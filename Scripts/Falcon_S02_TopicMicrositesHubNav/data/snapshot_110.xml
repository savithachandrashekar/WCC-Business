<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="110">
  <HTTPTask id="3324" hostname="c.contentsquare.net" path="/events?v=10.4.0&amp;sr=49&amp;mdh=1470&amp;pn=2&amp;re=1&amp;uu=043914a9-66f2-a204-aae8-602dabefbba4&amp;sn=1&amp;lv=1614154152&amp;lhd=1614154152&amp;hd=1614154251&amp;pid=1255&amp;str=447&amp;di=6772&amp;dc=10187&amp;fl=10193&amp;eu=%5B%5B2%2C42551%2C862%2C139%2C0%2C%22div%23content%3Ediv%3Aeq(3)%3Ediv%3Aeq(0)%3Ediv%3Aeq(1)%22%2C39040%2C13966%5D%2C%5B2%2C42951%2C861%2C140%2C0%2C%22%22%2C38995%2C15041%5D%5D" url="https://c.contentsquare.net/events?v=10.4.0&amp;sr=49&amp;mdh=1470&amp;pn=2&amp;re=1&amp;uu=043914a9-66f2-a204-aae8-602dabefbba4&amp;sn=1&amp;lv=1614154152&amp;lhd=1614154152&amp;hd=1614154251&amp;pid=1255&amp;str=447&amp;di=6772&amp;dc=10187&amp;fl=10193&amp;eu=%5B%5B2%2C42551%2C862%2C139%2C0%2C%22div%23content%3Ediv%3Aeq(3)%3Ediv%3Aeq(0)%3Ediv%3Aeq(1)%22%2C39040%2C13966%5D%2C%5B2%2C42951%2C861%2C140%2C0%2C%22%22%2C38995%2C15041%5D%5D" ip="18.214.30.116" port="443" connectionId="32" origin="Primary" frame="1" startDateTime="2021-02-24T08:15:04.200+00:00" startTime="364148000" endTime="364148062">
    <QueryString>
      <HTTPDataSet>
        <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
          <ActualData>dj0xMC40LjAmc3I9NDkmbWRoPTE0NzAmcG49MiZyZT0xJnV1PTA0MzkxNGE5LTY2ZjItYTIwNC1hYWU4LTYwMmRhYmVmYmJhNCZzbj0xJmx2PTE2MTQxNTQxNTImbGhkPTE2MTQxNTQxNTImaGQ9MTYxNDE1NDI1MSZwaWQ9MTI1NSZzdHI9NDQ3JmRpPTY3NzImZGM9MTAxODcmZmw9MTAxOTMmZXU9JTVCJTVCMiUyQzQyNTUxJTJDODYyJTJDMTM5JTJDMCUyQyUyMmRpdiUyM2NvbnRlbnQlM0VkaXYlM0FlcSgzKSUzRWRpdiUzQWVxKDApJTNFZGl2JTNBZXEoMSklMjIlMkMzOTA0MCUyQzEzOTY2JTVEJTJDJTVCMiUyQzQyOTUxJTJDODYxJTJDMTQwJTJDMCUyQyUyMiUyMiUyQzM4OTk1JTJDMTUwNDElNUQlNUQ=</ActualData>
        </HTTPData>
      </HTTPDataSet>
      <IsExternalData>false</IsExternalData>
    </QueryString>
    <HTTPSplittedQueryStrings>
      <HTTPHeaderEntity name="v" index="0">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MTAuNC4w</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="sr" index="1">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>NDk=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="mdh" index="2">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MTQ3MA==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="pn" index="3">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>Mg==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="re" index="4">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MQ==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="uu" index="5">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MDQzOTE0YTktNjZmMi1hMjA0LWFhZTgtNjAyZGFiZWZiYmE0</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="sn" index="6">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MQ==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="lv" index="7">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MTYxNDE1NDE1Mg==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="lhd" index="8">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MTYxNDE1NDE1Mg==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="hd" index="9">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MTYxNDE1NDI1MQ==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="pid" index="10">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MTI1NQ==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="str" index="11">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>NDQ3</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="di" index="12">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>Njc3Mg==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="dc" index="13">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MTAxODc=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="fl" index="14">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MTAxOTM=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="eu" index="15">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>JTVCJTVCMiUyQzQyNTUxJTJDODYyJTJDMTM5JTJDMCUyQyUyMmRpdiUyM2NvbnRlbnQlM0VkaXYlM0FlcSgzKSUzRWRpdiUzQWVxKDApJTNFZGl2JTNBZXEoMSklMjIlMkMzOTA0MCUyQzEzOTY2JTVEJTJDJTVCMiUyQzQyOTUxJTJDODYxJTJDMTQwJTJDMCUyQyUyMiUyMiUyQzM4OTk1JTJDMTUwNDElNUQlNUQ=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
    </HTTPSplittedQueryStrings>
    <HTTPRequest method="POST">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Yy5jb250ZW50c3F1YXJlLm5ldA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="sec-ch-ua" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>IkNocm9taXVtIjt2PSI4OCIsICJHb29nbGUgQ2hyb21lIjt2PSI4OCIsICI7Tm90IEEgQnJhbmQiO3Y9Ijk5Ig==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="sec-ch-ua-mobile" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>PzA=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg4LjAuNDMyNC4xODIgU2FmYXJpLzUzNy4zNg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9wbGFpbjtjaGFyc2V0PVVURi04</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Origin" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Sec-Fetch-Site" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Y3Jvc3Mtc2l0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Sec-Fetch-Mode" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bm8tY29ycw==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Sec-Fetch-Dest" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW1wdHk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20vdXMtZW4vaGVscC93aW5kb3dzLTEwLXN1cHBvcnQtY2VudGVy</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="13">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="14">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>UE9TVCAvZXZlbnRzP3Y9MTAuNC4wJnNyPTQ5Jm1kaD0xNDcwJnBuPTImcmU9MSZ1dT0wNDM5MTRhOS02NmYyLWEyMDQtYWFlOC02MDJkYWJlZmJiYTQmc249MSZsdj0xNjE0MTU0MTUyJmxoZD0xNjE0MTU0MTUyJmhkPTE2MTQxNTQyNTEmcGlkPTEyNTUmc3RyPTQ0NyZkaT02NzcyJmRjPTEwMTg3JmZsPTEwMTkzJmV1PSU1QiU1QjIlMkM0MjU1MSUyQzg2MiUyQzEzOSUyQzAlMkMlMjJkaXYlMjNjb250ZW50JTNFZGl2JTNBZXEoMyklM0VkaXYlM0FlcSgwKSUzRWRpdiUzQWVxKDEpJTIyJTJDMzkwNDAlMkMxMzk2NiU1RCUyQyU1QjIlMkM0Mjk1MSUyQzg2MSUyQzE0MCUyQzAlMkMlMjIlMjIlMkMzODk5NSUyQzE1MDQxJTVEJTVEIEhUVFAvMS4xDQpIb3N0OiBjLmNvbnRlbnRzcXVhcmUubmV0DQpDb25uZWN0aW9uOiBrZWVwLWFsaXZlDQpDb250ZW50LUxlbmd0aDogMA0Kc2VjLWNoLXVhOiAiQ2hyb21pdW0iO3Y9Ijg4IiwgIkdvb2dsZSBDaHJvbWUiO3Y9Ijg4IiwgIjtOb3QgQSBCcmFuZCI7dj0iOTkiDQpzZWMtY2gtdWEtbW9iaWxlOiA/MA0KVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg4LjAuNDMyNC4xODIgU2FmYXJpLzUzNy4zNg0KQ29udGVudC1UeXBlOiB0ZXh0L3BsYWluO2NoYXJzZXQ9VVRGLTgNCkFjY2VwdDogKi8qDQpPcmlnaW46IGh0dHBzOi8vcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tDQpTZWMtRmV0Y2gtU2l0ZTogY3Jvc3Mtc2l0ZQ0KU2VjLUZldGNoLU1vZGU6IG5vLWNvcnMNClNlYy1GZXRjaC1EZXN0OiBlbXB0eQ0KUmVmZXJlcjogaHR0cHM6Ly9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20vdXMtZW4vaGVscC93aW5kb3dzLTEwLXN1cHBvcnQtY2VudGVyDQpBY2NlcHQtRW5jb2Rpbmc6IGd6aXAsIGRlZmxhdGUsIGJyDQpBY2NlcHQtTGFuZ3VhZ2U6IGVuLVVTLGVuO3E9MC45DQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>43</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Date" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>V2VkLCAyNCBGZWIgMjAyMSAwODoxMTozNiBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aW1hZ2UvZ2lm</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>NDM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Timing-Allow-Origin" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Kg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bm8tY2FjaGUsIG5vLXN0b3JlLCBtdXN0LXJldmFsaWRhdGUsIHByZS1jaGVjaz0wLCBwb3N0LWNoZWNrPTA=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Pragma" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bm8tY2FjaGU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Expires" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>U3VuLCAyNCBPY3QgMTk4MiAyMzowMDowMCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Access-Control-Allow-Origin" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Kg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Access-Control-Allow-Methods" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VULCBQT1NULCBPUFRJT05T</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Access-Control-Allow-Headers" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXNzLUNvbnRyb2wtRXhwb3NlLUhlYWRlcnMsIENvbnRlbnQtVHlwZSwgQ29udGVudC1Db21wcmVzc2lvbiwgWC1SZXF1ZXN0ZWQtV2l0aA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Powered-By" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Q29udGVudFNxdWFyZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Disposition" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aW5saW5l</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpEYXRlOiBXZWQsIDI0IEZlYiAyMDIxIDA4OjExOjM2IEdNVA0KQ29udGVudC1UeXBlOiBpbWFnZS9naWYNCkNvbnRlbnQtTGVuZ3RoOiA0Mw0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KVGltaW5nLUFsbG93LU9yaWdpbjogKg0KQ2FjaGUtQ29udHJvbDogbm8tY2FjaGUsIG5vLXN0b3JlLCBtdXN0LXJldmFsaWRhdGUsIHByZS1jaGVjaz0wLCBwb3N0LWNoZWNrPTANClByYWdtYTogbm8tY2FjaGUNCkV4cGlyZXM6IFN1biwgMjQgT2N0IDE5ODIgMjM6MDA6MDAgR01UDQpBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW46ICoNCkFjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHM6IEdFVCwgUE9TVCwgT1BUSU9OUw0KQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVyczogQWNjZXNzLUNvbnRyb2wtRXhwb3NlLUhlYWRlcnMsIENvbnRlbnQtVHlwZSwgQ29udGVudC1Db21wcmVzc2lvbiwgWC1SZXF1ZXN0ZWQtV2l0aA0KWC1Qb3dlcmVkLUJ5OiBDb250ZW50U3F1YXJlDQpDb250ZW50LURpc3Bvc2l0aW9uOiBpbmxpbmUNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="364148046" offset="0" length="583" />
      </TcpPackets>
    </HTTPResponse>
    <HTTPTask id="3326" hostname="nebula-cdn.kampyle.com" path="/wu/541318/onsite/embed.js" url="https://nebula-cdn.kampyle.com/wu/541318/onsite/embed.js" ip="199.232.9.175" port="443" connectionId="25" origin="HTML" frame="1" startDateTime="2021-02-24T08:15:04.216+00:00" startTime="364148046" endTime="364148062">
      <HTTPRequest method="GET">
        <HTTPHeaders>
          <HTTPHeaderEntity name="Host" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bmVidWxhLWNkbi5rYW1weWxlLmNvbQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="sec-ch-ua" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>IkNocm9taXVtIjt2PSI4OCIsICJHb29nbGUgQ2hyb21lIjt2PSI4OCIsICI7Tm90IEEgQnJhbmQiO3Y9Ijk5Ig==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="If-None-Match" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ImVjMWEwYTc4ZGFkNDNlYjNhZTc5ODk1ZWFmNzczOWNjIg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="If-Modified-Since" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAyNCBGZWIgMjAyMSAwODowMzo0MSBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="sec-ch-ua-mobile" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>PzA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="User-Agent" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg4LjAuNDMyNC4xODIgU2FmYXJpLzUzNy4zNg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Ki8q</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Site" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Y3Jvc3Mtc2l0ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Mode" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tY29ycw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Dest" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>c2NyaXB0</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referer" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aHR0cHM6Ly9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20vdXMtZW4vaGVscC93aW5kb3dzLTEwLXN1cHBvcnQtY2VudGVyLWNvbXB1dGluZw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Encoding" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Language" index="13">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>R0VUIC93dS81NDEzMTgvb25zaXRlL2VtYmVkLmpzIEhUVFAvMS4xDQpIb3N0OiBuZWJ1bGEtY2RuLmthbXB5bGUuY29tDQpDb25uZWN0aW9uOiBrZWVwLWFsaXZlDQpzZWMtY2gtdWE6ICJDaHJvbWl1bSI7dj0iODgiLCAiR29vZ2xlIENocm9tZSI7dj0iODgiLCAiO05vdCBBIEJyYW5kIjt2PSI5OSINCklmLU5vbmUtTWF0Y2g6ICJlYzFhMGE3OGRhZDQzZWIzYWU3OTg5NWVhZjc3MzljYyINCklmLU1vZGlmaWVkLVNpbmNlOiBXZWQsIDI0IEZlYiAyMDIxIDA4OjAzOjQxIEdNVA0Kc2VjLWNoLXVhLW1vYmlsZTogPzANClVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS84OC4wLjQzMjQuMTgyIFNhZmFyaS81MzcuMzYNCkFjY2VwdDogKi8qDQpTZWMtRmV0Y2gtU2l0ZTogY3Jvc3Mtc2l0ZQ0KU2VjLUZldGNoLU1vZGU6IG5vLWNvcnMNClNlYy1GZXRjaC1EZXN0OiBzY3JpcHQNClJlZmVyZXI6IGh0dHBzOi8vcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tL3VzLWVuL2hlbHAvd2luZG93cy0xMC1zdXBwb3J0LWNlbnRlci1jb21wdXRpbmcNCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZSwgYnINCkFjY2VwdC1MYW5ndWFnZTogZW4tVVMsZW47cT0wLjkNCg0K</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
        </HTTPHeaders>
      </HTTPRequest>
      <HTTPResponse>
        <contentLenght>0</contentLenght>
        <HTTPHeaders>
          <HTTPHeaderEntity name="Connection" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Date" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAyNCBGZWIgMjAyMSAwODoxMTozNiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Via" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MS4xIHZhcm5pc2g=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cache-Control" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT0wLG11c3QtcmV2YWxpZGF0ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ETag" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ImVjMWEwYTc4ZGFkNDNlYjNhZTc5ODk1ZWFmNzczOWNjIg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Age" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NDc0</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Served-By" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Y2FjaGUtZGFsMjEyNzQtREFM</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Cache" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>SElU</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Cache-Hits" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Timer" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>UzE2MTQxNTQyOTYuMTg3ODI5LFZTMCxWRTA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Vary" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>SFRUUC8xLjEgMzA0IE5vdCBNb2RpZmllZA0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KRGF0ZTogV2VkLCAyNCBGZWIgMjAyMSAwODoxMTozNiBHTVQNClZpYTogMS4xIHZhcm5pc2gNCkNhY2hlLUNvbnRyb2w6IG1heC1hZ2U9MCxtdXN0LXJldmFsaWRhdGUNCkVUYWc6ICJlYzFhMGE3OGRhZDQzZWIzYWU3OTg5NWVhZjc3MzljYyINCkFnZTogNDc0DQpYLVNlcnZlZC1CeTogY2FjaGUtZGFsMjEyNzQtREFMDQpYLUNhY2hlOiBISVQNClgtQ2FjaGUtSGl0czogNA0KWC1UaW1lcjogUzE2MTQxNTQyOTYuMTg3ODI5LFZTMCxWRTANClZhcnk6IEFjY2VwdC1FbmNvZGluZw0KDQo=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
        </HTTPHeaders>
        <TcpPackets>
          <PacketInfo time="364148062" offset="0" length="326" />
        </TcpPackets>
      </HTTPResponse>
    </HTTPTask>
    <HTTPTask id="3330" hostname="ppssupport-itgllbh7.inc.hp.com" path="/etc.clientlibs/hp-wcc/clientlibs/clientlib-base.dedadcd11afc12a3de9b21d3a4cedd79.js" url="https://ppssupport-itgllbh7.inc.hp.com/etc.clientlibs/hp-wcc/clientlibs/clientlib-base.dedadcd11afc12a3de9b21d3a4cedd79.js" ip="15.72.22.19" port="443" connectionId="95" origin="HTML" frame="1" startDateTime="2021-02-24T08:15:04.230+00:00" startTime="364148062" endTime="364148359">
      <HTTPRequest method="GET">
        <HTTPHeaders>
          <HTTPHeaderEntity name="Host" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>cHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29t</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="sec-ch-ua" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>IkNocm9taXVtIjt2PSI4OCIsICJHb29nbGUgQ2hyb21lIjt2PSI4OCIsICI7Tm90IEEgQnJhbmQiO3Y9Ijk5Ig==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="sec-ch-ua-mobile" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>PzA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="User-Agent" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg4LjAuNDMyNC4xODIgU2FmYXJpLzUzNy4zNg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Ki8q</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Site" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>c2FtZS1vcmlnaW4=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Mode" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tY29ycw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Dest" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>c2NyaXB0</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referer" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aHR0cHM6Ly9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20vdXMtZW4vaGVscC93aW5kb3dzLTEwLXN1cHBvcnQtY2VudGVyLWNvbXB1dGluZw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Encoding" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Language" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cookie" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>X2NzX2M9MTsgQXBwbGljYXRpb25HYXRld2F5QWZmaW5pdHlDT1JTPTZlOTMwNjk1YjNkZGM4MmY1NmM3NjE5Y2U1MDBmOGM3OyBBcHBsaWNhdGlvbkdhdGV3YXlBZmZpbml0eT02ZTkzMDY5NWIzZGRjODJmNTZjNzYxOWNlNTAwZjhjNzsgV1JJZ25vcmU9dHJ1ZTsgQU1DVlNfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTsgc19lY2lkPU1DTUlEJTdDODE5ODU3NjQ1NzUyODA0OTc4NzQzMjYxNjkxMzQ3NzU3ODA3Nzg7IEFNQ1ZfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4NjgzJTdDTUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OCU3Q01DQUFNTEgtMTYxNDc1ODk1NCU3QzklN0NNQ0FBTUItMTYxNDc1ODk1NCU3QzZHMXluWWNMUHVpUXhZWnJzel9wa3FmTEc5eU1YQnBiMnpYNWR2SmRZUUp6UFhJbWRqMHklN0NNQ09QVE9VVC0xNjE0MTYxMzU1cyU3Q05PTkUlN0NNQ0FJRCU3Q05PTkUlN0NNQ1NZTkNTT1AlN0M0MTEtMTg2OTAlN0N2VmVyc2lvbiU3QzQuNC4wOyBrYW1weWxlX3VzZXJpZD0wZmEyLTgyODctYWMzNy1jMTMxLTcyMTEtMGY4Yi1kYzU3LTRmNjg7IGNkX3VzZXJfaWQ9MTc3ZDMxNWU0Y2M2ZmYtMGQ5NWRkMWUwN2JhZjMtNzNlMzU2Yi0xMjVmNTEtMTc3ZDMxNWU0Y2RiYTg7IHNfY2M9dHJ1ZTsgYWFtX3V1aWQ9ODgxMDAzNjU1NjgwMjc3MTk2NzQwMDI4ODYwMzM2NTEzNzE1NjY7IEpTRVNTSU9OSUQ9MDAwMEZhRGFCcDY5TFZaMkNRUXN4RkpCLUFKOjE5ZTBpZmY0Mjsgb3B0aW1pemVseUVuZFVzZXJJZD1vZXUxNjE0MTU0MjQ4NzAycjAuNzQxNjE1MDIxMDU0MjA1OyBfZ2NsX2F1PTEuMS4yOTM3OTkzNDEuMTYxNDE1NDI1MDsgaHBldWNrX3ByZWZzPTExMTExMTsgaHBldWNrX2Fuc3c9MTsgX3JkdF91dWlkPTE2MTQxNTQyNTE0OTAuZDZmZTlhZTMtYjgwNi00NmI4LThhOWUtMTcyZDc0ZDViNGY5OyBfdWV0c2lkPWNmM2ZmYWEwNzY3NzExZWJiNTE3OTk4ZDJiMmIzYWY0OyBfdWV0dmlkPWNmNDA2YTEwNzY3NzExZWJiNTdmN2Q5NjM4YTU4NTAwOyBfY3NfY3ZhcnM9JTdCJTIyMSUyMiUzQSU1QiUyMlRlbXBsYXRlJTIyJTJDJTIyTWljcm9zaXRlLXdpbjEwX2xlYXJuaW5nX2xhbmRpbmclMjIlNUQlN0Q7IF9jc19pZD0wNDM5MTRhOS02NmYyLWEyMDQtYWFlOC02MDJkYWJlZmJiYTQuMTYxNDE1NDE1Mi4xLjE2MTQxNTQyNTEuMTYxNDE1NDE1Mi4xNTg5MzgwMDk4LjE2NDgzMTgxNTI5NzkuTm9uZS4xOyBfY3Nfcz0yLjE7IF9fQ1RfRGF0YT1ncHY9MiZja3A9dGxkJmRtPWhwLmNvbSZhcHZfMzI1X3d3dzExPTImY3B2XzMyNV93d3cxMT0yOyBPcHRhbm9uQWxlcnRCb3hDbG9zZWQ9MjAyMS0wMi0yNFQwODoxMDo1Mi4xOTFaOyBPcHRhbm9uQ29uc2VudD1pc0lBQkdsb2JhbD1mYWxzZSZkYXRlc3RhbXA9V2VkK0ZlYisyNCsyMDIxKzA4JTNBMTAlM0E1MitHTVQlMkIwMDAwKyhHcmVlbndpY2grTWVhbitUaW1lKSZ2ZXJzaW9uPTYuMTQuMCZob3N0cz0mY29uc2VudElkPWFlNjBlOGU5LWMwNzMtNDY3Yy04YzY1LTQ5Y2Q2OTVmZGE1MCZpbnRlcmFjdGlvbkNvdW50PTEmbGFuZGluZ1BhdGg9Tm90TGFuZGluZ1BhZ2UmZ3JvdXBzPTElM0ExJTJDMiUzQTElMkMzJTNBMSUyQzQlM0ExJTJDNSUzQTElMkM2JTNBMSZnZW9sb2NhdGlvbj1VUyUzQk9SJkF3YWl0aW5nUmVjb25zZW50PWZhbHNlOyBrYW1weWxlVXNlclNlc3Npb249MTYxNDE1NDI1MjU0Mjsga2FtcHlsZVVzZXJTZXNzaW9uc0NvdW50PTI7IGthbXB5bGVTZXNzaW9uUGFnZUNvdW50ZXI9MTsgc19wX2NudD0xOyBocF9wdjFfcHJlZnM9MTExMTExOyBzX3ZudW09MTsgc19pbnZpc2l0PTE7IHNfaW52aXNpdGM9MTsgc19wcmV2aW91c1VybD1odHRwcyUzQS8vcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tL3VzLWVuL2hlbHAvd2luZG93cy0xMC1zdXBwb3J0LWNlbnRlcjsgc19wcG49RCUzRHY1NTsgc19wcHZsPXBwcy1jZXMlMjU3Q3NpdGVob21lX25ldyUyQzM3JTJDMzclMkM3MTMlMkMxNDYzJTJDNzEzJTJDMTQ2MyUyQzgyMyUyQzEuNzUlMkNQOyBzX3Bwdj1EJTI1M0R2NTUlMkM0OSUyQzQ5JTJDNzEzJTJDMTQ2MyUyQzcxMyUyQzE0NjMlMkM4MjMlMkMxLjc1JTJDUA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>R0VUIC9ldGMuY2xpZW50bGlicy9ocC13Y2MvY2xpZW50bGlicy9jbGllbnRsaWItYmFzZS5kZWRhZGNkMTFhZmMxMmEzZGU5YjIxZDNhNGNlZGQ3OS5qcyBIVFRQLzEuMQ0KSG9zdDogcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tDQpDb25uZWN0aW9uOiBrZWVwLWFsaXZlDQpzZWMtY2gtdWE6ICJDaHJvbWl1bSI7dj0iODgiLCAiR29vZ2xlIENocm9tZSI7dj0iODgiLCAiO05vdCBBIEJyYW5kIjt2PSI5OSINCnNlYy1jaC11YS1tb2JpbGU6ID8wDQpVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODguMC40MzI0LjE4MiBTYWZhcmkvNTM3LjM2DQpBY2NlcHQ6ICovKg0KU2VjLUZldGNoLVNpdGU6IHNhbWUtb3JpZ2luDQpTZWMtRmV0Y2gtTW9kZTogbm8tY29ycw0KU2VjLUZldGNoLURlc3Q6IHNjcmlwdA0KUmVmZXJlcjogaHR0cHM6Ly9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20vdXMtZW4vaGVscC93aW5kb3dzLTEwLXN1cHBvcnQtY2VudGVyLWNvbXB1dGluZw0KQWNjZXB0LUVuY29kaW5nOiBnemlwLCBkZWZsYXRlLCBicg0KQWNjZXB0LUxhbmd1YWdlOiBlbi1VUyxlbjtxPTAuOQ0KQ29va2llOiBfY3NfYz0xOyBBcHBsaWNhdGlvbkdhdGV3YXlBZmZpbml0eUNPUlM9NmU5MzA2OTViM2RkYzgyZjU2Yzc2MTljZTUwMGY4Yzc7IEFwcGxpY2F0aW9uR2F0ZXdheUFmZmluaXR5PTZlOTMwNjk1YjNkZGM4MmY1NmM3NjE5Y2U1MDBmOGM3OyBXUklnbm9yZT10cnVlOyBBTUNWU181RTM0MTIzRjUyNDVCMkNEMEE0OTBENDUlNDBBZG9iZU9yZz0xOyBzX2VjaWQ9TUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3ODsgQU1DVl81RTM0MTIzRjUyNDVCMkNEMEE0OTBENDUlNDBBZG9iZU9yZz0xNTg1NTQwMTM1JTdDTUNJRFRTJTdDMTg2ODMlN0NNQ01JRCU3QzgxOTg1NzY0NTc1MjgwNDk3ODc0MzI2MTY5MTM0Nzc1NzgwNzc4JTdDTUNBQU1MSC0xNjE0NzU4OTU0JTdDOSU3Q01DQUFNQi0xNjE0NzU4OTU0JTdDNkcxeW5ZY0xQdWlReFlacnN6X3BrcWZMRzl5TVhCcGIyelg1ZHZKZFlRSnpQWEltZGoweSU3Q01DT1BUT1VULTE2MTQxNjEzNTVzJTdDTk9ORSU3Q01DQUlEJTdDTk9ORSU3Q01DU1lOQ1NPUCU3QzQxMS0xODY5MCU3Q3ZWZXJzaW9uJTdDNC40LjA7IGthbXB5bGVfdXNlcmlkPTBmYTItODI4Ny1hYzM3LWMxMzEtNzIxMS0wZjhiLWRjNTctNGY2ODsgY2RfdXNlcl9pZD0xNzdkMzE1ZTRjYzZmZi0wZDk1ZGQxZTA3YmFmMy03M2UzNTZiLTEyNWY1MS0xNzdkMzE1ZTRjZGJhODsgc19jYz10cnVlOyBhYW1fdXVpZD04ODEwMDM2NTU2ODAyNzcxOTY3NDAwMjg4NjAzMzY1MTM3MTU2NjsgSlNFU1NJT05JRD0wMDAwRmFEYUJwNjlMVloyQ1FRc3hGSkItQUo6MTllMGlmZjQyOyBvcHRpbWl6ZWx5RW5kVXNlcklkPW9ldTE2MTQxNTQyNDg3MDJyMC43NDE2MTUwMjEwNTQyMDU7IF9nY2xfYXU9MS4xLjI5Mzc5OTM0MS4xNjE0MTU0MjUwOyBocGV1Y2tfcHJlZnM9MTExMTExOyBocGV1Y2tfYW5zdz0xOyBfcmR0X3V1aWQ9MTYxNDE1NDI1MTQ5MC5kNmZlOWFlMy1iODA2LTQ2YjgtOGE5ZS0xNzJkNzRkNWI0Zjk7IF91ZXRzaWQ9Y2YzZmZhYTA3Njc3MTFlYmI1MTc5OThkMmIyYjNhZjQ7IF91ZXR2aWQ9Y2Y0MDZhMTA3Njc3MTFlYmI1N2Y3ZDk2MzhhNTg1MDA7IF9jc19jdmFycz0lN0IlMjIxJTIyJTNBJTVCJTIyVGVtcGxhdGUlMjIlMkMlMjJNaWNyb3NpdGUtd2luMTBfbGVhcm5pbmdfbGFuZGluZyUyMiU1RCU3RDsgX2NzX2lkPTA0MzkxNGE5LTY2ZjItYTIwNC1hYWU4LTYwMmRhYmVmYmJhNC4xNjE0MTU0MTUyLjEuMTYxNDE1NDI1MS4xNjE0MTU0MTUyLjE1ODkzODAwOTguMTY0ODMxODE1Mjk3OS5Ob25lLjE7IF9jc19zPTIuMTsgX19DVF9EYXRhPWdwdj0yJmNrcD10bGQmZG09aHAuY29tJmFwdl8zMjVfd3d3MTE9MiZjcHZfMzI1X3d3dzExPTI7IE9wdGFub25BbGVydEJveENsb3NlZD0yMDIxLTAyLTI0VDA4OjEwOjUyLjE5MVo7IE9wdGFub25Db25zZW50PWlzSUFCR2xvYmFsPWZhbHNlJmRhdGVzdGFtcD1XZWQrRmViKzI0KzIwMjErMDglM0ExMCUzQTUyK0dNVCUyQjAwMDArKEdyZWVud2ljaCtNZWFuK1RpbWUpJnZlcnNpb249Ni4xNC4wJmhvc3RzPSZjb25zZW50SWQ9YWU2MGU4ZTktYzA3My00NjdjLThjNjUtNDljZDY5NWZkYTUwJmludGVyYWN0aW9uQ291bnQ9MSZsYW5kaW5nUGF0aD1Ob3RMYW5kaW5nUGFnZSZncm91cHM9MSUzQTElMkMyJTNBMSUyQzMlM0ExJTJDNCUzQTElMkM1JTNBMSUyQzYlM0ExJmdlb2xvY2F0aW9uPVVTJTNCT1ImQXdhaXRpbmdSZWNvbnNlbnQ9ZmFsc2U7IGthbXB5bGVVc2VyU2Vzc2lvbj0xNjE0MTU0MjUyNTQyOyBrYW1weWxlVXNlclNlc3Npb25zQ291bnQ9Mjsga2FtcHlsZVNlc3Npb25QYWdlQ291bnRlcj0xOyBzX3BfY250PTE7IGhwX3B2MV9wcmVmcz0xMTExMTE7IHNfdm51bT0xOyBzX2ludmlzaXQ9MTsgc19pbnZpc2l0Yz0xOyBzX3ByZXZpb3VzVXJsPWh0dHBzJTNBLy9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20vdXMtZW4vaGVscC93aW5kb3dzLTEwLXN1cHBvcnQtY2VudGVyOyBzX3Bwbj1EJTNEdjU1OyBzX3Bwdmw9cHBzLWNlcyUyNTdDc2l0ZWhvbWVfbmV3JTJDMzclMkMzNyUyQzcxMyUyQzE0NjMlMkM3MTMlMkMxNDYzJTJDODIzJTJDMS43NSUyQ1A7IHNfcHB2PUQlMjUzRHY1NSUyQzQ5JTJDNDklMkM3MTMlMkMxNDYzJTJDNzEzJTJDMTQ2MyUyQzgyMyUyQzEuNzUlMkNQDQoNCg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
          <HTTPCookies>
            <HTTPHeaderEntity name="_cs_c" index="0">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="ApplicationGatewayAffinityCORS" index="1">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>NmU5MzA2OTViM2RkYzgyZjU2Yzc2MTljZTUwMGY4Yzc=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="ApplicationGatewayAffinity" index="2">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>NmU5MzA2OTViM2RkYzgyZjU2Yzc2MTljZTUwMGY4Yzc=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="WRIgnore" index="3">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>dHJ1ZQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="AMCVS_5E34123F5245B2CD0A490D45%40AdobeOrg" index="4">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ecid" index="5">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>TUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OA==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="AMCV_5E34123F5245B2CD0A490D45%40AdobeOrg" index="6">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4NjgzJTdDTUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OCU3Q01DQUFNTEgtMTYxNDc1ODk1NCU3QzklN0NNQ0FBTUItMTYxNDc1ODk1NCU3QzZHMXluWWNMUHVpUXhZWnJzel9wa3FmTEc5eU1YQnBiMnpYNWR2SmRZUUp6UFhJbWRqMHklN0NNQ09QVE9VVC0xNjE0MTYxMzU1cyU3Q05PTkUlN0NNQ0FJRCU3Q05PTkUlN0NNQ1NZTkNTT1AlN0M0MTEtMTg2OTAlN0N2VmVyc2lvbiU3QzQuNC4w</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyle_userid" index="7">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MGZhMi04Mjg3LWFjMzctYzEzMS03MjExLTBmOGItZGM1Ny00ZjY4</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="cd_user_id" index="8">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTc3ZDMxNWU0Y2M2ZmYtMGQ5NWRkMWUwN2JhZjMtNzNlMzU2Yi0xMjVmNTEtMTc3ZDMxNWU0Y2RiYTg=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_cc" index="9">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>dHJ1ZQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="aam_uuid" index="10">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>ODgxMDAzNjU1NjgwMjc3MTk2NzQwMDI4ODYwMzM2NTEzNzE1NjY=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="JSESSIONID" index="11">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MDAwMEZhRGFCcDY5TFZaMkNRUXN4RkpCLUFKOjE5ZTBpZmY0Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="optimizelyEndUserId" index="12">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>b2V1MTYxNDE1NDI0ODcwMnIwLjc0MTYxNTAyMTA1NDIwNQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_gcl_au" index="13">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MS4xLjI5Mzc5OTM0MS4xNjE0MTU0MjUw</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="hpeuck_prefs" index="14">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTExMTEx</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="hpeuck_answ" index="15">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_rdt_uuid" index="16">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTYxNDE1NDI1MTQ5MC5kNmZlOWFlMy1iODA2LTQ2YjgtOGE5ZS0xNzJkNzRkNWI0Zjk=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_uetsid" index="17">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Y2YzZmZhYTA3Njc3MTFlYmI1MTc5OThkMmIyYjNhZjQ=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_uetvid" index="18">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Y2Y0MDZhMTA3Njc3MTFlYmI1N2Y3ZDk2MzhhNTg1MDA=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_cs_cvars" index="19">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>JTdCJTIyMSUyMiUzQSU1QiUyMlRlbXBsYXRlJTIyJTJDJTIyTWljcm9zaXRlLXdpbjEwX2xlYXJuaW5nX2xhbmRpbmclMjIlNUQlN0Q=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_cs_id" index="20">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MDQzOTE0YTktNjZmMi1hMjA0LWFhZTgtNjAyZGFiZWZiYmE0LjE2MTQxNTQxNTIuMS4xNjE0MTU0MjUxLjE2MTQxNTQxNTIuMTU4OTM4MDA5OC4xNjQ4MzE4MTUyOTc5Lk5vbmUuMQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_cs_s" index="21">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Mi4x</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="__CT_Data" index="22">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Z3B2PTImY2twPXRsZCZkbT1ocC5jb20mYXB2XzMyNV93d3cxMT0yJmNwdl8zMjVfd3d3MTE9Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="OptanonAlertBoxClosed" index="23">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MjAyMS0wMi0yNFQwODoxMDo1Mi4xOTFa</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="OptanonConsent" index="24">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>aXNJQUJHbG9iYWw9ZmFsc2UmZGF0ZXN0YW1wPVdlZCtGZWIrMjQrMjAyMSswOCUzQTEwJTNBNTIrR01UJTJCMDAwMCsoR3JlZW53aWNoK01lYW4rVGltZSkmdmVyc2lvbj02LjE0LjAmaG9zdHM9JmNvbnNlbnRJZD1hZTYwZThlOS1jMDczLTQ2N2MtOGM2NS00OWNkNjk1ZmRhNTAmaW50ZXJhY3Rpb25Db3VudD0xJmxhbmRpbmdQYXRoPU5vdExhbmRpbmdQYWdlJmdyb3Vwcz0xJTNBMSUyQzIlM0ExJTJDMyUzQTElMkM0JTNBMSUyQzUlM0ExJTJDNiUzQTEmZ2VvbG9jYXRpb249VVMlM0JPUiZBd2FpdGluZ1JlY29uc2VudD1mYWxzZQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyleUserSession" index="25">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTYxNDE1NDI1MjU0Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyleUserSessionsCount" index="26">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyleSessionPageCounter" index="27">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_p_cnt" index="28">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="hp_pv1_prefs" index="29">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTExMTEx</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_vnum" index="30">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_invisit" index="31">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_invisitc" index="32">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_previousUrl" index="33">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>aHR0cHMlM0EvL3Bwc3N1cHBvcnQtaXRnbGxiaDcuaW5jLmhwLmNvbS91cy1lbi9oZWxwL3dpbmRvd3MtMTAtc3VwcG9ydC1jZW50ZXI=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ppn" index="34">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>RCUzRHY1NQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ppvl" index="35">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>cHBzLWNlcyUyNTdDc2l0ZWhvbWVfbmV3JTJDMzclMkMzNyUyQzcxMyUyQzE0NjMlMkM3MTMlMkMxNDYzJTJDODIzJTJDMS43NSUyQ1A=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ppv" index="36">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>RCUyNTNEdjU1JTJDNDklMkM0OSUyQzcxMyUyQzE0NjMlMkM3MTMlMkMxNDYzJTJDODIzJTJDMS43NSUyQ1A=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
          </HTTPCookies>
        </HTTPHeaders>
      </HTTPRequest>
      <HTTPResponse>
        <contentLenght>0</contentLenght>
        <HTTPHeaders>
          <HTTPHeaderEntity name="Server" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bmdpbngvMS4xOC4w</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Date" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAyNCBGZWIgMjAyMSAwODoxMTozNiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Content-Type" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdDtjaGFyc2V0PXV0Zi04</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Transfer-Encoding" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Y2h1bmtlZA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Dispatcher" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZGlzcGF0Y2hlcjFlYXN0dXMy</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Vhost" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>d2ViLWN1c3RvbWVyLWNhcmU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Content-Type-Options" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm9zbmlmZg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Last-Modified" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>VGh1LCAxOCBGZWIgMjAyMSAxNjowNDowMiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ETag" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ImE2MzQzLTViYjllN2JlZTYwODAtZ3ppcCI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Ranges" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Ynl0ZXM=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Vary" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>QWNjZXB0LUVuY29kaW5nLFVzZXItQWdlbnQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Content-Encoding" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Z3ppcA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frame-Options" index="13">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>U0FNRU9SSUdJTg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frame-Options" index="14">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>REVOWQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Content-Type-Options" index="15">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm9zbmlmZg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-XSS-Protection" index="16">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTsgbW9kZT1ibG9jaw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Strict-Transport-Security" index="17">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referrer-Policy" index="18">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Access-Control-Allow-Origin" index="19">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Kg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Access-Control-Allow-Credentials" index="20">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dHJ1ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frame-Options" index="21">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>REVOWQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Content-Type-Options" index="22">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm9zbmlmZg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-XSS-Protection" index="23">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTsgbW9kZT1ibG9jaw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Strict-Transport-Security" index="24">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referrer-Policy" index="25">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Expires" index="26">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAwMyBNYXIgMjAyMSAwODoxMTozNiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cache-Control" index="27">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT02MDQ4MDA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IG5naW54LzEuMTguMA0KRGF0ZTogV2VkLCAyNCBGZWIgMjAyMSAwODoxMTozNiBHTVQNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdDtjaGFyc2V0PXV0Zi04DQpUcmFuc2Zlci1FbmNvZGluZzogY2h1bmtlZA0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KWC1EaXNwYXRjaGVyOiBkaXNwYXRjaGVyMWVhc3R1czINClgtVmhvc3Q6IHdlYi1jdXN0b21lci1jYXJlDQpYLUNvbnRlbnQtVHlwZS1PcHRpb25zOiBub3NuaWZmDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDE4IEZlYiAyMDIxIDE2OjA0OjAyIEdNVA0KRVRhZzogImE2MzQzLTViYjllN2JlZTYwODAtZ3ppcCINCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpWYXJ5OiBBY2NlcHQtRW5jb2RpbmcsVXNlci1BZ2VudA0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KWC1GcmFtZS1PcHRpb25zOiBTQU1FT1JJR0lODQpYLUZyYW1lLU9wdGlvbnM6IERFTlkNClgtQ29udGVudC1UeXBlLU9wdGlvbnM6IG5vc25pZmYNClgtWFNTLVByb3RlY3Rpb246IDE7IG1vZGU9YmxvY2sNClN0cmljdC1UcmFuc3BvcnQtU2VjdXJpdHk6IG1heC1hZ2U9MTU3NjgwMDA7IGluY2x1ZGVTdWJEb21haW5zOyBwcmVsb2FkDQpSZWZlcnJlci1Qb2xpY3k6IG5vLXJlZmVycmVyLXdoZW4tZG93bmdyYWRlDQpBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW46ICoNCkFjY2Vzcy1Db250cm9sLUFsbG93LUNyZWRlbnRpYWxzOiB0cnVlDQpYLUZyYW1lLU9wdGlvbnM6IERFTlkNClgtQ29udGVudC1UeXBlLU9wdGlvbnM6IG5vc25pZmYNClgtWFNTLVByb3RlY3Rpb246IDE7IG1vZGU9YmxvY2sNClN0cmljdC1UcmFuc3BvcnQtU2VjdXJpdHk6IG1heC1hZ2U9MTU3NjgwMDA7IGluY2x1ZGVTdWJEb21haW5zOyBwcmVsb2FkDQpSZWZlcnJlci1Qb2xpY3k6IG5vLXJlZmVycmVyLXdoZW4tZG93bmdyYWRlDQpFeHBpcmVzOiBXZWQsIDAzIE1hciAyMDIxIDA4OjExOjM2IEdNVA0KQ2FjaGUtQ29udHJvbDogbWF4LWFnZT02MDQ4MDANCg0K</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
        </HTTPHeaders>
        <HTTPBody>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>LyohCiAqIGpRdWVyeSBKYXZhU2NyaXB0IExpYnJhcnkgdjEuMTIuNC1hZW0KICogaHR0cDovL2pxdWVyeS5jb20vCiAqCiAqIEluY2x1ZGVzIFNpenpsZS5qcwogKiBodHRwOi8vc2l6emxlanMuY29tLwogKgogKiBDb3B5cmlnaHQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBEYXRlOiAyMDE2LTA1LTIwVDE3OjE3WgogKi8KCihmdW5jdGlvbiggZ2xvYmFsLCBmYWN0b3J5ICkgewoKCWlmICggdHlwZW9mIG1vZHVsZSA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIG1vZHVsZS5leHBvcnRzID09PSAib2JqZWN0IiApIHsKCQkvLyBGb3IgQ29tbW9uSlMgYW5kIENvbW1vbkpTLWxpa2UgZW52aXJvbm1lbnRzIHdoZXJlIGEgcHJvcGVyIGB3aW5kb3dgCgkJLy8gaXMgcHJlc2VudCwgZXhlY3V0ZSB0aGUgZmFjdG9yeSBhbmQgZ2V0IGpRdWVyeS4KCQkvLyBGb3IgZW52aXJvbm1lbnRzIHRoYXQgZG8gbm90IGhhdmUgYSBgd2luZG93YCB3aXRoIGEgYGRvY3VtZW50YAoJCS8vIChzdWNoIGFzIE5vZGUuanMpLCBleHBvc2UgYSBmYWN0b3J5IGFzIG1vZHVsZS5leHBvcnRzLgoJCS8vIFRoaXMgYWNjZW50dWF0ZXMgdGhlIG5lZWQgZm9yIHRoZSBjcmVhdGlvbiBvZiBhIHJlYWwgYHdpbmRvd2AuCgkJLy8gZS5nLiB2YXIgalF1ZXJ5ID0gcmVxdWlyZSgianF1ZXJ5Iikod2luZG93KTsKCQkvLyBTZWUgdGlja2V0ICMxNDU0OSBmb3IgbW9yZSBpbmZvLgoJCW1vZHVsZS5leHBvcnRzID0gZ2xvYmFsLmRvY3VtZW50ID8KCQkJZmFjdG9yeSggZ2xvYmFsLCB0cnVlICkgOgoJCQlmdW5jdGlvbiggdyApIHsKCQkJCWlmICggIXcuZG9jdW1lbnQgKSB7CgkJCQkJdGhyb3cgbmV3IEVycm9yKCAialF1ZXJ5IHJlcXVpcmVzIGEgd2luZG93IHdpdGggYSBkb2N1bWVudCIgKTsKCQkJCX0KCQkJCXJldHVybiBmYWN0b3J5KCB3ICk7CgkJCX07Cgl9IGVsc2UgewoJCWZhY3RvcnkoIGdsb2JhbCApOwoJfQoKLy8gUGFzcyB0aGlzIGlmIHdpbmRvdyBpcyBub3QgZGVmaW5lZCB5ZXQKfSh0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHRoaXMsIGZ1bmN0aW9uKCB3aW5kb3csIG5vR2xvYmFsICkgewoKLy8gU3VwcG9ydDogRmlyZWZveCAxOCsKLy8gQ2FuJ3QgYmUgaW4gc3RyaWN0IG1vZGUsIHNldmVyYWwgbGlicyBpbmNsdWRpbmcgQVNQLk5FVCB0cmFjZQovLyB0aGUgc3RhY2sgdmlhIGFyZ3VtZW50cy5jYWxsZXIuY2FsbGVlIGFuZCBGaXJlZm94IGRpZXMgaWYKLy8geW91IHRyeSB0byB0cmFjZSB0aHJvdWdoICJ1c2Ugc3RyaWN0IiBjYWxsIGNoYWlucy4gKCMxMzMzNSkKLy8idXNlIHN0cmljdCI7CnZhciBkZWxldGVkSWRzID0gW107Cgp2YXIgZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQ7Cgp2YXIgc2xpY2UgPSBkZWxldGVkSWRzLnNsaWNlOwoKdmFyIGNvbmNhdCA9IGRlbGV0ZWRJZHMuY29uY2F0OwoKdmFyIHB1c2ggPSBkZWxldGVkSWRzLnB1c2g7Cgp2YXIgaW5kZXhPZiA9IGRlbGV0ZWRJZHMuaW5kZXhPZjsKCnZhciBjbGFzczJ0eXBlID0ge307Cgp2YXIgdG9TdHJpbmcgPSBjbGFzczJ0eXBlLnRvU3RyaW5nOwoKdmFyIGhhc093biA9IGNsYXNzMnR5cGUuaGFzT3duUHJvcGVydHk7Cgp2YXIgc3VwcG9ydCA9IHt9OwoKCgp2YXIKCXZlcnNpb24gPSAiMS4xMi40LWFlbSIsCgoJLy8gRGVmaW5lIGEgbG9jYWwgY29weSBvZiBqUXVlcnkKCWpRdWVyeSA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsKCgkJLy8gVGhlIGpRdWVyeSBvYmplY3QgaXMgYWN0dWFsbHkganVzdCB0aGUgaW5pdCBjb25zdHJ1Y3RvciAnZW5oYW5jZWQnCgkJLy8gTmVlZCBpbml0IGlmIGpRdWVyeSBpcyBjYWxsZWQgKGp1c3QgYWxsb3cgZXJyb3IgdG8gYmUgdGhyb3duIGlmIG5vdCBpbmNsdWRlZCkKCQlyZXR1cm4gbmV3IGpRdWVyeS5mbi5pbml0KCBzZWxlY3RvciwgY29udGV4dCApOwoJfSwKCgkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMSwgSUU8OQoJLy8gTWFrZSBzdXJlIHdlIHRyaW0gQk9NIGFuZCBOQlNQCglydHJpbSA9IC9eW1xzXHVGRUZGXHhBMF0rfFtcc1x1RkVGRlx4QTBdKyQvZywKCgkvLyBNYXRjaGVzIGRhc2hlZCBzdHJpbmcgZm9yIGNhbWVsaXppbmcKCXJtc1ByZWZpeCA9IC9eLW1zLS8sCglyZGFzaEFscGhhID0gLy0oW1xkYS16XSkvZ2ksCgoJLy8gVXNlZCBieSBqUXVlcnkuY2FtZWxDYXNlIGFzIGNhbGxiYWNrIHRvIHJlcGxhY2UoKQoJZmNhbWVsQ2FzZSA9IGZ1bmN0aW9uKCBhbGwsIGxldHRlciApIHsKCQlyZXR1cm4gbGV0dGVyLnRvVXBwZXJDYXNlKCk7Cgl9OwoKalF1ZXJ5LmZuID0galF1ZXJ5LnByb3RvdHlwZSA9IHsKCgkvLyBUaGUgY3VycmVudCB2ZXJzaW9uIG9mIGpRdWVyeSBiZWluZyB1c2VkCglqcXVlcnk6IHZlcnNpb24sCgoJY29uc3RydWN0b3I6IGpRdWVyeSwKCgkvLyBTdGFydCB3aXRoIGFuIGVtcHR5IHNlbGVjdG9yCglzZWxlY3RvcjogIiIsCgoJLy8gVGhlIGRlZmF1bHQgbGVuZ3RoIG9mIGEgalF1ZXJ5IG9iamVjdCBpcyAwCglsZW5ndGg6IDAsCgoJdG9BcnJheTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHNsaWNlLmNhbGwoIHRoaXMgKTsKCX0sCgoJLy8gR2V0IHRoZSBOdGggZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldCBPUgoJLy8gR2V0IHRoZSB3aG9sZSBtYXRjaGVkIGVsZW1lbnQgc2V0IGFzIGEgY2xlYW4gYXJyYXkKCWdldDogZnVuY3Rpb24oIG51bSApIHsKCQlyZXR1cm4gbnVtICE9IG51bGwgPwoKCQkJLy8gUmV0dXJuIGp1c3QgdGhlIG9uZSBlbGVtZW50IGZyb20gdGhlIHNldAoJCQkoIG51bSA8IDAgPyB0aGlzWyBudW0gKyB0aGlzLmxlbmd0aCBdIDogdGhpc1sgbnVtIF0gKSA6CgoJCQkvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyBpbiBhIGNsZWFuIGFycmF5CgkJCXNsaWNlLmNhbGwoIHRoaXMgKTsKCX0sCgoJLy8gVGFrZSBhbiBhcnJheSBvZiBlbGVtZW50cyBhbmQgcHVzaCBpdCBvbnRvIHRoZSBzdGFjawoJLy8gKHJldHVybmluZyB0aGUgbmV3IG1hdGNoZWQgZWxlbWVudCBzZXQpCglwdXNoU3RhY2s6IGZ1bmN0aW9uKCBlbGVtcyApIHsKCgkJLy8gQnVpbGQgYSBuZXcgalF1ZXJ5IG1hdGNoZWQgZWxlbWVudCBzZXQKCQl2YXIgcmV0ID0galF1ZXJ5Lm1lcmdlKCB0aGlzLmNvbnN0cnVjdG9yKCksIGVsZW1zICk7CgoJCS8vIEFkZCB0aGUgb2xkIG9iamVjdCBvbnRvIHRoZSBzdGFjayAoYXMgYSByZWZlcmVuY2UpCgkJcmV0LnByZXZPYmplY3QgPSB0aGlzOwoJCXJldC5jb250ZXh0ID0gdGhpcy5jb250ZXh0OwoKCQkvLyBSZXR1cm4gdGhlIG5ld2x5LWZvcm1lZCBlbGVtZW50IHNldAoJCXJldHVybiByZXQ7Cgl9LAoKCS8vIEV4ZWN1dGUgYSBjYWxsYmFjayBmb3IgZXZlcnkgZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBzZXQuCgllYWNoOiBmdW5jdGlvbiggY2FsbGJhY2sgKSB7CgkJcmV0dXJuIGpRdWVyeS5lYWNoKCB0aGlzLCBjYWxsYmFjayApOwoJfSwKCgltYXA6IGZ1bmN0aW9uKCBjYWxsYmFjayApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIGpRdWVyeS5tYXAoIHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQlyZXR1cm4gY2FsbGJhY2suY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCX0gKSApOwoJfSwKCglzbGljZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBzbGljZS5hcHBseSggdGhpcywgYXJndW1lbnRzICkgKTsKCX0sCgoJZmlyc3Q6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmVxKCAwICk7Cgl9LAoKCWxhc3Q6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmVxKCAtMSApOwoJfSwKCgllcTogZnVuY3Rpb24oIGkgKSB7CgkJdmFyIGxlbiA9IHRoaXMubGVuZ3RoLAoJCQlqID0gK2kgKyAoIGkgPCAwID8gbGVuIDogMCApOwoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggaiA+PSAwICYmIGogPCBsZW4gPyBbIHRoaXNbIGogXSBdIDogW10gKTsKCX0sCgoJZW5kOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wcmV2T2JqZWN0IHx8IHRoaXMuY29uc3RydWN0b3IoKTsKCX0sCgoJLy8gRm9yIGludGVybmFsIHVzZSBvbmx5LgoJLy8gQmVoYXZlcyBsaWtlIGFuIEFycmF5J3MgbWV0aG9kLCBub3QgbGlrZSBhIGpRdWVyeSBtZXRob2QuCglwdXNoOiBwdXNoLAoJc29ydDogZGVsZXRlZElkcy5zb3J0LAoJc3BsaWNlOiBkZWxldGVkSWRzLnNwbGljZQp9OwoKalF1ZXJ5LmV4dGVuZCA9IGpRdWVyeS5mbi5leHRlbmQgPSBmdW5jdGlvbigpIHsKCXZhciBzcmMsIGNvcHlJc0FycmF5LCBjb3B5LCBuYW1lLCBvcHRpb25zLCBjbG9uZSwKCQl0YXJnZXQgPSBhcmd1bWVudHNbIDAgXSB8fCB7fSwKCQlpID0gMSwKCQlsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLAoJCWRlZXAgPSBmYWxzZTsKCgkvLyBIYW5kbGUgYSBkZWVwIGNvcHkgc2l0dWF0aW9uCglpZiAoIHR5cGVvZiB0YXJnZXQgPT09ICJib29sZWFuIiApIHsKCQlkZWVwID0gdGFyZ2V0OwoKCQkvLyBza2lwIHRoZSBib29sZWFuIGFuZCB0aGUgdGFyZ2V0CgkJdGFyZ2V0ID0gYXJndW1lbnRzWyBpIF0gfHwge307CgkJaSsrOwoJfQoKCS8vIEhhbmRsZSBjYXNlIHdoZW4gdGFyZ2V0IGlzIGEgc3RyaW5nIG9yIHNvbWV0aGluZyAocG9zc2libGUgaW4gZGVlcCBjb3B5KQoJaWYgKCB0eXBlb2YgdGFyZ2V0ICE9PSAib2JqZWN0IiAmJiAhalF1ZXJ5LmlzRnVuY3Rpb24oIHRhcmdldCApICkgewoJCXRhcmdldCA9IHt9OwoJfQoKCS8vIGV4dGVuZCBqUXVlcnkgaXRzZWxmIGlmIG9ubHkgb25lIGFyZ3VtZW50IGlzIHBhc3NlZAoJaWYgKCBpID09PSBsZW5ndGggKSB7CgkJdGFyZ2V0ID0gdGhpczsKCQlpLS07Cgl9CgoJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgoJCS8vIE9ubHkgZGVhbCB3aXRoIG5vbi1udWxsL3VuZGVmaW5lZCB2YWx1ZXMKCQlpZiAoICggb3B0aW9ucyA9IGFyZ3VtZW50c1sgaSBdICkgIT0gbnVsbCApIHsKCgkJCS8vIEV4dGVuZCB0aGUgYmFzZSBvYmplY3QKCQkJZm9yICggbmFtZSBpbiBvcHRpb25zICkgewoJCQkJc3JjID0gdGFyZ2V0WyBuYW1lIF07CgkJCQljb3B5ID0gb3B0aW9uc1sgbmFtZSBdOwoKCQkJCS8vIFByZXZlbnQgbmV2ZXItZW5kaW5nIGxvb3AKCQkJCS8vIFByZXZlbnQgUHJvdG90eXBlIFBvbGx1dGlvbiBWdWxuZXJhYmlsaXR5CgkJCQlpZiAoIG5hbWUgPT09ICJfX3Byb3RvX18iIHx8IHRhcmdldCA9PT0gY29weSApIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCgkJCQkvLyBSZWN1cnNlIGlmIHdlJ3JlIG1lcmdpbmcgcGxhaW4gb2JqZWN0cyBvciBhcnJheXMKCQkJCWlmICggZGVlcCAmJiBjb3B5ICYmICggalF1ZXJ5LmlzUGxhaW5PYmplY3QoIGNvcHkgKSB8fAoJCQkJCSggY29weUlzQXJyYXkgPSBqUXVlcnkuaXNBcnJheSggY29weSApICkgKSApIHsKCgkJCQkJaWYgKCBjb3B5SXNBcnJheSApIHsKCQkJCQkJY29weUlzQXJyYXkgPSBmYWxzZTsKCQkJCQkJY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzQXJyYXkoIHNyYyApID8gc3JjIDogW107CgoJCQkJCX0gZWxzZSB7CgkJCQkJCWNsb25lID0gc3JjICYmIGpRdWVyeS5pc1BsYWluT2JqZWN0KCBzcmMgKSA/IHNyYyA6IHt9OwoJCQkJCX0KCgkJCQkJLy8gTmV2ZXIgbW92ZSBvcmlnaW5hbCBvYmplY3RzLCBjbG9uZSB0aGVtCgkJCQkJdGFyZ2V0WyBuYW1lIF0gPSBqUXVlcnkuZXh0ZW5kKCBkZWVwLCBjbG9uZSwgY29weSApOwoKCQkJCS8vIERvbid0IGJyaW5nIGluIHVuZGVmaW5lZCB2YWx1ZXMKCQkJCX0gZWxzZSBpZiAoIGNvcHkgIT09IHVuZGVmaW5lZCApIHsKCQkJCQl0YXJnZXRbIG5hbWUgXSA9IGNvcHk7CgkJCQl9CgkJCX0KCQl9Cgl9CgoJLy8gUmV0dXJuIHRoZSBtb2RpZmllZCBvYmplY3QKCXJldHVybiB0YXJnZXQ7Cn07CgpqUXVlcnkuZXh0ZW5kKCB7CgoJLy8gVW5pcXVlIGZvciBlYWNoIGNvcHkgb2YgalF1ZXJ5IG9uIHRoZSBwYWdlCglleHBhbmRvOiAialF1ZXJ5IiArICggdmVyc2lvbiArIE1hdGgucmFuZG9tKCkgKS5yZXBsYWNlKCAvXEQvZywgIiIgKSwKCgkvLyBBc3N1bWUgalF1ZXJ5IGlzIHJlYWR5IHdpdGhvdXQgdGhlIHJlYWR5IG1vZHVsZQoJaXNSZWFkeTogdHJ1ZSwKCgllcnJvcjogZnVuY3Rpb24oIG1zZyApIHsKCQl0aHJvdyBuZXcgRXJyb3IoIG1zZyApOwoJfSwKCglub29wOiBmdW5jdGlvbigpIHt9LAoKCS8vIFNlZSB0ZXN0L3VuaXQvY29yZS5qcyBmb3IgZGV0YWlscyBjb25jZXJuaW5nIGlzRnVuY3Rpb24uCgkvLyBTaW5jZSB2ZXJzaW9uIDEuMywgRE9NIG1ldGhvZHMgYW5kIGZ1bmN0aW9ucyBsaWtlIGFsZXJ0CgkvLyBhcmVuJ3Qgc3VwcG9ydGVkLiBUaGV5IHJldHVybiBmYWxzZSBvbiBJRSAoIzI5NjgpLgoJaXNGdW5jdGlvbjogZnVuY3Rpb24oIG9iaiApIHsKCQlyZXR1cm4galF1ZXJ5LnR5cGUoIG9iaiApID09PSAiZnVuY3Rpb24iOwoJfSwKCglpc0FycmF5OiBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uKCBvYmogKSB7CgkJcmV0dXJuIGpRdWVyeS50eXBlKCBvYmogKSA9PT0gImFycmF5IjsKCX0sCgoJaXNXaW5kb3c6IGZ1bmN0aW9uKCBvYmogKSB7CgkJLyoganNoaW50IGVxZXFlcTogZmFsc2UgKi8KCQlyZXR1cm4gb2JqICE9IG51bGwgJiYgb2JqID09IG9iai53aW5kb3c7Cgl9LAoKCWlzTnVtZXJpYzogZnVuY3Rpb24oIG9iaiApIHsKCgkJLy8gcGFyc2VGbG9hdCBOYU5zIG51bWVyaWMtY2FzdCBmYWxzZSBwb3NpdGl2ZXMgKG51bGx8dHJ1ZXxmYWxzZXwiIikKCQkvLyAuLi5idXQgbWlzaW50ZXJwcmV0cyBsZWFkaW5nLW51bWJlciBzdHJpbmdzLCBwYXJ0aWN1bGFybHkgaGV4IGxpdGVyYWxzICgiMHguLi4iKQoJCS8vIHN1YnRyYWN0aW9uIGZvcmNlcyBpbmZpbml0aWVzIHRvIE5hTgoJCS8vIGFkZGluZyAxIGNvcnJlY3RzIGxvc3Mgb2YgcHJlY2lzaW9uIGZyb20gcGFyc2VGbG9hdCAoIzE1MTAwKQoJCXZhciByZWFsU3RyaW5nT2JqID0gb2JqICYmIG9iai50b1N0cmluZygpOwoJCXJldHVybiAhalF1ZXJ5LmlzQXJyYXkoIG9iaiApICYmICggcmVhbFN0cmluZ09iaiAtIHBhcnNlRmxvYXQoIHJlYWxTdHJpbmdPYmogKSArIDEgKSA+PSAwOwoJfSwKCglpc0VtcHR5T2JqZWN0OiBmdW5jdGlvbiggb2JqICkgewoJCXZhciBuYW1lOwoJCWZvciAoIG5hbWUgaW4gb2JqICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCXJldHVybiB0cnVlOwoJfSwKCglpc1BsYWluT2JqZWN0OiBmdW5jdGlvbiggb2JqICkgewoJCXZhciBrZXk7CgoJCS8vIE11c3QgYmUgYW4gT2JqZWN0LgoJCS8vIEJlY2F1c2Ugb2YgSUUsIHdlIGFsc28gaGF2ZSB0byBjaGVjayB0aGUgcHJlc2VuY2Ugb2YgdGhlIGNvbnN0cnVjdG9yIHByb3BlcnR5LgoJCS8vIE1ha2Ugc3VyZSB0aGF0IERPTSBub2RlcyBhbmQgd2luZG93IG9iamVjdHMgZG9uJ3QgcGFzcyB0aHJvdWdoLCBhcyB3ZWxsCgkJaWYgKCAhb2JqIHx8IGpRdWVyeS50eXBlKCBvYmogKSAhPT0gIm9iamVjdCIgfHwgb2JqLm5vZGVUeXBlIHx8IGpRdWVyeS5pc1dpbmRvdyggb2JqICkgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXRyeSB7CgoJCQkvLyBOb3Qgb3duIGNvbnN0cnVjdG9yIHByb3BlcnR5IG11c3QgYmUgT2JqZWN0CgkJCWlmICggb2JqLmNvbnN0cnVjdG9yICYmCgkJCQkhaGFzT3duLmNhbGwoIG9iaiwgImNvbnN0cnVjdG9yIiApICYmCgkJCQkhaGFzT3duLmNhbGwoIG9iai5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsICJpc1Byb3RvdHlwZU9mIiApICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfSBjYXRjaCAoIGUgKSB7CgoJCQkvLyBJRTgsOSBXaWxsIHRocm93IGV4Y2VwdGlvbnMgb24gY2VydGFpbiBob3N0IG9iamVjdHMgIzk4OTcKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIEhhbmRsZSBpdGVyYXRpb24gb3ZlciBpbmhlcml0ZWQgcHJvcGVydGllcyBiZWZvcmUgb3duIHByb3BlcnRpZXMuCgkJaWYgKCAhc3VwcG9ydC5vd25GaXJzdCApIHsKCQkJZm9yICgga2V5IGluIG9iaiApIHsKCQkJCXJldHVybiBoYXNPd24uY2FsbCggb2JqLCBrZXkgKTsKCQkJfQoJCX0KCgkJLy8gT3duIHByb3BlcnRpZXMgYXJlIGVudW1lcmF0ZWQgZmlyc3RseSwgc28gdG8gc3BlZWQgdXAsCgkJLy8gaWYgbGFzdCBvbmUgaXMgb3duLCB0aGVuIGFsbCBwcm9wZXJ0aWVzIGFyZSBvd24uCgkJZm9yICgga2V5IGluIG9iaiApIHt9CgoJCXJldHVybiBrZXkgPT09IHVuZGVmaW5lZCB8fCBoYXNPd24uY2FsbCggb2JqLCBrZXkgKTsKCX0sCgoJdHlwZTogZnVuY3Rpb24oIG9iaiApIHsKCQlpZiAoIG9iaiA9PSBudWxsICkgewoJCQlyZXR1cm4gb2JqICsgIiI7CgkJfQoJCXJldHVybiB0eXBlb2Ygb2JqID09PSAib2JqZWN0IiB8fCB0eXBlb2Ygb2JqID09PSAiZnVuY3Rpb24iID8KCQkJY2xhc3MydHlwZVsgdG9TdHJpbmcuY2FsbCggb2JqICkgXSB8fCAib2JqZWN0IiA6CgkJCXR5cGVvZiBvYmo7Cgl9LAoKCS8vIFdvcmthcm91bmRzIGJhc2VkIG9uIGZpbmRpbmdzIGJ5IEppbSBEcmlzY29sbAoJLy8gaHR0cDovL3dlYmxvZ3MuamF2YS5uZXQvYmxvZy9kcmlzY29sbC9hcmNoaXZlLzIwMDkvMDkvMDgvZXZhbC1qYXZhc2NyaXB0LWdsb2JhbC1jb250ZXh0CglnbG9iYWxFdmFsOiBmdW5jdGlvbiggZGF0YSApIHsKCQlpZiAoIGRhdGEgJiYgalF1ZXJ5LnRyaW0oIGRhdGEgKSApIHsKCgkJCS8vIFdlIHVzZSBleGVjU2NyaXB0IG9uIEludGVybmV0IEV4cGxvcmVyCgkJCS8vIFdlIHVzZSBhbiBhbm9ueW1vdXMgZnVuY3Rpb24gc28gdGhhdCBjb250ZXh0IGlzIHdpbmRvdwoJCQkvLyByYXRoZXIgdGhhbiBqUXVlcnkgaW4gRmlyZWZveAoJCQkoIHdpbmRvdy5leGVjU2NyaXB0IHx8IGZ1bmN0aW9uKCBkYXRhICkgewoJCQkJd2luZG93WyAiZXZhbCIgXS5jYWxsKCB3aW5kb3csIGRhdGEgKTsgLy8ganNjczppZ25vcmUgcmVxdWlyZURvdE5vdGF0aW9uCgkJCX0gKSggZGF0YSApOwoJCX0KCX0sCgoJLy8gQ29udmVydCBkYXNoZWQgdG8gY2FtZWxDYXNlOyB1c2VkIGJ5IHRoZSBjc3MgYW5kIGRhdGEgbW9kdWxlcwoJLy8gTWljcm9zb2Z0IGZvcmdvdCB0byBodW1wIHRoZWlyIHZlbmRvciBwcmVmaXggKCM5NTcyKQoJY2FtZWxDYXNlOiBmdW5jdGlvbiggc3RyaW5nICkgewoJCXJldHVybiBzdHJpbmcucmVwbGFjZSggcm1zUHJlZml4LCAibXMtIiApLnJlcGxhY2UoIHJkYXNoQWxwaGEsIGZjYW1lbENhc2UgKTsKCX0sCgoJbm9kZU5hbWU6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJCXJldHVybiBlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJfSwKCgllYWNoOiBmdW5jdGlvbiggb2JqLCBjYWxsYmFjayApIHsKCQl2YXIgbGVuZ3RoLCBpID0gMDsKCgkJaWYgKCBpc0FycmF5TGlrZSggb2JqICkgKSB7CgkJCWxlbmd0aCA9IG9iai5sZW5ndGg7CgkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJaWYgKCBjYWxsYmFjay5jYWxsKCBvYmpbIGkgXSwgaSwgb2JqWyBpIF0gKSA9PT0gZmFsc2UgKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQl9IGVsc2UgewoJCQlmb3IgKCBpIGluIG9iaiApIHsKCQkJCWlmICggY2FsbGJhY2suY2FsbCggb2JqWyBpIF0sIGksIG9ialsgaSBdICkgPT09IGZhbHNlICkgewoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gb2JqOwoJfSwKCgkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMSwgSUU8OQoJdHJpbTogZnVuY3Rpb24oIHRleHQgKSB7CgkJcmV0dXJuIHRleHQgPT0gbnVsbCA/CgkJCSIiIDoKCQkJKCB0ZXh0ICsgIiIgKS5yZXBsYWNlKCBydHJpbSwgIiIgKTsKCX0sCgoJLy8gcmVzdWx0cyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJbWFrZUFycmF5OiBmdW5jdGlvbiggYXJyLCByZXN1bHRzICkgewoJCXZhciByZXQgPSByZXN1bHRzIHx8IFtdOwoKCQlpZiAoIGFyciAhPSBudWxsICkgewoJCQlpZiAoIGlzQXJyYXlMaWtlKCBPYmplY3QoIGFyciApICkgKSB7CgkJCQlqUXVlcnkubWVyZ2UoIHJldCwKCQkJCQl0eXBlb2YgYXJyID09PSAic3RyaW5nIiA/CgkJCQkJWyBhcnIgXSA6IGFycgoJCQkJKTsKCQkJfSBlbHNlIHsKCQkJCXB1c2guY2FsbCggcmV0LCBhcnIgKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldDsKCX0sCgoJaW5BcnJheTogZnVuY3Rpb24oIGVsZW0sIGFyciwgaSApIHsKCQl2YXIgbGVuOwoKCQlpZiAoIGFyciApIHsKCQkJaWYgKCBpbmRleE9mICkgewoJCQkJcmV0dXJuIGluZGV4T2YuY2FsbCggYXJyLCBlbGVtLCBpICk7CgkJCX0KCgkJCWxlbiA9IGFyci5sZW5ndGg7CgkJCWkgPSBpID8gaSA8IDAgPyBNYXRoLm1heCggMCwgbGVuICsgaSApIDogaSA6IDA7CgoJCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCgkJCQkvLyBTa2lwIGFjY2Vzc2luZyBpbiBzcGFyc2UgYXJyYXlzCgkJCQlpZiAoIGkgaW4gYXJyICYmIGFyclsgaSBdID09PSBlbGVtICkgewoJCQkJCXJldHVybiBpOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gLTE7Cgl9LAoKCW1lcmdlOiBmdW5jdGlvbiggZmlyc3QsIHNlY29uZCApIHsKCQl2YXIgbGVuID0gK3NlY29uZC5sZW5ndGgsCgkJCWogPSAwLAoJCQlpID0gZmlyc3QubGVuZ3RoOwoKCQl3aGlsZSAoIGogPCBsZW4gKSB7CgkJCWZpcnN0WyBpKysgXSA9IHNlY29uZFsgaisrIF07CgkJfQoKCQkvLyBTdXBwb3J0OiBJRTw5CgkJLy8gV29ya2Fyb3VuZCBjYXN0aW5nIG9mIC5sZW5ndGggdG8gTmFOIG9uIG90aGVyd2lzZSBhcnJheWxpa2Ugb2JqZWN0cyAoZS5nLiwgTm9kZUxpc3RzKQoJCWlmICggbGVuICE9PSBsZW4gKSB7CgkJCXdoaWxlICggc2Vjb25kWyBqIF0gIT09IHVuZGVmaW5lZCApIHsKCQkJCWZpcnN0WyBpKysgXSA9IHNlY29uZFsgaisrIF07CgkJCX0KCQl9CgoJCWZpcnN0Lmxlbmd0aCA9IGk7CgoJCXJldHVybiBmaXJzdDsKCX0sCgoJZ3JlcDogZnVuY3Rpb24oIGVsZW1zLCBjYWxsYmFjaywgaW52ZXJ0ICkgewoJCXZhciBjYWxsYmFja0ludmVyc2UsCgkJCW1hdGNoZXMgPSBbXSwKCQkJaSA9IDAsCgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKCQkJY2FsbGJhY2tFeHBlY3QgPSAhaW52ZXJ0OwoKCQkvLyBHbyB0aHJvdWdoIHRoZSBhcnJheSwgb25seSBzYXZpbmcgdGhlIGl0ZW1zCgkJLy8gdGhhdCBwYXNzIHRoZSB2YWxpZGF0b3IgZnVuY3Rpb24KCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJY2FsbGJhY2tJbnZlcnNlID0gIWNhbGxiYWNrKCBlbGVtc1sgaSBdLCBpICk7CgkJCWlmICggY2FsbGJhY2tJbnZlcnNlICE9PSBjYWxsYmFja0V4cGVjdCApIHsKCQkJCW1hdGNoZXMucHVzaCggZWxlbXNbIGkgXSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gbWF0Y2hlczsKCX0sCgoJLy8gYXJnIGlzIGZvciBpbnRlcm5hbCB1c2FnZSBvbmx5CgltYXA6IGZ1bmN0aW9uKCBlbGVtcywgY2FsbGJhY2ssIGFyZyApIHsKCQl2YXIgbGVuZ3RoLCB2YWx1ZSwKCQkJaSA9IDAsCgkJCXJldCA9IFtdOwoKCQkvLyBHbyB0aHJvdWdoIHRoZSBhcnJheSwgdHJhbnNsYXRpbmcgZWFjaCBvZiB0aGUgaXRlbXMgdG8gdGhlaXIgbmV3IHZhbHVlcwoJCWlmICggaXNBcnJheUxpa2UoIGVsZW1zICkgKSB7CgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aDsKCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQl2YWx1ZSA9IGNhbGxiYWNrKCBlbGVtc1sgaSBdLCBpLCBhcmcgKTsKCgkJCQlpZiAoIHZhbHVlICE9IG51bGwgKSB7CgkJCQkJcmV0LnB1c2goIHZhbHVlICk7CgkJCQl9CgkJCX0KCgkJLy8gR28gdGhyb3VnaCBldmVyeSBrZXkgb24gdGhlIG9iamVjdCwKCQl9IGVsc2UgewoJCQlmb3IgKCBpIGluIGVsZW1zICkgewoJCQkJdmFsdWUgPSBjYWxsYmFjayggZWxlbXNbIGkgXSwgaSwgYXJnICk7CgoJCQkJaWYgKCB2YWx1ZSAhPSBudWxsICkgewoJCQkJCXJldC5wdXNoKCB2YWx1ZSApOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzCgkJcmV0dXJuIGNvbmNhdC5hcHBseSggW10sIHJldCApOwoJfSwKCgkvLyBBIGdsb2JhbCBHVUlEIGNvdW50ZXIgZm9yIG9iamVjdHMKCWd1aWQ6IDEsCgoJLy8gQmluZCBhIGZ1bmN0aW9uIHRvIGEgY29udGV4dCwgb3B0aW9uYWxseSBwYXJ0aWFsbHkgYXBwbHlpbmcgYW55CgkvLyBhcmd1bWVudHMuCglwcm94eTogZnVuY3Rpb24oIGZuLCBjb250ZXh0ICkgewoJCXZhciBhcmdzLCBwcm94eSwgdG1wOwoKCQlpZiAoIHR5cGVvZiBjb250ZXh0ID09PSAic3RyaW5nIiApIHsKCQkJdG1wID0gZm5bIGNvbnRleHQgXTsKCQkJY29udGV4dCA9IGZuOwoJCQlmbiA9IHRtcDsKCQl9CgoJCS8vIFF1aWNrIGNoZWNrIHRvIGRldGVybWluZSBpZiB0YXJnZXQgaXMgY2FsbGFibGUsIGluIHRoZSBzcGVjCgkJLy8gdGhpcyB0aHJvd3MgYSBUeXBlRXJyb3IsIGJ1dCB3ZSB3aWxsIGp1c3QgcmV0dXJuIHVuZGVmaW5lZC4KCQlpZiAoICFqUXVlcnkuaXNGdW5jdGlvbiggZm4gKSApIHsKCQkJcmV0dXJuIHVuZGVmaW5lZDsKCQl9CgoJCS8vIFNpbXVsYXRlZCBiaW5kCgkJYXJncyA9IHNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMiApOwoJCXByb3h5ID0gZnVuY3Rpb24oKSB7CgkJCXJldHVybiBmbi5hcHBseSggY29udGV4dCB8fCB0aGlzLCBhcmdzLmNvbmNhdCggc2xpY2UuY2FsbCggYXJndW1lbnRzICkgKSApOwoJCX07CgoJCS8vIFNldCB0aGUgZ3VpZCBvZiB1bmlxdWUgaGFuZGxlciB0byB0aGUgc2FtZSBvZiBvcmlnaW5hbCBoYW5kbGVyLCBzbyBpdCBjYW4gYmUgcmVtb3ZlZAoJCXByb3h5Lmd1aWQgPSBmbi5ndWlkID0gZm4uZ3VpZCB8fCBqUXVlcnkuZ3VpZCsrOwoKCQlyZXR1cm4gcHJveHk7Cgl9LAoKCW5vdzogZnVuY3Rpb24oKSB7CgkJcmV0dXJuICsoIG5ldyBEYXRlKCkgKTsKCX0sCgoJLy8galF1ZXJ5LnN1cHBvcnQgaXMgbm90IHVzZWQgaW4gQ29yZSBidXQgb3RoZXIgcHJvamVjdHMgYXR0YWNoIHRoZWlyCgkvLyBwcm9wZXJ0aWVzIHRvIGl0IHNvIGl0IG5lZWRzIHRvIGV4aXN0LgoJc3VwcG9ydDogc3VwcG9ydAp9ICk7CgovLyBKU0hpbnQgd291bGQgZXJyb3Igb24gdGhpcyBjb2RlIGR1ZSB0byB0aGUgU3ltYm9sIG5vdCBiZWluZyBkZWZpbmVkIGluIEVTNS4KLy8gRGVmaW5pbmcgdGhpcyBnbG9iYWwgaW4gLmpzaGludHJjIHdvdWxkIGNyZWF0ZSBhIGRhbmdlciBvZiB1c2luZyB0aGUgZ2xvYmFsCi8vIHVuZ3VhcmRlZCBpbiBhbm90aGVyIHBsYWNlLCBpdCBzZWVtcyBzYWZlciB0byBqdXN0IGRpc2FibGUgSlNIaW50IGZvciB0aGVzZQovLyB0aHJlZSBsaW5lcy4KLyoganNoaW50IGlnbm9yZTogc3RhcnQgKi8KaWYgKCB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICkgewoJalF1ZXJ5LmZuWyBTeW1ib2wuaXRlcmF0b3IgXSA9IGRlbGV0ZWRJZHNbIFN5bWJvbC5pdGVyYXRvciBdOwp9Ci8qIGpzaGludCBpZ25vcmU6IGVuZCAqLwoKLy8gUG9wdWxhdGUgdGhlIGNsYXNzMnR5cGUgbWFwCmpRdWVyeS5lYWNoKCAiQm9vbGVhbiBOdW1iZXIgU3RyaW5nIEZ1bmN0aW9uIEFycmF5IERhdGUgUmVnRXhwIE9iamVjdCBFcnJvciBTeW1ib2wiLnNwbGl0KCAiICIgKSwKZnVuY3Rpb24oIGksIG5hbWUgKSB7CgljbGFzczJ0eXBlWyAiW29iamVjdCAiICsgbmFtZSArICJdIiBdID0gbmFtZS50b0xvd2VyQ2FzZSgpOwp9ICk7CgpmdW5jdGlvbiBpc0FycmF5TGlrZSggb2JqICkgewoKCS8vIFN1cHBvcnQ6IGlPUyA4LjIgKG5vdCByZXByb2R1Y2libGUgaW4gc2ltdWxhdG9yKQoJLy8gYGluYCBjaGVjayB1c2VkIHRvIHByZXZlbnQgSklUIGVycm9yIChnaC0yMTQ1KQoJLy8gaGFzT3duIGlzbid0IHVzZWQgaGVyZSBkdWUgdG8gZmFsc2UgbmVnYXRpdmVzCgkvLyByZWdhcmRpbmcgTm9kZWxpc3QgbGVuZ3RoIGluIElFCgl2YXIgbGVuZ3RoID0gISFvYmogJiYgImxlbmd0aCIgaW4gb2JqICYmIG9iai5sZW5ndGgsCgkJdHlwZSA9IGpRdWVyeS50eXBlKCBvYmogKTsKCglpZiAoIHR5cGUgPT09ICJmdW5jdGlvbiIgfHwgalF1ZXJ5LmlzV2luZG93KCBvYmogKSApIHsKCQlyZXR1cm4gZmFsc2U7Cgl9CgoJcmV0dXJuIHR5cGUgPT09ICJhcnJheSIgfHwgbGVuZ3RoID09PSAwIHx8CgkJdHlwZW9mIGxlbmd0aCA9PT0gIm51bWJlciIgJiYgbGVuZ3RoID4gMCAmJiAoIGxlbmd0aCAtIDEgKSBpbiBvYmo7Cn0KdmFyIFNpenpsZSA9Ci8qIQogKiBTaXp6bGUgQ1NTIFNlbGVjdG9yIEVuZ2luZSB2Mi4yLjEKICogaHR0cDovL3NpenpsZWpzLmNvbS8KICoKICogQ29weXJpZ2h0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogRGF0ZTogMjAxNS0xMC0xNwogKi8KKGZ1bmN0aW9uKCB3aW5kb3cgKSB7Cgp2YXIgaSwKCXN1cHBvcnQsCglFeHByLAoJZ2V0VGV4dCwKCWlzWE1MLAoJdG9rZW5pemUsCgljb21waWxlLAoJc2VsZWN0LAoJb3V0ZXJtb3N0Q29udGV4dCwKCXNvcnRJbnB1dCwKCWhhc0R1cGxpY2F0ZSwKCgkvLyBMb2NhbCBkb2N1bWVudCB2YXJzCglzZXREb2N1bWVudCwKCWRvY3VtZW50LAoJZG9jRWxlbSwKCWRvY3VtZW50SXNIVE1MLAoJcmJ1Z2d5UVNBLAoJcmJ1Z2d5TWF0Y2hlcywKCW1hdGNoZXMsCgljb250YWlucywKCgkvLyBJbnN0YW5jZS1zcGVjaWZpYyBkYXRhCglleHBhbmRvID0gInNpenpsZSIgKyAxICogbmV3IERhdGUoKSwKCXByZWZlcnJlZERvYyA9IHdpbmRvdy5kb2N1bWVudCwKCWRpcnJ1bnMgPSAwLAoJZG9uZSA9IDAsCgljbGFzc0NhY2hlID0gY3JlYXRlQ2FjaGUoKSwKCXRva2VuQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLAoJY29tcGlsZXJDYWNoZSA9IGNyZWF0ZUNhY2hlKCksCglzb3J0T3JkZXIgPSBmdW5jdGlvbiggYSwgYiApIHsKCQlpZiAoIGEgPT09IGIgKSB7CgkJCWhhc0R1cGxpY2F0ZSA9IHRydWU7CgkJfQoJCXJldHVybiAwOwoJfSwKCgkvLyBHZW5lcmFsLXB1cnBvc2UgY29uc3RhbnRzCglNQVhfTkVHQVRJVkUgPSAxIDw8IDMxLAoKCS8vIEluc3RhbmNlIG1ldGhvZHMKCWhhc093biA9ICh7fSkuaGFzT3duUHJvcGVydHksCglhcnIgPSBbXSwKCXBvcCA9IGFyci5wb3AsCglwdXNoX25hdGl2ZSA9IGFyci5wdXNoLAoJcHVzaCA9IGFyci5wdXNoLAoJc2xpY2UgPSBhcnIuc2xpY2UsCgkvLyBVc2UgYSBzdHJpcHBlZC1kb3duIGluZGV4T2YgYXMgaXQncyBmYXN0ZXIgdGhhbiBuYXRpdmUKCS8vIGh0dHA6Ly9qc3BlcmYuY29tL3Rob3ItaW5kZXhvZi12cy1mb3IvNQoJaW5kZXhPZiA9IGZ1bmN0aW9uKCBsaXN0LCBlbGVtICkgewoJCXZhciBpID0gMCwKCQkJbGVuID0gbGlzdC5sZW5ndGg7CgkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCWlmICggbGlzdFtpXSA9PT0gZWxlbSApIHsKCQkJCXJldHVybiBpOwoJCQl9CgkJfQoJCXJldHVybiAtMTsKCX0sCgoJYm9vbGVhbnMgPSAiY2hlY2tlZHxzZWxlY3RlZHxhc3luY3xhdXRvZm9jdXN8YXV0b3BsYXl8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGlzbWFwfGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWQiLAoKCS8vIFJlZ3VsYXIgZXhwcmVzc2lvbnMKCgkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXNlbGVjdG9ycy8jd2hpdGVzcGFjZQoJd2hpdGVzcGFjZSA9ICJbXFx4MjBcXHRcXHJcXG5cXGZdIiwKCgkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9DU1MyMS9zeW5kYXRhLmh0bWwjdmFsdWUtZGVmLWlkZW50aWZpZXIKCWlkZW50aWZpZXIgPSAiKD86XFxcXC58W1xcdy1dfFteXFx4MDAtXFx4YTBdKSsiLAoKCS8vIEF0dHJpYnV0ZSBzZWxlY3RvcnM6IGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jYXR0cmlidXRlLXNlbGVjdG9ycwoJYXR0cmlidXRlcyA9ICJcXFsiICsgd2hpdGVzcGFjZSArICIqKCIgKyBpZGVudGlmaWVyICsgIikoPzoiICsgd2hpdGVzcGFjZSArCgkJLy8gT3BlcmF0b3IgKGNhcHR1cmUgMikKCQkiKihbKl4kfCF+XT89KSIgKyB3aGl0ZXNwYWNlICsKCQkvLyAiQXR0cmlidXRlIHZhbHVlcyBtdXN0IGJlIENTUyBpZGVudGlmaWVycyBbY2FwdHVyZSA1XSBvciBzdHJpbmdzIFtjYXB0dXJlIDMgb3IgY2FwdHVyZSA0XSIKCQkiKig/OicoKD86XFxcXC58W15cXFxcJ10pKiknfFwiKCg/OlxcXFwufFteXFxcXFwiXSkqKVwifCgiICsgaWRlbnRpZmllciArICIpKXwpIiArIHdoaXRlc3BhY2UgKwoJCSIqXFxdIiwKCglwc2V1ZG9zID0gIjooIiArIGlkZW50aWZpZXIgKyAiKSg/OlxcKCgiICsKCQkvLyBUbyByZWR1Y2UgdGhlIG51bWJlciBvZiBzZWxlY3RvcnMgbmVlZGluZyB0b2tlbml6ZSBpbiB0aGUgcHJlRmlsdGVyLCBwcmVmZXIgYXJndW1lbnRzOgoJCS8vIDEuIHF1b3RlZCAoY2FwdHVyZSAzOyBjYXB0dXJlIDQgb3IgY2FwdHVyZSA1KQoJCSIoJygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCIpfCIgKwoJCS8vIDIuIHNpbXBsZSAoY2FwdHVyZSA2KQoJCSIoKD86XFxcXC58W15cXFxcKClbXFxdXXwiICsgYXR0cmlidXRlcyArICIpKil8IiArCgkJLy8gMy4gYW55dGhpbmcgZWxzZSAoY2FwdHVyZSAyKQoJCSIuKiIgKwoJCSIpXFwpfCkiLAoKCS8vIExlYWRpbmcgYW5kIG5vbi1lc2NhcGVkIHRyYWlsaW5nIHdoaXRlc3BhY2UsIGNhcHR1cmluZyBzb21lIG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlcnMgcHJlY2VkaW5nIHRoZSBsYXR0ZXIKCXJ3aGl0ZXNwYWNlID0gbmV3IFJlZ0V4cCggd2hpdGVzcGFjZSArICIrIiwgImciICksCglydHJpbSA9IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiK3woKD86XnxbXlxcXFxdKSg/OlxcXFwuKSopIiArIHdoaXRlc3BhY2UgKyAiKyQiLCAiZyIgKSwKCglyY29tbWEgPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIiosIiArIHdoaXRlc3BhY2UgKyAiKiIgKSwKCXJjb21iaW5hdG9ycyA9IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiKihbPit+XXwiICsgd2hpdGVzcGFjZSArICIpIiArIHdoaXRlc3BhY2UgKyAiKiIgKSwKCglyYXR0cmlidXRlUXVvdGVzID0gbmV3IFJlZ0V4cCggIj0iICsgd2hpdGVzcGFjZSArICIqKFteXFxdJ1wiXSo/KSIgKyB3aGl0ZXNwYWNlICsgIipcXF0iLCAiZyIgKSwKCglycHNldWRvID0gbmV3IFJlZ0V4cCggcHNldWRvcyApLAoJcmlkZW50aWZpZXIgPSBuZXcgUmVnRXhwKCAiXiIgKyBpZGVudGlmaWVyICsgIiQiICksCgoJbWF0Y2hFeHByID0gewoJCSJJRCI6IG5ldyBSZWdFeHAoICJeIygiICsgaWRlbnRpZmllciArICIpIiApLAoJCSJDTEFTUyI6IG5ldyBSZWdFeHAoICJeXFwuKCIgKyBpZGVudGlmaWVyICsgIikiICksCgkJIlRBRyI6IG5ldyBSZWdFeHAoICJeKCIgKyBpZGVudGlmaWVyICsgInxbKl0pIiApLAoJCSJBVFRSIjogbmV3IFJlZ0V4cCggIl4iICsgYXR0cmlidXRlcyApLAoJCSJQU0VVRE8iOiBuZXcgUmVnRXhwKCAiXiIgKyBwc2V1ZG9zICksCgkJIkNISUxEIjogbmV3IFJlZ0V4cCggIl46KG9ubHl8Zmlyc3R8bGFzdHxudGh8bnRoLWxhc3QpLShjaGlsZHxvZi10eXBlKSg/OlxcKCIgKyB3aGl0ZXNwYWNlICsKCQkJIiooZXZlbnxvZGR8KChbKy1dfCkoXFxkKilufCkiICsgd2hpdGVzcGFjZSArICIqKD86KFsrLV18KSIgKyB3aGl0ZXNwYWNlICsKCQkJIiooXFxkKyl8KSkiICsgd2hpdGVzcGFjZSArICIqXFwpfCkiLCAiaSIgKSwKCQkiYm9vbCI6IG5ldyBSZWdFeHAoICJeKD86IiArIGJvb2xlYW5zICsgIikkIiwgImkiICksCgkJLy8gRm9yIHVzZSBpbiBsaWJyYXJpZXMgaW1wbGVtZW50aW5nIC5pcygpCgkJLy8gV2UgdXNlIHRoaXMgZm9yIFBPUyBtYXRjaGluZyBpbiBgc2VsZWN0YAoJCSJuZWVkc0NvbnRleHQiOiBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcKCIgKwoJCQl3aGl0ZXNwYWNlICsgIiooKD86LVxcZCk/XFxkKikiICsgd2hpdGVzcGFjZSArICIqXFwpfCkoPz1bXi1dfCQpIiwgImkiICkKCX0sCgoJcmlucHV0cyA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbikkL2ksCglyaGVhZGVyID0gL15oXGQkL2ksCgoJcm5hdGl2ZSA9IC9eW157XStce1xzKlxbbmF0aXZlIFx3LywKCgkvLyBFYXNpbHktcGFyc2VhYmxlL3JldHJpZXZhYmxlIElEIG9yIFRBRyBvciBDTEFTUyBzZWxlY3RvcnMKCXJxdWlja0V4cHIgPSAvXig/OiMoW1x3LV0rKXwoXHcrKXxcLihbXHctXSspKSQvLAoKCXJzaWJsaW5nID0gL1srfl0vLAoJcmVzY2FwZSA9IC8nfFxcL2csCgoJLy8gQ1NTIGVzY2FwZXMgaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI2VzY2FwZWQtY2hhcmFjdGVycwoJcnVuZXNjYXBlID0gbmV3IFJlZ0V4cCggIlxcXFwoW1xcZGEtZl17MSw2fSIgKyB3aGl0ZXNwYWNlICsgIj98KCIgKyB3aGl0ZXNwYWNlICsgIil8LikiLCAiaWciICksCglmdW5lc2NhcGUgPSBmdW5jdGlvbiggXywgZXNjYXBlZCwgZXNjYXBlZFdoaXRlc3BhY2UgKSB7CgkJdmFyIGhpZ2ggPSAiMHgiICsgZXNjYXBlZCAtIDB4MTAwMDA7CgkJLy8gTmFOIG1lYW5zIG5vbi1jb2RlcG9pbnQKCQkvLyBTdXBwb3J0OiBGaXJlZm94PDI0CgkJLy8gV29ya2Fyb3VuZCBlcnJvbmVvdXMgbnVtZXJpYyBpbnRlcnByZXRhdGlvbiBvZiArIjB4IgoJCXJldHVybiBoaWdoICE9PSBoaWdoIHx8IGVzY2FwZWRXaGl0ZXNwYWNlID8KCQkJZXNjYXBlZCA6CgkJCWhpZ2ggPCAwID8KCQkJCS8vIEJNUCBjb2RlcG9pbnQKCQkJCVN0cmluZy5mcm9tQ2hhckNvZGUoIGhpZ2ggKyAweDEwMDAwICkgOgoJCQkJLy8gU3VwcGxlbWVudGFsIFBsYW5lIGNvZGVwb2ludCAoc3Vycm9nYXRlIHBhaXIpCgkJCQlTdHJpbmcuZnJvbUNoYXJDb2RlKCBoaWdoID4+IDEwIHwgMHhEODAwLCBoaWdoICYgMHgzRkYgfCAweERDMDAgKTsKCX0sCgoJLy8gVXNlZCBmb3IgaWZyYW1lcwoJLy8gU2VlIHNldERvY3VtZW50KCkKCS8vIFJlbW92aW5nIHRoZSBmdW5jdGlvbiB3cmFwcGVyIGNhdXNlcyBhICJQZXJtaXNzaW9uIERlbmllZCIKCS8vIGVycm9yIGluIElFCgl1bmxvYWRIYW5kbGVyID0gZnVuY3Rpb24oKSB7CgkJc2V0RG9jdW1lbnQoKTsKCX07CgovLyBPcHRpbWl6ZSBmb3IgcHVzaC5hcHBseSggXywgTm9kZUxpc3QgKQp0cnkgewoJcHVzaC5hcHBseSgKCQkoYXJyID0gc2xpY2UuY2FsbCggcHJlZmVycmVkRG9jLmNoaWxkTm9kZXMgKSksCgkJcHJlZmVycmVkRG9jLmNoaWxkTm9kZXMKCSk7CgkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMAoJLy8gRGV0ZWN0IHNpbGVudGx5IGZhaWxpbmcgcHVzaC5hcHBseQoJYXJyWyBwcmVmZXJyZWREb2MuY2hpbGROb2Rlcy5sZW5ndGggXS5ub2RlVHlwZTsKfSBjYXRjaCAoIGUgKSB7CglwdXNoID0geyBhcHBseTogYXJyLmxlbmd0aCA/CgoJCS8vIExldmVyYWdlIHNsaWNlIGlmIHBvc3NpYmxlCgkJZnVuY3Rpb24oIHRhcmdldCwgZWxzICkgewoJCQlwdXNoX25hdGl2ZS5hcHBseSggdGFyZ2V0LCBzbGljZS5jYWxsKGVscykgKTsKCQl9IDoKCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIE90aGVyd2lzZSBhcHBlbmQgZGlyZWN0bHkKCQlmdW5jdGlvbiggdGFyZ2V0LCBlbHMgKSB7CgkJCXZhciBqID0gdGFyZ2V0Lmxlbmd0aCwKCQkJCWkgPSAwOwoJCQkvLyBDYW4ndCB0cnVzdCBOb2RlTGlzdC5sZW5ndGgKCQkJd2hpbGUgKCAodGFyZ2V0W2orK10gPSBlbHNbaSsrXSkgKSB7fQoJCQl0YXJnZXQubGVuZ3RoID0gaiAtIDE7CgkJfQoJfTsKfQoKZnVuY3Rpb24gU2l6emxlKCBzZWxlY3RvciwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApIHsKCXZhciBtLCBpLCBlbGVtLCBuaWQsIG5pZHNlbGVjdCwgbWF0Y2gsIGdyb3VwcywgbmV3U2VsZWN0b3IsCgkJbmV3Q29udGV4dCA9IGNvbnRleHQgJiYgY29udGV4dC5vd25lckRvY3VtZW50LAoKCQkvLyBub2RlVHlwZSBkZWZhdWx0cyB0byA5LCBzaW5jZSBjb250ZXh0IGRlZmF1bHRzIHRvIGRvY3VtZW50CgkJbm9kZVR5cGUgPSBjb250ZXh0ID8gY29udGV4dC5ub2RlVHlwZSA6IDk7CgoJcmVzdWx0cyA9IHJlc3VsdHMgfHwgW107CgoJLy8gUmV0dXJuIGVhcmx5IGZyb20gY2FsbHMgd2l0aCBpbnZhbGlkIHNlbGVjdG9yIG9yIGNvbnRleHQKCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiB8fCAhc2VsZWN0b3IgfHwKCQlub2RlVHlwZSAhPT0gMSAmJiBub2RlVHlwZSAhPT0gOSAmJiBub2RlVHlwZSAhPT0gMTEgKSB7CgoJCXJldHVybiByZXN1bHRzOwoJfQoKCS8vIFRyeSB0byBzaG9ydGN1dCBmaW5kIG9wZXJhdGlvbnMgKGFzIG9wcG9zZWQgdG8gZmlsdGVycykgaW4gSFRNTCBkb2N1bWVudHMKCWlmICggIXNlZWQgKSB7CgoJCWlmICggKCBjb250ZXh0ID8gY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgOiBwcmVmZXJyZWREb2MgKSAhPT0gZG9jdW1lbnQgKSB7CgkJCXNldERvY3VtZW50KCBjb250ZXh0ICk7CgkJfQoJCWNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50OwoKCQlpZiAoIGRvY3VtZW50SXNIVE1MICkgewoKCQkJLy8gSWYgdGhlIHNlbGVjdG9yIGlzIHN1ZmZpY2llbnRseSBzaW1wbGUsIHRyeSB1c2luZyBhICJnZXQqQnkqIiBET00gbWV0aG9kCgkJCS8vIChleGNlcHRpbmcgRG9jdW1lbnRGcmFnbWVudCBjb250ZXh0LCB3aGVyZSB0aGUgbWV0aG9kcyBkb24ndCBleGlzdCkKCQkJaWYgKCBub2RlVHlwZSAhPT0gMTEgJiYgKG1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApKSApIHsKCgkJCQkvLyBJRCBzZWxlY3RvcgoJCQkJaWYgKCAobSA9IG1hdGNoWzFdKSApIHsKCgkJCQkJLy8gRG9jdW1lbnQgY29udGV4dAoJCQkJCWlmICggbm9kZVR5cGUgPT09IDkgKSB7CgkJCQkJCWlmICggKGVsZW0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKCBtICkpICkgewoKCQkJCQkJCS8vIFN1cHBvcnQ6IElFLCBPcGVyYSwgV2Via2l0CgkJCQkJCQkvLyBUT0RPOiBpZGVudGlmeSB2ZXJzaW9ucwoJCQkJCQkJLy8gZ2V0RWxlbWVudEJ5SWQgY2FuIG1hdGNoIGVsZW1lbnRzIGJ5IG5hbWUgaW5zdGVhZCBvZiBJRAoJCQkJCQkJaWYgKCBlbGVtLmlkID09PSBtICkgewoJCQkJCQkJCXJlc3VsdHMucHVzaCggZWxlbSApOwoJCQkJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCQkJCX0KCgkJCQkJLy8gRWxlbWVudCBjb250ZXh0CgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIFN1cHBvcnQ6IElFLCBPcGVyYSwgV2Via2l0CgkJCQkJCS8vIFRPRE86IGlkZW50aWZ5IHZlcnNpb25zCgkJCQkJCS8vIGdldEVsZW1lbnRCeUlkIGNhbiBtYXRjaCBlbGVtZW50cyBieSBuYW1lIGluc3RlYWQgb2YgSUQKCQkJCQkJaWYgKCBuZXdDb250ZXh0ICYmIChlbGVtID0gbmV3Q29udGV4dC5nZXRFbGVtZW50QnlJZCggbSApKSAmJgoJCQkJCQkJY29udGFpbnMoIGNvbnRleHQsIGVsZW0gKSAmJgoJCQkJCQkJZWxlbS5pZCA9PT0gbSApIHsKCgkJCQkJCQlyZXN1bHRzLnB1c2goIGVsZW0gKTsKCQkJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJCQl9CgkJCQkJfQoKCQkJCS8vIFR5cGUgc2VsZWN0b3IKCQkJCX0gZWxzZSBpZiAoIG1hdGNoWzJdICkgewoJCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHNlbGVjdG9yICkgKTsKCQkJCQlyZXR1cm4gcmVzdWx0czsKCgkJCQkvLyBDbGFzcyBzZWxlY3RvcgoJCQkJfSBlbHNlIGlmICggKG0gPSBtYXRjaFszXSkgJiYgc3VwcG9ydC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICYmCgkJCQkJY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICkgewoKCQkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIG0gKSApOwoJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJfQoJCQl9CgoJCQkvLyBUYWtlIGFkdmFudGFnZSBvZiBxdWVyeVNlbGVjdG9yQWxsCgkJCWlmICggc3VwcG9ydC5xc2EgJiYKCQkJCSFjb21waWxlckNhY2hlWyBzZWxlY3RvciArICIgIiBdICYmCgkJCQkoIXJidWdneVFTQSB8fCAhcmJ1Z2d5UVNBLnRlc3QoIHNlbGVjdG9yICkpICkgewoKCQkJCWlmICggbm9kZVR5cGUgIT09IDEgKSB7CgkJCQkJbmV3Q29udGV4dCA9IGNvbnRleHQ7CgkJCQkJbmV3U2VsZWN0b3IgPSBzZWxlY3RvcjsKCgkJCQkvLyBxU0EgbG9va3Mgb3V0c2lkZSBFbGVtZW50IGNvbnRleHQsIHdoaWNoIGlzIG5vdCB3aGF0IHdlIHdhbnQKCQkJCS8vIFRoYW5rcyB0byBBbmRyZXcgRHVwb250IGZvciB0aGlzIHdvcmthcm91bmQgdGVjaG5pcXVlCgkJCQkvLyBTdXBwb3J0OiBJRSA8PTgKCQkJCS8vIEV4Y2x1ZGUgb2JqZWN0IGVsZW1lbnRzCgkJCQl9IGVsc2UgaWYgKCBjb250ZXh0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJvYmplY3QiICkgewoKCQkJCQkvLyBDYXB0dXJlIHRoZSBjb250ZXh0IElELCBzZXR0aW5nIGl0IGZpcnN0IGlmIG5lY2Vzc2FyeQoJCQkJCWlmICggKG5pZCA9IGNvbnRleHQuZ2V0QXR0cmlidXRlKCAiaWQiICkpICkgewoJCQkJCQluaWQgPSBuaWQucmVwbGFjZSggcmVzY2FwZSwgIlxcJCYiICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJY29udGV4dC5zZXRBdHRyaWJ1dGUoICJpZCIsIChuaWQgPSBleHBhbmRvKSApOwoJCQkJCX0KCgkJCQkJLy8gUHJlZml4IGV2ZXJ5IHNlbGVjdG9yIGluIHRoZSBsaXN0CgkJCQkJZ3JvdXBzID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgkJCQkJaSA9IGdyb3Vwcy5sZW5ndGg7CgkJCQkJbmlkc2VsZWN0ID0gcmlkZW50aWZpZXIudGVzdCggbmlkICkgPyAiIyIgKyBuaWQgOiAiW2lkPSciICsgbmlkICsgIiddIjsKCQkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQkJZ3JvdXBzW2ldID0gbmlkc2VsZWN0ICsgIiAiICsgdG9TZWxlY3RvciggZ3JvdXBzW2ldICk7CgkJCQkJfQoJCQkJCW5ld1NlbGVjdG9yID0gZ3JvdXBzLmpvaW4oICIsIiApOwoKCQkJCQkvLyBFeHBhbmQgY29udGV4dCBmb3Igc2libGluZyBzZWxlY3RvcnMKCQkJCQluZXdDb250ZXh0ID0gcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKSAmJiB0ZXN0Q29udGV4dCggY29udGV4dC5wYXJlbnROb2RlICkgfHwKCQkJCQkJY29udGV4dDsKCQkJCX0KCgkJCQlpZiAoIG5ld1NlbGVjdG9yICkgewoJCQkJCXRyeSB7CgkJCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsCgkJCQkJCQluZXdDb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwoIG5ld1NlbGVjdG9yICkKCQkJCQkJKTsKCQkJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCQkJfSBjYXRjaCAoIHFzYUVycm9yICkgewoJCQkJCX0gZmluYWxseSB7CgkJCQkJCWlmICggbmlkID09PSBleHBhbmRvICkgewoJCQkJCQkJY29udGV4dC5yZW1vdmVBdHRyaWJ1dGUoICJpZCIgKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBBbGwgb3RoZXJzCglyZXR1cm4gc2VsZWN0KCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgIiQxIiApLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICk7Cn0KCi8qKgogKiBDcmVhdGUga2V5LXZhbHVlIGNhY2hlcyBvZiBsaW1pdGVkIHNpemUKICogQHJldHVybnMge2Z1bmN0aW9uKHN0cmluZywgb2JqZWN0KX0gUmV0dXJucyB0aGUgT2JqZWN0IGRhdGEgYWZ0ZXIgc3RvcmluZyBpdCBvbiBpdHNlbGYgd2l0aAogKglwcm9wZXJ0eSBuYW1lIHRoZSAoc3BhY2Utc3VmZml4ZWQpIHN0cmluZyBhbmQgKGlmIHRoZSBjYWNoZSBpcyBsYXJnZXIgdGhhbiBFeHByLmNhY2hlTGVuZ3RoKQogKglkZWxldGluZyB0aGUgb2xkZXN0IGVudHJ5CiAqLwpmdW5jdGlvbiBjcmVhdGVDYWNoZSgpIHsKCXZhciBrZXlzID0gW107CgoJZnVuY3Rpb24gY2FjaGUoIGtleSwgdmFsdWUgKSB7CgkJLy8gVXNlIChrZXkgKyAiICIpIHRvIGF2b2lkIGNvbGxpc2lvbiB3aXRoIG5hdGl2ZSBwcm90b3R5cGUgcHJvcGVydGllcyAoc2VlIElzc3VlICMxNTcpCgkJaWYgKCBrZXlzLnB1c2goIGtleSArICIgIiApID4gRXhwci5jYWNoZUxlbmd0aCApIHsKCQkJLy8gT25seSBrZWVwIHRoZSBtb3N0IHJlY2VudCBlbnRyaWVzCgkJCWRlbGV0ZSBjYWNoZVsga2V5cy5zaGlmdCgpIF07CgkJfQoJCXJldHVybiAoY2FjaGVbIGtleSArICIgIiBdID0gdmFsdWUpOwoJfQoJcmV0dXJuIGNhY2hlOwp9CgovKioKICogTWFyayBhIGZ1bmN0aW9uIGZvciBzcGVjaWFsIHVzZSBieSBTaXp6bGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGZ1bmN0aW9uIHRvIG1hcmsKICovCmZ1bmN0aW9uIG1hcmtGdW5jdGlvbiggZm4gKSB7CglmblsgZXhwYW5kbyBdID0gdHJ1ZTsKCXJldHVybiBmbjsKfQoKLyoqCiAqIFN1cHBvcnQgdGVzdGluZyB1c2luZyBhbiBlbGVtZW50CiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFBhc3NlZCB0aGUgY3JlYXRlZCBkaXYgYW5kIGV4cGVjdHMgYSBib29sZWFuIHJlc3VsdAogKi8KZnVuY3Rpb24gYXNzZXJ0KCBmbiApIHsKCXZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCgl0cnkgewoJCXJldHVybiAhIWZuKCBkaXYgKTsKCX0gY2F0Y2ggKGUpIHsKCQlyZXR1cm4gZmFsc2U7Cgl9IGZpbmFsbHkgewoJCS8vIFJlbW92ZSBmcm9tIGl0cyBwYXJlbnQgYnkgZGVmYXVsdAoJCWlmICggZGl2LnBhcmVudE5vZGUgKSB7CgkJCWRpdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBkaXYgKTsKCQl9CgkJLy8gcmVsZWFzZSBtZW1vcnkgaW4gSUUKCQlkaXYgPSBudWxsOwoJfQp9CgovKioKICogQWRkcyB0aGUgc2FtZSBoYW5kbGVyIGZvciBhbGwgb2YgdGhlIHNwZWNpZmllZCBhdHRycwogKiBAcGFyYW0ge1N0cmluZ30gYXR0cnMgUGlwZS1zZXBhcmF0ZWQgbGlzdCBvZiBhdHRyaWJ1dGVzCiAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgVGhlIG1ldGhvZCB0aGF0IHdpbGwgYmUgYXBwbGllZAogKi8KZnVuY3Rpb24gYWRkSGFuZGxlKCBhdHRycywgaGFuZGxlciApIHsKCXZhciBhcnIgPSBhdHRycy5zcGxpdCgifCIpLAoJCWkgPSBhcnIubGVuZ3RoOwoKCXdoaWxlICggaS0tICkgewoJCUV4cHIuYXR0ckhhbmRsZVsgYXJyW2ldIF0gPSBoYW5kbGVyOwoJfQp9CgovKioKICogQ2hlY2tzIGRvY3VtZW50IG9yZGVyIG9mIHR3byBzaWJsaW5ncwogKiBAcGFyYW0ge0VsZW1lbnR9IGEKICogQHBhcmFtIHtFbGVtZW50fSBiCiAqIEByZXR1cm5zIHtOdW1iZXJ9IFJldHVybnMgbGVzcyB0aGFuIDAgaWYgYSBwcmVjZWRlcyBiLCBncmVhdGVyIHRoYW4gMCBpZiBhIGZvbGxvd3MgYgogKi8KZnVuY3Rpb24gc2libGluZ0NoZWNrKCBhLCBiICkgewoJdmFyIGN1ciA9IGIgJiYgYSwKCQlkaWZmID0gY3VyICYmIGEubm9kZVR5cGUgPT09IDEgJiYgYi5ub2RlVHlwZSA9PT0gMSAmJgoJCQkoIH5iLnNvdXJjZUluZGV4IHx8IE1BWF9ORUdBVElWRSApIC0KCQkJKCB+YS5zb3VyY2VJbmRleCB8fCBNQVhfTkVHQVRJVkUgKTsKCgkvLyBVc2UgSUUgc291cmNlSW5kZXggaWYgYXZhaWxhYmxlIG9uIGJvdGggbm9kZXMKCWlmICggZGlmZiApIHsKCQlyZXR1cm4gZGlmZjsKCX0KCgkvLyBDaGVjayBpZiBiIGZvbGxvd3MgYQoJaWYgKCBjdXIgKSB7CgkJd2hpbGUgKCAoY3VyID0gY3VyLm5leHRTaWJsaW5nKSApIHsKCQkJaWYgKCBjdXIgPT09IGIgKSB7CgkJCQlyZXR1cm4gLTE7CgkJCX0KCQl9Cgl9CgoJcmV0dXJuIGEgPyAxIDogLTE7Cn0KCi8qKgogKiBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGlucHV0IHR5cGVzCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAqLwpmdW5jdGlvbiBjcmVhdGVJbnB1dFBzZXVkbyggdHlwZSApIHsKCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQl2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQlyZXR1cm4gbmFtZSA9PT0gImlucHV0IiAmJiBlbGVtLnR5cGUgPT09IHR5cGU7Cgl9Owp9CgovKioKICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBidXR0b25zCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAqLwpmdW5jdGlvbiBjcmVhdGVCdXR0b25Qc2V1ZG8oIHR5cGUgKSB7CglyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJcmV0dXJuIChuYW1lID09PSAiaW5wdXQiIHx8IG5hbWUgPT09ICJidXR0b24iKSAmJiBlbGVtLnR5cGUgPT09IHR5cGU7Cgl9Owp9CgovKioKICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBwb3NpdGlvbmFscwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogKi8KZnVuY3Rpb24gY3JlYXRlUG9zaXRpb25hbFBzZXVkbyggZm4gKSB7CglyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBhcmd1bWVudCApIHsKCQlhcmd1bWVudCA9ICthcmd1bWVudDsKCQlyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzICkgewoJCQl2YXIgaiwKCQkJCW1hdGNoSW5kZXhlcyA9IGZuKCBbXSwgc2VlZC5sZW5ndGgsIGFyZ3VtZW50ICksCgkJCQlpID0gbWF0Y2hJbmRleGVzLmxlbmd0aDsKCgkJCS8vIE1hdGNoIGVsZW1lbnRzIGZvdW5kIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXhlcwoJCQl3aGlsZSAoIGktLSApIHsKCQkJCWlmICggc2VlZFsgKGogPSBtYXRjaEluZGV4ZXNbaV0pIF0gKSB7CgkJCQkJc2VlZFtqXSA9ICEobWF0Y2hlc1tqXSA9IHNlZWRbal0pOwoJCQkJfQoJCQl9CgkJfSk7Cgl9KTsKfQoKLyoqCiAqIENoZWNrcyBhIG5vZGUgZm9yIHZhbGlkaXR5IGFzIGEgU2l6emxlIGNvbnRleHQKICogQHBhcmFtIHtFbGVtZW50fE9iamVjdD19IGNvbnRleHQKICogQHJldHVybnMge0VsZW1lbnR8T2JqZWN0fEJvb2xlYW59IFRoZSBpbnB1dCBub2RlIGlmIGFjY2VwdGFibGUsIG90aGVyd2lzZSBhIGZhbHN5IHZhbHVlCiAqLwpmdW5jdGlvbiB0ZXN0Q29udGV4dCggY29udGV4dCApIHsKCXJldHVybiBjb250ZXh0ICYmIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSAidW5kZWZpbmVkIiAmJiBjb250ZXh0Owp9CgovLyBFeHBvc2Ugc3VwcG9ydCB2YXJzIGZvciBjb252ZW5pZW5jZQpzdXBwb3J0ID0gU2l6emxlLnN1cHBvcnQgPSB7fTsKCi8qKgogKiBEZXRlY3RzIFhNTCBub2RlcwogKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBlbGVtIEFuIGVsZW1lbnQgb3IgYSBkb2N1bWVudAogKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZmYgZWxlbSBpcyBhIG5vbi1IVE1MIFhNTCBub2RlCiAqLwppc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJLy8gZG9jdW1lbnRFbGVtZW50IGlzIHZlcmlmaWVkIGZvciBjYXNlcyB3aGVyZSBpdCBkb2Vzbid0IHlldCBleGlzdAoJLy8gKHN1Y2ggYXMgbG9hZGluZyBpZnJhbWVzIGluIElFIC0gIzQ4MzMpCgl2YXIgZG9jdW1lbnRFbGVtZW50ID0gZWxlbSAmJiAoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pLmRvY3VtZW50RWxlbWVudDsKCXJldHVybiBkb2N1bWVudEVsZW1lbnQgPyBkb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgIT09ICJIVE1MIiA6IGZhbHNlOwp9OwoKLyoqCiAqIFNldHMgZG9jdW1lbnQtcmVsYXRlZCB2YXJpYWJsZXMgb25jZSBiYXNlZCBvbiB0aGUgY3VycmVudCBkb2N1bWVudAogKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudAogKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjdXJyZW50IGRvY3VtZW50CiAqLwpzZXREb2N1bWVudCA9IFNpenpsZS5zZXREb2N1bWVudCA9IGZ1bmN0aW9uKCBub2RlICkgewoJdmFyIGhhc0NvbXBhcmUsIHBhcmVudCwKCQlkb2MgPSBub2RlID8gbm9kZS5vd25lckRvY3VtZW50IHx8IG5vZGUgOiBwcmVmZXJyZWREb2M7CgoJLy8gUmV0dXJuIGVhcmx5IGlmIGRvYyBpcyBpbnZhbGlkIG9yIGFscmVhZHkgc2VsZWN0ZWQKCWlmICggZG9jID09PSBkb2N1bWVudCB8fCBkb2Mubm9kZVR5cGUgIT09IDkgfHwgIWRvYy5kb2N1bWVudEVsZW1lbnQgKSB7CgkJcmV0dXJuIGRvY3VtZW50OwoJfQoKCS8vIFVwZGF0ZSBnbG9iYWwgdmFyaWFibGVzCglkb2N1bWVudCA9IGRvYzsKCWRvY0VsZW0gPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7Cglkb2N1bWVudElzSFRNTCA9ICFpc1hNTCggZG9jdW1lbnQgKTsKCgkvLyBTdXBwb3J0OiBJRSA5LTExLCBFZGdlCgkvLyBBY2Nlc3NpbmcgaWZyYW1lIGRvY3VtZW50cyBhZnRlciB1bmxvYWQgdGhyb3dzICJwZXJtaXNzaW9uIGRlbmllZCIgZXJyb3JzIChqUXVlcnkgIzEzOTM2KQoJaWYgKCAocGFyZW50ID0gZG9jdW1lbnQuZGVmYXVsdFZpZXcpICYmIHBhcmVudC50b3AgIT09IHBhcmVudCApIHsKCQkvLyBTdXBwb3J0OiBJRSAxMQoJCWlmICggcGFyZW50LmFkZEV2ZW50TGlzdGVuZXIgKSB7CgkJCXBhcmVudC5hZGRFdmVudExpc3RlbmVyKCAidW5sb2FkIiwgdW5sb2FkSGFuZGxlciwgZmFsc2UgKTsKCgkJLy8gU3VwcG9ydDogSUUgOSAtIDEwIG9ubHkKCQl9IGVsc2UgaWYgKCBwYXJlbnQuYXR0YWNoRXZlbnQgKSB7CgkJCXBhcmVudC5hdHRhY2hFdmVudCggIm9udW5sb2FkIiwgdW5sb2FkSGFuZGxlciApOwoJCX0KCX0KCgkvKiBBdHRyaWJ1dGVzCgktLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCgoJLy8gU3VwcG9ydDogSUU8OAoJLy8gVmVyaWZ5IHRoYXQgZ2V0QXR0cmlidXRlIHJlYWxseSByZXR1cm5zIGF0dHJpYnV0ZXMgYW5kIG5vdCBwcm9wZXJ0aWVzCgkvLyAoZXhjZXB0aW5nIElFOCBib29sZWFucykKCXN1cHBvcnQuYXR0cmlidXRlcyA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCWRpdi5jbGFzc05hbWUgPSAiaSI7CgkJcmV0dXJuICFkaXYuZ2V0QXR0cmlidXRlKCJjbGFzc05hbWUiKTsKCX0pOwoKCS8qIGdldEVsZW1lbnQocylCeSoKCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KCgkvLyBDaGVjayBpZiBnZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpIHJldHVybnMgb25seSBlbGVtZW50cwoJc3VwcG9ydC5nZXRFbGVtZW50c0J5VGFnTmFtZSA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCWRpdi5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlQ29tbWVudCgiIikgKTsKCQlyZXR1cm4gIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aDsKCX0pOwoKCS8vIFN1cHBvcnQ6IElFPDkKCXN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IHJuYXRpdmUudGVzdCggZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSApOwoKCS8vIFN1cHBvcnQ6IElFPDEwCgkvLyBDaGVjayBpZiBnZXRFbGVtZW50QnlJZCByZXR1cm5zIGVsZW1lbnRzIGJ5IG5hbWUKCS8vIFRoZSBicm9rZW4gZ2V0RWxlbWVudEJ5SWQgbWV0aG9kcyBkb24ndCBwaWNrIHVwIHByb2dyYW1hdGljYWxseS1zZXQgbmFtZXMsCgkvLyBzbyB1c2UgYSByb3VuZGFib3V0IGdldEVsZW1lbnRzQnlOYW1lIHRlc3QKCXN1cHBvcnQuZ2V0QnlJZCA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCWRvY0VsZW0uYXBwZW5kQ2hpbGQoIGRpdiApLmlkID0gZXhwYW5kbzsKCQlyZXR1cm4gIWRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lIHx8ICFkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSggZXhwYW5kbyApLmxlbmd0aDsKCX0pOwoKCS8vIElEIGZpbmQgYW5kIGZpbHRlcgoJaWYgKCBzdXBwb3J0LmdldEJ5SWQgKSB7CgkJRXhwci5maW5kWyJJRCJdID0gZnVuY3Rpb24oIGlkLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSAidW5kZWZpbmVkIiAmJiBkb2N1bWVudElzSFRNTCApIHsKCQkJCXZhciBtID0gY29udGV4dC5nZXRFbGVtZW50QnlJZCggaWQgKTsKCQkJCXJldHVybiBtID8gWyBtIF0gOiBbXTsKCQkJfQoJCX07CgkJRXhwci5maWx0ZXJbIklEIl0gPSBmdW5jdGlvbiggaWQgKSB7CgkJCXZhciBhdHRySWQgPSBpZC5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApOwoJCQlyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQlyZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoImlkIikgPT09IGF0dHJJZDsKCQkJfTsKCQl9OwoJfSBlbHNlIHsKCQkvLyBTdXBwb3J0OiBJRTYvNwoJCS8vIGdldEVsZW1lbnRCeUlkIGlzIG5vdCByZWxpYWJsZSBhcyBhIGZpbmQgc2hvcnRjdXQKCQlkZWxldGUgRXhwci5maW5kWyJJRCJdOwoKCQlFeHByLmZpbHRlclsiSUQiXSA9ICBmdW5jdGlvbiggaWQgKSB7CgkJCXZhciBhdHRySWQgPSBpZC5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApOwoJCQlyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQl2YXIgbm9kZSA9IHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZU5vZGUgIT09ICJ1bmRlZmluZWQiICYmCgkJCQkJZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpOwoJCQkJcmV0dXJuIG5vZGUgJiYgbm9kZS52YWx1ZSA9PT0gYXR0cklkOwoJCQl9OwoJCX07Cgl9CgoJLy8gVGFnCglFeHByLmZpbmRbIlRBRyJdID0gc3VwcG9ydC5nZXRFbGVtZW50c0J5VGFnTmFtZSA/CgkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gInVuZGVmaW5lZCIgKSB7CgkJCQlyZXR1cm4gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnICk7CgoJCQkvLyBEb2N1bWVudEZyYWdtZW50IG5vZGVzIGRvbid0IGhhdmUgZ0VCVE4KCQkJfSBlbHNlIGlmICggc3VwcG9ydC5xc2EgKSB7CgkJCQlyZXR1cm4gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCB0YWcgKTsKCQkJfQoJCX0gOgoKCQlmdW5jdGlvbiggdGFnLCBjb250ZXh0ICkgewoJCQl2YXIgZWxlbSwKCQkJCXRtcCA9IFtdLAoJCQkJaSA9IDAsCgkJCQkvLyBCeSBoYXBweSBjb2luY2lkZW5jZSwgYSAoYnJva2VuKSBnRUJUTiBhcHBlYXJzIG9uIERvY3VtZW50RnJhZ21lbnQgbm9kZXMgdG9vCgkJCQlyZXN1bHRzID0gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnICk7CgoJCQkvLyBGaWx0ZXIgb3V0IHBvc3NpYmxlIGNvbW1lbnRzCgkJCWlmICggdGFnID09PSAiKiIgKSB7CgkJCQl3aGlsZSAoIChlbGVtID0gcmVzdWx0c1tpKytdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQkJCXRtcC5wdXNoKCBlbGVtICk7CgkJCQkJfQoJCQkJfQoKCQkJCXJldHVybiB0bXA7CgkJCX0KCQkJcmV0dXJuIHJlc3VsdHM7CgkJfTsKCgkvLyBDbGFzcwoJRXhwci5maW5kWyJDTEFTUyJdID0gc3VwcG9ydC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICYmIGZ1bmN0aW9uKCBjbGFzc05hbWUsIGNvbnRleHQgKSB7CgkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICE9PSAidW5kZWZpbmVkIiAmJiBkb2N1bWVudElzSFRNTCApIHsKCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSggY2xhc3NOYW1lICk7CgkJfQoJfTsKCgkvKiBRU0EvbWF0Y2hlc1NlbGVjdG9yCgktLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCgoJLy8gUVNBIGFuZCBtYXRjaGVzU2VsZWN0b3Igc3VwcG9ydAoKCS8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpCglyYnVnZ3lNYXRjaGVzID0gW107CgoJLy8gcVNhKDpmb2N1cykgcmVwb3J0cyBmYWxzZSB3aGVuIHRydWUgKENocm9tZSAyMSkKCS8vIFdlIGFsbG93IHRoaXMgYmVjYXVzZSBvZiBhIGJ1ZyBpbiBJRTgvOSB0aGF0IHRocm93cyBhbiBlcnJvcgoJLy8gd2hlbmV2ZXIgYGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRgIGlzIGFjY2Vzc2VkIG9uIGFuIGlmcmFtZQoJLy8gU28sIHdlIGFsbG93IDpmb2N1cyB0byBwYXNzIHRocm91Z2ggUVNBIGFsbCB0aGUgdGltZSB0byBhdm9pZCB0aGUgSUUgZXJyb3IKCS8vIFNlZSBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC8xMzM3OAoJcmJ1Z2d5UVNBID0gW107CgoJaWYgKCAoc3VwcG9ydC5xc2EgPSBybmF0aXZlLnRlc3QoIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwgKSkgKSB7CgkJLy8gQnVpbGQgUVNBIHJlZ2V4CgkJLy8gUmVnZXggc3RyYXRlZ3kgYWRvcHRlZCBmcm9tIERpZWdvIFBlcmluaQoJCWFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCQkvLyBTZWxlY3QgaXMgc2V0IHRvIGVtcHR5IHN0cmluZyBvbiBwdXJwb3NlCgkJCS8vIFRoaXMgaXMgdG8gdGVzdCBJRSdzIHRyZWF0bWVudCBvZiBub3QgZXhwbGljaXRseQoJCQkvLyBzZXR0aW5nIGEgYm9vbGVhbiBjb250ZW50IGF0dHJpYnV0ZSwKCQkJLy8gc2luY2UgaXRzIHByZXNlbmNlIHNob3VsZCBiZSBlbm91Z2gKCQkJLy8gaHR0cDovL2J1Z3MuanF1ZXJ5LmNvbS90aWNrZXQvMTIzNTkKCQkJZG9jRWxlbS5hcHBlbmRDaGlsZCggZGl2ICkuaW5uZXJIVE1MID0gIjxhIGlkPSciICsgZXhwYW5kbyArICInPjwvYT4iICsKCQkJCSI8c2VsZWN0IGlkPSciICsgZXhwYW5kbyArICItXHJcXCcgbXNhbGxvd2NhcHR1cmU9Jyc+IiArCgkJCQkiPG9wdGlvbiBzZWxlY3RlZD0nJz48L29wdGlvbj48L3NlbGVjdD4iOwoKCQkJLy8gU3VwcG9ydDogSUU4LCBPcGVyYSAxMS0xMi4xNgoJCQkvLyBOb3RoaW5nIHNob3VsZCBiZSBzZWxlY3RlZCB3aGVuIGVtcHR5IHN0cmluZ3MgZm9sbG93IF49IG9yICQ9IG9yICo9CgkJCS8vIFRoZSB0ZXN0IGF0dHJpYnV0ZSBtdXN0IGJlIHVua25vd24gaW4gT3BlcmEgYnV0ICJzYWZlIiBmb3IgV2luUlQKCQkJLy8gaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2llL2hoNDY1Mzg4LmFzcHgjYXR0cmlidXRlX3NlY3Rpb24KCQkJaWYgKCBkaXYucXVlcnlTZWxlY3RvckFsbCgiW21zYWxsb3djYXB0dXJlXj0nJ10iKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCggIlsqXiRdPSIgKyB3aGl0ZXNwYWNlICsgIiooPzonJ3xcIlwiKSIgKTsKCQkJfQoKCQkJLy8gU3VwcG9ydDogSUU4CgkJCS8vIEJvb2xlYW4gYXR0cmlidXRlcyBhbmQgInZhbHVlIiBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5CgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCJbc2VsZWN0ZWRdIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICJcXFsiICsgd2hpdGVzcGFjZSArICIqKD86dmFsdWV8IiArIGJvb2xlYW5zICsgIikiICk7CgkJCX0KCgkJCS8vIFN1cHBvcnQ6IENocm9tZTwyOSwgQW5kcm9pZDw0LjQsIFNhZmFyaTw3LjArLCBpT1M8Ny4wKywgUGhhbnRvbUpTPDEuOS44KwoJCQlpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbCggIltpZH49IiArIGV4cGFuZG8gKyAiLV0iICkubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goIn49Iik7CgkJCX0KCgkJCS8vIFdlYmtpdC9PcGVyYSAtIDpjaGVja2VkIHNob3VsZCByZXR1cm4gc2VsZWN0ZWQgb3B0aW9uIGVsZW1lbnRzCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkCgkJCS8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzCgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCI6Y2hlY2tlZCIpLmxlbmd0aCApIHsKCQkJCXJidWdneVFTQS5wdXNoKCI6Y2hlY2tlZCIpOwoJCQl9CgoJCQkvLyBTdXBwb3J0OiBTYWZhcmkgOCssIGlPUyA4KwoJCQkvLyBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTM2ODUxCgkJCS8vIEluLXBhZ2UgYHNlbGVjdG9yI2lkIHNpYmluZy1jb21iaW5hdG9yIHNlbGVjdG9yYCBmYWlscwoJCQlpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbCggImEjIiArIGV4cGFuZG8gKyAiKyoiICkubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goIi4jLitbK35dIik7CgkJCX0KCQl9KTsKCgkJYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCS8vIFN1cHBvcnQ6IFdpbmRvd3MgOCBOYXRpdmUgQXBwcwoJCQkvLyBUaGUgdHlwZSBhbmQgbmFtZSBhdHRyaWJ1dGVzIGFyZSByZXN0cmljdGVkIGR1cmluZyAuaW5uZXJIVE1MIGFzc2lnbm1lbnQKCQkJdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKCQkJaW5wdXQuc2V0QXR0cmlidXRlKCAidHlwZSIsICJoaWRkZW4iICk7CgkJCWRpdi5hcHBlbmRDaGlsZCggaW5wdXQgKS5zZXRBdHRyaWJ1dGUoICJuYW1lIiwgIkQiICk7CgoJCQkvLyBTdXBwb3J0OiBJRTgKCQkJLy8gRW5mb3JjZSBjYXNlLXNlbnNpdGl2aXR5IG9mIG5hbWUgYXR0cmlidXRlCgkJCWlmICggZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIltuYW1lPWRdIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICJuYW1lIiArIHdoaXRlc3BhY2UgKyAiKlsqXiR8IX5dPz0iICk7CgkJCX0KCgkJCS8vIEZGIDMuNSAtIDplbmFibGVkLzpkaXNhYmxlZCBhbmQgaGlkZGVuIGVsZW1lbnRzIChoaWRkZW4gZWxlbWVudHMgYXJlIHN0aWxsIGVuYWJsZWQpCgkJCS8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzCgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCI6ZW5hYmxlZCIpLmxlbmd0aCApIHsKCQkJCXJidWdneVFTQS5wdXNoKCAiOmVuYWJsZWQiLCAiOmRpc2FibGVkIiApOwoJCQl9CgoJCQkvLyBPcGVyYSAxMC0xMSBkb2VzIG5vdCB0aHJvdyBvbiBwb3N0LWNvbW1hIGludmFsaWQgcHNldWRvcwoJCQlkaXYucXVlcnlTZWxlY3RvckFsbCgiKiw6eCIpOwoJCQlyYnVnZ3lRU0EucHVzaCgiLC4qOiIpOwoJCX0pOwoJfQoKCWlmICggKHN1cHBvcnQubWF0Y2hlc1NlbGVjdG9yID0gcm5hdGl2ZS50ZXN0KCAobWF0Y2hlcyA9IGRvY0VsZW0ubWF0Y2hlcyB8fAoJCWRvY0VsZW0ud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8CgkJZG9jRWxlbS5tb3pNYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm9NYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm1zTWF0Y2hlc1NlbGVjdG9yKSApKSApIHsKCgkJYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCS8vIENoZWNrIHRvIHNlZSBpZiBpdCdzIHBvc3NpYmxlIHRvIGRvIG1hdGNoZXNTZWxlY3RvcgoJCQkvLyBvbiBhIGRpc2Nvbm5lY3RlZCBub2RlIChJRSA5KQoJCQlzdXBwb3J0LmRpc2Nvbm5lY3RlZE1hdGNoID0gbWF0Y2hlcy5jYWxsKCBkaXYsICJkaXYiICk7CgoJCQkvLyBUaGlzIHNob3VsZCBmYWlsIHdpdGggYW4gZXhjZXB0aW9uCgkJCS8vIEdlY2tvIGRvZXMgbm90IGVycm9yLCByZXR1cm5zIGZhbHNlIGluc3RlYWQKCQkJbWF0Y2hlcy5jYWxsKCBkaXYsICJbcyE9JyddOngiICk7CgkJCXJidWdneU1hdGNoZXMucHVzaCggIiE9IiwgcHNldWRvcyApOwoJCX0pOwoJfQoKCXJidWdneVFTQSA9IHJidWdneVFTQS5sZW5ndGggJiYgbmV3IFJlZ0V4cCggcmJ1Z2d5UVNBLmpvaW4oInwiKSApOwoJcmJ1Z2d5TWF0Y2hlcyA9IHJidWdneU1hdGNoZXMubGVuZ3RoICYmIG5ldyBSZWdFeHAoIHJidWdneU1hdGNoZXMuam9pbigifCIpICk7CgoJLyogQ29udGFpbnMKCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KCWhhc0NvbXBhcmUgPSBybmF0aXZlLnRlc3QoIGRvY0VsZW0uY29tcGFyZURvY3VtZW50UG9zaXRpb24gKTsKCgkvLyBFbGVtZW50IGNvbnRhaW5zIGFub3RoZXIKCS8vIFB1cnBvc2VmdWxseSBzZWxmLWV4Y2x1c2l2ZQoJLy8gQXMgaW4sIGFuIGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBpdHNlbGYKCWNvbnRhaW5zID0gaGFzQ29tcGFyZSB8fCBybmF0aXZlLnRlc3QoIGRvY0VsZW0uY29udGFpbnMgKSA/CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCXZhciBhZG93biA9IGEubm9kZVR5cGUgPT09IDkgPyBhLmRvY3VtZW50RWxlbWVudCA6IGEsCgkJCQlidXAgPSBiICYmIGIucGFyZW50Tm9kZTsKCQkJcmV0dXJuIGEgPT09IGJ1cCB8fCAhISggYnVwICYmIGJ1cC5ub2RlVHlwZSA9PT0gMSAmJiAoCgkJCQlhZG93bi5jb250YWlucyA/CgkJCQkJYWRvd24uY29udGFpbnMoIGJ1cCApIDoKCQkJCQlhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGJ1cCApICYgMTYKCQkJKSk7CgkJfSA6CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCWlmICggYiApIHsKCQkJCXdoaWxlICggKGIgPSBiLnBhcmVudE5vZGUpICkgewoJCQkJCWlmICggYiA9PT0gYSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCXJldHVybiBmYWxzZTsKCQl9OwoKCS8qIFNvcnRpbmcKCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KCgkvLyBEb2N1bWVudCBvcmRlciBzb3J0aW5nCglzb3J0T3JkZXIgPSBoYXNDb21wYXJlID8KCWZ1bmN0aW9uKCBhLCBiICkgewoKCQkvLyBGbGFnIGZvciBkdXBsaWNhdGUgcmVtb3ZhbAoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgkJfQoKCQkvLyBTb3J0IG9uIG1ldGhvZCBleGlzdGVuY2UgaWYgb25seSBvbmUgaW5wdXQgaGFzIGNvbXBhcmVEb2N1bWVudFBvc2l0aW9uCgkJdmFyIGNvbXBhcmUgPSAhYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAtICFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uOwoJCWlmICggY29tcGFyZSApIHsKCQkJcmV0dXJuIGNvbXBhcmU7CgkJfQoKCQkvLyBDYWxjdWxhdGUgcG9zaXRpb24gaWYgYm90aCBpbnB1dHMgYmVsb25nIHRvIHRoZSBzYW1lIGRvY3VtZW50CgkJY29tcGFyZSA9ICggYS5vd25lckRvY3VtZW50IHx8IGEgKSA9PT0gKCBiLm93bmVyRG9jdW1lbnQgfHwgYiApID8KCQkJYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiggYiApIDoKCgkJCS8vIE90aGVyd2lzZSB3ZSBrbm93IHRoZXkgYXJlIGRpc2Nvbm5lY3RlZAoJCQkxOwoKCQkvLyBEaXNjb25uZWN0ZWQgbm9kZXMKCQlpZiAoIGNvbXBhcmUgJiAxIHx8CgkJCSghc3VwcG9ydC5zb3J0RGV0YWNoZWQgJiYgYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiggYSApID09PSBjb21wYXJlKSApIHsKCgkJCS8vIENob29zZSB0aGUgZmlyc3QgZWxlbWVudCB0aGF0IGlzIHJlbGF0ZWQgdG8gb3VyIHByZWZlcnJlZCBkb2N1bWVudAoJCQlpZiAoIGEgPT09IGRvY3VtZW50IHx8IGEub3duZXJEb2N1bWVudCA9PT0gcHJlZmVycmVkRG9jICYmIGNvbnRhaW5zKHByZWZlcnJlZERvYywgYSkgKSB7CgkJCQlyZXR1cm4gLTE7CgkJCX0KCQkJaWYgKCBiID09PSBkb2N1bWVudCB8fCBiLm93bmVyRG9jdW1lbnQgPT09IHByZWZlcnJlZERvYyAmJiBjb250YWlucyhwcmVmZXJyZWREb2MsIGIpICkgewoJCQkJcmV0dXJuIDE7CgkJCX0KCgkJCS8vIE1haW50YWluIG9yaWdpbmFsIG9yZGVyCgkJCXJldHVybiBzb3J0SW5wdXQgPwoJCQkJKCBpbmRleE9mKCBzb3J0SW5wdXQsIGEgKSAtIGluZGV4T2YoIHNvcnRJbnB1dCwgYiApICkgOgoJCQkJMDsKCQl9CgoJCXJldHVybiBjb21wYXJlICYgNCA/IC0xIDogMTsKCX0gOgoJZnVuY3Rpb24oIGEsIGIgKSB7CgkJLy8gRXhpdCBlYXJseSBpZiB0aGUgbm9kZXMgYXJlIGlkZW50aWNhbAoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgkJfQoKCQl2YXIgY3VyLAoJCQlpID0gMCwKCQkJYXVwID0gYS5wYXJlbnROb2RlLAoJCQlidXAgPSBiLnBhcmVudE5vZGUsCgkJCWFwID0gWyBhIF0sCgkJCWJwID0gWyBiIF07CgoJCS8vIFBhcmVudGxlc3Mgbm9kZXMgYXJlIGVpdGhlciBkb2N1bWVudHMgb3IgZGlzY29ubmVjdGVkCgkJaWYgKCAhYXVwIHx8ICFidXAgKSB7CgkJCXJldHVybiBhID09PSBkb2N1bWVudCA/IC0xIDoKCQkJCWIgPT09IGRvY3VtZW50ID8gMSA6CgkJCQlhdXAgPyAtMSA6CgkJCQlidXAgPyAxIDoKCQkJCXNvcnRJbnB1dCA/CgkJCQkoIGluZGV4T2YoIHNvcnRJbnB1dCwgYSApIC0gaW5kZXhPZiggc29ydElucHV0LCBiICkgKSA6CgkJCQkwOwoKCQkvLyBJZiB0aGUgbm9kZXMgYXJlIHNpYmxpbmdzLCB3ZSBjYW4gZG8gYSBxdWljayBjaGVjawoJCX0gZWxzZSBpZiAoIGF1cCA9PT0gYnVwICkgewoJCQlyZXR1cm4gc2libGluZ0NoZWNrKCBhLCBiICk7CgkJfQoKCQkvLyBPdGhlcndpc2Ugd2UgbmVlZCBmdWxsIGxpc3RzIG9mIHRoZWlyIGFuY2VzdG9ycyBmb3IgY29tcGFyaXNvbgoJCWN1ciA9IGE7CgkJd2hpbGUgKCAoY3VyID0gY3VyLnBhcmVudE5vZGUpICkgewoJCQlhcC51bnNoaWZ0KCBjdXIgKTsKCQl9CgkJY3VyID0gYjsKCQl3aGlsZSAoIChjdXIgPSBjdXIucGFyZW50Tm9kZSkgKSB7CgkJCWJwLnVuc2hpZnQoIGN1ciApOwoJCX0KCgkJLy8gV2FsayBkb3duIHRoZSB0cmVlIGxvb2tpbmcgZm9yIGEgZGlzY3JlcGFuY3kKCQl3aGlsZSAoIGFwW2ldID09PSBicFtpXSApIHsKCQkJaSsrOwoJCX0KCgkJcmV0dXJuIGkgPwoJCQkvLyBEbyBhIHNpYmxpbmcgY2hlY2sgaWYgdGhlIG5vZGVzIGhhdmUgYSBjb21tb24gYW5jZXN0b3IKCQkJc2libGluZ0NoZWNrKCBhcFtpXSwgYnBbaV0gKSA6CgoJCQkvLyBPdGhlcndpc2Ugbm9kZXMgaW4gb3VyIGRvY3VtZW50IHNvcnQgZmlyc3QKCQkJYXBbaV0gPT09IHByZWZlcnJlZERvYyA/IC0xIDoKCQkJYnBbaV0gPT09IHByZWZlcnJlZERvYyA/IDEgOgoJCQkwOwoJfTsKCglyZXR1cm4gZG9jdW1lbnQ7Cn07CgpTaXp6bGUubWF0Y2hlcyA9IGZ1bmN0aW9uKCBleHByLCBlbGVtZW50cyApIHsKCXJldHVybiBTaXp6bGUoIGV4cHIsIG51bGwsIG51bGwsIGVsZW1lbnRzICk7Cn07CgpTaXp6bGUubWF0Y2hlc1NlbGVjdG9yID0gZnVuY3Rpb24oIGVsZW0sIGV4cHIgKSB7CgkvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWQKCWlmICggKCBlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbSApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggZWxlbSApOwoJfQoKCS8vIE1ha2Ugc3VyZSB0aGF0IGF0dHJpYnV0ZSBzZWxlY3RvcnMgYXJlIHF1b3RlZAoJZXhwciA9IGV4cHIucmVwbGFjZSggcmF0dHJpYnV0ZVF1b3RlcywgIj0nJDEnXSIgKTsKCglpZiAoIHN1cHBvcnQubWF0Y2hlc1NlbGVjdG9yICYmIGRvY3VtZW50SXNIVE1MICYmCgkJIWNvbXBpbGVyQ2FjaGVbIGV4cHIgKyAiICIgXSAmJgoJCSggIXJidWdneU1hdGNoZXMgfHwgIXJidWdneU1hdGNoZXMudGVzdCggZXhwciApICkgJiYKCQkoICFyYnVnZ3lRU0EgICAgIHx8ICFyYnVnZ3lRU0EudGVzdCggZXhwciApICkgKSB7CgoJCXRyeSB7CgkJCXZhciByZXQgPSBtYXRjaGVzLmNhbGwoIGVsZW0sIGV4cHIgKTsKCgkJCS8vIElFIDkncyBtYXRjaGVzU2VsZWN0b3IgcmV0dXJucyBmYWxzZSBvbiBkaXNjb25uZWN0ZWQgbm9kZXMKCQkJaWYgKCByZXQgfHwgc3VwcG9ydC5kaXNjb25uZWN0ZWRNYXRjaCB8fAoJCQkJCS8vIEFzIHdlbGwsIGRpc2Nvbm5lY3RlZCBub2RlcyBhcmUgc2FpZCB0byBiZSBpbiBhIGRvY3VtZW50CgkJCQkJLy8gZnJhZ21lbnQgaW4gSUUgOQoJCQkJCWVsZW0uZG9jdW1lbnQgJiYgZWxlbS5kb2N1bWVudC5ub2RlVHlwZSAhPT0gMTEgKSB7CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgkJfSBjYXRjaCAoZSkge30KCX0KCglyZXR1cm4gU2l6emxlKCBleHByLCBkb2N1bWVudCwgbnVsbCwgWyBlbGVtIF0gKS5sZW5ndGggPiAwOwp9OwoKU2l6emxlLmNvbnRhaW5zID0gZnVuY3Rpb24oIGNvbnRleHQsIGVsZW0gKSB7CgkvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWQKCWlmICggKCBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggY29udGV4dCApOwoJfQoJcmV0dXJuIGNvbnRhaW5zKCBjb250ZXh0LCBlbGVtICk7Cn07CgpTaXp6bGUuYXR0ciA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCglpZiAoICggZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0gKSAhPT0gZG9jdW1lbnQgKSB7CgkJc2V0RG9jdW1lbnQoIGVsZW0gKTsKCX0KCgl2YXIgZm4gPSBFeHByLmF0dHJIYW5kbGVbIG5hbWUudG9Mb3dlckNhc2UoKSBdLAoJCS8vIERvbid0IGdldCBmb29sZWQgYnkgT2JqZWN0LnByb3RvdHlwZSBwcm9wZXJ0aWVzIChqUXVlcnkgIzEzODA3KQoJCXZhbCA9IGZuICYmIGhhc093bi5jYWxsKCBFeHByLmF0dHJIYW5kbGUsIG5hbWUudG9Mb3dlckNhc2UoKSApID8KCQkJZm4oIGVsZW0sIG5hbWUsICFkb2N1bWVudElzSFRNTCApIDoKCQkJdW5kZWZpbmVkOwoKCXJldHVybiB2YWwgIT09IHVuZGVmaW5lZCA/CgkJdmFsIDoKCQlzdXBwb3J0LmF0dHJpYnV0ZXMgfHwgIWRvY3VtZW50SXNIVE1MID8KCQkJZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKSA6CgkJCSh2YWwgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUobmFtZSkpICYmIHZhbC5zcGVjaWZpZWQgPwoJCQkJdmFsLnZhbHVlIDoKCQkJCW51bGw7Cn07CgpTaXp6bGUuZXJyb3IgPSBmdW5jdGlvbiggbXNnICkgewoJdGhyb3cgbmV3IEVycm9yKCAiU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogIiArIG1zZyApOwp9OwoKLyoqCiAqIERvY3VtZW50IHNvcnRpbmcgYW5kIHJlbW92aW5nIGR1cGxpY2F0ZXMKICogQHBhcmFtIHtBcnJheUxpa2V9IHJlc3VsdHMKICovClNpenpsZS51bmlxdWVTb3J0ID0gZnVuY3Rpb24oIHJlc3VsdHMgKSB7Cgl2YXIgZWxlbSwKCQlkdXBsaWNhdGVzID0gW10sCgkJaiA9IDAsCgkJaSA9IDA7CgoJLy8gVW5sZXNzIHdlICprbm93KiB3ZSBjYW4gZGV0ZWN0IGR1cGxpY2F0ZXMsIGFzc3VtZSB0aGVpciBwcmVzZW5jZQoJaGFzRHVwbGljYXRlID0gIXN1cHBvcnQuZGV0ZWN0RHVwbGljYXRlczsKCXNvcnRJbnB1dCA9ICFzdXBwb3J0LnNvcnRTdGFibGUgJiYgcmVzdWx0cy5zbGljZSggMCApOwoJcmVzdWx0cy5zb3J0KCBzb3J0T3JkZXIgKTsKCglpZiAoIGhhc0R1cGxpY2F0ZSApIHsKCQl3aGlsZSAoIChlbGVtID0gcmVzdWx0c1tpKytdKSApIHsKCQkJaWYgKCBlbGVtID09PSByZXN1bHRzWyBpIF0gKSB7CgkJCQlqID0gZHVwbGljYXRlcy5wdXNoKCBpICk7CgkJCX0KCQl9CgkJd2hpbGUgKCBqLS0gKSB7CgkJCXJlc3VsdHMuc3BsaWNlKCBkdXBsaWNhdGVzWyBqIF0sIDEgKTsKCQl9Cgl9CgoJLy8gQ2xlYXIgaW5wdXQgYWZ0ZXIgc29ydGluZyB0byByZWxlYXNlIG9iamVjdHMKCS8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L3NpenpsZS9wdWxsLzIyNQoJc29ydElucHV0ID0gbnVsbDsKCglyZXR1cm4gcmVzdWx0czsKfTsKCi8qKgogKiBVdGlsaXR5IGZ1bmN0aW9uIGZvciByZXRyaWV2aW5nIHRoZSB0ZXh0IHZhbHVlIG9mIGFuIGFycmF5IG9mIERPTSBub2RlcwogKiBAcGFyYW0ge0FycmF5fEVsZW1lbnR9IGVsZW0KICovCmdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJdmFyIG5vZGUsCgkJcmV0ID0gIiIsCgkJaSA9IDAsCgkJbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCWlmICggIW5vZGVUeXBlICkgewoJCS8vIElmIG5vIG5vZGVUeXBlLCB0aGlzIGlzIGV4cGVjdGVkIHRvIGJlIGFuIGFycmF5CgkJd2hpbGUgKCAobm9kZSA9IGVsZW1baSsrXSkgKSB7CgkJCS8vIERvIG5vdCB0cmF2ZXJzZSBjb21tZW50IG5vZGVzCgkJCXJldCArPSBnZXRUZXh0KCBub2RlICk7CgkJfQoJfSBlbHNlIGlmICggbm9kZVR5cGUgPT09IDEgfHwgbm9kZVR5cGUgPT09IDkgfHwgbm9kZVR5cGUgPT09IDExICkgewoJCS8vIFVzZSB0ZXh0Q29udGVudCBmb3IgZWxlbWVudHMKCQkvLyBpbm5lclRleHQgdXNhZ2UgcmVtb3ZlZCBmb3IgY29uc2lzdGVuY3kgb2YgbmV3IGxpbmVzIChqUXVlcnkgIzExMTUzKQoJCWlmICggdHlwZW9mIGVsZW0udGV4dENvbnRlbnQgPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gZWxlbS50ZXh0Q29udGVudDsKCQl9IGVsc2UgewoJCQkvLyBUcmF2ZXJzZSBpdHMgY2hpbGRyZW4KCQkJZm9yICggZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcgKSB7CgkJCQlyZXQgKz0gZ2V0VGV4dCggZWxlbSApOwoJCQl9CgkJfQoJfSBlbHNlIGlmICggbm9kZVR5cGUgPT09IDMgfHwgbm9kZVR5cGUgPT09IDQgKSB7CgkJcmV0dXJuIGVsZW0ubm9kZVZhbHVlOwoJfQoJLy8gRG8gbm90IGluY2x1ZGUgY29tbWVudCBvciBwcm9jZXNzaW5nIGluc3RydWN0aW9uIG5vZGVzCgoJcmV0dXJuIHJldDsKfTsKCkV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzID0gewoKCS8vIENhbiBiZSBhZGp1c3RlZCBieSB0aGUgdXNlcgoJY2FjaGVMZW5ndGg6IDUwLAoKCWNyZWF0ZVBzZXVkbzogbWFya0Z1bmN0aW9uLAoKCW1hdGNoOiBtYXRjaEV4cHIsCgoJYXR0ckhhbmRsZToge30sCgoJZmluZDoge30sCgoJcmVsYXRpdmU6IHsKCQkiPiI6IHsgZGlyOiAicGFyZW50Tm9kZSIsIGZpcnN0OiB0cnVlIH0sCgkJIiAiOiB7IGRpcjogInBhcmVudE5vZGUiIH0sCgkJIisiOiB7IGRpcjogInByZXZpb3VzU2libGluZyIsIGZpcnN0OiB0cnVlIH0sCgkJIn4iOiB7IGRpcjogInByZXZpb3VzU2libGluZyIgfQoJfSwKCglwcmVGaWx0ZXI6IHsKCQkiQVRUUiI6IGZ1bmN0aW9uKCBtYXRjaCApIHsKCQkJbWF0Y2hbMV0gPSBtYXRjaFsxXS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApOwoKCQkJLy8gTW92ZSB0aGUgZ2l2ZW4gdmFsdWUgdG8gbWF0Y2hbM10gd2hldGhlciBxdW90ZWQgb3IgdW5xdW90ZWQKCQkJbWF0Y2hbM10gPSAoIG1hdGNoWzNdIHx8IG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8ICIiICkucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCgkJCWlmICggbWF0Y2hbMl0gPT09ICJ+PSIgKSB7CgkJCQltYXRjaFszXSA9ICIgIiArIG1hdGNoWzNdICsgIiAiOwoJCQl9CgoJCQlyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDQgKTsKCQl9LAoKCQkiQ0hJTEQiOiBmdW5jdGlvbiggbWF0Y2ggKSB7CgkJCS8qIG1hdGNoZXMgZnJvbSBtYXRjaEV4cHJbIkNISUxEIl0KCQkJCTEgdHlwZSAob25seXxudGh8Li4uKQoJCQkJMiB3aGF0IChjaGlsZHxvZi10eXBlKQoJCQkJMyBhcmd1bWVudCAoZXZlbnxvZGR8XGQqfFxkKm4oWystXVxkKyk/fC4uLikKCQkJCTQgeG4tY29tcG9uZW50IG9mIHhuK3kgYXJndW1lbnQgKFsrLV0/XGQqbnwpCgkJCQk1IHNpZ24gb2YgeG4tY29tcG9uZW50CgkJCQk2IHggb2YgeG4tY29tcG9uZW50CgkJCQk3IHNpZ24gb2YgeS1jb21wb25lbnQKCQkJCTggeSBvZiB5LWNvbXBvbmVudAoJCQkqLwoJCQltYXRjaFsxXSA9IG1hdGNoWzFdLnRvTG93ZXJDYXNlKCk7CgoJCQlpZiAoIG1hdGNoWzFdLnNsaWNlKCAwLCAzICkgPT09ICJudGgiICkgewoJCQkJLy8gbnRoLSogcmVxdWlyZXMgYXJndW1lbnQKCQkJCWlmICggIW1hdGNoWzNdICkgewoJCQkJCVNpenpsZS5lcnJvciggbWF0Y2hbMF0gKTsKCQkJCX0KCgkJCQkvLyBudW1lcmljIHggYW5kIHkgcGFyYW1ldGVycyBmb3IgRXhwci5maWx0ZXIuQ0hJTEQKCQkJCS8vIHJlbWVtYmVyIHRoYXQgZmFsc2UvdHJ1ZSBjYXN0IHJlc3BlY3RpdmVseSB0byAwLzEKCQkJCW1hdGNoWzRdID0gKyggbWF0Y2hbNF0gPyBtYXRjaFs1XSArIChtYXRjaFs2XSB8fCAxKSA6IDIgKiAoIG1hdGNoWzNdID09PSAiZXZlbiIgfHwgbWF0Y2hbM10gPT09ICJvZGQiICkgKTsKCQkJCW1hdGNoWzVdID0gKyggKCBtYXRjaFs3XSArIG1hdGNoWzhdICkgfHwgbWF0Y2hbM10gPT09ICJvZGQiICk7CgoJCQkvLyBvdGhlciB0eXBlcyBwcm9oaWJpdCBhcmd1bWVudHMKCQkJfSBlbHNlIGlmICggbWF0Y2hbM10gKSB7CgkJCQlTaXp6bGUuZXJyb3IoIG1hdGNoWzBdICk7CgkJCX0KCgkJCXJldHVybiBtYXRjaDsKCQl9LAoKCQkiUFNFVURPIjogZnVuY3Rpb24oIG1hdGNoICkgewoJCQl2YXIgZXhjZXNzLAoJCQkJdW5xdW90ZWQgPSAhbWF0Y2hbNl0gJiYgbWF0Y2hbMl07CgoJCQlpZiAoIG1hdGNoRXhwclsiQ0hJTEQiXS50ZXN0KCBtYXRjaFswXSApICkgewoJCQkJcmV0dXJuIG51bGw7CgkJCX0KCgkJCS8vIEFjY2VwdCBxdW90ZWQgYXJndW1lbnRzIGFzLWlzCgkJCWlmICggbWF0Y2hbM10gKSB7CgkJCQltYXRjaFsyXSA9IG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8ICIiOwoKCQkJLy8gU3RyaXAgZXhjZXNzIGNoYXJhY3RlcnMgZnJvbSB1bnF1b3RlZCBhcmd1bWVudHMKCQkJfSBlbHNlIGlmICggdW5xdW90ZWQgJiYgcnBzZXVkby50ZXN0KCB1bnF1b3RlZCApICYmCgkJCQkvLyBHZXQgZXhjZXNzIGZyb20gdG9rZW5pemUgKHJlY3Vyc2l2ZWx5KQoJCQkJKGV4Y2VzcyA9IHRva2VuaXplKCB1bnF1b3RlZCwgdHJ1ZSApKSAmJgoJCQkJLy8gYWR2YW5jZSB0byB0aGUgbmV4dCBjbG9zaW5nIHBhcmVudGhlc2lzCgkJCQkoZXhjZXNzID0gdW5xdW90ZWQuaW5kZXhPZiggIikiLCB1bnF1b3RlZC5sZW5ndGggLSBleGNlc3MgKSAtIHVucXVvdGVkLmxlbmd0aCkgKSB7CgoJCQkJLy8gZXhjZXNzIGlzIGEgbmVnYXRpdmUgaW5kZXgKCQkJCW1hdGNoWzBdID0gbWF0Y2hbMF0uc2xpY2UoIDAsIGV4Y2VzcyApOwoJCQkJbWF0Y2hbMl0gPSB1bnF1b3RlZC5zbGljZSggMCwgZXhjZXNzICk7CgkJCX0KCgkJCS8vIFJldHVybiBvbmx5IGNhcHR1cmVzIG5lZWRlZCBieSB0aGUgcHNldWRvIGZpbHRlciBtZXRob2QgKHR5cGUgYW5kIGFyZ3VtZW50KQoJCQlyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDMgKTsKCQl9Cgl9LAoKCWZpbHRlcjogewoKCQkiVEFHIjogZnVuY3Rpb24oIG5vZGVOYW1lU2VsZWN0b3IgKSB7CgkJCXZhciBub2RlTmFtZSA9IG5vZGVOYW1lU2VsZWN0b3IucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKS50b0xvd2VyQ2FzZSgpOwoJCQlyZXR1cm4gbm9kZU5hbWVTZWxlY3RvciA9PT0gIioiID8KCQkJCWZ1bmN0aW9uKCkgeyByZXR1cm4gdHJ1ZTsgfSA6CgkJCQlmdW5jdGlvbiggZWxlbSApIHsKCQkJCQlyZXR1cm4gZWxlbS5ub2RlTmFtZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5vZGVOYW1lOwoJCQkJfTsKCQl9LAoKCQkiQ0xBU1MiOiBmdW5jdGlvbiggY2xhc3NOYW1lICkgewoJCQl2YXIgcGF0dGVybiA9IGNsYXNzQ2FjaGVbIGNsYXNzTmFtZSArICIgIiBdOwoKCQkJcmV0dXJuIHBhdHRlcm4gfHwKCQkJCShwYXR0ZXJuID0gbmV3IFJlZ0V4cCggIihefCIgKyB3aGl0ZXNwYWNlICsgIikiICsgY2xhc3NOYW1lICsgIigiICsgd2hpdGVzcGFjZSArICJ8JCkiICkpICYmCgkJCQljbGFzc0NhY2hlKCBjbGFzc05hbWUsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCXJldHVybiBwYXR0ZXJuLnRlc3QoIHR5cGVvZiBlbGVtLmNsYXNzTmFtZSA9PT0gInN0cmluZyIgJiYgZWxlbS5jbGFzc05hbWUgfHwgdHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlICE9PSAidW5kZWZpbmVkIiAmJiBlbGVtLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSB8fCAiIiApOwoJCQkJfSk7CgkJfSwKCgkJIkFUVFIiOiBmdW5jdGlvbiggbmFtZSwgb3BlcmF0b3IsIGNoZWNrICkgewoJCQlyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQl2YXIgcmVzdWx0ID0gU2l6emxlLmF0dHIoIGVsZW0sIG5hbWUgKTsKCgkJCQlpZiAoIHJlc3VsdCA9PSBudWxsICkgewoJCQkJCXJldHVybiBvcGVyYXRvciA9PT0gIiE9IjsKCQkJCX0KCQkJCWlmICggIW9wZXJhdG9yICkgewoJCQkJCXJldHVybiB0cnVlOwoJCQkJfQoKCQkJCXJlc3VsdCArPSAiIjsKCgkJCQlyZXR1cm4gb3BlcmF0b3IgPT09ICI9IiA/IHJlc3VsdCA9PT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAiIT0iID8gcmVzdWx0ICE9PSBjaGVjayA6CgkJCQkJb3BlcmF0b3IgPT09ICJePSIgPyBjaGVjayAmJiByZXN1bHQuaW5kZXhPZiggY2hlY2sgKSA9PT0gMCA6CgkJCQkJb3BlcmF0b3IgPT09ICIqPSIgPyBjaGVjayAmJiByZXN1bHQuaW5kZXhPZiggY2hlY2sgKSA+IC0xIDoKCQkJCQlvcGVyYXRvciA9PT0gIiQ9IiA/IGNoZWNrICYmIHJlc3VsdC5zbGljZSggLWNoZWNrLmxlbmd0aCApID09PSBjaGVjayA6CgkJCQkJb3BlcmF0b3IgPT09ICJ+PSIgPyAoICIgIiArIHJlc3VsdC5yZXBsYWNlKCByd2hpdGVzcGFjZSwgIiAiICkgKyAiICIgKS5pbmRleE9mKCBjaGVjayApID4gLTEgOgoJCQkJCW9wZXJhdG9yID09PSAifD0iID8gcmVzdWx0ID09PSBjaGVjayB8fCByZXN1bHQuc2xpY2UoIDAsIGNoZWNrLmxlbmd0aCArIDEgKSA9PT0gY2hlY2sgKyAiLSIgOgoJCQkJCWZhbHNlOwoJCQl9OwoJCX0sCgoJCSJDSElMRCI6IGZ1bmN0aW9uKCB0eXBlLCB3aGF0LCBhcmd1bWVudCwgZmlyc3QsIGxhc3QgKSB7CgkJCXZhciBzaW1wbGUgPSB0eXBlLnNsaWNlKCAwLCAzICkgIT09ICJudGgiLAoJCQkJZm9yd2FyZCA9IHR5cGUuc2xpY2UoIC00ICkgIT09ICJsYXN0IiwKCQkJCW9mVHlwZSA9IHdoYXQgPT09ICJvZi10eXBlIjsKCgkJCXJldHVybiBmaXJzdCA9PT0gMSAmJiBsYXN0ID09PSAwID8KCgkJCQkvLyBTaG9ydGN1dCBmb3IgOm50aC0qKG4pCgkJCQlmdW5jdGlvbiggZWxlbSApIHsKCQkJCQlyZXR1cm4gISFlbGVtLnBhcmVudE5vZGU7CgkJCQl9IDoKCgkJCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQkJCXZhciBjYWNoZSwgdW5pcXVlQ2FjaGUsIG91dGVyQ2FjaGUsIG5vZGUsIG5vZGVJbmRleCwgc3RhcnQsCgkJCQkJCWRpciA9IHNpbXBsZSAhPT0gZm9yd2FyZCA/ICJuZXh0U2libGluZyIgOiAicHJldmlvdXNTaWJsaW5nIiwKCQkJCQkJcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlLAoJCQkJCQluYW1lID0gb2ZUeXBlICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwKCQkJCQkJdXNlQ2FjaGUgPSAheG1sICYmICFvZlR5cGUsCgkJCQkJCWRpZmYgPSBmYWxzZTsKCgkJCQkJaWYgKCBwYXJlbnQgKSB7CgoJCQkJCQkvLyA6KGZpcnN0fGxhc3R8b25seSktKGNoaWxkfG9mLXR5cGUpCgkJCQkJCWlmICggc2ltcGxlICkgewoJCQkJCQkJd2hpbGUgKCBkaXIgKSB7CgkJCQkJCQkJbm9kZSA9IGVsZW07CgkJCQkJCQkJd2hpbGUgKCAobm9kZSA9IG5vZGVbIGRpciBdKSApIHsKCQkJCQkJCQkJaWYgKCBvZlR5cGUgPwoJCQkJCQkJCQkJbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDoKCQkJCQkJCQkJCW5vZGUubm9kZVR5cGUgPT09IDEgKSB7CgoJCQkJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJCS8vIFJldmVyc2UgZGlyZWN0aW9uIGZvciA6b25seS0qIChpZiB3ZSBoYXZlbid0IHlldCBkb25lIHNvKQoJCQkJCQkJCXN0YXJ0ID0gZGlyID0gdHlwZSA9PT0gIm9ubHkiICYmICFzdGFydCAmJiAibmV4dFNpYmxpbmciOwoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCX0KCgkJCQkJCXN0YXJ0ID0gWyBmb3J3YXJkID8gcGFyZW50LmZpcnN0Q2hpbGQgOiBwYXJlbnQubGFzdENoaWxkIF07CgoJCQkJCQkvLyBub24teG1sIDpudGgtY2hpbGQoLi4uKSBzdG9yZXMgY2FjaGUgZGF0YSBvbiBgcGFyZW50YAoJCQkJCQlpZiAoIGZvcndhcmQgJiYgdXNlQ2FjaGUgKSB7CgoJCQkJCQkJLy8gU2VlayBgZWxlbWAgZnJvbSBhIHByZXZpb3VzbHktY2FjaGVkIGluZGV4CgoJCQkJCQkJLy8gLi4uaW4gYSBnemlwLWZyaWVuZGx5IHdheQoJCQkJCQkJbm9kZSA9IHBhcmVudDsKCQkJCQkJCW91dGVyQ2FjaGUgPSBub2RlWyBleHBhbmRvIF0gfHwgKG5vZGVbIGV4cGFuZG8gXSA9IHt9KTsKCgkJCQkJCQkvLyBTdXBwb3J0OiBJRSA8OSBvbmx5CgkJCQkJCQkvLyBEZWZlbmQgYWdhaW5zdCBjbG9uZWQgYXR0cm9wZXJ0aWVzIChqUXVlcnkgZ2gtMTcwOSkKCQkJCQkJCXVuaXF1ZUNhY2hlID0gb3V0ZXJDYWNoZVsgbm9kZS51bmlxdWVJRCBdIHx8CgkJCQkJCQkJKG91dGVyQ2FjaGVbIG5vZGUudW5pcXVlSUQgXSA9IHt9KTsKCgkJCQkJCQljYWNoZSA9IHVuaXF1ZUNhY2hlWyB0eXBlIF0gfHwgW107CgkJCQkJCQlub2RlSW5kZXggPSBjYWNoZVsgMCBdID09PSBkaXJydW5zICYmIGNhY2hlWyAxIF07CgkJCQkJCQlkaWZmID0gbm9kZUluZGV4ICYmIGNhY2hlWyAyIF07CgkJCQkJCQlub2RlID0gbm9kZUluZGV4ICYmIHBhcmVudC5jaGlsZE5vZGVzWyBub2RlSW5kZXggXTsKCgkJCQkJCQl3aGlsZSAoIChub2RlID0gKytub2RlSW5kZXggJiYgbm9kZSAmJiBub2RlWyBkaXIgXSB8fAoKCQkJCQkJCQkvLyBGYWxsYmFjayB0byBzZWVraW5nIGBlbGVtYCBmcm9tIHRoZSBzdGFydAoJCQkJCQkJCShkaWZmID0gbm9kZUluZGV4ID0gMCkgfHwgc3RhcnQucG9wKCkpICkgewoKCQkJCQkJCQkvLyBXaGVuIGZvdW5kLCBjYWNoZSBpbmRleGVzIG9uIGBwYXJlbnRgIGFuZCBicmVhawoJCQkJCQkJCWlmICggbm9kZS5ub2RlVHlwZSA9PT0gMSAmJiArK2RpZmYgJiYgbm9kZSA9PT0gZWxlbSApIHsKCQkJCQkJCQkJdW5pcXVlQ2FjaGVbIHR5cGUgXSA9IFsgZGlycnVucywgbm9kZUluZGV4LCBkaWZmIF07CgkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCX0KCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBVc2UgcHJldmlvdXNseS1jYWNoZWQgZWxlbWVudCBpbmRleCBpZiBhdmFpbGFibGUKCQkJCQkJCWlmICggdXNlQ2FjaGUgKSB7CgkJCQkJCQkJLy8gLi4uaW4gYSBnemlwLWZyaWVuZGx5IHdheQoJCQkJCQkJCW5vZGUgPSBlbGVtOwoJCQkJCQkJCW91dGVyQ2FjaGUgPSBub2RlWyBleHBhbmRvIF0gfHwgKG5vZGVbIGV4cGFuZG8gXSA9IHt9KTsKCgkJCQkJCQkJLy8gU3VwcG9ydDogSUUgPDkgb25seQoJCQkJCQkJCS8vIERlZmVuZCBhZ2FpbnN0IGNsb25lZCBhdHRyb3BlcnRpZXMgKGpRdWVyeSBnaC0xNzA5KQoJCQkJCQkJCXVuaXF1ZUNhY2hlID0gb3V0ZXJDYWNoZVsgbm9kZS51bmlxdWVJRCBdIHx8CgkJCQkJCQkJCShvdXRlckNhY2hlWyBub2RlLnVuaXF1ZUlEIF0gPSB7fSk7CgoJCQkJCQkJCWNhY2hlID0gdW5pcXVlQ2FjaGVbIHR5cGUgXSB8fCBbXTsKCQkJCQkJCQlub2RlSW5kZXggPSBjYWNoZVsgMCBdID09PSBkaXJydW5zICYmIGNhY2hlWyAxIF07CgkJCQkJCQkJZGlmZiA9IG5vZGVJbmRleDsKCQkJCQkJCX0KCgkJCQkJCQkvLyB4bWwgOm50aC1jaGlsZCguLi4pCgkJCQkJCQkvLyBvciA6bnRoLWxhc3QtY2hpbGQoLi4uKSBvciA6bnRoKC1sYXN0KT8tb2YtdHlwZSguLi4pCgkJCQkJCQlpZiAoIGRpZmYgPT09IGZhbHNlICkgewoJCQkJCQkJCS8vIFVzZSB0aGUgc2FtZSBsb29wIGFzIGFib3ZlIHRvIHNlZWsgYGVsZW1gIGZyb20gdGhlIHN0YXJ0CgkJCQkJCQkJd2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHwKCQkJCQkJCQkJKGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7CgoJCQkJCQkJCQlpZiAoICggb2ZUeXBlID8KCQkJCQkJCQkJCW5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZSA6CgkJCQkJCQkJCQlub2RlLm5vZGVUeXBlID09PSAxICkgJiYKCQkJCQkJCQkJCSsrZGlmZiApIHsKCgkJCQkJCQkJCQkvLyBDYWNoZSB0aGUgaW5kZXggb2YgZWFjaCBlbmNvdW50ZXJlZCBlbGVtZW50CgkJCQkJCQkJCQlpZiAoIHVzZUNhY2hlICkgewoJCQkJCQkJCQkJCW91dGVyQ2FjaGUgPSBub2RlWyBleHBhbmRvIF0gfHwgKG5vZGVbIGV4cGFuZG8gXSA9IHt9KTsKCgkJCQkJCQkJCQkJLy8gU3VwcG9ydDogSUUgPDkgb25seQoJCQkJCQkJCQkJCS8vIERlZmVuZCBhZ2FpbnN0IGNsb25lZCBhdHRyb3BlcnRpZXMgKGpRdWVyeSBnaC0xNzA5KQoJCQkJCQkJCQkJCXVuaXF1ZUNhY2hlID0gb3V0ZXJDYWNoZVsgbm9kZS51bmlxdWVJRCBdIHx8CgkJCQkJCQkJCQkJCShvdXRlckNhY2hlWyBub2RlLnVuaXF1ZUlEIF0gPSB7fSk7CgoJCQkJCQkJCQkJCXVuaXF1ZUNhY2hlWyB0eXBlIF0gPSBbIGRpcnJ1bnMsIGRpZmYgXTsKCQkJCQkJCQkJCX0KCgkJCQkJCQkJCQlpZiAoIG5vZGUgPT09IGVsZW0gKSB7CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCgkJCQkJCS8vIEluY29ycG9yYXRlIHRoZSBvZmZzZXQsIHRoZW4gY2hlY2sgYWdhaW5zdCBjeWNsZSBzaXplCgkJCQkJCWRpZmYgLT0gbGFzdDsKCQkJCQkJcmV0dXJuIGRpZmYgPT09IGZpcnN0IHx8ICggZGlmZiAlIGZpcnN0ID09PSAwICYmIGRpZmYgLyBmaXJzdCA+PSAwICk7CgkJCQkJfQoJCQkJfTsKCQl9LAoKCQkiUFNFVURPIjogZnVuY3Rpb24oIHBzZXVkbywgYXJndW1lbnQgKSB7CgkJCS8vIHBzZXVkby1jbGFzcyBuYW1lcyBhcmUgY2FzZS1pbnNlbnNpdGl2ZQoJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI3BzZXVkby1jbGFzc2VzCgkJCS8vIFByaW9yaXRpemUgYnkgY2FzZSBzZW5zaXRpdml0eSBpbiBjYXNlIGN1c3RvbSBwc2V1ZG9zIGFyZSBhZGRlZCB3aXRoIHVwcGVyY2FzZSBsZXR0ZXJzCgkJCS8vIFJlbWVtYmVyIHRoYXQgc2V0RmlsdGVycyBpbmhlcml0cyBmcm9tIHBzZXVkb3MKCQkJdmFyIGFyZ3MsCgkJCQlmbiA9IEV4cHIucHNldWRvc1sgcHNldWRvIF0gfHwgRXhwci5zZXRGaWx0ZXJzWyBwc2V1ZG8udG9Mb3dlckNhc2UoKSBdIHx8CgkJCQkJU2l6emxlLmVycm9yKCAidW5zdXBwb3J0ZWQgcHNldWRvOiAiICsgcHNldWRvICk7CgoJCQkvLyBUaGUgdXNlciBtYXkgdXNlIGNyZWF0ZVBzZXVkbyB0byBpbmRpY2F0ZSB0aGF0CgkJCS8vIGFyZ3VtZW50cyBhcmUgbmVlZGVkIHRvIGNyZWF0ZSB0aGUgZmlsdGVyIGZ1bmN0aW9uCgkJCS8vIGp1c3QgYXMgU2l6emxlIGRvZXMKCQkJaWYgKCBmblsgZXhwYW5kbyBdICkgewoJCQkJcmV0dXJuIGZuKCBhcmd1bWVudCApOwoJCQl9CgoJCQkvLyBCdXQgbWFpbnRhaW4gc3VwcG9ydCBmb3Igb2xkIHNpZ25hdHVyZXMKCQkJaWYgKCBmbi5sZW5ndGggPiAxICkgewoJCQkJYXJncyA9IFsgcHNldWRvLCBwc2V1ZG8sICIiLCBhcmd1bWVudCBdOwoJCQkJcmV0dXJuIEV4cHIuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eSggcHNldWRvLnRvTG93ZXJDYXNlKCkgKSA/CgkJCQkJbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzICkgewoJCQkJCQl2YXIgaWR4LAoJCQkJCQkJbWF0Y2hlZCA9IGZuKCBzZWVkLCBhcmd1bWVudCApLAoJCQkJCQkJaSA9IG1hdGNoZWQubGVuZ3RoOwoJCQkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQkJCWlkeCA9IGluZGV4T2YoIHNlZWQsIG1hdGNoZWRbaV0gKTsKCQkJCQkJCXNlZWRbIGlkeCBdID0gISggbWF0Y2hlc1sgaWR4IF0gPSBtYXRjaGVkW2ldICk7CgkJCQkJCX0KCQkJCQl9KSA6CgkJCQkJZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJCXJldHVybiBmbiggZWxlbSwgMCwgYXJncyApOwoJCQkJCX07CgkJCX0KCgkJCXJldHVybiBmbjsKCQl9Cgl9LAoKCXBzZXVkb3M6IHsKCQkvLyBQb3RlbnRpYWxseSBjb21wbGV4IHBzZXVkb3MKCQkibm90IjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQkJLy8gVHJpbSB0aGUgc2VsZWN0b3IgcGFzc2VkIHRvIGNvbXBpbGUKCQkJLy8gdG8gYXZvaWQgdHJlYXRpbmcgbGVhZGluZyBhbmQgdHJhaWxpbmcKCQkJLy8gc3BhY2VzIGFzIGNvbWJpbmF0b3JzCgkJCXZhciBpbnB1dCA9IFtdLAoJCQkJcmVzdWx0cyA9IFtdLAoJCQkJbWF0Y2hlciA9IGNvbXBpbGUoIHNlbGVjdG9yLnJlcGxhY2UoIHJ0cmltLCAiJDEiICkgKTsKCgkJCXJldHVybiBtYXRjaGVyWyBleHBhbmRvIF0gPwoJCQkJbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzLCBjb250ZXh0LCB4bWwgKSB7CgkJCQkJdmFyIGVsZW0sCgkJCQkJCXVubWF0Y2hlZCA9IG1hdGNoZXIoIHNlZWQsIG51bGwsIHhtbCwgW10gKSwKCQkJCQkJaSA9IHNlZWQubGVuZ3RoOwoKCQkJCQkvLyBNYXRjaCBlbGVtZW50cyB1bm1hdGNoZWQgYnkgYG1hdGNoZXJgCgkJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJCWlmICggKGVsZW0gPSB1bm1hdGNoZWRbaV0pICkgewoJCQkJCQkJc2VlZFtpXSA9ICEobWF0Y2hlc1tpXSA9IGVsZW0pOwoJCQkJCQl9CgkJCQkJfQoJCQkJfSkgOgoJCQkJZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsKCQkJCQlpbnB1dFswXSA9IGVsZW07CgkJCQkJbWF0Y2hlciggaW5wdXQsIG51bGwsIHhtbCwgcmVzdWx0cyApOwoJCQkJCS8vIERvbid0IGtlZXAgdGhlIGVsZW1lbnQgKGlzc3VlICMyOTkpCgkJCQkJaW5wdXRbMF0gPSBudWxsOwoJCQkJCXJldHVybiAhcmVzdWx0cy5wb3AoKTsKCQkJCX07CgkJfSksCgoJCSJoYXMiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCQlyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQlyZXR1cm4gU2l6emxlKCBzZWxlY3RvciwgZWxlbSApLmxlbmd0aCA+IDA7CgkJCX07CgkJfSksCgoJCSJjb250YWlucyI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiggdGV4dCApIHsKCQkJdGV4dCA9IHRleHQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuICggZWxlbS50ZXh0Q29udGVudCB8fCBlbGVtLmlubmVyVGV4dCB8fCBnZXRUZXh0KCBlbGVtICkgKS5pbmRleE9mKCB0ZXh0ICkgPiAtMTsKCQkJfTsKCQl9KSwKCgkJLy8gIldoZXRoZXIgYW4gZWxlbWVudCBpcyByZXByZXNlbnRlZCBieSBhIDpsYW5nKCkgc2VsZWN0b3IKCQkvLyBpcyBiYXNlZCBzb2xlbHkgb24gdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZQoJCS8vIGJlaW5nIGVxdWFsIHRvIHRoZSBpZGVudGlmaWVyIEMsCgkJLy8gb3IgYmVnaW5uaW5nIHdpdGggdGhlIGlkZW50aWZpZXIgQyBpbW1lZGlhdGVseSBmb2xsb3dlZCBieSAiLSIuCgkJLy8gVGhlIG1hdGNoaW5nIG9mIEMgYWdhaW5zdCB0aGUgZWxlbWVudCdzIGxhbmd1YWdlIHZhbHVlIGlzIHBlcmZvcm1lZCBjYXNlLWluc2Vuc2l0aXZlbHkuCgkJLy8gVGhlIGlkZW50aWZpZXIgQyBkb2VzIG5vdCBoYXZlIHRvIGJlIGEgdmFsaWQgbGFuZ3VhZ2UgbmFtZS4iCgkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNsYW5nLXBzZXVkbwoJCSJsYW5nIjogbWFya0Z1bmN0aW9uKCBmdW5jdGlvbiggbGFuZyApIHsKCQkJLy8gbGFuZyB2YWx1ZSBtdXN0IGJlIGEgdmFsaWQgaWRlbnRpZmllcgoJCQlpZiAoICFyaWRlbnRpZmllci50ZXN0KGxhbmcgfHwgIiIpICkgewoJCQkJU2l6emxlLmVycm9yKCAidW5zdXBwb3J0ZWQgbGFuZzogIiArIGxhbmcgKTsKCQkJfQoJCQlsYW5nID0gbGFuZy5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLnRvTG93ZXJDYXNlKCk7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciBlbGVtTGFuZzsKCQkJCWRvIHsKCQkJCQlpZiAoIChlbGVtTGFuZyA9IGRvY3VtZW50SXNIVE1MID8KCQkJCQkJZWxlbS5sYW5nIDoKCQkJCQkJZWxlbS5nZXRBdHRyaWJ1dGUoInhtbDpsYW5nIikgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoImxhbmciKSkgKSB7CgoJCQkJCQllbGVtTGFuZyA9IGVsZW1MYW5nLnRvTG93ZXJDYXNlKCk7CgkJCQkJCXJldHVybiBlbGVtTGFuZyA9PT0gbGFuZyB8fCBlbGVtTGFuZy5pbmRleE9mKCBsYW5nICsgIi0iICkgPT09IDA7CgkJCQkJfQoJCQkJfSB3aGlsZSAoIChlbGVtID0gZWxlbS5wYXJlbnROb2RlKSAmJiBlbGVtLm5vZGVUeXBlID09PSAxICk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX07CgkJfSksCgoJCS8vIE1pc2NlbGxhbmVvdXMKCQkidGFyZ2V0IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXZhciBoYXNoID0gd2luZG93LmxvY2F0aW9uICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoOwoJCQlyZXR1cm4gaGFzaCAmJiBoYXNoLnNsaWNlKCAxICkgPT09IGVsZW0uaWQ7CgkJfSwKCgkJInJvb3QiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0gPT09IGRvY0VsZW07CgkJfSwKCgkJImZvY3VzIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmICghZG9jdW1lbnQuaGFzRm9jdXMgfHwgZG9jdW1lbnQuaGFzRm9jdXMoKSkgJiYgISEoZWxlbS50eXBlIHx8IGVsZW0uaHJlZiB8fCB+ZWxlbS50YWJJbmRleCk7CgkJfSwKCgkJLy8gQm9vbGVhbiBwcm9wZXJ0aWVzCgkJImVuYWJsZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IGZhbHNlOwoJCX0sCgoJCSJkaXNhYmxlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gdHJ1ZTsKCQl9LAoKCQkiY2hlY2tlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBJbiBDU1MzLCA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIGJvdGggY2hlY2tlZCBhbmQgc2VsZWN0ZWQgZWxlbWVudHMKCQkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAxMS9SRUMtY3NzMy1zZWxlY3RvcnMtMjAxMTA5MjkvI2NoZWNrZWQKCQkJdmFyIG5vZGVOYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCQlyZXR1cm4gKG5vZGVOYW1lID09PSAiaW5wdXQiICYmICEhZWxlbS5jaGVja2VkKSB8fCAobm9kZU5hbWUgPT09ICJvcHRpb24iICYmICEhZWxlbS5zZWxlY3RlZCk7CgkJfSwKCgkJInNlbGVjdGVkIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCS8vIEFjY2Vzc2luZyB0aGlzIHByb3BlcnR5IG1ha2VzIHNlbGVjdGVkLWJ5LWRlZmF1bHQKCQkJLy8gb3B0aW9ucyBpbiBTYWZhcmkgd29yayBwcm9wZXJseQoJCQlpZiAoIGVsZW0ucGFyZW50Tm9kZSApIHsKCQkJCWVsZW0ucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4OwoJCQl9CgoJCQlyZXR1cm4gZWxlbS5zZWxlY3RlZCA9PT0gdHJ1ZTsKCQl9LAoKCQkvLyBDb250ZW50cwoJCSJlbXB0eSI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2VtcHR5LXBzZXVkbwoJCQkvLyA6ZW1wdHkgaXMgbmVnYXRlZCBieSBlbGVtZW50ICgxKSBvciBjb250ZW50IG5vZGVzICh0ZXh0OiAzOyBjZGF0YTogNDsgZW50aXR5IHJlZjogNSksCgkJCS8vICAgYnV0IG5vdCBieSBvdGhlcnMgKGNvbW1lbnQ6IDg7IHByb2Nlc3NpbmcgaW5zdHJ1Y3Rpb246IDc7IGV0Yy4pCgkJCS8vIG5vZGVUeXBlIDwgNiB3b3JrcyBiZWNhdXNlIGF0dHJpYnV0ZXMgKDIpIGRvIG5vdCBhcHBlYXIgYXMgY2hpbGRyZW4KCQkJZm9yICggZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcgKSB7CgkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPCA2ICkgewoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gdHJ1ZTsKCQl9LAoKCQkicGFyZW50IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiAhRXhwci5wc2V1ZG9zWyJlbXB0eSJdKCBlbGVtICk7CgkJfSwKCgkJLy8gRWxlbWVudC9pbnB1dCB0eXBlcwoJCSJoZWFkZXIiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIHJoZWFkZXIudGVzdCggZWxlbS5ub2RlTmFtZSApOwoJCX0sCgoJCSJpbnB1dCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gcmlucHV0cy50ZXN0KCBlbGVtLm5vZGVOYW1lICk7CgkJfSwKCgkJImJ1dHRvbiI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIG5hbWUgPT09ICJpbnB1dCIgJiYgZWxlbS50eXBlID09PSAiYnV0dG9uIiB8fCBuYW1lID09PSAiYnV0dG9uIjsKCQl9LAoKCQkidGV4dCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgYXR0cjsKCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IiAmJgoJCQkJZWxlbS50eXBlID09PSAidGV4dCIgJiYKCgkJCQkvLyBTdXBwb3J0OiBJRTw4CgkJCQkvLyBOZXcgSFRNTDUgYXR0cmlidXRlIHZhbHVlcyAoZS5nLiwgInNlYXJjaCIpIGFwcGVhciB3aXRoIGVsZW0udHlwZSA9PT0gInRleHQiCgkJCQkoIChhdHRyID0gZWxlbS5nZXRBdHRyaWJ1dGUoInR5cGUiKSkgPT0gbnVsbCB8fCBhdHRyLnRvTG93ZXJDYXNlKCkgPT09ICJ0ZXh0IiApOwoJCX0sCgoJCS8vIFBvc2l0aW9uLWluLWNvbGxlY3Rpb24KCQkiZmlyc3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gWyAwIF07CgkJfSksCgoJCSJsYXN0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7CgkJCXJldHVybiBbIGxlbmd0aCAtIDEgXTsKCQl9KSwKCgkJImVxIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkgewoJCQlyZXR1cm4gWyBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50IF07CgkJfSksCgoJCSJldmVuIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7CgkJCXZhciBpID0gMDsKCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpICs9IDIgKSB7CgkJCQltYXRjaEluZGV4ZXMucHVzaCggaSApOwoJCQl9CgkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJfSksCgoJCSJvZGQiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsKCQkJdmFyIGkgPSAxOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkgKz0gMiApIHsKCQkJCW1hdGNoSW5kZXhlcy5wdXNoKCBpICk7CgkJCX0KCQkJcmV0dXJuIG1hdGNoSW5kZXhlczsKCQl9KSwKCgkJImx0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkgewoJCQl2YXIgaSA9IGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQ7CgkJCWZvciAoIDsgLS1pID49IDA7ICkgewoJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJfQoJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCX0pLAoKCQkiZ3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7CgkJCXZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudDsKCQkJZm9yICggOyArK2kgPCBsZW5ndGg7ICkgewoJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJfQoJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCX0pCgl9Cn07CgpFeHByLnBzZXVkb3NbIm50aCJdID0gRXhwci5wc2V1ZG9zWyJlcSJdOwoKLy8gQWRkIGJ1dHRvbi9pbnB1dCB0eXBlIHBzZXVkb3MKZm9yICggaSBpbiB7IHJhZGlvOiB0cnVlLCBjaGVja2JveDogdHJ1ZSwgZmlsZTogdHJ1ZSwgcGFzc3dvcmQ6IHRydWUsIGltYWdlOiB0cnVlIH0gKSB7CglFeHByLnBzZXVkb3NbIGkgXSA9IGNyZWF0ZUlucHV0UHNldWRvKCBpICk7Cn0KZm9yICggaSBpbiB7IHN1Ym1pdDogdHJ1ZSwgcmVzZXQ6IHRydWUgfSApIHsKCUV4cHIucHNldWRvc1sgaSBdID0gY3JlYXRlQnV0dG9uUHNldWRvKCBpICk7Cn0KCi8vIEVhc3kgQVBJIGZvciBjcmVhdGluZyBuZXcgc2V0RmlsdGVycwpmdW5jdGlvbiBzZXRGaWx0ZXJzKCkge30Kc2V0RmlsdGVycy5wcm90b3R5cGUgPSBFeHByLmZpbHRlcnMgPSBFeHByLnBzZXVkb3M7CkV4cHIuc2V0RmlsdGVycyA9IG5ldyBzZXRGaWx0ZXJzKCk7Cgp0b2tlbml6ZSA9IFNpenpsZS50b2tlbml6ZSA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgcGFyc2VPbmx5ICkgewoJdmFyIG1hdGNoZWQsIG1hdGNoLCB0b2tlbnMsIHR5cGUsCgkJc29GYXIsIGdyb3VwcywgcHJlRmlsdGVycywKCQljYWNoZWQgPSB0b2tlbkNhY2hlWyBzZWxlY3RvciArICIgIiBdOwoKCWlmICggY2FjaGVkICkgewoJCXJldHVybiBwYXJzZU9ubHkgPyAwIDogY2FjaGVkLnNsaWNlKCAwICk7Cgl9CgoJc29GYXIgPSBzZWxlY3RvcjsKCWdyb3VwcyA9IFtdOwoJcHJlRmlsdGVycyA9IEV4cHIucHJlRmlsdGVyOwoKCXdoaWxlICggc29GYXIgKSB7CgoJCS8vIENvbW1hIGFuZCBmaXJzdCBydW4KCQlpZiAoICFtYXRjaGVkIHx8IChtYXRjaCA9IHJjb21tYS5leGVjKCBzb0ZhciApKSApIHsKCQkJaWYgKCBtYXRjaCApIHsKCQkJCS8vIERvbid0IGNvbnN1bWUgdHJhaWxpbmcgY29tbWFzIGFzIHZhbGlkCgkJCQlzb0ZhciA9IHNvRmFyLnNsaWNlKCBtYXRjaFswXS5sZW5ndGggKSB8fCBzb0ZhcjsKCQkJfQoJCQlncm91cHMucHVzaCggKHRva2VucyA9IFtdKSApOwoJCX0KCgkJbWF0Y2hlZCA9IGZhbHNlOwoKCQkvLyBDb21iaW5hdG9ycwoJCWlmICggKG1hdGNoID0gcmNvbWJpbmF0b3JzLmV4ZWMoIHNvRmFyICkpICkgewoJCQltYXRjaGVkID0gbWF0Y2guc2hpZnQoKTsKCQkJdG9rZW5zLnB1c2goewoJCQkJdmFsdWU6IG1hdGNoZWQsCgkJCQkvLyBDYXN0IGRlc2NlbmRhbnQgY29tYmluYXRvcnMgdG8gc3BhY2UKCQkJCXR5cGU6IG1hdGNoWzBdLnJlcGxhY2UoIHJ0cmltLCAiICIgKQoJCQl9KTsKCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTsKCQl9CgoJCS8vIEZpbHRlcnMKCQlmb3IgKCB0eXBlIGluIEV4cHIuZmlsdGVyICkgewoJCQlpZiAoIChtYXRjaCA9IG1hdGNoRXhwclsgdHlwZSBdLmV4ZWMoIHNvRmFyICkpICYmICghcHJlRmlsdGVyc1sgdHlwZSBdIHx8CgkJCQkobWF0Y2ggPSBwcmVGaWx0ZXJzWyB0eXBlIF0oIG1hdGNoICkpKSApIHsKCQkJCW1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpOwoJCQkJdG9rZW5zLnB1c2goewoJCQkJCXZhbHVlOiBtYXRjaGVkLAoJCQkJCXR5cGU6IHR5cGUsCgkJCQkJbWF0Y2hlczogbWF0Y2gKCQkJCX0pOwoJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTsKCQkJfQoJCX0KCgkJaWYgKCAhbWF0Y2hlZCApIHsKCQkJYnJlYWs7CgkJfQoJfQoKCS8vIFJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBpbnZhbGlkIGV4Y2VzcwoJLy8gaWYgd2UncmUganVzdCBwYXJzaW5nCgkvLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yIG9yIHJldHVybiB0b2tlbnMKCXJldHVybiBwYXJzZU9ubHkgPwoJCXNvRmFyLmxlbmd0aCA6CgkJc29GYXIgPwoJCQlTaXp6bGUuZXJyb3IoIHNlbGVjdG9yICkgOgoJCQkvLyBDYWNoZSB0aGUgdG9rZW5zCgkJCXRva2VuQ2FjaGUoIHNlbGVjdG9yLCBncm91cHMgKS5zbGljZSggMCApOwp9OwoKZnVuY3Rpb24gdG9TZWxlY3RvciggdG9rZW5zICkgewoJdmFyIGkgPSAwLAoJCWxlbiA9IHRva2Vucy5sZW5ndGgsCgkJc2VsZWN0b3IgPSAiIjsKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCXNlbGVjdG9yICs9IHRva2Vuc1tpXS52YWx1ZTsKCX0KCXJldHVybiBzZWxlY3RvcjsKfQoKZnVuY3Rpb24gYWRkQ29tYmluYXRvciggbWF0Y2hlciwgY29tYmluYXRvciwgYmFzZSApIHsKCXZhciBkaXIgPSBjb21iaW5hdG9yLmRpciwKCQljaGVja05vbkVsZW1lbnRzID0gYmFzZSAmJiBkaXIgPT09ICJwYXJlbnROb2RlIiwKCQlkb25lTmFtZSA9IGRvbmUrKzsKCglyZXR1cm4gY29tYmluYXRvci5maXJzdCA/CgkJLy8gQ2hlY2sgYWdhaW5zdCBjbG9zZXN0IGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50CgkJZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsKCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzICkgewoJCQkJCXJldHVybiBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKTsKCQkJCX0KCQkJfQoJCX0gOgoKCQkvLyBDaGVjayBhZ2FpbnN0IGFsbCBhbmNlc3Rvci9wcmVjZWRpbmcgZWxlbWVudHMKCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQl2YXIgb2xkQ2FjaGUsIHVuaXF1ZUNhY2hlLCBvdXRlckNhY2hlLAoJCQkJbmV3Q2FjaGUgPSBbIGRpcnJ1bnMsIGRvbmVOYW1lIF07CgoJCQkvLyBXZSBjYW4ndCBzZXQgYXJiaXRyYXJ5IGRhdGEgb24gWE1MIG5vZGVzLCBzbyB0aGV5IGRvbid0IGJlbmVmaXQgZnJvbSBjb21iaW5hdG9yIGNhY2hpbmcKCQkJaWYgKCB4bWwgKSB7CgkJCQl3aGlsZSAoIChlbGVtID0gZWxlbVsgZGlyIF0pICkgewoJCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzICkgewoJCQkJCQlpZiAoIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApICkgewoJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQl3aGlsZSAoIChlbGVtID0gZWxlbVsgZGlyIF0pICkgewoJCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzICkgewoJCQkJCQlvdXRlckNhY2hlID0gZWxlbVsgZXhwYW5kbyBdIHx8IChlbGVtWyBleHBhbmRvIF0gPSB7fSk7CgoJCQkJCQkvLyBTdXBwb3J0OiBJRSA8OSBvbmx5CgkJCQkJCS8vIERlZmVuZCBhZ2FpbnN0IGNsb25lZCBhdHRyb3BlcnRpZXMgKGpRdWVyeSBnaC0xNzA5KQoJCQkJCQl1bmlxdWVDYWNoZSA9IG91dGVyQ2FjaGVbIGVsZW0udW5pcXVlSUQgXSB8fCAob3V0ZXJDYWNoZVsgZWxlbS51bmlxdWVJRCBdID0ge30pOwoKCQkJCQkJaWYgKCAob2xkQ2FjaGUgPSB1bmlxdWVDYWNoZVsgZGlyIF0pICYmCgkJCQkJCQlvbGRDYWNoZVsgMCBdID09PSBkaXJydW5zICYmIG9sZENhY2hlWyAxIF0gPT09IGRvbmVOYW1lICkgewoKCQkJCQkJCS8vIEFzc2lnbiB0byBuZXdDYWNoZSBzbyByZXN1bHRzIGJhY2stcHJvcGFnYXRlIHRvIHByZXZpb3VzIGVsZW1lbnRzCgkJCQkJCQlyZXR1cm4gKG5ld0NhY2hlWyAyIF0gPSBvbGRDYWNoZVsgMiBdKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCS8vIFJldXNlIG5ld2NhY2hlIHNvIHJlc3VsdHMgYmFjay1wcm9wYWdhdGUgdG8gcHJldmlvdXMgZWxlbWVudHMKCQkJCQkJCXVuaXF1ZUNhY2hlWyBkaXIgXSA9IG5ld0NhY2hlOwoKCQkJCQkJCS8vIEEgbWF0Y2ggbWVhbnMgd2UncmUgZG9uZTsgYSBmYWlsIG1lYW5zIHdlIGhhdmUgdG8ga2VlcCBjaGVja2luZwoJCQkJCQkJaWYgKCAobmV3Q2FjaGVbIDIgXSA9IG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApKSApIHsKCQkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX07Cn0KCmZ1bmN0aW9uIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApIHsKCXJldHVybiBtYXRjaGVycy5sZW5ndGggPiAxID8KCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQl2YXIgaSA9IG1hdGNoZXJzLmxlbmd0aDsKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQlpZiAoICFtYXRjaGVyc1tpXSggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJCXJldHVybiB0cnVlOwoJCX0gOgoJCW1hdGNoZXJzWzBdOwp9CgpmdW5jdGlvbiBtdWx0aXBsZUNvbnRleHRzKCBzZWxlY3RvciwgY29udGV4dHMsIHJlc3VsdHMgKSB7Cgl2YXIgaSA9IDAsCgkJbGVuID0gY29udGV4dHMubGVuZ3RoOwoJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJU2l6emxlKCBzZWxlY3RvciwgY29udGV4dHNbaV0sIHJlc3VsdHMgKTsKCX0KCXJldHVybiByZXN1bHRzOwp9CgpmdW5jdGlvbiBjb25kZW5zZSggdW5tYXRjaGVkLCBtYXAsIGZpbHRlciwgY29udGV4dCwgeG1sICkgewoJdmFyIGVsZW0sCgkJbmV3VW5tYXRjaGVkID0gW10sCgkJaSA9IDAsCgkJbGVuID0gdW5tYXRjaGVkLmxlbmd0aCwKCQltYXBwZWQgPSBtYXAgIT0gbnVsbDsKCglmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQlpZiAoIChlbGVtID0gdW5tYXRjaGVkW2ldKSApIHsKCQkJaWYgKCAhZmlsdGVyIHx8IGZpbHRlciggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7CgkJCQluZXdVbm1hdGNoZWQucHVzaCggZWxlbSApOwoJCQkJaWYgKCBtYXBwZWQgKSB7CgkJCQkJbWFwLnB1c2goIGkgKTsKCQkJCX0KCQkJfQoJCX0KCX0KCglyZXR1cm4gbmV3VW5tYXRjaGVkOwp9CgpmdW5jdGlvbiBzZXRNYXRjaGVyKCBwcmVGaWx0ZXIsIHNlbGVjdG9yLCBtYXRjaGVyLCBwb3N0RmlsdGVyLCBwb3N0RmluZGVyLCBwb3N0U2VsZWN0b3IgKSB7CglpZiAoIHBvc3RGaWx0ZXIgJiYgIXBvc3RGaWx0ZXJbIGV4cGFuZG8gXSApIHsKCQlwb3N0RmlsdGVyID0gc2V0TWF0Y2hlciggcG9zdEZpbHRlciApOwoJfQoJaWYgKCBwb3N0RmluZGVyICYmICFwb3N0RmluZGVyWyBleHBhbmRvIF0gKSB7CgkJcG9zdEZpbmRlciA9IHNldE1hdGNoZXIoIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvciApOwoJfQoJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgcmVzdWx0cywgY29udGV4dCwgeG1sICkgewoJCXZhciB0ZW1wLCBpLCBlbGVtLAoJCQlwcmVNYXAgPSBbXSwKCQkJcG9zdE1hcCA9IFtdLAoJCQlwcmVleGlzdGluZyA9IHJlc3VsdHMubGVuZ3RoLAoKCQkJLy8gR2V0IGluaXRpYWwgZWxlbWVudHMgZnJvbSBzZWVkIG9yIGNvbnRleHQKCQkJZWxlbXMgPSBzZWVkIHx8IG11bHRpcGxlQ29udGV4dHMoIHNlbGVjdG9yIHx8ICIqIiwgY29udGV4dC5ub2RlVHlwZSA/IFsgY29udGV4dCBdIDogY29udGV4dCwgW10gKSwKCgkJCS8vIFByZWZpbHRlciB0byBnZXQgbWF0Y2hlciBpbnB1dCwgcHJlc2VydmluZyBhIG1hcCBmb3Igc2VlZC1yZXN1bHRzIHN5bmNocm9uaXphdGlvbgoJCQltYXRjaGVySW4gPSBwcmVGaWx0ZXIgJiYgKCBzZWVkIHx8ICFzZWxlY3RvciApID8KCQkJCWNvbmRlbnNlKCBlbGVtcywgcHJlTWFwLCBwcmVGaWx0ZXIsIGNvbnRleHQsIHhtbCApIDoKCQkJCWVsZW1zLAoKCQkJbWF0Y2hlck91dCA9IG1hdGNoZXIgPwoJCQkJLy8gSWYgd2UgaGF2ZSBhIHBvc3RGaW5kZXIsIG9yIGZpbHRlcmVkIHNlZWQsIG9yIG5vbi1zZWVkIHBvc3RGaWx0ZXIgb3IgcHJlZXhpc3RpbmcgcmVzdWx0cywKCQkJCXBvc3RGaW5kZXIgfHwgKCBzZWVkID8gcHJlRmlsdGVyIDogcHJlZXhpc3RpbmcgfHwgcG9zdEZpbHRlciApID8KCgkJCQkJLy8gLi4uaW50ZXJtZWRpYXRlIHByb2Nlc3NpbmcgaXMgbmVjZXNzYXJ5CgkJCQkJW10gOgoKCQkJCQkvLyAuLi5vdGhlcndpc2UgdXNlIHJlc3VsdHMgZGlyZWN0bHkKCQkJCQlyZXN1bHRzIDoKCQkJCW1hdGNoZXJJbjsKCgkJLy8gRmluZCBwcmltYXJ5IG1hdGNoZXMKCQlpZiAoIG1hdGNoZXIgKSB7CgkJCW1hdGNoZXIoIG1hdGNoZXJJbiwgbWF0Y2hlck91dCwgY29udGV4dCwgeG1sICk7CgkJfQoKCQkvLyBBcHBseSBwb3N0RmlsdGVyCgkJaWYgKCBwb3N0RmlsdGVyICkgewoJCQl0ZW1wID0gY29uZGVuc2UoIG1hdGNoZXJPdXQsIHBvc3RNYXAgKTsKCQkJcG9zdEZpbHRlciggdGVtcCwgW10sIGNvbnRleHQsIHhtbCApOwoKCQkJLy8gVW4tbWF0Y2ggZmFpbGluZyBlbGVtZW50cyBieSBtb3ZpbmcgdGhlbSBiYWNrIHRvIG1hdGNoZXJJbgoJCQlpID0gdGVtcC5sZW5ndGg7CgkJCXdoaWxlICggaS0tICkgewoJCQkJaWYgKCAoZWxlbSA9IHRlbXBbaV0pICkgewoJCQkJCW1hdGNoZXJPdXRbIHBvc3RNYXBbaV0gXSA9ICEobWF0Y2hlckluWyBwb3N0TWFwW2ldIF0gPSBlbGVtKTsKCQkJCX0KCQkJfQoJCX0KCgkJaWYgKCBzZWVkICkgewoJCQlpZiAoIHBvc3RGaW5kZXIgfHwgcHJlRmlsdGVyICkgewoJCQkJaWYgKCBwb3N0RmluZGVyICkgewoJCQkJCS8vIEdldCB0aGUgZmluYWwgbWF0Y2hlck91dCBieSBjb25kZW5zaW5nIHRoaXMgaW50ZXJtZWRpYXRlIGludG8gcG9zdEZpbmRlciBjb250ZXh0cwoJCQkJCXRlbXAgPSBbXTsKCQkJCQlpID0gbWF0Y2hlck91dC5sZW5ndGg7CgkJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJCWlmICggKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSApIHsKCQkJCQkJCS8vIFJlc3RvcmUgbWF0Y2hlckluIHNpbmNlIGVsZW0gaXMgbm90IHlldCBhIGZpbmFsIG1hdGNoCgkJCQkJCQl0ZW1wLnB1c2goIChtYXRjaGVySW5baV0gPSBlbGVtKSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXBvc3RGaW5kZXIoIG51bGwsIChtYXRjaGVyT3V0ID0gW10pLCB0ZW1wLCB4bWwgKTsKCQkJCX0KCgkJCQkvLyBNb3ZlIG1hdGNoZWQgZWxlbWVudHMgZnJvbSBzZWVkIHRvIHJlc3VsdHMgdG8ga2VlcCB0aGVtIHN5bmNocm9uaXplZAoJCQkJaSA9IG1hdGNoZXJPdXQubGVuZ3RoOwoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJaWYgKCAoZWxlbSA9IG1hdGNoZXJPdXRbaV0pICYmCgkJCQkJCSh0ZW1wID0gcG9zdEZpbmRlciA/IGluZGV4T2YoIHNlZWQsIGVsZW0gKSA6IHByZU1hcFtpXSkgPiAtMSApIHsKCgkJCQkJCXNlZWRbdGVtcF0gPSAhKHJlc3VsdHNbdGVtcF0gPSBlbGVtKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJLy8gQWRkIGVsZW1lbnRzIHRvIHJlc3VsdHMsIHRocm91Z2ggcG9zdEZpbmRlciBpZiBkZWZpbmVkCgkJfSBlbHNlIHsKCQkJbWF0Y2hlck91dCA9IGNvbmRlbnNlKAoJCQkJbWF0Y2hlck91dCA9PT0gcmVzdWx0cyA/CgkJCQkJbWF0Y2hlck91dC5zcGxpY2UoIHByZWV4aXN0aW5nLCBtYXRjaGVyT3V0Lmxlbmd0aCApIDoKCQkJCQltYXRjaGVyT3V0CgkJCSk7CgkJCWlmICggcG9zdEZpbmRlciApIHsKCQkJCXBvc3RGaW5kZXIoIG51bGwsIHJlc3VsdHMsIG1hdGNoZXJPdXQsIHhtbCApOwoJCQl9IGVsc2UgewoJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgbWF0Y2hlck91dCApOwoJCQl9CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIG1hdGNoZXJGcm9tVG9rZW5zKCB0b2tlbnMgKSB7Cgl2YXIgY2hlY2tDb250ZXh0LCBtYXRjaGVyLCBqLAoJCWxlbiA9IHRva2Vucy5sZW5ndGgsCgkJbGVhZGluZ1JlbGF0aXZlID0gRXhwci5yZWxhdGl2ZVsgdG9rZW5zWzBdLnR5cGUgXSwKCQlpbXBsaWNpdFJlbGF0aXZlID0gbGVhZGluZ1JlbGF0aXZlIHx8IEV4cHIucmVsYXRpdmVbIiAiXSwKCQlpID0gbGVhZGluZ1JlbGF0aXZlID8gMSA6IDAsCgoJCS8vIFRoZSBmb3VuZGF0aW9uYWwgbWF0Y2hlciBlbnN1cmVzIHRoYXQgZWxlbWVudHMgYXJlIHJlYWNoYWJsZSBmcm9tIHRvcC1sZXZlbCBjb250ZXh0KHMpCgkJbWF0Y2hDb250ZXh0ID0gYWRkQ29tYmluYXRvciggZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtID09PSBjaGVja0NvbnRleHQ7CgkJfSwgaW1wbGljaXRSZWxhdGl2ZSwgdHJ1ZSApLAoJCW1hdGNoQW55Q29udGV4dCA9IGFkZENvbWJpbmF0b3IoIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gaW5kZXhPZiggY2hlY2tDb250ZXh0LCBlbGVtICkgPiAtMTsKCQl9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlICksCgkJbWF0Y2hlcnMgPSBbIGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXZhciByZXQgPSAoICFsZWFkaW5nUmVsYXRpdmUgJiYgKCB4bWwgfHwgY29udGV4dCAhPT0gb3V0ZXJtb3N0Q29udGV4dCApICkgfHwgKAoJCQkJKGNoZWNrQ29udGV4dCA9IGNvbnRleHQpLm5vZGVUeXBlID8KCQkJCQltYXRjaENvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApIDoKCQkJCQltYXRjaEFueUNvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApICk7CgkJCS8vIEF2b2lkIGhhbmdpbmcgb250byBlbGVtZW50IChpc3N1ZSAjMjk5KQoJCQljaGVja0NvbnRleHQgPSBudWxsOwoJCQlyZXR1cm4gcmV0OwoJCX0gXTsKCglmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQlpZiAoIChtYXRjaGVyID0gRXhwci5yZWxhdGl2ZVsgdG9rZW5zW2ldLnR5cGUgXSkgKSB7CgkJCW1hdGNoZXJzID0gWyBhZGRDb21iaW5hdG9yKGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApLCBtYXRjaGVyKSBdOwoJCX0gZWxzZSB7CgkJCW1hdGNoZXIgPSBFeHByLmZpbHRlclsgdG9rZW5zW2ldLnR5cGUgXS5hcHBseSggbnVsbCwgdG9rZW5zW2ldLm1hdGNoZXMgKTsKCgkJCS8vIFJldHVybiBzcGVjaWFsIHVwb24gc2VlaW5nIGEgcG9zaXRpb25hbCBtYXRjaGVyCgkJCWlmICggbWF0Y2hlclsgZXhwYW5kbyBdICkgewoJCQkJLy8gRmluZCB0aGUgbmV4dCByZWxhdGl2ZSBvcGVyYXRvciAoaWYgYW55KSBmb3IgcHJvcGVyIGhhbmRsaW5nCgkJCQlqID0gKytpOwoJCQkJZm9yICggOyBqIDwgbGVuOyBqKysgKSB7CgkJCQkJaWYgKCBFeHByLnJlbGF0aXZlWyB0b2tlbnNbal0udHlwZSBdICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gc2V0TWF0Y2hlcigKCQkJCQlpID4gMSAmJiBlbGVtZW50TWF0Y2hlciggbWF0Y2hlcnMgKSwKCQkJCQlpID4gMSAmJiB0b1NlbGVjdG9yKAoJCQkJCQkvLyBJZiB0aGUgcHJlY2VkaW5nIHRva2VuIHdhcyBhIGRlc2NlbmRhbnQgY29tYmluYXRvciwgaW5zZXJ0IGFuIGltcGxpY2l0IGFueS1lbGVtZW50IGAqYAoJCQkJCQl0b2tlbnMuc2xpY2UoIDAsIGkgLSAxICkuY29uY2F0KHsgdmFsdWU6IHRva2Vuc1sgaSAtIDIgXS50eXBlID09PSAiICIgPyAiKiIgOiAiIiB9KQoJCQkJCSkucmVwbGFjZSggcnRyaW0sICIkMSIgKSwKCQkJCQltYXRjaGVyLAoJCQkJCWkgPCBqICYmIG1hdGNoZXJGcm9tVG9rZW5zKCB0b2tlbnMuc2xpY2UoIGksIGogKSApLAoJCQkJCWogPCBsZW4gJiYgbWF0Y2hlckZyb21Ub2tlbnMoICh0b2tlbnMgPSB0b2tlbnMuc2xpY2UoIGogKSkgKSwKCQkJCQlqIDwgbGVuICYmIHRvU2VsZWN0b3IoIHRva2VucyApCgkJCQkpOwoJCQl9CgkJCW1hdGNoZXJzLnB1c2goIG1hdGNoZXIgKTsKCQl9Cgl9CgoJcmV0dXJuIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApOwp9CgpmdW5jdGlvbiBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoIGVsZW1lbnRNYXRjaGVycywgc2V0TWF0Y2hlcnMgKSB7Cgl2YXIgYnlTZXQgPSBzZXRNYXRjaGVycy5sZW5ndGggPiAwLAoJCWJ5RWxlbWVudCA9IGVsZW1lbnRNYXRjaGVycy5sZW5ndGggPiAwLAoJCXN1cGVyTWF0Y2hlciA9IGZ1bmN0aW9uKCBzZWVkLCBjb250ZXh0LCB4bWwsIHJlc3VsdHMsIG91dGVybW9zdCApIHsKCQkJdmFyIGVsZW0sIGosIG1hdGNoZXIsCgkJCQltYXRjaGVkQ291bnQgPSAwLAoJCQkJaSA9ICIwIiwKCQkJCXVubWF0Y2hlZCA9IHNlZWQgJiYgW10sCgkJCQlzZXRNYXRjaGVkID0gW10sCgkJCQljb250ZXh0QmFja3VwID0gb3V0ZXJtb3N0Q29udGV4dCwKCQkJCS8vIFdlIG11c3QgYWx3YXlzIGhhdmUgZWl0aGVyIHNlZWQgZWxlbWVudHMgb3Igb3V0ZXJtb3N0IGNvbnRleHQKCQkJCWVsZW1zID0gc2VlZCB8fCBieUVsZW1lbnQgJiYgRXhwci5maW5kWyJUQUciXSggIioiLCBvdXRlcm1vc3QgKSwKCQkJCS8vIFVzZSBpbnRlZ2VyIGRpcnJ1bnMgaWZmIHRoaXMgaXMgdGhlIG91dGVybW9zdCBtYXRjaGVyCgkJCQlkaXJydW5zVW5pcXVlID0gKGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xKSwKCQkJCWxlbiA9IGVsZW1zLmxlbmd0aDsKCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJb3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHQgPT09IGRvY3VtZW50IHx8IGNvbnRleHQgfHwgb3V0ZXJtb3N0OwoJCQl9CgoJCQkvLyBBZGQgZWxlbWVudHMgcGFzc2luZyBlbGVtZW50TWF0Y2hlcnMgZGlyZWN0bHkgdG8gcmVzdWx0cwoJCQkvLyBTdXBwb3J0OiBJRTw5LCBTYWZhcmkKCQkJLy8gVG9sZXJhdGUgTm9kZUxpc3QgcHJvcGVydGllcyAoSUU6ICJsZW5ndGgiOyBTYWZhcmk6IDxudW1iZXI+KSBtYXRjaGluZyBlbGVtZW50cyBieSBpZAoJCQlmb3IgKCA7IGkgIT09IGxlbiAmJiAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgkJCQlpZiAoIGJ5RWxlbWVudCAmJiBlbGVtICkgewoJCQkJCWogPSAwOwoJCQkJCWlmICggIWNvbnRleHQgJiYgZWxlbS5vd25lckRvY3VtZW50ICE9PSBkb2N1bWVudCApIHsKCQkJCQkJc2V0RG9jdW1lbnQoIGVsZW0gKTsKCQkJCQkJeG1sID0gIWRvY3VtZW50SXNIVE1MOwoJCQkJCX0KCQkJCQl3aGlsZSAoIChtYXRjaGVyID0gZWxlbWVudE1hdGNoZXJzW2orK10pICkgewoJCQkJCQlpZiAoIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQgfHwgZG9jdW1lbnQsIHhtbCkgKSB7CgkJCQkJCQlyZXN1bHRzLnB1c2goIGVsZW0gKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJCQlkaXJydW5zID0gZGlycnVuc1VuaXF1ZTsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gVHJhY2sgdW5tYXRjaGVkIGVsZW1lbnRzIGZvciBzZXQgZmlsdGVycwoJCQkJaWYgKCBieVNldCApIHsKCQkJCQkvLyBUaGV5IHdpbGwgaGF2ZSBnb25lIHRocm91Z2ggYWxsIHBvc3NpYmxlIG1hdGNoZXJzCgkJCQkJaWYgKCAoZWxlbSA9ICFtYXRjaGVyICYmIGVsZW0pICkgewoJCQkJCQltYXRjaGVkQ291bnQtLTsKCQkJCQl9CgoJCQkJCS8vIExlbmd0aGVuIHRoZSBhcnJheSBmb3IgZXZlcnkgZWxlbWVudCwgbWF0Y2hlZCBvciBub3QKCQkJCQlpZiAoIHNlZWQgKSB7CgkJCQkJCXVubWF0Y2hlZC5wdXNoKCBlbGVtICk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQkvLyBgaWAgaXMgbm93IHRoZSBjb3VudCBvZiBlbGVtZW50cyB2aXNpdGVkIGFib3ZlLCBhbmQgYWRkaW5nIGl0IHRvIGBtYXRjaGVkQ291bnRgCgkJCS8vIG1ha2VzIHRoZSBsYXR0ZXIgbm9ubmVnYXRpdmUuCgkJCW1hdGNoZWRDb3VudCArPSBpOwoKCQkJLy8gQXBwbHkgc2V0IGZpbHRlcnMgdG8gdW5tYXRjaGVkIGVsZW1lbnRzCgkJCS8vIE5PVEU6IFRoaXMgY2FuIGJlIHNraXBwZWQgaWYgdGhlcmUgYXJlIG5vIHVubWF0Y2hlZCBlbGVtZW50cyAoaS5lLiwgYG1hdGNoZWRDb3VudGAKCQkJLy8gZXF1YWxzIGBpYCksIHVubGVzcyB3ZSBkaWRuJ3QgdmlzaXQgX2FueV8gZWxlbWVudHMgaW4gdGhlIGFib3ZlIGxvb3AgYmVjYXVzZSB3ZSBoYXZlCgkJCS8vIG5vIGVsZW1lbnQgbWF0Y2hlcnMgYW5kIG5vIHNlZWQuCgkJCS8vIEluY3JlbWVudGluZyBhbiBpbml0aWFsbHktc3RyaW5nICIwIiBgaWAgYWxsb3dzIGBpYCB0byByZW1haW4gYSBzdHJpbmcgb25seSBpbiB0aGF0CgkJCS8vIGNhc2UsIHdoaWNoIHdpbGwgcmVzdWx0IGluIGEgIjAwIiBgbWF0Y2hlZENvdW50YCB0aGF0IGRpZmZlcnMgZnJvbSBgaWAgYnV0IGlzIGFsc28KCQkJLy8gbnVtZXJpY2FsbHkgemVyby4KCQkJaWYgKCBieVNldCAmJiBpICE9PSBtYXRjaGVkQ291bnQgKSB7CgkJCQlqID0gMDsKCQkJCXdoaWxlICggKG1hdGNoZXIgPSBzZXRNYXRjaGVyc1tqKytdKSApIHsKCQkJCQltYXRjaGVyKCB1bm1hdGNoZWQsIHNldE1hdGNoZWQsIGNvbnRleHQsIHhtbCApOwoJCQkJfQoKCQkJCWlmICggc2VlZCApIHsKCQkJCQkvLyBSZWludGVncmF0ZSBlbGVtZW50IG1hdGNoZXMgdG8gZWxpbWluYXRlIHRoZSBuZWVkIGZvciBzb3J0aW5nCgkJCQkJaWYgKCBtYXRjaGVkQ291bnQgPiAwICkgewoJCQkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQkJCWlmICggISh1bm1hdGNoZWRbaV0gfHwgc2V0TWF0Y2hlZFtpXSkgKSB7CgkJCQkJCQkJc2V0TWF0Y2hlZFtpXSA9IHBvcC5jYWxsKCByZXN1bHRzICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIERpc2NhcmQgaW5kZXggcGxhY2Vob2xkZXIgdmFsdWVzIHRvIGdldCBvbmx5IGFjdHVhbCBtYXRjaGVzCgkJCQkJc2V0TWF0Y2hlZCA9IGNvbmRlbnNlKCBzZXRNYXRjaGVkICk7CgkJCQl9CgoJCQkJLy8gQWRkIG1hdGNoZXMgdG8gcmVzdWx0cwoJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgc2V0TWF0Y2hlZCApOwoKCQkJCS8vIFNlZWRsZXNzIHNldCBtYXRjaGVzIHN1Y2NlZWRpbmcgbXVsdGlwbGUgc3VjY2Vzc2Z1bCBtYXRjaGVycyBzdGlwdWxhdGUgc29ydGluZwoJCQkJaWYgKCBvdXRlcm1vc3QgJiYgIXNlZWQgJiYgc2V0TWF0Y2hlZC5sZW5ndGggPiAwICYmCgkJCQkJKCBtYXRjaGVkQ291bnQgKyBzZXRNYXRjaGVycy5sZW5ndGggKSA+IDEgKSB7CgoJCQkJCVNpenpsZS51bmlxdWVTb3J0KCByZXN1bHRzICk7CgkJCQl9CgkJCX0KCgkJCS8vIE92ZXJyaWRlIG1hbmlwdWxhdGlvbiBvZiBnbG9iYWxzIGJ5IG5lc3RlZCBtYXRjaGVycwoJCQlpZiAoIG91dGVybW9zdCApIHsKCQkJCWRpcnJ1bnMgPSBkaXJydW5zVW5pcXVlOwoJCQkJb3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHRCYWNrdXA7CgkJCX0KCgkJCXJldHVybiB1bm1hdGNoZWQ7CgkJfTsKCglyZXR1cm4gYnlTZXQgPwoJCW1hcmtGdW5jdGlvbiggc3VwZXJNYXRjaGVyICkgOgoJCXN1cGVyTWF0Y2hlcjsKfQoKY29tcGlsZSA9IFNpenpsZS5jb21waWxlID0gZnVuY3Rpb24oIHNlbGVjdG9yLCBtYXRjaCAvKiBJbnRlcm5hbCBVc2UgT25seSAqLyApIHsKCXZhciBpLAoJCXNldE1hdGNoZXJzID0gW10sCgkJZWxlbWVudE1hdGNoZXJzID0gW10sCgkJY2FjaGVkID0gY29tcGlsZXJDYWNoZVsgc2VsZWN0b3IgKyAiICIgXTsKCglpZiAoICFjYWNoZWQgKSB7CgkJLy8gR2VuZXJhdGUgYSBmdW5jdGlvbiBvZiByZWN1cnNpdmUgZnVuY3Rpb25zIHRoYXQgY2FuIGJlIHVzZWQgdG8gY2hlY2sgZWFjaCBlbGVtZW50CgkJaWYgKCAhbWF0Y2ggKSB7CgkJCW1hdGNoID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgkJfQoJCWkgPSBtYXRjaC5sZW5ndGg7CgkJd2hpbGUgKCBpLS0gKSB7CgkJCWNhY2hlZCA9IG1hdGNoZXJGcm9tVG9rZW5zKCBtYXRjaFtpXSApOwoJCQlpZiAoIGNhY2hlZFsgZXhwYW5kbyBdICkgewoJCQkJc2V0TWF0Y2hlcnMucHVzaCggY2FjaGVkICk7CgkJCX0gZWxzZSB7CgkJCQllbGVtZW50TWF0Y2hlcnMucHVzaCggY2FjaGVkICk7CgkJCX0KCQl9CgoJCS8vIENhY2hlIHRoZSBjb21waWxlZCBmdW5jdGlvbgoJCWNhY2hlZCA9IGNvbXBpbGVyQ2FjaGUoIHNlbGVjdG9yLCBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoIGVsZW1lbnRNYXRjaGVycywgc2V0TWF0Y2hlcnMgKSApOwoKCQkvLyBTYXZlIHNlbGVjdG9yIGFuZCB0b2tlbml6YXRpb24KCQljYWNoZWQuc2VsZWN0b3IgPSBzZWxlY3RvcjsKCX0KCXJldHVybiBjYWNoZWQ7Cn07CgovKioKICogQSBsb3ctbGV2ZWwgc2VsZWN0aW9uIGZ1bmN0aW9uIHRoYXQgd29ya3Mgd2l0aCBTaXp6bGUncyBjb21waWxlZAogKiAgc2VsZWN0b3IgZnVuY3Rpb25zCiAqIEBwYXJhbSB7U3RyaW5nfEZ1bmN0aW9ufSBzZWxlY3RvciBBIHNlbGVjdG9yIG9yIGEgcHJlLWNvbXBpbGVkCiAqICBzZWxlY3RvciBmdW5jdGlvbiBidWlsdCB3aXRoIFNpenpsZS5jb21waWxlCiAqIEBwYXJhbSB7RWxlbWVudH0gY29udGV4dAogKiBAcGFyYW0ge0FycmF5fSBbcmVzdWx0c10KICogQHBhcmFtIHtBcnJheX0gW3NlZWRdIEEgc2V0IG9mIGVsZW1lbnRzIHRvIG1hdGNoIGFnYWluc3QKICovCnNlbGVjdCA9IFNpenpsZS5zZWxlY3QgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQgKSB7Cgl2YXIgaSwgdG9rZW5zLCB0b2tlbiwgdHlwZSwgZmluZCwKCQljb21waWxlZCA9IHR5cGVvZiBzZWxlY3RvciA9PT0gImZ1bmN0aW9uIiAmJiBzZWxlY3RvciwKCQltYXRjaCA9ICFzZWVkICYmIHRva2VuaXplKCAoc2VsZWN0b3IgPSBjb21waWxlZC5zZWxlY3RvciB8fCBzZWxlY3RvcikgKTsKCglyZXN1bHRzID0gcmVzdWx0cyB8fCBbXTsKCgkvLyBUcnkgdG8gbWluaW1pemUgb3BlcmF0aW9ucyBpZiB0aGVyZSBpcyBvbmx5IG9uZSBzZWxlY3RvciBpbiB0aGUgbGlzdCBhbmQgbm8gc2VlZAoJLy8gKHRoZSBsYXR0ZXIgb2Ygd2hpY2ggZ3VhcmFudGVlcyB1cyBjb250ZXh0KQoJaWYgKCBtYXRjaC5sZW5ndGggPT09IDEgKSB7CgoJCS8vIFJlZHVjZSBjb250ZXh0IGlmIHRoZSBsZWFkaW5nIGNvbXBvdW5kIHNlbGVjdG9yIGlzIGFuIElECgkJdG9rZW5zID0gbWF0Y2hbMF0gPSBtYXRjaFswXS5zbGljZSggMCApOwoJCWlmICggdG9rZW5zLmxlbmd0aCA+IDIgJiYgKHRva2VuID0gdG9rZW5zWzBdKS50eXBlID09PSAiSUQiICYmCgkJCQlzdXBwb3J0LmdldEJ5SWQgJiYgY29udGV4dC5ub2RlVHlwZSA9PT0gOSAmJiBkb2N1bWVudElzSFRNTCAmJgoJCQkJRXhwci5yZWxhdGl2ZVsgdG9rZW5zWzFdLnR5cGUgXSApIHsKCgkJCWNvbnRleHQgPSAoIEV4cHIuZmluZFsiSUQiXSggdG9rZW4ubWF0Y2hlc1swXS5yZXBsYWNlKHJ1bmVzY2FwZSwgZnVuZXNjYXBlKSwgY29udGV4dCApIHx8IFtdIClbMF07CgkJCWlmICggIWNvbnRleHQgKSB7CgkJCQlyZXR1cm4gcmVzdWx0czsKCgkJCS8vIFByZWNvbXBpbGVkIG1hdGNoZXJzIHdpbGwgc3RpbGwgdmVyaWZ5IGFuY2VzdHJ5LCBzbyBzdGVwIHVwIGEgbGV2ZWwKCQkJfSBlbHNlIGlmICggY29tcGlsZWQgKSB7CgkJCQljb250ZXh0ID0gY29udGV4dC5wYXJlbnROb2RlOwoJCQl9CgoJCQlzZWxlY3RvciA9IHNlbGVjdG9yLnNsaWNlKCB0b2tlbnMuc2hpZnQoKS52YWx1ZS5sZW5ndGggKTsKCQl9CgoJCS8vIEZldGNoIGEgc2VlZCBzZXQgZm9yIHJpZ2h0LXRvLWxlZnQgbWF0Y2hpbmcKCQlpID0gbWF0Y2hFeHByWyJuZWVkc0NvbnRleHQiXS50ZXN0KCBzZWxlY3RvciApID8gMCA6IHRva2Vucy5sZW5ndGg7CgkJd2hpbGUgKCBpLS0gKSB7CgkJCXRva2VuID0gdG9rZW5zW2ldOwoKCQkJLy8gQWJvcnQgaWYgd2UgaGl0IGEgY29tYmluYXRvcgoJCQlpZiAoIEV4cHIucmVsYXRpdmVbICh0eXBlID0gdG9rZW4udHlwZSkgXSApIHsKCQkJCWJyZWFrOwoJCQl9CgkJCWlmICggKGZpbmQgPSBFeHByLmZpbmRbIHR5cGUgXSkgKSB7CgkJCQkvLyBTZWFyY2gsIGV4cGFuZGluZyBjb250ZXh0IGZvciBsZWFkaW5nIHNpYmxpbmcgY29tYmluYXRvcnMKCQkJCWlmICggKHNlZWQgPSBmaW5kKAoJCQkJCXRva2VuLm1hdGNoZXNbMF0ucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKSwKCQkJCQlyc2libGluZy50ZXN0KCB0b2tlbnNbMF0udHlwZSApICYmIHRlc3RDb250ZXh0KCBjb250ZXh0LnBhcmVudE5vZGUgKSB8fCBjb250ZXh0CgkJCQkpKSApIHsKCgkJCQkJLy8gSWYgc2VlZCBpcyBlbXB0eSBvciBubyB0b2tlbnMgcmVtYWluLCB3ZSBjYW4gcmV0dXJuIGVhcmx5CgkJCQkJdG9rZW5zLnNwbGljZSggaSwgMSApOwoJCQkJCXNlbGVjdG9yID0gc2VlZC5sZW5ndGggJiYgdG9TZWxlY3RvciggdG9rZW5zICk7CgkJCQkJaWYgKCAhc2VsZWN0b3IgKSB7CgkJCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsIHNlZWQgKTsKCQkJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCQkJfQoKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBDb21waWxlIGFuZCBleGVjdXRlIGEgZmlsdGVyaW5nIGZ1bmN0aW9uIGlmIG9uZSBpcyBub3QgcHJvdmlkZWQKCS8vIFByb3ZpZGUgYG1hdGNoYCB0byBhdm9pZCByZXRva2VuaXphdGlvbiBpZiB3ZSBtb2RpZmllZCB0aGUgc2VsZWN0b3IgYWJvdmUKCSggY29tcGlsZWQgfHwgY29tcGlsZSggc2VsZWN0b3IsIG1hdGNoICkgKSgKCQlzZWVkLAoJCWNvbnRleHQsCgkJIWRvY3VtZW50SXNIVE1MLAoJCXJlc3VsdHMsCgkJIWNvbnRleHQgfHwgcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKSAmJiB0ZXN0Q29udGV4dCggY29udGV4dC5wYXJlbnROb2RlICkgfHwgY29udGV4dAoJKTsKCXJldHVybiByZXN1bHRzOwp9OwoKLy8gT25lLXRpbWUgYXNzaWdubWVudHMKCi8vIFNvcnQgc3RhYmlsaXR5CnN1cHBvcnQuc29ydFN0YWJsZSA9IGV4cGFuZG8uc3BsaXQoIiIpLnNvcnQoIHNvcnRPcmRlciApLmpvaW4oIiIpID09PSBleHBhbmRvOwoKLy8gU3VwcG9ydDogQ2hyb21lIDE0LTM1KwovLyBBbHdheXMgYXNzdW1lIGR1cGxpY2F0ZXMgaWYgdGhleSBhcmVuJ3QgcGFzc2VkIHRvIHRoZSBjb21wYXJpc29uIGZ1bmN0aW9uCnN1cHBvcnQuZGV0ZWN0RHVwbGljYXRlcyA9ICEhaGFzRHVwbGljYXRlOwoKLy8gSW5pdGlhbGl6ZSBhZ2FpbnN0IHRoZSBkZWZhdWx0IGRvY3VtZW50CnNldERvY3VtZW50KCk7CgovLyBTdXBwb3J0OiBXZWJraXQ8NTM3LjMyIC0gU2FmYXJpIDYuMC4zL0Nocm9tZSAyNSAoZml4ZWQgaW4gQ2hyb21lIDI3KQovLyBEZXRhY2hlZCBub2RlcyBjb25mb3VuZGluZ2x5IGZvbGxvdyAqZWFjaCBvdGhlcioKc3VwcG9ydC5zb3J0RGV0YWNoZWQgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdjEgKSB7CgkvLyBTaG91bGQgcmV0dXJuIDEsIGJ1dCByZXR1cm5zIDQgKGZvbGxvd2luZykKCXJldHVybiBkaXYxLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSApICYgMTsKfSk7CgovLyBTdXBwb3J0OiBJRTw4Ci8vIFByZXZlbnQgYXR0cmlidXRlL3Byb3BlcnR5ICJpbnRlcnBvbGF0aW9uIgovLyBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvbXM1MzY0MjklMjhWUy44NSUyOS5hc3B4CmlmICggIWFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJZGl2LmlubmVySFRNTCA9ICI8YSBocmVmPScjJz48L2E+IjsKCXJldHVybiBkaXYuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoImhyZWYiKSA9PT0gIiMiIDsKfSkgKSB7CglhZGRIYW5kbGUoICJ0eXBlfGhyZWZ8aGVpZ2h0fHdpZHRoIiwgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGlzWE1MICkgewoJCWlmICggIWlzWE1MICkgewoJCQlyZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUsIG5hbWUudG9Mb3dlckNhc2UoKSA9PT0gInR5cGUiID8gMSA6IDIgKTsKCQl9Cgl9KTsKfQoKLy8gU3VwcG9ydDogSUU8OQovLyBVc2UgZGVmYXVsdFZhbHVlIGluIHBsYWNlIG9mIGdldEF0dHJpYnV0ZSgidmFsdWUiKQppZiAoICFzdXBwb3J0LmF0dHJpYnV0ZXMgfHwgIWFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJZGl2LmlubmVySFRNTCA9ICI8aW5wdXQvPiI7CglkaXYuZmlyc3RDaGlsZC5zZXRBdHRyaWJ1dGUoICJ2YWx1ZSIsICIiICk7CglyZXR1cm4gZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCAidmFsdWUiICkgPT09ICIiOwp9KSApIHsKCWFkZEhhbmRsZSggInZhbHVlIiwgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGlzWE1MICkgewoJCWlmICggIWlzWE1MICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IiApIHsKCQkJcmV0dXJuIGVsZW0uZGVmYXVsdFZhbHVlOwoJCX0KCX0pOwp9CgovLyBTdXBwb3J0OiBJRTw5Ci8vIFVzZSBnZXRBdHRyaWJ1dGVOb2RlIHRvIGZldGNoIGJvb2xlYW5zIHdoZW4gZ2V0QXR0cmlidXRlIGxpZXMKaWYgKCAhYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CglyZXR1cm4gZGl2LmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKSA9PSBudWxsOwp9KSApIHsKCWFkZEhhbmRsZSggYm9vbGVhbnMsIGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBpc1hNTCApIHsKCQl2YXIgdmFsOwoJCWlmICggIWlzWE1MICkgewoJCQlyZXR1cm4gZWxlbVsgbmFtZSBdID09PSB0cnVlID8gbmFtZS50b0xvd2VyQ2FzZSgpIDoKCQkJCQkodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICkpICYmIHZhbC5zcGVjaWZpZWQgPwoJCQkJCXZhbC52YWx1ZSA6CgkJCQludWxsOwoJCX0KCX0pOwp9CgpyZXR1cm4gU2l6emxlOwoKfSkoIHdpbmRvdyApOwoKCgpqUXVlcnkuZmluZCA9IFNpenpsZTsKalF1ZXJ5LmV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzOwpqUXVlcnkuZXhwclsgIjoiIF0gPSBqUXVlcnkuZXhwci5wc2V1ZG9zOwpqUXVlcnkudW5pcXVlU29ydCA9IGpRdWVyeS51bmlxdWUgPSBTaXp6bGUudW5pcXVlU29ydDsKalF1ZXJ5LnRleHQgPSBTaXp6bGUuZ2V0VGV4dDsKalF1ZXJ5LmlzWE1MRG9jID0gU2l6emxlLmlzWE1MOwpqUXVlcnkuY29udGFpbnMgPSBTaXp6bGUuY29udGFpbnM7CgoKCnZhciBkaXIgPSBmdW5jdGlvbiggZWxlbSwgZGlyLCB1bnRpbCApIHsKCXZhciBtYXRjaGVkID0gW10sCgkJdHJ1bmNhdGUgPSB1bnRpbCAhPT0gdW5kZWZpbmVkOwoKCXdoaWxlICggKCBlbGVtID0gZWxlbVsgZGlyIF0gKSAmJiBlbGVtLm5vZGVUeXBlICE9PSA5ICkgewoJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJaWYgKCB0cnVuY2F0ZSAmJiBqUXVlcnkoIGVsZW0gKS5pcyggdW50aWwgKSApIHsKCQkJCWJyZWFrOwoJCQl9CgkJCW1hdGNoZWQucHVzaCggZWxlbSApOwoJCX0KCX0KCXJldHVybiBtYXRjaGVkOwp9OwoKCnZhciBzaWJsaW5ncyA9IGZ1bmN0aW9uKCBuLCBlbGVtICkgewoJdmFyIG1hdGNoZWQgPSBbXTsKCglmb3IgKCA7IG47IG4gPSBuLm5leHRTaWJsaW5nICkgewoJCWlmICggbi5ub2RlVHlwZSA9PT0gMSAmJiBuICE9PSBlbGVtICkgewoJCQltYXRjaGVkLnB1c2goIG4gKTsKCQl9Cgl9CgoJcmV0dXJuIG1hdGNoZWQ7Cn07CgoKdmFyIHJuZWVkc0NvbnRleHQgPSBqUXVlcnkuZXhwci5tYXRjaC5uZWVkc0NvbnRleHQ7Cgp2YXIgcnNpbmdsZVRhZyA9ICggL148KFtcdy1dKylccypcLz8+KD86PFwvXDE+fCkkLyApOwoKCgp2YXIgcmlzU2ltcGxlID0gL14uW146I1xbXC4sXSokLzsKCi8vIEltcGxlbWVudCB0aGUgaWRlbnRpY2FsIGZ1bmN0aW9uYWxpdHkgZm9yIGZpbHRlciBhbmQgbm90CmZ1bmN0aW9uIHdpbm5vdyggZWxlbWVudHMsIHF1YWxpZmllciwgbm90ICkgewoJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggcXVhbGlmaWVyICkgKSB7CgkJcmV0dXJuIGpRdWVyeS5ncmVwKCBlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0sIGkgKSB7CgkJCS8qIGpzaGludCAtVzAxOCAqLwoJCQlyZXR1cm4gISFxdWFsaWZpZXIuY2FsbCggZWxlbSwgaSwgZWxlbSApICE9PSBub3Q7CgkJfSApOwoKCX0KCglpZiAoIHF1YWxpZmllci5ub2RlVHlwZSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoIGVsZW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuICggZWxlbSA9PT0gcXVhbGlmaWVyICkgIT09IG5vdDsKCQl9ICk7CgoJfQoKCWlmICggdHlwZW9mIHF1YWxpZmllciA9PT0gInN0cmluZyIgKSB7CgkJaWYgKCByaXNTaW1wbGUudGVzdCggcXVhbGlmaWVyICkgKSB7CgkJCXJldHVybiBqUXVlcnkuZmlsdGVyKCBxdWFsaWZpZXIsIGVsZW1lbnRzLCBub3QgKTsKCQl9CgoJCXF1YWxpZmllciA9IGpRdWVyeS5maWx0ZXIoIHF1YWxpZmllciwgZWxlbWVudHMgKTsKCX0KCglyZXR1cm4galF1ZXJ5LmdyZXAoIGVsZW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gKCBqUXVlcnkuaW5BcnJheSggZWxlbSwgcXVhbGlmaWVyICkgPiAtMSApICE9PSBub3Q7Cgl9ICk7Cn0KCmpRdWVyeS5maWx0ZXIgPSBmdW5jdGlvbiggZXhwciwgZWxlbXMsIG5vdCApIHsKCXZhciBlbGVtID0gZWxlbXNbIDAgXTsKCglpZiAoIG5vdCApIHsKCQlleHByID0gIjpub3QoIiArIGV4cHIgKyAiKSI7Cgl9CgoJcmV0dXJuIGVsZW1zLmxlbmd0aCA9PT0gMSAmJiBlbGVtLm5vZGVUeXBlID09PSAxID8KCQlqUXVlcnkuZmluZC5tYXRjaGVzU2VsZWN0b3IoIGVsZW0sIGV4cHIgKSA/IFsgZWxlbSBdIDogW10gOgoJCWpRdWVyeS5maW5kLm1hdGNoZXMoIGV4cHIsIGpRdWVyeS5ncmVwKCBlbGVtcywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtLm5vZGVUeXBlID09PSAxOwoJCX0gKSApOwp9OwoKalF1ZXJ5LmZuLmV4dGVuZCggewoJZmluZDogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXZhciBpLAoJCQlyZXQgPSBbXSwKCQkJc2VsZiA9IHRoaXMsCgkJCWxlbiA9IHNlbGYubGVuZ3RoOwoKCQlpZiAoIHR5cGVvZiBzZWxlY3RvciAhPT0gInN0cmluZyIgKSB7CgkJCXJldHVybiB0aGlzLnB1c2hTdGFjayggalF1ZXJ5KCBzZWxlY3RvciApLmZpbHRlciggZnVuY3Rpb24oKSB7CgkJCQlmb3IgKCBpID0gMDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCBzZWxmWyBpIF0sIHRoaXMgKSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9ICkgKTsKCQl9CgoJCWZvciAoIGkgPSAwOyBpIDwgbGVuOyBpKysgKSB7CgkJCWpRdWVyeS5maW5kKCBzZWxlY3Rvciwgc2VsZlsgaSBdLCByZXQgKTsKCQl9CgoJCS8vIE5lZWRlZCBiZWNhdXNlICQoIHNlbGVjdG9yLCBjb250ZXh0ICkgYmVjb21lcyAkKCBjb250ZXh0ICkuZmluZCggc2VsZWN0b3IgKQoJCXJldCA9IHRoaXMucHVzaFN0YWNrKCBsZW4gPiAxID8galF1ZXJ5LnVuaXF1ZSggcmV0ICkgOiByZXQgKTsKCQlyZXQuc2VsZWN0b3IgPSB0aGlzLnNlbGVjdG9yID8gdGhpcy5zZWxlY3RvciArICIgIiArIHNlbGVjdG9yIDogc2VsZWN0b3I7CgkJcmV0dXJuIHJldDsKCX0sCglmaWx0ZXI6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHdpbm5vdyggdGhpcywgc2VsZWN0b3IgfHwgW10sIGZhbHNlICkgKTsKCX0sCglub3Q6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHdpbm5vdyggdGhpcywgc2VsZWN0b3IgfHwgW10sIHRydWUgKSApOwoJfSwKCWlzOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuICEhd2lubm93KAoJCQl0aGlzLAoKCQkJLy8gSWYgdGhpcyBpcyBhIHBvc2l0aW9uYWwvcmVsYXRpdmUgc2VsZWN0b3IsIGNoZWNrIG1lbWJlcnNoaXAgaW4gdGhlIHJldHVybmVkIHNldAoJCQkvLyBzbyAkKCJwOmZpcnN0IikuaXMoInA6bGFzdCIpIHdvbid0IHJldHVybiB0cnVlIGZvciBhIGRvYyB3aXRoIHR3byAicCIuCgkJCXR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgJiYgcm5lZWRzQ29udGV4dC50ZXN0KCBzZWxlY3RvciApID8KCQkJCWpRdWVyeSggc2VsZWN0b3IgKSA6CgkJCQlzZWxlY3RvciB8fCBbXSwKCQkJZmFsc2UKCQkpLmxlbmd0aDsKCX0KfSApOwoKCi8vIEluaXRpYWxpemUgYSBqUXVlcnkgb2JqZWN0CgoKLy8gQSBjZW50cmFsIHJlZmVyZW5jZSB0byB0aGUgcm9vdCBqUXVlcnkoZG9jdW1lbnQpCnZhciByb290alF1ZXJ5LAoKCS8vIEEgc2ltcGxlIHdheSB0byBjaGVjayBmb3IgSFRNTCBzdHJpbmdzCgkvLyBQcmlvcml0aXplICNpZCBvdmVyIDx0YWc+IHRvIGF2b2lkIFhTUyB2aWEgbG9jYXRpb24uaGFzaCAoIzk1MjEpCgkvLyBTdHJpY3QgSFRNTCByZWNvZ25pdGlvbiAoIzExMjkwOiBtdXN0IHN0YXJ0IHdpdGggPCkKCXJxdWlja0V4cHIgPSAvXig/OlxzKig8W1x3XFddKz4pW14+XSp8IyhbXHctXSopKSQvLAoKCWluaXQgPSBqUXVlcnkuZm4uaW5pdCA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCwgcm9vdCApIHsKCQl2YXIgbWF0Y2gsIGVsZW07CgoJCS8vIEhBTkRMRTogJCgiIiksICQobnVsbCksICQodW5kZWZpbmVkKSwgJChmYWxzZSkKCQlpZiAoICFzZWxlY3RvciApIHsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQkvLyBpbml0IGFjY2VwdHMgYW4gYWx0ZXJuYXRlIHJvb3RqUXVlcnkKCQkvLyBzbyBtaWdyYXRlIGNhbiBzdXBwb3J0IGpRdWVyeS5zdWIgKGdoLTIxMDEpCgkJcm9vdCA9IHJvb3QgfHwgcm9vdGpRdWVyeTsKCgkJLy8gSGFuZGxlIEhUTUwgc3RyaW5ncwoJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJaWYgKCBzZWxlY3Rvci5jaGFyQXQoIDAgKSA9PT0gIjwiICYmCgkJCQlzZWxlY3Rvci5jaGFyQXQoIHNlbGVjdG9yLmxlbmd0aCAtIDEgKSA9PT0gIj4iICYmCgkJCQlzZWxlY3Rvci5sZW5ndGggPj0gMyApIHsKCgkJCQkvLyBBc3N1bWUgdGhhdCBzdHJpbmdzIHRoYXQgc3RhcnQgYW5kIGVuZCB3aXRoIDw+IGFyZSBIVE1MIGFuZCBza2lwIHRoZSByZWdleCBjaGVjawoJCQkJbWF0Y2ggPSBbIG51bGwsIHNlbGVjdG9yLCBudWxsIF07CgoJCQl9IGVsc2UgewoJCQkJbWF0Y2ggPSBycXVpY2tFeHByLmV4ZWMoIHNlbGVjdG9yICk7CgkJCX0KCgkJCS8vIE1hdGNoIGh0bWwgb3IgbWFrZSBzdXJlIG5vIGNvbnRleHQgaXMgc3BlY2lmaWVkIGZvciAjaWQKCQkJaWYgKCBtYXRjaCAmJiAoIG1hdGNoWyAxIF0gfHwgIWNvbnRleHQgKSApIHsKCgkJCQkvLyBIQU5ETEU6ICQoaHRtbCkgLT4gJChhcnJheSkKCQkJCWlmICggbWF0Y2hbIDEgXSApIHsKCQkJCQljb250ZXh0ID0gY29udGV4dCBpbnN0YW5jZW9mIGpRdWVyeSA/IGNvbnRleHRbIDAgXSA6IGNvbnRleHQ7CgoJCQkJCS8vIHNjcmlwdHMgaXMgdHJ1ZSBmb3IgYmFjay1jb21wYXQKCQkJCQkvLyBJbnRlbnRpb25hbGx5IGxldCB0aGUgZXJyb3IgYmUgdGhyb3duIGlmIHBhcnNlSFRNTCBpcyBub3QgcHJlc2VudAoJCQkJCWpRdWVyeS5tZXJnZSggdGhpcywgalF1ZXJ5LnBhcnNlSFRNTCgKCQkJCQkJbWF0Y2hbIDEgXSwKCQkJCQkJY29udGV4dCAmJiBjb250ZXh0Lm5vZGVUeXBlID8gY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgOiBkb2N1bWVudCwKCQkJCQkJdHJ1ZQoJCQkJCSkgKTsKCgkJCQkJLy8gSEFORExFOiAkKGh0bWwsIHByb3BzKQoJCQkJCWlmICggcnNpbmdsZVRhZy50ZXN0KCBtYXRjaFsgMSBdICkgJiYgalF1ZXJ5LmlzUGxhaW5PYmplY3QoIGNvbnRleHQgKSApIHsKCQkJCQkJZm9yICggbWF0Y2ggaW4gY29udGV4dCApIHsKCgkJCQkJCQkvLyBQcm9wZXJ0aWVzIG9mIGNvbnRleHQgYXJlIGNhbGxlZCBhcyBtZXRob2RzIGlmIHBvc3NpYmxlCgkJCQkJCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB0aGlzWyBtYXRjaCBdICkgKSB7CgkJCQkJCQkJdGhpc1sgbWF0Y2ggXSggY29udGV4dFsgbWF0Y2ggXSApOwoKCQkJCQkJCS8vIC4uLmFuZCBvdGhlcndpc2Ugc2V0IGFzIGF0dHJpYnV0ZXMKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJdGhpcy5hdHRyKCBtYXRjaCwgY29udGV4dFsgbWF0Y2ggXSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoKCQkJCQlyZXR1cm4gdGhpczsKCgkJCQkvLyBIQU5ETEU6ICQoI2lkKQoJCQkJfSBlbHNlIHsKCQkJCQllbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIG1hdGNoWyAyIF0gKTsKCgkJCQkJLy8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnMKCQkJCQkvLyBub2RlcyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIGRvY3VtZW50ICM2OTYzCgkJCQkJaWYgKCBlbGVtICYmIGVsZW0ucGFyZW50Tm9kZSApIHsKCgkJCQkJCS8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSBJRSBhbmQgT3BlcmEgcmV0dXJuIGl0ZW1zCgkJCQkJCS8vIGJ5IG5hbWUgaW5zdGVhZCBvZiBJRAoJCQkJCQlpZiAoIGVsZW0uaWQgIT09IG1hdGNoWyAyIF0gKSB7CgkJCQkJCQlyZXR1cm4gcm9vdGpRdWVyeS5maW5kKCBzZWxlY3RvciApOwoJCQkJCQl9CgoJCQkJCQkvLyBPdGhlcndpc2UsIHdlIGluamVjdCB0aGUgZWxlbWVudCBkaXJlY3RseSBpbnRvIHRoZSBqUXVlcnkgb2JqZWN0CgkJCQkJCXRoaXMubGVuZ3RoID0gMTsKCQkJCQkJdGhpc1sgMCBdID0gZWxlbTsKCQkJCQl9CgoJCQkJCXRoaXMuY29udGV4dCA9IGRvY3VtZW50OwoJCQkJCXRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0KCgkJCS8vIEhBTkRMRTogJChleHByLCAkKC4uLikpCgkJCX0gZWxzZSBpZiAoICFjb250ZXh0IHx8IGNvbnRleHQuanF1ZXJ5ICkgewoJCQkJcmV0dXJuICggY29udGV4dCB8fCByb290ICkuZmluZCggc2VsZWN0b3IgKTsKCgkJCS8vIEhBTkRMRTogJChleHByLCBjb250ZXh0KQoJCQkvLyAod2hpY2ggaXMganVzdCBlcXVpdmFsZW50IHRvOiAkKGNvbnRleHQpLmZpbmQoZXhwcikKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLmNvbnN0cnVjdG9yKCBjb250ZXh0ICkuZmluZCggc2VsZWN0b3IgKTsKCQkJfQoKCQkvLyBIQU5ETEU6ICQoRE9NRWxlbWVudCkKCQl9IGVsc2UgaWYgKCBzZWxlY3Rvci5ub2RlVHlwZSApIHsKCQkJdGhpcy5jb250ZXh0ID0gdGhpc1sgMCBdID0gc2VsZWN0b3I7CgkJCXRoaXMubGVuZ3RoID0gMTsKCQkJcmV0dXJuIHRoaXM7CgoJCS8vIEhBTkRMRTogJChmdW5jdGlvbikKCQkvLyBTaG9ydGN1dCBmb3IgZG9jdW1lbnQgcmVhZHkKCQl9IGVsc2UgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggc2VsZWN0b3IgKSApIHsKCQkJcmV0dXJuIHR5cGVvZiByb290LnJlYWR5ICE9PSAidW5kZWZpbmVkIiA/CgkJCQlyb290LnJlYWR5KCBzZWxlY3RvciApIDoKCgkJCQkvLyBFeGVjdXRlIGltbWVkaWF0ZWx5IGlmIHJlYWR5IGlzIG5vdCBwcmVzZW50CgkJCQlzZWxlY3RvciggalF1ZXJ5ICk7CgkJfQoKCQlpZiAoIHNlbGVjdG9yLnNlbGVjdG9yICE9PSB1bmRlZmluZWQgKSB7CgkJCXRoaXMuc2VsZWN0b3IgPSBzZWxlY3Rvci5zZWxlY3RvcjsKCQkJdGhpcy5jb250ZXh0ID0gc2VsZWN0b3IuY29udGV4dDsKCQl9CgoJCXJldHVybiBqUXVlcnkubWFrZUFycmF5KCBzZWxlY3RvciwgdGhpcyApOwoJfTsKCi8vIEdpdmUgdGhlIGluaXQgZnVuY3Rpb24gdGhlIGpRdWVyeSBwcm90b3R5cGUgZm9yIGxhdGVyIGluc3RhbnRpYXRpb24KaW5pdC5wcm90b3R5cGUgPSBqUXVlcnkuZm47CgovLyBJbml0aWFsaXplIGNlbnRyYWwgcmVmZXJlbmNlCnJvb3RqUXVlcnkgPSBqUXVlcnkoIGRvY3VtZW50ICk7CgoKdmFyIHJwYXJlbnRzcHJldiA9IC9eKD86cGFyZW50c3xwcmV2KD86VW50aWx8QWxsKSkvLAoKCS8vIG1ldGhvZHMgZ3VhcmFudGVlZCB0byBwcm9kdWNlIGEgdW5pcXVlIHNldCB3aGVuIHN0YXJ0aW5nIGZyb20gYSB1bmlxdWUgc2V0CglndWFyYW50ZWVkVW5pcXVlID0gewoJCWNoaWxkcmVuOiB0cnVlLAoJCWNvbnRlbnRzOiB0cnVlLAoJCW5leHQ6IHRydWUsCgkJcHJldjogdHJ1ZQoJfTsKCmpRdWVyeS5mbi5leHRlbmQoIHsKCWhhczogZnVuY3Rpb24oIHRhcmdldCApIHsKCQl2YXIgaSwKCQkJdGFyZ2V0cyA9IGpRdWVyeSggdGFyZ2V0LCB0aGlzICksCgkJCWxlbiA9IHRhcmdldHMubGVuZ3RoOwoKCQlyZXR1cm4gdGhpcy5maWx0ZXIoIGZ1bmN0aW9uKCkgewoJCQlmb3IgKCBpID0gMDsgaSA8IGxlbjsgaSsrICkgewoJCQkJaWYgKCBqUXVlcnkuY29udGFpbnMoIHRoaXMsIHRhcmdldHNbIGkgXSApICkgewoJCQkJCXJldHVybiB0cnVlOwoJCQkJfQoJCQl9CgkJfSApOwoJfSwKCgljbG9zZXN0OiBmdW5jdGlvbiggc2VsZWN0b3JzLCBjb250ZXh0ICkgewoJCXZhciBjdXIsCgkJCWkgPSAwLAoJCQlsID0gdGhpcy5sZW5ndGgsCgkJCW1hdGNoZWQgPSBbXSwKCQkJcG9zID0gcm5lZWRzQ29udGV4dC50ZXN0KCBzZWxlY3RvcnMgKSB8fCB0eXBlb2Ygc2VsZWN0b3JzICE9PSAic3RyaW5nIiA/CgkJCQlqUXVlcnkoIHNlbGVjdG9ycywgY29udGV4dCB8fCB0aGlzLmNvbnRleHQgKSA6CgkJCQkwOwoKCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCWZvciAoIGN1ciA9IHRoaXNbIGkgXTsgY3VyICYmIGN1ciAhPT0gY29udGV4dDsgY3VyID0gY3VyLnBhcmVudE5vZGUgKSB7CgoJCQkJLy8gQWx3YXlzIHNraXAgZG9jdW1lbnQgZnJhZ21lbnRzCgkJCQlpZiAoIGN1ci5ub2RlVHlwZSA8IDExICYmICggcG9zID8KCQkJCQlwb3MuaW5kZXgoIGN1ciApID4gLTEgOgoKCQkJCQkvLyBEb24ndCBwYXNzIG5vbi1lbGVtZW50cyB0byBTaXp6bGUKCQkJCQljdXIubm9kZVR5cGUgPT09IDEgJiYKCQkJCQkJalF1ZXJ5LmZpbmQubWF0Y2hlc1NlbGVjdG9yKCBjdXIsIHNlbGVjdG9ycyApICkgKSB7CgoJCQkJCW1hdGNoZWQucHVzaCggY3VyICk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggbWF0Y2hlZC5sZW5ndGggPiAxID8galF1ZXJ5LnVuaXF1ZVNvcnQoIG1hdGNoZWQgKSA6IG1hdGNoZWQgKTsKCX0sCgoJLy8gRGV0ZXJtaW5lIHRoZSBwb3NpdGlvbiBvZiBhbiBlbGVtZW50IHdpdGhpbgoJLy8gdGhlIG1hdGNoZWQgc2V0IG9mIGVsZW1lbnRzCglpbmRleDogZnVuY3Rpb24oIGVsZW0gKSB7CgoJCS8vIE5vIGFyZ3VtZW50LCByZXR1cm4gaW5kZXggaW4gcGFyZW50CgkJaWYgKCAhZWxlbSApIHsKCQkJcmV0dXJuICggdGhpc1sgMCBdICYmIHRoaXNbIDAgXS5wYXJlbnROb2RlICkgPyB0aGlzLmZpcnN0KCkucHJldkFsbCgpLmxlbmd0aCA6IC0xOwoJCX0KCgkJLy8gaW5kZXggaW4gc2VsZWN0b3IKCQlpZiAoIHR5cGVvZiBlbGVtID09PSAic3RyaW5nIiApIHsKCQkJcmV0dXJuIGpRdWVyeS5pbkFycmF5KCB0aGlzWyAwIF0sIGpRdWVyeSggZWxlbSApICk7CgkJfQoKCQkvLyBMb2NhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBkZXNpcmVkIGVsZW1lbnQKCQlyZXR1cm4galF1ZXJ5LmluQXJyYXkoCgoJCQkvLyBJZiBpdCByZWNlaXZlcyBhIGpRdWVyeSBvYmplY3QsIHRoZSBmaXJzdCBlbGVtZW50IGlzIHVzZWQKCQkJZWxlbS5qcXVlcnkgPyBlbGVtWyAwIF0gOiBlbGVtLCB0aGlzICk7Cgl9LAoKCWFkZDogZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0ICkgewoJCXJldHVybiB0aGlzLnB1c2hTdGFjaygKCQkJalF1ZXJ5LnVuaXF1ZVNvcnQoCgkJCQlqUXVlcnkubWVyZ2UoIHRoaXMuZ2V0KCksIGpRdWVyeSggc2VsZWN0b3IsIGNvbnRleHQgKSApCgkJCSkKCQkpOwoJfSwKCglhZGRCYWNrOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMuYWRkKCBzZWxlY3RvciA9PSBudWxsID8KCQkJdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlciggc2VsZWN0b3IgKQoJCSk7Cgl9Cn0gKTsKCmZ1bmN0aW9uIHNpYmxpbmcoIGN1ciwgZGlyICkgewoJZG8gewoJCWN1ciA9IGN1clsgZGlyIF07Cgl9IHdoaWxlICggY3VyICYmIGN1ci5ub2RlVHlwZSAhPT0gMSApOwoKCXJldHVybiBjdXI7Cn0KCmpRdWVyeS5lYWNoKCB7CglwYXJlbnQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGU7CgkJcmV0dXJuIHBhcmVudCAmJiBwYXJlbnQubm9kZVR5cGUgIT09IDExID8gcGFyZW50IDogbnVsbDsKCX0sCglwYXJlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gZGlyKCBlbGVtLCAicGFyZW50Tm9kZSIgKTsKCX0sCglwYXJlbnRzVW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4gZGlyKCBlbGVtLCAicGFyZW50Tm9kZSIsIHVudGlsICk7Cgl9LAoJbmV4dDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIHNpYmxpbmcoIGVsZW0sICJuZXh0U2libGluZyIgKTsKCX0sCglwcmV2OiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gc2libGluZyggZWxlbSwgInByZXZpb3VzU2libGluZyIgKTsKCX0sCgluZXh0QWxsOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gZGlyKCBlbGVtLCAibmV4dFNpYmxpbmciICk7Cgl9LAoJcHJldkFsbDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGRpciggZWxlbSwgInByZXZpb3VzU2libGluZyIgKTsKCX0sCgluZXh0VW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4gZGlyKCBlbGVtLCAibmV4dFNpYmxpbmciLCB1bnRpbCApOwoJfSwKCXByZXZVbnRpbDogZnVuY3Rpb24oIGVsZW0sIGksIHVudGlsICkgewoJCXJldHVybiBkaXIoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciLCB1bnRpbCApOwoJfSwKCXNpYmxpbmdzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gc2libGluZ3MoICggZWxlbS5wYXJlbnROb2RlIHx8IHt9ICkuZmlyc3RDaGlsZCwgZWxlbSApOwoJfSwKCWNoaWxkcmVuOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gc2libGluZ3MoIGVsZW0uZmlyc3RDaGlsZCApOwoJfSwKCWNvbnRlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCAiaWZyYW1lIiApID8KCQkJZWxlbS5jb250ZW50RG9jdW1lbnQgfHwgZWxlbS5jb250ZW50V2luZG93LmRvY3VtZW50IDoKCQkJalF1ZXJ5Lm1lcmdlKCBbXSwgZWxlbS5jaGlsZE5vZGVzICk7Cgl9Cn0sIGZ1bmN0aW9uKCBuYW1lLCBmbiApIHsKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHVudGlsLCBzZWxlY3RvciApIHsKCQl2YXIgcmV0ID0galF1ZXJ5Lm1hcCggdGhpcywgZm4sIHVudGlsICk7CgoJCWlmICggbmFtZS5zbGljZSggLTUgKSAhPT0gIlVudGlsIiApIHsKCQkJc2VsZWN0b3IgPSB1bnRpbDsKCQl9CgoJCWlmICggc2VsZWN0b3IgJiYgdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJcmV0ID0galF1ZXJ5LmZpbHRlciggc2VsZWN0b3IsIHJldCApOwoJCX0KCgkJaWYgKCB0aGlzLmxlbmd0aCA+IDEgKSB7CgoJCQkvLyBSZW1vdmUgZHVwbGljYXRlcwoJCQlpZiAoICFndWFyYW50ZWVkVW5pcXVlWyBuYW1lIF0gKSB7CgkJCQlyZXQgPSBqUXVlcnkudW5pcXVlU29ydCggcmV0ICk7CgkJCX0KCgkJCS8vIFJldmVyc2Ugb3JkZXIgZm9yIHBhcmVudHMqIGFuZCBwcmV2LWRlcml2YXRpdmVzCgkJCWlmICggcnBhcmVudHNwcmV2LnRlc3QoIG5hbWUgKSApIHsKCQkJCXJldCA9IHJldC5yZXZlcnNlKCk7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0ICk7Cgl9Owp9ICk7CnZhciBybm90d2hpdGUgPSAoIC9cUysvZyApOwoKCgovLyBDb252ZXJ0IFN0cmluZy1mb3JtYXR0ZWQgb3B0aW9ucyBpbnRvIE9iamVjdC1mb3JtYXR0ZWQgb25lcwpmdW5jdGlvbiBjcmVhdGVPcHRpb25zKCBvcHRpb25zICkgewoJdmFyIG9iamVjdCA9IHt9OwoJalF1ZXJ5LmVhY2goIG9wdGlvbnMubWF0Y2goIHJub3R3aGl0ZSApIHx8IFtdLCBmdW5jdGlvbiggXywgZmxhZyApIHsKCQlvYmplY3RbIGZsYWcgXSA9IHRydWU7Cgl9ICk7CglyZXR1cm4gb2JqZWN0Owp9CgovKgogKiBDcmVhdGUgYSBjYWxsYmFjayBsaXN0IHVzaW5nIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKICoKICoJb3B0aW9uczogYW4gb3B0aW9uYWwgbGlzdCBvZiBzcGFjZS1zZXBhcmF0ZWQgb3B0aW9ucyB0aGF0IHdpbGwgY2hhbmdlIGhvdwogKgkJCXRoZSBjYWxsYmFjayBsaXN0IGJlaGF2ZXMgb3IgYSBtb3JlIHRyYWRpdGlvbmFsIG9wdGlvbiBvYmplY3QKICoKICogQnkgZGVmYXVsdCBhIGNhbGxiYWNrIGxpc3Qgd2lsbCBhY3QgbGlrZSBhbiBldmVudCBjYWxsYmFjayBsaXN0IGFuZCBjYW4gYmUKICogImZpcmVkIiBtdWx0aXBsZSB0aW1lcy4KICoKICogUG9zc2libGUgb3B0aW9uczoKICoKICoJb25jZToJCQl3aWxsIGVuc3VyZSB0aGUgY2FsbGJhY2sgbGlzdCBjYW4gb25seSBiZSBmaXJlZCBvbmNlIChsaWtlIGEgRGVmZXJyZWQpCiAqCiAqCW1lbW9yeToJCQl3aWxsIGtlZXAgdHJhY2sgb2YgcHJldmlvdXMgdmFsdWVzIGFuZCB3aWxsIGNhbGwgYW55IGNhbGxiYWNrIGFkZGVkCiAqCQkJCQlhZnRlciB0aGUgbGlzdCBoYXMgYmVlbiBmaXJlZCByaWdodCBhd2F5IHdpdGggdGhlIGxhdGVzdCAibWVtb3JpemVkIgogKgkJCQkJdmFsdWVzIChsaWtlIGEgRGVmZXJyZWQpCiAqCiAqCXVuaXF1ZToJCQl3aWxsIGVuc3VyZSBhIGNhbGxiYWNrIGNhbiBvbmx5IGJlIGFkZGVkIG9uY2UgKG5vIGR1cGxpY2F0ZSBpbiB0aGUgbGlzdCkKICoKICoJc3RvcE9uRmFsc2U6CWludGVycnVwdCBjYWxsaW5ncyB3aGVuIGEgY2FsbGJhY2sgcmV0dXJucyBmYWxzZQogKgogKi8KalF1ZXJ5LkNhbGxiYWNrcyA9IGZ1bmN0aW9uKCBvcHRpb25zICkgewoKCS8vIENvbnZlcnQgb3B0aW9ucyBmcm9tIFN0cmluZy1mb3JtYXR0ZWQgdG8gT2JqZWN0LWZvcm1hdHRlZCBpZiBuZWVkZWQKCS8vICh3ZSBjaGVjayBpbiBjYWNoZSBmaXJzdCkKCW9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9ucyA9PT0gInN0cmluZyIgPwoJCWNyZWF0ZU9wdGlvbnMoIG9wdGlvbnMgKSA6CgkJalF1ZXJ5LmV4dGVuZCgge30sIG9wdGlvbnMgKTsKCgl2YXIgLy8gRmxhZyB0byBrbm93IGlmIGxpc3QgaXMgY3VycmVudGx5IGZpcmluZwoJCWZpcmluZywKCgkJLy8gTGFzdCBmaXJlIHZhbHVlIGZvciBub24tZm9yZ2V0dGFibGUgbGlzdHMKCQltZW1vcnksCgoJCS8vIEZsYWcgdG8ga25vdyBpZiBsaXN0IHdhcyBhbHJlYWR5IGZpcmVkCgkJZmlyZWQsCgoJCS8vIEZsYWcgdG8gcHJldmVudCBmaXJpbmcKCQlsb2NrZWQsCgoJCS8vIEFjdHVhbCBjYWxsYmFjayBsaXN0CgkJbGlzdCA9IFtdLAoKCQkvLyBRdWV1ZSBvZiBleGVjdXRpb24gZGF0YSBmb3IgcmVwZWF0YWJsZSBsaXN0cwoJCXF1ZXVlID0gW10sCgoJCS8vIEluZGV4IG9mIGN1cnJlbnRseSBmaXJpbmcgY2FsbGJhY2sgKG1vZGlmaWVkIGJ5IGFkZC9yZW1vdmUgYXMgbmVlZGVkKQoJCWZpcmluZ0luZGV4ID0gLTEsCgoJCS8vIEZpcmUgY2FsbGJhY2tzCgkJZmlyZSA9IGZ1bmN0aW9uKCkgewoKCQkJLy8gRW5mb3JjZSBzaW5nbGUtZmlyaW5nCgkJCWxvY2tlZCA9IG9wdGlvbnMub25jZTsKCgkJCS8vIEV4ZWN1dGUgY2FsbGJhY2tzIGZvciBhbGwgcGVuZGluZyBleGVjdXRpb25zLAoJCQkvLyByZXNwZWN0aW5nIGZpcmluZ0luZGV4IG92ZXJyaWRlcyBhbmQgcnVudGltZSBjaGFuZ2VzCgkJCWZpcmVkID0gZmlyaW5nID0gdHJ1ZTsKCQkJZm9yICggOyBxdWV1ZS5sZW5ndGg7IGZpcmluZ0luZGV4ID0gLTEgKSB7CgkJCQltZW1vcnkgPSBxdWV1ZS5zaGlmdCgpOwoJCQkJd2hpbGUgKCArK2ZpcmluZ0luZGV4IDwgbGlzdC5sZW5ndGggKSB7CgoJCQkJCS8vIFJ1biBjYWxsYmFjayBhbmQgY2hlY2sgZm9yIGVhcmx5IHRlcm1pbmF0aW9uCgkJCQkJaWYgKCBsaXN0WyBmaXJpbmdJbmRleCBdLmFwcGx5KCBtZW1vcnlbIDAgXSwgbWVtb3J5WyAxIF0gKSA9PT0gZmFsc2UgJiYKCQkJCQkJb3B0aW9ucy5zdG9wT25GYWxzZSApIHsKCgkJCQkJCS8vIEp1bXAgdG8gZW5kIGFuZCBmb3JnZXQgdGhlIGRhdGEgc28gLmFkZCBkb2Vzbid0IHJlLWZpcmUKCQkJCQkJZmlyaW5nSW5kZXggPSBsaXN0Lmxlbmd0aDsKCQkJCQkJbWVtb3J5ID0gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQkvLyBGb3JnZXQgdGhlIGRhdGEgaWYgd2UncmUgZG9uZSB3aXRoIGl0CgkJCWlmICggIW9wdGlvbnMubWVtb3J5ICkgewoJCQkJbWVtb3J5ID0gZmFsc2U7CgkJCX0KCgkJCWZpcmluZyA9IGZhbHNlOwoKCQkJLy8gQ2xlYW4gdXAgaWYgd2UncmUgZG9uZSBmaXJpbmcgZm9yIGdvb2QKCQkJaWYgKCBsb2NrZWQgKSB7CgoJCQkJLy8gS2VlcCBhbiBlbXB0eSBsaXN0IGlmIHdlIGhhdmUgZGF0YSBmb3IgZnV0dXJlIGFkZCBjYWxscwoJCQkJaWYgKCBtZW1vcnkgKSB7CgkJCQkJbGlzdCA9IFtdOwoKCQkJCS8vIE90aGVyd2lzZSwgdGhpcyBvYmplY3QgaXMgc3BlbnQKCQkJCX0gZWxzZSB7CgkJCQkJbGlzdCA9ICIiOwoJCQkJfQoJCQl9CgkJfSwKCgkJLy8gQWN0dWFsIENhbGxiYWNrcyBvYmplY3QKCQlzZWxmID0gewoKCQkJLy8gQWRkIGEgY2FsbGJhY2sgb3IgYSBjb2xsZWN0aW9uIG9mIGNhbGxiYWNrcyB0byB0aGUgbGlzdAoJCQlhZGQ6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBsaXN0ICkgewoKCQkJCQkvLyBJZiB3ZSBoYXZlIG1lbW9yeSBmcm9tIGEgcGFzdCBydW4sIHdlIHNob3VsZCBmaXJlIGFmdGVyIGFkZGluZwoJCQkJCWlmICggbWVtb3J5ICYmICFmaXJpbmcgKSB7CgkJCQkJCWZpcmluZ0luZGV4ID0gbGlzdC5sZW5ndGggLSAxOwoJCQkJCQlxdWV1ZS5wdXNoKCBtZW1vcnkgKTsKCQkJCQl9CgoJCQkJCSggZnVuY3Rpb24gYWRkKCBhcmdzICkgewoJCQkJCQlqUXVlcnkuZWFjaCggYXJncywgZnVuY3Rpb24oIF8sIGFyZyApIHsKCQkJCQkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGFyZyApICkgewoJCQkJCQkJCWlmICggIW9wdGlvbnMudW5pcXVlIHx8ICFzZWxmLmhhcyggYXJnICkgKSB7CgkJCQkJCQkJCWxpc3QucHVzaCggYXJnICk7CgkJCQkJCQkJfQoJCQkJCQkJfSBlbHNlIGlmICggYXJnICYmIGFyZy5sZW5ndGggJiYgalF1ZXJ5LnR5cGUoIGFyZyApICE9PSAic3RyaW5nIiApIHsKCgkJCQkJCQkJLy8gSW5zcGVjdCByZWN1cnNpdmVseQoJCQkJCQkJCWFkZCggYXJnICk7CgkJCQkJCQl9CgkJCQkJCX0gKTsKCQkJCQl9ICkoIGFyZ3VtZW50cyApOwoKCQkJCQlpZiAoIG1lbW9yeSAmJiAhZmlyaW5nICkgewoJCQkJCQlmaXJlKCk7CgkJCQkJfQoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgoJCQkvLyBSZW1vdmUgYSBjYWxsYmFjayBmcm9tIHRoZSBsaXN0CgkJCXJlbW92ZTogZnVuY3Rpb24oKSB7CgkJCQlqUXVlcnkuZWFjaCggYXJndW1lbnRzLCBmdW5jdGlvbiggXywgYXJnICkgewoJCQkJCXZhciBpbmRleDsKCQkJCQl3aGlsZSAoICggaW5kZXggPSBqUXVlcnkuaW5BcnJheSggYXJnLCBsaXN0LCBpbmRleCApICkgPiAtMSApIHsKCQkJCQkJbGlzdC5zcGxpY2UoIGluZGV4LCAxICk7CgoJCQkJCQkvLyBIYW5kbGUgZmlyaW5nIGluZGV4ZXMKCQkJCQkJaWYgKCBpbmRleCA8PSBmaXJpbmdJbmRleCApIHsKCQkJCQkJCWZpcmluZ0luZGV4LS07CgkJCQkJCX0KCQkJCQl9CgkJCQl9ICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCgkJCS8vIENoZWNrIGlmIGEgZ2l2ZW4gY2FsbGJhY2sgaXMgaW4gdGhlIGxpc3QuCgkJCS8vIElmIG5vIGFyZ3VtZW50IGlzIGdpdmVuLCByZXR1cm4gd2hldGhlciBvciBub3QgbGlzdCBoYXMgY2FsbGJhY2tzIGF0dGFjaGVkLgoJCQloYXM6IGZ1bmN0aW9uKCBmbiApIHsKCQkJCXJldHVybiBmbiA/CgkJCQkJalF1ZXJ5LmluQXJyYXkoIGZuLCBsaXN0ICkgPiAtMSA6CgkJCQkJbGlzdC5sZW5ndGggPiAwOwoJCQl9LAoKCQkJLy8gUmVtb3ZlIGFsbCBjYWxsYmFja3MgZnJvbSB0aGUgbGlzdAoJCQllbXB0eTogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGxpc3QgKSB7CgkJCQkJbGlzdCA9IFtdOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgoJCQkvLyBEaXNhYmxlIC5maXJlIGFuZCAuYWRkCgkJCS8vIEFib3J0IGFueSBjdXJyZW50L3BlbmRpbmcgZXhlY3V0aW9ucwoJCQkvLyBDbGVhciBhbGwgY2FsbGJhY2tzIGFuZCB2YWx1ZXMKCQkJZGlzYWJsZTogZnVuY3Rpb24oKSB7CgkJCQlsb2NrZWQgPSBxdWV1ZSA9IFtdOwoJCQkJbGlzdCA9IG1lbW9yeSA9ICIiOwoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCWRpc2FibGVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhbGlzdDsKCQkJfSwKCgkJCS8vIERpc2FibGUgLmZpcmUKCQkJLy8gQWxzbyBkaXNhYmxlIC5hZGQgdW5sZXNzIHdlIGhhdmUgbWVtb3J5IChzaW5jZSBpdCB3b3VsZCBoYXZlIG5vIGVmZmVjdCkKCQkJLy8gQWJvcnQgYW55IHBlbmRpbmcgZXhlY3V0aW9ucwoJCQlsb2NrOiBmdW5jdGlvbigpIHsKCQkJCWxvY2tlZCA9IHRydWU7CgkJCQlpZiAoICFtZW1vcnkgKSB7CgkJCQkJc2VsZi5kaXNhYmxlKCk7CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJbG9ja2VkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhIWxvY2tlZDsKCQkJfSwKCgkJCS8vIENhbGwgYWxsIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBjb250ZXh0IGFuZCBhcmd1bWVudHMKCQkJZmlyZVdpdGg6IGZ1bmN0aW9uKCBjb250ZXh0LCBhcmdzICkgewoJCQkJaWYgKCAhbG9ja2VkICkgewoJCQkJCWFyZ3MgPSBhcmdzIHx8IFtdOwoJCQkJCWFyZ3MgPSBbIGNvbnRleHQsIGFyZ3Muc2xpY2UgPyBhcmdzLnNsaWNlKCkgOiBhcmdzIF07CgkJCQkJcXVldWUucHVzaCggYXJncyApOwoJCQkJCWlmICggIWZpcmluZyApIHsKCQkJCQkJZmlyZSgpOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiB0aGlzOwoJCQl9LAoKCQkJLy8gQ2FsbCBhbGwgdGhlIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBhcmd1bWVudHMKCQkJZmlyZTogZnVuY3Rpb24oKSB7CgkJCQlzZWxmLmZpcmVXaXRoKCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJCXJldHVybiB0aGlzOwoJCQl9LAoKCQkJLy8gVG8ga25vdyBpZiB0aGUgY2FsbGJhY2tzIGhhdmUgYWxyZWFkeSBiZWVuIGNhbGxlZCBhdCBsZWFzdCBvbmNlCgkJCWZpcmVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhIWZpcmVkOwoJCQl9CgkJfTsKCglyZXR1cm4gc2VsZjsKfTsKCgpqUXVlcnkuZXh0ZW5kKCB7CgoJRGVmZXJyZWQ6IGZ1bmN0aW9uKCBmdW5jICkgewoJCXZhciB0dXBsZXMgPSBbCgoJCQkJLy8gYWN0aW9uLCBhZGQgbGlzdGVuZXIsIGxpc3RlbmVyIGxpc3QsIGZpbmFsIHN0YXRlCgkJCQlbICJyZXNvbHZlIiwgImRvbmUiLCBqUXVlcnkuQ2FsbGJhY2tzKCAib25jZSBtZW1vcnkiICksICJyZXNvbHZlZCIgXSwKCQkJCVsgInJlamVjdCIsICJmYWlsIiwgalF1ZXJ5LkNhbGxiYWNrcyggIm9uY2UgbWVtb3J5IiApLCAicmVqZWN0ZWQiIF0sCgkJCQlbICJub3RpZnkiLCAicHJvZ3Jlc3MiLCBqUXVlcnkuQ2FsbGJhY2tzKCAibWVtb3J5IiApIF0KCQkJXSwKCQkJc3RhdGUgPSAicGVuZGluZyIsCgkJCXByb21pc2UgPSB7CgkJCQlzdGF0ZTogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHN0YXRlOwoJCQkJfSwKCQkJCWFsd2F5czogZnVuY3Rpb24oKSB7CgkJCQkJZGVmZXJyZWQuZG9uZSggYXJndW1lbnRzICkuZmFpbCggYXJndW1lbnRzICk7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9LAoJCQkJdGhlbjogZnVuY3Rpb24oIC8qIGZuRG9uZSwgZm5GYWlsLCBmblByb2dyZXNzICovICkgewoJCQkJCXZhciBmbnMgPSBhcmd1bWVudHM7CgkJCQkJcmV0dXJuIGpRdWVyeS5EZWZlcnJlZCggZnVuY3Rpb24oIG5ld0RlZmVyICkgewoJCQkJCQlqUXVlcnkuZWFjaCggdHVwbGVzLCBmdW5jdGlvbiggaSwgdHVwbGUgKSB7CgkJCQkJCQl2YXIgZm4gPSBqUXVlcnkuaXNGdW5jdGlvbiggZm5zWyBpIF0gKSAmJiBmbnNbIGkgXTsKCgkJCQkJCQkvLyBkZWZlcnJlZFsgZG9uZSB8IGZhaWwgfCBwcm9ncmVzcyBdIGZvciBmb3J3YXJkaW5nIGFjdGlvbnMgdG8gbmV3RGVmZXIKCQkJCQkJCWRlZmVycmVkWyB0dXBsZVsgMSBdIF0oIGZ1bmN0aW9uKCkgewoJCQkJCQkJCXZhciByZXR1cm5lZCA9IGZuICYmIGZuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJCQkJCQlpZiAoIHJldHVybmVkICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCByZXR1cm5lZC5wcm9taXNlICkgKSB7CgkJCQkJCQkJCXJldHVybmVkLnByb21pc2UoKQoJCQkJCQkJCQkJLnByb2dyZXNzKCBuZXdEZWZlci5ub3RpZnkgKQoJCQkJCQkJCQkJLmRvbmUoIG5ld0RlZmVyLnJlc29sdmUgKQoJCQkJCQkJCQkJLmZhaWwoIG5ld0RlZmVyLnJlamVjdCApOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCW5ld0RlZmVyWyB0dXBsZVsgMCBdICsgIldpdGgiIF0oCgkJCQkJCQkJCQl0aGlzID09PSBwcm9taXNlID8gbmV3RGVmZXIucHJvbWlzZSgpIDogdGhpcywKCQkJCQkJCQkJCWZuID8gWyByZXR1cm5lZCBdIDogYXJndW1lbnRzCgkJCQkJCQkJCSk7CgkJCQkJCQkJfQoJCQkJCQkJfSApOwoJCQkJCQl9ICk7CgkJCQkJCWZucyA9IG51bGw7CgkJCQkJfSApLnByb21pc2UoKTsKCQkJCX0sCgoJCQkJLy8gR2V0IGEgcHJvbWlzZSBmb3IgdGhpcyBkZWZlcnJlZAoJCQkJLy8gSWYgb2JqIGlzIHByb3ZpZGVkLCB0aGUgcHJvbWlzZSBhc3BlY3QgaXMgYWRkZWQgdG8gdGhlIG9iamVjdAoJCQkJcHJvbWlzZTogZnVuY3Rpb24oIG9iaiApIHsKCQkJCQlyZXR1cm4gb2JqICE9IG51bGwgPyBqUXVlcnkuZXh0ZW5kKCBvYmosIHByb21pc2UgKSA6IHByb21pc2U7CgkJCQl9CgkJCX0sCgkJCWRlZmVycmVkID0ge307CgoJCS8vIEtlZXAgcGlwZSBmb3IgYmFjay1jb21wYXQKCQlwcm9taXNlLnBpcGUgPSBwcm9taXNlLnRoZW47CgoJCS8vIEFkZCBsaXN0LXNwZWNpZmljIG1ldGhvZHMKCQlqUXVlcnkuZWFjaCggdHVwbGVzLCBmdW5jdGlvbiggaSwgdHVwbGUgKSB7CgkJCXZhciBsaXN0ID0gdHVwbGVbIDIgXSwKCQkJCXN0YXRlU3RyaW5nID0gdHVwbGVbIDMgXTsKCgkJCS8vIHByb21pc2VbIGRvbmUgfCBmYWlsIHwgcHJvZ3Jlc3MgXSA9IGxpc3QuYWRkCgkJCXByb21pc2VbIHR1cGxlWyAxIF0gXSA9IGxpc3QuYWRkOwoKCQkJLy8gSGFuZGxlIHN0YXRlCgkJCWlmICggc3RhdGVTdHJpbmcgKSB7CgkJCQlsaXN0LmFkZCggZnVuY3Rpb24oKSB7CgoJCQkJCS8vIHN0YXRlID0gWyByZXNvbHZlZCB8IHJlamVjdGVkIF0KCQkJCQlzdGF0ZSA9IHN0YXRlU3RyaW5nOwoKCQkJCS8vIFsgcmVqZWN0X2xpc3QgfCByZXNvbHZlX2xpc3QgXS5kaXNhYmxlOyBwcm9ncmVzc19saXN0LmxvY2sKCQkJCX0sIHR1cGxlc1sgaSBeIDEgXVsgMiBdLmRpc2FibGUsIHR1cGxlc1sgMiBdWyAyIF0ubG9jayApOwoJCQl9CgoJCQkvLyBkZWZlcnJlZFsgcmVzb2x2ZSB8IHJlamVjdCB8IG5vdGlmeSBdCgkJCWRlZmVycmVkWyB0dXBsZVsgMCBdIF0gPSBmdW5jdGlvbigpIHsKCQkJCWRlZmVycmVkWyB0dXBsZVsgMCBdICsgIldpdGgiIF0oIHRoaXMgPT09IGRlZmVycmVkID8gcHJvbWlzZSA6IHRoaXMsIGFyZ3VtZW50cyApOwoJCQkJcmV0dXJuIHRoaXM7CgkJCX07CgkJCWRlZmVycmVkWyB0dXBsZVsgMCBdICsgIldpdGgiIF0gPSBsaXN0LmZpcmVXaXRoOwoJCX0gKTsKCgkJLy8gTWFrZSB0aGUgZGVmZXJyZWQgYSBwcm9taXNlCgkJcHJvbWlzZS5wcm9taXNlKCBkZWZlcnJlZCApOwoKCQkvLyBDYWxsIGdpdmVuIGZ1bmMgaWYgYW55CgkJaWYgKCBmdW5jICkgewoJCQlmdW5jLmNhbGwoIGRlZmVycmVkLCBkZWZlcnJlZCApOwoJCX0KCgkJLy8gQWxsIGRvbmUhCgkJcmV0dXJuIGRlZmVycmVkOwoJfSwKCgkvLyBEZWZlcnJlZCBoZWxwZXIKCXdoZW46IGZ1bmN0aW9uKCBzdWJvcmRpbmF0ZSAvKiAsIC4uLiwgc3Vib3JkaW5hdGVOICovICkgewoJCXZhciBpID0gMCwKCQkJcmVzb2x2ZVZhbHVlcyA9IHNsaWNlLmNhbGwoIGFyZ3VtZW50cyApLAoJCQlsZW5ndGggPSByZXNvbHZlVmFsdWVzLmxlbmd0aCwKCgkJCS8vIHRoZSBjb3VudCBvZiB1bmNvbXBsZXRlZCBzdWJvcmRpbmF0ZXMKCQkJcmVtYWluaW5nID0gbGVuZ3RoICE9PSAxIHx8CgkJCQkoIHN1Ym9yZGluYXRlICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCBzdWJvcmRpbmF0ZS5wcm9taXNlICkgKSA/IGxlbmd0aCA6IDAsCgoJCQkvLyB0aGUgbWFzdGVyIERlZmVycmVkLgoJCQkvLyBJZiByZXNvbHZlVmFsdWVzIGNvbnNpc3Qgb2Ygb25seSBhIHNpbmdsZSBEZWZlcnJlZCwganVzdCB1c2UgdGhhdC4KCQkJZGVmZXJyZWQgPSByZW1haW5pbmcgPT09IDEgPyBzdWJvcmRpbmF0ZSA6IGpRdWVyeS5EZWZlcnJlZCgpLAoKCQkJLy8gVXBkYXRlIGZ1bmN0aW9uIGZvciBib3RoIHJlc29sdmUgYW5kIHByb2dyZXNzIHZhbHVlcwoJCQl1cGRhdGVGdW5jID0gZnVuY3Rpb24oIGksIGNvbnRleHRzLCB2YWx1ZXMgKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24oIHZhbHVlICkgewoJCQkJCWNvbnRleHRzWyBpIF0gPSB0aGlzOwoJCQkJCXZhbHVlc1sgaSBdID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBzbGljZS5jYWxsKCBhcmd1bWVudHMgKSA6IHZhbHVlOwoJCQkJCWlmICggdmFsdWVzID09PSBwcm9ncmVzc1ZhbHVlcyApIHsKCQkJCQkJZGVmZXJyZWQubm90aWZ5V2l0aCggY29udGV4dHMsIHZhbHVlcyApOwoKCQkJCQl9IGVsc2UgaWYgKCAhKCAtLXJlbWFpbmluZyApICkgewoJCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY29udGV4dHMsIHZhbHVlcyApOwoJCQkJCX0KCQkJCX07CgkJCX0sCgoJCQlwcm9ncmVzc1ZhbHVlcywgcHJvZ3Jlc3NDb250ZXh0cywgcmVzb2x2ZUNvbnRleHRzOwoKCQkvLyBhZGQgbGlzdGVuZXJzIHRvIERlZmVycmVkIHN1Ym9yZGluYXRlczsgdHJlYXQgb3RoZXJzIGFzIHJlc29sdmVkCgkJaWYgKCBsZW5ndGggPiAxICkgewoJCQlwcm9ncmVzc1ZhbHVlcyA9IG5ldyBBcnJheSggbGVuZ3RoICk7CgkJCXByb2dyZXNzQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlyZXNvbHZlQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCWlmICggcmVzb2x2ZVZhbHVlc1sgaSBdICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCByZXNvbHZlVmFsdWVzWyBpIF0ucHJvbWlzZSApICkgewoJCQkJCXJlc29sdmVWYWx1ZXNbIGkgXS5wcm9taXNlKCkKCQkJCQkJLnByb2dyZXNzKCB1cGRhdGVGdW5jKCBpLCBwcm9ncmVzc0NvbnRleHRzLCBwcm9ncmVzc1ZhbHVlcyApICkKCQkJCQkJLmRvbmUoIHVwZGF0ZUZ1bmMoIGksIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApICkKCQkJCQkJLmZhaWwoIGRlZmVycmVkLnJlamVjdCApOwoJCQkJfSBlbHNlIHsKCQkJCQktLXJlbWFpbmluZzsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gaWYgd2UncmUgbm90IHdhaXRpbmcgb24gYW55dGhpbmcsIHJlc29sdmUgdGhlIG1hc3RlcgoJCWlmICggIXJlbWFpbmluZyApIHsKCQkJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApOwoJCX0KCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKCX0KfSApOwoKCi8vIFRoZSBkZWZlcnJlZCB1c2VkIG9uIERPTSByZWFkeQp2YXIgcmVhZHlMaXN0OwoKalF1ZXJ5LmZuLnJlYWR5ID0gZnVuY3Rpb24oIGZuICkgewoKCS8vIEFkZCB0aGUgY2FsbGJhY2sKCWpRdWVyeS5yZWFkeS5wcm9taXNlKCkuZG9uZSggZm4gKTsKCglyZXR1cm4gdGhpczsKfTsKCmpRdWVyeS5leHRlbmQoIHsKCgkvLyBJcyB0aGUgRE9NIHJlYWR5IHRvIGJlIHVzZWQ/IFNldCB0byB0cnVlIG9uY2UgaXQgb2NjdXJzLgoJaXNSZWFkeTogZmFsc2UsCgoJLy8gQSBjb3VudGVyIHRvIHRyYWNrIGhvdyBtYW55IGl0ZW1zIHRvIHdhaXQgZm9yIGJlZm9yZQoJLy8gdGhlIHJlYWR5IGV2ZW50IGZpcmVzLiBTZWUgIzY3ODEKCXJlYWR5V2FpdDogMSwKCgkvLyBIb2xkIChvciByZWxlYXNlKSB0aGUgcmVhZHkgZXZlbnQKCWhvbGRSZWFkeTogZnVuY3Rpb24oIGhvbGQgKSB7CgkJaWYgKCBob2xkICkgewoJCQlqUXVlcnkucmVhZHlXYWl0Kys7CgkJfSBlbHNlIHsKCQkJalF1ZXJ5LnJlYWR5KCB0cnVlICk7CgkJfQoJfSwKCgkvLyBIYW5kbGUgd2hlbiB0aGUgRE9NIGlzIHJlYWR5CglyZWFkeTogZnVuY3Rpb24oIHdhaXQgKSB7CgoJCS8vIEFib3J0IGlmIHRoZXJlIGFyZSBwZW5kaW5nIGhvbGRzIG9yIHdlJ3JlIGFscmVhZHkgcmVhZHkKCQlpZiAoIHdhaXQgPT09IHRydWUgPyAtLWpRdWVyeS5yZWFkeVdhaXQgOiBqUXVlcnkuaXNSZWFkeSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gUmVtZW1iZXIgdGhhdCB0aGUgRE9NIGlzIHJlYWR5CgkJalF1ZXJ5LmlzUmVhZHkgPSB0cnVlOwoKCQkvLyBJZiBhIG5vcm1hbCBET00gUmVhZHkgZXZlbnQgZmlyZWQsIGRlY3JlbWVudCwgYW5kIHdhaXQgaWYgbmVlZCBiZQoJCWlmICggd2FpdCAhPT0gdHJ1ZSAmJiAtLWpRdWVyeS5yZWFkeVdhaXQgPiAwICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBJZiB0aGVyZSBhcmUgZnVuY3Rpb25zIGJvdW5kLCB0byBleGVjdXRlCgkJcmVhZHlMaXN0LnJlc29sdmVXaXRoKCBkb2N1bWVudCwgWyBqUXVlcnkgXSApOwoKCQkvLyBUcmlnZ2VyIGFueSBib3VuZCByZWFkeSBldmVudHMKCQlpZiAoIGpRdWVyeS5mbi50cmlnZ2VySGFuZGxlciApIHsKCQkJalF1ZXJ5KCBkb2N1bWVudCApLnRyaWdnZXJIYW5kbGVyKCAicmVhZHkiICk7CgkJCWpRdWVyeSggZG9jdW1lbnQgKS5vZmYoICJyZWFkeSIgKTsKCQl9Cgl9Cn0gKTsKCi8qKgogKiBDbGVhbi11cCBtZXRob2QgZm9yIGRvbSByZWFkeSBldmVudHMKICovCmZ1bmN0aW9uIGRldGFjaCgpIHsKCWlmICggZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciApIHsKCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAiRE9NQ29udGVudExvYWRlZCIsIGNvbXBsZXRlZCApOwoJCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCAibG9hZCIsIGNvbXBsZXRlZCApOwoKCX0gZWxzZSB7CgkJZG9jdW1lbnQuZGV0YWNoRXZlbnQoICJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBjb21wbGV0ZWQgKTsKCQl3aW5kb3cuZGV0YWNoRXZlbnQoICJvbmxvYWQiLCBjb21wbGV0ZWQgKTsKCX0KfQoKLyoqCiAqIFRoZSByZWFkeSBldmVudCBoYW5kbGVyIGFuZCBzZWxmIGNsZWFudXAgbWV0aG9kCiAqLwpmdW5jdGlvbiBjb21wbGV0ZWQoKSB7CgoJLy8gcmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiBpcyBnb29kIGVub3VnaCBmb3IgdXMgdG8gY2FsbCB0aGUgZG9tIHJlYWR5IGluIG9sZElFCglpZiAoIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgfHwKCQl3aW5kb3cuZXZlbnQudHlwZSA9PT0gImxvYWQiIHx8CgkJZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiApIHsKCgkJZGV0YWNoKCk7CgkJalF1ZXJ5LnJlYWR5KCk7Cgl9Cn0KCmpRdWVyeS5yZWFkeS5wcm9taXNlID0gZnVuY3Rpb24oIG9iaiApIHsKCWlmICggIXJlYWR5TGlzdCApIHsKCgkJcmVhZHlMaXN0ID0galF1ZXJ5LkRlZmVycmVkKCk7CgoJCS8vIENhdGNoIGNhc2VzIHdoZXJlICQoZG9jdW1lbnQpLnJlYWR5KCkgaXMgY2FsbGVkCgkJLy8gYWZ0ZXIgdGhlIGJyb3dzZXIgZXZlbnQgaGFzIGFscmVhZHkgb2NjdXJyZWQuCgkJLy8gU3VwcG9ydDogSUU2LTEwCgkJLy8gT2xkZXIgSUUgc29tZXRpbWVzIHNpZ25hbHMgImludGVyYWN0aXZlIiB0b28gc29vbgoJCWlmICggZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiB8fAoJCQkoIGRvY3VtZW50LnJlYWR5U3RhdGUgIT09ICJsb2FkaW5nIiAmJiAhZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsICkgKSB7CgoJCQkvLyBIYW5kbGUgaXQgYXN5bmNocm9ub3VzbHkgdG8gYWxsb3cgc2NyaXB0cyB0aGUgb3Bwb3J0dW5pdHkgdG8gZGVsYXkgcmVhZHkKCQkJd2luZG93LnNldFRpbWVvdXQoIGpRdWVyeS5yZWFkeSApOwoKCQkvLyBTdGFuZGFyZHMtYmFzZWQgYnJvd3NlcnMgc3VwcG9ydCBET01Db250ZW50TG9hZGVkCgkJfSBlbHNlIGlmICggZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciApIHsKCgkJCS8vIFVzZSB0aGUgaGFuZHkgZXZlbnQgY2FsbGJhY2sKCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggIkRPTUNvbnRlbnRMb2FkZWQiLCBjb21wbGV0ZWQgKTsKCgkJCS8vIEEgZmFsbGJhY2sgdG8gd2luZG93Lm9ubG9hZCwgdGhhdCB3aWxsIGFsd2F5cyB3b3JrCgkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAibG9hZCIsIGNvbXBsZXRlZCApOwoKCQkvLyBJZiBJRSBldmVudCBtb2RlbCBpcyB1c2VkCgkJfSBlbHNlIHsKCgkJCS8vIEVuc3VyZSBmaXJpbmcgYmVmb3JlIG9ubG9hZCwgbWF5YmUgbGF0ZSBidXQgc2FmZSBhbHNvIGZvciBpZnJhbWVzCgkJCWRvY3VtZW50LmF0dGFjaEV2ZW50KCAib25yZWFkeXN0YXRlY2hhbmdlIiwgY29tcGxldGVkICk7CgoJCQkvLyBBIGZhbGxiYWNrIHRvIHdpbmRvdy5vbmxvYWQsIHRoYXQgd2lsbCBhbHdheXMgd29yawoJCQl3aW5kb3cuYXR0YWNoRXZlbnQoICJvbmxvYWQiLCBjb21wbGV0ZWQgKTsKCgkJCS8vIElmIElFIGFuZCBub3QgYSBmcmFtZQoJCQkvLyBjb250aW51YWxseSBjaGVjayB0byBzZWUgaWYgdGhlIGRvY3VtZW50IGlzIHJlYWR5CgkJCXZhciB0b3AgPSBmYWxzZTsKCgkJCXRyeSB7CgkJCQl0b3AgPSB3aW5kb3cuZnJhbWVFbGVtZW50ID09IG51bGwgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoJCQl9IGNhdGNoICggZSApIHt9CgoJCQlpZiAoIHRvcCAmJiB0b3AuZG9TY3JvbGwgKSB7CgkJCQkoIGZ1bmN0aW9uIGRvU2Nyb2xsQ2hlY2soKSB7CgkJCQkJaWYgKCAhalF1ZXJ5LmlzUmVhZHkgKSB7CgoJCQkJCQl0cnkgewoKCQkJCQkJCS8vIFVzZSB0aGUgdHJpY2sgYnkgRGllZ28gUGVyaW5pCgkJCQkJCQkvLyBodHRwOi8vamF2YXNjcmlwdC5ud2JveC5jb20vSUVDb250ZW50TG9hZGVkLwoJCQkJCQkJdG9wLmRvU2Nyb2xsKCAibGVmdCIgKTsKCQkJCQkJfSBjYXRjaCAoIGUgKSB7CgkJCQkJCQlyZXR1cm4gd2luZG93LnNldFRpbWVvdXQoIGRvU2Nyb2xsQ2hlY2ssIDUwICk7CgkJCQkJCX0KCgkJCQkJCS8vIGRldGFjaCBhbGwgZG9tIHJlYWR5IGV2ZW50cwoJCQkJCQlkZXRhY2goKTsKCgkJCQkJCS8vIGFuZCBleGVjdXRlIGFueSB3YWl0aW5nIGZ1bmN0aW9ucwoJCQkJCQlqUXVlcnkucmVhZHkoKTsKCQkJCQl9CgkJCQl9ICkoKTsKCQkJfQoJCX0KCX0KCXJldHVybiByZWFkeUxpc3QucHJvbWlzZSggb2JqICk7Cn07CgovLyBLaWNrIG9mZiB0aGUgRE9NIHJlYWR5IGNoZWNrIGV2ZW4gaWYgdGhlIHVzZXIgZG9lcyBub3QKalF1ZXJ5LnJlYWR5LnByb21pc2UoKTsKCgoKCi8vIFN1cHBvcnQ6IElFPDkKLy8gSXRlcmF0aW9uIG92ZXIgb2JqZWN0J3MgaW5oZXJpdGVkIHByb3BlcnRpZXMgYmVmb3JlIGl0cyBvd24KdmFyIGk7CmZvciAoIGkgaW4galF1ZXJ5KCBzdXBwb3J0ICkgKSB7CglicmVhazsKfQpzdXBwb3J0Lm93bkZpcnN0ID0gaSA9PT0gIjAiOwoKLy8gTm90ZTogbW9zdCBzdXBwb3J0IHRlc3RzIGFyZSBkZWZpbmVkIGluIHRoZWlyIHJlc3BlY3RpdmUgbW9kdWxlcy4KLy8gZmFsc2UgdW50aWwgdGhlIHRlc3QgaXMgcnVuCnN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCA9IGZhbHNlOwoKLy8gRXhlY3V0ZSBBU0FQIGluIGNhc2Ugd2UgbmVlZCB0byBzZXQgYm9keS5zdHlsZS56b29tCmpRdWVyeSggZnVuY3Rpb24oKSB7CgoJLy8gTWluaWZpZWQ6IHZhciBhLGIsYyxkCgl2YXIgdmFsLCBkaXYsIGJvZHksIGNvbnRhaW5lcjsKCglib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICJib2R5IiApWyAwIF07CglpZiAoICFib2R5IHx8ICFib2R5LnN0eWxlICkgewoKCQkvLyBSZXR1cm4gZm9yIGZyYW1lc2V0IGRvY3MgdGhhdCBkb24ndCBoYXZlIGEgYm9keQoJCXJldHVybjsKCX0KCgkvLyBTZXR1cAoJZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKTsKCWNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICk7Cgljb250YWluZXIuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjphYnNvbHV0ZTtib3JkZXI6MDt3aWR0aDowO2hlaWdodDowO3RvcDowO2xlZnQ6LTk5OTlweCI7Cglib2R5LmFwcGVuZENoaWxkKCBjb250YWluZXIgKS5hcHBlbmRDaGlsZCggZGl2ICk7CgoJaWYgKCB0eXBlb2YgZGl2LnN0eWxlLnpvb20gIT09ICJ1bmRlZmluZWQiICkgewoKCQkvLyBTdXBwb3J0OiBJRTw4CgkJLy8gQ2hlY2sgaWYgbmF0aXZlbHkgYmxvY2stbGV2ZWwgZWxlbWVudHMgYWN0IGxpa2UgaW5saW5lLWJsb2NrCgkJLy8gZWxlbWVudHMgd2hlbiBzZXR0aW5nIHRoZWlyIGRpc3BsYXkgdG8gJ2lubGluZScgYW5kIGdpdmluZwoJCS8vIHRoZW0gbGF5b3V0CgkJZGl2LnN0eWxlLmNzc1RleHQgPSAiZGlzcGxheTppbmxpbmU7bWFyZ2luOjA7Ym9yZGVyOjA7cGFkZGluZzoxcHg7d2lkdGg6MXB4O3pvb206MSI7CgoJCXN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCA9IHZhbCA9IGRpdi5vZmZzZXRXaWR0aCA9PT0gMzsKCQlpZiAoIHZhbCApIHsKCgkJCS8vIFByZXZlbnQgSUUgNiBmcm9tIGFmZmVjdGluZyBsYXlvdXQgZm9yIHBvc2l0aW9uZWQgZWxlbWVudHMgIzExMDQ4CgkJCS8vIFByZXZlbnQgSUUgZnJvbSBzaHJpbmtpbmcgdGhlIGJvZHkgaW4gSUUgNyBtb2RlICMxMjg2OQoJCQkvLyBTdXBwb3J0OiBJRTw4CgkJCWJvZHkuc3R5bGUuem9vbSA9IDE7CgkJfQoJfQoKCWJvZHkucmVtb3ZlQ2hpbGQoIGNvbnRhaW5lciApOwp9ICk7CgoKKCBmdW5jdGlvbigpIHsKCXZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoKCS8vIFN1cHBvcnQ6IElFPDkKCXN1cHBvcnQuZGVsZXRlRXhwYW5kbyA9IHRydWU7Cgl0cnkgewoJCWRlbGV0ZSBkaXYudGVzdDsKCX0gY2F0Y2ggKCBlICkgewoJCXN1cHBvcnQuZGVsZXRlRXhwYW5kbyA9IGZhbHNlOwoJfQoKCS8vIE51bGwgZWxlbWVudHMgdG8gYXZvaWQgbGVha3MgaW4gSUUuCglkaXYgPSBudWxsOwp9ICkoKTsKdmFyIGFjY2VwdERhdGEgPSBmdW5jdGlvbiggZWxlbSApIHsKCXZhciBub0RhdGEgPSBqUXVlcnkubm9EYXRhWyAoIGVsZW0ubm9kZU5hbWUgKyAiICIgKS50b0xvd2VyQ2FzZSgpIF0sCgkJbm9kZVR5cGUgPSArZWxlbS5ub2RlVHlwZSB8fCAxOwoKCS8vIERvIG5vdCBzZXQgZGF0YSBvbiBub24tZWxlbWVudCBET00gbm9kZXMgYmVjYXVzZSBpdCB3aWxsIG5vdCBiZSBjbGVhcmVkICgjODMzNSkuCglyZXR1cm4gbm9kZVR5cGUgIT09IDEgJiYgbm9kZVR5cGUgIT09IDkgPwoJCWZhbHNlIDoKCgkJLy8gTm9kZXMgYWNjZXB0IGRhdGEgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQ7IHJlamVjdGlvbiBjYW4gYmUgY29uZGl0aW9uYWwKCQkhbm9EYXRhIHx8IG5vRGF0YSAhPT0gdHJ1ZSAmJiBlbGVtLmdldEF0dHJpYnV0ZSggImNsYXNzaWQiICkgPT09IG5vRGF0YTsKfTsKCgoKCnZhciByYnJhY2UgPSAvXig/Olx7W1x3XFddKlx9fFxbW1x3XFddKlxdKSQvLAoJcm11bHRpRGFzaCA9IC8oW0EtWl0pL2c7CgpmdW5jdGlvbiBkYXRhQXR0ciggZWxlbSwga2V5LCBkYXRhICkgewoKCS8vIElmIG5vdGhpbmcgd2FzIGZvdW5kIGludGVybmFsbHksIHRyeSB0byBmZXRjaCBhbnkKCS8vIGRhdGEgZnJvbSB0aGUgSFRNTDUgZGF0YS0qIGF0dHJpYnV0ZQoJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCgkJdmFyIG5hbWUgPSAiZGF0YS0iICsga2V5LnJlcGxhY2UoIHJtdWx0aURhc2gsICItJDEiICkudG9Mb3dlckNhc2UoKTsKCgkJZGF0YSA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICk7CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoJCQl0cnkgewoJCQkJZGF0YSA9IGRhdGEgPT09ICJ0cnVlIiA/IHRydWUgOgoJCQkJCWRhdGEgPT09ICJmYWxzZSIgPyBmYWxzZSA6CgkJCQkJZGF0YSA9PT0gIm51bGwiID8gbnVsbCA6CgoJCQkJCS8vIE9ubHkgY29udmVydCB0byBhIG51bWJlciBpZiBpdCBkb2Vzbid0IGNoYW5nZSB0aGUgc3RyaW5nCgkJCQkJK2RhdGEgKyAiIiA9PT0gZGF0YSA/ICtkYXRhIDoKCQkJCQlyYnJhY2UudGVzdCggZGF0YSApID8galF1ZXJ5LnBhcnNlSlNPTiggZGF0YSApIDoKCQkJCQlkYXRhOwoJCQl9IGNhdGNoICggZSApIHt9CgoJCQkvLyBNYWtlIHN1cmUgd2Ugc2V0IHRoZSBkYXRhIHNvIGl0IGlzbid0IGNoYW5nZWQgbGF0ZXIKCQkJalF1ZXJ5LmRhdGEoIGVsZW0sIGtleSwgZGF0YSApOwoKCQl9IGVsc2UgewoJCQlkYXRhID0gdW5kZWZpbmVkOwoJCX0KCX0KCglyZXR1cm4gZGF0YTsKfQoKLy8gY2hlY2tzIGEgY2FjaGUgb2JqZWN0IGZvciBlbXB0aW5lc3MKZnVuY3Rpb24gaXNFbXB0eURhdGFPYmplY3QoIG9iaiApIHsKCXZhciBuYW1lOwoJZm9yICggbmFtZSBpbiBvYmogKSB7CgoJCS8vIGlmIHRoZSBwdWJsaWMgZGF0YSBvYmplY3QgaXMgZW1wdHksIHRoZSBwcml2YXRlIGlzIHN0aWxsIGVtcHR5CgkJaWYgKCBuYW1lID09PSAiZGF0YSIgJiYgalF1ZXJ5LmlzRW1wdHlPYmplY3QoIG9ialsgbmFtZSBdICkgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCQlpZiAoIG5hbWUgIT09ICJ0b0pTT04iICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQoKCXJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiBpbnRlcm5hbERhdGEoIGVsZW0sIG5hbWUsIGRhdGEsIHB2dCAvKiBJbnRlcm5hbCBVc2UgT25seSAqLyApIHsKCWlmICggIWFjY2VwdERhdGEoIGVsZW0gKSApIHsKCQlyZXR1cm47Cgl9CgoJdmFyIHJldCwgdGhpc0NhY2hlLAoJCWludGVybmFsS2V5ID0galF1ZXJ5LmV4cGFuZG8sCgoJCS8vIFdlIGhhdmUgdG8gaGFuZGxlIERPTSBub2RlcyBhbmQgSlMgb2JqZWN0cyBkaWZmZXJlbnRseSBiZWNhdXNlIElFNi03CgkJLy8gY2FuJ3QgR0Mgb2JqZWN0IHJlZmVyZW5jZXMgcHJvcGVybHkgYWNyb3NzIHRoZSBET00tSlMgYm91bmRhcnkKCQlpc05vZGUgPSBlbGVtLm5vZGVUeXBlLAoKCQkvLyBPbmx5IERPTSBub2RlcyBuZWVkIHRoZSBnbG9iYWwgalF1ZXJ5IGNhY2hlOyBKUyBvYmplY3QgZGF0YSBpcwoJCS8vIGF0dGFjaGVkIGRpcmVjdGx5IHRvIHRoZSBvYmplY3Qgc28gR0MgY2FuIG9jY3VyIGF1dG9tYXRpY2FsbHkKCQljYWNoZSA9IGlzTm9kZSA/IGpRdWVyeS5jYWNoZSA6IGVsZW0sCgoJCS8vIE9ubHkgZGVmaW5pbmcgYW4gSUQgZm9yIEpTIG9iamVjdHMgaWYgaXRzIGNhY2hlIGFscmVhZHkgZXhpc3RzIGFsbG93cwoJCS8vIHRoZSBjb2RlIHRvIHNob3J0Y3V0IG9uIHRoZSBzYW1lIHBhdGggYXMgYSBET00gbm9kZSB3aXRoIG5vIGNhY2hlCgkJaWQgPSBpc05vZGUgPyBlbGVtWyBpbnRlcm5hbEtleSBdIDogZWxlbVsgaW50ZXJuYWxLZXkgXSAmJiBpbnRlcm5hbEtleTsKCgkvLyBBdm9pZCBkb2luZyBhbnkgbW9yZSB3b3JrIHRoYW4gd2UgbmVlZCB0byB3aGVuIHRyeWluZyB0byBnZXQgZGF0YSBvbiBhbgoJLy8gb2JqZWN0IHRoYXQgaGFzIG5vIGRhdGEgYXQgYWxsCglpZiAoICggIWlkIHx8ICFjYWNoZVsgaWQgXSB8fCAoICFwdnQgJiYgIWNhY2hlWyBpZCBdLmRhdGEgKSApICYmCgkJZGF0YSA9PT0gdW5kZWZpbmVkICYmIHR5cGVvZiBuYW1lID09PSAic3RyaW5nIiApIHsKCQlyZXR1cm47Cgl9CgoJaWYgKCAhaWQgKSB7CgoJCS8vIE9ubHkgRE9NIG5vZGVzIG5lZWQgYSBuZXcgdW5pcXVlIElEIGZvciBlYWNoIGVsZW1lbnQgc2luY2UgdGhlaXIgZGF0YQoJCS8vIGVuZHMgdXAgaW4gdGhlIGdsb2JhbCBjYWNoZQoJCWlmICggaXNOb2RlICkgewoJCQlpZCA9IGVsZW1bIGludGVybmFsS2V5IF0gPSBkZWxldGVkSWRzLnBvcCgpIHx8IGpRdWVyeS5ndWlkKys7CgkJfSBlbHNlIHsKCQkJaWQgPSBpbnRlcm5hbEtleTsKCQl9Cgl9CgoJaWYgKCAhY2FjaGVbIGlkIF0gKSB7CgoJCS8vIEF2b2lkIGV4cG9zaW5nIGpRdWVyeSBtZXRhZGF0YSBvbiBwbGFpbiBKUyBvYmplY3RzIHdoZW4gdGhlIG9iamVjdAoJCS8vIGlzIHNlcmlhbGl6ZWQgdXNpbmcgSlNPTi5zdHJpbmdpZnkKCQljYWNoZVsgaWQgXSA9IGlzTm9kZSA/IHt9IDogeyB0b0pTT046IGpRdWVyeS5ub29wIH07Cgl9CgoJLy8gQW4gb2JqZWN0IGNhbiBiZSBwYXNzZWQgdG8galF1ZXJ5LmRhdGEgaW5zdGVhZCBvZiBhIGtleS92YWx1ZSBwYWlyOyB0aGlzIGdldHMKCS8vIHNoYWxsb3cgY29waWVkIG92ZXIgb250byB0aGUgZXhpc3RpbmcgY2FjaGUKCWlmICggdHlwZW9mIG5hbWUgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBuYW1lID09PSAiZnVuY3Rpb24iICkgewoJCWlmICggcHZ0ICkgewoJCQljYWNoZVsgaWQgXSA9IGpRdWVyeS5leHRlbmQoIGNhY2hlWyBpZCBdLCBuYW1lICk7CgkJfSBlbHNlIHsKCQkJY2FjaGVbIGlkIF0uZGF0YSA9IGpRdWVyeS5leHRlbmQoIGNhY2hlWyBpZCBdLmRhdGEsIG5hbWUgKTsKCQl9Cgl9CgoJdGhpc0NhY2hlID0gY2FjaGVbIGlkIF07CgoJLy8galF1ZXJ5IGRhdGEoKSBpcyBzdG9yZWQgaW4gYSBzZXBhcmF0ZSBvYmplY3QgaW5zaWRlIHRoZSBvYmplY3QncyBpbnRlcm5hbCBkYXRhCgkvLyBjYWNoZSBpbiBvcmRlciB0byBhdm9pZCBrZXkgY29sbGlzaW9ucyBiZXR3ZWVuIGludGVybmFsIGRhdGEgYW5kIHVzZXItZGVmaW5lZAoJLy8gZGF0YS4KCWlmICggIXB2dCApIHsKCQlpZiAoICF0aGlzQ2FjaGUuZGF0YSApIHsKCQkJdGhpc0NhY2hlLmRhdGEgPSB7fTsKCQl9CgoJCXRoaXNDYWNoZSA9IHRoaXNDYWNoZS5kYXRhOwoJfQoKCWlmICggZGF0YSAhPT0gdW5kZWZpbmVkICkgewoJCXRoaXNDYWNoZVsgalF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApIF0gPSBkYXRhOwoJfQoKCS8vIENoZWNrIGZvciBib3RoIGNvbnZlcnRlZC10by1jYW1lbCBhbmQgbm9uLWNvbnZlcnRlZCBkYXRhIHByb3BlcnR5IG5hbWVzCgkvLyBJZiBhIGRhdGEgcHJvcGVydHkgd2FzIHNwZWNpZmllZAoJaWYgKCB0eXBlb2YgbmFtZSA9PT0gInN0cmluZyIgKSB7CgoJCS8vIEZpcnN0IFRyeSB0byBmaW5kIGFzLWlzIHByb3BlcnR5IGRhdGEKCQlyZXQgPSB0aGlzQ2FjaGVbIG5hbWUgXTsKCgkJLy8gVGVzdCBmb3IgbnVsbHx1bmRlZmluZWQgcHJvcGVydHkgZGF0YQoJCWlmICggcmV0ID09IG51bGwgKSB7CgoJCQkvLyBUcnkgdG8gZmluZCB0aGUgY2FtZWxDYXNlZCBwcm9wZXJ0eQoJCQlyZXQgPSB0aGlzQ2FjaGVbIGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKSBdOwoJCX0KCX0gZWxzZSB7CgkJcmV0ID0gdGhpc0NhY2hlOwoJfQoKCXJldHVybiByZXQ7Cn0KCmZ1bmN0aW9uIGludGVybmFsUmVtb3ZlRGF0YSggZWxlbSwgbmFtZSwgcHZ0ICkgewoJaWYgKCAhYWNjZXB0RGF0YSggZWxlbSApICkgewoJCXJldHVybjsKCX0KCgl2YXIgdGhpc0NhY2hlLCBpLAoJCWlzTm9kZSA9IGVsZW0ubm9kZVR5cGUsCgoJCS8vIFNlZSBqUXVlcnkuZGF0YSBmb3IgbW9yZSBpbmZvcm1hdGlvbgoJCWNhY2hlID0gaXNOb2RlID8galF1ZXJ5LmNhY2hlIDogZWxlbSwKCQlpZCA9IGlzTm9kZSA/IGVsZW1bIGpRdWVyeS5leHBhbmRvIF0gOiBqUXVlcnkuZXhwYW5kbzsKCgkvLyBJZiB0aGVyZSBpcyBhbHJlYWR5IG5vIGNhY2hlIGVudHJ5IGZvciB0aGlzIG9iamVjdCwgdGhlcmUgaXMgbm8KCS8vIHB1cnBvc2UgaW4gY29udGludWluZwoJaWYgKCAhY2FjaGVbIGlkIF0gKSB7CgkJcmV0dXJuOwoJfQoKCWlmICggbmFtZSApIHsKCgkJdGhpc0NhY2hlID0gcHZ0ID8gY2FjaGVbIGlkIF0gOiBjYWNoZVsgaWQgXS5kYXRhOwoKCQlpZiAoIHRoaXNDYWNoZSApIHsKCgkJCS8vIFN1cHBvcnQgYXJyYXkgb3Igc3BhY2Ugc2VwYXJhdGVkIHN0cmluZyBuYW1lcyBmb3IgZGF0YSBrZXlzCgkJCWlmICggIWpRdWVyeS5pc0FycmF5KCBuYW1lICkgKSB7CgoJCQkJLy8gdHJ5IHRoZSBzdHJpbmcgYXMgYSBrZXkgYmVmb3JlIGFueSBtYW5pcHVsYXRpb24KCQkJCWlmICggbmFtZSBpbiB0aGlzQ2FjaGUgKSB7CgkJCQkJbmFtZSA9IFsgbmFtZSBdOwoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gc3BsaXQgdGhlIGNhbWVsIGNhc2VkIHZlcnNpb24gYnkgc3BhY2VzIHVubGVzcyBhIGtleSB3aXRoIHRoZSBzcGFjZXMgZXhpc3RzCgkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKTsKCQkJCQlpZiAoIG5hbWUgaW4gdGhpc0NhY2hlICkgewoJCQkJCQluYW1lID0gWyBuYW1lIF07CgkJCQkJfSBlbHNlIHsKCQkJCQkJbmFtZSA9IG5hbWUuc3BsaXQoICIgIiApOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCgkJCQkvLyBJZiAibmFtZSIgaXMgYW4gYXJyYXkgb2Yga2V5cy4uLgoJCQkJLy8gV2hlbiBkYXRhIGlzIGluaXRpYWxseSBjcmVhdGVkLCB2aWEgKCJrZXkiLCAidmFsIikgc2lnbmF0dXJlLAoJCQkJLy8ga2V5cyB3aWxsIGJlIGNvbnZlcnRlZCB0byBjYW1lbENhc2UuCgkJCQkvLyBTaW5jZSB0aGVyZSBpcyBubyB3YXkgdG8gdGVsbCBfaG93XyBhIGtleSB3YXMgYWRkZWQsIHJlbW92ZQoJCQkJLy8gYm90aCBwbGFpbiBrZXkgYW5kIGNhbWVsQ2FzZSBrZXkuICMxMjc4NgoJCQkJLy8gVGhpcyB3aWxsIG9ubHkgcGVuYWxpemUgdGhlIGFycmF5IGFyZ3VtZW50IHBhdGguCgkJCQluYW1lID0gbmFtZS5jb25jYXQoIGpRdWVyeS5tYXAoIG5hbWUsIGpRdWVyeS5jYW1lbENhc2UgKSApOwoJCQl9CgoJCQlpID0gbmFtZS5sZW5ndGg7CgkJCXdoaWxlICggaS0tICkgewoJCQkJZGVsZXRlIHRoaXNDYWNoZVsgbmFtZVsgaSBdIF07CgkJCX0KCgkJCS8vIElmIHRoZXJlIGlzIG5vIGRhdGEgbGVmdCBpbiB0aGUgY2FjaGUsIHdlIHdhbnQgdG8gY29udGludWUKCQkJLy8gYW5kIGxldCB0aGUgY2FjaGUgb2JqZWN0IGl0c2VsZiBnZXQgZGVzdHJveWVkCgkJCWlmICggcHZ0ID8gIWlzRW1wdHlEYXRhT2JqZWN0KCB0aGlzQ2FjaGUgKSA6ICFqUXVlcnkuaXNFbXB0eU9iamVjdCggdGhpc0NhY2hlICkgKSB7CgkJCQlyZXR1cm47CgkJCX0KCQl9Cgl9CgoJLy8gU2VlIGpRdWVyeS5kYXRhIGZvciBtb3JlIGluZm9ybWF0aW9uCglpZiAoICFwdnQgKSB7CgkJZGVsZXRlIGNhY2hlWyBpZCBdLmRhdGE7CgoJCS8vIERvbid0IGRlc3Ryb3kgdGhlIHBhcmVudCBjYWNoZSB1bmxlc3MgdGhlIGludGVybmFsIGRhdGEgb2JqZWN0CgkJLy8gaGFkIGJlZW4gdGhlIG9ubHkgdGhpbmcgbGVmdCBpbiBpdAoJCWlmICggIWlzRW1wdHlEYXRhT2JqZWN0KCBjYWNoZVsgaWQgXSApICkgewoJCQlyZXR1cm47CgkJfQoJfQoKCS8vIERlc3Ryb3kgdGhlIGNhY2hlCglpZiAoIGlzTm9kZSApIHsKCQlqUXVlcnkuY2xlYW5EYXRhKCBbIGVsZW0gXSwgdHJ1ZSApOwoKCS8vIFVzZSBkZWxldGUgd2hlbiBzdXBwb3J0ZWQgZm9yIGV4cGFuZG9zIG9yIGBjYWNoZWAgaXMgbm90IGEgd2luZG93IHBlciBpc1dpbmRvdyAoIzEwMDgwKQoJLyoganNoaW50IGVxZXFlcTogZmFsc2UgKi8KCX0gZWxzZSBpZiAoIHN1cHBvcnQuZGVsZXRlRXhwYW5kbyB8fCBjYWNoZSAhPSBjYWNoZS53aW5kb3cgKSB7CgkJLyoganNoaW50IGVxZXFlcTogdHJ1ZSAqLwoJCWRlbGV0ZSBjYWNoZVsgaWQgXTsKCgkvLyBXaGVuIGFsbCBlbHNlIGZhaWxzLCB1bmRlZmluZWQKCX0gZWxzZSB7CgkJY2FjaGVbIGlkIF0gPSB1bmRlZmluZWQ7Cgl9Cn0KCmpRdWVyeS5leHRlbmQoIHsKCWNhY2hlOiB7fSwKCgkvLyBUaGUgZm9sbG93aW5nIGVsZW1lbnRzIChzcGFjZS1zdWZmaXhlZCB0byBhdm9pZCBPYmplY3QucHJvdG90eXBlIGNvbGxpc2lvbnMpCgkvLyB0aHJvdyB1bmNhdGNoYWJsZSBleGNlcHRpb25zIGlmIHlvdSBhdHRlbXB0IHRvIHNldCBleHBhbmRvIHByb3BlcnRpZXMKCW5vRGF0YTogewoJCSJhcHBsZXQgIjogdHJ1ZSwKCQkiZW1iZWQgIjogdHJ1ZSwKCgkJLy8gLi4uYnV0IEZsYXNoIG9iamVjdHMgKHdoaWNoIGhhdmUgdGhpcyBjbGFzc2lkKSAqY2FuKiBoYW5kbGUgZXhwYW5kb3MKCQkib2JqZWN0ICI6ICJjbHNpZDpEMjdDREI2RS1BRTZELTExY2YtOTZCOC00NDQ1NTM1NDAwMDAiCgl9LAoKCWhhc0RhdGE6IGZ1bmN0aW9uKCBlbGVtICkgewoJCWVsZW0gPSBlbGVtLm5vZGVUeXBlID8galF1ZXJ5LmNhY2hlWyBlbGVtWyBqUXVlcnkuZXhwYW5kbyBdIF0gOiBlbGVtWyBqUXVlcnkuZXhwYW5kbyBdOwoJCXJldHVybiAhIWVsZW0gJiYgIWlzRW1wdHlEYXRhT2JqZWN0KCBlbGVtICk7Cgl9LAoKCWRhdGE6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBkYXRhICkgewoJCXJldHVybiBpbnRlcm5hbERhdGEoIGVsZW0sIG5hbWUsIGRhdGEgKTsKCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJcmV0dXJuIGludGVybmFsUmVtb3ZlRGF0YSggZWxlbSwgbmFtZSApOwoJfSwKCgkvLyBGb3IgaW50ZXJuYWwgdXNlIG9ubHkuCglfZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEgKSB7CgkJcmV0dXJuIGludGVybmFsRGF0YSggZWxlbSwgbmFtZSwgZGF0YSwgdHJ1ZSApOwoJfSwKCglfcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJcmV0dXJuIGludGVybmFsUmVtb3ZlRGF0YSggZWxlbSwgbmFtZSwgdHJ1ZSApOwoJfQp9ICk7CgpqUXVlcnkuZm4uZXh0ZW5kKCB7CglkYXRhOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQl2YXIgaSwgbmFtZSwgZGF0YSwKCQkJZWxlbSA9IHRoaXNbIDAgXSwKCQkJYXR0cnMgPSBlbGVtICYmIGVsZW0uYXR0cmlidXRlczsKCgkJLy8gU3BlY2lhbCBleHBlY3Rpb25zIG9mIC5kYXRhIGJhc2ljYWxseSB0aHdhcnQgalF1ZXJ5LmFjY2VzcywKCQkvLyBzbyBpbXBsZW1lbnQgdGhlIHJlbGV2YW50IGJlaGF2aW9yIG91cnNlbHZlcwoKCQkvLyBHZXRzIGFsbCB2YWx1ZXMKCQlpZiAoIGtleSA9PT0gdW5kZWZpbmVkICkgewoJCQlpZiAoIHRoaXMubGVuZ3RoICkgewoJCQkJZGF0YSA9IGpRdWVyeS5kYXRhKCBlbGVtICk7CgoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICFqUXVlcnkuX2RhdGEoIGVsZW0sICJwYXJzZWRBdHRycyIgKSApIHsKCQkJCQlpID0gYXR0cnMubGVuZ3RoOwoJCQkJCXdoaWxlICggaS0tICkgewoKCQkJCQkJLy8gU3VwcG9ydDogSUUxMSsKCQkJCQkJLy8gVGhlIGF0dHJzIGVsZW1lbnRzIGNhbiBiZSBudWxsICgjMTQ4OTQpCgkJCQkJCWlmICggYXR0cnNbIGkgXSApIHsKCQkJCQkJCW5hbWUgPSBhdHRyc1sgaSBdLm5hbWU7CgkJCQkJCQlpZiAoIG5hbWUuaW5kZXhPZiggImRhdGEtIiApID09PSAwICkgewoJCQkJCQkJCW5hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lLnNsaWNlKCA1ICkgKTsKCQkJCQkJCQlkYXRhQXR0ciggZWxlbSwgbmFtZSwgZGF0YVsgbmFtZSBdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQkJalF1ZXJ5Ll9kYXRhKCBlbGVtLCAicGFyc2VkQXR0cnMiLCB0cnVlICk7CgkJCQl9CgkJCX0KCgkJCXJldHVybiBkYXRhOwoJCX0KCgkJLy8gU2V0cyBtdWx0aXBsZSB2YWx1ZXMKCQlpZiAoIHR5cGVvZiBrZXkgPT09ICJvYmplY3QiICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbigpIHsKCQkJCWpRdWVyeS5kYXRhKCB0aGlzLCBrZXkgKTsKCQkJfSApOwoJCX0KCgkJcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPiAxID8KCgkJCS8vIFNldHMgb25lIHZhbHVlCgkJCXRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCQlqUXVlcnkuZGF0YSggdGhpcywga2V5LCB2YWx1ZSApOwoJCQl9ICkgOgoKCQkJLy8gR2V0cyBvbmUgdmFsdWUKCQkJLy8gVHJ5IHRvIGZldGNoIGFueSBpbnRlcm5hbGx5IHN0b3JlZCBkYXRhIGZpcnN0CgkJCWVsZW0gPyBkYXRhQXR0ciggZWxlbSwga2V5LCBqUXVlcnkuZGF0YSggZWxlbSwga2V5ICkgKSA6IHVuZGVmaW5lZDsKCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGtleSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbigpIHsKCQkJalF1ZXJ5LnJlbW92ZURhdGEoIHRoaXMsIGtleSApOwoJCX0gKTsKCX0KfSApOwoKCmpRdWVyeS5leHRlbmQoIHsKCXF1ZXVlOiBmdW5jdGlvbiggZWxlbSwgdHlwZSwgZGF0YSApIHsKCQl2YXIgcXVldWU7CgoJCWlmICggZWxlbSApIHsKCQkJdHlwZSA9ICggdHlwZSB8fCAiZngiICkgKyAicXVldWUiOwoJCQlxdWV1ZSA9IGpRdWVyeS5fZGF0YSggZWxlbSwgdHlwZSApOwoKCQkJLy8gU3BlZWQgdXAgZGVxdWV1ZSBieSBnZXR0aW5nIG91dCBxdWlja2x5IGlmIHRoaXMgaXMganVzdCBhIGxvb2t1cAoJCQlpZiAoIGRhdGEgKSB7CgkJCQlpZiAoICFxdWV1ZSB8fCBqUXVlcnkuaXNBcnJheSggZGF0YSApICkgewoJCQkJCXF1ZXVlID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlLCBqUXVlcnkubWFrZUFycmF5KCBkYXRhICkgKTsKCQkJCX0gZWxzZSB7CgkJCQkJcXVldWUucHVzaCggZGF0YSApOwoJCQkJfQoJCQl9CgkJCXJldHVybiBxdWV1ZSB8fCBbXTsKCQl9Cgl9LAoKCWRlcXVldWU6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlICkgewoJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgoJCXZhciBxdWV1ZSA9IGpRdWVyeS5xdWV1ZSggZWxlbSwgdHlwZSApLAoJCQlzdGFydExlbmd0aCA9IHF1ZXVlLmxlbmd0aCwKCQkJZm4gPSBxdWV1ZS5zaGlmdCgpLAoJCQlob29rcyA9IGpRdWVyeS5fcXVldWVIb29rcyggZWxlbSwgdHlwZSApLAoJCQluZXh0ID0gZnVuY3Rpb24oKSB7CgkJCQlqUXVlcnkuZGVxdWV1ZSggZWxlbSwgdHlwZSApOwoJCQl9OwoKCQkvLyBJZiB0aGUgZnggcXVldWUgaXMgZGVxdWV1ZWQsIGFsd2F5cyByZW1vdmUgdGhlIHByb2dyZXNzIHNlbnRpbmVsCgkJaWYgKCBmbiA9PT0gImlucHJvZ3Jlc3MiICkgewoJCQlmbiA9IHF1ZXVlLnNoaWZ0KCk7CgkJCXN0YXJ0TGVuZ3RoLS07CgkJfQoKCQlpZiAoIGZuICkgewoKCQkJLy8gQWRkIGEgcHJvZ3Jlc3Mgc2VudGluZWwgdG8gcHJldmVudCB0aGUgZnggcXVldWUgZnJvbSBiZWluZwoJCQkvLyBhdXRvbWF0aWNhbGx5IGRlcXVldWVkCgkJCWlmICggdHlwZSA9PT0gImZ4IiApIHsKCQkJCXF1ZXVlLnVuc2hpZnQoICJpbnByb2dyZXNzIiApOwoJCQl9CgoJCQkvLyBjbGVhciB1cCB0aGUgbGFzdCBxdWV1ZSBzdG9wIGZ1bmN0aW9uCgkJCWRlbGV0ZSBob29rcy5zdG9wOwoJCQlmbi5jYWxsKCBlbGVtLCBuZXh0LCBob29rcyApOwoJCX0KCgkJaWYgKCAhc3RhcnRMZW5ndGggJiYgaG9va3MgKSB7CgkJCWhvb2tzLmVtcHR5LmZpcmUoKTsKCQl9Cgl9LAoKCS8vIG5vdCBpbnRlbmRlZCBmb3IgcHVibGljIGNvbnN1bXB0aW9uIC0gZ2VuZXJhdGVzIGEgcXVldWVIb29rcyBvYmplY3QsCgkvLyBvciByZXR1cm5zIHRoZSBjdXJyZW50IG9uZQoJX3F1ZXVlSG9va3M6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlICkgewoJCXZhciBrZXkgPSB0eXBlICsgInF1ZXVlSG9va3MiOwoJCXJldHVybiBqUXVlcnkuX2RhdGEoIGVsZW0sIGtleSApIHx8IGpRdWVyeS5fZGF0YSggZWxlbSwga2V5LCB7CgkJCWVtcHR5OiBqUXVlcnkuQ2FsbGJhY2tzKCAib25jZSBtZW1vcnkiICkuYWRkKCBmdW5jdGlvbigpIHsKCQkJCWpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwgdHlwZSArICJxdWV1ZSIgKTsKCQkJCWpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwga2V5ICk7CgkJCX0gKQoJCX0gKTsKCX0KfSApOwoKalF1ZXJ5LmZuLmV4dGVuZCggewoJcXVldWU6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkgewoJCXZhciBzZXR0ZXIgPSAyOwoKCQlpZiAoIHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJZGF0YSA9IHR5cGU7CgkJCXR5cGUgPSAiZngiOwoJCQlzZXR0ZXItLTsKCQl9CgoJCWlmICggYXJndW1lbnRzLmxlbmd0aCA8IHNldHRlciApIHsKCQkJcmV0dXJuIGpRdWVyeS5xdWV1ZSggdGhpc1sgMCBdLCB0eXBlICk7CgkJfQoKCQlyZXR1cm4gZGF0YSA9PT0gdW5kZWZpbmVkID8KCQkJdGhpcyA6CgkJCXRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCQl2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIHRoaXMsIHR5cGUsIGRhdGEgKTsKCgkJCQkvLyBlbnN1cmUgYSBob29rcyBmb3IgdGhpcyBxdWV1ZQoJCQkJalF1ZXJ5Ll9xdWV1ZUhvb2tzKCB0aGlzLCB0eXBlICk7CgoJCQkJaWYgKCB0eXBlID09PSAiZngiICYmIHF1ZXVlWyAwIF0gIT09ICJpbnByb2dyZXNzIiApIHsKCQkJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCQkJfQoJCQl9ICk7Cgl9LAoJZGVxdWV1ZTogZnVuY3Rpb24oIHR5cGUgKSB7CgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJfSApOwoJfSwKCWNsZWFyUXVldWU6IGZ1bmN0aW9uKCB0eXBlICkgewoJCXJldHVybiB0aGlzLnF1ZXVlKCB0eXBlIHx8ICJmeCIsIFtdICk7Cgl9LAoKCS8vIEdldCBhIHByb21pc2UgcmVzb2x2ZWQgd2hlbiBxdWV1ZXMgb2YgYSBjZXJ0YWluIHR5cGUKCS8vIGFyZSBlbXB0aWVkIChmeCBpcyB0aGUgdHlwZSBieSBkZWZhdWx0KQoJcHJvbWlzZTogZnVuY3Rpb24oIHR5cGUsIG9iaiApIHsKCQl2YXIgdG1wLAoJCQljb3VudCA9IDEsCgkJCWRlZmVyID0galF1ZXJ5LkRlZmVycmVkKCksCgkJCWVsZW1lbnRzID0gdGhpcywKCQkJaSA9IHRoaXMubGVuZ3RoLAoJCQlyZXNvbHZlID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAoICEoIC0tY291bnQgKSApIHsKCQkJCQlkZWZlci5yZXNvbHZlV2l0aCggZWxlbWVudHMsIFsgZWxlbWVudHMgXSApOwoJCQkJfQoJCQl9OwoKCQlpZiAoIHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJb2JqID0gdHlwZTsKCQkJdHlwZSA9IHVuZGVmaW5lZDsKCQl9CgkJdHlwZSA9IHR5cGUgfHwgImZ4IjsKCgkJd2hpbGUgKCBpLS0gKSB7CgkJCXRtcCA9IGpRdWVyeS5fZGF0YSggZWxlbWVudHNbIGkgXSwgdHlwZSArICJxdWV1ZUhvb2tzIiApOwoJCQlpZiAoIHRtcCAmJiB0bXAuZW1wdHkgKSB7CgkJCQljb3VudCsrOwoJCQkJdG1wLmVtcHR5LmFkZCggcmVzb2x2ZSApOwoJCQl9CgkJfQoJCXJlc29sdmUoKTsKCQlyZXR1cm4gZGVmZXIucHJvbWlzZSggb2JqICk7Cgl9Cn0gKTsKCgooIGZ1bmN0aW9uKCkgewoJdmFyIHNocmlua1dyYXBCbG9ja3NWYWw7CgoJc3VwcG9ydC5zaHJpbmtXcmFwQmxvY2tzID0gZnVuY3Rpb24oKSB7CgkJaWYgKCBzaHJpbmtXcmFwQmxvY2tzVmFsICE9IG51bGwgKSB7CgkJCXJldHVybiBzaHJpbmtXcmFwQmxvY2tzVmFsOwoJCX0KCgkJLy8gV2lsbCBiZSBjaGFuZ2VkIGxhdGVyIGlmIG5lZWRlZC4KCQlzaHJpbmtXcmFwQmxvY2tzVmFsID0gZmFsc2U7CgoJCS8vIE1pbmlmaWVkOiB2YXIgYixjLGQKCQl2YXIgZGl2LCBib2R5LCBjb250YWluZXI7CgoJCWJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSggImJvZHkiIClbIDAgXTsKCQlpZiAoICFib2R5IHx8ICFib2R5LnN0eWxlICkgewoKCQkJLy8gVGVzdCBmaXJlZCB0b28gZWFybHkgb3IgaW4gYW4gdW5zdXBwb3J0ZWQgZW52aXJvbm1lbnQsIGV4aXQuCgkJCXJldHVybjsKCQl9CgoJCS8vIFNldHVwCgkJZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKTsKCQljb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoJCWNvbnRhaW5lci5zdHlsZS5jc3NUZXh0ID0gInBvc2l0aW9uOmFic29sdXRlO2JvcmRlcjowO3dpZHRoOjA7aGVpZ2h0OjA7dG9wOjA7bGVmdDotOTk5OXB4IjsKCQlib2R5LmFwcGVuZENoaWxkKCBjb250YWluZXIgKS5hcHBlbmRDaGlsZCggZGl2ICk7CgoJCS8vIFN1cHBvcnQ6IElFNgoJCS8vIENoZWNrIGlmIGVsZW1lbnRzIHdpdGggbGF5b3V0IHNocmluay13cmFwIHRoZWlyIGNoaWxkcmVuCgkJaWYgKCB0eXBlb2YgZGl2LnN0eWxlLnpvb20gIT09ICJ1bmRlZmluZWQiICkgewoKCQkJLy8gUmVzZXQgQ1NTOiBib3gtc2l6aW5nOyBkaXNwbGF5OyBtYXJnaW47IGJvcmRlcgoJCQlkaXYuc3R5bGUuY3NzVGV4dCA9CgoJCQkJLy8gU3VwcG9ydDogRmlyZWZveDwyOSwgQW5kcm9pZCAyLjMKCQkJCS8vIFZlbmRvci1wcmVmaXggYm94LXNpemluZwoJCQkJIi13ZWJraXQtYm94LXNpemluZzpjb250ZW50LWJveDstbW96LWJveC1zaXppbmc6Y29udGVudC1ib3g7IiArCgkJCQkiYm94LXNpemluZzpjb250ZW50LWJveDtkaXNwbGF5OmJsb2NrO21hcmdpbjowO2JvcmRlcjowOyIgKwoJCQkJInBhZGRpbmc6MXB4O3dpZHRoOjFweDt6b29tOjEiOwoJCQlkaXYuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICkgKS5zdHlsZS53aWR0aCA9ICI1cHgiOwoJCQlzaHJpbmtXcmFwQmxvY2tzVmFsID0gZGl2Lm9mZnNldFdpZHRoICE9PSAzOwoJCX0KCgkJYm9keS5yZW1vdmVDaGlsZCggY29udGFpbmVyICk7CgoJCXJldHVybiBzaHJpbmtXcmFwQmxvY2tzVmFsOwoJfTsKCn0gKSgpOwp2YXIgcG51bSA9ICggL1srLV0/KD86XGQqXC58KVxkKyg/OltlRV1bKy1dP1xkK3wpLyApLnNvdXJjZTsKCnZhciByY3NzTnVtID0gbmV3IFJlZ0V4cCggIl4oPzooWystXSk9fCkoIiArIHBudW0gKyAiKShbYS16JV0qKSQiLCAiaSIgKTsKCgp2YXIgY3NzRXhwYW5kID0gWyAiVG9wIiwgIlJpZ2h0IiwgIkJvdHRvbSIsICJMZWZ0IiBdOwoKdmFyIGlzSGlkZGVuID0gZnVuY3Rpb24oIGVsZW0sIGVsICkgewoKCQkvLyBpc0hpZGRlbiBtaWdodCBiZSBjYWxsZWQgZnJvbSBqUXVlcnkjZmlsdGVyIGZ1bmN0aW9uOwoJCS8vIGluIHRoYXQgY2FzZSwgZWxlbWVudCB3aWxsIGJlIHNlY29uZCBhcmd1bWVudAoJCWVsZW0gPSBlbCB8fCBlbGVtOwoJCXJldHVybiBqUXVlcnkuY3NzKCBlbGVtLCAiZGlzcGxheSIgKSA9PT0gIm5vbmUiIHx8CgkJCSFqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApOwoJfTsKCgoKZnVuY3Rpb24gYWRqdXN0Q1NTKCBlbGVtLCBwcm9wLCB2YWx1ZVBhcnRzLCB0d2VlbiApIHsKCXZhciBhZGp1c3RlZCwKCQlzY2FsZSA9IDEsCgkJbWF4SXRlcmF0aW9ucyA9IDIwLAoJCWN1cnJlbnRWYWx1ZSA9IHR3ZWVuID8KCQkJZnVuY3Rpb24oKSB7IHJldHVybiB0d2Vlbi5jdXIoKTsgfSA6CgkJCWZ1bmN0aW9uKCkgeyByZXR1cm4galF1ZXJ5LmNzcyggZWxlbSwgcHJvcCwgIiIgKTsgfSwKCQlpbml0aWFsID0gY3VycmVudFZhbHVlKCksCgkJdW5pdCA9IHZhbHVlUGFydHMgJiYgdmFsdWVQYXJ0c1sgMyBdIHx8ICggalF1ZXJ5LmNzc051bWJlclsgcHJvcCBdID8gIiIgOiAicHgiICksCgoJCS8vIFN0YXJ0aW5nIHZhbHVlIGNvbXB1dGF0aW9uIGlzIHJlcXVpcmVkIGZvciBwb3RlbnRpYWwgdW5pdCBtaXNtYXRjaGVzCgkJaW5pdGlhbEluVW5pdCA9ICggalF1ZXJ5LmNzc051bWJlclsgcHJvcCBdIHx8IHVuaXQgIT09ICJweCIgJiYgK2luaXRpYWwgKSAmJgoJCQlyY3NzTnVtLmV4ZWMoIGpRdWVyeS5jc3MoIGVsZW0sIHByb3AgKSApOwoKCWlmICggaW5pdGlhbEluVW5pdCAmJiBpbml0aWFsSW5Vbml0WyAzIF0gIT09IHVuaXQgKSB7CgoJCS8vIFRydXN0IHVuaXRzIHJlcG9ydGVkIGJ5IGpRdWVyeS5jc3MKCQl1bml0ID0gdW5pdCB8fCBpbml0aWFsSW5Vbml0WyAzIF07CgoJCS8vIE1ha2Ugc3VyZSB3ZSB1cGRhdGUgdGhlIHR3ZWVuIHByb3BlcnRpZXMgbGF0ZXIgb24KCQl2YWx1ZVBhcnRzID0gdmFsdWVQYXJ0cyB8fCBbXTsKCgkJLy8gSXRlcmF0aXZlbHkgYXBwcm94aW1hdGUgZnJvbSBhIG5vbnplcm8gc3RhcnRpbmcgcG9pbnQKCQlpbml0aWFsSW5Vbml0ID0gK2luaXRpYWwgfHwgMTsKCgkJZG8gewoKCQkJLy8gSWYgcHJldmlvdXMgaXRlcmF0aW9uIHplcm9lZCBvdXQsIGRvdWJsZSB1bnRpbCB3ZSBnZXQgKnNvbWV0aGluZyouCgkJCS8vIFVzZSBzdHJpbmcgZm9yIGRvdWJsaW5nIHNvIHdlIGRvbid0IGFjY2lkZW50YWxseSBzZWUgc2NhbGUgYXMgdW5jaGFuZ2VkIGJlbG93CgkJCXNjYWxlID0gc2NhbGUgfHwgIi41IjsKCgkJCS8vIEFkanVzdCBhbmQgYXBwbHkKCQkJaW5pdGlhbEluVW5pdCA9IGluaXRpYWxJblVuaXQgLyBzY2FsZTsKCQkJalF1ZXJ5LnN0eWxlKCBlbGVtLCBwcm9wLCBpbml0aWFsSW5Vbml0ICsgdW5pdCApOwoKCQkvLyBVcGRhdGUgc2NhbGUsIHRvbGVyYXRpbmcgemVybyBvciBOYU4gZnJvbSB0d2Vlbi5jdXIoKQoJCS8vIEJyZWFrIHRoZSBsb29wIGlmIHNjYWxlIGlzIHVuY2hhbmdlZCBvciBwZXJmZWN0LCBvciBpZiB3ZSd2ZSBqdXN0IGhhZCBlbm91Z2guCgkJfSB3aGlsZSAoCgkJCXNjYWxlICE9PSAoIHNjYWxlID0gY3VycmVudFZhbHVlKCkgLyBpbml0aWFsICkgJiYgc2NhbGUgIT09IDEgJiYgLS1tYXhJdGVyYXRpb25zCgkJKTsKCX0KCglpZiAoIHZhbHVlUGFydHMgKSB7CgkJaW5pdGlhbEluVW5pdCA9ICtpbml0aWFsSW5Vbml0IHx8ICtpbml0aWFsIHx8IDA7CgoJCS8vIEFwcGx5IHJlbGF0aXZlIG9mZnNldCAoKz0vLT0pIGlmIHNwZWNpZmllZAoJCWFkanVzdGVkID0gdmFsdWVQYXJ0c1sgMSBdID8KCQkJaW5pdGlhbEluVW5pdCArICggdmFsdWVQYXJ0c1sgMSBdICsgMSApICogdmFsdWVQYXJ0c1sgMiBdIDoKCQkJK3ZhbHVlUGFydHNbIDIgXTsKCQlpZiAoIHR3ZWVuICkgewoJCQl0d2Vlbi51bml0ID0gdW5pdDsKCQkJdHdlZW4uc3RhcnQgPSBpbml0aWFsSW5Vbml0OwoJCQl0d2Vlbi5lbmQgPSBhZGp1c3RlZDsKCQl9Cgl9CglyZXR1cm4gYWRqdXN0ZWQ7Cn0KCgovLyBNdWx0aWZ1bmN0aW9uYWwgbWV0aG9kIHRvIGdldCBhbmQgc2V0IHZhbHVlcyBvZiBhIGNvbGxlY3Rpb24KLy8gVGhlIHZhbHVlL3MgY2FuIG9wdGlvbmFsbHkgYmUgZXhlY3V0ZWQgaWYgaXQncyBhIGZ1bmN0aW9uCnZhciBhY2Nlc3MgPSBmdW5jdGlvbiggZWxlbXMsIGZuLCBrZXksIHZhbHVlLCBjaGFpbmFibGUsIGVtcHR5R2V0LCByYXcgKSB7Cgl2YXIgaSA9IDAsCgkJbGVuZ3RoID0gZWxlbXMubGVuZ3RoLAoJCWJ1bGsgPSBrZXkgPT0gbnVsbDsKCgkvLyBTZXRzIG1hbnkgdmFsdWVzCglpZiAoIGpRdWVyeS50eXBlKCBrZXkgKSA9PT0gIm9iamVjdCIgKSB7CgkJY2hhaW5hYmxlID0gdHJ1ZTsKCQlmb3IgKCBpIGluIGtleSApIHsKCQkJYWNjZXNzKCBlbGVtcywgZm4sIGksIGtleVsgaSBdLCB0cnVlLCBlbXB0eUdldCwgcmF3ICk7CgkJfQoKCS8vIFNldHMgb25lIHZhbHVlCgl9IGVsc2UgaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCWNoYWluYWJsZSA9IHRydWU7CgoJCWlmICggIWpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyYXcgPSB0cnVlOwoJCX0KCgkJaWYgKCBidWxrICkgewoKCQkJLy8gQnVsayBvcGVyYXRpb25zIHJ1biBhZ2FpbnN0IHRoZSBlbnRpcmUgc2V0CgkJCWlmICggcmF3ICkgewoJCQkJZm4uY2FsbCggZWxlbXMsIHZhbHVlICk7CgkJCQlmbiA9IG51bGw7CgoJCQkvLyAuLi5leGNlcHQgd2hlbiBleGVjdXRpbmcgZnVuY3Rpb24gdmFsdWVzCgkJCX0gZWxzZSB7CgkJCQlidWxrID0gZm47CgkJCQlmbiA9IGZ1bmN0aW9uKCBlbGVtLCBrZXksIHZhbHVlICkgewoJCQkJCXJldHVybiBidWxrLmNhbGwoIGpRdWVyeSggZWxlbSApLCB2YWx1ZSApOwoJCQkJfTsKCQkJfQoJCX0KCgkJaWYgKCBmbiApIHsKCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQlmbigKCQkJCQllbGVtc1sgaSBdLAoJCQkJCWtleSwKCQkJCQlyYXcgPyB2YWx1ZSA6IHZhbHVlLmNhbGwoIGVsZW1zWyBpIF0sIGksIGZuKCBlbGVtc1sgaSBdLCBrZXkgKSApCgkJCQkpOwoJCQl9CgkJfQoJfQoKCXJldHVybiBjaGFpbmFibGUgPwoJCWVsZW1zIDoKCgkJLy8gR2V0cwoJCWJ1bGsgPwoJCQlmbi5jYWxsKCBlbGVtcyApIDoKCQkJbGVuZ3RoID8gZm4oIGVsZW1zWyAwIF0sIGtleSApIDogZW1wdHlHZXQ7Cn07CnZhciByY2hlY2thYmxlVHlwZSA9ICggL14oPzpjaGVja2JveHxyYWRpbykkL2kgKTsKCnZhciBydGFnTmFtZSA9ICggLzwoW1x3Oi1dKykvICk7Cgp2YXIgcnNjcmlwdFR5cGUgPSAoIC9eJHxcLyg/OmphdmF8ZWNtYSlzY3JpcHQvaSApOwoKdmFyIHJsZWFkaW5nV2hpdGVzcGFjZSA9ICggL15ccysvICk7Cgp2YXIgbm9kZU5hbWVzID0gImFiYnJ8YXJ0aWNsZXxhc2lkZXxhdWRpb3xiZGl8Y2FudmFzfGRhdGF8ZGF0YWxpc3R8IiArCgkJImRldGFpbHN8ZGlhbG9nfGZpZ2NhcHRpb258ZmlndXJlfGZvb3RlcnxoZWFkZXJ8aGdyb3VwfG1haW58IiArCgkJIm1hcmt8bWV0ZXJ8bmF2fG91dHB1dHxwaWN0dXJlfHByb2dyZXNzfHNlY3Rpb258c3VtbWFyeXx0ZW1wbGF0ZXx0aW1lfHZpZGVvIjsKCgoKZnVuY3Rpb24gY3JlYXRlU2FmZUZyYWdtZW50KCBkb2N1bWVudCApIHsKCXZhciBsaXN0ID0gbm9kZU5hbWVzLnNwbGl0KCAifCIgKSwKCQlzYWZlRnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKCglpZiAoIHNhZmVGcmFnLmNyZWF0ZUVsZW1lbnQgKSB7CgkJd2hpbGUgKCBsaXN0Lmxlbmd0aCApIHsKCQkJc2FmZUZyYWcuY3JlYXRlRWxlbWVudCgKCQkJCWxpc3QucG9wKCkKCQkJKTsKCQl9Cgl9CglyZXR1cm4gc2FmZUZyYWc7Cn0KCgooIGZ1bmN0aW9uKCkgewoJdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICksCgkJZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksCgkJaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiaW5wdXQiICk7CgoJLy8gU2V0dXAKCWRpdi5pbm5lckhUTUwgPSAiICA8bGluay8+PHRhYmxlPjwvdGFibGU+PGEgaHJlZj0nL2EnPmE8L2E+PGlucHV0IHR5cGU9J2NoZWNrYm94Jy8+IjsKCgkvLyBJRSBzdHJpcHMgbGVhZGluZyB3aGl0ZXNwYWNlIHdoZW4gLmlubmVySFRNTCBpcyB1c2VkCglzdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlID0gZGl2LmZpcnN0Q2hpbGQubm9kZVR5cGUgPT09IDM7CgoJLy8gTWFrZSBzdXJlIHRoYXQgdGJvZHkgZWxlbWVudHMgYXJlbid0IGF1dG9tYXRpY2FsbHkgaW5zZXJ0ZWQKCS8vIElFIHdpbGwgaW5zZXJ0IHRoZW0gaW50byBlbXB0eSB0YWJsZXMKCXN1cHBvcnQudGJvZHkgPSAhZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCAidGJvZHkiICkubGVuZ3RoOwoKCS8vIE1ha2Ugc3VyZSB0aGF0IGxpbmsgZWxlbWVudHMgZ2V0IHNlcmlhbGl6ZWQgY29ycmVjdGx5IGJ5IGlubmVySFRNTAoJLy8gVGhpcyByZXF1aXJlcyBhIHdyYXBwZXIgZWxlbWVudCBpbiBJRQoJc3VwcG9ydC5odG1sU2VyaWFsaXplID0gISFkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICJsaW5rIiApLmxlbmd0aDsKCgkvLyBNYWtlcyBzdXJlIGNsb25pbmcgYW4gaHRtbDUgZWxlbWVudCBkb2VzIG5vdCBjYXVzZSBwcm9ibGVtcwoJLy8gV2hlcmUgb3V0ZXJIVE1MIGlzIHVuZGVmaW5lZCwgdGhpcyBzdGlsbCB3b3JrcwoJc3VwcG9ydC5odG1sNUNsb25lID0KCQlkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAibmF2IiApLmNsb25lTm9kZSggdHJ1ZSApLm91dGVySFRNTCAhPT0gIjw6bmF2PjwvOm5hdj4iOwoKCS8vIENoZWNrIGlmIGEgZGlzY29ubmVjdGVkIGNoZWNrYm94IHdpbGwgcmV0YWluIGl0cyBjaGVja2VkCgkvLyB2YWx1ZSBvZiB0cnVlIGFmdGVyIGFwcGVuZGVkIHRvIHRoZSBET00gKElFNi83KQoJaW5wdXQudHlwZSA9ICJjaGVja2JveCI7CglpbnB1dC5jaGVja2VkID0gdHJ1ZTsKCWZyYWdtZW50LmFwcGVuZENoaWxkKCBpbnB1dCApOwoJc3VwcG9ydC5hcHBlbmRDaGVja2VkID0gaW5wdXQuY2hlY2tlZDsKCgkvLyBNYWtlIHN1cmUgdGV4dGFyZWEgKGFuZCBjaGVja2JveCkgZGVmYXVsdFZhbHVlIGlzIHByb3Blcmx5IGNsb25lZAoJLy8gU3VwcG9ydDogSUU2LUlFMTErCglkaXYuaW5uZXJIVE1MID0gIjx0ZXh0YXJlYT54PC90ZXh0YXJlYT4iOwoJc3VwcG9ydC5ub0Nsb25lQ2hlY2tlZCA9ICEhZGl2LmNsb25lTm9kZSggdHJ1ZSApLmxhc3RDaGlsZC5kZWZhdWx0VmFsdWU7CgoJLy8gIzExMjE3IC0gV2ViS2l0IGxvc2VzIGNoZWNrIHdoZW4gdGhlIG5hbWUgaXMgYWZ0ZXIgdGhlIGNoZWNrZWQgYXR0cmlidXRlCglmcmFnbWVudC5hcHBlbmRDaGlsZCggZGl2ICk7CgoJLy8gU3VwcG9ydDogV2luZG93cyBXZWIgQXBwcyAoV1dBKQoJLy8gYG5hbWVgIGFuZCBgdHlwZWAgbXVzdCB1c2UgLnNldEF0dHJpYnV0ZSBmb3IgV1dBICgjMTQ5MDEpCglpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJpbnB1dCIgKTsKCWlucHV0LnNldEF0dHJpYnV0ZSggInR5cGUiLCAicmFkaW8iICk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoICJjaGVja2VkIiwgImNoZWNrZWQiICk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoICJuYW1lIiwgInQiICk7CgoJZGl2LmFwcGVuZENoaWxkKCBpbnB1dCApOwoKCS8vIFN1cHBvcnQ6IFNhZmFyaSA1LjEsIGlPUyA1LjEsIEFuZHJvaWQgNC54LCBBbmRyb2lkIDIuMwoJLy8gb2xkIFdlYktpdCBkb2Vzbid0IGNsb25lIGNoZWNrZWQgc3RhdGUgY29ycmVjdGx5IGluIGZyYWdtZW50cwoJc3VwcG9ydC5jaGVja0Nsb25lID0gZGl2LmNsb25lTm9kZSggdHJ1ZSApLmNsb25lTm9kZSggdHJ1ZSApLmxhc3RDaGlsZC5jaGVja2VkOwoKCS8vIFN1cHBvcnQ6IElFPDkKCS8vIENsb25lZCBlbGVtZW50cyBrZWVwIGF0dGFjaEV2ZW50IGhhbmRsZXJzLCB3ZSB1c2UgYWRkRXZlbnRMaXN0ZW5lciBvbiBJRTkrCglzdXBwb3J0Lm5vQ2xvbmVFdmVudCA9ICEhZGl2LmFkZEV2ZW50TGlzdGVuZXI7CgoJLy8gU3VwcG9ydDogSUU8OQoJLy8gU2luY2UgYXR0cmlidXRlcyBhbmQgcHJvcGVydGllcyBhcmUgdGhlIHNhbWUgaW4gSUUsCgkvLyBjbGVhbkRhdGEgbXVzdCBzZXQgcHJvcGVydGllcyB0byB1bmRlZmluZWQgcmF0aGVyIHRoYW4gdXNlIHJlbW92ZUF0dHJpYnV0ZQoJZGl2WyBqUXVlcnkuZXhwYW5kbyBdID0gMTsKCXN1cHBvcnQuYXR0cmlidXRlcyA9ICFkaXYuZ2V0QXR0cmlidXRlKCBqUXVlcnkuZXhwYW5kbyApOwp9ICkoKTsKCgovLyBXZSBoYXZlIHRvIGNsb3NlIHRoZXNlIHRhZ3MgdG8gc3VwcG9ydCBYSFRNTCAoIzEzMjAwKQp2YXIgd3JhcE1hcCA9IHsKCW9wdGlvbjogWyAxLCAiPHNlbGVjdCBtdWx0aXBsZT0nbXVsdGlwbGUnPiIsICI8L3NlbGVjdD4iIF0sCglsZWdlbmQ6IFsgMSwgIjxmaWVsZHNldD4iLCAiPC9maWVsZHNldD4iIF0sCglhcmVhOiBbIDEsICI8bWFwPiIsICI8L21hcD4iIF0sCgoJLy8gU3VwcG9ydDogSUU4CglwYXJhbTogWyAxLCAiPG9iamVjdD4iLCAiPC9vYmplY3Q+IiBdLAoJdGhlYWQ6IFsgMSwgIjx0YWJsZT4iLCAiPC90YWJsZT4iIF0sCgl0cjogWyAyLCAiPHRhYmxlPjx0Ym9keT4iLCAiPC90Ym9keT48L3RhYmxlPiIgXSwKCWNvbDogWyAyLCAiPHRhYmxlPjx0Ym9keT48L3Rib2R5Pjxjb2xncm91cD4iLCAiPC9jb2xncm91cD48L3RhYmxlPiIgXSwKCXRkOiBbIDMsICI8dGFibGU+PHRib2R5Pjx0cj4iLCAiPC90cj48L3Rib2R5PjwvdGFibGU+IiBdLAoKCS8vIElFNi04IGNhbid0IHNlcmlhbGl6ZSBsaW5rLCBzY3JpcHQsIHN0eWxlLCBvciBhbnkgaHRtbDUgKE5vU2NvcGUpIHRhZ3MsCgkvLyB1bmxlc3Mgd3JhcHBlZCBpbiBhIGRpdiB3aXRoIG5vbi1icmVha2luZyBjaGFyYWN0ZXJzIGluIGZyb250IG9mIGl0LgoJX2RlZmF1bHQ6IHN1cHBvcnQuaHRtbFNlcmlhbGl6ZSA/IFsgMCwgIiIsICIiIF0gOiBbIDEsICJYPGRpdj4iLCAiPC9kaXY+IiBdCn07CgovLyBTdXBwb3J0OiBJRTgtSUU5CndyYXBNYXAub3B0Z3JvdXAgPSB3cmFwTWFwLm9wdGlvbjsKCndyYXBNYXAudGJvZHkgPSB3cmFwTWFwLnRmb290ID0gd3JhcE1hcC5jb2xncm91cCA9IHdyYXBNYXAuY2FwdGlvbiA9IHdyYXBNYXAudGhlYWQ7CndyYXBNYXAudGggPSB3cmFwTWFwLnRkOwoKCmZ1bmN0aW9uIGdldEFsbCggY29udGV4dCwgdGFnICkgewoJdmFyIGVsZW1zLCBlbGVtLAoJCWkgPSAwLAoJCWZvdW5kID0gdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgIT09ICJ1bmRlZmluZWQiID8KCQkJY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnIHx8ICIqIiApIDoKCQkJdHlwZW9mIGNvbnRleHQucXVlcnlTZWxlY3RvckFsbCAhPT0gInVuZGVmaW5lZCIgPwoJCQkJY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCB0YWcgfHwgIioiICkgOgoJCQkJdW5kZWZpbmVkOwoKCWlmICggIWZvdW5kICkgewoJCWZvciAoIGZvdW5kID0gW10sIGVsZW1zID0gY29udGV4dC5jaGlsZE5vZGVzIHx8IGNvbnRleHQ7CgkJCSggZWxlbSA9IGVsZW1zWyBpIF0gKSAhPSBudWxsOwoJCQlpKysKCQkpIHsKCQkJaWYgKCAhdGFnIHx8IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgdGFnICkgKSB7CgkJCQlmb3VuZC5wdXNoKCBlbGVtICk7CgkJCX0gZWxzZSB7CgkJCQlqUXVlcnkubWVyZ2UoIGZvdW5kLCBnZXRBbGwoIGVsZW0sIHRhZyApICk7CgkJCX0KCQl9Cgl9CgoJcmV0dXJuIHRhZyA9PT0gdW5kZWZpbmVkIHx8IHRhZyAmJiBqUXVlcnkubm9kZU5hbWUoIGNvbnRleHQsIHRhZyApID8KCQlqUXVlcnkubWVyZ2UoIFsgY29udGV4dCBdLCBmb3VuZCApIDoKCQlmb3VuZDsKfQoKCi8vIE1hcmsgc2NyaXB0cyBhcyBoYXZpbmcgYWxyZWFkeSBiZWVuIGV2YWx1YXRlZApmdW5jdGlvbiBzZXRHbG9iYWxFdmFsKCBlbGVtcywgcmVmRWxlbWVudHMgKSB7Cgl2YXIgZWxlbSwKCQlpID0gMDsKCWZvciAoIDsgKCBlbGVtID0gZWxlbXNbIGkgXSApICE9IG51bGw7IGkrKyApIHsKCQlqUXVlcnkuX2RhdGEoCgkJCWVsZW0sCgkJCSJnbG9iYWxFdmFsIiwKCQkJIXJlZkVsZW1lbnRzIHx8IGpRdWVyeS5fZGF0YSggcmVmRWxlbWVudHNbIGkgXSwgImdsb2JhbEV2YWwiICkKCQkpOwoJfQp9CgoKdmFyIHJodG1sID0gLzx8JiM/XHcrOy8sCglydGJvZHkgPSAvPHRib2R5L2k7CgpmdW5jdGlvbiBmaXhEZWZhdWx0Q2hlY2tlZCggZWxlbSApIHsKCWlmICggcmNoZWNrYWJsZVR5cGUudGVzdCggZWxlbS50eXBlICkgKSB7CgkJZWxlbS5kZWZhdWx0Q2hlY2tlZCA9IGVsZW0uY2hlY2tlZDsKCX0KfQoKZnVuY3Rpb24gYnVpbGRGcmFnbWVudCggZWxlbXMsIGNvbnRleHQsIHNjcmlwdHMsIHNlbGVjdGlvbiwgaWdub3JlZCApIHsKCXZhciBqLCBlbGVtLCBjb250YWlucywKCQl0bXAsIHRhZywgdGJvZHksIHdyYXAsCgkJbCA9IGVsZW1zLmxlbmd0aCwKCgkJLy8gRW5zdXJlIGEgc2FmZSBmcmFnbWVudAoJCXNhZmUgPSBjcmVhdGVTYWZlRnJhZ21lbnQoIGNvbnRleHQgKSwKCgkJbm9kZXMgPSBbXSwKCQlpID0gMDsKCglmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJZWxlbSA9IGVsZW1zWyBpIF07CgoJCWlmICggZWxlbSB8fCBlbGVtID09PSAwICkgewoKCQkJLy8gQWRkIG5vZGVzIGRpcmVjdGx5CgkJCWlmICggalF1ZXJ5LnR5cGUoIGVsZW0gKSA9PT0gIm9iamVjdCIgKSB7CgkJCQlqUXVlcnkubWVyZ2UoIG5vZGVzLCBlbGVtLm5vZGVUeXBlID8gWyBlbGVtIF0gOiBlbGVtICk7CgoJCQkvLyBDb252ZXJ0IG5vbi1odG1sIGludG8gYSB0ZXh0IG5vZGUKCQkJfSBlbHNlIGlmICggIXJodG1sLnRlc3QoIGVsZW0gKSApIHsKCQkJCW5vZGVzLnB1c2goIGNvbnRleHQuY3JlYXRlVGV4dE5vZGUoIGVsZW0gKSApOwoKCQkJLy8gQ29udmVydCBodG1sIGludG8gRE9NIG5vZGVzCgkJCX0gZWxzZSB7CgkJCQl0bXAgPSB0bXAgfHwgc2FmZS5hcHBlbmRDaGlsZCggY29udGV4dC5jcmVhdGVFbGVtZW50KCAiZGl2IiApICk7CgoJCQkJLy8gRGVzZXJpYWxpemUgYSBzdGFuZGFyZCByZXByZXNlbnRhdGlvbgoJCQkJdGFnID0gKCBydGFnTmFtZS5leGVjKCBlbGVtICkgfHwgWyAiIiwgIiIgXSApWyAxIF0udG9Mb3dlckNhc2UoKTsKCQkJCXdyYXAgPSB3cmFwTWFwWyB0YWcgXSB8fCB3cmFwTWFwLl9kZWZhdWx0OwoKCQkJCXRtcC5pbm5lckhUTUwgPSB3cmFwWyAxIF0gKyBqUXVlcnkuaHRtbFByZWZpbHRlciggZWxlbSApICsgd3JhcFsgMiBdOwoKCQkJCS8vIERlc2NlbmQgdGhyb3VnaCB3cmFwcGVycyB0byB0aGUgcmlnaHQgY29udGVudAoJCQkJaiA9IHdyYXBbIDAgXTsKCQkJCXdoaWxlICggai0tICkgewoJCQkJCXRtcCA9IHRtcC5sYXN0Q2hpbGQ7CgkJCQl9CgoJCQkJLy8gTWFudWFsbHkgYWRkIGxlYWRpbmcgd2hpdGVzcGFjZSByZW1vdmVkIGJ5IElFCgkJCQlpZiAoICFzdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlICYmIHJsZWFkaW5nV2hpdGVzcGFjZS50ZXN0KCBlbGVtICkgKSB7CgkJCQkJbm9kZXMucHVzaCggY29udGV4dC5jcmVhdGVUZXh0Tm9kZSggcmxlYWRpbmdXaGl0ZXNwYWNlLmV4ZWMoIGVsZW0gKVsgMCBdICkgKTsKCQkJCX0KCgkJCQkvLyBSZW1vdmUgSUUncyBhdXRvaW5zZXJ0ZWQgPHRib2R5PiBmcm9tIHRhYmxlIGZyYWdtZW50cwoJCQkJaWYgKCAhc3VwcG9ydC50Ym9keSApIHsKCgkJCQkJLy8gU3RyaW5nIHdhcyBhIDx0YWJsZT4sICptYXkqIGhhdmUgc3B1cmlvdXMgPHRib2R5PgoJCQkJCWVsZW0gPSB0YWcgPT09ICJ0YWJsZSIgJiYgIXJ0Ym9keS50ZXN0KCBlbGVtICkgPwoJCQkJCQl0bXAuZmlyc3RDaGlsZCA6CgoJCQkJCQkvLyBTdHJpbmcgd2FzIGEgYmFyZSA8dGhlYWQ+IG9yIDx0Zm9vdD4KCQkJCQkJd3JhcFsgMSBdID09PSAiPHRhYmxlPiIgJiYgIXJ0Ym9keS50ZXN0KCBlbGVtICkgPwoJCQkJCQkJdG1wIDoKCQkJCQkJCTA7CgoJCQkJCWogPSBlbGVtICYmIGVsZW0uY2hpbGROb2Rlcy5sZW5ndGg7CgkJCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCAoIHRib2R5ID0gZWxlbS5jaGlsZE5vZGVzWyBqIF0gKSwgInRib2R5IiApICYmCgkJCQkJCQkhdGJvZHkuY2hpbGROb2Rlcy5sZW5ndGggKSB7CgoJCQkJCQkJZWxlbS5yZW1vdmVDaGlsZCggdGJvZHkgKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQlqUXVlcnkubWVyZ2UoIG5vZGVzLCB0bXAuY2hpbGROb2RlcyApOwoKCQkJCS8vIEZpeCAjMTIzOTIgZm9yIFdlYktpdCBhbmQgSUUgPiA5CgkJCQl0bXAudGV4dENvbnRlbnQgPSAiIjsKCgkJCQkvLyBGaXggIzEyMzkyIGZvciBvbGRJRQoJCQkJd2hpbGUgKCB0bXAuZmlyc3RDaGlsZCApIHsKCQkJCQl0bXAucmVtb3ZlQ2hpbGQoIHRtcC5maXJzdENoaWxkICk7CgkJCQl9CgoJCQkJLy8gUmVtZW1iZXIgdGhlIHRvcC1sZXZlbCBjb250YWluZXIgZm9yIHByb3BlciBjbGVhbnVwCgkJCQl0bXAgPSBzYWZlLmxhc3RDaGlsZDsKCQkJfQoJCX0KCX0KCgkvLyBGaXggIzExMzU2OiBDbGVhciBlbGVtZW50cyBmcm9tIGZyYWdtZW50CglpZiAoIHRtcCApIHsKCQlzYWZlLnJlbW92ZUNoaWxkKCB0bXAgKTsKCX0KCgkvLyBSZXNldCBkZWZhdWx0Q2hlY2tlZCBmb3IgYW55IHJhZGlvcyBhbmQgY2hlY2tib3hlcwoJLy8gYWJvdXQgdG8gYmUgYXBwZW5kZWQgdG8gdGhlIERPTSBpbiBJRSA2LzcgKCM4MDYwKQoJaWYgKCAhc3VwcG9ydC5hcHBlbmRDaGVja2VkICkgewoJCWpRdWVyeS5ncmVwKCBnZXRBbGwoIG5vZGVzLCAiaW5wdXQiICksIGZpeERlZmF1bHRDaGVja2VkICk7Cgl9CgoJaSA9IDA7Cgl3aGlsZSAoICggZWxlbSA9IG5vZGVzWyBpKysgXSApICkgewoKCQkvLyBTa2lwIGVsZW1lbnRzIGFscmVhZHkgaW4gdGhlIGNvbnRleHQgY29sbGVjdGlvbiAodHJhYy00MDg3KQoJCWlmICggc2VsZWN0aW9uICYmIGpRdWVyeS5pbkFycmF5KCBlbGVtLCBzZWxlY3Rpb24gKSA+IC0xICkgewoJCQlpZiAoIGlnbm9yZWQgKSB7CgkJCQlpZ25vcmVkLnB1c2goIGVsZW0gKTsKCQkJfQoKCQkJY29udGludWU7CgkJfQoKCQljb250YWlucyA9IGpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICk7CgoJCS8vIEFwcGVuZCB0byBmcmFnbWVudAoJCXRtcCA9IGdldEFsbCggc2FmZS5hcHBlbmRDaGlsZCggZWxlbSApLCAic2NyaXB0IiApOwoKCQkvLyBQcmVzZXJ2ZSBzY3JpcHQgZXZhbHVhdGlvbiBoaXN0b3J5CgkJaWYgKCBjb250YWlucyApIHsKCQkJc2V0R2xvYmFsRXZhbCggdG1wICk7CgkJfQoKCQkvLyBDYXB0dXJlIGV4ZWN1dGFibGVzCgkJaWYgKCBzY3JpcHRzICkgewoJCQlqID0gMDsKCQkJd2hpbGUgKCAoIGVsZW0gPSB0bXBbIGorKyBdICkgKSB7CgkJCQlpZiAoIHJzY3JpcHRUeXBlLnRlc3QoIGVsZW0udHlwZSB8fCAiIiApICkgewoJCQkJCXNjcmlwdHMucHVzaCggZWxlbSApOwoJCQkJfQoJCQl9CgkJfQoJfQoKCXRtcCA9IG51bGw7CgoJcmV0dXJuIHNhZmU7Cn0KCgooIGZ1bmN0aW9uKCkgewoJdmFyIGksIGV2ZW50TmFtZSwKCQlkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoKCS8vIFN1cHBvcnQ6IElFPDkgKGxhY2sgc3VibWl0L2NoYW5nZSBidWJibGUpLCBGaXJlZm94IChsYWNrIGZvY3VzKGluIHwgb3V0KSBldmVudHMpCglmb3IgKCBpIGluIHsgc3VibWl0OiB0cnVlLCBjaGFuZ2U6IHRydWUsIGZvY3VzaW46IHRydWUgfSApIHsKCQlldmVudE5hbWUgPSAib24iICsgaTsKCgkJaWYgKCAhKCBzdXBwb3J0WyBpIF0gPSBldmVudE5hbWUgaW4gd2luZG93ICkgKSB7CgoJCQkvLyBCZXdhcmUgb2YgQ1NQIHJlc3RyaWN0aW9ucyAoaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vU2VjdXJpdHkvQ1NQKQoJCQlkaXYuc2V0QXR0cmlidXRlKCBldmVudE5hbWUsICJ0IiApOwoJCQlzdXBwb3J0WyBpIF0gPSBkaXYuYXR0cmlidXRlc1sgZXZlbnROYW1lIF0uZXhwYW5kbyA9PT0gZmFsc2U7CgkJfQoJfQoKCS8vIE51bGwgZWxlbWVudHMgdG8gYXZvaWQgbGVha3MgaW4gSUUuCglkaXYgPSBudWxsOwp9ICkoKTsKCgp2YXIgcmZvcm1FbGVtcyA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhKSQvaSwKCXJrZXlFdmVudCA9IC9ea2V5LywKCXJtb3VzZUV2ZW50ID0gL14oPzptb3VzZXxwb2ludGVyfGNvbnRleHRtZW51fGRyYWd8ZHJvcCl8Y2xpY2svLAoJcmZvY3VzTW9ycGggPSAvXig/OmZvY3VzaW5mb2N1c3xmb2N1c291dGJsdXIpJC8sCglydHlwZW5hbWVzcGFjZSA9IC9eKFteLl0qKSg/OlwuKC4rKXwpLzsKCmZ1bmN0aW9uIHJldHVyblRydWUoKSB7CglyZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gcmV0dXJuRmFsc2UoKSB7CglyZXR1cm4gZmFsc2U7Cn0KCi8vIFN1cHBvcnQ6IElFOQovLyBTZWUgIzEzMzkzIGZvciBtb3JlIGluZm8KZnVuY3Rpb24gc2FmZUFjdGl2ZUVsZW1lbnQoKSB7Cgl0cnkgewoJCXJldHVybiBkb2N1bWVudC5hY3RpdmVFbGVtZW50OwoJfSBjYXRjaCAoIGVyciApIHsgfQp9CgpmdW5jdGlvbiBvbiggZWxlbSwgdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiwgb25lICkgewoJdmFyIG9yaWdGbiwgdHlwZTsKCgkvLyBUeXBlcyBjYW4gYmUgYSBtYXAgb2YgdHlwZXMvaGFuZGxlcnMKCWlmICggdHlwZW9mIHR5cGVzID09PSAib2JqZWN0IiApIHsKCgkJLy8gKCB0eXBlcy1PYmplY3QsIHNlbGVjdG9yLCBkYXRhICkKCQlpZiAoIHR5cGVvZiBzZWxlY3RvciAhPT0gInN0cmluZyIgKSB7CgoJCQkvLyAoIHR5cGVzLU9iamVjdCwgZGF0YSApCgkJCWRhdGEgPSBkYXRhIHx8IHNlbGVjdG9yOwoJCQlzZWxlY3RvciA9IHVuZGVmaW5lZDsKCQl9CgkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJb24oIGVsZW0sIHR5cGUsIHNlbGVjdG9yLCBkYXRhLCB0eXBlc1sgdHlwZSBdLCBvbmUgKTsKCQl9CgkJcmV0dXJuIGVsZW07Cgl9CgoJaWYgKCBkYXRhID09IG51bGwgJiYgZm4gPT0gbnVsbCApIHsKCgkJLy8gKCB0eXBlcywgZm4gKQoJCWZuID0gc2VsZWN0b3I7CgkJZGF0YSA9IHNlbGVjdG9yID0gdW5kZWZpbmVkOwoJfSBlbHNlIGlmICggZm4gPT0gbnVsbCApIHsKCQlpZiAoIHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgKSB7CgoJCQkvLyAoIHR5cGVzLCBzZWxlY3RvciwgZm4gKQoJCQlmbiA9IGRhdGE7CgkJCWRhdGEgPSB1bmRlZmluZWQ7CgkJfSBlbHNlIHsKCgkJCS8vICggdHlwZXMsIGRhdGEsIGZuICkKCQkJZm4gPSBkYXRhOwoJCQlkYXRhID0gc2VsZWN0b3I7CgkJCXNlbGVjdG9yID0gdW5kZWZpbmVkOwoJCX0KCX0KCWlmICggZm4gPT09IGZhbHNlICkgewoJCWZuID0gcmV0dXJuRmFsc2U7Cgl9IGVsc2UgaWYgKCAhZm4gKSB7CgkJcmV0dXJuIGVsZW07Cgl9CgoJaWYgKCBvbmUgPT09IDEgKSB7CgkJb3JpZ0ZuID0gZm47CgkJZm4gPSBmdW5jdGlvbiggZXZlbnQgKSB7CgoJCQkvLyBDYW4gdXNlIGFuIGVtcHR5IHNldCwgc2luY2UgZXZlbnQgY29udGFpbnMgdGhlIGluZm8KCQkJalF1ZXJ5KCkub2ZmKCBldmVudCApOwoJCQlyZXR1cm4gb3JpZ0ZuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQl9OwoKCQkvLyBVc2Ugc2FtZSBndWlkIHNvIGNhbGxlciBjYW4gcmVtb3ZlIHVzaW5nIG9yaWdGbgoJCWZuLmd1aWQgPSBvcmlnRm4uZ3VpZCB8fCAoIG9yaWdGbi5ndWlkID0galF1ZXJ5Lmd1aWQrKyApOwoJfQoJcmV0dXJuIGVsZW0uZWFjaCggZnVuY3Rpb24oKSB7CgkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgdHlwZXMsIGZuLCBkYXRhLCBzZWxlY3RvciApOwoJfSApOwp9CgovKgogKiBIZWxwZXIgZnVuY3Rpb25zIGZvciBtYW5hZ2luZyBldmVudHMgLS0gbm90IHBhcnQgb2YgdGhlIHB1YmxpYyBpbnRlcmZhY2UuCiAqIFByb3BzIHRvIERlYW4gRWR3YXJkcycgYWRkRXZlbnQgbGlicmFyeSBmb3IgbWFueSBvZiB0aGUgaWRlYXMuCiAqLwpqUXVlcnkuZXZlbnQgPSB7CgoJZ2xvYmFsOiB7fSwKCglhZGQ6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlcywgaGFuZGxlciwgZGF0YSwgc2VsZWN0b3IgKSB7CgkJdmFyIHRtcCwgZXZlbnRzLCB0LCBoYW5kbGVPYmpJbiwKCQkJc3BlY2lhbCwgZXZlbnRIYW5kbGUsIGhhbmRsZU9iaiwKCQkJaGFuZGxlcnMsIHR5cGUsIG5hbWVzcGFjZXMsIG9yaWdUeXBlLAoJCQllbGVtRGF0YSA9IGpRdWVyeS5fZGF0YSggZWxlbSApOwoKCQkvLyBEb24ndCBhdHRhY2ggZXZlbnRzIHRvIG5vRGF0YSBvciB0ZXh0L2NvbW1lbnQgbm9kZXMgKGJ1dCBhbGxvdyBwbGFpbiBvYmplY3RzKQoJCWlmICggIWVsZW1EYXRhICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYW4gb2JqZWN0IG9mIGN1c3RvbSBkYXRhIGluIGxpZXUgb2YgdGhlIGhhbmRsZXIKCQlpZiAoIGhhbmRsZXIuaGFuZGxlciApIHsKCQkJaGFuZGxlT2JqSW4gPSBoYW5kbGVyOwoJCQloYW5kbGVyID0gaGFuZGxlT2JqSW4uaGFuZGxlcjsKCQkJc2VsZWN0b3IgPSBoYW5kbGVPYmpJbi5zZWxlY3RvcjsKCQl9CgoJCS8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBoYW5kbGVyIGhhcyBhIHVuaXF1ZSBJRCwgdXNlZCB0byBmaW5kL3JlbW92ZSBpdCBsYXRlcgoJCWlmICggIWhhbmRsZXIuZ3VpZCApIHsKCQkJaGFuZGxlci5ndWlkID0galF1ZXJ5Lmd1aWQrKzsKCQl9CgoJCS8vIEluaXQgdGhlIGVsZW1lbnQncyBldmVudCBzdHJ1Y3R1cmUgYW5kIG1haW4gaGFuZGxlciwgaWYgdGhpcyBpcyB0aGUgZmlyc3QKCQlpZiAoICEoIGV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cyApICkgewoJCQlldmVudHMgPSBlbGVtRGF0YS5ldmVudHMgPSB7fTsKCQl9CgkJaWYgKCAhKCBldmVudEhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZSApICkgewoJCQlldmVudEhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZSA9IGZ1bmN0aW9uKCBlICkgewoKCQkJCS8vIERpc2NhcmQgdGhlIHNlY29uZCBldmVudCBvZiBhIGpRdWVyeS5ldmVudC50cmlnZ2VyKCkgYW5kCgkJCQkvLyB3aGVuIGFuIGV2ZW50IGlzIGNhbGxlZCBhZnRlciBhIHBhZ2UgaGFzIHVubG9hZGVkCgkJCQlyZXR1cm4gdHlwZW9mIGpRdWVyeSAhPT0gInVuZGVmaW5lZCIgJiYKCQkJCQkoICFlIHx8IGpRdWVyeS5ldmVudC50cmlnZ2VyZWQgIT09IGUudHlwZSApID8KCQkJCQlqUXVlcnkuZXZlbnQuZGlzcGF0Y2guYXBwbHkoIGV2ZW50SGFuZGxlLmVsZW0sIGFyZ3VtZW50cyApIDoKCQkJCQl1bmRlZmluZWQ7CgkJCX07CgoJCQkvLyBBZGQgZWxlbSBhcyBhIHByb3BlcnR5IG9mIHRoZSBoYW5kbGUgZm4gdG8gcHJldmVudCBhIG1lbW9yeSBsZWFrCgkJCS8vIHdpdGggSUUgbm9uLW5hdGl2ZSBldmVudHMKCQkJZXZlbnRIYW5kbGUuZWxlbSA9IGVsZW07CgkJfQoKCQkvLyBIYW5kbGUgbXVsdGlwbGUgZXZlbnRzIHNlcGFyYXRlZCBieSBhIHNwYWNlCgkJdHlwZXMgPSAoIHR5cGVzIHx8ICIiICkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFsgIiIgXTsKCQl0ID0gdHlwZXMubGVuZ3RoOwoJCXdoaWxlICggdC0tICkgewoJCQl0bXAgPSBydHlwZW5hbWVzcGFjZS5leGVjKCB0eXBlc1sgdCBdICkgfHwgW107CgkJCXR5cGUgPSBvcmlnVHlwZSA9IHRtcFsgMSBdOwoJCQluYW1lc3BhY2VzID0gKCB0bXBbIDIgXSB8fCAiIiApLnNwbGl0KCAiLiIgKS5zb3J0KCk7CgoJCQkvLyBUaGVyZSAqbXVzdCogYmUgYSB0eXBlLCBubyBhdHRhY2hpbmcgbmFtZXNwYWNlLW9ubHkgaGFuZGxlcnMKCQkJaWYgKCAhdHlwZSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQkvLyBJZiBldmVudCBjaGFuZ2VzIGl0cyB0eXBlLCB1c2UgdGhlIHNwZWNpYWwgZXZlbnQgaGFuZGxlcnMgZm9yIHRoZSBjaGFuZ2VkIHR5cGUKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgoJCQkvLyBJZiBzZWxlY3RvciBkZWZpbmVkLCBkZXRlcm1pbmUgc3BlY2lhbCBldmVudCBhcGkgdHlwZSwgb3RoZXJ3aXNlIGdpdmVuIHR5cGUKCQkJdHlwZSA9ICggc2VsZWN0b3IgPyBzcGVjaWFsLmRlbGVnYXRlVHlwZSA6IHNwZWNpYWwuYmluZFR5cGUgKSB8fCB0eXBlOwoKCQkJLy8gVXBkYXRlIHNwZWNpYWwgYmFzZWQgb24gbmV3bHkgcmVzZXQgdHlwZQoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCgkJCS8vIGhhbmRsZU9iaiBpcyBwYXNzZWQgdG8gYWxsIGV2ZW50IGhhbmRsZXJzCgkJCWhhbmRsZU9iaiA9IGpRdWVyeS5leHRlbmQoIHsKCQkJCXR5cGU6IHR5cGUsCgkJCQlvcmlnVHlwZTogb3JpZ1R5cGUsCgkJCQlkYXRhOiBkYXRhLAoJCQkJaGFuZGxlcjogaGFuZGxlciwKCQkJCWd1aWQ6IGhhbmRsZXIuZ3VpZCwKCQkJCXNlbGVjdG9yOiBzZWxlY3RvciwKCQkJCW5lZWRzQ29udGV4dDogc2VsZWN0b3IgJiYgalF1ZXJ5LmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LnRlc3QoIHNlbGVjdG9yICksCgkJCQluYW1lc3BhY2U6IG5hbWVzcGFjZXMuam9pbiggIi4iICkKCQkJfSwgaGFuZGxlT2JqSW4gKTsKCgkJCS8vIEluaXQgdGhlIGV2ZW50IGhhbmRsZXIgcXVldWUgaWYgd2UncmUgdGhlIGZpcnN0CgkJCWlmICggISggaGFuZGxlcnMgPSBldmVudHNbIHR5cGUgXSApICkgewoJCQkJaGFuZGxlcnMgPSBldmVudHNbIHR5cGUgXSA9IFtdOwoJCQkJaGFuZGxlcnMuZGVsZWdhdGVDb3VudCA9IDA7CgoJCQkJLy8gT25seSB1c2UgYWRkRXZlbnRMaXN0ZW5lci9hdHRhY2hFdmVudCBpZiB0aGUgc3BlY2lhbCBldmVudHMgaGFuZGxlciByZXR1cm5zIGZhbHNlCgkJCQlpZiAoICFzcGVjaWFsLnNldHVwIHx8CgkJCQkJc3BlY2lhbC5zZXR1cC5jYWxsKCBlbGVtLCBkYXRhLCBuYW1lc3BhY2VzLCBldmVudEhhbmRsZSApID09PSBmYWxzZSApIHsKCgkJCQkJLy8gQmluZCB0aGUgZ2xvYmFsIGV2ZW50IGhhbmRsZXIgdG8gdGhlIGVsZW1lbnQKCQkJCQlpZiAoIGVsZW0uYWRkRXZlbnRMaXN0ZW5lciApIHsKCQkJCQkJZWxlbS5hZGRFdmVudExpc3RlbmVyKCB0eXBlLCBldmVudEhhbmRsZSwgZmFsc2UgKTsKCgkJCQkJfSBlbHNlIGlmICggZWxlbS5hdHRhY2hFdmVudCApIHsKCQkJCQkJZWxlbS5hdHRhY2hFdmVudCggIm9uIiArIHR5cGUsIGV2ZW50SGFuZGxlICk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlpZiAoIHNwZWNpYWwuYWRkICkgewoJCQkJc3BlY2lhbC5hZGQuY2FsbCggZWxlbSwgaGFuZGxlT2JqICk7CgoJCQkJaWYgKCAhaGFuZGxlT2JqLmhhbmRsZXIuZ3VpZCApIHsKCQkJCQloYW5kbGVPYmouaGFuZGxlci5ndWlkID0gaGFuZGxlci5ndWlkOwoJCQkJfQoJCQl9CgoJCQkvLyBBZGQgdG8gdGhlIGVsZW1lbnQncyBoYW5kbGVyIGxpc3QsIGRlbGVnYXRlcyBpbiBmcm9udAoJCQlpZiAoIHNlbGVjdG9yICkgewoJCQkJaGFuZGxlcnMuc3BsaWNlKCBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50KyssIDAsIGhhbmRsZU9iaiApOwoJCQl9IGVsc2UgewoJCQkJaGFuZGxlcnMucHVzaCggaGFuZGxlT2JqICk7CgkJCX0KCgkJCS8vIEtlZXAgdHJhY2sgb2Ygd2hpY2ggZXZlbnRzIGhhdmUgZXZlciBiZWVuIHVzZWQsIGZvciBldmVudCBvcHRpbWl6YXRpb24KCQkJalF1ZXJ5LmV2ZW50Lmdsb2JhbFsgdHlwZSBdID0gdHJ1ZTsKCQl9CgoJCS8vIE51bGxpZnkgZWxlbSB0byBwcmV2ZW50IG1lbW9yeSBsZWFrcyBpbiBJRQoJCWVsZW0gPSBudWxsOwoJfSwKCgkvLyBEZXRhY2ggYW4gZXZlbnQgb3Igc2V0IG9mIGV2ZW50cyBmcm9tIGFuIGVsZW1lbnQKCXJlbW92ZTogZnVuY3Rpb24oIGVsZW0sIHR5cGVzLCBoYW5kbGVyLCBzZWxlY3RvciwgbWFwcGVkVHlwZXMgKSB7CgkJdmFyIGosIGhhbmRsZU9iaiwgdG1wLAoJCQlvcmlnQ291bnQsIHQsIGV2ZW50cywKCQkJc3BlY2lhbCwgaGFuZGxlcnMsIHR5cGUsCgkJCW5hbWVzcGFjZXMsIG9yaWdUeXBlLAoJCQllbGVtRGF0YSA9IGpRdWVyeS5oYXNEYXRhKCBlbGVtICkgJiYgalF1ZXJ5Ll9kYXRhKCBlbGVtICk7CgoJCWlmICggIWVsZW1EYXRhIHx8ICEoIGV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cyApICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBPbmNlIGZvciBlYWNoIHR5cGUubmFtZXNwYWNlIGluIHR5cGVzOyB0eXBlIG1heSBiZSBvbWl0dGVkCgkJdHlwZXMgPSAoIHR5cGVzIHx8ICIiICkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFsgIiIgXTsKCQl0ID0gdHlwZXMubGVuZ3RoOwoJCXdoaWxlICggdC0tICkgewoJCQl0bXAgPSBydHlwZW5hbWVzcGFjZS5leGVjKCB0eXBlc1sgdCBdICkgfHwgW107CgkJCXR5cGUgPSBvcmlnVHlwZSA9IHRtcFsgMSBdOwoJCQluYW1lc3BhY2VzID0gKCB0bXBbIDIgXSB8fCAiIiApLnNwbGl0KCAiLiIgKS5zb3J0KCk7CgoJCQkvLyBVbmJpbmQgYWxsIGV2ZW50cyAob24gdGhpcyBuYW1lc3BhY2UsIGlmIHByb3ZpZGVkKSBmb3IgdGhlIGVsZW1lbnQKCQkJaWYgKCAhdHlwZSApIHsKCQkJCWZvciAoIHR5cGUgaW4gZXZlbnRzICkgewoJCQkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIGVsZW0sIHR5cGUgKyB0eXBlc1sgdCBdLCBoYW5kbGVyLCBzZWxlY3RvciwgdHJ1ZSApOwoJCQkJfQoJCQkJY29udGludWU7CgkJCX0KCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9OwoJCQl0eXBlID0gKCBzZWxlY3RvciA/IHNwZWNpYWwuZGVsZWdhdGVUeXBlIDogc3BlY2lhbC5iaW5kVHlwZSApIHx8IHR5cGU7CgkJCWhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF0gfHwgW107CgkJCXRtcCA9IHRtcFsgMiBdICYmCgkJCQluZXcgUmVnRXhwKCAiKF58XFwuKSIgKyBuYW1lc3BhY2VzLmpvaW4oICJcXC4oPzouKlxcLnwpIiApICsgIihcXC58JCkiICk7CgoJCQkvLyBSZW1vdmUgbWF0Y2hpbmcgZXZlbnRzCgkJCW9yaWdDb3VudCA9IGogPSBoYW5kbGVycy5sZW5ndGg7CgkJCXdoaWxlICggai0tICkgewoJCQkJaGFuZGxlT2JqID0gaGFuZGxlcnNbIGogXTsKCgkJCQlpZiAoICggbWFwcGVkVHlwZXMgfHwgb3JpZ1R5cGUgPT09IGhhbmRsZU9iai5vcmlnVHlwZSApICYmCgkJCQkJKCAhaGFuZGxlciB8fCBoYW5kbGVyLmd1aWQgPT09IGhhbmRsZU9iai5ndWlkICkgJiYKCQkJCQkoICF0bXAgfHwgdG1wLnRlc3QoIGhhbmRsZU9iai5uYW1lc3BhY2UgKSApICYmCgkJCQkJKCAhc2VsZWN0b3IgfHwgc2VsZWN0b3IgPT09IGhhbmRsZU9iai5zZWxlY3RvciB8fAoJCQkJCQlzZWxlY3RvciA9PT0gIioqIiAmJiBoYW5kbGVPYmouc2VsZWN0b3IgKSApIHsKCQkJCQloYW5kbGVycy5zcGxpY2UoIGosIDEgKTsKCgkJCQkJaWYgKCBoYW5kbGVPYmouc2VsZWN0b3IgKSB7CgkJCQkJCWhhbmRsZXJzLmRlbGVnYXRlQ291bnQtLTsKCQkJCQl9CgkJCQkJaWYgKCBzcGVjaWFsLnJlbW92ZSApIHsKCQkJCQkJc3BlY2lhbC5yZW1vdmUuY2FsbCggZWxlbSwgaGFuZGxlT2JqICk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQkvLyBSZW1vdmUgZ2VuZXJpYyBldmVudCBoYW5kbGVyIGlmIHdlIHJlbW92ZWQgc29tZXRoaW5nIGFuZCBubyBtb3JlIGhhbmRsZXJzIGV4aXN0CgkJCS8vIChhdm9pZHMgcG90ZW50aWFsIGZvciBlbmRsZXNzIHJlY3Vyc2lvbiBkdXJpbmcgcmVtb3ZhbCBvZiBzcGVjaWFsIGV2ZW50IGhhbmRsZXJzKQoJCQlpZiAoIG9yaWdDb3VudCAmJiAhaGFuZGxlcnMubGVuZ3RoICkgewoJCQkJaWYgKCAhc3BlY2lhbC50ZWFyZG93biB8fAoJCQkJCXNwZWNpYWwudGVhcmRvd24uY2FsbCggZWxlbSwgbmFtZXNwYWNlcywgZWxlbURhdGEuaGFuZGxlICkgPT09IGZhbHNlICkgewoKCQkJCQlqUXVlcnkucmVtb3ZlRXZlbnQoIGVsZW0sIHR5cGUsIGVsZW1EYXRhLmhhbmRsZSApOwoJCQkJfQoKCQkJCWRlbGV0ZSBldmVudHNbIHR5cGUgXTsKCQkJfQoJCX0KCgkJLy8gUmVtb3ZlIHRoZSBleHBhbmRvIGlmIGl0J3Mgbm8gbG9uZ2VyIHVzZWQKCQlpZiAoIGpRdWVyeS5pc0VtcHR5T2JqZWN0KCBldmVudHMgKSApIHsKCQkJZGVsZXRlIGVsZW1EYXRhLmhhbmRsZTsKCgkJCS8vIHJlbW92ZURhdGEgYWxzbyBjaGVja3MgZm9yIGVtcHRpbmVzcyBhbmQgY2xlYXJzIHRoZSBleHBhbmRvIGlmIGVtcHR5CgkJCS8vIHNvIHVzZSBpdCBpbnN0ZWFkIG9mIGRlbGV0ZQoJCQlqUXVlcnkuX3JlbW92ZURhdGEoIGVsZW0sICJldmVudHMiICk7CgkJfQoJfSwKCgl0cmlnZ2VyOiBmdW5jdGlvbiggZXZlbnQsIGRhdGEsIGVsZW0sIG9ubHlIYW5kbGVycyApIHsKCQl2YXIgaGFuZGxlLCBvbnR5cGUsIGN1ciwKCQkJYnViYmxlVHlwZSwgc3BlY2lhbCwgdG1wLCBpLAoJCQlldmVudFBhdGggPSBbIGVsZW0gfHwgZG9jdW1lbnQgXSwKCQkJdHlwZSA9IGhhc093bi5jYWxsKCBldmVudCwgInR5cGUiICkgPyBldmVudC50eXBlIDogZXZlbnQsCgkJCW5hbWVzcGFjZXMgPSBoYXNPd24uY2FsbCggZXZlbnQsICJuYW1lc3BhY2UiICkgPyBldmVudC5uYW1lc3BhY2Uuc3BsaXQoICIuIiApIDogW107CgoJCWN1ciA9IHRtcCA9IGVsZW0gPSBlbGVtIHx8IGRvY3VtZW50OwoKCQkvLyBEb24ndCBkbyBldmVudHMgb24gdGV4dCBhbmQgY29tbWVudCBub2RlcwoJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMyB8fCBlbGVtLm5vZGVUeXBlID09PSA4ICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBmb2N1cy9ibHVyIG1vcnBocyB0byBmb2N1c2luL291dDsgZW5zdXJlIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbSByaWdodCBub3cKCQlpZiAoIHJmb2N1c01vcnBoLnRlc3QoIHR5cGUgKyBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggdHlwZS5pbmRleE9mKCAiLiIgKSA+IC0xICkgewoKCQkJLy8gTmFtZXNwYWNlZCB0cmlnZ2VyOyBjcmVhdGUgYSByZWdleHAgdG8gbWF0Y2ggZXZlbnQgdHlwZSBpbiBoYW5kbGUoKQoJCQluYW1lc3BhY2VzID0gdHlwZS5zcGxpdCggIi4iICk7CgkJCXR5cGUgPSBuYW1lc3BhY2VzLnNoaWZ0KCk7CgkJCW5hbWVzcGFjZXMuc29ydCgpOwoJCX0KCQlvbnR5cGUgPSB0eXBlLmluZGV4T2YoICI6IiApIDwgMCAmJiAib24iICsgdHlwZTsKCgkJLy8gQ2FsbGVyIGNhbiBwYXNzIGluIGEgalF1ZXJ5LkV2ZW50IG9iamVjdCwgT2JqZWN0LCBvciBqdXN0IGFuIGV2ZW50IHR5cGUgc3RyaW5nCgkJZXZlbnQgPSBldmVudFsgalF1ZXJ5LmV4cGFuZG8gXSA/CgkJCWV2ZW50IDoKCQkJbmV3IGpRdWVyeS5FdmVudCggdHlwZSwgdHlwZW9mIGV2ZW50ID09PSAib2JqZWN0IiAmJiBldmVudCApOwoKCQkvLyBUcmlnZ2VyIGJpdG1hc2s6ICYgMSBmb3IgbmF0aXZlIGhhbmRsZXJzOyAmIDIgZm9yIGpRdWVyeSAoYWx3YXlzIHRydWUpCgkJZXZlbnQuaXNUcmlnZ2VyID0gb25seUhhbmRsZXJzID8gMiA6IDM7CgkJZXZlbnQubmFtZXNwYWNlID0gbmFtZXNwYWNlcy5qb2luKCAiLiIgKTsKCQlldmVudC5ybmFtZXNwYWNlID0gZXZlbnQubmFtZXNwYWNlID8KCQkJbmV3IFJlZ0V4cCggIihefFxcLikiICsgbmFtZXNwYWNlcy5qb2luKCAiXFwuKD86LipcXC58KSIgKSArICIoXFwufCQpIiApIDoKCQkJbnVsbDsKCgkJLy8gQ2xlYW4gdXAgdGhlIGV2ZW50IGluIGNhc2UgaXQgaXMgYmVpbmcgcmV1c2VkCgkJZXZlbnQucmVzdWx0ID0gdW5kZWZpbmVkOwoJCWlmICggIWV2ZW50LnRhcmdldCApIHsKCQkJZXZlbnQudGFyZ2V0ID0gZWxlbTsKCQl9CgoJCS8vIENsb25lIGFueSBpbmNvbWluZyBkYXRhIGFuZCBwcmVwZW5kIHRoZSBldmVudCwgY3JlYXRpbmcgdGhlIGhhbmRsZXIgYXJnIGxpc3QKCQlkYXRhID0gZGF0YSA9PSBudWxsID8KCQkJWyBldmVudCBdIDoKCQkJalF1ZXJ5Lm1ha2VBcnJheSggZGF0YSwgWyBldmVudCBdICk7CgoJCS8vIEFsbG93IHNwZWNpYWwgZXZlbnRzIHRvIGRyYXcgb3V0c2lkZSB0aGUgbGluZXMKCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCQlpZiAoICFvbmx5SGFuZGxlcnMgJiYgc3BlY2lhbC50cmlnZ2VyICYmIHNwZWNpYWwudHJpZ2dlci5hcHBseSggZWxlbSwgZGF0YSApID09PSBmYWxzZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gRGV0ZXJtaW5lIGV2ZW50IHByb3BhZ2F0aW9uIHBhdGggaW4gYWR2YW5jZSwgcGVyIFczQyBldmVudHMgc3BlYyAoIzk5NTEpCgkJLy8gQnViYmxlIHVwIHRvIGRvY3VtZW50LCB0aGVuIHRvIHdpbmRvdzsgd2F0Y2ggZm9yIGEgZ2xvYmFsIG93bmVyRG9jdW1lbnQgdmFyICgjOTcyNCkKCQlpZiAoICFvbmx5SGFuZGxlcnMgJiYgIXNwZWNpYWwubm9CdWJibGUgJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJYnViYmxlVHlwZSA9IHNwZWNpYWwuZGVsZWdhdGVUeXBlIHx8IHR5cGU7CgkJCWlmICggIXJmb2N1c01vcnBoLnRlc3QoIGJ1YmJsZVR5cGUgKyB0eXBlICkgKSB7CgkJCQljdXIgPSBjdXIucGFyZW50Tm9kZTsKCQkJfQoJCQlmb3IgKCA7IGN1cjsgY3VyID0gY3VyLnBhcmVudE5vZGUgKSB7CgkJCQlldmVudFBhdGgucHVzaCggY3VyICk7CgkJCQl0bXAgPSBjdXI7CgkJCX0KCgkJCS8vIE9ubHkgYWRkIHdpbmRvdyBpZiB3ZSBnb3QgdG8gZG9jdW1lbnQgKGUuZy4sIG5vdCBwbGFpbiBvYmogb3IgZGV0YWNoZWQgRE9NKQoJCQlpZiAoIHRtcCA9PT0gKCBlbGVtLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQgKSApIHsKCQkJCWV2ZW50UGF0aC5wdXNoKCB0bXAuZGVmYXVsdFZpZXcgfHwgdG1wLnBhcmVudFdpbmRvdyB8fCB3aW5kb3cgKTsKCQkJfQoJCX0KCgkJLy8gRmlyZSBoYW5kbGVycyBvbiB0aGUgZXZlbnQgcGF0aAoJCWkgPSAwOwoJCXdoaWxlICggKCBjdXIgPSBldmVudFBhdGhbIGkrKyBdICkgJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgoJCQlldmVudC50eXBlID0gaSA+IDEgPwoJCQkJYnViYmxlVHlwZSA6CgkJCQlzcGVjaWFsLmJpbmRUeXBlIHx8IHR5cGU7CgoJCQkvLyBqUXVlcnkgaGFuZGxlcgoJCQloYW5kbGUgPSAoIGpRdWVyeS5fZGF0YSggY3VyLCAiZXZlbnRzIiApIHx8IHt9IClbIGV2ZW50LnR5cGUgXSAmJgoJCQkJalF1ZXJ5Ll9kYXRhKCBjdXIsICJoYW5kbGUiICk7CgoJCQlpZiAoIGhhbmRsZSApIHsKCQkJCWhhbmRsZS5hcHBseSggY3VyLCBkYXRhICk7CgkJCX0KCgkJCS8vIE5hdGl2ZSBoYW5kbGVyCgkJCWhhbmRsZSA9IG9udHlwZSAmJiBjdXJbIG9udHlwZSBdOwoJCQlpZiAoIGhhbmRsZSAmJiBoYW5kbGUuYXBwbHkgJiYgYWNjZXB0RGF0YSggY3VyICkgKSB7CgkJCQlldmVudC5yZXN1bHQgPSBoYW5kbGUuYXBwbHkoIGN1ciwgZGF0YSApOwoJCQkJaWYgKCBldmVudC5yZXN1bHQgPT09IGZhbHNlICkgewoJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCQl9CgkJCX0KCQl9CgkJZXZlbnQudHlwZSA9IHR5cGU7CgoJCS8vIElmIG5vYm9keSBwcmV2ZW50ZWQgdGhlIGRlZmF1bHQgYWN0aW9uLCBkbyBpdCBub3cKCQlpZiAoICFvbmx5SGFuZGxlcnMgJiYgIWV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpICkgewoKCQkJaWYgKAoJCQkJKCAhc3BlY2lhbC5fZGVmYXVsdCB8fAoJCQkJIHNwZWNpYWwuX2RlZmF1bHQuYXBwbHkoIGV2ZW50UGF0aC5wb3AoKSwgZGF0YSApID09PSBmYWxzZQoJCQkJKSAmJiBhY2NlcHREYXRhKCBlbGVtICkKCQkJKSB7CgoJCQkJLy8gQ2FsbCBhIG5hdGl2ZSBET00gbWV0aG9kIG9uIHRoZSB0YXJnZXQgd2l0aCB0aGUgc2FtZSBuYW1lIG5hbWUgYXMgdGhlIGV2ZW50LgoJCQkJLy8gQ2FuJ3QgdXNlIGFuIC5pc0Z1bmN0aW9uKCkgY2hlY2sgaGVyZSBiZWNhdXNlIElFNi83IGZhaWxzIHRoYXQgdGVzdC4KCQkJCS8vIERvbid0IGRvIGRlZmF1bHQgYWN0aW9ucyBvbiB3aW5kb3csIHRoYXQncyB3aGVyZSBnbG9iYWwgdmFyaWFibGVzIGJlICgjNjE3MCkKCQkJCWlmICggb250eXBlICYmIGVsZW1bIHR5cGUgXSAmJiAhalF1ZXJ5LmlzV2luZG93KCBlbGVtICkgKSB7CgoJCQkJCS8vIERvbid0IHJlLXRyaWdnZXIgYW4gb25GT08gZXZlbnQgd2hlbiB3ZSBjYWxsIGl0cyBGT08oKSBtZXRob2QKCQkJCQl0bXAgPSBlbGVtWyBvbnR5cGUgXTsKCgkJCQkJaWYgKCB0bXAgKSB7CgkJCQkJCWVsZW1bIG9udHlwZSBdID0gbnVsbDsKCQkJCQl9CgoJCQkJCS8vIFByZXZlbnQgcmUtdHJpZ2dlcmluZyBvZiB0aGUgc2FtZSBldmVudCwgc2luY2Ugd2UgYWxyZWFkeSBidWJibGVkIGl0IGFib3ZlCgkJCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXJlZCA9IHR5cGU7CgkJCQkJdHJ5IHsKCQkJCQkJZWxlbVsgdHlwZSBdKCk7CgkJCQkJfSBjYXRjaCAoIGUgKSB7CgoJCQkJCQkvLyBJRTw5IGRpZXMgb24gZm9jdXMvYmx1ciB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsIzEyNTE4KQoJCQkJCQkvLyBvbmx5IHJlcHJvZHVjaWJsZSBvbiB3aW5YUCBJRTggbmF0aXZlLCBub3QgSUU5IGluIElFOCBtb2RlCgkJCQkJfQoJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB1bmRlZmluZWQ7CgoJCQkJCWlmICggdG1wICkgewoJCQkJCQllbGVtWyBvbnR5cGUgXSA9IHRtcDsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWRpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7CgoJCS8vIE1ha2UgYSB3cml0YWJsZSBqUXVlcnkuRXZlbnQgZnJvbSB0aGUgbmF0aXZlIGV2ZW50IG9iamVjdAoJCWV2ZW50ID0galF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgKTsKCgkJdmFyIGksIGosIHJldCwgbWF0Y2hlZCwgaGFuZGxlT2JqLAoJCQloYW5kbGVyUXVldWUgPSBbXSwKCQkJYXJncyA9IHNsaWNlLmNhbGwoIGFyZ3VtZW50cyApLAoJCQloYW5kbGVycyA9ICggalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiZXZlbnRzIiApIHx8IHt9IClbIGV2ZW50LnR5cGUgXSB8fCBbXSwKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyBldmVudC50eXBlIF0gfHwge307CgoJCS8vIFVzZSB0aGUgZml4LWVkIGpRdWVyeS5FdmVudCByYXRoZXIgdGhhbiB0aGUgKHJlYWQtb25seSkgbmF0aXZlIGV2ZW50CgkJYXJnc1sgMCBdID0gZXZlbnQ7CgkJZXZlbnQuZGVsZWdhdGVUYXJnZXQgPSB0aGlzOwoKCQkvLyBDYWxsIHRoZSBwcmVEaXNwYXRjaCBob29rIGZvciB0aGUgbWFwcGVkIHR5cGUsIGFuZCBsZXQgaXQgYmFpbCBpZiBkZXNpcmVkCgkJaWYgKCBzcGVjaWFsLnByZURpc3BhdGNoICYmIHNwZWNpYWwucHJlRGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIERldGVybWluZSBoYW5kbGVycwoJCWhhbmRsZXJRdWV1ZSA9IGpRdWVyeS5ldmVudC5oYW5kbGVycy5jYWxsKCB0aGlzLCBldmVudCwgaGFuZGxlcnMgKTsKCgkJLy8gUnVuIGRlbGVnYXRlcyBmaXJzdDsgdGhleSBtYXkgd2FudCB0byBzdG9wIHByb3BhZ2F0aW9uIGJlbmVhdGggdXMKCQlpID0gMDsKCQl3aGlsZSAoICggbWF0Y2hlZCA9IGhhbmRsZXJRdWV1ZVsgaSsrIF0gKSAmJiAhZXZlbnQuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSApIHsKCQkJZXZlbnQuY3VycmVudFRhcmdldCA9IG1hdGNoZWQuZWxlbTsKCgkJCWogPSAwOwoJCQl3aGlsZSAoICggaGFuZGxlT2JqID0gbWF0Y2hlZC5oYW5kbGVyc1sgaisrIF0gKSAmJgoJCQkJIWV2ZW50LmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgoJCQkJLy8gVHJpZ2dlcmVkIGV2ZW50IG11c3QgZWl0aGVyIDEpIGhhdmUgbm8gbmFtZXNwYWNlLCBvciAyKSBoYXZlIG5hbWVzcGFjZShzKQoJCQkJLy8gYSBzdWJzZXQgb3IgZXF1YWwgdG8gdGhvc2UgaW4gdGhlIGJvdW5kIGV2ZW50IChib3RoIGNhbiBoYXZlIG5vIG5hbWVzcGFjZSkuCgkJCQlpZiAoICFldmVudC5ybmFtZXNwYWNlIHx8IGV2ZW50LnJuYW1lc3BhY2UudGVzdCggaGFuZGxlT2JqLm5hbWVzcGFjZSApICkgewoKCQkJCQlldmVudC5oYW5kbGVPYmogPSBoYW5kbGVPYmo7CgkJCQkJZXZlbnQuZGF0YSA9IGhhbmRsZU9iai5kYXRhOwoKCQkJCQlyZXQgPSAoICggalF1ZXJ5LmV2ZW50LnNwZWNpYWxbIGhhbmRsZU9iai5vcmlnVHlwZSBdIHx8IHt9ICkuaGFuZGxlIHx8CgkJCQkJCWhhbmRsZU9iai5oYW5kbGVyICkuYXBwbHkoIG1hdGNoZWQuZWxlbSwgYXJncyApOwoKCQkJCQlpZiAoIHJldCAhPT0gdW5kZWZpbmVkICkgewoJCQkJCQlpZiAoICggZXZlbnQucmVzdWx0ID0gcmV0ICkgPT09IGZhbHNlICkgewoJCQkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQkJCWV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsIHRoZSBwb3N0RGlzcGF0Y2ggaG9vayBmb3IgdGhlIG1hcHBlZCB0eXBlCgkJaWYgKCBzcGVjaWFsLnBvc3REaXNwYXRjaCApIHsKCQkJc3BlY2lhbC5wb3N0RGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKTsKCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWhhbmRsZXJzOiBmdW5jdGlvbiggZXZlbnQsIGhhbmRsZXJzICkgewoJCXZhciBpLCBtYXRjaGVzLCBzZWwsIGhhbmRsZU9iaiwKCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCWRlbGVnYXRlQ291bnQgPSBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50LAoJCQljdXIgPSBldmVudC50YXJnZXQ7CgoJCS8vIFN1cHBvcnQgKGF0IGxlYXN0KTogQ2hyb21lLCBJRTkKCQkvLyBGaW5kIGRlbGVnYXRlIGhhbmRsZXJzCgkJLy8gQmxhY2staG9sZSBTVkcgPHVzZT4gaW5zdGFuY2UgdHJlZXMgKCMxMzE4MCkKCQkvLwoJCS8vIFN1cHBvcnQ6IEZpcmVmb3g8PTQyKwoJCS8vIEF2b2lkIG5vbi1sZWZ0LWNsaWNrIGluIEZGIGJ1dCBkb24ndCBibG9jayBJRSByYWRpbyBldmVudHMgKCMzODYxLCBnaC0yMzQzKQoJCWlmICggZGVsZWdhdGVDb3VudCAmJiBjdXIubm9kZVR5cGUgJiYKCQkJKCBldmVudC50eXBlICE9PSAiY2xpY2siIHx8IGlzTmFOKCBldmVudC5idXR0b24gKSB8fCBldmVudC5idXR0b24gPCAxICkgKSB7CgoJCQkvKiBqc2hpbnQgZXFlcWVxOiBmYWxzZSAqLwoJCQlmb3IgKCA7IGN1ciAhPSB0aGlzOyBjdXIgPSBjdXIucGFyZW50Tm9kZSB8fCB0aGlzICkgewoJCQkJLyoganNoaW50IGVxZXFlcTogdHJ1ZSAqLwoKCQkJCS8vIERvbid0IGNoZWNrIG5vbi1lbGVtZW50cyAoIzEzMjA4KQoJCQkJLy8gRG9uJ3QgcHJvY2VzcyBjbGlja3Mgb24gZGlzYWJsZWQgZWxlbWVudHMgKCM2OTExLCAjODE2NSwgIzExMzgyLCAjMTE3NjQpCgkJCQlpZiAoIGN1ci5ub2RlVHlwZSA9PT0gMSAmJiAoIGN1ci5kaXNhYmxlZCAhPT0gdHJ1ZSB8fCBldmVudC50eXBlICE9PSAiY2xpY2siICkgKSB7CgkJCQkJbWF0Y2hlcyA9IFtdOwoJCQkJCWZvciAoIGkgPSAwOyBpIDwgZGVsZWdhdGVDb3VudDsgaSsrICkgewoJCQkJCQloYW5kbGVPYmogPSBoYW5kbGVyc1sgaSBdOwoKCQkJCQkJLy8gRG9uJ3QgY29uZmxpY3Qgd2l0aCBPYmplY3QucHJvdG90eXBlIHByb3BlcnRpZXMgKCMxMzIwMykKCQkJCQkJc2VsID0gaGFuZGxlT2JqLnNlbGVjdG9yICsgIiAiOwoKCQkJCQkJaWYgKCBtYXRjaGVzWyBzZWwgXSA9PT0gdW5kZWZpbmVkICkgewoJCQkJCQkJbWF0Y2hlc1sgc2VsIF0gPSBoYW5kbGVPYmoubmVlZHNDb250ZXh0ID8KCQkJCQkJCQlqUXVlcnkoIHNlbCwgdGhpcyApLmluZGV4KCBjdXIgKSA+IC0xIDoKCQkJCQkJCQlqUXVlcnkuZmluZCggc2VsLCB0aGlzLCBudWxsLCBbIGN1ciBdICkubGVuZ3RoOwoJCQkJCQl9CgkJCQkJCWlmICggbWF0Y2hlc1sgc2VsIF0gKSB7CgkJCQkJCQltYXRjaGVzLnB1c2goIGhhbmRsZU9iaiApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmICggbWF0Y2hlcy5sZW5ndGggKSB7CgkJCQkJCWhhbmRsZXJRdWV1ZS5wdXNoKCB7IGVsZW06IGN1ciwgaGFuZGxlcnM6IG1hdGNoZXMgfSApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJLy8gQWRkIHRoZSByZW1haW5pbmcgKGRpcmVjdGx5LWJvdW5kKSBoYW5kbGVycwoJCWlmICggZGVsZWdhdGVDb3VudCA8IGhhbmRsZXJzLmxlbmd0aCApIHsKCQkJaGFuZGxlclF1ZXVlLnB1c2goIHsgZWxlbTogdGhpcywgaGFuZGxlcnM6IGhhbmRsZXJzLnNsaWNlKCBkZWxlZ2F0ZUNvdW50ICkgfSApOwoJCX0KCgkJcmV0dXJuIGhhbmRsZXJRdWV1ZTsKCX0sCgoJZml4OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCBldmVudFsgalF1ZXJ5LmV4cGFuZG8gXSApIHsKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCgkJLy8gQ3JlYXRlIGEgd3JpdGFibGUgY29weSBvZiB0aGUgZXZlbnQgb2JqZWN0IGFuZCBub3JtYWxpemUgc29tZSBwcm9wZXJ0aWVzCgkJdmFyIGksIHByb3AsIGNvcHksCgkJCXR5cGUgPSBldmVudC50eXBlLAoJCQlvcmlnaW5hbEV2ZW50ID0gZXZlbnQsCgkJCWZpeEhvb2sgPSB0aGlzLmZpeEhvb2tzWyB0eXBlIF07CgoJCWlmICggIWZpeEhvb2sgKSB7CgkJCXRoaXMuZml4SG9va3NbIHR5cGUgXSA9IGZpeEhvb2sgPQoJCQkJcm1vdXNlRXZlbnQudGVzdCggdHlwZSApID8gdGhpcy5tb3VzZUhvb2tzIDoKCQkJCXJrZXlFdmVudC50ZXN0KCB0eXBlICkgPyB0aGlzLmtleUhvb2tzIDoKCQkJCXt9OwoJCX0KCQljb3B5ID0gZml4SG9vay5wcm9wcyA/IHRoaXMucHJvcHMuY29uY2F0KCBmaXhIb29rLnByb3BzICkgOiB0aGlzLnByb3BzOwoKCQlldmVudCA9IG5ldyBqUXVlcnkuRXZlbnQoIG9yaWdpbmFsRXZlbnQgKTsKCgkJaSA9IGNvcHkubGVuZ3RoOwoJCXdoaWxlICggaS0tICkgewoJCQlwcm9wID0gY29weVsgaSBdOwoJCQlldmVudFsgcHJvcCBdID0gb3JpZ2luYWxFdmVudFsgcHJvcCBdOwoJCX0KCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIEZpeCB0YXJnZXQgcHJvcGVydHkgKCMxOTI1KQoJCWlmICggIWV2ZW50LnRhcmdldCApIHsKCQkJZXZlbnQudGFyZ2V0ID0gb3JpZ2luYWxFdmVudC5zcmNFbGVtZW50IHx8IGRvY3VtZW50OwoJCX0KCgkJLy8gU3VwcG9ydDogU2FmYXJpIDYtOCsKCQkvLyBUYXJnZXQgc2hvdWxkIG5vdCBiZSBhIHRleHQgbm9kZSAoIzUwNCwgIzEzMTQzKQoJCWlmICggZXZlbnQudGFyZ2V0Lm5vZGVUeXBlID09PSAzICkgewoJCQlldmVudC50YXJnZXQgPSBldmVudC50YXJnZXQucGFyZW50Tm9kZTsKCQl9CgoJCS8vIFN1cHBvcnQ6IElFPDkKCQkvLyBGb3IgbW91c2Uva2V5IGV2ZW50cywgbWV0YUtleT09ZmFsc2UgaWYgaXQncyB1bmRlZmluZWQgKCMzMzY4LCAjMTEzMjgpCgkJZXZlbnQubWV0YUtleSA9ICEhZXZlbnQubWV0YUtleTsKCgkJcmV0dXJuIGZpeEhvb2suZmlsdGVyID8gZml4SG9vay5maWx0ZXIoIGV2ZW50LCBvcmlnaW5hbEV2ZW50ICkgOiBldmVudDsKCX0sCgoJLy8gSW5jbHVkZXMgc29tZSBldmVudCBwcm9wcyBzaGFyZWQgYnkgS2V5RXZlbnQgYW5kIE1vdXNlRXZlbnQKCXByb3BzOiAoICJhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBkZXRhaWwgZXZlbnRQaGFzZSAiICsKCQkibWV0YUtleSByZWxhdGVkVGFyZ2V0IHNoaWZ0S2V5IHRhcmdldCB0aW1lU3RhbXAgdmlldyB3aGljaCIgKS5zcGxpdCggIiAiICksCgoJZml4SG9va3M6IHt9LAoKCWtleUhvb2tzOiB7CgkJcHJvcHM6ICJjaGFyIGNoYXJDb2RlIGtleSBrZXlDb2RlIi5zcGxpdCggIiAiICksCgkJZmlsdGVyOiBmdW5jdGlvbiggZXZlbnQsIG9yaWdpbmFsICkgewoKCQkJLy8gQWRkIHdoaWNoIGZvciBrZXkgZXZlbnRzCgkJCWlmICggZXZlbnQud2hpY2ggPT0gbnVsbCApIHsKCQkJCWV2ZW50LndoaWNoID0gb3JpZ2luYWwuY2hhckNvZGUgIT0gbnVsbCA/IG9yaWdpbmFsLmNoYXJDb2RlIDogb3JpZ2luYWwua2V5Q29kZTsKCQkJfQoKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCX0sCgoJbW91c2VIb29rczogewoJCXByb3BzOiAoICJidXR0b24gYnV0dG9ucyBjbGllbnRYIGNsaWVudFkgZnJvbUVsZW1lbnQgb2Zmc2V0WCBvZmZzZXRZICIgKwoJCQkicGFnZVggcGFnZVkgc2NyZWVuWCBzY3JlZW5ZIHRvRWxlbWVudCIgKS5zcGxpdCggIiAiICksCgkJZmlsdGVyOiBmdW5jdGlvbiggZXZlbnQsIG9yaWdpbmFsICkgewoJCQl2YXIgYm9keSwgZXZlbnREb2MsIGRvYywKCQkJCWJ1dHRvbiA9IG9yaWdpbmFsLmJ1dHRvbiwKCQkJCWZyb21FbGVtZW50ID0gb3JpZ2luYWwuZnJvbUVsZW1lbnQ7CgoJCQkvLyBDYWxjdWxhdGUgcGFnZVgvWSBpZiBtaXNzaW5nIGFuZCBjbGllbnRYL1kgYXZhaWxhYmxlCgkJCWlmICggZXZlbnQucGFnZVggPT0gbnVsbCAmJiBvcmlnaW5hbC5jbGllbnRYICE9IG51bGwgKSB7CgkJCQlldmVudERvYyA9IGV2ZW50LnRhcmdldC5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50OwoJCQkJZG9jID0gZXZlbnREb2MuZG9jdW1lbnRFbGVtZW50OwoJCQkJYm9keSA9IGV2ZW50RG9jLmJvZHk7CgoJCQkJZXZlbnQucGFnZVggPSBvcmlnaW5hbC5jbGllbnRYICsKCQkJCQkoIGRvYyAmJiBkb2Muc2Nyb2xsTGVmdCB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsTGVmdCB8fCAwICkgLQoJCQkJCSggZG9jICYmIGRvYy5jbGllbnRMZWZ0IHx8IGJvZHkgJiYgYm9keS5jbGllbnRMZWZ0IHx8IDAgKTsKCQkJCWV2ZW50LnBhZ2VZID0gb3JpZ2luYWwuY2xpZW50WSArCgkJCQkJKCBkb2MgJiYgZG9jLnNjcm9sbFRvcCAgfHwgYm9keSAmJiBib2R5LnNjcm9sbFRvcCAgfHwgMCApIC0KCQkJCQkoIGRvYyAmJiBkb2MuY2xpZW50VG9wICB8fCBib2R5ICYmIGJvZHkuY2xpZW50VG9wICB8fCAwICk7CgkJCX0KCgkJCS8vIEFkZCByZWxhdGVkVGFyZ2V0LCBpZiBuZWNlc3NhcnkKCQkJaWYgKCAhZXZlbnQucmVsYXRlZFRhcmdldCAmJiBmcm9tRWxlbWVudCApIHsKCQkJCWV2ZW50LnJlbGF0ZWRUYXJnZXQgPSBmcm9tRWxlbWVudCA9PT0gZXZlbnQudGFyZ2V0ID8KCQkJCQlvcmlnaW5hbC50b0VsZW1lbnQgOgoJCQkJCWZyb21FbGVtZW50OwoJCQl9CgoJCQkvLyBBZGQgd2hpY2ggZm9yIGNsaWNrOiAxID09PSBsZWZ0OyAyID09PSBtaWRkbGU7IDMgPT09IHJpZ2h0CgkJCS8vIE5vdGU6IGJ1dHRvbiBpcyBub3Qgbm9ybWFsaXplZCwgc28gZG9uJ3QgdXNlIGl0CgkJCWlmICggIWV2ZW50LndoaWNoICYmIGJ1dHRvbiAhPT0gdW5kZWZpbmVkICkgewoJCQkJZXZlbnQud2hpY2ggPSAoIGJ1dHRvbiAmIDEgPyAxIDogKCBidXR0b24gJiAyID8gMyA6ICggYnV0dG9uICYgNCA/IDIgOiAwICkgKSApOwoJCQl9CgoJCQlyZXR1cm4gZXZlbnQ7CgkJfQoJfSwKCglzcGVjaWFsOiB7CgkJbG9hZDogewoKCQkJLy8gUHJldmVudCB0cmlnZ2VyZWQgaW1hZ2UubG9hZCBldmVudHMgZnJvbSBidWJibGluZyB0byB3aW5kb3cubG9hZAoJCQlub0J1YmJsZTogdHJ1ZQoJCX0sCgkJZm9jdXM6IHsKCgkJCS8vIEZpcmUgbmF0aXZlIGV2ZW50IGlmIHBvc3NpYmxlIHNvIGJsdXIvZm9jdXMgc2VxdWVuY2UgaXMgY29ycmVjdAoJCQl0cmlnZ2VyOiBmdW5jdGlvbigpIHsKCQkJCWlmICggdGhpcyAhPT0gc2FmZUFjdGl2ZUVsZW1lbnQoKSAmJiB0aGlzLmZvY3VzICkgewoJCQkJCXRyeSB7CgkJCQkJCXRoaXMuZm9jdXMoKTsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0gY2F0Y2ggKCBlICkgewoKCQkJCQkJLy8gU3VwcG9ydDogSUU8OQoJCQkJCQkvLyBJZiB3ZSBlcnJvciBvbiBmb2N1cyB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsICMxMjUxOCksCgkJCQkJCS8vIGxldCAudHJpZ2dlcigpIHJ1biB0aGUgaGFuZGxlcnMKCQkJCQl9CgkJCQl9CgkJCX0sCgkJCWRlbGVnYXRlVHlwZTogImZvY3VzaW4iCgkJfSwKCQlibHVyOiB7CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCB0aGlzID09PSBzYWZlQWN0aXZlRWxlbWVudCgpICYmIHRoaXMuYmx1ciApIHsKCQkJCQl0aGlzLmJsdXIoKTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0sCgkJCWRlbGVnYXRlVHlwZTogImZvY3Vzb3V0IgoJCX0sCgkJY2xpY2s6IHsKCgkJCS8vIEZvciBjaGVja2JveCwgZmlyZSBuYXRpdmUgZXZlbnQgc28gY2hlY2tlZCBzdGF0ZSB3aWxsIGJlIHJpZ2h0CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJpbnB1dCIgKSAmJiB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgJiYgdGhpcy5jbGljayApIHsKCQkJCQl0aGlzLmNsaWNrKCk7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9LAoKCQkJLy8gRm9yIGNyb3NzLWJyb3dzZXIgY29uc2lzdGVuY3ksIGRvbid0IGZpcmUgbmF0aXZlIC5jbGljaygpIG9uIGxpbmtzCgkJCV9kZWZhdWx0OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlyZXR1cm4galF1ZXJ5Lm5vZGVOYW1lKCBldmVudC50YXJnZXQsICJhIiApOwoJCQl9CgkJfSwKCgkJYmVmb3JldW5sb2FkOiB7CgkJCXBvc3REaXNwYXRjaDogZnVuY3Rpb24oIGV2ZW50ICkgewoKCQkJCS8vIFN1cHBvcnQ6IEZpcmVmb3ggMjArCgkJCQkvLyBGaXJlZm94IGRvZXNuJ3QgYWxlcnQgaWYgdGhlIHJldHVyblZhbHVlIGZpZWxkIGlzIG5vdCBzZXQuCgkJCQlpZiAoIGV2ZW50LnJlc3VsdCAhPT0gdW5kZWZpbmVkICYmIGV2ZW50Lm9yaWdpbmFsRXZlbnQgKSB7CgkJCQkJZXZlbnQub3JpZ2luYWxFdmVudC5yZXR1cm5WYWx1ZSA9IGV2ZW50LnJlc3VsdDsKCQkJCX0KCQkJfQoJCX0KCX0sCgoJLy8gUGlnZ3liYWNrIG9uIGEgZG9ub3IgZXZlbnQgdG8gc2ltdWxhdGUgYSBkaWZmZXJlbnQgb25lCglzaW11bGF0ZTogZnVuY3Rpb24oIHR5cGUsIGVsZW0sIGV2ZW50ICkgewoJCXZhciBlID0galF1ZXJ5LmV4dGVuZCgKCQkJbmV3IGpRdWVyeS5FdmVudCgpLAoJCQlldmVudCwKCQkJewoJCQkJdHlwZTogdHlwZSwKCQkJCWlzU2ltdWxhdGVkOiB0cnVlCgoJCQkJLy8gUHJldmlvdXNseSwgYG9yaWdpbmFsRXZlbnQ6IHt9YCB3YXMgc2V0IGhlcmUsIHNvIHN0b3BQcm9wYWdhdGlvbiBjYWxsCgkJCQkvLyB3b3VsZCBub3QgYmUgdHJpZ2dlcmVkIG9uIGRvbm9yIGV2ZW50LCBzaW5jZSBpbiBvdXIgb3duCgkJCQkvLyBqUXVlcnkuZXZlbnQuc3RvcFByb3BhZ2F0aW9uIGZ1bmN0aW9uIHdlIGhhZCBhIGNoZWNrIGZvciBleGlzdGVuY2Ugb2YKCQkJCS8vIG9yaWdpbmFsRXZlbnQuc3RvcFByb3BhZ2F0aW9uIG1ldGhvZCwgc28sIGNvbnNlcXVlbnRseSBpdCB3b3VsZCBiZSBhIG5vb3AuCgkJCQkvLwoJCQkJLy8gR3VhcmQgZm9yIHNpbXVsYXRlZCBldmVudHMgd2FzIG1vdmVkIHRvIGpRdWVyeS5ldmVudC5zdG9wUHJvcGFnYXRpb24gZnVuY3Rpb24KCQkJCS8vIHNpbmNlIGBvcmlnaW5hbEV2ZW50YCBzaG91bGQgcG9pbnQgdG8gdGhlIG9yaWdpbmFsIGV2ZW50IGZvciB0aGUKCQkJCS8vIGNvbnN0YW5jeSB3aXRoIG90aGVyIGV2ZW50cyBhbmQgZm9yIG1vcmUgZm9jdXNlZCBsb2dpYwoJCQl9CgkJKTsKCgkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIGUsIG51bGwsIGVsZW0gKTsKCgkJaWYgKCBlLmlzRGVmYXVsdFByZXZlbnRlZCgpICkgewoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCX0KCX0KfTsKCmpRdWVyeS5yZW1vdmVFdmVudCA9IGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIgPwoJZnVuY3Rpb24oIGVsZW0sIHR5cGUsIGhhbmRsZSApIHsKCgkJLy8gVGhpcyAiaWYiIGlzIG5lZWRlZCBmb3IgcGxhaW4gb2JqZWN0cwoJCWlmICggZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyICkgewoJCQllbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIoIHR5cGUsIGhhbmRsZSApOwoJCX0KCX0gOgoJZnVuY3Rpb24oIGVsZW0sIHR5cGUsIGhhbmRsZSApIHsKCQl2YXIgbmFtZSA9ICJvbiIgKyB0eXBlOwoKCQlpZiAoIGVsZW0uZGV0YWNoRXZlbnQgKSB7CgoJCQkvLyAjODU0NSwgIzcwNTQsIHByZXZlbnRpbmcgbWVtb3J5IGxlYWtzIGZvciBjdXN0b20gZXZlbnRzIGluIElFNi04CgkJCS8vIGRldGFjaEV2ZW50IG5lZWRlZCBwcm9wZXJ0eSBvbiBlbGVtZW50LCBieSBuYW1lIG9mIHRoYXQgZXZlbnQsCgkJCS8vIHRvIHByb3Blcmx5IGV4cG9zZSBpdCB0byBHQwoJCQlpZiAoIHR5cGVvZiBlbGVtWyBuYW1lIF0gPT09ICJ1bmRlZmluZWQiICkgewoJCQkJZWxlbVsgbmFtZSBdID0gbnVsbDsKCQkJfQoKCQkJZWxlbS5kZXRhY2hFdmVudCggbmFtZSwgaGFuZGxlICk7CgkJfQoJfTsKCmpRdWVyeS5FdmVudCA9IGZ1bmN0aW9uKCBzcmMsIHByb3BzICkgewoKCS8vIEFsbG93IGluc3RhbnRpYXRpb24gd2l0aG91dCB0aGUgJ25ldycga2V5d29yZAoJaWYgKCAhKCB0aGlzIGluc3RhbmNlb2YgalF1ZXJ5LkV2ZW50ICkgKSB7CgkJcmV0dXJuIG5ldyBqUXVlcnkuRXZlbnQoIHNyYywgcHJvcHMgKTsKCX0KCgkvLyBFdmVudCBvYmplY3QKCWlmICggc3JjICYmIHNyYy50eXBlICkgewoJCXRoaXMub3JpZ2luYWxFdmVudCA9IHNyYzsKCQl0aGlzLnR5cGUgPSBzcmMudHlwZTsKCgkJLy8gRXZlbnRzIGJ1YmJsaW5nIHVwIHRoZSBkb2N1bWVudCBtYXkgaGF2ZSBiZWVuIG1hcmtlZCBhcyBwcmV2ZW50ZWQKCQkvLyBieSBhIGhhbmRsZXIgbG93ZXIgZG93biB0aGUgdHJlZTsgcmVmbGVjdCB0aGUgY29ycmVjdCB2YWx1ZS4KCQl0aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IHNyYy5kZWZhdWx0UHJldmVudGVkIHx8CgkJCQlzcmMuZGVmYXVsdFByZXZlbnRlZCA9PT0gdW5kZWZpbmVkICYmCgoJCQkJLy8gU3VwcG9ydDogSUUgPCA5LCBBbmRyb2lkIDwgNC4wCgkJCQlzcmMucmV0dXJuVmFsdWUgPT09IGZhbHNlID8KCQkJcmV0dXJuVHJ1ZSA6CgkJCXJldHVybkZhbHNlOwoKCS8vIEV2ZW50IHR5cGUKCX0gZWxzZSB7CgkJdGhpcy50eXBlID0gc3JjOwoJfQoKCS8vIFB1dCBleHBsaWNpdGx5IHByb3ZpZGVkIHByb3BlcnRpZXMgb250byB0aGUgZXZlbnQgb2JqZWN0CglpZiAoIHByb3BzICkgewoJCWpRdWVyeS5leHRlbmQoIHRoaXMsIHByb3BzICk7Cgl9CgoJLy8gQ3JlYXRlIGEgdGltZXN0YW1wIGlmIGluY29taW5nIGV2ZW50IGRvZXNuJ3QgaGF2ZSBvbmUKCXRoaXMudGltZVN0YW1wID0gc3JjICYmIHNyYy50aW1lU3RhbXAgfHwgalF1ZXJ5Lm5vdygpOwoKCS8vIE1hcmsgaXQgYXMgZml4ZWQKCXRoaXNbIGpRdWVyeS5leHBhbmRvIF0gPSB0cnVlOwp9OwoKLy8galF1ZXJ5LkV2ZW50IGlzIGJhc2VkIG9uIERPTTMgRXZlbnRzIGFzIHNwZWNpZmllZCBieSB0aGUgRUNNQVNjcmlwdCBMYW5ndWFnZSBCaW5kaW5nCi8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDMvV0QtRE9NLUxldmVsLTMtRXZlbnRzLTIwMDMwMzMxL2VjbWEtc2NyaXB0LWJpbmRpbmcuaHRtbApqUXVlcnkuRXZlbnQucHJvdG90eXBlID0gewoJY29uc3RydWN0b3I6IGpRdWVyeS5FdmVudCwKCWlzRGVmYXVsdFByZXZlbnRlZDogcmV0dXJuRmFsc2UsCglpc1Byb3BhZ2F0aW9uU3RvcHBlZDogcmV0dXJuRmFsc2UsCglpc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZDogcmV0dXJuRmFsc2UsCgoJcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uKCkgewoJCXZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50OwoKCQl0aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IHJldHVyblRydWU7CgkJaWYgKCAhZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gSWYgcHJldmVudERlZmF1bHQgZXhpc3RzLCBydW4gaXQgb24gdGhlIG9yaWdpbmFsIGV2ZW50CgkJaWYgKCBlLnByZXZlbnREZWZhdWx0ICkgewoJCQllLnByZXZlbnREZWZhdWx0KCk7CgoJCS8vIFN1cHBvcnQ6IElFCgkJLy8gT3RoZXJ3aXNlIHNldCB0aGUgcmV0dXJuVmFsdWUgcHJvcGVydHkgb2YgdGhlIG9yaWdpbmFsIGV2ZW50IHRvIGZhbHNlCgkJfSBlbHNlIHsKCQkJZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOwoJCX0KCX0sCglzdG9wUHJvcGFnYXRpb246IGZ1bmN0aW9uKCkgewoJCXZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50OwoKCQl0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkID0gcmV0dXJuVHJ1ZTsKCgkJaWYgKCAhZSB8fCB0aGlzLmlzU2ltdWxhdGVkICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBJZiBzdG9wUHJvcGFnYXRpb24gZXhpc3RzLCBydW4gaXQgb24gdGhlIG9yaWdpbmFsIGV2ZW50CgkJaWYgKCBlLnN0b3BQcm9wYWdhdGlvbiApIHsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQl9CgoJCS8vIFN1cHBvcnQ6IElFCgkJLy8gU2V0IHRoZSBjYW5jZWxCdWJibGUgcHJvcGVydHkgb2YgdGhlIG9yaWdpbmFsIGV2ZW50IHRvIHRydWUKCQllLmNhbmNlbEJ1YmJsZSA9IHRydWU7Cgl9LAoJc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgoJCWlmICggZSAmJiBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbiApIHsKCQkJZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCQl9CgoJCXRoaXMuc3RvcFByb3BhZ2F0aW9uKCk7Cgl9Cn07CgovLyBDcmVhdGUgbW91c2VlbnRlci9sZWF2ZSBldmVudHMgdXNpbmcgbW91c2VvdmVyL291dCBhbmQgZXZlbnQtdGltZSBjaGVja3MKLy8gc28gdGhhdCBldmVudCBkZWxlZ2F0aW9uIHdvcmtzIGluIGpRdWVyeS4KLy8gRG8gdGhlIHNhbWUgZm9yIHBvaW50ZXJlbnRlci9wb2ludGVybGVhdmUgYW5kIHBvaW50ZXJvdmVyL3BvaW50ZXJvdXQKLy8KLy8gU3VwcG9ydDogU2FmYXJpIDcgb25seQovLyBTYWZhcmkgc2VuZHMgbW91c2VlbnRlciB0b28gb2Z0ZW47IHNlZToKLy8gaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTQ3MDI1OAovLyBmb3IgdGhlIGRlc2NyaXB0aW9uIG9mIHRoZSBidWcgKGl0IGV4aXN0ZWQgaW4gb2xkZXIgQ2hyb21lIHZlcnNpb25zIGFzIHdlbGwpLgpqUXVlcnkuZWFjaCggewoJbW91c2VlbnRlcjogIm1vdXNlb3ZlciIsCgltb3VzZWxlYXZlOiAibW91c2VvdXQiLAoJcG9pbnRlcmVudGVyOiAicG9pbnRlcm92ZXIiLAoJcG9pbnRlcmxlYXZlOiAicG9pbnRlcm91dCIKfSwgZnVuY3Rpb24oIG9yaWcsIGZpeCApIHsKCWpRdWVyeS5ldmVudC5zcGVjaWFsWyBvcmlnIF0gPSB7CgkJZGVsZWdhdGVUeXBlOiBmaXgsCgkJYmluZFR5cGU6IGZpeCwKCgkJaGFuZGxlOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCXZhciByZXQsCgkJCQl0YXJnZXQgPSB0aGlzLAoJCQkJcmVsYXRlZCA9IGV2ZW50LnJlbGF0ZWRUYXJnZXQsCgkJCQloYW5kbGVPYmogPSBldmVudC5oYW5kbGVPYmo7CgoJCQkvLyBGb3IgbW91c2VlbnRlci9sZWF2ZSBjYWxsIHRoZSBoYW5kbGVyIGlmIHJlbGF0ZWQgaXMgb3V0c2lkZSB0aGUgdGFyZ2V0LgoJCQkvLyBOQjogTm8gcmVsYXRlZFRhcmdldCBpZiB0aGUgbW91c2UgbGVmdC9lbnRlcmVkIHRoZSBicm93c2VyIHdpbmRvdwoJCQlpZiAoICFyZWxhdGVkIHx8ICggcmVsYXRlZCAhPT0gdGFyZ2V0ICYmICFqUXVlcnkuY29udGFpbnMoIHRhcmdldCwgcmVsYXRlZCApICkgKSB7CgkJCQlldmVudC50eXBlID0gaGFuZGxlT2JqLm9yaWdUeXBlOwoJCQkJcmV0ID0gaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQkJZXZlbnQudHlwZSA9IGZpeDsKCQkJfQoJCQlyZXR1cm4gcmV0OwoJCX0KCX07Cn0gKTsKCi8vIElFIHN1Ym1pdCBkZWxlZ2F0aW9uCmlmICggIXN1cHBvcnQuc3VibWl0ICkgewoKCWpRdWVyeS5ldmVudC5zcGVjaWFsLnN1Ym1pdCA9IHsKCQlzZXR1cDogZnVuY3Rpb24oKSB7CgoJCQkvLyBPbmx5IG5lZWQgdGhpcyBmb3IgZGVsZWdhdGVkIGZvcm0gc3VibWl0IGV2ZW50cwoJCQlpZiAoIGpRdWVyeS5ub2RlTmFtZSggdGhpcywgImZvcm0iICkgKSB7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCgkJCS8vIExhenktYWRkIGEgc3VibWl0IGhhbmRsZXIgd2hlbiBhIGRlc2NlbmRhbnQgZm9ybSBtYXkgcG90ZW50aWFsbHkgYmUgc3VibWl0dGVkCgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJjbGljay5fc3VibWl0IGtleXByZXNzLl9zdWJtaXQiLCBmdW5jdGlvbiggZSApIHsKCgkJCQkvLyBOb2RlIG5hbWUgY2hlY2sgYXZvaWRzIGEgVk1MLXJlbGF0ZWQgY3Jhc2ggaW4gSUUgKCM5ODA3KQoJCQkJdmFyIGVsZW0gPSBlLnRhcmdldCwKCQkJCQlmb3JtID0galF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCAiaW5wdXQiICkgfHwgalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCAiYnV0dG9uIiApID8KCgkJCQkJCS8vIFN1cHBvcnQ6IElFIDw9OAoJCQkJCQkvLyBXZSB1c2UgalF1ZXJ5LnByb3AgaW5zdGVhZCBvZiBlbGVtLmZvcm0KCQkJCQkJLy8gdG8gYWxsb3cgZml4aW5nIHRoZSBJRTggZGVsZWdhdGVkIHN1Ym1pdCBpc3N1ZSAoZ2gtMjMzMikKCQkJCQkJLy8gYnkgM3JkIHBhcnR5IHBvbHlmaWxscy93b3JrYXJvdW5kcy4KCQkJCQkJalF1ZXJ5LnByb3AoIGVsZW0sICJmb3JtIiApIDoKCQkJCQkJdW5kZWZpbmVkOwoKCQkJCWlmICggZm9ybSAmJiAhalF1ZXJ5Ll9kYXRhKCBmb3JtLCAic3VibWl0IiApICkgewoJCQkJCWpRdWVyeS5ldmVudC5hZGQoIGZvcm0sICJzdWJtaXQuX3N1Ym1pdCIsIGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCQkJZXZlbnQuX3N1Ym1pdEJ1YmJsZSA9IHRydWU7CgkJCQkJfSApOwoJCQkJCWpRdWVyeS5fZGF0YSggZm9ybSwgInN1Ym1pdCIsIHRydWUgKTsKCQkJCX0KCQkJfSApOwoKCQkJLy8gcmV0dXJuIHVuZGVmaW5lZCBzaW5jZSB3ZSBkb24ndCBuZWVkIGFuIGV2ZW50IGxpc3RlbmVyCgkJfSwKCgkJcG9zdERpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7CgoJCQkvLyBJZiBmb3JtIHdhcyBzdWJtaXR0ZWQgYnkgdGhlIHVzZXIsIGJ1YmJsZSB0aGUgZXZlbnQgdXAgdGhlIHRyZWUKCQkJaWYgKCBldmVudC5fc3VibWl0QnViYmxlICkgewoJCQkJZGVsZXRlIGV2ZW50Ll9zdWJtaXRCdWJibGU7CgkJCQlpZiAoIHRoaXMucGFyZW50Tm9kZSAmJiAhZXZlbnQuaXNUcmlnZ2VyICkgewoJCQkJCWpRdWVyeS5ldmVudC5zaW11bGF0ZSggInN1Ym1pdCIsIHRoaXMucGFyZW50Tm9kZSwgZXZlbnQgKTsKCQkJCX0KCQkJfQoJCX0sCgoJCXRlYXJkb3duOiBmdW5jdGlvbigpIHsKCgkJCS8vIE9ubHkgbmVlZCB0aGlzIGZvciBkZWxlZ2F0ZWQgZm9ybSBzdWJtaXQgZXZlbnRzCgkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiZm9ybSIgKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJLy8gUmVtb3ZlIGRlbGVnYXRlZCBoYW5kbGVyczsgY2xlYW5EYXRhIGV2ZW50dWFsbHkgcmVhcHMgc3VibWl0IGhhbmRsZXJzIGF0dGFjaGVkIGFib3ZlCgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsICIuX3N1Ym1pdCIgKTsKCQl9Cgl9Owp9CgovLyBJRSBjaGFuZ2UgZGVsZWdhdGlvbiBhbmQgY2hlY2tib3gvcmFkaW8gZml4CmlmICggIXN1cHBvcnQuY2hhbmdlICkgewoKCWpRdWVyeS5ldmVudC5zcGVjaWFsLmNoYW5nZSA9IHsKCgkJc2V0dXA6IGZ1bmN0aW9uKCkgewoKCQkJaWYgKCByZm9ybUVsZW1zLnRlc3QoIHRoaXMubm9kZU5hbWUgKSApIHsKCgkJCQkvLyBJRSBkb2Vzbid0IGZpcmUgY2hhbmdlIG9uIGEgY2hlY2svcmFkaW8gdW50aWwgYmx1cjsgdHJpZ2dlciBpdCBvbiBjbGljawoJCQkJLy8gYWZ0ZXIgYSBwcm9wZXJ0eWNoYW5nZS4gRWF0IHRoZSBibHVyLWNoYW5nZSBpbiBzcGVjaWFsLmNoYW5nZS5oYW5kbGUuCgkJCQkvLyBUaGlzIHN0aWxsIGZpcmVzIG9uY2hhbmdlIGEgc2Vjb25kIHRpbWUgZm9yIGNoZWNrL3JhZGlvIGFmdGVyIGJsdXIuCgkJCQlpZiAoIHRoaXMudHlwZSA9PT0gImNoZWNrYm94IiB8fCB0aGlzLnR5cGUgPT09ICJyYWRpbyIgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgInByb3BlcnR5Y2hhbmdlLl9jaGFuZ2UiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCWlmICggZXZlbnQub3JpZ2luYWxFdmVudC5wcm9wZXJ0eU5hbWUgPT09ICJjaGVja2VkIiApIHsKCQkJCQkJCXRoaXMuX2p1c3RDaGFuZ2VkID0gdHJ1ZTsKCQkJCQkJfQoJCQkJCX0gKTsKCQkJCQlqUXVlcnkuZXZlbnQuYWRkKCB0aGlzLCAiY2xpY2suX2NoYW5nZSIsIGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCQkJaWYgKCB0aGlzLl9qdXN0Q2hhbmdlZCAmJiAhZXZlbnQuaXNUcmlnZ2VyICkgewoJCQkJCQkJdGhpcy5fanVzdENoYW5nZWQgPSBmYWxzZTsKCQkJCQkJfQoKCQkJCQkJLy8gQWxsb3cgdHJpZ2dlcmVkLCBzaW11bGF0ZWQgY2hhbmdlIGV2ZW50cyAoIzExNTAwKQoJCQkJCQlqUXVlcnkuZXZlbnQuc2ltdWxhdGUoICJjaGFuZ2UiLCB0aGlzLCBldmVudCApOwoJCQkJCX0gKTsKCQkJCX0KCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJLy8gRGVsZWdhdGVkIGV2ZW50OyBsYXp5LWFkZCBhIGNoYW5nZSBoYW5kbGVyIG9uIGRlc2NlbmRhbnQgaW5wdXRzCgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJiZWZvcmVhY3RpdmF0ZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGUgKSB7CgkJCQl2YXIgZWxlbSA9IGUudGFyZ2V0OwoKCQkJCWlmICggcmZvcm1FbGVtcy50ZXN0KCBlbGVtLm5vZGVOYW1lICkgJiYgIWpRdWVyeS5fZGF0YSggZWxlbSwgImNoYW5nZSIgKSApIHsKCQkJCQlqUXVlcnkuZXZlbnQuYWRkKCBlbGVtLCAiY2hhbmdlLl9jaGFuZ2UiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCWlmICggdGhpcy5wYXJlbnROb2RlICYmICFldmVudC5pc1NpbXVsYXRlZCAmJiAhZXZlbnQuaXNUcmlnZ2VyICkgewoJCQkJCQkJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCAiY2hhbmdlIiwgdGhpcy5wYXJlbnROb2RlLCBldmVudCApOwoJCQkJCQl9CgkJCQkJfSApOwoJCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgImNoYW5nZSIsIHRydWUgKTsKCQkJCX0KCQkJfSApOwoJCX0sCgoJCWhhbmRsZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQl2YXIgZWxlbSA9IGV2ZW50LnRhcmdldDsKCgkJCS8vIFN3YWxsb3cgbmF0aXZlIGNoYW5nZSBldmVudHMgZnJvbSBjaGVja2JveC9yYWRpbywgd2UgYWxyZWFkeSB0cmlnZ2VyZWQgdGhlbSBhYm92ZQoJCQlpZiAoIHRoaXMgIT09IGVsZW0gfHwgZXZlbnQuaXNTaW11bGF0ZWQgfHwgZXZlbnQuaXNUcmlnZ2VyIHx8CgkJCQkoIGVsZW0udHlwZSAhPT0gInJhZGlvIiAmJiBlbGVtLnR5cGUgIT09ICJjaGVja2JveCIgKSApIHsKCgkJCQlyZXR1cm4gZXZlbnQuaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQl9CgkJfSwKCgkJdGVhcmRvd246IGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCB0aGlzLCAiLl9jaGFuZ2UiICk7CgoJCQlyZXR1cm4gIXJmb3JtRWxlbXMudGVzdCggdGhpcy5ub2RlTmFtZSApOwoJCX0KCX07Cn0KCi8vIFN1cHBvcnQ6IEZpcmVmb3gKLy8gRmlyZWZveCBkb2Vzbid0IGhhdmUgZm9jdXMoaW4gfCBvdXQpIGV2ZW50cwovLyBSZWxhdGVkIHRpY2tldCAtIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTY4Nzc4NwovLwovLyBTdXBwb3J0OiBDaHJvbWUsIFNhZmFyaQovLyBmb2N1cyhpbiB8IG91dCkgZXZlbnRzIGZpcmUgYWZ0ZXIgZm9jdXMgJiBibHVyIGV2ZW50cywKLy8gd2hpY2ggaXMgc3BlYyB2aW9sYXRpb24gLSBodHRwOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMy1FdmVudHMvI2V2ZW50cy1mb2N1c2V2ZW50LWV2ZW50LW9yZGVyCi8vIFJlbGF0ZWQgdGlja2V0IC0gaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTQ0OTg1NwppZiAoICFzdXBwb3J0LmZvY3VzaW4gKSB7CglqUXVlcnkuZWFjaCggeyBmb2N1czogImZvY3VzaW4iLCBibHVyOiAiZm9jdXNvdXQiIH0sIGZ1bmN0aW9uKCBvcmlnLCBmaXggKSB7CgoJCS8vIEF0dGFjaCBhIHNpbmdsZSBjYXB0dXJpbmcgaGFuZGxlciBvbiB0aGUgZG9jdW1lbnQgd2hpbGUgc29tZW9uZSB3YW50cyBmb2N1c2luL2ZvY3Vzb3V0CgkJdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCWpRdWVyeS5ldmVudC5zaW11bGF0ZSggZml4LCBldmVudC50YXJnZXQsIGpRdWVyeS5ldmVudC5maXgoIGV2ZW50ICkgKTsKCQl9OwoKCQlqUXVlcnkuZXZlbnQuc3BlY2lhbFsgZml4IF0gPSB7CgkJCXNldHVwOiBmdW5jdGlvbigpIHsKCQkJCXZhciBkb2MgPSB0aGlzLm93bmVyRG9jdW1lbnQgfHwgdGhpcywKCQkJCQlhdHRhY2hlcyA9IGpRdWVyeS5fZGF0YSggZG9jLCBmaXggKTsKCgkJCQlpZiAoICFhdHRhY2hlcyApIHsKCQkJCQlkb2MuYWRkRXZlbnRMaXN0ZW5lciggb3JpZywgaGFuZGxlciwgdHJ1ZSApOwoJCQkJfQoJCQkJalF1ZXJ5Ll9kYXRhKCBkb2MsIGZpeCwgKCBhdHRhY2hlcyB8fCAwICkgKyAxICk7CgkJCX0sCgkJCXRlYXJkb3duOiBmdW5jdGlvbigpIHsKCQkJCXZhciBkb2MgPSB0aGlzLm93bmVyRG9jdW1lbnQgfHwgdGhpcywKCQkJCQlhdHRhY2hlcyA9IGpRdWVyeS5fZGF0YSggZG9jLCBmaXggKSAtIDE7CgoJCQkJaWYgKCAhYXR0YWNoZXMgKSB7CgkJCQkJZG9jLnJlbW92ZUV2ZW50TGlzdGVuZXIoIG9yaWcsIGhhbmRsZXIsIHRydWUgKTsKCQkJCQlqUXVlcnkuX3JlbW92ZURhdGEoIGRvYywgZml4ICk7CgkJCQl9IGVsc2UgewoJCQkJCWpRdWVyeS5fZGF0YSggZG9jLCBmaXgsIGF0dGFjaGVzICk7CgkJCQl9CgkJCX0KCQl9OwoJfSApOwp9CgpqUXVlcnkuZm4uZXh0ZW5kKCB7CgoJb246IGZ1bmN0aW9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICkgewoJCXJldHVybiBvbiggdGhpcywgdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiApOwoJfSwKCW9uZTogZnVuY3Rpb24oIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4gKSB7CgkJcmV0dXJuIG9uKCB0aGlzLCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuLCAxICk7Cgl9LAoJb2ZmOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBmbiApIHsKCQl2YXIgaGFuZGxlT2JqLCB0eXBlOwoJCWlmICggdHlwZXMgJiYgdHlwZXMucHJldmVudERlZmF1bHQgJiYgdHlwZXMuaGFuZGxlT2JqICkgewoKCQkJLy8gKCBldmVudCApICBkaXNwYXRjaGVkIGpRdWVyeS5FdmVudAoJCQloYW5kbGVPYmogPSB0eXBlcy5oYW5kbGVPYmo7CgkJCWpRdWVyeSggdHlwZXMuZGVsZWdhdGVUYXJnZXQgKS5vZmYoCgkJCQloYW5kbGVPYmoubmFtZXNwYWNlID8KCQkJCQloYW5kbGVPYmoub3JpZ1R5cGUgKyAiLiIgKyBoYW5kbGVPYmoubmFtZXNwYWNlIDoKCQkJCQloYW5kbGVPYmoub3JpZ1R5cGUsCgkJCQloYW5kbGVPYmouc2VsZWN0b3IsCgkJCQloYW5kbGVPYmouaGFuZGxlcgoJCQkpOwoJCQlyZXR1cm4gdGhpczsKCQl9CgkJaWYgKCB0eXBlb2YgdHlwZXMgPT09ICJvYmplY3QiICkgewoKCQkJLy8gKCB0eXBlcy1vYmplY3QgWywgc2VsZWN0b3JdICkKCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub2ZmKCB0eXBlLCBzZWxlY3RvciwgdHlwZXNbIHR5cGUgXSApOwoJCQl9CgkJCXJldHVybiB0aGlzOwoJCX0KCQlpZiAoIHNlbGVjdG9yID09PSBmYWxzZSB8fCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJmdW5jdGlvbiIgKSB7CgoJCQkvLyAoIHR5cGVzIFssIGZuXSApCgkJCWZuID0gc2VsZWN0b3I7CgkJCXNlbGVjdG9yID0gdW5kZWZpbmVkOwoJCX0KCQlpZiAoIGZuID09PSBmYWxzZSApIHsKCQkJZm4gPSByZXR1cm5GYWxzZTsKCQl9CgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsIHR5cGVzLCBmbiwgc2VsZWN0b3IgKTsKCQl9ICk7Cgl9LAoKCXRyaWdnZXI6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkgewoJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZXZlbnQudHJpZ2dlciggdHlwZSwgZGF0YSwgdGhpcyApOwoJCX0gKTsKCX0sCgl0cmlnZ2VySGFuZGxlcjogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJdmFyIGVsZW0gPSB0aGlzWyAwIF07CgkJaWYgKCBlbGVtICkgewoJCQlyZXR1cm4galF1ZXJ5LmV2ZW50LnRyaWdnZXIoIHR5cGUsIGRhdGEsIGVsZW0sIHRydWUgKTsKCQl9Cgl9Cn0gKTsKCgp2YXIgcmlubGluZWpRdWVyeSA9IC8galF1ZXJ5XGQrPSIoPzpudWxsfFxkKykiL2csCglybm9zaGltY2FjaGUgPSBuZXcgUmVnRXhwKCAiPCg/OiIgKyBub2RlTmFtZXMgKyAiKVtcXHMvPl0iLCAiaSIgKSwKCXJ4aHRtbFRhZyA9IC88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFtcdzotXSspW14+XSopXC8+L2dpLAoKCS8vIFN1cHBvcnQ6IElFIDEwLTExLCBFZGdlIDEwMjQwKwoJLy8gSW4gSUUvRWRnZSB1c2luZyByZWdleCBncm91cHMgaGVyZSBjYXVzZXMgc2V2ZXJlIHNsb3dkb3ducy4KCS8vIFNlZSBodHRwczovL2Nvbm5lY3QubWljcm9zb2Z0LmNvbS9JRS9mZWVkYmFjay9kZXRhaWxzLzE3MzY1MTIvCglybm9Jbm5lcmh0bWwgPSAvPHNjcmlwdHw8c3R5bGV8PGxpbmsvaSwKCgkvLyBjaGVja2VkPSJjaGVja2VkIiBvciBjaGVja2VkCglyY2hlY2tlZCA9IC9jaGVja2VkXHMqKD86W149XXw9XHMqLmNoZWNrZWQuKS9pLAoJcnNjcmlwdFR5cGVNYXNrZWQgPSAvXnRydWVcLyguKikvLAoJcmNsZWFuU2NyaXB0ID0gL15ccyo8ISg/OlxbQ0RBVEFcW3wtLSl8KD86XF1cXXwtLSk+XHMqJC9nLAoJc2FmZUZyYWdtZW50ID0gY3JlYXRlU2FmZUZyYWdtZW50KCBkb2N1bWVudCApLAoJZnJhZ21lbnREaXYgPSBzYWZlRnJhZ21lbnQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICkgKTsKCi8vIFN1cHBvcnQ6IElFPDgKLy8gTWFuaXB1bGF0aW5nIHRhYmxlcyByZXF1aXJlcyBhIHRib2R5CmZ1bmN0aW9uIG1hbmlwdWxhdGlvblRhcmdldCggZWxlbSwgY29udGVudCApIHsKCXJldHVybiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJ0YWJsZSIgKSAmJgoJCWpRdWVyeS5ub2RlTmFtZSggY29udGVudC5ub2RlVHlwZSAhPT0gMTEgPyBjb250ZW50IDogY29udGVudC5maXJzdENoaWxkLCAidHIiICkgPwoKCQllbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCAidGJvZHkiIClbIDAgXSB8fAoJCQllbGVtLmFwcGVuZENoaWxkKCBlbGVtLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudCggInRib2R5IiApICkgOgoJCWVsZW07Cn0KCi8vIFJlcGxhY2UvcmVzdG9yZSB0aGUgdHlwZSBhdHRyaWJ1dGUgb2Ygc2NyaXB0IGVsZW1lbnRzIGZvciBzYWZlIERPTSBtYW5pcHVsYXRpb24KZnVuY3Rpb24gZGlzYWJsZVNjcmlwdCggZWxlbSApIHsKCWVsZW0udHlwZSA9ICggalF1ZXJ5LmZpbmQuYXR0ciggZWxlbSwgInR5cGUiICkgIT09IG51bGwgKSArICIvIiArIGVsZW0udHlwZTsKCXJldHVybiBlbGVtOwp9CmZ1bmN0aW9uIHJlc3RvcmVTY3JpcHQoIGVsZW0gKSB7Cgl2YXIgbWF0Y2ggPSByc2NyaXB0VHlwZU1hc2tlZC5leGVjKCBlbGVtLnR5cGUgKTsKCWlmICggbWF0Y2ggKSB7CgkJZWxlbS50eXBlID0gbWF0Y2hbIDEgXTsKCX0gZWxzZSB7CgkJZWxlbS5yZW1vdmVBdHRyaWJ1dGUoICJ0eXBlIiApOwoJfQoJcmV0dXJuIGVsZW07Cn0KCmZ1bmN0aW9uIGNsb25lQ29weUV2ZW50KCBzcmMsIGRlc3QgKSB7CglpZiAoIGRlc3Qubm9kZVR5cGUgIT09IDEgfHwgIWpRdWVyeS5oYXNEYXRhKCBzcmMgKSApIHsKCQlyZXR1cm47Cgl9CgoJdmFyIHR5cGUsIGksIGwsCgkJb2xkRGF0YSA9IGpRdWVyeS5fZGF0YSggc3JjICksCgkJY3VyRGF0YSA9IGpRdWVyeS5fZGF0YSggZGVzdCwgb2xkRGF0YSApLAoJCWV2ZW50cyA9IG9sZERhdGEuZXZlbnRzOwoKCWlmICggZXZlbnRzICkgewoJCWRlbGV0ZSBjdXJEYXRhLmhhbmRsZTsKCQljdXJEYXRhLmV2ZW50cyA9IHt9OwoKCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJZm9yICggaSA9IDAsIGwgPSBldmVudHNbIHR5cGUgXS5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CgkJCQlqUXVlcnkuZXZlbnQuYWRkKCBkZXN0LCB0eXBlLCBldmVudHNbIHR5cGUgXVsgaSBdICk7CgkJCX0KCQl9Cgl9CgoJLy8gbWFrZSB0aGUgY2xvbmVkIHB1YmxpYyBkYXRhIG9iamVjdCBhIGNvcHkgZnJvbSB0aGUgb3JpZ2luYWwKCWlmICggY3VyRGF0YS5kYXRhICkgewoJCWN1ckRhdGEuZGF0YSA9IGpRdWVyeS5leHRlbmQoIHt9LCBjdXJEYXRhLmRhdGEgKTsKCX0KfQoKZnVuY3Rpb24gZml4Q2xvbmVOb2RlSXNzdWVzKCBzcmMsIGRlc3QgKSB7Cgl2YXIgbm9kZU5hbWUsIGUsIGRhdGE7CgoJLy8gV2UgZG8gbm90IG5lZWQgdG8gZG8gYW55dGhpbmcgZm9yIG5vbi1FbGVtZW50cwoJaWYgKCBkZXN0Lm5vZGVUeXBlICE9PSAxICkgewoJCXJldHVybjsKCX0KCglub2RlTmFtZSA9IGRlc3Qubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCgkvLyBJRTYtOCBjb3BpZXMgZXZlbnRzIGJvdW5kIHZpYSBhdHRhY2hFdmVudCB3aGVuIHVzaW5nIGNsb25lTm9kZS4KCWlmICggIXN1cHBvcnQubm9DbG9uZUV2ZW50ICYmIGRlc3RbIGpRdWVyeS5leHBhbmRvIF0gKSB7CgkJZGF0YSA9IGpRdWVyeS5fZGF0YSggZGVzdCApOwoKCQlmb3IgKCBlIGluIGRhdGEuZXZlbnRzICkgewoJCQlqUXVlcnkucmVtb3ZlRXZlbnQoIGRlc3QsIGUsIGRhdGEuaGFuZGxlICk7CgkJfQoKCQkvLyBFdmVudCBkYXRhIGdldHMgcmVmZXJlbmNlZCBpbnN0ZWFkIG9mIGNvcGllZCBpZiB0aGUgZXhwYW5kbyBnZXRzIGNvcGllZCB0b28KCQlkZXN0LnJlbW92ZUF0dHJpYnV0ZSggalF1ZXJ5LmV4cGFuZG8gKTsKCX0KCgkvLyBJRSBibGFua3MgY29udGVudHMgd2hlbiBjbG9uaW5nIHNjcmlwdHMsIGFuZCB0cmllcyB0byBldmFsdWF0ZSBuZXdseS1zZXQgdGV4dAoJaWYgKCBub2RlTmFtZSA9PT0gInNjcmlwdCIgJiYgZGVzdC50ZXh0ICE9PSBzcmMudGV4dCApIHsKCQlkaXNhYmxlU2NyaXB0KCBkZXN0ICkudGV4dCA9IHNyYy50ZXh0OwoJCXJlc3RvcmVTY3JpcHQoIGRlc3QgKTsKCgkvLyBJRTYtMTAgaW1wcm9wZXJseSBjbG9uZXMgY2hpbGRyZW4gb2Ygb2JqZWN0IGVsZW1lbnRzIHVzaW5nIGNsYXNzaWQuCgkvLyBJRTEwIHRocm93cyBOb01vZGlmaWNhdGlvbkFsbG93ZWRFcnJvciBpZiBwYXJlbnQgaXMgbnVsbCwgIzEyMTMyLgoJfSBlbHNlIGlmICggbm9kZU5hbWUgPT09ICJvYmplY3QiICkgewoJCWlmICggZGVzdC5wYXJlbnROb2RlICkgewoJCQlkZXN0Lm91dGVySFRNTCA9IHNyYy5vdXRlckhUTUw7CgkJfQoKCQkvLyBUaGlzIHBhdGggYXBwZWFycyB1bmF2b2lkYWJsZSBmb3IgSUU5LiBXaGVuIGNsb25pbmcgYW4gb2JqZWN0CgkJLy8gZWxlbWVudCBpbiBJRTksIHRoZSBvdXRlckhUTUwgc3RyYXRlZ3kgYWJvdmUgaXMgbm90IHN1ZmZpY2llbnQuCgkJLy8gSWYgdGhlIHNyYyBoYXMgaW5uZXJIVE1MIGFuZCB0aGUgZGVzdGluYXRpb24gZG9lcyBub3QsCgkJLy8gY29weSB0aGUgc3JjLmlubmVySFRNTCBpbnRvIHRoZSBkZXN0LmlubmVySFRNTC4gIzEwMzI0CgkJaWYgKCBzdXBwb3J0Lmh0bWw1Q2xvbmUgJiYgKCBzcmMuaW5uZXJIVE1MICYmICFqUXVlcnkudHJpbSggZGVzdC5pbm5lckhUTUwgKSApICkgewoJCQlkZXN0LmlubmVySFRNTCA9IHNyYy5pbm5lckhUTUw7CgkJfQoKCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAiaW5wdXQiICYmIHJjaGVja2FibGVUeXBlLnRlc3QoIHNyYy50eXBlICkgKSB7CgoJCS8vIElFNi04IGZhaWxzIHRvIHBlcnNpc3QgdGhlIGNoZWNrZWQgc3RhdGUgb2YgYSBjbG9uZWQgY2hlY2tib3gKCQkvLyBvciByYWRpbyBidXR0b24uIFdvcnNlLCBJRTYtNyBmYWlsIHRvIGdpdmUgdGhlIGNsb25lZCBlbGVtZW50CgkJLy8gYSBjaGVja2VkIGFwcGVhcmFuY2UgaWYgdGhlIGRlZmF1bHRDaGVja2VkIHZhbHVlIGlzbid0IGFsc28gc2V0CgoJCWRlc3QuZGVmYXVsdENoZWNrZWQgPSBkZXN0LmNoZWNrZWQgPSBzcmMuY2hlY2tlZDsKCgkJLy8gSUU2LTcgZ2V0IGNvbmZ1c2VkIGFuZCBlbmQgdXAgc2V0dGluZyB0aGUgdmFsdWUgb2YgYSBjbG9uZWQKCQkvLyBjaGVja2JveC9yYWRpbyBidXR0b24gdG8gYW4gZW1wdHkgc3RyaW5nIGluc3RlYWQgb2YgIm9uIgoJCWlmICggZGVzdC52YWx1ZSAhPT0gc3JjLnZhbHVlICkgewoJCQlkZXN0LnZhbHVlID0gc3JjLnZhbHVlOwoJCX0KCgkvLyBJRTYtOCBmYWlscyB0byByZXR1cm4gdGhlIHNlbGVjdGVkIG9wdGlvbiB0byB0aGUgZGVmYXVsdCBzZWxlY3RlZAoJLy8gc3RhdGUgd2hlbiBjbG9uaW5nIG9wdGlvbnMKCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAib3B0aW9uIiApIHsKCQlkZXN0LmRlZmF1bHRTZWxlY3RlZCA9IGRlc3Quc2VsZWN0ZWQgPSBzcmMuZGVmYXVsdFNlbGVjdGVkOwoKCS8vIElFNi04IGZhaWxzIHRvIHNldCB0aGUgZGVmYXVsdFZhbHVlIHRvIHRoZSBjb3JyZWN0IHZhbHVlIHdoZW4KCS8vIGNsb25pbmcgb3RoZXIgdHlwZXMgb2YgaW5wdXQgZmllbGRzCgl9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiB8fCBub2RlTmFtZSA9PT0gInRleHRhcmVhIiApIHsKCQlkZXN0LmRlZmF1bHRWYWx1ZSA9IHNyYy5kZWZhdWx0VmFsdWU7Cgl9Cn0KCmZ1bmN0aW9uIGRvbU1hbmlwKCBjb2xsZWN0aW9uLCBhcmdzLCBjYWxsYmFjaywgaWdub3JlZCApIHsKCgkvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzCglhcmdzID0gY29uY2F0LmFwcGx5KCBbXSwgYXJncyApOwoKCXZhciBmaXJzdCwgbm9kZSwgaGFzU2NyaXB0cywKCQlzY3JpcHRzLCBkb2MsIGZyYWdtZW50LAoJCWkgPSAwLAoJCWwgPSBjb2xsZWN0aW9uLmxlbmd0aCwKCQlpTm9DbG9uZSA9IGwgLSAxLAoJCXZhbHVlID0gYXJnc1sgMCBdLAoJCWlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkvLyBXZSBjYW4ndCBjbG9uZU5vZGUgZnJhZ21lbnRzIHRoYXQgY29udGFpbiBjaGVja2VkLCBpbiBXZWJLaXQKCWlmICggaXNGdW5jdGlvbiB8fAoJCQkoIGwgPiAxICYmIHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgJiYKCQkJCSFzdXBwb3J0LmNoZWNrQ2xvbmUgJiYgcmNoZWNrZWQudGVzdCggdmFsdWUgKSApICkgewoJCXJldHVybiBjb2xsZWN0aW9uLmVhY2goIGZ1bmN0aW9uKCBpbmRleCApIHsKCQkJdmFyIHNlbGYgPSBjb2xsZWN0aW9uLmVxKCBpbmRleCApOwoJCQlpZiAoIGlzRnVuY3Rpb24gKSB7CgkJCQlhcmdzWyAwIF0gPSB2YWx1ZS5jYWxsKCB0aGlzLCBpbmRleCwgc2VsZi5odG1sKCkgKTsKCQkJfQoJCQlkb21NYW5pcCggc2VsZiwgYXJncywgY2FsbGJhY2ssIGlnbm9yZWQgKTsKCQl9ICk7Cgl9CgoJaWYgKCBsICkgewoJCWZyYWdtZW50ID0gYnVpbGRGcmFnbWVudCggYXJncywgY29sbGVjdGlvblsgMCBdLm93bmVyRG9jdW1lbnQsIGZhbHNlLCBjb2xsZWN0aW9uLCBpZ25vcmVkICk7CgkJZmlyc3QgPSBmcmFnbWVudC5maXJzdENoaWxkOwoKCQlpZiAoIGZyYWdtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICkgewoJCQlmcmFnbWVudCA9IGZpcnN0OwoJCX0KCgkJLy8gUmVxdWlyZSBlaXRoZXIgbmV3IGNvbnRlbnQgb3IgYW4gaW50ZXJlc3QgaW4gaWdub3JlZCBlbGVtZW50cyB0byBpbnZva2UgdGhlIGNhbGxiYWNrCgkJaWYgKCBmaXJzdCB8fCBpZ25vcmVkICkgewoJCQlzY3JpcHRzID0galF1ZXJ5Lm1hcCggZ2V0QWxsKCBmcmFnbWVudCwgInNjcmlwdCIgKSwgZGlzYWJsZVNjcmlwdCApOwoJCQloYXNTY3JpcHRzID0gc2NyaXB0cy5sZW5ndGg7CgoJCQkvLyBVc2UgdGhlIG9yaWdpbmFsIGZyYWdtZW50IGZvciB0aGUgbGFzdCBpdGVtCgkJCS8vIGluc3RlYWQgb2YgdGhlIGZpcnN0IGJlY2F1c2UgaXQgY2FuIGVuZCB1cAoJCQkvLyBiZWluZyBlbXB0aWVkIGluY29ycmVjdGx5IGluIGNlcnRhaW4gc2l0dWF0aW9ucyAoIzgwNzApLgoJCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCQlub2RlID0gZnJhZ21lbnQ7CgoJCQkJaWYgKCBpICE9PSBpTm9DbG9uZSApIHsKCQkJCQlub2RlID0galF1ZXJ5LmNsb25lKCBub2RlLCB0cnVlLCB0cnVlICk7CgoJCQkJCS8vIEtlZXAgcmVmZXJlbmNlcyB0byBjbG9uZWQgc2NyaXB0cyBmb3IgbGF0ZXIgcmVzdG9yYXRpb24KCQkJCQlpZiAoIGhhc1NjcmlwdHMgKSB7CgoJCQkJCQkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMSwgUGhhbnRvbUpTPDIKCQkJCQkJLy8gcHVzaC5hcHBseShfLCBhcnJheWxpa2UpIHRocm93cyBvbiBhbmNpZW50IFdlYktpdAoJCQkJCQlqUXVlcnkubWVyZ2UoIHNjcmlwdHMsIGdldEFsbCggbm9kZSwgInNjcmlwdCIgKSApOwoJCQkJCX0KCQkJCX0KCgkJCQljYWxsYmFjay5jYWxsKCBjb2xsZWN0aW9uWyBpIF0sIG5vZGUsIGkgKTsKCQkJfQoKCQkJaWYgKCBoYXNTY3JpcHRzICkgewoJCQkJZG9jID0gc2NyaXB0c1sgc2NyaXB0cy5sZW5ndGggLSAxIF0ub3duZXJEb2N1bWVudDsKCgkJCQkvLyBSZWVuYWJsZSBzY3JpcHRzCgkJCQlqUXVlcnkubWFwKCBzY3JpcHRzLCByZXN0b3JlU2NyaXB0ICk7CgoJCQkJLy8gRXZhbHVhdGUgZXhlY3V0YWJsZSBzY3JpcHRzIG9uIGZpcnN0IGRvY3VtZW50IGluc2VydGlvbgoJCQkJZm9yICggaSA9IDA7IGkgPCBoYXNTY3JpcHRzOyBpKysgKSB7CgkJCQkJbm9kZSA9IHNjcmlwdHNbIGkgXTsKCQkJCQlpZiAoIHJzY3JpcHRUeXBlLnRlc3QoIG5vZGUudHlwZSB8fCAiIiApICYmCgkJCQkJCSFqUXVlcnkuX2RhdGEoIG5vZGUsICJnbG9iYWxFdmFsIiApICYmCgkJCQkJCWpRdWVyeS5jb250YWlucyggZG9jLCBub2RlICkgKSB7CgoJCQkJCQlpZiAoIG5vZGUuc3JjICkgewoKCQkJCQkJCS8vIE9wdGlvbmFsIEFKQVggZGVwZW5kZW5jeSwgYnV0IHdvbid0IHJ1biBzY3JpcHRzIGlmIG5vdCBwcmVzZW50CgkJCQkJCQlpZiAoIGpRdWVyeS5fZXZhbFVybCApIHsKCQkJCQkJCQlqUXVlcnkuX2V2YWxVcmwoIG5vZGUuc3JjICk7CgkJCQkJCQl9CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlqUXVlcnkuZ2xvYmFsRXZhbCgKCQkJCQkJCQkoIG5vZGUudGV4dCB8fCBub2RlLnRleHRDb250ZW50IHx8IG5vZGUuaW5uZXJIVE1MIHx8ICIiICkKCQkJCQkJCQkJLnJlcGxhY2UoIHJjbGVhblNjcmlwdCwgIiIgKQoJCQkJCQkJKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gRml4ICMxMTgwOTogQXZvaWQgbGVha2luZyBtZW1vcnkKCQkJZnJhZ21lbnQgPSBmaXJzdCA9IG51bGw7CgkJfQoJfQoKCXJldHVybiBjb2xsZWN0aW9uOwp9CgpmdW5jdGlvbiByZW1vdmUoIGVsZW0sIHNlbGVjdG9yLCBrZWVwRGF0YSApIHsKCXZhciBub2RlLAoJCWVsZW1zID0gc2VsZWN0b3IgPyBqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgZWxlbSApIDogZWxlbSwKCQlpID0gMDsKCglmb3IgKCA7ICggbm9kZSA9IGVsZW1zWyBpIF0gKSAhPSBudWxsOyBpKysgKSB7CgoJCWlmICggIWtlZXBEYXRhICYmIG5vZGUubm9kZVR5cGUgPT09IDEgKSB7CgkJCWpRdWVyeS5jbGVhbkRhdGEoIGdldEFsbCggbm9kZSApICk7CgkJfQoKCQlpZiAoIG5vZGUucGFyZW50Tm9kZSApIHsKCQkJaWYgKCBrZWVwRGF0YSAmJiBqUXVlcnkuY29udGFpbnMoIG5vZGUub3duZXJEb2N1bWVudCwgbm9kZSApICkgewoJCQkJc2V0R2xvYmFsRXZhbCggZ2V0QWxsKCBub2RlLCAic2NyaXB0IiApICk7CgkJCX0KCQkJbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBub2RlICk7CgkJfQoJfQoKCXJldHVybiBlbGVtOwp9CgpqUXVlcnkuZXh0ZW5kKCB7CglodG1sUHJlZmlsdGVyOiBmdW5jdGlvbiggaHRtbCApIHsKCQlyZXR1cm4gaHRtbC5yZXBsYWNlKCByeGh0bWxUYWcsICI8JDE+PC8kMj4iICk7Cgl9LAoKCWNsb25lOiBmdW5jdGlvbiggZWxlbSwgZGF0YUFuZEV2ZW50cywgZGVlcERhdGFBbmRFdmVudHMgKSB7CgkJdmFyIGRlc3RFbGVtZW50cywgbm9kZSwgY2xvbmUsIGksIHNyY0VsZW1lbnRzLAoJCQlpblBhZ2UgPSBqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApOwoKCQlpZiAoIHN1cHBvcnQuaHRtbDVDbG9uZSB8fCBqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKSB8fAoJCQkhcm5vc2hpbWNhY2hlLnRlc3QoICI8IiArIGVsZW0ubm9kZU5hbWUgKyAiPiIgKSApIHsKCgkJCWNsb25lID0gZWxlbS5jbG9uZU5vZGUoIHRydWUgKTsKCgkJLy8gSUU8PTggZG9lcyBub3QgcHJvcGVybHkgY2xvbmUgZGV0YWNoZWQsIHVua25vd24gZWxlbWVudCBub2RlcwoJCX0gZWxzZSB7CgkJCWZyYWdtZW50RGl2LmlubmVySFRNTCA9IGVsZW0ub3V0ZXJIVE1MOwoJCQlmcmFnbWVudERpdi5yZW1vdmVDaGlsZCggY2xvbmUgPSBmcmFnbWVudERpdi5maXJzdENoaWxkICk7CgkJfQoKCQlpZiAoICggIXN1cHBvcnQubm9DbG9uZUV2ZW50IHx8ICFzdXBwb3J0Lm5vQ2xvbmVDaGVja2VkICkgJiYKCQkJCSggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBlbGVtLm5vZGVUeXBlID09PSAxMSApICYmICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKSApIHsKCgkJCS8vIFdlIGVzY2hldyBTaXp6bGUgaGVyZSBmb3IgcGVyZm9ybWFuY2UgcmVhc29uczogaHR0cDovL2pzcGVyZi5jb20vZ2V0YWxsLXZzLXNpenpsZS8yCgkJCWRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUgKTsKCQkJc3JjRWxlbWVudHMgPSBnZXRBbGwoIGVsZW0gKTsKCgkJCS8vIEZpeCBhbGwgSUUgY2xvbmluZyBpc3N1ZXMKCQkJZm9yICggaSA9IDA7ICggbm9kZSA9IHNyY0VsZW1lbnRzWyBpIF0gKSAhPSBudWxsOyArK2kgKSB7CgoJCQkJLy8gRW5zdXJlIHRoYXQgdGhlIGRlc3RpbmF0aW9uIG5vZGUgaXMgbm90IG51bGw7IEZpeGVzICM5NTg3CgkJCQlpZiAoIGRlc3RFbGVtZW50c1sgaSBdICkgewoJCQkJCWZpeENsb25lTm9kZUlzc3Vlcyggbm9kZSwgZGVzdEVsZW1lbnRzWyBpIF0gKTsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gQ29weSB0aGUgZXZlbnRzIGZyb20gdGhlIG9yaWdpbmFsIHRvIHRoZSBjbG9uZQoJCWlmICggZGF0YUFuZEV2ZW50cyApIHsKCQkJaWYgKCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQkJCXNyY0VsZW1lbnRzID0gc3JjRWxlbWVudHMgfHwgZ2V0QWxsKCBlbGVtICk7CgkJCQlkZXN0RWxlbWVudHMgPSBkZXN0RWxlbWVudHMgfHwgZ2V0QWxsKCBjbG9uZSApOwoKCQkJCWZvciAoIGkgPSAwOyAoIG5vZGUgPSBzcmNFbGVtZW50c1sgaSBdICkgIT0gbnVsbDsgaSsrICkgewoJCQkJCWNsb25lQ29weUV2ZW50KCBub2RlLCBkZXN0RWxlbWVudHNbIGkgXSApOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJY2xvbmVDb3B5RXZlbnQoIGVsZW0sIGNsb25lICk7CgkJCX0KCQl9CgoJCS8vIFByZXNlcnZlIHNjcmlwdCBldmFsdWF0aW9uIGhpc3RvcnkKCQlkZXN0RWxlbWVudHMgPSBnZXRBbGwoIGNsb25lLCAic2NyaXB0IiApOwoJCWlmICggZGVzdEVsZW1lbnRzLmxlbmd0aCA+IDAgKSB7CgkJCXNldEdsb2JhbEV2YWwoIGRlc3RFbGVtZW50cywgIWluUGFnZSAmJiBnZXRBbGwoIGVsZW0sICJzY3JpcHQiICkgKTsKCQl9CgoJCWRlc3RFbGVtZW50cyA9IHNyY0VsZW1lbnRzID0gbm9kZSA9IG51bGw7CgoJCS8vIFJldHVybiB0aGUgY2xvbmVkIHNldAoJCXJldHVybiBjbG9uZTsKCX0sCgoJY2xlYW5EYXRhOiBmdW5jdGlvbiggZWxlbXMsIC8qIGludGVybmFsICovIGZvcmNlQWNjZXB0RGF0YSApIHsKCQl2YXIgZWxlbSwgdHlwZSwgaWQsIGRhdGEsCgkJCWkgPSAwLAoJCQlpbnRlcm5hbEtleSA9IGpRdWVyeS5leHBhbmRvLAoJCQljYWNoZSA9IGpRdWVyeS5jYWNoZSwKCQkJYXR0cmlidXRlcyA9IHN1cHBvcnQuYXR0cmlidXRlcywKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsOwoKCQlmb3IgKCA7ICggZWxlbSA9IGVsZW1zWyBpIF0gKSAhPSBudWxsOyBpKysgKSB7CgkJCWlmICggZm9yY2VBY2NlcHREYXRhIHx8IGFjY2VwdERhdGEoIGVsZW0gKSApIHsKCgkJCQlpZCA9IGVsZW1bIGludGVybmFsS2V5IF07CgkJCQlkYXRhID0gaWQgJiYgY2FjaGVbIGlkIF07CgoJCQkJaWYgKCBkYXRhICkgewoJCQkJCWlmICggZGF0YS5ldmVudHMgKSB7CgkJCQkJCWZvciAoIHR5cGUgaW4gZGF0YS5ldmVudHMgKSB7CgkJCQkJCQlpZiAoIHNwZWNpYWxbIHR5cGUgXSApIHsKCQkJCQkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICk7CgoJCQkJCQkJLy8gVGhpcyBpcyBhIHNob3J0Y3V0IHRvIGF2b2lkIGpRdWVyeS5ldmVudC5yZW1vdmUncyBvdmVyaGVhZAoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlqUXVlcnkucmVtb3ZlRXZlbnQoIGVsZW0sIHR5cGUsIGRhdGEuaGFuZGxlICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIFJlbW92ZSBjYWNoZSBvbmx5IGlmIGl0IHdhcyBub3QgYWxyZWFkeSByZW1vdmVkIGJ5IGpRdWVyeS5ldmVudC5yZW1vdmUKCQkJCQlpZiAoIGNhY2hlWyBpZCBdICkgewoKCQkJCQkJZGVsZXRlIGNhY2hlWyBpZCBdOwoKCQkJCQkJLy8gU3VwcG9ydDogSUU8OQoJCQkJCQkvLyBJRSBkb2VzIG5vdCBhbGxvdyB1cyB0byBkZWxldGUgZXhwYW5kbyBwcm9wZXJ0aWVzIGZyb20gbm9kZXMKCQkJCQkJLy8gSUUgY3JlYXRlcyBleHBhbmRvIGF0dHJpYnV0ZXMgYWxvbmcgd2l0aCB0aGUgcHJvcGVydHkKCQkJCQkJLy8gSUUgZG9lcyBub3QgaGF2ZSBhIHJlbW92ZUF0dHJpYnV0ZSBmdW5jdGlvbiBvbiBEb2N1bWVudCBub2RlcwoJCQkJCQlpZiAoICFhdHRyaWJ1dGVzICYmIHR5cGVvZiBlbGVtLnJlbW92ZUF0dHJpYnV0ZSAhPT0gInVuZGVmaW5lZCIgKSB7CgkJCQkJCQllbGVtLnJlbW92ZUF0dHJpYnV0ZSggaW50ZXJuYWxLZXkgKTsKCgkJCQkJCS8vIFdlYmtpdCAmIEJsaW5rIHBlcmZvcm1hbmNlIHN1ZmZlcnMgd2hlbiBkZWxldGluZyBwcm9wZXJ0aWVzCgkJCQkJCS8vIGZyb20gRE9NIG5vZGVzLCBzbyBzZXQgdG8gdW5kZWZpbmVkIGluc3RlYWQKCQkJCQkJLy8gaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTM3ODYwNwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJZWxlbVsgaW50ZXJuYWxLZXkgXSA9IHVuZGVmaW5lZDsKCQkJCQkJfQoKCQkJCQkJZGVsZXRlZElkcy5wdXNoKCBpZCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0KfSApOwoKalF1ZXJ5LmZuLmV4dGVuZCggewoKCS8vIEtlZXAgZG9tTWFuaXAgZXhwb3NlZCB1bnRpbCAzLjAgKGdoLTIyMjUpCglkb21NYW5pcDogZG9tTWFuaXAsCgoJZGV0YWNoOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHJlbW92ZSggdGhpcywgc2VsZWN0b3IsIHRydWUgKTsKCX0sCgoJcmVtb3ZlOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHJlbW92ZSggdGhpcywgc2VsZWN0b3IgKTsKCX0sCgoJdGV4dDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPwoJCQkJalF1ZXJ5LnRleHQoIHRoaXMgKSA6CgkJCQl0aGlzLmVtcHR5KCkuYXBwZW5kKAoJCQkJCSggdGhpc1sgMCBdICYmIHRoaXNbIDAgXS5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50ICkuY3JlYXRlVGV4dE5vZGUoIHZhbHVlICkKCQkJCSk7CgkJfSwgbnVsbCwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggKTsKCX0sCgoJYXBwZW5kOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gZG9tTWFuaXAoIHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5ub2RlVHlwZSA9PT0gMSB8fCB0aGlzLm5vZGVUeXBlID09PSAxMSB8fCB0aGlzLm5vZGVUeXBlID09PSA5ICkgewoJCQkJdmFyIHRhcmdldCA9IG1hbmlwdWxhdGlvblRhcmdldCggdGhpcywgZWxlbSApOwoJCQkJdGFyZ2V0LmFwcGVuZENoaWxkKCBlbGVtICk7CgkJCX0KCQl9ICk7Cgl9LAoKCXByZXBlbmQ6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBkb21NYW5pcCggdGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJaWYgKCB0aGlzLm5vZGVUeXBlID09PSAxIHx8IHRoaXMubm9kZVR5cGUgPT09IDExIHx8IHRoaXMubm9kZVR5cGUgPT09IDkgKSB7CgkJCQl2YXIgdGFyZ2V0ID0gbWFuaXB1bGF0aW9uVGFyZ2V0KCB0aGlzLCBlbGVtICk7CgkJCQl0YXJnZXQuaW5zZXJ0QmVmb3JlKCBlbGVtLCB0YXJnZXQuZmlyc3RDaGlsZCApOwoJCQl9CgkJfSApOwoJfSwKCgliZWZvcmU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBkb21NYW5pcCggdGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJaWYgKCB0aGlzLnBhcmVudE5vZGUgKSB7CgkJCQl0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCBlbGVtLCB0aGlzICk7CgkJCX0KCQl9ICk7Cgl9LAoKCWFmdGVyOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gZG9tTWFuaXAoIHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5wYXJlbnROb2RlICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5uZXh0U2libGluZyApOwoJCQl9CgkJfSApOwoJfSwKCgllbXB0eTogZnVuY3Rpb24oKSB7CgkJdmFyIGVsZW0sCgkJCWkgPSAwOwoKCQlmb3IgKCA7ICggZWxlbSA9IHRoaXNbIGkgXSApICE9IG51bGw7IGkrKyApIHsKCgkJCS8vIFJlbW92ZSBlbGVtZW50IG5vZGVzIGFuZCBwcmV2ZW50IG1lbW9yeSBsZWFrcwoJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0sIGZhbHNlICkgKTsKCQkJfQoKCQkJLy8gUmVtb3ZlIGFueSByZW1haW5pbmcgbm9kZXMKCQkJd2hpbGUgKCBlbGVtLmZpcnN0Q2hpbGQgKSB7CgkJCQllbGVtLnJlbW92ZUNoaWxkKCBlbGVtLmZpcnN0Q2hpbGQgKTsKCQkJfQoKCQkJLy8gSWYgdGhpcyBpcyBhIHNlbGVjdCwgZW5zdXJlIHRoYXQgaXQgZGlzcGxheXMgZW1wdHkgKCMxMjMzNikKCQkJLy8gU3VwcG9ydDogSUU8OQoJCQlpZiAoIGVsZW0ub3B0aW9ucyAmJiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJzZWxlY3QiICkgKSB7CgkJCQllbGVtLm9wdGlvbnMubGVuZ3RoID0gMDsKCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCWNsb25lOiBmdW5jdGlvbiggZGF0YUFuZEV2ZW50cywgZGVlcERhdGFBbmRFdmVudHMgKSB7CgkJZGF0YUFuZEV2ZW50cyA9IGRhdGFBbmRFdmVudHMgPT0gbnVsbCA/IGZhbHNlIDogZGF0YUFuZEV2ZW50czsKCQlkZWVwRGF0YUFuZEV2ZW50cyA9IGRlZXBEYXRhQW5kRXZlbnRzID09IG51bGwgPyBkYXRhQW5kRXZlbnRzIDogZGVlcERhdGFBbmRFdmVudHM7CgoJCXJldHVybiB0aGlzLm1hcCggZnVuY3Rpb24oKSB7CgkJCXJldHVybiBqUXVlcnkuY2xvbmUoIHRoaXMsIGRhdGFBbmRFdmVudHMsIGRlZXBEYXRhQW5kRXZlbnRzICk7CgkJfSApOwoJfSwKCglodG1sOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIHZhbHVlICkgewoJCQl2YXIgZWxlbSA9IHRoaXNbIDAgXSB8fCB7fSwKCQkJCWkgPSAwLAoJCQkJbCA9IHRoaXMubGVuZ3RoOwoKCQkJaWYgKCB2YWx1ZSA9PT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIGVsZW0ubm9kZVR5cGUgPT09IDEgPwoJCQkJCWVsZW0uaW5uZXJIVE1MLnJlcGxhY2UoIHJpbmxpbmVqUXVlcnksICIiICkgOgoJCQkJCXVuZGVmaW5lZDsKCQkJfQoKCQkJLy8gU2VlIGlmIHdlIGNhbiB0YWtlIGEgc2hvcnRjdXQgYW5kIGp1c3QgdXNlIGlubmVySFRNTAoJCQlpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgJiYgIXJub0lubmVyaHRtbC50ZXN0KCB2YWx1ZSApICYmCgkJCQkoIHN1cHBvcnQuaHRtbFNlcmlhbGl6ZSB8fCAhcm5vc2hpbWNhY2hlLnRlc3QoIHZhbHVlICkgICkgJiYKCQkJCSggc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSB8fCAhcmxlYWRpbmdXaGl0ZXNwYWNlLnRlc3QoIHZhbHVlICkgKSAmJgoJCQkJIXdyYXBNYXBbICggcnRhZ05hbWUuZXhlYyggdmFsdWUgKSB8fCBbICIiLCAiIiBdIClbIDEgXS50b0xvd2VyQ2FzZSgpIF0gKSB7CgoJCQkJdmFsdWUgPSBqUXVlcnkuaHRtbFByZWZpbHRlciggdmFsdWUgKTsKCgkJCQl0cnkgewoJCQkJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCgkJCQkJCS8vIFJlbW92ZSBlbGVtZW50IG5vZGVzIGFuZCBwcmV2ZW50IG1lbW9yeSBsZWFrcwoJCQkJCQllbGVtID0gdGhpc1sgaSBdIHx8IHt9OwoJCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0sIGZhbHNlICkgKTsKCQkJCQkJCWVsZW0uaW5uZXJIVE1MID0gdmFsdWU7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCWVsZW0gPSAwOwoKCQkJCS8vIElmIHVzaW5nIGlubmVySFRNTCB0aHJvd3MgYW4gZXhjZXB0aW9uLCB1c2UgdGhlIGZhbGxiYWNrIG1ldGhvZAoJCQkJfSBjYXRjaCAoIGUgKSB7fQoJCQl9CgoJCQlpZiAoIGVsZW0gKSB7CgkJCQl0aGlzLmVtcHR5KCkuYXBwZW5kKCB2YWx1ZSApOwoJCQl9CgkJfSwgbnVsbCwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggKTsKCX0sCgoJcmVwbGFjZVdpdGg6IGZ1bmN0aW9uKCkgewoJCXZhciBpZ25vcmVkID0gW107CgoJCS8vIE1ha2UgdGhlIGNoYW5nZXMsIHJlcGxhY2luZyBlYWNoIG5vbi1pZ25vcmVkIGNvbnRleHQgZWxlbWVudCB3aXRoIHRoZSBuZXcgY29udGVudAoJCXJldHVybiBkb21NYW5pcCggdGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJdmFyIHBhcmVudCA9IHRoaXMucGFyZW50Tm9kZTsKCgkJCWlmICggalF1ZXJ5LmluQXJyYXkoIHRoaXMsIGlnbm9yZWQgKSA8IDAgKSB7CgkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIHRoaXMgKSApOwoJCQkJaWYgKCBwYXJlbnQgKSB7CgkJCQkJcGFyZW50LnJlcGxhY2VDaGlsZCggZWxlbSwgdGhpcyApOwoJCQkJfQoJCQl9CgoJCS8vIEZvcmNlIGNhbGxiYWNrIGludm9jYXRpb24KCQl9LCBpZ25vcmVkICk7Cgl9Cn0gKTsKCmpRdWVyeS5lYWNoKCB7CglhcHBlbmRUbzogImFwcGVuZCIsCglwcmVwZW5kVG86ICJwcmVwZW5kIiwKCWluc2VydEJlZm9yZTogImJlZm9yZSIsCglpbnNlcnRBZnRlcjogImFmdGVyIiwKCXJlcGxhY2VBbGw6ICJyZXBsYWNlV2l0aCIKfSwgZnVuY3Rpb24oIG5hbWUsIG9yaWdpbmFsICkgewoJalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJdmFyIGVsZW1zLAoJCQlpID0gMCwKCQkJcmV0ID0gW10sCgkJCWluc2VydCA9IGpRdWVyeSggc2VsZWN0b3IgKSwKCQkJbGFzdCA9IGluc2VydC5sZW5ndGggLSAxOwoKCQlmb3IgKCA7IGkgPD0gbGFzdDsgaSsrICkgewoJCQllbGVtcyA9IGkgPT09IGxhc3QgPyB0aGlzIDogdGhpcy5jbG9uZSggdHJ1ZSApOwoJCQlqUXVlcnkoIGluc2VydFsgaSBdIClbIG9yaWdpbmFsIF0oIGVsZW1zICk7CgoJCQkvLyBNb2Rlcm4gYnJvd3NlcnMgY2FuIGFwcGx5IGpRdWVyeSBjb2xsZWN0aW9ucyBhcyBhcnJheXMsIGJ1dCBvbGRJRSBuZWVkcyBhIC5nZXQoKQoJCQlwdXNoLmFwcGx5KCByZXQsIGVsZW1zLmdldCgpICk7CgkJfQoKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHJldCApOwoJfTsKfSApOwoKCnZhciBpZnJhbWUsCgllbGVtZGlzcGxheSA9IHsKCgkJLy8gU3VwcG9ydDogRmlyZWZveAoJCS8vIFdlIGhhdmUgdG8gcHJlLWRlZmluZSB0aGVzZSB2YWx1ZXMgZm9yIEZGICgjMTAyMjcpCgkJSFRNTDogImJsb2NrIiwKCQlCT0RZOiAiYmxvY2siCgl9OwoKLyoqCiAqIFJldHJpZXZlIHRoZSBhY3R1YWwgZGlzcGxheSBvZiBhIGVsZW1lbnQKICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgbm9kZU5hbWUgb2YgdGhlIGVsZW1lbnQKICogQHBhcmFtIHtPYmplY3R9IGRvYyBEb2N1bWVudCBvYmplY3QKICovCgovLyBDYWxsZWQgb25seSBmcm9tIHdpdGhpbiBkZWZhdWx0RGlzcGxheQpmdW5jdGlvbiBhY3R1YWxEaXNwbGF5KCBuYW1lLCBkb2MgKSB7Cgl2YXIgZWxlbSA9IGpRdWVyeSggZG9jLmNyZWF0ZUVsZW1lbnQoIG5hbWUgKSApLmFwcGVuZFRvKCBkb2MuYm9keSApLAoKCQlkaXNwbGF5ID0galF1ZXJ5LmNzcyggZWxlbVsgMCBdLCAiZGlzcGxheSIgKTsKCgkvLyBXZSBkb24ndCBoYXZlIGFueSBkYXRhIHN0b3JlZCBvbiB0aGUgZWxlbWVudCwKCS8vIHNvIHVzZSAiZGV0YWNoIiBtZXRob2QgYXMgZmFzdCB3YXkgdG8gZ2V0IHJpZCBvZiB0aGUgZWxlbWVudAoJZWxlbS5kZXRhY2goKTsKCglyZXR1cm4gZGlzcGxheTsKfQoKLyoqCiAqIFRyeSB0byBkZXRlcm1pbmUgdGhlIGRlZmF1bHQgZGlzcGxheSB2YWx1ZSBvZiBhbiBlbGVtZW50CiAqIEBwYXJhbSB7U3RyaW5nfSBub2RlTmFtZQogKi8KZnVuY3Rpb24gZGVmYXVsdERpc3BsYXkoIG5vZGVOYW1lICkgewoJdmFyIGRvYyA9IGRvY3VtZW50LAoJCWRpc3BsYXkgPSBlbGVtZGlzcGxheVsgbm9kZU5hbWUgXTsKCglpZiAoICFkaXNwbGF5ICkgewoJCWRpc3BsYXkgPSBhY3R1YWxEaXNwbGF5KCBub2RlTmFtZSwgZG9jICk7CgoJCS8vIElmIHRoZSBzaW1wbGUgd2F5IGZhaWxzLCByZWFkIGZyb20gaW5zaWRlIGFuIGlmcmFtZQoJCWlmICggZGlzcGxheSA9PT0gIm5vbmUiIHx8ICFkaXNwbGF5ICkgewoKCQkJLy8gVXNlIHRoZSBhbHJlYWR5LWNyZWF0ZWQgaWZyYW1lIGlmIHBvc3NpYmxlCgkJCWlmcmFtZSA9ICggaWZyYW1lIHx8IGpRdWVyeSggIjxpZnJhbWUgZnJhbWVib3JkZXI9JzAnIHdpZHRoPScwJyBoZWlnaHQ9JzAnLz4iICkgKQoJCQkJLmFwcGVuZFRvKCBkb2MuZG9jdW1lbnRFbGVtZW50ICk7CgoJCQkvLyBBbHdheXMgd3JpdGUgYSBuZXcgSFRNTCBza2VsZXRvbiBzbyBXZWJraXQgYW5kIEZpcmVmb3ggZG9uJ3QgY2hva2Ugb24gcmV1c2UKCQkJZG9jID0gKCBpZnJhbWVbIDAgXS5jb250ZW50V2luZG93IHx8IGlmcmFtZVsgMCBdLmNvbnRlbnREb2N1bWVudCApLmRvY3VtZW50OwoKCQkJLy8gU3VwcG9ydDogSUUKCQkJZG9jLndyaXRlKCk7CgkJCWRvYy5jbG9zZSgpOwoKCQkJZGlzcGxheSA9IGFjdHVhbERpc3BsYXkoIG5vZGVOYW1lLCBkb2MgKTsKCQkJaWZyYW1lLmRldGFjaCgpOwoJCX0KCgkJLy8gU3RvcmUgdGhlIGNvcnJlY3QgZGVmYXVsdCBkaXNwbGF5CgkJZWxlbWRpc3BsYXlbIG5vZGVOYW1lIF0gPSBkaXNwbGF5OwoJfQoKCXJldHVybiBkaXNwbGF5Owp9CnZhciBybWFyZ2luID0gKCAvXm1hcmdpbi8gKTsKCnZhciBybnVtbm9ucHggPSBuZXcgUmVnRXhwKCAiXigiICsgcG51bSArICIpKD8hcHgpW2EteiVdKyQiLCAiaSIgKTsKCnZhciBzd2FwID0gZnVuY3Rpb24oIGVsZW0sIG9wdGlvbnMsIGNhbGxiYWNrLCBhcmdzICkgewoJdmFyIHJldCwgbmFtZSwKCQlvbGQgPSB7fTsKCgkvLyBSZW1lbWJlciB0aGUgb2xkIHZhbHVlcywgYW5kIGluc2VydCB0aGUgbmV3IG9uZXMKCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQlvbGRbIG5hbWUgXSA9IGVsZW0uc3R5bGVbIG5hbWUgXTsKCQllbGVtLnN0eWxlWyBuYW1lIF0gPSBvcHRpb25zWyBuYW1lIF07Cgl9CgoJcmV0ID0gY2FsbGJhY2suYXBwbHkoIGVsZW0sIGFyZ3MgfHwgW10gKTsKCgkvLyBSZXZlcnQgdGhlIG9sZCB2YWx1ZXMKCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQllbGVtLnN0eWxlWyBuYW1lIF0gPSBvbGRbIG5hbWUgXTsKCX0KCglyZXR1cm4gcmV0Owp9OwoKCnZhciBkb2N1bWVudEVsZW1lbnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgoKCiggZnVuY3Rpb24oKSB7Cgl2YXIgcGl4ZWxQb3NpdGlvblZhbCwgcGl4ZWxNYXJnaW5SaWdodFZhbCwgYm94U2l6aW5nUmVsaWFibGVWYWwsCgkJcmVsaWFibGVIaWRkZW5PZmZzZXRzVmFsLCByZWxpYWJsZU1hcmdpblJpZ2h0VmFsLCByZWxpYWJsZU1hcmdpbkxlZnRWYWwsCgkJY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKSwKCQlkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoKCS8vIEZpbmlzaCBlYXJseSBpbiBsaW1pdGVkIChub24tYnJvd3NlcikgZW52aXJvbm1lbnRzCglpZiAoICFkaXYuc3R5bGUgKSB7CgkJcmV0dXJuOwoJfQoKCWRpdi5zdHlsZS5jc3NUZXh0ID0gImZsb2F0OmxlZnQ7b3BhY2l0eTouNSI7CgoJLy8gU3VwcG9ydDogSUU8OQoJLy8gTWFrZSBzdXJlIHRoYXQgZWxlbWVudCBvcGFjaXR5IGV4aXN0cyAoYXMgb3Bwb3NlZCB0byBmaWx0ZXIpCglzdXBwb3J0Lm9wYWNpdHkgPSBkaXYuc3R5bGUub3BhY2l0eSA9PT0gIjAuNSI7CgoJLy8gVmVyaWZ5IHN0eWxlIGZsb2F0IGV4aXN0ZW5jZQoJLy8gKElFIHVzZXMgc3R5bGVGbG9hdCBpbnN0ZWFkIG9mIGNzc0Zsb2F0KQoJc3VwcG9ydC5jc3NGbG9hdCA9ICEhZGl2LnN0eWxlLmNzc0Zsb2F0OwoKCWRpdi5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICJjb250ZW50LWJveCI7CglkaXYuY2xvbmVOb2RlKCB0cnVlICkuc3R5bGUuYmFja2dyb3VuZENsaXAgPSAiIjsKCXN1cHBvcnQuY2xlYXJDbG9uZVN0eWxlID0gZGl2LnN0eWxlLmJhY2tncm91bmRDbGlwID09PSAiY29udGVudC1ib3giOwoKCWNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICk7Cgljb250YWluZXIuc3R5bGUuY3NzVGV4dCA9ICJib3JkZXI6MDt3aWR0aDo4cHg7aGVpZ2h0OjA7dG9wOjA7bGVmdDotOTk5OXB4OyIgKwoJCSJwYWRkaW5nOjA7bWFyZ2luLXRvcDoxcHg7cG9zaXRpb246YWJzb2x1dGUiOwoJZGl2LmlubmVySFRNTCA9ICIiOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKCBkaXYgKTsKCgkvLyBTdXBwb3J0OiBGaXJlZm94PDI5LCBBbmRyb2lkIDIuMwoJLy8gVmVuZG9yLXByZWZpeCBib3gtc2l6aW5nCglzdXBwb3J0LmJveFNpemluZyA9IGRpdi5zdHlsZS5ib3hTaXppbmcgPT09ICIiIHx8IGRpdi5zdHlsZS5Nb3pCb3hTaXppbmcgPT09ICIiIHx8CgkJZGl2LnN0eWxlLldlYmtpdEJveFNpemluZyA9PT0gIiI7CgoJalF1ZXJ5LmV4dGVuZCggc3VwcG9ydCwgewoJCXJlbGlhYmxlSGlkZGVuT2Zmc2V0czogZnVuY3Rpb24oKSB7CgkJCWlmICggcGl4ZWxQb3NpdGlvblZhbCA9PSBudWxsICkgewoJCQkJY29tcHV0ZVN0eWxlVGVzdHMoKTsKCQkJfQoJCQlyZXR1cm4gcmVsaWFibGVIaWRkZW5PZmZzZXRzVmFsOwoJCX0sCgoJCWJveFNpemluZ1JlbGlhYmxlOiBmdW5jdGlvbigpIHsKCgkJCS8vIFdlJ3JlIGNoZWNraW5nIGZvciBwaXhlbFBvc2l0aW9uVmFsIGhlcmUgaW5zdGVhZCBvZiBib3hTaXppbmdSZWxpYWJsZVZhbAoJCQkvLyBzaW5jZSB0aGF0IGNvbXByZXNzZXMgYmV0dGVyIGFuZCB0aGV5J3JlIGNvbXB1dGVkIHRvZ2V0aGVyIGFueXdheS4KCQkJaWYgKCBwaXhlbFBvc2l0aW9uVmFsID09IG51bGwgKSB7CgkJCQljb21wdXRlU3R5bGVUZXN0cygpOwoJCQl9CgkJCXJldHVybiBib3hTaXppbmdSZWxpYWJsZVZhbDsKCQl9LAoKCQlwaXhlbE1hcmdpblJpZ2h0OiBmdW5jdGlvbigpIHsKCgkJCS8vIFN1cHBvcnQ6IEFuZHJvaWQgNC4wLTQuMwoJCQlpZiAoIHBpeGVsUG9zaXRpb25WYWwgPT0gbnVsbCApIHsKCQkJCWNvbXB1dGVTdHlsZVRlc3RzKCk7CgkJCX0KCQkJcmV0dXJuIHBpeGVsTWFyZ2luUmlnaHRWYWw7CgkJfSwKCgkJcGl4ZWxQb3NpdGlvbjogZnVuY3Rpb24oKSB7CgkJCWlmICggcGl4ZWxQb3NpdGlvblZhbCA9PSBudWxsICkgewoJCQkJY29tcHV0ZVN0eWxlVGVzdHMoKTsKCQkJfQoJCQlyZXR1cm4gcGl4ZWxQb3NpdGlvblZhbDsKCQl9LAoKCQlyZWxpYWJsZU1hcmdpblJpZ2h0OiBmdW5jdGlvbigpIHsKCgkJCS8vIFN1cHBvcnQ6IEFuZHJvaWQgMi4zCgkJCWlmICggcGl4ZWxQb3NpdGlvblZhbCA9PSBudWxsICkgewoJCQkJY29tcHV0ZVN0eWxlVGVzdHMoKTsKCQkJfQoJCQlyZXR1cm4gcmVsaWFibGVNYXJnaW5SaWdodFZhbDsKCQl9LAoKCQlyZWxpYWJsZU1hcmdpbkxlZnQ6IGZ1bmN0aW9uKCkgewoKCQkJLy8gU3VwcG9ydDogSUUgPD04IG9ubHksIEFuZHJvaWQgNC4wIC0gNC4zIG9ubHksIEZpcmVmb3ggPD0zIC0gMzcKCQkJaWYgKCBwaXhlbFBvc2l0aW9uVmFsID09IG51bGwgKSB7CgkJCQljb21wdXRlU3R5bGVUZXN0cygpOwoJCQl9CgkJCXJldHVybiByZWxpYWJsZU1hcmdpbkxlZnRWYWw7CgkJfQoJfSApOwoKCWZ1bmN0aW9uIGNvbXB1dGVTdHlsZVRlc3RzKCkgewoJCXZhciBjb250ZW50cywgZGl2U3R5bGUsCgkJCWRvY3VtZW50RWxlbWVudCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCgkJLy8gU2V0dXAKCQlkb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoIGNvbnRhaW5lciApOwoKCQlkaXYuc3R5bGUuY3NzVGV4dCA9CgoJCQkvLyBTdXBwb3J0OiBBbmRyb2lkIDIuMwoJCQkvLyBWZW5kb3ItcHJlZml4IGJveC1zaXppbmcKCQkJIi13ZWJraXQtYm94LXNpemluZzpib3JkZXItYm94O2JveC1zaXppbmc6Ym9yZGVyLWJveDsiICsKCQkJInBvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6YmxvY2s7IiArCgkJCSJtYXJnaW46YXV0bztib3JkZXI6MXB4O3BhZGRpbmc6MXB4OyIgKwoJCQkidG9wOjElO3dpZHRoOjUwJSI7CgoJCS8vIFN1cHBvcnQ6IElFPDkKCQkvLyBBc3N1bWUgcmVhc29uYWJsZSB2YWx1ZXMgaW4gdGhlIGFic2VuY2Ugb2YgZ2V0Q29tcHV0ZWRTdHlsZQoJCXBpeGVsUG9zaXRpb25WYWwgPSBib3hTaXppbmdSZWxpYWJsZVZhbCA9IHJlbGlhYmxlTWFyZ2luTGVmdFZhbCA9IGZhbHNlOwoJCXBpeGVsTWFyZ2luUmlnaHRWYWwgPSByZWxpYWJsZU1hcmdpblJpZ2h0VmFsID0gdHJ1ZTsKCgkJLy8gQ2hlY2sgZm9yIGdldENvbXB1dGVkU3R5bGUgc28gdGhhdCB0aGlzIGNvZGUgaXMgbm90IHJ1biBpbiBJRTw5LgoJCWlmICggd2luZG93LmdldENvbXB1dGVkU3R5bGUgKSB7CgkJCWRpdlN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoIGRpdiApOwoJCQlwaXhlbFBvc2l0aW9uVmFsID0gKCBkaXZTdHlsZSB8fCB7fSApLnRvcCAhPT0gIjElIjsKCQkJcmVsaWFibGVNYXJnaW5MZWZ0VmFsID0gKCBkaXZTdHlsZSB8fCB7fSApLm1hcmdpbkxlZnQgPT09ICIycHgiOwoJCQlib3hTaXppbmdSZWxpYWJsZVZhbCA9ICggZGl2U3R5bGUgfHwgeyB3aWR0aDogIjRweCIgfSApLndpZHRoID09PSAiNHB4IjsKCgkJCS8vIFN1cHBvcnQ6IEFuZHJvaWQgNC4wIC0gNC4zIG9ubHkKCQkJLy8gU29tZSBzdHlsZXMgY29tZSBiYWNrIHdpdGggcGVyY2VudGFnZSB2YWx1ZXMsIGV2ZW4gdGhvdWdoIHRoZXkgc2hvdWxkbid0CgkJCWRpdi5zdHlsZS5tYXJnaW5SaWdodCA9ICI1MCUiOwoJCQlwaXhlbE1hcmdpblJpZ2h0VmFsID0gKCBkaXZTdHlsZSB8fCB7IG1hcmdpblJpZ2h0OiAiNHB4IiB9ICkubWFyZ2luUmlnaHQgPT09ICI0cHgiOwoKCQkJLy8gU3VwcG9ydDogQW5kcm9pZCAyLjMgb25seQoJCQkvLyBEaXYgd2l0aCBleHBsaWNpdCB3aWR0aCBhbmQgbm8gbWFyZ2luLXJpZ2h0IGluY29ycmVjdGx5CgkJCS8vIGdldHMgY29tcHV0ZWQgbWFyZ2luLXJpZ2h0IGJhc2VkIG9uIHdpZHRoIG9mIGNvbnRhaW5lciAoIzMzMzMpCgkJCS8vIFdlYktpdCBCdWcgMTMzNDMgLSBnZXRDb21wdXRlZFN0eWxlIHJldHVybnMgd3JvbmcgdmFsdWUgZm9yIG1hcmdpbi1yaWdodAoJCQljb250ZW50cyA9IGRpdi5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKSApOwoKCQkJLy8gUmVzZXQgQ1NTOiBib3gtc2l6aW5nOyBkaXNwbGF5OyBtYXJnaW47IGJvcmRlcjsgcGFkZGluZwoJCQljb250ZW50cy5zdHlsZS5jc3NUZXh0ID0gZGl2LnN0eWxlLmNzc1RleHQgPQoKCQkJCS8vIFN1cHBvcnQ6IEFuZHJvaWQgMi4zCgkJCQkvLyBWZW5kb3ItcHJlZml4IGJveC1zaXppbmcKCQkJCSItd2Via2l0LWJveC1zaXppbmc6Y29udGVudC1ib3g7LW1vei1ib3gtc2l6aW5nOmNvbnRlbnQtYm94OyIgKwoJCQkJImJveC1zaXppbmc6Y29udGVudC1ib3g7ZGlzcGxheTpibG9jazttYXJnaW46MDtib3JkZXI6MDtwYWRkaW5nOjAiOwoJCQljb250ZW50cy5zdHlsZS5tYXJnaW5SaWdodCA9IGNvbnRlbnRzLnN0eWxlLndpZHRoID0gIjAiOwoJCQlkaXYuc3R5bGUud2lkdGggPSAiMXB4IjsKCgkJCXJlbGlhYmxlTWFyZ2luUmlnaHRWYWwgPQoJCQkJIXBhcnNlRmxvYXQoICggd2luZG93LmdldENvbXB1dGVkU3R5bGUoIGNvbnRlbnRzICkgfHwge30gKS5tYXJnaW5SaWdodCApOwoKCQkJZGl2LnJlbW92ZUNoaWxkKCBjb250ZW50cyApOwoJCX0KCgkJLy8gU3VwcG9ydDogSUU2LTgKCQkvLyBGaXJzdCBjaGVjayB0aGF0IGdldENsaWVudFJlY3RzIHdvcmtzIGFzIGV4cGVjdGVkCgkJLy8gQ2hlY2sgaWYgdGFibGUgY2VsbHMgc3RpbGwgaGF2ZSBvZmZzZXRXaWR0aC9IZWlnaHQgd2hlbiB0aGV5IGFyZSBzZXQKCQkvLyB0byBkaXNwbGF5Om5vbmUgYW5kIHRoZXJlIGFyZSBzdGlsbCBvdGhlciB2aXNpYmxlIHRhYmxlIGNlbGxzIGluIGEKCQkvLyB0YWJsZSByb3c7IGlmIHNvLCBvZmZzZXRXaWR0aC9IZWlnaHQgYXJlIG5vdCByZWxpYWJsZSBmb3IgdXNlIHdoZW4KCQkvLyBkZXRlcm1pbmluZyBpZiBhbiBlbGVtZW50IGhhcyBiZWVuIGhpZGRlbiBkaXJlY3RseSB1c2luZwoJCS8vIGRpc3BsYXk6bm9uZSAoaXQgaXMgc3RpbGwgc2FmZSB0byB1c2Ugb2Zmc2V0cyBpZiBhIHBhcmVudCBlbGVtZW50IGlzCgkJLy8gaGlkZGVuOyBkb24gc2FmZXR5IGdvZ2dsZXMgYW5kIHNlZSBidWcgIzQ1MTIgZm9yIG1vcmUgaW5mb3JtYXRpb24pLgoJCWRpdi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCXJlbGlhYmxlSGlkZGVuT2Zmc2V0c1ZhbCA9IGRpdi5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCA9PT0gMDsKCQlpZiAoIHJlbGlhYmxlSGlkZGVuT2Zmc2V0c1ZhbCApIHsKCQkJZGl2LnN0eWxlLmRpc3BsYXkgPSAiIjsKCQkJZGl2LmlubmVySFRNTCA9ICI8dGFibGU+PHRyPjx0ZD48L3RkPjx0ZD50PC90ZD48L3RyPjwvdGFibGU+IjsKCQkJZGl2LmNoaWxkTm9kZXNbIDAgXS5zdHlsZS5ib3JkZXJDb2xsYXBzZSA9ICJzZXBhcmF0ZSI7CgkJCWNvbnRlbnRzID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCAidGQiICk7CgkJCWNvbnRlbnRzWyAwIF0uc3R5bGUuY3NzVGV4dCA9ICJtYXJnaW46MDtib3JkZXI6MDtwYWRkaW5nOjA7ZGlzcGxheTpub25lIjsKCQkJcmVsaWFibGVIaWRkZW5PZmZzZXRzVmFsID0gY29udGVudHNbIDAgXS5vZmZzZXRIZWlnaHQgPT09IDA7CgkJCWlmICggcmVsaWFibGVIaWRkZW5PZmZzZXRzVmFsICkgewoJCQkJY29udGVudHNbIDAgXS5zdHlsZS5kaXNwbGF5ID0gIiI7CgkJCQljb250ZW50c1sgMSBdLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQlyZWxpYWJsZUhpZGRlbk9mZnNldHNWYWwgPSBjb250ZW50c1sgMCBdLm9mZnNldEhlaWdodCA9PT0gMDsKCQkJfQoJCX0KCgkJLy8gVGVhcmRvd24KCQlkb2N1bWVudEVsZW1lbnQucmVtb3ZlQ2hpbGQoIGNvbnRhaW5lciApOwoJfQoKfSApKCk7CgoKdmFyIGdldFN0eWxlcywgY3VyQ1NTLAoJcnBvc2l0aW9uID0gL14odG9wfHJpZ2h0fGJvdHRvbXxsZWZ0KSQvOwoKaWYgKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSApIHsKCWdldFN0eWxlcyA9IGZ1bmN0aW9uKCBlbGVtICkgewoKCQkvLyBTdXBwb3J0OiBJRTw9MTErLCBGaXJlZm94PD0zMCsgKCMxNTA5OCwgIzE0MTUwKQoJCS8vIElFIHRocm93cyBvbiBlbGVtZW50cyBjcmVhdGVkIGluIHBvcHVwcwoJCS8vIEZGIG1lYW53aGlsZSB0aHJvd3Mgb24gZnJhbWUgZWxlbWVudHMgdGhyb3VnaCAiZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSIKCQl2YXIgdmlldyA9IGVsZW0ub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldzsKCgkJaWYgKCAhdmlldyB8fCAhdmlldy5vcGVuZXIgKSB7CgkJCXZpZXcgPSB3aW5kb3c7CgkJfQoKCQlyZXR1cm4gdmlldy5nZXRDb21wdXRlZFN0eWxlKCBlbGVtICk7Cgl9OwoKCWN1ckNTUyA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBjb21wdXRlZCApIHsKCQl2YXIgd2lkdGgsIG1pbldpZHRoLCBtYXhXaWR0aCwgcmV0LAoJCQlzdHlsZSA9IGVsZW0uc3R5bGU7CgoJCWNvbXB1dGVkID0gY29tcHV0ZWQgfHwgZ2V0U3R5bGVzKCBlbGVtICk7CgoJCS8vIGdldFByb3BlcnR5VmFsdWUgaXMgb25seSBuZWVkZWQgZm9yIC5jc3MoJ2ZpbHRlcicpIGluIElFOSwgc2VlICMxMjUzNwoJCXJldCA9IGNvbXB1dGVkID8gY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZSggbmFtZSApIHx8IGNvbXB1dGVkWyBuYW1lIF0gOiB1bmRlZmluZWQ7CgoJCS8vIFN1cHBvcnQ6IE9wZXJhIDEyLjF4IG9ubHkKCQkvLyBGYWxsIGJhY2sgdG8gc3R5bGUgZXZlbiB3aXRob3V0IGNvbXB1dGVkCgkJLy8gY29tcHV0ZWQgaXMgdW5kZWZpbmVkIGZvciBlbGVtcyBvbiBkb2N1bWVudCBmcmFnbWVudHMKCQlpZiAoICggcmV0ID09PSAiIiB8fCByZXQgPT09IHVuZGVmaW5lZCApICYmICFqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApICkgewoJCQlyZXQgPSBqUXVlcnkuc3R5bGUoIGVsZW0sIG5hbWUgKTsKCQl9CgoJCWlmICggY29tcHV0ZWQgKSB7CgoJCQkvLyBBIHRyaWJ1dGUgdG8gdGhlICJhd2Vzb21lIGhhY2sgYnkgRGVhbiBFZHdhcmRzIgoJCQkvLyBDaHJvbWUgPCAxNyBhbmQgU2FmYXJpIDUuMCB1c2VzICJjb21wdXRlZCB2YWx1ZSIKCQkJLy8gaW5zdGVhZCBvZiAidXNlZCB2YWx1ZSIgZm9yIG1hcmdpbi1yaWdodAoJCQkvLyBTYWZhcmkgNS4xLjcgKGF0IGxlYXN0KSByZXR1cm5zIHBlcmNlbnRhZ2UgZm9yIGEgbGFyZ2VyIHNldCBvZiB2YWx1ZXMsCgkJCS8vIGJ1dCB3aWR0aCBzZWVtcyB0byBiZSByZWxpYWJseSBwaXhlbHMKCQkJLy8gdGhpcyBpcyBhZ2FpbnN0IHRoZSBDU1NPTSBkcmFmdCBzcGVjOgoJCQkvLyBodHRwOi8vZGV2LnczLm9yZy9jc3N3Zy9jc3NvbS8jcmVzb2x2ZWQtdmFsdWVzCgkJCWlmICggIXN1cHBvcnQucGl4ZWxNYXJnaW5SaWdodCgpICYmIHJudW1ub25weC50ZXN0KCByZXQgKSAmJiBybWFyZ2luLnRlc3QoIG5hbWUgKSApIHsKCgkJCQkvLyBSZW1lbWJlciB0aGUgb3JpZ2luYWwgdmFsdWVzCgkJCQl3aWR0aCA9IHN0eWxlLndpZHRoOwoJCQkJbWluV2lkdGggPSBzdHlsZS5taW5XaWR0aDsKCQkJCW1heFdpZHRoID0gc3R5bGUubWF4V2lkdGg7CgoJCQkJLy8gUHV0IGluIHRoZSBuZXcgdmFsdWVzIHRvIGdldCBhIGNvbXB1dGVkIHZhbHVlIG91dAoJCQkJc3R5bGUubWluV2lkdGggPSBzdHlsZS5tYXhXaWR0aCA9IHN0eWxlLndpZHRoID0gcmV0OwoJCQkJcmV0ID0gY29tcHV0ZWQud2lkdGg7CgoJCQkJLy8gUmV2ZXJ0IHRoZSBjaGFuZ2VkIHZhbHVlcwoJCQkJc3R5bGUud2lkdGggPSB3aWR0aDsKCQkJCXN0eWxlLm1pbldpZHRoID0gbWluV2lkdGg7CgkJCQlzdHlsZS5tYXhXaWR0aCA9IG1heFdpZHRoOwoJCQl9CgkJfQoKCQkvLyBTdXBwb3J0OiBJRQoJCS8vIElFIHJldHVybnMgekluZGV4IHZhbHVlIGFzIGFuIGludGVnZXIuCgkJcmV0dXJuIHJldCA9PT0gdW5kZWZpbmVkID8KCQkJcmV0IDoKCQkJcmV0ICsgIiI7Cgl9Owp9IGVsc2UgaWYgKCBkb2N1bWVudEVsZW1lbnQuY3VycmVudFN0eWxlICkgewoJZ2V0U3R5bGVzID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGVsZW0uY3VycmVudFN0eWxlOwoJfTsKCgljdXJDU1MgPSBmdW5jdGlvbiggZWxlbSwgbmFtZSwgY29tcHV0ZWQgKSB7CgkJdmFyIGxlZnQsIHJzLCByc0xlZnQsIHJldCwKCQkJc3R5bGUgPSBlbGVtLnN0eWxlOwoKCQljb21wdXRlZCA9IGNvbXB1dGVkIHx8IGdldFN0eWxlcyggZWxlbSApOwoJCXJldCA9IGNvbXB1dGVkID8gY29tcHV0ZWRbIG5hbWUgXSA6IHVuZGVmaW5lZDsKCgkJLy8gQXZvaWQgc2V0dGluZyByZXQgdG8gZW1wdHkgc3RyaW5nIGhlcmUKCQkvLyBzbyB3ZSBkb24ndCBkZWZhdWx0IHRvIGF1dG8KCQlpZiAoIHJldCA9PSBudWxsICYmIHN0eWxlICYmIHN0eWxlWyBuYW1lIF0gKSB7CgkJCXJldCA9IHN0eWxlWyBuYW1lIF07CgkJfQoKCQkvLyBGcm9tIHRoZSBhd2Vzb21lIGhhY2sgYnkgRGVhbiBFZHdhcmRzCgkJLy8gaHR0cDovL2VyaWsuZWFlLm5ldC9hcmNoaXZlcy8yMDA3LzA3LzI3LzE4LjU0LjE1LyNjb21tZW50LTEwMjI5MQoKCQkvLyBJZiB3ZSdyZSBub3QgZGVhbGluZyB3aXRoIGEgcmVndWxhciBwaXhlbCBudW1iZXIKCQkvLyBidXQgYSBudW1iZXIgdGhhdCBoYXMgYSB3ZWlyZCBlbmRpbmcsIHdlIG5lZWQgdG8gY29udmVydCBpdCB0byBwaXhlbHMKCQkvLyBidXQgbm90IHBvc2l0aW9uIGNzcyBhdHRyaWJ1dGVzLCBhcyB0aG9zZSBhcmUKCQkvLyBwcm9wb3J0aW9uYWwgdG8gdGhlIHBhcmVudCBlbGVtZW50IGluc3RlYWQKCQkvLyBhbmQgd2UgY2FuJ3QgbWVhc3VyZSB0aGUgcGFyZW50IGluc3RlYWQgYmVjYXVzZSBpdAoJCS8vIG1pZ2h0IHRyaWdnZXIgYSAic3RhY2tpbmcgZG9sbHMiIHByb2JsZW0KCQlpZiAoIHJudW1ub25weC50ZXN0KCByZXQgKSAmJiAhcnBvc2l0aW9uLnRlc3QoIG5hbWUgKSApIHsKCgkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJbGVmdCA9IHN0eWxlLmxlZnQ7CgkJCXJzID0gZWxlbS5ydW50aW1lU3R5bGU7CgkJCXJzTGVmdCA9IHJzICYmIHJzLmxlZnQ7CgoJCQkvLyBQdXQgaW4gdGhlIG5ldyB2YWx1ZXMgdG8gZ2V0IGEgY29tcHV0ZWQgdmFsdWUgb3V0CgkJCWlmICggcnNMZWZ0ICkgewoJCQkJcnMubGVmdCA9IGVsZW0uY3VycmVudFN0eWxlLmxlZnQ7CgkJCX0KCQkJc3R5bGUubGVmdCA9IG5hbWUgPT09ICJmb250U2l6ZSIgPyAiMWVtIiA6IHJldDsKCQkJcmV0ID0gc3R5bGUucGl4ZWxMZWZ0ICsgInB4IjsKCgkJCS8vIFJldmVydCB0aGUgY2hhbmdlZCB2YWx1ZXMKCQkJc3R5bGUubGVmdCA9IGxlZnQ7CgkJCWlmICggcnNMZWZ0ICkgewoJCQkJcnMubGVmdCA9IHJzTGVmdDsKCQkJfQoJCX0KCgkJLy8gU3VwcG9ydDogSUUKCQkvLyBJRSByZXR1cm5zIHpJbmRleCB2YWx1ZSBhcyBhbiBpbnRlZ2VyLgoJCXJldHVybiByZXQgPT09IHVuZGVmaW5lZCA/CgkJCXJldCA6CgkJCXJldCArICIiIHx8ICJhdXRvIjsKCX07Cn0KCgoKCmZ1bmN0aW9uIGFkZEdldEhvb2tJZiggY29uZGl0aW9uRm4sIGhvb2tGbiApIHsKCgkvLyBEZWZpbmUgdGhlIGhvb2ssIHdlJ2xsIGNoZWNrIG9uIHRoZSBmaXJzdCBydW4gaWYgaXQncyByZWFsbHkgbmVlZGVkLgoJcmV0dXJuIHsKCQlnZXQ6IGZ1bmN0aW9uKCkgewoJCQlpZiAoIGNvbmRpdGlvbkZuKCkgKSB7CgoJCQkJLy8gSG9vayBub3QgbmVlZGVkIChvciBpdCdzIG5vdCBwb3NzaWJsZSB0byB1c2UgaXQgZHVlCgkJCQkvLyB0byBtaXNzaW5nIGRlcGVuZGVuY3kpLCByZW1vdmUgaXQuCgkJCQlkZWxldGUgdGhpcy5nZXQ7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIEhvb2sgbmVlZGVkOyByZWRlZmluZSBpdCBzbyB0aGF0IHRoZSBzdXBwb3J0IHRlc3QgaXMgbm90IGV4ZWN1dGVkIGFnYWluLgoJCQlyZXR1cm4gKCB0aGlzLmdldCA9IGhvb2tGbiApLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQl9Cgl9Owp9CgoKdmFyCgoJCXJhbHBoYSA9IC9hbHBoYVwoW14pXSpcKS9pLAoJcm9wYWNpdHkgPSAvb3BhY2l0eVxzKj1ccyooW14pXSopL2ksCgoJLy8gc3dhcHBhYmxlIGlmIGRpc3BsYXkgaXMgbm9uZSBvciBzdGFydHMgd2l0aCB0YWJsZSBleGNlcHQKCS8vICJ0YWJsZSIsICJ0YWJsZS1jZWxsIiwgb3IgInRhYmxlLWNhcHRpb24iCgkvLyBzZWUgaGVyZSBmb3IgZGlzcGxheSB2YWx1ZXM6CgkvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL0NTUy9kaXNwbGF5CglyZGlzcGxheXN3YXAgPSAvXihub25lfHRhYmxlKD8hLWNbZWFdKS4rKS8sCglybnVtc3BsaXQgPSBuZXcgUmVnRXhwKCAiXigiICsgcG51bSArICIpKC4qKSQiLCAiaSIgKSwKCgljc3NTaG93ID0geyBwb3NpdGlvbjogImFic29sdXRlIiwgdmlzaWJpbGl0eTogImhpZGRlbiIsIGRpc3BsYXk6ICJibG9jayIgfSwKCWNzc05vcm1hbFRyYW5zZm9ybSA9IHsKCQlsZXR0ZXJTcGFjaW5nOiAiMCIsCgkJZm9udFdlaWdodDogIjQwMCIKCX0sCgoJY3NzUHJlZml4ZXMgPSBbICJXZWJraXQiLCAiTyIsICJNb3oiLCAibXMiIF0sCgllbXB0eVN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKS5zdHlsZTsKCgovLyByZXR1cm4gYSBjc3MgcHJvcGVydHkgbWFwcGVkIHRvIGEgcG90ZW50aWFsbHkgdmVuZG9yIHByZWZpeGVkIHByb3BlcnR5CmZ1bmN0aW9uIHZlbmRvclByb3BOYW1lKCBuYW1lICkgewoKCS8vIHNob3J0Y3V0IGZvciBuYW1lcyB0aGF0IGFyZSBub3QgdmVuZG9yIHByZWZpeGVkCglpZiAoIG5hbWUgaW4gZW1wdHlTdHlsZSApIHsKCQlyZXR1cm4gbmFtZTsKCX0KCgkvLyBjaGVjayBmb3IgdmVuZG9yIHByZWZpeGVkIG5hbWVzCgl2YXIgY2FwTmFtZSA9IG5hbWUuY2hhckF0KCAwICkudG9VcHBlckNhc2UoKSArIG5hbWUuc2xpY2UoIDEgKSwKCQlpID0gY3NzUHJlZml4ZXMubGVuZ3RoOwoKCXdoaWxlICggaS0tICkgewoJCW5hbWUgPSBjc3NQcmVmaXhlc1sgaSBdICsgY2FwTmFtZTsKCQlpZiAoIG5hbWUgaW4gZW1wdHlTdHlsZSApIHsKCQkJcmV0dXJuIG5hbWU7CgkJfQoJfQp9CgpmdW5jdGlvbiBzaG93SGlkZSggZWxlbWVudHMsIHNob3cgKSB7Cgl2YXIgZGlzcGxheSwgZWxlbSwgaGlkZGVuLAoJCXZhbHVlcyA9IFtdLAoJCWluZGV4ID0gMCwKCQlsZW5ndGggPSBlbGVtZW50cy5sZW5ndGg7CgoJZm9yICggOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKyApIHsKCQllbGVtID0gZWxlbWVudHNbIGluZGV4IF07CgkJaWYgKCAhZWxlbS5zdHlsZSApIHsKCQkJY29udGludWU7CgkJfQoKCQl2YWx1ZXNbIGluZGV4IF0gPSBqUXVlcnkuX2RhdGEoIGVsZW0sICJvbGRkaXNwbGF5IiApOwoJCWRpc3BsYXkgPSBlbGVtLnN0eWxlLmRpc3BsYXk7CgkJaWYgKCBzaG93ICkgewoKCQkJLy8gUmVzZXQgdGhlIGlubGluZSBkaXNwbGF5IG9mIHRoaXMgZWxlbWVudCB0byBsZWFybiBpZiBpdCBpcwoJCQkvLyBiZWluZyBoaWRkZW4gYnkgY2FzY2FkZWQgcnVsZXMgb3Igbm90CgkJCWlmICggIXZhbHVlc1sgaW5kZXggXSAmJiBkaXNwbGF5ID09PSAibm9uZSIgKSB7CgkJCQllbGVtLnN0eWxlLmRpc3BsYXkgPSAiIjsKCQkJfQoKCQkJLy8gU2V0IGVsZW1lbnRzIHdoaWNoIGhhdmUgYmVlbiBvdmVycmlkZGVuIHdpdGggZGlzcGxheTogbm9uZQoJCQkvLyBpbiBhIHN0eWxlc2hlZXQgdG8gd2hhdGV2ZXIgdGhlIGRlZmF1bHQgYnJvd3NlciBzdHlsZSBpcwoJCQkvLyBmb3Igc3VjaCBhbiBlbGVtZW50CgkJCWlmICggZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAiIiAmJiBpc0hpZGRlbiggZWxlbSApICkgewoJCQkJdmFsdWVzWyBpbmRleCBdID0KCQkJCQlqUXVlcnkuX2RhdGEoIGVsZW0sICJvbGRkaXNwbGF5IiwgZGVmYXVsdERpc3BsYXkoIGVsZW0ubm9kZU5hbWUgKSApOwoJCQl9CgkJfSBlbHNlIHsKCQkJaGlkZGVuID0gaXNIaWRkZW4oIGVsZW0gKTsKCgkJCWlmICggZGlzcGxheSAmJiBkaXNwbGF5ICE9PSAibm9uZSIgfHwgIWhpZGRlbiApIHsKCQkJCWpRdWVyeS5fZGF0YSgKCQkJCQllbGVtLAoJCQkJCSJvbGRkaXNwbGF5IiwKCQkJCQloaWRkZW4gPyBkaXNwbGF5IDogalF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkKCQkJCSk7CgkJCX0KCQl9Cgl9CgoJLy8gU2V0IHRoZSBkaXNwbGF5IG9mIG1vc3Qgb2YgdGhlIGVsZW1lbnRzIGluIGEgc2Vjb25kIGxvb3AKCS8vIHRvIGF2b2lkIHRoZSBjb25zdGFudCByZWZsb3cKCWZvciAoIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJZWxlbSA9IGVsZW1lbnRzWyBpbmRleCBdOwoJCWlmICggIWVsZW0uc3R5bGUgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCQlpZiAoICFzaG93IHx8IGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIm5vbmUiIHx8IGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIiIgKSB7CgkJCWVsZW0uc3R5bGUuZGlzcGxheSA9IHNob3cgPyB2YWx1ZXNbIGluZGV4IF0gfHwgIiIgOiAibm9uZSI7CgkJfQoJfQoKCXJldHVybiBlbGVtZW50czsKfQoKZnVuY3Rpb24gc2V0UG9zaXRpdmVOdW1iZXIoIGVsZW0sIHZhbHVlLCBzdWJ0cmFjdCApIHsKCXZhciBtYXRjaGVzID0gcm51bXNwbGl0LmV4ZWMoIHZhbHVlICk7CglyZXR1cm4gbWF0Y2hlcyA/CgoJCS8vIEd1YXJkIGFnYWluc3QgdW5kZWZpbmVkICJzdWJ0cmFjdCIsIGUuZy4sIHdoZW4gdXNlZCBhcyBpbiBjc3NIb29rcwoJCU1hdGgubWF4KCAwLCBtYXRjaGVzWyAxIF0gLSAoIHN1YnRyYWN0IHx8IDAgKSApICsgKCBtYXRjaGVzWyAyIF0gfHwgInB4IiApIDoKCQl2YWx1ZTsKfQoKZnVuY3Rpb24gYXVnbWVudFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhLCBpc0JvcmRlckJveCwgc3R5bGVzICkgewoJdmFyIGkgPSBleHRyYSA9PT0gKCBpc0JvcmRlckJveCA/ICJib3JkZXIiIDogImNvbnRlbnQiICkgPwoKCQkvLyBJZiB3ZSBhbHJlYWR5IGhhdmUgdGhlIHJpZ2h0IG1lYXN1cmVtZW50LCBhdm9pZCBhdWdtZW50YXRpb24KCQk0IDoKCgkJLy8gT3RoZXJ3aXNlIGluaXRpYWxpemUgZm9yIGhvcml6b250YWwgb3IgdmVydGljYWwgcHJvcGVydGllcwoJCW5hbWUgPT09ICJ3aWR0aCIgPyAxIDogMCwKCgkJdmFsID0gMDsKCglmb3IgKCA7IGkgPCA0OyBpICs9IDIgKSB7CgoJCS8vIGJvdGggYm94IG1vZGVscyBleGNsdWRlIG1hcmdpbiwgc28gYWRkIGl0IGlmIHdlIHdhbnQgaXQKCQlpZiAoIGV4dHJhID09PSAibWFyZ2luIiApIHsKCQkJdmFsICs9IGpRdWVyeS5jc3MoIGVsZW0sIGV4dHJhICsgY3NzRXhwYW5kWyBpIF0sIHRydWUsIHN0eWxlcyApOwoJCX0KCgkJaWYgKCBpc0JvcmRlckJveCApIHsKCgkJCS8vIGJvcmRlci1ib3ggaW5jbHVkZXMgcGFkZGluZywgc28gcmVtb3ZlIGl0IGlmIHdlIHdhbnQgY29udGVudAoJCQlpZiAoIGV4dHJhID09PSAiY29udGVudCIgKSB7CgkJCQl2YWwgLT0galF1ZXJ5LmNzcyggZWxlbSwgInBhZGRpbmciICsgY3NzRXhwYW5kWyBpIF0sIHRydWUsIHN0eWxlcyApOwoJCQl9CgoJCQkvLyBhdCB0aGlzIHBvaW50LCBleHRyYSBpc24ndCBib3JkZXIgbm9yIG1hcmdpbiwgc28gcmVtb3ZlIGJvcmRlcgoJCQlpZiAoIGV4dHJhICE9PSAibWFyZ2luIiApIHsKCQkJCXZhbCAtPSBqUXVlcnkuY3NzKCBlbGVtLCAiYm9yZGVyIiArIGNzc0V4cGFuZFsgaSBdICsgIldpZHRoIiwgdHJ1ZSwgc3R5bGVzICk7CgkJCX0KCQl9IGVsc2UgewoKCQkJLy8gYXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgY29udGVudCwgc28gYWRkIHBhZGRpbmcKCQkJdmFsICs9IGpRdWVyeS5jc3MoIGVsZW0sICJwYWRkaW5nIiArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsKCgkJCS8vIGF0IHRoaXMgcG9pbnQsIGV4dHJhIGlzbid0IGNvbnRlbnQgbm9yIHBhZGRpbmcsIHNvIGFkZCBib3JkZXIKCQkJaWYgKCBleHRyYSAhPT0gInBhZGRpbmciICkgewoJCQkJdmFsICs9IGpRdWVyeS5jc3MoIGVsZW0sICJib3JkZXIiICsgY3NzRXhwYW5kWyBpIF0gKyAiV2lkdGgiLCB0cnVlLCBzdHlsZXMgKTsKCQkJfQoJCX0KCX0KCglyZXR1cm4gdmFsOwp9CgpmdW5jdGlvbiBnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApIHsKCgkvLyBTdGFydCB3aXRoIG9mZnNldCBwcm9wZXJ0eSwgd2hpY2ggaXMgZXF1aXZhbGVudCB0byB0aGUgYm9yZGVyLWJveCB2YWx1ZQoJdmFyIHZhbHVlSXNCb3JkZXJCb3ggPSB0cnVlLAoJCXZhbCA9IG5hbWUgPT09ICJ3aWR0aCIgPyBlbGVtLm9mZnNldFdpZHRoIDogZWxlbS5vZmZzZXRIZWlnaHQsCgkJc3R5bGVzID0gZ2V0U3R5bGVzKCBlbGVtICksCgkJaXNCb3JkZXJCb3ggPSBzdXBwb3J0LmJveFNpemluZyAmJgoJCQlqUXVlcnkuY3NzKCBlbGVtLCAiYm94U2l6aW5nIiwgZmFsc2UsIHN0eWxlcyApID09PSAiYm9yZGVyLWJveCI7CgoJLy8gc29tZSBub24taHRtbCBlbGVtZW50cyByZXR1cm4gdW5kZWZpbmVkIGZvciBvZmZzZXRXaWR0aCwgc28gY2hlY2sgZm9yIG51bGwvdW5kZWZpbmVkCgkvLyBzdmcgLSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02NDkyODUKCS8vIE1hdGhNTCAtIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTQ5MTY2OAoJaWYgKCB2YWwgPD0gMCB8fCB2YWwgPT0gbnVsbCApIHsKCgkJLy8gRmFsbCBiYWNrIHRvIGNvbXB1dGVkIHRoZW4gdW5jb21wdXRlZCBjc3MgaWYgbmVjZXNzYXJ5CgkJdmFsID0gY3VyQ1NTKCBlbGVtLCBuYW1lLCBzdHlsZXMgKTsKCQlpZiAoIHZhbCA8IDAgfHwgdmFsID09IG51bGwgKSB7CgkJCXZhbCA9IGVsZW0uc3R5bGVbIG5hbWUgXTsKCQl9CgoJCS8vIENvbXB1dGVkIHVuaXQgaXMgbm90IHBpeGVscy4gU3RvcCBoZXJlIGFuZCByZXR1cm4uCgkJaWYgKCBybnVtbm9ucHgudGVzdCggdmFsICkgKSB7CgkJCXJldHVybiB2YWw7CgkJfQoKCQkvLyB3ZSBuZWVkIHRoZSBjaGVjayBmb3Igc3R5bGUgaW4gY2FzZSBhIGJyb3dzZXIgd2hpY2ggcmV0dXJucyB1bnJlbGlhYmxlIHZhbHVlcwoJCS8vIGZvciBnZXRDb21wdXRlZFN0eWxlIHNpbGVudGx5IGZhbGxzIGJhY2sgdG8gdGhlIHJlbGlhYmxlIGVsZW0uc3R5bGUKCQl2YWx1ZUlzQm9yZGVyQm94ID0gaXNCb3JkZXJCb3ggJiYKCQkJKCBzdXBwb3J0LmJveFNpemluZ1JlbGlhYmxlKCkgfHwgdmFsID09PSBlbGVtLnN0eWxlWyBuYW1lIF0gKTsKCgkJLy8gTm9ybWFsaXplICIiLCBhdXRvLCBhbmQgcHJlcGFyZSBmb3IgZXh0cmEKCQl2YWwgPSBwYXJzZUZsb2F0KCB2YWwgKSB8fCAwOwoJfQoKCS8vIHVzZSB0aGUgYWN0aXZlIGJveC1zaXppbmcgbW9kZWwgdG8gYWRkL3N1YnRyYWN0IGlycmVsZXZhbnQgc3R5bGVzCglyZXR1cm4gKCB2YWwgKwoJCWF1Z21lbnRXaWR0aE9ySGVpZ2h0KAoJCQllbGVtLAoJCQluYW1lLAoJCQlleHRyYSB8fCAoIGlzQm9yZGVyQm94ID8gImJvcmRlciIgOiAiY29udGVudCIgKSwKCQkJdmFsdWVJc0JvcmRlckJveCwKCQkJc3R5bGVzCgkJKQoJKSArICJweCI7Cn0KCmpRdWVyeS5leHRlbmQoIHsKCgkvLyBBZGQgaW4gc3R5bGUgcHJvcGVydHkgaG9va3MgZm9yIG92ZXJyaWRpbmcgdGhlIGRlZmF1bHQKCS8vIGJlaGF2aW9yIG9mIGdldHRpbmcgYW5kIHNldHRpbmcgYSBzdHlsZSBwcm9wZXJ0eQoJY3NzSG9va3M6IHsKCQlvcGFjaXR5OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgewoJCQkJaWYgKCBjb21wdXRlZCApIHsKCgkJCQkJLy8gV2Ugc2hvdWxkIGFsd2F5cyBnZXQgYSBudW1iZXIgYmFjayBmcm9tIG9wYWNpdHkKCQkJCQl2YXIgcmV0ID0gY3VyQ1NTKCBlbGVtLCAib3BhY2l0eSIgKTsKCQkJCQlyZXR1cm4gcmV0ID09PSAiIiA/ICIxIiA6IHJldDsKCQkJCX0KCQkJfQoJCX0KCX0sCgoJLy8gRG9uJ3QgYXV0b21hdGljYWxseSBhZGQgInB4IiB0byB0aGVzZSBwb3NzaWJseS11bml0bGVzcyBwcm9wZXJ0aWVzCgljc3NOdW1iZXI6IHsKCQkiYW5pbWF0aW9uSXRlcmF0aW9uQ291bnQiOiB0cnVlLAoJCSJjb2x1bW5Db3VudCI6IHRydWUsCgkJImZpbGxPcGFjaXR5IjogdHJ1ZSwKCQkiZmxleEdyb3ciOiB0cnVlLAoJCSJmbGV4U2hyaW5rIjogdHJ1ZSwKCQkiZm9udFdlaWdodCI6IHRydWUsCgkJImxpbmVIZWlnaHQiOiB0cnVlLAoJCSJvcGFjaXR5IjogdHJ1ZSwKCQkib3JkZXIiOiB0cnVlLAoJCSJvcnBoYW5zIjogdHJ1ZSwKCQkid2lkb3dzIjogdHJ1ZSwKCQkiekluZGV4IjogdHJ1ZSwKCQkiem9vbSI6IHRydWUKCX0sCgoJLy8gQWRkIGluIHByb3BlcnRpZXMgd2hvc2UgbmFtZXMgeW91IHdpc2ggdG8gZml4IGJlZm9yZQoJLy8gc2V0dGluZyBvciBnZXR0aW5nIHRoZSB2YWx1ZQoJY3NzUHJvcHM6IHsKCgkJLy8gbm9ybWFsaXplIGZsb2F0IGNzcyBwcm9wZXJ0eQoJCSJmbG9hdCI6IHN1cHBvcnQuY3NzRmxvYXQgPyAiY3NzRmxvYXQiIDogInN0eWxlRmxvYXQiCgl9LAoKCS8vIEdldCBhbmQgc2V0IHRoZSBzdHlsZSBwcm9wZXJ0eSBvbiBhIERPTSBOb2RlCglzdHlsZTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlLCBleHRyYSApIHsKCgkJLy8gRG9uJ3Qgc2V0IHN0eWxlcyBvbiB0ZXh0IGFuZCBjb21tZW50IG5vZGVzCgkJaWYgKCAhZWxlbSB8fCBlbGVtLm5vZGVUeXBlID09PSAzIHx8IGVsZW0ubm9kZVR5cGUgPT09IDggfHwgIWVsZW0uc3R5bGUgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIE1ha2Ugc3VyZSB0aGF0IHdlJ3JlIHdvcmtpbmcgd2l0aCB0aGUgcmlnaHQgbmFtZQoJCXZhciByZXQsIHR5cGUsIGhvb2tzLAoJCQlvcmlnTmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKSwKCQkJc3R5bGUgPSBlbGVtLnN0eWxlOwoKCQluYW1lID0galF1ZXJ5LmNzc1Byb3BzWyBvcmlnTmFtZSBdIHx8CgkJCSggalF1ZXJ5LmNzc1Byb3BzWyBvcmlnTmFtZSBdID0gdmVuZG9yUHJvcE5hbWUoIG9yaWdOYW1lICkgfHwgb3JpZ05hbWUgKTsKCgkJLy8gZ2V0cyBob29rIGZvciB0aGUgcHJlZml4ZWQgdmVyc2lvbgoJCS8vIGZvbGxvd2VkIGJ5IHRoZSB1bnByZWZpeGVkIHZlcnNpb24KCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdIHx8IGpRdWVyeS5jc3NIb29rc1sgb3JpZ05hbWUgXTsKCgkJLy8gQ2hlY2sgaWYgd2UncmUgc2V0dGluZyBhIHZhbHVlCgkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQl0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQkJLy8gQ29udmVydCAiKz0iIG9yICItPSIgdG8gcmVsYXRpdmUgbnVtYmVycyAoIzczNDUpCgkJCWlmICggdHlwZSA9PT0gInN0cmluZyIgJiYgKCByZXQgPSByY3NzTnVtLmV4ZWMoIHZhbHVlICkgKSAmJiByZXRbIDEgXSApIHsKCQkJCXZhbHVlID0gYWRqdXN0Q1NTKCBlbGVtLCBuYW1lLCByZXQgKTsKCgkJCQkvLyBGaXhlcyBidWcgIzkyMzcKCQkJCXR5cGUgPSAibnVtYmVyIjsKCQkJfQoKCQkJLy8gTWFrZSBzdXJlIHRoYXQgbnVsbCBhbmQgTmFOIHZhbHVlcyBhcmVuJ3Qgc2V0LiBTZWU6ICM3MTE2CgkJCWlmICggdmFsdWUgPT0gbnVsbCB8fCB2YWx1ZSAhPT0gdmFsdWUgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIElmIGEgbnVtYmVyIHdhcyBwYXNzZWQgaW4sIGFkZCB0aGUgdW5pdCAoZXhjZXB0IGZvciBjZXJ0YWluIENTUyBwcm9wZXJ0aWVzKQoJCQlpZiAoIHR5cGUgPT09ICJudW1iZXIiICkgewoJCQkJdmFsdWUgKz0gcmV0ICYmIHJldFsgMyBdIHx8ICggalF1ZXJ5LmNzc051bWJlclsgb3JpZ05hbWUgXSA/ICIiIDogInB4IiApOwoJCQl9CgoJCQkvLyBGaXhlcyAjODkwOCwgaXQgY2FuIGJlIGRvbmUgbW9yZSBjb3JyZWN0bHkgYnkgc3BlY2lmaW5nIHNldHRlcnMgaW4gY3NzSG9va3MsCgkJCS8vIGJ1dCBpdCB3b3VsZCBtZWFuIHRvIGRlZmluZSBlaWdodAoJCQkvLyAoZm9yIGV2ZXJ5IHByb2JsZW1hdGljIHByb3BlcnR5KSBpZGVudGljYWwgZnVuY3Rpb25zCgkJCWlmICggIXN1cHBvcnQuY2xlYXJDbG9uZVN0eWxlICYmIHZhbHVlID09PSAiIiAmJiBuYW1lLmluZGV4T2YoICJiYWNrZ3JvdW5kIiApID09PSAwICkgewoJCQkJc3R5bGVbIG5hbWUgXSA9ICJpbmhlcml0IjsKCQkJfQoKCQkJLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCwgdXNlIHRoYXQgdmFsdWUsIG90aGVyd2lzZSBqdXN0IHNldCB0aGUgc3BlY2lmaWVkIHZhbHVlCgkJCWlmICggIWhvb2tzIHx8ICEoICJzZXQiIGluIGhvb2tzICkgfHwKCQkJCSggdmFsdWUgPSBob29rcy5zZXQoIGVsZW0sIHZhbHVlLCBleHRyYSApICkgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBTdXBwb3J0OiBJRQoJCQkJLy8gU3dhbGxvdyBlcnJvcnMgZnJvbSAnaW52YWxpZCcgQ1NTIHZhbHVlcyAoIzU1MDkpCgkJCQl0cnkgewoJCQkJCXN0eWxlWyBuYW1lIF0gPSB2YWx1ZTsKCQkJCX0gY2F0Y2ggKCBlICkge30KCQkJfQoKCQl9IGVsc2UgewoKCQkJLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCBnZXQgdGhlIG5vbi1jb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYKCQkJCSggcmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBmYWxzZSwgZXh0cmEgKSApICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcmV0dXJuIHJldDsKCQkJfQoKCQkJLy8gT3RoZXJ3aXNlIGp1c3QgZ2V0IHRoZSB2YWx1ZSBmcm9tIHRoZSBzdHlsZSBvYmplY3QKCQkJcmV0dXJuIHN0eWxlWyBuYW1lIF07CgkJfQoJfSwKCgljc3M6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBleHRyYSwgc3R5bGVzICkgewoJCXZhciBudW0sIHZhbCwgaG9va3MsCgkJCW9yaWdOYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApOwoKCQkvLyBNYWtlIHN1cmUgdGhhdCB3ZSdyZSB3b3JraW5nIHdpdGggdGhlIHJpZ2h0IG5hbWUKCQluYW1lID0galF1ZXJ5LmNzc1Byb3BzWyBvcmlnTmFtZSBdIHx8CgkJCSggalF1ZXJ5LmNzc1Byb3BzWyBvcmlnTmFtZSBdID0gdmVuZG9yUHJvcE5hbWUoIG9yaWdOYW1lICkgfHwgb3JpZ05hbWUgKTsKCgkJLy8gZ2V0cyBob29rIGZvciB0aGUgcHJlZml4ZWQgdmVyc2lvbgoJCS8vIGZvbGxvd2VkIGJ5IHRoZSB1bnByZWZpeGVkIHZlcnNpb24KCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdIHx8IGpRdWVyeS5jc3NIb29rc1sgb3JpZ05hbWUgXTsKCgkJLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCBnZXQgdGhlIGNvbXB1dGVkIHZhbHVlIGZyb20gdGhlcmUKCQlpZiAoIGhvb2tzICYmICJnZXQiIGluIGhvb2tzICkgewoJCQl2YWwgPSBob29rcy5nZXQoIGVsZW0sIHRydWUsIGV4dHJhICk7CgkJfQoKCQkvLyBPdGhlcndpc2UsIGlmIGEgd2F5IHRvIGdldCB0aGUgY29tcHV0ZWQgdmFsdWUgZXhpc3RzLCB1c2UgdGhhdAoJCWlmICggdmFsID09PSB1bmRlZmluZWQgKSB7CgkJCXZhbCA9IGN1ckNTUyggZWxlbSwgbmFtZSwgc3R5bGVzICk7CgkJfQoKCQkvL2NvbnZlcnQgIm5vcm1hbCIgdG8gY29tcHV0ZWQgdmFsdWUKCQlpZiAoIHZhbCA9PT0gIm5vcm1hbCIgJiYgbmFtZSBpbiBjc3NOb3JtYWxUcmFuc2Zvcm0gKSB7CgkJCXZhbCA9IGNzc05vcm1hbFRyYW5zZm9ybVsgbmFtZSBdOwoJCX0KCgkJLy8gUmV0dXJuLCBjb252ZXJ0aW5nIHRvIG51bWJlciBpZiBmb3JjZWQgb3IgYSBxdWFsaWZpZXIgd2FzIHByb3ZpZGVkIGFuZCB2YWwgbG9va3MgbnVtZXJpYwoJCWlmICggZXh0cmEgPT09ICIiIHx8IGV4dHJhICkgewoJCQludW0gPSBwYXJzZUZsb2F0KCB2YWwgKTsKCQkJcmV0dXJuIGV4dHJhID09PSB0cnVlIHx8IGlzRmluaXRlKCBudW0gKSA/IG51bSB8fCAwIDogdmFsOwoJCX0KCQlyZXR1cm4gdmFsOwoJfQp9ICk7CgpqUXVlcnkuZWFjaCggWyAiaGVpZ2h0IiwgIndpZHRoIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCWpRdWVyeS5jc3NIb29rc1sgbmFtZSBdID0gewoJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkLCBleHRyYSApIHsKCQkJaWYgKCBjb21wdXRlZCApIHsKCgkJCQkvLyBjZXJ0YWluIGVsZW1lbnRzIGNhbiBoYXZlIGRpbWVuc2lvbiBpbmZvIGlmIHdlIGludmlzaWJseSBzaG93IHRoZW0KCQkJCS8vIGhvd2V2ZXIsIGl0IG11c3QgaGF2ZSBhIGN1cnJlbnQgZGlzcGxheSBzdHlsZSB0aGF0IHdvdWxkIGJlbmVmaXQgZnJvbSB0aGlzCgkJCQlyZXR1cm4gcmRpc3BsYXlzd2FwLnRlc3QoIGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApICkgJiYKCQkJCQllbGVtLm9mZnNldFdpZHRoID09PSAwID8KCQkJCQkJc3dhcCggZWxlbSwgY3NzU2hvdywgZnVuY3Rpb24oKSB7CgkJCQkJCQlyZXR1cm4gZ2V0V2lkdGhPckhlaWdodCggZWxlbSwgbmFtZSwgZXh0cmEgKTsKCQkJCQkJfSApIDoKCQkJCQkJZ2V0V2lkdGhPckhlaWdodCggZWxlbSwgbmFtZSwgZXh0cmEgKTsKCQkJfQoJCX0sCgoJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlLCBleHRyYSApIHsKCQkJdmFyIHN0eWxlcyA9IGV4dHJhICYmIGdldFN0eWxlcyggZWxlbSApOwoJCQlyZXR1cm4gc2V0UG9zaXRpdmVOdW1iZXIoIGVsZW0sIHZhbHVlLCBleHRyYSA/CgkJCQlhdWdtZW50V2lkdGhPckhlaWdodCgKCQkJCQllbGVtLAoJCQkJCW5hbWUsCgkJCQkJZXh0cmEsCgkJCQkJc3VwcG9ydC5ib3hTaXppbmcgJiYKCQkJCQkJalF1ZXJ5LmNzcyggZWxlbSwgImJveFNpemluZyIsIGZhbHNlLCBzdHlsZXMgKSA9PT0gImJvcmRlci1ib3giLAoJCQkJCXN0eWxlcwoJCQkJKSA6IDAKCQkJKTsKCQl9Cgl9Owp9ICk7CgppZiAoICFzdXBwb3J0Lm9wYWNpdHkgKSB7CglqUXVlcnkuY3NzSG9va3Mub3BhY2l0eSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCgkJCS8vIElFIHVzZXMgZmlsdGVycyBmb3Igb3BhY2l0eQoJCQlyZXR1cm4gcm9wYWNpdHkudGVzdCggKCBjb21wdXRlZCAmJiBlbGVtLmN1cnJlbnRTdHlsZSA/CgkJCQllbGVtLmN1cnJlbnRTdHlsZS5maWx0ZXIgOgoJCQkJZWxlbS5zdHlsZS5maWx0ZXIgKSB8fCAiIiApID8KCQkJCQkoIDAuMDEgKiBwYXJzZUZsb2F0KCBSZWdFeHAuJDEgKSApICsgIiIgOgoJCQkJCWNvbXB1dGVkID8gIjEiIDogIiI7CgkJfSwKCgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCXZhciBzdHlsZSA9IGVsZW0uc3R5bGUsCgkJCQljdXJyZW50U3R5bGUgPSBlbGVtLmN1cnJlbnRTdHlsZSwKCQkJCW9wYWNpdHkgPSBqUXVlcnkuaXNOdW1lcmljKCB2YWx1ZSApID8gImFscGhhKG9wYWNpdHk9IiArIHZhbHVlICogMTAwICsgIikiIDogIiIsCgkJCQlmaWx0ZXIgPSBjdXJyZW50U3R5bGUgJiYgY3VycmVudFN0eWxlLmZpbHRlciB8fCBzdHlsZS5maWx0ZXIgfHwgIiI7CgoJCQkvLyBJRSBoYXMgdHJvdWJsZSB3aXRoIG9wYWNpdHkgaWYgaXQgZG9lcyBub3QgaGF2ZSBsYXlvdXQKCQkJLy8gRm9yY2UgaXQgYnkgc2V0dGluZyB0aGUgem9vbSBsZXZlbAoJCQlzdHlsZS56b29tID0gMTsKCgkJCS8vIGlmIHNldHRpbmcgb3BhY2l0eSB0byAxLCBhbmQgbm8gb3RoZXIgZmlsdGVycyBleGlzdCAtCgkJCS8vIGF0dGVtcHQgdG8gcmVtb3ZlIGZpbHRlciBhdHRyaWJ1dGUgIzY2NTIKCQkJLy8gaWYgdmFsdWUgPT09ICIiLCB0aGVuIHJlbW92ZSBpbmxpbmUgb3BhY2l0eSAjMTI2ODUKCQkJaWYgKCAoIHZhbHVlID49IDEgfHwgdmFsdWUgPT09ICIiICkgJiYKCQkJCQlqUXVlcnkudHJpbSggZmlsdGVyLnJlcGxhY2UoIHJhbHBoYSwgIiIgKSApID09PSAiIiAmJgoJCQkJCXN0eWxlLnJlbW92ZUF0dHJpYnV0ZSApIHsKCgkJCQkvLyBTZXR0aW5nIHN0eWxlLmZpbHRlciB0byBudWxsLCAiIiAmICIgIiBzdGlsbCBsZWF2ZSAiZmlsdGVyOiIgaW4gdGhlIGNzc1RleHQKCQkJCS8vIGlmICJmaWx0ZXI6IiBpcyBwcmVzZW50IGF0IGFsbCwgY2xlYXJUeXBlIGlzIGRpc2FibGVkLCB3ZSB3YW50IHRvIGF2b2lkIHRoaXMKCQkJCS8vIHN0eWxlLnJlbW92ZUF0dHJpYnV0ZSBpcyBJRSBPbmx5LCBidXQgc28gYXBwYXJlbnRseSBpcyB0aGlzIGNvZGUgcGF0aC4uLgoJCQkJc3R5bGUucmVtb3ZlQXR0cmlidXRlKCAiZmlsdGVyIiApOwoKCQkJCS8vIGlmIHRoZXJlIGlzIG5vIGZpbHRlciBzdHlsZSBhcHBsaWVkIGluIGEgY3NzIHJ1bGUKCQkJCS8vIG9yIHVuc2V0IGlubGluZSBvcGFjaXR5LCB3ZSBhcmUgZG9uZQoJCQkJaWYgKCB2YWx1ZSA9PT0gIiIgfHwgY3VycmVudFN0eWxlICYmICFjdXJyZW50U3R5bGUuZmlsdGVyICkgewoJCQkJCXJldHVybjsKCQkJCX0KCQkJfQoKCQkJLy8gb3RoZXJ3aXNlLCBzZXQgbmV3IGZpbHRlciB2YWx1ZXMKCQkJc3R5bGUuZmlsdGVyID0gcmFscGhhLnRlc3QoIGZpbHRlciApID8KCQkJCWZpbHRlci5yZXBsYWNlKCByYWxwaGEsIG9wYWNpdHkgKSA6CgkJCQlmaWx0ZXIgKyAiICIgKyBvcGFjaXR5OwoJCX0KCX07Cn0KCmpRdWVyeS5jc3NIb29rcy5tYXJnaW5SaWdodCA9IGFkZEdldEhvb2tJZiggc3VwcG9ydC5yZWxpYWJsZU1hcmdpblJpZ2h0LAoJZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgewoJCWlmICggY29tcHV0ZWQgKSB7CgkJCXJldHVybiBzd2FwKCBlbGVtLCB7ICJkaXNwbGF5IjogImlubGluZS1ibG9jayIgfSwKCQkJCWN1ckNTUywgWyBlbGVtLCAibWFyZ2luUmlnaHQiIF0gKTsKCQl9Cgl9Cik7CgpqUXVlcnkuY3NzSG9va3MubWFyZ2luTGVmdCA9IGFkZEdldEhvb2tJZiggc3VwcG9ydC5yZWxpYWJsZU1hcmdpbkxlZnQsCglmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7CgkJaWYgKCBjb21wdXRlZCApIHsKCQkJcmV0dXJuICgKCQkJCXBhcnNlRmxvYXQoIGN1ckNTUyggZWxlbSwgIm1hcmdpbkxlZnQiICkgKSB8fAoKCQkJCS8vIFN1cHBvcnQ6IElFPD0xMSsKCQkJCS8vIFJ1bm5pbmcgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IG9uIGEgZGlzY29ubmVjdGVkIG5vZGUgaW4gSUUgdGhyb3dzIGFuIGVycm9yCgkJCQkvLyBTdXBwb3J0OiBJRTggb25seQoJCQkJLy8gZ2V0Q2xpZW50UmVjdHMoKSBlcnJvcnMgb24gZGlzY29ubmVjdGVkIGVsZW1zCgkJCQkoIGpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICkgPwoJCQkJCWVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCAtCgkJCQkJCXN3YXAoIGVsZW0sIHsgbWFyZ2luTGVmdDogMCB9LCBmdW5jdGlvbigpIHsKCQkJCQkJCXJldHVybiBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7CgkJCQkJCX0gKSA6CgkJCQkJMAoJCQkJKQoJCQkpICsgInB4IjsKCQl9Cgl9Cik7CgovLyBUaGVzZSBob29rcyBhcmUgdXNlZCBieSBhbmltYXRlIHRvIGV4cGFuZCBwcm9wZXJ0aWVzCmpRdWVyeS5lYWNoKCB7CgltYXJnaW46ICIiLAoJcGFkZGluZzogIiIsCglib3JkZXI6ICJXaWR0aCIKfSwgZnVuY3Rpb24oIHByZWZpeCwgc3VmZml4ICkgewoJalF1ZXJ5LmNzc0hvb2tzWyBwcmVmaXggKyBzdWZmaXggXSA9IHsKCQlleHBhbmQ6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJdmFyIGkgPSAwLAoJCQkJZXhwYW5kZWQgPSB7fSwKCgkJCQkvLyBhc3N1bWVzIGEgc2luZ2xlIG51bWJlciBpZiBub3QgYSBzdHJpbmcKCQkJCXBhcnRzID0gdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiA/IHZhbHVlLnNwbGl0KCAiICIgKSA6IFsgdmFsdWUgXTsKCgkJCWZvciAoIDsgaSA8IDQ7IGkrKyApIHsKCQkJCWV4cGFuZGVkWyBwcmVmaXggKyBjc3NFeHBhbmRbIGkgXSArIHN1ZmZpeCBdID0KCQkJCQlwYXJ0c1sgaSBdIHx8IHBhcnRzWyBpIC0gMiBdIHx8IHBhcnRzWyAwIF07CgkJCX0KCgkJCXJldHVybiBleHBhbmRlZDsKCQl9Cgl9OwoKCWlmICggIXJtYXJnaW4udGVzdCggcHJlZml4ICkgKSB7CgkJalF1ZXJ5LmNzc0hvb2tzWyBwcmVmaXggKyBzdWZmaXggXS5zZXQgPSBzZXRQb3NpdGl2ZU51bWJlcjsKCX0KfSApOwoKalF1ZXJ5LmZuLmV4dGVuZCggewoJY3NzOiBmdW5jdGlvbiggbmFtZSwgdmFsdWUgKSB7CgkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCQl2YXIgc3R5bGVzLCBsZW4sCgkJCQltYXAgPSB7fSwKCQkJCWkgPSAwOwoKCQkJaWYgKCBqUXVlcnkuaXNBcnJheSggbmFtZSApICkgewoJCQkJc3R5bGVzID0gZ2V0U3R5bGVzKCBlbGVtICk7CgkJCQlsZW4gPSBuYW1lLmxlbmd0aDsKCgkJCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJCQltYXBbIG5hbWVbIGkgXSBdID0galF1ZXJ5LmNzcyggZWxlbSwgbmFtZVsgaSBdLCBmYWxzZSwgc3R5bGVzICk7CgkJCQl9CgoJCQkJcmV0dXJuIG1hcDsKCQkJfQoKCQkJcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgPwoJCQkJalF1ZXJ5LnN0eWxlKCBlbGVtLCBuYW1lLCB2YWx1ZSApIDoKCQkJCWpRdWVyeS5jc3MoIGVsZW0sIG5hbWUgKTsKCQl9LCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsKCX0sCglzaG93OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gc2hvd0hpZGUoIHRoaXMsIHRydWUgKTsKCX0sCgloaWRlOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gc2hvd0hpZGUoIHRoaXMgKTsKCX0sCgl0b2dnbGU6IGZ1bmN0aW9uKCBzdGF0ZSApIHsKCQlpZiAoIHR5cGVvZiBzdGF0ZSA9PT0gImJvb2xlYW4iICkgewoJCQlyZXR1cm4gc3RhdGUgPyB0aGlzLnNob3coKSA6IHRoaXMuaGlkZSgpOwoJCX0KCgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCWlmICggaXNIaWRkZW4oIHRoaXMgKSApIHsKCQkJCWpRdWVyeSggdGhpcyApLnNob3coKTsKCQkJfSBlbHNlIHsKCQkJCWpRdWVyeSggdGhpcyApLmhpZGUoKTsKCQkJfQoJCX0gKTsKCX0KfSApOwoKCmZ1bmN0aW9uIFR3ZWVuKCBlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZyApIHsKCXJldHVybiBuZXcgVHdlZW4ucHJvdG90eXBlLmluaXQoIGVsZW0sIG9wdGlvbnMsIHByb3AsIGVuZCwgZWFzaW5nICk7Cn0KalF1ZXJ5LlR3ZWVuID0gVHdlZW47CgpUd2Vlbi5wcm90b3R5cGUgPSB7Cgljb25zdHJ1Y3RvcjogVHdlZW4sCglpbml0OiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgcHJvcCwgZW5kLCBlYXNpbmcsIHVuaXQgKSB7CgkJdGhpcy5lbGVtID0gZWxlbTsKCQl0aGlzLnByb3AgPSBwcm9wOwoJCXRoaXMuZWFzaW5nID0gZWFzaW5nIHx8IGpRdWVyeS5lYXNpbmcuX2RlZmF1bHQ7CgkJdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCQl0aGlzLnN0YXJ0ID0gdGhpcy5ub3cgPSB0aGlzLmN1cigpOwoJCXRoaXMuZW5kID0gZW5kOwoJCXRoaXMudW5pdCA9IHVuaXQgfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gPyAiIiA6ICJweCIgKTsKCX0sCgljdXI6IGZ1bmN0aW9uKCkgewoJCXZhciBob29rcyA9IFR3ZWVuLnByb3BIb29rc1sgdGhpcy5wcm9wIF07CgoJCXJldHVybiBob29rcyAmJiBob29rcy5nZXQgPwoJCQlob29rcy5nZXQoIHRoaXMgKSA6CgkJCVR3ZWVuLnByb3BIb29rcy5fZGVmYXVsdC5nZXQoIHRoaXMgKTsKCX0sCglydW46IGZ1bmN0aW9uKCBwZXJjZW50ICkgewoJCXZhciBlYXNlZCwKCQkJaG9va3MgPSBUd2Vlbi5wcm9wSG9va3NbIHRoaXMucHJvcCBdOwoKCQlpZiAoIHRoaXMub3B0aW9ucy5kdXJhdGlvbiApIHsKCQkJdGhpcy5wb3MgPSBlYXNlZCA9IGpRdWVyeS5lYXNpbmdbIHRoaXMuZWFzaW5nIF0oCgkJCQlwZXJjZW50LCB0aGlzLm9wdGlvbnMuZHVyYXRpb24gKiBwZXJjZW50LCAwLCAxLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24KCQkJKTsKCQl9IGVsc2UgewoJCQl0aGlzLnBvcyA9IGVhc2VkID0gcGVyY2VudDsKCQl9CgkJdGhpcy5ub3cgPSAoIHRoaXMuZW5kIC0gdGhpcy5zdGFydCApICogZWFzZWQgKyB0aGlzLnN0YXJ0OwoKCQlpZiAoIHRoaXMub3B0aW9ucy5zdGVwICkgewoJCQl0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKCB0aGlzLmVsZW0sIHRoaXMubm93LCB0aGlzICk7CgkJfQoKCQlpZiAoIGhvb2tzICYmIGhvb2tzLnNldCApIHsKCQkJaG9va3Muc2V0KCB0aGlzICk7CgkJfSBlbHNlIHsKCQkJVHdlZW4ucHJvcEhvb2tzLl9kZWZhdWx0LnNldCggdGhpcyApOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0KfTsKClR3ZWVuLnByb3RvdHlwZS5pbml0LnByb3RvdHlwZSA9IFR3ZWVuLnByb3RvdHlwZTsKClR3ZWVuLnByb3BIb29rcyA9IHsKCV9kZWZhdWx0OiB7CgkJZ2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgkJCXZhciByZXN1bHQ7CgoJCQkvLyBVc2UgYSBwcm9wZXJ0eSBvbiB0aGUgZWxlbWVudCBkaXJlY3RseSB3aGVuIGl0IGlzIG5vdCBhIERPTSBlbGVtZW50LAoJCQkvLyBvciB3aGVuIHRoZXJlIGlzIG5vIG1hdGNoaW5nIHN0eWxlIHByb3BlcnR5IHRoYXQgZXhpc3RzLgoJCQlpZiAoIHR3ZWVuLmVsZW0ubm9kZVR5cGUgIT09IDEgfHwKCQkJCXR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSAhPSBudWxsICYmIHR3ZWVuLmVsZW0uc3R5bGVbIHR3ZWVuLnByb3AgXSA9PSBudWxsICkgewoJCQkJcmV0dXJuIHR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXTsKCQkJfQoKCQkJLy8gcGFzc2luZyBhbiBlbXB0eSBzdHJpbmcgYXMgYSAzcmQgcGFyYW1ldGVyIHRvIC5jc3Mgd2lsbCBhdXRvbWF0aWNhbGx5CgkJCS8vIGF0dGVtcHQgYSBwYXJzZUZsb2F0IGFuZCBmYWxsYmFjayB0byBhIHN0cmluZyBpZiB0aGUgcGFyc2UgZmFpbHMKCQkJLy8gc28sIHNpbXBsZSB2YWx1ZXMgc3VjaCBhcyAiMTBweCIgYXJlIHBhcnNlZCB0byBGbG9hdC4KCQkJLy8gY29tcGxleCB2YWx1ZXMgc3VjaCBhcyAicm90YXRlKDFyYWQpIiBhcmUgcmV0dXJuZWQgYXMgaXMuCgkJCXJlc3VsdCA9IGpRdWVyeS5jc3MoIHR3ZWVuLmVsZW0sIHR3ZWVuLnByb3AsICIiICk7CgoJCQkvLyBFbXB0eSBzdHJpbmdzLCBudWxsLCB1bmRlZmluZWQgYW5kICJhdXRvIiBhcmUgY29udmVydGVkIHRvIDAuCgkJCXJldHVybiAhcmVzdWx0IHx8IHJlc3VsdCA9PT0gImF1dG8iID8gMCA6IHJlc3VsdDsKCQl9LAoJCXNldDogZnVuY3Rpb24oIHR3ZWVuICkgewoKCQkJLy8gdXNlIHN0ZXAgaG9vayBmb3IgYmFjayBjb21wYXQgLSB1c2UgY3NzSG9vayBpZiBpdHMgdGhlcmUgLSB1c2UgLnN0eWxlIGlmIGl0cwoJCQkvLyBhdmFpbGFibGUgYW5kIHVzZSBwbGFpbiBwcm9wZXJ0aWVzIHdoZXJlIGF2YWlsYWJsZQoJCQlpZiAoIGpRdWVyeS5meC5zdGVwWyB0d2Vlbi5wcm9wIF0gKSB7CgkJCQlqUXVlcnkuZnguc3RlcFsgdHdlZW4ucHJvcCBdKCB0d2VlbiApOwoJCQl9IGVsc2UgaWYgKCB0d2Vlbi5lbGVtLm5vZGVUeXBlID09PSAxICYmCgkJCQkoIHR3ZWVuLmVsZW0uc3R5bGVbIGpRdWVyeS5jc3NQcm9wc1sgdHdlZW4ucHJvcCBdIF0gIT0gbnVsbCB8fAoJCQkJCWpRdWVyeS5jc3NIb29rc1sgdHdlZW4ucHJvcCBdICkgKSB7CgkJCQlqUXVlcnkuc3R5bGUoIHR3ZWVuLmVsZW0sIHR3ZWVuLnByb3AsIHR3ZWVuLm5vdyArIHR3ZWVuLnVuaXQgKTsKCQkJfSBlbHNlIHsKCQkJCXR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSA9IHR3ZWVuLm5vdzsKCQkJfQoJCX0KCX0KfTsKCi8vIFN1cHBvcnQ6IElFIDw9OQovLyBQYW5pYyBiYXNlZCBhcHByb2FjaCB0byBzZXR0aW5nIHRoaW5ncyBvbiBkaXNjb25uZWN0ZWQgbm9kZXMKClR3ZWVuLnByb3BIb29rcy5zY3JvbGxUb3AgPSBUd2Vlbi5wcm9wSG9va3Muc2Nyb2xsTGVmdCA9IHsKCXNldDogZnVuY3Rpb24oIHR3ZWVuICkgewoJCWlmICggdHdlZW4uZWxlbS5ub2RlVHlwZSAmJiB0d2Vlbi5lbGVtLnBhcmVudE5vZGUgKSB7CgkJCXR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSA9IHR3ZWVuLm5vdzsKCQl9Cgl9Cn07CgpqUXVlcnkuZWFzaW5nID0gewoJbGluZWFyOiBmdW5jdGlvbiggcCApIHsKCQlyZXR1cm4gcDsKCX0sCglzd2luZzogZnVuY3Rpb24oIHAgKSB7CgkJcmV0dXJuIDAuNSAtIE1hdGguY29zKCBwICogTWF0aC5QSSApIC8gMjsKCX0sCglfZGVmYXVsdDogInN3aW5nIgp9OwoKalF1ZXJ5LmZ4ID0gVHdlZW4ucHJvdG90eXBlLmluaXQ7CgovLyBCYWNrIENvbXBhdCA8MS44IGV4dGVuc2lvbiBwb2ludApqUXVlcnkuZnguc3RlcCA9IHt9OwoKCgoKdmFyCglmeE5vdywgdGltZXJJZCwKCXJmeHR5cGVzID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLAoJcnJ1biA9IC9xdWV1ZUhvb2tzJC87CgovLyBBbmltYXRpb25zIGNyZWF0ZWQgc3luY2hyb25vdXNseSB3aWxsIHJ1biBzeW5jaHJvbm91c2x5CmZ1bmN0aW9uIGNyZWF0ZUZ4Tm93KCkgewoJd2luZG93LnNldFRpbWVvdXQoIGZ1bmN0aW9uKCkgewoJCWZ4Tm93ID0gdW5kZWZpbmVkOwoJfSApOwoJcmV0dXJuICggZnhOb3cgPSBqUXVlcnkubm93KCkgKTsKfQoKLy8gR2VuZXJhdGUgcGFyYW1ldGVycyB0byBjcmVhdGUgYSBzdGFuZGFyZCBhbmltYXRpb24KZnVuY3Rpb24gZ2VuRngoIHR5cGUsIGluY2x1ZGVXaWR0aCApIHsKCXZhciB3aGljaCwKCQlhdHRycyA9IHsgaGVpZ2h0OiB0eXBlIH0sCgkJaSA9IDA7CgoJLy8gaWYgd2UgaW5jbHVkZSB3aWR0aCwgc3RlcCB2YWx1ZSBpcyAxIHRvIGRvIGFsbCBjc3NFeHBhbmQgdmFsdWVzLAoJLy8gaWYgd2UgZG9uJ3QgaW5jbHVkZSB3aWR0aCwgc3RlcCB2YWx1ZSBpcyAyIHRvIHNraXAgb3ZlciBMZWZ0IGFuZCBSaWdodAoJaW5jbHVkZVdpZHRoID0gaW5jbHVkZVdpZHRoID8gMSA6IDA7Cglmb3IgKCA7IGkgPCA0IDsgaSArPSAyIC0gaW5jbHVkZVdpZHRoICkgewoJCXdoaWNoID0gY3NzRXhwYW5kWyBpIF07CgkJYXR0cnNbICJtYXJnaW4iICsgd2hpY2ggXSA9IGF0dHJzWyAicGFkZGluZyIgKyB3aGljaCBdID0gdHlwZTsKCX0KCglpZiAoIGluY2x1ZGVXaWR0aCApIHsKCQlhdHRycy5vcGFjaXR5ID0gYXR0cnMud2lkdGggPSB0eXBlOwoJfQoKCXJldHVybiBhdHRyczsKfQoKZnVuY3Rpb24gY3JlYXRlVHdlZW4oIHZhbHVlLCBwcm9wLCBhbmltYXRpb24gKSB7Cgl2YXIgdHdlZW4sCgkJY29sbGVjdGlvbiA9ICggQW5pbWF0aW9uLnR3ZWVuZXJzWyBwcm9wIF0gfHwgW10gKS5jb25jYXQoIEFuaW1hdGlvbi50d2VlbmVyc1sgIioiIF0gKSwKCQlpbmRleCA9IDAsCgkJbGVuZ3RoID0gY29sbGVjdGlvbi5sZW5ndGg7Cglmb3IgKCA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCWlmICggKCB0d2VlbiA9IGNvbGxlY3Rpb25bIGluZGV4IF0uY2FsbCggYW5pbWF0aW9uLCBwcm9wLCB2YWx1ZSApICkgKSB7CgoJCQkvLyB3ZSdyZSBkb25lIHdpdGggdGhpcyBwcm9wZXJ0eQoJCQlyZXR1cm4gdHdlZW47CgkJfQoJfQp9CgpmdW5jdGlvbiBkZWZhdWx0UHJlZmlsdGVyKCBlbGVtLCBwcm9wcywgb3B0cyApIHsKCS8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi8KCXZhciBwcm9wLCB2YWx1ZSwgdG9nZ2xlLCB0d2VlbiwgaG9va3MsIG9sZGZpcmUsIGRpc3BsYXksIGNoZWNrRGlzcGxheSwKCQlhbmltID0gdGhpcywKCQlvcmlnID0ge30sCgkJc3R5bGUgPSBlbGVtLnN0eWxlLAoJCWhpZGRlbiA9IGVsZW0ubm9kZVR5cGUgJiYgaXNIaWRkZW4oIGVsZW0gKSwKCQlkYXRhU2hvdyA9IGpRdWVyeS5fZGF0YSggZWxlbSwgImZ4c2hvdyIgKTsKCgkvLyBoYW5kbGUgcXVldWU6IGZhbHNlIHByb21pc2VzCglpZiAoICFvcHRzLnF1ZXVlICkgewoJCWhvb2tzID0galF1ZXJ5Ll9xdWV1ZUhvb2tzKCBlbGVtLCAiZngiICk7CgkJaWYgKCBob29rcy51bnF1ZXVlZCA9PSBudWxsICkgewoJCQlob29rcy51bnF1ZXVlZCA9IDA7CgkJCW9sZGZpcmUgPSBob29rcy5lbXB0eS5maXJlOwoJCQlob29rcy5lbXB0eS5maXJlID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAoICFob29rcy51bnF1ZXVlZCApIHsKCQkJCQlvbGRmaXJlKCk7CgkJCQl9CgkJCX07CgkJfQoJCWhvb2tzLnVucXVldWVkKys7CgoJCWFuaW0uYWx3YXlzKCBmdW5jdGlvbigpIHsKCgkJCS8vIGRvaW5nIHRoaXMgbWFrZXMgc3VyZSB0aGF0IHRoZSBjb21wbGV0ZSBoYW5kbGVyIHdpbGwgYmUgY2FsbGVkCgkJCS8vIGJlZm9yZSB0aGlzIGNvbXBsZXRlcwoJCQlhbmltLmFsd2F5cyggZnVuY3Rpb24oKSB7CgkJCQlob29rcy51bnF1ZXVlZC0tOwoJCQkJaWYgKCAhalF1ZXJ5LnF1ZXVlKCBlbGVtLCAiZngiICkubGVuZ3RoICkgewoJCQkJCWhvb2tzLmVtcHR5LmZpcmUoKTsKCQkJCX0KCQkJfSApOwoJCX0gKTsKCX0KCgkvLyBoZWlnaHQvd2lkdGggb3ZlcmZsb3cgcGFzcwoJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICggImhlaWdodCIgaW4gcHJvcHMgfHwgIndpZHRoIiBpbiBwcm9wcyApICkgewoKCQkvLyBNYWtlIHN1cmUgdGhhdCBub3RoaW5nIHNuZWFrcyBvdXQKCQkvLyBSZWNvcmQgYWxsIDMgb3ZlcmZsb3cgYXR0cmlidXRlcyBiZWNhdXNlIElFIGRvZXMgbm90CgkJLy8gY2hhbmdlIHRoZSBvdmVyZmxvdyBhdHRyaWJ1dGUgd2hlbiBvdmVyZmxvd1ggYW5kCgkJLy8gb3ZlcmZsb3dZIGFyZSBzZXQgdG8gdGhlIHNhbWUgdmFsdWUKCQlvcHRzLm92ZXJmbG93ID0gWyBzdHlsZS5vdmVyZmxvdywgc3R5bGUub3ZlcmZsb3dYLCBzdHlsZS5vdmVyZmxvd1kgXTsKCgkJLy8gU2V0IGRpc3BsYXkgcHJvcGVydHkgdG8gaW5saW5lLWJsb2NrIGZvciBoZWlnaHQvd2lkdGgKCQkvLyBhbmltYXRpb25zIG9uIGlubGluZSBlbGVtZW50cyB0aGF0IGFyZSBoYXZpbmcgd2lkdGgvaGVpZ2h0IGFuaW1hdGVkCgkJZGlzcGxheSA9IGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApOwoKCQkvLyBUZXN0IGRlZmF1bHQgZGlzcGxheSBpZiBkaXNwbGF5IGlzIGN1cnJlbnRseSAibm9uZSIKCQljaGVja0Rpc3BsYXkgPSBkaXNwbGF5ID09PSAibm9uZSIgPwoJCQlqUXVlcnkuX2RhdGEoIGVsZW0sICJvbGRkaXNwbGF5IiApIHx8IGRlZmF1bHREaXNwbGF5KCBlbGVtLm5vZGVOYW1lICkgOiBkaXNwbGF5OwoKCQlpZiAoIGNoZWNrRGlzcGxheSA9PT0gImlubGluZSIgJiYgalF1ZXJ5LmNzcyggZWxlbSwgImZsb2F0IiApID09PSAibm9uZSIgKSB7CgoJCQkvLyBpbmxpbmUtbGV2ZWwgZWxlbWVudHMgYWNjZXB0IGlubGluZS1ibG9jazsKCQkJLy8gYmxvY2stbGV2ZWwgZWxlbWVudHMgbmVlZCB0byBiZSBpbmxpbmUgd2l0aCBsYXlvdXQKCQkJaWYgKCAhc3VwcG9ydC5pbmxpbmVCbG9ja05lZWRzTGF5b3V0IHx8IGRlZmF1bHREaXNwbGF5KCBlbGVtLm5vZGVOYW1lICkgPT09ICJpbmxpbmUiICkgewoJCQkJc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwoJCQl9IGVsc2UgewoJCQkJc3R5bGUuem9vbSA9IDE7CgkJCX0KCQl9Cgl9CgoJaWYgKCBvcHRzLm92ZXJmbG93ICkgewoJCXN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJaWYgKCAhc3VwcG9ydC5zaHJpbmtXcmFwQmxvY2tzKCkgKSB7CgkJCWFuaW0uYWx3YXlzKCBmdW5jdGlvbigpIHsKCQkJCXN0eWxlLm92ZXJmbG93ID0gb3B0cy5vdmVyZmxvd1sgMCBdOwoJCQkJc3R5bGUub3ZlcmZsb3dYID0gb3B0cy5vdmVyZmxvd1sgMSBdOwoJCQkJc3R5bGUub3ZlcmZsb3dZID0gb3B0cy5vdmVyZmxvd1sgMiBdOwoJCQl9ICk7CgkJfQoJfQoKCS8vIHNob3cvaGlkZSBwYXNzCglmb3IgKCBwcm9wIGluIHByb3BzICkgewoJCXZhbHVlID0gcHJvcHNbIHByb3AgXTsKCQlpZiAoIHJmeHR5cGVzLmV4ZWMoIHZhbHVlICkgKSB7CgkJCWRlbGV0ZSBwcm9wc1sgcHJvcCBdOwoJCQl0b2dnbGUgPSB0b2dnbGUgfHwgdmFsdWUgPT09ICJ0b2dnbGUiOwoJCQlpZiAoIHZhbHVlID09PSAoIGhpZGRlbiA/ICJoaWRlIiA6ICJzaG93IiApICkgewoKCQkJCS8vIElmIHRoZXJlIGlzIGRhdGFTaG93IGxlZnQgb3ZlciBmcm9tIGEgc3RvcHBlZCBoaWRlIG9yIHNob3cKCQkJCS8vIGFuZCB3ZSBhcmUgZ29pbmcgdG8gcHJvY2VlZCB3aXRoIHNob3csIHdlIHNob3VsZCBwcmV0ZW5kIHRvIGJlIGhpZGRlbgoJCQkJaWYgKCB2YWx1ZSA9PT0gInNob3ciICYmIGRhdGFTaG93ICYmIGRhdGFTaG93WyBwcm9wIF0gIT09IHVuZGVmaW5lZCApIHsKCQkJCQloaWRkZW4gPSB0cnVlOwoJCQkJfSBlbHNlIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCQkJfQoJCQlvcmlnWyBwcm9wIF0gPSBkYXRhU2hvdyAmJiBkYXRhU2hvd1sgcHJvcCBdIHx8IGpRdWVyeS5zdHlsZSggZWxlbSwgcHJvcCApOwoKCQkvLyBBbnkgbm9uLWZ4IHZhbHVlIHN0b3BzIHVzIGZyb20gcmVzdG9yaW5nIHRoZSBvcmlnaW5hbCBkaXNwbGF5IHZhbHVlCgkJfSBlbHNlIHsKCQkJZGlzcGxheSA9IHVuZGVmaW5lZDsKCQl9Cgl9CgoJaWYgKCAhalF1ZXJ5LmlzRW1wdHlPYmplY3QoIG9yaWcgKSApIHsKCQlpZiAoIGRhdGFTaG93ICkgewoJCQlpZiAoICJoaWRkZW4iIGluIGRhdGFTaG93ICkgewoJCQkJaGlkZGVuID0gZGF0YVNob3cuaGlkZGVuOwoJCQl9CgkJfSBlbHNlIHsKCQkJZGF0YVNob3cgPSBqUXVlcnkuX2RhdGEoIGVsZW0sICJmeHNob3ciLCB7fSApOwoJCX0KCgkJLy8gc3RvcmUgc3RhdGUgaWYgaXRzIHRvZ2dsZSAtIGVuYWJsZXMgLnN0b3AoKS50b2dnbGUoKSB0byAicmV2ZXJzZSIKCQlpZiAoIHRvZ2dsZSApIHsKCQkJZGF0YVNob3cuaGlkZGVuID0gIWhpZGRlbjsKCQl9CgkJaWYgKCBoaWRkZW4gKSB7CgkJCWpRdWVyeSggZWxlbSApLnNob3coKTsKCQl9IGVsc2UgewoJCQlhbmltLmRvbmUoIGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5KCBlbGVtICkuaGlkZSgpOwoJCQl9ICk7CgkJfQoJCWFuaW0uZG9uZSggZnVuY3Rpb24oKSB7CgkJCXZhciBwcm9wOwoJCQlqUXVlcnkuX3JlbW92ZURhdGEoIGVsZW0sICJmeHNob3ciICk7CgkJCWZvciAoIHByb3AgaW4gb3JpZyApIHsKCQkJCWpRdWVyeS5zdHlsZSggZWxlbSwgcHJvcCwgb3JpZ1sgcHJvcCBdICk7CgkJCX0KCQl9ICk7CgkJZm9yICggcHJvcCBpbiBvcmlnICkgewoJCQl0d2VlbiA9IGNyZWF0ZVR3ZWVuKCBoaWRkZW4gPyBkYXRhU2hvd1sgcHJvcCBdIDogMCwgcHJvcCwgYW5pbSApOwoKCQkJaWYgKCAhKCBwcm9wIGluIGRhdGFTaG93ICkgKSB7CgkJCQlkYXRhU2hvd1sgcHJvcCBdID0gdHdlZW4uc3RhcnQ7CgkJCQlpZiAoIGhpZGRlbiApIHsKCQkJCQl0d2Vlbi5lbmQgPSB0d2Vlbi5zdGFydDsKCQkJCQl0d2Vlbi5zdGFydCA9IHByb3AgPT09ICJ3aWR0aCIgfHwgcHJvcCA9PT0gImhlaWdodCIgPyAxIDogMDsKCQkJCX0KCQkJfQoJCX0KCgkvLyBJZiB0aGlzIGlzIGEgbm9vcCBsaWtlIC5oaWRlKCkuaGlkZSgpLCByZXN0b3JlIGFuIG92ZXJ3cml0dGVuIGRpc3BsYXkgdmFsdWUKCX0gZWxzZSBpZiAoICggZGlzcGxheSA9PT0gIm5vbmUiID8gZGVmYXVsdERpc3BsYXkoIGVsZW0ubm9kZU5hbWUgKSA6IGRpc3BsYXkgKSA9PT0gImlubGluZSIgKSB7CgkJc3R5bGUuZGlzcGxheSA9IGRpc3BsYXk7Cgl9Cn0KCmZ1bmN0aW9uIHByb3BGaWx0ZXIoIHByb3BzLCBzcGVjaWFsRWFzaW5nICkgewoJdmFyIGluZGV4LCBuYW1lLCBlYXNpbmcsIHZhbHVlLCBob29rczsKCgkvLyBjYW1lbENhc2UsIHNwZWNpYWxFYXNpbmcgYW5kIGV4cGFuZCBjc3NIb29rIHBhc3MKCWZvciAoIGluZGV4IGluIHByb3BzICkgewoJCW5hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBpbmRleCApOwoJCWVhc2luZyA9IHNwZWNpYWxFYXNpbmdbIG5hbWUgXTsKCQl2YWx1ZSA9IHByb3BzWyBpbmRleCBdOwoJCWlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbHVlICkgKSB7CgkJCWVhc2luZyA9IHZhbHVlWyAxIF07CgkJCXZhbHVlID0gcHJvcHNbIGluZGV4IF0gPSB2YWx1ZVsgMCBdOwoJCX0KCgkJaWYgKCBpbmRleCAhPT0gbmFtZSApIHsKCQkJcHJvcHNbIG5hbWUgXSA9IHZhbHVlOwoJCQlkZWxldGUgcHJvcHNbIGluZGV4IF07CgkJfQoKCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdOwoJCWlmICggaG9va3MgJiYgImV4cGFuZCIgaW4gaG9va3MgKSB7CgkJCXZhbHVlID0gaG9va3MuZXhwYW5kKCB2YWx1ZSApOwoJCQlkZWxldGUgcHJvcHNbIG5hbWUgXTsKCgkJCS8vIG5vdCBxdWl0ZSAkLmV4dGVuZCwgdGhpcyB3b250IG92ZXJ3cml0ZSBrZXlzIGFscmVhZHkgcHJlc2VudC4KCQkJLy8gYWxzbyAtIHJldXNpbmcgJ2luZGV4JyBmcm9tIGFib3ZlIGJlY2F1c2Ugd2UgaGF2ZSB0aGUgY29ycmVjdCAibmFtZSIKCQkJZm9yICggaW5kZXggaW4gdmFsdWUgKSB7CgkJCQlpZiAoICEoIGluZGV4IGluIHByb3BzICkgKSB7CgkJCQkJcHJvcHNbIGluZGV4IF0gPSB2YWx1ZVsgaW5kZXggXTsKCQkJCQlzcGVjaWFsRWFzaW5nWyBpbmRleCBdID0gZWFzaW5nOwoJCQkJfQoJCQl9CgkJfSBlbHNlIHsKCQkJc3BlY2lhbEVhc2luZ1sgbmFtZSBdID0gZWFzaW5nOwoJCX0KCX0KfQoKZnVuY3Rpb24gQW5pbWF0aW9uKCBlbGVtLCBwcm9wZXJ0aWVzLCBvcHRpb25zICkgewoJdmFyIHJlc3VsdCwKCQlzdG9wcGVkLAoJCWluZGV4ID0gMCwKCQlsZW5ndGggPSBBbmltYXRpb24ucHJlZmlsdGVycy5sZW5ndGgsCgkJZGVmZXJyZWQgPSBqUXVlcnkuRGVmZXJyZWQoKS5hbHdheXMoIGZ1bmN0aW9uKCkgewoKCQkJLy8gZG9uJ3QgbWF0Y2ggZWxlbSBpbiB0aGUgOmFuaW1hdGVkIHNlbGVjdG9yCgkJCWRlbGV0ZSB0aWNrLmVsZW07CgkJfSApLAoJCXRpY2sgPSBmdW5jdGlvbigpIHsKCQkJaWYgKCBzdG9wcGVkICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJCXZhciBjdXJyZW50VGltZSA9IGZ4Tm93IHx8IGNyZWF0ZUZ4Tm93KCksCgkJCQlyZW1haW5pbmcgPSBNYXRoLm1heCggMCwgYW5pbWF0aW9uLnN0YXJ0VGltZSArIGFuaW1hdGlvbi5kdXJhdGlvbiAtIGN1cnJlbnRUaW1lICksCgoJCQkJLy8gU3VwcG9ydDogQW5kcm9pZCAyLjMKCQkJCS8vIEFyY2hhaWMgY3Jhc2ggYnVnIHdvbid0IGFsbG93IHVzIHRvIHVzZSBgMSAtICggMC41IHx8IDAgKWAgKCMxMjQ5NykKCQkJCXRlbXAgPSByZW1haW5pbmcgLyBhbmltYXRpb24uZHVyYXRpb24gfHwgMCwKCQkJCXBlcmNlbnQgPSAxIC0gdGVtcCwKCQkJCWluZGV4ID0gMCwKCQkJCWxlbmd0aCA9IGFuaW1hdGlvbi50d2VlbnMubGVuZ3RoOwoKCQkJZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7CgkJCQlhbmltYXRpb24udHdlZW5zWyBpbmRleCBdLnJ1biggcGVyY2VudCApOwoJCQl9CgoJCQlkZWZlcnJlZC5ub3RpZnlXaXRoKCBlbGVtLCBbIGFuaW1hdGlvbiwgcGVyY2VudCwgcmVtYWluaW5nIF0gKTsKCgkJCWlmICggcGVyY2VudCA8IDEgJiYgbGVuZ3RoICkgewoJCQkJcmV0dXJuIHJlbWFpbmluZzsKCQkJfSBlbHNlIHsKCQkJCWRlZmVycmVkLnJlc29sdmVXaXRoKCBlbGVtLCBbIGFuaW1hdGlvbiBdICk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9LAoJCWFuaW1hdGlvbiA9IGRlZmVycmVkLnByb21pc2UoIHsKCQkJZWxlbTogZWxlbSwKCQkJcHJvcHM6IGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wZXJ0aWVzICksCgkJCW9wdHM6IGpRdWVyeS5leHRlbmQoIHRydWUsIHsKCQkJCXNwZWNpYWxFYXNpbmc6IHt9LAoJCQkJZWFzaW5nOiBqUXVlcnkuZWFzaW5nLl9kZWZhdWx0CgkJCX0sIG9wdGlvbnMgKSwKCQkJb3JpZ2luYWxQcm9wZXJ0aWVzOiBwcm9wZXJ0aWVzLAoJCQlvcmlnaW5hbE9wdGlvbnM6IG9wdGlvbnMsCgkJCXN0YXJ0VGltZTogZnhOb3cgfHwgY3JlYXRlRnhOb3coKSwKCQkJZHVyYXRpb246IG9wdGlvbnMuZHVyYXRpb24sCgkJCXR3ZWVuczogW10sCgkJCWNyZWF0ZVR3ZWVuOiBmdW5jdGlvbiggcHJvcCwgZW5kICkgewoJCQkJdmFyIHR3ZWVuID0galF1ZXJ5LlR3ZWVuKCBlbGVtLCBhbmltYXRpb24ub3B0cywgcHJvcCwgZW5kLAoJCQkJCQlhbmltYXRpb24ub3B0cy5zcGVjaWFsRWFzaW5nWyBwcm9wIF0gfHwgYW5pbWF0aW9uLm9wdHMuZWFzaW5nICk7CgkJCQlhbmltYXRpb24udHdlZW5zLnB1c2goIHR3ZWVuICk7CgkJCQlyZXR1cm4gdHdlZW47CgkJCX0sCgkJCXN0b3A6IGZ1bmN0aW9uKCBnb3RvRW5kICkgewoJCQkJdmFyIGluZGV4ID0gMCwKCgkJCQkJLy8gaWYgd2UgYXJlIGdvaW5nIHRvIHRoZSBlbmQsIHdlIHdhbnQgdG8gcnVuIGFsbCB0aGUgdHdlZW5zCgkJCQkJLy8gb3RoZXJ3aXNlIHdlIHNraXAgdGhpcyBwYXJ0CgkJCQkJbGVuZ3RoID0gZ290b0VuZCA/IGFuaW1hdGlvbi50d2VlbnMubGVuZ3RoIDogMDsKCQkJCWlmICggc3RvcHBlZCApIHsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0KCQkJCXN0b3BwZWQgPSB0cnVlOwoJCQkJZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7CgkJCQkJYW5pbWF0aW9uLnR3ZWVuc1sgaW5kZXggXS5ydW4oIDEgKTsKCQkJCX0KCgkJCQkvLyByZXNvbHZlIHdoZW4gd2UgcGxheWVkIHRoZSBsYXN0IGZyYW1lCgkJCQkvLyBvdGhlcndpc2UsIHJlamVjdAoJCQkJaWYgKCBnb3RvRW5kICkgewoJCQkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGVsZW0sIFsgYW5pbWF0aW9uLCAxLCAwIF0gKTsKCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24sIGdvdG9FbmQgXSApOwoJCQkJfSBlbHNlIHsKCQkJCQlkZWZlcnJlZC5yZWplY3RXaXRoKCBlbGVtLCBbIGFuaW1hdGlvbiwgZ290b0VuZCBdICk7CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfQoJCX0gKSwKCQlwcm9wcyA9IGFuaW1hdGlvbi5wcm9wczsKCglwcm9wRmlsdGVyKCBwcm9wcywgYW5pbWF0aW9uLm9wdHMuc3BlY2lhbEVhc2luZyApOwoKCWZvciAoIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCXJlc3VsdCA9IEFuaW1hdGlvbi5wcmVmaWx0ZXJzWyBpbmRleCBdLmNhbGwoIGFuaW1hdGlvbiwgZWxlbSwgcHJvcHMsIGFuaW1hdGlvbi5vcHRzICk7CgkJaWYgKCByZXN1bHQgKSB7CgkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHJlc3VsdC5zdG9wICkgKSB7CgkJCQlqUXVlcnkuX3F1ZXVlSG9va3MoIGFuaW1hdGlvbi5lbGVtLCBhbmltYXRpb24ub3B0cy5xdWV1ZSApLnN0b3AgPQoJCQkJCWpRdWVyeS5wcm94eSggcmVzdWx0LnN0b3AsIHJlc3VsdCApOwoJCQl9CgkJCXJldHVybiByZXN1bHQ7CgkJfQoJfQoKCWpRdWVyeS5tYXAoIHByb3BzLCBjcmVhdGVUd2VlbiwgYW5pbWF0aW9uICk7CgoJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggYW5pbWF0aW9uLm9wdHMuc3RhcnQgKSApIHsKCQlhbmltYXRpb24ub3B0cy5zdGFydC5jYWxsKCBlbGVtLCBhbmltYXRpb24gKTsKCX0KCglqUXVlcnkuZngudGltZXIoCgkJalF1ZXJ5LmV4dGVuZCggdGljaywgewoJCQllbGVtOiBlbGVtLAoJCQlhbmltOiBhbmltYXRpb24sCgkJCXF1ZXVlOiBhbmltYXRpb24ub3B0cy5xdWV1ZQoJCX0gKQoJKTsKCgkvLyBhdHRhY2ggY2FsbGJhY2tzIGZyb20gb3B0aW9ucwoJcmV0dXJuIGFuaW1hdGlvbi5wcm9ncmVzcyggYW5pbWF0aW9uLm9wdHMucHJvZ3Jlc3MgKQoJCS5kb25lKCBhbmltYXRpb24ub3B0cy5kb25lLCBhbmltYXRpb24ub3B0cy5jb21wbGV0ZSApCgkJLmZhaWwoIGFuaW1hdGlvbi5vcHRzLmZhaWwgKQoJCS5hbHdheXMoIGFuaW1hdGlvbi5vcHRzLmFsd2F5cyApOwp9CgpqUXVlcnkuQW5pbWF0aW9uID0galF1ZXJ5LmV4dGVuZCggQW5pbWF0aW9uLCB7CgoJdHdlZW5lcnM6IHsKCQkiKiI6IFsgZnVuY3Rpb24oIHByb3AsIHZhbHVlICkgewoJCQl2YXIgdHdlZW4gPSB0aGlzLmNyZWF0ZVR3ZWVuKCBwcm9wLCB2YWx1ZSApOwoJCQlhZGp1c3RDU1MoIHR3ZWVuLmVsZW0sIHByb3AsIHJjc3NOdW0uZXhlYyggdmFsdWUgKSwgdHdlZW4gKTsKCQkJcmV0dXJuIHR3ZWVuOwoJCX0gXQoJfSwKCgl0d2VlbmVyOiBmdW5jdGlvbiggcHJvcHMsIGNhbGxiYWNrICkgewoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHByb3BzICkgKSB7CgkJCWNhbGxiYWNrID0gcHJvcHM7CgkJCXByb3BzID0gWyAiKiIgXTsKCQl9IGVsc2UgewoJCQlwcm9wcyA9IHByb3BzLm1hdGNoKCBybm90d2hpdGUgKTsKCQl9CgoJCXZhciBwcm9wLAoJCQlpbmRleCA9IDAsCgkJCWxlbmd0aCA9IHByb3BzLmxlbmd0aDsKCgkJZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7CgkJCXByb3AgPSBwcm9wc1sgaW5kZXggXTsKCQkJQW5pbWF0aW9uLnR3ZWVuZXJzWyBwcm9wIF0gPSBBbmltYXRpb24udHdlZW5lcnNbIHByb3AgXSB8fCBbXTsKCQkJQW5pbWF0aW9uLnR3ZWVuZXJzWyBwcm9wIF0udW5zaGlmdCggY2FsbGJhY2sgKTsKCQl9Cgl9LAoKCXByZWZpbHRlcnM6IFsgZGVmYXVsdFByZWZpbHRlciBdLAoKCXByZWZpbHRlcjogZnVuY3Rpb24oIGNhbGxiYWNrLCBwcmVwZW5kICkgewoJCWlmICggcHJlcGVuZCApIHsKCQkJQW5pbWF0aW9uLnByZWZpbHRlcnMudW5zaGlmdCggY2FsbGJhY2sgKTsKCQl9IGVsc2UgewoJCQlBbmltYXRpb24ucHJlZmlsdGVycy5wdXNoKCBjYWxsYmFjayApOwoJCX0KCX0KfSApOwoKalF1ZXJ5LnNwZWVkID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGZuICkgewoJdmFyIG9wdCA9IHNwZWVkICYmIHR5cGVvZiBzcGVlZCA9PT0gIm9iamVjdCIgPyBqUXVlcnkuZXh0ZW5kKCB7fSwgc3BlZWQgKSA6IHsKCQljb21wbGV0ZTogZm4gfHwgIWZuICYmIGVhc2luZyB8fAoJCQlqUXVlcnkuaXNGdW5jdGlvbiggc3BlZWQgKSAmJiBzcGVlZCwKCQlkdXJhdGlvbjogc3BlZWQsCgkJZWFzaW5nOiBmbiAmJiBlYXNpbmcgfHwgZWFzaW5nICYmICFqUXVlcnkuaXNGdW5jdGlvbiggZWFzaW5nICkgJiYgZWFzaW5nCgl9OwoKCW9wdC5kdXJhdGlvbiA9IGpRdWVyeS5meC5vZmYgPyAwIDogdHlwZW9mIG9wdC5kdXJhdGlvbiA9PT0gIm51bWJlciIgPyBvcHQuZHVyYXRpb24gOgoJCW9wdC5kdXJhdGlvbiBpbiBqUXVlcnkuZnguc3BlZWRzID8KCQkJalF1ZXJ5LmZ4LnNwZWVkc1sgb3B0LmR1cmF0aW9uIF0gOiBqUXVlcnkuZnguc3BlZWRzLl9kZWZhdWx0OwoKCS8vIG5vcm1hbGl6ZSBvcHQucXVldWUgLSB0cnVlL3VuZGVmaW5lZC9udWxsIC0+ICJmeCIKCWlmICggb3B0LnF1ZXVlID09IG51bGwgfHwgb3B0LnF1ZXVlID09PSB0cnVlICkgewoJCW9wdC5xdWV1ZSA9ICJmeCI7Cgl9CgoJLy8gUXVldWVpbmcKCW9wdC5vbGQgPSBvcHQuY29tcGxldGU7CgoJb3B0LmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggb3B0Lm9sZCApICkgewoJCQlvcHQub2xkLmNhbGwoIHRoaXMgKTsKCQl9CgoJCWlmICggb3B0LnF1ZXVlICkgewoJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgb3B0LnF1ZXVlICk7CgkJfQoJfTsKCglyZXR1cm4gb3B0Owp9OwoKalF1ZXJ5LmZuLmV4dGVuZCggewoJZmFkZVRvOiBmdW5jdGlvbiggc3BlZWQsIHRvLCBlYXNpbmcsIGNhbGxiYWNrICkgewoKCQkvLyBzaG93IGFueSBoaWRkZW4gZWxlbWVudHMgYWZ0ZXIgc2V0dGluZyBvcGFjaXR5IHRvIDAKCQlyZXR1cm4gdGhpcy5maWx0ZXIoIGlzSGlkZGVuICkuY3NzKCAib3BhY2l0eSIsIDAgKS5zaG93KCkKCgkJCS8vIGFuaW1hdGUgdG8gdGhlIHZhbHVlIHNwZWNpZmllZAoJCQkuZW5kKCkuYW5pbWF0ZSggeyBvcGFjaXR5OiB0byB9LCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApOwoJfSwKCWFuaW1hdGU6IGZ1bmN0aW9uKCBwcm9wLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQl2YXIgZW1wdHkgPSBqUXVlcnkuaXNFbXB0eU9iamVjdCggcHJvcCApLAoJCQlvcHRhbGwgPSBqUXVlcnkuc3BlZWQoIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICksCgkJCWRvQW5pbWF0aW9uID0gZnVuY3Rpb24oKSB7CgoJCQkJLy8gT3BlcmF0ZSBvbiBhIGNvcHkgb2YgcHJvcCBzbyBwZXItcHJvcGVydHkgZWFzaW5nIHdvbid0IGJlIGxvc3QKCQkJCXZhciBhbmltID0gQW5pbWF0aW9uKCB0aGlzLCBqUXVlcnkuZXh0ZW5kKCB7fSwgcHJvcCApLCBvcHRhbGwgKTsKCgkJCQkvLyBFbXB0eSBhbmltYXRpb25zLCBvciBmaW5pc2hpbmcgcmVzb2x2ZXMgaW1tZWRpYXRlbHkKCQkJCWlmICggZW1wdHkgfHwgalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiZmluaXNoIiApICkgewoJCQkJCWFuaW0uc3RvcCggdHJ1ZSApOwoJCQkJfQoJCQl9OwoJCQlkb0FuaW1hdGlvbi5maW5pc2ggPSBkb0FuaW1hdGlvbjsKCgkJcmV0dXJuIGVtcHR5IHx8IG9wdGFsbC5xdWV1ZSA9PT0gZmFsc2UgPwoJCQl0aGlzLmVhY2goIGRvQW5pbWF0aW9uICkgOgoJCQl0aGlzLnF1ZXVlKCBvcHRhbGwucXVldWUsIGRvQW5pbWF0aW9uICk7Cgl9LAoJc3RvcDogZnVuY3Rpb24oIHR5cGUsIGNsZWFyUXVldWUsIGdvdG9FbmQgKSB7CgkJdmFyIHN0b3BRdWV1ZSA9IGZ1bmN0aW9uKCBob29rcyApIHsKCQkJdmFyIHN0b3AgPSBob29rcy5zdG9wOwoJCQlkZWxldGUgaG9va3Muc3RvcDsKCQkJc3RvcCggZ290b0VuZCApOwoJCX07CgoJCWlmICggdHlwZW9mIHR5cGUgIT09ICJzdHJpbmciICkgewoJCQlnb3RvRW5kID0gY2xlYXJRdWV1ZTsKCQkJY2xlYXJRdWV1ZSA9IHR5cGU7CgkJCXR5cGUgPSB1bmRlZmluZWQ7CgkJfQoJCWlmICggY2xlYXJRdWV1ZSAmJiB0eXBlICE9PSBmYWxzZSApIHsKCQkJdGhpcy5xdWV1ZSggdHlwZSB8fCAiZngiLCBbXSApOwoJCX0KCgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCXZhciBkZXF1ZXVlID0gdHJ1ZSwKCQkJCWluZGV4ID0gdHlwZSAhPSBudWxsICYmIHR5cGUgKyAicXVldWVIb29rcyIsCgkJCQl0aW1lcnMgPSBqUXVlcnkudGltZXJzLAoJCQkJZGF0YSA9IGpRdWVyeS5fZGF0YSggdGhpcyApOwoKCQkJaWYgKCBpbmRleCApIHsKCQkJCWlmICggZGF0YVsgaW5kZXggXSAmJiBkYXRhWyBpbmRleCBdLnN0b3AgKSB7CgkJCQkJc3RvcFF1ZXVlKCBkYXRhWyBpbmRleCBdICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlmb3IgKCBpbmRleCBpbiBkYXRhICkgewoJCQkJCWlmICggZGF0YVsgaW5kZXggXSAmJiBkYXRhWyBpbmRleCBdLnN0b3AgJiYgcnJ1bi50ZXN0KCBpbmRleCApICkgewoJCQkJCQlzdG9wUXVldWUoIGRhdGFbIGluZGV4IF0gKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCWZvciAoIGluZGV4ID0gdGltZXJzLmxlbmd0aDsgaW5kZXgtLTsgKSB7CgkJCQlpZiAoIHRpbWVyc1sgaW5kZXggXS5lbGVtID09PSB0aGlzICYmCgkJCQkJKCB0eXBlID09IG51bGwgfHwgdGltZXJzWyBpbmRleCBdLnF1ZXVlID09PSB0eXBlICkgKSB7CgoJCQkJCXRpbWVyc1sgaW5kZXggXS5hbmltLnN0b3AoIGdvdG9FbmQgKTsKCQkJCQlkZXF1ZXVlID0gZmFsc2U7CgkJCQkJdGltZXJzLnNwbGljZSggaW5kZXgsIDEgKTsKCQkJCX0KCQkJfQoKCQkJLy8gc3RhcnQgdGhlIG5leHQgaW4gdGhlIHF1ZXVlIGlmIHRoZSBsYXN0IHN0ZXAgd2Fzbid0IGZvcmNlZAoJCQkvLyB0aW1lcnMgY3VycmVudGx5IHdpbGwgY2FsbCB0aGVpciBjb21wbGV0ZSBjYWxsYmFja3MsIHdoaWNoIHdpbGwgZGVxdWV1ZQoJCQkvLyBidXQgb25seSBpZiB0aGV5IHdlcmUgZ290b0VuZAoJCQlpZiAoIGRlcXVldWUgfHwgIWdvdG9FbmQgKSB7CgkJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCQl9CgkJfSApOwoJfSwKCWZpbmlzaDogZnVuY3Rpb24oIHR5cGUgKSB7CgkJaWYgKCB0eXBlICE9PSBmYWxzZSApIHsKCQkJdHlwZSA9IHR5cGUgfHwgImZ4IjsKCQl9CgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCXZhciBpbmRleCwKCQkJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIHRoaXMgKSwKCQkJCXF1ZXVlID0gZGF0YVsgdHlwZSArICJxdWV1ZSIgXSwKCQkJCWhvb2tzID0gZGF0YVsgdHlwZSArICJxdWV1ZUhvb2tzIiBdLAoJCQkJdGltZXJzID0galF1ZXJ5LnRpbWVycywKCQkJCWxlbmd0aCA9IHF1ZXVlID8gcXVldWUubGVuZ3RoIDogMDsKCgkJCS8vIGVuYWJsZSBmaW5pc2hpbmcgZmxhZyBvbiBwcml2YXRlIGRhdGEKCQkJZGF0YS5maW5pc2ggPSB0cnVlOwoKCQkJLy8gZW1wdHkgdGhlIHF1ZXVlIGZpcnN0CgkJCWpRdWVyeS5xdWV1ZSggdGhpcywgdHlwZSwgW10gKTsKCgkJCWlmICggaG9va3MgJiYgaG9va3Muc3RvcCApIHsKCQkJCWhvb2tzLnN0b3AuY2FsbCggdGhpcywgdHJ1ZSApOwoJCQl9CgoJCQkvLyBsb29rIGZvciBhbnkgYWN0aXZlIGFuaW1hdGlvbnMsIGFuZCBmaW5pc2ggdGhlbQoJCQlmb3IgKCBpbmRleCA9IHRpbWVycy5sZW5ndGg7IGluZGV4LS07ICkgewoJCQkJaWYgKCB0aW1lcnNbIGluZGV4IF0uZWxlbSA9PT0gdGhpcyAmJiB0aW1lcnNbIGluZGV4IF0ucXVldWUgPT09IHR5cGUgKSB7CgkJCQkJdGltZXJzWyBpbmRleCBdLmFuaW0uc3RvcCggdHJ1ZSApOwoJCQkJCXRpbWVycy5zcGxpY2UoIGluZGV4LCAxICk7CgkJCQl9CgkJCX0KCgkJCS8vIGxvb2sgZm9yIGFueSBhbmltYXRpb25zIGluIHRoZSBvbGQgcXVldWUgYW5kIGZpbmlzaCB0aGVtCgkJCWZvciAoIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJCQlpZiAoIHF1ZXVlWyBpbmRleCBdICYmIHF1ZXVlWyBpbmRleCBdLmZpbmlzaCApIHsKCQkJCQlxdWV1ZVsgaW5kZXggXS5maW5pc2guY2FsbCggdGhpcyApOwoJCQkJfQoJCQl9CgoJCQkvLyB0dXJuIG9mZiBmaW5pc2hpbmcgZmxhZwoJCQlkZWxldGUgZGF0YS5maW5pc2g7CgkJfSApOwoJfQp9ICk7CgpqUXVlcnkuZWFjaCggWyAidG9nZ2xlIiwgInNob3ciLCAiaGlkZSIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7Cgl2YXIgY3NzRm4gPSBqUXVlcnkuZm5bIG5hbWUgXTsKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgewoJCXJldHVybiBzcGVlZCA9PSBudWxsIHx8IHR5cGVvZiBzcGVlZCA9PT0gImJvb2xlYW4iID8KCQkJY3NzRm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApIDoKCQkJdGhpcy5hbmltYXRlKCBnZW5GeCggbmFtZSwgdHJ1ZSApLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApOwoJfTsKfSApOwoKLy8gR2VuZXJhdGUgc2hvcnRjdXRzIGZvciBjdXN0b20gYW5pbWF0aW9ucwpqUXVlcnkuZWFjaCggewoJc2xpZGVEb3duOiBnZW5GeCggInNob3ciICksCglzbGlkZVVwOiBnZW5GeCggImhpZGUiICksCglzbGlkZVRvZ2dsZTogZ2VuRngoICJ0b2dnbGUiICksCglmYWRlSW46IHsgb3BhY2l0eTogInNob3ciIH0sCglmYWRlT3V0OiB7IG9wYWNpdHk6ICJoaWRlIiB9LAoJZmFkZVRvZ2dsZTogeyBvcGFjaXR5OiAidG9nZ2xlIiB9Cn0sIGZ1bmN0aW9uKCBuYW1lLCBwcm9wcyApIHsKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgewoJCXJldHVybiB0aGlzLmFuaW1hdGUoIHByb3BzLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApOwoJfTsKfSApOwoKalF1ZXJ5LnRpbWVycyA9IFtdOwpqUXVlcnkuZngudGljayA9IGZ1bmN0aW9uKCkgewoJdmFyIHRpbWVyLAoJCXRpbWVycyA9IGpRdWVyeS50aW1lcnMsCgkJaSA9IDA7CgoJZnhOb3cgPSBqUXVlcnkubm93KCk7CgoJZm9yICggOyBpIDwgdGltZXJzLmxlbmd0aDsgaSsrICkgewoJCXRpbWVyID0gdGltZXJzWyBpIF07CgoJCS8vIENoZWNrcyB0aGUgdGltZXIgaGFzIG5vdCBhbHJlYWR5IGJlZW4gcmVtb3ZlZAoJCWlmICggIXRpbWVyKCkgJiYgdGltZXJzWyBpIF0gPT09IHRpbWVyICkgewoJCQl0aW1lcnMuc3BsaWNlKCBpLS0sIDEgKTsKCQl9Cgl9CgoJaWYgKCAhdGltZXJzLmxlbmd0aCApIHsKCQlqUXVlcnkuZnguc3RvcCgpOwoJfQoJZnhOb3cgPSB1bmRlZmluZWQ7Cn07CgpqUXVlcnkuZngudGltZXIgPSBmdW5jdGlvbiggdGltZXIgKSB7CglqUXVlcnkudGltZXJzLnB1c2goIHRpbWVyICk7CglpZiAoIHRpbWVyKCkgKSB7CgkJalF1ZXJ5LmZ4LnN0YXJ0KCk7Cgl9IGVsc2UgewoJCWpRdWVyeS50aW1lcnMucG9wKCk7Cgl9Cn07CgpqUXVlcnkuZnguaW50ZXJ2YWwgPSAxMzsKCmpRdWVyeS5meC5zdGFydCA9IGZ1bmN0aW9uKCkgewoJaWYgKCAhdGltZXJJZCApIHsKCQl0aW1lcklkID0gd2luZG93LnNldEludGVydmFsKCBqUXVlcnkuZngudGljaywgalF1ZXJ5LmZ4LmludGVydmFsICk7Cgl9Cn07CgpqUXVlcnkuZnguc3RvcCA9IGZ1bmN0aW9uKCkgewoJd2luZG93LmNsZWFySW50ZXJ2YWwoIHRpbWVySWQgKTsKCXRpbWVySWQgPSBudWxsOwp9OwoKalF1ZXJ5LmZ4LnNwZWVkcyA9IHsKCXNsb3c6IDYwMCwKCWZhc3Q6IDIwMCwKCgkvLyBEZWZhdWx0IHNwZWVkCglfZGVmYXVsdDogNDAwCn07CgoKLy8gQmFzZWQgb2ZmIG9mIHRoZSBwbHVnaW4gYnkgQ2xpbnQgSGVsZmVycywgd2l0aCBwZXJtaXNzaW9uLgovLyBodHRwOi8vd2ViLmFyY2hpdmUub3JnL3dlYi8yMDEwMDMyNDAxNDc0Ny9odHRwOi8vYmxpbmRzaWduYWxzLmNvbS9pbmRleC5waHAvMjAwOS8wNy9qcXVlcnktZGVsYXkvCmpRdWVyeS5mbi5kZWxheSA9IGZ1bmN0aW9uKCB0aW1lLCB0eXBlICkgewoJdGltZSA9IGpRdWVyeS5meCA/IGpRdWVyeS5meC5zcGVlZHNbIHRpbWUgXSB8fCB0aW1lIDogdGltZTsKCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgoJcmV0dXJuIHRoaXMucXVldWUoIHR5cGUsIGZ1bmN0aW9uKCBuZXh0LCBob29rcyApIHsKCQl2YXIgdGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KCBuZXh0LCB0aW1lICk7CgkJaG9va3Muc3RvcCA9IGZ1bmN0aW9uKCkgewoJCQl3aW5kb3cuY2xlYXJUaW1lb3V0KCB0aW1lb3V0ICk7CgkJfTsKCX0gKTsKfTsKCgooIGZ1bmN0aW9uKCkgewoJdmFyIGEsCgkJaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiaW5wdXQiICksCgkJZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKSwKCQlzZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAic2VsZWN0IiApLAoJCW9wdCA9IHNlbGVjdC5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggIm9wdGlvbiIgKSApOwoKCS8vIFNldHVwCglkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoJZGl2LnNldEF0dHJpYnV0ZSggImNsYXNzTmFtZSIsICJ0IiApOwoJZGl2LmlubmVySFRNTCA9ICIgIDxsaW5rLz48dGFibGU+PC90YWJsZT48YSBocmVmPScvYSc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz4iOwoJYSA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSggImEiIClbIDAgXTsKCgkvLyBTdXBwb3J0OiBXaW5kb3dzIFdlYiBBcHBzIChXV0EpCgkvLyBgdHlwZWAgbXVzdCB1c2UgLnNldEF0dHJpYnV0ZSBmb3IgV1dBICgjMTQ5MDEpCglpbnB1dC5zZXRBdHRyaWJ1dGUoICJ0eXBlIiwgImNoZWNrYm94IiApOwoJZGl2LmFwcGVuZENoaWxkKCBpbnB1dCApOwoKCWEgPSBkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICJhIiApWyAwIF07CgoJLy8gRmlyc3QgYmF0Y2ggb2YgdGVzdHMuCglhLnN0eWxlLmNzc1RleHQgPSAidG9wOjFweCI7CgoJLy8gVGVzdCBzZXRBdHRyaWJ1dGUgb24gY2FtZWxDYXNlIGNsYXNzLgoJLy8gSWYgaXQgd29ya3MsIHdlIG5lZWQgYXR0ckZpeGVzIHdoZW4gZG9pbmcgZ2V0L3NldEF0dHJpYnV0ZSAoaWU2LzcpCglzdXBwb3J0LmdldFNldEF0dHJpYnV0ZSA9IGRpdi5jbGFzc05hbWUgIT09ICJ0IjsKCgkvLyBHZXQgdGhlIHN0eWxlIGluZm9ybWF0aW9uIGZyb20gZ2V0QXR0cmlidXRlCgkvLyAoSUUgdXNlcyAuY3NzVGV4dCBpbnN0ZWFkKQoJc3VwcG9ydC5zdHlsZSA9IC90b3AvLnRlc3QoIGEuZ2V0QXR0cmlidXRlKCAic3R5bGUiICkgKTsKCgkvLyBNYWtlIHN1cmUgdGhhdCBVUkxzIGFyZW4ndCBtYW5pcHVsYXRlZAoJLy8gKElFIG5vcm1hbGl6ZXMgaXQgYnkgZGVmYXVsdCkKCXN1cHBvcnQuaHJlZk5vcm1hbGl6ZWQgPSBhLmdldEF0dHJpYnV0ZSggImhyZWYiICkgPT09ICIvYSI7CgoJLy8gQ2hlY2sgdGhlIGRlZmF1bHQgY2hlY2tib3gvcmFkaW8gdmFsdWUgKCIiIG9uIFdlYktpdDsgIm9uIiBlbHNld2hlcmUpCglzdXBwb3J0LmNoZWNrT24gPSAhIWlucHV0LnZhbHVlOwoKCS8vIE1ha2Ugc3VyZSB0aGF0IGEgc2VsZWN0ZWQtYnktZGVmYXVsdCBvcHRpb24gaGFzIGEgd29ya2luZyBzZWxlY3RlZCBwcm9wZXJ0eS4KCS8vIChXZWJLaXQgZGVmYXVsdHMgdG8gZmFsc2UgaW5zdGVhZCBvZiB0cnVlLCBJRSB0b28sIGlmIGl0J3MgaW4gYW4gb3B0Z3JvdXApCglzdXBwb3J0Lm9wdFNlbGVjdGVkID0gb3B0LnNlbGVjdGVkOwoKCS8vIFRlc3RzIGZvciBlbmN0eXBlIHN1cHBvcnQgb24gYSBmb3JtICgjNjc0MykKCXN1cHBvcnQuZW5jdHlwZSA9ICEhZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImZvcm0iICkuZW5jdHlwZTsKCgkvLyBNYWtlIHN1cmUgdGhhdCB0aGUgb3B0aW9ucyBpbnNpZGUgZGlzYWJsZWQgc2VsZWN0cyBhcmVuJ3QgbWFya2VkIGFzIGRpc2FibGVkCgkvLyAoV2ViS2l0IG1hcmtzIHRoZW0gYXMgZGlzYWJsZWQpCglzZWxlY3QuZGlzYWJsZWQgPSB0cnVlOwoJc3VwcG9ydC5vcHREaXNhYmxlZCA9ICFvcHQuZGlzYWJsZWQ7CgoJLy8gU3VwcG9ydDogSUU4IG9ubHkKCS8vIENoZWNrIGlmIHdlIGNhbiB0cnVzdCBnZXRBdHRyaWJ1dGUoInZhbHVlIikKCWlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImlucHV0IiApOwoJaW5wdXQuc2V0QXR0cmlidXRlKCAidmFsdWUiLCAiIiApOwoJc3VwcG9ydC5pbnB1dCA9IGlucHV0LmdldEF0dHJpYnV0ZSggInZhbHVlIiApID09PSAiIjsKCgkvLyBDaGVjayBpZiBhbiBpbnB1dCBtYWludGFpbnMgaXRzIHZhbHVlIGFmdGVyIGJlY29taW5nIGEgcmFkaW8KCWlucHV0LnZhbHVlID0gInQiOwoJaW5wdXQuc2V0QXR0cmlidXRlKCAidHlwZSIsICJyYWRpbyIgKTsKCXN1cHBvcnQucmFkaW9WYWx1ZSA9IGlucHV0LnZhbHVlID09PSAidCI7Cn0gKSgpOwoKCnZhciBycmV0dXJuID0gL1xyL2csCglyc3BhY2VzID0gL1tceDIwXHRcclxuXGZdKy9nOwoKalF1ZXJ5LmZuLmV4dGVuZCggewoJdmFsOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdmFyIGhvb2tzLCByZXQsIGlzRnVuY3Rpb24sCgkJCWVsZW0gPSB0aGlzWyAwIF07CgoJCWlmICggIWFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCWlmICggZWxlbSApIHsKCQkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyBlbGVtLnR5cGUgXSB8fAoJCQkJCWpRdWVyeS52YWxIb29rc1sgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIF07CgoJCQkJaWYgKAoJCQkJCWhvb2tzICYmCgkJCQkJImdldCIgaW4gaG9va3MgJiYKCQkJCQkoIHJldCA9IGhvb2tzLmdldCggZWxlbSwgInZhbHVlIiApICkgIT09IHVuZGVmaW5lZAoJCQkJKSB7CgkJCQkJcmV0dXJuIHJldDsKCQkJCX0KCgkJCQlyZXQgPSBlbGVtLnZhbHVlOwoKCQkJCXJldHVybiB0eXBlb2YgcmV0ID09PSAic3RyaW5nIiA/CgoJCQkJCS8vIGhhbmRsZSBtb3N0IGNvbW1vbiBzdHJpbmcgY2FzZXMKCQkJCQlyZXQucmVwbGFjZSggcnJldHVybiwgIiIgKSA6CgoJCQkJCS8vIGhhbmRsZSBjYXNlcyB3aGVyZSB2YWx1ZSBpcyBudWxsL3VuZGVmIG9yIG51bWJlcgoJCQkJCXJldCA9PSBudWxsID8gIiIgOiByZXQ7CgkJCX0KCgkJCXJldHVybjsKCQl9CgoJCWlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oIGkgKSB7CgkJCXZhciB2YWw7CgoJCQlpZiAoIHRoaXMubm9kZVR5cGUgIT09IDEgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmICggaXNGdW5jdGlvbiApIHsKCQkJCXZhbCA9IHZhbHVlLmNhbGwoIHRoaXMsIGksIGpRdWVyeSggdGhpcyApLnZhbCgpICk7CgkJCX0gZWxzZSB7CgkJCQl2YWwgPSB2YWx1ZTsKCQkJfQoKCQkJLy8gVHJlYXQgbnVsbC91bmRlZmluZWQgYXMgIiI7IGNvbnZlcnQgbnVtYmVycyB0byBzdHJpbmcKCQkJaWYgKCB2YWwgPT0gbnVsbCApIHsKCQkJCXZhbCA9ICIiOwoJCQl9IGVsc2UgaWYgKCB0eXBlb2YgdmFsID09PSAibnVtYmVyIiApIHsKCQkJCXZhbCArPSAiIjsKCQkJfSBlbHNlIGlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbCApICkgewoJCQkJdmFsID0galF1ZXJ5Lm1hcCggdmFsLCBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCQkJcmV0dXJuIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlICsgIiI7CgkJCQl9ICk7CgkJCX0KCgkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyB0aGlzLnR5cGUgXSB8fCBqUXVlcnkudmFsSG9va3NbIHRoaXMubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkJLy8gSWYgc2V0IHJldHVybnMgdW5kZWZpbmVkLCBmYWxsIGJhY2sgdG8gbm9ybWFsIHNldHRpbmcKCQkJaWYgKCAhaG9va3MgfHwgISggInNldCIgaW4gaG9va3MgKSB8fCBob29rcy5zZXQoIHRoaXMsIHZhbCwgInZhbHVlIiApID09PSB1bmRlZmluZWQgKSB7CgkJCQl0aGlzLnZhbHVlID0gdmFsOwoJCQl9CgkJfSApOwoJfQp9ICk7CgpqUXVlcnkuZXh0ZW5kKCB7Cgl2YWxIb29rczogewoJCW9wdGlvbjogewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHZhbCA9IGpRdWVyeS5maW5kLmF0dHIoIGVsZW0sICJ2YWx1ZSIgKTsKCQkJCXJldHVybiB2YWwgIT0gbnVsbCA/CgkJCQkJdmFsIDoKCgkJCQkJLy8gU3VwcG9ydDogSUUxMC0xMSsKCQkJCQkvLyBvcHRpb24udGV4dCB0aHJvd3MgZXhjZXB0aW9ucyAoIzE0Njg2LCAjMTQ4NTgpCgkJCQkJLy8gU3RyaXAgYW5kIGNvbGxhcHNlIHdoaXRlc3BhY2UKCQkJCQkvLyBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnLyNzdHJpcC1hbmQtY29sbGFwc2Utd2hpdGVzcGFjZQoJCQkJCWpRdWVyeS50cmltKCBqUXVlcnkudGV4dCggZWxlbSApICkucmVwbGFjZSggcnNwYWNlcywgIiAiICk7CgkJCX0KCQl9LAoJCXNlbGVjdDogewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHZhbHVlLCBvcHRpb24sCgkJCQkJb3B0aW9ucyA9IGVsZW0ub3B0aW9ucywKCQkJCQlpbmRleCA9IGVsZW0uc2VsZWN0ZWRJbmRleCwKCQkJCQlvbmUgPSBlbGVtLnR5cGUgPT09ICJzZWxlY3Qtb25lIiB8fCBpbmRleCA8IDAsCgkJCQkJdmFsdWVzID0gb25lID8gbnVsbCA6IFtdLAoJCQkJCW1heCA9IG9uZSA/IGluZGV4ICsgMSA6IG9wdGlvbnMubGVuZ3RoLAoJCQkJCWkgPSBpbmRleCA8IDAgPwoJCQkJCQltYXggOgoJCQkJCQlvbmUgPyBpbmRleCA6IDA7CgoJCQkJLy8gTG9vcCB0aHJvdWdoIGFsbCB0aGUgc2VsZWN0ZWQgb3B0aW9ucwoJCQkJZm9yICggOyBpIDwgbWF4OyBpKysgKSB7CgkJCQkJb3B0aW9uID0gb3B0aW9uc1sgaSBdOwoKCQkJCQkvLyBvbGRJRSBkb2Vzbid0IHVwZGF0ZSBzZWxlY3RlZCBhZnRlciBmb3JtIHJlc2V0ICgjMjU1MSkKCQkJCQlpZiAoICggb3B0aW9uLnNlbGVjdGVkIHx8IGkgPT09IGluZGV4ICkgJiYKCgkJCQkJCQkvLyBEb24ndCByZXR1cm4gb3B0aW9ucyB0aGF0IGFyZSBkaXNhYmxlZCBvciBpbiBhIGRpc2FibGVkIG9wdGdyb3VwCgkJCQkJCQkoIHN1cHBvcnQub3B0RGlzYWJsZWQgPwoJCQkJCQkJCSFvcHRpb24uZGlzYWJsZWQgOgoJCQkJCQkJCW9wdGlvbi5nZXRBdHRyaWJ1dGUoICJkaXNhYmxlZCIgKSA9PT0gbnVsbCApICYmCgkJCQkJCQkoICFvcHRpb24ucGFyZW50Tm9kZS5kaXNhYmxlZCB8fAoJCQkJCQkJCSFqUXVlcnkubm9kZU5hbWUoIG9wdGlvbi5wYXJlbnROb2RlLCAib3B0Z3JvdXAiICkgKSApIHsKCgkJCQkJCS8vIEdldCB0aGUgc3BlY2lmaWMgdmFsdWUgZm9yIHRoZSBvcHRpb24KCQkJCQkJdmFsdWUgPSBqUXVlcnkoIG9wdGlvbiApLnZhbCgpOwoKCQkJCQkJLy8gV2UgZG9uJ3QgbmVlZCBhbiBhcnJheSBmb3Igb25lIHNlbGVjdHMKCQkJCQkJaWYgKCBvbmUgKSB7CgkJCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQkJCX0KCgkJCQkJCS8vIE11bHRpLVNlbGVjdHMgcmV0dXJuIGFuIGFycmF5CgkJCQkJCXZhbHVlcy5wdXNoKCB2YWx1ZSApOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gdmFsdWVzOwoJCQl9LAoKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQl2YXIgb3B0aW9uU2V0LCBvcHRpb24sCgkJCQkJb3B0aW9ucyA9IGVsZW0ub3B0aW9ucywKCQkJCQl2YWx1ZXMgPSBqUXVlcnkubWFrZUFycmF5KCB2YWx1ZSApLAoJCQkJCWkgPSBvcHRpb25zLmxlbmd0aDsKCgkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQlvcHRpb24gPSBvcHRpb25zWyBpIF07CgoJCQkJCWlmICggalF1ZXJ5LmluQXJyYXkoIGpRdWVyeS52YWxIb29rcy5vcHRpb24uZ2V0KCBvcHRpb24gKSwgdmFsdWVzICkgPiAtMSApIHsKCgkJCQkJCS8vIFN1cHBvcnQ6IElFNgoJCQkJCQkvLyBXaGVuIG5ldyBvcHRpb24gZWxlbWVudCBpcyBhZGRlZCB0byBzZWxlY3QgYm94IHdlIG5lZWQgdG8KCQkJCQkJLy8gZm9yY2UgcmVmbG93IG9mIG5ld2x5IGFkZGVkIG5vZGUgaW4gb3JkZXIgdG8gd29ya2Fyb3VuZCBkZWxheQoJCQkJCQkvLyBvZiBpbml0aWFsaXphdGlvbiBwcm9wZXJ0aWVzCgkJCQkJCXRyeSB7CgkJCQkJCQlvcHRpb24uc2VsZWN0ZWQgPSBvcHRpb25TZXQgPSB0cnVlOwoKCQkJCQkJfSBjYXRjaCAoIF8gKSB7CgoJCQkJCQkJLy8gV2lsbCBiZSBleGVjdXRlZCBvbmx5IGluIElFNgoJCQkJCQkJb3B0aW9uLnNjcm9sbEhlaWdodDsKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoJCQkJCQlvcHRpb24uc2VsZWN0ZWQgPSBmYWxzZTsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gRm9yY2UgYnJvd3NlcnMgdG8gYmVoYXZlIGNvbnNpc3RlbnRseSB3aGVuIG5vbi1tYXRjaGluZyB2YWx1ZSBpcyBzZXQKCQkJCWlmICggIW9wdGlvblNldCApIHsKCQkJCQllbGVtLnNlbGVjdGVkSW5kZXggPSAtMTsKCQkJCX0KCgkJCQlyZXR1cm4gb3B0aW9uczsKCQkJfQoJCX0KCX0KfSApOwoKLy8gUmFkaW9zIGFuZCBjaGVja2JveGVzIGdldHRlci9zZXR0ZXIKalF1ZXJ5LmVhY2goIFsgInJhZGlvIiwgImNoZWNrYm94IiBdLCBmdW5jdGlvbigpIHsKCWpRdWVyeS52YWxIb29rc1sgdGhpcyBdID0gewoJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQlpZiAoIGpRdWVyeS5pc0FycmF5KCB2YWx1ZSApICkgewoJCQkJcmV0dXJuICggZWxlbS5jaGVja2VkID0galF1ZXJ5LmluQXJyYXkoIGpRdWVyeSggZWxlbSApLnZhbCgpLCB2YWx1ZSApID4gLTEgKTsKCQkJfQoJCX0KCX07CglpZiAoICFzdXBwb3J0LmNoZWNrT24gKSB7CgkJalF1ZXJ5LnZhbEhvb2tzWyB0aGlzIF0uZ2V0ID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggInZhbHVlIiApID09PSBudWxsID8gIm9uIiA6IGVsZW0udmFsdWU7CgkJfTsKCX0KfSApOwoKCgoKdmFyIG5vZGVIb29rLCBib29sSG9vaywKCWF0dHJIYW5kbGUgPSBqUXVlcnkuZXhwci5hdHRySGFuZGxlLAoJcnVzZURlZmF1bHQgPSAvXig/OmNoZWNrZWR8c2VsZWN0ZWQpJC9pLAoJZ2V0U2V0QXR0cmlidXRlID0gc3VwcG9ydC5nZXRTZXRBdHRyaWJ1dGUsCglnZXRTZXRJbnB1dCA9IHN1cHBvcnQuaW5wdXQ7CgpqUXVlcnkuZm4uZXh0ZW5kKCB7CglhdHRyOiBmdW5jdGlvbiggbmFtZSwgdmFsdWUgKSB7CgkJcmV0dXJuIGFjY2VzcyggdGhpcywgalF1ZXJ5LmF0dHIsIG5hbWUsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMSApOwoJfSwKCglyZW1vdmVBdHRyOiBmdW5jdGlvbiggbmFtZSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbigpIHsKCQkJalF1ZXJ5LnJlbW92ZUF0dHIoIHRoaXMsIG5hbWUgKTsKCQl9ICk7Cgl9Cn0gKTsKCmpRdWVyeS5leHRlbmQoIHsKCWF0dHI6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCB2YWx1ZSApIHsKCQl2YXIgcmV0LCBob29rcywKCQkJblR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCQkvLyBEb24ndCBnZXQvc2V0IGF0dHJpYnV0ZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzCgkJaWYgKCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gRmFsbGJhY2sgdG8gcHJvcCB3aGVuIGF0dHJpYnV0ZXMgYXJlIG5vdCBzdXBwb3J0ZWQKCQlpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSA9PT0gInVuZGVmaW5lZCIgKSB7CgkJCXJldHVybiBqUXVlcnkucHJvcCggZWxlbSwgbmFtZSwgdmFsdWUgKTsKCQl9CgoJCS8vIEFsbCBhdHRyaWJ1dGVzIGFyZSBsb3dlcmNhc2UKCQkvLyBHcmFiIG5lY2Vzc2FyeSBob29rIGlmIG9uZSBpcyBkZWZpbmVkCgkJaWYgKCBuVHlwZSAhPT0gMSB8fCAhalF1ZXJ5LmlzWE1MRG9jKCBlbGVtICkgKSB7CgkJCW5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CgkJCWhvb2tzID0galF1ZXJ5LmF0dHJIb29rc1sgbmFtZSBdIHx8CgkJCQkoIGpRdWVyeS5leHByLm1hdGNoLmJvb2wudGVzdCggbmFtZSApID8gYm9vbEhvb2sgOiBub2RlSG9vayApOwoJCX0KCgkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQlpZiAoIHZhbHVlID09PSBudWxsICkgewoJCQkJalF1ZXJ5LnJlbW92ZUF0dHIoIGVsZW0sIG5hbWUgKTsKCQkJCXJldHVybjsKCQkJfQoKCQkJaWYgKCBob29rcyAmJiAic2V0IiBpbiBob29rcyAmJgoJCQkJKCByZXQgPSBob29rcy5zZXQoIGVsZW0sIHZhbHVlLCBuYW1lICkgKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIHJldDsKCQkJfQoKCQkJZWxlbS5zZXRBdHRyaWJ1dGUoIG5hbWUsIHZhbHVlICsgIiIgKTsKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCgkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAoIHJldCA9IGhvb2tzLmdldCggZWxlbSwgbmFtZSApICkgIT09IG51bGwgKSB7CgkJCXJldHVybiByZXQ7CgkJfQoKCQlyZXQgPSBqUXVlcnkuZmluZC5hdHRyKCBlbGVtLCBuYW1lICk7CgoJCS8vIE5vbi1leGlzdGVudCBhdHRyaWJ1dGVzIHJldHVybiBudWxsLCB3ZSBub3JtYWxpemUgdG8gdW5kZWZpbmVkCgkJcmV0dXJuIHJldCA9PSBudWxsID8gdW5kZWZpbmVkIDogcmV0OwoJfSwKCglhdHRySG9va3M6IHsKCQl0eXBlOiB7CgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQkJaWYgKCAhc3VwcG9ydC5yYWRpb1ZhbHVlICYmIHZhbHVlID09PSAicmFkaW8iICYmCgkJCQkJalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCAiaW5wdXQiICkgKSB7CgoJCQkJCS8vIFNldHRpbmcgdGhlIHR5cGUgb24gYSByYWRpbyBidXR0b24gYWZ0ZXIgdGhlIHZhbHVlIHJlc2V0cyB0aGUgdmFsdWUgaW4gSUU4LTkKCQkJCQkvLyBSZXNldCB2YWx1ZSB0byBkZWZhdWx0IGluIGNhc2UgdHlwZSBpcyBzZXQgYWZ0ZXIgdmFsdWUgZHVyaW5nIGNyZWF0aW9uCgkJCQkJdmFyIHZhbCA9IGVsZW0udmFsdWU7CgkJCQkJZWxlbS5zZXRBdHRyaWJ1dGUoICJ0eXBlIiwgdmFsdWUgKTsKCQkJCQlpZiAoIHZhbCApIHsKCQkJCQkJZWxlbS52YWx1ZSA9IHZhbDsKCQkJCQl9CgkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJfQoJCQl9CgkJfQoJfSwKCglyZW1vdmVBdHRyOiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJdmFyIG5hbWUsIHByb3BOYW1lLAoJCQlpID0gMCwKCQkJYXR0ck5hbWVzID0gdmFsdWUgJiYgdmFsdWUubWF0Y2goIHJub3R3aGl0ZSApOwoKCQlpZiAoIGF0dHJOYW1lcyAmJiBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQl3aGlsZSAoICggbmFtZSA9IGF0dHJOYW1lc1sgaSsrIF0gKSApIHsKCQkJCXByb3BOYW1lID0galF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lOwoKCQkJCS8vIEJvb2xlYW4gYXR0cmlidXRlcyBnZXQgc3BlY2lhbCB0cmVhdG1lbnQgKCMxMDg3MCkKCQkJCWlmICggalF1ZXJ5LmV4cHIubWF0Y2guYm9vbC50ZXN0KCBuYW1lICkgKSB7CgoJCQkJCS8vIFNldCBjb3JyZXNwb25kaW5nIHByb3BlcnR5IHRvIGZhbHNlCgkJCQkJaWYgKCBnZXRTZXRJbnB1dCAmJiBnZXRTZXRBdHRyaWJ1dGUgfHwgIXJ1c2VEZWZhdWx0LnRlc3QoIG5hbWUgKSApIHsKCQkJCQkJZWxlbVsgcHJvcE5hbWUgXSA9IGZhbHNlOwoKCQkJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCQkJLy8gQWxzbyBjbGVhciBkZWZhdWx0Q2hlY2tlZC9kZWZhdWx0U2VsZWN0ZWQgKGlmIGFwcHJvcHJpYXRlKQoJCQkJCX0gZWxzZSB7CgkJCQkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA9CgkJCQkJCQllbGVtWyBwcm9wTmFtZSBdID0gZmFsc2U7CgkJCQkJfQoKCQkJCS8vIFNlZSAjOTY5OSBmb3IgZXhwbGFuYXRpb24gb2YgdGhpcyBhcHByb2FjaCAoc2V0dGluZyBmaXJzdCwgdGhlbiByZW1vdmFsKQoJCQkJfSBlbHNlIHsKCQkJCQlqUXVlcnkuYXR0ciggZWxlbSwgbmFtZSwgIiIgKTsKCQkJCX0KCgkJCQllbGVtLnJlbW92ZUF0dHJpYnV0ZSggZ2V0U2V0QXR0cmlidXRlID8gbmFtZSA6IHByb3BOYW1lICk7CgkJCX0KCQl9Cgl9Cn0gKTsKCi8vIEhvb2tzIGZvciBib29sZWFuIGF0dHJpYnV0ZXMKYm9vbEhvb2sgPSB7CglzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCgkJCS8vIFJlbW92ZSBib29sZWFuIGF0dHJpYnV0ZXMgd2hlbiBzZXQgdG8gZmFsc2UKCQkJalF1ZXJ5LnJlbW92ZUF0dHIoIGVsZW0sIG5hbWUgKTsKCQl9IGVsc2UgaWYgKCBnZXRTZXRJbnB1dCAmJiBnZXRTZXRBdHRyaWJ1dGUgfHwgIXJ1c2VEZWZhdWx0LnRlc3QoIG5hbWUgKSApIHsKCgkJCS8vIElFPDggbmVlZHMgdGhlICpwcm9wZXJ0eSogbmFtZQoJCQllbGVtLnNldEF0dHJpYnV0ZSggIWdldFNldEF0dHJpYnV0ZSAmJiBqUXVlcnkucHJvcEZpeFsgbmFtZSBdIHx8IG5hbWUsIG5hbWUgKTsKCgkJfSBlbHNlIHsKCgkJCS8vIFN1cHBvcnQ6IElFPDkKCQkJLy8gVXNlIGRlZmF1bHRDaGVja2VkIGFuZCBkZWZhdWx0U2VsZWN0ZWQgZm9yIG9sZElFCgkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA9IGVsZW1bIG5hbWUgXSA9IHRydWU7CgkJfQoJCXJldHVybiBuYW1lOwoJfQp9OwoKalF1ZXJ5LmVhY2goIGpRdWVyeS5leHByLm1hdGNoLmJvb2wuc291cmNlLm1hdGNoKCAvXHcrL2cgKSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7Cgl2YXIgZ2V0dGVyID0gYXR0ckhhbmRsZVsgbmFtZSBdIHx8IGpRdWVyeS5maW5kLmF0dHI7CgoJaWYgKCBnZXRTZXRJbnB1dCAmJiBnZXRTZXRBdHRyaWJ1dGUgfHwgIXJ1c2VEZWZhdWx0LnRlc3QoIG5hbWUgKSApIHsKCQlhdHRySGFuZGxlWyBuYW1lIF0gPSBmdW5jdGlvbiggZWxlbSwgbmFtZSwgaXNYTUwgKSB7CgkJCXZhciByZXQsIGhhbmRsZTsKCQkJaWYgKCAhaXNYTUwgKSB7CgoJCQkJLy8gQXZvaWQgYW4gaW5maW5pdGUgbG9vcCBieSB0ZW1wb3JhcmlseSByZW1vdmluZyB0aGlzIGZ1bmN0aW9uIGZyb20gdGhlIGdldHRlcgoJCQkJaGFuZGxlID0gYXR0ckhhbmRsZVsgbmFtZSBdOwoJCQkJYXR0ckhhbmRsZVsgbmFtZSBdID0gcmV0OwoJCQkJcmV0ID0gZ2V0dGVyKCBlbGVtLCBuYW1lLCBpc1hNTCApICE9IG51bGwgPwoJCQkJCW5hbWUudG9Mb3dlckNhc2UoKSA6CgkJCQkJbnVsbDsKCQkJCWF0dHJIYW5kbGVbIG5hbWUgXSA9IGhhbmRsZTsKCQkJfQoJCQlyZXR1cm4gcmV0OwoJCX07Cgl9IGVsc2UgewoJCWF0dHJIYW5kbGVbIG5hbWUgXSA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBpc1hNTCApIHsKCQkJaWYgKCAhaXNYTUwgKSB7CgkJCQlyZXR1cm4gZWxlbVsgalF1ZXJ5LmNhbWVsQ2FzZSggImRlZmF1bHQtIiArIG5hbWUgKSBdID8KCQkJCQluYW1lLnRvTG93ZXJDYXNlKCkgOgoJCQkJCW51bGw7CgkJCX0KCQl9OwoJfQp9ICk7CgovLyBmaXggb2xkSUUgYXR0cm9wZXJ0aWVzCmlmICggIWdldFNldElucHV0IHx8ICFnZXRTZXRBdHRyaWJ1dGUgKSB7CglqUXVlcnkuYXR0ckhvb2tzLnZhbHVlID0gewoJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlLCBuYW1lICkgewoJCQlpZiAoIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImlucHV0IiApICkgewoKCQkJCS8vIERvZXMgbm90IHJldHVybiBzbyB0aGF0IHNldEF0dHJpYnV0ZSBpcyBhbHNvIHVzZWQKCQkJCWVsZW0uZGVmYXVsdFZhbHVlID0gdmFsdWU7CgkJCX0gZWxzZSB7CgoJCQkJLy8gVXNlIG5vZGVIb29rIGlmIGRlZmluZWQgKCMxOTU0KTsgb3RoZXJ3aXNlIHNldEF0dHJpYnV0ZSBpcyBmaW5lCgkJCQlyZXR1cm4gbm9kZUhvb2sgJiYgbm9kZUhvb2suc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApOwoJCQl9CgkJfQoJfTsKfQoKLy8gSUU2LzcgZG8gbm90IHN1cHBvcnQgZ2V0dGluZy9zZXR0aW5nIHNvbWUgYXR0cmlidXRlcyB3aXRoIGdldC9zZXRBdHRyaWJ1dGUKaWYgKCAhZ2V0U2V0QXR0cmlidXRlICkgewoKCS8vIFVzZSB0aGlzIGZvciBhbnkgYXR0cmlidXRlIGluIElFNi83CgkvLyBUaGlzIGZpeGVzIGFsbW9zdCBldmVyeSBJRTYvNyBpc3N1ZQoJbm9kZUhvb2sgPSB7CgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIG5hbWUgKSB7CgoJCQkvLyBTZXQgdGhlIGV4aXN0aW5nIG9yIGNyZWF0ZSBhIG5ldyBhdHRyaWJ1dGUgbm9kZQoJCQl2YXIgcmV0ID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICk7CgkJCWlmICggIXJldCApIHsKCQkJCWVsZW0uc2V0QXR0cmlidXRlTm9kZSgKCQkJCQkoIHJldCA9IGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoIG5hbWUgKSApCgkJCQkpOwoJCQl9CgoJCQlyZXQudmFsdWUgPSB2YWx1ZSArPSAiIjsKCgkJCS8vIEJyZWFrIGFzc29jaWF0aW9uIHdpdGggY2xvbmVkIGVsZW1lbnRzIGJ5IGFsc28gdXNpbmcgc2V0QXR0cmlidXRlICgjOTY0NikKCQkJaWYgKCBuYW1lID09PSAidmFsdWUiIHx8IHZhbHVlID09PSBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApICkgewoJCQkJcmV0dXJuIHZhbHVlOwoJCQl9CgkJfQoJfTsKCgkvLyBTb21lIGF0dHJpYnV0ZXMgYXJlIGNvbnN0cnVjdGVkIHdpdGggZW1wdHktc3RyaW5nIHZhbHVlcyB3aGVuIG5vdCBkZWZpbmVkCglhdHRySGFuZGxlLmlkID0gYXR0ckhhbmRsZS5uYW1lID0gYXR0ckhhbmRsZS5jb29yZHMgPQoJCWZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBpc1hNTCApIHsKCQkJdmFyIHJldDsKCQkJaWYgKCAhaXNYTUwgKSB7CgkJCQlyZXR1cm4gKCByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKSApICYmIHJldC52YWx1ZSAhPT0gIiIgPwoJCQkJCXJldC52YWx1ZSA6CgkJCQkJbnVsbDsKCQkJfQoJCX07CgoJLy8gRml4aW5nIHZhbHVlIHJldHJpZXZhbCBvbiBhIGJ1dHRvbiByZXF1aXJlcyB0aGlzIG1vZHVsZQoJalF1ZXJ5LnZhbEhvb2tzLmJ1dHRvbiA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJCQl2YXIgcmV0ID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICk7CgkJCWlmICggcmV0ICYmIHJldC5zcGVjaWZpZWQgKSB7CgkJCQlyZXR1cm4gcmV0LnZhbHVlOwoJCQl9CgkJfSwKCQlzZXQ6IG5vZGVIb29rLnNldAoJfTsKCgkvLyBTZXQgY29udGVudGVkaXRhYmxlIHRvIGZhbHNlIG9uIHJlbW92YWxzKCMxMDQyOSkKCS8vIFNldHRpbmcgdG8gZW1wdHkgc3RyaW5nIHRocm93cyBhbiBlcnJvciBhcyBhbiBpbnZhbGlkIHZhbHVlCglqUXVlcnkuYXR0ckhvb2tzLmNvbnRlbnRlZGl0YWJsZSA9IHsKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJbm9kZUhvb2suc2V0KCBlbGVtLCB2YWx1ZSA9PT0gIiIgPyBmYWxzZSA6IHZhbHVlLCBuYW1lICk7CgkJfQoJfTsKCgkvLyBTZXQgd2lkdGggYW5kIGhlaWdodCB0byBhdXRvIGluc3RlYWQgb2YgMCBvbiBlbXB0eSBzdHJpbmcoIEJ1ZyAjODE1MCApCgkvLyBUaGlzIGlzIGZvciByZW1vdmFscwoJalF1ZXJ5LmVhY2goIFsgIndpZHRoIiwgImhlaWdodCIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7CgkJalF1ZXJ5LmF0dHJIb29rc1sgbmFtZSBdID0gewoJCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJCWlmICggdmFsdWUgPT09ICIiICkgewoJCQkJCWVsZW0uc2V0QXR0cmlidXRlKCBuYW1lLCAiYXV0byIgKTsKCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQl9CgkJCX0KCQl9OwoJfSApOwp9CgppZiAoICFzdXBwb3J0LnN0eWxlICkgewoJalF1ZXJ5LmF0dHJIb29rcy5zdHlsZSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoKCQkJLy8gUmV0dXJuIHVuZGVmaW5lZCBpbiB0aGUgY2FzZSBvZiBlbXB0eSBzdHJpbmcKCQkJLy8gTm90ZTogSUUgdXBwZXJjYXNlcyBjc3MgcHJvcGVydHkgbmFtZXMsIGJ1dCBpZiB3ZSB3ZXJlIHRvIC50b0xvd2VyQ2FzZSgpCgkJCS8vIC5jc3NUZXh0LCB0aGF0IHdvdWxkIGRlc3Ryb3kgY2FzZSBzZW5zaXRpdml0eSBpbiBVUkwncywgbGlrZSBpbiAiYmFja2dyb3VuZCIKCQkJcmV0dXJuIGVsZW0uc3R5bGUuY3NzVGV4dCB8fCB1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJcmV0dXJuICggZWxlbS5zdHlsZS5jc3NUZXh0ID0gdmFsdWUgKyAiIiApOwoJCX0KCX07Cn0KCgoKCnZhciByZm9jdXNhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdCkkL2ksCglyY2xpY2thYmxlID0gL14oPzphfGFyZWEpJC9pOwoKalF1ZXJ5LmZuLmV4dGVuZCggewoJcHJvcDogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGpRdWVyeS5wcm9wLCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsKCX0sCgoJcmVtb3ZlUHJvcDogZnVuY3Rpb24oIG5hbWUgKSB7CgkJbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCQlyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbigpIHsKCgkJCS8vIHRyeS9jYXRjaCBoYW5kbGVzIGNhc2VzIHdoZXJlIElFIGJhbGtzIChzdWNoIGFzIHJlbW92aW5nIGEgcHJvcGVydHkgb24gd2luZG93KQoJCQl0cnkgewoJCQkJdGhpc1sgbmFtZSBdID0gdW5kZWZpbmVkOwoJCQkJZGVsZXRlIHRoaXNbIG5hbWUgXTsKCQkJfSBjYXRjaCAoIGUgKSB7fQoJCX0gKTsKCX0KfSApOwoKalF1ZXJ5LmV4dGVuZCggewoJcHJvcDogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCXZhciByZXQsIGhvb2tzLAoJCQluVHlwZSA9IGVsZW0ubm9kZVR5cGU7CgoJCS8vIERvbid0IGdldC9zZXQgcHJvcGVydGllcyBvbiB0ZXh0LCBjb21tZW50IGFuZCBhdHRyaWJ1dGUgbm9kZXMKCQlpZiAoIG5UeXBlID09PSAzIHx8IG5UeXBlID09PSA4IHx8IG5UeXBlID09PSAyICkgewoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKSApIHsKCgkJCS8vIEZpeCBuYW1lIGFuZCBhdHRhY2ggaG9va3MKCQkJbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCQkJaG9va3MgPSBqUXVlcnkucHJvcEhvb2tzWyBuYW1lIF07CgkJfQoKCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJCWlmICggaG9va3MgJiYgInNldCIgaW4gaG9va3MgJiYKCQkJCSggcmV0ID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApICkgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiByZXQ7CgkJCX0KCgkJCXJldHVybiAoIGVsZW1bIG5hbWUgXSA9IHZhbHVlICk7CgkJfQoKCQlpZiAoIGhvb2tzICYmICJnZXQiIGluIGhvb2tzICYmICggcmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkgKSAhPT0gbnVsbCApIHsKCQkJcmV0dXJuIHJldDsKCQl9CgoJCXJldHVybiBlbGVtWyBuYW1lIF07Cgl9LAoKCXByb3BIb29rczogewoJCXRhYkluZGV4OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgoJCQkJLy8gZWxlbS50YWJJbmRleCBkb2Vzbid0IGFsd2F5cyByZXR1cm4gdGhlCgkJCQkvLyBjb3JyZWN0IHZhbHVlIHdoZW4gaXQgaGFzbid0IGJlZW4gZXhwbGljaXRseSBzZXQKCQkJCS8vIGh0dHA6Ly9mbHVpZHByb2plY3Qub3JnL2Jsb2cvMjAwOC8wMS8wOS9nZXR0aW5nLXNldHRpbmctYW5kLXJlbW92aW5nLXRhYmluZGV4LXZhbHVlcy13aXRoLWphdmFzY3JpcHQvCgkJCQkvLyBVc2UgcHJvcGVyIGF0dHJpYnV0ZSByZXRyaWV2YWwoIzEyMDcyKQoJCQkJdmFyIHRhYmluZGV4ID0galF1ZXJ5LmZpbmQuYXR0ciggZWxlbSwgInRhYmluZGV4IiApOwoKCQkJCXJldHVybiB0YWJpbmRleCA/CgkJCQkJcGFyc2VJbnQoIHRhYmluZGV4LCAxMCApIDoKCQkJCQlyZm9jdXNhYmxlLnRlc3QoIGVsZW0ubm9kZU5hbWUgKSB8fAoJCQkJCQlyY2xpY2thYmxlLnRlc3QoIGVsZW0ubm9kZU5hbWUgKSAmJiBlbGVtLmhyZWYgPwoJCQkJCQkJMCA6CgkJCQkJCQktMTsKCQkJfQoJCX0KCX0sCgoJcHJvcEZpeDogewoJCSJmb3IiOiAiaHRtbEZvciIsCgkJImNsYXNzIjogImNsYXNzTmFtZSIKCX0KfSApOwoKLy8gU29tZSBhdHRyaWJ1dGVzIHJlcXVpcmUgYSBzcGVjaWFsIGNhbGwgb24gSUUKLy8gaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L21zNTM2NDI5JTI4VlMuODUlMjkuYXNweAppZiAoICFzdXBwb3J0LmhyZWZOb3JtYWxpemVkICkgewoKCS8vIGhyZWYvc3JjIHByb3BlcnR5IHNob3VsZCBnZXQgdGhlIGZ1bGwgbm9ybWFsaXplZCBVUkwgKCMxMDI5OS8jMTI5MTUpCglqUXVlcnkuZWFjaCggWyAiaHJlZiIsICJzcmMiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJCWpRdWVyeS5wcm9wSG9va3NbIG5hbWUgXSA9IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSwgNCApOwoJCQl9CgkJfTsKCX0gKTsKfQoKLy8gU3VwcG9ydDogU2FmYXJpLCBJRTkrCi8vIEFjY2Vzc2luZyB0aGUgc2VsZWN0ZWRJbmRleCBwcm9wZXJ0eQovLyBmb3JjZXMgdGhlIGJyb3dzZXIgdG8gcmVzcGVjdCBzZXR0aW5nIHNlbGVjdGVkCi8vIG9uIHRoZSBvcHRpb24KLy8gVGhlIGdldHRlciBlbnN1cmVzIGEgZGVmYXVsdCBvcHRpb24gaXMgc2VsZWN0ZWQKLy8gd2hlbiBpbiBhbiBvcHRncm91cAppZiAoICFzdXBwb3J0Lm9wdFNlbGVjdGVkICkgewoJalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwoKCQkJaWYgKCBwYXJlbnQgKSB7CgkJCQlwYXJlbnQuc2VsZWN0ZWRJbmRleDsKCgkJCQkvLyBNYWtlIHN1cmUgdGhhdCBpdCBhbHNvIHdvcmtzIHdpdGggb3B0Z3JvdXBzLCBzZWUgIzU3MDEKCQkJCWlmICggcGFyZW50LnBhcmVudE5vZGUgKSB7CgkJCQkJcGFyZW50LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9LAoJCXNldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXZhciBwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGU7CgkJCWlmICggcGFyZW50ICkgewoJCQkJcGFyZW50LnNlbGVjdGVkSW5kZXg7CgoJCQkJaWYgKCBwYXJlbnQucGFyZW50Tm9kZSApIHsKCQkJCQlwYXJlbnQucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4OwoJCQkJfQoJCQl9CgkJfQoJfTsKfQoKalF1ZXJ5LmVhY2goIFsKCSJ0YWJJbmRleCIsCgkicmVhZE9ubHkiLAoJIm1heExlbmd0aCIsCgkiY2VsbFNwYWNpbmciLAoJImNlbGxQYWRkaW5nIiwKCSJyb3dTcGFuIiwKCSJjb2xTcGFuIiwKCSJ1c2VNYXAiLAoJImZyYW1lQm9yZGVyIiwKCSJjb250ZW50RWRpdGFibGUiCl0sIGZ1bmN0aW9uKCkgewoJalF1ZXJ5LnByb3BGaXhbIHRoaXMudG9Mb3dlckNhc2UoKSBdID0gdGhpczsKfSApOwoKLy8gSUU2LzcgY2FsbCBlbmN0eXBlIGVuY29kaW5nCmlmICggIXN1cHBvcnQuZW5jdHlwZSApIHsKCWpRdWVyeS5wcm9wRml4LmVuY3R5cGUgPSAiZW5jb2RpbmciOwp9CgoKCgp2YXIgcmNsYXNzID0gL1tcdFxyXG5cZl0vZzsKCmZ1bmN0aW9uIGdldENsYXNzKCBlbGVtICkgewoJcmV0dXJuIGpRdWVyeS5hdHRyKCBlbGVtLCAiY2xhc3MiICkgfHwgIiI7Cn0KCmpRdWVyeS5mbi5leHRlbmQoIHsKCWFkZENsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdmFyIGNsYXNzZXMsIGVsZW0sIGN1ciwgY3VyVmFsdWUsIGNsYXp6LCBqLCBmaW5hbFZhbHVlLAoJCQlpID0gMDsKCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHsKCQkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oIGogKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS5hZGRDbGFzcyggdmFsdWUuY2FsbCggdGhpcywgaiwgZ2V0Q2xhc3MoIHRoaXMgKSApICk7CgkJCX0gKTsKCQl9CgoJCWlmICggdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZSApIHsKCQkJY2xhc3NlcyA9IHZhbHVlLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbXTsKCgkJCXdoaWxlICggKCBlbGVtID0gdGhpc1sgaSsrIF0gKSApIHsKCQkJCWN1clZhbHVlID0gZ2V0Q2xhc3MoIGVsZW0gKTsKCQkJCWN1ciA9IGVsZW0ubm9kZVR5cGUgPT09IDEgJiYKCQkJCQkoICIgIiArIGN1clZhbHVlICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKTsKCgkJCQlpZiAoIGN1ciApIHsKCQkJCQlqID0gMDsKCQkJCQl3aGlsZSAoICggY2xhenogPSBjbGFzc2VzWyBqKysgXSApICkgewoJCQkJCQlpZiAoIGN1ci5pbmRleE9mKCAiICIgKyBjbGF6eiArICIgIiApIDwgMCApIHsKCQkJCQkJCWN1ciArPSBjbGF6eiArICIgIjsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJLy8gb25seSBhc3NpZ24gaWYgZGlmZmVyZW50IHRvIGF2b2lkIHVubmVlZGVkIHJlbmRlcmluZy4KCQkJCQlmaW5hbFZhbHVlID0galF1ZXJ5LnRyaW0oIGN1ciApOwoJCQkJCWlmICggY3VyVmFsdWUgIT09IGZpbmFsVmFsdWUgKSB7CgkJCQkJCWpRdWVyeS5hdHRyKCBlbGVtLCAiY2xhc3MiLCBmaW5hbFZhbHVlICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgY2xhc3NlcywgZWxlbSwgY3VyLCBjdXJWYWx1ZSwgY2xhenosIGosIGZpbmFsVmFsdWUsCgkJCWkgPSAwOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbiggaiApIHsKCQkJCWpRdWVyeSggdGhpcyApLnJlbW92ZUNsYXNzKCB2YWx1ZS5jYWxsKCB0aGlzLCBqLCBnZXRDbGFzcyggdGhpcyApICkgKTsKCQkJfSApOwoJCX0KCgkJaWYgKCAhYXJndW1lbnRzLmxlbmd0aCApIHsKCQkJcmV0dXJuIHRoaXMuYXR0ciggImNsYXNzIiwgIiIgKTsKCQl9CgoJCWlmICggdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZSApIHsKCQkJY2xhc3NlcyA9IHZhbHVlLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbXTsKCgkJCXdoaWxlICggKCBlbGVtID0gdGhpc1sgaSsrIF0gKSApIHsKCQkJCWN1clZhbHVlID0gZ2V0Q2xhc3MoIGVsZW0gKTsKCgkJCQkvLyBUaGlzIGV4cHJlc3Npb24gaXMgaGVyZSBmb3IgYmV0dGVyIGNvbXByZXNzaWJpbGl0eSAoc2VlIGFkZENsYXNzKQoJCQkJY3VyID0gZWxlbS5ub2RlVHlwZSA9PT0gMSAmJgoJCQkJCSggIiAiICsgY3VyVmFsdWUgKyAiICIgKS5yZXBsYWNlKCByY2xhc3MsICIgIiApOwoKCQkJCWlmICggY3VyICkgewoJCQkJCWogPSAwOwoJCQkJCXdoaWxlICggKCBjbGF6eiA9IGNsYXNzZXNbIGorKyBdICkgKSB7CgoJCQkJCQkvLyBSZW1vdmUgKmFsbCogaW5zdGFuY2VzCgkJCQkJCXdoaWxlICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPiAtMSApIHsKCQkJCQkJCWN1ciA9IGN1ci5yZXBsYWNlKCAiICIgKyBjbGF6eiArICIgIiwgIiAiICk7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIE9ubHkgYXNzaWduIGlmIGRpZmZlcmVudCB0byBhdm9pZCB1bm5lZWRlZCByZW5kZXJpbmcuCgkJCQkJZmluYWxWYWx1ZSA9IGpRdWVyeS50cmltKCBjdXIgKTsKCQkJCQlpZiAoIGN1clZhbHVlICE9PSBmaW5hbFZhbHVlICkgewoJCQkJCQlqUXVlcnkuYXR0ciggZWxlbSwgImNsYXNzIiwgZmluYWxWYWx1ZSApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXRvZ2dsZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUsIHN0YXRlVmFsICkgewoJCXZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQlpZiAoIHR5cGVvZiBzdGF0ZVZhbCA9PT0gImJvb2xlYW4iICYmIHR5cGUgPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gc3RhdGVWYWwgPyB0aGlzLmFkZENsYXNzKCB2YWx1ZSApIDogdGhpcy5yZW1vdmVDbGFzcyggdmFsdWUgKTsKCQl9CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCBpICkgewoJCQkJalF1ZXJ5KCB0aGlzICkudG9nZ2xlQ2xhc3MoCgkJCQkJdmFsdWUuY2FsbCggdGhpcywgaSwgZ2V0Q2xhc3MoIHRoaXMgKSwgc3RhdGVWYWwgKSwKCQkJCQlzdGF0ZVZhbAoJCQkJKTsKCQkJfSApOwoJCX0KCgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCXZhciBjbGFzc05hbWUsIGksIHNlbGYsIGNsYXNzTmFtZXM7CgoJCQlpZiAoIHR5cGUgPT09ICJzdHJpbmciICkgewoKCQkJCS8vIFRvZ2dsZSBpbmRpdmlkdWFsIGNsYXNzIG5hbWVzCgkJCQlpID0gMDsKCQkJCXNlbGYgPSBqUXVlcnkoIHRoaXMgKTsKCQkJCWNsYXNzTmFtZXMgPSB2YWx1ZS5tYXRjaCggcm5vdHdoaXRlICkgfHwgW107CgoJCQkJd2hpbGUgKCAoIGNsYXNzTmFtZSA9IGNsYXNzTmFtZXNbIGkrKyBdICkgKSB7CgoJCQkJCS8vIENoZWNrIGVhY2ggY2xhc3NOYW1lIGdpdmVuLCBzcGFjZSBzZXBhcmF0ZWQgbGlzdAoJCQkJCWlmICggc2VsZi5oYXNDbGFzcyggY2xhc3NOYW1lICkgKSB7CgkJCQkJCXNlbGYucmVtb3ZlQ2xhc3MoIGNsYXNzTmFtZSApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXNlbGYuYWRkQ2xhc3MoIGNsYXNzTmFtZSApOwoJCQkJCX0KCQkJCX0KCgkJCS8vIFRvZ2dsZSB3aG9sZSBjbGFzcyBuYW1lCgkJCX0gZWxzZSBpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgfHwgdHlwZSA9PT0gImJvb2xlYW4iICkgewoJCQkJY2xhc3NOYW1lID0gZ2V0Q2xhc3MoIHRoaXMgKTsKCQkJCWlmICggY2xhc3NOYW1lICkgewoKCQkJCQkvLyBzdG9yZSBjbGFzc05hbWUgaWYgc2V0CgkJCQkJalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiX19jbGFzc05hbWVfXyIsIGNsYXNzTmFtZSApOwoJCQkJfQoKCQkJCS8vIElmIHRoZSBlbGVtZW50IGhhcyBhIGNsYXNzIG5hbWUgb3IgaWYgd2UncmUgcGFzc2VkICJmYWxzZSIsCgkJCQkvLyB0aGVuIHJlbW92ZSB0aGUgd2hvbGUgY2xhc3NuYW1lIChpZiB0aGVyZSB3YXMgb25lLCB0aGUgYWJvdmUgc2F2ZWQgaXQpLgoJCQkJLy8gT3RoZXJ3aXNlIGJyaW5nIGJhY2sgd2hhdGV2ZXIgd2FzIHByZXZpb3VzbHkgc2F2ZWQgKGlmIGFueXRoaW5nKSwKCQkJCS8vIGZhbGxpbmcgYmFjayB0byB0aGUgZW1wdHkgc3RyaW5nIGlmIG5vdGhpbmcgd2FzIHN0b3JlZC4KCQkJCWpRdWVyeS5hdHRyKCB0aGlzLCAiY2xhc3MiLAoJCQkJCWNsYXNzTmFtZSB8fCB2YWx1ZSA9PT0gZmFsc2UgPwoJCQkJCSIiIDoKCQkJCQlqUXVlcnkuX2RhdGEoIHRoaXMsICJfX2NsYXNzTmFtZV9fIiApIHx8ICIiCgkJCQkpOwoJCQl9CgkJfSApOwoJfSwKCgloYXNDbGFzczogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXZhciBjbGFzc05hbWUsIGVsZW0sCgkJCWkgPSAwOwoKCQljbGFzc05hbWUgPSAiICIgKyBzZWxlY3RvciArICIgIjsKCQl3aGlsZSAoICggZWxlbSA9IHRoaXNbIGkrKyBdICkgKSB7CgkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSAmJgoJCQkJKCAiICIgKyBnZXRDbGFzcyggZWxlbSApICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKQoJCQkJCS5pbmRleE9mKCBjbGFzc05hbWUgKSA+IC0xCgkJCSkgewoJCQkJcmV0dXJuIHRydWU7CgkJCX0KCQl9CgoJCXJldHVybiBmYWxzZTsKCX0KfSApOwoKCgoKLy8gUmV0dXJuIGpRdWVyeSBmb3IgYXR0cmlidXRlcy1vbmx5IGluY2x1c2lvbgoKCmpRdWVyeS5lYWNoKCAoICJibHVyIGZvY3VzIGZvY3VzaW4gZm9jdXNvdXQgbG9hZCByZXNpemUgc2Nyb2xsIHVubG9hZCBjbGljayBkYmxjbGljayAiICsKCSJtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0IG1vdXNlZW50ZXIgbW91c2VsZWF2ZSAiICsKCSJjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGVycm9yIGNvbnRleHRtZW51IiApLnNwbGl0KCAiICIgKSwKCWZ1bmN0aW9uKCBpLCBuYW1lICkgewoKCS8vIEhhbmRsZSBldmVudCBiaW5kaW5nCglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBkYXRhLCBmbiApIHsKCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+IDAgPwoJCQl0aGlzLm9uKCBuYW1lLCBudWxsLCBkYXRhLCBmbiApIDoKCQkJdGhpcy50cmlnZ2VyKCBuYW1lICk7Cgl9Owp9ICk7CgpqUXVlcnkuZm4uZXh0ZW5kKCB7Cglob3ZlcjogZnVuY3Rpb24oIGZuT3ZlciwgZm5PdXQgKSB7CgkJcmV0dXJuIHRoaXMubW91c2VlbnRlciggZm5PdmVyICkubW91c2VsZWF2ZSggZm5PdXQgfHwgZm5PdmVyICk7Cgl9Cn0gKTsKCgp2YXIgbG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb247Cgp2YXIgbm9uY2UgPSBqUXVlcnkubm93KCk7Cgp2YXIgcnF1ZXJ5ID0gKCAvXD8vICk7CgoKCnZhciBydmFsaWR0b2tlbnMgPSAvKCwpfChcW3x7KXwofXxdKXwiKD86W14iXFxcclxuXXxcXFsiXFxcL2JmbnJ0XXxcXHVbXGRhLWZBLUZdezR9KSoiXHMqOj98dHJ1ZXxmYWxzZXxudWxsfC0/KD8hMFxkKVxkKyg/OlwuXGQrfCkoPzpbZUVdWystXT9cZCt8KS9nOwoKalF1ZXJ5LnBhcnNlSlNPTiA9IGZ1bmN0aW9uKCBkYXRhICkgewoKCS8vIEF0dGVtcHQgdG8gcGFyc2UgdXNpbmcgdGhlIG5hdGl2ZSBKU09OIHBhcnNlciBmaXJzdAoJaWYgKCB3aW5kb3cuSlNPTiAmJiB3aW5kb3cuSlNPTi5wYXJzZSApIHsKCgkJLy8gU3VwcG9ydDogQW5kcm9pZCAyLjMKCQkvLyBXb3JrYXJvdW5kIGZhaWx1cmUgdG8gc3RyaW5nLWNhc3QgbnVsbCBpbnB1dAoJCXJldHVybiB3aW5kb3cuSlNPTi5wYXJzZSggZGF0YSArICIiICk7Cgl9CgoJdmFyIHJlcXVpcmVOb25Db21tYSwKCQlkZXB0aCA9IG51bGwsCgkJc3RyID0galF1ZXJ5LnRyaW0oIGRhdGEgKyAiIiApOwoKCS8vIEd1YXJkIGFnYWluc3QgaW52YWxpZCAoYW5kIHBvc3NpYmx5IGRhbmdlcm91cykgaW5wdXQgYnkgZW5zdXJpbmcgdGhhdCBub3RoaW5nIHJlbWFpbnMKCS8vIGFmdGVyIHJlbW92aW5nIHZhbGlkIHRva2VucwoJcmV0dXJuIHN0ciAmJiAhalF1ZXJ5LnRyaW0oIHN0ci5yZXBsYWNlKCBydmFsaWR0b2tlbnMsIGZ1bmN0aW9uKCB0b2tlbiwgY29tbWEsIG9wZW4sIGNsb3NlICkgewoKCQkvLyBGb3JjZSB0ZXJtaW5hdGlvbiBpZiB3ZSBzZWUgYSBtaXNwbGFjZWQgY29tbWEKCQlpZiAoIHJlcXVpcmVOb25Db21tYSAmJiBjb21tYSApIHsKCQkJZGVwdGggPSAwOwoJCX0KCgkJLy8gUGVyZm9ybSBubyBtb3JlIHJlcGxhY2VtZW50cyBhZnRlciByZXR1cm5pbmcgdG8gb3V0ZXJtb3N0IGRlcHRoCgkJaWYgKCBkZXB0aCA9PT0gMCApIHsKCQkJcmV0dXJuIHRva2VuOwoJCX0KCgkJLy8gQ29tbWFzIG11c3Qgbm90IGZvbGxvdyAiWyIsICJ7Iiwgb3IgIiwiCgkJcmVxdWlyZU5vbkNvbW1hID0gb3BlbiB8fCBjb21tYTsKCgkJLy8gRGV0ZXJtaW5lIG5ldyBkZXB0aAoJCS8vIGFycmF5L29iamVjdCBvcGVuICgiWyIgb3IgInsiKTogZGVwdGggKz0gdHJ1ZSAtIGZhbHNlIChpbmNyZW1lbnQpCgkJLy8gYXJyYXkvb2JqZWN0IGNsb3NlICgiXSIgb3IgIn0iKTogZGVwdGggKz0gZmFsc2UgLSB0cnVlIChkZWNyZW1lbnQpCgkJLy8gb3RoZXIgY2FzZXMgKCIsIiBvciBwcmltaXRpdmUpOiBkZXB0aCArPSB0cnVlIC0gdHJ1ZSAobnVtZXJpYyBjYXN0KQoJCWRlcHRoICs9ICFjbG9zZSAtICFvcGVuOwoKCQkvLyBSZW1vdmUgdGhpcyB0b2tlbgoJCXJldHVybiAiIjsKCX0gKSApID8KCQkoIEZ1bmN0aW9uKCAicmV0dXJuICIgKyBzdHIgKSApKCkgOgoJCWpRdWVyeS5lcnJvciggIkludmFsaWQgSlNPTjogIiArIGRhdGEgKTsKfTsKCgovLyBDcm9zcy1icm93c2VyIHhtbCBwYXJzaW5nCmpRdWVyeS5wYXJzZVhNTCA9IGZ1bmN0aW9uKCBkYXRhICkgewoJdmFyIHhtbCwgdG1wOwoJaWYgKCAhZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIgKSB7CgkJcmV0dXJuIG51bGw7Cgl9Cgl0cnkgewoJCWlmICggd2luZG93LkRPTVBhcnNlciApIHsgLy8gU3RhbmRhcmQKCQkJdG1wID0gbmV3IHdpbmRvdy5ET01QYXJzZXIoKTsKCQkJeG1sID0gdG1wLnBhcnNlRnJvbVN0cmluZyggZGF0YSwgInRleHQveG1sIiApOwoJCX0gZWxzZSB7IC8vIElFCgkJCXhtbCA9IG5ldyB3aW5kb3cuQWN0aXZlWE9iamVjdCggIk1pY3Jvc29mdC5YTUxET00iICk7CgkJCXhtbC5hc3luYyA9ICJmYWxzZSI7CgkJCXhtbC5sb2FkWE1MKCBkYXRhICk7CgkJfQoJfSBjYXRjaCAoIGUgKSB7CgkJeG1sID0gdW5kZWZpbmVkOwoJfQoJaWYgKCAheG1sIHx8ICF4bWwuZG9jdW1lbnRFbGVtZW50IHx8IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSggInBhcnNlcmVycm9yIiApLmxlbmd0aCApIHsKCQlqUXVlcnkuZXJyb3IoICJJbnZhbGlkIFhNTDogIiArIGRhdGEgKTsKCX0KCXJldHVybiB4bWw7Cn07CgoKdmFyCglyaGFzaCA9IC8jLiokLywKCXJ0cyA9IC8oWz8mXSlfPVteJl0qLywKCgkvLyBJRSBsZWF2ZXMgYW4gXHIgY2hhcmFjdGVyIGF0IEVPTAoJcmhlYWRlcnMgPSAvXiguKj8pOlsgXHRdKihbXlxyXG5dKilccj8kL21nLAoKCS8vICM3NjUzLCAjODEyNSwgIzgxNTI6IGxvY2FsIHByb3RvY29sIGRldGVjdGlvbgoJcmxvY2FsUHJvdG9jb2wgPSAvXig/OmFib3V0fGFwcHxhcHAtc3RvcmFnZXwuKy1leHRlbnNpb258ZmlsZXxyZXN8d2lkZ2V0KTokLywKCXJub0NvbnRlbnQgPSAvXig/OkdFVHxIRUFEKSQvLAoJcnByb3RvY29sID0gL15cL1wvLywKCXJ1cmwgPSAvXihbXHcuKy1dKzopKD86XC9cLyg/OlteXC8/I10qQHwpKFteXC8/IzpdKikoPzo6KFxkKyl8KXwpLywKCgkvKiBQcmVmaWx0ZXJzCgkgKiAxKSBUaGV5IGFyZSB1c2VmdWwgdG8gaW50cm9kdWNlIGN1c3RvbSBkYXRhVHlwZXMgKHNlZSBhamF4L2pzb25wLmpzIGZvciBhbiBleGFtcGxlKQoJICogMikgVGhlc2UgYXJlIGNhbGxlZDoKCSAqICAgIC0gQkVGT1JFIGFza2luZyBmb3IgYSB0cmFuc3BvcnQKCSAqICAgIC0gQUZURVIgcGFyYW0gc2VyaWFsaXphdGlvbiAocy5kYXRhIGlzIGEgc3RyaW5nIGlmIHMucHJvY2Vzc0RhdGEgaXMgdHJ1ZSkKCSAqIDMpIGtleSBpcyB0aGUgZGF0YVR5cGUKCSAqIDQpIHRoZSBjYXRjaGFsbCBzeW1ib2wgIioiIGNhbiBiZSB1c2VkCgkgKiA1KSBleGVjdXRpb24gd2lsbCBzdGFydCB3aXRoIHRyYW5zcG9ydCBkYXRhVHlwZSBhbmQgVEhFTiBjb250aW51ZSBkb3duIHRvICIqIiBpZiBuZWVkZWQKCSAqLwoJcHJlZmlsdGVycyA9IHt9LAoKCS8qIFRyYW5zcG9ydHMgYmluZGluZ3MKCSAqIDEpIGtleSBpcyB0aGUgZGF0YVR5cGUKCSAqIDIpIHRoZSBjYXRjaGFsbCBzeW1ib2wgIioiIGNhbiBiZSB1c2VkCgkgKiAzKSBzZWxlY3Rpb24gd2lsbCBzdGFydCB3aXRoIHRyYW5zcG9ydCBkYXRhVHlwZSBhbmQgVEhFTiBnbyB0byAiKiIgaWYgbmVlZGVkCgkgKi8KCXRyYW5zcG9ydHMgPSB7fSwKCgkvLyBBdm9pZCBjb21tZW50LXByb2xvZyBjaGFyIHNlcXVlbmNlICgjMTAwOTgpOyBtdXN0IGFwcGVhc2UgbGludCBhbmQgZXZhZGUgY29tcHJlc3Npb24KCWFsbFR5cGVzID0gIiovIi5jb25jYXQoICIqIiApLAoKCS8vIERvY3VtZW50IGxvY2F0aW9uCglhamF4TG9jYXRpb24gPSBsb2NhdGlvbi5ocmVmLAoKCS8vIFNlZ21lbnQgbG9jYXRpb24gaW50byBwYXJ0cwoJYWpheExvY1BhcnRzID0gcnVybC5leGVjKCBhamF4TG9jYXRpb24udG9Mb3dlckNhc2UoKSApIHx8IFtdOwoKLy8gQmFzZSAiY29uc3RydWN0b3IiIGZvciBqUXVlcnkuYWpheFByZWZpbHRlciBhbmQgalF1ZXJ5LmFqYXhUcmFuc3BvcnQKZnVuY3Rpb24gYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBzdHJ1Y3R1cmUgKSB7CgoJLy8gZGF0YVR5cGVFeHByZXNzaW9uIGlzIG9wdGlvbmFsIGFuZCBkZWZhdWx0cyB0byAiKiIKCXJldHVybiBmdW5jdGlvbiggZGF0YVR5cGVFeHByZXNzaW9uLCBmdW5jICkgewoKCQlpZiAoIHR5cGVvZiBkYXRhVHlwZUV4cHJlc3Npb24gIT09ICJzdHJpbmciICkgewoJCQlmdW5jID0gZGF0YVR5cGVFeHByZXNzaW9uOwoJCQlkYXRhVHlwZUV4cHJlc3Npb24gPSAiKiI7CgkJfQoKCQl2YXIgZGF0YVR5cGUsCgkJCWkgPSAwLAoJCQlkYXRhVHlwZXMgPSBkYXRhVHlwZUV4cHJlc3Npb24udG9Mb3dlckNhc2UoKS5tYXRjaCggcm5vdHdoaXRlICkgfHwgW107CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGZ1bmMgKSApIHsKCgkJCS8vIEZvciBlYWNoIGRhdGFUeXBlIGluIHRoZSBkYXRhVHlwZUV4cHJlc3Npb24KCQkJd2hpbGUgKCAoIGRhdGFUeXBlID0gZGF0YVR5cGVzWyBpKysgXSApICkgewoKCQkJCS8vIFByZXBlbmQgaWYgcmVxdWVzdGVkCgkJCQlpZiAoIGRhdGFUeXBlLmNoYXJBdCggMCApID09PSAiKyIgKSB7CgkJCQkJZGF0YVR5cGUgPSBkYXRhVHlwZS5zbGljZSggMSApIHx8ICIqIjsKCQkJCQkoIHN0cnVjdHVyZVsgZGF0YVR5cGUgXSA9IHN0cnVjdHVyZVsgZGF0YVR5cGUgXSB8fCBbXSApLnVuc2hpZnQoIGZ1bmMgKTsKCgkJCQkvLyBPdGhlcndpc2UgYXBwZW5kCgkJCQl9IGVsc2UgewoJCQkJCSggc3RydWN0dXJlWyBkYXRhVHlwZSBdID0gc3RydWN0dXJlWyBkYXRhVHlwZSBdIHx8IFtdICkucHVzaCggZnVuYyApOwoJCQkJfQoJCQl9CgkJfQoJfTsKfQoKLy8gQmFzZSBpbnNwZWN0aW9uIGZ1bmN0aW9uIGZvciBwcmVmaWx0ZXJzIGFuZCB0cmFuc3BvcnRzCmZ1bmN0aW9uIGluc3BlY3RQcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBzdHJ1Y3R1cmUsIG9wdGlvbnMsIG9yaWdpbmFsT3B0aW9ucywganFYSFIgKSB7CgoJdmFyIGluc3BlY3RlZCA9IHt9LAoJCXNlZWtpbmdUcmFuc3BvcnQgPSAoIHN0cnVjdHVyZSA9PT0gdHJhbnNwb3J0cyApOwoKCWZ1bmN0aW9uIGluc3BlY3QoIGRhdGFUeXBlICkgewoJCXZhciBzZWxlY3RlZDsKCQlpbnNwZWN0ZWRbIGRhdGFUeXBlIF0gPSB0cnVlOwoJCWpRdWVyeS5lYWNoKCBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gfHwgW10sIGZ1bmN0aW9uKCBfLCBwcmVmaWx0ZXJPckZhY3RvcnkgKSB7CgkJCXZhciBkYXRhVHlwZU9yVHJhbnNwb3J0ID0gcHJlZmlsdGVyT3JGYWN0b3J5KCBvcHRpb25zLCBvcmlnaW5hbE9wdGlvbnMsIGpxWEhSICk7CgkJCWlmICggdHlwZW9mIGRhdGFUeXBlT3JUcmFuc3BvcnQgPT09ICJzdHJpbmciICYmCgkJCQkhc2Vla2luZ1RyYW5zcG9ydCAmJiAhaW5zcGVjdGVkWyBkYXRhVHlwZU9yVHJhbnNwb3J0IF0gKSB7CgoJCQkJb3B0aW9ucy5kYXRhVHlwZXMudW5zaGlmdCggZGF0YVR5cGVPclRyYW5zcG9ydCApOwoJCQkJaW5zcGVjdCggZGF0YVR5cGVPclRyYW5zcG9ydCApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9IGVsc2UgaWYgKCBzZWVraW5nVHJhbnNwb3J0ICkgewoJCQkJcmV0dXJuICEoIHNlbGVjdGVkID0gZGF0YVR5cGVPclRyYW5zcG9ydCApOwoJCQl9CgkJfSApOwoJCXJldHVybiBzZWxlY3RlZDsKCX0KCglyZXR1cm4gaW5zcGVjdCggb3B0aW9ucy5kYXRhVHlwZXNbIDAgXSApIHx8ICFpbnNwZWN0ZWRbICIqIiBdICYmIGluc3BlY3QoICIqIiApOwp9CgovLyBBIHNwZWNpYWwgZXh0ZW5kIGZvciBhamF4IG9wdGlvbnMKLy8gdGhhdCB0YWtlcyAiZmxhdCIgb3B0aW9ucyAobm90IHRvIGJlIGRlZXAgZXh0ZW5kZWQpCi8vIEZpeGVzICM5ODg3CmZ1bmN0aW9uIGFqYXhFeHRlbmQoIHRhcmdldCwgc3JjICkgewoJdmFyIGRlZXAsIGtleSwKCQlmbGF0T3B0aW9ucyA9IGpRdWVyeS5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnMgfHwge307CgoJZm9yICgga2V5IGluIHNyYyApIHsKCQlpZiAoIHNyY1sga2V5IF0gIT09IHVuZGVmaW5lZCApIHsKCQkJKCBmbGF0T3B0aW9uc1sga2V5IF0gPyB0YXJnZXQgOiAoIGRlZXAgfHwgKCBkZWVwID0ge30gKSApIClbIGtleSBdID0gc3JjWyBrZXkgXTsKCQl9Cgl9CglpZiAoIGRlZXAgKSB7CgkJalF1ZXJ5LmV4dGVuZCggdHJ1ZSwgdGFyZ2V0LCBkZWVwICk7Cgl9CgoJcmV0dXJuIHRhcmdldDsKfQoKLyogSGFuZGxlcyByZXNwb25zZXMgdG8gYW4gYWpheCByZXF1ZXN0OgogKiAtIGZpbmRzIHRoZSByaWdodCBkYXRhVHlwZSAobWVkaWF0ZXMgYmV0d2VlbiBjb250ZW50LXR5cGUgYW5kIGV4cGVjdGVkIGRhdGFUeXBlKQogKiAtIHJldHVybnMgdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UKICovCmZ1bmN0aW9uIGFqYXhIYW5kbGVSZXNwb25zZXMoIHMsIGpxWEhSLCByZXNwb25zZXMgKSB7Cgl2YXIgZmlyc3REYXRhVHlwZSwgY3QsIGZpbmFsRGF0YVR5cGUsIHR5cGUsCgkJY29udGVudHMgPSBzLmNvbnRlbnRzLAoJCWRhdGFUeXBlcyA9IHMuZGF0YVR5cGVzOwoKCS8vIFJlbW92ZSBhdXRvIGRhdGFUeXBlIGFuZCBnZXQgY29udGVudC10eXBlIGluIHRoZSBwcm9jZXNzCgl3aGlsZSAoIGRhdGFUeXBlc1sgMCBdID09PSAiKiIgKSB7CgkJZGF0YVR5cGVzLnNoaWZ0KCk7CgkJaWYgKCBjdCA9PT0gdW5kZWZpbmVkICkgewoJCQljdCA9IHMubWltZVR5cGUgfHwganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoICJDb250ZW50LVR5cGUiICk7CgkJfQoJfQoKCS8vIENoZWNrIGlmIHdlJ3JlIGRlYWxpbmcgd2l0aCBhIGtub3duIGNvbnRlbnQtdHlwZQoJaWYgKCBjdCApIHsKCQlmb3IgKCB0eXBlIGluIGNvbnRlbnRzICkgewoJCQlpZiAoIGNvbnRlbnRzWyB0eXBlIF0gJiYgY29udGVudHNbIHR5cGUgXS50ZXN0KCBjdCApICkgewoJCQkJZGF0YVR5cGVzLnVuc2hpZnQoIHR5cGUgKTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJfQoKCS8vIENoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIGEgcmVzcG9uc2UgZm9yIHRoZSBleHBlY3RlZCBkYXRhVHlwZQoJaWYgKCBkYXRhVHlwZXNbIDAgXSBpbiByZXNwb25zZXMgKSB7CgkJZmluYWxEYXRhVHlwZSA9IGRhdGFUeXBlc1sgMCBdOwoJfSBlbHNlIHsKCgkJLy8gVHJ5IGNvbnZlcnRpYmxlIGRhdGFUeXBlcwoJCWZvciAoIHR5cGUgaW4gcmVzcG9uc2VzICkgewoJCQlpZiAoICFkYXRhVHlwZXNbIDAgXSB8fCBzLmNvbnZlcnRlcnNbIHR5cGUgKyAiICIgKyBkYXRhVHlwZXNbIDAgXSBdICkgewoJCQkJZmluYWxEYXRhVHlwZSA9IHR5cGU7CgkJCQlicmVhazsKCQkJfQoJCQlpZiAoICFmaXJzdERhdGFUeXBlICkgewoJCQkJZmlyc3REYXRhVHlwZSA9IHR5cGU7CgkJCX0KCQl9CgoJCS8vIE9yIGp1c3QgdXNlIGZpcnN0IG9uZQoJCWZpbmFsRGF0YVR5cGUgPSBmaW5hbERhdGFUeXBlIHx8IGZpcnN0RGF0YVR5cGU7Cgl9CgoJLy8gSWYgd2UgZm91bmQgYSBkYXRhVHlwZQoJLy8gV2UgYWRkIHRoZSBkYXRhVHlwZSB0byB0aGUgbGlzdCBpZiBuZWVkZWQKCS8vIGFuZCByZXR1cm4gdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UKCWlmICggZmluYWxEYXRhVHlwZSApIHsKCQlpZiAoIGZpbmFsRGF0YVR5cGUgIT09IGRhdGFUeXBlc1sgMCBdICkgewoJCQlkYXRhVHlwZXMudW5zaGlmdCggZmluYWxEYXRhVHlwZSApOwoJCX0KCQlyZXR1cm4gcmVzcG9uc2VzWyBmaW5hbERhdGFUeXBlIF07Cgl9Cn0KCi8qIENoYWluIGNvbnZlcnNpb25zIGdpdmVuIHRoZSByZXF1ZXN0IGFuZCB0aGUgb3JpZ2luYWwgcmVzcG9uc2UKICogQWxzbyBzZXRzIHRoZSByZXNwb25zZVhYWCBmaWVsZHMgb24gdGhlIGpxWEhSIGluc3RhbmNlCiAqLwpmdW5jdGlvbiBhamF4Q29udmVydCggcywgcmVzcG9uc2UsIGpxWEhSLCBpc1N1Y2Nlc3MgKSB7Cgl2YXIgY29udjIsIGN1cnJlbnQsIGNvbnYsIHRtcCwgcHJldiwKCQljb252ZXJ0ZXJzID0ge30sCgoJCS8vIFdvcmsgd2l0aCBhIGNvcHkgb2YgZGF0YVR5cGVzIGluIGNhc2Ugd2UgbmVlZCB0byBtb2RpZnkgaXQgZm9yIGNvbnZlcnNpb24KCQlkYXRhVHlwZXMgPSBzLmRhdGFUeXBlcy5zbGljZSgpOwoKCS8vIENyZWF0ZSBjb252ZXJ0ZXJzIG1hcCB3aXRoIGxvd2VyY2FzZWQga2V5cwoJaWYgKCBkYXRhVHlwZXNbIDEgXSApIHsKCQlmb3IgKCBjb252IGluIHMuY29udmVydGVycyApIHsKCQkJY29udmVydGVyc1sgY29udi50b0xvd2VyQ2FzZSgpIF0gPSBzLmNvbnZlcnRlcnNbIGNvbnYgXTsKCQl9Cgl9CgoJY3VycmVudCA9IGRhdGFUeXBlcy5zaGlmdCgpOwoKCS8vIENvbnZlcnQgdG8gZWFjaCBzZXF1ZW50aWFsIGRhdGFUeXBlCgl3aGlsZSAoIGN1cnJlbnQgKSB7CgoJCWlmICggcy5yZXNwb25zZUZpZWxkc1sgY3VycmVudCBdICkgewoJCQlqcVhIUlsgcy5yZXNwb25zZUZpZWxkc1sgY3VycmVudCBdIF0gPSByZXNwb25zZTsKCQl9CgoJCS8vIEFwcGx5IHRoZSBkYXRhRmlsdGVyIGlmIHByb3ZpZGVkCgkJaWYgKCAhcHJldiAmJiBpc1N1Y2Nlc3MgJiYgcy5kYXRhRmlsdGVyICkgewoJCQlyZXNwb25zZSA9IHMuZGF0YUZpbHRlciggcmVzcG9uc2UsIHMuZGF0YVR5cGUgKTsKCQl9CgoJCXByZXYgPSBjdXJyZW50OwoJCWN1cnJlbnQgPSBkYXRhVHlwZXMuc2hpZnQoKTsKCgkJaWYgKCBjdXJyZW50ICkgewoKCQkJLy8gVGhlcmUncyBvbmx5IHdvcmsgdG8gZG8gaWYgY3VycmVudCBkYXRhVHlwZSBpcyBub24tYXV0bwoJCQlpZiAoIGN1cnJlbnQgPT09ICIqIiApIHsKCgkJCQljdXJyZW50ID0gcHJldjsKCgkJCS8vIENvbnZlcnQgcmVzcG9uc2UgaWYgcHJldiBkYXRhVHlwZSBpcyBub24tYXV0byBhbmQgZGlmZmVycyBmcm9tIGN1cnJlbnQKCQkJfSBlbHNlIGlmICggcHJldiAhPT0gIioiICYmIHByZXYgIT09IGN1cnJlbnQgKSB7CgoJCQkJLy8gU2VlayBhIGRpcmVjdCBjb252ZXJ0ZXIKCQkJCWNvbnYgPSBjb252ZXJ0ZXJzWyBwcmV2ICsgIiAiICsgY3VycmVudCBdIHx8IGNvbnZlcnRlcnNbICIqICIgKyBjdXJyZW50IF07CgoJCQkJLy8gSWYgbm9uZSBmb3VuZCwgc2VlayBhIHBhaXIKCQkJCWlmICggIWNvbnYgKSB7CgkJCQkJZm9yICggY29udjIgaW4gY29udmVydGVycyApIHsKCgkJCQkJCS8vIElmIGNvbnYyIG91dHB1dHMgY3VycmVudAoJCQkJCQl0bXAgPSBjb252Mi5zcGxpdCggIiAiICk7CgkJCQkJCWlmICggdG1wWyAxIF0gPT09IGN1cnJlbnQgKSB7CgoJCQkJCQkJLy8gSWYgcHJldiBjYW4gYmUgY29udmVydGVkIHRvIGFjY2VwdGVkIGlucHV0CgkJCQkJCQljb252ID0gY29udmVydGVyc1sgcHJldiArICIgIiArIHRtcFsgMCBdIF0gfHwKCQkJCQkJCQljb252ZXJ0ZXJzWyAiKiAiICsgdG1wWyAwIF0gXTsKCQkJCQkJCWlmICggY29udiApIHsKCgkJCQkJCQkJLy8gQ29uZGVuc2UgZXF1aXZhbGVuY2UgY29udmVydGVycwoJCQkJCQkJCWlmICggY29udiA9PT0gdHJ1ZSApIHsKCQkJCQkJCQkJY29udiA9IGNvbnZlcnRlcnNbIGNvbnYyIF07CgoJCQkJCQkJCS8vIE90aGVyd2lzZSwgaW5zZXJ0IHRoZSBpbnRlcm1lZGlhdGUgZGF0YVR5cGUKCQkJCQkJCQl9IGVsc2UgaWYgKCBjb252ZXJ0ZXJzWyBjb252MiBdICE9PSB0cnVlICkgewoJCQkJCQkJCQljdXJyZW50ID0gdG1wWyAwIF07CgkJCQkJCQkJCWRhdGFUeXBlcy51bnNoaWZ0KCB0bXBbIDEgXSApOwoJCQkJCQkJCX0KCQkJCQkJCQlicmVhazsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQkvLyBBcHBseSBjb252ZXJ0ZXIgKGlmIG5vdCBhbiBlcXVpdmFsZW5jZSkKCQkJCWlmICggY29udiAhPT0gdHJ1ZSApIHsKCgkJCQkJLy8gVW5sZXNzIGVycm9ycyBhcmUgYWxsb3dlZCB0byBidWJibGUsIGNhdGNoIGFuZCByZXR1cm4gdGhlbQoJCQkJCWlmICggY29udiAmJiBzWyAidGhyb3dzIiBdICkgeyAvLyBqc2NzOmlnbm9yZSByZXF1aXJlRG90Tm90YXRpb24KCQkJCQkJcmVzcG9uc2UgPSBjb252KCByZXNwb25zZSApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlyZXNwb25zZSA9IGNvbnYoIHJlc3BvbnNlICk7CgkJCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCQkJcmV0dXJuIHsKCQkJCQkJCQlzdGF0ZTogInBhcnNlcmVycm9yIiwKCQkJCQkJCQllcnJvcjogY29udiA/IGUgOiAiTm8gY29udmVyc2lvbiBmcm9tICIgKyBwcmV2ICsgIiB0byAiICsgY3VycmVudAoJCQkJCQkJfTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0KCglyZXR1cm4geyBzdGF0ZTogInN1Y2Nlc3MiLCBkYXRhOiByZXNwb25zZSB9Owp9CgpqUXVlcnkuZXh0ZW5kKCB7CgoJLy8gQ291bnRlciBmb3IgaG9sZGluZyB0aGUgbnVtYmVyIG9mIGFjdGl2ZSBxdWVyaWVzCglhY3RpdmU6IDAsCgoJLy8gTGFzdC1Nb2RpZmllZCBoZWFkZXIgY2FjaGUgZm9yIG5leHQgcmVxdWVzdAoJbGFzdE1vZGlmaWVkOiB7fSwKCWV0YWc6IHt9LAoKCWFqYXhTZXR0aW5nczogewoJCXVybDogYWpheExvY2F0aW9uLAoJCXR5cGU6ICJHRVQiLAoJCWlzTG9jYWw6IHJsb2NhbFByb3RvY29sLnRlc3QoIGFqYXhMb2NQYXJ0c1sgMSBdICksCgkJZ2xvYmFsOiB0cnVlLAoJCXByb2Nlc3NEYXRhOiB0cnVlLAoJCWFzeW5jOiB0cnVlLAoJCWNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04IiwKCQkvKgoJCXRpbWVvdXQ6IDAsCgkJZGF0YTogbnVsbCwKCQlkYXRhVHlwZTogbnVsbCwKCQl1c2VybmFtZTogbnVsbCwKCQlwYXNzd29yZDogbnVsbCwKCQljYWNoZTogbnVsbCwKCQl0aHJvd3M6IGZhbHNlLAoJCXRyYWRpdGlvbmFsOiBmYWxzZSwKCQloZWFkZXJzOiB7fSwKCQkqLwoKCQlhY2NlcHRzOiB7CgkJCSIqIjogYWxsVHlwZXMsCgkJCXRleHQ6ICJ0ZXh0L3BsYWluIiwKCQkJaHRtbDogInRleHQvaHRtbCIsCgkJCXhtbDogImFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWwiLAoJCQlqc29uOiAiYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0IgoJCX0sCgoJCWNvbnRlbnRzOiB7CgkJCXhtbDogL1xieG1sXGIvLAoJCQlodG1sOiAvXGJodG1sLywKCQkJanNvbjogL1xianNvblxiLwoJCX0sCgoJCXJlc3BvbnNlRmllbGRzOiB7CgkJCXhtbDogInJlc3BvbnNlWE1MIiwKCQkJdGV4dDogInJlc3BvbnNlVGV4dCIsCgkJCWpzb246ICJyZXNwb25zZUpTT04iCgkJfSwKCgkJLy8gRGF0YSBjb252ZXJ0ZXJzCgkJLy8gS2V5cyBzZXBhcmF0ZSBzb3VyY2UgKG9yIGNhdGNoYWxsICIqIikgYW5kIGRlc3RpbmF0aW9uIHR5cGVzIHdpdGggYSBzaW5nbGUgc3BhY2UKCQljb252ZXJ0ZXJzOiB7CgoJCQkvLyBDb252ZXJ0IGFueXRoaW5nIHRvIHRleHQKCQkJIiogdGV4dCI6IFN0cmluZywKCgkJCS8vIFRleHQgdG8gaHRtbCAodHJ1ZSA9IG5vIHRyYW5zZm9ybWF0aW9uKQoJCQkidGV4dCBodG1sIjogdHJ1ZSwKCgkJCS8vIEV2YWx1YXRlIHRleHQgYXMgYSBqc29uIGV4cHJlc3Npb24KCQkJInRleHQganNvbiI6IGpRdWVyeS5wYXJzZUpTT04sCgoJCQkvLyBQYXJzZSB0ZXh0IGFzIHhtbAoJCQkidGV4dCB4bWwiOiBqUXVlcnkucGFyc2VYTUwKCQl9LAoKCQkvLyBGb3Igb3B0aW9ucyB0aGF0IHNob3VsZG4ndCBiZSBkZWVwIGV4dGVuZGVkOgoJCS8vIHlvdSBjYW4gYWRkIHlvdXIgb3duIGN1c3RvbSBvcHRpb25zIGhlcmUgaWYKCQkvLyBhbmQgd2hlbiB5b3UgY3JlYXRlIG9uZSB0aGF0IHNob3VsZG4ndCBiZQoJCS8vIGRlZXAgZXh0ZW5kZWQgKHNlZSBhamF4RXh0ZW5kKQoJCWZsYXRPcHRpb25zOiB7CgkJCXVybDogdHJ1ZSwKCQkJY29udGV4dDogdHJ1ZQoJCX0KCX0sCgoJLy8gQ3JlYXRlcyBhIGZ1bGwgZmxlZGdlZCBzZXR0aW5ncyBvYmplY3QgaW50byB0YXJnZXQKCS8vIHdpdGggYm90aCBhamF4U2V0dGluZ3MgYW5kIHNldHRpbmdzIGZpZWxkcy4KCS8vIElmIHRhcmdldCBpcyBvbWl0dGVkLCB3cml0ZXMgaW50byBhamF4U2V0dGluZ3MuCglhamF4U2V0dXA6IGZ1bmN0aW9uKCB0YXJnZXQsIHNldHRpbmdzICkgewoJCXJldHVybiBzZXR0aW5ncyA/CgoJCQkvLyBCdWlsZGluZyBhIHNldHRpbmdzIG9iamVjdAoJCQlhamF4RXh0ZW5kKCBhamF4RXh0ZW5kKCB0YXJnZXQsIGpRdWVyeS5hamF4U2V0dGluZ3MgKSwgc2V0dGluZ3MgKSA6CgoJCQkvLyBFeHRlbmRpbmcgYWpheFNldHRpbmdzCgkJCWFqYXhFeHRlbmQoIGpRdWVyeS5hamF4U2V0dGluZ3MsIHRhcmdldCApOwoJfSwKCglhamF4UHJlZmlsdGVyOiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHByZWZpbHRlcnMgKSwKCWFqYXhUcmFuc3BvcnQ6IGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cyApLAoKCS8vIE1haW4gbWV0aG9kCglhamF4OiBmdW5jdGlvbiggdXJsLCBvcHRpb25zICkgewoKCQkvLyBJZiB1cmwgaXMgYW4gb2JqZWN0LCBzaW11bGF0ZSBwcmUtMS41IHNpZ25hdHVyZQoJCWlmICggdHlwZW9mIHVybCA9PT0gIm9iamVjdCIgKSB7CgkJCW9wdGlvbnMgPSB1cmw7CgkJCXVybCA9IHVuZGVmaW5lZDsKCQl9CgoJCS8vIEZvcmNlIG9wdGlvbnMgdG8gYmUgYW4gb2JqZWN0CgkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgoJCXZhcgoKCQkJLy8gQ3Jvc3MtZG9tYWluIGRldGVjdGlvbiB2YXJzCgkJCXBhcnRzLAoKCQkJLy8gTG9vcCB2YXJpYWJsZQoJCQlpLAoKCQkJLy8gVVJMIHdpdGhvdXQgYW50aS1jYWNoZSBwYXJhbQoJCQljYWNoZVVSTCwKCgkJCS8vIFJlc3BvbnNlIGhlYWRlcnMgYXMgc3RyaW5nCgkJCXJlc3BvbnNlSGVhZGVyc1N0cmluZywKCgkJCS8vIHRpbWVvdXQgaGFuZGxlCgkJCXRpbWVvdXRUaW1lciwKCgkJCS8vIFRvIGtub3cgaWYgZ2xvYmFsIGV2ZW50cyBhcmUgdG8gYmUgZGlzcGF0Y2hlZAoJCQlmaXJlR2xvYmFscywKCgkJCXRyYW5zcG9ydCwKCgkJCS8vIFJlc3BvbnNlIGhlYWRlcnMKCQkJcmVzcG9uc2VIZWFkZXJzLAoKCQkJLy8gQ3JlYXRlIHRoZSBmaW5hbCBvcHRpb25zIG9iamVjdAoJCQlzID0galF1ZXJ5LmFqYXhTZXR1cCgge30sIG9wdGlvbnMgKSwKCgkJCS8vIENhbGxiYWNrcyBjb250ZXh0CgkJCWNhbGxiYWNrQ29udGV4dCA9IHMuY29udGV4dCB8fCBzLAoKCQkJLy8gQ29udGV4dCBmb3IgZ2xvYmFsIGV2ZW50cyBpcyBjYWxsYmFja0NvbnRleHQgaWYgaXQgaXMgYSBET00gbm9kZSBvciBqUXVlcnkgY29sbGVjdGlvbgoJCQlnbG9iYWxFdmVudENvbnRleHQgPSBzLmNvbnRleHQgJiYKCQkJCSggY2FsbGJhY2tDb250ZXh0Lm5vZGVUeXBlIHx8IGNhbGxiYWNrQ29udGV4dC5qcXVlcnkgKSA/CgkJCQkJalF1ZXJ5KCBjYWxsYmFja0NvbnRleHQgKSA6CgkJCQkJalF1ZXJ5LmV2ZW50LAoKCQkJLy8gRGVmZXJyZWRzCgkJCWRlZmVycmVkID0galF1ZXJ5LkRlZmVycmVkKCksCgkJCWNvbXBsZXRlRGVmZXJyZWQgPSBqUXVlcnkuQ2FsbGJhY2tzKCAib25jZSBtZW1vcnkiICksCgoJCQkvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwoJCQlzdGF0dXNDb2RlID0gcy5zdGF0dXNDb2RlIHx8IHt9LAoKCQkJLy8gSGVhZGVycyAodGhleSBhcmUgc2VudCBhbGwgYXQgb25jZSkKCQkJcmVxdWVzdEhlYWRlcnMgPSB7fSwKCQkJcmVxdWVzdEhlYWRlcnNOYW1lcyA9IHt9LAoKCQkJLy8gVGhlIGpxWEhSIHN0YXRlCgkJCXN0YXRlID0gMCwKCgkJCS8vIERlZmF1bHQgYWJvcnQgbWVzc2FnZQoJCQlzdHJBYm9ydCA9ICJjYW5jZWxlZCIsCgoJCQkvLyBGYWtlIHhocgoJCQlqcVhIUiA9IHsKCQkJCXJlYWR5U3RhdGU6IDAsCgoJCQkJLy8gQnVpbGRzIGhlYWRlcnMgaGFzaHRhYmxlIGlmIG5lZWRlZAoJCQkJZ2V0UmVzcG9uc2VIZWFkZXI6IGZ1bmN0aW9uKCBrZXkgKSB7CgkJCQkJdmFyIG1hdGNoOwoJCQkJCWlmICggc3RhdGUgPT09IDIgKSB7CgkJCQkJCWlmICggIXJlc3BvbnNlSGVhZGVycyApIHsKCQkJCQkJCXJlc3BvbnNlSGVhZGVycyA9IHt9OwoJCQkJCQkJd2hpbGUgKCAoIG1hdGNoID0gcmhlYWRlcnMuZXhlYyggcmVzcG9uc2VIZWFkZXJzU3RyaW5nICkgKSApIHsKCQkJCQkJCQlyZXNwb25zZUhlYWRlcnNbIG1hdGNoWyAxIF0udG9Mb3dlckNhc2UoKSBdID0gbWF0Y2hbIDIgXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQltYXRjaCA9IHJlc3BvbnNlSGVhZGVyc1sga2V5LnRvTG93ZXJDYXNlKCkgXTsKCQkJCQl9CgkJCQkJcmV0dXJuIG1hdGNoID09IG51bGwgPyBudWxsIDogbWF0Y2g7CgkJCQl9LAoKCQkJCS8vIFJhdyBzdHJpbmcKCQkJCWdldEFsbFJlc3BvbnNlSGVhZGVyczogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHN0YXRlID09PSAyID8gcmVzcG9uc2VIZWFkZXJzU3RyaW5nIDogbnVsbDsKCQkJCX0sCgoJCQkJLy8gQ2FjaGVzIHRoZSBoZWFkZXIKCQkJCXNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQkJCQl2YXIgbG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCW5hbWUgPSByZXF1ZXN0SGVhZGVyc05hbWVzWyBsbmFtZSBdID0gcmVxdWVzdEhlYWRlcnNOYW1lc1sgbG5hbWUgXSB8fCBuYW1lOwoJCQkJCQlyZXF1ZXN0SGVhZGVyc1sgbmFtZSBdID0gdmFsdWU7CgkJCQkJfQoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCgkJCQkvLyBPdmVycmlkZXMgcmVzcG9uc2UgY29udGVudC10eXBlIGhlYWRlcgoJCQkJb3ZlcnJpZGVNaW1lVHlwZTogZnVuY3Rpb24oIHR5cGUgKSB7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCXMubWltZVR5cGUgPSB0eXBlOwoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gU3RhdHVzLWRlcGVuZGVudCBjYWxsYmFja3MKCQkJCXN0YXR1c0NvZGU6IGZ1bmN0aW9uKCBtYXAgKSB7CgkJCQkJdmFyIGNvZGU7CgkJCQkJaWYgKCBtYXAgKSB7CgkJCQkJCWlmICggc3RhdGUgPCAyICkgewoJCQkJCQkJZm9yICggY29kZSBpbiBtYXAgKSB7CgoJCQkJCQkJCS8vIExhenktYWRkIHRoZSBuZXcgY2FsbGJhY2sgaW4gYSB3YXkgdGhhdCBwcmVzZXJ2ZXMgb2xkIG9uZXMKCQkJCQkJCQlzdGF0dXNDb2RlWyBjb2RlIF0gPSBbIHN0YXR1c0NvZGVbIGNvZGUgXSwgbWFwWyBjb2RlIF0gXTsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkvLyBFeGVjdXRlIHRoZSBhcHByb3ByaWF0ZSBjYWxsYmFja3MKCQkJCQkJCWpxWEhSLmFsd2F5cyggbWFwWyBqcVhIUi5zdGF0dXMgXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCgkJCQkvLyBDYW5jZWwgdGhlIHJlcXVlc3QKCQkJCWFib3J0OiBmdW5jdGlvbiggc3RhdHVzVGV4dCApIHsKCQkJCQl2YXIgZmluYWxUZXh0ID0gc3RhdHVzVGV4dCB8fCBzdHJBYm9ydDsKCQkJCQlpZiAoIHRyYW5zcG9ydCApIHsKCQkJCQkJdHJhbnNwb3J0LmFib3J0KCBmaW5hbFRleHQgKTsKCQkJCQl9CgkJCQkJZG9uZSggMCwgZmluYWxUZXh0ICk7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9CgkJCX07CgoJCS8vIEF0dGFjaCBkZWZlcnJlZHMKCQlkZWZlcnJlZC5wcm9taXNlKCBqcVhIUiApLmNvbXBsZXRlID0gY29tcGxldGVEZWZlcnJlZC5hZGQ7CgkJanFYSFIuc3VjY2VzcyA9IGpxWEhSLmRvbmU7CgkJanFYSFIuZXJyb3IgPSBqcVhIUi5mYWlsOwoKCQkvLyBSZW1vdmUgaGFzaCBjaGFyYWN0ZXIgKCM3NTMxOiBhbmQgc3RyaW5nIHByb21vdGlvbikKCQkvLyBBZGQgcHJvdG9jb2wgaWYgbm90IHByb3ZpZGVkICgjNTg2NjogSUU3IGlzc3VlIHdpdGggcHJvdG9jb2wtbGVzcyB1cmxzKQoJCS8vIEhhbmRsZSBmYWxzeSB1cmwgaW4gdGhlIHNldHRpbmdzIG9iamVjdCAoIzEwMDkzOiBjb25zaXN0ZW5jeSB3aXRoIG9sZCBzaWduYXR1cmUpCgkJLy8gV2UgYWxzbyB1c2UgdGhlIHVybCBwYXJhbWV0ZXIgaWYgYXZhaWxhYmxlCgkJcy51cmwgPSAoICggdXJsIHx8IHMudXJsIHx8IGFqYXhMb2NhdGlvbiApICsgIiIgKQoJCQkucmVwbGFjZSggcmhhc2gsICIiICkKCQkJLnJlcGxhY2UoIHJwcm90b2NvbCwgYWpheExvY1BhcnRzWyAxIF0gKyAiLy8iICk7CgoJCS8vIEFsaWFzIG1ldGhvZCBvcHRpb24gdG8gdHlwZSBhcyBwZXIgdGlja2V0ICMxMjAwNAoJCXMudHlwZSA9IG9wdGlvbnMubWV0aG9kIHx8IG9wdGlvbnMudHlwZSB8fCBzLm1ldGhvZCB8fCBzLnR5cGU7CgoJCS8vIEV4dHJhY3QgZGF0YVR5cGVzIGxpc3QKCQlzLmRhdGFUeXBlcyA9IGpRdWVyeS50cmltKCBzLmRhdGFUeXBlIHx8ICIqIiApLnRvTG93ZXJDYXNlKCkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFsgIiIgXTsKCgkJLy8gQSBjcm9zcy1kb21haW4gcmVxdWVzdCBpcyBpbiBvcmRlciB3aGVuIHdlIGhhdmUgYSBwcm90b2NvbDpob3N0OnBvcnQgbWlzbWF0Y2gKCQlpZiAoIHMuY3Jvc3NEb21haW4gPT0gbnVsbCApIHsKCQkJcGFydHMgPSBydXJsLmV4ZWMoIHMudXJsLnRvTG93ZXJDYXNlKCkgKTsKCQkJcy5jcm9zc0RvbWFpbiA9ICEhKCBwYXJ0cyAmJgoJCQkJKCBwYXJ0c1sgMSBdICE9PSBhamF4TG9jUGFydHNbIDEgXSB8fCBwYXJ0c1sgMiBdICE9PSBhamF4TG9jUGFydHNbIDIgXSB8fAoJCQkJCSggcGFydHNbIDMgXSB8fCAoIHBhcnRzWyAxIF0gPT09ICJodHRwOiIgPyAiODAiIDogIjQ0MyIgKSApICE9PQoJCQkJCQkoIGFqYXhMb2NQYXJ0c1sgMyBdIHx8ICggYWpheExvY1BhcnRzWyAxIF0gPT09ICJodHRwOiIgPyAiODAiIDogIjQ0MyIgKSApICkKCQkJKTsKCQl9CgoJCS8vIENvbnZlcnQgZGF0YSBpZiBub3QgYWxyZWFkeSBhIHN0cmluZwoJCWlmICggcy5kYXRhICYmIHMucHJvY2Vzc0RhdGEgJiYgdHlwZW9mIHMuZGF0YSAhPT0gInN0cmluZyIgKSB7CgkJCXMuZGF0YSA9IGpRdWVyeS5wYXJhbSggcy5kYXRhLCBzLnRyYWRpdGlvbmFsICk7CgkJfQoKCQkvLyBBcHBseSBwcmVmaWx0ZXJzCgkJaW5zcGVjdFByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHByZWZpbHRlcnMsIHMsIG9wdGlvbnMsIGpxWEhSICk7CgoJCS8vIElmIHJlcXVlc3Qgd2FzIGFib3J0ZWQgaW5zaWRlIGEgcHJlZmlsdGVyLCBzdG9wIHRoZXJlCgkJaWYgKCBzdGF0ZSA9PT0gMiApIHsKCQkJcmV0dXJuIGpxWEhSOwoJCX0KCgkJLy8gV2UgY2FuIGZpcmUgZ2xvYmFsIGV2ZW50cyBhcyBvZiBub3cgaWYgYXNrZWQgdG8KCQkvLyBEb24ndCBmaXJlIGV2ZW50cyBpZiBqUXVlcnkuZXZlbnQgaXMgdW5kZWZpbmVkIGluIGFuIEFNRC11c2FnZSBzY2VuYXJpbyAoIzE1MTE4KQoJCWZpcmVHbG9iYWxzID0galF1ZXJ5LmV2ZW50ICYmIHMuZ2xvYmFsOwoKCQkvLyBXYXRjaCBmb3IgYSBuZXcgc2V0IG9mIHJlcXVlc3RzCgkJaWYgKCBmaXJlR2xvYmFscyAmJiBqUXVlcnkuYWN0aXZlKysgPT09IDAgKSB7CgkJCWpRdWVyeS5ldmVudC50cmlnZ2VyKCAiYWpheFN0YXJ0IiApOwoJCX0KCgkJLy8gVXBwZXJjYXNlIHRoZSB0eXBlCgkJcy50eXBlID0gcy50eXBlLnRvVXBwZXJDYXNlKCk7CgoJCS8vIERldGVybWluZSBpZiByZXF1ZXN0IGhhcyBjb250ZW50CgkJcy5oYXNDb250ZW50ID0gIXJub0NvbnRlbnQudGVzdCggcy50eXBlICk7CgoJCS8vIFNhdmUgdGhlIFVSTCBpbiBjYXNlIHdlJ3JlIHRveWluZyB3aXRoIHRoZSBJZi1Nb2RpZmllZC1TaW5jZQoJCS8vIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciBsYXRlciBvbgoJCWNhY2hlVVJMID0gcy51cmw7CgoJCS8vIE1vcmUgb3B0aW9ucyBoYW5kbGluZyBmb3IgcmVxdWVzdHMgd2l0aCBubyBjb250ZW50CgkJaWYgKCAhcy5oYXNDb250ZW50ICkgewoKCQkJLy8gSWYgZGF0YSBpcyBhdmFpbGFibGUsIGFwcGVuZCBkYXRhIHRvIHVybAoJCQlpZiAoIHMuZGF0YSApIHsKCQkJCWNhY2hlVVJMID0gKCBzLnVybCArPSAoIHJxdWVyeS50ZXN0KCBjYWNoZVVSTCApID8gIiYiIDogIj8iICkgKyBzLmRhdGEgKTsKCgkJCQkvLyAjOTY4MjogcmVtb3ZlIGRhdGEgc28gdGhhdCBpdCdzIG5vdCB1c2VkIGluIGFuIGV2ZW50dWFsIHJldHJ5CgkJCQlkZWxldGUgcy5kYXRhOwoJCQl9CgoJCQkvLyBBZGQgYW50aS1jYWNoZSBpbiB1cmwgaWYgbmVlZGVkCgkJCWlmICggcy5jYWNoZSA9PT0gZmFsc2UgKSB7CgkJCQlzLnVybCA9IHJ0cy50ZXN0KCBjYWNoZVVSTCApID8KCgkJCQkJLy8gSWYgdGhlcmUgaXMgYWxyZWFkeSBhICdfJyBwYXJhbWV0ZXIsIHNldCBpdHMgdmFsdWUKCQkJCQljYWNoZVVSTC5yZXBsYWNlKCBydHMsICIkMV89IiArIG5vbmNlKysgKSA6CgoJCQkJCS8vIE90aGVyd2lzZSBhZGQgb25lIHRvIHRoZSBlbmQKCQkJCQljYWNoZVVSTCArICggcnF1ZXJ5LnRlc3QoIGNhY2hlVVJMICkgPyAiJiIgOiAiPyIgKSArICJfPSIgKyBub25jZSsrOwoJCQl9CgkJfQoKCQkvLyBTZXQgdGhlIElmLU1vZGlmaWVkLVNpbmNlIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciwgaWYgaW4gaWZNb2RpZmllZCBtb2RlLgoJCWlmICggcy5pZk1vZGlmaWVkICkgewoJCQlpZiAoIGpRdWVyeS5sYXN0TW9kaWZpZWRbIGNhY2hlVVJMIF0gKSB7CgkJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiSWYtTW9kaWZpZWQtU2luY2UiLCBqUXVlcnkubGFzdE1vZGlmaWVkWyBjYWNoZVVSTCBdICk7CgkJCX0KCQkJaWYgKCBqUXVlcnkuZXRhZ1sgY2FjaGVVUkwgXSApIHsKCQkJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoICJJZi1Ob25lLU1hdGNoIiwgalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gKTsKCQkJfQoJCX0KCgkJLy8gU2V0IHRoZSBjb3JyZWN0IGhlYWRlciwgaWYgZGF0YSBpcyBiZWluZyBzZW50CgkJaWYgKCBzLmRhdGEgJiYgcy5oYXNDb250ZW50ICYmIHMuY29udGVudFR5cGUgIT09IGZhbHNlIHx8IG9wdGlvbnMuY29udGVudFR5cGUgKSB7CgkJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoICJDb250ZW50LVR5cGUiLCBzLmNvbnRlbnRUeXBlICk7CgkJfQoKCQkvLyBTZXQgdGhlIEFjY2VwdHMgaGVhZGVyIGZvciB0aGUgc2VydmVyLCBkZXBlbmRpbmcgb24gdGhlIGRhdGFUeXBlCgkJanFYSFIuc2V0UmVxdWVzdEhlYWRlcigKCQkJIkFjY2VwdCIsCgkJCXMuZGF0YVR5cGVzWyAwIF0gJiYgcy5hY2NlcHRzWyBzLmRhdGFUeXBlc1sgMCBdIF0gPwoJCQkJcy5hY2NlcHRzWyBzLmRhdGFUeXBlc1sgMCBdIF0gKwoJCQkJCSggcy5kYXRhVHlwZXNbIDAgXSAhPT0gIioiID8gIiwgIiArIGFsbFR5cGVzICsgIjsgcT0wLjAxIiA6ICIiICkgOgoJCQkJcy5hY2NlcHRzWyAiKiIgXQoJCSk7CgoJCS8vIENoZWNrIGZvciBoZWFkZXJzIG9wdGlvbgoJCWZvciAoIGkgaW4gcy5oZWFkZXJzICkgewoJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCBpLCBzLmhlYWRlcnNbIGkgXSApOwoJCX0KCgkJLy8gQWxsb3cgY3VzdG9tIGhlYWRlcnMvbWltZXR5cGVzIGFuZCBlYXJseSBhYm9ydAoJCWlmICggcy5iZWZvcmVTZW5kICYmCgkJCSggcy5iZWZvcmVTZW5kLmNhbGwoIGNhbGxiYWNrQ29udGV4dCwganFYSFIsIHMgKSA9PT0gZmFsc2UgfHwgc3RhdGUgPT09IDIgKSApIHsKCgkJCS8vIEFib3J0IGlmIG5vdCBkb25lIGFscmVhZHkgYW5kIHJldHVybgoJCQlyZXR1cm4ganFYSFIuYWJvcnQoKTsKCQl9CgoJCS8vIGFib3J0aW5nIGlzIG5vIGxvbmdlciBhIGNhbmNlbGxhdGlvbgoJCXN0ckFib3J0ID0gImFib3J0IjsKCgkJLy8gSW5zdGFsbCBjYWxsYmFja3Mgb24gZGVmZXJyZWRzCgkJZm9yICggaSBpbiB7IHN1Y2Nlc3M6IDEsIGVycm9yOiAxLCBjb21wbGV0ZTogMSB9ICkgewoJCQlqcVhIUlsgaSBdKCBzWyBpIF0gKTsKCQl9CgoJCS8vIEdldCB0cmFuc3BvcnQKCQl0cmFuc3BvcnQgPSBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cywgcywgb3B0aW9ucywganFYSFIgKTsKCgkJLy8gSWYgbm8gdHJhbnNwb3J0LCB3ZSBhdXRvLWFib3J0CgkJaWYgKCAhdHJhbnNwb3J0ICkgewoJCQlkb25lKCAtMSwgIk5vIFRyYW5zcG9ydCIgKTsKCQl9IGVsc2UgewoJCQlqcVhIUi5yZWFkeVN0YXRlID0gMTsKCgkJCS8vIFNlbmQgZ2xvYmFsIGV2ZW50CgkJCWlmICggZmlyZUdsb2JhbHMgKSB7CgkJCQlnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlciggImFqYXhTZW5kIiwgWyBqcVhIUiwgcyBdICk7CgkJCX0KCgkJCS8vIElmIHJlcXVlc3Qgd2FzIGFib3J0ZWQgaW5zaWRlIGFqYXhTZW5kLCBzdG9wIHRoZXJlCgkJCWlmICggc3RhdGUgPT09IDIgKSB7CgkJCQlyZXR1cm4ganFYSFI7CgkJCX0KCgkJCS8vIFRpbWVvdXQKCQkJaWYgKCBzLmFzeW5jICYmIHMudGltZW91dCA+IDAgKSB7CgkJCQl0aW1lb3V0VGltZXIgPSB3aW5kb3cuc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCQkJanFYSFIuYWJvcnQoICJ0aW1lb3V0IiApOwoJCQkJfSwgcy50aW1lb3V0ICk7CgkJCX0KCgkJCXRyeSB7CgkJCQlzdGF0ZSA9IDE7CgkJCQl0cmFuc3BvcnQuc2VuZCggcmVxdWVzdEhlYWRlcnMsIGRvbmUgKTsKCQkJfSBjYXRjaCAoIGUgKSB7CgoJCQkJLy8gUHJvcGFnYXRlIGV4Y2VwdGlvbiBhcyBlcnJvciBpZiBub3QgZG9uZQoJCQkJaWYgKCBzdGF0ZSA8IDIgKSB7CgkJCQkJZG9uZSggLTEsIGUgKTsKCgkJCQkvLyBTaW1wbHkgcmV0aHJvdyBvdGhlcndpc2UKCQkJCX0gZWxzZSB7CgkJCQkJdGhyb3cgZTsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gQ2FsbGJhY2sgZm9yIHdoZW4gZXZlcnl0aGluZyBpcyBkb25lCgkJZnVuY3Rpb24gZG9uZSggc3RhdHVzLCBuYXRpdmVTdGF0dXNUZXh0LCByZXNwb25zZXMsIGhlYWRlcnMgKSB7CgkJCXZhciBpc1N1Y2Nlc3MsIHN1Y2Nlc3MsIGVycm9yLCByZXNwb25zZSwgbW9kaWZpZWQsCgkJCQlzdGF0dXNUZXh0ID0gbmF0aXZlU3RhdHVzVGV4dDsKCgkJCS8vIENhbGxlZCBvbmNlCgkJCWlmICggc3RhdGUgPT09IDIgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIFN0YXRlIGlzICJkb25lIiBub3cKCQkJc3RhdGUgPSAyOwoKCQkJLy8gQ2xlYXIgdGltZW91dCBpZiBpdCBleGlzdHMKCQkJaWYgKCB0aW1lb3V0VGltZXIgKSB7CgkJCQl3aW5kb3cuY2xlYXJUaW1lb3V0KCB0aW1lb3V0VGltZXIgKTsKCQkJfQoKCQkJLy8gRGVyZWZlcmVuY2UgdHJhbnNwb3J0IGZvciBlYXJseSBnYXJiYWdlIGNvbGxlY3Rpb24KCQkJLy8gKG5vIG1hdHRlciBob3cgbG9uZyB0aGUganFYSFIgb2JqZWN0IHdpbGwgYmUgdXNlZCkKCQkJdHJhbnNwb3J0ID0gdW5kZWZpbmVkOwoKCQkJLy8gQ2FjaGUgcmVzcG9uc2UgaGVhZGVycwoJCQlyZXNwb25zZUhlYWRlcnNTdHJpbmcgPSBoZWFkZXJzIHx8ICIiOwoKCQkJLy8gU2V0IHJlYWR5U3RhdGUKCQkJanFYSFIucmVhZHlTdGF0ZSA9IHN0YXR1cyA+IDAgPyA0IDogMDsKCgkJCS8vIERldGVybWluZSBpZiBzdWNjZXNzZnVsCgkJCWlzU3VjY2VzcyA9IHN0YXR1cyA+PSAyMDAgJiYgc3RhdHVzIDwgMzAwIHx8IHN0YXR1cyA9PT0gMzA0OwoKCQkJLy8gR2V0IHJlc3BvbnNlIGRhdGEKCQkJaWYgKCByZXNwb25zZXMgKSB7CgkJCQlyZXNwb25zZSA9IGFqYXhIYW5kbGVSZXNwb25zZXMoIHMsIGpxWEhSLCByZXNwb25zZXMgKTsKCQkJfQoKCQkJLy8gQ29udmVydCBubyBtYXR0ZXIgd2hhdCAodGhhdCB3YXkgcmVzcG9uc2VYWFggZmllbGRzIGFyZSBhbHdheXMgc2V0KQoJCQlyZXNwb25zZSA9IGFqYXhDb252ZXJ0KCBzLCByZXNwb25zZSwganFYSFIsIGlzU3VjY2VzcyApOwoKCQkJLy8gSWYgc3VjY2Vzc2Z1bCwgaGFuZGxlIHR5cGUgY2hhaW5pbmcKCQkJaWYgKCBpc1N1Y2Nlc3MgKSB7CgoJCQkJLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIsIGlmIGluIGlmTW9kaWZpZWQgbW9kZS4KCQkJCWlmICggcy5pZk1vZGlmaWVkICkgewoJCQkJCW1vZGlmaWVkID0ganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoICJMYXN0LU1vZGlmaWVkIiApOwoJCQkJCWlmICggbW9kaWZpZWQgKSB7CgkJCQkJCWpRdWVyeS5sYXN0TW9kaWZpZWRbIGNhY2hlVVJMIF0gPSBtb2RpZmllZDsKCQkJCQl9CgkJCQkJbW9kaWZpZWQgPSBqcVhIUi5nZXRSZXNwb25zZUhlYWRlciggImV0YWciICk7CgkJCQkJaWYgKCBtb2RpZmllZCApIHsKCQkJCQkJalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gPSBtb2RpZmllZDsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gaWYgbm8gY29udGVudAoJCQkJaWYgKCBzdGF0dXMgPT09IDIwNCB8fCBzLnR5cGUgPT09ICJIRUFEIiApIHsKCQkJCQlzdGF0dXNUZXh0ID0gIm5vY29udGVudCI7CgoJCQkJLy8gaWYgbm90IG1vZGlmaWVkCgkJCQl9IGVsc2UgaWYgKCBzdGF0dXMgPT09IDMwNCApIHsKCQkJCQlzdGF0dXNUZXh0ID0gIm5vdG1vZGlmaWVkIjsKCgkJCQkvLyBJZiB3ZSBoYXZlIGRhdGEsIGxldCdzIGNvbnZlcnQgaXQKCQkJCX0gZWxzZSB7CgkJCQkJc3RhdHVzVGV4dCA9IHJlc3BvbnNlLnN0YXRlOwoJCQkJCXN1Y2Nlc3MgPSByZXNwb25zZS5kYXRhOwoJCQkJCWVycm9yID0gcmVzcG9uc2UuZXJyb3I7CgkJCQkJaXNTdWNjZXNzID0gIWVycm9yOwoJCQkJfQoJCQl9IGVsc2UgewoKCQkJCS8vIFdlIGV4dHJhY3QgZXJyb3IgZnJvbSBzdGF0dXNUZXh0CgkJCQkvLyB0aGVuIG5vcm1hbGl6ZSBzdGF0dXNUZXh0IGFuZCBzdGF0dXMgZm9yIG5vbi1hYm9ydHMKCQkJCWVycm9yID0gc3RhdHVzVGV4dDsKCQkJCWlmICggc3RhdHVzIHx8ICFzdGF0dXNUZXh0ICkgewoJCQkJCXN0YXR1c1RleHQgPSAiZXJyb3IiOwoJCQkJCWlmICggc3RhdHVzIDwgMCApIHsKCQkJCQkJc3RhdHVzID0gMDsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFNldCBkYXRhIGZvciB0aGUgZmFrZSB4aHIgb2JqZWN0CgkJCWpxWEhSLnN0YXR1cyA9IHN0YXR1czsKCQkJanFYSFIuc3RhdHVzVGV4dCA9ICggbmF0aXZlU3RhdHVzVGV4dCB8fCBzdGF0dXNUZXh0ICkgKyAiIjsKCgkJCS8vIFN1Y2Nlc3MvRXJyb3IKCQkJaWYgKCBpc1N1Y2Nlc3MgKSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY2FsbGJhY2tDb250ZXh0LCBbIHN1Y2Nlc3MsIHN0YXR1c1RleHQsIGpxWEhSIF0gKTsKCQkJfSBlbHNlIHsKCQkJCWRlZmVycmVkLnJlamVjdFdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBqcVhIUiwgc3RhdHVzVGV4dCwgZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwoJCQlqcVhIUi5zdGF0dXNDb2RlKCBzdGF0dXNDb2RlICk7CgkJCXN0YXR1c0NvZGUgPSB1bmRlZmluZWQ7CgoJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoIGlzU3VjY2VzcyA/ICJhamF4U3VjY2VzcyIgOiAiYWpheEVycm9yIiwKCQkJCQlbIGpxWEhSLCBzLCBpc1N1Y2Nlc3MgPyBzdWNjZXNzIDogZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBDb21wbGV0ZQoJCQljb21wbGV0ZURlZmVycmVkLmZpcmVXaXRoKCBjYWxsYmFja0NvbnRleHQsIFsganFYSFIsIHN0YXR1c1RleHQgXSApOwoKCQkJaWYgKCBmaXJlR2xvYmFscyApIHsKCQkJCWdsb2JhbEV2ZW50Q29udGV4dC50cmlnZ2VyKCAiYWpheENvbXBsZXRlIiwgWyBqcVhIUiwgcyBdICk7CgoJCQkJLy8gSGFuZGxlIHRoZSBnbG9iYWwgQUpBWCBjb3VudGVyCgkJCQlpZiAoICEoIC0talF1ZXJ5LmFjdGl2ZSApICkgewoJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyKCAiYWpheFN0b3AiICk7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBqcVhIUjsKCX0sCgoJZ2V0SlNPTjogZnVuY3Rpb24oIHVybCwgZGF0YSwgY2FsbGJhY2sgKSB7CgkJcmV0dXJuIGpRdWVyeS5nZXQoIHVybCwgZGF0YSwgY2FsbGJhY2ssICJqc29uIiApOwoJfSwKCglnZXRTY3JpcHQ6IGZ1bmN0aW9uKCB1cmwsIGNhbGxiYWNrICkgewoJCXJldHVybiBqUXVlcnkuZ2V0KCB1cmwsIHVuZGVmaW5lZCwgY2FsbGJhY2ssICJzY3JpcHQiICk7Cgl9Cn0gKTsKCmpRdWVyeS5lYWNoKCBbICJnZXQiLCAicG9zdCIgXSwgZnVuY3Rpb24oIGksIG1ldGhvZCApIHsKCWpRdWVyeVsgbWV0aG9kIF0gPSBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjaywgdHlwZSApIHsKCgkJLy8gc2hpZnQgYXJndW1lbnRzIGlmIGRhdGEgYXJndW1lbnQgd2FzIG9taXR0ZWQKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBkYXRhICkgKSB7CgkJCXR5cGUgPSB0eXBlIHx8IGNhbGxiYWNrOwoJCQljYWxsYmFjayA9IGRhdGE7CgkJCWRhdGEgPSB1bmRlZmluZWQ7CgkJfQoKCQkvLyBUaGUgdXJsIGNhbiBiZSBhbiBvcHRpb25zIG9iamVjdCAod2hpY2ggdGhlbiBtdXN0IGhhdmUgLnVybCkKCQlyZXR1cm4galF1ZXJ5LmFqYXgoIGpRdWVyeS5leHRlbmQoIHsKCQkJdXJsOiB1cmwsCgkJCXR5cGU6IG1ldGhvZCwKCQkJZGF0YVR5cGU6IHR5cGUsCgkJCWRhdGE6IGRhdGEsCgkJCXN1Y2Nlc3M6IGNhbGxiYWNrCgkJfSwgalF1ZXJ5LmlzUGxhaW5PYmplY3QoIHVybCApICYmIHVybCApICk7Cgl9Owp9ICk7CgoKalF1ZXJ5Ll9ldmFsVXJsID0gZnVuY3Rpb24oIHVybCApIHsKCXJldHVybiBqUXVlcnkuYWpheCggewoJCXVybDogdXJsLAoKCQkvLyBNYWtlIHRoaXMgZXhwbGljaXQsIHNpbmNlIHVzZXIgY2FuIG92ZXJyaWRlIHRoaXMgdGhyb3VnaCBhamF4U2V0dXAgKCMxMTI2NCkKCQl0eXBlOiAiR0VUIiwKCQlkYXRhVHlwZTogInNjcmlwdCIsCgkJY2FjaGU6IHRydWUsCgkJYXN5bmM6IGZhbHNlLAoJCWdsb2JhbDogZmFsc2UsCgkJInRocm93cyI6IHRydWUKCX0gKTsKfTsKCgpqUXVlcnkuZm4uZXh0ZW5kKCB7Cgl3cmFwQWxsOiBmdW5jdGlvbiggaHRtbCApIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBodG1sICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCBpICkgewoJCQkJalF1ZXJ5KCB0aGlzICkud3JhcEFsbCggaHRtbC5jYWxsKCB0aGlzLCBpICkgKTsKCQkJfSApOwoJCX0KCgkJaWYgKCB0aGlzWyAwIF0gKSB7CgoJCQkvLyBUaGUgZWxlbWVudHMgdG8gd3JhcCB0aGUgdGFyZ2V0IGFyb3VuZAoJCQl2YXIgd3JhcCA9IGpRdWVyeSggaHRtbCwgdGhpc1sgMCBdLm93bmVyRG9jdW1lbnQgKS5lcSggMCApLmNsb25lKCB0cnVlICk7CgoJCQlpZiAoIHRoaXNbIDAgXS5wYXJlbnROb2RlICkgewoJCQkJd3JhcC5pbnNlcnRCZWZvcmUoIHRoaXNbIDAgXSApOwoJCQl9CgoJCQl3cmFwLm1hcCggZnVuY3Rpb24oKSB7CgkJCQl2YXIgZWxlbSA9IHRoaXM7CgoJCQkJd2hpbGUgKCBlbGVtLmZpcnN0Q2hpbGQgJiYgZWxlbS5maXJzdENoaWxkLm5vZGVUeXBlID09PSAxICkgewoJCQkJCWVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7CgkJCQl9CgoJCQkJcmV0dXJuIGVsZW07CgkJCX0gKS5hcHBlbmQoIHRoaXMgKTsKCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCgl3cmFwSW5uZXI6IGZ1bmN0aW9uKCBodG1sICkgewoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGh0bWwgKSApIHsKCQkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oIGkgKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS53cmFwSW5uZXIoIGh0bWwuY2FsbCggdGhpcywgaSApICk7CgkJCX0gKTsKCQl9CgoJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCkgewoJCQl2YXIgc2VsZiA9IGpRdWVyeSggdGhpcyApLAoJCQkJY29udGVudHMgPSBzZWxmLmNvbnRlbnRzKCk7CgoJCQlpZiAoIGNvbnRlbnRzLmxlbmd0aCApIHsKCQkJCWNvbnRlbnRzLndyYXBBbGwoIGh0bWwgKTsKCgkJCX0gZWxzZSB7CgkJCQlzZWxmLmFwcGVuZCggaHRtbCApOwoJCQl9CgkJfSApOwoJfSwKCgl3cmFwOiBmdW5jdGlvbiggaHRtbCApIHsKCQl2YXIgaXNGdW5jdGlvbiA9IGpRdWVyeS5pc0Z1bmN0aW9uKCBodG1sICk7CgoJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCBpICkgewoJCQlqUXVlcnkoIHRoaXMgKS53cmFwQWxsKCBpc0Z1bmN0aW9uID8gaHRtbC5jYWxsKCB0aGlzLCBpICkgOiBodG1sICk7CgkJfSApOwoJfSwKCgl1bndyYXA6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnBhcmVudCgpLmVhY2goIGZ1bmN0aW9uKCkgewoJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJib2R5IiApICkgewoJCQkJalF1ZXJ5KCB0aGlzICkucmVwbGFjZVdpdGgoIHRoaXMuY2hpbGROb2RlcyApOwoJCQl9CgkJfSApLmVuZCgpOwoJfQp9ICk7CgoKZnVuY3Rpb24gZ2V0RGlzcGxheSggZWxlbSApIHsKCXJldHVybiBlbGVtLnN0eWxlICYmIGVsZW0uc3R5bGUuZGlzcGxheSB8fCBqUXVlcnkuY3NzKCBlbGVtLCAiZGlzcGxheSIgKTsKfQoKZnVuY3Rpb24gZmlsdGVySGlkZGVuKCBlbGVtICkgewoKCS8vIERpc2Nvbm5lY3RlZCBlbGVtZW50cyBhcmUgY29uc2lkZXJlZCBoaWRkZW4KCWlmICggIWpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50LCBlbGVtICkgKSB7CgkJcmV0dXJuIHRydWU7Cgl9Cgl3aGlsZSAoIGVsZW0gJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQlpZiAoIGdldERpc3BsYXkoIGVsZW0gKSA9PT0gIm5vbmUiIHx8IGVsZW0udHlwZSA9PT0gImhpZGRlbiIgKSB7CgkJCXJldHVybiB0cnVlOwoJCX0KCQllbGVtID0gZWxlbS5wYXJlbnROb2RlOwoJfQoJcmV0dXJuIGZhbHNlOwp9CgpqUXVlcnkuZXhwci5maWx0ZXJzLmhpZGRlbiA9IGZ1bmN0aW9uKCBlbGVtICkgewoKCS8vIFN1cHBvcnQ6IE9wZXJhIDw9IDEyLjEyCgkvLyBPcGVyYSByZXBvcnRzIG9mZnNldFdpZHRocyBhbmQgb2Zmc2V0SGVpZ2h0cyBsZXNzIHRoYW4gemVybyBvbiBzb21lIGVsZW1lbnRzCglyZXR1cm4gc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMoKSA/CgkJKCBlbGVtLm9mZnNldFdpZHRoIDw9IDAgJiYgZWxlbS5vZmZzZXRIZWlnaHQgPD0gMCAmJgoJCQkhZWxlbS5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCApIDoKCQkJZmlsdGVySGlkZGVuKCBlbGVtICk7Cn07CgpqUXVlcnkuZXhwci5maWx0ZXJzLnZpc2libGUgPSBmdW5jdGlvbiggZWxlbSApIHsKCXJldHVybiAhalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4oIGVsZW0gKTsKfTsKCgoKCnZhciByMjAgPSAvJTIwL2csCglyYnJhY2tldCA9IC9cW1xdJC8sCglyQ1JMRiA9IC9ccj9cbi9nLAoJcnN1Ym1pdHRlclR5cGVzID0gL14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLAoJcnN1Ym1pdHRhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8a2V5Z2VuKS9pOwoKZnVuY3Rpb24gYnVpbGRQYXJhbXMoIHByZWZpeCwgb2JqLCB0cmFkaXRpb25hbCwgYWRkICkgewoJdmFyIG5hbWU7CgoJaWYgKCBqUXVlcnkuaXNBcnJheSggb2JqICkgKSB7CgoJCS8vIFNlcmlhbGl6ZSBhcnJheSBpdGVtLgoJCWpRdWVyeS5lYWNoKCBvYmosIGZ1bmN0aW9uKCBpLCB2ICkgewoJCQlpZiAoIHRyYWRpdGlvbmFsIHx8IHJicmFja2V0LnRlc3QoIHByZWZpeCApICkgewoKCQkJCS8vIFRyZWF0IGVhY2ggYXJyYXkgaXRlbSBhcyBhIHNjYWxhci4KCQkJCWFkZCggcHJlZml4LCB2ICk7CgoJCQl9IGVsc2UgewoKCQkJCS8vIEl0ZW0gaXMgbm9uLXNjYWxhciAoYXJyYXkgb3Igb2JqZWN0KSwgZW5jb2RlIGl0cyBudW1lcmljIGluZGV4LgoJCQkJYnVpbGRQYXJhbXMoCgkJCQkJcHJlZml4ICsgIlsiICsgKCB0eXBlb2YgdiA9PT0gIm9iamVjdCIgJiYgdiAhPSBudWxsID8gaSA6ICIiICkgKyAiXSIsCgkJCQkJdiwKCQkJCQl0cmFkaXRpb25hbCwKCQkJCQlhZGQKCQkJCSk7CgkJCX0KCQl9ICk7CgoJfSBlbHNlIGlmICggIXRyYWRpdGlvbmFsICYmIGpRdWVyeS50eXBlKCBvYmogKSA9PT0gIm9iamVjdCIgKSB7CgoJCS8vIFNlcmlhbGl6ZSBvYmplY3QgaXRlbS4KCQlmb3IgKCBuYW1lIGluIG9iaiApIHsKCQkJYnVpbGRQYXJhbXMoIHByZWZpeCArICJbIiArIG5hbWUgKyAiXSIsIG9ialsgbmFtZSBdLCB0cmFkaXRpb25hbCwgYWRkICk7CgkJfQoKCX0gZWxzZSB7CgoJCS8vIFNlcmlhbGl6ZSBzY2FsYXIgaXRlbS4KCQlhZGQoIHByZWZpeCwgb2JqICk7Cgl9Cn0KCi8vIFNlcmlhbGl6ZSBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzIG9yIGEgc2V0IG9mCi8vIGtleS92YWx1ZXMgaW50byBhIHF1ZXJ5IHN0cmluZwpqUXVlcnkucGFyYW0gPSBmdW5jdGlvbiggYSwgdHJhZGl0aW9uYWwgKSB7Cgl2YXIgcHJlZml4LAoJCXMgPSBbXSwKCQlhZGQgPSBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCgkJCS8vIElmIHZhbHVlIGlzIGEgZnVuY3Rpb24sIGludm9rZSBpdCBhbmQgcmV0dXJuIGl0cyB2YWx1ZQoJCQl2YWx1ZSA9IGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApID8gdmFsdWUoKSA6ICggdmFsdWUgPT0gbnVsbCA/ICIiIDogdmFsdWUgKTsKCQkJc1sgcy5sZW5ndGggXSA9IGVuY29kZVVSSUNvbXBvbmVudCgga2V5ICkgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQoIHZhbHVlICk7CgkJfTsKCgkvLyBTZXQgdHJhZGl0aW9uYWwgdG8gdHJ1ZSBmb3IgalF1ZXJ5IDw9IDEuMy4yIGJlaGF2aW9yLgoJaWYgKCB0cmFkaXRpb25hbCA9PT0gdW5kZWZpbmVkICkgewoJCXRyYWRpdGlvbmFsID0galF1ZXJ5LmFqYXhTZXR0aW5ncyAmJiBqUXVlcnkuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsOwoJfQoKCS8vIElmIGFuIGFycmF5IHdhcyBwYXNzZWQgaW4sIGFzc3VtZSB0aGF0IGl0IGlzIGFuIGFycmF5IG9mIGZvcm0gZWxlbWVudHMuCglpZiAoIGpRdWVyeS5pc0FycmF5KCBhICkgfHwgKCBhLmpxdWVyeSAmJiAhalF1ZXJ5LmlzUGxhaW5PYmplY3QoIGEgKSApICkgewoKCQkvLyBTZXJpYWxpemUgdGhlIGZvcm0gZWxlbWVudHMKCQlqUXVlcnkuZWFjaCggYSwgZnVuY3Rpb24oKSB7CgkJCWFkZCggdGhpcy5uYW1lLCB0aGlzLnZhbHVlICk7CgkJfSApOwoKCX0gZWxzZSB7CgoJCS8vIElmIHRyYWRpdGlvbmFsLCBlbmNvZGUgdGhlICJvbGQiIHdheSAodGhlIHdheSAxLjMuMiBvciBvbGRlcgoJCS8vIGRpZCBpdCksIG90aGVyd2lzZSBlbmNvZGUgcGFyYW1zIHJlY3Vyc2l2ZWx5LgoJCWZvciAoIHByZWZpeCBpbiBhICkgewoJCQlidWlsZFBhcmFtcyggcHJlZml4LCBhWyBwcmVmaXggXSwgdHJhZGl0aW9uYWwsIGFkZCApOwoJCX0KCX0KCgkvLyBSZXR1cm4gdGhlIHJlc3VsdGluZyBzZXJpYWxpemF0aW9uCglyZXR1cm4gcy5qb2luKCAiJiIgKS5yZXBsYWNlKCByMjAsICIrIiApOwp9OwoKalF1ZXJ5LmZuLmV4dGVuZCggewoJc2VyaWFsaXplOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4galF1ZXJ5LnBhcmFtKCB0aGlzLnNlcmlhbGl6ZUFycmF5KCkgKTsKCX0sCglzZXJpYWxpemVBcnJheTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMubWFwKCBmdW5jdGlvbigpIHsKCgkJCS8vIENhbiBhZGQgcHJvcEhvb2sgZm9yICJlbGVtZW50cyIgdG8gZmlsdGVyIG9yIGFkZCBmb3JtIGVsZW1lbnRzCgkJCXZhciBlbGVtZW50cyA9IGpRdWVyeS5wcm9wKCB0aGlzLCAiZWxlbWVudHMiICk7CgkJCXJldHVybiBlbGVtZW50cyA/IGpRdWVyeS5tYWtlQXJyYXkoIGVsZW1lbnRzICkgOiB0aGlzOwoJCX0gKQoJCS5maWx0ZXIoIGZ1bmN0aW9uKCkgewoJCQl2YXIgdHlwZSA9IHRoaXMudHlwZTsKCgkJCS8vIFVzZSAuaXMoIjpkaXNhYmxlZCIpIHNvIHRoYXQgZmllbGRzZXRbZGlzYWJsZWRdIHdvcmtzCgkJCXJldHVybiB0aGlzLm5hbWUgJiYgIWpRdWVyeSggdGhpcyApLmlzKCAiOmRpc2FibGVkIiApICYmCgkJCQlyc3VibWl0dGFibGUudGVzdCggdGhpcy5ub2RlTmFtZSApICYmICFyc3VibWl0dGVyVHlwZXMudGVzdCggdHlwZSApICYmCgkJCQkoIHRoaXMuY2hlY2tlZCB8fCAhcmNoZWNrYWJsZVR5cGUudGVzdCggdHlwZSApICk7CgkJfSApCgkJLm1hcCggZnVuY3Rpb24oIGksIGVsZW0gKSB7CgkJCXZhciB2YWwgPSBqUXVlcnkoIHRoaXMgKS52YWwoKTsKCgkJCXJldHVybiB2YWwgPT0gbnVsbCA/CgkJCQludWxsIDoKCQkJCWpRdWVyeS5pc0FycmF5KCB2YWwgKSA/CgkJCQkJalF1ZXJ5Lm1hcCggdmFsLCBmdW5jdGlvbiggdmFsICkgewoJCQkJCQlyZXR1cm4geyBuYW1lOiBlbGVtLm5hbWUsIHZhbHVlOiB2YWwucmVwbGFjZSggckNSTEYsICJcclxuIiApIH07CgkJCQkJfSApIDoKCQkJCQl7IG5hbWU6IGVsZW0ubmFtZSwgdmFsdWU6IHZhbC5yZXBsYWNlKCByQ1JMRiwgIlxyXG4iICkgfTsKCQl9ICkuZ2V0KCk7Cgl9Cn0gKTsKCgovLyBDcmVhdGUgdGhlIHJlcXVlc3Qgb2JqZWN0Ci8vIChUaGlzIGlzIHN0aWxsIGF0dGFjaGVkIHRvIGFqYXhTZXR0aW5ncyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSkKalF1ZXJ5LmFqYXhTZXR0aW5ncy54aHIgPSB3aW5kb3cuQWN0aXZlWE9iamVjdCAhPT0gdW5kZWZpbmVkID8KCgkvLyBTdXBwb3J0OiBJRTYtSUU4CglmdW5jdGlvbigpIHsKCgkJLy8gWEhSIGNhbm5vdCBhY2Nlc3MgbG9jYWwgZmlsZXMsIGFsd2F5cyB1c2UgQWN0aXZlWCBmb3IgdGhhdCBjYXNlCgkJaWYgKCB0aGlzLmlzTG9jYWwgKSB7CgkJCXJldHVybiBjcmVhdGVBY3RpdmVYSFIoKTsKCQl9CgoJCS8vIFN1cHBvcnQ6IElFIDktMTEKCQkvLyBJRSBzZWVtcyB0byBlcnJvciBvbiBjcm9zcy1kb21haW4gUEFUQ0ggcmVxdWVzdHMgd2hlbiBBY3RpdmVYIFhIUgoJCS8vIGlzIHVzZWQuIEluIElFIDkrIGFsd2F5cyB1c2UgdGhlIG5hdGl2ZSBYSFIuCgkJLy8gTm90ZTogdGhpcyBjb25kaXRpb24gd29uJ3QgY2F0Y2ggRWRnZSBhcyBpdCBkb2Vzbid0IGRlZmluZQoJCS8vIGRvY3VtZW50LmRvY3VtZW50TW9kZSBidXQgaXQgYWxzbyBkb2Vzbid0IHN1cHBvcnQgQWN0aXZlWCBzbyBpdCB3b24ndAoJCS8vIHJlYWNoIHRoaXMgY29kZS4KCQlpZiAoIGRvY3VtZW50LmRvY3VtZW50TW9kZSA+IDggKSB7CgkJCXJldHVybiBjcmVhdGVTdGFuZGFyZFhIUigpOwoJCX0KCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIG9sZElFIFhIUiBkb2VzIG5vdCBzdXBwb3J0IG5vbi1SRkMyNjE2IG1ldGhvZHMgKCMxMzI0MCkKCQkvLyBTZWUgaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2llL21zNTM2NjQ4KHY9dnMuODUpLmFzcHgKCQkvLyBhbmQgaHR0cDovL3d3dy53My5vcmcvUHJvdG9jb2xzL3JmYzI2MTYvcmZjMjYxNi1zZWM5Lmh0bWwjc2VjOQoJCS8vIEFsdGhvdWdoIHRoaXMgY2hlY2sgZm9yIHNpeCBtZXRob2RzIGluc3RlYWQgb2YgZWlnaHQKCQkvLyBzaW5jZSBJRSBhbHNvIGRvZXMgbm90IHN1cHBvcnQgInRyYWNlIiBhbmQgImNvbm5lY3QiCgkJcmV0dXJuIC9eKGdldHxwb3N0fGhlYWR8cHV0fGRlbGV0ZXxvcHRpb25zKSQvaS50ZXN0KCB0aGlzLnR5cGUgKSAmJgoJCQljcmVhdGVTdGFuZGFyZFhIUigpIHx8IGNyZWF0ZUFjdGl2ZVhIUigpOwoJfSA6CgoJLy8gRm9yIGFsbCBvdGhlciBicm93c2VycywgdXNlIHRoZSBzdGFuZGFyZCBYTUxIdHRwUmVxdWVzdCBvYmplY3QKCWNyZWF0ZVN0YW5kYXJkWEhSOwoKdmFyIHhocklkID0gMCwKCXhockNhbGxiYWNrcyA9IHt9LAoJeGhyU3VwcG9ydGVkID0galF1ZXJ5LmFqYXhTZXR0aW5ncy54aHIoKTsKCi8vIFN1cHBvcnQ6IElFPDEwCi8vIE9wZW4gcmVxdWVzdHMgbXVzdCBiZSBtYW51YWxseSBhYm9ydGVkIG9uIHVubG9hZCAoIzUyODApCi8vIFNlZSBodHRwczovL3N1cHBvcnQubWljcm9zb2Z0LmNvbS9rYi8yODU2NzQ2IGZvciBtb3JlIGluZm8KaWYgKCB3aW5kb3cuYXR0YWNoRXZlbnQgKSB7Cgl3aW5kb3cuYXR0YWNoRXZlbnQoICJvbnVubG9hZCIsIGZ1bmN0aW9uKCkgewoJCWZvciAoIHZhciBrZXkgaW4geGhyQ2FsbGJhY2tzICkgewoJCQl4aHJDYWxsYmFja3NbIGtleSBdKCB1bmRlZmluZWQsIHRydWUgKTsKCQl9Cgl9ICk7Cn0KCi8vIERldGVybWluZSBzdXBwb3J0IHByb3BlcnRpZXMKc3VwcG9ydC5jb3JzID0gISF4aHJTdXBwb3J0ZWQgJiYgKCAid2l0aENyZWRlbnRpYWxzIiBpbiB4aHJTdXBwb3J0ZWQgKTsKeGhyU3VwcG9ydGVkID0gc3VwcG9ydC5hamF4ID0gISF4aHJTdXBwb3J0ZWQ7CgovLyBDcmVhdGUgdHJhbnNwb3J0IGlmIHRoZSBicm93c2VyIGNhbiBwcm92aWRlIGFuIHhocgppZiAoIHhoclN1cHBvcnRlZCApIHsKCglqUXVlcnkuYWpheFRyYW5zcG9ydCggZnVuY3Rpb24oIG9wdGlvbnMgKSB7CgoJCS8vIENyb3NzIGRvbWFpbiBvbmx5IGFsbG93ZWQgaWYgc3VwcG9ydGVkIHRocm91Z2ggWE1MSHR0cFJlcXVlc3QKCQlpZiAoICFvcHRpb25zLmNyb3NzRG9tYWluIHx8IHN1cHBvcnQuY29ycyApIHsKCgkJCXZhciBjYWxsYmFjazsKCgkJCXJldHVybiB7CgkJCQlzZW5kOiBmdW5jdGlvbiggaGVhZGVycywgY29tcGxldGUgKSB7CgkJCQkJdmFyIGksCgkJCQkJCXhociA9IG9wdGlvbnMueGhyKCksCgkJCQkJCWlkID0gKyt4aHJJZDsKCgkJCQkJLy8gT3BlbiB0aGUgc29ja2V0CgkJCQkJeGhyLm9wZW4oCgkJCQkJCW9wdGlvbnMudHlwZSwKCQkJCQkJb3B0aW9ucy51cmwsCgkJCQkJCW9wdGlvbnMuYXN5bmMsCgkJCQkJCW9wdGlvbnMudXNlcm5hbWUsCgkJCQkJCW9wdGlvbnMucGFzc3dvcmQKCQkJCQkpOwoKCQkJCQkvLyBBcHBseSBjdXN0b20gZmllbGRzIGlmIHByb3ZpZGVkCgkJCQkJaWYgKCBvcHRpb25zLnhockZpZWxkcyApIHsKCQkJCQkJZm9yICggaSBpbiBvcHRpb25zLnhockZpZWxkcyApIHsKCQkJCQkJCXhoclsgaSBdID0gb3B0aW9ucy54aHJGaWVsZHNbIGkgXTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJLy8gT3ZlcnJpZGUgbWltZSB0eXBlIGlmIG5lZWRlZAoJCQkJCWlmICggb3B0aW9ucy5taW1lVHlwZSAmJiB4aHIub3ZlcnJpZGVNaW1lVHlwZSApIHsKCQkJCQkJeGhyLm92ZXJyaWRlTWltZVR5cGUoIG9wdGlvbnMubWltZVR5cGUgKTsKCQkJCQl9CgoJCQkJCS8vIFgtUmVxdWVzdGVkLVdpdGggaGVhZGVyCgkJCQkJLy8gRm9yIGNyb3NzLWRvbWFpbiByZXF1ZXN0cywgc2VlaW5nIGFzIGNvbmRpdGlvbnMgZm9yIGEgcHJlZmxpZ2h0IGFyZQoJCQkJCS8vIGFraW4gdG8gYSBqaWdzYXcgcHV6emxlLCB3ZSBzaW1wbHkgbmV2ZXIgc2V0IGl0IHRvIGJlIHN1cmUuCgkJCQkJLy8gKGl0IGNhbiBhbHdheXMgYmUgc2V0IG9uIGEgcGVyLXJlcXVlc3QgYmFzaXMgb3IgZXZlbiB1c2luZyBhamF4U2V0dXApCgkJCQkJLy8gRm9yIHNhbWUtZG9tYWluIHJlcXVlc3RzLCB3b24ndCBjaGFuZ2UgaGVhZGVyIGlmIGFscmVhZHkgcHJvdmlkZWQuCgkJCQkJaWYgKCAhb3B0aW9ucy5jcm9zc0RvbWFpbiAmJiAhaGVhZGVyc1sgIlgtUmVxdWVzdGVkLVdpdGgiIF0gKSB7CgkJCQkJCWhlYWRlcnNbICJYLVJlcXVlc3RlZC1XaXRoIiBdID0gIlhNTEh0dHBSZXF1ZXN0IjsKCQkJCQl9CgoJCQkJCS8vIFNldCBoZWFkZXJzCgkJCQkJZm9yICggaSBpbiBoZWFkZXJzICkgewoKCQkJCQkJLy8gU3VwcG9ydDogSUU8OQoJCQkJCQkvLyBJRSdzIEFjdGl2ZVhPYmplY3QgdGhyb3dzIGEgJ1R5cGUgTWlzbWF0Y2gnIGV4Y2VwdGlvbiB3aGVuIHNldHRpbmcKCQkJCQkJLy8gcmVxdWVzdCBoZWFkZXIgdG8gYSBudWxsLXZhbHVlLgoJCQkJCQkvLwoJCQkJCQkvLyBUbyBrZWVwIGNvbnNpc3RlbnQgd2l0aCBvdGhlciBYSFIgaW1wbGVtZW50YXRpb25zLCBjYXN0IHRoZSB2YWx1ZQoJCQkJCQkvLyB0byBzdHJpbmcgYW5kIGlnbm9yZSBgdW5kZWZpbmVkYC4KCQkJCQkJaWYgKCBoZWFkZXJzWyBpIF0gIT09IHVuZGVmaW5lZCApIHsKCQkJCQkJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKCBpLCBoZWFkZXJzWyBpIF0gKyAiIiApOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvLyBEbyBzZW5kIHRoZSByZXF1ZXN0CgkJCQkJLy8gVGhpcyBtYXkgcmFpc2UgYW4gZXhjZXB0aW9uIHdoaWNoIGlzIGFjdHVhbGx5CgkJCQkJLy8gaGFuZGxlZCBpbiBqUXVlcnkuYWpheCAoc28gbm8gdHJ5L2NhdGNoIGhlcmUpCgkJCQkJeGhyLnNlbmQoICggb3B0aW9ucy5oYXNDb250ZW50ICYmIG9wdGlvbnMuZGF0YSApIHx8IG51bGwgKTsKCgkJCQkJLy8gTGlzdGVuZXIKCQkJCQljYWxsYmFjayA9IGZ1bmN0aW9uKCBfLCBpc0Fib3J0ICkgewoJCQkJCQl2YXIgc3RhdHVzLCBzdGF0dXNUZXh0LCByZXNwb25zZXM7CgoJCQkJCQkvLyBXYXMgbmV2ZXIgY2FsbGVkIGFuZCBpcyBhYm9ydGVkIG9yIGNvbXBsZXRlCgkJCQkJCWlmICggY2FsbGJhY2sgJiYgKCBpc0Fib3J0IHx8IHhoci5yZWFkeVN0YXRlID09PSA0ICkgKSB7CgoJCQkJCQkJLy8gQ2xlYW4gdXAKCQkJCQkJCWRlbGV0ZSB4aHJDYWxsYmFja3NbIGlkIF07CgkJCQkJCQljYWxsYmFjayA9IHVuZGVmaW5lZDsKCQkJCQkJCXhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBqUXVlcnkubm9vcDsKCgkJCQkJCQkvLyBBYm9ydCBtYW51YWxseSBpZiBuZWVkZWQKCQkJCQkJCWlmICggaXNBYm9ydCApIHsKCQkJCQkJCQlpZiAoIHhoci5yZWFkeVN0YXRlICE9PSA0ICkgewoJCQkJCQkJCQl4aHIuYWJvcnQoKTsKCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXJlc3BvbnNlcyA9IHt9OwoJCQkJCQkJCXN0YXR1cyA9IHhoci5zdGF0dXM7CgoJCQkJCQkJCS8vIFN1cHBvcnQ6IElFPDEwCgkJCQkJCQkJLy8gQWNjZXNzaW5nIGJpbmFyeS1kYXRhIHJlc3BvbnNlVGV4dCB0aHJvd3MgYW4gZXhjZXB0aW9uCgkJCQkJCQkJLy8gKCMxMTQyNikKCQkJCQkJCQlpZiAoIHR5cGVvZiB4aHIucmVzcG9uc2VUZXh0ID09PSAic3RyaW5nIiApIHsKCQkJCQkJCQkJcmVzcG9uc2VzLnRleHQgPSB4aHIucmVzcG9uc2VUZXh0OwoJCQkJCQkJCX0KCgkJCQkJCQkJLy8gRmlyZWZveCB0aHJvd3MgYW4gZXhjZXB0aW9uIHdoZW4gYWNjZXNzaW5nCgkJCQkJCQkJLy8gc3RhdHVzVGV4dCBmb3IgZmF1bHR5IGNyb3NzLWRvbWFpbiByZXF1ZXN0cwoJCQkJCQkJCXRyeSB7CgkJCQkJCQkJCXN0YXR1c1RleHQgPSB4aHIuc3RhdHVzVGV4dDsKCQkJCQkJCQl9IGNhdGNoICggZSApIHsKCgkJCQkJCQkJCS8vIFdlIG5vcm1hbGl6ZSB3aXRoIFdlYmtpdCBnaXZpbmcgYW4gZW1wdHkgc3RhdHVzVGV4dAoJCQkJCQkJCQlzdGF0dXNUZXh0ID0gIiI7CgkJCQkJCQkJfQoKCQkJCQkJCQkvLyBGaWx0ZXIgc3RhdHVzIGZvciBub24gc3RhbmRhcmQgYmVoYXZpb3JzCgoJCQkJCQkJCS8vIElmIHRoZSByZXF1ZXN0IGlzIGxvY2FsIGFuZCB3ZSBoYXZlIGRhdGE6IGFzc3VtZSBhIHN1Y2Nlc3MKCQkJCQkJCQkvLyAoc3VjY2VzcyB3aXRoIG5vIGRhdGEgd29uJ3QgZ2V0IG5vdGlmaWVkLCB0aGF0J3MgdGhlIGJlc3Qgd2UKCQkJCQkJCQkvLyBjYW4gZG8gZ2l2ZW4gY3VycmVudCBpbXBsZW1lbnRhdGlvbnMpCgkJCQkJCQkJaWYgKCAhc3RhdHVzICYmIG9wdGlvbnMuaXNMb2NhbCAmJiAhb3B0aW9ucy5jcm9zc0RvbWFpbiApIHsKCQkJCQkJCQkJc3RhdHVzID0gcmVzcG9uc2VzLnRleHQgPyAyMDAgOiA0MDQ7CgoJCQkJCQkJCS8vIElFIC0gIzE0NTA6IHNvbWV0aW1lcyByZXR1cm5zIDEyMjMgd2hlbiBpdCBzaG91bGQgYmUgMjA0CgkJCQkJCQkJfSBlbHNlIGlmICggc3RhdHVzID09PSAxMjIzICkgewoJCQkJCQkJCQlzdGF0dXMgPSAyMDQ7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgoJCQkJCQkvLyBDYWxsIGNvbXBsZXRlIGlmIG5lZWRlZAoJCQkJCQlpZiAoIHJlc3BvbnNlcyApIHsKCQkJCQkJCWNvbXBsZXRlKCBzdGF0dXMsIHN0YXR1c1RleHQsIHJlc3BvbnNlcywgeGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpICk7CgkJCQkJCX0KCQkJCQl9OwoKCQkJCQkvLyBEbyBzZW5kIHRoZSByZXF1ZXN0CgkJCQkJLy8gYHhoci5zZW5kYCBtYXkgcmFpc2UgYW4gZXhjZXB0aW9uLCBidXQgaXQgd2lsbCBiZQoJCQkJCS8vIGhhbmRsZWQgaW4galF1ZXJ5LmFqYXggKHNvIG5vIHRyeS9jYXRjaCBoZXJlKQoJCQkJCWlmICggIW9wdGlvbnMuYXN5bmMgKSB7CgoJCQkJCQkvLyBJZiB3ZSdyZSBpbiBzeW5jIG1vZGUgd2UgZmlyZSB0aGUgY2FsbGJhY2sKCQkJCQkJY2FsbGJhY2soKTsKCQkJCQl9IGVsc2UgaWYgKCB4aHIucmVhZHlTdGF0ZSA9PT0gNCApIHsKCgkJCQkJCS8vIChJRTYgJiBJRTcpIGlmIGl0J3MgaW4gY2FjaGUgYW5kIGhhcyBiZWVuCgkJCQkJCS8vIHJldHJpZXZlZCBkaXJlY3RseSB3ZSBuZWVkIHRvIGZpcmUgdGhlIGNhbGxiYWNrCgkJCQkJCXdpbmRvdy5zZXRUaW1lb3V0KCBjYWxsYmFjayApOwoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyBSZWdpc3RlciB0aGUgY2FsbGJhY2ssIGJ1dCBkZWxheSBpdCBpbiBjYXNlIGB4aHIuc2VuZGAgdGhyb3dzCgkJCQkJCS8vIEFkZCB0byB0aGUgbGlzdCBvZiBhY3RpdmUgeGhyIGNhbGxiYWNrcwoJCQkJCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlID0geGhyQ2FsbGJhY2tzWyBpZCBdID0gY2FsbGJhY2s7CgkJCQkJfQoJCQkJfSwKCgkJCQlhYm9ydDogZnVuY3Rpb24oKSB7CgkJCQkJaWYgKCBjYWxsYmFjayApIHsKCQkJCQkJY2FsbGJhY2soIHVuZGVmaW5lZCwgdHJ1ZSApOwoJCQkJCX0KCQkJCX0KCQkJfTsKCQl9Cgl9ICk7Cn0KCi8vIEZ1bmN0aW9ucyB0byBjcmVhdGUgeGhycwpmdW5jdGlvbiBjcmVhdGVTdGFuZGFyZFhIUigpIHsKCXRyeSB7CgkJcmV0dXJuIG5ldyB3aW5kb3cuWE1MSHR0cFJlcXVlc3QoKTsKCX0gY2F0Y2ggKCBlICkge30KfQoKZnVuY3Rpb24gY3JlYXRlQWN0aXZlWEhSKCkgewoJdHJ5IHsKCQlyZXR1cm4gbmV3IHdpbmRvdy5BY3RpdmVYT2JqZWN0KCAiTWljcm9zb2Z0LlhNTEhUVFAiICk7Cgl9IGNhdGNoICggZSApIHt9Cn0KCi8vIEFFTSBQYXRjaCAtIFN0YXJ0Ci8vIFByZXZlbnQgYXV0by1leGVjdXRpb24gb2Ygc2NyaXB0cyB3aGVuIG5vIGV4cGxpY2l0IGRhdGFUeXBlIHdhcyBwcm92aWRlZCAoU2VlIGdoLTI0MzIpCi8vIChTZWUgR1JBTklURS0yMDA1OCkKalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoIGZ1bmN0aW9uKCBzICkgewogICAgaWYgKCBzLmNyb3NzRG9tYWluICkgewogICAgICAgIHMuY29udGVudHMuc2NyaXB0ID0gZmFsc2U7CiAgICB9Cn0gKTsKLy8gQUVNIFBhdGNoIC0gRW5kCgoKLy8gSW5zdGFsbCBzY3JpcHQgZGF0YVR5cGUKalF1ZXJ5LmFqYXhTZXR1cCggewoJYWNjZXB0czogewoJCXNjcmlwdDogInRleHQvamF2YXNjcmlwdCwgYXBwbGljYXRpb24vamF2YXNjcmlwdCwgIiArCgkJCSJhcHBsaWNhdGlvbi9lY21hc2NyaXB0LCBhcHBsaWNhdGlvbi94LWVjbWFzY3JpcHQiCgl9LAoJY29udGVudHM6IHsKCQlzY3JpcHQ6IC9cYig/OmphdmF8ZWNtYSlzY3JpcHRcYi8KCX0sCgljb252ZXJ0ZXJzOiB7CgkJInRleHQgc2NyaXB0IjogZnVuY3Rpb24oIHRleHQgKSB7CgkJCWpRdWVyeS5nbG9iYWxFdmFsKCB0ZXh0ICk7CgkJCXJldHVybiB0ZXh0OwoJCX0KCX0KfSApOwoKLy8gSGFuZGxlIGNhY2hlJ3Mgc3BlY2lhbCBjYXNlIGFuZCBnbG9iYWwKalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoICJzY3JpcHQiLCBmdW5jdGlvbiggcyApIHsKCWlmICggcy5jYWNoZSA9PT0gdW5kZWZpbmVkICkgewoJCXMuY2FjaGUgPSBmYWxzZTsKCX0KCWlmICggcy5jcm9zc0RvbWFpbiApIHsKCQlzLnR5cGUgPSAiR0VUIjsKCQlzLmdsb2JhbCA9IGZhbHNlOwoJfQp9ICk7CgovLyBCaW5kIHNjcmlwdCB0YWcgaGFjayB0cmFuc3BvcnQKalF1ZXJ5LmFqYXhUcmFuc3BvcnQoICJzY3JpcHQiLCBmdW5jdGlvbiggcyApIHsKCgkvLyBUaGlzIHRyYW5zcG9ydCBvbmx5IGRlYWxzIHdpdGggY3Jvc3MgZG9tYWluIHJlcXVlc3RzCglpZiAoIHMuY3Jvc3NEb21haW4gKSB7CgoJCXZhciBzY3JpcHQsCgkJCWhlYWQgPSBkb2N1bWVudC5oZWFkIHx8IGpRdWVyeSggImhlYWQiIClbIDAgXSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgoJCXJldHVybiB7CgoJCQlzZW5kOiBmdW5jdGlvbiggXywgY2FsbGJhY2sgKSB7CgoJCQkJc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggInNjcmlwdCIgKTsKCgkJCQlzY3JpcHQuYXN5bmMgPSB0cnVlOwoKCQkJCWlmICggcy5zY3JpcHRDaGFyc2V0ICkgewoJCQkJCXNjcmlwdC5jaGFyc2V0ID0gcy5zY3JpcHRDaGFyc2V0OwoJCQkJfQoKCQkJCXNjcmlwdC5zcmMgPSBzLnVybDsKCgkJCQkvLyBBdHRhY2ggaGFuZGxlcnMgZm9yIGFsbCBicm93c2VycwoJCQkJc2NyaXB0Lm9ubG9hZCA9IHNjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiggXywgaXNBYm9ydCApIHsKCgkJCQkJaWYgKCBpc0Fib3J0IHx8ICFzY3JpcHQucmVhZHlTdGF0ZSB8fCAvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KCBzY3JpcHQucmVhZHlTdGF0ZSApICkgewoKCQkJCQkJLy8gSGFuZGxlIG1lbW9yeSBsZWFrIGluIElFCgkJCQkJCXNjcmlwdC5vbmxvYWQgPSBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDsKCgkJCQkJCS8vIFJlbW92ZSB0aGUgc2NyaXB0CgkJCQkJCWlmICggc2NyaXB0LnBhcmVudE5vZGUgKSB7CgkJCQkJCQlzY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggc2NyaXB0ICk7CgkJCQkJCX0KCgkJCQkJCS8vIERlcmVmZXJlbmNlIHRoZSBzY3JpcHQKCQkJCQkJc2NyaXB0ID0gbnVsbDsKCgkJCQkJCS8vIENhbGxiYWNrIGlmIG5vdCBhYm9ydAoJCQkJCQlpZiAoICFpc0Fib3J0ICkgewoJCQkJCQkJY2FsbGJhY2soIDIwMCwgInN1Y2Nlc3MiICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9OwoKCQkJCS8vIENpcmN1bXZlbnQgSUU2IGJ1Z3Mgd2l0aCBiYXNlIGVsZW1lbnRzICgjMjcwOSBhbmQgIzQzNzgpIGJ5IHByZXBlbmRpbmcKCQkJCS8vIFVzZSBuYXRpdmUgRE9NIG1hbmlwdWxhdGlvbiB0byBhdm9pZCBvdXIgZG9tTWFuaXAgQUpBWCB0cmlja2VyeQoJCQkJaGVhZC5pbnNlcnRCZWZvcmUoIHNjcmlwdCwgaGVhZC5maXJzdENoaWxkICk7CgkJCX0sCgoJCQlhYm9ydDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHNjcmlwdCApIHsKCQkJCQlzY3JpcHQub25sb2FkKCB1bmRlZmluZWQsIHRydWUgKTsKCQkJCX0KCQkJfQoJCX07Cgl9Cn0gKTsKCgoKCnZhciBvbGRDYWxsYmFja3MgPSBbXSwKCXJqc29ucCA9IC8oPSlcPyg/PSZ8JCl8XD9cPy87CgovLyBEZWZhdWx0IGpzb25wIHNldHRpbmdzCmpRdWVyeS5hamF4U2V0dXAoIHsKCWpzb25wOiAiY2FsbGJhY2siLAoJanNvbnBDYWxsYmFjazogZnVuY3Rpb24oKSB7CgkJdmFyIGNhbGxiYWNrID0gb2xkQ2FsbGJhY2tzLnBvcCgpIHx8ICggalF1ZXJ5LmV4cGFuZG8gKyAiXyIgKyAoIG5vbmNlKysgKSApOwoJCXRoaXNbIGNhbGxiYWNrIF0gPSB0cnVlOwoJCXJldHVybiBjYWxsYmFjazsKCX0KfSApOwoKLy8gRGV0ZWN0LCBub3JtYWxpemUgb3B0aW9ucyBhbmQgaW5zdGFsbCBjYWxsYmFja3MgZm9yIGpzb25wIHJlcXVlc3RzCmpRdWVyeS5hamF4UHJlZmlsdGVyKCAianNvbiBqc29ucCIsIGZ1bmN0aW9uKCBzLCBvcmlnaW5hbFNldHRpbmdzLCBqcVhIUiApIHsKCgl2YXIgY2FsbGJhY2tOYW1lLCBvdmVyd3JpdHRlbiwgcmVzcG9uc2VDb250YWluZXIsCgkJanNvblByb3AgPSBzLmpzb25wICE9PSBmYWxzZSAmJiAoIHJqc29ucC50ZXN0KCBzLnVybCApID8KCQkJInVybCIgOgoJCQl0eXBlb2Ygcy5kYXRhID09PSAic3RyaW5nIiAmJgoJCQkJKCBzLmNvbnRlbnRUeXBlIHx8ICIiICkKCQkJCQkuaW5kZXhPZiggImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIgKSA9PT0gMCAmJgoJCQkJcmpzb25wLnRlc3QoIHMuZGF0YSApICYmICJkYXRhIgoJCSk7CgoJLy8gSGFuZGxlIGlmZiB0aGUgZXhwZWN0ZWQgZGF0YSB0eXBlIGlzICJqc29ucCIgb3Igd2UgaGF2ZSBhIHBhcmFtZXRlciB0byBzZXQKCWlmICgganNvblByb3AgfHwgcy5kYXRhVHlwZXNbIDAgXSA9PT0gImpzb25wIiApIHsKCgkJLy8gR2V0IGNhbGxiYWNrIG5hbWUsIHJlbWVtYmVyaW5nIHByZWV4aXN0aW5nIHZhbHVlIGFzc29jaWF0ZWQgd2l0aCBpdAoJCWNhbGxiYWNrTmFtZSA9IHMuanNvbnBDYWxsYmFjayA9IGpRdWVyeS5pc0Z1bmN0aW9uKCBzLmpzb25wQ2FsbGJhY2sgKSA/CgkJCXMuanNvbnBDYWxsYmFjaygpIDoKCQkJcy5qc29ucENhbGxiYWNrOwoKCQkvLyBJbnNlcnQgY2FsbGJhY2sgaW50byB1cmwgb3IgZm9ybSBkYXRhCgkJaWYgKCBqc29uUHJvcCApIHsKCQkJc1sganNvblByb3AgXSA9IHNbIGpzb25Qcm9wIF0ucmVwbGFjZSggcmpzb25wLCAiJDEiICsgY2FsbGJhY2tOYW1lICk7CgkJfSBlbHNlIGlmICggcy5qc29ucCAhPT0gZmFsc2UgKSB7CgkJCXMudXJsICs9ICggcnF1ZXJ5LnRlc3QoIHMudXJsICkgPyAiJiIgOiAiPyIgKSArIHMuanNvbnAgKyAiPSIgKyBjYWxsYmFja05hbWU7CgkJfQoKCQkvLyBVc2UgZGF0YSBjb252ZXJ0ZXIgdG8gcmV0cmlldmUganNvbiBhZnRlciBzY3JpcHQgZXhlY3V0aW9uCgkJcy5jb252ZXJ0ZXJzWyAic2NyaXB0IGpzb24iIF0gPSBmdW5jdGlvbigpIHsKCQkJaWYgKCAhcmVzcG9uc2VDb250YWluZXIgKSB7CgkJCQlqUXVlcnkuZXJyb3IoIGNhbGxiYWNrTmFtZSArICIgd2FzIG5vdCBjYWxsZWQiICk7CgkJCX0KCQkJcmV0dXJuIHJlc3BvbnNlQ29udGFpbmVyWyAwIF07CgkJfTsKCgkJLy8gZm9yY2UganNvbiBkYXRhVHlwZQoJCXMuZGF0YVR5cGVzWyAwIF0gPSAianNvbiI7CgoJCS8vIEluc3RhbGwgY2FsbGJhY2sKCQlvdmVyd3JpdHRlbiA9IHdpbmRvd1sgY2FsbGJhY2tOYW1lIF07CgkJd2luZG93WyBjYWxsYmFja05hbWUgXSA9IGZ1bmN0aW9uKCkgewoJCQlyZXNwb25zZUNvbnRhaW5lciA9IGFyZ3VtZW50czsKCQl9OwoKCQkvLyBDbGVhbi11cCBmdW5jdGlvbiAoZmlyZXMgYWZ0ZXIgY29udmVydGVycykKCQlqcVhIUi5hbHdheXMoIGZ1bmN0aW9uKCkgewoKCQkJLy8gSWYgcHJldmlvdXMgdmFsdWUgZGlkbid0IGV4aXN0IC0gcmVtb3ZlIGl0CgkJCWlmICggb3ZlcndyaXR0ZW4gPT09IHVuZGVmaW5lZCApIHsKCQkJCWpRdWVyeSggd2luZG93ICkucmVtb3ZlUHJvcCggY2FsbGJhY2tOYW1lICk7CgoJCQkvLyBPdGhlcndpc2UgcmVzdG9yZSBwcmVleGlzdGluZyB2YWx1ZQoJCQl9IGVsc2UgewoJCQkJd2luZG93WyBjYWxsYmFja05hbWUgXSA9IG92ZXJ3cml0dGVuOwoJCQl9CgoJCQkvLyBTYXZlIGJhY2sgYXMgZnJlZQoJCQlpZiAoIHNbIGNhbGxiYWNrTmFtZSBdICkgewoKCQkJCS8vIG1ha2Ugc3VyZSB0aGF0IHJlLXVzaW5nIHRoZSBvcHRpb25zIGRvZXNuJ3Qgc2NyZXcgdGhpbmdzIGFyb3VuZAoJCQkJcy5qc29ucENhbGxiYWNrID0gb3JpZ2luYWxTZXR0aW5ncy5qc29ucENhbGxiYWNrOwoKCQkJCS8vIHNhdmUgdGhlIGNhbGxiYWNrIG5hbWUgZm9yIGZ1dHVyZSB1c2UKCQkJCW9sZENhbGxiYWNrcy5wdXNoKCBjYWxsYmFja05hbWUgKTsKCQkJfQoKCQkJLy8gQ2FsbCBpZiBpdCB3YXMgYSBmdW5jdGlvbiBhbmQgd2UgaGF2ZSBhIHJlc3BvbnNlCgkJCWlmICggcmVzcG9uc2VDb250YWluZXIgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIG92ZXJ3cml0dGVuICkgKSB7CgkJCQlvdmVyd3JpdHRlbiggcmVzcG9uc2VDb250YWluZXJbIDAgXSApOwoJCQl9CgoJCQlyZXNwb25zZUNvbnRhaW5lciA9IG92ZXJ3cml0dGVuID0gdW5kZWZpbmVkOwoJCX0gKTsKCgkJLy8gRGVsZWdhdGUgdG8gc2NyaXB0CgkJcmV0dXJuICJzY3JpcHQiOwoJfQp9ICk7CgoKCgovLyBkYXRhOiBzdHJpbmcgb2YgaHRtbAovLyBjb250ZXh0IChvcHRpb25hbCk6IElmIHNwZWNpZmllZCwgdGhlIGZyYWdtZW50IHdpbGwgYmUgY3JlYXRlZCBpbiB0aGlzIGNvbnRleHQsCi8vIGRlZmF1bHRzIHRvIGRvY3VtZW50Ci8vIGtlZXBTY3JpcHRzIChvcHRpb25hbCk6IElmIHRydWUsIHdpbGwgaW5jbHVkZSBzY3JpcHRzIHBhc3NlZCBpbiB0aGUgaHRtbCBzdHJpbmcKalF1ZXJ5LnBhcnNlSFRNTCA9IGZ1bmN0aW9uKCBkYXRhLCBjb250ZXh0LCBrZWVwU2NyaXB0cyApIHsKCWlmICggIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICJzdHJpbmciICkgewoJCXJldHVybiBudWxsOwoJfQoJaWYgKCB0eXBlb2YgY29udGV4dCA9PT0gImJvb2xlYW4iICkgewoJCWtlZXBTY3JpcHRzID0gY29udGV4dDsKCQljb250ZXh0ID0gZmFsc2U7Cgl9Cgljb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsKCgl2YXIgcGFyc2VkID0gcnNpbmdsZVRhZy5leGVjKCBkYXRhICksCgkJc2NyaXB0cyA9ICFrZWVwU2NyaXB0cyAmJiBbXTsKCgkvLyBTaW5nbGUgdGFnCglpZiAoIHBhcnNlZCApIHsKCQlyZXR1cm4gWyBjb250ZXh0LmNyZWF0ZUVsZW1lbnQoIHBhcnNlZFsgMSBdICkgXTsKCX0KCglwYXJzZWQgPSBidWlsZEZyYWdtZW50KCBbIGRhdGEgXSwgY29udGV4dCwgc2NyaXB0cyApOwoKCWlmICggc2NyaXB0cyAmJiBzY3JpcHRzLmxlbmd0aCApIHsKCQlqUXVlcnkoIHNjcmlwdHMgKS5yZW1vdmUoKTsKCX0KCglyZXR1cm4galF1ZXJ5Lm1lcmdlKCBbXSwgcGFyc2VkLmNoaWxkTm9kZXMgKTsKfTsKCgovLyBLZWVwIGEgY29weSBvZiB0aGUgb2xkIGxvYWQgbWV0aG9kCnZhciBfbG9hZCA9IGpRdWVyeS5mbi5sb2FkOwoKLyoqCiAqIExvYWQgYSB1cmwgaW50byBhIHBhZ2UKICovCmpRdWVyeS5mbi5sb2FkID0gZnVuY3Rpb24oIHVybCwgcGFyYW1zLCBjYWxsYmFjayApIHsKCWlmICggdHlwZW9mIHVybCAhPT0gInN0cmluZyIgJiYgX2xvYWQgKSB7CgkJcmV0dXJuIF9sb2FkLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCX0KCgl2YXIgc2VsZWN0b3IsIHR5cGUsIHJlc3BvbnNlLAoJCXNlbGYgPSB0aGlzLAoJCW9mZiA9IHVybC5pbmRleE9mKCAiICIgKTsKCglpZiAoIG9mZiA+IC0xICkgewoJCXNlbGVjdG9yID0galF1ZXJ5LnRyaW0oIHVybC5zbGljZSggb2ZmLCB1cmwubGVuZ3RoICkgKTsKCQl1cmwgPSB1cmwuc2xpY2UoIDAsIG9mZiApOwoJfQoKCS8vIElmIGl0J3MgYSBmdW5jdGlvbgoJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggcGFyYW1zICkgKSB7CgoJCS8vIFdlIGFzc3VtZSB0aGF0IGl0J3MgdGhlIGNhbGxiYWNrCgkJY2FsbGJhY2sgPSBwYXJhbXM7CgkJcGFyYW1zID0gdW5kZWZpbmVkOwoKCS8vIE90aGVyd2lzZSwgYnVpbGQgYSBwYXJhbSBzdHJpbmcKCX0gZWxzZSBpZiAoIHBhcmFtcyAmJiB0eXBlb2YgcGFyYW1zID09PSAib2JqZWN0IiApIHsKCQl0eXBlID0gIlBPU1QiOwoJfQoKCS8vIElmIHdlIGhhdmUgZWxlbWVudHMgdG8gbW9kaWZ5LCBtYWtlIHRoZSByZXF1ZXN0CglpZiAoIHNlbGYubGVuZ3RoID4gMCApIHsKCQlqUXVlcnkuYWpheCggewoJCQl1cmw6IHVybCwKCgkJCS8vIElmICJ0eXBlIiB2YXJpYWJsZSBpcyB1bmRlZmluZWQsIHRoZW4gIkdFVCIgbWV0aG9kIHdpbGwgYmUgdXNlZC4KCQkJLy8gTWFrZSB2YWx1ZSBvZiB0aGlzIGZpZWxkIGV4cGxpY2l0IHNpbmNlCgkJCS8vIHVzZXIgY2FuIG92ZXJyaWRlIGl0IHRocm91Z2ggYWpheFNldHVwIG1ldGhvZAoJCQl0eXBlOiB0eXBlIHx8ICJHRVQiLAoJCQlkYXRhVHlwZTogImh0bWwiLAoJCQlkYXRhOiBwYXJhbXMKCQl9ICkuZG9uZSggZnVuY3Rpb24oIHJlc3BvbnNlVGV4dCApIHsKCgkJCS8vIFNhdmUgcmVzcG9uc2UgZm9yIHVzZSBpbiBjb21wbGV0ZSBjYWxsYmFjawoJCQlyZXNwb25zZSA9IGFyZ3VtZW50czsKCgkJCXNlbGYuaHRtbCggc2VsZWN0b3IgPwoKCQkJCS8vIElmIGEgc2VsZWN0b3Igd2FzIHNwZWNpZmllZCwgbG9jYXRlIHRoZSByaWdodCBlbGVtZW50cyBpbiBhIGR1bW15IGRpdgoJCQkJLy8gRXhjbHVkZSBzY3JpcHRzIHRvIGF2b2lkIElFICdQZXJtaXNzaW9uIERlbmllZCcgZXJyb3JzCgkJCQlqUXVlcnkoICI8ZGl2PiIgKS5hcHBlbmQoIGpRdWVyeS5wYXJzZUhUTUwoIHJlc3BvbnNlVGV4dCApICkuZmluZCggc2VsZWN0b3IgKSA6CgoJCQkJLy8gT3RoZXJ3aXNlIHVzZSB0aGUgZnVsbCByZXN1bHQKCQkJCXJlc3BvbnNlVGV4dCApOwoKCQkvLyBJZiB0aGUgcmVxdWVzdCBzdWNjZWVkcywgdGhpcyBmdW5jdGlvbiBnZXRzICJkYXRhIiwgInN0YXR1cyIsICJqcVhIUiIKCQkvLyBidXQgdGhleSBhcmUgaWdub3JlZCBiZWNhdXNlIHJlc3BvbnNlIHdhcyBzZXQgYWJvdmUuCgkJLy8gSWYgaXQgZmFpbHMsIHRoaXMgZnVuY3Rpb24gZ2V0cyAianFYSFIiLCAic3RhdHVzIiwgImVycm9yIgoJCX0gKS5hbHdheXMoIGNhbGxiYWNrICYmIGZ1bmN0aW9uKCBqcVhIUiwgc3RhdHVzICkgewoJCQlzZWxmLmVhY2goIGZ1bmN0aW9uKCkgewoJCQkJY2FsbGJhY2suYXBwbHkoIHRoaXMsIHJlc3BvbnNlIHx8IFsganFYSFIucmVzcG9uc2VUZXh0LCBzdGF0dXMsIGpxWEhSIF0gKTsKCQkJfSApOwoJCX0gKTsKCX0KCglyZXR1cm4gdGhpczsKfTsKCgoKCi8vIEF0dGFjaCBhIGJ1bmNoIG9mIGZ1bmN0aW9ucyBmb3IgaGFuZGxpbmcgY29tbW9uIEFKQVggZXZlbnRzCmpRdWVyeS5lYWNoKCBbCgkiYWpheFN0YXJ0IiwKCSJhamF4U3RvcCIsCgkiYWpheENvbXBsZXRlIiwKCSJhamF4RXJyb3IiLAoJImFqYXhTdWNjZXNzIiwKCSJhamF4U2VuZCIKXSwgZnVuY3Rpb24oIGksIHR5cGUgKSB7CglqUXVlcnkuZm5bIHR5cGUgXSA9IGZ1bmN0aW9uKCBmbiApIHsKCQlyZXR1cm4gdGhpcy5vbiggdHlwZSwgZm4gKTsKCX07Cn0gKTsKCgoKCmpRdWVyeS5leHByLmZpbHRlcnMuYW5pbWF0ZWQgPSBmdW5jdGlvbiggZWxlbSApIHsKCXJldHVybiBqUXVlcnkuZ3JlcCggalF1ZXJ5LnRpbWVycywgZnVuY3Rpb24oIGZuICkgewoJCXJldHVybiBlbGVtID09PSBmbi5lbGVtOwoJfSApLmxlbmd0aDsKfTsKCgoKCgovKioKICogR2V0cyBhIHdpbmRvdyBmcm9tIGFuIGVsZW1lbnQKICovCmZ1bmN0aW9uIGdldFdpbmRvdyggZWxlbSApIHsKCXJldHVybiBqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSA/CgkJZWxlbSA6CgkJZWxlbS5ub2RlVHlwZSA9PT0gOSA/CgkJCWVsZW0uZGVmYXVsdFZpZXcgfHwgZWxlbS5wYXJlbnRXaW5kb3cgOgoJCQlmYWxzZTsKfQoKalF1ZXJ5Lm9mZnNldCA9IHsKCXNldE9mZnNldDogZnVuY3Rpb24oIGVsZW0sIG9wdGlvbnMsIGkgKSB7CgkJdmFyIGN1clBvc2l0aW9uLCBjdXJMZWZ0LCBjdXJDU1NUb3AsIGN1clRvcCwgY3VyT2Zmc2V0LCBjdXJDU1NMZWZ0LCBjYWxjdWxhdGVQb3NpdGlvbiwKCQkJcG9zaXRpb24gPSBqUXVlcnkuY3NzKCBlbGVtLCAicG9zaXRpb24iICksCgkJCWN1ckVsZW0gPSBqUXVlcnkoIGVsZW0gKSwKCQkJcHJvcHMgPSB7fTsKCgkJLy8gc2V0IHBvc2l0aW9uIGZpcnN0LCBpbi1jYXNlIHRvcC9sZWZ0IGFyZSBzZXQgZXZlbiBvbiBzdGF0aWMgZWxlbQoJCWlmICggcG9zaXRpb24gPT09ICJzdGF0aWMiICkgewoJCQllbGVtLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsKCQl9CgoJCWN1ck9mZnNldCA9IGN1ckVsZW0ub2Zmc2V0KCk7CgkJY3VyQ1NTVG9wID0galF1ZXJ5LmNzcyggZWxlbSwgInRvcCIgKTsKCQljdXJDU1NMZWZ0ID0galF1ZXJ5LmNzcyggZWxlbSwgImxlZnQiICk7CgkJY2FsY3VsYXRlUG9zaXRpb24gPSAoIHBvc2l0aW9uID09PSAiYWJzb2x1dGUiIHx8IHBvc2l0aW9uID09PSAiZml4ZWQiICkgJiYKCQkJalF1ZXJ5LmluQXJyYXkoICJhdXRvIiwgWyBjdXJDU1NUb3AsIGN1ckNTU0xlZnQgXSApID4gLTE7CgoJCS8vIG5lZWQgdG8gYmUgYWJsZSB0byBjYWxjdWxhdGUgcG9zaXRpb24gaWYgZWl0aGVyIHRvcCBvciBsZWZ0CgkJLy8gaXMgYXV0byBhbmQgcG9zaXRpb24gaXMgZWl0aGVyIGFic29sdXRlIG9yIGZpeGVkCgkJaWYgKCBjYWxjdWxhdGVQb3NpdGlvbiApIHsKCQkJY3VyUG9zaXRpb24gPSBjdXJFbGVtLnBvc2l0aW9uKCk7CgkJCWN1clRvcCA9IGN1clBvc2l0aW9uLnRvcDsKCQkJY3VyTGVmdCA9IGN1clBvc2l0aW9uLmxlZnQ7CgkJfSBlbHNlIHsKCQkJY3VyVG9wID0gcGFyc2VGbG9hdCggY3VyQ1NTVG9wICkgfHwgMDsKCQkJY3VyTGVmdCA9IHBhcnNlRmxvYXQoIGN1ckNTU0xlZnQgKSB8fCAwOwoJCX0KCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggb3B0aW9ucyApICkgewoKCQkJLy8gVXNlIGpRdWVyeS5leHRlbmQgaGVyZSB0byBhbGxvdyBtb2RpZmljYXRpb24gb2YgY29vcmRpbmF0ZXMgYXJndW1lbnQgKGdoLTE4NDgpCgkJCW9wdGlvbnMgPSBvcHRpb25zLmNhbGwoIGVsZW0sIGksIGpRdWVyeS5leHRlbmQoIHt9LCBjdXJPZmZzZXQgKSApOwoJCX0KCgkJaWYgKCBvcHRpb25zLnRvcCAhPSBudWxsICkgewoJCQlwcm9wcy50b3AgPSAoIG9wdGlvbnMudG9wIC0gY3VyT2Zmc2V0LnRvcCApICsgY3VyVG9wOwoJCX0KCQlpZiAoIG9wdGlvbnMubGVmdCAhPSBudWxsICkgewoJCQlwcm9wcy5sZWZ0ID0gKCBvcHRpb25zLmxlZnQgLSBjdXJPZmZzZXQubGVmdCApICsgY3VyTGVmdDsKCQl9CgoJCWlmICggInVzaW5nIiBpbiBvcHRpb25zICkgewoJCQlvcHRpb25zLnVzaW5nLmNhbGwoIGVsZW0sIHByb3BzICk7CgkJfSBlbHNlIHsKCQkJY3VyRWxlbS5jc3MoIHByb3BzICk7CgkJfQoJfQp9OwoKalF1ZXJ5LmZuLmV4dGVuZCggewoJb2Zmc2V0OiBmdW5jdGlvbiggb3B0aW9ucyApIHsKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCXJldHVybiBvcHRpb25zID09PSB1bmRlZmluZWQgPwoJCQkJdGhpcyA6CgkJCQl0aGlzLmVhY2goIGZ1bmN0aW9uKCBpICkgewoJCQkJCWpRdWVyeS5vZmZzZXQuc2V0T2Zmc2V0KCB0aGlzLCBvcHRpb25zLCBpICk7CgkJCQl9ICk7CgkJfQoKCQl2YXIgZG9jRWxlbSwgd2luLAoJCQlib3ggPSB7IHRvcDogMCwgbGVmdDogMCB9LAoJCQllbGVtID0gdGhpc1sgMCBdLAoJCQlkb2MgPSBlbGVtICYmIGVsZW0ub3duZXJEb2N1bWVudDsKCgkJaWYgKCAhZG9jICkgewoJCQlyZXR1cm47CgkJfQoKCQlkb2NFbGVtID0gZG9jLmRvY3VtZW50RWxlbWVudDsKCgkJLy8gTWFrZSBzdXJlIGl0J3Mgbm90IGEgZGlzY29ubmVjdGVkIERPTSBub2RlCgkJaWYgKCAhalF1ZXJ5LmNvbnRhaW5zKCBkb2NFbGVtLCBlbGVtICkgKSB7CgkJCXJldHVybiBib3g7CgkJfQoKCQkvLyBJZiB3ZSBkb24ndCBoYXZlIGdCQ1IsIGp1c3QgdXNlIDAsMCByYXRoZXIgdGhhbiBlcnJvcgoJCS8vIEJsYWNrQmVycnkgNSwgaU9TIDMgKG9yaWdpbmFsIGlQaG9uZSkKCQlpZiAoIHR5cGVvZiBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCAhPT0gInVuZGVmaW5lZCIgKSB7CgkJCWJveCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgkJfQoJCXdpbiA9IGdldFdpbmRvdyggZG9jICk7CgkJcmV0dXJuIHsKCQkJdG9wOiBib3gudG9wICArICggd2luLnBhZ2VZT2Zmc2V0IHx8IGRvY0VsZW0uc2Nyb2xsVG9wICkgIC0gKCBkb2NFbGVtLmNsaWVudFRvcCAgfHwgMCApLAoJCQlsZWZ0OiBib3gubGVmdCArICggd2luLnBhZ2VYT2Zmc2V0IHx8IGRvY0VsZW0uc2Nyb2xsTGVmdCApIC0gKCBkb2NFbGVtLmNsaWVudExlZnQgfHwgMCApCgkJfTsKCX0sCgoJcG9zaXRpb246IGZ1bmN0aW9uKCkgewoJCWlmICggIXRoaXNbIDAgXSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIG9mZnNldFBhcmVudCwgb2Zmc2V0LAoJCQlwYXJlbnRPZmZzZXQgPSB7IHRvcDogMCwgbGVmdDogMCB9LAoJCQllbGVtID0gdGhpc1sgMCBdOwoKCQkvLyBGaXhlZCBlbGVtZW50cyBhcmUgb2Zmc2V0IGZyb20gd2luZG93IChwYXJlbnRPZmZzZXQgPSB7dG9wOjAsIGxlZnQ6IDB9LAoJCS8vIGJlY2F1c2UgaXQgaXMgaXRzIG9ubHkgb2Zmc2V0IHBhcmVudAoJCWlmICggalF1ZXJ5LmNzcyggZWxlbSwgInBvc2l0aW9uIiApID09PSAiZml4ZWQiICkgewoKCQkJLy8gd2UgYXNzdW1lIHRoYXQgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IGlzIGF2YWlsYWJsZSB3aGVuIGNvbXB1dGVkIHBvc2l0aW9uIGlzIGZpeGVkCgkJCW9mZnNldCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgkJfSBlbHNlIHsKCgkJCS8vIEdldCAqcmVhbCogb2Zmc2V0UGFyZW50CgkJCW9mZnNldFBhcmVudCA9IHRoaXMub2Zmc2V0UGFyZW50KCk7CgoJCQkvLyBHZXQgY29ycmVjdCBvZmZzZXRzCgkJCW9mZnNldCA9IHRoaXMub2Zmc2V0KCk7CgkJCWlmICggIWpRdWVyeS5ub2RlTmFtZSggb2Zmc2V0UGFyZW50WyAwIF0sICJodG1sIiApICkgewoJCQkJcGFyZW50T2Zmc2V0ID0gb2Zmc2V0UGFyZW50Lm9mZnNldCgpOwoJCQl9CgoJCQkvLyBBZGQgb2Zmc2V0UGFyZW50IGJvcmRlcnMKCQkJcGFyZW50T2Zmc2V0LnRvcCAgKz0galF1ZXJ5LmNzcyggb2Zmc2V0UGFyZW50WyAwIF0sICJib3JkZXJUb3BXaWR0aCIsIHRydWUgKTsKCQkJcGFyZW50T2Zmc2V0LmxlZnQgKz0galF1ZXJ5LmNzcyggb2Zmc2V0UGFyZW50WyAwIF0sICJib3JkZXJMZWZ0V2lkdGgiLCB0cnVlICk7CgkJfQoKCQkvLyBTdWJ0cmFjdCBwYXJlbnQgb2Zmc2V0cyBhbmQgZWxlbWVudCBtYXJnaW5zCgkJLy8gbm90ZTogd2hlbiBhbiBlbGVtZW50IGhhcyBtYXJnaW46IGF1dG8gdGhlIG9mZnNldExlZnQgYW5kIG1hcmdpbkxlZnQKCQkvLyBhcmUgdGhlIHNhbWUgaW4gU2FmYXJpIGNhdXNpbmcgb2Zmc2V0LmxlZnQgdG8gaW5jb3JyZWN0bHkgYmUgMAoJCXJldHVybiB7CgkJCXRvcDogIG9mZnNldC50b3AgIC0gcGFyZW50T2Zmc2V0LnRvcCAtIGpRdWVyeS5jc3MoIGVsZW0sICJtYXJnaW5Ub3AiLCB0cnVlICksCgkJCWxlZnQ6IG9mZnNldC5sZWZ0IC0gcGFyZW50T2Zmc2V0LmxlZnQgLSBqUXVlcnkuY3NzKCBlbGVtLCAibWFyZ2luTGVmdCIsIHRydWUgKQoJCX07Cgl9LAoKCW9mZnNldFBhcmVudDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMubWFwKCBmdW5jdGlvbigpIHsKCQkJdmFyIG9mZnNldFBhcmVudCA9IHRoaXMub2Zmc2V0UGFyZW50OwoKCQkJd2hpbGUgKCBvZmZzZXRQYXJlbnQgJiYgKCAhalF1ZXJ5Lm5vZGVOYW1lKCBvZmZzZXRQYXJlbnQsICJodG1sIiApICYmCgkJCQlqUXVlcnkuY3NzKCBvZmZzZXRQYXJlbnQsICJwb3NpdGlvbiIgKSA9PT0gInN0YXRpYyIgKSApIHsKCQkJCW9mZnNldFBhcmVudCA9IG9mZnNldFBhcmVudC5vZmZzZXRQYXJlbnQ7CgkJCX0KCQkJcmV0dXJuIG9mZnNldFBhcmVudCB8fCBkb2N1bWVudEVsZW1lbnQ7CgkJfSApOwoJfQp9ICk7CgovLyBDcmVhdGUgc2Nyb2xsTGVmdCBhbmQgc2Nyb2xsVG9wIG1ldGhvZHMKalF1ZXJ5LmVhY2goIHsgc2Nyb2xsTGVmdDogInBhZ2VYT2Zmc2V0Iiwgc2Nyb2xsVG9wOiAicGFnZVlPZmZzZXQiIH0sIGZ1bmN0aW9uKCBtZXRob2QsIHByb3AgKSB7Cgl2YXIgdG9wID0gL1kvLnRlc3QoIHByb3AgKTsKCglqUXVlcnkuZm5bIG1ldGhvZCBdID0gZnVuY3Rpb24oIHZhbCApIHsKCQlyZXR1cm4gYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggZWxlbSwgbWV0aG9kLCB2YWwgKSB7CgkJCXZhciB3aW4gPSBnZXRXaW5kb3coIGVsZW0gKTsKCgkJCWlmICggdmFsID09PSB1bmRlZmluZWQgKSB7CgkJCQlyZXR1cm4gd2luID8gKCBwcm9wIGluIHdpbiApID8gd2luWyBwcm9wIF0gOgoJCQkJCXdpbi5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbIG1ldGhvZCBdIDoKCQkJCQllbGVtWyBtZXRob2QgXTsKCQkJfQoKCQkJaWYgKCB3aW4gKSB7CgkJCQl3aW4uc2Nyb2xsVG8oCgkJCQkJIXRvcCA/IHZhbCA6IGpRdWVyeSggd2luICkuc2Nyb2xsTGVmdCgpLAoJCQkJCXRvcCA/IHZhbCA6IGpRdWVyeSggd2luICkuc2Nyb2xsVG9wKCkKCQkJCSk7CgoJCQl9IGVsc2UgewoJCQkJZWxlbVsgbWV0aG9kIF0gPSB2YWw7CgkJCX0KCQl9LCBtZXRob2QsIHZhbCwgYXJndW1lbnRzLmxlbmd0aCwgbnVsbCApOwoJfTsKfSApOwoKLy8gU3VwcG9ydDogU2FmYXJpPDctOCssIENocm9tZTwzNy00NCsKLy8gQWRkIHRoZSB0b3AvbGVmdCBjc3NIb29rcyB1c2luZyBqUXVlcnkuZm4ucG9zaXRpb24KLy8gV2Via2l0IGJ1ZzogaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTI5MDg0Ci8vIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyBwZXJjZW50IHdoZW4gc3BlY2lmaWVkIGZvciB0b3AvbGVmdC9ib3R0b20vcmlnaHQKLy8gcmF0aGVyIHRoYW4gbWFrZSB0aGUgY3NzIG1vZHVsZSBkZXBlbmQgb24gdGhlIG9mZnNldCBtb2R1bGUsIHdlIGp1c3QgY2hlY2sgZm9yIGl0IGhlcmUKalF1ZXJ5LmVhY2goIFsgInRvcCIsICJsZWZ0IiBdLCBmdW5jdGlvbiggaSwgcHJvcCApIHsKCWpRdWVyeS5jc3NIb29rc1sgcHJvcCBdID0gYWRkR2V0SG9va0lmKCBzdXBwb3J0LnBpeGVsUG9zaXRpb24sCgkJZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgewoJCQlpZiAoIGNvbXB1dGVkICkgewoJCQkJY29tcHV0ZWQgPSBjdXJDU1MoIGVsZW0sIHByb3AgKTsKCgkJCQkvLyBpZiBjdXJDU1MgcmV0dXJucyBwZXJjZW50YWdlLCBmYWxsYmFjayB0byBvZmZzZXQKCQkJCXJldHVybiBybnVtbm9ucHgudGVzdCggY29tcHV0ZWQgKSA/CgkJCQkJalF1ZXJ5KCBlbGVtICkucG9zaXRpb24oKVsgcHJvcCBdICsgInB4IiA6CgkJCQkJY29tcHV0ZWQ7CgkJCX0KCQl9CgkpOwp9ICk7CgoKLy8gQ3JlYXRlIGlubmVySGVpZ2h0LCBpbm5lcldpZHRoLCBoZWlnaHQsIHdpZHRoLCBvdXRlckhlaWdodCBhbmQgb3V0ZXJXaWR0aCBtZXRob2RzCmpRdWVyeS5lYWNoKCB7IEhlaWdodDogImhlaWdodCIsIFdpZHRoOiAid2lkdGgiIH0sIGZ1bmN0aW9uKCBuYW1lLCB0eXBlICkgewoJalF1ZXJ5LmVhY2goIHsgcGFkZGluZzogImlubmVyIiArIG5hbWUsIGNvbnRlbnQ6IHR5cGUsICIiOiAib3V0ZXIiICsgbmFtZSB9LAoJZnVuY3Rpb24oIGRlZmF1bHRFeHRyYSwgZnVuY05hbWUgKSB7CgoJCS8vIG1hcmdpbiBpcyBvbmx5IGZvciBvdXRlckhlaWdodCwgb3V0ZXJXaWR0aAoJCWpRdWVyeS5mblsgZnVuY05hbWUgXSA9IGZ1bmN0aW9uKCBtYXJnaW4sIHZhbHVlICkgewoJCQl2YXIgY2hhaW5hYmxlID0gYXJndW1lbnRzLmxlbmd0aCAmJiAoIGRlZmF1bHRFeHRyYSB8fCB0eXBlb2YgbWFyZ2luICE9PSAiYm9vbGVhbiIgKSwKCQkJCWV4dHJhID0gZGVmYXVsdEV4dHJhIHx8ICggbWFyZ2luID09PSB0cnVlIHx8IHZhbHVlID09PSB0cnVlID8gIm1hcmdpbiIgOiAiYm9yZGVyIiApOwoKCQkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIHR5cGUsIHZhbHVlICkgewoJCQkJdmFyIGRvYzsKCgkJCQlpZiAoIGpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJCQkvLyBBcyBvZiA1LzgvMjAxMiB0aGlzIHdpbGwgeWllbGQgaW5jb3JyZWN0IHJlc3VsdHMgZm9yIE1vYmlsZSBTYWZhcmksIGJ1dCB0aGVyZQoJCQkJCS8vIGlzbid0IGEgd2hvbGUgbG90IHdlIGNhbiBkby4gU2VlIHB1bGwgcmVxdWVzdCBhdCB0aGlzIFVSTCBmb3IgZGlzY3Vzc2lvbjoKCQkJCQkvLyBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS9wdWxsLzc2NAoJCQkJCXJldHVybiBlbGVtLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsgImNsaWVudCIgKyBuYW1lIF07CgkJCQl9CgoJCQkJLy8gR2V0IGRvY3VtZW50IHdpZHRoIG9yIGhlaWdodAoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSA5ICkgewoJCQkJCWRvYyA9IGVsZW0uZG9jdW1lbnRFbGVtZW50OwoKCQkJCQkvLyBFaXRoZXIgc2Nyb2xsW1dpZHRoL0hlaWdodF0gb3Igb2Zmc2V0W1dpZHRoL0hlaWdodF0gb3IgY2xpZW50W1dpZHRoL0hlaWdodF0sCgkJCQkJLy8gd2hpY2hldmVyIGlzIGdyZWF0ZXN0CgkJCQkJLy8gdW5mb3J0dW5hdGVseSwgdGhpcyBjYXVzZXMgYnVnICMzODM4IGluIElFNi84IG9ubHksCgkJCQkJLy8gYnV0IHRoZXJlIGlzIGN1cnJlbnRseSBubyBnb29kLCBzbWFsbCB3YXkgdG8gZml4IGl0LgoJCQkJCXJldHVybiBNYXRoLm1heCgKCQkJCQkJZWxlbS5ib2R5WyAic2Nyb2xsIiArIG5hbWUgXSwgZG9jWyAic2Nyb2xsIiArIG5hbWUgXSwKCQkJCQkJZWxlbS5ib2R5WyAib2Zmc2V0IiArIG5hbWUgXSwgZG9jWyAib2Zmc2V0IiArIG5hbWUgXSwKCQkJCQkJZG9jWyAiY2xpZW50IiArIG5hbWUgXQoJCQkJCSk7CgkJCQl9CgoJCQkJcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPwoKCQkJCQkvLyBHZXQgd2lkdGggb3IgaGVpZ2h0IG9uIHRoZSBlbGVtZW50LCByZXF1ZXN0aW5nIGJ1dCBub3QgZm9yY2luZyBwYXJzZUZsb2F0CgkJCQkJalF1ZXJ5LmNzcyggZWxlbSwgdHlwZSwgZXh0cmEgKSA6CgoJCQkJCS8vIFNldCB3aWR0aCBvciBoZWlnaHQgb24gdGhlIGVsZW1lbnQKCQkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIHR5cGUsIHZhbHVlLCBleHRyYSApOwoJCQl9LCB0eXBlLCBjaGFpbmFibGUgPyBtYXJnaW4gOiB1bmRlZmluZWQsIGNoYWluYWJsZSwgbnVsbCApOwoJCX07Cgl9ICk7Cn0gKTsKCgpqUXVlcnkuZm4uZXh0ZW5kKCB7CgoJYmluZDogZnVuY3Rpb24oIHR5cGVzLCBkYXRhLCBmbiApIHsKCQlyZXR1cm4gdGhpcy5vbiggdHlwZXMsIG51bGwsIGRhdGEsIGZuICk7Cgl9LAoJdW5iaW5kOiBmdW5jdGlvbiggdHlwZXMsIGZuICkgewoJCXJldHVybiB0aGlzLm9mZiggdHlwZXMsIG51bGwsIGZuICk7Cgl9LAoKCWRlbGVnYXRlOiBmdW5jdGlvbiggc2VsZWN0b3IsIHR5cGVzLCBkYXRhLCBmbiApIHsKCQlyZXR1cm4gdGhpcy5vbiggdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiApOwoJfSwKCXVuZGVsZWdhdGU6IGZ1bmN0aW9uKCBzZWxlY3RvciwgdHlwZXMsIGZuICkgewoKCQkvLyAoIG5hbWVzcGFjZSApIG9yICggc2VsZWN0b3IsIHR5cGVzIFssIGZuXSApCgkJcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPwoJCQl0aGlzLm9mZiggc2VsZWN0b3IsICIqKiIgKSA6CgkJCXRoaXMub2ZmKCB0eXBlcywgc2VsZWN0b3IgfHwgIioqIiwgZm4gKTsKCX0KfSApOwoKLy8gVGhlIG51bWJlciBvZiBlbGVtZW50cyBjb250YWluZWQgaW4gdGhlIG1hdGNoZWQgZWxlbWVudCBzZXQKalF1ZXJ5LmZuLnNpemUgPSBmdW5jdGlvbigpIHsKCXJldHVybiB0aGlzLmxlbmd0aDsKfTsKCmpRdWVyeS5mbi5hbmRTZWxmID0galF1ZXJ5LmZuLmFkZEJhY2s7CgoKCgovLyBSZWdpc3RlciBhcyBhIG5hbWVkIEFNRCBtb2R1bGUsIHNpbmNlIGpRdWVyeSBjYW4gYmUgY29uY2F0ZW5hdGVkIHdpdGggb3RoZXIKLy8gZmlsZXMgdGhhdCBtYXkgdXNlIGRlZmluZSwgYnV0IG5vdCB2aWEgYSBwcm9wZXIgY29uY2F0ZW5hdGlvbiBzY3JpcHQgdGhhdAovLyB1bmRlcnN0YW5kcyBhbm9ueW1vdXMgQU1EIG1vZHVsZXMuIEEgbmFtZWQgQU1EIGlzIHNhZmVzdCBhbmQgbW9zdCByb2J1c3QKLy8gd2F5IHRvIHJlZ2lzdGVyLiBMb3dlcmNhc2UganF1ZXJ5IGlzIHVzZWQgYmVjYXVzZSBBTUQgbW9kdWxlIG5hbWVzIGFyZQovLyBkZXJpdmVkIGZyb20gZmlsZSBuYW1lcywgYW5kIGpRdWVyeSBpcyBub3JtYWxseSBkZWxpdmVyZWQgaW4gYSBsb3dlcmNhc2UKLy8gZmlsZSBuYW1lLiBEbyB0aGlzIGFmdGVyIGNyZWF0aW5nIHRoZSBnbG9iYWwgc28gdGhhdCBpZiBhbiBBTUQgbW9kdWxlIHdhbnRzCi8vIHRvIGNhbGwgbm9Db25mbGljdCB0byBoaWRlIHRoaXMgdmVyc2lvbiBvZiBqUXVlcnksIGl0IHdpbGwgd29yay4KCi8vIE5vdGUgdGhhdCBmb3IgbWF4aW11bSBwb3J0YWJpbGl0eSwgbGlicmFyaWVzIHRoYXQgYXJlIG5vdCBqUXVlcnkgc2hvdWxkCi8vIGRlY2xhcmUgdGhlbXNlbHZlcyBhcyBhbm9ueW1vdXMgbW9kdWxlcywgYW5kIGF2b2lkIHNldHRpbmcgYSBnbG9iYWwgaWYgYW4KLy8gQU1EIGxvYWRlciBpcyBwcmVzZW50LiBqUXVlcnkgaXMgYSBzcGVjaWFsIGNhc2UuIEZvciBtb3JlIGluZm9ybWF0aW9uLCBzZWUKLy8gaHR0cHM6Ly9naXRodWIuY29tL2pyYnVya2UvcmVxdWlyZWpzL3dpa2kvVXBkYXRpbmctZXhpc3RpbmctbGlicmFyaWVzI3dpa2ktYW5vbgoKaWYgKCB0eXBlb2YgZGVmaW5lID09PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQgKSB7CglkZWZpbmUoICJqcXVlcnkiLCBbXSwgZnVuY3Rpb24oKSB7CgkJcmV0dXJuIGpRdWVyeTsKCX0gKTsKfQoKCgp2YXIKCgkvLyBNYXAgb3ZlciBqUXVlcnkgaW4gY2FzZSBvZiBvdmVyd3JpdGUKCV9qUXVlcnkgPSB3aW5kb3cualF1ZXJ5LAoKCS8vIE1hcCBvdmVyIHRoZSAkIGluIGNhc2Ugb2Ygb3ZlcndyaXRlCglfJCA9IHdpbmRvdy4kOwoKalF1ZXJ5Lm5vQ29uZmxpY3QgPSBmdW5jdGlvbiggZGVlcCApIHsKCWlmICggd2luZG93LiQgPT09IGpRdWVyeSApIHsKCQl3aW5kb3cuJCA9IF8kOwoJfQoKCWlmICggZGVlcCAmJiB3aW5kb3cualF1ZXJ5ID09PSBqUXVlcnkgKSB7CgkJd2luZG93LmpRdWVyeSA9IF9qUXVlcnk7Cgl9CgoJcmV0dXJuIGpRdWVyeTsKfTsKCi8vIEV4cG9zZSBqUXVlcnkgYW5kICQgaWRlbnRpZmllcnMsIGV2ZW4gaW4KLy8gQU1EICgjNzEwMiNjb21tZW50OjEwLCBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS9wdWxsLzU1NykKLy8gYW5kIENvbW1vbkpTIGZvciBicm93c2VyIGVtdWxhdG9ycyAoIzEzNTY2KQppZiAoICFub0dsb2JhbCApIHsKCXdpbmRvdy5qUXVlcnkgPSB3aW5kb3cuJCA9IGpRdWVyeTsKfQoKcmV0dXJuIGpRdWVyeTsKfSkpOwoKalF1ZXJ5LnVhTWF0Y2ggPSBmdW5jdGlvbiggdWEgKSB7CiAgICB1YSA9IHVhLnRvTG93ZXJDYXNlKCk7CgogICAgdmFyIG1hdGNoID0gLyhjaHJvbWUpWyBcL10oW1x3Ll0rKS8uZXhlYyggdWEgKSB8fAogICAgICAgIC8od2Via2l0KVsgXC9dKFtcdy5dKykvLmV4ZWMoIHVhICkgfHwKICAgICAgICAvKG9wZXJhKSg/Oi4qdmVyc2lvbnwpWyBcL10oW1x3Ll0rKS8uZXhlYyggdWEgKSB8fAogICAgICAgIC8obXNpZSkgKFtcdy5dKykvLmV4ZWMoIHVhICkgfHwKICAgICAgICB1YS5pbmRleE9mKCJjb21wYXRpYmxlIikgPCAwICYmIC8obW96aWxsYSkoPzouKj8gcnY6KFtcdy5dKyl8KS8uZXhlYyggdWEgKSB8fAogICAgICAgIFtdOwoKICAgIHJldHVybiB7CiAgICAgICAgYnJvd3NlcjogbWF0Y2hbIDEgXSB8fCAiIiwKICAgICAgICB2ZXJzaW9uOiBtYXRjaFsgMiBdIHx8ICIwIgogICAgfTsKfTsKCi8vIERvbid0IGNsb2JiZXIgYW55IGV4aXN0aW5nIGpRdWVyeS5icm93c2VyIGluIGNhc2UgaXQncyBkaWZmZXJlbnQKaWYgKCAhalF1ZXJ5LmJyb3dzZXIgKSB7CiAgICBtYXRjaGVkID0galF1ZXJ5LnVhTWF0Y2goIG5hdmlnYXRvci51c2VyQWdlbnQgKTsKICAgIGJyb3dzZXIgPSB7fTsKCiAgICBpZiAoIG1hdGNoZWQuYnJvd3NlciApIHsKICAgICAgICBicm93c2VyWyBtYXRjaGVkLmJyb3dzZXIgXSA9IHRydWU7CiAgICAgICAgYnJvd3Nlci52ZXJzaW9uID0gbWF0Y2hlZC52ZXJzaW9uOwogICAgfQoKICAgIC8vIENocm9tZSBpcyBXZWJraXQsIGJ1dCBXZWJraXQgaXMgYWxzbyBTYWZhcmkuCiAgICBpZiAoIGJyb3dzZXIuY2hyb21lICkgewogICAgICAgIGJyb3dzZXIud2Via2l0ID0gdHJ1ZTsKICAgIH0gZWxzZSBpZiAoIGJyb3dzZXIud2Via2l0ICkgewogICAgICAgIGJyb3dzZXIuc2FmYXJpID0gdHJ1ZTsKICAgIH0KCiAgICBqUXVlcnkuYnJvd3NlciA9IGJyb3dzZXI7Cn0KCiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewogICAgdmFyIHBhZ2VJbmZvTWV0YSA9ICQoJ2hlYWQgbWV0YVtuYW1lPXBhZ2VpbmZvXScpOwogICAgLy9nZXQgdXNlciBpbmZvcm1hdGlvbgogICAgZ2V0VXNlckluZm8ocGFnZUluZm9NZXRhKTsKfSk7CgpmdW5jdGlvbiBnZXRVc2VySW5mbyhwYWdlSW5mb01ldGEpIHsKICAgIGNvbnN0IGxvZ2luQ29tcG9uZW50ID0gJCgnLmxvZ2luJykuY2xvbmUoKTsKICAgIGNvbnN0IHJlZ2lzdHJhdGlvbk1vZGFsID0gJCgnLnJlZ2lzdGVyTW9kYWwnKTsKICAgIGNvbnN0IHdlbGNvbWVIZWFkZXIgPSAkKCcjd2VsY29tZUhlYWRlcicpOwogICAgY29uc3QgY2MgPSBwYWdlSW5mb01ldGEuZGF0YSgnY2MnKTsKICAgIGNvbnN0IGxjID0gcGFnZUluZm9NZXRhLmRhdGEoJ2xjJyk7CiAgICBjb25zdCB1cmwgPSBwYWdlSW5mb01ldGEuZGF0YSgndXJsJyk7CiAgICB2YXIgd2Vic2VydmVyVVJMID0gcGFnZUluZm9NZXRhLmRhdGEoJ3dlYnNlcnZlcnVybCcpOwogICAgdmFyIHBhcmFtcyA9ICJjYz0iICsgY2MgKyAiJmxjPSIgKyBsYyArICImcGFnZXVybD0iICsgdXJsOwogICAgdmFyIHNpZ25JblVSTCA9ICIvaHAtcHBzLXNlcnZpY2VzL2F1dGgvbG9naW4/IiArIHBhcmFtczsKICAgIHZhciByZWdpc3RlclVSTCA9ICIvaHAtcHBzLXNlcnZpY2VzL2F1dGgvcmVnaXN0cmF0aW9uPyIgKyBwYXJhbXM7CiAgICB2YXIgc2lnbk91dFVSTCA9ICIvaHAtcHBzLXNlcnZpY2VzL2F1dGgvbG9nb3V0PyIgKyBwYXJhbXM7CiAgICB2YXIgZGFzaGJvYXJkRkFRVVJMID0gIi8iICsgY2MgKyAiLSIgKyBsYyArIGxvZ2luQ29tcG9uZW50LmZpbmQoIiNkYWhib2FyZEZBUUxpbmtNb2IiKS5kYXRhKCdsaW5rJyk7IAogICAgdmFyIGRhc2hib2FyZFVSTCA9ICIvIiArIGNjICsgIi0iICsgbGMgKyBsb2dpbkNvbXBvbmVudC5maW5kKCIjZGFoYm9hcmRMaW5rTW9iIikuZGF0YSgnbGluaycpOyAKICAgIGxvZ2luQ29tcG9uZW50LmZpbmQoIiNlZGl0UHJvZmlsZUxpbmtNb2IiKS5hdHRyKCJocmVmIiwgbG9naW5Db21wb25lbnQuZmluZCgiI2VkaXRQcm9maWxlTGlua01vYiIpLmRhdGEoJ2xpbmsnKSk7CiAgICBsb2dpbkNvbXBvbmVudC5maW5kKCIjZGFoYm9hcmRGQVFMaW5rTW9iIikuYXR0cigiaHJlZiIsIGRhc2hib2FyZEZBUVVSTCk7CiAgICBsb2dpbkNvbXBvbmVudC5maW5kKCIjZGFoYm9hcmRMaW5rTW9iIikuYXR0cigiaHJlZiIsIGRhc2hib2FyZFVSTCk7CiAgICBsb2dpbkNvbXBvbmVudC5maW5kKCIjc2lnbkluSGVhZGVyTGluayIpLmF0dHIoImhyZWYiLCBzaWduSW5VUkwpOwogICAgbG9naW5Db21wb25lbnQuZmluZCgiI3NpZ25PdXRMaW5rTW9iIikuYXR0cigiaHJlZiIsIHNpZ25PdXRVUkwpOwoKICAgIC8vSHAtQWNjb3VudCBTaWduLWluCgljb25zdCBocEFjY1NpZ25VcmwgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAiLy8iICsgd2luZG93LmxvY2F0aW9uLmhvc3QgKyAiLyIgKyBjYyArICItIiArIGxjICsgIi8iICsgImRhc2hib2FyZCI7CiAgICB2YXIgYWNjb3VudHBhcmFtcyA9ICJjYz0iICsgY2MgKyAiJmxjPSIgKyBsYyArICImcGFnZXVybD0iICsgaHBBY2NTaWduVXJsOwkKCXZhciBzaWduSW5BY2NvdW50VXJsID0gIi9ocC1wcHMtc2VydmljZXMvYXV0aC9sb2dpbj8iICsgYWNjb3VudHBhcmFtczsKCSQoJyNocGlkRXhpc3RpbmdBY2N0U2lnbkluQnRuJykuYXR0cigiaHJlZiIsc2lnbkluQWNjb3VudFVybCk7CiAgICAkKCcjaHBpZENyZWF0ZVBlcnNvbmFsQWNjdEJ0bicpLmF0dHIoImhyZWYiLHNpZ25JbkFjY291bnRVcmwpOwogICAgJCgnI2hwaWRDcmVhdGVQZXJzb25hbEFjY3RCdG5Cb3R0b20nKS5hdHRyKCJocmVmIixyZWdpc3RlclVSTCk7CiAgICByZWdpc3RyYXRpb25Nb2RhbC5maW5kKCcjYnRuQ3JlYXRlUGVyc29uYWxBQycpLm9uKCJjbGljayIsIGZ1bmN0aW9uKCl7CiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWY9cmVnaXN0ZXJVUkw7CiAgICB9KTsKCiAgICByZWdpc3RyYXRpb25Nb2RhbC5maW5kKCcjYnRuQ3JlYXRlQnVzaW5lc3NBQycpLm9uKCJjbGljayIsIGZ1bmN0aW9uKCl7CiAgICAgICAgY29uc3QgbGluayA9ICQodGhpcykuZGF0YSgibGluayIpOwogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPWxpbms7CiAgICB9KTsKCiAgICAvL3ZhciBwcm9kdWN0c1VSTCA9ICIvY29udGVudC9wcm9kdWN0cy5odG1sIgogICAgdmFyIHByb2R1Y3RzVVJMID0gIi8iK2NjICsgIi0iICsgbGMgKyAiL3Byb2R1Y3RzIjsKICAgICQuYWpheCh7CiAgICAgICAgdHlwZTogIkdFVCIsCiAgICAgICAgdXJsOiBwcm9kdWN0c1VSTCwKICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHsKICAgICAgICAgICAgaWYgKHJlcy5pbmRleE9mKCJ1c2VyUHJvZmlsZUpzb24gPSAneyIpID49IDEpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG15UmVnZXhwID0gL3siY3VzdG9tZXJJZCI6Lip9L2c7CiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IG15UmVnZXhwLmV4ZWMocmVzKTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZEF1dGhEYXRhID0gc2FmZVBhcnNlSlNPTihtYXRjaFswXSk7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBhcnNlZEF1dGhEYXRhICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdlbGNvbWVNZXNzYWdlID0gIGxvZ2luQ29tcG9uZW50LmZpbmQoJyN3ZWxjb21lTWVzc2FnZU5ldycpOwogICAgICAgICAgICAgICAgICAgICBsb2dpbkNvbXBvbmVudC5maW5kKCcjdXNlckZpcnN0TmFtZScpLnRleHQocGFyc2VkQXV0aERhdGFbJ2ZpcnN0TmFtZSddKTsKICAgICAgICAgICAgICAgICAgICBsb2dpbkNvbXBvbmVudC5maW5kKCcuc2lnbkluUmVnaXN0ZXJMaW5rJykuaGlkZSgpOwoKICAgICAgICAgICAgICAgICAgICBpZih3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCJrci1rbyIpID4gLTEgfHwgd2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZigianAtamEiKSA+IC0xKXsKICAgICAgICAgICAgICAgICAgICAgICAgbG9naW5Db21wb25lbnQuZmluZCgnI3VzZXJMYXN0TmFtZScpLnRleHQocGFyc2VkQXV0aERhdGFbJ2xhc3ROYW1lJ10pOwoJCQkJCQlsb2dpbkNvbXBvbmVudC5maW5kKCcjbmFtZVNpZ25hdHVyZScpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB3ZWxjb21lTWVzc2FnZS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgd2VsY29tZUhlYWRlci5hcHBlbmQobG9naW5Db21wb25lbnQuaHRtbCgpKTsKCQkJCQl1cGRhdGVHREwocGFyc2VkQXV0aERhdGEpOwogICAgICAgICAgICAgICAgICAgIC8vc2hvdyBkYXNoYm9hcmQgbGluayBpbiBzZWNvbmRhcnkgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlY05hdkRhc2hib2FyZCA9ICQoJ2xpIGEuY29uc3VtZXItb25seScpOwogICAgICAgICAgICAgICAgICAgIHNlY05hdkRhc2hib2FyZC5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgICAgIHNlY05hdkRhc2hib2FyZC5wYXJlbnQoJ2xpJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICBsb2dpbkNvbXBvbmVudC5maW5kKCcuc2lnbkluUmVnaXN0ZXJMaW5rJykuc2hvdygpOwogICAgICAgICAgICAgICB3ZWxjb21lSGVhZGVyLmFwcGVuZChsb2dpbkNvbXBvbmVudC5odG1sKCkpOwoKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZmFpbCA6IGZ1bmN0aW9uKCl7CiAgICAgICAgbG9naW5Db21wb25lbnQuZmluZCgnLnNpZ25JblJlZ2lzdGVyTGluaycpLnNob3coKTsKICAgICAgICAgICAgIHdlbGNvbWVIZWFkZXIuYXBwZW5kKGxvZ2luQ29tcG9uZW50Lmh0bWwoKSk7CiAgICB9LAogICAgICAgIGVycm9yIDogZnVuY3Rpb24oKXsKICAgICAgICBsb2dpbkNvbXBvbmVudC5maW5kKCcuc2lnbkluUmVnaXN0ZXJMaW5rJykuc2hvdygpOwogICAgICAgICAgICAgd2VsY29tZUhlYWRlci5hcHBlbmQobG9naW5Db21wb25lbnQuaHRtbCgpKTsKICAgIH0KICAgIH0pOwp9CgpmdW5jdGlvbiBzYWZlUGFyc2VKU09OKGpzb25EYXRhKSB7CiAgICBsZXQgcGFyc2VkRGF0YTsKICAgIHRyeSB7CiAgICAgICAgcGFyc2VkRGF0YSA9IEpTT04ucGFyc2UoanNvbkRhdGEpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmxvZygnRXJyb3Igb2NjdXJlZCB3aGlsZSBwYXJzaW5nIGRhdGEgaW4gYXV0aCBzZXJ2aWNlJywgZXJyb3IpOwogICAgfQogICAgcmV0dXJuIHBhcnNlZERhdGE7Cn0KCmZ1bmN0aW9uIHNpZ25vdXQoZXZlbnQpIHsKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICB2YXIgcGFnZUluZm9NZXRhID0gJCgnaGVhZCBtZXRhW25hbWU9cGFnZWluZm9dJyk7CiAgICB2YXIgY2MgPSBwYWdlSW5mb01ldGEuZGF0YSgnY2MnKTsKICAgIHZhciBsYyA9IHBhZ2VJbmZvTWV0YS5kYXRhKCdsYycpOwogICAgdmFyIHBhcmFtcyA9ICJjYz0iICsgY2MgKyAiJmxjPSIgKyBsYyArICImcGFnZXVybD0iICsgd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICB2YXIgc2lnbk91dFVSTCA9ICIvaHAtcHBzLXNlcnZpY2VzL2F1dGgvbG9nb3V0PyIgKyBwYXJhbXM7CiAgICAkLmFqYXgoewogICAgICAgIHR5cGU6ICJHRVQiLAogICAgICAgIHVybDogc2lnbk91dFVSTCwKICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1VzZXIgTG9nZ2VkIG91dCEnKTsKICAgICAgICB9CgogICAgfSk7Cn0KCmZ1bmN0aW9uIHNob3dtb2RlbCgpewogICAgY29uc3QgaWNvbiA9ICQoJyN3ZWxjb21lTWVzc2FnZU5ldycpLmZpbmQoJy5mYScpOwogICAgY29uc3QgcHJvZmlsZVV0aWxpdHlNZW51TW9iID0gJCgnI3Byb2ZpbGVVdGlsaXR5TWVudU1vYicpOwogICAgaWYoaWNvbi5oYXNDbGFzcygnZmEtY2FyZXQtZG93bicpKXsKCQlpY29uLnJlbW92ZUNsYXNzKCdmYS1jYXJldC1kb3duJyk7CiAgICAJaWNvbi5hZGRDbGFzcygnZmEtY2FyZXQtdXAnKTsKICAgICAgICBwcm9maWxlVXRpbGl0eU1lbnVNb2IuYWRkQ2xhc3MoJ3Nob3cnKTsKICAgICAgICBwcm9maWxlVXRpbGl0eU1lbnVNb2Iuc2hvdygpOwoJfWVsc2V7CgkJaWNvbi5yZW1vdmVDbGFzcygnZmEtY2FyZXQtdXAnKTsKICAgIAlpY29uLmFkZENsYXNzKCdmYS1jYXJldC1kb3duJyk7CiAgICAgICAgcHJvZmlsZVV0aWxpdHlNZW51TW9iLnJlbW92ZUNsYXNzKCdzaG93Jyk7CiAgICAgICAgcHJvZmlsZVV0aWxpdHlNZW51TW9iLmhpZGUoKTsKCX0KfQoKZnVuY3Rpb24gdXBkYXRlR0RMKHBhcnNlZEF1dGhEYXRhKSB7CiAgICBpZiAodHlwZW9mIHBhcnNlZEF1dGhEYXRhWydwcm9maWxlVHlwZSddICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIGlmIChwYXJzZWRBdXRoRGF0YVsncHJvZmlsZVR5cGUnXSA9PSAnQ09OU1VNRVInKSB7CiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnY3VzdG9tZXJTdGF0ZScsICdQZXJzb25hbCcpOwogICAgICAgIH0gZWxzZSBpZiAocGFyc2VkQXV0aERhdGFbJ3Byb2ZpbGVUeXBlJ10gPT0gJ0NPTU1FUkNJQUwnKSB7CiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnY3VzdG9tZXJTdGF0ZScsICdCdXNpbmVzcycpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnY3VzdG9tZXJTdGF0ZScsIHBhcnNlZEF1dGhEYXRhWydwcm9maWxlVHlwZSddKTsKICAgICAgICB9CiAgICB9Cgp9CgogZnVuY3Rpb24gc2hvd1JlZ2lzdHJhdGlvbk1vZGVsKGV2ZW50KXsKICAgIGNvbnN0IHJlZ2lzdHJhdGlvbk1vZGFsID0gJCgnLnJlZ2lzdGVyTW9kYWwnKTsKICAgIC8vcmVnaXN0cmF0aW9uTW9kYWwuY2xvc2VzdCgnI3NpZ25pbi1yZWdpc3Rlci1tb2RhbCcpLmFkZENsYXNzKCdtb2RhbHNob3cnKTsKICAgIHJlZ2lzdHJhdGlvbk1vZGFsLmNsb3Nlc3QoJyNzaWduaW4tcmVnaXN0ZXItbW9kYWwnKS5hZGRDbGFzcygnaW4nKTsKICAgIHJlZ2lzdHJhdGlvbk1vZGFsLmNsb3Nlc3QoJy5tb2RhbC1kaWFsb2cnKS5yZW1vdmVDbGFzcygnaGlkZScpOwoKfQovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogKiBDb3B5cmlnaHQgMjAxOSBBZG9iZQogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgovKioKICogRWxlbWVudC5tYXRjaGVzKCkKICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW5VUy9kb2NzL1dlYi9BUEkvRWxlbWVudC9tYXRjaGVzI1BvbHlmaWxsCiAqLwppZiAoIUVsZW1lbnQucHJvdG90eXBlLm1hdGNoZXMpIHsKICAgIEVsZW1lbnQucHJvdG90eXBlLm1hdGNoZXMgPSBFbGVtZW50LnByb3RvdHlwZS5tc01hdGNoZXNTZWxlY3RvciB8fCBFbGVtZW50LnByb3RvdHlwZS53ZWJraXRNYXRjaGVzU2VsZWN0b3I7Cn0KCi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB2YWxpZC1qc2RvYwovKioKICogRWxlbWVudC5jbG9zZXN0KCkKICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW5VUy9kb2NzL1dlYi9BUEkvRWxlbWVudC9jbG9zZXN0I1BvbHlmaWxsCiAqLwppZiAoIUVsZW1lbnQucHJvdG90eXBlLmNsb3Nlc3QpIHsKICAgIEVsZW1lbnQucHJvdG90eXBlLmNsb3Nlc3QgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciBlbCA9IHRoaXM7CiAgICAgICAgaWYgKCFkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY29udGFpbnMoZWwpKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBkbyB7CiAgICAgICAgICAgIGlmIChlbC5tYXRjaGVzKHMpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWwgPSBlbC5wYXJlbnRFbGVtZW50IHx8IGVsLnBhcmVudE5vZGU7CiAgICAgICAgfSB3aGlsZSAoZWwgIT09IG51bGwgJiYgZWwubm9kZVR5cGUgPT09IDEpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfTsKfQoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICogQ29weXJpZ2h0IDIwMTkgQWRvYmUKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KKGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBOUyA9ICJjbXAiOwogICAgdmFyIElTID0gImFjY29yZGlvbiI7CgogICAgdmFyIGtleUNvZGVzID0gewogICAgICAgIEVOVEVSOiAxMywKICAgICAgICBTUEFDRTogMzIsCiAgICAgICAgRU5EOiAzNSwKICAgICAgICBIT01FOiAzNiwKICAgICAgICBBUlJPV19MRUZUOiAzNywKICAgICAgICBBUlJPV19VUDogMzgsCiAgICAgICAgQVJST1dfUklHSFQ6IDM5LAogICAgICAgIEFSUk9XX0RPV046IDQwCiAgICB9OwoKICAgIHZhciBzZWxlY3RvcnMgPSB7CiAgICAgICAgc2VsZjogIltkYXRhLSIgKyAgTlMgKyAnLWlzPSInICsgSVMgKyAnIl0nCiAgICB9OwoKICAgIHZhciBjc3NDbGFzc2VzID0gewogICAgICAgIGJ1dHRvbjogewogICAgICAgICAgICBkaXNhYmxlZDogImNtcC1hY2NvcmRpb25fX2J1dHRvbi0tZGlzYWJsZWQiLAogICAgICAgICAgICBleHBhbmRlZDogImNtcC1hY2NvcmRpb25fX2J1dHRvbi0tZXhwYW5kZWQiCiAgICAgICAgfSwKICAgICAgICBwYW5lbDogewogICAgICAgICAgICBoaWRkZW46ICJjbXAtYWNjb3JkaW9uX19wYW5lbC0taGlkZGVuIiwKICAgICAgICAgICAgZXhwYW5kZWQ6ICJjbXAtYWNjb3JkaW9uX19wYW5lbC0tZXhwYW5kZWQiCiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgZGF0YUF0dHJpYnV0ZXMgPSB7CiAgICAgICAgaXRlbTogewogICAgICAgICAgICBleHBhbmRlZDogImRhdGEtY21wLWV4cGFuZGVkIgogICAgICAgIH0KICAgIH07CgogICAgdmFyIHByb3BlcnRpZXMgPSB7CiAgICAgICAgLyoqCiAgICAgICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIGEgc2luZ2xlIGFjY29yZGlvbiBpdGVtIGlzIGZvcmNlZCB0byBiZSBleHBhbmRlZCBhdCBhIHRpbWUuCiAgICAgICAgICogRXhwYW5kaW5nIG9uZSBpdGVtIHdpbGwgY29sbGFwc2UgYWxsIG90aGVycy4KICAgICAgICAgKgogICAgICAgICAqIEBtZW1iZXJvZiBBY2NvcmRpb24KICAgICAgICAgKiBAdHlwZSB7Qm9vbGVhbn0KICAgICAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICAgICAqLwogICAgICAgICJzaW5nbGVFeHBhbnNpb24iOiB7CiAgICAgICAgICAgICJkZWZhdWx0IjogZmFsc2UsCiAgICAgICAgICAgICJ0cmFuc2Zvcm0iOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICEodmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSAidW5kZWZpbmVkIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogQWNjb3JkaW9uIENvbmZpZ3VyYXRpb24uCiAgICAgKgogICAgICogQHR5cGVkZWYge09iamVjdH0gQWNjb3JkaW9uQ29uZmlnIFJlcHJlc2VudHMgYW4gQWNjb3JkaW9uIGNvbmZpZ3VyYXRpb24KICAgICAqIEBwcm9wZXJ0eSB7SFRNTEVsZW1lbnR9IGVsZW1lbnQgVGhlIEhUTUxFbGVtZW50IHJlcHJlc2VudGluZyB0aGUgQWNjb3JkaW9uCiAgICAgKiBAcHJvcGVydHkge09iamVjdH0gb3B0aW9ucyBUaGUgQWNjb3JkaW9uIG9wdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogQWNjb3JkaW9uLgogICAgICoKICAgICAqIEBjbGFzcyBBY2NvcmRpb24KICAgICAqIEBjbGFzc2Rlc2MgQW4gaW50ZXJhY3RpdmUgQWNjb3JkaW9uIGNvbXBvbmVudCBmb3IgdG9nZ2xpbmcgcGFuZWxzIG9mIHJlbGF0ZWQgY29udGVudAogICAgICogQHBhcmFtIHtBY2NvcmRpb25Db25maWd9IGNvbmZpZyBUaGUgQWNjb3JkaW9uIGNvbmZpZ3VyYXRpb24KICAgICAqLwogICAgZnVuY3Rpb24gQWNjb3JkaW9uKGNvbmZpZykgewogICAgICAgIHZhciB0aGF0ID0gdGhpczsKCiAgICAgICAgaWYgKGNvbmZpZyAmJiBjb25maWcuZWxlbWVudCkgewogICAgICAgICAgICBpbml0KGNvbmZpZyk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBJbml0aWFsaXplcyB0aGUgQWNjb3JkaW9uLgogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKiBAcGFyYW0ge0FjY29yZGlvbkNvbmZpZ30gY29uZmlnIFRoZSBBY2NvcmRpb24gY29uZmlndXJhdGlvbgogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGluaXQoY29uZmlnKSB7CiAgICAgICAgICAgIC8vIHByZXZlbnRzIG11bHRpcGxlIGluaXRpYWxpemF0aW9uCiAgICAgICAgICAgIGNvbmZpZy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgiZGF0YS0iICsgTlMgKyAiLWlzIik7CgogICAgICAgICAgICBzZXR1cFByb3BlcnRpZXMoY29uZmlnLm9wdGlvbnMpOwogICAgICAgICAgICBjYWNoZUVsZW1lbnRzKGNvbmZpZy5lbGVtZW50KTsKCiAgICAgICAgICAgIGlmICh0aGF0Ll9lbGVtZW50c1siaXRlbSJdKSB7CiAgICAgICAgICAgICAgICAvLyBlbnN1cmVzIG11bHRpcGxlIGVsZW1lbnQgdHlwZXMgYXJlIGFycmF5cy4KICAgICAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzWyJpdGVtIl0gPSBBcnJheS5pc0FycmF5KHRoYXQuX2VsZW1lbnRzWyJpdGVtIl0pID8gdGhhdC5fZWxlbWVudHNbIml0ZW0iXSA6IFt0aGF0Ll9lbGVtZW50c1siaXRlbSJdXTsKICAgICAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzWyJidXR0b24iXSA9IEFycmF5LmlzQXJyYXkodGhhdC5fZWxlbWVudHNbImJ1dHRvbiJdKSA/IHRoYXQuX2VsZW1lbnRzWyJidXR0b24iXSA6IFt0aGF0Ll9lbGVtZW50c1siYnV0dG9uIl1dOwogICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHNbInBhbmVsIl0gPSBBcnJheS5pc0FycmF5KHRoYXQuX2VsZW1lbnRzWyJwYW5lbCJdKSA/IHRoYXQuX2VsZW1lbnRzWyJwYW5lbCJdIDogW3RoYXQuX2VsZW1lbnRzWyJwYW5lbCJdXTsKCiAgICAgICAgICAgICAgICBpZiAodGhhdC5fcHJvcGVydGllcy5zaW5nbGVFeHBhbnNpb24pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZXhwYW5kZWRJdGVtcyA9IGdldEV4cGFuZGVkSXRlbXMoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBleHBhbmRlZCBpdGVtIGFubm90YXRlZCwgZm9yY2UgdGhlIGZpcnN0IGl0ZW0gdG8gZGlzcGxheS4KICAgICAgICAgICAgICAgICAgICBpZiAoZXhwYW5kZWRJdGVtcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlKDApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBtdWx0aXBsZSBleHBhbmRlZCBpdGVtcyBhbm5vdGF0ZWQsIGRpc3BsYXkgdGhlIGxhc3QgaXRlbSBvcGVuLgogICAgICAgICAgICAgICAgICAgIGlmIChleHBhbmRlZEl0ZW1zLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlKGV4cGFuZGVkSXRlbXMubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJlZnJlc2hJdGVtcygpOwogICAgICAgICAgICAgICAgYmluZEV2ZW50cygpOwoKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuR3Jhbml0ZSAmJiB3aW5kb3cuR3Jhbml0ZS5hdXRob3IgJiYgd2luZG93LkdyYW5pdGUuYXV0aG9yLk1lc3NhZ2VDaGFubmVsKSB7CiAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgKiBFZGl0b3IgbWVzc2FnZSBoYW5kbGluZzoKICAgICAgICAgICAgICAgICAgICAgKiAtIHN1YnNjcmliZSB0byAiY21wLnBhbmVsY29udGFpbmVyIiBtZXNzYWdlIHJlcXVlc3RzIHNlbnQgYnkgdGhlIGVkaXRvciBmcmFtZQogICAgICAgICAgICAgICAgICAgICAqIC0gY2hlY2sgdGhhdCB0aGUgbWVzc2FnZSBkYXRhIHBhbmVsIGNvbnRhaW5lciB0eXBlIGlzIGNvcnJlY3QgYW5kIHRoYXQgdGhlIGlkIChwYXRoKSBtYXRjaGVzIHRoaXMgc3BlY2lmaWMgQWNjb3JkaW9uIGNvbXBvbmVudAogICAgICAgICAgICAgICAgICAgICAqIC0gaWYgc28sIHJvdXRlIHRoZSAibmF2aWdhdGUiIG9wZXJhdGlvbiB0byBlbmFjdCBhIG5hdmlnYXRpb24gb2YgdGhlIEFjY29yZGlvbiBiYXNlZCBvbiBpbmRleCBkYXRhCiAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgbmV3IHdpbmRvdy5HcmFuaXRlLmF1dGhvci5NZXNzYWdlQ2hhbm5lbCgiY3FhdXRob3IiLCB3aW5kb3cpLnN1YnNjcmliZVJlcXVlc3RNZXNzYWdlKCJjbXAucGFuZWxjb250YWluZXIiLCBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmRhdGEgJiYgbWVzc2FnZS5kYXRhLnR5cGUgPT09ICJjbXAtYWNjb3JkaW9uIiAmJiBtZXNzYWdlLmRhdGEuaWQgPT09IHRoYXQuX2VsZW1lbnRzLnNlbGYuZGF0YXNldFsiY21wUGFuZWxjb250YWluZXJJZCJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5kYXRhLm9wZXJhdGlvbiA9PT0gIm5hdmlnYXRlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN3aXRjaCB0byBzaW5nbGUgZXhwYW5zaW9uIG1vZGUgd2hlbiBuYXZpZ2F0aW5nIGluIGVkaXQgbW9kZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2luZ2xlRXhwYW5zaW9uID0gdGhhdC5fcHJvcGVydGllcy5zaW5nbGVFeHBhbnNpb247CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fcHJvcGVydGllcy5zaW5nbGVFeHBhbnNpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZShtZXNzYWdlLmRhdGEuaW5kZXgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZXZlcnQgdG8gdGhlIGNvbmZpZ3VyZWQgc3RhdGUuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fcHJvcGVydGllcy5zaW5nbGVFeHBhbnNpb24gPSBzaW5nbGVFeHBhbnNpb247CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ2FjaGVzIHRoZSBBY2NvcmRpb24gZWxlbWVudHMgYXMgZGVmaW5lZCB2aWEgdGhlIHtAY29kZSBkYXRhLWFjY29yZGlvbi1ob29rPSJFTEVNRU5UX05BTUUifSBtYXJrdXAgQVBJLgogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSB3cmFwcGVyIFRoZSBBY2NvcmRpb24gd3JhcHBlciBlbGVtZW50CiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gY2FjaGVFbGVtZW50cyh3cmFwcGVyKSB7CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzID0ge307CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLnNlbGYgPSB3cmFwcGVyOwogICAgICAgICAgICB2YXIgaG9va3MgPSB0aGF0Ll9lbGVtZW50cy5zZWxmLnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLSIgKyBOUyArICItaG9vay0iICsgSVMgKyAiXSIpOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBob29rcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGhvb2sgPSBob29rc1tpXTsKICAgICAgICAgICAgICAgIGlmIChob29rLmNsb3Nlc3QoIi4iICsgTlMgKyAiLSIgKyBJUykgPT09IHRoYXQuX2VsZW1lbnRzLnNlbGYpIHsgLy8gb25seSBwcm9jZXNzIG93biBhY2NvcmRpb24gZWxlbWVudHMKICAgICAgICAgICAgICAgICAgICB2YXIgY2FwaXRhbGl6ZWQgPSBJUzsKICAgICAgICAgICAgICAgICAgICBjYXBpdGFsaXplZCA9IGNhcGl0YWxpemVkLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgY2FwaXRhbGl6ZWQuc2xpY2UoMSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IGhvb2suZGF0YXNldFtOUyArICJIb29rIiArIGNhcGl0YWxpemVkXTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5fZWxlbWVudHNba2V5XSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodGhhdC5fZWxlbWVudHNba2V5XSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSB0aGF0Ll9lbGVtZW50c1trZXldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHNba2V5XSA9IFt0bXBdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzW2tleV0ucHVzaChob29rKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50c1trZXldID0gaG9vazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNldHMgdXAgcHJvcGVydGllcyBmb3IgdGhlIEFjY29yZGlvbiBiYXNlZCBvbiB0aGUgcGFzc2VkIG9wdGlvbnMuCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIFRoZSBBY2NvcmRpb24gb3B0aW9ucwogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIHNldHVwUHJvcGVydGllcyhvcHRpb25zKSB7CiAgICAgICAgICAgIHRoYXQuX3Byb3BlcnRpZXMgPSB7fTsKCiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHByb3BlcnR5ID0gcHJvcGVydGllc1trZXldOwogICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnNba2V5XSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gb3B0aW9uc1trZXldOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdHJhbnNmb3JtIHRoZSBwcm92aWRlZCBvcHRpb24KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5ICYmIHR5cGVvZiBwcm9wZXJ0eS50cmFuc2Zvcm0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcHJvcGVydHkudHJhbnNmb3JtKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlIHN0aWxsIG51bGwsIHRha2UgdGhlIHByb3BlcnR5IGRlZmF1bHQKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwcm9wZXJ0aWVzW2tleV1bImRlZmF1bHQiXTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRoYXQuX3Byb3BlcnRpZXNba2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBCaW5kcyBBY2NvcmRpb24gZXZlbnQgaGFuZGxpbmcuCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGJpbmRFdmVudHMoKSB7CiAgICAgICAgICAgIHZhciBidXR0b25zID0gdGhhdC5fZWxlbWVudHNbImJ1dHRvbiJdOwogICAgICAgICAgICBpZiAoYnV0dG9ucykgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBidXR0b25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbnNbaV0uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlKGluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvY3VzQnV0dG9uKGluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbnNbaV0uYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkJ1dHRvbktleURvd24oZXZlbnQsIGluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEhhbmRsZXMgYnV0dG9uIGtleWRvd24gZXZlbnRzLgogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIGtleWRvd24gZXZlbnQKICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSBidXR0b24gdHJpZ2dlcmluZyB0aGUgZXZlbnQKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBvbkJ1dHRvbktleURvd24oZXZlbnQsIGluZGV4KSB7CiAgICAgICAgICAgIHZhciBsYXN0SW5kZXggPSB0aGF0Ll9lbGVtZW50c1siYnV0dG9uIl0ubGVuZ3RoIC0gMTsKCiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkgewogICAgICAgICAgICAgICAgY2FzZSBrZXlDb2Rlcy5BUlJPV19MRUZUOgogICAgICAgICAgICAgICAgY2FzZSBrZXlDb2Rlcy5BUlJPV19VUDoKICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXNCdXR0b24oaW5kZXggLSAxKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGtleUNvZGVzLkFSUk9XX1JJR0hUOgogICAgICAgICAgICAgICAgY2FzZSBrZXlDb2Rlcy5BUlJPV19ET1dOOgogICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgbGFzdEluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvY3VzQnV0dG9uKGluZGV4ICsgMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBrZXlDb2Rlcy5IT01FOgogICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgZm9jdXNCdXR0b24oMCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGtleUNvZGVzLkVORDoKICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGZvY3VzQnV0dG9uKGxhc3RJbmRleCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGtleUNvZGVzLkVOVEVSOgogICAgICAgICAgICAgICAgY2FzZSBrZXlDb2Rlcy5TUEFDRToKICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIHRvZ2dsZShpbmRleCk7CiAgICAgICAgICAgICAgICAgICAgZm9jdXNCdXR0b24oaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEdlbmVyYWwgaGFuZGxlciBmb3IgdG9nZ2xlIG9mIGFuIGl0ZW0uCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIGl0ZW0gdG8gdG9nZ2xlCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlKGluZGV4KSB7CiAgICAgICAgICAgIHZhciBpdGVtID0gdGhhdC5fZWxlbWVudHNbIml0ZW0iXVtpbmRleF07CiAgICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAodGhhdC5fcHJvcGVydGllcy5zaW5nbGVFeHBhbnNpb24pIHsKICAgICAgICAgICAgICAgICAgICAvLyBlbnN1cmUgb25seSBhIHNpbmdsZSBpdGVtIGlzIGV4cGFuZGVkIGlmIHNpbmdsZSBleHBhbnNpb24gaXMgZW5hYmxlZC4KICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoYXQuX2VsZW1lbnRzWyJpdGVtIl0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuX2VsZW1lbnRzWyJpdGVtIl1baV0gIT09IGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleHBhbmRlZCA9IGdldEl0ZW1FeHBhbmRlZCh0aGF0Ll9lbGVtZW50c1siaXRlbSJdW2ldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleHBhbmRlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldEl0ZW1FeHBhbmRlZCh0aGF0Ll9lbGVtZW50c1siaXRlbSJdW2ldLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2V0SXRlbUV4cGFuZGVkKGl0ZW0sIHRydWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZXRJdGVtRXhwYW5kZWQoaXRlbSwgIWdldEl0ZW1FeHBhbmRlZChpdGVtKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNldHMgYW4gaXRlbSdzIGV4cGFuZGVkIHN0YXRlIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBmbGFnIGFuZCByZWZyZXNoZXMgaXRzIGludGVybmFscy4KICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gaXRlbSBUaGUgaXRlbSB0byBtYXJrIGFzIGV4cGFuZGVkLCBvciBub3QgZXhwYW5kZWQKICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGV4cGFuZGVkIHRydWUgdG8gbWFyayB0aGUgaXRlbSBleHBhbmRlZCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gc2V0SXRlbUV4cGFuZGVkKGl0ZW0sIGV4cGFuZGVkKSB7CiAgICAgICAgICAgIGlmIChleHBhbmRlZCkgewogICAgICAgICAgICAgICAgaXRlbS5zZXRBdHRyaWJ1dGUoZGF0YUF0dHJpYnV0ZXMuaXRlbS5leHBhbmRlZCwgIiIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaXRlbS5yZW1vdmVBdHRyaWJ1dGUoZGF0YUF0dHJpYnV0ZXMuaXRlbS5leHBhbmRlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVmcmVzaEl0ZW0oaXRlbSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBHZXRzIGFuIGl0ZW0ncyBleHBhbmRlZCBzdGF0ZS4KICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gaXRlbSBUaGUgaXRlbSBmb3IgY2hlY2tpbmcgaXRzIGV4cGFuZGVkIHN0YXRlCiAgICAgICAgICogQHJldHVybnMge0Jvb2xlYW59IHRydWUgaWYgdGhlIGl0ZW0gaXMgZXhwYW5kZWQsIGZhbHNlIG90aGVyd2lzZQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGdldEl0ZW1FeHBhbmRlZChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtICYmIGl0ZW0uZGF0YXNldCAmJiBpdGVtLmRhdGFzZXRbImNtcEV4cGFuZGVkIl0gIT09IHVuZGVmaW5lZDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJlZnJlc2hlcyBhbiBpdGVtIGJhc2VkIG9uIGl0cyBleHBhbmRlZCBzdGF0ZS4KICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gaXRlbSBUaGUgaXRlbSB0byByZWZyZXNoCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gcmVmcmVzaEl0ZW0oaXRlbSkgewogICAgICAgICAgICB2YXIgZXhwYW5kZWQgPSBnZXRJdGVtRXhwYW5kZWQoaXRlbSk7CiAgICAgICAgICAgIGlmIChleHBhbmRlZCkgewogICAgICAgICAgICAgICAgZXhwYW5kSXRlbShpdGVtKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbGxhcHNlSXRlbShpdGVtKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmVmcmVzaGVzIGFsbCBpdGVtcyBiYXNlZCBvbiB0aGVpciBleHBhbmRlZCBzdGF0ZS4KICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gcmVmcmVzaEl0ZW1zKCkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoYXQuX2VsZW1lbnRzWyJpdGVtIl0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHJlZnJlc2hJdGVtKHRoYXQuX2VsZW1lbnRzWyJpdGVtIl1baV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIGFsbCBleHBhbmRlZCBpdGVtcy4KICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICogQHJldHVybnMge0hUTUxFbGVtZW50W119IFRoZSBleHBhbmRlZCBpdGVtcwogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGdldEV4cGFuZGVkSXRlbXMoKSB7CiAgICAgICAgICAgIHZhciBleHBhbmRlZEl0ZW1zID0gW107CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoYXQuX2VsZW1lbnRzWyJpdGVtIl0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdGhhdC5fZWxlbWVudHNbIml0ZW0iXVtpXTsKICAgICAgICAgICAgICAgIHZhciBleHBhbmRlZCA9IGdldEl0ZW1FeHBhbmRlZChpdGVtKTsKICAgICAgICAgICAgICAgIGlmIChleHBhbmRlZCkgewogICAgICAgICAgICAgICAgICAgIGV4cGFuZGVkSXRlbXMucHVzaChpdGVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGV4cGFuZGVkSXRlbXM7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBBbm5vdGF0ZXMgdGhlIGl0ZW0gYW5kIGl0cyBpbnRlcm5hbHMgd2l0aAogICAgICAgICAqIHRoZSBuZWNlc3Nhcnkgc3R5bGUgYW5kIGFjY2Vzc2liaWxpdHkgYXR0cmlidXRlcyB0byBpbmRpY2F0ZSBpdCBpcyBleHBhbmRlZC4KICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gaXRlbSBUaGUgaXRlbSB0byBhbm5vdGF0ZSBhcyBleHBhbmRlZAogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGV4cGFuZEl0ZW0oaXRlbSkgewogICAgICAgICAgICB2YXIgaW5kZXggPSB0aGF0Ll9lbGVtZW50c1siaXRlbSJdLmluZGV4T2YoaXRlbSk7CiAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7CiAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gdGhhdC5fZWxlbWVudHNbImJ1dHRvbiJdW2luZGV4XTsKICAgICAgICAgICAgICAgIHZhciBwYW5lbCA9IHRoYXQuX2VsZW1lbnRzWyJwYW5lbCJdW2luZGV4XTsKICAgICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKGNzc0NsYXNzZXMuYnV0dG9uLmV4cGFuZGVkKTsKICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtZXhwYW5kZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgIHBhbmVsLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5wYW5lbC5leHBhbmRlZCk7CiAgICAgICAgICAgICAgICBwYW5lbC5jbGFzc0xpc3QucmVtb3ZlKGNzc0NsYXNzZXMucGFuZWwuaGlkZGVuKTsKICAgICAgICAgICAgICAgIHBhbmVsLnNldEF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iLCBmYWxzZSk7CgogICAgICAgICAgICAgICAgaWYgKHRoYXQuX3Byb3BlcnRpZXMuc2luZ2xlRXhwYW5zaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5idXR0b24uZGlzYWJsZWQpOwogICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQW5ub3RhdGVzIHRoZSBpdGVtIGFuZCBpdHMgaW50ZXJuYWxzIHdpdGgKICAgICAgICAgKiB0aGUgbmVjZXNzYXJ5IHN0eWxlIGFuZCBhY2Nlc3NpYmlsaXR5IGF0dHJpYnV0ZXMgdG8gaW5kaWNhdGUgaXQgaXMgbm90IGV4cGFuZGVkLgogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBpdGVtIFRoZSBpdGVtIHRvIGFubm90YXRlIGFzIG5vdCBleHBhbmRlZAogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGNvbGxhcHNlSXRlbShpdGVtKSB7CiAgICAgICAgICAgIHZhciBpbmRleCA9IHRoYXQuX2VsZW1lbnRzWyJpdGVtIl0uaW5kZXhPZihpdGVtKTsKICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICAgICAgICAgIHZhciBidXR0b24gPSB0aGF0Ll9lbGVtZW50c1siYnV0dG9uIl1baW5kZXhdOwogICAgICAgICAgICAgICAgdmFyIHBhbmVsID0gdGhhdC5fZWxlbWVudHNbInBhbmVsIl1baW5kZXhdOwogICAgICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoY3NzQ2xhc3Nlcy5idXR0b24uZGlzYWJsZWQpOwogICAgICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoY3NzQ2xhc3Nlcy5idXR0b24uZXhwYW5kZWQpOwogICAgICAgICAgICAgICAgYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZSgiYXJpYS1kaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgIHBhbmVsLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5wYW5lbC5oaWRkZW4pOwogICAgICAgICAgICAgICAgcGFuZWwuY2xhc3NMaXN0LnJlbW92ZShjc3NDbGFzc2VzLnBhbmVsLmV4cGFuZGVkKTsKICAgICAgICAgICAgICAgIHBhbmVsLnNldEF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogRm9jdXNlcyB0aGUgYnV0dG9uIGF0IHRoZSBwcm92aWRlZCBpbmRleC4KICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4IFRoZSBpbmRleCBvZiB0aGUgYnV0dG9uIHRvIGZvY3VzCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gZm9jdXNCdXR0b24oaW5kZXgpIHsKICAgICAgICAgICAgdmFyIGJ1dHRvbiA9IHRoYXQuX2VsZW1lbnRzWyJidXR0b24iXVtpbmRleF07CiAgICAgICAgICAgIGJ1dHRvbi5mb2N1cygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlYWRzIG9wdGlvbnMgZGF0YSBmcm9tIHRoZSBBY2NvcmRpb24gd3JhcHBlciBlbGVtZW50LCBkZWZpbmVkIHZpYSB7QGNvZGUgZGF0YS1jbXAtKn0gZGF0YSBhdHRyaWJ1dGVzLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50IFRoZSBBY2NvcmRpb24gZWxlbWVudCB0byByZWFkIG9wdGlvbnMgZGF0YSBmcm9tCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBUaGUgb3B0aW9ucyByZWFkIGZyb20gdGhlIGNvbXBvbmVudCBkYXRhIGF0dHJpYnV0ZXMKICAgICAqLwogICAgZnVuY3Rpb24gcmVhZERhdGEoZWxlbWVudCkgewogICAgICAgIHZhciBkYXRhID0gZWxlbWVudC5kYXRhc2V0OwogICAgICAgIHZhciBvcHRpb25zID0gW107CiAgICAgICAgdmFyIGNhcGl0YWxpemVkID0gSVM7CiAgICAgICAgY2FwaXRhbGl6ZWQgPSBjYXBpdGFsaXplZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGNhcGl0YWxpemVkLnNsaWNlKDEpOwogICAgICAgIHZhciByZXNlcnZlZCA9IFsiaXMiLCAiaG9vayIgKyBjYXBpdGFsaXplZF07CgogICAgICAgIGZvciAodmFyIGtleSBpbiBkYXRhKSB7CiAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGRhdGFba2V5XTsKCiAgICAgICAgICAgICAgICBpZiAoa2V5LmluZGV4T2YoTlMpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAga2V5ID0ga2V5LnNsaWNlKE5TLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAga2V5ID0ga2V5LmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsga2V5LnN1YnN0cmluZygxKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc2VydmVkLmluZGV4T2Yoa2V5KSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1trZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb3B0aW9uczsKICAgIH0KCiAgICAvKioKICAgICAqIERvY3VtZW50IHJlYWR5IGhhbmRsZXIgYW5kIERPTSBtdXRhdGlvbiBvYnNlcnZlcnMuIEluaXRpYWxpemVzIEFjY29yZGlvbiBjb21wb25lbnRzIGFzIG5lY2Vzc2FyeS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICBmdW5jdGlvbiBvbkRvY3VtZW50UmVhZHkoKSB7CiAgICAgICAgdmFyIGVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcnMuc2VsZik7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBuZXcgQWNjb3JkaW9uKHsgZWxlbWVudDogZWxlbWVudHNbaV0sIG9wdGlvbnM6IHJlYWREYXRhKGVsZW1lbnRzW2ldKSB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93Lk1vek11dGF0aW9uT2JzZXJ2ZXI7CiAgICAgICAgdmFyIGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJib2R5Iik7CiAgICAgICAgdmFyIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24obXV0YXRpb25zKSB7CiAgICAgICAgICAgIG11dGF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKG11dGF0aW9uKSB7CiAgICAgICAgICAgICAgICAvLyBuZWVkZWQgZm9yIElFCiAgICAgICAgICAgICAgICB2YXIgbm9kZXNBcnJheSA9IFtdLnNsaWNlLmNhbGwobXV0YXRpb24uYWRkZWROb2Rlcyk7CiAgICAgICAgICAgICAgICBpZiAobm9kZXNBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgbm9kZXNBcnJheS5mb3JFYWNoKGZ1bmN0aW9uKGFkZGVkTm9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWRkZWROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50c0FycmF5ID0gW10uc2xpY2UuY2FsbChhZGRlZE5vZGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcnMuc2VsZikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHNBcnJheS5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgQWNjb3JkaW9uKHsgZWxlbWVudDogZWxlbWVudCwgb3B0aW9uczogcmVhZERhdGEoZWxlbWVudCkgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShib2R5LCB7CiAgICAgICAgICAgIHN1YnRyZWU6IHRydWUsCiAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSwKICAgICAgICAgICAgY2hhcmFjdGVyRGF0YTogdHJ1ZQogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlICE9PSAibG9hZGluZyIpIHsKICAgICAgICBvbkRvY3VtZW50UmVhZHkoKTsKICAgIH0gZWxzZSB7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIG9uRG9jdW1lbnRSZWFkeSgpKTsKICAgIH0KfSgpKTsKCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAqIENvcHlyaWdodCAyMDE4IEFkb2JlCiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UyLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCi8qKgogKiBFbGVtZW50Lm1hdGNoZXMoKQogKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lblVTL2RvY3MvV2ViL0FQSS9FbGVtZW50L21hdGNoZXMjUG9seWZpbGwKICovCmlmICghRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlcykgewogICAgRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlcyA9IEVsZW1lbnQucHJvdG90eXBlLm1zTWF0Y2hlc1NlbGVjdG9yIHx8IEVsZW1lbnQucHJvdG90eXBlLndlYmtpdE1hdGNoZXNTZWxlY3RvcjsKfQoKLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHZhbGlkLWpzZG9jCi8qKgogKiBFbGVtZW50LmNsb3Nlc3QoKQogKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lblVTL2RvY3MvV2ViL0FQSS9FbGVtZW50L2Nsb3Nlc3QjUG9seWZpbGwKICovCmlmICghRWxlbWVudC5wcm90b3R5cGUuY2xvc2VzdCkgewogICAgRWxlbWVudC5wcm90b3R5cGUuY2xvc2VzdCA9IGZ1bmN0aW9uKHMpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIGVsID0gdGhpczsKICAgICAgICBpZiAoIWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jb250YWlucyhlbCkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGRvIHsKICAgICAgICAgICAgaWYgKGVsLm1hdGNoZXMocykpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbCA9IGVsLnBhcmVudEVsZW1lbnQgfHwgZWwucGFyZW50Tm9kZTsKICAgICAgICB9IHdoaWxlIChlbCAhPT0gbnVsbCAmJiBlbC5ub2RlVHlwZSA9PT0gMSk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Owp9CgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogKiBDb3B5cmlnaHQgMjAxOCBBZG9iZQogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwooZnVuY3Rpb24oKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIE5TID0gImNtcCI7CiAgICB2YXIgSVMgPSAidGFicyI7CgogICAgdmFyIGtleUNvZGVzID0gewogICAgICAgIEVORDogMzUsCiAgICAgICAgSE9NRTogMzYsCiAgICAgICAgQVJST1dfTEVGVDogMzcsCiAgICAgICAgQVJST1dfVVA6IDM4LAogICAgICAgIEFSUk9XX1JJR0hUOiAzOSwKICAgICAgICBBUlJPV19ET1dOOiA0MAogICAgfTsKCiAgICB2YXIgc2VsZWN0b3JzID0gewogICAgICAgIHNlbGY6ICJbZGF0YS0iICsgIE5TICsgJy1pcz0iJyArIElTICsgJyJdJywKICAgICAgICBhY3RpdmU6IHsKICAgICAgICAgICAgdGFiOiAiY21wLXRhYnNfX3RhYi0tYWN0aXZlIiwKICAgICAgICAgICAgdGFicGFuZWw6ICJjbXAtdGFic19fdGFicGFuZWwtLWFjdGl2ZSIKICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogVGFicyBDb25maWd1cmF0aW9uCiAgICAgKgogICAgICogQHR5cGVkZWYge09iamVjdH0gVGFic0NvbmZpZyBSZXByZXNlbnRzIGEgVGFicyBjb25maWd1cmF0aW9uCiAgICAgKiBAcHJvcGVydHkge0hUTUxFbGVtZW50fSBlbGVtZW50IFRoZSBIVE1MRWxlbWVudCByZXByZXNlbnRpbmcgdGhlIFRhYnMKICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBvcHRpb25zIFRoZSBUYWJzIG9wdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogVGFicwogICAgICoKICAgICAqIEBjbGFzcyBUYWJzCiAgICAgKiBAY2xhc3NkZXNjIEFuIGludGVyYWN0aXZlIFRhYnMgY29tcG9uZW50IGZvciBuYXZpZ2F0aW5nIGEgbGlzdCBvZiB0YWJzCiAgICAgKiBAcGFyYW0ge1RhYnNDb25maWd9IGNvbmZpZyBUaGUgVGFicyBjb25maWd1cmF0aW9uCiAgICAgKi8KICAgIGZ1bmN0aW9uIFRhYnMoY29uZmlnKSB7CiAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwoKICAgICAgICBpZiAoY29uZmlnICYmIGNvbmZpZy5lbGVtZW50KSB7CiAgICAgICAgICAgIGluaXQoY29uZmlnKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEluaXRpYWxpemVzIHRoZSBUYWJzCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEBwYXJhbSB7VGFic0NvbmZpZ30gY29uZmlnIFRoZSBUYWJzIGNvbmZpZ3VyYXRpb24KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBpbml0KGNvbmZpZykgewogICAgICAgICAgICAvLyBwcmV2ZW50cyBtdWx0aXBsZSBpbml0aWFsaXphdGlvbgogICAgICAgICAgICBjb25maWcuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtIiArIE5TICsgIi1pcyIpOwoKICAgICAgICAgICAgY2FjaGVFbGVtZW50cyhjb25maWcuZWxlbWVudCk7CiAgICAgICAgICAgIHRoYXQuX2FjdGl2ZSA9IGdldEFjdGl2ZUluZGV4KHRoYXQuX2VsZW1lbnRzWyJ0YWIiXSk7CgogICAgICAgICAgICBpZiAodGhhdC5fZWxlbWVudHMudGFicGFuZWwpIHsKICAgICAgICAgICAgICAgIHJlZnJlc2hBY3RpdmUoKTsKICAgICAgICAgICAgICAgIGJpbmRFdmVudHMoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHdpbmRvdy5HcmFuaXRlICYmIHdpbmRvdy5HcmFuaXRlLmF1dGhvciAmJiB3aW5kb3cuR3Jhbml0ZS5hdXRob3IuTWVzc2FnZUNoYW5uZWwpIHsKICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgKiBFZGl0b3IgbWVzc2FnZSBoYW5kbGluZzoKICAgICAgICAgICAgICAgICAqIC0gc3Vic2NyaWJlIHRvICJjbXAucGFuZWxjb250YWluZXIiIG1lc3NhZ2UgcmVxdWVzdHMgc2VudCBieSB0aGUgZWRpdG9yIGZyYW1lCiAgICAgICAgICAgICAgICAgKiAtIGNoZWNrIHRoYXQgdGhlIG1lc3NhZ2UgZGF0YSBwYW5lbCBjb250YWluZXIgdHlwZSBpcyBjb3JyZWN0IGFuZCB0aGF0IHRoZSBpZCAocGF0aCkgbWF0Y2hlcyB0aGlzIHNwZWNpZmljIFRhYnMgY29tcG9uZW50CiAgICAgICAgICAgICAgICAgKiAtIGlmIHNvLCByb3V0ZSB0aGUgIm5hdmlnYXRlIiBvcGVyYXRpb24gdG8gZW5hY3QgYSBuYXZpZ2F0aW9uIG9mIHRoZSBUYWJzIGJhc2VkIG9uIGluZGV4IGRhdGEKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgbmV3IHdpbmRvdy5HcmFuaXRlLmF1dGhvci5NZXNzYWdlQ2hhbm5lbCgiY3FhdXRob3IiLCB3aW5kb3cpLnN1YnNjcmliZVJlcXVlc3RNZXNzYWdlKCJjbXAucGFuZWxjb250YWluZXIiLCBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuZGF0YSAmJiBtZXNzYWdlLmRhdGEudHlwZSA9PT0gImNtcC10YWJzIiAmJiBtZXNzYWdlLmRhdGEuaWQgPT09IHRoYXQuX2VsZW1lbnRzLnNlbGYuZGF0YXNldFsiY21wUGFuZWxjb250YWluZXJJZCJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmRhdGEub3BlcmF0aW9uID09PSAibmF2aWdhdGUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0ZShtZXNzYWdlLmRhdGEuaW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBhY3RpdmUgdGFiLCBpZiBubyB0YWIgaXMgYWN0aXZlIHJldHVybnMgMAogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBcnJheX0gdGFicyBUYWIgZWxlbWVudHMKICAgICAgICAgKiBAcmV0dXJucyB7TnVtYmVyfSBJbmRleCBvZiB0aGUgYWN0aXZlIHRhYiwgMCBpZiBub25lIGlzIGFjdGl2ZQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGdldEFjdGl2ZUluZGV4KHRhYnMpIHsKICAgICAgICAgICAgaWYgKHRhYnMpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFicy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmICh0YWJzW2ldLmNsYXNzTGlzdC5jb250YWlucyhzZWxlY3RvcnMuYWN0aXZlLnRhYikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ2FjaGVzIHRoZSBUYWJzIGVsZW1lbnRzIGFzIGRlZmluZWQgdmlhIHRoZSB7QGNvZGUgZGF0YS10YWJzLWhvb2s9IkVMRU1FTlRfTkFNRSJ9IG1hcmt1cCBBUEkKICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gd3JhcHBlciBUaGUgVGFicyB3cmFwcGVyIGVsZW1lbnQKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBjYWNoZUVsZW1lbnRzKHdyYXBwZXIpIHsKICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMgPSB7fTsKICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuc2VsZiA9IHdyYXBwZXI7CiAgICAgICAgICAgIHZhciBob29rcyA9IHRoYXQuX2VsZW1lbnRzLnNlbGYucXVlcnlTZWxlY3RvckFsbCgiW2RhdGEtIiArIE5TICsgIi1ob29rLSIgKyBJUyArICJdIik7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhvb2tzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgaG9vayA9IGhvb2tzW2ldOwogICAgICAgICAgICAgICAgaWYgKGhvb2suY2xvc2VzdCgiLiIgKyBOUyArICItIiArIElTKSA9PT0gdGhhdC5fZWxlbWVudHMuc2VsZikgeyAvLyBvbmx5IHByb2Nlc3Mgb3duIHRhYiBlbGVtZW50cwogICAgICAgICAgICAgICAgICAgIHZhciBjYXBpdGFsaXplZCA9IElTOwogICAgICAgICAgICAgICAgICAgIGNhcGl0YWxpemVkID0gY2FwaXRhbGl6ZWQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBjYXBpdGFsaXplZC5zbGljZSgxKTsKICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gaG9vay5kYXRhc2V0W05TICsgIkhvb2siICsgY2FwaXRhbGl6ZWRdOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGF0Ll9lbGVtZW50c1trZXldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0aGF0Ll9lbGVtZW50c1trZXldKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9IHRoYXQuX2VsZW1lbnRzW2tleV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50c1trZXldID0gW3RtcF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHNba2V5XS5wdXNoKGhvb2spOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzW2tleV0gPSBob29rOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQmluZHMgVGFicyBldmVudCBoYW5kbGluZwogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBiaW5kRXZlbnRzKCkgewogICAgICAgICAgICB2YXIgdGFicyA9IHRoYXQuX2VsZW1lbnRzWyJ0YWIiXTsKICAgICAgICAgICAgaWYgKHRhYnMpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFicy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbihpbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgICB0YWJzW2ldLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlQW5kRm9jdXNUYWIoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGFic1tpXS5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uS2V5RG93bihldmVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pKGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBIYW5kbGVzIHRhYiBrZXlkb3duIGV2ZW50cwogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIGtleWRvd24gZXZlbnQKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBvbktleURvd24oZXZlbnQpIHsKICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhhdC5fYWN0aXZlOwogICAgICAgICAgICB2YXIgbGFzdEluZGV4ID0gdGhhdC5fZWxlbWVudHNbInRhYiJdLmxlbmd0aCAtIDE7CgogICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2Uga2V5Q29kZXMuQVJST1dfTEVGVDoKICAgICAgICAgICAgICAgIGNhc2Uga2V5Q29kZXMuQVJST1dfVVA6CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlQW5kRm9jdXNUYWIoaW5kZXggLSAxKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGtleUNvZGVzLkFSUk9XX1JJR0hUOgogICAgICAgICAgICAgICAgY2FzZSBrZXlDb2Rlcy5BUlJPV19ET1dOOgogICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgbGFzdEluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlQW5kRm9jdXNUYWIoaW5kZXggKyAxKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGtleUNvZGVzLkhPTUU6CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0ZUFuZEZvY3VzVGFiKDApOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBrZXlDb2Rlcy5FTkQ6CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0ZUFuZEZvY3VzVGFiKGxhc3RJbmRleCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmVmcmVzaGVzIHRoZSB0YWIgbWFya3VwIGJhc2VkIG9uIHRoZSBjdXJyZW50IHtAY29kZSBUYWJzI19hY3RpdmV9IGluZGV4CiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIHJlZnJlc2hBY3RpdmUoKSB7CiAgICAgICAgICAgIHZhciB0YWJwYW5lbHMgPSB0aGF0Ll9lbGVtZW50c1sidGFicGFuZWwiXTsKICAgICAgICAgICAgdmFyIHRhYnMgPSB0aGF0Ll9lbGVtZW50c1sidGFiIl07CgogICAgICAgICAgICBpZiAodGFicGFuZWxzKSB7CiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0YWJwYW5lbHMpKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YWJwYW5lbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IHBhcnNlSW50KHRoYXQuX2FjdGl2ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYnBhbmVsc1tpXS5jbGFzc0xpc3QuYWRkKHNlbGVjdG9ycy5hY3RpdmUudGFicGFuZWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFicGFuZWxzW2ldLnJlbW92ZUF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYnNbaV0uY2xhc3NMaXN0LmFkZChzZWxlY3RvcnMuYWN0aXZlLnRhYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJzW2ldLnNldEF0dHJpYnV0ZSgiYXJpYS1zZWxlY3RlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFic1tpXS5zZXRBdHRyaWJ1dGUoInRhYmluZGV4IiwgIjAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYnBhbmVsc1tpXS5jbGFzc0xpc3QucmVtb3ZlKHNlbGVjdG9ycy5hY3RpdmUudGFicGFuZWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFicGFuZWxzW2ldLnNldEF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYnNbaV0uY2xhc3NMaXN0LnJlbW92ZShzZWxlY3RvcnMuYWN0aXZlLnRhYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJzW2ldLnNldEF0dHJpYnV0ZSgiYXJpYS1zZWxlY3RlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYnNbaV0uc2V0QXR0cmlidXRlKCJ0YWJpbmRleCIsICItMSIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IG9uZSB0YWIKICAgICAgICAgICAgICAgICAgICB0YWJwYW5lbHMuY2xhc3NMaXN0LmFkZChzZWxlY3RvcnMuYWN0aXZlLnRhYnBhbmVsKTsKICAgICAgICAgICAgICAgICAgICB0YWJzLmNsYXNzTGlzdC5hZGQoc2VsZWN0b3JzLmFjdGl2ZS50YWIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBGb2N1c2VzIHRoZSBlbGVtZW50IGFuZCBwcmV2ZW50cyBzY3JvbGxpbmcgdGhlIGVsZW1lbnQgaW50byB2aWV3CiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50IEVsZW1lbnQgdG8gZm9jdXMKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBmb2N1c1dpdGhvdXRTY3JvbGwoZWxlbWVudCkgewogICAgICAgICAgICB2YXIgeCA9IHdpbmRvdy5zY3JvbGxYIHx8IHdpbmRvdy5wYWdlWE9mZnNldDsKICAgICAgICAgICAgdmFyIHkgPSB3aW5kb3cuc2Nyb2xsWSB8fCB3aW5kb3cucGFnZVlPZmZzZXQ7CiAgICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTsKICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKHgsIHkpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogTmF2aWdhdGVzIHRvIHRoZSB0YWIgYXQgdGhlIHByb3ZpZGVkIGluZGV4CiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHRhYiB0byBuYXZpZ2F0ZSB0bwogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIG5hdmlnYXRlKGluZGV4KSB7CiAgICAgICAgICAgIHRoYXQuX2FjdGl2ZSA9IGluZGV4OwogICAgICAgICAgICByZWZyZXNoQWN0aXZlKCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBOYXZpZ2F0ZXMgdG8gdGhlIGl0ZW0gYXQgdGhlIHByb3ZpZGVkIGluZGV4IGFuZCBlbnN1cmVzIHRoZSBhY3RpdmUgdGFiIGdhaW5zIGZvY3VzCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIGl0ZW0gdG8gbmF2aWdhdGUgdG8KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBuYXZpZ2F0ZUFuZEZvY3VzVGFiKGluZGV4KSB7CiAgICAgICAgICAgIG5hdmlnYXRlKGluZGV4KTsKICAgICAgICAgICAgZm9jdXNXaXRob3V0U2Nyb2xsKHRoYXQuX2VsZW1lbnRzWyJ0YWIiXVtpbmRleF0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlYWRzIG9wdGlvbnMgZGF0YSBmcm9tIHRoZSBUYWJzIHdyYXBwZXIgZWxlbWVudCwgZGVmaW5lZCB2aWEge0Bjb2RlIGRhdGEtY21wLSp9IGRhdGEgYXR0cmlidXRlcwogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50IFRoZSBUYWJzIGVsZW1lbnQgdG8gcmVhZCBvcHRpb25zIGRhdGEgZnJvbQogICAgICogQHJldHVybnMge09iamVjdH0gVGhlIG9wdGlvbnMgcmVhZCBmcm9tIHRoZSBjb21wb25lbnQgZGF0YSBhdHRyaWJ1dGVzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlYWREYXRhKGVsZW1lbnQpIHsKICAgICAgICB2YXIgZGF0YSA9IGVsZW1lbnQuZGF0YXNldDsKICAgICAgICB2YXIgb3B0aW9ucyA9IFtdOwogICAgICAgIHZhciBjYXBpdGFsaXplZCA9IElTOwogICAgICAgIGNhcGl0YWxpemVkID0gY2FwaXRhbGl6ZWQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBjYXBpdGFsaXplZC5zbGljZSgxKTsKICAgICAgICB2YXIgcmVzZXJ2ZWQgPSBbImlzIiwgImhvb2siICsgY2FwaXRhbGl6ZWRdOwoKICAgICAgICBmb3IgKHZhciBrZXkgaW4gZGF0YSkgewogICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBkYXRhW2tleV07CgogICAgICAgICAgICAgICAgaWYgKGtleS5pbmRleE9mKE5TKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGtleSA9IGtleS5zbGljZShOUy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIGtleSA9IGtleS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIGtleS5zdWJzdHJpbmcoMSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChyZXNlcnZlZC5pbmRleE9mKGtleSkgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNba2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBEb2N1bWVudCByZWFkeSBoYW5kbGVyIGFuZCBET00gbXV0YXRpb24gb2JzZXJ2ZXJzLiBJbml0aWFsaXplcyBUYWJzIGNvbXBvbmVudHMgYXMgbmVjZXNzYXJ5LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIG9uRG9jdW1lbnRSZWFkeSgpIHsKICAgICAgICB2YXIgZWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9ycy5zZWxmKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG5ldyBUYWJzKHsgZWxlbWVudDogZWxlbWVudHNbaV0sIG9wdGlvbnM6IHJlYWREYXRhKGVsZW1lbnRzW2ldKSB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93Lk1vek11dGF0aW9uT2JzZXJ2ZXI7CiAgICAgICAgdmFyIGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJib2R5Iik7CiAgICAgICAgdmFyIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24obXV0YXRpb25zKSB7CiAgICAgICAgICAgIG11dGF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKG11dGF0aW9uKSB7CiAgICAgICAgICAgICAgICAvLyBuZWVkZWQgZm9yIElFCiAgICAgICAgICAgICAgICB2YXIgbm9kZXNBcnJheSA9IFtdLnNsaWNlLmNhbGwobXV0YXRpb24uYWRkZWROb2Rlcyk7CiAgICAgICAgICAgICAgICBpZiAobm9kZXNBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgbm9kZXNBcnJheS5mb3JFYWNoKGZ1bmN0aW9uKGFkZGVkTm9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWRkZWROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50c0FycmF5ID0gW10uc2xpY2UuY2FsbChhZGRlZE5vZGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcnMuc2VsZikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHNBcnJheS5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgVGFicyh7IGVsZW1lbnQ6IGVsZW1lbnQsIG9wdGlvbnM6IHJlYWREYXRhKGVsZW1lbnQpIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIG9ic2VydmVyLm9ic2VydmUoYm9keSwgewogICAgICAgICAgICBzdWJ0cmVlOiB0cnVlLAogICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsCiAgICAgICAgICAgIGNoYXJhY3RlckRhdGE6IHRydWUKICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gImxvYWRpbmciKSB7CiAgICAgICAgb25Eb2N1bWVudFJlYWR5KCk7CiAgICB9IGVsc2UgewogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBvbkRvY3VtZW50UmVhZHkpOwogICAgfQoKfSgpKTsKCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAqIENvcHlyaWdodCAyMDE4IEFkb2JlCiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCihmdW5jdGlvbigpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgTlMgPSAiY21wIjsKICAgIHZhciBJUyA9ICJjYXJvdXNlbCI7CgogICAgdmFyIGtleUNvZGVzID0gewogICAgICAgIFNQQUNFOiAzMiwKICAgICAgICBFTkQ6IDM1LAogICAgICAgIEhPTUU6IDM2LAogICAgICAgIEFSUk9XX0xFRlQ6IDM3LAogICAgICAgIEFSUk9XX1VQOiAzOCwKICAgICAgICBBUlJPV19SSUdIVDogMzksCiAgICAgICAgQVJST1dfRE9XTjogNDAKICAgIH07CgogICAgdmFyIHNlbGVjdG9ycyA9IHsKICAgICAgICBzZWxmOiAiW2RhdGEtIiArICBOUyArICctaXM9IicgKyBJUyArICciXScKICAgIH07CgogICAgdmFyIHByb3BlcnRpZXMgPSB7CiAgICAgICAgLyoqCiAgICAgICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBDYXJvdXNlbCB3aWxsIGF1dG9tYXRpY2FsbHkgdHJhbnNpdGlvbiBiZXR3ZWVuIHNsaWRlcwogICAgICAgICAqCiAgICAgICAgICogQG1lbWJlcm9mIENhcm91c2VsCiAgICAgICAgICogQHR5cGUge0Jvb2xlYW59CiAgICAgICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAgICAgKi8KICAgICAgICAiYXV0b3BsYXkiOiB7CiAgICAgICAgICAgICJkZWZhdWx0IjogZmFsc2UsCiAgICAgICAgICAgICJ0cmFuc2Zvcm0iOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICEodmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSAidW5kZWZpbmVkIik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIER1cmF0aW9uIChpbiBtaWxsaXNlY29uZHMpIGJlZm9yZSBhdXRvbWF0aWNhbGx5IHRyYW5zaXRpb25pbmcgdG8gdGhlIG5leHQgc2xpZGUKICAgICAgICAgKgogICAgICAgICAqIEBtZW1iZXJvZiBDYXJvdXNlbAogICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9CiAgICAgICAgICogQGRlZmF1bHQgNTAwMAogICAgICAgICAqLwogICAgICAgICJkZWxheSI6IHsKICAgICAgICAgICAgImRlZmF1bHQiOiA1MDAwLAogICAgICAgICAgICAidHJhbnNmb3JtIjogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gIWlzTmFOKHZhbHVlKSA/IHZhbHVlIDogbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIGF1dG9tYXRpYyBwYXVzZSBvbiBob3ZlcmluZyB0aGUgY2Fyb3VzZWwgaXMgZGlzYWJsZWQKICAgICAgICAgKgogICAgICAgICAqIEBtZW1iZXJvZiBDYXJvdXNlbAogICAgICAgICAqIEB0eXBlIHtCb29sZWFufQogICAgICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgICAgICovCiAgICAgICAgImF1dG9wYXVzZURpc2FibGVkIjogewogICAgICAgICAgICAiZGVmYXVsdCI6IGZhbHNlLAogICAgICAgICAgICAidHJhbnNmb3JtIjogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhKHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gInVuZGVmaW5lZCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIENhcm91c2VsIENvbmZpZ3VyYXRpb24KICAgICAqCiAgICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDYXJvdXNlbENvbmZpZyBSZXByZXNlbnRzIGEgQ2Fyb3VzZWwgY29uZmlndXJhdGlvbgogICAgICogQHByb3BlcnR5IHtIVE1MRWxlbWVudH0gZWxlbWVudCBUaGUgSFRNTEVsZW1lbnQgcmVwcmVzZW50aW5nIHRoZSBDYXJvdXNlbAogICAgICogQHByb3BlcnR5IHtPYmplY3R9IG9wdGlvbnMgVGhlIENhcm91c2VsIG9wdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogQ2Fyb3VzZWwKICAgICAqCiAgICAgKiBAY2xhc3MgQ2Fyb3VzZWwKICAgICAqIEBjbGFzc2Rlc2MgQW4gaW50ZXJhY3RpdmUgQ2Fyb3VzZWwgY29tcG9uZW50IGZvciBuYXZpZ2F0aW5nIGEgbGlzdCBvZiBnZW5lcmljIGl0ZW1zCiAgICAgKiBAcGFyYW0ge0Nhcm91c2VsQ29uZmlnfSBjb25maWcgVGhlIENhcm91c2VsIGNvbmZpZ3VyYXRpb24KICAgICAqLwogICAgZnVuY3Rpb24gQ2Fyb3VzZWwoY29uZmlnKSB7CiAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwoKICAgICAgICBpZiAoY29uZmlnICYmIGNvbmZpZy5lbGVtZW50KSB7CiAgICAgICAgICAgIGluaXQoY29uZmlnKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEluaXRpYWxpemVzIHRoZSBDYXJvdXNlbAogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKiBAcGFyYW0ge0Nhcm91c2VsQ29uZmlnfSBjb25maWcgVGhlIENhcm91c2VsIGNvbmZpZ3VyYXRpb24KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBpbml0KGNvbmZpZykgewogICAgICAgICAgICAvLyBwcmV2ZW50cyBtdWx0aXBsZSBpbml0aWFsaXphdGlvbgogICAgICAgICAgICBjb25maWcuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtIiArIE5TICsgIi1pcyIpOwoKICAgICAgICAgICAgc2V0dXBQcm9wZXJ0aWVzKGNvbmZpZy5vcHRpb25zKTsKICAgICAgICAgICAgY2FjaGVFbGVtZW50cyhjb25maWcuZWxlbWVudCk7CgogICAgICAgICAgICB0aGF0Ll9hY3RpdmUgPSAwOwogICAgICAgICAgICB0aGF0Ll9wYXVzZWQgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmICh0aGF0Ll9lbGVtZW50cy5pdGVtKSB7CiAgICAgICAgICAgICAgICByZWZyZXNoQWN0aXZlKCk7CiAgICAgICAgICAgICAgICBiaW5kRXZlbnRzKCk7CiAgICAgICAgICAgICAgICByZXNldEF1dG9wbGF5SW50ZXJ2YWwoKTsKICAgICAgICAgICAgICAgIHJlZnJlc2hQbGF5UGF1c2VBY3Rpb25zKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh3aW5kb3cuR3Jhbml0ZSAmJiB3aW5kb3cuR3Jhbml0ZS5hdXRob3IgJiYgd2luZG93LkdyYW5pdGUuYXV0aG9yLk1lc3NhZ2VDaGFubmVsKSB7CiAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICogRWRpdG9yIG1lc3NhZ2UgaGFuZGxpbmc6CiAgICAgICAgICAgICAgICAgKiAtIHN1YnNjcmliZSB0byAiY21wLnBhbmVsY29udGFpbmVyIiBtZXNzYWdlIHJlcXVlc3RzIHNlbnQgYnkgdGhlIGVkaXRvciBmcmFtZQogICAgICAgICAgICAgICAgICogLSBjaGVjayB0aGF0IHRoZSBtZXNzYWdlIGRhdGEgcGFuZWwgY29udGFpbmVyIHR5cGUgaXMgY29ycmVjdCBhbmQgdGhhdCB0aGUgaWQgKHBhdGgpIG1hdGNoZXMgdGhpcyBzcGVjaWZpYyBDYXJvdXNlbCBjb21wb25lbnQKICAgICAgICAgICAgICAgICAqIC0gaWYgc28sIHJvdXRlIHRoZSAibmF2aWdhdGUiIG9wZXJhdGlvbiB0byBlbmFjdCBhIG5hdmlnYXRpb24gb2YgdGhlIENhcm91c2VsIGJhc2VkIG9uIGluZGV4IGRhdGEKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgbmV3IHdpbmRvdy5HcmFuaXRlLmF1dGhvci5NZXNzYWdlQ2hhbm5lbCgiY3FhdXRob3IiLCB3aW5kb3cpLnN1YnNjcmliZVJlcXVlc3RNZXNzYWdlKCJjbXAucGFuZWxjb250YWluZXIiLCBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuZGF0YSAmJiBtZXNzYWdlLmRhdGEudHlwZSA9PT0gImNtcC1jYXJvdXNlbCIgJiYgbWVzc2FnZS5kYXRhLmlkID09PSB0aGF0Ll9lbGVtZW50cy5zZWxmLmRhdGFzZXRbImNtcFBhbmVsY29udGFpbmVySWQiXSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5kYXRhLm9wZXJhdGlvbiA9PT0gIm5hdmlnYXRlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGUobWVzc2FnZS5kYXRhLmluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDYWNoZXMgdGhlIENhcm91c2VsIGVsZW1lbnRzIGFzIGRlZmluZWQgdmlhIHRoZSB7QGNvZGUgZGF0YS1jYXJvdXNlbC1ob29rPSJFTEVNRU5UX05BTUUifSBtYXJrdXAgQVBJCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IHdyYXBwZXIgVGhlIENhcm91c2VsIHdyYXBwZXIgZWxlbWVudAogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGNhY2hlRWxlbWVudHMod3JhcHBlcikgewogICAgICAgICAgICB0aGF0Ll9lbGVtZW50cyA9IHt9OwogICAgICAgICAgICB0aGF0Ll9lbGVtZW50cy5zZWxmID0gd3JhcHBlcjsKICAgICAgICAgICAgdmFyIGhvb2tzID0gdGhhdC5fZWxlbWVudHMuc2VsZi5xdWVyeVNlbGVjdG9yQWxsKCJbZGF0YS0iICsgTlMgKyAiLWhvb2stIiArIElTICsgIl0iKTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaG9va3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBob29rID0gaG9va3NbaV07CiAgICAgICAgICAgICAgICB2YXIgY2FwaXRhbGl6ZWQgPSBJUzsKICAgICAgICAgICAgICAgIGNhcGl0YWxpemVkID0gY2FwaXRhbGl6ZWQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBjYXBpdGFsaXplZC5zbGljZSgxKTsKICAgICAgICAgICAgICAgIHZhciBrZXkgPSBob29rLmRhdGFzZXRbTlMgKyAiSG9vayIgKyBjYXBpdGFsaXplZF07CiAgICAgICAgICAgICAgICBpZiAodGhhdC5fZWxlbWVudHNba2V5XSkgewogICAgICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0aGF0Ll9lbGVtZW50c1trZXldKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gdGhhdC5fZWxlbWVudHNba2V5XTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHNba2V5XSA9IFt0bXBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50c1trZXldLnB1c2goaG9vayk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzW2tleV0gPSBob29rOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHVwIHByb3BlcnRpZXMgZm9yIHRoZSBDYXJvdXNlbCBiYXNlZCBvbiB0aGUgcGFzc2VkIG9wdGlvbnMuCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIFRoZSBDYXJvdXNlbCBvcHRpb25zCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gc2V0dXBQcm9wZXJ0aWVzKG9wdGlvbnMpIHsKICAgICAgICAgICAgdGhhdC5fcHJvcGVydGllcyA9IHt9OwoKICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcGVydHkgPSBwcm9wZXJ0aWVzW2tleV07CiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gbnVsbDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9uc1trZXldICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvcHRpb25zW2tleV07CgogICAgICAgICAgICAgICAgICAgICAgICAvLyB0cmFuc2Zvcm0gdGhlIHByb3ZpZGVkIG9wdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydHkgJiYgdHlwZW9mIHByb3BlcnR5LnRyYW5zZm9ybSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwcm9wZXJ0eS50cmFuc2Zvcm0odmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdmFsdWUgc3RpbGwgbnVsbCwgdGFrZSB0aGUgcHJvcGVydHkgZGVmYXVsdAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHByb3BlcnRpZXNba2V5XVsiZGVmYXVsdCJdOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdGhhdC5fcHJvcGVydGllc1trZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEJpbmRzIENhcm91c2VsIGV2ZW50IGhhbmRsaW5nCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGJpbmRFdmVudHMoKSB7CiAgICAgICAgICAgIGlmICh0aGF0Ll9lbGVtZW50c1sicHJldmlvdXMiXSkgewogICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHNbInByZXZpb3VzIl0uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0ZShnZXRQcmV2aW91c0luZGV4KCkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGF0Ll9lbGVtZW50c1sibmV4dCJdKSB7CiAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50c1sibmV4dCJdLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGUoZ2V0TmV4dEluZGV4KCkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JzID0gdGhhdC5fZWxlbWVudHNbImluZGljYXRvciJdOwogICAgICAgICAgICBpZiAoaW5kaWNhdG9ycykgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmRpY2F0b3JzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluZGljYXRvcnNbaV0uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGVBbmRGb2N1c0luZGljYXRvcihpbmRleCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pKGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhhdC5fZWxlbWVudHNbInBhdXNlIl0pIHsKICAgICAgICAgICAgICAgIGlmICh0aGF0Ll9wcm9wZXJ0aWVzLmF1dG9wbGF5KSB7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHNbInBhdXNlIl0uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBvblBhdXNlQ2xpY2spOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhhdC5fZWxlbWVudHNbInBsYXkiXSkgewogICAgICAgICAgICAgICAgaWYgKHRoYXQuX3Byb3BlcnRpZXMuYXV0b3BsYXkpIHsKICAgICAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50c1sicGxheSJdLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgb25QbGF5Q2xpY2spOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGF0Ll9lbGVtZW50cy5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBvbktleURvd24pOwoKICAgICAgICAgICAgaWYgKCF0aGF0Ll9wcm9wZXJ0aWVzLmF1dG9wYXVzZURpc2FibGVkKSB7CiAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50cy5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZW50ZXIiLCBvbk1vdXNlRW50ZXIpOwogICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuc2VsZi5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWxlYXZlIiwgb25Nb3VzZUxlYXZlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogSGFuZGxlcyBjYXJvdXNlbCBrZXlkb3duIGV2ZW50cwogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIGtleWRvd24gZXZlbnQKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBvbktleURvd24oZXZlbnQpIHsKICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhhdC5fYWN0aXZlOwogICAgICAgICAgICB2YXIgbGFzdEluZGV4ID0gdGhhdC5fZWxlbWVudHNbImluZGljYXRvciJdLmxlbmd0aCAtIDE7CgogICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2Uga2V5Q29kZXMuQVJST1dfTEVGVDoKICAgICAgICAgICAgICAgIGNhc2Uga2V5Q29kZXMuQVJST1dfVVA6CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlQW5kRm9jdXNJbmRpY2F0b3IoaW5kZXggLSAxKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGtleUNvZGVzLkFSUk9XX1JJR0hUOgogICAgICAgICAgICAgICAgY2FzZSBrZXlDb2Rlcy5BUlJPV19ET1dOOgogICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgbGFzdEluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlQW5kRm9jdXNJbmRpY2F0b3IoaW5kZXggKyAxKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGtleUNvZGVzLkhPTUU6CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0ZUFuZEZvY3VzSW5kaWNhdG9yKDApOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBrZXlDb2Rlcy5FTkQ6CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0ZUFuZEZvY3VzSW5kaWNhdG9yKGxhc3RJbmRleCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGtleUNvZGVzLlNQQUNFOgogICAgICAgICAgICAgICAgICAgIGlmICh0aGF0Ll9wcm9wZXJ0aWVzLmF1dG9wbGF5ICYmIChldmVudC50YXJnZXQgIT09IHRoYXQuX2VsZW1lbnRzWyJwcmV2aW91cyJdICYmIGV2ZW50LnRhcmdldCAhPT0gdGhhdC5fZWxlbWVudHNbIm5leHQiXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGF0Ll9wYXVzZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gdGhhdC5fZWxlbWVudHNbInBhdXNlIl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHNbInBsYXkiXS5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSB0aGF0Ll9lbGVtZW50c1sicGxheSJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzWyJwYXVzZSJdLmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEhhbmRsZXMgY2Fyb3VzZWwgbW91c2VlbnRlciBldmVudHMKICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50IFRoZSBtb3VzZWVudGVyIGV2ZW50CiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gb25Nb3VzZUVudGVyKGV2ZW50KSB7CiAgICAgICAgICAgIGNsZWFyQXV0b3BsYXlJbnRlcnZhbCgpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogSGFuZGxlcyBjYXJvdXNlbCBtb3VzZWxlYXZlIGV2ZW50cwogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIG1vdXNlbGVhdmUgZXZlbnQKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBvbk1vdXNlTGVhdmUoZXZlbnQpIHsKICAgICAgICAgICAgcmVzZXRBdXRvcGxheUludGVydmFsKCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBIYW5kbGVzIHBhdXNlIGVsZW1lbnQgY2xpY2sgZXZlbnRzCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgY2xpY2sgZXZlbnQKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBvblBhdXNlQ2xpY2soZXZlbnQpIHsKICAgICAgICAgICAgcGF1c2UoKTsKICAgICAgICAgICAgdGhhdC5fZWxlbWVudHNbInBsYXkiXS5mb2N1cygpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogSGFuZGxlcyBwbGF5IGVsZW1lbnQgY2xpY2sgZXZlbnRzCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgY2xpY2sgZXZlbnQKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBvblBsYXlDbGljaygpIHsKICAgICAgICAgICAgcGxheSgpOwogICAgICAgICAgICB0aGF0Ll9lbGVtZW50c1sicGF1c2UiXS5mb2N1cygpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUGF1c2VzIHRoZSBwbGF5aW5nIG9mIHRoZSBDYXJvdXNlbC4gU2V0cyB7QGNvZGUgQ2Fyb3VzZWwjX3BhdXNlZH0gbWFya2VyLgogICAgICAgICAqIE9ubHkgcmVsZXZhbnQgd2hlbiBhdXRvcGxheSBpcyBlbmFibGVkCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIHBhdXNlKCkgewogICAgICAgICAgICB0aGF0Ll9wYXVzZWQgPSB0cnVlOwogICAgICAgICAgICBjbGVhckF1dG9wbGF5SW50ZXJ2YWwoKTsKICAgICAgICAgICAgcmVmcmVzaFBsYXlQYXVzZUFjdGlvbnMoKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEVuYWJsZXMgdGhlIHBsYXlpbmcgb2YgdGhlIENhcm91c2VsLiBTZXRzIHtAY29kZSBDYXJvdXNlbCNfcGF1c2VkfSBtYXJrZXIuCiAgICAgICAgICogT25seSByZWxldmFudCB3aGVuIGF1dG9wbGF5IGlzIGVuYWJsZWQKICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gcGxheSgpIHsKICAgICAgICAgICAgdGhhdC5fcGF1c2VkID0gZmFsc2U7CgogICAgICAgICAgICAvLyBJZiB0aGUgQ2Fyb3VzZWwgaXMgaG92ZXJlZCwgZG9uJ3QgYmVnaW4gYXV0byB0cmFuc2l0aW9uaW5nIHVudGlsIHRoZSBuZXh0IG1vdXNlIGxlYXZlIGV2ZW50CiAgICAgICAgICAgIHZhciBob3ZlcmVkID0gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGF0Ll9lbGVtZW50cy5zZWxmLnBhcmVudEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIGhvdmVyZWQgPSB0aGF0Ll9lbGVtZW50cy5zZWxmLnBhcmVudEVsZW1lbnQucXVlcnlTZWxlY3RvcigiOmhvdmVyIikgPT09IHRoYXQuX2VsZW1lbnRzLnNlbGY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoYXQuX3Byb3BlcnRpZXMuYXV0b3BhdXNlRGlzYWJsZWQgfHwgIWhvdmVyZWQpIHsKICAgICAgICAgICAgICAgIHJlc2V0QXV0b3BsYXlJbnRlcnZhbCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZWZyZXNoUGxheVBhdXNlQWN0aW9ucygpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmVmcmVzaGVzIHRoZSBwbGF5L3BhdXNlIGFjdGlvbiBtYXJrdXAgYmFzZWQgb24gdGhlIHtAY29kZSBDYXJvdXNlbCNfcGF1c2VkfSBzdGF0ZQogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiByZWZyZXNoUGxheVBhdXNlQWN0aW9ucygpIHsKICAgICAgICAgICAgc2V0QWN0aW9uRGlzYWJsZWQodGhhdC5fZWxlbWVudHNbInBhdXNlIl0sIHRoYXQuX3BhdXNlZCk7CiAgICAgICAgICAgIHNldEFjdGlvbkRpc2FibGVkKHRoYXQuX2VsZW1lbnRzWyJwbGF5Il0sICF0aGF0Ll9wYXVzZWQpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmVmcmVzaGVzIHRoZSBpdGVtIG1hcmt1cCBiYXNlZCBvbiB0aGUgY3VycmVudCB7QGNvZGUgQ2Fyb3VzZWwjX2FjdGl2ZX0gaW5kZXgKICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gcmVmcmVzaEFjdGl2ZSgpIHsKICAgICAgICAgICAgdmFyIGl0ZW1zID0gdGhhdC5fZWxlbWVudHNbIml0ZW0iXTsKICAgICAgICAgICAgdmFyIGluZGljYXRvcnMgPSB0aGF0Ll9lbGVtZW50c1siaW5kaWNhdG9yIl07CgogICAgICAgICAgICBpZiAoaXRlbXMpIHsKICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW1zKSkgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IHBhcnNlSW50KHRoYXQuX2FjdGl2ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zW2ldLmNsYXNzTGlzdC5hZGQoImNtcC1jYXJvdXNlbF9faXRlbS0tYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1tpXS5yZW1vdmVBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRpY2F0b3JzW2ldLmNsYXNzTGlzdC5hZGQoImNtcC1jYXJvdXNlbF9faW5kaWNhdG9yLS1hY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGljYXRvcnNbaV0uc2V0QXR0cmlidXRlKCJhcmlhLXNlbGVjdGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRpY2F0b3JzW2ldLnNldEF0dHJpYnV0ZSgidGFiaW5kZXgiLCAiMCIpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNbaV0uY2xhc3NMaXN0LnJlbW92ZSgiY21wLWNhcm91c2VsX19pdGVtLS1hY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zW2ldLnNldEF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGljYXRvcnNbaV0uY2xhc3NMaXN0LnJlbW92ZSgiY21wLWNhcm91c2VsX19pbmRpY2F0b3ItLWFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kaWNhdG9yc1tpXS5zZXRBdHRyaWJ1dGUoImFyaWEtc2VsZWN0ZWQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRpY2F0b3JzW2ldLnNldEF0dHJpYnV0ZSgidGFiaW5kZXgiLCAiLTEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gb25seSBvbmUgaXRlbQogICAgICAgICAgICAgICAgICAgIGl0ZW1zLmNsYXNzTGlzdC5hZGQoImNtcC1jYXJvdXNlbF9faXRlbS0tYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgaW5kaWNhdG9ycy5jbGFzc0xpc3QuYWRkKCJjbXAtY2Fyb3VzZWxfX2luZGljYXRvci0tYWN0aXZlIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEZvY3VzZXMgdGhlIGVsZW1lbnQgYW5kIHByZXZlbnRzIHNjcm9sbGluZyB0aGUgZWxlbWVudCBpbnRvIHZpZXcKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnQgRWxlbWVudCB0byBmb2N1cwogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGZvY3VzV2l0aG91dFNjcm9sbChlbGVtZW50KSB7CiAgICAgICAgICAgIHZhciB4ID0gd2luZG93LnNjcm9sbFggfHwgd2luZG93LnBhZ2VYT2Zmc2V0OwogICAgICAgICAgICB2YXIgeSA9IHdpbmRvdy5zY3JvbGxZIHx8IHdpbmRvdy5wYWdlWU9mZnNldDsKICAgICAgICAgICAgZWxlbWVudC5mb2N1cygpOwogICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oeCwgeSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIG5leHQgYWN0aXZlIGluZGV4LCB3aXRoIGxvb3BpbmcKICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICogQHJldHVybnMge051bWJlcn0gSW5kZXggb2YgdGhlIG5leHQgY2Fyb3VzZWwgaXRlbQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGdldE5leHRJbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoYXQuX2FjdGl2ZSA9PT0gKHRoYXQuX2VsZW1lbnRzWyJpdGVtIl0ubGVuZ3RoIC0gMSkgPyAwIDogdGhhdC5fYWN0aXZlICsgMTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHJpZXZlcyB0aGUgcHJldmlvdXMgYWN0aXZlIGluZGV4LCB3aXRoIGxvb3BpbmcKICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICogQHJldHVybnMge051bWJlcn0gSW5kZXggb2YgdGhlIHByZXZpb3VzIGNhcm91c2VsIGl0ZW0KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBnZXRQcmV2aW91c0luZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhhdC5fYWN0aXZlID09PSAwID8gKHRoYXQuX2VsZW1lbnRzWyJpdGVtIl0ubGVuZ3RoIC0gMSkgOiB0aGF0Ll9hY3RpdmUgLSAxOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogTmF2aWdhdGVzIHRvIHRoZSBpdGVtIGF0IHRoZSBwcm92aWRlZCBpbmRleAogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSBpdGVtIHRvIG5hdmlnYXRlIHRvCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gbmF2aWdhdGUoaW5kZXgpIHsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+ICh0aGF0Ll9lbGVtZW50c1siaXRlbSJdLmxlbmd0aCAtIDEpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoYXQuX2FjdGl2ZSA9IGluZGV4OwogICAgICAgICAgICByZWZyZXNoQWN0aXZlKCk7CgogICAgICAgICAgICAvLyByZXNldCB0aGUgYXV0b3BsYXkgdHJhbnNpdGlvbiBpbnRlcnZhbCBmb2xsb3dpbmcgbmF2aWdhdGlvbiwgaWYgbm90IGFscmVhZHkgaG92ZXJpbmcgdGhlIGNhcm91c2VsCiAgICAgICAgICAgIGlmICh0aGF0Ll9lbGVtZW50cy5zZWxmLnBhcmVudEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGF0Ll9lbGVtZW50cy5zZWxmLnBhcmVudEVsZW1lbnQucXVlcnlTZWxlY3RvcigiOmhvdmVyIikgIT09IHRoYXQuX2VsZW1lbnRzLnNlbGYpIHsKICAgICAgICAgICAgICAgICAgICByZXNldEF1dG9wbGF5SW50ZXJ2YWwoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogTmF2aWdhdGVzIHRvIHRoZSBpdGVtIGF0IHRoZSBwcm92aWRlZCBpbmRleCBhbmQgZW5zdXJlcyB0aGUgYWN0aXZlIGluZGljYXRvciBnYWlucyBmb2N1cwogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSBpdGVtIHRvIG5hdmlnYXRlIHRvCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gbmF2aWdhdGVBbmRGb2N1c0luZGljYXRvcihpbmRleCkgewogICAgICAgICAgICBuYXZpZ2F0ZShpbmRleCk7CiAgICAgICAgICAgIGZvY3VzV2l0aG91dFNjcm9sbCh0aGF0Ll9lbGVtZW50c1siaW5kaWNhdG9yIl1baW5kZXhdKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFN0YXJ0cy9yZXNldHMgYXV0b21hdGljIHNsaWRlIHRyYW5zaXRpb24gaW50ZXJ2YWwKICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gcmVzZXRBdXRvcGxheUludGVydmFsKCkgewogICAgICAgICAgICBpZiAodGhhdC5fcGF1c2VkIHx8ICF0aGF0Ll9wcm9wZXJ0aWVzLmF1dG9wbGF5KSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xlYXJBdXRvcGxheUludGVydmFsKCk7CiAgICAgICAgICAgIHRoYXQuX2F1dG9wbGF5SW50ZXJ2YWxJZCA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC52aXNpYmlsaXR5U3RhdGUgJiYgZG9jdW1lbnQuaGlkZGVuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGluZGljYXRvcnMgPSB0aGF0Ll9lbGVtZW50c1siaW5kaWNhdG9ycyJdOwogICAgICAgICAgICAgICAgaWYgKGluZGljYXRvcnMgIT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgaW5kaWNhdG9ycy5jb250YWlucyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KSkgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIGFuIGluZGljYXRvciBoYXMgZm9jdXMsIGVuc3VyZSB3ZSBzd2l0Y2ggZm9jdXMgZm9sbG93aW5nIG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0ZUFuZEZvY3VzSW5kaWNhdG9yKGdldE5leHRJbmRleCgpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGUoZ2V0TmV4dEluZGV4KCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB0aGF0Ll9wcm9wZXJ0aWVzLmRlbGF5KTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENsZWFycy9wYXVzZXMgYXV0b21hdGljIHNsaWRlIHRyYW5zaXRpb24gaW50ZXJ2YWwKICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gY2xlYXJBdXRvcGxheUludGVydmFsKCkgewogICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGF0Ll9hdXRvcGxheUludGVydmFsSWQpOwogICAgICAgICAgICB0aGF0Ll9hdXRvcGxheUludGVydmFsSWQgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgZGlzYWJsZWQgc3RhdGUgZm9yIGFuIGFjdGlvbiBhbmQgdG9nZ2xlcyB0aGUgYXBwcm9wcmlhdGUgQ1NTIGNsYXNzZXMKICAgICAgICAgKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gYWN0aW9uIEFjdGlvbiB0byBkaXNhYmxlCiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbZGlzYWJsZV0ge0Bjb2RlIHRydWV9IHRvIGRpc2FibGUsIHtAY29kZSBmYWxzZX0gdG8gZW5hYmxlCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gc2V0QWN0aW9uRGlzYWJsZWQoYWN0aW9uLCBkaXNhYmxlKSB7CiAgICAgICAgICAgIGlmICghYWN0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRpc2FibGUgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBhY3Rpb24uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgYWN0aW9uLmNsYXNzTGlzdC5hZGQoImNtcC1jYXJvdXNlbF9fYWN0aW9uLS1kaXNhYmxlZCIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWN0aW9uLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBhY3Rpb24uY2xhc3NMaXN0LnJlbW92ZSgiY21wLWNhcm91c2VsX19hY3Rpb24tLWRpc2FibGVkIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWFkcyBvcHRpb25zIGRhdGEgZnJvbSB0aGUgQ2Fyb3VzZWwgd3JhcHBlciBlbGVtZW50LCBkZWZpbmVkIHZpYSB7QGNvZGUgZGF0YS1jbXAtKn0gZGF0YSBhdHRyaWJ1dGVzCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnQgVGhlIENhcm91c2VsIGVsZW1lbnQgdG8gcmVhZCBvcHRpb25zIGRhdGEgZnJvbQogICAgICogQHJldHVybnMge09iamVjdH0gVGhlIG9wdGlvbnMgcmVhZCBmcm9tIHRoZSBjb21wb25lbnQgZGF0YSBhdHRyaWJ1dGVzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlYWREYXRhKGVsZW1lbnQpIHsKICAgICAgICB2YXIgZGF0YSA9IGVsZW1lbnQuZGF0YXNldDsKICAgICAgICB2YXIgb3B0aW9ucyA9IFtdOwogICAgICAgIHZhciBjYXBpdGFsaXplZCA9IElTOwogICAgICAgIGNhcGl0YWxpemVkID0gY2FwaXRhbGl6ZWQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBjYXBpdGFsaXplZC5zbGljZSgxKTsKICAgICAgICB2YXIgcmVzZXJ2ZWQgPSBbImlzIiwgImhvb2siICsgY2FwaXRhbGl6ZWRdOwoKICAgICAgICBmb3IgKHZhciBrZXkgaW4gZGF0YSkgewogICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBkYXRhW2tleV07CgogICAgICAgICAgICAgICAgaWYgKGtleS5pbmRleE9mKE5TKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGtleSA9IGtleS5zbGljZShOUy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIGtleSA9IGtleS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIGtleS5zdWJzdHJpbmcoMSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChyZXNlcnZlZC5pbmRleE9mKGtleSkgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNba2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBEb2N1bWVudCByZWFkeSBoYW5kbGVyIGFuZCBET00gbXV0YXRpb24gb2JzZXJ2ZXJzLiBJbml0aWFsaXplcyBDYXJvdXNlbCBjb21wb25lbnRzIGFzIG5lY2Vzc2FyeS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICBmdW5jdGlvbiBvbkRvY3VtZW50UmVhZHkoKSB7CiAgICAgICAgdmFyIGVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcnMuc2VsZik7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBuZXcgQ2Fyb3VzZWwoeyBlbGVtZW50OiBlbGVtZW50c1tpXSwgb3B0aW9uczogcmVhZERhdGEoZWxlbWVudHNbaV0pIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIE11dGF0aW9uT2JzZXJ2ZXIgPSB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuTW96TXV0YXRpb25PYnNlcnZlcjsKICAgICAgICB2YXIgYm9keSAgICAgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImJvZHkiKTsKICAgICAgICB2YXIgb2JzZXJ2ZXIgICAgICAgICA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKG11dGF0aW9ucykgewogICAgICAgICAgICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihtdXRhdGlvbikgewogICAgICAgICAgICAgICAgLy8gbmVlZGVkIGZvciBJRQogICAgICAgICAgICAgICAgdmFyIG5vZGVzQXJyYXkgPSBbXS5zbGljZS5jYWxsKG11dGF0aW9uLmFkZGVkTm9kZXMpOwogICAgICAgICAgICAgICAgaWYgKG5vZGVzQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIG5vZGVzQXJyYXkuZm9yRWFjaChmdW5jdGlvbihhZGRlZE5vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFkZGVkTm9kZS5xdWVyeVNlbGVjdG9yQWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudHNBcnJheSA9IFtdLnNsaWNlLmNhbGwoYWRkZWROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JzLnNlbGYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzQXJyYXkuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IENhcm91c2VsKHsgZWxlbWVudDogZWxlbWVudCwgb3B0aW9uczogcmVhZERhdGEoZWxlbWVudCkgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShib2R5LCB7CiAgICAgICAgICAgIHN1YnRyZWU6IHRydWUsCiAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSwKICAgICAgICAgICAgY2hhcmFjdGVyRGF0YTogdHJ1ZQogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlICE9PSAibG9hZGluZyIpIHsKICAgICAgICBvbkRvY3VtZW50UmVhZHkoKTsKICAgIH0gZWxzZSB7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIG9uRG9jdW1lbnRSZWFkeSk7CiAgICB9Cgp9KCkpOwoKCihmdW5jdGlvbigkKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkeW5hbWljLWNvbnRlbnQiKSkgeyAgCgogICAgICAgIC8vIEhpZGUgdGhlIG1haW4gZGl2IG9uIHBhZ2UgbG9hZC4KCSAgICAkKCcjeGYtY29udGVudCcpLmhpZGUoKTsKCiAgICAJdmFyIGNvb2tpZVZhbHVlID0gJCgiI2Nvb2tpZS12YWx1ZSIpLmF0dHIoImRhdGEiKTsKICAgICAgICB2YXIgY3VycmVudFBhZ2VQYXRoID0gJCgiI3Jlc291cmNlLXBhdGgiKS5hdHRyKCJkYXRhIik7CgoJICAgIC8vIFNldCBjb29raWUgdGhyb3VnaCBKYXZhc2NyaXB0IGZvciBQT0MgcHVycG9zZS4KICAgIAlzZXRDb29raWUoImhwLWR5bmFtaWMtY29udGVudCIsIGNvb2tpZVZhbHVlLDEpOwoKCSAgICBnZXRYRlBhdGgoKTsKCX0KCiAgICBmdW5jdGlvbiBzZXRDb29raWUobmFtZSx2YWx1ZSxkYXlzKSB7CiAgICAgICAgdmFyIGV4cGlyZXMgPSAiIjsKICAgICAgICBpZiAoZGF5cykgewogICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgIGRhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSArIChkYXlzKjI0KjYwKjYwKjEwMDApKTsKICAgICAgICAgICAgZXhwaXJlcyA9ICI7IGV4cGlyZXM9IiArIGRhdGUudG9VVENTdHJpbmcoKTsKICAgICAgICB9CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gbmFtZSArICI9IiArICh2YWx1ZSB8fCAiIikgICsgZXhwaXJlcyArICI7IHBhdGg9LyI7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0WEZQYXRoKCl7CiAgICAgICAgLy9TaG93IGxvYWRlciBHSUYgdGlsbCB0aGUgdGltZSByZXNwb25zZSBpcyBmZXRjaGVkIGZyb20gdGhlIGNhbGwuCiAgICAgICAgJCgnLmxvYWRlcicpLnNob3coKTsKCiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHR5cGU6ICJHRVQiLAogICAgICAgICAgICAgICAgdXJsOiAiL2Jpbi9ocC9keW5hbWljY29udGVudCIsCiAgICAgICAgICAgICAgICBkYXRhOidyZXNvdXJjZVBhdGg9JysgY3VycmVudFBhZ2VQYXRoLAogICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdodG1sJywgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbigpeyAKICAgICAgICAgICAgICAgICAgICAkKCcubG9hZGVyJykuZmFkZU91dCgpOwogICAgICAgICAgICAgICAgICAgICQoJyN4Zi1jb250ZW50Jykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICQoIiN4Zi1jb250ZW50IikubG9hZCgiICN4Zi1jb250ZW50Iik7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgIC8vSGFuZGxlIGVycm9yCiAgICAgICAgICAgICAgICAgICAgJCgnI3hmLWNvbnRlbnQnKS50ZXh0KCJFcnJvciBPY2N1cnJlZC4gQ291bGQgbm90IGZldGNoIHRoZSBFeHBlcmllbmNlIEZyYWdtZW50IGRldGFpbHMgdGhyb3VnaCBzZXJ2ZXIuIik7CiAgICAgICAgICAgICAgICAgICAkKCcubG9hZGVyJykuaGlkZSgpOwogICAgICAgICAgICAgIH0gICAgICAgICAgIAogICAgICAgICAgICB9KTsKICAgIH0KCn0pKGpRdWVyeSk7CgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogKiBDb3B5cmlnaHQgMjAxNyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwppZiAod2luZG93LkVsZW1lbnQgJiYgIUVsZW1lbnQucHJvdG90eXBlLmNsb3Nlc3QpIHsKICAgIC8vIGVzbGludCB2YWxpZC1qc2RvYzogIm9mZiIKICAgIEVsZW1lbnQucHJvdG90eXBlLmNsb3Nlc3QgPQogICAgICAgIGZ1bmN0aW9uKHMpIHsKICAgICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9ICh0aGlzLmRvY3VtZW50IHx8IHRoaXMub3duZXJEb2N1bWVudCkucXVlcnlTZWxlY3RvckFsbChzKTsKICAgICAgICAgICAgdmFyIGVsICAgICAgPSB0aGlzOwogICAgICAgICAgICB2YXIgaTsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgaSA9IG1hdGNoZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKC0taSA+PSAwICYmIG1hdGNoZXMuaXRlbShpKSAhPT0gZWwpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlICgoaSA8IDApICYmIChlbCA9IGVsLnBhcmVudEVsZW1lbnQpKTsKICAgICAgICAgICAgcmV0dXJuIGVsOwogICAgICAgIH07Cn0KCmlmICh3aW5kb3cuRWxlbWVudCAmJiAhRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlcykgewogICAgRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlcyA9CiAgICAgICAgRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlc1NlbGVjdG9yIHx8CiAgICAgICAgRWxlbWVudC5wcm90b3R5cGUubW96TWF0Y2hlc1NlbGVjdG9yIHx8CiAgICAgICAgRWxlbWVudC5wcm90b3R5cGUubXNNYXRjaGVzU2VsZWN0b3IgfHwKICAgICAgICBFbGVtZW50LnByb3RvdHlwZS5vTWF0Y2hlc1NlbGVjdG9yIHx8CiAgICAgICAgRWxlbWVudC5wcm90b3R5cGUud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8CiAgICAgICAgZnVuY3Rpb24ocykgewogICAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gKHRoaXMuZG9jdW1lbnQgfHwgdGhpcy5vd25lckRvY3VtZW50KS5xdWVyeVNlbGVjdG9yQWxsKHMpOwogICAgICAgICAgICB2YXIgaSAgICAgICA9IG1hdGNoZXMubGVuZ3RoOwogICAgICAgICAgICB3aGlsZSAoLS1pID49IDAgJiYgbWF0Y2hlcy5pdGVtKGkpICE9PSB0aGlzKSB7CiAgICAgICAgICAgICAgICAvLyBjb250aW51ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBpID4gLTE7CiAgICAgICAgfTsKfQoKaWYgKCFPYmplY3QuYXNzaWduKSB7CiAgICBPYmplY3QuYXNzaWduID0gZnVuY3Rpb24odGFyZ2V0LCB2YXJBcmdzKSB7IC8vIC5sZW5ndGggb2YgZnVuY3Rpb24gaXMgMgogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICBpZiAodGFyZ2V0ID09PSBudWxsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjb252ZXJ0IHVuZGVmaW5lZCBvciBudWxsIHRvIG9iamVjdCIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHRvID0gT2JqZWN0KHRhcmdldCk7CgogICAgICAgIGZvciAodmFyIGluZGV4ID0gMTsgaW5kZXggPCBhcmd1bWVudHMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIHZhciBuZXh0U291cmNlID0gYXJndW1lbnRzW2luZGV4XTsKCiAgICAgICAgICAgIGlmIChuZXh0U291cmNlICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBuZXh0S2V5IGluIG5leHRTb3VyY2UpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG5leHRTb3VyY2UsIG5leHRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvW25leHRLZXldID0gbmV4dFNvdXJjZVtuZXh0S2V5XTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRvOwogICAgfTsKfQoKKGZ1bmN0aW9uKGFycikgewogICAgInVzZSBzdHJpY3QiOwogICAgYXJyLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KCJyZW1vdmUiKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpdGVtLCAicmVtb3ZlIiwgewogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlKCkgewogICAgICAgICAgICAgICAgdGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKfSkoW0VsZW1lbnQucHJvdG90eXBlLCBDaGFyYWN0ZXJEYXRhLnByb3RvdHlwZSwgRG9jdW1lbnRUeXBlLnByb3RvdHlwZV0pOwoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICogQ29weXJpZ2h0IDIwMTYgQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KKGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBOUyA9ICJjbXAiOwogICAgdmFyIElTID0gImltYWdlIjsKCiAgICB2YXIgRU1QVFlfUElYRUwgPSAiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFJQUFBQUFBQVAvLy95SDVCQUVBQUFBQUxBQUFBQUFCQUFFQUFBSUJSQUE3IjsKICAgIHZhciBMQVpZX1RIUkVTSE9MRCA9IDA7CiAgICB2YXIgU1JDX1VSSV9URU1QTEFURV9XSURUSF9WQVIgPSAiey53aWR0aH0iOwoKICAgIHZhciBzZWxlY3RvcnMgPSB7CiAgICAgICAgc2VsZjogIltkYXRhLSIgKyBOUyArICctaXM9IicgKyBJUyArICciXScsCiAgICAgICAgaW1hZ2U6ICdbZGF0YS1jbXAtaG9vay1pbWFnZT0iaW1hZ2UiXScsCiAgICAgICAgbWFwOiAnW2RhdGEtY21wLWhvb2staW1hZ2U9Im1hcCJdJywKICAgICAgICBhcmVhOiAnW2RhdGEtY21wLWhvb2staW1hZ2U9ImFyZWEiXScKICAgIH07CgogICAgdmFyIGxhenlMb2FkZXIgPSB7CiAgICAgICAgImNzc0NsYXNzIjogImNtcC1pbWFnZV9faW1hZ2UtLWlzLWxvYWRpbmciLAogICAgICAgICJzdHlsZSI6IHsKICAgICAgICAgICAgImhlaWdodCI6IDAsCiAgICAgICAgICAgICJwYWRkaW5nLWJvdHRvbSI6ICIiIC8vIHdpbGwgYmUgcmVwbGFjZWQgd2l0aCAlIHJhdGlvCiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgcHJvcGVydGllcyA9IHsKICAgICAgICAvKioKICAgICAgICAgKiBBbiBhcnJheSBvZiBhbHRlcm5hdGl2ZSBpbWFnZSB3aWR0aHMgKGluIHBpeGVscykuCiAgICAgICAgICogVXNlZCB0byByZXBsYWNlIGEgey53aWR0aH0gdmFyaWFibGUgaW4gdGhlIHNyYyBwcm9wZXJ0eSB3aXRoIGFuIG9wdGltYWwgd2lkdGggaWYgYSBVUkkgdGVtcGxhdGUgaXMgcHJvdmlkZWQuCiAgICAgICAgICoKICAgICAgICAgKiBAbWVtYmVyb2YgSW1hZ2UKICAgICAgICAgKiBAdHlwZSB7TnVtYmVyW119CiAgICAgICAgICogQGRlZmF1bHQgW10KICAgICAgICAgKi8KICAgICAgICAid2lkdGhzIjogewogICAgICAgICAgICAiZGVmYXVsdCI6IFtdLAogICAgICAgICAgICAidHJhbnNmb3JtIjogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciB3aWR0aHMgPSBbXTsKICAgICAgICAgICAgICAgIHZhbHVlLnNwbGl0KCIsIikuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHBhcnNlRmxvYXQoaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc05hTihpdGVtKSkgewogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aHMucHVzaChpdGVtKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiB3aWR0aHM7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBpbWFnZSBzaG91bGQgYmUgcmVuZGVyZWQgbGF6aWx5LgogICAgICAgICAqCiAgICAgICAgICogQG1lbWJlcm9mIEltYWdlCiAgICAgICAgICogQHR5cGUge0Jvb2xlYW59CiAgICAgICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAgICAgKi8KICAgICAgICAibGF6eSI6IHsKICAgICAgICAgICAgImRlZmF1bHQiOiBmYWxzZSwKICAgICAgICAgICAgInRyYW5zZm9ybSI6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gISh2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09ICJ1bmRlZmluZWQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGltYWdlIHNvdXJjZS4KICAgICAgICAgKgogICAgICAgICAqIENhbiBiZSBhIHNpbXBsZSBpbWFnZSBzb3VyY2UsIG9yIGEgVVJJIHRlbXBsYXRlIHJlcHJlc2VudGF0aW9uIHRoYXQKICAgICAgICAgKiBjYW4gYmUgdmFyaWFibGUgZXhwYW5kZWQgLSB1c2VmdWwgZm9yIGJ1aWxkaW5nIGFuIGltYWdlIGNvbmZpZ3VyYXRpb24gd2l0aCBhbiBhbHRlcm5hdGl2ZSB3aWR0aC4KICAgICAgICAgKiBlLmcuICcvcGF0aC9pbWFnZS5jb3JlaW1ney53aWR0aH0uanBlZy8xNTA2NjIwOTU0MjE0LmpwZWcnCiAgICAgICAgICoKICAgICAgICAgKiBAbWVtYmVyb2YgSW1hZ2UKICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfQogICAgICAgICAqLwogICAgICAgICJzcmMiOiB7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgZGV2aWNlUGl4ZWxSYXRpbyA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7CgogICAgZnVuY3Rpb24gcmVhZERhdGEoZWxlbWVudCkgewogICAgICAgIHZhciBkYXRhID0gZWxlbWVudC5kYXRhc2V0OwogICAgICAgIHZhciBvcHRpb25zID0gW107CiAgICAgICAgdmFyIGNhcGl0YWxpemVkID0gSVM7CiAgICAgICAgY2FwaXRhbGl6ZWQgPSBjYXBpdGFsaXplZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGNhcGl0YWxpemVkLnNsaWNlKDEpOwogICAgICAgIHZhciByZXNlcnZlZCA9IFsiaXMiLCAiaG9vayIgKyBjYXBpdGFsaXplZF07CgogICAgICAgIGZvciAodmFyIGtleSBpbiBkYXRhKSB7CiAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGRhdGFba2V5XTsKCiAgICAgICAgICAgICAgICBpZiAoa2V5LmluZGV4T2YoTlMpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAga2V5ID0ga2V5LnNsaWNlKE5TLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAga2V5ID0ga2V5LmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsga2V5LnN1YnN0cmluZygxKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc2VydmVkLmluZGV4T2Yoa2V5KSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1trZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb3B0aW9uczsKICAgIH0KCiAgICBmdW5jdGlvbiBJbWFnZShjb25maWcpIHsKICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CgogICAgICAgIGZ1bmN0aW9uIGluaXQoY29uZmlnKSB7CiAgICAgICAgICAgIC8vIHByZXZlbnRzIG11bHRpcGxlIGluaXRpYWxpemF0aW9uCiAgICAgICAgICAgIGNvbmZpZy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgiZGF0YS0iICsgTlMgKyAiLWlzIik7CgogICAgICAgICAgICBzZXR1cFByb3BlcnRpZXMoY29uZmlnLm9wdGlvbnMpOwogICAgICAgICAgICBjYWNoZUVsZW1lbnRzKGNvbmZpZy5lbGVtZW50KTsKCiAgICAgICAgICAgIGlmICghdGhhdC5fZWxlbWVudHMubm9zY3JpcHQpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuY29udGFpbmVyID0gdGhhdC5fZWxlbWVudHMubGluayA/IHRoYXQuX2VsZW1lbnRzLmxpbmsgOiB0aGF0Ll9lbGVtZW50cy5zZWxmOwoKICAgICAgICAgICAgdW53cmFwTm9TY3JpcHQoKTsKCiAgICAgICAgICAgIGlmICh0aGF0Ll9wcm9wZXJ0aWVzLmxhenkpIHsKICAgICAgICAgICAgICAgIGFkZExhenlMb2FkZXIoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoYXQuX2VsZW1lbnRzLm1hcCkgewogICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsIG9uTG9hZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJzY3JvbGwiLCB0aGF0LnVwZGF0ZSk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCBvbldpbmRvd1Jlc2l6ZSk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ1cGRhdGUiLCB0aGF0LnVwZGF0ZSk7CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLmltYWdlLmFkZEV2ZW50TGlzdGVuZXIoImNtcC1pbWFnZS1yZWRyYXciLCB0aGF0LnVwZGF0ZSk7CiAgICAgICAgICAgIHRoYXQudXBkYXRlKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsb2FkSW1hZ2UoKSB7CiAgICAgICAgICAgIHZhciBoYXNXaWR0aHMgPSB0aGF0Ll9wcm9wZXJ0aWVzLndpZHRocyAmJiB0aGF0Ll9wcm9wZXJ0aWVzLndpZHRocy5sZW5ndGggPiAwOwogICAgICAgICAgICB2YXIgcmVwbGFjZW1lbnQgPSBoYXNXaWR0aHMgPyAiLiIgKyBnZXRPcHRpbWFsV2lkdGgoKSA6ICIiOwogICAgICAgICAgICB2YXIgdXJsID0gdGhhdC5fcHJvcGVydGllcy5zcmMucmVwbGFjZShTUkNfVVJJX1RFTVBMQVRFX1dJRFRIX1ZBUiwgcmVwbGFjZW1lbnQpOwoKICAgICAgICAgICAgaWYgKHRoYXQuX2VsZW1lbnRzLmltYWdlLmdldEF0dHJpYnV0ZSgic3JjIikgIT09IHVybCkgewogICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuaW1hZ2Uuc2V0QXR0cmlidXRlKCJzcmMiLCB1cmwpOwogICAgICAgICAgICAgICAgaWYgKCFoYXNXaWR0aHMpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigic2Nyb2xsIiwgdGhhdC51cGRhdGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhhdC5fbGF6eUxvYWRlclNob3dpbmcpIHsKICAgICAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLmltYWdlLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCByZW1vdmVMYXp5TG9hZGVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0T3B0aW1hbFdpZHRoKCkgewogICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdGhhdC5fZWxlbWVudHMuc2VsZjsKICAgICAgICAgICAgdmFyIGNvbnRhaW5lcldpZHRoID0gY29udGFpbmVyLmNsaWVudFdpZHRoOwogICAgICAgICAgICB3aGlsZSAoY29udGFpbmVyV2lkdGggPT09IDAgJiYgY29udGFpbmVyLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lciA9IGNvbnRhaW5lci5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgY29udGFpbmVyV2lkdGggPSBjb250YWluZXIuY2xpZW50V2lkdGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG9wdGltYWxXaWR0aCA9IGNvbnRhaW5lcldpZHRoICogZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICAgICAgdmFyIGxlbiA9IHRoYXQuX3Byb3BlcnRpZXMud2lkdGhzLmxlbmd0aDsKICAgICAgICAgICAgdmFyIGtleSA9IDA7CgogICAgICAgICAgICB3aGlsZSAoKGtleSA8IGxlbiAtIDEpICYmICh0aGF0Ll9wcm9wZXJ0aWVzLndpZHRoc1trZXldIDwgb3B0aW1hbFdpZHRoKSkgewogICAgICAgICAgICAgICAga2V5Kys7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0aGF0Ll9wcm9wZXJ0aWVzLndpZHRoc1trZXldLnRvU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhZGRMYXp5TG9hZGVyKCkgewogICAgICAgICAgICB2YXIgd2lkdGggPSB0aGF0Ll9lbGVtZW50cy5pbWFnZS5nZXRBdHRyaWJ1dGUoIndpZHRoIik7CiAgICAgICAgICAgIHZhciBoZWlnaHQgPSB0aGF0Ll9lbGVtZW50cy5pbWFnZS5nZXRBdHRyaWJ1dGUoImhlaWdodCIpOwoKICAgICAgICAgICAgaWYgKHdpZHRoICYmIGhlaWdodCkgewogICAgICAgICAgICAgICAgdmFyIHJhdGlvID0gKGhlaWdodCAvIHdpZHRoKSAqIDEwMDsKICAgICAgICAgICAgICAgIHZhciBzdHlsZXMgPSBsYXp5TG9hZGVyLnN0eWxlOwoKICAgICAgICAgICAgICAgIHN0eWxlc1sicGFkZGluZy1ib3R0b20iXSA9IHJhdGlvICsgIiUiOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIHMgaW4gc3R5bGVzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0eWxlcy5oYXNPd25Qcm9wZXJ0eShzKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50cy5pbWFnZS5zdHlsZVtzXSA9IHN0eWxlc1tzXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuaW1hZ2Uuc2V0QXR0cmlidXRlKCJzcmMiLCBFTVBUWV9QSVhFTCk7CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLmltYWdlLmNsYXNzTGlzdC5hZGQobGF6eUxvYWRlci5jc3NDbGFzcyk7CiAgICAgICAgICAgIHRoYXQuX2xhenlMb2FkZXJTaG93aW5nID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVud3JhcE5vU2NyaXB0KCkgewogICAgICAgICAgICB2YXIgbWFya3VwID0gZGVjb2RlTm9zY3JpcHQodGhhdC5fZWxlbWVudHMubm9zY3JpcHQudGV4dENvbnRlbnQudHJpbSgpKTsKICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTsKCiAgICAgICAgICAgIC8vIHRlbXBvcmFyeSBkb2N1bWVudCBhdm9pZHMgcmVxdWVzdGluZyB0aGUgaW1hZ2UgYmVmb3JlIHJlbW92aW5nIGl0cyBzcmMKICAgICAgICAgICAgdmFyIHRlbXBvcmFyeURvY3VtZW50ID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhtYXJrdXAsICJ0ZXh0L2h0bWwiKTsKICAgICAgICAgICAgdmFyIGltYWdlRWxlbWVudCA9IHRlbXBvcmFyeURvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JzLmltYWdlKTsKICAgICAgICAgICAgaW1hZ2VFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgic3JjIik7CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLmNvbnRhaW5lci5pbnNlcnRCZWZvcmUoaW1hZ2VFbGVtZW50LCB0aGF0Ll9lbGVtZW50cy5ub3NjcmlwdCk7CgogICAgICAgICAgICB2YXIgbWFwRWxlbWVudCA9IHRlbXBvcmFyeURvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JzLm1hcCk7CiAgICAgICAgICAgIGlmIChtYXBFbGVtZW50KSB7CiAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50cy5jb250YWluZXIuaW5zZXJ0QmVmb3JlKG1hcEVsZW1lbnQsIHRoYXQuX2VsZW1lbnRzLm5vc2NyaXB0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMubm9zY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGF0Ll9lbGVtZW50cy5ub3NjcmlwdCk7CiAgICAgICAgICAgIGlmICh0aGF0Ll9lbGVtZW50cy5jb250YWluZXIubWF0Y2hlcyhzZWxlY3RvcnMuaW1hZ2UpKSB7CiAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50cy5pbWFnZSA9IHRoYXQuX2VsZW1lbnRzLmNvbnRhaW5lcjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLmltYWdlID0gdGhhdC5fZWxlbWVudHMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JzLmltYWdlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMubWFwID0gdGhhdC5fZWxlbWVudHMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JzLm1hcCk7CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLmFyZWFzID0gdGhhdC5fZWxlbWVudHMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JzLmFyZWEpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlTGF6eUxvYWRlcigpIHsKICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuaW1hZ2UuY2xhc3NMaXN0LnJlbW92ZShsYXp5TG9hZGVyLmNzc0NsYXNzKTsKICAgICAgICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gbGF6eUxvYWRlci5zdHlsZSkgewogICAgICAgICAgICAgICAgaWYgKGxhenlMb2FkZXIuc3R5bGUuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuaW1hZ2Uuc3R5bGVbcHJvcGVydHldID0gIiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lcigibG9hZCIsIHJlbW92ZUxhenlMb2FkZXIpOwogICAgICAgICAgICB0aGF0Ll9sYXp5TG9hZGVyU2hvd2luZyA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaXNMYXp5VmlzaWJsZSgpIHsKICAgICAgICAgICAgaWYgKHRoYXQuX2VsZW1lbnRzLmNvbnRhaW5lci5vZmZzZXRQYXJlbnQgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHd0ID0gd2luZG93LnBhZ2VZT2Zmc2V0OwogICAgICAgICAgICB2YXIgd2IgPSB3dCArIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7CiAgICAgICAgICAgIHZhciBldCA9IHRoYXQuX2VsZW1lbnRzLmNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgKyB3dDsKICAgICAgICAgICAgdmFyIGViID0gZXQgKyB0aGF0Ll9lbGVtZW50cy5jb250YWluZXIuY2xpZW50SGVpZ2h0OwoKICAgICAgICAgICAgcmV0dXJuIGViID49IHd0IC0gTEFaWV9USFJFU0hPTEQgJiYgZXQgPD0gd2IgKyBMQVpZX1RIUkVTSE9MRDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlc2l6ZUFyZWFzKCkgewogICAgICAgICAgICBpZiAodGhhdC5fZWxlbWVudHMuYXJlYXMgJiYgdGhhdC5fZWxlbWVudHMuYXJlYXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGF0Ll9lbGVtZW50cy5hcmVhcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IHRoYXQuX2VsZW1lbnRzLmltYWdlLndpZHRoOwogICAgICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSB0aGF0Ll9lbGVtZW50cy5pbWFnZS5oZWlnaHQ7CgogICAgICAgICAgICAgICAgICAgIGlmICh3aWR0aCAmJiBoZWlnaHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlbGNvb3JkcyA9IHRoYXQuX2VsZW1lbnRzLmFyZWFzW2ldLmRhdGFzZXQuY21wUmVsY29vcmRzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVsY29vcmRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVsYXRpdmVDb29yZGluYXRlcyA9IHJlbGNvb3Jkcy5zcGxpdCgiLCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvb3JkaW5hdGVzID0gbmV3IEFycmF5KHJlbGF0aXZlQ29vcmRpbmF0ZXMubGVuZ3RoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNvb3JkaW5hdGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGogJSAyID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVzW2pdID0gcGFyc2VJbnQocmVsYXRpdmVDb29yZGluYXRlc1tqXSAqIHdpZHRoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29yZGluYXRlc1tqXSA9IHBhcnNlSW50KHJlbGF0aXZlQ29vcmRpbmF0ZXNbal0gKiBoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50cy5hcmVhc1tpXS5jb29yZHMgPSBjb29yZGluYXRlczsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2FjaGVFbGVtZW50cyh3cmFwcGVyKSB7CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzID0ge307CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLnNlbGYgPSB3cmFwcGVyOwogICAgICAgICAgICB2YXIgaG9va3MgPSB0aGF0Ll9lbGVtZW50cy5zZWxmLnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLSIgKyBOUyArICItaG9vay0iICsgSVMgKyAiXSIpOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBob29rcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGhvb2sgPSBob29rc1tpXTsKICAgICAgICAgICAgICAgIHZhciBjYXBpdGFsaXplZCA9IElTOwogICAgICAgICAgICAgICAgY2FwaXRhbGl6ZWQgPSBjYXBpdGFsaXplZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGNhcGl0YWxpemVkLnNsaWNlKDEpOwogICAgICAgICAgICAgICAgdmFyIGtleSA9IGhvb2suZGF0YXNldFtOUyArICJIb29rIiArIGNhcGl0YWxpemVkXTsKICAgICAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzW2tleV0gPSBob29rOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXR1cFByb3BlcnRpZXMob3B0aW9ucykgewogICAgICAgICAgICB0aGF0Ll9wcm9wZXJ0aWVzID0ge307CgogICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gcHJvcGVydGllcykgewogICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0eSA9IHByb3BlcnRpZXNba2V5XTsKICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zW2tleV0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydHkgJiYgdHlwZW9mIHByb3BlcnR5LnRyYW5zZm9ybSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fcHJvcGVydGllc1trZXldID0gcHJvcGVydHkudHJhbnNmb3JtKG9wdGlvbnNba2V5XSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9wcm9wZXJ0aWVzW2tleV0gPSBvcHRpb25zW2tleV07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9wcm9wZXJ0aWVzW2tleV0gPSBwcm9wZXJ0aWVzW2tleV1bImRlZmF1bHQiXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG9uV2luZG93UmVzaXplKCkgewogICAgICAgICAgICB0aGF0LnVwZGF0ZSgpOwogICAgICAgICAgICByZXNpemVBcmVhcygpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gb25Mb2FkKCkgewogICAgICAgICAgICByZXNpemVBcmVhcygpOwogICAgICAgIH0KCiAgICAgICAgdGhhdC51cGRhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKHRoYXQuX3Byb3BlcnRpZXMubGF6eSkgewogICAgICAgICAgICAgICAgaWYgKGlzTGF6eVZpc2libGUoKSkgewogICAgICAgICAgICAgICAgICAgIGxvYWRJbWFnZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbG9hZEltYWdlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBpZiAoY29uZmlnICYmIGNvbmZpZy5lbGVtZW50KSB7CiAgICAgICAgICAgIGluaXQoY29uZmlnKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gb25Eb2N1bWVudFJlYWR5KCkgewogICAgICAgIHZhciBlbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JzLnNlbGYpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbmV3IEltYWdlKHsgZWxlbWVudDogZWxlbWVudHNbaV0sIG9wdGlvbnM6IHJlYWREYXRhKGVsZW1lbnRzW2ldKSB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93Lk1vek11dGF0aW9uT2JzZXJ2ZXI7CiAgICAgICAgdmFyIGJvZHkgICAgICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJib2R5Iik7CiAgICAgICAgdmFyIG9ic2VydmVyICAgICAgICAgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbihtdXRhdGlvbnMpIHsKICAgICAgICAgICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24obXV0YXRpb24pIHsKICAgICAgICAgICAgICAgIC8vIG5lZWRlZCBmb3IgSUUKICAgICAgICAgICAgICAgIHZhciBub2Rlc0FycmF5ID0gW10uc2xpY2UuY2FsbChtdXRhdGlvbi5hZGRlZE5vZGVzKTsKICAgICAgICAgICAgICAgIGlmIChub2Rlc0FycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBub2Rlc0FycmF5LmZvckVhY2goZnVuY3Rpb24oYWRkZWROb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZGRlZE5vZGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRzQXJyYXkgPSBbXS5zbGljZS5jYWxsKGFkZGVkTm9kZS5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9ycy5zZWxmKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50c0FycmF5LmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJbWFnZSh7IGVsZW1lbnQ6IGVsZW1lbnQsIG9wdGlvbnM6IHJlYWREYXRhKGVsZW1lbnQpIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIG9ic2VydmVyLm9ic2VydmUoYm9keSwgewogICAgICAgICAgICBzdWJ0cmVlOiB0cnVlLAogICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsCiAgICAgICAgICAgIGNoYXJhY3RlckRhdGE6IHRydWUKICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gImxvYWRpbmciKSB7CiAgICAgICAgb25Eb2N1bWVudFJlYWR5KCk7CiAgICB9IGVsc2UgewogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBvbkRvY3VtZW50UmVhZHkpOwogICAgfQoKICAgIC8qCiAgICAgICAgb24gZHJhZyAmIGRyb3Agb2YgdGhlIGNvbXBvbmVudCBpbnRvIGEgcGFyc3lzLCBub3NjcmlwdCdzIGNvbnRlbnQgd2lsbCBiZSBlc2NhcGVkIG11bHRpcGxlIHRpbWVzIGJ5IHRoZSBlZGl0b3Igd2hpY2ggY3JlYXRlcwogICAgICAgIHRoZSBET00gZm9yIGVkaXRpbmc7IHRoZSBIVE1MIHBhcnNlciBjYW5ub3QgYmUgdXNlZCBoZXJlIGR1ZSB0byB0aGUgbXVsdGlwbGUgZXNjYXBpbmcKICAgICAqLwogICAgZnVuY3Rpb24gZGVjb2RlTm9zY3JpcHQodGV4dCkgewogICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyYoYW1wOykqbHQ7L2csICI8Iik7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvJihhbXA7KSpndDsvZywgIj4iKTsKICAgICAgICByZXR1cm4gdGV4dDsKICAgIH0KCn0pKCk7CgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogKiBDb3B5cmlnaHQgMjAxNyBBZG9iZQogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwppZiAod2luZG93LkVsZW1lbnQgJiYgIUVsZW1lbnQucHJvdG90eXBlLmNsb3Nlc3QpIHsKICAgIC8vIGVzbGludCB2YWxpZC1qc2RvYzogIm9mZiIKICAgIEVsZW1lbnQucHJvdG90eXBlLmNsb3Nlc3QgPQogICAgICAgIGZ1bmN0aW9uKHMpIHsKICAgICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9ICh0aGlzLmRvY3VtZW50IHx8IHRoaXMub3duZXJEb2N1bWVudCkucXVlcnlTZWxlY3RvckFsbChzKTsKICAgICAgICAgICAgdmFyIGVsICAgICAgPSB0aGlzOwogICAgICAgICAgICB2YXIgaTsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgaSA9IG1hdGNoZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKC0taSA+PSAwICYmIG1hdGNoZXMuaXRlbShpKSAhPT0gZWwpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlICgoaSA8IDApICYmIChlbCA9IGVsLnBhcmVudEVsZW1lbnQpKTsKICAgICAgICAgICAgcmV0dXJuIGVsOwogICAgICAgIH07Cn0KCmlmICh3aW5kb3cuRWxlbWVudCAmJiAhRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlcykgewogICAgRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlcyA9CiAgICAgICAgRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlc1NlbGVjdG9yIHx8CiAgICAgICAgRWxlbWVudC5wcm90b3R5cGUubW96TWF0Y2hlc1NlbGVjdG9yIHx8CiAgICAgICAgRWxlbWVudC5wcm90b3R5cGUubXNNYXRjaGVzU2VsZWN0b3IgfHwKICAgICAgICBFbGVtZW50LnByb3RvdHlwZS5vTWF0Y2hlc1NlbGVjdG9yIHx8CiAgICAgICAgRWxlbWVudC5wcm90b3R5cGUud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8CiAgICAgICAgZnVuY3Rpb24ocykgewogICAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gKHRoaXMuZG9jdW1lbnQgfHwgdGhpcy5vd25lckRvY3VtZW50KS5xdWVyeVNlbGVjdG9yQWxsKHMpOwogICAgICAgICAgICB2YXIgaSAgICAgICA9IG1hdGNoZXMubGVuZ3RoOwogICAgICAgICAgICB3aGlsZSAoLS1pID49IDAgJiYgbWF0Y2hlcy5pdGVtKGkpICE9PSB0aGlzKSB7CiAgICAgICAgICAgICAgICAvLyBjb250aW51ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBpID4gLTE7CiAgICAgICAgfTsKfQoKaWYgKCFPYmplY3QuYXNzaWduKSB7CiAgICBPYmplY3QuYXNzaWduID0gZnVuY3Rpb24odGFyZ2V0LCB2YXJBcmdzKSB7IC8vIC5sZW5ndGggb2YgZnVuY3Rpb24gaXMgMgogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICBpZiAodGFyZ2V0ID09PSBudWxsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjb252ZXJ0IHVuZGVmaW5lZCBvciBudWxsIHRvIG9iamVjdCIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHRvID0gT2JqZWN0KHRhcmdldCk7CgogICAgICAgIGZvciAodmFyIGluZGV4ID0gMTsgaW5kZXggPCBhcmd1bWVudHMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIHZhciBuZXh0U291cmNlID0gYXJndW1lbnRzW2luZGV4XTsKCiAgICAgICAgICAgIGlmIChuZXh0U291cmNlICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBuZXh0S2V5IGluIG5leHRTb3VyY2UpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG5leHRTb3VyY2UsIG5leHRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvW25leHRLZXldID0gbmV4dFNvdXJjZVtuZXh0S2V5XTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRvOwogICAgfTsKfQoKKGZ1bmN0aW9uKGFycikgewogICAgInVzZSBzdHJpY3QiOwogICAgYXJyLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KCJyZW1vdmUiKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpdGVtLCAicmVtb3ZlIiwgewogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlKCkgewogICAgICAgICAgICAgICAgdGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKfSkoW0VsZW1lbnQucHJvdG90eXBlLCBDaGFyYWN0ZXJEYXRhLnByb3RvdHlwZSwgRG9jdW1lbnRUeXBlLnByb3RvdHlwZV0pOwoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICogQ29weXJpZ2h0IDIwMTYgQWRvYmUKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KKGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBOUyA9ICJjbXAiOwogICAgdmFyIElTID0gImltYWdlIjsKCiAgICB2YXIgRU1QVFlfUElYRUwgPSAiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFJQUFBQUFBQVAvLy95SDVCQUVBQUFBQUxBQUFBQUFCQUFFQUFBSUJSQUE3IjsKICAgIHZhciBMQVpZX1RIUkVTSE9MRCA9IDA7CiAgICB2YXIgU1JDX1VSSV9URU1QTEFURV9XSURUSF9WQVIgPSAiey53aWR0aH0iOwoKICAgIHZhciBzZWxlY3RvcnMgPSB7CiAgICAgICAgc2VsZjogIltkYXRhLSIgKyBOUyArICctaXM9IicgKyBJUyArICciXScsCiAgICAgICAgaW1hZ2U6ICdbZGF0YS1jbXAtaG9vay1pbWFnZT0iaW1hZ2UiXScsCiAgICAgICAgbWFwOiAnW2RhdGEtY21wLWhvb2staW1hZ2U9Im1hcCJdJywKICAgICAgICBhcmVhOiAnW2RhdGEtY21wLWhvb2staW1hZ2U9ImFyZWEiXScKICAgIH07CgogICAgdmFyIGxhenlMb2FkZXIgPSB7CiAgICAgICAgImNzc0NsYXNzIjogImNtcC1pbWFnZV9faW1hZ2UtLWlzLWxvYWRpbmciLAogICAgICAgICJzdHlsZSI6IHsKICAgICAgICAgICAgImhlaWdodCI6IDAsCiAgICAgICAgICAgICJwYWRkaW5nLWJvdHRvbSI6ICIiIC8vIHdpbGwgYmUgcmVwbGFjZWQgd2l0aCAlIHJhdGlvCiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgcHJvcGVydGllcyA9IHsKICAgICAgICAvKioKICAgICAgICAgKiBBbiBhcnJheSBvZiBhbHRlcm5hdGl2ZSBpbWFnZSB3aWR0aHMgKGluIHBpeGVscykuCiAgICAgICAgICogVXNlZCB0byByZXBsYWNlIGEgey53aWR0aH0gdmFyaWFibGUgaW4gdGhlIHNyYyBwcm9wZXJ0eSB3aXRoIGFuIG9wdGltYWwgd2lkdGggaWYgYSBVUkkgdGVtcGxhdGUgaXMgcHJvdmlkZWQuCiAgICAgICAgICoKICAgICAgICAgKiBAbWVtYmVyb2YgSW1hZ2UKICAgICAgICAgKiBAdHlwZSB7TnVtYmVyW119CiAgICAgICAgICogQGRlZmF1bHQgW10KICAgICAgICAgKi8KICAgICAgICAid2lkdGhzIjogewogICAgICAgICAgICAiZGVmYXVsdCI6IFtdLAogICAgICAgICAgICAidHJhbnNmb3JtIjogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciB3aWR0aHMgPSBbXTsKICAgICAgICAgICAgICAgIHZhbHVlLnNwbGl0KCIsIikuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHBhcnNlRmxvYXQoaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc05hTihpdGVtKSkgewogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aHMucHVzaChpdGVtKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiB3aWR0aHM7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBpbWFnZSBzaG91bGQgYmUgcmVuZGVyZWQgbGF6aWx5LgogICAgICAgICAqCiAgICAgICAgICogQG1lbWJlcm9mIEltYWdlCiAgICAgICAgICogQHR5cGUge0Jvb2xlYW59CiAgICAgICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAgICAgKi8KICAgICAgICAibGF6eSI6IHsKICAgICAgICAgICAgImRlZmF1bHQiOiBmYWxzZSwKICAgICAgICAgICAgInRyYW5zZm9ybSI6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gISh2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09ICJ1bmRlZmluZWQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGltYWdlIHNvdXJjZS4KICAgICAgICAgKgogICAgICAgICAqIENhbiBiZSBhIHNpbXBsZSBpbWFnZSBzb3VyY2UsIG9yIGEgVVJJIHRlbXBsYXRlIHJlcHJlc2VudGF0aW9uIHRoYXQKICAgICAgICAgKiBjYW4gYmUgdmFyaWFibGUgZXhwYW5kZWQgLSB1c2VmdWwgZm9yIGJ1aWxkaW5nIGFuIGltYWdlIGNvbmZpZ3VyYXRpb24gd2l0aCBhbiBhbHRlcm5hdGl2ZSB3aWR0aC4KICAgICAgICAgKiBlLmcuICcvcGF0aC9pbWFnZS5jb3JlaW1ney53aWR0aH0uanBlZy8xNTA2NjIwOTU0MjE0LmpwZWcnCiAgICAgICAgICoKICAgICAgICAgKiBAbWVtYmVyb2YgSW1hZ2UKICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfQogICAgICAgICAqLwogICAgICAgICJzcmMiOiB7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgZGV2aWNlUGl4ZWxSYXRpbyA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7CgogICAgZnVuY3Rpb24gcmVhZERhdGEoZWxlbWVudCkgewogICAgICAgIHZhciBkYXRhID0gZWxlbWVudC5kYXRhc2V0OwogICAgICAgIHZhciBvcHRpb25zID0gW107CiAgICAgICAgdmFyIGNhcGl0YWxpemVkID0gSVM7CiAgICAgICAgY2FwaXRhbGl6ZWQgPSBjYXBpdGFsaXplZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGNhcGl0YWxpemVkLnNsaWNlKDEpOwogICAgICAgIHZhciByZXNlcnZlZCA9IFsiaXMiLCAiaG9vayIgKyBjYXBpdGFsaXplZF07CgogICAgICAgIGZvciAodmFyIGtleSBpbiBkYXRhKSB7CiAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGRhdGFba2V5XTsKCiAgICAgICAgICAgICAgICBpZiAoa2V5LmluZGV4T2YoTlMpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAga2V5ID0ga2V5LnNsaWNlKE5TLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAga2V5ID0ga2V5LmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsga2V5LnN1YnN0cmluZygxKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc2VydmVkLmluZGV4T2Yoa2V5KSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1trZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb3B0aW9uczsKICAgIH0KCiAgICBmdW5jdGlvbiBJbWFnZShjb25maWcpIHsKICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CgogICAgICAgIGZ1bmN0aW9uIGluaXQoY29uZmlnKSB7CiAgICAgICAgICAgIC8vIHByZXZlbnRzIG11bHRpcGxlIGluaXRpYWxpemF0aW9uCiAgICAgICAgICAgIGNvbmZpZy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgiZGF0YS0iICsgTlMgKyAiLWlzIik7CgogICAgICAgICAgICBzZXR1cFByb3BlcnRpZXMoY29uZmlnLm9wdGlvbnMpOwogICAgICAgICAgICBjYWNoZUVsZW1lbnRzKGNvbmZpZy5lbGVtZW50KTsKCiAgICAgICAgICAgIGlmICghdGhhdC5fZWxlbWVudHMubm9zY3JpcHQpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuY29udGFpbmVyID0gdGhhdC5fZWxlbWVudHMubGluayA/IHRoYXQuX2VsZW1lbnRzLmxpbmsgOiB0aGF0Ll9lbGVtZW50cy5zZWxmOwoKICAgICAgICAgICAgdW53cmFwTm9TY3JpcHQoKTsKCiAgICAgICAgICAgIGlmICh0aGF0Ll9wcm9wZXJ0aWVzLmxhenkpIHsKICAgICAgICAgICAgICAgIGFkZExhenlMb2FkZXIoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoYXQuX2VsZW1lbnRzLm1hcCkgewogICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsIG9uTG9hZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJzY3JvbGwiLCB0aGF0LnVwZGF0ZSk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCBvbldpbmRvd1Jlc2l6ZSk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ1cGRhdGUiLCB0aGF0LnVwZGF0ZSk7CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLmltYWdlLmFkZEV2ZW50TGlzdGVuZXIoImNtcC1pbWFnZS1yZWRyYXciLCB0aGF0LnVwZGF0ZSk7CiAgICAgICAgICAgIHRoYXQudXBkYXRlKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsb2FkSW1hZ2UoKSB7CiAgICAgICAgICAgIHZhciBoYXNXaWR0aHMgPSB0aGF0Ll9wcm9wZXJ0aWVzLndpZHRocyAmJiB0aGF0Ll9wcm9wZXJ0aWVzLndpZHRocy5sZW5ndGggPiAwOwogICAgICAgICAgICB2YXIgcmVwbGFjZW1lbnQgPSBoYXNXaWR0aHMgPyAiLiIgKyBnZXRPcHRpbWFsV2lkdGgoKSA6ICIiOwogICAgICAgICAgICB2YXIgdXJsID0gdGhhdC5fcHJvcGVydGllcy5zcmMucmVwbGFjZShTUkNfVVJJX1RFTVBMQVRFX1dJRFRIX1ZBUiwgcmVwbGFjZW1lbnQpOwoKICAgICAgICAgICAgaWYgKHRoYXQuX2VsZW1lbnRzLmltYWdlLmdldEF0dHJpYnV0ZSgic3JjIikgIT09IHVybCkgewogICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuaW1hZ2Uuc2V0QXR0cmlidXRlKCJzcmMiLCB1cmwpOwogICAgICAgICAgICAgICAgaWYgKCFoYXNXaWR0aHMpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigic2Nyb2xsIiwgdGhhdC51cGRhdGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhhdC5fbGF6eUxvYWRlclNob3dpbmcpIHsKICAgICAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLmltYWdlLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCByZW1vdmVMYXp5TG9hZGVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0T3B0aW1hbFdpZHRoKCkgewogICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdGhhdC5fZWxlbWVudHMuc2VsZjsKICAgICAgICAgICAgdmFyIGNvbnRhaW5lcldpZHRoID0gY29udGFpbmVyLmNsaWVudFdpZHRoOwogICAgICAgICAgICB3aGlsZSAoY29udGFpbmVyV2lkdGggPT09IDAgJiYgY29udGFpbmVyLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lciA9IGNvbnRhaW5lci5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgY29udGFpbmVyV2lkdGggPSBjb250YWluZXIuY2xpZW50V2lkdGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG9wdGltYWxXaWR0aCA9IGNvbnRhaW5lcldpZHRoICogZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICAgICAgdmFyIGxlbiA9IHRoYXQuX3Byb3BlcnRpZXMud2lkdGhzLmxlbmd0aDsKICAgICAgICAgICAgdmFyIGtleSA9IDA7CgogICAgICAgICAgICB3aGlsZSAoKGtleSA8IGxlbiAtIDEpICYmICh0aGF0Ll9wcm9wZXJ0aWVzLndpZHRoc1trZXldIDwgb3B0aW1hbFdpZHRoKSkgewogICAgICAgICAgICAgICAga2V5Kys7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0aGF0Ll9wcm9wZXJ0aWVzLndpZHRoc1trZXldLnRvU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhZGRMYXp5TG9hZGVyKCkgewogICAgICAgICAgICB2YXIgd2lkdGggPSB0aGF0Ll9lbGVtZW50cy5pbWFnZS5nZXRBdHRyaWJ1dGUoIndpZHRoIik7CiAgICAgICAgICAgIHZhciBoZWlnaHQgPSB0aGF0Ll9lbGVtZW50cy5pbWFnZS5nZXRBdHRyaWJ1dGUoImhlaWdodCIpOwoKICAgICAgICAgICAgaWYgKHdpZHRoICYmIGhlaWdodCkgewogICAgICAgICAgICAgICAgdmFyIHJhdGlvID0gKGhlaWdodCAvIHdpZHRoKSAqIDEwMDsKICAgICAgICAgICAgICAgIHZhciBzdHlsZXMgPSBsYXp5TG9hZGVyLnN0eWxlOwoKICAgICAgICAgICAgICAgIHN0eWxlc1sicGFkZGluZy1ib3R0b20iXSA9IHJhdGlvICsgIiUiOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIHMgaW4gc3R5bGVzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0eWxlcy5oYXNPd25Qcm9wZXJ0eShzKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50cy5pbWFnZS5zdHlsZVtzXSA9IHN0eWxlc1tzXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuaW1hZ2Uuc2V0QXR0cmlidXRlKCJzcmMiLCBFTVBUWV9QSVhFTCk7CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLmltYWdlLmNsYXNzTGlzdC5hZGQobGF6eUxvYWRlci5jc3NDbGFzcyk7CiAgICAgICAgICAgIHRoYXQuX2xhenlMb2FkZXJTaG93aW5nID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVud3JhcE5vU2NyaXB0KCkgewogICAgICAgICAgICB2YXIgbWFya3VwID0gZGVjb2RlTm9zY3JpcHQodGhhdC5fZWxlbWVudHMubm9zY3JpcHQudGV4dENvbnRlbnQudHJpbSgpKTsKICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTsKCiAgICAgICAgICAgIC8vIHRlbXBvcmFyeSBkb2N1bWVudCBhdm9pZHMgcmVxdWVzdGluZyB0aGUgaW1hZ2UgYmVmb3JlIHJlbW92aW5nIGl0cyBzcmMKICAgICAgICAgICAgdmFyIHRlbXBvcmFyeURvY3VtZW50ID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhtYXJrdXAsICJ0ZXh0L2h0bWwiKTsKICAgICAgICAgICAgdmFyIGltYWdlRWxlbWVudCA9IHRlbXBvcmFyeURvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JzLmltYWdlKTsKICAgICAgICAgICAgaW1hZ2VFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgic3JjIik7CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLmNvbnRhaW5lci5pbnNlcnRCZWZvcmUoaW1hZ2VFbGVtZW50LCB0aGF0Ll9lbGVtZW50cy5ub3NjcmlwdCk7CgogICAgICAgICAgICB2YXIgbWFwRWxlbWVudCA9IHRlbXBvcmFyeURvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JzLm1hcCk7CiAgICAgICAgICAgIGlmIChtYXBFbGVtZW50KSB7CiAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50cy5jb250YWluZXIuaW5zZXJ0QmVmb3JlKG1hcEVsZW1lbnQsIHRoYXQuX2VsZW1lbnRzLm5vc2NyaXB0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMubm9zY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGF0Ll9lbGVtZW50cy5ub3NjcmlwdCk7CiAgICAgICAgICAgIGlmICh0aGF0Ll9lbGVtZW50cy5jb250YWluZXIubWF0Y2hlcyhzZWxlY3RvcnMuaW1hZ2UpKSB7CiAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50cy5pbWFnZSA9IHRoYXQuX2VsZW1lbnRzLmNvbnRhaW5lcjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLmltYWdlID0gdGhhdC5fZWxlbWVudHMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JzLmltYWdlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMubWFwID0gdGhhdC5fZWxlbWVudHMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JzLm1hcCk7CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLmFyZWFzID0gdGhhdC5fZWxlbWVudHMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JzLmFyZWEpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlTGF6eUxvYWRlcigpIHsKICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuaW1hZ2UuY2xhc3NMaXN0LnJlbW92ZShsYXp5TG9hZGVyLmNzc0NsYXNzKTsKICAgICAgICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gbGF6eUxvYWRlci5zdHlsZSkgewogICAgICAgICAgICAgICAgaWYgKGxhenlMb2FkZXIuc3R5bGUuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuaW1hZ2Uuc3R5bGVbcHJvcGVydHldID0gIiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhhdC5fZWxlbWVudHMuaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lcigibG9hZCIsIHJlbW92ZUxhenlMb2FkZXIpOwogICAgICAgICAgICB0aGF0Ll9sYXp5TG9hZGVyU2hvd2luZyA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaXNMYXp5VmlzaWJsZSgpIHsKICAgICAgICAgICAgaWYgKHRoYXQuX2VsZW1lbnRzLmNvbnRhaW5lci5vZmZzZXRQYXJlbnQgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHd0ID0gd2luZG93LnBhZ2VZT2Zmc2V0OwogICAgICAgICAgICB2YXIgd2IgPSB3dCArIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7CiAgICAgICAgICAgIHZhciBldCA9IHRoYXQuX2VsZW1lbnRzLmNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgKyB3dDsKICAgICAgICAgICAgdmFyIGViID0gZXQgKyB0aGF0Ll9lbGVtZW50cy5jb250YWluZXIuY2xpZW50SGVpZ2h0OwoKICAgICAgICAgICAgcmV0dXJuIGViID49IHd0IC0gTEFaWV9USFJFU0hPTEQgJiYgZXQgPD0gd2IgKyBMQVpZX1RIUkVTSE9MRDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlc2l6ZUFyZWFzKCkgewogICAgICAgICAgICBpZiAodGhhdC5fZWxlbWVudHMuYXJlYXMgJiYgdGhhdC5fZWxlbWVudHMuYXJlYXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGF0Ll9lbGVtZW50cy5hcmVhcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IHRoYXQuX2VsZW1lbnRzLmltYWdlLndpZHRoOwogICAgICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSB0aGF0Ll9lbGVtZW50cy5pbWFnZS5oZWlnaHQ7CgogICAgICAgICAgICAgICAgICAgIGlmICh3aWR0aCAmJiBoZWlnaHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlbGNvb3JkcyA9IHRoYXQuX2VsZW1lbnRzLmFyZWFzW2ldLmRhdGFzZXQuY21wUmVsY29vcmRzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVsY29vcmRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVsYXRpdmVDb29yZGluYXRlcyA9IHJlbGNvb3Jkcy5zcGxpdCgiLCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvb3JkaW5hdGVzID0gbmV3IEFycmF5KHJlbGF0aXZlQ29vcmRpbmF0ZXMubGVuZ3RoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNvb3JkaW5hdGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGogJSAyID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVzW2pdID0gcGFyc2VJbnQocmVsYXRpdmVDb29yZGluYXRlc1tqXSAqIHdpZHRoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29yZGluYXRlc1tqXSA9IHBhcnNlSW50KHJlbGF0aXZlQ29vcmRpbmF0ZXNbal0gKiBoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9lbGVtZW50cy5hcmVhc1tpXS5jb29yZHMgPSBjb29yZGluYXRlczsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2FjaGVFbGVtZW50cyh3cmFwcGVyKSB7CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzID0ge307CiAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzLnNlbGYgPSB3cmFwcGVyOwogICAgICAgICAgICB2YXIgaG9va3MgPSB0aGF0Ll9lbGVtZW50cy5zZWxmLnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLSIgKyBOUyArICItaG9vay0iICsgSVMgKyAiXSIpOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBob29rcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGhvb2sgPSBob29rc1tpXTsKICAgICAgICAgICAgICAgIHZhciBjYXBpdGFsaXplZCA9IElTOwogICAgICAgICAgICAgICAgY2FwaXRhbGl6ZWQgPSBjYXBpdGFsaXplZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGNhcGl0YWxpemVkLnNsaWNlKDEpOwogICAgICAgICAgICAgICAgdmFyIGtleSA9IGhvb2suZGF0YXNldFtOUyArICJIb29rIiArIGNhcGl0YWxpemVkXTsKICAgICAgICAgICAgICAgIHRoYXQuX2VsZW1lbnRzW2tleV0gPSBob29rOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXR1cFByb3BlcnRpZXMob3B0aW9ucykgewogICAgICAgICAgICB0aGF0Ll9wcm9wZXJ0aWVzID0ge307CgogICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gcHJvcGVydGllcykgewogICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0eSA9IHByb3BlcnRpZXNba2V5XTsKICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zW2tleV0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydHkgJiYgdHlwZW9mIHByb3BlcnR5LnRyYW5zZm9ybSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fcHJvcGVydGllc1trZXldID0gcHJvcGVydHkudHJhbnNmb3JtKG9wdGlvbnNba2V5XSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9wcm9wZXJ0aWVzW2tleV0gPSBvcHRpb25zW2tleV07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9wcm9wZXJ0aWVzW2tleV0gPSBwcm9wZXJ0aWVzW2tleV1bImRlZmF1bHQiXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG9uV2luZG93UmVzaXplKCkgewogICAgICAgICAgICB0aGF0LnVwZGF0ZSgpOwogICAgICAgICAgICByZXNpemVBcmVhcygpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gb25Mb2FkKCkgewogICAgICAgICAgICByZXNpemVBcmVhcygpOwogICAgICAgIH0KCiAgICAgICAgdGhhdC51cGRhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKHRoYXQuX3Byb3BlcnRpZXMubGF6eSkgewogICAgICAgICAgICAgICAgaWYgKGlzTGF6eVZpc2libGUoKSkgewogICAgICAgICAgICAgICAgICAgIGxvYWRJbWFnZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbG9hZEltYWdlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBpZiAoY29uZmlnICYmIGNvbmZpZy5lbGVtZW50KSB7CiAgICAgICAgICAgIGluaXQoY29uZmlnKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gb25Eb2N1bWVudFJlYWR5KCkgewogICAgICAgIHZhciBlbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JzLnNlbGYpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbmV3IEltYWdlKHsgZWxlbWVudDogZWxlbWVudHNbaV0sIG9wdGlvbnM6IHJlYWREYXRhKGVsZW1lbnRzW2ldKSB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93Lk1vek11dGF0aW9uT2JzZXJ2ZXI7CiAgICAgICAgdmFyIGJvZHkgICAgICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJib2R5Iik7CiAgICAgICAgdmFyIG9ic2VydmVyICAgICAgICAgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbihtdXRhdGlvbnMpIHsKICAgICAgICAgICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24obXV0YXRpb24pIHsKICAgICAgICAgICAgICAgIC8vIG5lZWRlZCBmb3IgSUUKICAgICAgICAgICAgICAgIHZhciBub2Rlc0FycmF5ID0gW10uc2xpY2UuY2FsbChtdXRhdGlvbi5hZGRlZE5vZGVzKTsKICAgICAgICAgICAgICAgIGlmIChub2Rlc0FycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBub2Rlc0FycmF5LmZvckVhY2goZnVuY3Rpb24oYWRkZWROb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZGRlZE5vZGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRzQXJyYXkgPSBbXS5zbGljZS5jYWxsKGFkZGVkTm9kZS5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9ycy5zZWxmKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50c0FycmF5LmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJbWFnZSh7IGVsZW1lbnQ6IGVsZW1lbnQsIG9wdGlvbnM6IHJlYWREYXRhKGVsZW1lbnQpIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIG9ic2VydmVyLm9ic2VydmUoYm9keSwgewogICAgICAgICAgICBzdWJ0cmVlOiB0cnVlLAogICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsCiAgICAgICAgICAgIGNoYXJhY3RlckRhdGE6IHRydWUKICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gImxvYWRpbmciKSB7CiAgICAgICAgb25Eb2N1bWVudFJlYWR5KCk7CiAgICB9IGVsc2UgewogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBvbkRvY3VtZW50UmVhZHkpOwogICAgfQoKICAgIC8qCiAgICAgICAgb24gZHJhZyAmIGRyb3Agb2YgdGhlIGNvbXBvbmVudCBpbnRvIGEgcGFyc3lzLCBub3NjcmlwdCdzIGNvbnRlbnQgd2lsbCBiZSBlc2NhcGVkIG11bHRpcGxlIHRpbWVzIGJ5IHRoZSBlZGl0b3Igd2hpY2ggY3JlYXRlcwogICAgICAgIHRoZSBET00gZm9yIGVkaXRpbmc7IHRoZSBIVE1MIHBhcnNlciBjYW5ub3QgYmUgdXNlZCBoZXJlIGR1ZSB0byB0aGUgbXVsdGlwbGUgZXNjYXBpbmcKICAgICAqLwogICAgZnVuY3Rpb24gZGVjb2RlTm9zY3JpcHQodGV4dCkgewogICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyYoYW1wOykqbHQ7L2csICI8Iik7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvJihhbXA7KSpndDsvZywgIj4iKTsKICAgICAgICByZXR1cm4gdGV4dDsKICAgIH0KCn0pKCk7CgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogKiBDb3B5cmlnaHQgMjAxNyBBZG9iZQogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwooZnVuY3Rpb24oKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIE5TID0gImNtcCI7CiAgICB2YXIgSVMgPSAic2VhcmNoIjsKCiAgICB2YXIgREVMQVkgPSAzMDA7IC8vIHRpbWUgYmVmb3JlIGZldGNoaW5nIG5ldyByZXN1bHRzIHdoZW4gdGhlIHVzZXIgaXMgdHlwaW5nIGEgc2VhcmNoIHN0cmluZwogICAgdmFyIExPQURJTkdfRElTUExBWV9ERUxBWSA9IDMwMDsgLy8gbWluaW11bSB0aW1lIGR1cmluZyB3aGljaCB0aGUgbG9hZGluZyBpbmRpY2F0b3IgaXMgZGlzcGxheWVkCiAgICB2YXIgUEFSQU1fUkVTVUxUU19PRkZTRVQgPSAicmVzdWx0c09mZnNldCI7CgogICAgdmFyIGtleUNvZGVzID0gewogICAgICAgIFRBQjogOSwKICAgICAgICBFTlRFUjogMTMsCiAgICAgICAgRVNDQVBFOiAyNywKICAgICAgICBBUlJPV19VUDogMzgsCiAgICAgICAgQVJST1dfRE9XTjogNDAKICAgIH07CgogICAgdmFyIHNlbGVjdG9ycyA9IHsKICAgICAgICBzZWxmOiAiW2RhdGEtIiArIE5TICsgJy1pcz0iJyArIElTICsgJyJdJywKICAgICAgICBpdGVtOiB7CiAgICAgICAgICAgIHNlbGY6ICJbZGF0YS0iICsgTlMgKyAiLWhvb2stIiArIElTICsgJz0iaXRlbSJdJywKICAgICAgICAgICAgdGl0bGU6ICJbZGF0YS0iICsgTlMgKyAiLWhvb2stIiArIElTICsgJz0iaXRlbVRpdGxlIl0nLAogICAgICAgICAgICBmb2N1c2VkOiAiLiIgKyBOUyArICItc2VhcmNoX19pdGVtLS1pcy1mb2N1c2VkIgogICAgICAgIH0KICAgIH07CgogICAgdmFyIHByb3BlcnRpZXMgPSB7CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIG1pbmltdW0gcmVxdWlyZWQgbGVuZ3RoIG9mIHRoZSBzZWFyY2ggdGVybSBiZWZvcmUgcmVzdWx0cyBhcmUgZmV0Y2hlZC4KICAgICAgICAgKgogICAgICAgICAqIEBtZW1iZXJvZiBTZWFyY2gKICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfQogICAgICAgICAqIEBkZWZhdWx0IDMKICAgICAgICAgKi8KICAgICAgICBtaW5MZW5ndGg6IHsKICAgICAgICAgICAgImRlZmF1bHQiOiAzLAogICAgICAgICAgICB0cmFuc2Zvcm06IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIGlzTmFOKHZhbHVlKSA/IG51bGwgOiB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIG1heGltYWwgbnVtYmVyIG9mIHJlc3VsdHMgZmV0Y2hlZCBieSBhIHNlYXJjaCByZXF1ZXN0LgogICAgICAgICAqCiAgICAgICAgICogQG1lbWJlcm9mIFNlYXJjaAogICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9CiAgICAgICAgICogQGRlZmF1bHQgMTAKICAgICAgICAgKi8KICAgICAgICByZXN1bHRzU2l6ZTogewogICAgICAgICAgICAiZGVmYXVsdCI6IDEwLAogICAgICAgICAgICB0cmFuc2Zvcm06IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIGlzTmFOKHZhbHVlKSA/IG51bGwgOiB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CgogICAgdmFyIGlkQ291bnQgPSAwOwoKICAgIGZ1bmN0aW9uIHJlYWREYXRhKGVsZW1lbnQpIHsKICAgICAgICB2YXIgZGF0YSA9IGVsZW1lbnQuZGF0YXNldDsKICAgICAgICB2YXIgb3B0aW9ucyA9IFtdOwogICAgICAgIHZhciBjYXBpdGFsaXplZCA9IElTOwogICAgICAgIGNhcGl0YWxpemVkID0gY2FwaXRhbGl6ZWQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBjYXBpdGFsaXplZC5zbGljZSgxKTsKICAgICAgICB2YXIgcmVzZXJ2ZWQgPSBbImlzIiwgImhvb2siICsgY2FwaXRhbGl6ZWRdOwoKICAgICAgICBmb3IgKHZhciBrZXkgaW4gZGF0YSkgewogICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBkYXRhW2tleV07CgogICAgICAgICAgICAgICAgaWYgKGtleS5pbmRleE9mKE5TKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGtleSA9IGtleS5zbGljZShOUy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIGtleSA9IGtleS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIGtleS5zdWJzdHJpbmcoMSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChyZXNlcnZlZC5pbmRleE9mKGtleSkgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNba2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogICAgZnVuY3Rpb24gdG9nZ2xlU2hvdyhlbGVtZW50LCBzaG93KSB7CiAgICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICAgICAgaWYgKHNob3cgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwgZmFsc2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2VyaWFsaXplKGZvcm0pIHsKICAgICAgICB2YXIgcXVlcnkgPSBbXTsKICAgICAgICBpZiAoZm9ybSAmJiBmb3JtLmVsZW1lbnRzKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZm9ybS5lbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBmb3JtLmVsZW1lbnRzW2ldOwogICAgICAgICAgICAgICAgaWYgKCFub2RlLmRpc2FibGVkICYmIG5vZGUubmFtZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbSA9IFtub2RlLm5hbWUsIGVuY29kZVVSSUNvbXBvbmVudChub2RlLnZhbHVlKV07CiAgICAgICAgICAgICAgICAgICAgcXVlcnkucHVzaChwYXJhbS5qb2luKCI9IikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBxdWVyeS5qb2luKCImIik7CiAgICB9CgogICAgZnVuY3Rpb24gbWFyayhub2RlLCByZWdleCkgewogICAgICAgIGlmICghbm9kZSB8fCAhcmVnZXgpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gdGV4dCBub2RlcwogICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAzKSB7CiAgICAgICAgICAgIHZhciBub2RlVmFsdWUgPSBub2RlLm5vZGVWYWx1ZTsKICAgICAgICAgICAgdmFyIG1hdGNoID0gcmVnZXguZXhlYyhub2RlVmFsdWUpOwoKICAgICAgICAgICAgaWYgKG5vZGVWYWx1ZSAmJiBtYXRjaCkgewogICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJtYXJrIik7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9IE5TICsgIi1zZWFyY2hfX2l0ZW0tbWFyayI7CiAgICAgICAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG1hdGNoWzBdKSk7CgogICAgICAgICAgICAgICAgdmFyIGFmdGVyID0gbm9kZS5zcGxpdFRleHQobWF0Y2guaW5kZXgpOwogICAgICAgICAgICAgICAgYWZ0ZXIubm9kZVZhbHVlID0gYWZ0ZXIubm9kZVZhbHVlLnN1YnN0cmluZyhtYXRjaFswXS5sZW5ndGgpOwogICAgICAgICAgICAgICAgbm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlbGVtZW50LCBhZnRlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG5vZGUuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZS5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAvLyByZWN1cnNlCiAgICAgICAgICAgICAgICBtYXJrKG5vZGUuY2hpbGROb2Rlc1tpXSwgcmVnZXgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIFNlYXJjaChjb25maWcpIHsKICAgICAgICBpZiAoY29uZmlnLmVsZW1lbnQpIHsKICAgICAgICAgICAgLy8gcHJldmVudHMgbXVsdGlwbGUgaW5pdGlhbGl6YXRpb24KICAgICAgICAgICAgY29uZmlnLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCJkYXRhLSIgKyBOUyArICItaXMiKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX2NhY2hlRWxlbWVudHMoY29uZmlnLmVsZW1lbnQpOwogICAgICAgIHRoaXMuX3NldHVwUHJvcGVydGllcyhjb25maWcub3B0aW9ucyk7CgogICAgICAgIHRoaXMuX2FjdGlvbiA9IHRoaXMuX2VsZW1lbnRzLmZvcm0uZ2V0QXR0cmlidXRlKCJhY3Rpb24iKTsKICAgICAgICB0aGlzLl9yZXN1bHRzT2Zmc2V0ID0gMDsKICAgICAgICB0aGlzLl9oYXNNb3JlUmVzdWx0cyA9IHRydWU7CgogICAgICAgIHRoaXMuX2VsZW1lbnRzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgdGhpcy5fb25JbnB1dC5iaW5kKHRoaXMpKTsKICAgICAgICB0aGlzLl9lbGVtZW50cy5pbnB1dC5hZGRFdmVudExpc3RlbmVyKCJmb2N1cyIsIHRoaXMuX29uSW5wdXQuYmluZCh0aGlzKSk7CiAgICAgICAgdGhpcy5fZWxlbWVudHMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIHRoaXMuX29uS2V5ZG93bi5iaW5kKHRoaXMpKTsKICAgICAgICB0aGlzLl9lbGVtZW50cy5jbGVhci5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuX29uQ2xlYXJDbGljay5iaW5kKHRoaXMpKTsKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuX29uRG9jdW1lbnRDbGljay5iaW5kKHRoaXMpKTsKICAgICAgICB0aGlzLl9lbGVtZW50cy5yZXN1bHRzLmFkZEV2ZW50TGlzdGVuZXIoInNjcm9sbCIsIHRoaXMuX29uU2Nyb2xsLmJpbmQodGhpcykpOwoKICAgICAgICB0aGlzLl9tYWtlQWNjZXNzaWJsZSgpOwogICAgfQoKICAgIFNlYXJjaC5wcm90b3R5cGUuX2Rpc3BsYXlSZXN1bHRzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHRoaXMuX2VsZW1lbnRzLmlucHV0LnZhbHVlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICB0b2dnbGVTaG93KHRoaXMuX2VsZW1lbnRzLmNsZWFyLCBmYWxzZSk7CiAgICAgICAgICAgIHRoaXMuX2NhbmNlbFJlc3VsdHMoKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2VsZW1lbnRzLmlucHV0LnZhbHVlLmxlbmd0aCA8IHRoaXMuX3Byb3BlcnRpZXMubWluTGVuZ3RoKSB7CiAgICAgICAgICAgIHRvZ2dsZVNob3codGhpcy5fZWxlbWVudHMuY2xlYXIsIHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVJlc3VsdHMoKTsKICAgICAgICAgICAgdG9nZ2xlU2hvdyh0aGlzLl9lbGVtZW50cy5jbGVhciwgdHJ1ZSk7CiAgICAgICAgfQogICAgfTsKCiAgICBTZWFyY2gucHJvdG90eXBlLl9vblNjcm9sbCA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgLy8gZmV0Y2ggbmV3IHJlc3VsdHMgd2hlbiB0aGUgcmVzdWx0cyB0byBiZSBzY3JvbGxlZCBkb3duIGFyZSBsZXNzIHRoYW4gdGhlIHZpc2libGUgcmVzdWx0cwogICAgICAgIGlmICh0aGlzLl9lbGVtZW50cy5yZXN1bHRzLnNjcm9sbFRvcCArIDIgKiB0aGlzLl9lbGVtZW50cy5yZXN1bHRzLmNsaWVudEhlaWdodCA+PSB0aGlzLl9lbGVtZW50cy5yZXN1bHRzLnNjcm9sbEhlaWdodCkgewogICAgICAgICAgICB0aGlzLl9yZXN1bHRzT2Zmc2V0ICs9IHRoaXMuX3Byb3BlcnRpZXMucmVzdWx0c1NpemU7CiAgICAgICAgICAgIHRoaXMuX2Rpc3BsYXlSZXN1bHRzKCk7CiAgICAgICAgfQogICAgfTsKCiAgICBTZWFyY2gucHJvdG90eXBlLl9vbklucHV0ID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgc2VsZi5fY2FuY2VsUmVzdWx0cygpOwogICAgICAgIC8vIHN0YXJ0IHNlYXJjaGluZyB3aGVuIHRoZSBzZWFyY2ggdGVybSByZWFjaGVzIHRoZSBtaW5pbXVtIGxlbmd0aAogICAgICAgIHRoaXMuX3RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICBzZWxmLl9kaXNwbGF5UmVzdWx0cygpOwogICAgICAgIH0sIERFTEFZKTsKICAgIH07CgogICAgU2VhcmNoLnByb3RvdHlwZS5fb25LZXlkb3duID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkgewogICAgICAgICAgICBjYXNlIGtleUNvZGVzLlRBQjoKICAgICAgICAgICAgICAgIGlmIChzZWxmLl9yZXN1bHRzT3BlbigpKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGtleUNvZGVzLkVOVEVSOgogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGlmIChzZWxmLl9yZXN1bHRzT3BlbigpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZvY3VzZWQgPSBzZWxmLl9lbGVtZW50cy5yZXN1bHRzLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JzLml0ZW0uZm9jdXNlZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZvY3VzZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXNlZC5jbGljaygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGtleUNvZGVzLkVTQ0FQRToKICAgICAgICAgICAgICAgIHNlbGYuX2NhbmNlbFJlc3VsdHMoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGtleUNvZGVzLkFSUk9XX1VQOgogICAgICAgICAgICAgICAgaWYgKHNlbGYuX3Jlc3VsdHNPcGVuKCkpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIHNlbGYuX3N0ZXBSZXN1bHRGb2N1cyh0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGtleUNvZGVzLkFSUk9XX0RPV046CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5fcmVzdWx0c09wZW4oKSkgewogICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc3RlcFJlc3VsdEZvY3VzKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIHRlc3QgdGhlIGlucHV0IGFuZCBpZiBuZWNlc3NhcnkgZmV0Y2ggYW5kIGRpc3BsYXkgdGhlIHJlc3VsdHMKICAgICAgICAgICAgICAgICAgICBzZWxmLl9vbklucHV0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9OwoKICAgIFNlYXJjaC5wcm90b3R5cGUuX29uQ2xlYXJDbGljayA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB0aGlzLl9lbGVtZW50cy5pbnB1dC52YWx1ZSA9ICIiOwogICAgICAgIHRvZ2dsZVNob3codGhpcy5fZWxlbWVudHMuY2xlYXIsIGZhbHNlKTsKICAgICAgICB0b2dnbGVTaG93KHRoaXMuX2VsZW1lbnRzLnJlc3VsdHMsIGZhbHNlKTsKICAgIH07CgogICAgU2VhcmNoLnByb3RvdHlwZS5fb25Eb2N1bWVudENsaWNrID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICB2YXIgaW5wdXRDb250YWluc1RhcmdldCA9ICB0aGlzLl9lbGVtZW50cy5pbnB1dC5jb250YWlucyhldmVudC50YXJnZXQpOwogICAgICAgIHZhciByZXN1bHRzQ29udGFpblRhcmdldCA9IHRoaXMuX2VsZW1lbnRzLnJlc3VsdHMuY29udGFpbnMoZXZlbnQudGFyZ2V0KTsKCiAgICAgICAgaWYgKCEoaW5wdXRDb250YWluc1RhcmdldCB8fCByZXN1bHRzQ29udGFpblRhcmdldCkpIHsKICAgICAgICAgICAgdG9nZ2xlU2hvdyh0aGlzLl9lbGVtZW50cy5yZXN1bHRzLCBmYWxzZSk7CiAgICAgICAgfQogICAgfTsKCiAgICBTZWFyY2gucHJvdG90eXBlLl9yZXN1bHRzT3BlbiA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9lbGVtZW50cy5yZXN1bHRzLnN0eWxlLmRpc3BsYXkgIT09ICJub25lIjsKICAgIH07CgogICAgU2VhcmNoLnByb3RvdHlwZS5fbWFrZUFjY2Vzc2libGUgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgaWQgPSBOUyArICItc2VhcmNoLXJlc3VsdHMtIiArIGlkQ291bnQ7CiAgICAgICAgdGhpcy5fZWxlbWVudHMuaW5wdXQuc2V0QXR0cmlidXRlKCJhcmlhLW93bnMiLCBpZCk7CiAgICAgICAgdGhpcy5fZWxlbWVudHMucmVzdWx0cy5pZCA9IGlkOwogICAgICAgIGlkQ291bnQrKzsKICAgIH07CgogICAgU2VhcmNoLnByb3RvdHlwZS5fZ2VuZXJhdGVJdGVtcyA9IGZ1bmN0aW9uKGRhdGEsIHJlc3VsdHMpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgICAgICAgZWwuaW5uZXJIVE1MID0gc2VsZi5fZWxlbWVudHMuaXRlbVRlbXBsYXRlLmlubmVySFRNTDsKICAgICAgICAgICAgZWwucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcnMuaXRlbS50aXRsZSlbMF0uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoaXRlbS50aXRsZSkpOwogICAgICAgICAgICBlbC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9ycy5pdGVtLnNlbGYpWzBdLnNldEF0dHJpYnV0ZSgiaHJlZiIsIGl0ZW0udXJsKTsKICAgICAgICAgICAgcmVzdWx0cy5pbm5lckhUTUwgKz0gZWwuaW5uZXJIVE1MOwogICAgICAgIH0pOwogICAgfTsKCiAgICBTZWFyY2gucHJvdG90eXBlLl9tYXJrUmVzdWx0cyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBub2RlTGlzdCA9IHRoaXMuX2VsZW1lbnRzLnJlc3VsdHMucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcnMuaXRlbS5zZWxmKTsKICAgICAgICB2YXIgZXNjYXBlZFRlcm0gPSB0aGlzLl9lbGVtZW50cy5pbnB1dC52YWx1ZS5yZXBsYWNlKC9bLVtcXXt9KCkqKz8uLFxcXiR8I1xzXS9nLCAiXFwkJiIpOwogICAgICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAoIigiICsgZXNjYXBlZFRlcm0gKyAiKSIsICJnaSIpOwoKICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fcmVzdWx0c09mZnNldCAtIDE7IGkgPCBub2RlTGlzdC5sZW5ndGg7ICsraSkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gbm9kZUxpc3RbaV07CiAgICAgICAgICAgIG1hcmsocmVzdWx0LCByZWdleCk7CiAgICAgICAgfQogICAgfTsKCiAgICBTZWFyY2gucHJvdG90eXBlLl9zdGVwUmVzdWx0Rm9jdXMgPSBmdW5jdGlvbihyZXZlcnNlKSB7CiAgICAgICAgdmFyIHJlc3VsdHMgPSB0aGlzLl9lbGVtZW50cy5yZXN1bHRzLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JzLml0ZW0uc2VsZik7CiAgICAgICAgdmFyIGZvY3VzZWQgPSB0aGlzLl9lbGVtZW50cy5yZXN1bHRzLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JzLml0ZW0uZm9jdXNlZCk7CiAgICAgICAgdmFyIG5ld0ZvY3VzZWQ7CiAgICAgICAgdmFyIGluZGV4ID0gQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChyZXN1bHRzLCBmb2N1c2VkKTsKICAgICAgICB2YXIgZm9jdXNlZENzc0NsYXNzID0gTlMgKyAiLXNlYXJjaF9faXRlbS0taXMtZm9jdXNlZCI7CgogICAgICAgIGlmIChyZXN1bHRzLmxlbmd0aCA+IDApIHsKCiAgICAgICAgICAgIGlmICghcmV2ZXJzZSkgewogICAgICAgICAgICAgICAgLy8gaGlnaGxpZ2h0IHRoZSBuZXh0IHJlc3VsdAogICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdHNbMF0uY2xhc3NMaXN0LmFkZChmb2N1c2VkQ3NzQ2xhc3MpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbmRleCArIDEgPCByZXN1bHRzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdHNbaW5kZXhdLmNsYXNzTGlzdC5yZW1vdmUoZm9jdXNlZENzc0NsYXNzKTsKICAgICAgICAgICAgICAgICAgICByZXN1bHRzW2luZGV4ICsgMV0uY2xhc3NMaXN0LmFkZChmb2N1c2VkQ3NzQ2xhc3MpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBsYXN0IHZpc2libGUgcmVzdWx0IGlzIHBhcnRpYWxseSBoaWRkZW4sIHNjcm9sbCB1cCB1bnRpbCBpdCdzIGNvbXBsZXRlbHkgdmlzaWJsZQogICAgICAgICAgICAgICAgbmV3Rm9jdXNlZCA9IHRoaXMuX2VsZW1lbnRzLnJlc3VsdHMucXVlcnlTZWxlY3RvcihzZWxlY3RvcnMuaXRlbS5mb2N1c2VkKTsKICAgICAgICAgICAgICAgIGlmIChuZXdGb2N1c2VkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGJvdHRvbUhpZGRlbkhlaWdodCA9IG5ld0ZvY3VzZWQub2Zmc2V0VG9wICsgbmV3Rm9jdXNlZC5vZmZzZXRIZWlnaHQgLSB0aGlzLl9lbGVtZW50cy5yZXN1bHRzLnNjcm9sbFRvcCAtIHRoaXMuX2VsZW1lbnRzLnJlc3VsdHMuY2xpZW50SGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIGlmIChib3R0b21IaWRkZW5IZWlnaHQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2VsZW1lbnRzLnJlc3VsdHMuc2Nyb2xsVG9wICs9IGJvdHRvbUhpZGRlbkhlaWdodDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblNjcm9sbCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBoaWdobGlnaHQgdGhlIHByZXZpb3VzIHJlc3VsdAogICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDEpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRzW2luZGV4XS5jbGFzc0xpc3QucmVtb3ZlKGZvY3VzZWRDc3NDbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1tpbmRleCAtIDFdLmNsYXNzTGlzdC5hZGQoZm9jdXNlZENzc0NsYXNzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgZmlyc3QgdmlzaWJsZSByZXN1bHQgaXMgcGFydGlhbGx5IGhpZGRlbiwgc2Nyb2xsIGRvd24gdW50aWwgaXQncyBjb21wbGV0ZWx5IHZpc2libGUKICAgICAgICAgICAgICAgIG5ld0ZvY3VzZWQgPSB0aGlzLl9lbGVtZW50cy5yZXN1bHRzLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JzLml0ZW0uZm9jdXNlZCk7CiAgICAgICAgICAgICAgICBpZiAobmV3Rm9jdXNlZCkgewogICAgICAgICAgICAgICAgICAgIHZhciB0b3BIaWRkZW5IZWlnaHQgPSB0aGlzLl9lbGVtZW50cy5yZXN1bHRzLnNjcm9sbFRvcCAtIG5ld0ZvY3VzZWQub2Zmc2V0VG9wOwogICAgICAgICAgICAgICAgICAgIGlmICh0b3BIaWRkZW5IZWlnaHQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2VsZW1lbnRzLnJlc3VsdHMuc2Nyb2xsVG9wIC09IHRvcEhpZGRlbkhlaWdodDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIFNlYXJjaC5wcm90b3R5cGUuX3VwZGF0ZVJlc3VsdHMgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgaWYgKHNlbGYuX2hhc01vcmVSZXN1bHRzKSB7CiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICAgIHZhciB1cmwgPSBzZWxmLl9hY3Rpb24gKyAiPyIgKyBzZXJpYWxpemUoc2VsZi5fZWxlbWVudHMuZm9ybSkgKyAiJiIgKyBQQVJBTV9SRVNVTFRTX09GRlNFVCArICI9IiArIHNlbGYuX3Jlc3VsdHNPZmZzZXQ7CgogICAgICAgICAgICByZXF1ZXN0Lm9wZW4oIkdFVCIsIHVybCwgdHJ1ZSk7CiAgICAgICAgICAgIHJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAvLyB3aGVuIHRoZSByZXN1bHRzIGFyZSBsb2FkZWQ6IGhpZGUgdGhlIGxvYWRpbmcgaW5kaWNhdG9yIGFuZCBkaXNwbGF5IHRoZSBzZWFyY2ggaWNvbiBhZnRlciBhIG1pbmltdW0gcGVyaW9kCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRvZ2dsZVNob3coc2VsZi5fZWxlbWVudHMubG9hZGluZ0luZGljYXRvciwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIHRvZ2dsZVNob3coc2VsZi5fZWxlbWVudHMuaWNvbiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9LCBMT0FESU5HX0RJU1BMQVlfREVMQVkpOwogICAgICAgICAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzID49IDIwMCAmJiByZXF1ZXN0LnN0YXR1cyA8IDQwMCkgewogICAgICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3Mgc3RhdHVzCiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2dlbmVyYXRlSXRlbXMoZGF0YSwgc2VsZi5fZWxlbWVudHMucmVzdWx0cyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX21hcmtSZXN1bHRzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZVNob3coc2VsZi5fZWxlbWVudHMucmVzdWx0cywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faGFzTW9yZVJlc3VsdHMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHRvdGFsIG51bWJlciBvZiByZXN1bHRzIGlzIG5vdCBhIG11bHRpcGxlIG9mIHRoZSBmZXRjaGVkIHJlc3VsdHM6CiAgICAgICAgICAgICAgICAgICAgLy8gLT4gd2UgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBxdWVyeQogICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLl9lbGVtZW50cy5yZXN1bHRzLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JzLml0ZW0uc2VsZikubGVuZ3RoICUgc2VsZi5fcHJvcGVydGllcy5yZXN1bHRzU2l6ZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faGFzTW9yZVJlc3VsdHMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIGVycm9yIHN0YXR1cwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICAvLyB3aGVuIHRoZSByZXN1bHRzIGFyZSBsb2FkaW5nOiBkaXNwbGF5IHRoZSBsb2FkaW5nIGluZGljYXRvciBhbmQgaGlkZSB0aGUgc2VhcmNoIGljb24KICAgICAgICAgICAgdG9nZ2xlU2hvdyhzZWxmLl9lbGVtZW50cy5sb2FkaW5nSW5kaWNhdG9yLCB0cnVlKTsKICAgICAgICAgICAgdG9nZ2xlU2hvdyhzZWxmLl9lbGVtZW50cy5pY29uLCBmYWxzZSk7CiAgICAgICAgICAgIHJlcXVlc3Quc2VuZCgpOwogICAgICAgIH0KICAgIH07CgogICAgU2VhcmNoLnByb3RvdHlwZS5fY2FuY2VsUmVzdWx0cyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lb3V0KTsKICAgICAgICB0aGlzLl9lbGVtZW50cy5yZXN1bHRzLnNjcm9sbFRvcCA9IDA7CiAgICAgICAgdGhpcy5fcmVzdWx0c09mZnNldCA9IDA7CiAgICAgICAgdGhpcy5faGFzTW9yZVJlc3VsdHMgPSB0cnVlOwogICAgICAgIHRoaXMuX2VsZW1lbnRzLnJlc3VsdHMuaW5uZXJIVE1MID0gIiI7CiAgICB9OwoKICAgIFNlYXJjaC5wcm90b3R5cGUuX2NhY2hlRWxlbWVudHMgPSBmdW5jdGlvbih3cmFwcGVyKSB7CiAgICAgICAgdGhpcy5fZWxlbWVudHMgPSB7fTsKICAgICAgICB0aGlzLl9lbGVtZW50cy5zZWxmID0gd3JhcHBlcjsKICAgICAgICB2YXIgaG9va3MgPSB0aGlzLl9lbGVtZW50cy5zZWxmLnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLSIgKyBOUyArICItaG9vay0iICsgSVMgKyAiXSIpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhvb2tzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBob29rID0gaG9va3NbaV07CiAgICAgICAgICAgIHZhciBjYXBpdGFsaXplZCA9IElTOwogICAgICAgICAgICBjYXBpdGFsaXplZCA9IGNhcGl0YWxpemVkLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgY2FwaXRhbGl6ZWQuc2xpY2UoMSk7CiAgICAgICAgICAgIHZhciBrZXkgPSBob29rLmRhdGFzZXRbTlMgKyAiSG9vayIgKyBjYXBpdGFsaXplZF07CiAgICAgICAgICAgIHRoaXMuX2VsZW1lbnRzW2tleV0gPSBob29rOwogICAgICAgIH0KICAgIH07CgogICAgU2VhcmNoLnByb3RvdHlwZS5fc2V0dXBQcm9wZXJ0aWVzID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgIHRoaXMuX3Byb3BlcnRpZXMgPSB7fTsKCiAgICAgICAgZm9yICh2YXIga2V5IGluIHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgdmFyIHByb3BlcnR5ID0gcHJvcGVydGllc1trZXldOwogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9uc1trZXldICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydHkgJiYgdHlwZW9mIHByb3BlcnR5LnRyYW5zZm9ybSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9wZXJ0aWVzW2tleV0gPSBwcm9wZXJ0eS50cmFuc2Zvcm0ob3B0aW9uc1trZXldKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9wZXJ0aWVzW2tleV0gPSBvcHRpb25zW2tleV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9wZXJ0aWVzW2tleV0gPSBwcm9wZXJ0aWVzW2tleV1bImRlZmF1bHQiXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gb25Eb2N1bWVudFJlYWR5KCkgewogICAgICAgIHZhciBlbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JzLnNlbGYpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbmV3IFNlYXJjaCh7IGVsZW1lbnQ6IGVsZW1lbnRzW2ldLCBvcHRpb25zOiByZWFkRGF0YShlbGVtZW50c1tpXSkgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgTXV0YXRpb25PYnNlcnZlciA9IHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyIHx8IHdpbmRvdy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyIHx8IHdpbmRvdy5Nb3pNdXRhdGlvbk9ic2VydmVyOwogICAgICAgIHZhciBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYm9keSIpOwogICAgICAgIHZhciBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKG11dGF0aW9ucykgewogICAgICAgICAgICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihtdXRhdGlvbikgewogICAgICAgICAgICAgICAgLy8gbmVlZGVkIGZvciBJRQogICAgICAgICAgICAgICAgdmFyIG5vZGVzQXJyYXkgPSBbXS5zbGljZS5jYWxsKG11dGF0aW9uLmFkZGVkTm9kZXMpOwogICAgICAgICAgICAgICAgaWYgKG5vZGVzQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIG5vZGVzQXJyYXkuZm9yRWFjaChmdW5jdGlvbihhZGRlZE5vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFkZGVkTm9kZS5xdWVyeVNlbGVjdG9yQWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudHNBcnJheSA9IFtdLnNsaWNlLmNhbGwoYWRkZWROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JzLnNlbGYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzQXJyYXkuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFNlYXJjaCh7IGVsZW1lbnQ6IGVsZW1lbnQsIG9wdGlvbnM6IHJlYWREYXRhKGVsZW1lbnQpIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIG9ic2VydmVyLm9ic2VydmUoYm9keSwgewogICAgICAgICAgICBzdWJ0cmVlOiB0cnVlLAogICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsCiAgICAgICAgICAgIGNoYXJhY3RlckRhdGE6IHRydWUKICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gImxvYWRpbmciKSB7CiAgICAgICAgb25Eb2N1bWVudFJlYWR5KCk7CiAgICB9IGVsc2UgewogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBvbkRvY3VtZW50UmVhZHkpOwogICAgfQoKfSkoKTsKCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAqIENvcHlyaWdodCAyMDE2IEFkb2JlCiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCihmdW5jdGlvbigpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgTlMgPSAiY21wIjsKICAgIHZhciBJUyA9ICJmb3JtVGV4dCI7CiAgICB2YXIgSVNfREFTSCA9ICJmb3JtLXRleHQiOwoKICAgIHZhciBzZWxlY3RvcnMgPSB7CiAgICAgICAgc2VsZjogIltkYXRhLSIgKyBOUyArICctaXM9IicgKyBJUyArICciXScKICAgIH07CgogICAgdmFyIHByb3BlcnRpZXMgPSB7CiAgICAgICAgLyoqCiAgICAgICAgICogQSB2YWxpZGF0aW9uIG1lc3NhZ2UgdG8gZGlzcGxheSBpZiB0aGVyZSBpcyBhIHR5cGUgbWlzbWF0Y2ggYmV0d2VlbiB0aGUgdXNlciBpbnB1dCBhbmQgZXhwZWN0ZWQgaW5wdXQuCiAgICAgICAgICoKICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfQogICAgICAgICAqLwogICAgICAgIGNvbnN0cmFpbnRNZXNzYWdlOiB7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBBIHZhbGlkYXRpb24gbWVzc2FnZSB0byBkaXNwbGF5IGlmIG5vIGlucHV0IGlzIHN1cHBsaWVkLCBidXQgaW5wdXQgaXMgZXhwZWN0ZWQgZm9yIHRoZSBmaWVsZC4KICAgICAgICAgKgogICAgICAgICAqIEB0eXBlIHtTdHJpbmd9CiAgICAgICAgICovCiAgICAgICAgcmVxdWlyZWRNZXNzYWdlOiB7CiAgICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiByZWFkRGF0YShlbGVtZW50KSB7CiAgICAgICAgdmFyIGRhdGEgPSBlbGVtZW50LmRhdGFzZXQ7CiAgICAgICAgdmFyIG9wdGlvbnMgPSBbXTsKICAgICAgICB2YXIgY2FwaXRhbGl6ZWQgPSBJUzsKICAgICAgICBjYXBpdGFsaXplZCA9IGNhcGl0YWxpemVkLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgY2FwaXRhbGl6ZWQuc2xpY2UoMSk7CiAgICAgICAgdmFyIHJlc2VydmVkID0gWyJpcyIsICJob29rIiArIGNhcGl0YWxpemVkXTsKCiAgICAgICAgZm9yICh2YXIga2V5IGluIGRhdGEpIHsKICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gZGF0YVtrZXldOwoKICAgICAgICAgICAgICAgIGlmIChrZXkuaW5kZXhPZihOUykgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBrZXkgPSBrZXkuc2xpY2UoTlMubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICBrZXkgPSBrZXkuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBrZXkuc3Vic3RyaW5nKDEpOwoKICAgICAgICAgICAgICAgICAgICBpZiAocmVzZXJ2ZWQuaW5kZXhPZihrZXkpID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBvcHRpb25zOwogICAgfQoKICAgIGZ1bmN0aW9uIEZvcm1UZXh0KGNvbmZpZykgewogICAgICAgIGlmIChjb25maWcuZWxlbWVudCkgewogICAgICAgICAgICAvLyBwcmV2ZW50cyBtdWx0aXBsZSBpbml0aWFsaXphdGlvbgogICAgICAgICAgICBjb25maWcuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtIiArIE5TICsgIi1pcyIpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fY2FjaGVFbGVtZW50cyhjb25maWcuZWxlbWVudCk7CiAgICAgICAgdGhpcy5fc2V0dXBQcm9wZXJ0aWVzKGNvbmZpZy5vcHRpb25zKTsKCiAgICAgICAgdGhpcy5fZWxlbWVudHMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiaW52YWxpZCIsIHRoaXMuX29uSW52YWxpZC5iaW5kKHRoaXMpKTsKICAgICAgICB0aGlzLl9lbGVtZW50cy5pbnB1dC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIHRoaXMuX29uSW5wdXQuYmluZCh0aGlzKSk7CiAgICB9CgogICAgRm9ybVRleHQucHJvdG90eXBlLl9vbkludmFsaWQgPSBmdW5jdGlvbihldmVudCkgewogICAgICAgIGV2ZW50LnRhcmdldC5zZXRDdXN0b21WYWxpZGl0eSgiIik7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC52YWxpZGl0eS50eXBlTWlzbWF0Y2gpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3Byb3BlcnRpZXMuY29uc3RyYWludE1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5zZXRDdXN0b21WYWxpZGl0eSh0aGlzLl9wcm9wZXJ0aWVzLmNvbnN0cmFpbnRNZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LnZhbGlkaXR5LnZhbHVlTWlzc2luZykgewogICAgICAgICAgICBpZiAodGhpcy5fcHJvcGVydGllcy5yZXF1aXJlZE1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5zZXRDdXN0b21WYWxpZGl0eSh0aGlzLl9wcm9wZXJ0aWVzLnJlcXVpcmVkTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIEZvcm1UZXh0LnByb3RvdHlwZS5fb25JbnB1dCA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgZXZlbnQudGFyZ2V0LnNldEN1c3RvbVZhbGlkaXR5KCIiKTsKICAgIH07CgogICAgRm9ybVRleHQucHJvdG90eXBlLl9jYWNoZUVsZW1lbnRzID0gZnVuY3Rpb24od3JhcHBlcikgewogICAgICAgIHRoaXMuX2VsZW1lbnRzID0ge307CiAgICAgICAgdGhpcy5fZWxlbWVudHMuc2VsZiA9IHdyYXBwZXI7CiAgICAgICAgdmFyIGhvb2tzID0gdGhpcy5fZWxlbWVudHMuc2VsZi5xdWVyeVNlbGVjdG9yQWxsKCJbZGF0YS0iICsgTlMgKyAiLWhvb2stIiArIElTX0RBU0ggKyAiXSIpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaG9va3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIGhvb2sgPSBob29rc1tpXTsKICAgICAgICAgICAgdmFyIGNhcGl0YWxpemVkID0gSVM7CiAgICAgICAgICAgIGNhcGl0YWxpemVkID0gY2FwaXRhbGl6ZWQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBjYXBpdGFsaXplZC5zbGljZSgxKTsKICAgICAgICAgICAgdmFyIGtleSA9IGhvb2suZGF0YXNldFtOUyArICJIb29rIiArIGNhcGl0YWxpemVkXTsKICAgICAgICAgICAgdGhpcy5fZWxlbWVudHNba2V5XSA9IGhvb2s7CiAgICAgICAgfQogICAgfTsKCiAgICBGb3JtVGV4dC5wcm90b3R5cGUuX3NldHVwUHJvcGVydGllcyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICB0aGlzLl9wcm9wZXJ0aWVzID0ge307CgogICAgICAgIGZvciAodmFyIGtleSBpbiBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0eSA9IHByb3BlcnRpZXNba2V5XTsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnNba2V5XSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5ICYmIHR5cGVvZiBwcm9wZXJ0eS50cmFuc2Zvcm0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydGllc1trZXldID0gcHJvcGVydHkudHJhbnNmb3JtKG9wdGlvbnNba2V5XSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydGllc1trZXldID0gb3B0aW9uc1trZXldOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydGllc1trZXldID0gcHJvcGVydGllc1trZXldWyJkZWZhdWx0Il07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIG9uRG9jdW1lbnRSZWFkeSgpIHsKICAgICAgICB2YXIgZWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9ycy5zZWxmKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG5ldyBGb3JtVGV4dCh7IGVsZW1lbnQ6IGVsZW1lbnRzW2ldLCBvcHRpb25zOiByZWFkRGF0YShlbGVtZW50c1tpXSkgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgTXV0YXRpb25PYnNlcnZlciA9IHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyIHx8IHdpbmRvdy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyIHx8IHdpbmRvdy5Nb3pNdXRhdGlvbk9ic2VydmVyOwogICAgICAgIHZhciBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYm9keSIpOwogICAgICAgIHZhciBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKG11dGF0aW9ucykgewogICAgICAgICAgICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihtdXRhdGlvbikgewogICAgICAgICAgICAgICAgLy8gbmVlZGVkIGZvciBJRQogICAgICAgICAgICAgICAgdmFyIG5vZGVzQXJyYXkgPSBbXS5zbGljZS5jYWxsKG11dGF0aW9uLmFkZGVkTm9kZXMpOwogICAgICAgICAgICAgICAgaWYgKG5vZGVzQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIG5vZGVzQXJyYXkuZm9yRWFjaChmdW5jdGlvbihhZGRlZE5vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFkZGVkTm9kZS5xdWVyeVNlbGVjdG9yQWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudHNBcnJheSA9IFtdLnNsaWNlLmNhbGwoYWRkZWROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JzLnNlbGYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzQXJyYXkuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEZvcm1UZXh0KHsgZWxlbWVudDogZWxlbWVudCwgb3B0aW9uczogcmVhZERhdGEoZWxlbWVudCkgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShib2R5LCB7CiAgICAgICAgICAgIHN1YnRyZWU6IHRydWUsCiAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSwKICAgICAgICAgICAgY2hhcmFjdGVyRGF0YTogdHJ1ZQogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlICE9PSAibG9hZGluZyIpIHsKICAgICAgICBvbkRvY3VtZW50UmVhZHkoKTsKICAgIH0gZWxzZSB7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIG9uRG9jdW1lbnRSZWFkeSk7CiAgICB9Cgp9KSgpOwoKCndpbmRvdy52aXJ0dWFsQWdlbnQgPSAoZnVuY3Rpb24oKSB7CgogICAgdmFyIHByb3RvY29sID0gImh0dHBzOi8vIjsKICAgIHZhciBhZ2VudEhvc3QgPSAidmlydHVhbGFnZW50LmhwY2xvdWQuaHAuY29tIjsKICAgIHZhciBhZ2VudENsaWVudCA9ICJXZWIiOwogICAgdmFyIGFnZW50U3ViQ2xpZW50ID0gIndlYmRpcmVjdDIiOyAKICAgIHZhciBwcm9kQ29udGV4dDsKICAgIHZhciBjYz0gIiI7CiAgICB2YXIgbGM9IiI7CgoKCiAgICByZXR1cm4gewogICAgICAgIHNldFByb2RDb250ZXh0OiBmdW5jdGlvbigpIHsKIAkJCXByb2RDb250ZXh0PSIiOwogICAgICAgICAgICB2YXIgcHJvZHVjdEdETCA9IGdsb2JhbERhdGFMYXllclsnUHJvZHVjdCddOwoKCQlpZiAocHJvZHVjdEdETC5oYXNPd25Qcm9wZXJ0eSgic2VyaWFsTnVtYmVyIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZENvbnRleHQgKz0gIiZTZXJpYWxOdW1iZXI9IjsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZENvbnRleHQgKz0gcHJvZHVjdEdETC5zZXJpYWxOdW1iZXIgIT09IG51bGwgPyBwcm9kdWN0R0RMLnNlcmlhbE51bWJlciA6ICIiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAocHJvZHVjdEdETC5oYXNPd25Qcm9wZXJ0eSgicHJvZHVjdExpbmVDb2RlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZENvbnRleHQgKz0gIiZQTD0iOwogICAgICAgICAgICAgICAgICAgICAgICBwcm9kQ29udGV4dCArPSBwcm9kdWN0R0RMLnByb2R1Y3RMaW5lQ29kZSAhPT0gbnVsbCA/IHByb2R1Y3RHREwucHJvZHVjdExpbmVDb2RlIDogIiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChwcm9kdWN0R0RMLmhhc093blByb3BlcnR5KCJwcm9kdWN0TW9kZWxOdW1iZXIiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwcm9kQ29udGV4dCArPSAiJlByb2R1Y3ROdW1iZXI9IjsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZENvbnRleHQgKz0gcHJvZHVjdEdETC5wcm9kdWN0TW9kZWxOdW1iZXIgIT09IG51bGwgPyBwcm9kdWN0R0RMLnByb2R1Y3RNb2RlbE51bWJlciA6ICIiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAocHJvZHVjdEdETC5oYXNPd25Qcm9wZXJ0eSgic3VwcG9ydE5hbWVOYW1lIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZENvbnRleHQgKz0gIiZQcm9kdWN0TmFtZT0iOwogICAgICAgICAgICAgICAgICAgICAgICBwcm9kQ29udGV4dCArPSBwcm9kdWN0R0RMLnN1cHBvcnROYW1lTmFtZSAhPT0gbnVsbCA/IHByb2R1Y3RHREwuc3VwcG9ydE5hbWVOYW1lIDogIiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChwcm9kdWN0R0RMLmhhc093blByb3BlcnR5KCJzdXBwb3J0TmFtZU9pZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2RDb250ZXh0ICs9ICImUHJvZHVjdE5hbWVPSUQ9IjsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZENvbnRleHQgKz0gcHJvZHVjdEdETC5zdXBwb3J0TmFtZU9pZCAhPT0gbnVsbCA/IHByb2R1Y3RHREwuc3VwcG9ydE5hbWVPaWQgOiAiIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHByb2R1Y3RHREwuaGFzT3duUHJvcGVydHkoInNlcmllc05hbWUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwcm9kQ29udGV4dCArPSAiJlByb2R1Y3RTZXJpZXNOYW1lPSI7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2RDb250ZXh0ICs9IHByb2R1Y3RHREwuc2VyaWVzTmFtZSAhPT0gbnVsbCA/IHByb2R1Y3RHREwuc2VyaWVzTmFtZSA6ICIiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAocHJvZHVjdEdETC5oYXNPd25Qcm9wZXJ0eSgic2VyaWVzT2lkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZENvbnRleHQgKz0gIiZQcm9kdWN0U2VyaWVzTmFtZU9JRD0iOwogICAgICAgICAgICAgICAgICAgICAgICBwcm9kQ29udGV4dCArPSBwcm9kdWN0R0RMLnNlcmllc09pZCAhPT0gbnVsbCA/IHByb2R1Y3RHREwuc2VyaWVzT2lkIDogIiI7CiAgICAgICAgICAgICAgICAgICAgfQoJCQkgY2M9IGdsb2JhbERhdGFMYXllci5Db3VudHJ5Q29kZTsKICAgICAgICAgICAgIGxjPWdsb2JhbERhdGFMYXllci5MYW5ndWFnZUNvZGU7CiAgICAgICAgfSwKICAgICAgICBnZXRQcm9kQ29udGV4dDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9kQ29udGV4dDsKICAgICAgICB9LAogICAgICAgIGNyZWF0ZUFnZW50VXJpOiBmdW5jdGlvbihpbnRlbnQsdGVtcGxhdGUpIHsKICAgICAgICAgICAgdmFyIGFnZW50VXJpID0gcHJvdG9jb2wgKyBhZ2VudEhvc3QgKyAiP0JvdENsaWVudD0iICsgYWdlbnRDbGllbnQgKyAiJkJvdFN1YkNsaWVudD0iICsgYWdlbnRTdWJDbGllbnQgKyAiJnF1ZXJ5PSIgKyBpbnRlbnQgKyBwcm9kQ29udGV4dCArICImQ0M9IiArY2MgKyAiJkxDPSIgKyBsYyArICImVGVtcGxhdGU9Iit0ZW1wbGF0ZTsKICAgICAgICAgICAgcmV0dXJuIGVuY29kZVVSSShhZ2VudFVyaSk7CiAgICAgICAgfSwKICAgICAgICBjcmVhdGVBZ2VudFByb2R1Y3RUeXBlVXJpOiBmdW5jdGlvbih0ZW1wbGF0ZSkgewogICAgICAgICAgICB2YXIgYWdlbnRVcmkgPSBwcm90b2NvbCArIGFnZW50SG9zdCArICI/Qm90Q2xpZW50PSIgKyBhZ2VudENsaWVudCArIldpZGdldCIrICImQm90U3ViQ2xpZW50PSIgKyBhZ2VudFN1YkNsaWVudCArICImcHJvZHVjdFR5cGU9cHJpbnRlciIgICsgcHJvZENvbnRleHQgKyAiJkNDPSIgK2NjICsgIiZMQz0iICsgbGMgKyAiJlRlbXBsYXRlPSIrdGVtcGxhdGU7CiAgICAgICAgICAgIHJldHVybiBlbmNvZGVVUkkoYWdlbnRVcmkpOwogICAgICAgIH0sCiAgICAgICAgY3JlYXRlQWdlbnRQQ1Nsb3dVcmk6IGZ1bmN0aW9uKGludGVudCx0ZW1wbGF0ZSkgewogICAgICAgICAgICB2YXIgYWdlbnRVcmkgPSBwcm90b2NvbCArIGFnZW50SG9zdCArICI/Qm90Q2xpZW50PSIgKyBhZ2VudENsaWVudCArICImQm90U3ViQ2xpZW50PSIgKyBhZ2VudFN1YkNsaWVudCArICImcXVlcnk9IiArIGludGVudCAgKyAgIiZMQz0iICsgbGMgKyAiJkNDPSIgK2NjICsiJlRlbXBsYXRlPSIrdGVtcGxhdGU7CiAgICAgICAgICAgIHJldHVybiBlbmNvZGVVUkkoYWdlbnRVcmkpOwogICAgICAgIH0sCiAgICAgICAgbGF1bmNoQWdlbnQ6IGZ1bmN0aW9uKGFnZW50SHJlZikgewoJCQkgd2luZG93Lm9wZW4oYWdlbnRIcmVmLCAnX2JsYW5rJyk7CiAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfTsKfSgpKTsKCgoKLy8gTGF1bmNoIE5vdyAtIExvZ2ljCi8qKiBIUCAnb25lIGNsaWNrJyBzdXBwb3J0IHNvbHV0aW9ucyBmZWF0dXJlIHN1cHBvcnQgKiovCgokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7CndpbmRvdy5PTkVDTElDSyA9IChmdW5jdGlvbigpIHsKCiAgdmFyIGZhaWxUb0xhdW5jTGlua1BlcmYgPSAiJ2h0dHA6Ly9ocC5kZXppZGUuY29tL3RzL3N0YXJ0LmpzcD9ndWlkZT1QZXJmb3JtYW5jZUdlbmVyYWwubmV0JmFzPXRydWUmc2ZzPWd0cyZzZWN0aW9uPW9wdG16JmxjPSIgKyB3aW5kb3cubGMgKyAiJyI7CiAgdmFyIGZhaWxUb0xhdW5jTGlua2VOZXQgPSAiJ2h0dHA6Ly9ocC5kZXppZGUuY29tL3RzL3N0YXJ0LmpzcD9ndWlkZT13aXJlbGVzc2Nvbm5lY3Rpb24ubmV0JmFzPXRydWUmc2ZzPWd0cyZzZWN0aW9uPW9wdG16JmxjPSIgKyB3aW5kb3cubGMgKyAiJyI7CiAgdmFyIEN1c3RvbVByb3RvY29sQ2hlY2tBbmRMYXVuY2ggPSB3aW5kb3cuQ3VzdG9tUHJvdG9jb2xDaGVja0FuZExhdW5jaCB8fCBmdW5jdGlvbih1cmksIHN1Y2Nlc3NDYWxsYmFjaywgbm9IYW5kbGVyQ2FsbGJhY2spIHsKICAgICAgdmFyIHJlcywgcGFyZW50LCBwb3B1cCwgaWZyYW1lLCB0aW1lciwgdGltZW91dCwgYmx1ckhhbmRsZXIsIHRpbWVvdXRIYW5kbGVyLCBicm93c2VyLCBtc0xhdW5jaFVyaVJldHVybmVkOwogICAgICBmdW5jdGlvbiBjYWxsYmFjayhjYikgewogICAgICAgICAgaWYgKHR5cGVvZiBjYiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgIGNiKCk7CiAgICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY3JlYXRlSGlkZGVuSWZyYW1lKHBhcmVudCkgewogICAgICAgICAgdmFyIGlmcmFtZTsKICAgICAgICAgIGlmICghcGFyZW50KSB7CiAgICAgICAgICAgICAgcGFyZW50ID0gZG9jdW1lbnQuYm9keTsKICAgICAgICAgIH0KICAgICAgICAgIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOwogICAgICAgICAgaWZyYW1lLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoaWZyYW1lKTsKICAgICAgICAgIHJldHVybiBpZnJhbWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcmVtb3ZlSGlkZGVuSWZyYW1lKHBhcmVudCkgewogICAgICAgICAgaWYgKCFpZnJhbWUpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXBhcmVudCkgewogICAgICAgICAgICAgIHBhcmVudCA9IGRvY3VtZW50LmJvZHk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJlbnQucmVtb3ZlQ2hpbGQoaWZyYW1lKTsKICAgICAgICAgIGlmcmFtZSA9IG51bGw7CiAgICAgIH0KICAgICAgYnJvd3NlciA9IHsKICAgICAgICAgIGlzQ2hyb21lOiBmYWxzZSwKICAgICAgICAgIGlzRmlyZWZveDogZmFsc2UKICAgICAgfTsKICAgICAgaWYgKHdpbmRvdy5jaHJvbWUgJiYgIW5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL09wZXJhfE9QUlwvLykpIHsKICAgICAgICAgIGJyb3dzZXIuaXNDaHJvbWUgPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBJbnN0YWxsVHJpZ2dlciAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIGJyb3dzZXIuaXNGaXJlZm94ID0gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRtc0xhdW5jaFVyaVJldHVybmVkKGNiKSB7CiAgICAgICAgICBtc0xhdW5jaFVyaVJldHVybmVkID0gdHJ1ZTsKICAgICAgICAgIGNhbGxiYWNrKGNiKTsKICAgICAgfQogICAgICBtc0xhdW5jaFVyaVJldHVybmVkID0gZmFsc2U7CiAgICAgIC8qIFByb3ByaWV0YXJ5IG1zTGF1bmNoVXJpIG1ldGhvZCAoSUUgMTArIG9uIFdpbmRvd3MgOCspICovCiAgICAgIGlmIChuYXZpZ2F0b3IubXNMYXVuY2hVcmkpIHsKICAgICAgICAgIG5hdmlnYXRvci5tc0xhdW5jaFVyaSh1cmksIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIFNldG1zTGF1bmNoVXJpUmV0dXJuZWQoc3VjY2Vzc0NhbGxiYWNrKTsKICAgICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIFNldG1zTGF1bmNoVXJpUmV0dXJuZWQobm9IYW5kbGVyQ2FsbGJhY2spOwogICAgICAgICAgfSk7CiAgICAgICAgICAvKiByZS1hdHRlbXB0IGFmdGVyIDUwMG1zIGFnYWluIHRvIGFjY291bnQgZm9yIEVkZ2Ugbm90IHJlc3BvbmRpbmcgb24gZmlyc3QgdGltZS4gKi8KICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGlmICghbXNMYXVuY2hVcmlSZXR1cm5lZCkKICAgICAgICAgICAgICAgICAgbmF2aWdhdG9yLm1zTGF1bmNoVXJpKHVyaSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICBTZXRtc0xhdW5jaFVyaVJldHVybmVkKHN1Y2Nlc3NDYWxsYmFjayk7CiAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgU2V0bXNMYXVuY2hVcmlSZXR1cm5lZChub0hhbmRsZXJDYWxsYmFjayk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwgNTAwKTsKICAgICAgfS8qIEJsdXIgaGFjayAoQ2hyb21lKSAqLwogICAgICBlbHNlIGlmIChicm93c2VyLmlzQ2hyb21lKSB7CiAgICAgICAgICBibHVySGFuZGxlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCBibHVySGFuZGxlcik7CiAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc0NhbGxiYWNrKTsKICAgICAgICAgIH0KICAgICAgICAgIDsKICAgICAgICAgIHRpbWVvdXRIYW5kbGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCBibHVySGFuZGxlcik7CiAgICAgICAgICAgICAgY2FsbGJhY2sobm9IYW5kbGVyQ2FsbGJhY2spOwogICAgICAgICAgfQogICAgICAgICAgOwogICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBibHVySGFuZGxlcik7CiAgICAgICAgICB3aW5kb3cuZm9jdXMoKTsKICAgICAgICAgIHRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dCh0aW1lb3V0SGFuZGxlciwgMjAwMCk7CiAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHVyaTsKICAgICAgfS8qIENhdGNoIE5TX0VSUk9SX1VOS05PV05fUFJPVE9DT0wgZXhjZXB0aW9uIChGaXJlZm94KSAqLwogICAgICBlbHNlIGlmIChicm93c2VyLmlzRmlyZWZveCkgewogICAgICAgICAgaWZyYW1lID0gY3JlYXRlSGlkZGVuSWZyYW1lKCk7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIC8qIGlmIHdlJ3JlIHN0aWxsIGFsbG93ZWQgdG8gY2hhbmdlIHRoZSBpZnJhbWUncyBsb2NhdGlvbiwgdGhlIHByb3RvY29sIGlzIHJlZ2lzdGVyZWQgKi8KICAgICAgICAgICAgICBpZnJhbWUuY29udGVudFdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdXJpOwogICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NDYWxsYmFjayk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgY2FsbGJhY2sobm9IYW5kbGVyQ2FsbGJhY2spOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICByZW1vdmVIaWRkZW5JZnJhbWUoKTsKICAgICAgICAgIH0KICAgICAgfS8qIE5vIGhhY2sgd2UgY2FuIHVzZSwganVzdCBvcGVuIHRoZSBVUkwgaW4gYW4gaGlkZGVuIGlmcmFtZSBhbmQgaW52b2tlIGBub0hhbmRsZXJDYWxsYmFja2AgKi8KICAgICAgZWxzZSB7CiAgICAgICAgICBpZnJhbWUgPSBjcmVhdGVIaWRkZW5JZnJhbWUoKTsKICAgICAgICAgIGlmcmFtZS5jb250ZW50V2luZG93LmxvY2F0aW9uLmhyZWYgPSB1cmk7CiAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZW1vdmVIaWRkZW5JZnJhbWUocGFyZW50KTsKICAgICAgICAgICAgICBjYWxsYmFjayhub0hhbmRsZXJDYWxsYmFjayk7CiAgICAgICAgICB9LCA1MDApOwogICAgICB9CiAgfQogIDsKICB2YXIgb2NEYXRhID0gewogICAgICBwZXJmOiB7CiAgICAgICAgICB0aXRsZTogIlBlcmZvcm1hbmNlIFR1bmUgVXAgY2hlY2siLAogICAgICAgICAgZGVzY3JpcHRpb246ICJIUCBQZXJmb3JtYW5jZSBUdW5lIFVwIENoZWNrIGFuYWx5emVzIGFuZCBvcHRpbWl6ZXMgeW91ciBQQyB0byByZXNvbHZlIHN5c3RlbSBmcmVlemUgaXNzdWVzIGFuZCBpbXByb3ZlIHBlcmZvcm1hbmNlLiIsCiAgICAgICAgICBpY29uUGF0aDogIi93cHMvd2NtL2Nvbm5lY3QvcHBzL2U4ZWFkZDRmLWZlOWItNDMwNC04YTgzLWRjZTgwMDU1ZjUyZC9ocHB0dS5wbmc/TU9EPUFKUEVSRVMmQ0FDSEVJRD1lOGVhZGQ0Zi1mZTliLTQzMDQtOGE4My1kY2U4MDA1NWY1MmQiLAogICAgICAgICAgZmFpbFRvTGF1bmNoTWVzc2FnZTogIjxwPlVzZSB0aGVzZSBkb2N1bWVudHMgdG8gbGVhcm4gd2F5cyBvZiBpbXByb3ZpbmcgeW91ciBjb21wdXRlciBwZXJmb3JtYW5jZSA8YnI+PGEgaHJlZj0naHR0cHM6Ly9zdXBwb3J0LmhwLmNvbS91cy1lbi9kb2N1bWVudC9jMDYxMDIxNzcnIHRhcmdldD0nX2JsYW5rJyByZWw9J25vb3BlbmVyJz5IUCBQQ3MgLSBJbXByb3ZpbmcgUEMgUGVyZm9ybWFuY2UgKFdpbmRvd3MgMTApPC9hPjxicj48YSBocmVmPSdodHRwczovL3N1cHBvcnQuaHAuY29tL3VzLWVuL2RvY3VtZW50L2MwMzM0MDY3NicgdGFyZ2V0PSdfYmxhbmsnIHJlbD0nbm9vcGVuZXInPkhQIFBDcyAtIEltcHJvdmluZyBQQyBQZXJmb3JtYW5jZSAoV2luZG93cyA4KTwvYT48YnI+PGEgaHJlZj0naHR0cHM6Ly9zdXBwb3J0LmhwLmNvbS91cy1lbi9kb2N1bWVudC9jMDE4MTcyOTAnIHRhcmdldD0nX2JsYW5rJyByZWw9J25vb3BlbmVyJz5IUCBQQ3MgLSBJbXByb3ZpbmcgUEMgUGVyZm9ybWFuY2UgKFdpbmRvd3MgNyk8L2E+PC9wPiIsCiAgICAgICAgICBpZDogImJ0bkxhdW5jaEhwcHR1IgogICAgICB9LAogICAgICBuZXQ6IHsKICAgICAgICAgIHRpdGxlOiAiTmV0d29yayBjaGVjayIsCiAgICAgICAgICBkZXNjcmlwdGlvbjogIkhQIE5ldHdvcmsgQ2hlY2sgaXMgYSBjb21wcmVoZW5zaXZlIG5ldHdvcmsgZGlhZ25vc3RpYyB0aGF0IGNhbiBhdXRvbWF0aWNhbGx5IGRpYWdub3NlLCByZXBhaXIgYW5kIGVhc2lseSBoZWxwIHlvdSB0cm91Ymxlc2hvb3QgdGhlIGlzc3VlIHRoYXQgaXMgcHJldmVudGluZyB5b3VyIG5ldHdvcmsgb3IgaW50ZXJuZXQgZnJvbSBmdW5jdGlvbmluZyBjb3JyZWN0bHkuIiwKICAgICAgICAgIGljb25QYXRoOiAiL3dwcy93Y20vY29ubmVjdC9wcHMvOThhNjU0MTYtODYzZS00YWQ4LWIzOTQtZGU0MjhjMDc0NjFlL2RpYWctaWNvbnMtbmV0d29yay5wbmc/TU9EPUFKUEVSRVMmQ0FDSEVJRD05OGE2NTQxNi04NjNlLTRhZDgtYjM5NC1kZTQyOGMwNzQ2MWUiLAogICAgICAgICAgZmFpbFRvTGF1bmNoTWVzc2FnZTogIjxwPlVzZSB0aGlzIGRvY3VtZW50IHRvIHRyb3VibGVzaG9vdCBhbmQgcmVzb2x2ZSB3aXJlbGVzcyBpbnRlcm5ldCBjb25uZWN0aW9uIHByb2JsZW1zLiA8YnI+PGEgaHJlZj0naHR0cHM6Ly9zdXBwb3J0LmhwLmNvbS91cy1lbi9kb2N1bWVudC9jMDYyODI4NzUnIHRhcmdldD0nX2JsYW5rJyByZWw9J25vb3BlbmVyJz5IUCBQQ3MgLSBBZHZhbmNlZCBXaXJlbGVzcyBOZXR3b3JrIGFuZCBJbnRlcm5ldCBUcm91Ymxlc2hvb3RpbmcgKFdpbmRvd3MgMTApPC9hPjwvcD4iLAogICAgICAgICAgaWQ6ICJidG5MYXVuY2hOZXR3b3JrIgogICAgICB9LAogICAgICBiYXQ6IHsKICAgICAgICAgIHRpdGxlOiAiQmF0dGVyeSBjaGVjayIsCiAgICAgICAgICBkZXNjcmlwdGlvbjogIkhQIEJhdHRlcnkgQ2hlY2sgcHJvdmlkZXMgYSBzaW1wbGUgYnV0IGFjY3VyYXRlIHRlc3Qgb2YgdGhlIGJhdHRlcnkgZm9yIG5vdGVib29rcyBhbmQgcHJvdmlkZXMgYWR2YW5jZWQgaW5mb3JtYXRpb24gb24gdGhlIHN0YXRlIG9mIHRoZSBiYXR0ZXJ5IGFuZCBhbnkgbWFpbnRlbmFuY2UgYWN0aW9uIHRoYXQgbWF5IGJlIHJlcXVpcmVkLiIsCiAgICAgICAgICBpY29uUGF0aDogIi93cHMvd2NtL2Nvbm5lY3QvcHBzL2MwY2FkMDI1LWIxOTQtNDgxMC04N2YwLTRjNGVlNGJhOGE1ZS9iYXR0ZXJ5QWRhcHRlck1pbml0YWIucG5nP01PRD1BSlBFUkVTJkNBQ0hFSUQ9YzBjYWQwMjUtYjE5NC00ODEwLTg3ZjAtNGM0ZWU0YmE4YTVlIiwKICAgICAgICAgIGZhaWxUb0xhdW5jaE1lc3NhZ2U6ICI8cD5JZiBIUCBCYXR0ZXJ5IGNoZWNrIGZhaWxzIHRvIGxhdW5jaCwgeW91IGNhbiByZWZlciB0byA8YSBocmVmPSdodHRwczovL3N1cHBvcnQuaHAuY29tL3VzLWVuL2RvY3VtZW50L2MwNDcwMDc3MScgdGFyZ2V0PSdfYmxhbmsnPlRlc3RpbmcgYW5kIENhbGlicmF0aW5nIHRoZSBCYXR0ZXJ5PC9hPiBkb2N1bWVudCB0aGF0IHByb3ZpZGVzIHN0ZXAtYnktc3RlcCBpbnN0cnVjdGlvbnMgZm9yIHJlc29sdmluZyBiYXR0ZXJ5IGlzc3Vlcy48L3A+IiwKICAgICAgICAgIGlkOiAiYnRuTGF1bmNoQmF0dGVyeSIKICAgICAgfSwKICAgICAgb3M6IHsKICAgICAgICAgIHRpdGxlOiAiT3BlcmF0aW5nIFN5c3RlbSBjaGVjayIsCiAgICAgICAgICBkZXNjcmlwdGlvbjogIkhQIE9wZXJhdGluZyBTeXN0ZW0gQ2hlY2sgaXMgYW4gb3B0aW1pemF0aW9uIHRvb2wgdGhhdCBhbmFseXplcyBhbmQgb3B0aW1pemVzIHlvdXIgb3BlcmF0aW5nIHN5c3RlbSB0byBydW4gYXQgcGVhayBwZXJmb3JtYW5jZS4gSXQgcGVyZm9ybXMgdmFyaW91cyBkaWFnbm9zdGljIHNjYW5zLCBhdXRvbWF0aWNhbGx5IGZpeGluZyBpc3N1ZXMgYW5kIGRpc3BsYXlpbmcgZGV0YWlsZWQgcmVzdWx0cyBmb3IgY29tcGxldGVkIG9wZXJhdGlvbnMuIiwKICAgICAgICAgIGljb25QYXRoOiAiL3dwcy93Y20vY29ubmVjdC9wcHMvNzY2NjFmNjMtOTE1ZS00NzY5LThkZjEtZmFkYjllODlkYmU3L29zZGlhZy5wbmc/TU9EPUFKUEVSRVMmQ0FDSEVJRD03NjY2MWY2My05MTVlLTQ3NjktOGRmMS1mYWRiOWU4OWRiZTciLAogICAgICAgICAgZmFpbFRvTGF1bmNoTWVzc2FnZTogIjxwPklmIEhQIE9wZXJhdGluZyBzeXN0ZW0gY2hlY2sgZmFpbHMgdG8gbGF1bmNoLCBzZWxlY3QgXCJQcm9kdWN0IEluZm9ybWF0aW9uXCIgZnJvbSB0aGUgdGFicyBiZWxvdyB0byB2aWV3IHJlbGV2YW50IGluZm9ybWF0aW9uIGFib3V0IHlvdXIgc3lzdGVtLjwvcD48cD48YSBjbGFzcz0naHBzYUdUYnRuIGJ1dHRvbiBwcmltYXJ5IGluZm8nIHJvbGU9J2J1dHRvbicgdGFyZ2V0PSdfYmxhbmsnIHJlbD0nbm9vcGVuZXInIGhyZWY9IiArIGZhaWxUb0xhdW5jTGlua1BlcmYgKyAiPkxhdW5jaCBUcm91Ymxlc2hvb3RlciA8aSBjbGFzcz0nZmEgZmEtbG9uZy1hcnJvdy1yaWdodCcgYXJpYS1oaWRkZW49J3RydWUnPjwvaT48c3Bhbj5PcGVucyBhIG5ldyB3aW5kb3c8L3NwYW4+PC9hPjwvcD4iLAogICAgICAgICAgaWQ6ICJidG5MYXVuY2hPU0RpYWciCiAgICAgIH0sCiAgICAgIGFjOiB7CiAgICAgICAgICB0aXRsZTogIkF1ZGlvIGNoZWNrIiwKICAgICAgICAgIGRlc2NyaXB0aW9uOiAiSFAgQXVkaW8gY2hlY2sgcGVyZm9ybXMgdmFyaW91cyBkaWFnbm9zdGljIHRlc3RzIGFuZCByZXNvbHZlcyBhdWRpbyBpc3N1ZXMgYXV0b21hdGljYWxseSBhbmQgcHJvdmlkZXMgYSBUZXN0IGJ1dHRvbiBmb3IgeW91IHRvIHZlcmlmeSB0aGF0IHNvdW5kIGlzc3VlcyBhcmUgcmVzb2x2ZWQuIiwKICAgICAgICAgIGljb25QYXRoOiAiL3dwcy93Y20vY29ubmVjdC9wcHMvZTE3ZGIxNTctNjg0My00MDk0LWE5ZTMtZTg5OTYwZTc2MjY0LzFjbGlja2ZpeGVzX2ljb25fUkdCX2F1ZGlvXzUweDUwLnBuZz9NT0Q9QUpQRVJFUyZDQUNIRUlEPWUxN2RiMTU3LTY4NDMtNDA5NC1hOWUzLWU4OTk2MGU3NjI2NCIsCiAgICAgICAgICBmYWlsVG9MYXVuY2hNZXNzYWdlOiAiPHA+VXNlIHRoZXNlIGRvY3VtZW50cyB0byB0cm91Ymxlc2hvb3Qgc291bmQgaXNzdWVzOjxicj48YSBocmVmPSdodHRwczovL3N1cHBvcnQuaHAuY29tL3VzLWVuL2RvY3VtZW50L2MwNjI1ODI3NicgdGFyZ2V0PSdfYmxhbmsnIHJlbD0nbm9vcGVuZXInPkhQIE5vdGVib29rIFBDcyAtIEFkdmFuY2VkIFNvdW5kIFRyb3VibGVzaG9vdGluZyAoV2luZG93cyAxMCwgOCk8L2E+PGJyPjxhIGhyZWY9J2h0dHBzOi8vc3VwcG9ydC5ocC5jb20vdXMtZW4vZG9jdW1lbnQvYzA2MjYwMjYzJyB0YXJnZXQ9J19ibGFuaycgcmVsPSdub29wZW5lcic+SFAgRGVza3RvcCBQQ3MgLSBBZHZhbmNlZCBTb3VuZCBUcm91Ymxlc2hvb3RpbmcgKFdpbmRvd3MgMTAsIDgpPC9hPjwvcD4iLAogICAgICAgICAgaWQ6ICJidG5MYXVuY2hBdWRpb0NoZWNrIgogICAgICB9CiAgfTsKICByZXR1cm4gewogICAgICBnZXREYXRhOiBmdW5jdGlvbihkaWFnVHlwZSkgewogICAgICAgICAgcmV0dXJuIG9jRGF0YVtkaWFnVHlwZV07CiAgICAgIH0sCiAgICAgIGhpZGVEaWFnTG9hZGluZzogZnVuY3Rpb24oaWRwcmVmaXgpIHsKICAgICAgICAgIHZhciBoaWRlaWQgPSAiIyIgKyBpZHByZWZpeCArICJkaWFnTG9hZGluZyI7CiAgICAgICAgICAkKGhpZGVpZCkuYWRkQ2xhc3MoImhpZGRlbiIpOwogICAgICB9LAogICAgICBzaG93RGlhZ0xvYWRpbmc6IGZ1bmN0aW9uKGlkcHJlZml4KSB7CiAgICAgICAgICB2YXIgc2hvd2lkID0gIiMiICsgaWRwcmVmaXggKyAiZGlhZ0xvYWRpbmciOwogICAgICAgICAgJChzaG93aWQpLnJlbW92ZUNsYXNzKCJoaWRkZW4iKTsKICAgICAgfSwKICAgICAgc2hvd1Bvc3REaWFnTGF1bmNoOiBmdW5jdGlvbihpZHByZWZpeCkgewogICAgICAgICAgdmFyIGRpYWdQb3N0TGF1bmNoaWQgPSAiIyIgKyBpZHByZWZpeCArICJkaWFnUG9zdExhdW5jaCI7CiAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBPTkVDTElDSy5oaWRlRGlhZ0xvYWRpbmcoaWRwcmVmaXgpOwogICAgICAgICAgICAgICQoZGlhZ1Bvc3RMYXVuY2hpZCkucmVtb3ZlQ2xhc3MoImhpZGRlbiIpLnNob3coKTsKICAgICAgICAgIH0sIDEwMDAwKTsKICAgICAgfSwKICAgICAgY2hlY2tDdXN0b21Qcm90b2NvbDogZnVuY3Rpb24odXJpLCBpZHByZWZpeCkgewogICAgICAgICAgQ3VzdG9tUHJvdG9jb2xDaGVja0FuZExhdW5jaCh1cmksIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIE9ORUNMSUNLLnNob3dQb3N0RGlhZ0xhdW5jaChpZHByZWZpeCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgT05FQ0xJQ0suc2hvd1Bvc3REaWFnTGF1bmNoKGlkcHJlZml4KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9KTsKICAgICAgfSwKICAgICAgbGF1bmNoRGlhZzogZnVuY3Rpb24oZSwgaWRwcmVmaXgsIGRpYWcpIHsKICAgICAgICAgIHZhciBsYXVuY2hpZHByZWZpeCA9ICIjIiArIGlkcHJlZml4ICsgImhwV2ViRGlhZ0xhdW5jaCI7CiAgICAgICAgICAkKGxhdW5jaGlkcHJlZml4KS5hZGRDbGFzcygiaGlkZGVuIik7CiAgICAgICAgICBPTkVDTElDSy5zaG93RGlhZ0xvYWRpbmcoaWRwcmVmaXgpOwogICAgICAgICAgdmFyIHdoaWNoRGlhZzsKICAgICAgICAgIHN3aXRjaCAoZGlhZykgewogICAgICAgICAgY2FzZSAiYnRuTGF1bmNoSHBwdHUiOgogICAgICAgICAgICAgIHdoaWNoRGlhZyA9ICJocHBlcmZvcm1hbmNldHVuZXVwOi8vTWFpbj9MYXVuY2hQb2ludD01NCI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJidG5MYXVuY2hOZXR3b3JrIjoKICAgICAgICAgICAgICB3aGljaERpYWcgPSAiaHBuZXR3b3JrY2hlY2s6Ly9NYWluP0xhdW5jaFBvaW50PTU0IjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImJ0bkxhdW5jaEJhdHRlcnkiOgogICAgICAgICAgICAgIHdoaWNoRGlhZyA9ICJIUEJhdHRlcnlDaGVjazovL01haW4/TGF1bmNoUG9pbnQ9NTQiOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiYnRuTGF1bmNoT1NEaWFnIjoKICAgICAgICAgICAgICB3aGljaERpYWcgPSAiSFBPU0NoZWNrOi8vTWFpbj9MYXVuY2hQb2ludD01NCI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJidG5MYXVuY2hBdWRpb0NoZWNrIjoKICAgICAgICAgICAgICB3aGljaERpYWcgPSAiSFBBdWRpb0NoZWNrOi8vTWFpbj9MYXVuY2hQb2ludD01NCI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBPTkVDTElDSy5jaGVja0N1c3RvbVByb3RvY29sKHdoaWNoRGlhZywgaWRwcmVmaXgpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgfQp9KCkpOwoKCn0pOwoKCgoKCgoKCgoKCgoKJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CiAgICBjb25zdCBwYWdlSW5mb01ldGEgPSAkKCdoZWFkIG1ldGFbbmFtZT1wYWdlaW5mb10nKTsKICAgIGNvbnN0IGNjID0gcGFnZUluZm9NZXRhLmRhdGEoJ2NjJyk7CiAgICBjb25zdCBsYyA9IHBhZ2VJbmZvTWV0YS5kYXRhKCdsYycpOwoJY29uc3QgdXJpID0gcGFnZUluZm9NZXRhLmRhdGEoJ3VyaScpOwogICAgY29uc3Qgc2VydmxldFBhdGggPSAiL2Jpbi9ocHdjYy9jb3VudHJ5c2VsZWN0b3IiOwogICAgdmFyIHBhZ2VQYXRoID0gcGFnZUluZm9NZXRhLmRhdGEoJ3BhZ2VwYXRoJyk7CgogICAgLy91cGRhdGUgZmxhZyBuYW1lCiAgICBjb25zdCBjdXJyZW50TENDQ0ZsYWcgPSAkKCcuY291bnRyeS1zZWxlY3RvcicpLmZpbmQoImFbcmVsPSIgKyBjYyArICJdW2RhdGEtbGFuZ3VhZ2Vjb2RlPSIgKyBsYyArICJdIikuZmlyc3QoKTsKICAgIGNvbnN0IGN1cnJlbnRDb3VudHJ5TmFtZSA9IGN1cnJlbnRMQ0NDRmxhZy50ZXh0KCk7CiAgICAkKCcjY2xjQ291bnRyeUhlYWRlcicpLnRleHQoY3VycmVudENvdW50cnlOYW1lKTsKCiAgICAvL2dlbmVyYXRlIGpzb24gb2YgbGMgYW5kIGNjIGZvciBjdXJyZW50IHBhZ2UgbG9jYWxlcwoJY29uc3QgbGlua3MgPSAkKCdoZWFkIGxpbmtbcmVsPWFsdGVybmF0ZV0nKTsKICAgIGNvbnN0IHdlYnNlcnZlcnVybCA9IHBhZ2VJbmZvTWV0YS5kYXRhKCd3ZWJzZXJ2ZXJ1cmwnKTsKICAgIHZhciBsY2NjSnNvbiA9IHt9OwogICAgJChsaW5rcykuZWFjaChmdW5jdGlvbihpKSB7CiAgICAgICAgY29uc3QgbGlua1RhZyA9ICQobGlua3NbaV0pOwogICAgICAgIHZhciBsaW5rID0gbGlua1RhZy5hdHRyKCdocmVmJyk7CgkJaWYodHlwZW9mIHdlYnNlcnZlcnVybCAhPT0gJ3VuZGVmaW5lZCcpewoJCQlsaW5rID0gbGluay5yZXBsYWNlKHdlYnNlcnZlcnVybCArICIvIiwgJycpOwoJCX0KICAgICAgICBsaW5rID0gbGluay5zdWJzdHJpbmcoMCwgbGluay5pbmRleE9mKCcvJykpOwogICAgICAgIGlmIChsaW5rLmluZGV4T2YoJy0nKSA+IC0xKSB7CiAgICAgICAgICAgIGNvbnN0IGxjY2MgPSBsaW5rLnNwbGl0KCctJyk7CiAgICAgICAgICAgIHZhciBsYyA9IGxjY2NbMV07CiAgICAgICAgICAgIHZhciBjYyA9IGxjY2NbMF07CiAgICAgICAgICAgIHZhciBsY0FycmF5ID0gbGNjY0pzb25bbGNdOwogICAgICAgICAgICBpZiAodHlwZW9mIGxjQXJyYXkgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICBsY0FycmF5LnB1c2goY2MpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGxjQXJyYXkgPSBbXTsKICAgICAgICAgICAgICAgIGxjQXJyYXkucHVzaChjYyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGNjY0pzb25bbGNdID0gbGNBcnJheTsKICAgICAgICB9CiAgICB9KTsKCQoJLy9zaG93IGZsYWdzIGJhc2VkIG9uIGxjIGFuZCBjYyBqc29uCiAgICBjb25zdCBmbGFncyA9ICQoJy5mbGFnbGluaycpOwogICAgJChmbGFncykuZWFjaChmdW5jdGlvbihpKSB7CiAgICAgICAgdmFyIGZsYWcgPSAkKGZsYWdzW2ldKTsKICAgICAgICBjb25zdCBmbGFnQ0MgPSBmbGFnLmF0dHIoInJlbCIpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgY29uc3QgZmxhZ0xDID0gZmxhZy5kYXRhKCJsYW5ndWFnZWNvZGUiKS50b0xvd2VyQ2FzZSgpOwogICAgICAgIGNvbnN0IHJlc0xDID0gbGNjY0pzb25bZmxhZ0xDXTsKICAgICAgICBpZiAodHlwZW9mIHJlc0xDICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICBpZiAocmVzTEMuaW5kZXhPZihmbGFnQ0MpID4gLTEpIHsKICAgICAgICAgICAgICAgIGZsYWcucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQYXRoID0gdXJpOwogICAgICAgICAgICAgICAgdmFyIHBhdGggPSAiIjsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCIuaHRtbCIpID4gLTEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFBhdGguaW5kZXhPZignL2xhbmd1YWdlLW1hc3RlcnMvJykgPiAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gcGFnZVBhdGgucmVwbGFjZSgiL2xhbmd1YWdlLW1hc3RlcnMvIiwgIi8iICsgZmxhZ0xDICsgIi0iICsgZmxhZ0NDICsgIi8iKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gcGFnZVBhdGgucmVwbGFjZShsYyArICItIiArIGNjLCBmbGFnTEMgKyAiLSIgKyBmbGFnQ0MpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwYXRoID0gcGF0aCArICIuaHRtbCI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHBhdGggPSB1cmkucmVwbGFjZShjYyArICItIiArIGxjLCBmbGFnQ0MgKyAiLSIgKyBmbGFnTEMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGxhbmdQYXRoID0gcGF0aDsKICAgICAgICAgICAgICAgIGZsYWcuYXR0cigiaHJlZiIsIGxhbmdQYXRoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9KTsKCi8vIENvdW50cnkgU2VsZWN0b3IgTW9kYWwgT3BlbgokKCcuUG9wdXBBY3RpdmF0b3InKS5jbGljayhmdW5jdGlvbigpIHsKICAgICQoJ2JvZHknKS5hZGRDbGFzcygnbW9kYWwtb3BlbicpOwogICAgJCgnLmNvdW50cnlTZWxlY3RvckJveCcpLnJlbW92ZUNsYXNzKCdoaWRlJyk7CiAgICAkKCcubW9kYWwnKS5zaG93KCk7CiAgICAkKCcubW9kYWwtYmFja2Ryb3AnKS5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgJCgnLm1vZGFsLWJhY2tkcm9wJykuc2hvdygpOwogICAgJCgnLm1vZGFsLWJhY2tkcm9wJykuYWRkQ2xhc3MoJ2luJyk7Cgp9KTsKCi8vQ291bnRyeSBDbG9zZQokKCcuY291bnRyeS1jbG9zZScpLmNsaWNrKGZ1bmN0aW9uKCkgewokKCdib2R5JykucmVtb3ZlQ2xhc3MoJ21vZGFsLW9wZW4nKTsKJCgnLmNvdW50cnlTZWxlY3RvckJveCcpLmFkZENsYXNzKCdoaWRlJyk7CiQoJy5tb2RhbCcpLmhpZGUoKTsKJCgnLm1vZGFsLWJhY2tkcm9wJykuaGlkZSgpOwp9KTsKCn0pOwokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKICAgIC8vIENsaWNrIGZ1bmN0aW9uIGZvciBXaW4xMCBDb21wdXRpbmcgIFRhYnMKICAgICQoJy5uYXYtdGFicyA+IGxpID4gYScpLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7ICAKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyAgICAgICAgCiAgICAgICAgJCgnLnRhYkNvbnRhaW5lcicpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJ2xpJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogICAgICAgICQoJy5teVJvdyAudGFiLXBhbmUnKS5oaWRlKCk7CiAgICAgICAgJCgkKHRoaXMpLmF0dHIoJ2hyZWYnKSkuc2hvdygpOyAKICAgICAgICAkKCQodGhpcykuYXR0cignaHJlZicpKS5hZGRDbGFzcygnYWN0aXZlJyk7CiAgICB9KTsKCQoJICQoIi5ib2R5Q29udGFpbmVyIikucmVtb3ZlQ2xhc3MoImNvbnRhaW5lciIpOwoKCgoKICAgIC8vIFNldHRpbmcgdGFiZSB3aWR0aCBpZiBUYWJzID0gMyAKCiAgICAKCiAgICBpZiggJCgnLnRhYnMtcHJpbnRlci1sYXlvdXQgdWwgbGknKS5sZW5ndGggPT0gMyApewogICAgICAgICAkKCcudGFiQ29udGFpbmVyJykuYWRkQ2xhc3MoJ3RhYmxlbmd0aDMnKTsKICAgIH0KCgogICAgJCgnLnRhYi1oZWFkZXItcHJpbnRlci1zZWN0aW9uIC5wcmludGluZy10YWItaGVhZCcpLnJlbW92ZUF0dHIoJ3N0eWxlJyk7CgoKCgoKCgoKCn0pOwokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKICAgLy8gQ2xpY2sgZnVuY3Rpb24gZm9yIFdpbjEwIENvbXB1dGluZyAgVGFicwoKICAgICQoJy5uYXYtdGFicy1yZXNwb25zaXZlIGxpJykuY2xpY2soZnVuY3Rpb24oZSkgeyAKICAgIHZhciBpc0ZpcnN0TGkgPSAkKHRoaXMpLmlzKCdsaTpmaXJzdC1vZi10eXBlJyk7CiAgICB2YXIgaXNFeHBhbmRlZCA9ICQodGhpcykuc2libGluZ3MoKS5maWx0ZXIoJzpoaWRkZW4nKS5zaXplKCkgPT0gMCA/IHRydWUgOiBmYWxzZTsKICAgIHZhciBtZW51U3RhdGVJbmRpY2F0b3IgPSBmdW5jdGlvbihzZWxlY3RlZExpKSB7CiAgICAgICAgaWYgKGlzRmlyc3RMaSAmJiBpc0V4cGFuZGVkKSB7CiAgICAgICAgICAgICQoc2VsZWN0ZWRMaSkuZmluZCgiaSIpLnJlbW92ZUNsYXNzKCdmYS1zb3J0LWFzYycpLmFkZENsYXNzKCdmYS1zb3J0LWRlc2MnKTsKICAgICAgICB9IGVsc2UgaWYgKGlzRmlyc3RMaSAmJiAhaXNFeHBhbmRlZCkgewogICAgICAgICAgICAkKHNlbGVjdGVkTGkpLnNpYmxpbmdzKCkuZmluZCgnaScpLmFkZENsYXNzKCdoaWRkZW4nKTsKICAgICAgICAgICAgJChzZWxlY3RlZExpKS5maW5kKCJpIikucmVtb3ZlQ2xhc3MoJ2ZhLXNvcnQtZGVzYycpLmFkZENsYXNzKCdmYS1zb3J0LWFzYycpOwogICAgICAgIH0gZWxzZSBpZiAoIWlzRmlyc3RMaSAmJiBpc0V4cGFuZGVkKSB7CiAgICAgICAgICAgICQoc2VsZWN0ZWRMaSkuZmluZCgnaScpLmFkZENsYXNzKCdmYS1zb3J0LWRlc2MnKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7CiAgICAgICAgfSBlbHNlIGlmICghaXNGaXJzdExpICYmICFpc0V4cGFuZGVkKSB7CiAgICAgICAgICAgICQoc2VsZWN0ZWRMaSwgJChzZWxlY3RlZExpKS5zaWJsaW5ncygnOm5vdChsaTpmaXJzdC1vZi10eXBlKScpKS5maW5kKCdpJykuYWRkQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICAgICAkKHNlbGVjdGVkTGkpLnNpYmxpbmdzKCdsaTpmaXJzdC1vZi10eXBlJykuZmluZCgnaScpLnJlbW92ZUNsYXNzKCdmYS1zb3J0LWRlc2MnKS5hZGRDbGFzcygnZmEtc29ydC1hc2MnKTsKICAgICAgICB9CiAgICB9OwogICAgJCh0aGlzKS5zaWJsaW5ncygpLnRvZ2dsZShtZW51U3RhdGVJbmRpY2F0b3IodGhpcykpOwp9KTsKCgoKCgoKCgp9KTsKJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkgewoKCSQoJyNlcnJMb29rVXBCdG4nKS5jbGljayhmdW5jdGlvbiAoKSB7CgkJIHZhciBwYWdlSW5mb01ldGEgPSAkKCdoZWFkIG1ldGFbbmFtZT1wYWdlaW5mb10nKTsKCQkgdmFyIGNjID0gcGFnZUluZm9NZXRhLmRhdGEoJ2NjJyk7CgkJIHZhciBsYyA9IHBhZ2VJbmZvTWV0YS5kYXRhKCdsYycpOwoJCSB2YXIgcXVlcnlVcmwgPSAiaHR0cHM6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vIitsYysiLSIrY2MrIi9zZWFyY2g/cXVlcnk9IjsKCQkgdmFyIGlucHV0VGV4dCA9ICQoJyNlcnJvcklucHV0VHh0JykudmFsKCk7CgkJIHZhciBzZWFyY2hVcmwgPSBxdWVyeVVybCArIGlucHV0VGV4dDsKCQkgd2luZG93Lm9wZW4oc2VhcmNoVXJsLCAiX2JsYW5rIik7Cgl9KTsKCn0pOwokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7CgoKCSQoJy55b3V0dWJlJykub24oImNsaWNrIiwgZnVuY3Rpb24gKCkgewoJCSQodGhpcykuZmluZCgnLnBsYXktYnV0dG9uJykucmVtb3ZlKCk7CgkJJCh0aGlzKS5maW5kKCdpbWcnKS5yZW1vdmUoKTsKCQl2YXIgdmlkZW9JZCA9ICQodGhpcykuZGF0YSgnZW1iZWQnKTsKCQkkKHRoaXMpLmFwcGVuZCgnPGlmcmFtZSBzdHlsZT0id2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsiIHNyYz0iaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvJyArIHZpZGVvSWQgKyAnP2VuYWJsZWpzYXBpPTEmdmVyc2lvbj0zJnBsYXllcmFwaWlkPXl0cGxheWVyJnJlbD0wJnNob3dpbmZvPTAmYXV0b3BsYXk9MSZvcmlnaW49JyArIHdpbmRvdy5vcmlnaW4gKyAnIiBmcmFtZWJvcmRlcj0iMCIgYWxsb3c9ImF1dG9wbGF5IiBhbGxvd2Z1bGxzY3JlZW4+PC9pZnJhbWU+Jyk7CgoJfSk7Cgl2YXIgcGFnZUluZm9NZXRhID0gJCgnaGVhZCBtZXRhW25hbWU9cGFnZWluZm9dJyk7Cgl2YXIgY2MgPSBwYWdlSW5mb01ldGEuZGF0YSgnY2MnKTsKCXZhciBsYyA9IHBhZ2VJbmZvTWV0YS5kYXRhKCdsYycpOwoKCWlmIChjYyAhPSAiY24iKSB7CgkJZmV0Y2hKc29uTGREZXRhaWxzKGNjLCBsYywgIiIpOwoJfSBlbHNlIHsKCQltc0ZldGNoVmlkZW8oKTsKCX0KCgoJZnVuY3Rpb24gbXNGZXRjaFZpZGVvKCkgewoJCXZhciBtc1ZpZGVvSWQgPSAkKCcudmlkZW8tanMnKS5kYXRhKCd2aWRlby1pZCcpOwoJCXZhciBhY2NvdW50SWQgPSAnMTE2MDQzODcwNjAwMSc7CgoJCSQuYWpheCh7CgkJCXR5cGU6ICdHRVQnLAoJCQl1cmw6ICIvaHAtcHBzLXNlcnZpY2VzL2JyaWdodGNvdmUvYWNjb3VudHMvIiArIGFjY291bnRJZCArICIvdmlkZW9zLyIgKyBtc1ZpZGVvSWQsCgkJCWNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24vanNvbiIsCgkJCWRhdGFUeXBlOiAnanNvbicKCQl9KS5kb25lKGZ1bmN0aW9uIChkYXRhKSB7CgkJCXZhciByZWZJZCA9IGRhdGFbMF0ucmVmZXJlbmNlX2lkOwoJCQlmZXRjaEpzb25MZERldGFpbHMoY2MsIGxjLCByZWZJZCk7CgkJfSkuZmFpbChmdW5jdGlvbiAoanFYSFIsIHRleHRTdGF0dXMpIHsKCQkJY29uc29sZS5sb2coIm1zIGxvZzogUGxheWxpc3QgZmV0Y2ggZmFpbGVkICIpOwoJCX0pOwoKCX0KCgoJZnVuY3Rpb24gZmV0Y2hKc29uTGREZXRhaWxzKGNjLCBsYywgcmVmSWQpIHsKCgkJdmFyIHZpZGVvSWQ7CgkJaWYgKGNjID09ICJjbiIpIHsKCQkJdmlkZW9JZCA9IHJlZklkOwoJCX0gZWxzZSB7CgkJCXZpZGVvSWQgPSAkKCcueW91dHViZScpLmRhdGEoJ2VtYmVkJyk7CgkJfQoKCgkJJC5hamF4KHsKCQkJdHlwZTogJ0dFVCcsCgkJCXVybDogIi93Y2Mtc2VydmljZXMvY29udGVudC92aWRlb0RldGFpbHMvIiArIGNjICsgIi0iICsgbGMgKyAiP3ZpZGVvSWRzPSIgKyB2aWRlb0lkLAoJCQljb250ZW50VHlwZTogImFwcGxpY2F0aW9uL2pzb24iLAoJCQlkYXRhVHlwZTogJ2pzb24nCgkJfSkuZG9uZShmdW5jdGlvbiAoZGF0YSkgewoJCQlmZXRjaE1ldGFkYXRhKGRhdGEsIHZpZGVvSWQsIHJlZklkKTsKCQl9KS5mYWlsKGZ1bmN0aW9uIChqcVhIUiwgdGV4dFN0YXR1cykgewoJCQljb25zb2xlLmxvZygibXMgbG9nOiB2aWRlbyBqc29uIGxkIGZldGNoIGZhaWxlZCAiKTsKCQl9KTsKCgl9CgoKCWZ1bmN0aW9uIGZldGNoTWV0YWRhdGEobWV0YUpzb24sIHZpZGVvSWQsIHJlZklkKSB7CgkJdmFyIG1ldGFEYXRhSnNvbiA9IG1ldGFKc29uLmRhdGE7CgkJaWYgKE9iamVjdC5rZXlzKG1ldGFEYXRhSnNvbikubGVuZ3RoKSB7CgkJCXZhciBkZXRhaWxzSnNvbjsKCgkJCWlmIChjYyA9PSAiY24iKSB7CgkJCQlkZXRhaWxzSnNvbiA9IG1ldGFEYXRhSnNvbltyZWZJZF07CgkJCQl2aWRlb0lkID0gZGV0YWlsc0pzb24ueW91dHViZUlkOwoJCQl9IGVsc2UgewoJCQkJZGV0YWlsc0pzb24gPSBtZXRhRGF0YUpzb25bdmlkZW9JZF07CgkJCX0KCgkJCXZhciB1cGxvYWREYXRlID0gZGV0YWlsc0pzb24udXBsb2FkRGF0ZTsKCQkJdmFyIGR1cmF0aW9uID0gZGV0YWlsc0pzb24uZHVyYXRpb247CgkJCXZhciBuYW1lID0gZGV0YWlsc0pzb24udmlkZW9UaXRsZTsKCQkJdmFyIGRlc2NyaXB0aW9uID0gZGV0YWlsc0pzb24udmlkZW9EZXNjcmlwdGlvbjsKCQkJdmFyIHRodW1ibmFpbFVybCA9ICJodHRwOi8vaW1nLnlvdXR1YmUuY29tL3ZpLyIgKyB2aWRlb0lkICsgIi9ocWRlZmF1bHQuanBnIjsKCQkJdmFyIGVtYmVkVXJsID0gImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkLyIgKyB2aWRlb0lkOwoJCQl2YXIgcmVzcFNjcmlwdEpzb24gPSB7CgkJCQkiQGNvbnRleHQiOiAiaHR0cDovL3NjaGVtYS5vcmcvIiwKCgoJCQkJIkB0eXBlIjogIlZpZGVvT2JqZWN0IiwKCgoJCQkJIm5hbWUiOiBuYW1lLAoKCgkJCQkiZGVzY3JpcHRpb24iOiBkZXNjcmlwdGlvbiwKCgoJCQkJInRodW1ibmFpbFVybCI6IHRodW1ibmFpbFVybCwKCgoJCQkJInVwbG9hZERhdGUiOiB1cGxvYWREYXRlLAoKCgkJCQkiZHVyYXRpb24iOiBkdXJhdGlvbiwKCgoJCQkJImVtYmVkVXJsIjogZW1iZWRVcmwKCgoJCQl9OwoJCQl2YXIgcGpzb24gPSBKU09OLnN0cmluZ2lmeShyZXNwU2NyaXB0SnNvbik7CgoKCQkJJCgiYm9keSIpLmFwcGVuZCgiPHNjcmlwdCB0eXBlPSdhcHBsaWNhdGlvbi9sZCtqc29uJz4iICsgcGpzb24gKyAiPC9zY3JpcHQ+Iik7CgkJfQoKCX0KfSk7CiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoKICAgIHZhciBwbGFjZWhvbGRlcklkID0gJ3BsYXlMaXN0Zm9yV2luMTAnOwoKICAgIHZhciBtc1BsYXlsaXN0SWQgPSAkKCcucGxheWxpc3RJZCcpLmRhdGEoJ2VtYmVkJyk7CiAgICB2YXIgcGFnZUluZm9NZXRhID0gJCgnaGVhZCBtZXRhW25hbWU9cGFnZWluZm9dJyk7CiAgICB2YXIgY2MgPSBwYWdlSW5mb01ldGEuZGF0YSgnY2MnKTsKICAgIHZhciBsYyA9IHBhZ2VJbmZvTWV0YS5kYXRhKCdsYycpOwoKCiAgICBtc0ZldGNoUGxheWxpc3RNZXRhZGF0YShtc1BsYXlsaXN0SWQsIHBsYWNlaG9sZGVySWQsIGNjLCBsYyk7CgogICAgZnVuY3Rpb24gbXNGZXRjaFBsYXlsaXN0TWV0YWRhdGEobXNQbGF5bGlzdElkLCBwbGFjZWhvbGRlcklkLCBjYywgbGMpIHsKCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1zUGxheWxpc3RJZCA9IHBhcnNlSW50KG1zUGxheWxpc3RJZCk7CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJywKICAgICAgICAgICAgICAgIHVybDogd2luZG93LmxvY2F0aW9uLm9yaWdpbiArICIvaHAtcHBzLXNlcnZpY2VzL3ZpZGVvcy9wbGF5bGlzdC8iICsgbXNQbGF5bGlzdElkICsgIi9jYy8iICsgY2MgKyAiL2xjLyIgKyBsYywKICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgICAgICQoJyN2aWRUaXRsZScpLmhpZGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1zQ3JlYXRlUGxheWxpc3RDbGlja2FibGVFbGVtZW50cyhkYXRhLCBtc1BsYXlsaXN0SWQsIHBsYWNlaG9sZGVySWQsIGNjLCBsYyk7CiAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMpIHsKICAgICAgICAgICAgICAgIHRocm93ICJtcyBsb2c6IEZldGNoIGZvciB2aWRlbyBwbGF5bGlzdCBkYXRhIGZhaWxlZCI7CiAgICAgICAgICAgIH0pOwoKICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTsKICAgICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIG1zQ3JlYXRlUGxheWxpc3RDbGlja2FibGVFbGVtZW50cyhtc1BsYXlsaXN0SnNvbiwgbXNQbGF5bGlzdElkLCBwbGFjZWhvbGRlcklkLCBjYywgbGMpIHsKCiAgICAgICAgY29uc29sZS5sb2cobXNQbGF5bGlzdEpzb24pOwoKICAgICAgICB2YXIgcGxheWxpc3RIdG1sID0gIiI7CiAgICAgICAgdmFyIG1zU2hvd1RpdGxlID0gJCgiZGl2W2RhdGEtcGxheWxpc3QtaWQ9JyIgKyBtc1BsYXlsaXN0SWQgKyAiJ10iKS5kYXRhKCJzaG93VGl0bGUiKSAhPSB1bmRlZmluZWQgJiYgJCgiZGl2W2RhdGEtcGxheWxpc3QtaWQ9JyIgKyBtc1BsYXlsaXN0SWQgKyAiJ10iKS5kYXRhKCJzaG93VGl0bGUiKSA9PT0gMCA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICB2YXIgbXNTaG93RGVzYyA9ICQoImRpdltkYXRhLXBsYXlsaXN0LWlkPSciICsgbXNQbGF5bGlzdElkICsgIiddIikuZGF0YSgic2hvd0Rlc2MiKSAhPSB1bmRlZmluZWQgJiYgJCgiZGl2W2RhdGEtcGxheWxpc3QtaWQ9JyIgKyBtc1BsYXlsaXN0SWQgKyAiJ10iKS5kYXRhKCJzaG93RGVzYyIpID09PSAwID8gZmFsc2UgOiB0cnVlOwogICAgICAgIHZhciBtc0dyaWRTaXplID0gJCgiZGl2W2RhdGEtcGxheWxpc3QtaWQ9JyIgKyBtc1BsYXlsaXN0SWQgKyAiJ10iKS5kYXRhKCJ2aWRHcmlkU2l6ZSIpICE9IHVuZGVmaW5lZCA/IHBhcnNlR3JpZFNpemUoJCgiZGl2W2RhdGEtcGxheWxpc3QtaWQ9JyIgKyBtc1BsYXlsaXN0SWQgKyAiJ10iKS5kYXRhKCJ2aWRHcmlkU2l6ZSIpLCAicGwiKSA6IFs4LCAxMiwgMjRdOwogICAgICAgIHZhciBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBtc1BsYXlsaXN0SnNvbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgdGl0bGUgPSBtc1BsYXlsaXN0SnNvbltpXS5kZXNjcmlwdGlvbjsKICAgICAgICAgICAgdmFyIHZpZGVvSWQgPSBtc1BsYXlsaXN0SnNvbltpXS5pZDsKICAgICAgICAgICAgdmFyIHZpZGVvVGh1bWJuYWlsID0gbXNQbGF5bGlzdEpzb25baV0uaW1hZ2VzLnRodW1ibmFpbDsKICAgICAgICAgICAgdmFyIHZpZGVvUG9zdGVyID0gbXNQbGF5bGlzdEpzb25baV0uaW1hZ2VzLnBvc3RlcjsKICAgICAgICAgICAgdmFyIHZpZGVvTmFtZSA9IG1zUGxheWxpc3RKc29uW2ldLm5hbWU7CiAgICAgICAgICAgIHZhciB2aWRlb0Rlc2NyaXB0aW9uID0gbXNQbGF5bGlzdEpzb25baV0uZGVzY3JpcHRpb247CiAgICAgICAgICAgIHZhciBZVElkID0gbXNQbGF5bGlzdEpzb25baV0ueW91dHViZV9pZDsKICAgICAgICAgICAgdmFyIGhpZGVCbG9jayA9ICdibG9jayc7CiAgICAgICAgICAgIHZhciB2aWRDb3VudCA9ICdtc1ZpZGVvQ29udGVudCcgKyBwYXJzZUludChpICsgMSk7CiAgICAgICAgICAgIHZhciByZWZlcmVuY2VJZCA9IG1zUGxheWxpc3RKc29uW2ldLnJlZmVyZW5jZV9pZDsKICAgICAgICAgICAgaWYgKGkgPiAyKSB7CiAgICAgICAgICAgICAgICBoaWRlQmxvY2sgPSAnbm9uZScKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2MgIT0gImNuIikgewogICAgICAgICAgICAgICAgcGxheWxpc3RIdG1sICs9ICc8ZGl2IGNsYXNzPSJjb2wtbGctJyArIG1zR3JpZFNpemVbMF0gKyAnIGNvbC1tZC0nICsgbXNHcmlkU2l6ZVsxXSArICcgY29sLXNtLScgKyBtc0dyaWRTaXplWzJdICsgJyAgbXNWaWRlb0NvbnRlbnQgJyArIHZpZENvdW50ICsgJyAiICBzdHlsZT0iZGlzcGxheTonICsgaGlkZUJsb2NrICsgJyIgPicgKyAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBvbmNsaWNrPSJvcGVuVmlkZW9Nb2RhbCh0aGlzKSIgZGF0YS1wYXJhbXM9IicgKyBZVElkICsgJyIgICBhcmlhLWRlc2NyaWJlZGJ5PSJ2aWRlb0NhcHRpb24nICsgaSArICciIGNsYXNzPSJtb2RhbC10cmlnZ2VyIiBkYXRhLXZpZGlkPSInICsgWVRJZCArICciPicgKyAnPGltZyBzdHlsZT0iY3Vyc29yOiBwb2ludGVyO2NsZWFyOmJvdGg7ZGlzcGxheTpibG9jazsiIHNyYz0iJyArIHZpZGVvVGh1bWJuYWlsICsgJyI7PjxzcGFuIHRpdGxlPSJwbGF5IiByZWw9IiIgY2xhc3M9InBsYXkgIHBsYXlZVCBqc192aWRlb190cmlnZ2VyXCI+IDwvc3Bhbj4gPC9hPic7CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcGxheWxpc3RIdG1sICs9ICc8ZGl2IGNsYXNzPSJjb2wtbGctJyArIG1zR3JpZFNpemVbMF0gKyAnIGNvbC1tZC0nICsgbXNHcmlkU2l6ZVsxXSArICcgY29sLXNtLScgKyBtc0dyaWRTaXplWzJdICsgJyBtc1ZpZGVvQ29udGVudCAgJyArIHZpZENvdW50ICsgJyAiIHN0eWxlPSJkaXNwbGF5OicgKyBoaWRlQmxvY2sgKyAnIj4nICsgJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgb25jbGljaz0ibXNGZXRjaFZpZGVvKHRoaXMpIiBkYXRhLXBhcmFtcz0iJyArIHZpZGVvSWQgKyAnIiBhcmlhLWRlc2NyaWJlZGJ5PSJ2aWRlb0NhcHRpb24nICsgaSArICciIGNsYXNzPSJtb2RhbC10cmlnZ2VyIiBkYXRhLXZpZGlkPSInICsgdmlkZW9JZCArICciPicgKyAnPGltZyBzdHlsZT0iY3Vyc29yOiBwb2ludGVyO2NsZWFyOmJvdGg7ZGlzcGxheTpibG9jazsiIHNyYz0iJyArIHZpZGVvUG9zdGVyICsgJyI+PHNwYW4gdGl0bGU9InBsYXkiIHJlbD0iIiBjbGFzcz0icGxheSBicmlnaENvdmUganNfdmlkZW9fdHJpZ2dlclwiPiA8L3NwYW4+IDwvYT4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZldGNoSnNvbkxkRGV0YWlscyhZVElkLCBjYywgbGMsIHJlZmVyZW5jZUlkKTsKICAgICAgICAgICAgaWYgKG1zU2hvd1RpdGxlIHx8IG1zU2hvd0Rlc2MpIHsKICAgICAgICAgICAgICAgIHBsYXlsaXN0SHRtbCArPSAnPGZpZ2NhcHRpb24gaWQ9InZpZGVvQ2FwdGlvbicgKyBpICsgJyIgc3R5bGU9ImhlaWdodDoxMDhweCI+JzsKICAgICAgICAgICAgICAgIGlmIChtc1Nob3dUaXRsZSkgewogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0SHRtbCArPSAnPHN0cm9uZz4nICsgdmlkZW9OYW1lICsgJzwvc3Ryb25nPic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobXNTaG93RGVzYykgewogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0SHRtbCArPSAnPGRpdj4nICsgdmlkZW9EZXNjcmlwdGlvbiArICc8L2Rpdj4nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGxheWxpc3RIdG1sICs9ICc8L2ZpZ2NhcHRpb24+JzsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIGlmIChjYyAhPSAiY24iKSB7CiAgICAgICAgICAgICAgICBwbGF5bGlzdEh0bWwgKz0gJzwvZGl2PjxkaXYgY2xhc3M9Im1vZGFsIHBsYXlsaXN0VmlkZW9Nb2RhbCBmYWRlIiBpZD0idmlkZW8tbW9kYWwnICsgWVRJZCArICciIHRhYmluZGV4PSItMSIgcm9sZT0iZGlhbG9nIiBhcmlhLWxhYmVsPSJIUCBWaWRlb3MiIGFyaWEtaGlkZGVuPSJ0cnVlIiBkYXRhLXNob3c9InRydWUiPjxkaXYgY2xhc3M9Im1vZGFsLWRpYWxvZyBtb2RhbC1tZCI+PGRpdiBpZD0iZGF0YS1jb2xsZWN0aW9uIiBjbGFzcz0ibW9kYWwtY29udGVudCI+PGRpdiBjbGFzcz0iZW1iZWQtY29udGFpbmVyIj48L2Rpdj48ZGl2IGNsYXNzPSJtb2RhbC1ib2R5Ij48ZGl2IGNsYXNzPSJocC1yb3ciPjxkaXYgY2xhc3M9ImNvbC1sZy0yNCI+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InBhdXNlWVRWaWRlbygpIiBjbGFzcz0iYnV0dG9uIGJ1dHRvbi1ibG9jayBwcmltYXJ5IGZyIiBkYXRhLWRpc21pc3M9Im1vZGFsIj5DbG9zZTwvYnV0dG9uPjxoMyBjbGFzcz0ibm8tc3VidGl0bGUiPicgKyB2aWRlb05hbWUgKyAnPC9oMz48cD4nICsgdmlkZW9EZXNjcmlwdGlvbiArICc8L3A+PC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+JzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBsYXlsaXN0SHRtbCArPSAnPC9kaXY+PGRpdiBjbGFzcz0ibW9kYWwgcGxheWxpc3RWaWRlb01vZGFsIGZhZGUiIGlkPSJ2aWRlby1tb2RhbCcgKyB2aWRlb0lkICsgJyIgdGFiaW5kZXg9Ii0xIiByb2xlPSJkaWFsb2ciIGFyaWEtbGFiZWw9IkhQIFZpZGVvcyIgYXJpYS1oaWRkZW49InRydWUiIGRhdGEtc2hvdz0idHJ1ZSI+PGRpdiBjbGFzcz0ibW9kYWwtZGlhbG9nIG1vZGFsLW1kIj48ZGl2IGlkPSJkYXRhLWNvbGxlY3Rpb24iIGNsYXNzPSJtb2RhbC1jb250ZW50Ij48ZGl2IGNsYXNzPSJlbWJlZC1jb250YWluZXIiPjwvZGl2PjxkaXYgY2xhc3M9Im1vZGFsLWJvZHkiPjxkaXYgY2xhc3M9ImhwLXJvdyI+PGRpdiBjbGFzcz0iY29sLWxnLTI0Ij48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgIGNsYXNzPSJidXR0b24gYnV0dG9uLWJsb2NrIHByaW1hcnkgZnIgYnJpZ2h0Y292ZWNsb3NlIiBkYXRhLWRpc21pc3M9Im1vZGFsIj5DbG9zZTwvYnV0dG9uPjxoMyBjbGFzcz0ibm8tc3VidGl0bGUiPicgKyB2aWRlb05hbWUgKyAnPC9oMz48cD4nICsgdmlkZW9EZXNjcmlwdGlvbiArICc8L3A+PC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+JzsKICAgICAgICAgICAgfQoKICAgICAgICB9CiAgICAgICAgJCgiZGl2W2RhdGEtcGxheWxpc3QtaWQ9JyIgKyBwbGFjZWhvbGRlcklkICsgIiddIikuZW1wdHkoKS5hcHBlbmQoJzxkaXYgY2xhc3M9ImhwLXJvdyBjb2wtbGctMjQiPicgKyBwbGF5bGlzdEh0bWwgKyAnPC9kaXY+Jyk7CiAgICAgICAgaWYgKG1zUGxheWxpc3RKc29uLmxlbmd0aCA+IDMpIHsKICAgICAgICAgICAgJCgiZGl2W2RhdGEtcGxheWxpc3QtaWQ9JyIgKyBwbGFjZWhvbGRlcklkICsgIiddIikuYXBwZW5kKCc8ZGl2IGNsYXNzPSJocC1yb3cgIGNvbC1sZy0yNCI+PGRpdiBjbGFzcz0icGFnaW5hdGlvbi1jb250YWluZXIgY29udGFpbmVyRm9yUGFnaW5hdGlvbkZvb3QiIHN0eWxlPSIgbWFyZ2luLWJvdHRvbTogMTBweDsiPjxzcGFuIGNsYXNzPSJwYWdpbmF0aW9uVGV4dCI+PHNwYW4gY2xhc3M9InBhZ2luYXRpb25TdGFydFZhbCI+MTwvc3Bhbj48c3Bhbj4tPC9zcGFuPjxzcGFuIGNsYXNzPSJwYWdpbmF0aW9uRW5kVmFsIj4zPC9zcGFuPjxzcGFuPiB7eyNwcHNfbGJsX1BhZ2luYXRpb25fT2Z9fSA8L3NwYW4+PHNwYW4gY2xhc3M9InBhZ2luYXRpb25Ub3RhbFZhbCI+JyArIG1zUGxheWxpc3RKc29uLmxlbmd0aCArICcgPC9zcGFuPjxzcGFuIGNsYXNzPSJ0b3RhbFJlc3VsdHMiPiB7eyNwcHNfbGJsX1JlbGF0ZWRWaWRlb3NfdmlkZW9zfX0gPC9zcGFuPjxzcGFuPiB8IDwvc3Bhbj48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJzaG93QWxsIHRleHQtYmx1ZSIgYXJpYS1sYWJlbD0ie3sjcHBzX2xibF9SZWxhdGVkVmlkZW9zX1Nob3dhbGx9fSI+IHt7I3Bwc19sYmxfUmVsYXRlZFZpZGVvc19TaG93YWxsfX0gPC9hPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgYXJpYS1sYWJlbD0ie3sjcHBzX2xibF9SZWxhdGVkVmlkZW9zX1Nob3dsZXNzfX0iIGNsYXNzPSJzaG93TGVzcyB0ZXh0LWJsdWUiIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij4ge3sjcHBzX2xibF9SZWxhdGVkVmlkZW9zX1Nob3dsZXNzfX0gPC9hPjwvc3Bhbj48YnV0dG9uIGNsYXNzPSJwYWdpbmF0aW9uLWJ1dHRvbiBwYWdpbmF0aW9uLWxlc3MgcHJldiIgYXJpYS1sYWJlbD0icHJldlZpZGVvcyIgZGlzYWJsZWQ9ImRpc2FibGVkIj48c3BhbiBjbGFzcz0icHJldlBhZ2luYXRpb24iPjwvc3Bhbj48L2J1dHRvbj48YnV0dG9uIGNsYXNzPSJwYWdpbmF0aW9uLWJ1dHRvbiBwYWdpbmF0aW9uLW1vcmUgbmV4dCIgYXJpYS1sYWJlbD0idmlkZW9OZXh0Ij48c3BhbiBjbGFzcz0ibmV4dFBhZ2luYXRpb24iPjwvc3Bhbj48L2J1dHRvbj48c3BhbiBjbGFzcz0idG90YWwiPjwvc3Bhbj48L2Rpdj48L2Rpdj4nKTsKICAgICAgICB9CgogICAgICAgIHdpbmRvdy4kKGRvY3VtZW50KS50cmlnZ2VyKHsKICAgICAgICAgICAgdHlwZTogIm1zUGxheWxpc3RBZGRlZEV2ZW50IiwKICAgICAgICAgICAgdmlkaWQ6IG1zUGxheWxpc3RJZAogICAgICAgIH0pOwogICAgfQoKICAgIHdpbmRvdy5wYXVzZVlUVmlkZW8gPSBmdW5jdGlvbih0YWJpZCkgewogICAgICAgICQoImlmcmFtZSIpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICQodGhpcylbMF0uY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZSgneyJldmVudCI6ImNvbW1hbmQiLCJmdW5jIjoiJyArICdwYXVzZVZpZGVvJyArICciLCJhcmdzIjoiIn0nLCAnKicpOwogICAgICAgIH0pOwogICAgfTsKCiAgICAkKCcuYnJpZ2h0Y292ZWNsb3NlJykub24oImNsaWNrIiwgZnVuY3Rpb24oKSB7CgogICAgICAgIHZhciBteVBsYXllciA9IHZpZGVvanMoJ2JjcGxheWVyJyk7CiAgICAgICAgbXlQbGF5ZXIucGF1c2UoKTsKICAgIH0pOwoKfSk7CgoKZnVuY3Rpb24gb3BlblZpZGVvTW9kYWwoZWwpIHsKICAgIHZhciBtc1ZpZGVvSWQgPSAkKGVsKS5kYXRhKCdwYXJhbXMnKTsKCiAgICB2YXIgdmlkZW9IdG1sU291cmNlWVQgPSAiPGlmcmFtZSBzdHlsZT0nd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsnIHNyYz0naHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvIiArIG1zVmlkZW9JZCArICI/ZW5hYmxlanNhcGk9MSZ2ZXJzaW9uPTMmcGxheWVyYXBpaWQ9eXRwbGF5ZXImcmVsPTAmc2hvd2luZm89MCZhdXRvcGxheT0wJm9yaWdpbj0iICsgd2luZG93Lm9yaWdpbiArICInIGZyYW1lYm9yZGVyPScwJyBhbGxvd2Z1bGxzY3JlZW49JyAnID48L2lmcmFtZT4iOwoKCiAgICBpZiAoJCgiI3ZpZGVvLW1vZGFsIiArIG1zVmlkZW9JZCArICIgLmVtYmVkLWNvbnRhaW5lciIpLmh0bWwoKS5sZW5ndGggPT0gMCkgewogICAgICAgICQoIiN2aWRlby1tb2RhbCIgKyBtc1ZpZGVvSWQgKyAiIC5lbWJlZC1jb250YWluZXIiKS5hcHBlbmQodmlkZW9IdG1sU291cmNlWVQpOwogICAgfQoKICAgICQoIiN2aWRlby1tb2RhbCIgKyBtc1ZpZGVvSWQpLm1vZGFsKCJzaG93Iik7Cn0KCmZ1bmN0aW9uIG1zRmV0Y2hWaWRlbyhyZWZJZCkgewogICAgdmFyIG1zVmlkZW9JZCA9ICQocmVmSWQpLmRhdGEoJ3BhcmFtcycpOwogICAgdmFyIGFjY291bnRJZCA9ICcxMTYwNDM4NzA2MDAxJzsKICAgIGlmICgkKCIjdmlkZW8tbW9kYWwiICsgbXNWaWRlb0lkICsgIiAuZW1iZWQtY29udGFpbmVyIHZpZGVvIikubGVuZ3RoID4gMCkgewogICAgICAgICQoIiN2aWRlby1tb2RhbCIgKyBtc1ZpZGVvSWQpLm1vZGFsKCJzaG93Iik7CiAgICB9IGVsc2UgewogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHR5cGU6ICdHRVQnLAogICAgICAgICAgICB1cmw6ICIvaHAtcHBzLXNlcnZpY2VzL2JyaWdodGNvdmUvYWNjb3VudHMvIiArIGFjY291bnRJZCArICIvdmlkZW9zLyIgKyBtc1ZpZGVvSWQsCiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicKICAgICAgICB9KS5kb25lKGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgbXNDcmVhdGVWaWRlbyhkYXRhLCBtc1ZpZGVvSWQpOwogICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIm1zIGxvZzogUGxheWxpc3QgZmV0Y2ggZmFpbGVkICIpOwogICAgICAgIH0pOwoKICAgIH0KfQoKCmZ1bmN0aW9uIG1zQ3JlYXRlVmlkZW8obXNWaWRKc29uLCBtc1ZpZGVvSWQpIHsKICAgIHZhciB2aWRlb0h0bWxTb3VyY2UgPSAiPHZpZGVvIGlkPSdiY3BsYXllcicgc3R5bGU9J3dpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwcHg7IGJvdHRvbTogMHB4OyByaWdodDogMHB4OyBsZWZ0OiAwcHg7JyBkYXRhLXZpZGVvLWlkPSciICsgbXNWaWRKc29uWzBdLmlkICsgIicgZGF0YS1hY2NvdW50PScxMTYwNDM4NzA2MDAxJyBkYXRhLXBsYXllcj0nQnlMV1VpMEEnIGRhdGEtZW1iZWQ9J2RlZmF1bHQnIGNsYXNzPSd2aWRlby1qcycgY29udHJvbHM9JycgcGxheXNpbmxpbmUgcG9zdGVyPSciICsgbXNWaWRKc29uWzBdLmltYWdlcy5wb3N0ZXIgKyAiJz48L3ZpZGVvPiI7CiAgICBpZiAobXNWaWRKc29uLmhhc093blByb3BlcnR5KCJsZW5ndGgiKSkgewogICAgICAgICQoIiN2aWRlby1tb2RhbCIgKyBtc1ZpZGVvSWQgKyAiIC5lbWJlZC1jb250YWluZXIiKS5hcHBlbmQodmlkZW9IdG1sU291cmNlKTsKICAgICAgICAkKCIjdmlkZW8tbW9kYWwiICsgbXNWaWRlb0lkKS5tb2RhbCgic2hvdyIpOwoKCiAgICAgICAgICAgIGxvYWRCcmlnaHRjb3ZlU2NyaXB0Rm9yVmlkZW9zKCk7CgogICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyAibXMgbG9nOiBlcnJvciBwcm9jZXNzaW5nIHZpZGVvIHJlc3BvbnNlIC8gcmVzcG9uc2Ugb2JqZWN0IGlzIG5vdCBhbiBhcnJheSI7CiAgICB9Cn0KCmZ1bmN0aW9uIGxvYWRCcmlnaHRjb3ZlU2NyaXB0Rm9yVmlkZW9zKCkgewogICAgJCgiYm9keSIpLmFwcGVuZCgiPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0nIiArIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICIvL3BsYXllcnMuYnJpZ2h0Y292ZS5uZXQvMTE2MDQzODcwNjAwMS9CeUxXVWkwQV9kZWZhdWx0L2luZGV4Lm1pbi5qcyc+PC9zY3JpcHQ+Iik7Cgp9CgpmdW5jdGlvbiBmZXRjaEpzb25MZERldGFpbHModmlkZW9JZCwgY2MsIGxjLCByZWZlcmVuY2VJZCkgewogICAgJC5hamF4KHsKICAgICAgICB0eXBlOiAnR0VUJywKICAgICAgICB1cmw6ICIvd2NjLXNlcnZpY2VzL2NvbnRlbnQvdmlkZW9EZXRhaWxzLyIgKyBjYyArICItIiArIGxjICsgIj92aWRlb0lkcz0iICsgdmlkZW9JZCwKICAgICAgICBjb250ZW50VHlwZTogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgIGRhdGFUeXBlOiAnanNvbicKICAgIH0pLmRvbmUoZnVuY3Rpb24oZGF0YSkgewogICAgICAgIGZldGNoTWV0YWRhdGEoZGF0YSwgdmlkZW9JZCwgcmVmZXJlbmNlSWQsIGNjKTsKICAgIH0pLmZhaWwoZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMpIHsKICAgICAgICBjb25zb2xlLmxvZygibXMgbG9nOiB2aWRlbyBqc29uIGxkIGZldGNoIGZhaWxlZCAiKTsKICAgIH0pOwp9CgpmdW5jdGlvbiBmZXRjaE1ldGFkYXRhKG1ldGFKc29uLCB2aWRlb0lkLCByZWZlcmVuY2VJZCwgY2MpIHsKICAgIHZhciBtZXRhRGF0YUpzb24gPSBtZXRhSnNvbi5kYXRhOwogICAgdmFyIGRldGFpbHNKc29uOwogICAgaWYgKE9iamVjdC5rZXlzKG1ldGFEYXRhSnNvbikubGVuZ3RoKSB7CiAgICAgICAgaWYgKGNjID09ICJjbiIpIHsKICAgICAgICAgICAgZGV0YWlsc0pzb24gPSBtZXRhRGF0YUpzb25bcmVmZXJlbmNlSWRdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRldGFpbHNKc29uID0gbWV0YURhdGFKc29uW3ZpZGVvSWRdOwogICAgICAgIH0KICAgICAgICB2YXIgdXBsb2FkRGF0ZSA9IGRldGFpbHNKc29uLnVwbG9hZERhdGU7CiAgICAgICAgdmFyIGR1cmF0aW9uID0gZGV0YWlsc0pzb24uZHVyYXRpb247CiAgICAgICAgdmFyIG5hbWUgPSBkZXRhaWxzSnNvbi52aWRlb1RpdGxlOwogICAgICAgIHZhciBkZXNjcmlwdGlvbiA9IGRldGFpbHNKc29uLnZpZGVvRGVzY3JpcHRpb247CiAgICAgICAgdmFyIHRodW1ibmFpbFVybCA9ICJodHRwOi8vaW1nLnlvdXR1YmUuY29tL3ZpLyIgKyB2aWRlb0lkICsgIi9ocWRlZmF1bHQuanBnIjsKICAgICAgICB2YXIgZW1iZWRVcmwgPSAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvIiArIHZpZGVvSWQ7CiAgICAgICAgdmFyIHJlc3BTY3JpcHRKc29uID0gewogICAgICAgICAgICAiQGNvbnRleHQiOiAiaHR0cDovL3NjaGVtYS5vcmcvIiwKCiAgICAgICAgICAgICJAdHlwZSI6ICJWaWRlb09iamVjdCIsCgogICAgICAgICAgICAibmFtZSI6IG5hbWUsCgogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiBkZXNjcmlwdGlvbiwKCiAgICAgICAgICAgICJ0aHVtYm5haWxVcmwiOiB0aHVtYm5haWxVcmwsCgogICAgICAgICAgICAidXBsb2FkRGF0ZSI6IHVwbG9hZERhdGUsCgogICAgICAgICAgICAiZHVyYXRpb24iOiBkdXJhdGlvbiwKCiAgICAgICAgICAgICJlbWJlZFVybCI6IGVtYmVkVXJsCgogICAgICAgIH07CiAgICAgICAgdmFyIHBqc29uID0gSlNPTi5zdHJpbmdpZnkocmVzcFNjcmlwdEpzb24pOwoKICAgICAgICAkKCJib2R5IikuYXBwZW5kKCI8c2NyaXB0IHR5cGU9J2FwcGxpY2F0aW9uL2xkK2pzb24nPiIgKyBwanNvbiArICI8L3NjcmlwdD4iKTsKCiAgICB9Cn0KJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkgewoKICAgIC8vIERvd25sb2FkIE1vZGFsCgkkKCcuZG93bmxvYWRMaW5rJykuY2xpY2soZnVuY3Rpb24gKCkgewoJCSQoIiNkb3dubG9hZE1vZGFsIikuc2hvdygpOwoJCSQoJy5tb2RhbC1iYWNrZHJvcCcpLmFkZENsYXNzKCdzaG93Jyk7Cgl9KTsKCgl2YXIgdGFiSHJlZiA9ICQoJy5wcmludFNjYW5UYWJzIC5uYXYtdGFicyBsaSBhJyk7Cgl0YWJIcmVmLmVhY2goZnVuY3Rpb24gKCkgewoJCXZhciBocmVmID0gJCh0aGlzKS5kYXRhKCdocmVmJyk7CgoJCXZhciBsaW5rID0gaHJlZi5zcGxpdCgnLycpOwoJCXZhciBsaW5rUGF0aCA9IGxpbmtbbGluay5sZW5ndGgtMV07CgogICAgICAgIHZhciBkb21haW5OYW1lID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbjsKICAgICAgICB2YXIgcGFnZUluZm9NZXRhID0gJCgnaGVhZCBtZXRhW25hbWU9cGFnZWluZm9dJyk7CiAgICAgICAgdmFyIGNjID0gcGFnZUluZm9NZXRhLmRhdGEoJ2NjJyk7CiAgICAJdmFyIGxjID0gcGFnZUluZm9NZXRhLmRhdGEoJ2xjJyk7CgkJdmFyIGxvY2FsaXplZE1pY3Jvc2l0ZVRhYkxpbmsgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgd2luZG93LmxvY2F0aW9uLmhvc3QgKyAnLycgKyBjYyArICctJyArIGxjICsgJy9oZWxwLycgKyBsaW5rUGF0aDsKCgkJJCh0aGlzKS5kYXRhKCdsaW5rJywgbG9jYWxpemVkTWljcm9zaXRlVGFiTGluayk7CgogICAgICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKCdhcmlhLXNlbGVjdGVkJykgPT09ICJ0cnVlIikgewogICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5hZGRDbGFzcygnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUF0dHIoImhyZWYiKTsKICAgICAgICAgICAgICAgICQodGhpcykuYXR0cigib25jbGljayIsICIiKS51bmJpbmQoImNsaWNrIik7CiAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoJ3RhYmluZGV4JywgJy0xJyk7ICAgICAgICAgICAgICAKCiAgICAgICAgICAgIH0KCgl9KTsKCgogICAgLy9SZXNwb3NpdmUgTmF2IGZvciBQcmludC1TY2FuRG9jIGZvciBNb2JpbGUgRGV2aWNlIE9OTFkKICAgIHZhciBwcmludHRhYkhyZWYgPSAkKCcucHJpbnRTY2FuVGFicyAucHJpbnQtbmF2LXRhYnMtcmVzcG9uc2l2ZSBsaSBhJyk7CgoJCXByaW50dGFiSHJlZi5lYWNoKGZ1bmN0aW9uICgpIHsKCQkJdmFyIGhyZWYgPSAkKHRoaXMpLmRhdGEoJ2hyZWYnKTsKCiAgICAgICAgICAgIHZhciBsaW5rID0gaHJlZi5zcGxpdCgnLycpOwogICAgICAgICAgICB2YXIgbGlua1BhdGggPSBsaW5rW2xpbmsubGVuZ3RoLTFdOwogICAgCiAgICAgICAgICAgIHZhciBkb21haW5OYW1lID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbjsKICAgICAgICAgICAgdmFyIHBhZ2VJbmZvTWV0YSA9ICQoJ2hlYWQgbWV0YVtuYW1lPXBhZ2VpbmZvXScpOwogICAgICAgICAgICB2YXIgY2MgPSBwYWdlSW5mb01ldGEuZGF0YSgnY2MnKTsKICAgICAgICAgICAgdmFyIGxjID0gcGFnZUluZm9NZXRhLmRhdGEoJ2xjJyk7CiAgICAgICAgICAgIHZhciBsb2NhbGl6ZWRNaWNyb3NpdGVUYWJMaW5rID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0ICsgJy8nICsgY2MgKyAnLScgKyBsYyArICcvaGVscC8nICsgbGlua1BhdGg7CgoJCSQodGhpcykuZGF0YSgnbGluaycsIGxvY2FsaXplZE1pY3Jvc2l0ZVRhYkxpbmspOwoKICAgICAgIAkgICAgaWYgKCQodGhpcykuYXR0cignYXJpYS1zZWxlY3RlZCcpID09PSAidHJ1ZSIpIHsgCiAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmFkZENsYXNzKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQXR0cigiaHJlZiIpOwogICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKCJvbmNsaWNrIiwgIiIpLnVuYmluZCgiY2xpY2siKTsKICAgICAgICAgICAgICAgICQodGhpcykuYXR0cigndGFiaW5kZXgnLCAnLTEnKTsgCgogICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCd1bCcpLmZpbmQoJ2xpJykuaGlkZSgpOwogICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5zaG93KCkKCiAgICAgICAgICAgICAgICAgJCh0aGlzKS5jbGljayhmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJ3VsJykuZmluZCgnbGknKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgndWwnKS5maW5kKCcuZmEnKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICQoJ3VsLnByaW50LW5hdi10YWJzLXJlc3BvbnNpdmUgbGk6Zmlyc3QnKS5maW5kKCcuZmEnKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB9CgogICAgIH0pOwoKCgoKCgoKfSk7CgoKZnVuY3Rpb24gdGFiY2xpY2soZSwgZWwpIHsKCWUucHJldmVudERlZmF1bHQoKTsKCXdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJChlbCkuZGF0YSgnbGluaycpOwoKfQogICAgd2luZG93LmRldGVjdGVkT3MgPSAnJzsKICAgIHdpbmRvdy5kZXRlY3RlZE9zSWNvbiA9ICcnOwogICAgd2luZG93LmFsdE9zID0gJyc7CiAgICB3aW5kb3cuYWx0T3NJY29uID0gJyc7CgpmdW5jdGlvbiBvc25hdnRhYmNsaWNrKGUsIGVsKSB7CiAgICAgICAgdmFyIHRhYk5hbWUgPSAiIyIgKyAkKGVsKS5hdHRyKCdhcmlhLWNvbnRyb2xzJyk7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOyAgICAKICAgICAgICAkKCcubmF2Q29udCcpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgICAkKGVsKS5jbG9zZXN0KCdsaScpLmFkZENsYXNzKCdhY3RpdmUnKTsKICAgICAgICAkKCcubXlPc05hdlJvdyAudGFiLXBhbmUnKS5oaWRlKCk7CiAgICAgICAgJCh0YWJOYW1lKS5zaG93KCk7IAogICAgICAgICQodGFiTmFtZSkuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogICAgICAgIGlmICh0YWJOYW1lID09ICIjaG93VG9GYXgiKSB7CiAgICAgICAgICAgICQoIiNvc1NlbGVjdG9yIikuaGlkZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoIiNvc1NlbGVjdG9yIikuc2hvdygpOwogICAgICAgIH0gICAgICAgICAgICAKICAgICAgICBwdXNoUXVlcnlTdHJpbmcoInRhYj0iKyQoZWwpLmF0dHIoJ2FyaWEtY29udHJvbHMnKSk7Cn0KCmZ1bmN0aW9uIHB1c2hRdWVyeVN0cmluZyhxdWVyeVN0cmluZyl7CiAgICB2YXIgaXNQcmV2aWV3ID0gZ2V0VXJsUGFyYW1ldGVyKCJ3Y21tb2RlIik7CiAgICB2YXIgbnFzID0gKGlzUHJldmlldyAhPT0gIiIpID8gIj93Y21tb2RlPWRpc2FibGVkJiIgKyBxdWVyeVN0cmluZyA6ICI/IiArIHF1ZXJ5U3RyaW5nOwogICAgaGlzdG9yeS5wdXNoU3RhdGUobnVsbCwgbnVsbCwgd2luZG93LmxvY2F0aW9uLm9yaWdpbiArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArIG5xcyk7Cn07CgpmdW5jdGlvbiBnZXRVcmxQYXJhbWV0ZXIobmFtZSkgewogICAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xbXS8sICdcXFsnKS5yZXBsYWNlKC9bXF1dLywgJ1xcXScpOwogICAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cCgnW1xcPyZdJyArIG5hbWUgKyAnPShbXiYjXSopJyk7CiAgICB2YXIgcmVzdWx0cyA9IHJlZ2V4LmV4ZWMobG9jYXRpb24uc2VhcmNoKTsKICAgIHJldHVybiAocmVzdWx0cyA9PT0gbnVsbCkgPyAnJyA6IGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzFdLnJlcGxhY2UoL1wrL2csICcgJykpOwp9OwoKd2luZG93LnNob3dPc1NwZWNpZmljQ29udGVudCA9IGZ1bmN0aW9uKG9zKSB7ICAgICAgCiAgICBzd2l0Y2ggKG9zKXsKICAgICAgICBjYXNlICdXaW5kb3dzJzoKICAgICAgICAgICAgJCgnLm1hY2NvbnRhaW5lcicpLmFkZENsYXNzKCdoaWRkZW4nKS5oaWRlKCk7ICAgICAgICAgICAgCiAgICAgICAgICAgICQoJy53aW5kb3dzY29udGFpbmVyJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpLnNob3coKTsgICAgICAgICAgICAKICAgICAgICAgICAgZGV0ZWN0ZWRPc0ljb24gPSAnZmEtd2luZG93cyc7CiAgICAgICAgICAgIGFsdE9zSWNvbiA9ICdmYS1hcHBsZSc7CiAgICAgICAgICAgIGFsdE9zID0gJ01hY2ludG9zaCc7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdNYWNpbnRvc2gnOgogICAgICAgICAgICAkKCcud2luZG93c2NvbnRhaW5lcicpLmFkZENsYXNzKCdoaWRkZW4nKS5oaWRlKCk7CiAgICAgICAgICAgICQoJy5tYWNjb250YWluZXInKS5yZW1vdmVDbGFzcygnaGlkZGVuJykuc2hvdygpOwogICAgICAgICAgICBkZXRlY3RlZE9zSWNvbiA9ICdmYS1hcHBsZSc7CiAgICAgICAgICAgIGFsdE9zSWNvbiA9ICdmYS13aW5kb3dzJzsKICAgICAgICAgICAgYWx0T3MgPSAnV2luZG93cyc7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICQoJy5tYWNjb250YWluZXInKS5hZGRDbGFzcygnaGlkZGVuJykuaGlkZSgpOwogICAgICAgICAgICAkKCcud2luZG93c2NvbnRhaW5lcicpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKS5zaG93KCk7CiAgICAgICAgICAgIGRldGVjdGVkT3NJY29uID0gJ2ZhLXdpbmRvd3MnOwogICAgICAgICAgICBhbHRPc0ljb24gPSAnZmEtYXBwbGUnOwogICAgICAgICAgICBhbHRPcyA9ICdNYWNpbnRvc2gnOwogICAgICAgICAgICBicmVhazsKICAgIH0KfTsKCndpbmRvdy5kZXRlY3RPcyA9IChmdW5jdGlvbigpewogICAgZGV0ZWN0ZWRPcyA9ICAvTWFjL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSA/ICdNYWNpbnRvc2gnOidXaW5kb3dzJzsKICAgIHNob3dPc1NwZWNpZmljQ29udGVudChkZXRlY3RlZE9zKTsKCn0oKSk7Cgp3aW5kb3cuZ2V0UXVlcnlTdHJpbmcgPSBmdW5jdGlvbigpewogICAgdmFyIHF1ZXJ5U3RyaW5nVGFiID0gZ2V0VXJsUGFyYW1ldGVyKCJ0YWIiKTsKICAgIHZhciB0YWJJZCA9ICIjIiArIHF1ZXJ5U3RyaW5nVGFiICsgIlRhYiI7CiAgICBpZiAocXVlcnlTdHJpbmdUYWIgIT09ICIiKSB7CiAgICAgICAgJCgnLm5hdkNvbnQnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7CiAgICAgICAgJCh0YWJJZCkucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogICAgICAgICQoJy5teU9zTmF2Um93IC50YWItcGFuZScpLmhpZGUoKTsKICAgICAgICAkKCIjIitxdWVyeVN0cmluZ1RhYikuc2hvdygpOyAKICAgICAgICAkKCIjIitxdWVyeVN0cmluZ1RhYikuYWRkQ2xhc3MoJ2FjdGl2ZScpOyAgICAgICAKICAgICAgICBpZiAocXVlcnlTdHJpbmdUYWIgPT0gImhvd1RvRmF4IikgewogICAgICAgICAgICAkKCIjb3NTZWxlY3RvciIpLmhpZGUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkKCIjb3NTZWxlY3RvciIpLnNob3coKTsKICAgICAgICB9ICAgICAgICAgICAgICAgCiAgICB9IAogICAgICAgIHZhciB0YWJIcmVmID0gJCgnLm9zbmF2LXRhYnMgbGkgYScpOwogICAgICAgIHRhYkhyZWYuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBocmVmID0gJCh0aGlzKS5hdHRyKCdhcmlhLWNvbnRyb2xzJyk7CiAgICAgICAgICAgIHZhciBpc1ByZXZpZXcgPSBnZXRVcmxQYXJhbWV0ZXIoIndjbW1vZGUiKTsKICAgICAgICAgICAgdmFyIG5xdCA9IChpc1ByZXZpZXcgIT09ICIiKSA/ICI/d2NtbW9kZT1kaXNhYmxlZCZ0YWI9IiArIGhyZWYgOiAiP3RhYj0iICsgaHJlZjsgICAgICAgICAgICAKICAgICAgICAgICAgJCh0aGlzKS5hdHRyKCdocmVmJywgd2luZG93LmxvY2F0aW9uLm9yaWdpbiArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArIG5xdCk7CgogICAgICAgIH0pOyAgICAgIAp9OwoKJCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24gKCkgewogICAgZ2V0UXVlcnlTdHJpbmcoKTsgICAgICAgCiAgICAkKCcjYWN0aXZlT3MnKS50ZXh0KGRldGVjdGVkT3MpOwogICAgJCgnI2FjdGl2ZU9zJykucHJldigpLmFkZENsYXNzKGRldGVjdGVkT3NJY29uKS5yZW1vdmVDbGFzcyhhbHRPc0ljb24pOwogICAgJCgnI2luYWN0aXZlT3Mgc3BhbjpsYXN0JykudGV4dChhbHRPcyk7CiAgICAkKCcjaW5hY3RpdmVPcyBpJykuYWRkQ2xhc3MoYWx0T3NJY29uKS5yZW1vdmVDbGFzcyhkZXRlY3RlZE9zSWNvbik7CiAgICAkKCcjaW5hY3RpdmVPcycpLmF0dHIoJ2FyaWEtbGFiZWwnLCAnc3dpdGNoIHRvIHZpZXdpbmcgY29udGVudCBmb3IgJyArIGFsdE9zKTsgCiAgICBpZiAoZGV0ZWN0ZWRPcyAhPT0gJ01hY2ludG9zaCcpIHsKICAgICAgICAkKCcubWFjY29udGFpbmVyJykuYWRkQ2xhc3MoJ2hpZGRlbicpOwogICAgfSBlbHNlIHsKICAgICAgICAkKCcubWFjY29udGFpbmVyJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICQoJy53aW5kb3dzY29udGFpbmVyJykuYWRkQ2xhc3MoJ2hpZGRlbicpOwogICAgfSAgICAKCiAgICAkKCcjaW5hY3RpdmVPcycpLmNsaWNrKGZ1bmN0aW9uKGUpIHsKICAgICAgICB2YXIgc2VsZWN0ZWRPc0VsZW0gPSAkKHRoaXMpLmZpbmQoJ3NwYW46bGFzdCcpLnRleHQoKTsKICAgICAgICAkKHRoaXMpLmZpbmQoJ3NwYW46bGFzdCcpLnRleHQoZGV0ZWN0ZWRPcyk7CiAgICAgICAgJCh0aGlzKS5hdHRyKCdhcmlhLWxhYmVsJywgJ3N3aXRjaCB0byB2aWV3aW5nIGNvbnRlbnQgZm9yICcgKyBkZXRlY3RlZE9zKTsKICAgICAgICAkKHRoaXMpLmZpbmQoJ2knKS5hZGRDbGFzcyhkZXRlY3RlZE9zSWNvbikucmVtb3ZlQ2xhc3MoYWx0T3NJY29uKTsKICAgICAgICAkKCcjYWN0aXZlT3MnKS50ZXh0KHNlbGVjdGVkT3NFbGVtKTsKICAgICAgICAkKCcjYWN0aXZlT3MnKS5wcmV2KCkuYWRkQ2xhc3MoYWx0T3NJY29uKS5yZW1vdmVDbGFzcyhkZXRlY3RlZE9zSWNvbik7CiAgICAgICAgZGV0ZWN0ZWRPcyA9IHNlbGVjdGVkT3NFbGVtOyAgICAgICAgCiAgICAgICAgc2hvd09zU3BlY2lmaWNDb250ZW50KHNlbGVjdGVkT3NFbGVtKTsKICAgICAgICAkKCcubGl2ZXJlZ2lvbicpLnRleHQoJ05vdyBzaG93aW5nIGNvbnRlbnQgZm9yICAnICsgc2VsZWN0ZWRPc0VsZW0pOwogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgIH0pOwoKfSk7CgokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKICAgIC8vIENsaWNrIGZ1bmN0aW9uIGZvciBtaWNyb3NpdGUgdGFiIHZlcnRpY2FsIGxheW91dAoKICAgICQoJy5tc25hdiBsaSBhLCAubXNuYXZSZXNwb25zaXZlIGxpIGEnKS5jbGljayhmdW5jdGlvbihldmVudCkgeyAgCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgCgkJCgkJaWYoISQodGhpcykuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7CgkJCgkJCQkkKCcubXN0YWJDb250YWluZXInKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7CgkJCQkkKHRoaXMpLmNsb3Nlc3QoJ2xpJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOwoJCQkJCgkJCQkvL3NldCBvcGVuIGNsb3NlIGljb24KCQkJCSQoJy5tc1RhYkljb24tb3BlbicpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsKCQkJCSQoJy5tc1RhYkljb24tY2xvc2UnKS5hZGRDbGFzcygnaGlkZGVuJyk7CgkJCQkkKHRoaXMpLmNsb3Nlc3QoJ2xpJykuZmluZCgnLm1zVGFiSWNvbi1jbG9zZScpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsKCQkJCSQodGhpcykuY2xvc2VzdCgnbGknKS5maW5kKCcubXNUYWJJY29uLW9wZW4nKS5hZGRDbGFzcygnaGlkZGVuJyk7CgkJCQkKCQkJCSQoJy5teVJvdyAudGFiLXBhbmUsIC5teVJvd1Jlc3BvbnNpdmUgLnRhYi1wYW5lJykuaGlkZSgpOwoJCQkJJCgkKHRoaXMpLmF0dHIoJ2hyZWYnKSkuc2hvdygpOyAKCQkJCSQoJCh0aGlzKS5hdHRyKCdocmVmJykpLmFkZENsYXNzKCdhY3RpdmUnKTsKCQkJfQkKCQllbHNlewoJCQkJJCh0aGlzKS50b2dnbGVDbGFzcygnYWN0aXZlJyk7CgkJCQkkKHRoaXMpLmNsb3Nlc3QoJ2xpJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwoJCQkJJCgkKHRoaXMpLmF0dHIoJ2hyZWYnKSkuaGlkZSgpOyAKCQkJCSQoJCh0aGlzKS5hdHRyKCdocmVmJykpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKCQkJCQoJCQkJLy9zZXQgb3BlbiBjbG9zZSBpY29uCgkJCQkkKHRoaXMpLmNsb3Nlc3QoJ2xpJykuZmluZCgnLm1zVGFiSWNvbi1jbG9zZScpLmFkZENsYXNzKCdoaWRkZW4nKTsKCQkJCSQodGhpcykuY2xvc2VzdCgnbGknKS5maW5kKCcubXNUYWJJY29uLW9wZW4nKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0gCgkJCgkJJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe3Njcm9sbFRvcDogJCh0aGlzKS5vZmZzZXQoKS50b3B9LCAxMDAwKTsKCiAgICB9KTsKCiAgICAgJCgnLm1zLXJlc3BvbnNpdmUtdGFiJykuY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsgIAogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7ICAKICAgICAgICAkKCQodGhpcykuYXR0cignaHJlZicpKS5hcHBlbmRUbygkKHRoaXMpLmNsb3Nlc3QoJ2xpJykuZmluZCgnLm15Um93UmVzcG9uc2l2ZScpKTsgCgogICAgfSk7CgogICAgJCgnLm1zLWRlc2t0b3AtdGFiJykuY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsgIAogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7ICAKICAgICAgICAkKCQodGhpcykuYXR0cignaHJlZicpKS5hcHBlbmRUbygnLm15Um93Jyk7IAoKICAgIH0pOwoKCgoJICQoIi5ib2R5Q29udGFpbmVyIikucmVtb3ZlQ2xhc3MoImNvbnRhaW5lciIpOwoKCiAgICAvLyBTZXR0aW5nIHRhYmUgd2lkdGggaWYgVGFicyA9IDMgCgogICAgCgogICAgaWYoICQoJy5tcy10YWJzLWxheW91dCB1bCBsaScpLmxlbmd0aCA9PSAzICl7CiAgICAgICAgICQoJy5tc3RhYkNvbnRhaW5lcicpLmFkZENsYXNzKCd0YWJsZW5ndGgzJyk7CiAgICB9CgoKICAgICQoJy50YWItaGVhZGVyLXByaW50ZXItc2VjdGlvbiAucHJpbnRpbmctdGFiLWhlYWQnKS5yZW1vdmVBdHRyKCdzdHlsZScpOwoKCn0pOwovL0xvZ2ljIHRvIGNyZWF0ZSBlcnJvciBtZXNzYWdlIC0gQXNod2luaQovL2F0dHIgLSBlcnJvclBvc2l0aW9uID0gImJyIiwgd2lsbCBzaG93IHRoZSBlcnJvciBtZXNzZ2FlIGJlbG93LiBFbHNlLCBlcnJvciBtZXNzYWdlIHdpbGwgYmUgc2hvd24gYWJvdmUgdGhlIGVycm9yIGVsZW1lbnQuCmZ1bmN0aW9uIGNyZWF0ZUVycm9yTWVzc2FnZShlbCwgbXNnKSB7CglpZiAoJChlbCkucHJvcCgndGFnTmFtZScpLnRvTG93ZXJDYXNlKCkgPT0gInNlbGVjdCIpIHsKCQlpZiAoJChlbCkuYXR0cignZXJyb3JQb3NpdGlvbicpICE9IHVuZGVmaW5lZCkgewoJCQlpZiAoJChlbCkuaGFzQ2xhc3MoImhwU3R5bGVEcm9wZG93bkxpZ2h0IikpIHsKCQkJCSQoJyMnICsgJChlbCkuYXR0cignaWQnKSArICdfZGRfbGlnaHQnKS5hdHRyKCdlcnJvclBvc2l0aW9uJywgJChlbCkuYXR0cignZXJyb3JQb3NpdGlvbicpKTsKCQkJfSBlbHNlIHsKCQkJCSQoJyMnICsgJChlbCkuYXR0cignaWQnKSArICdfZGQnKS5hdHRyKCdlcnJvclBvc2l0aW9uJywgJChlbCkuYXR0cignZXJyb3JQb3NpdGlvbicpKTsKCQkJfQoJCX0KCQlpZiAoJChlbCkuaGFzQ2xhc3MoImhwU3R5bGVEcm9wZG93bkxpZ2h0IikpIHsKCQkJZWwgPSAkKCcjJyArICQoZWwpLmF0dHIoJ2lkJykgKyAnX2RkX2xpZ2h0Jyk7CgkJfSBlbHNlIHsKCQkJZWwgPSAkKCcjJyArICQoZWwpLmF0dHIoJ2lkJykgKyAnX2RkJyk7CgkJfQoJfQoJaWYgKCEkKGVsKS5oYXNDbGFzcygnZXJyb3JFbGVtZW50JykpIHsKCQkvL0hpZGUgdGhlIGhlbHAgdGV4dCBsYWJlbAoJCSQoZWwpLnNpYmxpbmdzKCcuaGVscGxhYmVsdGV4dCcpLmhpZGUoKTsKCQltc2cgPSBtc2cgPyBtc2cgOiAnRXJyb3IgT2NjdXJlZCc7CgkJdmFyIGVycm9yUG9zaXRpb24gPSAkKGVsKS5hdHRyKCdlcnJvclBvc2l0aW9uJyk7CgkJdmFyIGVycm9yQ29udGFpbmVyID0gJChlbCkuYXR0cignZXJyb3JDb250YWluZXInKTsKCQlpZiAoZXJyb3JQb3NpdGlvbiAmJiBlcnJvclBvc2l0aW9uID09ICdicicpIHsKCQkJaWYgKGVycm9yQ29udGFpbmVyKSB7CgkJCQkkKCc8c3BhbiBjbGFzcz0iZXJyb3JNZXNzYWdlIj4nICsgJzxzcGFuIGNsYXNzPSJlcnJvckljb24iPjwvc3Bhbj4nICsgbXNnICsgJzwvc3Bhbj4nKS5hcHBlbmRUbygiLiIgKyBlcnJvckNvbnRhaW5lcik7CgkJCX0gZWxzZSB7CgkJCQkkKCc8ZGl2IGNsYXNzPSJlcnJvck1lc3NhZ2UiIHJvbGU9ImFsZXJ0Ij4nICsgJzxzcGFuIGNsYXNzPSJlcnJvckljb24iPjwvc3Bhbj4nICsgbXNnICsgJzwvZGl2PicpLmluc2VydEFmdGVyKGVsKTsKCQkJfQoJCX0gZWxzZSB7CgkJCXZhciB0b3BPZmZzZXQgPSAkKGVsKS5wb3NpdGlvbigpLnRvcCAtIDE4OwoJCQkkKCc8ZGl2IGNsYXNzPSJlcnJvck1lc3NhZ2UiIHN0eWxlPSJ0b3A6JyArIHRvcE9mZnNldCArICdweCI+JyArICc8c3BhbiBjbGFzcz0iZXJyb3JJY29uIj48L3NwYW4+JyArIG1zZyArICc8L2Rpdj4nKS5pbnNlcnRCZWZvcmUoZWwpOwoJCX0KCQkkKGVsKS5hZGRDbGFzcygnZXJyb3JFbGVtZW50Jyk7CgkJJChlbCkuYXR0cignYXJpYS1pbnZhbGlkJywgJ3RydWUnKTsKCX0KfQoKLy9DaGVjayBmb3IgdmFsaWQgZW1haWwgSUQgcGF0dGVybiAtIEFzaHdpbmkKZnVuY3Rpb24gaXNWYWxpZEVtYWlsQWRkcmVzcyhlbWFpbEFkZHJlc3MpIHsKICAgIHZhciBwYXR0ZXJuID0gbmV3ICBSZWdFeHAoL14oKChbYS16XXxcZHxbISNcJCUmJ1wqXCtcLVwvPVw/XF5fYHtcfH1+XXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkrKFwuKFthLXpdfFxkfFshI1wkJSYnXCpcK1wtXC89XD9cXl9ge1x8fX5dfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSspKil8KChceDIyKSgoKChceDIwfFx4MDkpKihceDBkXHgwYSkpPyhceDIwfFx4MDkpKyk/KChbXHgwMS1ceDA4XHgwYlx4MGNceDBlLVx4MWZceDdmXXxceDIxfFtceDIzLVx4NWJdfFtceDVkLVx4N2VdfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoXFwoW1x4MDEtXHgwOVx4MGJceDBjXHgwZC1ceDdmXXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkpKSkqKCgoXHgyMHxceDA5KSooXHgwZFx4MGEpKT8oXHgyMHxceDA5KSspPyhceDIyKSkpQCgoKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKShbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkqKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSkpXC4pKygoW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pfCgoW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKFthLXpdfFxkfC18XC58X3x+fFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSooW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKSlcLj8kL2kpOwogICAgcmV0dXJuIHBhdHRlcm4udGVzdChlbWFpbEFkZHJlc3MpOwp9CgovL0dldCBlcnJvciBtZXNzYWdlIGZvciBlbWFpbC4KZnVuY3Rpb24gZ2V0RW1haWxFcnJvck1lc3NhZ2UoZW1haWxFbCl7Cgl2YXIgZXJyb3JNZXNzYWdlID0gZW1haWxFbC5hdHRyKCdlcnJvck1lc3NhZ2UnKTsKCWlmKGlzVmFsaWRFbWFpbEFkZHJlc3MoZW1haWxFbC52YWwoKSkpewoJCWlmKGVtYWlsRWwuYXR0cignbWF0Y2gnKSAhPSB1bmRlZmluZWQpewoJCQl2YXIgbWF0Y2hpbmdFbCA9IGVtYWlsRWw7CgkJCXZhciBtYXRjaElkID0gbWF0Y2hpbmdFbC5hdHRyKCdtYXRjaCcpOwoJCQl2YXIgaG9zdEVsID0gJCgnIycrIG1hdGNoSWQpOwoJCQl2YXIgbWlzTWF0Y2hFcnJvciA9IG1hdGNoaW5nRWwuYXR0cignbWlzTWF0Y2hFcnJvcicpOwoJCQlpZihtYXRjaGluZ0VsLnZhbCgpLmxlbmd0aCA+IDAgJiYgbWF0Y2hpbmdFbC52YWwoKS50b0xvd2VyQ2FzZSgpICE9IGhvc3RFbC52YWwoKS50b0xvd2VyQ2FzZSgpKXsKCQkJCWVycm9yTWVzc2FnZSA9IG1pc01hdGNoRXJyb3I7CgkJCQljbGVhckVycm9yTWVzc2FnZShtYXRjaGluZ0VsKTsKCQkJCWNyZWF0ZUVycm9yTWVzc2FnZShtYXRjaGluZ0VsLG1pc01hdGNoRXJyb3IpOwoJCQkJaWYoaG9zdEVsLnZhbCgpLmxlbmd0aCA8IDEpewoJCQkJCWNsZWFyRXJyb3JNZXNzYWdlKGhvc3RFbCk7CgkJCQkJY3JlYXRlRXJyb3JNZXNzYWdlKGhvc3RFbCwgaG9zdEVsLmF0dHIoJ2Vycm9yTWVzc2FnZScpKTsKCQkJCX0KCQkJfQoJCX0gZWxzZSBpZihlbWFpbEVsLmF0dHIoJ2NvbXBhcmVFbCcpICE9IHVuZGVmaW5lZCl7CgkJCXZhciBob3N0RWwgPSBlbWFpbEVsOwoJCQl2YXIgY29wYXJlRWwgPSAkKCcjJytob3N0RWwuYXR0cignY29tcGFyZUVsJykpOwoJCQlpZihob3N0RWwudmFsKCkubGVuZ3RoID4gMCAmJiBjb3BhcmVFbC52YWwoKS50b0xvd2VyQ2FzZSgpICE9IGhvc3RFbC52YWwoKS50b0xvd2VyQ2FzZSgpKXsKCQkJCWVycm9yTWVzc2FnZSA9IGNvcGFyZUVsLmF0dHIoJ21pc01hdGNoRXJyb3InKTsKCQkJfQoJCX0KCX0KCXJldHVybiBlcnJvck1lc3NhZ2U7Cn0KCi8vR2V0IGVycm9yIG1lc3NhZ2UgYmFzZWQgb24gZWxlbWVudCB0eXBlCmZ1bmN0aW9uIGdldEVycm9yTWVzc2FnZShlcnJvckVsKXsKCXZhciBlcnJvck1lc3NhZ2UgPSAiTWFuZGF0b3J5IEZpZWxkIjsKCWlmKGVycm9yRWwuYXR0cignZmlsdGVyJykgIT0gdW5kZWZpbmVkICYmIGVycm9yRWwuYXR0cignZmlsdGVyJykudG9Mb3dlckNhc2UoKSA9PSAnZW1haWwnKXsKCQllcnJvck1lc3NhZ2UgPSBnZXRFbWFpbEVycm9yTWVzc2FnZShlcnJvckVsKTsKCX0gZWxzZSBpZihlcnJvckVsLmF0dHIoJ2Vycm9yTWVzc2FnZScpICE9IHVuZGVmaW5lZCl7CgkJZXJyb3JNZXNzYWdlID0gZXJyb3JFbC5hdHRyKCdlcnJvck1lc3NhZ2UnKTsKICAgIH0KCXJldHVybiBlcnJvck1lc3NhZ2U7Cn0KCi8vTG9naWMgdG8gY2xlYXIgdGhlIGVycm9yIG1lc3NhZ2UuIC0gQXNod2luaQpmdW5jdGlvbiBjbGVhckVycm9yTWVzc2FnZShlbCkgewoJaWYgKCQoZWwpLnByb3AoJ3RhZ05hbWUnKS50b0xvd2VyQ2FzZSgpID09ICJzZWxlY3QiKSB7CgkJaWYgKCQoZWwpLmhhc0NsYXNzKCJocFN0eWxlRHJvcGRvd25MaWdodCIpKSB7CgkJCWVsID0gJCgnIycgKyAkKGVsKS5hdHRyKCdpZCcpICsgJ19kZF9saWdodCcpOwoJCX0gZWxzZSB7CgkJCWVsID0gJCgnIycgKyAkKGVsKS5hdHRyKCdpZCcpICsgJ19kZCcpOwoJCX0KCX0KCWlmICgkKGVsKS5oYXNDbGFzcygnZXJyb3JFbGVtZW50JykgJiYgJChlbCkuYXR0cignZXJyb3JQb3NpdGlvbicpICE9IHVuZGVmaW5lZCAmJiAkKGVsKS5hdHRyKCdlcnJvclBvc2l0aW9uJykgPT0gJ2JyJykgewoJCWlmICgkKGVsKS5uZXh0KCkuaGFzQ2xhc3MoJ2Vycm9yTWVzc2FnZScpKXsKICAgICAgICAgICAgJChlbCkubmV4dCgpLnJlbW92ZSgpOwogICAgICAgIH0gZWxzZSBpZiAoJChlbCkucHJldigpLmhhc0NsYXNzKCdlcnJvck1lc3NhZ2UnKSl7CiAgICAgICAgICAgICQoZWwpLnByZXYoKS5yZW1vdmUoKTsKICAgICAgICB9CiAgICAgICAgJChlbCkucmVtb3ZlQ2xhc3MoJ2Vycm9yRWxlbWVudCcpOwogICAgICAgICQoZWwpLnJlbW92ZUF0dHIoJ2FyaWEtaW52YWxpZCcpOwogICAgICAgIC8vU2hvdyB0aGUgaGVscCB0ZXh0IGxhYmVsCiAgICAgICAgJChlbCkuc2libGluZ3MoJy5oZWxwbGFiZWx0ZXh0Jykuc2hvdygpOwogICAgfSBlbHNlIGlmICgkKGVsKS5oYXNDbGFzcygnZXJyb3JFbGVtZW50JykpIHsKICAgICAgICBpZiAoJChlbCkubmV4dCgpLmhhc0NsYXNzKCdlcnJvck1lc3NhZ2UnKSl7CiAgICAgICAgICAgICQoZWwpLm5leHQoKS5yZW1vdmUoKTsKICAgICAgICB9IGVsc2UgaWYgKCQoZWwpLnByZXYoKS5oYXNDbGFzcygnZXJyb3JNZXNzYWdlJykpewogICAgICAgICAgICAkKGVsKS5wcmV2KCkucmVtb3ZlKCk7CiAgICAgICAgfQogICAgICAgICQoZWwpLnJlbW92ZUNsYXNzKCdlcnJvckVsZW1lbnQnKTsKICAgICAgICAkKGVsKS5yZW1vdmVBdHRyKCdhcmlhLWludmFsaWQnKTsKICAgICAgICAvL1Nob3cgdGhlIGhlbHAgdGV4dCBsYWJlbAogICAgICAgICQoZWwpLnNpYmxpbmdzKCcuaGVscGxhYmVsdGV4dCcpLnNob3coKTsKICAgIH0KICAgIHZhciBlcnJvckNvbnRhaW5lciA9ICQoZWwpLmF0dHIoJ2Vycm9yQ29udGFpbmVyJyk7CiAgICBpZiAoZXJyb3JDb250YWluZXIpIHsKICAgICAgICAkKCIuIiArIGVycm9yQ29udGFpbmVyKS5maW5kKCIuZXJyb3JNZXNzYWdlIikucmVtb3ZlKCk7CiAgICAgICAgJChlbCkucmVtb3ZlQ2xhc3MoJ2Vycm9yRWxlbWVudCcpOwogICAgICAgICQoZWwpLnJlbW92ZUF0dHIoJ2FyaWEtaW52YWxpZCcpOwogICAgfQp9CgovL1RoaXMgY2hlY2tzIGZvciBwb3NzaWJsZSBlcnJvcnMgaW4gdGhlIGVycm9yIGFuZCBjcmVhdGVzIGVycm9yIG1lc3NhZ2UgYmFzZWQgb24gZWxlbWVudCB0eXBlLiAtIEFzaHdpbmkKZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGVscykgewoJLy9GdW5jdGlvbiB0byBjaGVjayBpZiBhIHByb3BlcnR5IGV4aXN0c0xvY2FsCgkvL0V4YW1wbGU6ICQoJyNzZWFyY2gtaW5wdXQnKS5leGlzdHNMb2NhbCgnZ2hvc3R0ZXh0Jyk7CglqUXVlcnkuZm4uZXhpc3RzTG9jYWwgPSBmdW5jdGlvbihhdHRyaWJ1dGVWYXIpIHsKCQl2YXIgYXR0ciA9ICQodGhpcykuYXR0cihhdHRyaWJ1dGVWYXIpOwoJCXJldHVybiB0eXBlb2YgYXR0ciAhPT0gdHlwZW9mIHVuZGVmaW5lZCAmJiBhdHRyICE9PSBmYWxzZTsKCX07CgoJLy9OZXcgcHJvcGVydHkgdG8gZ2V0IGFjdHVhbCB2YWx1ZSBleGNsdWRpbmcgZ2hvc3QgdGV4dCB3aXRoIHRyaW0oKQoJalF1ZXJ5LmZuLmFjdHVhbFZhbExvY2FsID0gZnVuY3Rpb24oKSB7CgkJaWYgKHRoaXNbMF0pIHsKCQkJdmFyIGVsID0gJCh0aGlzWzBdKTsKCQkJdmFyIGdob3N0VGV4dFVzZWQgPSBlbC5leGlzdHNMb2NhbCgnZ2hvc3R0ZXh0Jyk7CgkJCWlmIChnaG9zdFRleHRVc2VkICYmIGVsLnZhbCgpID09IGVsLmF0dHIoJ2dob3N0VGV4dCcpKSB7CgkJCQlyZXR1cm4gJyc7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gJC50cmltKGVsLnZhbCgpKTsKCQkJfQoJCX0KCQlyZXR1cm4gdW5kZWZpbmVkOwoJfTsKCgkvL05ldyBwcm9wZXJ0eSB0byBnZXQgYWN0dWFsIHZhbHVlIGV4Y2x1ZGluZyBnaG9zdCB0ZXh0IHdpdGhvdXQgdHJpbSgpOwoJalF1ZXJ5LmZuLnRydWVWYWxMb2NhbCA9IGZ1bmN0aW9uKCkgewoJCWlmICh0aGlzWzBdKSB7CgkJCXZhciBlbGUgPSAkKHRoaXNbMF0pOwoJCQl2YXIgZ2hvc3RUZXh0VXNlZCA9IGVsZS5leGlzdHNMb2NhbCgnZ2hvc3R0ZXh0Jyk7CgkJCWlmIChnaG9zdFRleHRVc2VkICYmIGVsZS52YWwoKSA9PSBlbGUuYXR0cignZ2hvc3RUZXh0JykpIHsKCQkJCXJldHVybiAnJzsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiBlbGUudmFsKCk7CgkJCX0KCQl9CgkJcmV0dXJuIHVuZGVmaW5lZDsKICAgIH07CgoJaWYgKCQoZWxzKS5sZW5ndGggPiAwKSB7CgkJdmFyIG1pbkNoYXIgPSAkKGVscykuYXR0cignTWluLUNoYXInKTsKCQl2YXIgbWluQ2hhckZsYWcgPSBtaW5DaGFyID8gJChlbHMpLmFjdHVhbFZhbExvY2FsKCkubGVuZ3RoID4gMCAmJiAkKGVscykuYWN0dWFsVmFsTG9jYWwoKS5sZW5ndGggPCBtaW5DaGFyIDogZmFsc2U7CgkJdmFyIGVtYWlsRmxhZyA9ICQoZWxzKS5hdHRyKCdGaWx0ZXInKSA9PSAnRW1haWwnICYmICQudHJpbSgkKGVscykudmFsKCkpLmxlbmd0aCA+IDAgPyAhaXNWYWxpZEVtYWlsQWRkcmVzcygkLnRyaW0oJChlbHMpLnZhbCgpKSkgOiBmYWxzZTsKCQl2YXIgZW1haWxNYXRjaCA9ICQoZWxzKS5hdHRyKCdNYXRjaCcpICYmICQudHJpbSgkKGVscykudmFsKCkpLmxlbmd0aCA+IDAgPyAhKCQoZWxzKS52YWwoKS50b0xvd2VyQ2FzZSgpID09ICQoJyMnICsgJChlbHMpLmF0dHIoJ01hdGNoJykpLnZhbCgpLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7CgkJaWYgKCQoZWxzKS5hdHRyKCdjb21wYXJlRWwnKSAhPSB1bmRlZmluZWQpewogICAgICAgICAgICBlbWFpbE1hdGNoID0gJC50cmltKCQoZWxzKS52YWwoKSkubGVuZ3RoID4gMCA/ICEoJChlbHMpLnZhbCgpLnRvTG93ZXJDYXNlKCkgPT0gJCgnIycgKyAkKGVscykuYXR0cignY29tcGFyZUVsJykpLnZhbCgpLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7CiAgICAgICAgfQoJCXZhciBpc1ZhbGlkRGF0YSA9IHRydWU7CgkJLyogRGVmZWN0IDM1NzAgaWYgUmVxdWlyZWRWYWxpZGF0aW9uIGlzIGZhbHNlIGFuZCBhY3R1YWxWYWxMb2NhbCgpIGlzIGVtcHR5IHRoZW4gY2hlY2tpbmcgUmVjb21tZW5kZWQgVmFsaWRhdGlvbiBhdHRyaWJ1dGUgKi8KCQl2YXIgaXNFbXB0eURhdGE7CgkJaWYgKG1pbkNoYXIgJiYgJChlbHMpWzBdLmdldEF0dHJpYnV0ZSgiaWQiKSAhPSAid0Zvcm1TZXJpYWxOdW1iZXIiICYmICQoZWxzKVswXS5nZXRBdHRyaWJ1dGUoImlkIikgIT0gIndGb3JtUHJvZHVjdE51bSIpIHsKICAgICAgICAgICAgLy9jb25kaXRpb24gdG8gY2hlY2sgaWYgdGhlIGVtYWlsIGZpZWxkIGlzIGVtcHR5IG9yIG5vdCBiYXNlZCBvbiBtaW4gY2hhciBVUyAxOTQtNzAKCQkgICBpc0VtcHR5RGF0YSA9IGZhbHNlOwoJCX0gZWxzZSB7CgkJICAgICBpc0VtcHR5RGF0YSA9ICggJChlbHMpLmF0dHIoJ1JlcXVpcmVkVmFsaWRhdGlvbicpID09ICJ0cnVlIiAmJiAkLnRyaW0oJChlbHMpLmFjdHVhbFZhbExvY2FsKCkpID09ICcnICkgfHwgKCAkKGVscykuYXR0cignUmVjb21tZW5kZWRWYWxpZGF0aW9uJykgPT0gInRydWUiICk7CgkJfQoJCS8qIERlZmVjdCAzNTcwICovCgoJCWlmICgkKGVscykuYXR0cignZ2hvc3RUZXh0JykgJiYgKCQoZWxzKS52YWwoKSA9PSAkKGVscykuYXR0cignZ2hvc3RUZXh0JykpIHx8ICQoZWxzKS5hdHRyKCdkZWZhdWx0VGV4dCcpICYmICgkKGVscykudmFsKCkgPT0gJChlbHMpLmF0dHIoJ2RlZmF1bHRUZXh0JykpIHx8IGlzRW1wdHlEYXRhIHx8IG1pbkNoYXJGbGFnIHx8IGVtYWlsRmxhZyB8fCBlbWFpbE1hdGNoIHx8ICFpc1ZhbGlkRGF0YSkgewogICAgICAgICAgICB2YXIgbXNnID0gZ2V0RXJyb3JNZXNzYWdlKCQoZWxzKSk7CiAgICAgICAgICAgIGlmICgkKGVscykucHJvcCgidGFnTmFtZSIpLnRvTG93ZXJDYXNlKCkgPT0gInNlbGVjdCIpIHsKCQkJCS8vZWxzPSAkKGVscykuYXR0cigiaWQiKSsiX2RkIjsKCQkJfQoJCQlpZiAoISQoZWxzKS5oYXNDbGFzcygnZXJyb3JFbGVtZW50JykpIHsKCQkJCS8vRGlmZmVyZW50IGVycm9yIG1lc3NhZ2luZyBmb3IgZW1haWwuCgkJCQl2YXIgaXNFbWFpbEZpZWxkID0gJChlbHMpLmF0dHIoJ2ZpbHRlcicpICE9IHVuZGVmaW5lZCAmJiAkKGVscykuYXR0cignZmlsdGVyJykudG9Mb3dlckNhc2UoKSA9PSAnZW1haWwnOwoJCQkJdmFyIGlzTWF0Y2hpbmdIb3N0ID0gJChlbHMpLmF0dHIoJ2NvbXBhcmVFbCcpICE9IHVuZGVmaW5lZCAmJiAkKGVscykudmFsKCkubGVuZ3RoID4gMDsKCQkJCXZhciBpc1ZhbGlkRW1haWxGb3JtYXQgPSBpc1ZhbGlkRW1haWxBZGRyZXNzKCQoZWxzKS52YWwoKSk7CgkJCQlpZiAoaXNFbWFpbEZpZWxkICYmIGlzTWF0Y2hpbmdIb3N0ICYmIGlzVmFsaWRFbWFpbEZvcm1hdCkgewoJCQkJCXZhciBlbWFpbEVycm9yRWxlbWVudCA9ICQoJyMnICsgJChlbHMpLmF0dHIoJ2NvbXBhcmVFbCcpKTsKCQkJCQljcmVhdGVFcnJvck1lc3NhZ2UoZW1haWxFcnJvckVsZW1lbnQsIG1zZyk7CgkJCQl9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNyZWF0ZUVycm9yTWVzc2FnZShlbHMsIG1zZyk7CiAgICAgICAgICAgICAgICB9CgkJCX0KCQl9IGVsc2UgewoJCQljbGVhckVycm9yTWVzc2FnZShlbHMpOwoJCX0KCX0KfQoKLy9DcmVhdGlvbiBvZiBlcnJvciBoYW5kbGVyIC0gQXNod2luaQpmdW5jdGlvbiBjcmVhdGVFcnJvckhhbmRsZXIoZWxzLHNlbGVjdEVsKXsKICAgIGVscy5lYWNoKGZ1bmN0aW9uKGtleSx2YWwpewogICAgICAgIGlmKHNlbGVjdEVsKXsKICAgICAgICAgICAgdmFyIHNlbGVjdEFuY2hvcklkID0gJCh0aGlzKS5hdHRyKCJpZCIpICsgIl9kZF9oZWFkZXJMaW5rIjsKICAgICAgICAgICAgaWYoISgkKHRoaXMpLmF0dHIoJ0Vycm9yRXhjZXB0aW9uRXZlbnQnKSAmJiAkKHRoaXMpLmF0dHIoJ0Vycm9yRXhjZXB0aW9uRXZlbnQnKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoImJsdXIiKSA+PSAwKSl7CiAgICAgICAgICAgICAgICAkKCIjIitzZWxlY3RBbmNob3JJZCkuYmx1cihmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIHZhciBzZWxlY3RFbElkID0gJCh0aGlzKS5hdHRyKCJpZCIpLnNwbGl0KCJfIilbMF07CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlRWwgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50OwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0RWxlbWVudCA9ICQoIiMiK3NlbGVjdEVsSWQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZihzZWxlY3RFbGVtZW50Lmhhc0NsYXNzKCJocFN0eWxlRHJvcGRvd25MaWdodCIpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCEkKGFjdGl2ZUVsKS5wYXJlbnRzKCIjIitzZWxlY3RFbElkKyJfZGRfbGlnaHQiKS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvckhhbmRsZXIoc2VsZWN0RWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCEkKGFjdGl2ZUVsKS5wYXJlbnRzKCIjIitzZWxlY3RFbElkKyJfZGQiKS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvckhhbmRsZXIoc2VsZWN0RWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LDEwMCk7CgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJCgiIyIrc2VsZWN0QW5jaG9ySWQpLm9uKCdmb2N1cycsZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzZWxlY3RFbGVtZW50ID0gJCgiIyIrJCh0aGlzKS5hdHRyKCJpZCIpLnNwbGl0KCJfIilbMF0pOwogICAgICAgICAgICAgICAgY2xlYXJFcnJvck1lc3NhZ2Uoc2VsZWN0RWxlbWVudCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH1lbHNlewogICAgICAgICAgICBpZighKCQodGhpcykuYXR0cignRXJyb3JFeGNlcHRpb25FdmVudCcpICYmICQodGhpcykuYXR0cignRXJyb3JFeGNlcHRpb25FdmVudCcpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigiYmx1ciIpID49IDApKXsKICAgICAgICAgICAgICAgICQodGhpcykuYmx1cihmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIGVycm9ySGFuZGxlcih0aGlzKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgICQodGhpcykub24oJ2ZvY3VzJyxmdW5jdGlvbigpewogICAgICAgICAgICAgICAgY2xlYXJFcnJvck1lc3NhZ2UodGhpcyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0vL0RvbnQgQXR0YWNoIHRoZSBibHVyIGV2ZW50IGZvciB0aGUgZWxlbWVudHMgbGlrZSBwZmluZGVyCiAgICB9KTsKfQoKLy9UaGlzIHNlY3Rpb24gbWFrZXMgc3VyZSB0aGUgdGV4dC90ZXh0IGFyZWEgd2lsbCBub3QgYWNjZXB0IG1vcmUgdGhhbiBzcGVjaWZpZWQgbWF4IGNoYXIuIC0gQXNod2luaQovL0hhbmRsZWQgZm9yIHR5cGUsIGRyYWctZHJvcCBhbmQgY29weS1wYXN0ZS4KZnVuY3Rpb24gY3JlYXRlTWF4Q2hhckhhbmRsZXIoZWxlSWQpewoJaWYoISQoZWxlSWQpLmF0dHIoJ0ZpbHRlcicpIHx8ICQoZWxlSWQpLmF0dHIoJ01heC1DaGFyJykpewogICAgICAgIHZhciBldmVudEtleUNvZGUgPSAiIjsKCQkkKGVsZUlkKS5vbigna2V5ZG93bicsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldmVudCkgIT09ICd1bmRlZmluZWQnICYmIGV2ZW50Lmhhc093blByb3BlcnR5KCJrZXlDb2RlIikpewogICAgICAgICAgICAgICAgICAgIGV2ZW50S2V5Q29kZSA9IGV2ZW50LmtleUNvZGU7CiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0eXBlb2YoZSkgIT09ICd1bmRlZmluZWQnICYmIGUuaGFzT3duUHJvcGVydHkoIndoaWNoIikpewogICAgICAgICAgICAgICAgICAgIGV2ZW50S2V5Q29kZSA9IGUud2hpY2g7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1jYXRjaChlKXsKICAgICAgICAgICAgICAgIC8vc3VwcmVzcyBlcnJvcgogICAgICAgICAgICB9CgkJCWlmKChldmVudC50YXJnZXQudmFsdWUubGVuZ3RoID4gJCh0aGlzKS5hdHRyKCdNYXgtQ2hhcicpKSAmJiBldmVudEtleUNvZGUhPSA4ICYmIGV2ZW50S2V5Q29kZSE9IDEyNyl7CgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQl9CiAgICAgICAgfSkuYmluZCh7cGFzdGU6IGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgaWYoJCh0aGlzKS5hdHRyKCdNYXgtQ2hhcicpICYmIGV2ZW50LnRhcmdldC52YWx1ZS5sZW5ndGggPiAkKHRoaXMpLmF0dHIoJ01heC1DaGFyJykpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICQodGhpcykudmFsKCQodGhpcykudmFsKCkuc3Vic3RyaW5nKDAsJCh0aGlzKS5hdHRyKCdNYXgtQ2hhcicpKSk7CiAgICAgICAgICAgIH0KCQl9fSk7Cgl9Cn0KCi8vRW5hYmxpbmcgYW5kIERpc2FibGluZyBvZiBkZXBlbmRlbmN5IGVsZW1lbnRzIC0gQXNod2luaQpmdW5jdGlvbiBjaGVja0ZvckVuYWJsaW5nKGRlcGVuZGVjeUVsZW1lbnRzLGVuYWJsaW5nRWwpewoJdmFyIGRpc2FibGVGbGFnID0gZmFsc2U7CgkkLmVhY2goZGVwZW5kZWN5RWxlbWVudHMsZnVuY3Rpb24oa2V5LHZhbHVlKXsKCQl2YWx1ZSA9ICQudHJpbSh2YWx1ZSk7CgkJaWYoISh2YWx1ZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoInJhZGlvIikgPj0gMCkpewoJCQl2YXIgZWxlbSA9ICQoJyMnK3ZhbHVlKTsKCQkJaWYoZWxlbS5oYXNDbGFzcygiaHBTdHlsZURyb3Bkb3duTGlnaHQiKSl7CgkJCQl2YXIgdGVtcCA9ICcjJyt2YWx1ZSsnX2RkX2xpZ2h0IHVsIGxpJzsKCQkJfWVsc2V7CgkJCQl2YXIgdGVtcCA9ICcjJyt2YWx1ZSsnX2RkIHVsIGxpJzsKCQkJfQoJCX1lbHNlewoJCQlpZigkKCIjIit2YWx1ZSkubGVuZ3RoID4gMCl7CgkJCQlpZigkKCIjIit2YWx1ZSkuaXMoIklOUFVUIikpewoJCQkJCXZhciBlbGVtID0gJCgnIycrdmFsdWUpOwoJCQkJfWVsc2V7CgkJCQkJdmFyIGVsZW0gPSAkKCcuJyt2YWx1ZSk7CgkJCQl9CgkJCX1lbHNlewoJCQkJdmFyIGVsZW0gPSAkKCcuJyt2YWx1ZSk7CgkJCX0KCQl9CgkJaWYoZWxlbS5hdHRyKCdSZXF1aXJlZFZhbGlkYXRpb24nKSAhPT0gInRydWUiKXsKCQkJaWYoZWxlbS5wcm9wKCJ0YWdOYW1lIikgIT0gdW5kZWZpbmVkICYmICgoZWxlbS5wcm9wKCJ0YWdOYW1lIikudG9Mb3dlckNhc2UoKSA9PSAiaW5wdXQiICYmIChlbGVtLmF0dHIoJ3R5cGUnKS50b0xvd2VyQ2FzZSgpID09ICJ0ZXh0IiB8fCBlbGVtLmF0dHIoJ3R5cGUnKS50b0xvd2VyQ2FzZSgpID09ICJoaWRkZW4iIHx8IGVsZW0uYXR0cigidHlwZSIpLnRvTG93ZXJDYXNlKCkgPT0gInRlbCIgfHwgZWxlbS5hdHRyKCJ0eXBlIikudG9Mb3dlckNhc2UoKSA9PSAiZW1haWwiKSkgfHwgZWxlbS5wcm9wKCJ0YWdOYW1lIikudG9Mb3dlckNhc2UoKSA9PSAidGV4dGFyZWEiKSl7CgkJCQlpZihlbGVtLmF0dHIoJ21pbi1jaGFyJykgJiYgZWxlbS5hY3R1YWxWYWwoKS5sZW5ndGggPiAwKXsKCQkJCQlkaXNhYmxlRmxhZyA9IGVsZW0uYWN0dWFsVmFsKCkubGVuZ3RoIDwgZWxlbS5hdHRyKCdtaW4tY2hhcicpOwoJCQkJfWVsc2UgaWYoZWxlbS5hdHRyKCdtaW4tY2hhcicpICYmIGVsZW0uYWN0dWFsVmFsKCkubGVuZ3RoID09IDApewkJLy9maXggZm9yIHZhbGlkYXRpb24gZm9yIHYyIGNhcHRjaGEuIEFkZGVkIHRoZSBlbHNlIHBhcnQgdG8gZGlzYWJsZSB0aGUgc3VibWl0IGJ1dHRvbiB1bmxlc3MgdGhlIGNhcHRjaGEgY2hlY2tib3ggaXMgbm90IGNoZWNrZWQuIERpZCBub3QgaGFyZGNvZGUgdGhlIGZsYWcgdG8gdHJ1ZSBhcyBpdCBpcyBub3QgaGFyZGNvZGVkIGFueXdoZXJlLgoJCQkJCWRpc2FibGVGbGFnID0gZWxlbS5hY3R1YWxWYWwoKS5sZW5ndGggPCBlbGVtLmF0dHIoJ21pbi1jaGFyJyk7CgkJCQl9CgkJCX0KCQl9ZWxzZSBpZihlbGVtLnByb3AoInRhZ05hbWUiKSAhPSB1bmRlZmluZWQpewoJCQlpZigoZWxlbS5wcm9wKCJ0YWdOYW1lIikudG9Mb3dlckNhc2UoKSA9PSAiaW5wdXQiICYmIChlbGVtLmF0dHIoJ3R5cGUnKS50b0xvd2VyQ2FzZSgpID09ICJ0ZXh0IiB8fCBlbGVtLmF0dHIoInR5cGUiKS50b0xvd2VyQ2FzZSgpID09ICJ0ZWwiIHx8IGVsZW0uYXR0cigidHlwZSIpLnRvTG93ZXJDYXNlKCkgPT0gImVtYWlsIikpIHx8IGVsZW0ucHJvcCgidGFnTmFtZSIpLnRvTG93ZXJDYXNlKCkgPT0gInRleHRhcmVhIil7CgkJCQl2YXIgY2hhckxlbmd0aENoZWNrID0gZWxlbS5hdHRyKCdNaW4tQ2hhcicpID8gZWxlbS5hdHRyKCdNaW4tQ2hhcicpIDogMTsKCQkJCWRpc2FibGVGbGFnID0gZGlzYWJsZUZsYWcgfHwgZWxlbS5hdHRyKCdnaG9zdFRleHQnKSAmJiAoZWxlbS52YWwoKSA9PSBlbGVtLmF0dHIoJ2dob3N0VGV4dCcpKSB8fCAkLnRyaW0oZWxlbS52YWwoKSkubGVuZ3RoIDwgY2hhckxlbmd0aENoZWNrOwoJCQkJaWYoZWxlbS5hdHRyKCdtYXRjaCcpKXsKCQkJCQlkaXNhYmxlRmxhZyA9IGRpc2FibGVGbGFnIHx8ICQoJyMnK2VsZW0uYXR0cignbWF0Y2gnKSkudmFsKCkudG9Mb3dlckNhc2UoKSAhPSBlbGVtLnZhbCgpLnRvTG93ZXJDYXNlKCk7CgkJCQl9CgoJCQkJLy9JZiB0aGVyZSBpcyBhIHJlZ0V4cCBjaGVjayByZXF1aXJlZCwgd2UgbmVlZCB0byBwYXNzIHRoZSByZWdFeCB0byB0aGUgZGF0YSB2YXJpYWJsZSAiZGF0YS1yZWdFeHBDaGVjayIKCQkJCS8vVGhlIHN1Ym1pdCBidXR0b24gd2lsbCBiZSBlbmFibGVkIG9ubHkgaWYgdGhlIHJlZ0V4IHBhc3NlZAoJCQkJdmFyIHJlZ0V4cENoZWNrID0gZWxlbS5hdHRyKCdkYXRhLXJlZ0V4cENoZWNrJykgfHwgJyc7CgkJCQlpZihyZWdFeHBDaGVjay5sZW5ndGggPiAwKXsKCQkJCQlyZWdFeHBDaGVjayA9IHJlZ0V4cENoZWNrLnJlcGxhY2UoL1wvL2csJycpOyAvL1JlbW92ZSBhbGwgIi8iCgkJCQkJcmVnRXhwQ2hlY2sgPSBuZXcgUmVnRXhwKHJlZ0V4cENoZWNrKTsgLy9UaGlzIGlzIHRoZSByZWdFeHAgdGhhdCB3aWxsIGJlIHVzZWQgdG8gdGVzdCB0aGUgdmFsaWRpdHkgb2YgdGhlIHN0cmluZwoJCQkJCWRpc2FibGVGbGFnID0gZGlzYWJsZUZsYWcgfHwgIXJlZ0V4cENoZWNrLnRlc3QoZWxlbS52YWwoKSk7CgkJCQl9CgkJCX1lbHNlIGlmKGVsZW0ucHJvcCgidGFnTmFtZSIpLnRvTG93ZXJDYXNlKCkgPT0gInNlbGVjdCIpewoJCQkJZGlzYWJsZUZsYWcgPSBkaXNhYmxlRmxhZyB8fCAkKCIjIitlbGVtLmF0dHIoJ2lkJykrIl9kZF9oZWFkZXJWYWx1ZSIpLmh0bWwoKS5zcGxpdCgnPCcpWzBdID09IGVsZW0uY2hpbGRyZW4oJ29wdGlvbicpLmZpcnN0KCkuaHRtbCgpOwoJCQl9ZWxzZSBpZiAoKGVsZW0ucHJvcCgidGFnTmFtZSIpLnRvTG93ZXJDYXNlKCkgPT0gImlucHV0IiAmJiBlbGVtLmF0dHIoJ3R5cGUnKS50b0xvd2VyQ2FzZSgpID09ICJyYWRpbyIpKXsKCQkJCWRpc2FibGVGbGFnID0gZGlzYWJsZUZsYWcgfHwgIWVsZW0uaXMoJzpjaGVja2VkJyk7CgkJCX1lbHNlIGlmICgoZWxlbS5wcm9wKCJ0YWdOYW1lIikudG9Mb3dlckNhc2UoKSA9PSAiaW5wdXQiICYmIGVsZW0uYXR0cigndHlwZScpLnRvTG93ZXJDYXNlKCkgPT0gImNoZWNrYm94IikpewoJCQkJZGlzYWJsZUZsYWcgPSBkaXNhYmxlRmxhZyB8fCAhZWxlbS5pcygiOmNoZWNrZWQiKTsKCQkJfQoJCX0KCX0pOwoJaWYoZGlzYWJsZUZsYWcpewoJCWVuYWJsaW5nRWwuYXR0cignZGlzYWJsZWQnLCdkaXNhYmxlZCcpLmF0dHIoJ2FyaWEtZGlzYWJsZWQnLCd0cnVlJyk7Cgl9CgllbHNlewoJCWVuYWJsaW5nRWwucmVtb3ZlQXR0cignZGlzYWJsZWQnKS5yZW1vdmVBdHRyKCdhcmlhLWRpc2FibGVkJyk7Cgl9Cn0KCi8vIEluaXRpYXRlIHZhbGlkYXRpb24gZGVwZW5kZW5jeSBmb3Igc3VibWl0IGJ1dHRvbiBhY3RpdmF0aW9uCmZ1bmN0aW9uIGluaXRFYXNGb3JtVmFsaWRhdGlvbkRlcGVuZGVuY3lGb3JTdWJtaXRBY3RpdmF0ZSgpewoJJCgnI3N1Ym1pdEJ0blthY3RpdmVEZXBlbmRlbmN5XScpLmVhY2goZnVuY3Rpb24oKXsKCQl2YXIgZW5hYmxpbmdFbCA9ICQodGhpcyk7CgkJdmFyIGRlcGVuZGVjeUVsZW1lbnRzID0gW107CgkJZW5hYmxpbmdFbC5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJykuYXR0cignYXJpYS1kaXNhYmxlZCcsJ3RydWUnKTsKCQlkZXBlbmRlY3lFbGVtZW50cyA9IGVuYWJsaW5nRWwuYXR0cignYWN0aXZlRGVwZW5kZW5jeScpOwoJCWRlcGVuZGVjeUVsZW1lbnRzID0gJC50cmltKGRlcGVuZGVjeUVsZW1lbnRzKS5zcGxpdCgnLCcpOwoJCWNoZWNrRm9yRW5hYmxpbmcoZGVwZW5kZWN5RWxlbWVudHMsZW5hYmxpbmdFbCk7IC8qIFRoaXMgd2lsbCBjaGVjayBpZiB0aGUgc3VibWl0IHNob3VsZCBiZSBhY3R1YWxseSBkaXNhYmxlZCAvIG5vdCBhbmQgdGhlbiBkaXNhYmxlIHRoZSBidXR0b24gLyBub3QgKi8KCQkkLmVhY2goZGVwZW5kZWN5RWxlbWVudHMsZnVuY3Rpb24oaW5kZXgsIHZhbHVlKXsKCQkJdmFsdWUgPSAkLnRyaW0odmFsdWUpOwoJCQlpZighKHZhbHVlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigicmFkaW8iKSA+PSAwKSl7CgkJCQl2YXIgZWxlbSA9ICQoJyMnK3ZhbHVlKTsKCQkJCWlmKGVsZW0uaGFzQ2xhc3MoImhwU3R5bGVEcm9wZG93bkxpZ2h0IikpewoJCQkJCXZhciB0ZW1wID0gJyMnK3ZhbHVlKydfZGRfbGlnaHQgdWwgbGknOwoJCQkJfQoJCQkJZWxzZXsKCQkJCQl2YXIgdGVtcCA9ICcjJyt2YWx1ZSsnX2RkIHVsIGxpJzsKCQkJCX0KCQkJfQoJCQllbHNlewoJCQkJaWYoJCgiIyIrdmFsdWUpLmxlbmd0aCA+IDApewoJCQkJCWlmKCQoIiMiK3ZhbHVlKS5pcygiSU5QVVQiKSl7CgkJCQkJCXZhciBlbGVtID0gJCgnIycrdmFsdWUpOwoJCQkJCX0KCQkJCQllbHNlewoJCQkJCQl2YXIgZWxlbSA9ICQoJy4nK3ZhbHVlKTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlewoJCQkJCXZhciBlbGVtID0gJCgnLicrdmFsdWUpOwoJCQkJfQoJCQl9CgkJCWlmKGVsZW0ucHJvcCgndGFnTmFtZScpICE9IHVuZGVmaW5lZCl7CgkJCQlpZiggKGVsZW0ucHJvcCgidGFnTmFtZSIpLnRvTG93ZXJDYXNlKCkgPT0gImlucHV0IiAmJiAoZWxlbS5hdHRyKCd0eXBlJykudG9Mb3dlckNhc2UoKSA9PSAidGV4dCIgfHwgZWxlbS5hdHRyKCJ0eXBlIikudG9Mb3dlckNhc2UoKSA9PSAidGVsIiB8fCBlbGVtLmF0dHIoInR5cGUiKS50b0xvd2VyQ2FzZSgpID09ICJlbWFpbCIpKSB8fCBlbGVtLnByb3AoInRhZ05hbWUiKS50b0xvd2VyQ2FzZSgpID09ICJ0ZXh0YXJlYSIpewoJCQkJCWVsZW0ub24oJ2tleWRvd24ga2V5dXAnLGZ1bmN0aW9uKCl7CgkJCQkJCWNoZWNrRm9yRW5hYmxpbmcoZGVwZW5kZWN5RWxlbWVudHMsZW5hYmxpbmdFbCk7CgkJCQkJfSk7CgkJCQkJZWxlbS5vbignY2hhbmdlJyxmdW5jdGlvbihldmVudCl7CgkJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkge2NoZWNrRm9yRW5hYmxpbmcoZGVwZW5kZWN5RWxlbWVudHMsZW5hYmxpbmdFbCk7fSwgMSk7CgkJCQkJfSk7CgkJCQkJZWxlbS5vbigncGFzdGUnLGZ1bmN0aW9uKGV2ZW50KXsKCQkJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7Y2hlY2tGb3JFbmFibGluZyhkZXBlbmRlY3lFbGVtZW50cyxlbmFibGluZ0VsKTt9LCAxKTsKCQkJCQl9KTsKCQkJCQllbGVtLm9uKCdpbnB1dCcsZnVuY3Rpb24oZXZlbnQpewoJCQkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtjaGVja0ZvckVuYWJsaW5nKGRlcGVuZGVjeUVsZW1lbnRzLGVuYWJsaW5nRWwpO30sIDEpOwoJCQkJCX0pOwoJCQkJCWpRdWVyeShkb2N1bWVudCkub24oImRyYWdlbmQiICwgZnVuY3Rpb24oZXZlbnQpewoJCQkJCQljaGVja0ZvckVuYWJsaW5nKGRlcGVuZGVjeUVsZW1lbnRzLGVuYWJsaW5nRWwpOwoJCQkJCX0pOwoJCQkJfQoJCQkJZWxzZSBpZihlbGVtLnByb3AoInRhZ05hbWUiKS50b0xvd2VyQ2FzZSgpID09ICJzZWxlY3QiKXsKCQkJCQkkKHRlbXApLmVhY2goZnVuY3Rpb24oKXsKCQkJCQkJJCh0aGlzKS5vbignY2xpY2snLGZ1bmN0aW9uKGV2ZW50KXsKCQkJCQkJCWNoZWNrRm9yRW5hYmxpbmcoZGVwZW5kZWN5RWxlbWVudHMsZW5hYmxpbmdFbCk7CgkJCQkJCX0pOwoJCQkJCX0pOwoJCQkJfQoJCQkJZWxzZSBpZihlbGVtLnByb3AoInRhZ05hbWUiKS50b0xvd2VyQ2FzZSgpID09ICJpbnB1dCIgJiYgZWxlbS5hdHRyKCd0eXBlJykudG9Mb3dlckNhc2UoKSA9PSAicmFkaW8iKXsKCQkJCQl2YXIgZWxOYW1lID0gZWxlbS5hdHRyKCduYW1lJyk7CgkJCQkJJCgnaW5wdXRbbmFtZT0iJytlbE5hbWUrJyJdJykub24oJ2lmQ2hhbmdlZCcsIGZ1bmN0aW9uKGV2ZW50KXsKCQkJCQkJY2hlY2tGb3JFbmFibGluZyhkZXBlbmRlY3lFbGVtZW50cyxlbmFibGluZ0VsKTsKCQkJCQl9KTsKCQkJCX0KCQkJCWVsc2UgaWYoZWxlbS5wcm9wKCJ0YWdOYW1lIikudG9Mb3dlckNhc2UoKSA9PSAiaW5wdXQiICYmIGVsZW0uYXR0cigndHlwZScpLnRvTG93ZXJDYXNlKCkgPT0gImNoZWNrYm94Iil7CgkJCQkJJCgnaW5wdXRbbmFtZT0iJytlbE5hbWUrJyJdJykub24oJ2lmQ2hhbmdlZCcsIGZ1bmN0aW9uKGV2ZW50KXsKCQkJCQkJY2hlY2tGb3JFbmFibGluZyhkZXBlbmRlY3lFbGVtZW50cyxlbmFibGluZ0VsKTsKCQkJCQl9KTsKCQkJCX0KCQkJfQoJCX0pOwoJCSQodGhpcykub24oJ2NsaWNrJyxmdW5jdGlvbihldmVudCl7CgkJCSQuZWFjaChkZXBlbmRlY3lFbGVtZW50cyxmdW5jdGlvbihrZXksdmFsdWUpewoJCQkJdmFsdWUgPSAkLnRyaW0odmFsdWUpOwoJCQkJdmFyIGVsZW0gPSAnIycrdmFsdWU7CgkJCQllcnJvckhhbmRsZXIoZWxlbSk7CgkJCQlpZigkKGVsZW0pLmhhc0NsYXNzKCdlcnJvckVsZW1lbnQnKSl7CgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCX0KCQkJfSk7CgkJfSk7CgoJCSQodGhpcykub24oJ2tleWRvd24nLGZ1bmN0aW9uKCl7CgkJCXZhciBldmVudEtleUNvZGUgPSBldmVudC5rZXlDb2RlID8gZXZlbnQua2V5Q29kZSA6IGV2ZW50LndoaWNoOwoJCQlpZihldmVudEtleUNvZGUgPT0gMTMpewoJCQkJJC5lYWNoKGRlcGVuZGVjeUVsZW1lbnRzLGZ1bmN0aW9uKGtleSx2YWx1ZSl7CgkJCQkJdmFsdWUgPSAkLnRyaW0odmFsdWUpOwoJCQkJCXZhciBlbGVtID0gJyMnK3ZhbHVlOwoJCQkJCWVycm9ySGFuZGxlcihlbGVtKTsKCQkJCQlpZigkKGVsZW0pLmhhc0NsYXNzKCdlcnJvckVsZW1lbnQnKSl7CgkJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCQkJfQoJCQkJfSk7CgkJCX0KCQl9KTsKCX0pOwp9CgpmdW5jdGlvbiBpbml0RXJyb3JIYW5kbGVycygpewoJY3JlYXRlTWF4Q2hhckhhbmRsZXIoJ2lucHV0W01heC1DaGFyXScpOwoJY3JlYXRlRXJyb3JIYW5kbGVyKCQoJ2lucHV0W1JlcXVpcmVkVmFsaWRhdGlvbj0idHJ1ZSJdJykpOwoJY3JlYXRlRXJyb3JIYW5kbGVyKCQoJ3NlbGVjdFtSZXF1aXJlZFZhbGlkYXRpb249InRydWUiXScpLHRydWUpOwogICAgY3JlYXRlRXJyb3JIYW5kbGVyKCQoJ3RleHRhcmVhW1JlcXVpcmVkVmFsaWRhdGlvbj0idHJ1ZSJdJykpOwogICAgaW5pdEVhc0Zvcm1WYWxpZGF0aW9uRGVwZW5kZW5jeUZvclN1Ym1pdEFjdGl2YXRlKCk7Cn0KdmFyIGVhc0NDID0gIiI7CgpmdW5jdGlvbiBzZXRDb3VudHJ5Q29udGV4dCgpewogICAgdHJ5ewogICAgICAgIGVhc0NDID0gJCgnaGVhZCBtZXRhW25hbWU9cGFnZWluZm9dJykuZGF0YSgnY2MnKTsKICAgICAgICBpZignJyAhPT0gZWFzQ0MpewogICAgICAgICAgICAkKCIjdXNlckNvdW50cnlDb2RlIG9wdGlvblt2YWx1ZT0nIitlYXNDQysiJ10iKS5hdHRyKCJzZWxlY3RlZCIsdHJ1ZSk7CiAgICAgICAgfQogICAgfWNhdGNoKGUpewogICAgICAgIGNvbnNvbGUubG9nKCJTSVRFIEVSUk9SOiByZXBhaXIgIiArIGUpOwogICAgfQp9CgpmdW5jdGlvbiBnZXRIcFN0eWxlTGlnaHREcm9wZG93bigpIHsKICAgIC8vdGhpcyB3aWxsIGFjdCBhcyB0aGUgaW5pdCBmdW5jdGlvbgogICAgJCgnc2VsZWN0LmhwU3R5bGVEcm9wZG93bkxpZ2h0JykuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgLy9nZXQgc2xlY3QgdGFnIGlkCiAgICAgICAgdmFyIGFjdHVhbEVsSWQgPSAkKHRoaXMpLmF0dHIoJ2lkJyk7CgogICAgICAgIGlmIChjaGVja0ZvckN1c3RvbURyb3Bkb3duTGlnaHQoYWN0dWFsRWxJZCkpIHsKICAgICAgICAgICAgaGlkZVNlbGVjdEJ5SWRMaWdodChhY3R1YWxFbElkKTsKICAgICAgICAgICAgY3JlYXRlQ3VzdG9tRHJvcGRvd25MaWdodFN0cnVjdHVyZShhY3R1YWxFbElkKTsKICAgICAgICAgICAgYXR0YWNoQ2xpY2tIYW5kbGVyTGlnaHQoYWN0dWFsRWxJZCk7CiAgICAgICAgICAgIGF0dGFjaEtleWJvYXJkTGlzdGVuZXJzTGlnaHQoYWN0dWFsRWxJZCk7CiAgICAgICAgICAgIGF0dGFjaENoYW5nZUxpc3RlbmVyTGlnaHQoYWN0dWFsRWxJZCk7CiAgICAgICAgfQogICAgfSk7Cn0KCmZ1bmN0aW9uIGNoZWNrRm9yQ3VzdG9tRHJvcGRvd25MaWdodCAoZWxJZCkgewogICAgLy8gZWxJZCA9IElkIG9mIHRoZSBzZWxlY3QgdGFnCiAgICAvL2NoZWNrIGlmIGVsZW1lbnQgd2l0aCBpZCA9IDxlbElkPl9kZCBleGlzdHMKICAgIGlmICgkKCcjJyArIGVsSWQgKyAnX2RkX2xpZ2h0JykubGVuZ3RoIDwgMSkgewogICAgICAgIC8vZWxlbWVudCBkb2VzbnQgZXhpc3QsIHJldHVybiB0cnVlIHRvIGNyZWF0ZSBlbGVtZW50CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAvL2VsZW1lbnQgZXhpc3RzLCByZXR1cm4gZmFsc2UgdG8gbm90IHJlY3JlYXRlIGVsZW1lbnQKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0KCmZ1bmN0aW9uIGhpZGVTZWxlY3RCeUlkTGlnaHQoZWxJZCkgewogICAgaWYgKCEkKCcjJyArIGVsSWQpLmhhc0NsYXNzKCdoaWRlJykpIHsKICAgICAgICAkKCcjJyArIGVsSWQpLmFkZENsYXNzKCdoaWRlJykKICAgIH0KfQoKZnVuY3Rpb24gY3JlYXRlQ3VzdG9tRHJvcGRvd25MaWdodFN0cnVjdHVyZShhY3R1YWxFbElkKSB7CiAgICB2YXIgRHJvcGRvd25Db250YWluZXJJZCA9IGFjdHVhbEVsSWQgKyAnX2RkX2xpZ2h0JzsKICAgIHZhciBEcm9wZG93bkNvbnRhaW5lciA9ICQoJzxkaXYgaWQ9IicgKyBEcm9wZG93bkNvbnRhaW5lcklkICsgJyIgY2xhc3M9ImRyb3Bkb3duIGRyb3Bkb3duTGlnaHRDb250YWluZXIgaHBTdHlsZURyb3Bkb3duTGlnaHQiPjwvZGl2PicpOwogICAgdmFyIERyb3Bkb3duVHJpZ2dlckFuY2hvcklkID0gYWN0dWFsRWxJZCArICdfZGRfaGVhZGVyTGluayc7CiAgICB2YXIgRHJvcGRvd25UYWJJbmRleCA9ICQoJyMnICsgYWN0dWFsRWxJZCkuYXR0cigndGFiaW5kZXgnKTsKICAgIHZhciBhcmlhTGFiZWwgPSAkKCcjJyArIGFjdHVhbEVsSWQpLmF0dHIoJ2FyaWEtbGFiZWxsZWRieScpOwogICAgdmFyIERyb3Bkb3duVHJpZ2dlclZhbHVlSWQgPSBhY3R1YWxFbElkICsgJ19kZF9oZWFkZXJWYWx1ZSc7CiAgICB2YXIgdmFsdWVSZXEgPSAiIjsKICAgIGlmIChhcmlhTGFiZWwgPT0gbnVsbCB8fCBhcmlhTGFiZWwgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgYXJpYUxhYmVsID0gRHJvcGRvd25UcmlnZ2VyVmFsdWVJZDsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGFyaWFMYWJlbCA9IGFyaWFMYWJlbCArICIgIiArIERyb3Bkb3duVHJpZ2dlclZhbHVlSWQ7CiAgICB9CiAgICBpZiAodHlwZW9mIERyb3Bkb3duVGFiSW5kZXggPT0gInVuZGVmaW5lZCIgfHwgRHJvcGRvd25UYWJJbmRleCA9PSAiIikgewogICAgICAgIHZhciBEcm9wZG93blRyaWdnZXJBbmNob3IgPSAkKCc8YSBpZD0iJyArIERyb3Bkb3duVHJpZ2dlckFuY2hvcklkICsgJyIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIiBocmVmPSJqYXZhc2NyaXB0OjsiIGNsYXNzPSJkcm9wZG93bkhlYWRlckxpbmsiIGFyaWEtZXhwYW5kZWQ9ImZhbHNlIiBhcmlhLWRlc2NyaWJlZGJ5PSInICsgYXJpYUxhYmVsICsgJyI+PC9hPicpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgdmFyIERyb3Bkb3duVHJpZ2dlckFuY2hvciA9ICQoJzxhIGlkPSInICsgRHJvcGRvd25UcmlnZ2VyQW5jaG9ySWQgKyAnIiB0YWJpbmRleD0iJyArIERyb3Bkb3duVGFiSW5kZXggKyAnImhyZWY9ImphdmFzY3JpcHQ6OyIgY2xhc3M9ImRyb3Bkb3duLXRvZ2dsZSBkcm9wZG93bkhlYWRlckxpbmsiIGFyaWEtZXhwYW5kZWQ9ImZhbHNlIiBhcmlhLWRlc2NyaWJlZGJ5PSInICsgYXJpYUxhYmVsICsgJyI+PC9hPicpOwogICAgfQoKICAgIHZhciBEcm9wZG93blRyaWdnZXJWYWx1ZSA9ICQoJzxzcGFuIGlkPSInICsgRHJvcGRvd25UcmlnZ2VyVmFsdWVJZCArICciIGNsYXNzPSJkcm9wZG93bkhlYWRlclZhbHVlIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9zcGFuPicpOwoKICAgICQoRHJvcGRvd25UcmlnZ2VyQW5jaG9yKS5hcHBlbmQoRHJvcGRvd25UcmlnZ2VyVmFsdWUpOwoKICAgICQoRHJvcGRvd25Db250YWluZXIpLmFwcGVuZChEcm9wZG93blRyaWdnZXJBbmNob3IpOwoKICAgIHZhciBEcm9wZG93bkxpc3RJZCA9IGFjdHVhbEVsSWQgKyAnX2RkX2xpc3QnOwogICAgdmFyIERyb3Bkb3duTGlzdCA9ICQoJzx1bCBpZD0iJyArIERyb3Bkb3duTGlzdElkICsgJyIgcm9sZT0ibWVudSIgY2xhc3M9ImRyb3Bkb3duLW1lbnUgZHJvcGRvd24tbWVudS1saWdodCBkcm9wZG93bkxpc3QiPjwvdWw+Jyk7CgogICAgJChEcm9wZG93bkNvbnRhaW5lcikuYXBwZW5kKERyb3Bkb3duTGlzdCk7CgogICAgLy9pbnNlcnQgdGhlIGN1c3RvbSBjb250YWluZXIgYWZ0ZXIgdGhlIHNlbGVjdCB0YWcKICAgIERyb3Bkb3duQ29udGFpbmVyLmluc2VydEFmdGVyKCQoJyMnICsgYWN0dWFsRWxJZCkpOwoKICAgIC8vcG9wdWxhdGUgdGhlIGxpc3QgaXRlbXMKICAgIHBvcHVsYXRlRHJvcGRvd25MaXN0TGlnaHQoYWN0dWFsRWxJZCwgRHJvcGRvd25MaXN0SWQpOwoKICAgIC8vUG9wdWxhdGUgdGhlIERyb3Bkb3duIEhlYWRlciBWYWx1ZQoKICAgIGlmIChlYXNDQyAhPSAiIikgewogICAgICAgIHBvcHVsYXRlRHJvcGRvd25IZWFkZXJMaWdodChhY3R1YWxFbElkLCBlYXNDQyk7CiAgICB9CiAgICBlbHNlCiAgICAgICAgcG9wdWxhdGVEcm9wZG93bkhlYWRlckxpZ2h0KGFjdHVhbEVsSWQsICIiKTsKfQoKZnVuY3Rpb24gcG9wdWxhdGVEcm9wZG93bkhlYWRlckxpZ2h0KGVsSWQsIHZhbCkgewogICAgLy9zZXQgdGhlIGRyb3Bkb3duIEhlYWRlciBWYWx1ZSB0byB0aGUgZmlyc3QgZWxlbQogICAgdmFyIGZpcnN0VmFsID0gJCgkKCcjJyArIGVsSWQpLmNoaWxkcmVuKCdvcHRpb24nKVswXSkuaHRtbCgpOwogICAgJCgnIycgKyBlbElkICsgJ19kZF9oZWFkZXJWYWx1ZScpLmVtcHR5KCkuYXBwZW5kKGZpcnN0VmFsKTsKICAgICQoJyMnICsgZWxJZCArICdfZGRfaGVhZGVyVmFsdWUnKS5hZGRDbGFzcygnZGVmYXVsdCcpOwogICAgLy9zZXQgdGhlIGhpZGRlbiBkcm9wZG93biB2YWx1ZQogICAgJCgnIycgKyBlbElkKS52YWwoMCkKICAgIGlmICh2YWwgIT0gIiIpIHsKICAgICAgICB2YXIgZWxlbSA9ICIiOwogICAgICAgICQoJyMnICsgZWxJZCArICdfZGRfbGlzdCBsaS5lbGVtIGEgc3Bhbi52YWx1ZScpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoJCh0aGlzKS50ZXh0KCkgPT0gdmFsKSB7CiAgICAgICAgICAgICAgICAvL3NldCB0aGUgZHJvcGRvd24gSGVhZGVyIFZhbHVlIHRvIHRoZSBmb3VuZCBlbGVtCiAgICAgICAgICAgICAgICBlbGVtID0gJCh0aGlzKS5wYXJlbnRzKCdhJykuaHRtbCgpCiAgICAgICAgICAgICAgICAkKCcjJyArIGVsSWQgKyAnX2RkX2hlYWRlclZhbHVlJykuZW1wdHkoKS5hcHBlbmQoZWxlbSk7CiAgICAgICAgICAgICAgICAvL3NldCB0aGUgaGlkZGVuIGRyb3Bkb3duIHZhbHVlCiAgICAgICAgICAgICAgICAkKCcjJyArIGVsSWQpLnZhbCh2YWwpOwogICAgICAgICAgICB9CgogICAgICAgIH0pOwogICAgfQp9CgpmdW5jdGlvbiBwb3B1bGF0ZURyb3Bkb3duTGlzdExpZ2h0KGVsSWQsIGxpc3RJZCkgewogICAgJCgnIycgKyBlbElkKS5jaGlsZHJlbignb3B0aW9uJykuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxpc3RJdGVtID0gJCgnPGxpIGNsYXNzPSJkcm9wZG93bi1pdGVtIGVsZW0iIHJvbGU9Im1lbnVpdGVtIj48L2xpPicpOwogICAgICAgIHZhciBsaXN0SXRlbUFuY2hvciA9ICQoJzxhIGhyZWY9ImphdmFzY3JpcHQ6OyIgPjwvYT4nKTsKICAgICAgICB2YXIgc3BhblZhbHVlID0gJCgnPHNwYW4gY2xhc3M9ImhpZGUgdmFsdWUiPjwvc3Bhbj4nKTsKICAgICAgICB2YXIgc3BhbkltZ1VybCA9ICQoJzxzcGFuIGNsYXNzPSJoaWRlIGltZ3VybCI+PC9zcGFuPicpOwogICAgICAgIHZhciBzcGFuU2VvTGFiZWwgPSAkKCc8c3BhbiBjbGFzcz0iaGlkZSBzZW9MYWJlbCI+PC9zcGFuPicpOwogICAgICAgIHZhciBzcGFuUmVkaXJlY3RVcmwgPSAkKCc8c3BhbiBjbGFzcz0iaGlkZSByZWRpcmVjdFVybCI+PC9zcGFuPicpOwogICAgICAgIHZhciBzcGFuQ2xhenpUeXBlID0gJCgnPHNwYW4gY2xhc3M9ImhpZGUgY2xhenpUeXBlIj48L3NwYW4+Jyk7CiAgICAgICAgdmFyIGxpc3REYXRhID0gJCh0aGlzKS5odG1sKCk7CiAgICAgICAgdmFyIGRhdGFWYWx1ZSA9ICQodGhpcykuYXR0cigndmFsdWUnKTsKICAgICAgICAkKGxpc3RJdGVtQW5jaG9yKS5hcHBlbmQobGlzdERhdGEpOwogICAgICAgICQoc3BhblZhbHVlKS5hcHBlbmQoJCh0aGlzKS5hdHRyKCJ2YWx1ZSIpKTsKICAgICAgICBsaXN0SXRlbUFuY2hvci5hcHBlbmQoc3BhblZhbHVlKTsKICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKCJpbWFnZXVybCIpKSB7CiAgICAgICAgICAgICQoc3BhbkltZ1VybCkuYXBwZW5kKCQodGhpcykuYXR0cigiaW1hZ2V1cmwiKSk7CiAgICAgICAgICAgIGxpc3RJdGVtQW5jaG9yLmFwcGVuZChzcGFuSW1nVXJsKTsKICAgICAgICB9CiAgICAgICAgaWYgKCQodGhpcykuYXR0cigic2VvLWxhYmVsIikpIHsKICAgICAgICAgICAgJChzcGFuU2VvTGFiZWwpLmFwcGVuZCgkKHRoaXMpLmF0dHIoInNlby1sYWJlbCIpKTsKICAgICAgICAgICAgbGlzdEl0ZW1BbmNob3IuYXBwZW5kKHNwYW5TZW9MYWJlbCk7CiAgICAgICAgfQogICAgICAgIGlmICgkKHRoaXMpLmF0dHIoInJlZGlyZWN0VXJsIikpIHsKICAgICAgICAgICAgJChzcGFuUmVkaXJlY3RVcmwpLmFwcGVuZCgkKHRoaXMpLmF0dHIoInJlZGlyZWN0VXJsIikpOwogICAgICAgICAgICBsaXN0SXRlbUFuY2hvci5hcHBlbmQoc3BhblJlZGlyZWN0VXJsKTsKICAgICAgICB9CiAgICAgICAgaWYgKCQodGhpcykuYXR0cigiY2xhenpUeXBlIikpIHsKICAgICAgICAgICAgJChzcGFuQ2xhenpUeXBlKS5hcHBlbmQoJCh0aGlzKS5hdHRyKCJjbGF6elR5cGUiKSk7CiAgICAgICAgICAgIGxpc3RJdGVtQW5jaG9yLmFwcGVuZChzcGFuQ2xhenpUeXBlKTsKICAgICAgICB9CiAgICAgICAgJChsaXN0SXRlbSkuYXBwZW5kKGxpc3RJdGVtQW5jaG9yKTsKICAgICAgICAkKCcjJyArIGxpc3RJZCkuYXBwZW5kKGxpc3RJdGVtKTsKICAgIH0pOwp9CgpmdW5jdGlvbiBhdHRhY2hDbGlja0hhbmRsZXJMaWdodChlbElkKSB7CiAgICAkKCcjJyArIGVsSWQgKyAnX2RkX2xpc3QgbGknKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy9zZXQgdmFsdWUgaW4gdGhlIGhpZGRlbiBzZWxlY3QgdGFnCiAgICAgICAgLy9wb3B1bGF0ZSBoZWFkZXIgdmFsdWUKICAgICAgICBzZWxWYWx1ZSA9ICQodGhpcykuY2hpbGRyZW4oJ2EnKS5jaGlsZHJlbignc3Bhbi52YWx1ZScpLnRleHQoKTsKICAgICAgICAkKCcjJyArIGVsSWQpLnZhbChzZWxWYWx1ZSk7CiAgICAgICAgcG9wdWxhdGVEcm9wZG93bkhlYWRlckxpZ2h0KGVsSWQsIHNlbFZhbHVlKTsKICAgICAgICAkKCcjJyArIGVsSWQpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgIC8vc2V0IGZvY3VzIHRvIHRoZSBtYWluIGFuY2hvciB0YWcKICAgICAgICAkKCcjJyArIGVsSWQgKyAnX2RkX2hlYWRlckxpbmsnKS5mb2N1cygpCiAgICB9KTsKfTsKCmZ1bmN0aW9uIGF0dGFjaEtleWJvYXJkTGlzdGVuZXJzTGlnaHQoZWxJZCkgewogICAgLy9rZXlkb3duIGV2ZXRzIGZvciBlc2MvYmNrc3AvdGFiCiAgICAkKCcjJyArIGVsSWQgKyAnX2RkX2xpZ2h0Jykub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLmtleUNvZGUgPT0gOCB8fCBlLmtleUNvZGUgPT0gOSB8fCBlLmtleUNvZGUgPT0gMjcpIHsKICAgICAgICAgICAgLy9pZiB0aGUgdXNlciBoaXRzIGJhY2tzcGFjZSwgZXNjLCBvciB0YWIgaXQgc2hvdWxkIGNsb3NlIHRoZSBkcm9wZG93bgogICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnb3BlbicpKSB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOy8vdG8gcHJldmVudCBwb3B1cHMgZnJvbSBjbG9zaW5nCiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdvcGVuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICAgIC8va2V5cHJlc3MgZXZlbnRzIGZvciB0eXBlYWhlYWQKICAgICQoJyMnICsgZWxJZCArICdfZGRfbGlnaHQnKS5vbigna2V5cHJlc3MnLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLmtleUNvZGUgIT0gMzcgfHwgZS5rZXlDb2RlICE9IDM4IHx8IGUua2V5Q29kZSAhPSAzOSB8fCBlLmtleUNvZGUgIT0gNDApIHsKICAgICAgICAgICAga2V5ID0gU3RyaW5nLmZyb21DaGFyQ29kZShlLmNoYXJDb2RlICE9IG51bGwgPyBlLmNoYXJDb2RlIDogZS5rZXlDb2RlKTsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVPdXRSZXNldExldHRlcnNMaWdodCk7CiAgICAgICAgICAgIHRpbWVPdXRSZXNldExldHRlcnNMaWdodCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbGV0dGVyUHJlc3NlZExpZ2h0ID0gW107CiAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgICAgIGxldHRlclByZXNzZWRMaWdodC5wdXNoKGtleSk7CiAgICAgICAgICAgIGlmIChnZXRUeXBlZExpZ2h0KCkgPT0gbGV0dGVyUHJlc3NlZExpZ2h0LmpvaW4oJycpKSB7CiAgICAgICAgICAgICAgICBzZXRUeXBlZExpZ2h0KGxldHRlclByZXNzZWRMaWdodC5qb2luKCcnKSk7CiAgICAgICAgICAgICAgICBzZXRDb3VudGVyTGlnaHQoZ2V0Q291bnRlckxpZ2h0KCkgKyAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHNldENvdW50ZXJMaWdodCgxKTsKICAgICAgICAgICAgICAgIHNldFR5cGVkTGlnaHQobGV0dGVyUHJlc3NlZExpZ2h0LmpvaW4oJycpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0eXBlYWhlYWRMaWdodChsZXR0ZXJQcmVzc2VkTGlnaHQuam9pbignJyksIHRoaXMpOwogICAgICAgIH0KICAgIH0pOwogICAgLy9UbyBoYW5kbGUgdHlwZWFoZWQgZm9yIG1vcmUgdGhhbiBvbmNlCiAgICAkKCcjJyArIGVsSWQgKyAnX2RkX2xpZ2h0Jykub24oJ2JsdXInLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHNldENvdW50ZXJMaWdodCgxKTsKICAgICAgICBzZXRUeXBlZExpZ2h0KCcnKTsKICAgIH0pOwogICAgJCgnIycgKyBlbElkICsgJ19kZF9saWdodCB1bCA+IGxpJykub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgc2V0VHlwZUFoZWFkTGlnaHQodGhpcyk7CiAgICB9KTsKfTsKCmZ1bmN0aW9uIGF0dGFjaENoYW5nZUxpc3RlbmVyTGlnaHQoZWxJZCl7CgkkKCcjJytlbElkKS5vbignY2hhbmdlJyxmdW5jdGlvbigpewoJCXZhciBjdXJyZW50VmFsdWUgPSAkKHRoaXMpLnZhbCgpOwoJCWlmKGN1cnJlbnRWYWx1ZSA9PT0gbnVsbCl7CgkJCWN1cnJlbnRWYWx1ZSA9ICIiOwoJCX0KCQlwb3B1bGF0ZURyb3Bkb3duSGVhZGVyTGlnaHQoZWxJZCwgY3VycmVudFZhbHVlKTsKCQlpZihjdXJyZW50VmFsdWUgPT0gMCB8fCBjdXJyZW50VmFsdWUgPT0gIjAiIHx8IGN1cnJlbnRWYWx1ZSA9PSAiIiB8fCBjdXJyZW50VmFsdWUubGVuZ3RoID09IDAgfHwgY3VycmVudFZhbHVlLnRvTG93ZXJDYXNlKCkgPT0gInNlbGVjdCIpewoJCQkkKCIjIitlbElkKyJfZGRfbGlnaHQiKS5yZW1vdmVDbGFzcygidmFsU2VsZWN0ZWQiKTsKCQl9CgkJZWxzZXsKCQkJJCgiIyIrZWxJZCsiX2RkX2xpZ2h0IikuYWRkQ2xhc3MoInZhbFNlbGVjdGVkIik7CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIHR5cGVhaGVhZExpZ2h0KHdoYXQsIGVsZW0pIHsKICAgIHZhciBlbHMgPSAkKCcjJyArICQoZWxlbSkuYXR0cignaWQnKSArICcgLmVsZW0nKS5maWx0ZXIoZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgcmV0dXJuICQodGhpcykuY2hpbGRyZW4oJ2EnKS5odG1sKCkudG9Mb3dlckNhc2UoKS5zZWFyY2god2hhdCkgPT0gMDsKICAgIH0pOwogICAgdmFyIGluZGV4ID0gKHR5cGVBaGVhZENvdW50ZXJMaWdodCAtIDEpICUgZWxzLmxlbmd0aDsKICAgIGlmIChlbHMgJiYgZWxzLmxlbmd0aCA+IDAgJiYgZWxzW2luZGV4XSAmJiBlbHNbaW5kZXhdLmNoaWxkTm9kZXNbMF0pIHsKICAgICAgICBlbHNbaW5kZXhdLmNoaWxkTm9kZXNbMF0uZm9jdXMoKTsKICAgIH0KfQoKZnVuY3Rpb24gc2V0VHlwZUFoZWFkTGlnaHQoZWwpIHsKICAgIHZhciBob3ZlcmVkRWwgPSAkKGVsKTsKICAgIHZhciBob3ZlcmVkQ2hhciA9IGhvdmVyZWRFbC5jaGlsZHJlbignYScpLmh0bWwoKS50b0xvd2VyQ2FzZSgpLnNwbGl0KCc8JylbMF1bMF07CiAgICBzZXRUeXBlZExpZ2h0KGhvdmVyZWRDaGFyKTsKICAgIHNldENvdW50ZXJMaWdodCgwKTsKfQoKdmFyIGxldHRlclByZXNzZWRMaWdodCA9IFtdOwp2YXIgdGltZU91dFJlc2V0TGV0dGVyc0xpZ2h0ID0gbnVsbDsKdmFyIHR5cGVBaGVhZENvdW50ZXJMaWdodCA9IDE7CnZhciB0eXBlQWhlYWRUZXh0TGlnaHQgPSAnJzsKCmZ1bmN0aW9uIHNldENvdW50ZXJMaWdodCh2YWwpewogICAgdHlwZUFoZWFkQ291bnRlckxpZ2h0ID0gdmFsOwp9CgpmdW5jdGlvbiBnZXRDb3VudGVyTGlnaHQoKXsKICAgIHJldHVybiB0eXBlQWhlYWRDb3VudGVyTGlnaHQ7Cn0KCmZ1bmN0aW9uIHNldFR5cGVkTGlnaHQodmFsKXsKICAgIHR5cGVBaGVhZFRleHRMaWdodCA9IHZhbDsKfQoKZnVuY3Rpb24gZ2V0VHlwZWRMaWdodCgpewogICAgcmV0dXJuIHR5cGVBaGVhZFRleHRMaWdodDsKfQoKZnVuY3Rpb24gZ2V0U2VsZWN0ZWREYXRhTGlnaHQob3B0LGVsSUQpewoJdmFyIGVsZW0gPSAkKCcjJytlbElEKydfZGRfaGVhZGVyVmFsdWUnKTsKCWlmKG9wdD09J3ZhbHVlJyl7CgkJcmV0dXJuICQoZWxlbSkuY2hpbGRyZW4oJ3NwYW4udmFsdWUnKS5odG1sKCk7Cgl9CglpZihvcHQ9PSdpbWd1cmwnKXsKCQlyZXR1cm4gJChlbGVtKS5jaGlsZHJlbignc3Bhbi5pbWd1cmwnKS5odG1sKCk7Cgl9CglpZihvcHQ9PSdzZW9MYWJlbCcpewoJCXJldHVybiAkKGVsZW0pLmNoaWxkcmVuKCdzcGFuLnNlb0xhYmVsJykuaHRtbCgpOwoJfQoJaWYob3B0PT0ncmVkaXJlY3RVcmwnKXsKCQlyZXR1cm4gJChlbGVtKS5jaGlsZHJlbignc3Bhbi5yZWRpcmVjdFVybCcpLmh0bWwoKTsKCX0KCWlmKG9wdD09J2NsYXp6VHlwZScpewoJCXJldHVybiAkKGVsZW0pLmNoaWxkcmVuKCdzcGFuLmNsYXp6VHlwZScpLmh0bWwoKTsKCX0KfQoKZnVuY3Rpb24gYXR0YWNoQ2hhbmdlTGlzdGVuZXJMaWdodChlbElkKXsKCSQoJyMnK2VsSWQpLm9uKCdjaGFuZ2UnLGZ1bmN0aW9uKCl7CgkJdmFyIGN1cnJlbnRWYWx1ZSA9ICQodGhpcykudmFsKCk7CgkJaWYoY3VycmVudFZhbHVlID09PSBudWxsKXsKCQkJY3VycmVudFZhbHVlID0gIiI7CgkJfQoJCXBvcHVsYXRlRHJvcGRvd25IZWFkZXJMaWdodChlbElkLCBjdXJyZW50VmFsdWUpOwoJCWlmKGN1cnJlbnRWYWx1ZSA9PSAwIHx8IGN1cnJlbnRWYWx1ZSA9PSAiMCIgfHwgY3VycmVudFZhbHVlID09ICIiIHx8IGN1cnJlbnRWYWx1ZS5sZW5ndGggPT0gMCB8fCBjdXJyZW50VmFsdWUudG9Mb3dlckNhc2UoKSA9PSAic2VsZWN0Iil7CgkJCSQoIiMiK2VsSWQrIl9kZF9saWdodCIpLnJlbW92ZUNsYXNzKCJ2YWxTZWxlY3RlZCIpOwoJCX0KCQllbHNlewoJCQkkKCIjIitlbElkKyJfZGRfbGlnaHQiKS5hZGRDbGFzcygidmFsU2VsZWN0ZWQiKTsKCQl9CgoJfSk7Cn0KCgpmdW5jdGlvbiBzdXBwb3J0ZWRMYW5ncyhzZWxlY3RlZGNjKXsKICAgIC8qKiBOT1RFOiBmb3IgY291bnRyaWVzIHdoZXJlIG1vcmUgdGhhbiBvbmUgbGFuZyBpcyBhdmFpbGFibGUgKHN1Y2ggYXMgJ3RoJyBvciAnYmUnKSwgdGhpcyBmdW5jdGlvbiByZXR1cm5zIHRoZSBmaXJzdCBtYXRjaGluZyBsYW5ndWFnZS4KICAgICogICBDb25zaWRlciByZWZhY3RvcmluZyB0byByZXR1cm4gYW4gYXJyYXkgb2YgYWxsIG1hdGNoaW5nIGxhbmd1YWdlcywgYXMgdGltZSBhbGxvd3MuCiAgICAqLwogICAgdmFyIGxhbmdtYXRjaCA9ICIiOwogICAgdmFyIGNvdW50cnlMYW5nTWFwID0ge307CiAgICBjb3VudHJ5TGFuZ01hcC5lbiA9IFsnYXUnLCdiZycsJ2NhJywnZWUnLCdlbWVhX2FmcmljYScsJ2VtZWFfbWlkZGxlX2Vhc3QnLCdoaycsJ2hyJywnaWQnLCdpZScsJ2luJywnbGFtZXJpY2FfbnNjX2NhcmliJywnbHQnLCdsdicsJ215JywnbnonLCdwaCcsJ3JvJywncnMnLCdzZycsJ3NpJywnc2snLCd0aCcsJ2diJywndXMnLCd2bicsJ3phJ107CiAgICBjb3VudHJ5TGFuZ01hcC5lcyA9IFsnYXInLCdibycsJ2NsJywnY28nLCdlYycsJ2VzJywnbGFtZXJpY2FfbnNjX2NudF9hbWVyJywnbXgnLCdwZScsJ3ByJywncHknLCd1eScsJ3ZlJ107CiAgICBjb3VudHJ5TGFuZ01hcC5kZSA9IFsnYXQnLCdjaCcsJ2RlJ107CiAgICBjb3VudHJ5TGFuZ01hcC5hciA9IFsnZW1lYV9taWRkbGVfZWFzdCddOwogICAgY291bnRyeUxhbmdNYXAuY3MgPSBbJ2N6J107CiAgICBjb3VudHJ5TGFuZ01hcC5kYSA9IFsnZGsnXTsKICAgIGNvdW50cnlMYW5nTWFwLmVsID0gWydnciddOwogICAgY291bnRyeUxhbmdNYXAuZmkgPSBbJ2ZpJ107CiAgICBjb3VudHJ5TGFuZ01hcC5mciA9IFsnYmUnLCdjYScsJ2NoJywnZW1lYV9hZnJpY2EnLCdmciddOwogICAgY291bnRyeUxhbmdNYXAuaGUgPSBbJ2lsJ107CiAgICBjb3VudHJ5TGFuZ01hcC5odSA9IFsnaHUnXTsKICAgIGNvdW50cnlMYW5nTWFwLml0ID0gWydpdCddOwogICAgY291bnRyeUxhbmdNYXAuamEgPSBbJ2pwJ107CiAgICBjb3VudHJ5TGFuZ01hcC5rbyA9IFsna3InXTsKICAgIGNvdW50cnlMYW5nTWFwLmhlID0gWydpbCddOwogICAgY291bnRyeUxhbmdNYXAubmwgPSBbJ2JlJywnbmwnXTsKICAgIGNvdW50cnlMYW5nTWFwLm5vID0gWydubyddOwogICAgY291bnRyeUxhbmdNYXAucGwgPSBbJ3BsJ107CiAgICBjb3VudHJ5TGFuZ01hcC5wdCA9IFsnYnInLCdwdCddOwogICAgY291bnRyeUxhbmdNYXAucnUgPSBbJ2J5Jywna3onLCdydScsJ3VhJ107CiAgICBjb3VudHJ5TGFuZ01hcC5zdiA9IFsnc2UnXTsKICAgIGNvdW50cnlMYW5nTWFwLnRoID0gWyd0aCddOwogICAgY291bnRyeUxhbmdNYXAudHIgPSBbJ3RyJ107CiAgICBjb3VudHJ5TGFuZ01hcC56aCA9IFsnY24nLCdoaycsJ3R3J107CgogICAgICAgICQuZWFjaChjb3VudHJ5TGFuZ01hcCwgZnVuY3Rpb24oayx2KXsKICAgICAgICBpZih2LmluZGV4T2Yoc2VsZWN0ZWRjYykgIT09IC0xKXsKICAgICAgICAgICAgbGFuZ21hdGNoID0gazsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vcmV0dXJuIGRlZmF1bHQgImVuIiBpZiBzZWxlY3RlZGNjIGRvZXMgbm90IGhhdmUgYSBsYW5ndWFnZSBtYXRjaAogICAgaWYgKGxhbmdtYXRjaCAhPT0gIiIpewogICAgICAgIHJldHVybiBsYW5nbWF0Y2g7CiAgICB9IGVsc2V7CiAgICAgICAgcmV0dXJuICJlbiI7CiAgICB9Cgp9CgpmdW5jdGlvbiBnZXRFbnZyaW9ubWVudCgpewogICAgbGV0IGVhc0hvc3QgPSAiIjsKICAgIGxldCBoID0gIiI7CiAgICB0cnl7CiAgICAgICAgaCA9IGxvY2F0aW9uLmhvc3Q7CiAgICB9Y2F0Y2goZSl7fQoKICAgIGlmKC9sb2NhbGhvc3QvLnRlc3QoaCkpewogICAgICAgIGVhc0hvc3QgPSAiaHR0cHM6Ly9zdXBwb3J0LmhwLmNvbSI7CiAgICB9ZWxzZSBpZiAoL3VhdC8udGVzdChoKSl7CiAgICAgICAgZWFzSG9zdCA9ICJodHRwczovL3VhdC5zdXBwb3J0LmhwLmNvbSI7CiAgICB9ZWxzZXsKICAgICAgICBlYXNIb3N0ID0gImh0dHBzOi8vc3VwcG9ydC5ocC5jb20iOwogICAgfQogICAgcmV0dXJuIGVhc0hvc3Q7Cn0KCiQoZG9jdW1lbnQpLm9uKCJjbGljayIsICIuZWFzLWZvcm1CdXR0b24iLCBmdW5jdGlvbigpewogICAgdHJ5ewogICAgICAgIHZhciBmaWRWYWwgPSAkKCIjZmFpbHVyZUlkIikudmFsKCkgPyAkKCIjZmFpbHVyZUlkIikudmFsKCk6ICIiOwogICAgICAgIHZhciBwTm9WYWwgPSAkKCIjcHJvZHVjdE5vIikudmFsKCkgPyAkKCIjcHJvZHVjdE5vIikudmFsKCk6ICIiOwogICAgICAgIHZhciBsb2NWYWwgPSAkKCIjdXNlckNvdW50cnlDb2RlIG9wdGlvbiIpLmZpbHRlcigiOnNlbGVjdGVkIikudmFsKCk7CiAgICAgICAgdmFyIGVhc0xpbmtIb3N0ID0gZ2V0RW52cmlvbm1lbnQoKTsKICAgICAgICB2YXIgZWFzQ0NMQyA9IGxvY1ZhbCArICItIiArIHN1cHBvcnRlZExhbmdzKGxvY1ZhbCk7CiAgICAgICAgdmFyIGVhc0xpbmtCYXNlID0gIi9lYXMvZmFpbHVyZWlkPyI7CiAgICAgICAgdmFyIGVhc0xpbmsgPSBlYXNMaW5rSG9zdCArICIvIiArIGVhc0NDTEMgKyBlYXNMaW5rQmFzZSArICJmYWlsdXJlSWQ9IiArIGZpZFZhbCArICImcHJvZHVjdE5vPSIgKyBwTm9WYWw7CiAgICAgICAgd2luZG93Lm9wZW4oZWFzTGluaywiX2JsYW5rIik7CiAgICB9Y2F0Y2goZSl7fQp9KTsKCgokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7CiAgICBzZXRDb3VudHJ5Q29udGV4dCgpOwogICAgZ2V0SHBTdHlsZUxpZ2h0RHJvcGRvd24oKTsKICAgIGluaXRFcnJvckhhbmRsZXJzKCk7Cn0pOwpmdW5jdGlvbiBzaG93SXRlbXMoKSB7CiAgJCgiLmRyb3Bkb3duLWNvbnRlbnQiKS50b2dnbGVDbGFzcygic2hvdyBoaWRkZW4iKTsKICAkKCIuaWNvbi10b2dnbGUiKS50b2dnbGVDbGFzcygnaWNvbi1kd24gaWNvbi11cCcpOwp9CgovLyBDbG9zZSB0aGUgZHJvcGRvd24gaWYgdGhlIHVzZXIgY2xpY2tzIG91dHNpZGUgb2YgaXQKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oZSkgewogICAgdHJ5IHsKICAgICAgICAvL2lmICghZS50YXJnZXQubWF0Y2hlcygnLmRyb3Bkb3duYnRuJykgJiYgIWUudGFyZ2V0Lm1hdGNoZXMoJy5sYWJlbCcpKSB7CiAgICAgIGlmICghZS50YXJnZXQubWF0Y2hlcygnLmRyb3Bkb3duYnRuJykgJiYgIWUudGFyZ2V0Lm1hdGNoZXMoJy5sYWJlbCcpICYmICFlLnRhcmdldC5tYXRjaGVzKCcuaWNvbi10b2dnbGUnKSkgewogICAgICAgIHZhciBkZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImRyb3Bkb3duLWNvbnRlbnQiKTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGRkW2ldLmNsYXNzTGlzdC5jb250YWlucygnc2hvdycpKSB7CiAgICAgICAgICAgICAgICAgICAgICBkZFtpXS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRkW2ldLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAkKCIuaWNvbi11cCIpLnJlbW92ZUNsYXNzKCJpY29uLXVwIikuYWRkQ2xhc3MoImljb24tZHduIik7CiAgICAgIH0KCX0gY2F0Y2ggKGVycm9yKSB7CiAgCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgfQp9KTsKLyoKIENvcHlyaWdodCAoQykgRmVkZXJpY28gWml2b2xvIDIwMjAKIERpc3RyaWJ1dGVkIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAobGljZW5zZSB0ZXJtcyBhcmUgYXQgaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVCkuCiAqLyhmdW5jdGlvbihlLHQpeydvYmplY3QnPT10eXBlb2YgZXhwb3J0cyYmJ3VuZGVmaW5lZCchPXR5cGVvZiBtb2R1bGU/bW9kdWxlLmV4cG9ydHM9dCgpOidmdW5jdGlvbic9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKHQpOmUuUG9wcGVyPXQoKX0pKHRoaXMsZnVuY3Rpb24oKXsndXNlIHN0cmljdCc7ZnVuY3Rpb24gZShlKXtyZXR1cm4gZSYmJ1tvYmplY3QgRnVuY3Rpb25dJz09PXt9LnRvU3RyaW5nLmNhbGwoZSl9ZnVuY3Rpb24gdChlLHQpe2lmKDEhPT1lLm5vZGVUeXBlKXJldHVybltdO3ZhciBvPWUub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldyxuPW8uZ2V0Q29tcHV0ZWRTdHlsZShlLG51bGwpO3JldHVybiB0P25bdF06bn1mdW5jdGlvbiBvKGUpe3JldHVybidIVE1MJz09PWUubm9kZU5hbWU/ZTplLnBhcmVudE5vZGV8fGUuaG9zdH1mdW5jdGlvbiBuKGUpe2lmKCFlKXJldHVybiBkb2N1bWVudC5ib2R5O3N3aXRjaChlLm5vZGVOYW1lKXtjYXNlJ0hUTUwnOmNhc2UnQk9EWSc6cmV0dXJuIGUub3duZXJEb2N1bWVudC5ib2R5O2Nhc2UnI2RvY3VtZW50JzpyZXR1cm4gZS5ib2R5O312YXIgaT10KGUpLHI9aS5vdmVyZmxvdyxwPWkub3ZlcmZsb3dYLHM9aS5vdmVyZmxvd1k7cmV0dXJuIC8oYXV0b3xzY3JvbGx8b3ZlcmxheSkvLnRlc3QocitzK3ApP2U6bihvKGUpKX1mdW5jdGlvbiBpKGUpe3JldHVybiBlJiZlLnJlZmVyZW5jZU5vZGU/ZS5yZWZlcmVuY2VOb2RlOmV9ZnVuY3Rpb24gcihlKXtyZXR1cm4gMTE9PT1lP3JlOjEwPT09ZT9wZTpyZXx8cGV9ZnVuY3Rpb24gcChlKXtpZighZSlyZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O2Zvcih2YXIgbz1yKDEwKT9kb2N1bWVudC5ib2R5Om51bGwsbj1lLm9mZnNldFBhcmVudHx8bnVsbDtuPT09byYmZS5uZXh0RWxlbWVudFNpYmxpbmc7KW49KGU9ZS5uZXh0RWxlbWVudFNpYmxpbmcpLm9mZnNldFBhcmVudDt2YXIgaT1uJiZuLm5vZGVOYW1lO3JldHVybiBpJiYnQk9EWSchPT1pJiYnSFRNTCchPT1pPy0xIT09WydUSCcsJ1REJywnVEFCTEUnXS5pbmRleE9mKG4ubm9kZU5hbWUpJiYnc3RhdGljJz09PXQobiwncG9zaXRpb24nKT9wKG4pOm46ZT9lLm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OmRvY3VtZW50LmRvY3VtZW50RWxlbWVudH1mdW5jdGlvbiBzKGUpe3ZhciB0PWUubm9kZU5hbWU7cmV0dXJuJ0JPRFknIT09dCYmKCdIVE1MJz09PXR8fHAoZS5maXJzdEVsZW1lbnRDaGlsZCk9PT1lKX1mdW5jdGlvbiBkKGUpe3JldHVybiBudWxsPT09ZS5wYXJlbnROb2RlP2U6ZChlLnBhcmVudE5vZGUpfWZ1bmN0aW9uIGEoZSx0KXtpZighZXx8IWUubm9kZVR5cGV8fCF0fHwhdC5ub2RlVHlwZSlyZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O3ZhciBvPWUuY29tcGFyZURvY3VtZW50UG9zaXRpb24odCkmTm9kZS5ET0NVTUVOVF9QT1NJVElPTl9GT0xMT1dJTkcsbj1vP2U6dCxpPW8/dDplLHI9ZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtyLnNldFN0YXJ0KG4sMCksci5zZXRFbmQoaSwwKTt2YXIgbD1yLmNvbW1vbkFuY2VzdG9yQ29udGFpbmVyO2lmKGUhPT1sJiZ0IT09bHx8bi5jb250YWlucyhpKSlyZXR1cm4gcyhsKT9sOnAobCk7dmFyIGY9ZChlKTtyZXR1cm4gZi5ob3N0P2EoZi5ob3N0LHQpOmEoZSxkKHQpLmhvc3QpfWZ1bmN0aW9uIGwoZSl7dmFyIHQ9MTxhcmd1bWVudHMubGVuZ3RoJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOid0b3AnLG89J3RvcCc9PT10PydzY3JvbGxUb3AnOidzY3JvbGxMZWZ0JyxuPWUubm9kZU5hbWU7aWYoJ0JPRFknPT09bnx8J0hUTUwnPT09bil7dmFyIGk9ZS5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxyPWUub3duZXJEb2N1bWVudC5zY3JvbGxpbmdFbGVtZW50fHxpO3JldHVybiByW29dfXJldHVybiBlW29dfWZ1bmN0aW9uIGYoZSx0KXt2YXIgbz0yPGFyZ3VtZW50cy5sZW5ndGgmJnZvaWQgMCE9PWFyZ3VtZW50c1syXSYmYXJndW1lbnRzWzJdLG49bCh0LCd0b3AnKSxpPWwodCwnbGVmdCcpLHI9bz8tMToxO3JldHVybiBlLnRvcCs9bipyLGUuYm90dG9tKz1uKnIsZS5sZWZ0Kz1pKnIsZS5yaWdodCs9aSpyLGV9ZnVuY3Rpb24gbShlLHQpe3ZhciBvPSd4Jz09PXQ/J0xlZnQnOidUb3AnLG49J0xlZnQnPT1vPydSaWdodCc6J0JvdHRvbSc7cmV0dXJuIHBhcnNlRmxvYXQoZVsnYm9yZGVyJytvKydXaWR0aCddKStwYXJzZUZsb2F0KGVbJ2JvcmRlcicrbisnV2lkdGgnXSl9ZnVuY3Rpb24gaChlLHQsbyxuKXtyZXR1cm4gZWUodFsnb2Zmc2V0JytlXSx0WydzY3JvbGwnK2VdLG9bJ2NsaWVudCcrZV0sb1snb2Zmc2V0JytlXSxvWydzY3JvbGwnK2VdLHIoMTApP3BhcnNlSW50KG9bJ29mZnNldCcrZV0pK3BhcnNlSW50KG5bJ21hcmdpbicrKCdIZWlnaHQnPT09ZT8nVG9wJzonTGVmdCcpXSkrcGFyc2VJbnQoblsnbWFyZ2luJysoJ0hlaWdodCc9PT1lPydCb3R0b20nOidSaWdodCcpXSk6MCl9ZnVuY3Rpb24gYyhlKXt2YXIgdD1lLmJvZHksbz1lLmRvY3VtZW50RWxlbWVudCxuPXIoMTApJiZnZXRDb21wdXRlZFN0eWxlKG8pO3JldHVybntoZWlnaHQ6aCgnSGVpZ2h0Jyx0LG8sbiksd2lkdGg6aCgnV2lkdGgnLHQsbyxuKX19ZnVuY3Rpb24gZyhlKXtyZXR1cm4gbGUoe30sZSx7cmlnaHQ6ZS5sZWZ0K2Uud2lkdGgsYm90dG9tOmUudG9wK2UuaGVpZ2h0fSl9ZnVuY3Rpb24gdShlKXt2YXIgbz17fTt0cnl7aWYocigxMCkpe289ZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTt2YXIgbj1sKGUsJ3RvcCcpLGk9bChlLCdsZWZ0Jyk7by50b3ArPW4sby5sZWZ0Kz1pLG8uYm90dG9tKz1uLG8ucmlnaHQrPWl9ZWxzZSBvPWUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCl9Y2F0Y2godCl7fXZhciBwPXtsZWZ0Om8ubGVmdCx0b3A6by50b3Asd2lkdGg6by5yaWdodC1vLmxlZnQsaGVpZ2h0Om8uYm90dG9tLW8udG9wfSxzPSdIVE1MJz09PWUubm9kZU5hbWU/YyhlLm93bmVyRG9jdW1lbnQpOnt9LGQ9cy53aWR0aHx8ZS5jbGllbnRXaWR0aHx8cC53aWR0aCxhPXMuaGVpZ2h0fHxlLmNsaWVudEhlaWdodHx8cC5oZWlnaHQsZj1lLm9mZnNldFdpZHRoLWQsaD1lLm9mZnNldEhlaWdodC1hO2lmKGZ8fGgpe3ZhciB1PXQoZSk7Zi09bSh1LCd4JyksaC09bSh1LCd5JykscC53aWR0aC09ZixwLmhlaWdodC09aH1yZXR1cm4gZyhwKX1mdW5jdGlvbiBiKGUsbyl7dmFyIGk9Mjxhcmd1bWVudHMubGVuZ3RoJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0mJmFyZ3VtZW50c1syXSxwPXIoMTApLHM9J0hUTUwnPT09by5ub2RlTmFtZSxkPXUoZSksYT11KG8pLGw9bihlKSxtPXQobyksaD1wYXJzZUZsb2F0KG0uYm9yZGVyVG9wV2lkdGgpLGM9cGFyc2VGbG9hdChtLmJvcmRlckxlZnRXaWR0aCk7aSYmcyYmKGEudG9wPWVlKGEudG9wLDApLGEubGVmdD1lZShhLmxlZnQsMCkpO3ZhciBiPWcoe3RvcDpkLnRvcC1hLnRvcC1oLGxlZnQ6ZC5sZWZ0LWEubGVmdC1jLHdpZHRoOmQud2lkdGgsaGVpZ2h0OmQuaGVpZ2h0fSk7aWYoYi5tYXJnaW5Ub3A9MCxiLm1hcmdpbkxlZnQ9MCwhcCYmcyl7dmFyIHc9cGFyc2VGbG9hdChtLm1hcmdpblRvcCkseT1wYXJzZUZsb2F0KG0ubWFyZ2luTGVmdCk7Yi50b3AtPWgtdyxiLmJvdHRvbS09aC13LGIubGVmdC09Yy15LGIucmlnaHQtPWMteSxiLm1hcmdpblRvcD13LGIubWFyZ2luTGVmdD15fXJldHVybihwJiYhaT9vLmNvbnRhaW5zKGwpOm89PT1sJiYnQk9EWSchPT1sLm5vZGVOYW1lKSYmKGI9ZihiLG8pKSxifWZ1bmN0aW9uIHcoZSl7dmFyIHQ9MTxhcmd1bWVudHMubGVuZ3RoJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0mJmFyZ3VtZW50c1sxXSxvPWUub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsbj1iKGUsbyksaT1lZShvLmNsaWVudFdpZHRoLHdpbmRvdy5pbm5lcldpZHRofHwwKSxyPWVlKG8uY2xpZW50SGVpZ2h0LHdpbmRvdy5pbm5lckhlaWdodHx8MCkscD10PzA6bChvKSxzPXQ/MDpsKG8sJ2xlZnQnKSxkPXt0b3A6cC1uLnRvcCtuLm1hcmdpblRvcCxsZWZ0OnMtbi5sZWZ0K24ubWFyZ2luTGVmdCx3aWR0aDppLGhlaWdodDpyfTtyZXR1cm4gZyhkKX1mdW5jdGlvbiB5KGUpe3ZhciBuPWUubm9kZU5hbWU7aWYoJ0JPRFknPT09bnx8J0hUTUwnPT09bilyZXR1cm4hMTtpZignZml4ZWQnPT09dChlLCdwb3NpdGlvbicpKXJldHVybiEwO3ZhciBpPW8oZSk7cmV0dXJuISFpJiZ5KGkpfWZ1bmN0aW9uIEUoZSl7aWYoIWV8fCFlLnBhcmVudEVsZW1lbnR8fHIoKSlyZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O2Zvcih2YXIgbz1lLnBhcmVudEVsZW1lbnQ7byYmJ25vbmUnPT09dChvLCd0cmFuc2Zvcm0nKTspbz1vLnBhcmVudEVsZW1lbnQ7cmV0dXJuIG98fGRvY3VtZW50LmRvY3VtZW50RWxlbWVudH1mdW5jdGlvbiB2KGUsdCxyLHApe3ZhciBzPTQ8YXJndW1lbnRzLmxlbmd0aCYmdm9pZCAwIT09YXJndW1lbnRzWzRdJiZhcmd1bWVudHNbNF0sZD17dG9wOjAsbGVmdDowfSxsPXM/RShlKTphKGUsaSh0KSk7aWYoJ3ZpZXdwb3J0Jz09PXApZD13KGwscyk7ZWxzZXt2YXIgZjsnc2Nyb2xsUGFyZW50Jz09PXA/KGY9bihvKHQpKSwnQk9EWSc9PT1mLm5vZGVOYW1lJiYoZj1lLm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSk6J3dpbmRvdyc9PT1wP2Y9ZS5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudDpmPXA7dmFyIG09YihmLGwscyk7aWYoJ0hUTUwnPT09Zi5ub2RlTmFtZSYmIXkobCkpe3ZhciBoPWMoZS5vd25lckRvY3VtZW50KSxnPWguaGVpZ2h0LHU9aC53aWR0aDtkLnRvcCs9bS50b3AtbS5tYXJnaW5Ub3AsZC5ib3R0b209ZyttLnRvcCxkLmxlZnQrPW0ubGVmdC1tLm1hcmdpbkxlZnQsZC5yaWdodD11K20ubGVmdH1lbHNlIGQ9bX1yPXJ8fDA7dmFyIHY9J251bWJlcic9PXR5cGVvZiByO3JldHVybiBkLmxlZnQrPXY/cjpyLmxlZnR8fDAsZC50b3ArPXY/cjpyLnRvcHx8MCxkLnJpZ2h0LT12P3I6ci5yaWdodHx8MCxkLmJvdHRvbS09dj9yOnIuYm90dG9tfHwwLGR9ZnVuY3Rpb24geChlKXt2YXIgdD1lLndpZHRoLG89ZS5oZWlnaHQ7cmV0dXJuIHQqb31mdW5jdGlvbiBPKGUsdCxvLG4saSl7dmFyIHI9NTxhcmd1bWVudHMubGVuZ3RoJiZ2b2lkIDAhPT1hcmd1bWVudHNbNV0/YXJndW1lbnRzWzVdOjA7aWYoLTE9PT1lLmluZGV4T2YoJ2F1dG8nKSlyZXR1cm4gZTt2YXIgcD12KG8sbixyLGkpLHM9e3RvcDp7d2lkdGg6cC53aWR0aCxoZWlnaHQ6dC50b3AtcC50b3B9LHJpZ2h0Ont3aWR0aDpwLnJpZ2h0LXQucmlnaHQsaGVpZ2h0OnAuaGVpZ2h0fSxib3R0b206e3dpZHRoOnAud2lkdGgsaGVpZ2h0OnAuYm90dG9tLXQuYm90dG9tfSxsZWZ0Ont3aWR0aDp0LmxlZnQtcC5sZWZ0LGhlaWdodDpwLmhlaWdodH19LGQ9T2JqZWN0LmtleXMocykubWFwKGZ1bmN0aW9uKGUpe3JldHVybiBsZSh7a2V5OmV9LHNbZV0se2FyZWE6eChzW2VdKX0pfSkuc29ydChmdW5jdGlvbihlLHQpe3JldHVybiB0LmFyZWEtZS5hcmVhfSksYT1kLmZpbHRlcihmdW5jdGlvbihlKXt2YXIgdD1lLndpZHRoLG49ZS5oZWlnaHQ7cmV0dXJuIHQ+PW8uY2xpZW50V2lkdGgmJm4+PW8uY2xpZW50SGVpZ2h0fSksbD0wPGEubGVuZ3RoP2FbMF0ua2V5OmRbMF0ua2V5LGY9ZS5zcGxpdCgnLScpWzFdO3JldHVybiBsKyhmPyctJytmOicnKX1mdW5jdGlvbiBMKGUsdCxvKXt2YXIgbj0zPGFyZ3VtZW50cy5sZW5ndGgmJnZvaWQgMCE9PWFyZ3VtZW50c1szXT9hcmd1bWVudHNbM106bnVsbCxyPW4/RSh0KTphKHQsaShvKSk7cmV0dXJuIGIobyxyLG4pfWZ1bmN0aW9uIFMoZSl7dmFyIHQ9ZS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LG89dC5nZXRDb21wdXRlZFN0eWxlKGUpLG49cGFyc2VGbG9hdChvLm1hcmdpblRvcHx8MCkrcGFyc2VGbG9hdChvLm1hcmdpbkJvdHRvbXx8MCksaT1wYXJzZUZsb2F0KG8ubWFyZ2luTGVmdHx8MCkrcGFyc2VGbG9hdChvLm1hcmdpblJpZ2h0fHwwKSxyPXt3aWR0aDplLm9mZnNldFdpZHRoK2ksaGVpZ2h0OmUub2Zmc2V0SGVpZ2h0K259O3JldHVybiByfWZ1bmN0aW9uIFQoZSl7dmFyIHQ9e2xlZnQ6J3JpZ2h0JyxyaWdodDonbGVmdCcsYm90dG9tOid0b3AnLHRvcDonYm90dG9tJ307cmV0dXJuIGUucmVwbGFjZSgvbGVmdHxyaWdodHxib3R0b218dG9wL2csZnVuY3Rpb24oZSl7cmV0dXJuIHRbZV19KX1mdW5jdGlvbiBDKGUsdCxvKXtvPW8uc3BsaXQoJy0nKVswXTt2YXIgbj1TKGUpLGk9e3dpZHRoOm4ud2lkdGgsaGVpZ2h0Om4uaGVpZ2h0fSxyPS0xIT09WydyaWdodCcsJ2xlZnQnXS5pbmRleE9mKG8pLHA9cj8ndG9wJzonbGVmdCcscz1yPydsZWZ0JzondG9wJyxkPXI/J2hlaWdodCc6J3dpZHRoJyxhPXI/J3dpZHRoJzonaGVpZ2h0JztyZXR1cm4gaVtwXT10W3BdK3RbZF0vMi1uW2RdLzIsaVtzXT1vPT09cz90W3NdLW5bYV06dFtUKHMpXSxpfWZ1bmN0aW9uIEQoZSx0KXtyZXR1cm4gQXJyYXkucHJvdG90eXBlLmZpbmQ/ZS5maW5kKHQpOmUuZmlsdGVyKHQpWzBdfWZ1bmN0aW9uIE4oZSx0LG8pe2lmKEFycmF5LnByb3RvdHlwZS5maW5kSW5kZXgpcmV0dXJuIGUuZmluZEluZGV4KGZ1bmN0aW9uKGUpe3JldHVybiBlW3RdPT09b30pO3ZhciBuPUQoZSxmdW5jdGlvbihlKXtyZXR1cm4gZVt0XT09PW99KTtyZXR1cm4gZS5pbmRleE9mKG4pfWZ1bmN0aW9uIFAodCxvLG4pe3ZhciBpPXZvaWQgMD09PW4/dDp0LnNsaWNlKDAsTih0LCduYW1lJyxuKSk7cmV0dXJuIGkuZm9yRWFjaChmdW5jdGlvbih0KXt0WydmdW5jdGlvbiddJiZjb25zb2xlLndhcm4oJ2Btb2RpZmllci5mdW5jdGlvbmAgaXMgZGVwcmVjYXRlZCwgdXNlIGBtb2RpZmllci5mbmAhJyk7dmFyIG49dFsnZnVuY3Rpb24nXXx8dC5mbjt0LmVuYWJsZWQmJmUobikmJihvLm9mZnNldHMucG9wcGVyPWcoby5vZmZzZXRzLnBvcHBlciksby5vZmZzZXRzLnJlZmVyZW5jZT1nKG8ub2Zmc2V0cy5yZWZlcmVuY2UpLG89bihvLHQpKX0pLG99ZnVuY3Rpb24gaygpe2lmKCF0aGlzLnN0YXRlLmlzRGVzdHJveWVkKXt2YXIgZT17aW5zdGFuY2U6dGhpcyxzdHlsZXM6e30sYXJyb3dTdHlsZXM6e30sYXR0cmlidXRlczp7fSxmbGlwcGVkOiExLG9mZnNldHM6e319O2Uub2Zmc2V0cy5yZWZlcmVuY2U9TCh0aGlzLnN0YXRlLHRoaXMucG9wcGVyLHRoaXMucmVmZXJlbmNlLHRoaXMub3B0aW9ucy5wb3NpdGlvbkZpeGVkKSxlLnBsYWNlbWVudD1PKHRoaXMub3B0aW9ucy5wbGFjZW1lbnQsZS5vZmZzZXRzLnJlZmVyZW5jZSx0aGlzLnBvcHBlcix0aGlzLnJlZmVyZW5jZSx0aGlzLm9wdGlvbnMubW9kaWZpZXJzLmZsaXAuYm91bmRhcmllc0VsZW1lbnQsdGhpcy5vcHRpb25zLm1vZGlmaWVycy5mbGlwLnBhZGRpbmcpLGUub3JpZ2luYWxQbGFjZW1lbnQ9ZS5wbGFjZW1lbnQsZS5wb3NpdGlvbkZpeGVkPXRoaXMub3B0aW9ucy5wb3NpdGlvbkZpeGVkLGUub2Zmc2V0cy5wb3BwZXI9Qyh0aGlzLnBvcHBlcixlLm9mZnNldHMucmVmZXJlbmNlLGUucGxhY2VtZW50KSxlLm9mZnNldHMucG9wcGVyLnBvc2l0aW9uPXRoaXMub3B0aW9ucy5wb3NpdGlvbkZpeGVkPydmaXhlZCc6J2Fic29sdXRlJyxlPVAodGhpcy5tb2RpZmllcnMsZSksdGhpcy5zdGF0ZS5pc0NyZWF0ZWQ/dGhpcy5vcHRpb25zLm9uVXBkYXRlKGUpOih0aGlzLnN0YXRlLmlzQ3JlYXRlZD0hMCx0aGlzLm9wdGlvbnMub25DcmVhdGUoZSkpfX1mdW5jdGlvbiBXKGUsdCl7cmV0dXJuIGUuc29tZShmdW5jdGlvbihlKXt2YXIgbz1lLm5hbWUsbj1lLmVuYWJsZWQ7cmV0dXJuIG4mJm89PT10fSl9ZnVuY3Rpb24gQihlKXtmb3IodmFyIHQ9WyExLCdtcycsJ1dlYmtpdCcsJ01veicsJ08nXSxvPWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrZS5zbGljZSgxKSxuPTA7bjx0Lmxlbmd0aDtuKyspe3ZhciBpPXRbbl0scj1pPycnK2krbzplO2lmKCd1bmRlZmluZWQnIT10eXBlb2YgZG9jdW1lbnQuYm9keS5zdHlsZVtyXSlyZXR1cm4gcn1yZXR1cm4gbnVsbH1mdW5jdGlvbiBIKCl7cmV0dXJuIHRoaXMuc3RhdGUuaXNEZXN0cm95ZWQ9ITAsVyh0aGlzLm1vZGlmaWVycywnYXBwbHlTdHlsZScpJiYodGhpcy5wb3BwZXIucmVtb3ZlQXR0cmlidXRlKCd4LXBsYWNlbWVudCcpLHRoaXMucG9wcGVyLnN0eWxlLnBvc2l0aW9uPScnLHRoaXMucG9wcGVyLnN0eWxlLnRvcD0nJyx0aGlzLnBvcHBlci5zdHlsZS5sZWZ0PScnLHRoaXMucG9wcGVyLnN0eWxlLnJpZ2h0PScnLHRoaXMucG9wcGVyLnN0eWxlLmJvdHRvbT0nJyx0aGlzLnBvcHBlci5zdHlsZS53aWxsQ2hhbmdlPScnLHRoaXMucG9wcGVyLnN0eWxlW0IoJ3RyYW5zZm9ybScpXT0nJyksdGhpcy5kaXNhYmxlRXZlbnRMaXN0ZW5lcnMoKSx0aGlzLm9wdGlvbnMucmVtb3ZlT25EZXN0cm95JiZ0aGlzLnBvcHBlci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucG9wcGVyKSx0aGlzfWZ1bmN0aW9uIEEoZSl7dmFyIHQ9ZS5vd25lckRvY3VtZW50O3JldHVybiB0P3QuZGVmYXVsdFZpZXc6d2luZG93fWZ1bmN0aW9uIE0oZSx0LG8saSl7dmFyIHI9J0JPRFknPT09ZS5ub2RlTmFtZSxwPXI/ZS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3OmU7cC5hZGRFdmVudExpc3RlbmVyKHQsbyx7cGFzc2l2ZTohMH0pLHJ8fE0obihwLnBhcmVudE5vZGUpLHQsbyxpKSxpLnB1c2gocCl9ZnVuY3Rpb24gRihlLHQsbyxpKXtvLnVwZGF0ZUJvdW5kPWksQShlKS5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLG8udXBkYXRlQm91bmQse3Bhc3NpdmU6ITB9KTt2YXIgcj1uKGUpO3JldHVybiBNKHIsJ3Njcm9sbCcsby51cGRhdGVCb3VuZCxvLnNjcm9sbFBhcmVudHMpLG8uc2Nyb2xsRWxlbWVudD1yLG8uZXZlbnRzRW5hYmxlZD0hMCxvfWZ1bmN0aW9uIEkoKXt0aGlzLnN0YXRlLmV2ZW50c0VuYWJsZWR8fCh0aGlzLnN0YXRlPUYodGhpcy5yZWZlcmVuY2UsdGhpcy5vcHRpb25zLHRoaXMuc3RhdGUsdGhpcy5zY2hlZHVsZVVwZGF0ZSkpfWZ1bmN0aW9uIFIoZSx0KXtyZXR1cm4gQShlKS5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLHQudXBkYXRlQm91bmQpLHQuc2Nyb2xsUGFyZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGUpe2UucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJyx0LnVwZGF0ZUJvdW5kKX0pLHQudXBkYXRlQm91bmQ9bnVsbCx0LnNjcm9sbFBhcmVudHM9W10sdC5zY3JvbGxFbGVtZW50PW51bGwsdC5ldmVudHNFbmFibGVkPSExLHR9ZnVuY3Rpb24gVSgpe3RoaXMuc3RhdGUuZXZlbnRzRW5hYmxlZCYmKGNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuc2NoZWR1bGVVcGRhdGUpLHRoaXMuc3RhdGU9Uih0aGlzLnJlZmVyZW5jZSx0aGlzLnN0YXRlKSl9ZnVuY3Rpb24gWShlKXtyZXR1cm4nJyE9PWUmJiFpc05hTihwYXJzZUZsb2F0KGUpKSYmaXNGaW5pdGUoZSl9ZnVuY3Rpb24gVihlLHQpe09iamVjdC5rZXlzKHQpLmZvckVhY2goZnVuY3Rpb24obyl7dmFyIG49Jyc7LTEhPT1bJ3dpZHRoJywnaGVpZ2h0JywndG9wJywncmlnaHQnLCdib3R0b20nLCdsZWZ0J10uaW5kZXhPZihvKSYmWSh0W29dKSYmKG49J3B4JyksZS5zdHlsZVtvXT10W29dK259KX1mdW5jdGlvbiBqKGUsdCl7T2JqZWN0LmtleXModCkuZm9yRWFjaChmdW5jdGlvbihvKXt2YXIgbj10W29dOyExPT09bj9lLnJlbW92ZUF0dHJpYnV0ZShvKTplLnNldEF0dHJpYnV0ZShvLHRbb10pfSl9ZnVuY3Rpb24gcShlLHQpe3ZhciBvPWUub2Zmc2V0cyxuPW8ucG9wcGVyLGk9by5yZWZlcmVuY2Uscj0kLHA9ZnVuY3Rpb24oZSl7cmV0dXJuIGV9LHM9cihpLndpZHRoKSxkPXIobi53aWR0aCksYT0tMSE9PVsnbGVmdCcsJ3JpZ2h0J10uaW5kZXhPZihlLnBsYWNlbWVudCksbD0tMSE9PWUucGxhY2VtZW50LmluZGV4T2YoJy0nKSxmPXQ/YXx8bHx8cyUyPT1kJTI/cjpaOnAsbT10P3I6cDtyZXR1cm57bGVmdDpmKDE9PXMlMiYmMT09ZCUyJiYhbCYmdD9uLmxlZnQtMTpuLmxlZnQpLHRvcDptKG4udG9wKSxib3R0b206bShuLmJvdHRvbSkscmlnaHQ6ZihuLnJpZ2h0KX19ZnVuY3Rpb24gSyhlLHQsbyl7dmFyIG49RChlLGZ1bmN0aW9uKGUpe3ZhciBvPWUubmFtZTtyZXR1cm4gbz09PXR9KSxpPSEhbiYmZS5zb21lKGZ1bmN0aW9uKGUpe3JldHVybiBlLm5hbWU9PT1vJiZlLmVuYWJsZWQmJmUub3JkZXI8bi5vcmRlcn0pO2lmKCFpKXt2YXIgcj0nYCcrdCsnYCc7Y29uc29sZS53YXJuKCdgJytvKydgJysnIG1vZGlmaWVyIGlzIHJlcXVpcmVkIGJ5ICcrcisnIG1vZGlmaWVyIGluIG9yZGVyIHRvIHdvcmssIGJlIHN1cmUgdG8gaW5jbHVkZSBpdCBiZWZvcmUgJytyKychJyl9cmV0dXJuIGl9ZnVuY3Rpb24geihlKXtyZXR1cm4nZW5kJz09PWU/J3N0YXJ0Jzonc3RhcnQnPT09ZT8nZW5kJzplfWZ1bmN0aW9uIEcoZSl7dmFyIHQ9MTxhcmd1bWVudHMubGVuZ3RoJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0mJmFyZ3VtZW50c1sxXSxvPWhlLmluZGV4T2YoZSksbj1oZS5zbGljZShvKzEpLmNvbmNhdChoZS5zbGljZSgwLG8pKTtyZXR1cm4gdD9uLnJldmVyc2UoKTpufWZ1bmN0aW9uIF8oZSx0LG8sbil7dmFyIGk9ZS5tYXRjaCgvKCg/OlwtfFwrKT9cZCpcLj9cZCopKC4qKS8pLHI9K2lbMV0scD1pWzJdO2lmKCFyKXJldHVybiBlO2lmKDA9PT1wLmluZGV4T2YoJyUnKSl7dmFyIHM7c3dpdGNoKHApe2Nhc2UnJXAnOnM9bzticmVhaztjYXNlJyUnOmNhc2UnJXInOmRlZmF1bHQ6cz1uO312YXIgZD1nKHMpO3JldHVybiBkW3RdLzEwMCpyfWlmKCd2aCc9PT1wfHwndncnPT09cCl7dmFyIGE7cmV0dXJuIGE9J3ZoJz09PXA/ZWUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCx3aW5kb3cuaW5uZXJIZWlnaHR8fDApOmVlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCx3aW5kb3cuaW5uZXJXaWR0aHx8MCksYS8xMDAqcn1yZXR1cm4gcn1mdW5jdGlvbiBYKGUsdCxvLG4pe3ZhciBpPVswLDBdLHI9LTEhPT1bJ3JpZ2h0JywnbGVmdCddLmluZGV4T2YobikscD1lLnNwbGl0KC8oXCt8XC0pLykubWFwKGZ1bmN0aW9uKGUpe3JldHVybiBlLnRyaW0oKX0pLHM9cC5pbmRleE9mKEQocCxmdW5jdGlvbihlKXtyZXR1cm4tMSE9PWUuc2VhcmNoKC8sfFxzLyl9KSk7cFtzXSYmLTE9PT1wW3NdLmluZGV4T2YoJywnKSYmY29uc29sZS53YXJuKCdPZmZzZXRzIHNlcGFyYXRlZCBieSB3aGl0ZSBzcGFjZShzKSBhcmUgZGVwcmVjYXRlZCwgdXNlIGEgY29tbWEgKCwpIGluc3RlYWQuJyk7dmFyIGQ9L1xzKixccyp8XHMrLyxhPS0xPT09cz9bcF06W3Auc2xpY2UoMCxzKS5jb25jYXQoW3Bbc10uc3BsaXQoZClbMF1dKSxbcFtzXS5zcGxpdChkKVsxXV0uY29uY2F0KHAuc2xpY2UocysxKSldO3JldHVybiBhPWEubWFwKGZ1bmN0aW9uKGUsbil7dmFyIGk9KDE9PT1uPyFyOnIpPydoZWlnaHQnOid3aWR0aCcscD0hMTtyZXR1cm4gZS5yZWR1Y2UoZnVuY3Rpb24oZSx0KXtyZXR1cm4nJz09PWVbZS5sZW5ndGgtMV0mJi0xIT09WycrJywnLSddLmluZGV4T2YodCk/KGVbZS5sZW5ndGgtMV09dCxwPSEwLGUpOnA/KGVbZS5sZW5ndGgtMV0rPXQscD0hMSxlKTplLmNvbmNhdCh0KX0sW10pLm1hcChmdW5jdGlvbihlKXtyZXR1cm4gXyhlLGksdCxvKX0pfSksYS5mb3JFYWNoKGZ1bmN0aW9uKGUsdCl7ZS5mb3JFYWNoKGZ1bmN0aW9uKG8sbil7WShvKSYmKGlbdF0rPW8qKCctJz09PWVbbi0xXT8tMToxKSl9KX0pLGl9ZnVuY3Rpb24gSihlLHQpe3ZhciBvLG49dC5vZmZzZXQsaT1lLnBsYWNlbWVudCxyPWUub2Zmc2V0cyxwPXIucG9wcGVyLHM9ci5yZWZlcmVuY2UsZD1pLnNwbGl0KCctJylbMF07cmV0dXJuIG89WSgrbik/WytuLDBdOlgobixwLHMsZCksJ2xlZnQnPT09ZD8ocC50b3ArPW9bMF0scC5sZWZ0LT1vWzFdKToncmlnaHQnPT09ZD8ocC50b3ArPW9bMF0scC5sZWZ0Kz1vWzFdKTondG9wJz09PWQ/KHAubGVmdCs9b1swXSxwLnRvcC09b1sxXSk6J2JvdHRvbSc9PT1kJiYocC5sZWZ0Kz1vWzBdLHAudG9wKz1vWzFdKSxlLnBvcHBlcj1wLGV9dmFyIFE9TWF0aC5taW4sWj1NYXRoLmZsb29yLCQ9TWF0aC5yb3VuZCxlZT1NYXRoLm1heCx0ZT0ndW5kZWZpbmVkJyE9dHlwZW9mIHdpbmRvdyYmJ3VuZGVmaW5lZCchPXR5cGVvZiBkb2N1bWVudCYmJ3VuZGVmaW5lZCchPXR5cGVvZiBuYXZpZ2F0b3Isb2U9ZnVuY3Rpb24oKXtmb3IodmFyIGU9WydFZGdlJywnVHJpZGVudCcsJ0ZpcmVmb3gnXSx0PTA7dDxlLmxlbmd0aDt0Kz0xKWlmKHRlJiYwPD1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoZVt0XSkpcmV0dXJuIDE7cmV0dXJuIDB9KCksbmU9dGUmJndpbmRvdy5Qcm9taXNlLGllPW5lP2Z1bmN0aW9uKGUpe3ZhciB0PSExO3JldHVybiBmdW5jdGlvbigpe3R8fCh0PSEwLHdpbmRvdy5Qcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCl7dD0hMSxlKCl9KSl9fTpmdW5jdGlvbihlKXt2YXIgdD0hMTtyZXR1cm4gZnVuY3Rpb24oKXt0fHwodD0hMCxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dD0hMSxlKCl9LG9lKSl9fSxyZT10ZSYmISEod2luZG93Lk1TSW5wdXRNZXRob2RDb250ZXh0JiZkb2N1bWVudC5kb2N1bWVudE1vZGUpLHBlPXRlJiYvTVNJRSAxMC8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSxzZT1mdW5jdGlvbihlLHQpe2lmKCEoZSBpbnN0YW5jZW9mIHQpKXRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpfSxkZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0KXtmb3IodmFyIG8sbj0wO248dC5sZW5ndGg7bisrKW89dFtuXSxvLmVudW1lcmFibGU9by5lbnVtZXJhYmxlfHwhMSxvLmNvbmZpZ3VyYWJsZT0hMCwndmFsdWUnaW4gbyYmKG8ud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLG8ua2V5LG8pfXJldHVybiBmdW5jdGlvbih0LG8sbil7cmV0dXJuIG8mJmUodC5wcm90b3R5cGUsbyksbiYmZSh0LG4pLHR9fSgpLGFlPWZ1bmN0aW9uKGUsdCxvKXtyZXR1cm4gdCBpbiBlP09iamVjdC5kZWZpbmVQcm9wZXJ0eShlLHQse3ZhbHVlOm8sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KTplW3RdPW8sZX0sbGU9T2JqZWN0LmFzc2lnbnx8ZnVuY3Rpb24oZSl7Zm9yKHZhciB0LG89MTtvPGFyZ3VtZW50cy5sZW5ndGg7bysrKWZvcih2YXIgbiBpbiB0PWFyZ3VtZW50c1tvXSx0KU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LG4pJiYoZVtuXT10W25dKTtyZXR1cm4gZX0sZmU9dGUmJi9GaXJlZm94L2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSxtZT1bJ2F1dG8tc3RhcnQnLCdhdXRvJywnYXV0by1lbmQnLCd0b3Atc3RhcnQnLCd0b3AnLCd0b3AtZW5kJywncmlnaHQtc3RhcnQnLCdyaWdodCcsJ3JpZ2h0LWVuZCcsJ2JvdHRvbS1lbmQnLCdib3R0b20nLCdib3R0b20tc3RhcnQnLCdsZWZ0LWVuZCcsJ2xlZnQnLCdsZWZ0LXN0YXJ0J10saGU9bWUuc2xpY2UoMyksY2U9e0ZMSVA6J2ZsaXAnLENMT0NLV0lTRTonY2xvY2t3aXNlJyxDT1VOVEVSQ0xPQ0tXSVNFOidjb3VudGVyY2xvY2t3aXNlJ30sZ2U9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KG8sbil7dmFyIGk9dGhpcyxyPTI8YXJndW1lbnRzLmxlbmd0aCYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTp7fTtzZSh0aGlzLHQpLHRoaXMuc2NoZWR1bGVVcGRhdGU9ZnVuY3Rpb24oKXtyZXR1cm4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGkudXBkYXRlKX0sdGhpcy51cGRhdGU9aWUodGhpcy51cGRhdGUuYmluZCh0aGlzKSksdGhpcy5vcHRpb25zPWxlKHt9LHQuRGVmYXVsdHMsciksdGhpcy5zdGF0ZT17aXNEZXN0cm95ZWQ6ITEsaXNDcmVhdGVkOiExLHNjcm9sbFBhcmVudHM6W119LHRoaXMucmVmZXJlbmNlPW8mJm8uanF1ZXJ5P29bMF06byx0aGlzLnBvcHBlcj1uJiZuLmpxdWVyeT9uWzBdOm4sdGhpcy5vcHRpb25zLm1vZGlmaWVycz17fSxPYmplY3Qua2V5cyhsZSh7fSx0LkRlZmF1bHRzLm1vZGlmaWVycyxyLm1vZGlmaWVycykpLmZvckVhY2goZnVuY3Rpb24oZSl7aS5vcHRpb25zLm1vZGlmaWVyc1tlXT1sZSh7fSx0LkRlZmF1bHRzLm1vZGlmaWVyc1tlXXx8e30sci5tb2RpZmllcnM/ci5tb2RpZmllcnNbZV06e30pfSksdGhpcy5tb2RpZmllcnM9T2JqZWN0LmtleXModGhpcy5vcHRpb25zLm1vZGlmaWVycykubWFwKGZ1bmN0aW9uKGUpe3JldHVybiBsZSh7bmFtZTplfSxpLm9wdGlvbnMubW9kaWZpZXJzW2VdKX0pLnNvcnQoZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5vcmRlci10Lm9yZGVyfSksdGhpcy5tb2RpZmllcnMuZm9yRWFjaChmdW5jdGlvbih0KXt0LmVuYWJsZWQmJmUodC5vbkxvYWQpJiZ0Lm9uTG9hZChpLnJlZmVyZW5jZSxpLnBvcHBlcixpLm9wdGlvbnMsdCxpLnN0YXRlKX0pLHRoaXMudXBkYXRlKCk7dmFyIHA9dGhpcy5vcHRpb25zLmV2ZW50c0VuYWJsZWQ7cCYmdGhpcy5lbmFibGVFdmVudExpc3RlbmVycygpLHRoaXMuc3RhdGUuZXZlbnRzRW5hYmxlZD1wfXJldHVybiBkZSh0LFt7a2V5Oid1cGRhdGUnLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIGsuY2FsbCh0aGlzKX19LHtrZXk6J2Rlc3Ryb3knLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIEguY2FsbCh0aGlzKX19LHtrZXk6J2VuYWJsZUV2ZW50TGlzdGVuZXJzJyx2YWx1ZTpmdW5jdGlvbigpe3JldHVybiBJLmNhbGwodGhpcyl9fSx7a2V5OidkaXNhYmxlRXZlbnRMaXN0ZW5lcnMnLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIFUuY2FsbCh0aGlzKX19XSksdH0oKTtyZXR1cm4gZ2UuVXRpbHM9KCd1bmRlZmluZWQnPT10eXBlb2Ygd2luZG93P2dsb2JhbDp3aW5kb3cpLlBvcHBlclV0aWxzLGdlLnBsYWNlbWVudHM9bWUsZ2UuRGVmYXVsdHM9e3BsYWNlbWVudDonYm90dG9tJyxwb3NpdGlvbkZpeGVkOiExLGV2ZW50c0VuYWJsZWQ6ITAscmVtb3ZlT25EZXN0cm95OiExLG9uQ3JlYXRlOmZ1bmN0aW9uKCl7fSxvblVwZGF0ZTpmdW5jdGlvbigpe30sbW9kaWZpZXJzOntzaGlmdDp7b3JkZXI6MTAwLGVuYWJsZWQ6ITAsZm46ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wbGFjZW1lbnQsbz10LnNwbGl0KCctJylbMF0sbj10LnNwbGl0KCctJylbMV07aWYobil7dmFyIGk9ZS5vZmZzZXRzLHI9aS5yZWZlcmVuY2UscD1pLnBvcHBlcixzPS0xIT09Wydib3R0b20nLCd0b3AnXS5pbmRleE9mKG8pLGQ9cz8nbGVmdCc6J3RvcCcsYT1zPyd3aWR0aCc6J2hlaWdodCcsbD17c3RhcnQ6YWUoe30sZCxyW2RdKSxlbmQ6YWUoe30sZCxyW2RdK3JbYV0tcFthXSl9O2Uub2Zmc2V0cy5wb3BwZXI9bGUoe30scCxsW25dKX1yZXR1cm4gZX19LG9mZnNldDp7b3JkZXI6MjAwLGVuYWJsZWQ6ITAsZm46SixvZmZzZXQ6MH0scHJldmVudE92ZXJmbG93OntvcmRlcjozMDAsZW5hYmxlZDohMCxmbjpmdW5jdGlvbihlLHQpe3ZhciBvPXQuYm91bmRhcmllc0VsZW1lbnR8fHAoZS5pbnN0YW5jZS5wb3BwZXIpO2UuaW5zdGFuY2UucmVmZXJlbmNlPT09byYmKG89cChvKSk7dmFyIG49QigndHJhbnNmb3JtJyksaT1lLmluc3RhbmNlLnBvcHBlci5zdHlsZSxyPWkudG9wLHM9aS5sZWZ0LGQ9aVtuXTtpLnRvcD0nJyxpLmxlZnQ9JycsaVtuXT0nJzt2YXIgYT12KGUuaW5zdGFuY2UucG9wcGVyLGUuaW5zdGFuY2UucmVmZXJlbmNlLHQucGFkZGluZyxvLGUucG9zaXRpb25GaXhlZCk7aS50b3A9cixpLmxlZnQ9cyxpW25dPWQsdC5ib3VuZGFyaWVzPWE7dmFyIGw9dC5wcmlvcml0eSxmPWUub2Zmc2V0cy5wb3BwZXIsbT17cHJpbWFyeTpmdW5jdGlvbihlKXt2YXIgbz1mW2VdO3JldHVybiBmW2VdPGFbZV0mJiF0LmVzY2FwZVdpdGhSZWZlcmVuY2UmJihvPWVlKGZbZV0sYVtlXSkpLGFlKHt9LGUsbyl9LHNlY29uZGFyeTpmdW5jdGlvbihlKXt2YXIgbz0ncmlnaHQnPT09ZT8nbGVmdCc6J3RvcCcsbj1mW29dO3JldHVybiBmW2VdPmFbZV0mJiF0LmVzY2FwZVdpdGhSZWZlcmVuY2UmJihuPVEoZltvXSxhW2VdLSgncmlnaHQnPT09ZT9mLndpZHRoOmYuaGVpZ2h0KSkpLGFlKHt9LG8sbil9fTtyZXR1cm4gbC5mb3JFYWNoKGZ1bmN0aW9uKGUpe3ZhciB0PS0xPT09WydsZWZ0JywndG9wJ10uaW5kZXhPZihlKT8nc2Vjb25kYXJ5JzoncHJpbWFyeSc7Zj1sZSh7fSxmLG1bdF0oZSkpfSksZS5vZmZzZXRzLnBvcHBlcj1mLGV9LHByaW9yaXR5OlsnbGVmdCcsJ3JpZ2h0JywndG9wJywnYm90dG9tJ10scGFkZGluZzo1LGJvdW5kYXJpZXNFbGVtZW50OidzY3JvbGxQYXJlbnQnfSxrZWVwVG9nZXRoZXI6e29yZGVyOjQwMCxlbmFibGVkOiEwLGZuOmZ1bmN0aW9uKGUpe3ZhciB0PWUub2Zmc2V0cyxvPXQucG9wcGVyLG49dC5yZWZlcmVuY2UsaT1lLnBsYWNlbWVudC5zcGxpdCgnLScpWzBdLHI9WixwPS0xIT09Wyd0b3AnLCdib3R0b20nXS5pbmRleE9mKGkpLHM9cD8ncmlnaHQnOidib3R0b20nLGQ9cD8nbGVmdCc6J3RvcCcsYT1wPyd3aWR0aCc6J2hlaWdodCc7cmV0dXJuIG9bc108cihuW2RdKSYmKGUub2Zmc2V0cy5wb3BwZXJbZF09cihuW2RdKS1vW2FdKSxvW2RdPnIobltzXSkmJihlLm9mZnNldHMucG9wcGVyW2RdPXIobltzXSkpLGV9fSxhcnJvdzp7b3JkZXI6NTAwLGVuYWJsZWQ6ITAsZm46ZnVuY3Rpb24oZSxvKXt2YXIgbjtpZighSyhlLmluc3RhbmNlLm1vZGlmaWVycywnYXJyb3cnLCdrZWVwVG9nZXRoZXInKSlyZXR1cm4gZTt2YXIgaT1vLmVsZW1lbnQ7aWYoJ3N0cmluZyc9PXR5cGVvZiBpKXtpZihpPWUuaW5zdGFuY2UucG9wcGVyLnF1ZXJ5U2VsZWN0b3IoaSksIWkpcmV0dXJuIGU7fWVsc2UgaWYoIWUuaW5zdGFuY2UucG9wcGVyLmNvbnRhaW5zKGkpKXJldHVybiBjb25zb2xlLndhcm4oJ1dBUk5JTkc6IGBhcnJvdy5lbGVtZW50YCBtdXN0IGJlIGNoaWxkIG9mIGl0cyBwb3BwZXIgZWxlbWVudCEnKSxlO3ZhciByPWUucGxhY2VtZW50LnNwbGl0KCctJylbMF0scD1lLm9mZnNldHMscz1wLnBvcHBlcixkPXAucmVmZXJlbmNlLGE9LTEhPT1bJ2xlZnQnLCdyaWdodCddLmluZGV4T2YociksbD1hPydoZWlnaHQnOid3aWR0aCcsZj1hPydUb3AnOidMZWZ0JyxtPWYudG9Mb3dlckNhc2UoKSxoPWE/J2xlZnQnOid0b3AnLGM9YT8nYm90dG9tJzoncmlnaHQnLHU9UyhpKVtsXTtkW2NdLXU8c1ttXSYmKGUub2Zmc2V0cy5wb3BwZXJbbV0tPXNbbV0tKGRbY10tdSkpLGRbbV0rdT5zW2NdJiYoZS5vZmZzZXRzLnBvcHBlclttXSs9ZFttXSt1LXNbY10pLGUub2Zmc2V0cy5wb3BwZXI9ZyhlLm9mZnNldHMucG9wcGVyKTt2YXIgYj1kW21dK2RbbF0vMi11LzIsdz10KGUuaW5zdGFuY2UucG9wcGVyKSx5PXBhcnNlRmxvYXQod1snbWFyZ2luJytmXSksRT1wYXJzZUZsb2F0KHdbJ2JvcmRlcicrZisnV2lkdGgnXSksdj1iLWUub2Zmc2V0cy5wb3BwZXJbbV0teS1FO3JldHVybiB2PWVlKFEoc1tsXS11LHYpLDApLGUuYXJyb3dFbGVtZW50PWksZS5vZmZzZXRzLmFycm93PShuPXt9LGFlKG4sbSwkKHYpKSxhZShuLGgsJycpLG4pLGV9LGVsZW1lbnQ6J1t4LWFycm93XSd9LGZsaXA6e29yZGVyOjYwMCxlbmFibGVkOiEwLGZuOmZ1bmN0aW9uKGUsdCl7aWYoVyhlLmluc3RhbmNlLm1vZGlmaWVycywnaW5uZXInKSlyZXR1cm4gZTtpZihlLmZsaXBwZWQmJmUucGxhY2VtZW50PT09ZS5vcmlnaW5hbFBsYWNlbWVudClyZXR1cm4gZTt2YXIgbz12KGUuaW5zdGFuY2UucG9wcGVyLGUuaW5zdGFuY2UucmVmZXJlbmNlLHQucGFkZGluZyx0LmJvdW5kYXJpZXNFbGVtZW50LGUucG9zaXRpb25GaXhlZCksbj1lLnBsYWNlbWVudC5zcGxpdCgnLScpWzBdLGk9VChuKSxyPWUucGxhY2VtZW50LnNwbGl0KCctJylbMV18fCcnLHA9W107c3dpdGNoKHQuYmVoYXZpb3Ipe2Nhc2UgY2UuRkxJUDpwPVtuLGldO2JyZWFrO2Nhc2UgY2UuQ0xPQ0tXSVNFOnA9RyhuKTticmVhaztjYXNlIGNlLkNPVU5URVJDTE9DS1dJU0U6cD1HKG4sITApO2JyZWFrO2RlZmF1bHQ6cD10LmJlaGF2aW9yO31yZXR1cm4gcC5mb3JFYWNoKGZ1bmN0aW9uKHMsZCl7aWYobiE9PXN8fHAubGVuZ3RoPT09ZCsxKXJldHVybiBlO249ZS5wbGFjZW1lbnQuc3BsaXQoJy0nKVswXSxpPVQobik7dmFyIGE9ZS5vZmZzZXRzLnBvcHBlcixsPWUub2Zmc2V0cy5yZWZlcmVuY2UsZj1aLG09J2xlZnQnPT09biYmZihhLnJpZ2h0KT5mKGwubGVmdCl8fCdyaWdodCc9PT1uJiZmKGEubGVmdCk8ZihsLnJpZ2h0KXx8J3RvcCc9PT1uJiZmKGEuYm90dG9tKT5mKGwudG9wKXx8J2JvdHRvbSc9PT1uJiZmKGEudG9wKTxmKGwuYm90dG9tKSxoPWYoYS5sZWZ0KTxmKG8ubGVmdCksYz1mKGEucmlnaHQpPmYoby5yaWdodCksZz1mKGEudG9wKTxmKG8udG9wKSx1PWYoYS5ib3R0b20pPmYoby5ib3R0b20pLGI9J2xlZnQnPT09biYmaHx8J3JpZ2h0Jz09PW4mJmN8fCd0b3AnPT09biYmZ3x8J2JvdHRvbSc9PT1uJiZ1LHc9LTEhPT1bJ3RvcCcsJ2JvdHRvbSddLmluZGV4T2YobikseT0hIXQuZmxpcFZhcmlhdGlvbnMmJih3JiYnc3RhcnQnPT09ciYmaHx8dyYmJ2VuZCc9PT1yJiZjfHwhdyYmJ3N0YXJ0Jz09PXImJmd8fCF3JiYnZW5kJz09PXImJnUpLEU9ISF0LmZsaXBWYXJpYXRpb25zQnlDb250ZW50JiYodyYmJ3N0YXJ0Jz09PXImJmN8fHcmJidlbmQnPT09ciYmaHx8IXcmJidzdGFydCc9PT1yJiZ1fHwhdyYmJ2VuZCc9PT1yJiZnKSx2PXl8fEU7KG18fGJ8fHYpJiYoZS5mbGlwcGVkPSEwLChtfHxiKSYmKG49cFtkKzFdKSx2JiYocj16KHIpKSxlLnBsYWNlbWVudD1uKyhyPyctJytyOicnKSxlLm9mZnNldHMucG9wcGVyPWxlKHt9LGUub2Zmc2V0cy5wb3BwZXIsQyhlLmluc3RhbmNlLnBvcHBlcixlLm9mZnNldHMucmVmZXJlbmNlLGUucGxhY2VtZW50KSksZT1QKGUuaW5zdGFuY2UubW9kaWZpZXJzLGUsJ2ZsaXAnKSl9KSxlfSxiZWhhdmlvcjonZmxpcCcscGFkZGluZzo1LGJvdW5kYXJpZXNFbGVtZW50Oid2aWV3cG9ydCcsZmxpcFZhcmlhdGlvbnM6ITEsZmxpcFZhcmlhdGlvbnNCeUNvbnRlbnQ6ITF9LGlubmVyOntvcmRlcjo3MDAsZW5hYmxlZDohMSxmbjpmdW5jdGlvbihlKXt2YXIgdD1lLnBsYWNlbWVudCxvPXQuc3BsaXQoJy0nKVswXSxuPWUub2Zmc2V0cyxpPW4ucG9wcGVyLHI9bi5yZWZlcmVuY2UscD0tMSE9PVsnbGVmdCcsJ3JpZ2h0J10uaW5kZXhPZihvKSxzPS0xPT09Wyd0b3AnLCdsZWZ0J10uaW5kZXhPZihvKTtyZXR1cm4gaVtwPydsZWZ0JzondG9wJ109cltvXS0ocz9pW3A/J3dpZHRoJzonaGVpZ2h0J106MCksZS5wbGFjZW1lbnQ9VCh0KSxlLm9mZnNldHMucG9wcGVyPWcoaSksZX19LGhpZGU6e29yZGVyOjgwMCxlbmFibGVkOiEwLGZuOmZ1bmN0aW9uKGUpe2lmKCFLKGUuaW5zdGFuY2UubW9kaWZpZXJzLCdoaWRlJywncHJldmVudE92ZXJmbG93JykpcmV0dXJuIGU7dmFyIHQ9ZS5vZmZzZXRzLnJlZmVyZW5jZSxvPUQoZS5pbnN0YW5jZS5tb2RpZmllcnMsZnVuY3Rpb24oZSl7cmV0dXJuJ3ByZXZlbnRPdmVyZmxvdyc9PT1lLm5hbWV9KS5ib3VuZGFyaWVzO2lmKHQuYm90dG9tPG8udG9wfHx0LmxlZnQ+by5yaWdodHx8dC50b3A+by5ib3R0b218fHQucmlnaHQ8by5sZWZ0KXtpZighMD09PWUuaGlkZSlyZXR1cm4gZTtlLmhpZGU9ITAsZS5hdHRyaWJ1dGVzWyd4LW91dC1vZi1ib3VuZGFyaWVzJ109Jyd9ZWxzZXtpZighMT09PWUuaGlkZSlyZXR1cm4gZTtlLmhpZGU9ITEsZS5hdHRyaWJ1dGVzWyd4LW91dC1vZi1ib3VuZGFyaWVzJ109ITF9cmV0dXJuIGV9fSxjb21wdXRlU3R5bGU6e29yZGVyOjg1MCxlbmFibGVkOiEwLGZuOmZ1bmN0aW9uKGUsdCl7dmFyIG89dC54LG49dC55LGk9ZS5vZmZzZXRzLnBvcHBlcixyPUQoZS5pbnN0YW5jZS5tb2RpZmllcnMsZnVuY3Rpb24oZSl7cmV0dXJuJ2FwcGx5U3R5bGUnPT09ZS5uYW1lfSkuZ3B1QWNjZWxlcmF0aW9uO3ZvaWQgMCE9PXImJmNvbnNvbGUud2FybignV0FSTklORzogYGdwdUFjY2VsZXJhdGlvbmAgb3B0aW9uIG1vdmVkIHRvIGBjb21wdXRlU3R5bGVgIG1vZGlmaWVyIGFuZCB3aWxsIG5vdCBiZSBzdXBwb3J0ZWQgaW4gZnV0dXJlIHZlcnNpb25zIG9mIFBvcHBlci5qcyEnKTt2YXIgcyxkLGE9dm9pZCAwPT09cj90LmdwdUFjY2VsZXJhdGlvbjpyLGw9cChlLmluc3RhbmNlLnBvcHBlciksZj11KGwpLG09e3Bvc2l0aW9uOmkucG9zaXRpb259LGg9cShlLDI+d2luZG93LmRldmljZVBpeGVsUmF0aW98fCFmZSksYz0nYm90dG9tJz09PW8/J3RvcCc6J2JvdHRvbScsZz0ncmlnaHQnPT09bj8nbGVmdCc6J3JpZ2h0JyxiPUIoJ3RyYW5zZm9ybScpO2lmKGQ9J2JvdHRvbSc9PWM/J0hUTUwnPT09bC5ub2RlTmFtZT8tbC5jbGllbnRIZWlnaHQraC5ib3R0b206LWYuaGVpZ2h0K2guYm90dG9tOmgudG9wLHM9J3JpZ2h0Jz09Zz8nSFRNTCc9PT1sLm5vZGVOYW1lPy1sLmNsaWVudFdpZHRoK2gucmlnaHQ6LWYud2lkdGgraC5yaWdodDpoLmxlZnQsYSYmYiltW2JdPSd0cmFuc2xhdGUzZCgnK3MrJ3B4LCAnK2QrJ3B4LCAwKScsbVtjXT0wLG1bZ109MCxtLndpbGxDaGFuZ2U9J3RyYW5zZm9ybSc7ZWxzZXt2YXIgdz0nYm90dG9tJz09Yz8tMToxLHk9J3JpZ2h0Jz09Zz8tMToxO21bY109ZCp3LG1bZ109cyp5LG0ud2lsbENoYW5nZT1jKycsICcrZ312YXIgRT17IngtcGxhY2VtZW50IjplLnBsYWNlbWVudH07cmV0dXJuIGUuYXR0cmlidXRlcz1sZSh7fSxFLGUuYXR0cmlidXRlcyksZS5zdHlsZXM9bGUoe30sbSxlLnN0eWxlcyksZS5hcnJvd1N0eWxlcz1sZSh7fSxlLm9mZnNldHMuYXJyb3csZS5hcnJvd1N0eWxlcyksZX0sZ3B1QWNjZWxlcmF0aW9uOiEwLHg6J2JvdHRvbScseToncmlnaHQnfSxhcHBseVN0eWxlOntvcmRlcjo5MDAsZW5hYmxlZDohMCxmbjpmdW5jdGlvbihlKXtyZXR1cm4gVihlLmluc3RhbmNlLnBvcHBlcixlLnN0eWxlcyksaihlLmluc3RhbmNlLnBvcHBlcixlLmF0dHJpYnV0ZXMpLGUuYXJyb3dFbGVtZW50JiZPYmplY3Qua2V5cyhlLmFycm93U3R5bGVzKS5sZW5ndGgmJlYoZS5hcnJvd0VsZW1lbnQsZS5hcnJvd1N0eWxlcyksZX0sb25Mb2FkOmZ1bmN0aW9uKGUsdCxvLG4saSl7dmFyIHI9TChpLHQsZSxvLnBvc2l0aW9uRml4ZWQpLHA9TyhvLnBsYWNlbWVudCxyLHQsZSxvLm1vZGlmaWVycy5mbGlwLmJvdW5kYXJpZXNFbGVtZW50LG8ubW9kaWZpZXJzLmZsaXAucGFkZGluZyk7cmV0dXJuIHQuc2V0QXR0cmlidXRlKCd4LXBsYWNlbWVudCcscCksVih0LHtwb3NpdGlvbjpvLnBvc2l0aW9uRml4ZWQ/J2ZpeGVkJzonYWJzb2x1dGUnfSksb30sZ3B1QWNjZWxlcmF0aW9uOnZvaWQgMH19fSxnZX0pOwovLyMgc291cmNlTWFwcGluZ1VSTD1wb3BwZXIubWluLmpzLm1hcAovKiEKICogQm9vdHN0cmFwIHY0LjUuMiAoaHR0cHM6Ly9nZXRib290c3RyYXAuY29tLykKICogQ29weXJpZ2h0IDIwMTEtMjAyMCBUaGUgQm9vdHN0cmFwIEF1dGhvcnMgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ncmFwaHMvY29udHJpYnV0b3JzKQogKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21haW4vTElDRU5TRSkKICovCiEgZnVuY3Rpb24odCwgZSkgewogICAgIm9iamVjdCIgPT0gdHlwZW9mIGV4cG9ydHMgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIG1vZHVsZSA/IGUoZXhwb3J0cywgcmVxdWlyZSgianF1ZXJ5IiksIHJlcXVpcmUoInBvcHBlci5qcyIpKSA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKFsiZXhwb3J0cyIsICJqcXVlcnkiLCAicG9wcGVyLmpzIl0sIGUpIDogZSgodCA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWxUaGlzID8gZ2xvYmFsVGhpcyA6IHQgfHwgc2VsZikuYm9vdHN0cmFwID0ge30sIHQualF1ZXJ5LCB0LlBvcHBlcikKfSh0aGlzLCAoZnVuY3Rpb24odCwgZSwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIGZ1bmN0aW9uIGkodCwgZSkgewogICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgZS5sZW5ndGg7IG4rKykgewogICAgICAgICAgICB2YXIgaSA9IGVbbl07CiAgICAgICAgICAgIGkuZW51bWVyYWJsZSA9IGkuZW51bWVyYWJsZSB8fCAhMSwgaS5jb25maWd1cmFibGUgPSAhMCwgInZhbHVlIiBpbiBpICYmIChpLndyaXRhYmxlID0gITApLCBPYmplY3QuZGVmaW5lUHJvcGVydHkodCwgaS5rZXksIGkpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG8odCwgZSwgbikgewogICAgICAgIHJldHVybiBlICYmIGkodC5wcm90b3R5cGUsIGUpLCBuICYmIGkodCwgbiksIHQKICAgIH0KCiAgICBmdW5jdGlvbiBzKCkgewogICAgICAgIHJldHVybiAocyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkgewogICAgICAgICAgICBmb3IgKHZhciBlID0gMTsgZSA8IGFyZ3VtZW50cy5sZW5ndGg7IGUrKykgewogICAgICAgICAgICAgICAgdmFyIG4gPSBhcmd1bWVudHNbZV07CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIG4pIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuLCBpKSAmJiAodFtpXSA9IG5baV0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHQKICAgICAgICB9KS5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICB9CiAgICBlID0gZSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgImRlZmF1bHQiKSA/IGUuZGVmYXVsdCA6IGUsIG4gPSBuICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuLCAiZGVmYXVsdCIpID8gbi5kZWZhdWx0IDogbjsKCiAgICBmdW5jdGlvbiByKHQpIHsKICAgICAgICB2YXIgbiA9IHRoaXMsCiAgICAgICAgICAgIGkgPSAhMTsKICAgICAgICByZXR1cm4gZSh0aGlzKS5vbmUoYS5UUkFOU0lUSU9OX0VORCwgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpID0gITAKICAgICAgICB9KSksIHNldFRpbWVvdXQoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpIHx8IGEudHJpZ2dlclRyYW5zaXRpb25FbmQobikKICAgICAgICB9KSwgdCksIHRoaXMKICAgIH0KICAgIHZhciBhID0gewogICAgICAgIFRSQU5TSVRJT05fRU5EOiAiYnNUcmFuc2l0aW9uRW5kIiwKICAgICAgICBnZXRVSUQ6IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgdCArPSB+figxZTYgKiBNYXRoLnJhbmRvbSgpKQogICAgICAgICAgICB9IHdoaWxlIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0KSk7CiAgICAgICAgICAgIHJldHVybiB0CiAgICAgICAgfSwKICAgICAgICBnZXRTZWxlY3RvckZyb21FbGVtZW50OiBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgIHZhciBlID0gdC5nZXRBdHRyaWJ1dGUoImRhdGEtdGFyZ2V0Iik7CiAgICAgICAgICAgIGlmICghZSB8fCAiIyIgPT09IGUpIHsKICAgICAgICAgICAgICAgIHZhciBuID0gdC5nZXRBdHRyaWJ1dGUoImhyZWYiKTsKICAgICAgICAgICAgICAgIGUgPSBuICYmICIjIiAhPT0gbiA/IG4udHJpbSgpIDogIiIKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZSkgPyBlIDogbnVsbAogICAgICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBnZXRUcmFuc2l0aW9uRHVyYXRpb25Gcm9tRWxlbWVudDogZnVuY3Rpb24odCkgewogICAgICAgICAgICBpZiAoIXQpIHJldHVybiAwOwogICAgICAgICAgICB2YXIgbiA9IGUodCkuY3NzKCJ0cmFuc2l0aW9uLWR1cmF0aW9uIiksCiAgICAgICAgICAgICAgICBpID0gZSh0KS5jc3MoInRyYW5zaXRpb24tZGVsYXkiKSwKICAgICAgICAgICAgICAgIG8gPSBwYXJzZUZsb2F0KG4pLAogICAgICAgICAgICAgICAgcyA9IHBhcnNlRmxvYXQoaSk7CiAgICAgICAgICAgIHJldHVybiBvIHx8IHMgPyAobiA9IG4uc3BsaXQoIiwiKVswXSwgaSA9IGkuc3BsaXQoIiwiKVswXSwgMWUzICogKHBhcnNlRmxvYXQobikgKyBwYXJzZUZsb2F0KGkpKSkgOiAwCiAgICAgICAgfSwKICAgICAgICByZWZsb3c6IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHQub2Zmc2V0SGVpZ2h0CiAgICAgICAgfSwKICAgICAgICB0cmlnZ2VyVHJhbnNpdGlvbkVuZDogZnVuY3Rpb24odCkgewogICAgICAgICAgICBlKHQpLnRyaWdnZXIoInRyYW5zaXRpb25lbmQiKQogICAgICAgIH0sCiAgICAgICAgc3VwcG9ydHNUcmFuc2l0aW9uRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4oInRyYW5zaXRpb25lbmQiKQogICAgICAgIH0sCiAgICAgICAgaXNFbGVtZW50OiBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgIHJldHVybiAodFswXSB8fCB0KS5ub2RlVHlwZQogICAgICAgIH0sCiAgICAgICAgdHlwZUNoZWNrQ29uZmlnOiBmdW5jdGlvbih0LCBlLCBuKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gbikKICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobiwgaSkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IG5baV0sCiAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBlW2ldLAogICAgICAgICAgICAgICAgICAgICAgICByID0gcyAmJiBhLmlzRWxlbWVudChzKSA/ICJlbGVtZW50IiA6IG51bGwgPT09IChsID0gcykgfHwgInVuZGVmaW5lZCIgPT0gdHlwZW9mIGwgPyAiIiArIGwgOiB7fS50b1N0cmluZy5jYWxsKGwpLm1hdGNoKC9ccyhbYS16XSspL2kpWzFdLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXcgUmVnRXhwKG8pLnRlc3QocikpIHRocm93IG5ldyBFcnJvcih0LnRvVXBwZXJDYXNlKCkgKyAnOiBPcHRpb24gIicgKyBpICsgJyIgcHJvdmlkZWQgdHlwZSAiJyArIHIgKyAnIiBidXQgZXhwZWN0ZWQgdHlwZSAiJyArIG8gKyAnIi4nKQogICAgICAgICAgICAgICAgfSB2YXIgbAogICAgICAgIH0sCiAgICAgICAgZmluZFNoYWRvd1Jvb3Q6IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXR0YWNoU2hhZG93KSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIHQuZ2V0Um9vdE5vZGUpIHsKICAgICAgICAgICAgICAgIHZhciBlID0gdC5nZXRSb290Tm9kZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBTaGFkb3dSb290ID8gZSA6IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdCBpbnN0YW5jZW9mIFNoYWRvd1Jvb3QgPyB0IDogdC5wYXJlbnROb2RlID8gYS5maW5kU2hhZG93Um9vdCh0LnBhcmVudE5vZGUpIDogbnVsbAogICAgICAgIH0sCiAgICAgICAgalF1ZXJ5RGV0ZWN0aW9uOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09IHR5cGVvZiBlKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJCb290c3RyYXAncyBKYXZhU2NyaXB0IHJlcXVpcmVzIGpRdWVyeS4galF1ZXJ5IG11c3QgYmUgaW5jbHVkZWQgYmVmb3JlIEJvb3RzdHJhcCdzIEphdmFTY3JpcHQuIik7CiAgICAgICAgICAgIHZhciB0ID0gZS5mbi5qcXVlcnkuc3BsaXQoIiAiKVswXS5zcGxpdCgiLiIpOwogICAgICAgICAgICBpZiAodFswXSA8IDIgJiYgdFsxXSA8IDkgfHwgMSA9PT0gdFswXSAmJiA5ID09PSB0WzFdICYmIHRbMl0gPCAxIHx8IHRbMF0gPj0gNCkgdGhyb3cgbmV3IEVycm9yKCJCb290c3RyYXAncyBKYXZhU2NyaXB0IHJlcXVpcmVzIGF0IGxlYXN0IGpRdWVyeSB2MS45LjEgYnV0IGxlc3MgdGhhbiB2NC4wLjAiKQogICAgICAgIH0KICAgIH07CiAgICBhLmpRdWVyeURldGVjdGlvbigpLCBlLmZuLmVtdWxhdGVUcmFuc2l0aW9uRW5kID0gciwgZS5ldmVudC5zcGVjaWFsW2EuVFJBTlNJVElPTl9FTkRdID0gewogICAgICAgIGJpbmRUeXBlOiAidHJhbnNpdGlvbmVuZCIsCiAgICAgICAgZGVsZWdhdGVUeXBlOiAidHJhbnNpdGlvbmVuZCIsCiAgICAgICAgaGFuZGxlOiBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgIGlmIChlKHQudGFyZ2V0KS5pcyh0aGlzKSkgcmV0dXJuIHQuaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICAgIH0KICAgIH07CiAgICB2YXIgbCA9ICJhbGVydCIsCiAgICAgICAgYyA9IGUuZm5bbF0sCiAgICAgICAgaCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBmdW5jdGlvbiB0KHQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2VsZW1lbnQgPSB0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG4gPSB0LnByb3RvdHlwZTsKICAgICAgICAgICAgcmV0dXJuIG4uY2xvc2UgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMuX2VsZW1lbnQ7CiAgICAgICAgICAgICAgICB0ICYmIChlID0gdGhpcy5fZ2V0Um9vdEVsZW1lbnQodCkpLCB0aGlzLl90cmlnZ2VyQ2xvc2VFdmVudChlKS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSB8fCB0aGlzLl9yZW1vdmVFbGVtZW50KGUpCiAgICAgICAgICAgIH0sIG4uZGlzcG9zZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZS5yZW1vdmVEYXRhKHRoaXMuX2VsZW1lbnQsICJicy5hbGVydCIpLCB0aGlzLl9lbGVtZW50ID0gbnVsbAogICAgICAgICAgICB9LCBuLl9nZXRSb290RWxlbWVudCA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIHZhciBuID0gYS5nZXRTZWxlY3RvckZyb21FbGVtZW50KHQpLAogICAgICAgICAgICAgICAgICAgIGkgPSAhMTsKICAgICAgICAgICAgICAgIHJldHVybiBuICYmIChpID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihuKSksIGkgfHwgKGkgPSBlKHQpLmNsb3Nlc3QoIi5hbGVydCIpWzBdKSwgaQogICAgICAgICAgICB9LCBuLl90cmlnZ2VyQ2xvc2VFdmVudCA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIHZhciBuID0gZS5FdmVudCgiY2xvc2UuYnMuYWxlcnQiKTsKICAgICAgICAgICAgICAgIHJldHVybiBlKHQpLnRyaWdnZXIobiksIG4KICAgICAgICAgICAgfSwgbi5fcmVtb3ZlRWxlbWVudCA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIHZhciBuID0gdGhpczsKICAgICAgICAgICAgICAgIGlmIChlKHQpLnJlbW92ZUNsYXNzKCJzaG93IiksIGUodCkuaGFzQ2xhc3MoImZhZGUiKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBpID0gYS5nZXRUcmFuc2l0aW9uRHVyYXRpb25Gcm9tRWxlbWVudCh0KTsKICAgICAgICAgICAgICAgICAgICBlKHQpLm9uZShhLlRSQU5TSVRJT05fRU5ELCAoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5fZGVzdHJveUVsZW1lbnQodCwgZSkKICAgICAgICAgICAgICAgICAgICB9KSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoaSkKICAgICAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9kZXN0cm95RWxlbWVudCh0KQogICAgICAgICAgICB9LCBuLl9kZXN0cm95RWxlbWVudCA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIGUodCkuZGV0YWNoKCkudHJpZ2dlcigiY2xvc2VkLmJzLmFsZXJ0IikucmVtb3ZlKCkKICAgICAgICAgICAgfSwgdC5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24obikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaCgoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBlKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICBvID0gaS5kYXRhKCJicy5hbGVydCIpOwogICAgICAgICAgICAgICAgICAgIG8gfHwgKG8gPSBuZXcgdCh0aGlzKSwgaS5kYXRhKCJicy5hbGVydCIsIG8pKSwgImNsb3NlIiA9PT0gbiAmJiBvW25dKHRoaXMpCiAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgfSwgdC5faGFuZGxlRGlzbWlzcyA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgZSAmJiBlLnByZXZlbnREZWZhdWx0KCksIHQuY2xvc2UodGhpcykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbyh0LCBudWxsLCBbewogICAgICAgICAgICAgICAga2V5OiAiVkVSU0lPTiIsCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiNC41LjIiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dKSwgdAogICAgICAgIH0oKTsKICAgIGUoZG9jdW1lbnQpLm9uKCJjbGljay5icy5hbGVydC5kYXRhLWFwaSIsICdbZGF0YS1kaXNtaXNzPSJhbGVydCJdJywgaC5faGFuZGxlRGlzbWlzcyhuZXcgaCkpLCBlLmZuW2xdID0gaC5falF1ZXJ5SW50ZXJmYWNlLCBlLmZuW2xdLkNvbnN0cnVjdG9yID0gaCwgZS5mbltsXS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGUuZm5bbF0gPSBjLCBoLl9qUXVlcnlJbnRlcmZhY2UKICAgIH07CiAgICB2YXIgdSA9IGUuZm4uYnV0dG9uLAogICAgICAgIGQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZnVuY3Rpb24gdCh0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9lbGVtZW50ID0gdAogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBuID0gdC5wcm90b3R5cGU7CiAgICAgICAgICAgIHJldHVybiBuLnRvZ2dsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSAhMCwKICAgICAgICAgICAgICAgICAgICBuID0gITAsCiAgICAgICAgICAgICAgICAgICAgaSA9IGUodGhpcy5fZWxlbWVudCkuY2xvc2VzdCgnW2RhdGEtdG9nZ2xlPSJidXR0b25zIl0nKVswXTsKICAgICAgICAgICAgICAgIGlmIChpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Om5vdChbdHlwZT0iaGlkZGVuIl0pJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJyYWRpbyIgPT09IG8udHlwZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvLmNoZWNrZWQgJiYgdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoImFjdGl2ZSIpKSB0ID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGkucXVlcnlTZWxlY3RvcigiLmFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgJiYgZShzKS5yZW1vdmVDbGFzcygiYWN0aXZlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gdCAmJiAoImNoZWNrYm94IiAhPT0gby50eXBlICYmICJyYWRpbyIgIT09IG8udHlwZSB8fCAoby5jaGVja2VkID0gIXRoaXMuX2VsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJhY3RpdmUiKSksIGUobykudHJpZ2dlcigiY2hhbmdlIikpLCBvLmZvY3VzKCksIG4gPSAhMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2VsZW1lbnQuaGFzQXR0cmlidXRlKCJkaXNhYmxlZCIpIHx8IHRoaXMuX2VsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJkaXNhYmxlZCIpIHx8IChuICYmIHRoaXMuX2VsZW1lbnQuc2V0QXR0cmlidXRlKCJhcmlhLXByZXNzZWQiLCAhdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoImFjdGl2ZSIpKSwgdCAmJiBlKHRoaXMuX2VsZW1lbnQpLnRvZ2dsZUNsYXNzKCJhY3RpdmUiKSkKICAgICAgICAgICAgfSwgbi5kaXNwb3NlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBlLnJlbW92ZURhdGEodGhpcy5fZWxlbWVudCwgImJzLmJ1dHRvbiIpLCB0aGlzLl9lbGVtZW50ID0gbnVsbAogICAgICAgICAgICB9LCB0Ll9qUXVlcnlJbnRlcmZhY2UgPSBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IGUodGhpcykuZGF0YSgiYnMuYnV0dG9uIik7CiAgICAgICAgICAgICAgICAgICAgaSB8fCAoaSA9IG5ldyB0KHRoaXMpLCBlKHRoaXMpLmRhdGEoImJzLmJ1dHRvbiIsIGkpKSwgInRvZ2dsZSIgPT09IG4gJiYgaVtuXSgpCiAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgfSwgbyh0LCBudWxsLCBbewogICAgICAgICAgICAgICAga2V5OiAiVkVSU0lPTiIsCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiNC41LjIiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dKSwgdAogICAgICAgIH0oKTsKICAgIGUoZG9jdW1lbnQpLm9uKCJjbGljay5icy5idXR0b24uZGF0YS1hcGkiLCAnW2RhdGEtdG9nZ2xlXj0iYnV0dG9uIl0nLCAoZnVuY3Rpb24odCkgewogICAgICAgIHZhciBuID0gdC50YXJnZXQsCiAgICAgICAgICAgIGkgPSBuOwogICAgICAgIGlmIChlKG4pLmhhc0NsYXNzKCJidG4iKSB8fCAobiA9IGUobikuY2xvc2VzdCgiLmJ0biIpWzBdKSwgIW4gfHwgbi5oYXNBdHRyaWJ1dGUoImRpc2FibGVkIikgfHwgbi5jbGFzc0xpc3QuY29udGFpbnMoImRpc2FibGVkIikpIHQucHJldmVudERlZmF1bHQoKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdmFyIG8gPSBuLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Om5vdChbdHlwZT0iaGlkZGVuIl0pJyk7CiAgICAgICAgICAgIGlmIChvICYmIChvLmhhc0F0dHJpYnV0ZSgiZGlzYWJsZWQiKSB8fCBvLmNsYXNzTGlzdC5jb250YWlucygiZGlzYWJsZWQiKSkpIHJldHVybiB2b2lkIHQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgKCJMQUJFTCIgIT09IGkudGFnTmFtZSB8fCBvICYmICJjaGVja2JveCIgIT09IG8udHlwZSkgJiYgZC5falF1ZXJ5SW50ZXJmYWNlLmNhbGwoZShuKSwgInRvZ2dsZSIpCiAgICAgICAgfQogICAgfSkpLm9uKCJmb2N1cy5icy5idXR0b24uZGF0YS1hcGkgYmx1ci5icy5idXR0b24uZGF0YS1hcGkiLCAnW2RhdGEtdG9nZ2xlXj0iYnV0dG9uIl0nLCAoZnVuY3Rpb24odCkgewogICAgICAgIHZhciBuID0gZSh0LnRhcmdldCkuY2xvc2VzdCgiLmJ0biIpWzBdOwogICAgICAgIGUobikudG9nZ2xlQ2xhc3MoImZvY3VzIiwgL15mb2N1cyhpbik/JC8udGVzdCh0LnR5cGUpKQogICAgfSkpLCBlKHdpbmRvdykub24oImxvYWQuYnMuYnV0dG9uLmRhdGEtYXBpIiwgKGZ1bmN0aW9uKCkgewogICAgICAgIGZvciAodmFyIHQgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXRvZ2dsZT0iYnV0dG9ucyJdIC5idG4nKSksIGUgPSAwLCBuID0gdC5sZW5ndGg7IGUgPCBuOyBlKyspIHsKICAgICAgICAgICAgdmFyIGkgPSB0W2VdLAogICAgICAgICAgICAgICAgbyA9IGkucXVlcnlTZWxlY3RvcignaW5wdXQ6bm90KFt0eXBlPSJoaWRkZW4iXSknKTsKICAgICAgICAgICAgby5jaGVja2VkIHx8IG8uaGFzQXR0cmlidXRlKCJjaGVja2VkIikgPyBpLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpIDogaS5jbGFzc0xpc3QucmVtb3ZlKCJhY3RpdmUiKQogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBzID0gMCwgciA9ICh0ID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS10b2dnbGU9ImJ1dHRvbiJdJykpKS5sZW5ndGg7IHMgPCByOyBzKyspIHsKICAgICAgICAgICAgdmFyIGEgPSB0W3NdOwogICAgICAgICAgICAidHJ1ZSIgPT09IGEuZ2V0QXR0cmlidXRlKCJhcmlhLXByZXNzZWQiKSA/IGEuY2xhc3NMaXN0LmFkZCgiYWN0aXZlIikgOiBhLmNsYXNzTGlzdC5yZW1vdmUoImFjdGl2ZSIpCiAgICAgICAgfQogICAgfSkpLCBlLmZuLmJ1dHRvbiA9IGQuX2pRdWVyeUludGVyZmFjZSwgZS5mbi5idXR0b24uQ29uc3RydWN0b3IgPSBkLCBlLmZuLmJ1dHRvbi5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGUuZm4uYnV0dG9uID0gdSwgZC5falF1ZXJ5SW50ZXJmYWNlCiAgICB9OwogICAgdmFyIGYgPSAiY2Fyb3VzZWwiLAogICAgICAgIGcgPSAiLmJzLmNhcm91c2VsIiwKICAgICAgICBtID0gZS5mbltmXSwKICAgICAgICBwID0gewogICAgICAgICAgICBpbnRlcnZhbDogNWUzLAogICAgICAgICAgICBrZXlib2FyZDogITAsCiAgICAgICAgICAgIHNsaWRlOiAhMSwKICAgICAgICAgICAgcGF1c2U6ICJob3ZlciIsCiAgICAgICAgICAgIHdyYXA6ICEwLAogICAgICAgICAgICB0b3VjaDogITAKICAgICAgICB9LAogICAgICAgIF8gPSB7CiAgICAgICAgICAgIGludGVydmFsOiAiKG51bWJlcnxib29sZWFuKSIsCiAgICAgICAgICAgIGtleWJvYXJkOiAiYm9vbGVhbiIsCiAgICAgICAgICAgIHNsaWRlOiAiKGJvb2xlYW58c3RyaW5nKSIsCiAgICAgICAgICAgIHBhdXNlOiAiKHN0cmluZ3xib29sZWFuKSIsCiAgICAgICAgICAgIHdyYXA6ICJib29sZWFuIiwKICAgICAgICAgICAgdG91Y2g6ICJib29sZWFuIgogICAgICAgIH0sCiAgICAgICAgdiA9IHsKICAgICAgICAgICAgVE9VQ0g6ICJ0b3VjaCIsCiAgICAgICAgICAgIFBFTjogInBlbiIKICAgICAgICB9LAogICAgICAgIGIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZnVuY3Rpb24gdCh0LCBlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtcyA9IG51bGwsIHRoaXMuX2ludGVydmFsID0gbnVsbCwgdGhpcy5fYWN0aXZlRWxlbWVudCA9IG51bGwsIHRoaXMuX2lzUGF1c2VkID0gITEsIHRoaXMuX2lzU2xpZGluZyA9ICExLCB0aGlzLnRvdWNoVGltZW91dCA9IG51bGwsIHRoaXMudG91Y2hTdGFydFggPSAwLCB0aGlzLnRvdWNoRGVsdGFYID0gMCwgdGhpcy5fY29uZmlnID0gdGhpcy5fZ2V0Q29uZmlnKGUpLCB0aGlzLl9lbGVtZW50ID0gdCwgdGhpcy5faW5kaWNhdG9yc0VsZW1lbnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoIi5jYXJvdXNlbC1pbmRpY2F0b3JzIiksIHRoaXMuX3RvdWNoU3VwcG9ydGVkID0gIm9udG91Y2hzdGFydCIgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50IHx8IG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyA+IDAsIHRoaXMuX3BvaW50ZXJFdmVudCA9IEJvb2xlYW4od2luZG93LlBvaW50ZXJFdmVudCB8fCB3aW5kb3cuTVNQb2ludGVyRXZlbnQpLCB0aGlzLl9hZGRFdmVudExpc3RlbmVycygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG4gPSB0LnByb3RvdHlwZTsKICAgICAgICAgICAgcmV0dXJuIG4ubmV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdGhpcy5faXNTbGlkaW5nIHx8IHRoaXMuX3NsaWRlKCJuZXh0IikKICAgICAgICAgICAgfSwgbi5uZXh0V2hlblZpc2libGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICFkb2N1bWVudC5oaWRkZW4gJiYgZSh0aGlzLl9lbGVtZW50KS5pcygiOnZpc2libGUiKSAmJiAiaGlkZGVuIiAhPT0gZSh0aGlzLl9lbGVtZW50KS5jc3MoInZpc2liaWxpdHkiKSAmJiB0aGlzLm5leHQoKQogICAgICAgICAgICB9LCBuLnByZXYgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2lzU2xpZGluZyB8fCB0aGlzLl9zbGlkZSgicHJldiIpCiAgICAgICAgICAgIH0sIG4ucGF1c2UgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICB0IHx8ICh0aGlzLl9pc1BhdXNlZCA9ICEwKSwgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCIuY2Fyb3VzZWwtaXRlbS1uZXh0LCAuY2Fyb3VzZWwtaXRlbS1wcmV2IikgJiYgKGEudHJpZ2dlclRyYW5zaXRpb25FbmQodGhpcy5fZWxlbWVudCksIHRoaXMuY3ljbGUoITApKSwgY2xlYXJJbnRlcnZhbCh0aGlzLl9pbnRlcnZhbCksIHRoaXMuX2ludGVydmFsID0gbnVsbAogICAgICAgICAgICB9LCBuLmN5Y2xlID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgdCB8fCAodGhpcy5faXNQYXVzZWQgPSAhMSksIHRoaXMuX2ludGVydmFsICYmIChjbGVhckludGVydmFsKHRoaXMuX2ludGVydmFsKSwgdGhpcy5faW50ZXJ2YWwgPSBudWxsKSwgdGhpcy5fY29uZmlnLmludGVydmFsICYmICF0aGlzLl9pc1BhdXNlZCAmJiAodGhpcy5faW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlID8gdGhpcy5uZXh0V2hlblZpc2libGUgOiB0aGlzLm5leHQpLmJpbmQodGhpcyksIHRoaXMuX2NvbmZpZy5pbnRlcnZhbCkpCiAgICAgICAgICAgIH0sIG4udG8gPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmVFbGVtZW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCIuYWN0aXZlLmNhcm91c2VsLWl0ZW0iKTsKICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy5fZ2V0SXRlbUluZGV4KHRoaXMuX2FjdGl2ZUVsZW1lbnQpOwogICAgICAgICAgICAgICAgaWYgKCEodCA+IHRoaXMuX2l0ZW1zLmxlbmd0aCAtIDEgfHwgdCA8IDApKQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc1NsaWRpbmcpIGUodGhpcy5fZWxlbWVudCkub25lKCJzbGlkLmJzLmNhcm91c2VsIiwgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi50byh0KQogICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IHQpIHJldHVybiB0aGlzLnBhdXNlKCksIHZvaWQgdGhpcy5jeWNsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IHQgPiBpID8gIm5leHQiIDogInByZXYiOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zbGlkZShvLCB0aGlzLl9pdGVtc1t0XSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIG4uZGlzcG9zZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZSh0aGlzLl9lbGVtZW50KS5vZmYoZyksIGUucmVtb3ZlRGF0YSh0aGlzLl9lbGVtZW50LCAiYnMuY2Fyb3VzZWwiKSwgdGhpcy5faXRlbXMgPSBudWxsLCB0aGlzLl9jb25maWcgPSBudWxsLCB0aGlzLl9lbGVtZW50ID0gbnVsbCwgdGhpcy5faW50ZXJ2YWwgPSBudWxsLCB0aGlzLl9pc1BhdXNlZCA9IG51bGwsIHRoaXMuX2lzU2xpZGluZyA9IG51bGwsIHRoaXMuX2FjdGl2ZUVsZW1lbnQgPSBudWxsLCB0aGlzLl9pbmRpY2F0b3JzRWxlbWVudCA9IG51bGwKICAgICAgICAgICAgfSwgbi5fZ2V0Q29uZmlnID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHQgPSBzKHt9LCBwLCB0KSwgYS50eXBlQ2hlY2tDb25maWcoZiwgdCwgXyksIHQKICAgICAgICAgICAgfSwgbi5faGFuZGxlU3dpcGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gTWF0aC5hYnModGhpcy50b3VjaERlbHRhWCk7CiAgICAgICAgICAgICAgICBpZiAoISh0IDw9IDQwKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBlID0gdCAvIHRoaXMudG91Y2hEZWx0YVg7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50b3VjaERlbHRhWCA9IDAsIGUgPiAwICYmIHRoaXMucHJldigpLCBlIDwgMCAmJiB0aGlzLm5leHQoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBuLl9hZGRFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy5fY29uZmlnLmtleWJvYXJkICYmIGUodGhpcy5fZWxlbWVudCkub24oImtleWRvd24uYnMuY2Fyb3VzZWwiLCAoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0Ll9rZXlkb3duKGUpCiAgICAgICAgICAgICAgICB9KSksICJob3ZlciIgPT09IHRoaXMuX2NvbmZpZy5wYXVzZSAmJiBlKHRoaXMuX2VsZW1lbnQpLm9uKCJtb3VzZWVudGVyLmJzLmNhcm91c2VsIiwgKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5wYXVzZShlKQogICAgICAgICAgICAgICAgfSkpLm9uKCJtb3VzZWxlYXZlLmJzLmNhcm91c2VsIiwgKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5jeWNsZShlKQogICAgICAgICAgICAgICAgfSkpLCB0aGlzLl9jb25maWcudG91Y2ggJiYgdGhpcy5fYWRkVG91Y2hFdmVudExpc3RlbmVycygpCiAgICAgICAgICAgIH0sIG4uX2FkZFRvdWNoRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpczsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl90b3VjaFN1cHBvcnRlZCkgewogICAgICAgICAgICAgICAgICAgIHZhciBuID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5fcG9pbnRlckV2ZW50ICYmIHZbZS5vcmlnaW5hbEV2ZW50LnBvaW50ZXJUeXBlLnRvVXBwZXJDYXNlKCldID8gdC50b3VjaFN0YXJ0WCA9IGUub3JpZ2luYWxFdmVudC5jbGllbnRYIDogdC5fcG9pbnRlckV2ZW50IHx8ICh0LnRvdWNoU3RhcnRYID0gZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WCkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgaSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuX3BvaW50ZXJFdmVudCAmJiB2W2Uub3JpZ2luYWxFdmVudC5wb2ludGVyVHlwZS50b1VwcGVyQ2FzZSgpXSAmJiAodC50b3VjaERlbHRhWCA9IGUub3JpZ2luYWxFdmVudC5jbGllbnRYIC0gdC50b3VjaFN0YXJ0WCksIHQuX2hhbmRsZVN3aXBlKCksICJob3ZlciIgPT09IHQuX2NvbmZpZy5wYXVzZSAmJiAodC5wYXVzZSgpLCB0LnRvdWNoVGltZW91dCAmJiBjbGVhclRpbWVvdXQodC50b3VjaFRpbWVvdXQpLCB0LnRvdWNoVGltZW91dCA9IHNldFRpbWVvdXQoKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5jeWNsZShlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIDUwMCArIHQuX2NvbmZpZy5pbnRlcnZhbCkpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgZSh0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5jYXJvdXNlbC1pdGVtIGltZyIpKS5vbigiZHJhZ3N0YXJ0LmJzLmNhcm91c2VsIiwgKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQucHJldmVudERlZmF1bHQoKQogICAgICAgICAgICAgICAgICAgIH0pKSwgdGhpcy5fcG9pbnRlckV2ZW50ID8gKGUodGhpcy5fZWxlbWVudCkub24oInBvaW50ZXJkb3duLmJzLmNhcm91c2VsIiwgKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4odCkKICAgICAgICAgICAgICAgICAgICB9KSksIGUodGhpcy5fZWxlbWVudCkub24oInBvaW50ZXJ1cC5icy5jYXJvdXNlbCIsIChmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpKHQpCiAgICAgICAgICAgICAgICAgICAgfSkpLCB0aGlzLl9lbGVtZW50LmNsYXNzTGlzdC5hZGQoInBvaW50ZXItZXZlbnQiKSkgOiAoZSh0aGlzLl9lbGVtZW50KS5vbigidG91Y2hzdGFydC5icy5jYXJvdXNlbCIsIChmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuKHQpCiAgICAgICAgICAgICAgICAgICAgfSkpLCBlKHRoaXMuX2VsZW1lbnQpLm9uKCJ0b3VjaG1vdmUuYnMuY2Fyb3VzZWwiLCAoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXMgJiYgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXMubGVuZ3RoID4gMSA/IHQudG91Y2hEZWx0YVggPSAwIDogdC50b3VjaERlbHRhWCA9IGUub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLmNsaWVudFggLSB0LnRvdWNoU3RhcnRYCiAgICAgICAgICAgICAgICAgICAgICAgIH0oZSkKICAgICAgICAgICAgICAgICAgICB9KSksIGUodGhpcy5fZWxlbWVudCkub24oInRvdWNoZW5kLmJzLmNhcm91c2VsIiwgKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkodCkKICAgICAgICAgICAgICAgICAgICB9KSkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIG4uX2tleWRvd24gPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICBpZiAoIS9pbnB1dHx0ZXh0YXJlYS9pLnRlc3QodC50YXJnZXQudGFnTmFtZSkpIHN3aXRjaCAodC53aGljaCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMzc6CiAgICAgICAgICAgICAgICAgICAgICAgIHQucHJldmVudERlZmF1bHQoKSwgdGhpcy5wcmV2KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzk6CiAgICAgICAgICAgICAgICAgICAgICAgIHQucHJldmVudERlZmF1bHQoKSwgdGhpcy5uZXh0KCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbi5fZ2V0SXRlbUluZGV4ID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zID0gdCAmJiB0LnBhcmVudE5vZGUgPyBbXS5zbGljZS5jYWxsKHQucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yQWxsKCIuY2Fyb3VzZWwtaXRlbSIpKSA6IFtdLCB0aGlzLl9pdGVtcy5pbmRleE9mKHQpCiAgICAgICAgICAgIH0sIG4uX2dldEl0ZW1CeURpcmVjdGlvbiA9IGZ1bmN0aW9uKHQsIGUpIHsKICAgICAgICAgICAgICAgIHZhciBuID0gIm5leHQiID09PSB0LAogICAgICAgICAgICAgICAgICAgIGkgPSAicHJldiIgPT09IHQsCiAgICAgICAgICAgICAgICAgICAgbyA9IHRoaXMuX2dldEl0ZW1JbmRleChlKSwKICAgICAgICAgICAgICAgICAgICBzID0gdGhpcy5faXRlbXMubGVuZ3RoIC0gMTsKICAgICAgICAgICAgICAgIGlmICgoaSAmJiAwID09PSBvIHx8IG4gJiYgbyA9PT0gcykgJiYgIXRoaXMuX2NvbmZpZy53cmFwKSByZXR1cm4gZTsKICAgICAgICAgICAgICAgIHZhciByID0gKG8gKyAoInByZXYiID09PSB0ID8gLTEgOiAxKSkgJSB0aGlzLl9pdGVtcy5sZW5ndGg7CiAgICAgICAgICAgICAgICByZXR1cm4gLTEgPT09IHIgPyB0aGlzLl9pdGVtc1t0aGlzLl9pdGVtcy5sZW5ndGggLSAxXSA6IHRoaXMuX2l0ZW1zW3JdCiAgICAgICAgICAgIH0sIG4uX3RyaWdnZXJTbGlkZUV2ZW50ID0gZnVuY3Rpb24odCwgbikgewogICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLl9nZXRJdGVtSW5kZXgodCksCiAgICAgICAgICAgICAgICAgICAgbyA9IHRoaXMuX2dldEl0ZW1JbmRleCh0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoIi5hY3RpdmUuY2Fyb3VzZWwtaXRlbSIpKSwKICAgICAgICAgICAgICAgICAgICBzID0gZS5FdmVudCgic2xpZGUuYnMuY2Fyb3VzZWwiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0ZWRUYXJnZXQ6IHQsCiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogbiwKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogbywKICAgICAgICAgICAgICAgICAgICAgICAgdG86IGkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBlKHRoaXMuX2VsZW1lbnQpLnRyaWdnZXIocyksIHMKICAgICAgICAgICAgfSwgbi5fc2V0QWN0aXZlSW5kaWNhdG9yRWxlbWVudCA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pbmRpY2F0b3JzRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgIHZhciBuID0gW10uc2xpY2UuY2FsbCh0aGlzLl9pbmRpY2F0b3JzRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuYWN0aXZlIikpOwogICAgICAgICAgICAgICAgICAgIGUobikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy5faW5kaWNhdG9yc0VsZW1lbnQuY2hpbGRyZW5bdGhpcy5fZ2V0SXRlbUluZGV4KHQpXTsKICAgICAgICAgICAgICAgICAgICBpICYmIGUoaSkuYWRkQ2xhc3MoImFjdGl2ZSIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIG4uX3NsaWRlID0gZnVuY3Rpb24odCwgbikgewogICAgICAgICAgICAgICAgdmFyIGksIG8sIHMsIHIgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgIGwgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoIi5hY3RpdmUuY2Fyb3VzZWwtaXRlbSIpLAogICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLl9nZXRJdGVtSW5kZXgobCksCiAgICAgICAgICAgICAgICAgICAgaCA9IG4gfHwgbCAmJiB0aGlzLl9nZXRJdGVtQnlEaXJlY3Rpb24odCwgbCksCiAgICAgICAgICAgICAgICAgICAgdSA9IHRoaXMuX2dldEl0ZW1JbmRleChoKSwKICAgICAgICAgICAgICAgICAgICBkID0gQm9vbGVhbih0aGlzLl9pbnRlcnZhbCk7CiAgICAgICAgICAgICAgICBpZiAoIm5leHQiID09PSB0ID8gKGkgPSAiY2Fyb3VzZWwtaXRlbS1sZWZ0IiwgbyA9ICJjYXJvdXNlbC1pdGVtLW5leHQiLCBzID0gImxlZnQiKSA6IChpID0gImNhcm91c2VsLWl0ZW0tcmlnaHQiLCBvID0gImNhcm91c2VsLWl0ZW0tcHJldiIsIHMgPSAicmlnaHQiKSwgaCAmJiBlKGgpLmhhc0NsYXNzKCJhY3RpdmUiKSkgdGhpcy5faXNTbGlkaW5nID0gITE7CiAgICAgICAgICAgICAgICBlbHNlIGlmICghdGhpcy5fdHJpZ2dlclNsaWRlRXZlbnQoaCwgcykuaXNEZWZhdWx0UHJldmVudGVkKCkgJiYgbCAmJiBoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNTbGlkaW5nID0gITAsIGQgJiYgdGhpcy5wYXVzZSgpLCB0aGlzLl9zZXRBY3RpdmVJbmRpY2F0b3JFbGVtZW50KGgpOwogICAgICAgICAgICAgICAgICAgIHZhciBmID0gZS5FdmVudCgic2xpZC5icy5jYXJvdXNlbCIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRlZFRhcmdldDogaCwKICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBzLAogICAgICAgICAgICAgICAgICAgICAgICBmcm9tOiBjLAogICAgICAgICAgICAgICAgICAgICAgICB0bzogdQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChlKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKCJzbGlkZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoaCkuYWRkQ2xhc3MobyksIGEucmVmbG93KGgpLCBlKGwpLmFkZENsYXNzKGkpLCBlKGgpLmFkZENsYXNzKGkpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IHBhcnNlSW50KGguZ2V0QXR0cmlidXRlKCJkYXRhLWludGVydmFsIiksIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZyA/ICh0aGlzLl9jb25maWcuZGVmYXVsdEludGVydmFsID0gdGhpcy5fY29uZmlnLmRlZmF1bHRJbnRlcnZhbCB8fCB0aGlzLl9jb25maWcuaW50ZXJ2YWwsIHRoaXMuX2NvbmZpZy5pbnRlcnZhbCA9IGcpIDogdGhpcy5fY29uZmlnLmludGVydmFsID0gdGhpcy5fY29uZmlnLmRlZmF1bHRJbnRlcnZhbCB8fCB0aGlzLl9jb25maWcuaW50ZXJ2YWw7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gYS5nZXRUcmFuc2l0aW9uRHVyYXRpb25Gcm9tRWxlbWVudChsKTsKICAgICAgICAgICAgICAgICAgICAgICAgZShsKS5vbmUoYS5UUkFOU0lUSU9OX0VORCwgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZShoKS5yZW1vdmVDbGFzcyhpICsgIiAiICsgbykuYWRkQ2xhc3MoImFjdGl2ZSIpLCBlKGwpLnJlbW92ZUNsYXNzKCJhY3RpdmUgIiArIG8gKyAiICIgKyBpKSwgci5faXNTbGlkaW5nID0gITEsIHNldFRpbWVvdXQoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlKHIuX2VsZW1lbnQpLnRyaWdnZXIoZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAwKQogICAgICAgICAgICAgICAgICAgICAgICB9KSkuZW11bGF0ZVRyYW5zaXRpb25FbmQobSkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgZShsKS5yZW1vdmVDbGFzcygiYWN0aXZlIiksIGUoaCkuYWRkQ2xhc3MoImFjdGl2ZSIpLCB0aGlzLl9pc1NsaWRpbmcgPSAhMSwgZSh0aGlzLl9lbGVtZW50KS50cmlnZ2VyKGYpOwogICAgICAgICAgICAgICAgICAgIGQgJiYgdGhpcy5jeWNsZSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHQuX2pRdWVyeUludGVyZmFjZSA9IGZ1bmN0aW9uKG4pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBpID0gZSh0aGlzKS5kYXRhKCJicy5jYXJvdXNlbCIpLAogICAgICAgICAgICAgICAgICAgICAgICBvID0gcyh7fSwgcCwgZSh0aGlzKS5kYXRhKCkpOwogICAgICAgICAgICAgICAgICAgICJvYmplY3QiID09IHR5cGVvZiBuICYmIChvID0gcyh7fSwgbywgbikpOwogICAgICAgICAgICAgICAgICAgIHZhciByID0gInN0cmluZyIgPT0gdHlwZW9mIG4gPyBuIDogby5zbGlkZTsKICAgICAgICAgICAgICAgICAgICBpZiAoaSB8fCAoaSA9IG5ldyB0KHRoaXMsIG8pLCBlKHRoaXMpLmRhdGEoImJzLmNhcm91c2VsIiwgaSkpLCAibnVtYmVyIiA9PSB0eXBlb2YgbikgaS50byhuKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgcikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoInVuZGVmaW5lZCIgPT0gdHlwZW9mIGlbcl0pIHRocm93IG5ldyBUeXBlRXJyb3IoJ05vIG1ldGhvZCBuYW1lZCAiJyArIHIgKyAnIicpOwogICAgICAgICAgICAgICAgICAgICAgICBpW3JdKCkKICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugby5pbnRlcnZhbCAmJiBvLnJpZGUgJiYgKGkucGF1c2UoKSwgaS5jeWNsZSgpKQogICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIH0sIHQuX2RhdGFBcGlDbGlja0hhbmRsZXIgPSBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgICAgICB2YXIgaSA9IGEuZ2V0U2VsZWN0b3JGcm9tRWxlbWVudCh0aGlzKTsKICAgICAgICAgICAgICAgIGlmIChpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSBlKGkpWzBdOwogICAgICAgICAgICAgICAgICAgIGlmIChvICYmIGUobykuaGFzQ2xhc3MoImNhcm91c2VsIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSBzKHt9LCBlKG8pLmRhdGEoKSwgZSh0aGlzKS5kYXRhKCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHRoaXMuZ2V0QXR0cmlidXRlKCJkYXRhLXNsaWRlLXRvIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGwgJiYgKHIuaW50ZXJ2YWwgPSAhMSksIHQuX2pRdWVyeUludGVyZmFjZS5jYWxsKGUobyksIHIpLCBsICYmIGUobykuZGF0YSgiYnMuY2Fyb3VzZWwiKS50byhsKSwgbi5wcmV2ZW50RGVmYXVsdCgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBvKHQsIG51bGwsIFt7CiAgICAgICAgICAgICAgICBrZXk6ICJWRVJTSU9OIiwKICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI0LjUuMiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAga2V5OiAiRGVmYXVsdCIsCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dKSwgdAogICAgICAgIH0oKTsKICAgIGUoZG9jdW1lbnQpLm9uKCJjbGljay5icy5jYXJvdXNlbC5kYXRhLWFwaSIsICJbZGF0YS1zbGlkZV0sIFtkYXRhLXNsaWRlLXRvXSIsIGIuX2RhdGFBcGlDbGlja0hhbmRsZXIpLCBlKHdpbmRvdykub24oImxvYWQuYnMuY2Fyb3VzZWwuZGF0YS1hcGkiLCAoZnVuY3Rpb24oKSB7CiAgICAgICAgZm9yICh2YXIgdCA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtcmlkZT0iY2Fyb3VzZWwiXScpKSwgbiA9IDAsIGkgPSB0Lmxlbmd0aDsgbiA8IGk7IG4rKykgewogICAgICAgICAgICB2YXIgbyA9IGUodFtuXSk7CiAgICAgICAgICAgIGIuX2pRdWVyeUludGVyZmFjZS5jYWxsKG8sIG8uZGF0YSgpKQogICAgICAgIH0KICAgIH0pKSwgZS5mbltmXSA9IGIuX2pRdWVyeUludGVyZmFjZSwgZS5mbltmXS5Db25zdHJ1Y3RvciA9IGIsIGUuZm5bZl0ubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBlLmZuW2ZdID0gbSwgYi5falF1ZXJ5SW50ZXJmYWNlCiAgICB9OwogICAgdmFyIHkgPSAiY29sbGFwc2UiLAogICAgICAgIEUgPSBlLmZuW3ldLAogICAgICAgIHcgPSB7CiAgICAgICAgICAgIHRvZ2dsZTogITAsCiAgICAgICAgICAgIHBhcmVudDogIiIKICAgICAgICB9LAogICAgICAgIFQgPSB7CiAgICAgICAgICAgIHRvZ2dsZTogImJvb2xlYW4iLAogICAgICAgICAgICBwYXJlbnQ6ICIoc3RyaW5nfGVsZW1lbnQpIgogICAgICAgIH0sCiAgICAgICAgQyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBmdW5jdGlvbiB0KHQsIGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2lzVHJhbnNpdGlvbmluZyA9ICExLCB0aGlzLl9lbGVtZW50ID0gdCwgdGhpcy5fY29uZmlnID0gdGhpcy5fZ2V0Q29uZmlnKGUpLCB0aGlzLl90cmlnZ2VyQXJyYXkgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXRvZ2dsZT0iY29sbGFwc2UiXVtocmVmPSIjJyArIHQuaWQgKyAnIl0sW2RhdGEtdG9nZ2xlPSJjb2xsYXBzZSJdW2RhdGEtdGFyZ2V0PSIjJyArIHQuaWQgKyAnIl0nKSk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBuID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS10b2dnbGU9ImNvbGxhcHNlIl0nKSksIGkgPSAwLCBvID0gbi5sZW5ndGg7IGkgPCBvOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IG5baV0sCiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBhLmdldFNlbGVjdG9yRnJvbUVsZW1lbnQocyksCiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocikpLmZpbHRlcigoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgPT09IHQKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIG51bGwgIT09IHIgJiYgbC5sZW5ndGggPiAwICYmICh0aGlzLl9zZWxlY3RvciA9IHIsIHRoaXMuX3RyaWdnZXJBcnJheS5wdXNoKHMpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50ID0gdGhpcy5fY29uZmlnLnBhcmVudCA/IHRoaXMuX2dldFBhcmVudCgpIDogbnVsbCwgdGhpcy5fY29uZmlnLnBhcmVudCB8fCB0aGlzLl9hZGRBcmlhQW5kQ29sbGFwc2VkQ2xhc3ModGhpcy5fZWxlbWVudCwgdGhpcy5fdHJpZ2dlckFycmF5KSwgdGhpcy5fY29uZmlnLnRvZ2dsZSAmJiB0aGlzLnRvZ2dsZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG4gPSB0LnByb3RvdHlwZTsKICAgICAgICAgICAgcmV0dXJuIG4udG9nZ2xlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBlKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKCJzaG93IikgPyB0aGlzLmhpZGUoKSA6IHRoaXMuc2hvdygpCiAgICAgICAgICAgIH0sIG4uc2hvdyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIG4sIGksIG8gPSB0aGlzOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc1RyYW5zaXRpb25pbmcgJiYgIWUodGhpcy5fZWxlbWVudCkuaGFzQ2xhc3MoInNob3ciKSAmJiAodGhpcy5fcGFyZW50ICYmIDAgPT09IChuID0gW10uc2xpY2UuY2FsbCh0aGlzLl9wYXJlbnQucXVlcnlTZWxlY3RvckFsbCgiLnNob3csIC5jb2xsYXBzaW5nIikpLmZpbHRlcigoZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIG8uX2NvbmZpZy5wYXJlbnQgPyB0LmdldEF0dHJpYnV0ZSgiZGF0YS1wYXJlbnQiKSA9PT0gby5fY29uZmlnLnBhcmVudCA6IHQuY2xhc3NMaXN0LmNvbnRhaW5zKCJjb2xsYXBzZSIpCiAgICAgICAgICAgICAgICAgICAgfSkpKS5sZW5ndGggJiYgKG4gPSBudWxsKSwgIShuICYmIChpID0gZShuKS5ub3QodGhpcy5fc2VsZWN0b3IpLmRhdGEoImJzLmNvbGxhcHNlIikpICYmIGkuX2lzVHJhbnNpdGlvbmluZykpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBlLkV2ZW50KCJzaG93LmJzLmNvbGxhcHNlIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGUodGhpcy5fZWxlbWVudCkudHJpZ2dlcihzKSwgIXMuaXNEZWZhdWx0UHJldmVudGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbiAmJiAodC5falF1ZXJ5SW50ZXJmYWNlLmNhbGwoZShuKS5ub3QodGhpcy5fc2VsZWN0b3IpLCAiaGlkZSIpLCBpIHx8IGUobikuZGF0YSgiYnMuY29sbGFwc2UiLCBudWxsKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy5fZ2V0RGltZW5zaW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUodGhpcy5fZWxlbWVudCkucmVtb3ZlQ2xhc3MoImNvbGxhcHNlIikuYWRkQ2xhc3MoImNvbGxhcHNpbmciKSwgdGhpcy5fZWxlbWVudC5zdHlsZVtyXSA9IDAsIHRoaXMuX3RyaWdnZXJBcnJheS5sZW5ndGggJiYgZSh0aGlzLl90cmlnZ2VyQXJyYXkpLnJlbW92ZUNsYXNzKCJjb2xsYXBzZWQiKS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwgITApLCB0aGlzLnNldFRyYW5zaXRpb25pbmcoITApOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9ICJzY3JvbGwiICsgKHJbMF0udG9VcHBlckNhc2UoKSArIHIuc2xpY2UoMSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGEuZ2V0VHJhbnNpdGlvbkR1cmF0aW9uRnJvbUVsZW1lbnQodGhpcy5fZWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUodGhpcy5fZWxlbWVudCkub25lKGEuVFJBTlNJVElPTl9FTkQsIChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUoby5fZWxlbWVudCkucmVtb3ZlQ2xhc3MoImNvbGxhcHNpbmciKS5hZGRDbGFzcygiY29sbGFwc2Ugc2hvdyIpLCBvLl9lbGVtZW50LnN0eWxlW3JdID0gIiIsIG8uc2V0VHJhbnNpdGlvbmluZyghMSksIGUoby5fZWxlbWVudCkudHJpZ2dlcigic2hvd24uYnMuY29sbGFwc2UiKQogICAgICAgICAgICAgICAgICAgICAgICB9KSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoYyksIHRoaXMuX2VsZW1lbnQuc3R5bGVbcl0gPSB0aGlzLl9lbGVtZW50W2xdICsgInB4IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbi5oaWRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzVHJhbnNpdGlvbmluZyAmJiBlKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKCJzaG93IikpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGUuRXZlbnQoImhpZGUuYnMuY29sbGFwc2UiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZSh0aGlzLl9lbGVtZW50KS50cmlnZ2VyKG4pLCAhbi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuX2dldERpbWVuc2lvbigpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlW2ldID0gdGhpcy5fZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVtpXSArICJweCIsIGEucmVmbG93KHRoaXMuX2VsZW1lbnQpLCBlKHRoaXMuX2VsZW1lbnQpLmFkZENsYXNzKCJjb2xsYXBzaW5nIikucmVtb3ZlQ2xhc3MoImNvbGxhcHNlIHNob3ciKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSB0aGlzLl90cmlnZ2VyQXJyYXkubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobyA+IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBzID0gMDsgcyA8IG87IHMrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy5fdHJpZ2dlckFycmF5W3NdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYS5nZXRTZWxlY3RvckZyb21FbGVtZW50KHIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSBsKSBlKFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChsKSkpLmhhc0NsYXNzKCJzaG93IikgfHwgZShyKS5hZGRDbGFzcygiY29sbGFwc2VkIikuYXR0cigiYXJpYS1leHBhbmRlZCIsICExKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFRyYW5zaXRpb25pbmcoITApOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlW2ldID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYS5nZXRUcmFuc2l0aW9uRHVyYXRpb25Gcm9tRWxlbWVudCh0aGlzLl9lbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgZSh0aGlzLl9lbGVtZW50KS5vbmUoYS5UUkFOU0lUSU9OX0VORCwgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5zZXRUcmFuc2l0aW9uaW5nKCExKSwgZSh0Ll9lbGVtZW50KS5yZW1vdmVDbGFzcygiY29sbGFwc2luZyIpLmFkZENsYXNzKCJjb2xsYXBzZSIpLnRyaWdnZXIoImhpZGRlbi5icy5jb2xsYXBzZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKS5lbXVsYXRlVHJhbnNpdGlvbkVuZChjKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbi5zZXRUcmFuc2l0aW9uaW5nID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgdGhpcy5faXNUcmFuc2l0aW9uaW5nID0gdAogICAgICAgICAgICB9LCBuLmRpc3Bvc2UgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGUucmVtb3ZlRGF0YSh0aGlzLl9lbGVtZW50LCAiYnMuY29sbGFwc2UiKSwgdGhpcy5fY29uZmlnID0gbnVsbCwgdGhpcy5fcGFyZW50ID0gbnVsbCwgdGhpcy5fZWxlbWVudCA9IG51bGwsIHRoaXMuX3RyaWdnZXJBcnJheSA9IG51bGwsIHRoaXMuX2lzVHJhbnNpdGlvbmluZyA9IG51bGwKICAgICAgICAgICAgfSwgbi5fZ2V0Q29uZmlnID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgcmV0dXJuICh0ID0gcyh7fSwgdywgdCkpLnRvZ2dsZSA9IEJvb2xlYW4odC50b2dnbGUpLCBhLnR5cGVDaGVja0NvbmZpZyh5LCB0LCBUKSwgdAogICAgICAgICAgICB9LCBuLl9nZXREaW1lbnNpb24gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKCJ3aWR0aCIpID8gIndpZHRoIiA6ICJoZWlnaHQiCiAgICAgICAgICAgIH0sIG4uX2dldFBhcmVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIG4sIGkgPSB0aGlzOwogICAgICAgICAgICAgICAgYS5pc0VsZW1lbnQodGhpcy5fY29uZmlnLnBhcmVudCkgPyAobiA9IHRoaXMuX2NvbmZpZy5wYXJlbnQsICJ1bmRlZmluZWQiICE9IHR5cGVvZiB0aGlzLl9jb25maWcucGFyZW50LmpxdWVyeSAmJiAobiA9IHRoaXMuX2NvbmZpZy5wYXJlbnRbMF0pKSA6IG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NvbmZpZy5wYXJlbnQpOwogICAgICAgICAgICAgICAgdmFyIG8gPSAnW2RhdGEtdG9nZ2xlPSJjb2xsYXBzZSJdW2RhdGEtcGFyZW50PSInICsgdGhpcy5fY29uZmlnLnBhcmVudCArICciXScsCiAgICAgICAgICAgICAgICAgICAgcyA9IFtdLnNsaWNlLmNhbGwobi5xdWVyeVNlbGVjdG9yQWxsKG8pKTsKICAgICAgICAgICAgICAgIHJldHVybiBlKHMpLmVhY2goKGZ1bmN0aW9uKGUsIG4pIHsKICAgICAgICAgICAgICAgICAgICBpLl9hZGRBcmlhQW5kQ29sbGFwc2VkQ2xhc3ModC5fZ2V0VGFyZ2V0RnJvbUVsZW1lbnQobiksIFtuXSkKICAgICAgICAgICAgICAgIH0pKSwgbgogICAgICAgICAgICB9LCBuLl9hZGRBcmlhQW5kQ29sbGFwc2VkQ2xhc3MgPSBmdW5jdGlvbih0LCBuKSB7CiAgICAgICAgICAgICAgICB2YXIgaSA9IGUodCkuaGFzQ2xhc3MoInNob3ciKTsKICAgICAgICAgICAgICAgIG4ubGVuZ3RoICYmIGUobikudG9nZ2xlQ2xhc3MoImNvbGxhcHNlZCIsICFpKS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwgaSkKICAgICAgICAgICAgfSwgdC5fZ2V0VGFyZ2V0RnJvbUVsZW1lbnQgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICB2YXIgZSA9IGEuZ2V0U2VsZWN0b3JGcm9tRWxlbWVudCh0KTsKICAgICAgICAgICAgICAgIHJldHVybiBlID8gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlKSA6IG51bGwKICAgICAgICAgICAgfSwgdC5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24obikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaCgoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBlKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICBvID0gaS5kYXRhKCJicy5jb2xsYXBzZSIpLAogICAgICAgICAgICAgICAgICAgICAgICByID0gcyh7fSwgdywgaS5kYXRhKCksICJvYmplY3QiID09IHR5cGVvZiBuICYmIG4gPyBuIDoge30pOwogICAgICAgICAgICAgICAgICAgIGlmICghbyAmJiByLnRvZ2dsZSAmJiAic3RyaW5nIiA9PSB0eXBlb2YgbiAmJiAvc2hvd3xoaWRlLy50ZXN0KG4pICYmIChyLnRvZ2dsZSA9ICExKSwgbyB8fCAobyA9IG5ldyB0KHRoaXMsIHIpLCBpLmRhdGEoImJzLmNvbGxhcHNlIiwgbykpLCAic3RyaW5nIiA9PSB0eXBlb2YgbikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoInVuZGVmaW5lZCIgPT0gdHlwZW9mIG9bbl0pIHRocm93IG5ldyBUeXBlRXJyb3IoJ05vIG1ldGhvZCBuYW1lZCAiJyArIG4gKyAnIicpOwogICAgICAgICAgICAgICAgICAgICAgICBvW25dKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgfSwgbyh0LCBudWxsLCBbewogICAgICAgICAgICAgICAga2V5OiAiVkVSU0lPTiIsCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiNC41LjIiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGtleTogIkRlZmF1bHQiLAogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XSksIHQKICAgICAgICB9KCk7CiAgICBlKGRvY3VtZW50KS5vbigiY2xpY2suYnMuY29sbGFwc2UuZGF0YS1hcGkiLCAnW2RhdGEtdG9nZ2xlPSJjb2xsYXBzZSJdJywgKGZ1bmN0aW9uKHQpIHsKICAgICAgICAiQSIgPT09IHQuY3VycmVudFRhcmdldC50YWdOYW1lICYmIHQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2YXIgbiA9IGUodGhpcyksCiAgICAgICAgICAgIGkgPSBhLmdldFNlbGVjdG9yRnJvbUVsZW1lbnQodGhpcyksCiAgICAgICAgICAgIG8gPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoaSkpOwogICAgICAgIGUobykuZWFjaCgoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciB0ID0gZSh0aGlzKSwKICAgICAgICAgICAgICAgIGkgPSB0LmRhdGEoImJzLmNvbGxhcHNlIikgPyAidG9nZ2xlIiA6IG4uZGF0YSgpOwogICAgICAgICAgICBDLl9qUXVlcnlJbnRlcmZhY2UuY2FsbCh0LCBpKQogICAgICAgIH0pKQogICAgfSkpLCBlLmZuW3ldID0gQy5falF1ZXJ5SW50ZXJmYWNlLCBlLmZuW3ldLkNvbnN0cnVjdG9yID0gQywgZS5mblt5XS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGUuZm5beV0gPSBFLCBDLl9qUXVlcnlJbnRlcmZhY2UKICAgIH07CiAgICB2YXIgUyA9ICJkcm9wZG93biIsCiAgICAgICAgayA9IGUuZm5bU10sCiAgICAgICAgRCA9IG5ldyBSZWdFeHAoIjM4fDQwfDI3IiksCiAgICAgICAgTiA9IHsKICAgICAgICAgICAgb2Zmc2V0OiAwLAogICAgICAgICAgICBmbGlwOiAhMCwKICAgICAgICAgICAgYm91bmRhcnk6ICJzY3JvbGxQYXJlbnQiLAogICAgICAgICAgICByZWZlcmVuY2U6ICJ0b2dnbGUiLAogICAgICAgICAgICBkaXNwbGF5OiAiZHluYW1pYyIsCiAgICAgICAgICAgIHBvcHBlckNvbmZpZzogbnVsbAogICAgICAgIH0sCiAgICAgICAgQSA9IHsKICAgICAgICAgICAgb2Zmc2V0OiAiKG51bWJlcnxzdHJpbmd8ZnVuY3Rpb24pIiwKICAgICAgICAgICAgZmxpcDogImJvb2xlYW4iLAogICAgICAgICAgICBib3VuZGFyeTogIihzdHJpbmd8ZWxlbWVudCkiLAogICAgICAgICAgICByZWZlcmVuY2U6ICIoc3RyaW5nfGVsZW1lbnQpIiwKICAgICAgICAgICAgZGlzcGxheTogInN0cmluZyIsCiAgICAgICAgICAgIHBvcHBlckNvbmZpZzogIihudWxsfG9iamVjdCkiCiAgICAgICAgfSwKICAgICAgICBJID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHQodCwgZSkgewogICAgICAgICAgICAgICAgdGhpcy5fZWxlbWVudCA9IHQsIHRoaXMuX3BvcHBlciA9IG51bGwsIHRoaXMuX2NvbmZpZyA9IHRoaXMuX2dldENvbmZpZyhlKSwgdGhpcy5fbWVudSA9IHRoaXMuX2dldE1lbnVFbGVtZW50KCksIHRoaXMuX2luTmF2YmFyID0gdGhpcy5fZGV0ZWN0TmF2YmFyKCksIHRoaXMuX2FkZEV2ZW50TGlzdGVuZXJzKCkKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgaSA9IHQucHJvdG90eXBlOwogICAgICAgICAgICByZXR1cm4gaS50b2dnbGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fZWxlbWVudC5kaXNhYmxlZCAmJiAhZSh0aGlzLl9lbGVtZW50KS5oYXNDbGFzcygiZGlzYWJsZWQiKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBuID0gZSh0aGlzLl9tZW51KS5oYXNDbGFzcygic2hvdyIpOwogICAgICAgICAgICAgICAgICAgIHQuX2NsZWFyTWVudXMoKSwgbiB8fCB0aGlzLnNob3coITApCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGkuc2hvdyA9IGZ1bmN0aW9uKGkpIHsKICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGkgJiYgKGkgPSAhMSksICEodGhpcy5fZWxlbWVudC5kaXNhYmxlZCB8fCBlKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKCJkaXNhYmxlZCIpIHx8IGUodGhpcy5fbWVudSkuaGFzQ2xhc3MoInNob3ciKSkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0ZWRUYXJnZXQ6IHRoaXMuX2VsZW1lbnQKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgcyA9IGUuRXZlbnQoInNob3cuYnMuZHJvcGRvd24iLCBvKSwKICAgICAgICAgICAgICAgICAgICAgICAgciA9IHQuX2dldFBhcmVudEZyb21FbGVtZW50KHRoaXMuX2VsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgIGlmIChlKHIpLnRyaWdnZXIocyksICFzLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5faW5OYXZiYXIgJiYgaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09IHR5cGVvZiBuKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJCb290c3RyYXAncyBkcm9wZG93bnMgcmVxdWlyZSBQb3BwZXIuanMgKGh0dHBzOi8vcG9wcGVyLmpzLm9yZy8pIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IHRoaXMuX2VsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGFyZW50IiA9PT0gdGhpcy5fY29uZmlnLnJlZmVyZW5jZSA/IGwgPSByIDogYS5pc0VsZW1lbnQodGhpcy5fY29uZmlnLnJlZmVyZW5jZSkgJiYgKGwgPSB0aGlzLl9jb25maWcucmVmZXJlbmNlLCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgdGhpcy5fY29uZmlnLnJlZmVyZW5jZS5qcXVlcnkgJiYgKGwgPSB0aGlzLl9jb25maWcucmVmZXJlbmNlWzBdKSksICJzY3JvbGxQYXJlbnQiICE9PSB0aGlzLl9jb25maWcuYm91bmRhcnkgJiYgZShyKS5hZGRDbGFzcygicG9zaXRpb24tc3RhdGljIiksIHRoaXMuX3BvcHBlciA9IG5ldyBuKGwsIHRoaXMuX21lbnUsIHRoaXMuX2dldFBvcHBlckNvbmZpZygpKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICJvbnRvdWNoc3RhcnQiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiAwID09PSBlKHIpLmNsb3Nlc3QoIi5uYXZiYXItbmF2IikubGVuZ3RoICYmIGUoZG9jdW1lbnQuYm9keSkuY2hpbGRyZW4oKS5vbigibW91c2VvdmVyIiwgbnVsbCwgZS5ub29wKSwgdGhpcy5fZWxlbWVudC5mb2N1cygpLCB0aGlzLl9lbGVtZW50LnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsICEwKSwgZSh0aGlzLl9tZW51KS50b2dnbGVDbGFzcygic2hvdyIpLCBlKHIpLnRvZ2dsZUNsYXNzKCJzaG93IikudHJpZ2dlcihlLkV2ZW50KCJzaG93bi5icy5kcm9wZG93biIsIG8pKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgaS5oaWRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2VsZW1lbnQuZGlzYWJsZWQgJiYgIWUodGhpcy5fZWxlbWVudCkuaGFzQ2xhc3MoImRpc2FibGVkIikgJiYgZSh0aGlzLl9tZW51KS5oYXNDbGFzcygic2hvdyIpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiB0aGlzLl9lbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBlLkV2ZW50KCJoaWRlLmJzLmRyb3Bkb3duIiwgbiksCiAgICAgICAgICAgICAgICAgICAgICAgIG8gPSB0Ll9nZXRQYXJlbnRGcm9tRWxlbWVudCh0aGlzLl9lbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICBlKG8pLnRyaWdnZXIoaSksIGkuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgKHRoaXMuX3BvcHBlciAmJiB0aGlzLl9wb3BwZXIuZGVzdHJveSgpLCBlKHRoaXMuX21lbnUpLnRvZ2dsZUNsYXNzKCJzaG93IiksIGUobykudG9nZ2xlQ2xhc3MoInNob3ciKS50cmlnZ2VyKGUuRXZlbnQoImhpZGRlbi5icy5kcm9wZG93biIsIG4pKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgaS5kaXNwb3NlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBlLnJlbW92ZURhdGEodGhpcy5fZWxlbWVudCwgImJzLmRyb3Bkb3duIiksIGUodGhpcy5fZWxlbWVudCkub2ZmKCIuYnMuZHJvcGRvd24iKSwgdGhpcy5fZWxlbWVudCA9IG51bGwsIHRoaXMuX21lbnUgPSBudWxsLCBudWxsICE9PSB0aGlzLl9wb3BwZXIgJiYgKHRoaXMuX3BvcHBlci5kZXN0cm95KCksIHRoaXMuX3BvcHBlciA9IG51bGwpCiAgICAgICAgICAgIH0sIGkudXBkYXRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pbk5hdmJhciA9IHRoaXMuX2RldGVjdE5hdmJhcigpLCBudWxsICE9PSB0aGlzLl9wb3BwZXIgJiYgdGhpcy5fcG9wcGVyLnNjaGVkdWxlVXBkYXRlKCkKICAgICAgICAgICAgfSwgaS5fYWRkRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpczsKICAgICAgICAgICAgICAgIGUodGhpcy5fZWxlbWVudCkub24oImNsaWNrLmJzLmRyb3Bkb3duIiwgKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCksIGUuc3RvcFByb3BhZ2F0aW9uKCksIHQudG9nZ2xlKCkKICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICB9LCBpLl9nZXRDb25maWcgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdCA9IHMoe30sIHRoaXMuY29uc3RydWN0b3IuRGVmYXVsdCwgZSh0aGlzLl9lbGVtZW50KS5kYXRhKCksIHQpLCBhLnR5cGVDaGVja0NvbmZpZyhTLCB0LCB0aGlzLmNvbnN0cnVjdG9yLkRlZmF1bHRUeXBlKSwgdAogICAgICAgICAgICB9LCBpLl9nZXRNZW51RWxlbWVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9tZW51KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSB0Ll9nZXRQYXJlbnRGcm9tRWxlbWVudCh0aGlzLl9lbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICBlICYmICh0aGlzLl9tZW51ID0gZS5xdWVyeVNlbGVjdG9yKCIuZHJvcGRvd24tbWVudSIpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lbnUKICAgICAgICAgICAgfSwgaS5fZ2V0UGxhY2VtZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IGUodGhpcy5fZWxlbWVudC5wYXJlbnROb2RlKSwKICAgICAgICAgICAgICAgICAgICBuID0gImJvdHRvbS1zdGFydCI7CiAgICAgICAgICAgICAgICByZXR1cm4gdC5oYXNDbGFzcygiZHJvcHVwIikgPyBuID0gZSh0aGlzLl9tZW51KS5oYXNDbGFzcygiZHJvcGRvd24tbWVudS1yaWdodCIpID8gInRvcC1lbmQiIDogInRvcC1zdGFydCIgOiB0Lmhhc0NsYXNzKCJkcm9wcmlnaHQiKSA/IG4gPSAicmlnaHQtc3RhcnQiIDogdC5oYXNDbGFzcygiZHJvcGxlZnQiKSA/IG4gPSAibGVmdC1zdGFydCIgOiBlKHRoaXMuX21lbnUpLmhhc0NsYXNzKCJkcm9wZG93bi1tZW51LXJpZ2h0IikgJiYgKG4gPSAiYm90dG9tLWVuZCIpLCBuCiAgICAgICAgICAgIH0sIGkuX2RldGVjdE5hdmJhciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGUodGhpcy5fZWxlbWVudCkuY2xvc2VzdCgiLm5hdmJhciIpLmxlbmd0aCA+IDAKICAgICAgICAgICAgfSwgaS5fZ2V0T2Zmc2V0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgZSA9IHt9OwogICAgICAgICAgICAgICAgcmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIHRoaXMuX2NvbmZpZy5vZmZzZXQgPyBlLmZuID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBlLm9mZnNldHMgPSBzKHt9LCBlLm9mZnNldHMsIHQuX2NvbmZpZy5vZmZzZXQoZS5vZmZzZXRzLCB0Ll9lbGVtZW50KSB8fCB7fSksIGUKICAgICAgICAgICAgICAgIH0gOiBlLm9mZnNldCA9IHRoaXMuX2NvbmZpZy5vZmZzZXQsIGUKICAgICAgICAgICAgfSwgaS5fZ2V0UG9wcGVyQ29uZmlnID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IHsKICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6IHRoaXMuX2dldFBsYWNlbWVudCgpLAogICAgICAgICAgICAgICAgICAgIG1vZGlmaWVyczogewogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IHRoaXMuX2dldE9mZnNldCgpLAogICAgICAgICAgICAgICAgICAgICAgICBmbGlwOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiB0aGlzLl9jb25maWcuZmxpcAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBwcmV2ZW50T3ZlcmZsb3c6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kYXJpZXNFbGVtZW50OiB0aGlzLl9jb25maWcuYm91bmRhcnkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZXR1cm4gInN0YXRpYyIgPT09IHRoaXMuX2NvbmZpZy5kaXNwbGF5ICYmICh0Lm1vZGlmaWVycy5hcHBseVN0eWxlID0gewogICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6ICExCiAgICAgICAgICAgICAgICB9KSwgcyh7fSwgdCwgdGhpcy5fY29uZmlnLnBvcHBlckNvbmZpZykKICAgICAgICAgICAgfSwgdC5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24obikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaCgoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBlKHRoaXMpLmRhdGEoImJzLmRyb3Bkb3duIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgfHwgKGkgPSBuZXcgdCh0aGlzLCAib2JqZWN0IiA9PSB0eXBlb2YgbiA/IG4gOiBudWxsKSwgZSh0aGlzKS5kYXRhKCJicy5kcm9wZG93biIsIGkpKSwgInN0cmluZyIgPT0gdHlwZW9mIG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09IHR5cGVvZiBpW25dKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdObyBtZXRob2QgbmFtZWQgIicgKyBuICsgJyInKTsKICAgICAgICAgICAgICAgICAgICAgICAgaVtuXSgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIH0sIHQuX2NsZWFyTWVudXMgPSBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgICAgICBpZiAoIW4gfHwgMyAhPT0gbi53aGljaCAmJiAoImtleXVwIiAhPT0gbi50eXBlIHx8IDkgPT09IG4ud2hpY2gpKQogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXRvZ2dsZT0iZHJvcGRvd24iXScpKSwgbyA9IDAsIHMgPSBpLmxlbmd0aDsgbyA8IHM7IG8rKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IHQuX2dldFBhcmVudEZyb21FbGVtZW50KGlbb10pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGUoaVtvXSkuZGF0YSgiYnMuZHJvcGRvd24iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRlZFRhcmdldDogaVtvXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG4gJiYgImNsaWNrIiA9PT0gbi50eXBlICYmIChsLmNsaWNrRXZlbnQgPSBuKSwgYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLl9tZW51OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUocikuaGFzQ2xhc3MoInNob3ciKSAmJiAhKG4gJiYgKCJjbGljayIgPT09IG4udHlwZSAmJiAvaW5wdXR8dGV4dGFyZWEvaS50ZXN0KG4udGFyZ2V0LnRhZ05hbWUpIHx8ICJrZXl1cCIgPT09IG4udHlwZSAmJiA5ID09PSBuLndoaWNoKSAmJiBlLmNvbnRhaW5zKHIsIG4udGFyZ2V0KSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IGUuRXZlbnQoImhpZGUuYnMuZHJvcGRvd24iLCBsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKHIpLnRyaWdnZXIoaCksIGguaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgKCJvbnRvdWNoc3RhcnQiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiBlKGRvY3VtZW50LmJvZHkpLmNoaWxkcmVuKCkub2ZmKCJtb3VzZW92ZXIiLCBudWxsLCBlLm5vb3ApLCBpW29dLnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsICJmYWxzZSIpLCBhLl9wb3BwZXIgJiYgYS5fcG9wcGVyLmRlc3Ryb3koKSwgZShjKS5yZW1vdmVDbGFzcygic2hvdyIpLCBlKHIpLnJlbW92ZUNsYXNzKCJzaG93IikudHJpZ2dlcihlLkV2ZW50KCJoaWRkZW4uYnMuZHJvcGRvd24iLCBsKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHQuX2dldFBhcmVudEZyb21FbGVtZW50ID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgdmFyIGUsIG4gPSBhLmdldFNlbGVjdG9yRnJvbUVsZW1lbnQodCk7CiAgICAgICAgICAgICAgICByZXR1cm4gbiAmJiAoZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobikpLCBlIHx8IHQucGFyZW50Tm9kZQogICAgICAgICAgICB9LCB0Ll9kYXRhQXBpS2V5ZG93bkhhbmRsZXIgPSBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgICAgICBpZiAoISgvaW5wdXR8dGV4dGFyZWEvaS50ZXN0KG4udGFyZ2V0LnRhZ05hbWUpID8gMzIgPT09IG4ud2hpY2ggfHwgMjcgIT09IG4ud2hpY2ggJiYgKDQwICE9PSBuLndoaWNoICYmIDM4ICE9PSBuLndoaWNoIHx8IGUobi50YXJnZXQpLmNsb3Nlc3QoIi5kcm9wZG93bi1tZW51IikubGVuZ3RoKSA6ICFELnRlc3Qobi53aGljaCkpICYmICF0aGlzLmRpc2FibGVkICYmICFlKHRoaXMpLmhhc0NsYXNzKCJkaXNhYmxlZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSB0Ll9nZXRQYXJlbnRGcm9tRWxlbWVudCh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgbyA9IGUoaSkuaGFzQ2xhc3MoInNob3ciKTsKICAgICAgICAgICAgICAgICAgICBpZiAobyB8fCAyNyAhPT0gbi53aGljaCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobi5wcmV2ZW50RGVmYXVsdCgpLCBuLnN0b3BQcm9wYWdhdGlvbigpLCAhbyB8fCBvICYmICgyNyA9PT0gbi53aGljaCB8fCAzMiA9PT0gbi53aGljaCkpIHJldHVybiAyNyA9PT0gbi53aGljaCAmJiBlKGkucXVlcnlTZWxlY3RvcignW2RhdGEtdG9nZ2xlPSJkcm9wZG93biJdJykpLnRyaWdnZXIoImZvY3VzIiksIHZvaWQgZSh0aGlzKS50cmlnZ2VyKCJjbGljayIpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IFtdLnNsaWNlLmNhbGwoaS5xdWVyeVNlbGVjdG9yQWxsKCIuZHJvcGRvd24tbWVudSAuZHJvcGRvd24taXRlbTpub3QoLmRpc2FibGVkKTpub3QoOmRpc2FibGVkKSIpKS5maWx0ZXIoKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlKHQpLmlzKCI6dmlzaWJsZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgIT09IHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IHMuaW5kZXhPZihuLnRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAzOCA9PT0gbi53aGljaCAmJiByID4gMCAmJiByLS0sIDQwID09PSBuLndoaWNoICYmIHIgPCBzLmxlbmd0aCAtIDEgJiYgcisrLCByIDwgMCAmJiAociA9IDApLCBzW3JdLmZvY3VzKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbyh0LCBudWxsLCBbewogICAgICAgICAgICAgICAga2V5OiAiVkVSU0lPTiIsCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiNC41LjIiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGtleTogIkRlZmF1bHQiLAogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBrZXk6ICJEZWZhdWx0VHlwZSIsCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBBCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dKSwgdAogICAgICAgIH0oKTsKICAgIGUoZG9jdW1lbnQpLm9uKCJrZXlkb3duLmJzLmRyb3Bkb3duLmRhdGEtYXBpIiwgJ1tkYXRhLXRvZ2dsZT0iZHJvcGRvd24iXScsIEkuX2RhdGFBcGlLZXlkb3duSGFuZGxlcikub24oImtleWRvd24uYnMuZHJvcGRvd24uZGF0YS1hcGkiLCAiLmRyb3Bkb3duLW1lbnUiLCBJLl9kYXRhQXBpS2V5ZG93bkhhbmRsZXIpLm9uKCJjbGljay5icy5kcm9wZG93bi5kYXRhLWFwaSBrZXl1cC5icy5kcm9wZG93bi5kYXRhLWFwaSIsIEkuX2NsZWFyTWVudXMpLm9uKCJjbGljay5icy5kcm9wZG93bi5kYXRhLWFwaSIsICdbZGF0YS10b2dnbGU9ImRyb3Bkb3duIl0nLCAoZnVuY3Rpb24odCkgewogICAgICAgIHQucHJldmVudERlZmF1bHQoKSwgdC5zdG9wUHJvcGFnYXRpb24oKSwgSS5falF1ZXJ5SW50ZXJmYWNlLmNhbGwoZSh0aGlzKSwgInRvZ2dsZSIpCiAgICB9KSkub24oImNsaWNrLmJzLmRyb3Bkb3duLmRhdGEtYXBpIiwgIi5kcm9wZG93biBmb3JtIiwgKGZ1bmN0aW9uKHQpIHsKICAgICAgICB0LnN0b3BQcm9wYWdhdGlvbigpCiAgICB9KSksIGUuZm5bU10gPSBJLl9qUXVlcnlJbnRlcmZhY2UsIGUuZm5bU10uQ29uc3RydWN0b3IgPSBJLCBlLmZuW1NdLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gZS5mbltTXSA9IGssIEkuX2pRdWVyeUludGVyZmFjZQogICAgfTsKICAgIHZhciBPID0gZS5mbi5tb2RhbCwKICAgICAgICBqID0gewogICAgICAgICAgICBiYWNrZHJvcDogITAsCiAgICAgICAgICAgIGtleWJvYXJkOiAhMCwKICAgICAgICAgICAgZm9jdXM6ICEwLAogICAgICAgICAgICBzaG93OiAhMAogICAgICAgIH0sCiAgICAgICAgeCA9IHsKICAgICAgICAgICAgYmFja2Ryb3A6ICIoYm9vbGVhbnxzdHJpbmcpIiwKICAgICAgICAgICAga2V5Ym9hcmQ6ICJib29sZWFuIiwKICAgICAgICAgICAgZm9jdXM6ICJib29sZWFuIiwKICAgICAgICAgICAgc2hvdzogImJvb2xlYW4iCiAgICAgICAgfSwKICAgICAgICBQID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHQodCwgZSkgewogICAgICAgICAgICAgICAgdGhpcy5fY29uZmlnID0gdGhpcy5fZ2V0Q29uZmlnKGUpLCB0aGlzLl9lbGVtZW50ID0gdCwgdGhpcy5fZGlhbG9nID0gdC5xdWVyeVNlbGVjdG9yKCIubW9kYWwtZGlhbG9nIiksIHRoaXMuX2JhY2tkcm9wID0gbnVsbCwgdGhpcy5faXNTaG93biA9ICExLCB0aGlzLl9pc0JvZHlPdmVyZmxvd2luZyA9ICExLCB0aGlzLl9pZ25vcmVCYWNrZHJvcENsaWNrID0gITEsIHRoaXMuX2lzVHJhbnNpdGlvbmluZyA9ICExLCB0aGlzLl9zY3JvbGxiYXJXaWR0aCA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbiA9IHQucHJvdG90eXBlOwogICAgICAgICAgICByZXR1cm4gbi50b2dnbGUgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNTaG93biA/IHRoaXMuaGlkZSgpIDogdGhpcy5zaG93KHQpCiAgICAgICAgICAgIH0sIG4uc2hvdyA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIHZhciBuID0gdGhpczsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNTaG93biAmJiAhdGhpcy5faXNUcmFuc2l0aW9uaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgZSh0aGlzLl9lbGVtZW50KS5oYXNDbGFzcygiZmFkZSIpICYmICh0aGlzLl9pc1RyYW5zaXRpb25pbmcgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBlLkV2ZW50KCJzaG93LmJzLm1vZGFsIiwgewogICAgICAgICAgICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiB0CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgZSh0aGlzLl9lbGVtZW50KS50cmlnZ2VyKGkpLCB0aGlzLl9pc1Nob3duIHx8IGkuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgKHRoaXMuX2lzU2hvd24gPSAhMCwgdGhpcy5fY2hlY2tTY3JvbGxiYXIoKSwgdGhpcy5fc2V0U2Nyb2xsYmFyKCksIHRoaXMuX2FkanVzdERpYWxvZygpLCB0aGlzLl9zZXRFc2NhcGVFdmVudCgpLCB0aGlzLl9zZXRSZXNpemVFdmVudCgpLCBlKHRoaXMuX2VsZW1lbnQpLm9uKCJjbGljay5kaXNtaXNzLmJzLm1vZGFsIiwgJ1tkYXRhLWRpc21pc3M9Im1vZGFsIl0nLCAoZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5oaWRlKHQpCiAgICAgICAgICAgICAgICAgICAgfSkpLCBlKHRoaXMuX2RpYWxvZykub24oIm1vdXNlZG93bi5kaXNtaXNzLmJzLm1vZGFsIiwgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBlKG4uX2VsZW1lbnQpLm9uZSgibW91c2V1cC5kaXNtaXNzLmJzLm1vZGFsIiwgKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUodC50YXJnZXQpLmlzKG4uX2VsZW1lbnQpICYmIChuLl9pZ25vcmVCYWNrZHJvcENsaWNrID0gITApCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgICAgIH0pKSwgdGhpcy5fc2hvd0JhY2tkcm9wKChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4uX3Nob3dFbGVtZW50KHQpCiAgICAgICAgICAgICAgICAgICAgfSkpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBuLmhpZGUgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAodCAmJiB0LnByZXZlbnREZWZhdWx0KCksIHRoaXMuX2lzU2hvd24gJiYgIXRoaXMuX2lzVHJhbnNpdGlvbmluZykgewogICAgICAgICAgICAgICAgICAgIHZhciBpID0gZS5FdmVudCgiaGlkZS5icy5tb2RhbCIpOwogICAgICAgICAgICAgICAgICAgIGlmIChlKHRoaXMuX2VsZW1lbnQpLnRyaWdnZXIoaSksIHRoaXMuX2lzU2hvd24gJiYgIWkuaXNEZWZhdWx0UHJldmVudGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNTaG93biA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGUodGhpcy5fZWxlbWVudCkuaGFzQ2xhc3MoImZhZGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8gJiYgKHRoaXMuX2lzVHJhbnNpdGlvbmluZyA9ICEwKSwgdGhpcy5fc2V0RXNjYXBlRXZlbnQoKSwgdGhpcy5fc2V0UmVzaXplRXZlbnQoKSwgZShkb2N1bWVudCkub2ZmKCJmb2N1c2luLmJzLm1vZGFsIiksIGUodGhpcy5fZWxlbWVudCkucmVtb3ZlQ2xhc3MoInNob3ciKSwgZSh0aGlzLl9lbGVtZW50KS5vZmYoImNsaWNrLmRpc21pc3MuYnMubW9kYWwiKSwgZSh0aGlzLl9kaWFsb2cpLm9mZigibW91c2Vkb3duLmRpc21pc3MuYnMubW9kYWwiKSwgbykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBhLmdldFRyYW5zaXRpb25EdXJhdGlvbkZyb21FbGVtZW50KHRoaXMuX2VsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSh0aGlzLl9lbGVtZW50KS5vbmUoYS5UUkFOU0lUSU9OX0VORCwgKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5faGlkZU1vZGFsKHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkuZW11bGF0ZVRyYW5zaXRpb25FbmQocykKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMuX2hpZGVNb2RhbCgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBuLmRpc3Bvc2UgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIFt3aW5kb3csIHRoaXMuX2VsZW1lbnQsIHRoaXMuX2RpYWxvZ10uZm9yRWFjaCgoZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBlKHQpLm9mZigiLmJzLm1vZGFsIikKICAgICAgICAgICAgICAgIH0pKSwgZShkb2N1bWVudCkub2ZmKCJmb2N1c2luLmJzLm1vZGFsIiksIGUucmVtb3ZlRGF0YSh0aGlzLl9lbGVtZW50LCAiYnMubW9kYWwiKSwgdGhpcy5fY29uZmlnID0gbnVsbCwgdGhpcy5fZWxlbWVudCA9IG51bGwsIHRoaXMuX2RpYWxvZyA9IG51bGwsIHRoaXMuX2JhY2tkcm9wID0gbnVsbCwgdGhpcy5faXNTaG93biA9IG51bGwsIHRoaXMuX2lzQm9keU92ZXJmbG93aW5nID0gbnVsbCwgdGhpcy5faWdub3JlQmFja2Ryb3BDbGljayA9IG51bGwsIHRoaXMuX2lzVHJhbnNpdGlvbmluZyA9IG51bGwsIHRoaXMuX3Njcm9sbGJhcldpZHRoID0gbnVsbAogICAgICAgICAgICB9LCBuLmhhbmRsZVVwZGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdGhpcy5fYWRqdXN0RGlhbG9nKCkKICAgICAgICAgICAgfSwgbi5fZ2V0Q29uZmlnID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHQgPSBzKHt9LCBqLCB0KSwgYS50eXBlQ2hlY2tDb25maWcoIm1vZGFsIiwgdCwgeCksIHQKICAgICAgICAgICAgfSwgbi5fdHJpZ2dlckJhY2tkcm9wVHJhbnNpdGlvbiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzOwogICAgICAgICAgICAgICAgaWYgKCJzdGF0aWMiID09PSB0aGlzLl9jb25maWcuYmFja2Ryb3ApIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGUuRXZlbnQoImhpZGVQcmV2ZW50ZWQuYnMubW9kYWwiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZSh0aGlzLl9lbGVtZW50KS50cmlnZ2VyKG4pLCBuLmRlZmF1bHRQcmV2ZW50ZWQpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuX2VsZW1lbnQuc2Nyb2xsSGVpZ2h0ID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDsKICAgICAgICAgICAgICAgICAgICBpIHx8ICh0aGlzLl9lbGVtZW50LnN0eWxlLm92ZXJmbG93WSA9ICJoaWRkZW4iKSwgdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJtb2RhbC1zdGF0aWMiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGEuZ2V0VHJhbnNpdGlvbkR1cmF0aW9uRnJvbUVsZW1lbnQodGhpcy5fZGlhbG9nKTsKICAgICAgICAgICAgICAgICAgICBlKHRoaXMuX2VsZW1lbnQpLm9mZihhLlRSQU5TSVRJT05fRU5EKSwgZSh0aGlzLl9lbGVtZW50KS5vbmUoYS5UUkFOU0lUSU9OX0VORCwgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB0Ll9lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoIm1vZGFsLXN0YXRpYyIpLCBpIHx8IGUodC5fZWxlbWVudCkub25lKGEuVFJBTlNJVElPTl9FTkQsIChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuX2VsZW1lbnQuc3R5bGUub3ZlcmZsb3dZID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgfSkpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKHQuX2VsZW1lbnQsIG8pCiAgICAgICAgICAgICAgICAgICAgfSkpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKG8pLCB0aGlzLl9lbGVtZW50LmZvY3VzKCkKICAgICAgICAgICAgICAgIH0gZWxzZSB0aGlzLmhpZGUoKQogICAgICAgICAgICB9LCBuLl9zaG93RWxlbWVudCA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIHZhciBuID0gdGhpcywKICAgICAgICAgICAgICAgICAgICBpID0gZSh0aGlzLl9lbGVtZW50KS5oYXNDbGFzcygiZmFkZSIpLAogICAgICAgICAgICAgICAgICAgIG8gPSB0aGlzLl9kaWFsb2cgPyB0aGlzLl9kaWFsb2cucXVlcnlTZWxlY3RvcigiLm1vZGFsLWJvZHkiKSA6IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLl9lbGVtZW50LnBhcmVudE5vZGUgJiYgdGhpcy5fZWxlbWVudC5wYXJlbnROb2RlLm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSB8fCBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuX2VsZW1lbnQpLCB0aGlzLl9lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siLCB0aGlzLl9lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iKSwgdGhpcy5fZWxlbWVudC5zZXRBdHRyaWJ1dGUoImFyaWEtbW9kYWwiLCAhMCksIHRoaXMuX2VsZW1lbnQuc2V0QXR0cmlidXRlKCJyb2xlIiwgImRpYWxvZyIpLCBlKHRoaXMuX2RpYWxvZykuaGFzQ2xhc3MoIm1vZGFsLWRpYWxvZy1zY3JvbGxhYmxlIikgJiYgbyA/IG8uc2Nyb2xsVG9wID0gMCA6IHRoaXMuX2VsZW1lbnQuc2Nyb2xsVG9wID0gMCwgaSAmJiBhLnJlZmxvdyh0aGlzLl9lbGVtZW50KSwgZSh0aGlzLl9lbGVtZW50KS5hZGRDbGFzcygic2hvdyIpLCB0aGlzLl9jb25maWcuZm9jdXMgJiYgdGhpcy5fZW5mb3JjZUZvY3VzKCk7CiAgICAgICAgICAgICAgICB2YXIgcyA9IGUuRXZlbnQoInNob3duLmJzLm1vZGFsIiwgewogICAgICAgICAgICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiB0CiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBuLl9jb25maWcuZm9jdXMgJiYgbi5fZWxlbWVudC5mb2N1cygpLCBuLl9pc1RyYW5zaXRpb25pbmcgPSAhMSwgZShuLl9lbGVtZW50KS50cmlnZ2VyKHMpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGlmIChpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSBhLmdldFRyYW5zaXRpb25EdXJhdGlvbkZyb21FbGVtZW50KHRoaXMuX2RpYWxvZyk7CiAgICAgICAgICAgICAgICAgICAgZSh0aGlzLl9kaWFsb2cpLm9uZShhLlRSQU5TSVRJT05fRU5ELCByKS5lbXVsYXRlVHJhbnNpdGlvbkVuZChsKQogICAgICAgICAgICAgICAgfSBlbHNlIHIoKQogICAgICAgICAgICB9LCBuLl9lbmZvcmNlRm9jdXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpczsKICAgICAgICAgICAgICAgIGUoZG9jdW1lbnQpLm9mZigiZm9jdXNpbi5icy5tb2RhbCIpLm9uKCJmb2N1c2luLmJzLm1vZGFsIiwgKGZ1bmN0aW9uKG4pIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudCAhPT0gbi50YXJnZXQgJiYgdC5fZWxlbWVudCAhPT0gbi50YXJnZXQgJiYgMCA9PT0gZSh0Ll9lbGVtZW50KS5oYXMobi50YXJnZXQpLmxlbmd0aCAmJiB0Ll9lbGVtZW50LmZvY3VzKCkKICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICB9LCBuLl9zZXRFc2NhcGVFdmVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy5faXNTaG93biA/IGUodGhpcy5fZWxlbWVudCkub24oImtleWRvd24uZGlzbWlzcy5icy5tb2RhbCIsIChmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgdC5fY29uZmlnLmtleWJvYXJkICYmIDI3ID09PSBlLndoaWNoID8gKGUucHJldmVudERlZmF1bHQoKSwgdC5oaWRlKCkpIDogdC5fY29uZmlnLmtleWJvYXJkIHx8IDI3ICE9PSBlLndoaWNoIHx8IHQuX3RyaWdnZXJCYWNrZHJvcFRyYW5zaXRpb24oKQogICAgICAgICAgICAgICAgfSkpIDogdGhpcy5faXNTaG93biB8fCBlKHRoaXMuX2VsZW1lbnQpLm9mZigia2V5ZG93bi5kaXNtaXNzLmJzLm1vZGFsIikKICAgICAgICAgICAgfSwgbi5fc2V0UmVzaXplRXZlbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMuX2lzU2hvd24gPyBlKHdpbmRvdykub24oInJlc2l6ZS5icy5tb2RhbCIsIChmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuaGFuZGxlVXBkYXRlKGUpCiAgICAgICAgICAgICAgICB9KSkgOiBlKHdpbmRvdykub2ZmKCJyZXNpemUuYnMubW9kYWwiKQogICAgICAgICAgICB9LCBuLl9oaWRlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMuX2VsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgdGhpcy5fZWxlbWVudC5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwgITApLCB0aGlzLl9lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgiYXJpYS1tb2RhbCIpLCB0aGlzLl9lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgicm9sZSIpLCB0aGlzLl9pc1RyYW5zaXRpb25pbmcgPSAhMSwgdGhpcy5fc2hvd0JhY2tkcm9wKChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBlKGRvY3VtZW50LmJvZHkpLnJlbW92ZUNsYXNzKCJtb2RhbC1vcGVuIiksIHQuX3Jlc2V0QWRqdXN0bWVudHMoKSwgdC5fcmVzZXRTY3JvbGxiYXIoKSwgZSh0Ll9lbGVtZW50KS50cmlnZ2VyKCJoaWRkZW4uYnMubW9kYWwiKQogICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIH0sIG4uX3JlbW92ZUJhY2tkcm9wID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9iYWNrZHJvcCAmJiAoZSh0aGlzLl9iYWNrZHJvcCkucmVtb3ZlKCksIHRoaXMuX2JhY2tkcm9wID0gbnVsbCkKICAgICAgICAgICAgfSwgbi5fc2hvd0JhY2tkcm9wID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgdmFyIG4gPSB0aGlzLAogICAgICAgICAgICAgICAgICAgIGkgPSBlKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKCJmYWRlIikgPyAiZmFkZSIgOiAiIjsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc1Nob3duICYmIHRoaXMuX2NvbmZpZy5iYWNrZHJvcCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9iYWNrZHJvcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLCB0aGlzLl9iYWNrZHJvcC5jbGFzc05hbWUgPSAibW9kYWwtYmFja2Ryb3AiLCBpICYmIHRoaXMuX2JhY2tkcm9wLmNsYXNzTGlzdC5hZGQoaSksIGUodGhpcy5fYmFja2Ryb3ApLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLCBlKHRoaXMuX2VsZW1lbnQpLm9uKCJjbGljay5kaXNtaXNzLmJzLm1vZGFsIiwgKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uX2lnbm9yZUJhY2tkcm9wQ2xpY2sgPyBuLl9pZ25vcmVCYWNrZHJvcENsaWNrID0gITEgOiB0LnRhcmdldCA9PT0gdC5jdXJyZW50VGFyZ2V0ICYmIG4uX3RyaWdnZXJCYWNrZHJvcFRyYW5zaXRpb24oKQogICAgICAgICAgICAgICAgICAgICAgICB9KSksIGkgJiYgYS5yZWZsb3codGhpcy5fYmFja2Ryb3ApLCBlKHRoaXMuX2JhY2tkcm9wKS5hZGRDbGFzcygic2hvdyIpLCAhdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGlmICghaSkgcmV0dXJuIHZvaWQgdCgpOwogICAgICAgICAgICAgICAgICAgIHZhciBvID0gYS5nZXRUcmFuc2l0aW9uRHVyYXRpb25Gcm9tRWxlbWVudCh0aGlzLl9iYWNrZHJvcCk7CiAgICAgICAgICAgICAgICAgICAgZSh0aGlzLl9iYWNrZHJvcCkub25lKGEuVFJBTlNJVElPTl9FTkQsIHQpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKG8pCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLl9pc1Nob3duICYmIHRoaXMuX2JhY2tkcm9wKSB7CiAgICAgICAgICAgICAgICAgICAgZSh0aGlzLl9iYWNrZHJvcCkucmVtb3ZlQ2xhc3MoInNob3ciKTsKICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBuLl9yZW1vdmVCYWNrZHJvcCgpLCB0ICYmIHQoKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgaWYgKGUodGhpcy5fZWxlbWVudCkuaGFzQ2xhc3MoImZhZGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IGEuZ2V0VHJhbnNpdGlvbkR1cmF0aW9uRnJvbUVsZW1lbnQodGhpcy5fYmFja2Ryb3ApOwogICAgICAgICAgICAgICAgICAgICAgICBlKHRoaXMuX2JhY2tkcm9wKS5vbmUoYS5UUkFOU0lUSU9OX0VORCwgcykuZW11bGF0ZVRyYW5zaXRpb25FbmQocikKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgcygpCiAgICAgICAgICAgICAgICB9IGVsc2UgdCAmJiB0KCkKICAgICAgICAgICAgfSwgbi5fYWRqdXN0RGlhbG9nID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMuX2VsZW1lbnQuc2Nyb2xsSGVpZ2h0ID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDsKICAgICAgICAgICAgICAgICF0aGlzLl9pc0JvZHlPdmVyZmxvd2luZyAmJiB0ICYmICh0aGlzLl9lbGVtZW50LnN0eWxlLnBhZGRpbmdMZWZ0ID0gdGhpcy5fc2Nyb2xsYmFyV2lkdGggKyAicHgiKSwgdGhpcy5faXNCb2R5T3ZlcmZsb3dpbmcgJiYgIXQgJiYgKHRoaXMuX2VsZW1lbnQuc3R5bGUucGFkZGluZ1JpZ2h0ID0gdGhpcy5fc2Nyb2xsYmFyV2lkdGggKyAicHgiKQogICAgICAgICAgICB9LCBuLl9yZXNldEFkanVzdG1lbnRzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLnBhZGRpbmdMZWZ0ID0gIiIsIHRoaXMuX2VsZW1lbnQuc3R5bGUucGFkZGluZ1JpZ2h0ID0gIiIKICAgICAgICAgICAgfSwgbi5fY2hlY2tTY3JvbGxiYXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gZG9jdW1lbnQuYm9keS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzQm9keU92ZXJmbG93aW5nID0gTWF0aC5yb3VuZCh0LmxlZnQgKyB0LnJpZ2h0KSA8IHdpbmRvdy5pbm5lcldpZHRoLCB0aGlzLl9zY3JvbGxiYXJXaWR0aCA9IHRoaXMuX2dldFNjcm9sbGJhcldpZHRoKCkKICAgICAgICAgICAgfSwgbi5fc2V0U2Nyb2xsYmFyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNCb2R5T3ZlcmZsb3dpbmcpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmZpeGVkLXRvcCwgLmZpeGVkLWJvdHRvbSwgLmlzLWZpeGVkLCAuc3RpY2t5LXRvcCIpKSwKICAgICAgICAgICAgICAgICAgICAgICAgaSA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnN0aWNreS10b3AiKSk7CiAgICAgICAgICAgICAgICAgICAgZShuKS5lYWNoKChmdW5jdGlvbihuLCBpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gaS5zdHlsZS5wYWRkaW5nUmlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gZShpKS5jc3MoInBhZGRpbmctcmlnaHQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZShpKS5kYXRhKCJwYWRkaW5nLXJpZ2h0IiwgbykuY3NzKCJwYWRkaW5nLXJpZ2h0IiwgcGFyc2VGbG9hdChzKSArIHQuX3Njcm9sbGJhcldpZHRoICsgInB4IikKICAgICAgICAgICAgICAgICAgICB9KSksIGUoaSkuZWFjaCgoZnVuY3Rpb24obiwgaSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGkuc3R5bGUubWFyZ2luUmlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gZShpKS5jc3MoIm1hcmdpbi1yaWdodCIpOwogICAgICAgICAgICAgICAgICAgICAgICBlKGkpLmRhdGEoIm1hcmdpbi1yaWdodCIsIG8pLmNzcygibWFyZ2luLXJpZ2h0IiwgcGFyc2VGbG9hdChzKSAtIHQuX3Njcm9sbGJhcldpZHRoICsgInB4IikKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSBkb2N1bWVudC5ib2R5LnN0eWxlLnBhZGRpbmdSaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgcyA9IGUoZG9jdW1lbnQuYm9keSkuY3NzKCJwYWRkaW5nLXJpZ2h0Iik7CiAgICAgICAgICAgICAgICAgICAgZShkb2N1bWVudC5ib2R5KS5kYXRhKCJwYWRkaW5nLXJpZ2h0IiwgbykuY3NzKCJwYWRkaW5nLXJpZ2h0IiwgcGFyc2VGbG9hdChzKSArIHRoaXMuX3Njcm9sbGJhcldpZHRoICsgInB4IikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGUoZG9jdW1lbnQuYm9keSkuYWRkQ2xhc3MoIm1vZGFsLW9wZW4iKQogICAgICAgICAgICB9LCBuLl9yZXNldFNjcm9sbGJhciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5maXhlZC10b3AsIC5maXhlZC1ib3R0b20sIC5pcy1maXhlZCwgLnN0aWNreS10b3AiKSk7CiAgICAgICAgICAgICAgICBlKHQpLmVhY2goKGZ1bmN0aW9uKHQsIG4pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IGUobikuZGF0YSgicGFkZGluZy1yaWdodCIpOwogICAgICAgICAgICAgICAgICAgIGUobikucmVtb3ZlRGF0YSgicGFkZGluZy1yaWdodCIpLCBuLnN0eWxlLnBhZGRpbmdSaWdodCA9IGkgfHwgIiIKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIHZhciBuID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuc3RpY2t5LXRvcCIpKTsKICAgICAgICAgICAgICAgIGUobikuZWFjaCgoZnVuY3Rpb24odCwgbikgewogICAgICAgICAgICAgICAgICAgIHZhciBpID0gZShuKS5kYXRhKCJtYXJnaW4tcmlnaHQiKTsKICAgICAgICAgICAgICAgICAgICAidW5kZWZpbmVkIiAhPSB0eXBlb2YgaSAmJiBlKG4pLmNzcygibWFyZ2luLXJpZ2h0IiwgaSkucmVtb3ZlRGF0YSgibWFyZ2luLXJpZ2h0IikKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIHZhciBpID0gZShkb2N1bWVudC5ib2R5KS5kYXRhKCJwYWRkaW5nLXJpZ2h0Iik7CiAgICAgICAgICAgICAgICBlKGRvY3VtZW50LmJvZHkpLnJlbW92ZURhdGEoInBhZGRpbmctcmlnaHQiKSwgZG9jdW1lbnQuYm9keS5zdHlsZS5wYWRkaW5nUmlnaHQgPSBpIHx8ICIiCiAgICAgICAgICAgIH0sIG4uX2dldFNjcm9sbGJhcldpZHRoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICAgICAgdC5jbGFzc05hbWUgPSAibW9kYWwtc2Nyb2xsYmFyLW1lYXN1cmUiLCBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHQpOwogICAgICAgICAgICAgICAgdmFyIGUgPSB0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoIC0gdC5jbGllbnRXaWR0aDsKICAgICAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHQpLCBlCiAgICAgICAgICAgIH0sIHQuX2pRdWVyeUludGVyZmFjZSA9IGZ1bmN0aW9uKG4sIGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBvID0gZSh0aGlzKS5kYXRhKCJicy5tb2RhbCIpLAogICAgICAgICAgICAgICAgICAgICAgICByID0gcyh7fSwgaiwgZSh0aGlzKS5kYXRhKCksICJvYmplY3QiID09IHR5cGVvZiBuICYmIG4gPyBuIDoge30pOwogICAgICAgICAgICAgICAgICAgIGlmIChvIHx8IChvID0gbmV3IHQodGhpcywgciksIGUodGhpcykuZGF0YSgiYnMubW9kYWwiLCBvKSksICJzdHJpbmciID09IHR5cGVvZiBuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgidW5kZWZpbmVkIiA9PSB0eXBlb2Ygb1tuXSkgdGhyb3cgbmV3IFR5cGVFcnJvcignTm8gbWV0aG9kIG5hbWVkICInICsgbiArICciJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIG9bbl0oaSkKICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugci5zaG93ICYmIG8uc2hvdyhpKQogICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIH0sIG8odCwgbnVsbCwgW3sKICAgICAgICAgICAgICAgIGtleTogIlZFUlNJT04iLAogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjQuNS4yIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBrZXk6ICJEZWZhdWx0IiwKICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0pLCB0CiAgICAgICAgfSgpOwogICAgZShkb2N1bWVudCkub24oImNsaWNrLmJzLm1vZGFsLmRhdGEtYXBpIiwgJ1tkYXRhLXRvZ2dsZT0ibW9kYWwiXScsIChmdW5jdGlvbih0KSB7CiAgICAgICAgdmFyIG4sIGkgPSB0aGlzLAogICAgICAgICAgICBvID0gYS5nZXRTZWxlY3RvckZyb21FbGVtZW50KHRoaXMpOwogICAgICAgIG8gJiYgKG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG8pKTsKICAgICAgICB2YXIgciA9IGUobikuZGF0YSgiYnMubW9kYWwiKSA/ICJ0b2dnbGUiIDogcyh7fSwgZShuKS5kYXRhKCksIGUodGhpcykuZGF0YSgpKTsKICAgICAgICAiQSIgIT09IHRoaXMudGFnTmFtZSAmJiAiQVJFQSIgIT09IHRoaXMudGFnTmFtZSB8fCB0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdmFyIGwgPSBlKG4pLm9uZSgic2hvdy5icy5tb2RhbCIsIChmdW5jdGlvbih0KSB7CiAgICAgICAgICAgIHQuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgbC5vbmUoImhpZGRlbi5icy5tb2RhbCIsIChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGUoaSkuaXMoIjp2aXNpYmxlIikgJiYgaS5mb2N1cygpCiAgICAgICAgICAgIH0pKQogICAgICAgIH0pKTsKICAgICAgICBQLl9qUXVlcnlJbnRlcmZhY2UuY2FsbChlKG4pLCByLCB0aGlzKQogICAgfSkpLCBlLmZuLm1vZGFsID0gUC5falF1ZXJ5SW50ZXJmYWNlLCBlLmZuLm1vZGFsLkNvbnN0cnVjdG9yID0gUCwgZS5mbi5tb2RhbC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGUuZm4ubW9kYWwgPSBPLCBQLl9qUXVlcnlJbnRlcmZhY2UKICAgIH07CiAgICB2YXIgUiA9IFsiYmFja2dyb3VuZCIsICJjaXRlIiwgImhyZWYiLCAiaXRlbXR5cGUiLCAibG9uZ2Rlc2MiLCAicG9zdGVyIiwgInNyYyIsICJ4bGluazpocmVmIl0sCiAgICAgICAgTCA9IHsKICAgICAgICAgICAgIioiOiBbImNsYXNzIiwgImRpciIsICJpZCIsICJsYW5nIiwgInJvbGUiLCAvXmFyaWEtW1x3LV0qJC9pXSwKICAgICAgICAgICAgYTogWyJ0YXJnZXQiLCAiaHJlZiIsICJ0aXRsZSIsICJyZWwiXSwKICAgICAgICAgICAgYXJlYTogW10sCiAgICAgICAgICAgIGI6IFtdLAogICAgICAgICAgICBicjogW10sCiAgICAgICAgICAgIGNvbDogW10sCiAgICAgICAgICAgIGNvZGU6IFtdLAogICAgICAgICAgICBkaXY6IFtdLAogICAgICAgICAgICBlbTogW10sCiAgICAgICAgICAgIGhyOiBbXSwKICAgICAgICAgICAgaDE6IFtdLAogICAgICAgICAgICBoMjogW10sCiAgICAgICAgICAgIGgzOiBbXSwKICAgICAgICAgICAgaDQ6IFtdLAogICAgICAgICAgICBoNTogW10sCiAgICAgICAgICAgIGg2OiBbXSwKICAgICAgICAgICAgaTogW10sCiAgICAgICAgICAgIGltZzogWyJzcmMiLCAic3Jjc2V0IiwgImFsdCIsICJ0aXRsZSIsICJ3aWR0aCIsICJoZWlnaHQiXSwKICAgICAgICAgICAgbGk6IFtdLAogICAgICAgICAgICBvbDogW10sCiAgICAgICAgICAgIHA6IFtdLAogICAgICAgICAgICBwcmU6IFtdLAogICAgICAgICAgICBzOiBbXSwKICAgICAgICAgICAgc21hbGw6IFtdLAogICAgICAgICAgICBzcGFuOiBbXSwKICAgICAgICAgICAgc3ViOiBbXSwKICAgICAgICAgICAgc3VwOiBbXSwKICAgICAgICAgICAgc3Ryb25nOiBbXSwKICAgICAgICAgICAgdTogW10sCiAgICAgICAgICAgIHVsOiBbXQogICAgICAgIH0sCiAgICAgICAgcSA9IC9eKD86KD86aHR0cHM/fG1haWx0b3xmdHB8dGVsfGZpbGUpOnxbXiMmLzo/XSooPzpbIy8/XXwkKSkvZ2ksCiAgICAgICAgRiA9IC9eZGF0YTooPzppbWFnZVwvKD86Ym1wfGdpZnxqcGVnfGpwZ3xwbmd8dGlmZnx3ZWJwKXx2aWRlb1wvKD86bXBlZ3xtcDR8b2dnfHdlYm0pfGF1ZGlvXC8oPzptcDN8b2dhfG9nZ3xvcHVzKSk7YmFzZTY0LFtcZCsvYS16XSs9KiQvaTsKCiAgICBmdW5jdGlvbiBRKHQsIGUsIG4pIHsKICAgICAgICBpZiAoMCA9PT0gdC5sZW5ndGgpIHJldHVybiB0OwogICAgICAgIGlmIChuICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIG4pIHJldHVybiBuKHQpOwogICAgICAgIGZvciAodmFyIGkgPSAobmV3IHdpbmRvdy5ET01QYXJzZXIpLnBhcnNlRnJvbVN0cmluZyh0LCAidGV4dC9odG1sIiksIG8gPSBPYmplY3Qua2V5cyhlKSwgcyA9IFtdLnNsaWNlLmNhbGwoaS5ib2R5LnF1ZXJ5U2VsZWN0b3JBbGwoIioiKSksIHIgPSBmdW5jdGlvbih0LCBuKSB7CiAgICAgICAgICAgICAgICB2YXIgaSA9IHNbdF0sCiAgICAgICAgICAgICAgICAgICAgciA9IGkubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIGlmICgtMSA9PT0gby5pbmRleE9mKGkubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkpIHJldHVybiBpLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaSksICJjb250aW51ZSI7CiAgICAgICAgICAgICAgICB2YXIgYSA9IFtdLnNsaWNlLmNhbGwoaS5hdHRyaWJ1dGVzKSwKICAgICAgICAgICAgICAgICAgICBsID0gW10uY29uY2F0KGVbIioiXSB8fCBbXSwgZVtyXSB8fCBbXSk7CiAgICAgICAgICAgICAgICBhLmZvckVhY2goKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24odCwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC0xICE9PSBlLmluZGV4T2YobikpIHJldHVybiAtMSA9PT0gUi5pbmRleE9mKG4pIHx8IEJvb2xlYW4odC5ub2RlVmFsdWUubWF0Y2gocSkgfHwgdC5ub2RlVmFsdWUubWF0Y2goRikpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gZS5maWx0ZXIoKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdCBpbnN0YW5jZW9mIFJlZ0V4cAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLCBvID0gMCwgcyA9IGkubGVuZ3RoOyBvIDwgczsgbysrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG4ubWF0Y2goaVtvXSkpIHJldHVybiAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgfSkodCwgbCkgfHwgaS5yZW1vdmVBdHRyaWJ1dGUodC5ub2RlTmFtZSkKICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICB9LCBhID0gMCwgbCA9IHMubGVuZ3RoOyBhIDwgbDsgYSsrKSByKGEpOwogICAgICAgIHJldHVybiBpLmJvZHkuaW5uZXJIVE1MCiAgICB9CiAgICB2YXIgQiA9ICJ0b29sdGlwIiwKICAgICAgICBIID0gZS5mbltCXSwKICAgICAgICBVID0gbmV3IFJlZ0V4cCgiKF58XFxzKWJzLXRvb2x0aXBcXFMrIiwgImciKSwKICAgICAgICBNID0gWyJzYW5pdGl6ZSIsICJ3aGl0ZUxpc3QiLCAic2FuaXRpemVGbiJdLAogICAgICAgIFcgPSB7CiAgICAgICAgICAgIGFuaW1hdGlvbjogImJvb2xlYW4iLAogICAgICAgICAgICB0ZW1wbGF0ZTogInN0cmluZyIsCiAgICAgICAgICAgIHRpdGxlOiAiKHN0cmluZ3xlbGVtZW50fGZ1bmN0aW9uKSIsCiAgICAgICAgICAgIHRyaWdnZXI6ICJzdHJpbmciLAogICAgICAgICAgICBkZWxheTogIihudW1iZXJ8b2JqZWN0KSIsCiAgICAgICAgICAgIGh0bWw6ICJib29sZWFuIiwKICAgICAgICAgICAgc2VsZWN0b3I6ICIoc3RyaW5nfGJvb2xlYW4pIiwKICAgICAgICAgICAgcGxhY2VtZW50OiAiKHN0cmluZ3xmdW5jdGlvbikiLAogICAgICAgICAgICBvZmZzZXQ6ICIobnVtYmVyfHN0cmluZ3xmdW5jdGlvbikiLAogICAgICAgICAgICBjb250YWluZXI6ICIoc3RyaW5nfGVsZW1lbnR8Ym9vbGVhbikiLAogICAgICAgICAgICBmYWxsYmFja1BsYWNlbWVudDogIihzdHJpbmd8YXJyYXkpIiwKICAgICAgICAgICAgYm91bmRhcnk6ICIoc3RyaW5nfGVsZW1lbnQpIiwKICAgICAgICAgICAgc2FuaXRpemU6ICJib29sZWFuIiwKICAgICAgICAgICAgc2FuaXRpemVGbjogIihudWxsfGZ1bmN0aW9uKSIsCiAgICAgICAgICAgIHdoaXRlTGlzdDogIm9iamVjdCIsCiAgICAgICAgICAgIHBvcHBlckNvbmZpZzogIihudWxsfG9iamVjdCkiCiAgICAgICAgfSwKICAgICAgICBWID0gewogICAgICAgICAgICBBVVRPOiAiYXV0byIsCiAgICAgICAgICAgIFRPUDogInRvcCIsCiAgICAgICAgICAgIFJJR0hUOiAicmlnaHQiLAogICAgICAgICAgICBCT1RUT006ICJib3R0b20iLAogICAgICAgICAgICBMRUZUOiAibGVmdCIKICAgICAgICB9LAogICAgICAgIHogPSB7CiAgICAgICAgICAgIGFuaW1hdGlvbjogITAsCiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz0idG9vbHRpcCIgcm9sZT0idG9vbHRpcCI+PGRpdiBjbGFzcz0iYXJyb3ciPjwvZGl2PjxkaXYgY2xhc3M9InRvb2x0aXAtaW5uZXIiPjwvZGl2PjwvZGl2PicsCiAgICAgICAgICAgIHRyaWdnZXI6ICJob3ZlciBmb2N1cyIsCiAgICAgICAgICAgIHRpdGxlOiAiIiwKICAgICAgICAgICAgZGVsYXk6IDAsCiAgICAgICAgICAgIGh0bWw6ICExLAogICAgICAgICAgICBzZWxlY3RvcjogITEsCiAgICAgICAgICAgIHBsYWNlbWVudDogInRvcCIsCiAgICAgICAgICAgIG9mZnNldDogMCwKICAgICAgICAgICAgY29udGFpbmVyOiAhMSwKICAgICAgICAgICAgZmFsbGJhY2tQbGFjZW1lbnQ6ICJmbGlwIiwKICAgICAgICAgICAgYm91bmRhcnk6ICJzY3JvbGxQYXJlbnQiLAogICAgICAgICAgICBzYW5pdGl6ZTogITAsCiAgICAgICAgICAgIHNhbml0aXplRm46IG51bGwsCiAgICAgICAgICAgIHdoaXRlTGlzdDogTCwKICAgICAgICAgICAgcG9wcGVyQ29uZmlnOiBudWxsCiAgICAgICAgfSwKICAgICAgICBLID0gewogICAgICAgICAgICBISURFOiAiaGlkZS5icy50b29sdGlwIiwKICAgICAgICAgICAgSElEREVOOiAiaGlkZGVuLmJzLnRvb2x0aXAiLAogICAgICAgICAgICBTSE9XOiAic2hvdy5icy50b29sdGlwIiwKICAgICAgICAgICAgU0hPV046ICJzaG93bi5icy50b29sdGlwIiwKICAgICAgICAgICAgSU5TRVJURUQ6ICJpbnNlcnRlZC5icy50b29sdGlwIiwKICAgICAgICAgICAgQ0xJQ0s6ICJjbGljay5icy50b29sdGlwIiwKICAgICAgICAgICAgRk9DVVNJTjogImZvY3VzaW4uYnMudG9vbHRpcCIsCiAgICAgICAgICAgIEZPQ1VTT1VUOiAiZm9jdXNvdXQuYnMudG9vbHRpcCIsCiAgICAgICAgICAgIE1PVVNFRU5URVI6ICJtb3VzZWVudGVyLmJzLnRvb2x0aXAiLAogICAgICAgICAgICBNT1VTRUxFQVZFOiAibW91c2VsZWF2ZS5icy50b29sdGlwIgogICAgICAgIH0sCiAgICAgICAgWCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBmdW5jdGlvbiB0KHQsIGUpIHsKICAgICAgICAgICAgICAgIGlmICgidW5kZWZpbmVkIiA9PSB0eXBlb2YgbikgdGhyb3cgbmV3IFR5cGVFcnJvcigiQm9vdHN0cmFwJ3MgdG9vbHRpcHMgcmVxdWlyZSBQb3BwZXIuanMgKGh0dHBzOi8vcG9wcGVyLmpzLm9yZy8pIik7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSAhMCwgdGhpcy5fdGltZW91dCA9IDAsIHRoaXMuX2hvdmVyU3RhdGUgPSAiIiwgdGhpcy5fYWN0aXZlVHJpZ2dlciA9IHt9LCB0aGlzLl9wb3BwZXIgPSBudWxsLCB0aGlzLmVsZW1lbnQgPSB0LCB0aGlzLmNvbmZpZyA9IHRoaXMuX2dldENvbmZpZyhlKSwgdGhpcy50aXAgPSBudWxsLCB0aGlzLl9zZXRMaXN0ZW5lcnMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBpID0gdC5wcm90b3R5cGU7CiAgICAgICAgICAgIHJldHVybiBpLmVuYWJsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gITAKICAgICAgICAgICAgfSwgaS5kaXNhYmxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSAhMQogICAgICAgICAgICB9LCBpLnRvZ2dsZUVuYWJsZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2lzRW5hYmxlZCA9ICF0aGlzLl9pc0VuYWJsZWQKICAgICAgICAgICAgfSwgaS50b2dnbGUgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkKQogICAgICAgICAgICAgICAgICAgIGlmICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gdGhpcy5jb25zdHJ1Y3Rvci5EQVRBX0tFWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBlKHQuY3VycmVudFRhcmdldCkuZGF0YShuKTsKICAgICAgICAgICAgICAgICAgICAgICAgaSB8fCAoaSA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKHQuY3VycmVudFRhcmdldCwgdGhpcy5fZ2V0RGVsZWdhdGVDb25maWcoKSksIGUodC5jdXJyZW50VGFyZ2V0KS5kYXRhKG4sIGkpKSwgaS5fYWN0aXZlVHJpZ2dlci5jbGljayA9ICFpLl9hY3RpdmVUcmlnZ2VyLmNsaWNrLCBpLl9pc1dpdGhBY3RpdmVUcmlnZ2VyKCkgPyBpLl9lbnRlcihudWxsLCBpKSA6IGkuX2xlYXZlKG51bGwsIGkpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUodGhpcy5nZXRUaXBFbGVtZW50KCkpLmhhc0NsYXNzKCJzaG93IikpIHJldHVybiB2b2lkIHRoaXMuX2xlYXZlKG51bGwsIHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9lbnRlcihudWxsLCB0aGlzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgaS5kaXNwb3NlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fdGltZW91dCksIGUucmVtb3ZlRGF0YSh0aGlzLmVsZW1lbnQsIHRoaXMuY29uc3RydWN0b3IuREFUQV9LRVkpLCBlKHRoaXMuZWxlbWVudCkub2ZmKHRoaXMuY29uc3RydWN0b3IuRVZFTlRfS0VZKSwgZSh0aGlzLmVsZW1lbnQpLmNsb3Nlc3QoIi5tb2RhbCIpLm9mZigiaGlkZS5icy5tb2RhbCIsIHRoaXMuX2hpZGVNb2RhbEhhbmRsZXIpLCB0aGlzLnRpcCAmJiBlKHRoaXMudGlwKS5yZW1vdmUoKSwgdGhpcy5faXNFbmFibGVkID0gbnVsbCwgdGhpcy5fdGltZW91dCA9IG51bGwsIHRoaXMuX2hvdmVyU3RhdGUgPSBudWxsLCB0aGlzLl9hY3RpdmVUcmlnZ2VyID0gbnVsbCwgdGhpcy5fcG9wcGVyICYmIHRoaXMuX3BvcHBlci5kZXN0cm95KCksIHRoaXMuX3BvcHBlciA9IG51bGwsIHRoaXMuZWxlbWVudCA9IG51bGwsIHRoaXMuY29uZmlnID0gbnVsbCwgdGhpcy50aXAgPSBudWxsCiAgICAgICAgICAgIH0sIGkuc2hvdyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzOwogICAgICAgICAgICAgICAgaWYgKCJub25lIiA9PT0gZSh0aGlzLmVsZW1lbnQpLmNzcygiZGlzcGxheSIpKSB0aHJvdyBuZXcgRXJyb3IoIlBsZWFzZSB1c2Ugc2hvdyBvbiB2aXNpYmxlIGVsZW1lbnRzIik7CiAgICAgICAgICAgICAgICB2YXIgaSA9IGUuRXZlbnQodGhpcy5jb25zdHJ1Y3Rvci5FdmVudC5TSE9XKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzV2l0aENvbnRlbnQoKSAmJiB0aGlzLl9pc0VuYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgICBlKHRoaXMuZWxlbWVudCkudHJpZ2dlcihpKTsKICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGEuZmluZFNoYWRvd1Jvb3QodGhpcy5lbGVtZW50KSwKICAgICAgICAgICAgICAgICAgICAgICAgcyA9IGUuY29udGFpbnMobnVsbCAhPT0gbyA/IG8gOiB0aGlzLmVsZW1lbnQub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIHRoaXMuZWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgIXMpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMuZ2V0VGlwRWxlbWVudCgpLAogICAgICAgICAgICAgICAgICAgICAgICBsID0gYS5nZXRVSUQodGhpcy5jb25zdHJ1Y3Rvci5OQU1FKTsKICAgICAgICAgICAgICAgICAgICByLnNldEF0dHJpYnV0ZSgiaWQiLCBsKSwgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgiYXJpYS1kZXNjcmliZWRieSIsIGwpLCB0aGlzLnNldENvbnRlbnQoKSwgdGhpcy5jb25maWcuYW5pbWF0aW9uICYmIGUocikuYWRkQ2xhc3MoImZhZGUiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHRoaXMuY29uZmlnLnBsYWNlbWVudCA/IHRoaXMuY29uZmlnLnBsYWNlbWVudC5jYWxsKHRoaXMsIHIsIHRoaXMuZWxlbWVudCkgOiB0aGlzLmNvbmZpZy5wbGFjZW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSB0aGlzLl9nZXRBdHRhY2htZW50KGMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQXR0YWNobWVudENsYXNzKGgpOwogICAgICAgICAgICAgICAgICAgIHZhciB1ID0gdGhpcy5fZ2V0Q29udGFpbmVyKCk7CiAgICAgICAgICAgICAgICAgICAgZShyKS5kYXRhKHRoaXMuY29uc3RydWN0b3IuREFUQV9LRVksIHRoaXMpLCBlLmNvbnRhaW5zKHRoaXMuZWxlbWVudC5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgdGhpcy50aXApIHx8IGUocikuYXBwZW5kVG8odSksIGUodGhpcy5lbGVtZW50KS50cmlnZ2VyKHRoaXMuY29uc3RydWN0b3IuRXZlbnQuSU5TRVJURUQpLCB0aGlzLl9wb3BwZXIgPSBuZXcgbih0aGlzLmVsZW1lbnQsIHIsIHRoaXMuX2dldFBvcHBlckNvbmZpZyhoKSksIGUocikuYWRkQ2xhc3MoInNob3ciKSwgIm9udG91Y2hzdGFydCIgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIGUoZG9jdW1lbnQuYm9keSkuY2hpbGRyZW4oKS5vbigibW91c2VvdmVyIiwgbnVsbCwgZS5ub29wKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB0LmNvbmZpZy5hbmltYXRpb24gJiYgdC5fZml4VHJhbnNpdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHQuX2hvdmVyU3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHQuX2hvdmVyU3RhdGUgPSBudWxsLCBlKHQuZWxlbWVudCkudHJpZ2dlcih0LmNvbnN0cnVjdG9yLkV2ZW50LlNIT1dOKSwgIm91dCIgPT09IG4gJiYgdC5fbGVhdmUobnVsbCwgdCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGlmIChlKHRoaXMudGlwKS5oYXNDbGFzcygiZmFkZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gYS5nZXRUcmFuc2l0aW9uRHVyYXRpb25Gcm9tRWxlbWVudCh0aGlzLnRpcCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUodGhpcy50aXApLm9uZShhLlRSQU5TSVRJT05fRU5ELCBkKS5lbXVsYXRlVHJhbnNpdGlvbkVuZChmKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBkKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgaS5oaWRlID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgdmFyIG4gPSB0aGlzLAogICAgICAgICAgICAgICAgICAgIGkgPSB0aGlzLmdldFRpcEVsZW1lbnQoKSwKICAgICAgICAgICAgICAgICAgICBvID0gZS5FdmVudCh0aGlzLmNvbnN0cnVjdG9yLkV2ZW50LkhJREUpLAogICAgICAgICAgICAgICAgICAgIHMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgInNob3ciICE9PSBuLl9ob3ZlclN0YXRlICYmIGkucGFyZW50Tm9kZSAmJiBpLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaSksIG4uX2NsZWFuVGlwQ2xhc3MoKSwgbi5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgiYXJpYS1kZXNjcmliZWRieSIpLCBlKG4uZWxlbWVudCkudHJpZ2dlcihuLmNvbnN0cnVjdG9yLkV2ZW50LkhJRERFTiksIG51bGwgIT09IG4uX3BvcHBlciAmJiBuLl9wb3BwZXIuZGVzdHJveSgpLCB0ICYmIHQoKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAoZSh0aGlzLmVsZW1lbnQpLnRyaWdnZXIobyksICFvLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGUoaSkucmVtb3ZlQ2xhc3MoInNob3ciKSwgIm9udG91Y2hzdGFydCIgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIGUoZG9jdW1lbnQuYm9keSkuY2hpbGRyZW4oKS5vZmYoIm1vdXNlb3ZlciIsIG51bGwsIGUubm9vcCksIHRoaXMuX2FjdGl2ZVRyaWdnZXIuY2xpY2sgPSAhMSwgdGhpcy5fYWN0aXZlVHJpZ2dlci5mb2N1cyA9ICExLCB0aGlzLl9hY3RpdmVUcmlnZ2VyLmhvdmVyID0gITEsIGUodGhpcy50aXApLmhhc0NsYXNzKCJmYWRlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSBhLmdldFRyYW5zaXRpb25EdXJhdGlvbkZyb21FbGVtZW50KGkpOwogICAgICAgICAgICAgICAgICAgICAgICBlKGkpLm9uZShhLlRSQU5TSVRJT05fRU5ELCBzKS5lbXVsYXRlVHJhbnNpdGlvbkVuZChyKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBzKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faG92ZXJTdGF0ZSA9ICIiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGkudXBkYXRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBudWxsICE9PSB0aGlzLl9wb3BwZXIgJiYgdGhpcy5fcG9wcGVyLnNjaGVkdWxlVXBkYXRlKCkKICAgICAgICAgICAgfSwgaS5pc1dpdGhDb250ZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQm9vbGVhbih0aGlzLmdldFRpdGxlKCkpCiAgICAgICAgICAgIH0sIGkuYWRkQXR0YWNobWVudENsYXNzID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgZSh0aGlzLmdldFRpcEVsZW1lbnQoKSkuYWRkQ2xhc3MoImJzLXRvb2x0aXAtIiArIHQpCiAgICAgICAgICAgIH0sIGkuZ2V0VGlwRWxlbWVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudGlwID0gdGhpcy50aXAgfHwgZSh0aGlzLmNvbmZpZy50ZW1wbGF0ZSlbMF0sIHRoaXMudGlwCiAgICAgICAgICAgIH0sIGkuc2V0Q29udGVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmdldFRpcEVsZW1lbnQoKTsKICAgICAgICAgICAgICAgIHRoaXMuc2V0RWxlbWVudENvbnRlbnQoZSh0LnF1ZXJ5U2VsZWN0b3JBbGwoIi50b29sdGlwLWlubmVyIikpLCB0aGlzLmdldFRpdGxlKCkpLCBlKHQpLnJlbW92ZUNsYXNzKCJmYWRlIHNob3ciKQogICAgICAgICAgICB9LCBpLnNldEVsZW1lbnRDb250ZW50ID0gZnVuY3Rpb24odCwgbikgewogICAgICAgICAgICAgICAgIm9iamVjdCIgIT0gdHlwZW9mIG4gfHwgIW4ubm9kZVR5cGUgJiYgIW4uanF1ZXJ5ID8gdGhpcy5jb25maWcuaHRtbCA/ICh0aGlzLmNvbmZpZy5zYW5pdGl6ZSAmJiAobiA9IFEobiwgdGhpcy5jb25maWcud2hpdGVMaXN0LCB0aGlzLmNvbmZpZy5zYW5pdGl6ZUZuKSksIHQuaHRtbChuKSkgOiB0LnRleHQobikgOiB0aGlzLmNvbmZpZy5odG1sID8gZShuKS5wYXJlbnQoKS5pcyh0KSB8fCB0LmVtcHR5KCkuYXBwZW5kKG4pIDogdC50ZXh0KGUobikudGV4dCgpKQogICAgICAgICAgICB9LCBpLmdldFRpdGxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMuZWxlbWVudC5nZXRBdHRyaWJ1dGUoImRhdGEtb3JpZ2luYWwtdGl0bGUiKTsKICAgICAgICAgICAgICAgIHJldHVybiB0IHx8ICh0ID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdGhpcy5jb25maWcudGl0bGUgPyB0aGlzLmNvbmZpZy50aXRsZS5jYWxsKHRoaXMuZWxlbWVudCkgOiB0aGlzLmNvbmZpZy50aXRsZSksIHQKICAgICAgICAgICAgfSwgaS5fZ2V0UG9wcGVyQ29uZmlnID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzOwogICAgICAgICAgICAgICAgcmV0dXJuIHMoe30sIHsKICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6IHQsCiAgICAgICAgICAgICAgICAgICAgbW9kaWZpZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogdGhpcy5fZ2V0T2Zmc2V0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIGZsaXA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlaGF2aW9yOiB0aGlzLmNvbmZpZy5mYWxsYmFja1BsYWNlbWVudAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBhcnJvdzogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogIi5hcnJvdyIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgcHJldmVudE92ZXJmbG93OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3VuZGFyaWVzRWxlbWVudDogdGhpcy5jb25maWcuYm91bmRhcnkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25DcmVhdGU6IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC5vcmlnaW5hbFBsYWNlbWVudCAhPT0gdC5wbGFjZW1lbnQgJiYgZS5faGFuZGxlUG9wcGVyUGxhY2VtZW50Q2hhbmdlKHQpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvblVwZGF0ZTogZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5faGFuZGxlUG9wcGVyUGxhY2VtZW50Q2hhbmdlKHQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgdGhpcy5jb25maWcucG9wcGVyQ29uZmlnKQogICAgICAgICAgICB9LCBpLl9nZXRPZmZzZXQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICAgICAgICBlID0ge307CiAgICAgICAgICAgICAgICByZXR1cm4gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdGhpcy5jb25maWcub2Zmc2V0ID8gZS5mbiA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5vZmZzZXRzID0gcyh7fSwgZS5vZmZzZXRzLCB0LmNvbmZpZy5vZmZzZXQoZS5vZmZzZXRzLCB0LmVsZW1lbnQpIHx8IHt9KSwgZQogICAgICAgICAgICAgICAgfSA6IGUub2Zmc2V0ID0gdGhpcy5jb25maWcub2Zmc2V0LCBlCiAgICAgICAgICAgIH0sIGkuX2dldENvbnRhaW5lciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICExID09PSB0aGlzLmNvbmZpZy5jb250YWluZXIgPyBkb2N1bWVudC5ib2R5IDogYS5pc0VsZW1lbnQodGhpcy5jb25maWcuY29udGFpbmVyKSA/IGUodGhpcy5jb25maWcuY29udGFpbmVyKSA6IGUoZG9jdW1lbnQpLmZpbmQodGhpcy5jb25maWcuY29udGFpbmVyKQogICAgICAgICAgICB9LCBpLl9nZXRBdHRhY2htZW50ID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFZbdC50b1VwcGVyQ2FzZSgpXQogICAgICAgICAgICB9LCBpLl9zZXRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLnRyaWdnZXIuc3BsaXQoIiAiKS5mb3JFYWNoKChmdW5jdGlvbihuKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCJjbGljayIgPT09IG4pIGUodC5lbGVtZW50KS5vbih0LmNvbnN0cnVjdG9yLkV2ZW50LkNMSUNLLCB0LmNvbmZpZy5zZWxlY3RvciwgKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQudG9nZ2xlKGUpCiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCJtYW51YWwiICE9PSBuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gImhvdmVyIiA9PT0gbiA/IHQuY29uc3RydWN0b3IuRXZlbnQuTU9VU0VFTlRFUiA6IHQuY29uc3RydWN0b3IuRXZlbnQuRk9DVVNJTiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8gPSAiaG92ZXIiID09PSBuID8gdC5jb25zdHJ1Y3Rvci5FdmVudC5NT1VTRUxFQVZFIDogdC5jb25zdHJ1Y3Rvci5FdmVudC5GT0NVU09VVDsKICAgICAgICAgICAgICAgICAgICAgICAgZSh0LmVsZW1lbnQpLm9uKGksIHQuY29uZmlnLnNlbGVjdG9yLCAoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuX2VudGVyKGUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKS5vbihvLCB0LmNvbmZpZy5zZWxlY3RvciwgKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0Ll9sZWF2ZShlKQogICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSksIHRoaXMuX2hpZGVNb2RhbEhhbmRsZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0LmVsZW1lbnQgJiYgdC5oaWRlKCkKICAgICAgICAgICAgICAgIH0sIGUodGhpcy5lbGVtZW50KS5jbG9zZXN0KCIubW9kYWwiKS5vbigiaGlkZS5icy5tb2RhbCIsIHRoaXMuX2hpZGVNb2RhbEhhbmRsZXIpLCB0aGlzLmNvbmZpZy5zZWxlY3RvciA/IHRoaXMuY29uZmlnID0gcyh7fSwgdGhpcy5jb25maWcsIHsKICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiAibWFudWFsIiwKICAgICAgICAgICAgICAgICAgICBzZWxlY3RvcjogIiIKICAgICAgICAgICAgICAgIH0pIDogdGhpcy5fZml4VGl0bGUoKQogICAgICAgICAgICB9LCBpLl9maXhUaXRsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSB0eXBlb2YgdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS1vcmlnaW5hbC10aXRsZSIpOwogICAgICAgICAgICAgICAgKHRoaXMuZWxlbWVudC5nZXRBdHRyaWJ1dGUoInRpdGxlIikgfHwgInN0cmluZyIgIT09IHQpICYmICh0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLW9yaWdpbmFsLXRpdGxlIiwgdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZSgidGl0bGUiKSB8fCAiIiksIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoInRpdGxlIiwgIiIpKQogICAgICAgICAgICB9LCBpLl9lbnRlciA9IGZ1bmN0aW9uKHQsIG4pIHsKICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy5jb25zdHJ1Y3Rvci5EQVRBX0tFWTsKICAgICAgICAgICAgICAgIChuID0gbiB8fCBlKHQuY3VycmVudFRhcmdldCkuZGF0YShpKSkgfHwgKG4gPSBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0LmN1cnJlbnRUYXJnZXQsIHRoaXMuX2dldERlbGVnYXRlQ29uZmlnKCkpLCBlKHQuY3VycmVudFRhcmdldCkuZGF0YShpLCBuKSksIHQgJiYgKG4uX2FjdGl2ZVRyaWdnZXJbImZvY3VzaW4iID09PSB0LnR5cGUgPyAiZm9jdXMiIDogImhvdmVyIl0gPSAhMCksIGUobi5nZXRUaXBFbGVtZW50KCkpLmhhc0NsYXNzKCJzaG93IikgfHwgInNob3ciID09PSBuLl9ob3ZlclN0YXRlID8gbi5faG92ZXJTdGF0ZSA9ICJzaG93IiA6IChjbGVhclRpbWVvdXQobi5fdGltZW91dCksIG4uX2hvdmVyU3RhdGUgPSAic2hvdyIsIG4uY29uZmlnLmRlbGF5ICYmIG4uY29uZmlnLmRlbGF5LnNob3cgPyBuLl90aW1lb3V0ID0gc2V0VGltZW91dCgoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgInNob3ciID09PSBuLl9ob3ZlclN0YXRlICYmIG4uc2hvdygpCiAgICAgICAgICAgICAgICB9KSwgbi5jb25maWcuZGVsYXkuc2hvdykgOiBuLnNob3coKSkKICAgICAgICAgICAgfSwgaS5fbGVhdmUgPSBmdW5jdGlvbih0LCBuKSB7CiAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuY29uc3RydWN0b3IuREFUQV9LRVk7CiAgICAgICAgICAgICAgICAobiA9IG4gfHwgZSh0LmN1cnJlbnRUYXJnZXQpLmRhdGEoaSkpIHx8IChuID0gbmV3IHRoaXMuY29uc3RydWN0b3IodC5jdXJyZW50VGFyZ2V0LCB0aGlzLl9nZXREZWxlZ2F0ZUNvbmZpZygpKSwgZSh0LmN1cnJlbnRUYXJnZXQpLmRhdGEoaSwgbikpLCB0ICYmIChuLl9hY3RpdmVUcmlnZ2VyWyJmb2N1c291dCIgPT09IHQudHlwZSA/ICJmb2N1cyIgOiAiaG92ZXIiXSA9ICExKSwgbi5faXNXaXRoQWN0aXZlVHJpZ2dlcigpIHx8IChjbGVhclRpbWVvdXQobi5fdGltZW91dCksIG4uX2hvdmVyU3RhdGUgPSAib3V0Iiwgbi5jb25maWcuZGVsYXkgJiYgbi5jb25maWcuZGVsYXkuaGlkZSA/IG4uX3RpbWVvdXQgPSBzZXRUaW1lb3V0KChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAib3V0IiA9PT0gbi5faG92ZXJTdGF0ZSAmJiBuLmhpZGUoKQogICAgICAgICAgICAgICAgfSksIG4uY29uZmlnLmRlbGF5LmhpZGUpIDogbi5oaWRlKCkpCiAgICAgICAgICAgIH0sIGkuX2lzV2l0aEFjdGl2ZVRyaWdnZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIHQgaW4gdGhpcy5fYWN0aXZlVHJpZ2dlcikKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYWN0aXZlVHJpZ2dlclt0XSkgcmV0dXJuICEwOwogICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgIH0sIGkuX2dldENvbmZpZyA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIHZhciBuID0gZSh0aGlzLmVsZW1lbnQpLmRhdGEoKTsKICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhuKS5mb3JFYWNoKChmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgICAgLTEgIT09IE0uaW5kZXhPZih0KSAmJiBkZWxldGUgblt0XQogICAgICAgICAgICAgICAgfSkpLCAibnVtYmVyIiA9PSB0eXBlb2YodCA9IHMoe30sIHRoaXMuY29uc3RydWN0b3IuRGVmYXVsdCwgbiwgIm9iamVjdCIgPT0gdHlwZW9mIHQgJiYgdCA/IHQgOiB7fSkpLmRlbGF5ICYmICh0LmRlbGF5ID0gewogICAgICAgICAgICAgICAgICAgIHNob3c6IHQuZGVsYXksCiAgICAgICAgICAgICAgICAgICAgaGlkZTogdC5kZWxheQogICAgICAgICAgICAgICAgfSksICJudW1iZXIiID09IHR5cGVvZiB0LnRpdGxlICYmICh0LnRpdGxlID0gdC50aXRsZS50b1N0cmluZygpKSwgIm51bWJlciIgPT0gdHlwZW9mIHQuY29udGVudCAmJiAodC5jb250ZW50ID0gdC5jb250ZW50LnRvU3RyaW5nKCkpLCBhLnR5cGVDaGVja0NvbmZpZyhCLCB0LCB0aGlzLmNvbnN0cnVjdG9yLkRlZmF1bHRUeXBlKSwgdC5zYW5pdGl6ZSAmJiAodC50ZW1wbGF0ZSA9IFEodC50ZW1wbGF0ZSwgdC53aGl0ZUxpc3QsIHQuc2FuaXRpemVGbikpLCB0CiAgICAgICAgICAgIH0sIGkuX2dldERlbGVnYXRlQ29uZmlnID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IHt9OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnKQogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGUgaW4gdGhpcy5jb25maWcpIHRoaXMuY29uc3RydWN0b3IuRGVmYXVsdFtlXSAhPT0gdGhpcy5jb25maWdbZV0gJiYgKHRbZV0gPSB0aGlzLmNvbmZpZ1tlXSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdAogICAgICAgICAgICB9LCBpLl9jbGVhblRpcENsYXNzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IGUodGhpcy5nZXRUaXBFbGVtZW50KCkpLAogICAgICAgICAgICAgICAgICAgIG4gPSB0LmF0dHIoImNsYXNzIikubWF0Y2goVSk7CiAgICAgICAgICAgICAgICBudWxsICE9PSBuICYmIG4ubGVuZ3RoICYmIHQucmVtb3ZlQ2xhc3Mobi5qb2luKCIiKSkKICAgICAgICAgICAgfSwgaS5faGFuZGxlUG9wcGVyUGxhY2VtZW50Q2hhbmdlID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgdGhpcy50aXAgPSB0Lmluc3RhbmNlLnBvcHBlciwgdGhpcy5fY2xlYW5UaXBDbGFzcygpLCB0aGlzLmFkZEF0dGFjaG1lbnRDbGFzcyh0aGlzLl9nZXRBdHRhY2htZW50KHQucGxhY2VtZW50KSkKICAgICAgICAgICAgfSwgaS5fZml4VHJhbnNpdGlvbiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmdldFRpcEVsZW1lbnQoKSwKICAgICAgICAgICAgICAgICAgICBuID0gdGhpcy5jb25maWcuYW5pbWF0aW9uOwogICAgICAgICAgICAgICAgbnVsbCA9PT0gdC5nZXRBdHRyaWJ1dGUoIngtcGxhY2VtZW50IikgJiYgKGUodCkucmVtb3ZlQ2xhc3MoImZhZGUiKSwgdGhpcy5jb25maWcuYW5pbWF0aW9uID0gITEsIHRoaXMuaGlkZSgpLCB0aGlzLnNob3coKSwgdGhpcy5jb25maWcuYW5pbWF0aW9uID0gbikKICAgICAgICAgICAgfSwgdC5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24obikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaCgoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBlKHRoaXMpLmRhdGEoImJzLnRvb2x0aXAiKSwKICAgICAgICAgICAgICAgICAgICAgICAgbyA9ICJvYmplY3QiID09IHR5cGVvZiBuICYmIG47CiAgICAgICAgICAgICAgICAgICAgaWYgKChpIHx8ICEvZGlzcG9zZXxoaWRlLy50ZXN0KG4pKSAmJiAoaSB8fCAoaSA9IG5ldyB0KHRoaXMsIG8pLCBlKHRoaXMpLmRhdGEoImJzLnRvb2x0aXAiLCBpKSksICJzdHJpbmciID09IHR5cGVvZiBuKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoInVuZGVmaW5lZCIgPT0gdHlwZW9mIGlbbl0pIHRocm93IG5ldyBUeXBlRXJyb3IoJ05vIG1ldGhvZCBuYW1lZCAiJyArIG4gKyAnIicpOwogICAgICAgICAgICAgICAgICAgICAgICBpW25dKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgfSwgbyh0LCBudWxsLCBbewogICAgICAgICAgICAgICAga2V5OiAiVkVSU0lPTiIsCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiNC41LjIiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGtleTogIkRlZmF1bHQiLAogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gegogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBrZXk6ICJOQU1FIiwKICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAga2V5OiAiREFUQV9LRVkiLAogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gImJzLnRvb2x0aXAiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGtleTogIkV2ZW50IiwKICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAga2V5OiAiRVZFTlRfS0VZIiwKICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIuYnMudG9vbHRpcCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAga2V5OiAiRGVmYXVsdFR5cGUiLAogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XSksIHQKICAgICAgICB9KCk7CiAgICBlLmZuW0JdID0gWC5falF1ZXJ5SW50ZXJmYWNlLCBlLmZuW0JdLkNvbnN0cnVjdG9yID0gWCwgZS5mbltCXS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGUuZm5bQl0gPSBILCBYLl9qUXVlcnlJbnRlcmZhY2UKICAgIH07CiAgICB2YXIgWSA9ICJwb3BvdmVyIiwKICAgICAgICAkID0gZS5mbltZXSwKICAgICAgICBKID0gbmV3IFJlZ0V4cCgiKF58XFxzKWJzLXBvcG92ZXJcXFMrIiwgImciKSwKICAgICAgICBHID0gcyh7fSwgWC5EZWZhdWx0LCB7CiAgICAgICAgICAgIHBsYWNlbWVudDogInJpZ2h0IiwKICAgICAgICAgICAgdHJpZ2dlcjogImNsaWNrIiwKICAgICAgICAgICAgY29udGVudDogIiIsCiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz0icG9wb3ZlciIgcm9sZT0idG9vbHRpcCI+PGRpdiBjbGFzcz0iYXJyb3ciPjwvZGl2PjxoMyBjbGFzcz0icG9wb3Zlci1oZWFkZXIiPjwvaDM+PGRpdiBjbGFzcz0icG9wb3Zlci1ib2R5Ij48L2Rpdj48L2Rpdj4nCiAgICAgICAgfSksCiAgICAgICAgWiA9IHMoe30sIFguRGVmYXVsdFR5cGUsIHsKICAgICAgICAgICAgY29udGVudDogIihzdHJpbmd8ZWxlbWVudHxmdW5jdGlvbikiCiAgICAgICAgfSksCiAgICAgICAgdHQgPSB7CiAgICAgICAgICAgIEhJREU6ICJoaWRlLmJzLnBvcG92ZXIiLAogICAgICAgICAgICBISURERU46ICJoaWRkZW4uYnMucG9wb3ZlciIsCiAgICAgICAgICAgIFNIT1c6ICJzaG93LmJzLnBvcG92ZXIiLAogICAgICAgICAgICBTSE9XTjogInNob3duLmJzLnBvcG92ZXIiLAogICAgICAgICAgICBJTlNFUlRFRDogImluc2VydGVkLmJzLnBvcG92ZXIiLAogICAgICAgICAgICBDTElDSzogImNsaWNrLmJzLnBvcG92ZXIiLAogICAgICAgICAgICBGT0NVU0lOOiAiZm9jdXNpbi5icy5wb3BvdmVyIiwKICAgICAgICAgICAgRk9DVVNPVVQ6ICJmb2N1c291dC5icy5wb3BvdmVyIiwKICAgICAgICAgICAgTU9VU0VFTlRFUjogIm1vdXNlZW50ZXIuYnMucG9wb3ZlciIsCiAgICAgICAgICAgIE1PVVNFTEVBVkU6ICJtb3VzZWxlYXZlLmJzLnBvcG92ZXIiCiAgICAgICAgfSwKICAgICAgICBldCA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgdmFyIG4sIGk7CgogICAgICAgICAgICBmdW5jdGlvbiBzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSA9IHQsIChuID0gcykucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShpLnByb3RvdHlwZSksIG4ucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gbiwgbi5fX3Byb3RvX18gPSBpOwogICAgICAgICAgICB2YXIgciA9IHMucHJvdG90eXBlOwogICAgICAgICAgICByZXR1cm4gci5pc1dpdGhDb250ZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRUaXRsZSgpIHx8IHRoaXMuX2dldENvbnRlbnQoKQogICAgICAgICAgICB9LCByLmFkZEF0dGFjaG1lbnRDbGFzcyA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIGUodGhpcy5nZXRUaXBFbGVtZW50KCkpLmFkZENsYXNzKCJicy1wb3BvdmVyLSIgKyB0KQogICAgICAgICAgICB9LCByLmdldFRpcEVsZW1lbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRpcCA9IHRoaXMudGlwIHx8IGUodGhpcy5jb25maWcudGVtcGxhdGUpWzBdLCB0aGlzLnRpcAogICAgICAgICAgICB9LCByLnNldENvbnRlbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gZSh0aGlzLmdldFRpcEVsZW1lbnQoKSk7CiAgICAgICAgICAgICAgICB0aGlzLnNldEVsZW1lbnRDb250ZW50KHQuZmluZCgiLnBvcG92ZXItaGVhZGVyIiksIHRoaXMuZ2V0VGl0bGUoKSk7CiAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMuX2dldENvbnRlbnQoKTsKICAgICAgICAgICAgICAgICJmdW5jdGlvbiIgPT0gdHlwZW9mIG4gJiYgKG4gPSBuLmNhbGwodGhpcy5lbGVtZW50KSksIHRoaXMuc2V0RWxlbWVudENvbnRlbnQodC5maW5kKCIucG9wb3Zlci1ib2R5IiksIG4pLCB0LnJlbW92ZUNsYXNzKCJmYWRlIHNob3ciKQogICAgICAgICAgICB9LCByLl9nZXRDb250ZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS1jb250ZW50IikgfHwgdGhpcy5jb25maWcuY29udGVudAogICAgICAgICAgICB9LCByLl9jbGVhblRpcENsYXNzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IGUodGhpcy5nZXRUaXBFbGVtZW50KCkpLAogICAgICAgICAgICAgICAgICAgIG4gPSB0LmF0dHIoImNsYXNzIikubWF0Y2goSik7CiAgICAgICAgICAgICAgICBudWxsICE9PSBuICYmIG4ubGVuZ3RoID4gMCAmJiB0LnJlbW92ZUNsYXNzKG4uam9pbigiIikpCiAgICAgICAgICAgIH0sIHMuX2pRdWVyeUludGVyZmFjZSA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBuID0gZSh0aGlzKS5kYXRhKCJicy5wb3BvdmVyIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSAib2JqZWN0IiA9PSB0eXBlb2YgdCA/IHQgOiBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmICgobiB8fCAhL2Rpc3Bvc2V8aGlkZS8udGVzdCh0KSkgJiYgKG4gfHwgKG4gPSBuZXcgcyh0aGlzLCBpKSwgZSh0aGlzKS5kYXRhKCJicy5wb3BvdmVyIiwgbikpLCAic3RyaW5nIiA9PSB0eXBlb2YgdCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09IHR5cGVvZiBuW3RdKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdObyBtZXRob2QgbmFtZWQgIicgKyB0ICsgJyInKTsKICAgICAgICAgICAgICAgICAgICAgICAgblt0XSgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIH0sIG8ocywgbnVsbCwgW3sKICAgICAgICAgICAgICAgIGtleTogIlZFUlNJT04iLAogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjQuNS4yIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBrZXk6ICJEZWZhdWx0IiwKICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEcKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAga2V5OiAiTkFNRSIsCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBZCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGtleTogIkRBVEFfS0VZIiwKICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJicy5wb3BvdmVyIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBrZXk6ICJFdmVudCIsCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0dAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBrZXk6ICJFVkVOVF9LRVkiLAogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIi5icy5wb3BvdmVyIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBrZXk6ICJEZWZhdWx0VHlwZSIsCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBaCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dKSwgcwogICAgICAgIH0oWCk7CiAgICBlLmZuW1ldID0gZXQuX2pRdWVyeUludGVyZmFjZSwgZS5mbltZXS5Db25zdHJ1Y3RvciA9IGV0LCBlLmZuW1ldLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gZS5mbltZXSA9ICQsIGV0Ll9qUXVlcnlJbnRlcmZhY2UKICAgIH07CiAgICB2YXIgbnQgPSAic2Nyb2xsc3B5IiwKICAgICAgICBpdCA9IGUuZm5bbnRdLAogICAgICAgIG90ID0gewogICAgICAgICAgICBvZmZzZXQ6IDEwLAogICAgICAgICAgICBtZXRob2Q6ICJhdXRvIiwKICAgICAgICAgICAgdGFyZ2V0OiAiIgogICAgICAgIH0sCiAgICAgICAgc3QgPSB7CiAgICAgICAgICAgIG9mZnNldDogIm51bWJlciIsCiAgICAgICAgICAgIG1ldGhvZDogInN0cmluZyIsCiAgICAgICAgICAgIHRhcmdldDogIihzdHJpbmd8ZWxlbWVudCkiCiAgICAgICAgfSwKICAgICAgICBydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBmdW5jdGlvbiB0KHQsIG4pIHsKICAgICAgICAgICAgICAgIHZhciBpID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMuX2VsZW1lbnQgPSB0LCB0aGlzLl9zY3JvbGxFbGVtZW50ID0gIkJPRFkiID09PSB0LnRhZ05hbWUgPyB3aW5kb3cgOiB0LCB0aGlzLl9jb25maWcgPSB0aGlzLl9nZXRDb25maWcobiksIHRoaXMuX3NlbGVjdG9yID0gdGhpcy5fY29uZmlnLnRhcmdldCArICIgLm5hdi1saW5rLCIgKyB0aGlzLl9jb25maWcudGFyZ2V0ICsgIiAubGlzdC1ncm91cC1pdGVtLCIgKyB0aGlzLl9jb25maWcudGFyZ2V0ICsgIiAuZHJvcGRvd24taXRlbSIsIHRoaXMuX29mZnNldHMgPSBbXSwgdGhpcy5fdGFyZ2V0cyA9IFtdLCB0aGlzLl9hY3RpdmVUYXJnZXQgPSBudWxsLCB0aGlzLl9zY3JvbGxIZWlnaHQgPSAwLCBlKHRoaXMuX3Njcm9sbEVsZW1lbnQpLm9uKCJzY3JvbGwuYnMuc2Nyb2xsc3B5IiwgKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaS5fcHJvY2Vzcyh0KQogICAgICAgICAgICAgICAgfSkpLCB0aGlzLnJlZnJlc2goKSwgdGhpcy5fcHJvY2VzcygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG4gPSB0LnByb3RvdHlwZTsKICAgICAgICAgICAgcmV0dXJuIG4ucmVmcmVzaCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgIG4gPSB0aGlzLl9zY3JvbGxFbGVtZW50ID09PSB0aGlzLl9zY3JvbGxFbGVtZW50LndpbmRvdyA/ICJvZmZzZXQiIDogInBvc2l0aW9uIiwKICAgICAgICAgICAgICAgICAgICBpID0gImF1dG8iID09PSB0aGlzLl9jb25maWcubWV0aG9kID8gbiA6IHRoaXMuX2NvbmZpZy5tZXRob2QsCiAgICAgICAgICAgICAgICAgICAgbyA9ICJwb3NpdGlvbiIgPT09IGkgPyB0aGlzLl9nZXRTY3JvbGxUb3AoKSA6IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9vZmZzZXRzID0gW10sIHRoaXMuX3RhcmdldHMgPSBbXSwgdGhpcy5fc2Nyb2xsSGVpZ2h0ID0gdGhpcy5fZ2V0U2Nyb2xsSGVpZ2h0KCksIFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9zZWxlY3RvcikpLm1hcCgoZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICAgIHZhciBuLCBzID0gYS5nZXRTZWxlY3RvckZyb21FbGVtZW50KHQpOwogICAgICAgICAgICAgICAgICAgIGlmIChzICYmIChuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzKSksIG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSBuLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoci53aWR0aCB8fCByLmhlaWdodCkgcmV0dXJuIFtlKG4pW2ldKCkudG9wICsgbywgc10KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICAgICAgICAgIH0pKS5maWx0ZXIoKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdAogICAgICAgICAgICAgICAgfSkpLnNvcnQoKGZ1bmN0aW9uKHQsIGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdFswXSAtIGVbMF0KICAgICAgICAgICAgICAgIH0pKS5mb3JFYWNoKChmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgdC5fb2Zmc2V0cy5wdXNoKGVbMF0pLCB0Ll90YXJnZXRzLnB1c2goZVsxXSkKICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICB9LCBuLmRpc3Bvc2UgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGUucmVtb3ZlRGF0YSh0aGlzLl9lbGVtZW50LCAiYnMuc2Nyb2xsc3B5IiksIGUodGhpcy5fc2Nyb2xsRWxlbWVudCkub2ZmKCIuYnMuc2Nyb2xsc3B5IiksIHRoaXMuX2VsZW1lbnQgPSBudWxsLCB0aGlzLl9zY3JvbGxFbGVtZW50ID0gbnVsbCwgdGhpcy5fY29uZmlnID0gbnVsbCwgdGhpcy5fc2VsZWN0b3IgPSBudWxsLCB0aGlzLl9vZmZzZXRzID0gbnVsbCwgdGhpcy5fdGFyZ2V0cyA9IG51bGwsIHRoaXMuX2FjdGl2ZVRhcmdldCA9IG51bGwsIHRoaXMuX3Njcm9sbEhlaWdodCA9IG51bGwKICAgICAgICAgICAgfSwgbi5fZ2V0Q29uZmlnID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgaWYgKCJzdHJpbmciICE9IHR5cGVvZih0ID0gcyh7fSwgb3QsICJvYmplY3QiID09IHR5cGVvZiB0ICYmIHQgPyB0IDoge30pKS50YXJnZXQgJiYgYS5pc0VsZW1lbnQodC50YXJnZXQpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBlKHQudGFyZ2V0KS5hdHRyKCJpZCIpOwogICAgICAgICAgICAgICAgICAgIG4gfHwgKG4gPSBhLmdldFVJRChudCksIGUodC50YXJnZXQpLmF0dHIoImlkIiwgbikpLCB0LnRhcmdldCA9ICIjIiArIG4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBhLnR5cGVDaGVja0NvbmZpZyhudCwgdCwgc3QpLCB0CiAgICAgICAgICAgIH0sIG4uX2dldFNjcm9sbFRvcCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Njcm9sbEVsZW1lbnQgPT09IHdpbmRvdyA/IHRoaXMuX3Njcm9sbEVsZW1lbnQucGFnZVlPZmZzZXQgOiB0aGlzLl9zY3JvbGxFbGVtZW50LnNjcm9sbFRvcAogICAgICAgICAgICB9LCBuLl9nZXRTY3JvbGxIZWlnaHQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zY3JvbGxFbGVtZW50LnNjcm9sbEhlaWdodCB8fCBNYXRoLm1heChkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodCwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodCkKICAgICAgICAgICAgfSwgbi5fZ2V0T2Zmc2V0SGVpZ2h0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2Nyb2xsRWxlbWVudCA9PT0gd2luZG93ID8gd2luZG93LmlubmVySGVpZ2h0IDogdGhpcy5fc2Nyb2xsRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQKICAgICAgICAgICAgfSwgbi5fcHJvY2VzcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLl9nZXRTY3JvbGxUb3AoKSArIHRoaXMuX2NvbmZpZy5vZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgZSA9IHRoaXMuX2dldFNjcm9sbEhlaWdodCgpLAogICAgICAgICAgICAgICAgICAgIG4gPSB0aGlzLl9jb25maWcub2Zmc2V0ICsgZSAtIHRoaXMuX2dldE9mZnNldEhlaWdodCgpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Njcm9sbEhlaWdodCAhPT0gZSAmJiB0aGlzLnJlZnJlc2goKSwgdCA+PSBuKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLl90YXJnZXRzW3RoaXMuX3RhcmdldHMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlVGFyZ2V0ICE9PSBpICYmIHRoaXMuX2FjdGl2YXRlKGkpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hY3RpdmVUYXJnZXQgJiYgdCA8IHRoaXMuX29mZnNldHNbMF0gJiYgdGhpcy5fb2Zmc2V0c1swXSA+IDApIHJldHVybiB0aGlzLl9hY3RpdmVUYXJnZXQgPSBudWxsLCB2b2lkIHRoaXMuX2NsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbyA9IHRoaXMuX29mZnNldHMubGVuZ3RoOyBvLS07KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVRhcmdldCAhPT0gdGhpcy5fdGFyZ2V0c1tvXSAmJiB0ID49IHRoaXMuX29mZnNldHNbb10gJiYgKCJ1bmRlZmluZWQiID09IHR5cGVvZiB0aGlzLl9vZmZzZXRzW28gKyAxXSB8fCB0IDwgdGhpcy5fb2Zmc2V0c1tvICsgMV0pICYmIHRoaXMuX2FjdGl2YXRlKHRoaXMuX3RhcmdldHNbb10pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBuLl9hY3RpdmF0ZSA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVRhcmdldCA9IHQsIHRoaXMuX2NsZWFyKCk7CiAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMuX3NlbGVjdG9yLnNwbGl0KCIsIikubWFwKChmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlICsgJ1tkYXRhLXRhcmdldD0iJyArIHQgKyAnIl0sJyArIGUgKyAnW2hyZWY9IicgKyB0ICsgJyJdJwogICAgICAgICAgICAgICAgICAgIH0pKSwKICAgICAgICAgICAgICAgICAgICBpID0gZShbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwobi5qb2luKCIsIikpKSk7CiAgICAgICAgICAgICAgICBpLmhhc0NsYXNzKCJkcm9wZG93bi1pdGVtIikgPyAoaS5jbG9zZXN0KCIuZHJvcGRvd24iKS5maW5kKCIuZHJvcGRvd24tdG9nZ2xlIikuYWRkQ2xhc3MoImFjdGl2ZSIpLCBpLmFkZENsYXNzKCJhY3RpdmUiKSkgOiAoaS5hZGRDbGFzcygiYWN0aXZlIiksIGkucGFyZW50cygiLm5hdiwgLmxpc3QtZ3JvdXAiKS5wcmV2KCIubmF2LWxpbmssIC5saXN0LWdyb3VwLWl0ZW0iKS5hZGRDbGFzcygiYWN0aXZlIiksIGkucGFyZW50cygiLm5hdiwgLmxpc3QtZ3JvdXAiKS5wcmV2KCIubmF2LWl0ZW0iKS5jaGlsZHJlbigiLm5hdi1saW5rIikuYWRkQ2xhc3MoImFjdGl2ZSIpKSwgZSh0aGlzLl9zY3JvbGxFbGVtZW50KS50cmlnZ2VyKCJhY3RpdmF0ZS5icy5zY3JvbGxzcHkiLCB7CiAgICAgICAgICAgICAgICAgICAgcmVsYXRlZFRhcmdldDogdAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwgbi5fY2xlYXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9zZWxlY3RvcikpLmZpbHRlcigoZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmNsYXNzTGlzdC5jb250YWlucygiYWN0aXZlIikKICAgICAgICAgICAgICAgIH0pKS5mb3JFYWNoKChmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuY2xhc3NMaXN0LnJlbW92ZSgiYWN0aXZlIikKICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICB9LCB0Ll9qUXVlcnlJbnRlcmZhY2UgPSBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IGUodGhpcykuZGF0YSgiYnMuc2Nyb2xsc3B5Iik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgfHwgKGkgPSBuZXcgdCh0aGlzLCAib2JqZWN0IiA9PSB0eXBlb2YgbiAmJiBuKSwgZSh0aGlzKS5kYXRhKCJicy5zY3JvbGxzcHkiLCBpKSksICJzdHJpbmciID09IHR5cGVvZiBuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgidW5kZWZpbmVkIiA9PSB0eXBlb2YgaVtuXSkgdGhyb3cgbmV3IFR5cGVFcnJvcignTm8gbWV0aG9kIG5hbWVkICInICsgbiArICciJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlbbl0oKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICB9LCBvKHQsIG51bGwsIFt7CiAgICAgICAgICAgICAgICBrZXk6ICJWRVJTSU9OIiwKICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI0LjUuMiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAga2V5OiAiRGVmYXVsdCIsCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBvdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XSksIHQKICAgICAgICB9KCk7CiAgICBlKHdpbmRvdykub24oImxvYWQuYnMuc2Nyb2xsc3B5LmRhdGEtYXBpIiwgKGZ1bmN0aW9uKCkgewogICAgICAgIGZvciAodmFyIHQgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXNweT0ic2Nyb2xsIl0nKSksIG4gPSB0Lmxlbmd0aDsgbi0tOykgewogICAgICAgICAgICB2YXIgaSA9IGUodFtuXSk7CiAgICAgICAgICAgIHJ0Ll9qUXVlcnlJbnRlcmZhY2UuY2FsbChpLCBpLmRhdGEoKSkKICAgICAgICB9CiAgICB9KSksIGUuZm5bbnRdID0gcnQuX2pRdWVyeUludGVyZmFjZSwgZS5mbltudF0uQ29uc3RydWN0b3IgPSBydCwgZS5mbltudF0ubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBlLmZuW250XSA9IGl0LCBydC5falF1ZXJ5SW50ZXJmYWNlCiAgICB9OwogICAgdmFyIGF0ID0gZS5mbi50YWIsCiAgICAgICAgbHQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZnVuY3Rpb24gdCh0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9lbGVtZW50ID0gdAogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBuID0gdC5wcm90b3R5cGU7CiAgICAgICAgICAgIHJldHVybiBuLnNob3cgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpczsKICAgICAgICAgICAgICAgIGlmICghKHRoaXMuX2VsZW1lbnQucGFyZW50Tm9kZSAmJiB0aGlzLl9lbGVtZW50LnBhcmVudE5vZGUubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFICYmIGUodGhpcy5fZWxlbWVudCkuaGFzQ2xhc3MoImFjdGl2ZSIpIHx8IGUodGhpcy5fZWxlbWVudCkuaGFzQ2xhc3MoImRpc2FibGVkIikpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG4sIGksIG8gPSBlKHRoaXMuX2VsZW1lbnQpLmNsb3Nlc3QoIi5uYXYsIC5saXN0LWdyb3VwIilbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBhLmdldFNlbGVjdG9yRnJvbUVsZW1lbnQodGhpcy5fZWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSAiVUwiID09PSBvLm5vZGVOYW1lIHx8ICJPTCIgPT09IG8ubm9kZU5hbWUgPyAiPiBsaSA+IC5hY3RpdmUiIDogIi5hY3RpdmUiOwogICAgICAgICAgICAgICAgICAgICAgICBpID0gKGkgPSBlLm1ha2VBcnJheShlKG8pLmZpbmQocikpKVtpLmxlbmd0aCAtIDFdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciBsID0gZS5FdmVudCgiaGlkZS5icy50YWIiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiB0aGlzLl9lbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gZS5FdmVudCgic2hvdy5icy50YWIiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiBpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChpICYmIGUoaSkudHJpZ2dlcihsKSwgZSh0aGlzLl9lbGVtZW50KS50cmlnZ2VyKGMpLCAhYy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSAmJiAhbC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBzICYmIChuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzKSksIHRoaXMuX2FjdGl2YXRlKHRoaXMuX2VsZW1lbnQsIG8pOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBlLkV2ZW50KCJoaWRkZW4uYnMudGFiIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiB0Ll9lbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbyA9IGUuRXZlbnQoInNob3duLmJzLnRhYiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRlZFRhcmdldDogaQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZShpKS50cmlnZ2VyKG4pLCBlKHQuX2VsZW1lbnQpLnRyaWdnZXIobykKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgbiA/IHRoaXMuX2FjdGl2YXRlKG4sIG4ucGFyZW50Tm9kZSwgaCkgOiBoKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIG4uZGlzcG9zZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZS5yZW1vdmVEYXRhKHRoaXMuX2VsZW1lbnQsICJicy50YWIiKSwgdGhpcy5fZWxlbWVudCA9IG51bGwKICAgICAgICAgICAgfSwgbi5fYWN0aXZhdGUgPSBmdW5jdGlvbih0LCBuLCBpKSB7CiAgICAgICAgICAgICAgICB2YXIgbyA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgcyA9ICghbiB8fCAiVUwiICE9PSBuLm5vZGVOYW1lICYmICJPTCIgIT09IG4ubm9kZU5hbWUgPyBlKG4pLmNoaWxkcmVuKCIuYWN0aXZlIikgOiBlKG4pLmZpbmQoIj4gbGkgPiAuYWN0aXZlIikpWzBdLAogICAgICAgICAgICAgICAgICAgIHIgPSBpICYmIHMgJiYgZShzKS5oYXNDbGFzcygiZmFkZSIpLAogICAgICAgICAgICAgICAgICAgIGwgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG8uX3RyYW5zaXRpb25Db21wbGV0ZSh0LCBzLCBpKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAocyAmJiByKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLmdldFRyYW5zaXRpb25EdXJhdGlvbkZyb21FbGVtZW50KHMpOwogICAgICAgICAgICAgICAgICAgIGUocykucmVtb3ZlQ2xhc3MoInNob3ciKS5vbmUoYS5UUkFOU0lUSU9OX0VORCwgbCkuZW11bGF0ZVRyYW5zaXRpb25FbmQoYykKICAgICAgICAgICAgICAgIH0gZWxzZSBsKCkKICAgICAgICAgICAgfSwgbi5fdHJhbnNpdGlvbkNvbXBsZXRlID0gZnVuY3Rpb24odCwgbiwgaSkgewogICAgICAgICAgICAgICAgaWYgKG4pIHsKICAgICAgICAgICAgICAgICAgICBlKG4pLnJlbW92ZUNsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGUobi5wYXJlbnROb2RlKS5maW5kKCI+IC5kcm9wZG93bi1tZW51IC5hY3RpdmUiKVswXTsKICAgICAgICAgICAgICAgICAgICBvICYmIGUobykucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpLCAidGFiIiA9PT0gbi5nZXRBdHRyaWJ1dGUoInJvbGUiKSAmJiBuLnNldEF0dHJpYnV0ZSgiYXJpYS1zZWxlY3RlZCIsICExKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGUodCkuYWRkQ2xhc3MoImFjdGl2ZSIpLCAidGFiIiA9PT0gdC5nZXRBdHRyaWJ1dGUoInJvbGUiKSAmJiB0LnNldEF0dHJpYnV0ZSgiYXJpYS1zZWxlY3RlZCIsICEwKSwgYS5yZWZsb3codCksIHQuY2xhc3NMaXN0LmNvbnRhaW5zKCJmYWRlIikgJiYgdC5jbGFzc0xpc3QuYWRkKCJzaG93IiksIHQucGFyZW50Tm9kZSAmJiBlKHQucGFyZW50Tm9kZSkuaGFzQ2xhc3MoImRyb3Bkb3duLW1lbnUiKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBzID0gZSh0KS5jbG9zZXN0KCIuZHJvcGRvd24iKVswXTsKICAgICAgICAgICAgICAgICAgICBpZiAocykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IFtdLnNsaWNlLmNhbGwocy5xdWVyeVNlbGVjdG9yQWxsKCIuZHJvcGRvd24tdG9nZ2xlIikpOwogICAgICAgICAgICAgICAgICAgICAgICBlKHIpLmFkZENsYXNzKCJhY3RpdmUiKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0LnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsICEwKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaSAmJiBpKCkKICAgICAgICAgICAgfSwgdC5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24obikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaCgoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBlKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICBvID0gaS5kYXRhKCJicy50YWIiKTsKICAgICAgICAgICAgICAgICAgICBpZiAobyB8fCAobyA9IG5ldyB0KHRoaXMpLCBpLmRhdGEoImJzLnRhYiIsIG8pKSwgInN0cmluZyIgPT0gdHlwZW9mIG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09IHR5cGVvZiBvW25dKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdObyBtZXRob2QgbmFtZWQgIicgKyBuICsgJyInKTsKICAgICAgICAgICAgICAgICAgICAgICAgb1tuXSgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIH0sIG8odCwgbnVsbCwgW3sKICAgICAgICAgICAgICAgIGtleTogIlZFUlNJT04iLAogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjQuNS4yIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XSksIHQKICAgICAgICB9KCk7CiAgICBlKGRvY3VtZW50KS5vbigiY2xpY2suYnMudGFiLmRhdGEtYXBpIiwgJ1tkYXRhLXRvZ2dsZT0idGFiIl0sIFtkYXRhLXRvZ2dsZT0icGlsbCJdLCBbZGF0YS10b2dnbGU9Imxpc3QiXScsIChmdW5jdGlvbih0KSB7CiAgICAgICAgdC5wcmV2ZW50RGVmYXVsdCgpLCBsdC5falF1ZXJ5SW50ZXJmYWNlLmNhbGwoZSh0aGlzKSwgInNob3ciKQogICAgfSkpLCBlLmZuLnRhYiA9IGx0Ll9qUXVlcnlJbnRlcmZhY2UsIGUuZm4udGFiLkNvbnN0cnVjdG9yID0gbHQsIGUuZm4udGFiLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gZS5mbi50YWIgPSBhdCwgbHQuX2pRdWVyeUludGVyZmFjZQogICAgfTsKICAgIHZhciBjdCA9IGUuZm4udG9hc3QsCiAgICAgICAgaHQgPSB7CiAgICAgICAgICAgIGFuaW1hdGlvbjogImJvb2xlYW4iLAogICAgICAgICAgICBhdXRvaGlkZTogImJvb2xlYW4iLAogICAgICAgICAgICBkZWxheTogIm51bWJlciIKICAgICAgICB9LAogICAgICAgIHV0ID0gewogICAgICAgICAgICBhbmltYXRpb246ICEwLAogICAgICAgICAgICBhdXRvaGlkZTogITAsCiAgICAgICAgICAgIGRlbGF5OiA1MDAKICAgICAgICB9LAogICAgICAgIGR0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHQodCwgZSkgewogICAgICAgICAgICAgICAgdGhpcy5fZWxlbWVudCA9IHQsIHRoaXMuX2NvbmZpZyA9IHRoaXMuX2dldENvbmZpZyhlKSwgdGhpcy5fdGltZW91dCA9IG51bGwsIHRoaXMuX3NldExpc3RlbmVycygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG4gPSB0LnByb3RvdHlwZTsKICAgICAgICAgICAgcmV0dXJuIG4uc2hvdyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgIG4gPSBlLkV2ZW50KCJzaG93LmJzLnRvYXN0Iik7CiAgICAgICAgICAgICAgICBpZiAoZSh0aGlzLl9lbGVtZW50KS50cmlnZ2VyKG4pLCAhbi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NsZWFyVGltZW91dCgpLCB0aGlzLl9jb25maWcuYW5pbWF0aW9uICYmIHRoaXMuX2VsZW1lbnQuY2xhc3NMaXN0LmFkZCgiZmFkZSIpOwogICAgICAgICAgICAgICAgICAgIHZhciBpID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHQuX2VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgic2hvd2luZyIpLCB0Ll9lbGVtZW50LmNsYXNzTGlzdC5hZGQoInNob3ciKSwgZSh0Ll9lbGVtZW50KS50cmlnZ2VyKCJzaG93bi5icy50b2FzdCIpLCB0Ll9jb25maWcuYXV0b2hpZGUgJiYgKHQuX3RpbWVvdXQgPSBzZXRUaW1lb3V0KChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCB0Ll9jb25maWcuZGVsYXkpKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgiaGlkZSIpLCBhLnJlZmxvdyh0aGlzLl9lbGVtZW50KSwgdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJzaG93aW5nIiksIHRoaXMuX2NvbmZpZy5hbmltYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSBhLmdldFRyYW5zaXRpb25EdXJhdGlvbkZyb21FbGVtZW50KHRoaXMuX2VsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICBlKHRoaXMuX2VsZW1lbnQpLm9uZShhLlRSQU5TSVRJT05fRU5ELCBpKS5lbXVsYXRlVHJhbnNpdGlvbkVuZChvKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbi5oaWRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoInNob3ciKSkgewogICAgICAgICAgICAgICAgICAgIHZhciB0ID0gZS5FdmVudCgiaGlkZS5icy50b2FzdCIpOwogICAgICAgICAgICAgICAgICAgIGUodGhpcy5fZWxlbWVudCkudHJpZ2dlcih0KSwgdC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSB8fCB0aGlzLl9jbG9zZSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIG4uZGlzcG9zZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdGhpcy5fY2xlYXJUaW1lb3V0KCksIHRoaXMuX2VsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJzaG93IikgJiYgdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJzaG93IiksIGUodGhpcy5fZWxlbWVudCkub2ZmKCJjbGljay5kaXNtaXNzLmJzLnRvYXN0IiksIGUucmVtb3ZlRGF0YSh0aGlzLl9lbGVtZW50LCAiYnMudG9hc3QiKSwgdGhpcy5fZWxlbWVudCA9IG51bGwsIHRoaXMuX2NvbmZpZyA9IG51bGwKICAgICAgICAgICAgfSwgbi5fZ2V0Q29uZmlnID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHQgPSBzKHt9LCB1dCwgZSh0aGlzLl9lbGVtZW50KS5kYXRhKCksICJvYmplY3QiID09IHR5cGVvZiB0ICYmIHQgPyB0IDoge30pLCBhLnR5cGVDaGVja0NvbmZpZygidG9hc3QiLCB0LCB0aGlzLmNvbnN0cnVjdG9yLkRlZmF1bHRUeXBlKSwgdAogICAgICAgICAgICB9LCBuLl9zZXRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpczsKICAgICAgICAgICAgICAgIGUodGhpcy5fZWxlbWVudCkub24oImNsaWNrLmRpc21pc3MuYnMudG9hc3QiLCAnW2RhdGEtZGlzbWlzcz0idG9hc3QiXScsIChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5oaWRlKCkKICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICB9LCBuLl9jbG9zZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgIG4gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC5fZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJoaWRlIiksIGUodC5fZWxlbWVudCkudHJpZ2dlcigiaGlkZGVuLmJzLnRvYXN0IikKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgic2hvdyIpLCB0aGlzLl9jb25maWcuYW5pbWF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBhLmdldFRyYW5zaXRpb25EdXJhdGlvbkZyb21FbGVtZW50KHRoaXMuX2VsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgIGUodGhpcy5fZWxlbWVudCkub25lKGEuVFJBTlNJVElPTl9FTkQsIG4pLmVtdWxhdGVUcmFuc2l0aW9uRW5kKGkpCiAgICAgICAgICAgICAgICB9IGVsc2UgbigpCiAgICAgICAgICAgIH0sIG4uX2NsZWFyVGltZW91dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVvdXQpLCB0aGlzLl90aW1lb3V0ID0gbnVsbAogICAgICAgICAgICB9LCB0Ll9qUXVlcnlJbnRlcmZhY2UgPSBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IGUodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgIG8gPSBpLmRhdGEoImJzLnRvYXN0Iik7CiAgICAgICAgICAgICAgICAgICAgaWYgKG8gfHwgKG8gPSBuZXcgdCh0aGlzLCAib2JqZWN0IiA9PSB0eXBlb2YgbiAmJiBuKSwgaS5kYXRhKCJicy50b2FzdCIsIG8pKSwgInN0cmluZyIgPT0gdHlwZW9mIG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09IHR5cGVvZiBvW25dKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdObyBtZXRob2QgbmFtZWQgIicgKyBuICsgJyInKTsKICAgICAgICAgICAgICAgICAgICAgICAgb1tuXSh0aGlzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICB9LCBvKHQsIG51bGwsIFt7CiAgICAgICAgICAgICAgICBrZXk6ICJWRVJTSU9OIiwKICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI0LjUuMiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAga2V5OiAiRGVmYXVsdFR5cGUiLAogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaHQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAga2V5OiAiRGVmYXVsdCIsCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB1dAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XSksIHQKICAgICAgICB9KCk7CiAgICBlLmZuLnRvYXN0ID0gZHQuX2pRdWVyeUludGVyZmFjZSwgZS5mbi50b2FzdC5Db25zdHJ1Y3RvciA9IGR0LCBlLmZuLnRvYXN0Lm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gZS5mbi50b2FzdCA9IGN0LCBkdC5falF1ZXJ5SW50ZXJmYWNlCiAgICB9LCB0LkFsZXJ0ID0gaCwgdC5CdXR0b24gPSBkLCB0LkNhcm91c2VsID0gYiwgdC5Db2xsYXBzZSA9IEMsIHQuRHJvcGRvd24gPSBJLCB0Lk1vZGFsID0gUCwgdC5Qb3BvdmVyID0gZXQsIHQuU2Nyb2xsc3B5ID0gcnQsIHQuVGFiID0gbHQsIHQuVG9hc3QgPSBkdCwgdC5Ub29sdGlwID0gWCwgdC5VdGlsID0gYSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiAhMAogICAgfSkKfSkpOwovLyMgc291cmNlTWFwcGluZ1VSTD1ib290c3RyYXAubWluLmpzLm1hcAp0cnl7LyoKICogVGhpcyBpcyB0aGUgRGF0YUxheWVyIHRoYXQgaXMgcGFzc2VkIHRvIEVuc2lnaHRlbiBmb3IgYW5hbHl0aWNzLgogKiBUaGlzIGZpbGUgaXMgaW5jbHVkZWQgZGlyZWN0bHkgaW50byB0aGVtZXMuaHRtbCBhZnRlciB0aGUgY286aGVhZCBzZWN0aW9uCiAqIEF1dGhvcjogVmFydW4gVmluYXlhawogKiBTYW1wbGU6IGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgia2V5IiwidmFsdWUiKQogKi8KCi8qICoqKipUaGlzIGlzIHRoZSBnbG9iYWwgZGF0YWxheWVyIG9iamVjdCB0aGF0IGhvbGRzIHRoZSByZXF1aXJlZCBrZXkgLSB2YWx1ZSBwYWlycyAmIGNhbiBiZSBhY2Nlc3NlZCBieSBhbGwgdGhlIHBvcnRsZXRzICoqKiogICovCnZhciBnbG9iYWxEYXRhTGF5ZXIgPSB7CiAgICBDb3VudHJ5Q29kZTogJycsCiAgICBMYW5ndWFnZUNvZGU6ICcnLAogICAgTG9jYWxlOiAnJywKICAgIFdlYlNlY3Rpb25JZDogJ1IxMTgzOScsCiAgICBQZmluZGVyUXVlcnk6ICcnLAogICAgVGVtcGxhdGU6ICcnLAoJY2hhdEJvdEFjY2Vzc2VkOiBmYWxzZSwKCWN1c3RvbWVyU3RhdGU6ICJBbm9ueW1vdXMiLAogICAgc3dTbmlmZmVkT1NzdXBwb3J0ZWQ6IG51bGwsCiAgICBEb2N1bWVudDogewogICAgICAgIGRvY3VtZW50SUQ6ICIiCiAgICB9LAogICAgRGFzaGJvYXJkOiB7CiAgICAgICAgTm9PZkRldmljZXM6ICIiLAogICAgICAgIFByb2R1Y3RzOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGF1ZGllbmNlVHlwZTogIiIsCiAgICAgICAgICAgICAgICBQcm9kdWN0TGluZUNvZGU6ICIiLAogICAgICAgICAgICAgICAgUHJvZHVjdE1vZGVsTnVtYmVyOiAiIiwKICAgICAgICAgICAgICAgIFNlcmllc05hbWU6ICIiLAogICAgICAgICAgICAgICAgU2VyaWVzT2lkOiAiIiwKICAgICAgICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICBTcGVjc01pc3Npbmc6IFtdLAogICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCiAgICBQcm9kdWN0OiB7CiAgICAgICAgYmlnU2VyaWVzTmFtZTogIiIsCiAgICAgICAgYmlnU2VyaWVzT2lkOiAiIiwKICAgICAgICBzdXBwb3J0Q2F0ZWdvcnlOYW1lOiAiIiwKICAgICAgICBzdXBwb3J0Q2F0ZWdvcnlPaWQ6ICIiLAogICAgICAgIHNlcmllc05hbWU6ICIiLAogICAgICAgIHNlcmllc09pZDogIiIsCiAgICAgICAgcHJvZHVjdExpbmVDb2RlOiAiIiwKICAgICAgICBzdXBwb3J0TmFtZU5hbWU6ICIiLAogICAgICAgIHN1cHBvcnROYW1lT2lkOiAiIiwKICAgICAgICBwbGF0Zm9ybUlkOiAiIiwKICAgICAgICB3ZWJSZWxlYXNlRGF0ZTogIiIsCiAgICAgICAgc2VyaWFsTnVtYmVyOiAiIiwKICAgICAgICBwcm9kdWN0TW9kZWxOdW1iZXI6IiIsCiAgICAgICAgYXVkaWVuY2VUeXBlOiIiLAogICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIFNlYXJjaDogewogICAgICAgICAgICBRdWVyeToiIiwKICAgICAgICAgICAgUmVkaXJlY3Q6ImZhbHNlIiwKICAgICAgICAgICAgQ291bnQ6IiIsCiAgICAgICAgICAgIFByb2R1Y3Q6IHsKICAgICAgICAgICAgICAgICAgICBiaWdTZXJpZXNOYW1lOiAiIiwKICAgICAgICAgICAgICAgICAgICBiaWdTZXJpZXNPaWQ6ICIiLAogICAgICAgICAgICAgICAgICAgIHN1cHBvcnRDYXRlZ29yeU5hbWU6ICIiLAogICAgICAgICAgICAgICAgICAgIHN1cHBvcnRDYXRlZ29yeU9pZDogIiIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWVzTmFtZTogIiIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWVzT2lkOiAiIiwKICAgICAgICAgICAgICAgICAgICBwcm9kdWN0TGluZUNvZGU6ICIiLAogICAgICAgICAgICAgICAgICAgIHN1cHBvcnROYW1lTmFtZTogIiIsCiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydE5hbWVPaWQ6ICIiLAogICAgICAgICAgICAgICAgICAgIHBsYXRmb3JtSWQ6ICIiLAogICAgICAgICAgICAgICAgICAgIHdlYlJlbGVhc2VEYXRlOiAiIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxOdW1iZXI6ICIiLAogICAgICAgICAgICAgICAgICAgIHByb2R1Y3RNb2RlbE51bWJlcjoiIiwKICAgICAgICAgICAgICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElET0xQcm9kdWN0OnsKICAgICAgICAgICAgICAgIHByb2R1Y3ROYW1lOiIiLAogICAgICAgICAgICAgICAgcHJvZHVjdFRNU09JRDoiIiwKICAgICAgICAgICAgICAgIHByb2R1Y3RUTVNDbGFzczoiIiwKICAgICAgICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgfSwKICAgIERNRDogewogICAgICAgIFNTRkluc3RhbGxlZDogIiIsCiAgICAgICAgUHJvZENvdW50OiAiIiwKICAgICAgICBQcm9kdWN0czogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiUG4iOiAiIiwKICAgICAgICAgICAgICAgICJQbCI6ICIiLAogICAgICAgICAgICAgICAgIlBOYW1lIjogIiIsCiAgICAgICAgICAgICAgICAic09pZCI6ICIiLAogICAgICAgICAgICAgICAgInBPaWQiOiAiIiwKICAgICAgICAgICAgICAgICJEZXRlY3RNZXRob2QiOiAiIiwKICAgICAgICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIEVudGl0bGVtZW50UmVzdWx0czogewogICAgICAgIEVudFJlc3VsdHM6JycsCiAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgICB9CiAgICB9LAogICAgRXJyb3JDb2RlOiAnJywKICAgIHNvZnR3YXJlRG93bmxvYWRlZEZpbGVOYW1lczogJycsCiAgICBJT0c6IFtdLAoJc2Vzc2lvbklkOicnLAoJRmxhZzogewoJCWRhc2hib2FyZFZpc2l0ZWQ6IGZhbHNlLAoJCWRvY3VtZW50Vmlld2VkOglmYWxzZSwKCQlzZWFyY2hFeGVjdXRlZDoJZmFsc2UsCgkJc3dkVmlzaXRlZDoJZmFsc2UsCgkJY29udGFjdEhQVmlzaXRlZDogZmFsc2UsCgkJaWRlbnRpZnlOb3dEbWQ6IGZhbHNlLAoJCWZpbmRTb2x1dGlvbnNEbWQ6IGZhbHNlLAoJCWNoZWNrTm93RG1kOiBmYWxzZSwKCQlFQVNWaXNpdGVkOiBmYWxzZSwKCQlzZXRWYWx1ZTogZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogIH0sCgljaGF0Qm90V2lkZ2V0SWQ6J2NoYXRib3RUb3JvbnRvJywKICAgIHNldFZhbHVlOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTsKICAgICAgICB9CiAgICB9Cn07CgppZihzZXNzaW9uU3RvcmFnZS5Eb3dubG9hZFR5cGUgIT0gdW5kZWZpbmVkKXsKICAgIGdsb2JhbERhdGFMYXllci5Eb3dubG9hZFR5cGUgPSBzZXNzaW9uU3RvcmFnZS5Eb3dubG9hZFR5cGU7Cn0KCi8qKgogKiBSMTkyLTM2NzogR2xvYmFsIERhdGEgTGF5ZXIgc2hhcmluZyBiZXR3ZWVuIFdlYnNwaGVyZSBXQ0MgYW5kIEFXUyBXQ0MgYXBwbGljYXRpb25zIC0tCiAqIFRoZSBnbG9iYWxEYXRhTGF5ZXJXcml0ZXIgaXMgYSB1dGlsaXR5IG9iamVjdCBmb3Igd3JpdGluZyBnbG9iYWxEYXRhTGF5ZXIgdmFsdWVzIHJldHJpdmVkIGZyb20gbG9jYWwgc3RvcmFnZS4KICogZ2xvYmFsRGF0YUxheWVyIHByb3BlcnRpZXMgY2FuIGNvbnRhaW4gc3RyaW5ncywgbnVtYmVycywgYm9vbGVhbnMsIG9iamVjdHMsIGFuZCBhcnJheXMgb2Ygb2JqZWN0cy4KICovCnZhciBnbG9iYWxEYXRhTGF5ZXJXcml0ZXIgPSB7CiAgICAvKioKICAgICAqIFNldHMgZ2xvYmFsRGF0YUxheWVyIHByb3BlcnRpZXMgb24gdGhlIGdsb2JhbERhdGFMYXllciBvYmplY3QuIE5vdCBhbGwgZ2RsIHByb3BlcnRpZXMgaGF2ZSBhIHNldFZhbHVlIG1ldGhvZAogICAgICogc28gaXQncyBuZWNlc3NhcnkgdG8gY2hlY2sgZmlyc3QgdG8gYXZvaWQgZXJyb3IuICBOZXN0ZWQgb2JqZWN0cyBuZWNlc3NpdGF0ZSB0aGUgYWRkaXRpb25hbCBjaGVja3MgZm9yCiAgICAgKiBhbmNlc3RvciAvIHBhcmVudC4gIFRoZXJlIGlzIGxpa2VseSBhIG1vcmUgZWxlZ2FudCBzb2x1dGlvbiAodXNpbmcgbGVzcyAnaWYnIHN0bXRzKSwgYnV0IHRoaXMgd29ya3MgZm9yIG5vdy4uLgogICAgICoKICAgICAqIEBwYXJhbSBnZGxQcm9wTmFtZSAtIGdkbCBwcm9wZXJ0eSBuYW1lCiAgICAgKiBAcGFyYW0gZ2xkUHJvcFZhbHVlIC0gZ2RsIHByb3BlcnR5IHZhbHVlCiAgICAgKiBAcGFyYW0gZ2RsRmFtaWx5VHJlZSAtIFtvcHRpb25hbF0gb2JqZWN0IHdpdGggcGFyZW50ICYgYW5jZXN0b3IgcHJvcGVydGllcy4gIEV4IHtwYXJlbnQ6IFByb2R1Y3RzLCBhbmNlc3RvcjogRGFzaGJvYXJkfQogICAgICoKICAgICAqLwogICAgd3JpdGVHbG9iYWxEYXRhTGF5ZXJWYWx1ZTogZnVuY3Rpb24oZ2RsUHJvcE5hbWUsIGdkbFByb3BWYWwsIGdkbEZhbWlseVRyZWUpewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChnZGxGYW1pbHlUcmVlICYmIGdkbEZhbWlseVRyZWUuaGFzT3duUHJvcGVydHkoImFuY2VzdG9yIikgJiYgZ2RsRmFtaWx5VHJlZS5oYXNPd25Qcm9wZXJ0eSgicGFyZW50IikpIHsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZ2xvYmFsRGF0YUxheWVyW2dkbEZhbWlseVRyZWUuYW5jZXN0b3JdW2dkbEZhbWlseVRyZWUucGFyZW50XS5oYXNPd25Qcm9wZXJ0eSgnc2V0VmFsdWUnKSl7CiAgICAgICAgICAgICAgICAgICAgd2luZG93Lmdsb2JhbERhdGFMYXllcltnZGxGYW1pbHlUcmVlLmFuY2VzdG9yXVtnZGxGYW1pbHlUcmVlLnBhcmVudF0uc2V0VmFsdWUoZ2RsUHJvcE5hbWUsIGdkbFByb3BWYWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZ2xvYmFsRGF0YUxheWVyW2dkbEZhbWlseVRyZWUuYW5jZXN0b3JdW2dkbEZhbWlseVRyZWUucGFyZW50XVtnZGxQcm9wTmFtZV0gPSAgZ2RsUHJvcFZhbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChnZGxGYW1pbHlUcmVlICYmIGdkbEZhbWlseVRyZWUuaGFzT3duUHJvcGVydHkoInBhcmVudCIpKSB7CiAgICAgICAgICAgICAgICBpZiAodW5kZWZpbmVkICE9PSB3aW5kb3cuZ2xvYmFsRGF0YUxheWVyW2dkbEZhbWlseVRyZWUucGFyZW50XSkgewogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZ2xvYmFsRGF0YUxheWVyW2dkbEZhbWlseVRyZWUucGFyZW50XS5oYXNPd25Qcm9wZXJ0eSgnc2V0VmFsdWUnKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5nbG9iYWxEYXRhTGF5ZXJbZ2RsRmFtaWx5VHJlZS5wYXJlbnRdLnNldFZhbHVlKGdkbFByb3BOYW1lLCBnZGxQcm9wVmFsKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZ2xvYmFsRGF0YUxheWVyW2dkbEZhbWlseVRyZWUucGFyZW50XVtnZGxQcm9wTmFtZV0gPSAgZ2RsUHJvcFZhbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKGdkbFByb3BOYW1lLCBnZGxQcm9wVmFsKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2goZSl7CiAgICAgICAgICBjb25zb2xlLmxvZygiRVJST1I6IGZhaWxlZCB0byBzZXQgZ2xvYmFsRGF0YUxheWVyIHByb3AgIiArIGUpOwogICAgICAgIH0KICAgIH0sCiAgICAvKioKICAgICAqIEl0ZXJhdGVzIGdsb2JhbERhdGFMYXllciBwcm9wZXJ0aWVzIGNhbGxpbmcgd3JpdGVHbG9iYWxEYXRhTGF5ZXJWYWx1ZSB3aXRoIHRoZSBhcHByb3ByaWF0ZSBsZXZlbCBvZiByZWZlcmVuY2UgKGZvciBuZXN0ZWQgb2JqZWN0cykuCiAgICAgKiBBcnJheXMgJiBwcmltaXRpdmUgdHlwZXMgYXJlIGhhbmRsZWQgaWRlbnRpY2FsbHkgZm9yIG5vdyAodmFsdWUgaXMgYXNzaWduZWQgZGlyZWN0bHkpLiAgSWYgdGhlIHByb3BlcnkgaXMgbm90IG51bGwgbm9yIGFuIEFycmF5IGJ1dAogICAgICogaXMgYW4gb2JqZWN0LCB0aGUgZnVuY3Rpb24gcmVjdXJzZXMgb24gaXRzZWxmIHJldGFpbmluZyB0aGUgcGFyZW50IHByb3BlcnR5IG5hbWUgYXMgYW5jZXN0b3IgLgogICAgICoKICAgICAqIEBwYXJhbSBwYXJlbnQgLSB0aGUgcHJvcGVydHkgbmFtZSBmb3IgdGhpcyBnbG9iYWxEYXRhTGF5ZXIgdmFsdWUKICAgICAqIEBwYXJhbSBnZGxPYmogLSB0aGUgZ2xvYmFsRGF0YUxheWVyIG9iamVjdCB0byBiZSBwYXJzZWQKICAgICAqIEBwYXJhbSBhbmNlc3RvciAtIFtvcHRpb25hbF0gd2lsbCBiZSBwcmVzZW50IGZvciBuZXN0ZWQgb2JqZWN0cyBvbmx5LiAgVGhpcyBpcyB0aGUgZmlyc3QgbGV2ZWwgZ2xvYmFsRGF0YUxheWVyIHByb3BlcnR5IG5hbWUuICBFeDoKICAgICAqICAgIFNlYXJjaCBiZWNvbWVzIHRoZSBhbmNlc3RvciB3aGVuIHRoZSBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLlByb2R1Y3Qgb2JqZWN0IHZhbHVlIGlzIHBhcnNlZC4KICAgICAqLwogICAgcGFyc2VHRExQcm9wZXJ0eTogZnVuY3Rpb24ocGFyZW50LCBnZGxPYmosIGFuY2VzdG9yKXsKICAgICAgICB2YXIgZ2RsQW5jZXN0b3J5ID0geyJwYXJlbnQiOiBwYXJlbnR9OwogICAgICAgIGlmIChhbmNlc3RvciAmJiBhbmNlc3RvciAhPT0gIiIpewogICAgICAgICAgICBnZGxBbmNlc3RvcnlbImFuY2VzdG9yIl0gPSBhbmNlc3RvcjsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIga2V5IGluIGdkbE9iaikgewogICAgICAgICAgICBpZiAoIm9iamVjdCIgPT0gdHlwZW9mKGdkbE9ialtrZXldKSAmJiBmYWxzZSA9PSBBcnJheS5pc0FycmF5KGdkbE9ialtrZXldKSAmJiBudWxsICE9PSBnZGxPYmpba2V5XSkgewogICAgICAgICAgICAgICAgLy8gdmFsdWUgaXMgYW4gb2JqZWN0IHdpdGggc3RyaW5nL2Jvb2xlYW4vbnVtYmVyL251bGwgcHJvcGVydGllcy4gIGV4OiBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLlByb2R1Y3QgPSB7ImtleSI6InZhbHVlIiwuLi59CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXJXcml0ZXIucGFyc2VHRExQcm9wZXJ0eShrZXksZ2RsT2JqW2tleV0scGFyZW50KTsKICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyB2YWx1ZSBpcyBhbiBhcnJheSBvZiBvYmplY3RzIG9yIGFueSBwcmltaXRpdmUgZGF0YSB0eXBlIChzdHJpbmcsIG51bWJlciwgYm9vbGVhbikKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllcldyaXRlci53cml0ZUdsb2JhbERhdGFMYXllclZhbHVlKGtleSxnZGxPYmpba2V5XSxnZGxBbmNlc3RvcnkpOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cn07Ci8qKgogKiBSMTkyLTM2NzogR2xvYmFsIERhdGEgTGF5ZXIgc2hhcmluZyBiZXR3ZWVuIFdlYnNwaGVyZSBXQ0MgYW5kIEFXUyBXQ0MgYXBwbGljYXRpb25zIC0tCiAqCiAqIFRoaXMgZnVuY3Rpb24gY2hlY2tzIGxvY2FsIHN0b3JhZ2UgZm9yIHRoZSBnbG9iYWxEYXRhTGF5ZXIgaXRlbS4gIElmIGZvdW5kLCB0aGUgdmFsdWUgaXMgY29udmVydGVkIHRvIEpTT04gdGhlbiBpdGVyYXRlZAogKiB3cml0aW5nIGVhY2gga2V5L3ZhbHVlIHRvIHdpbmRvdy5nbG9iYWxEYXRhTGF5ZXIgKGZvciBhbGwgbm9uLW9iamVjdCB2YWx1ZXMpIG9yIHNlbmRpbmcgdGhlIHZhbHVlIGZvciBmdXRoZXIgcGFyc2luZwogKiAoZm9yIHZhbHVlcyB0aGF0IGFyZSBvYmplY3RzIHRoZW1zZWx2ZXMpLiBUaGUgaW50ZW50IGlzIHR3b2ZvbGQ6CiAqICAxLiAgYXZvaWQgb3ZlcndyaXRpbmcgdGhlIGdsb2JhbERhdGFMYXllciBvYmplY3Qgd2l0aCBhIHN1YnNldCBvZiBrZXkvdmFsdWVzIGFjcXVpcmVkIGZyb20gQVdTIFdDQyAoaW4gY2FzZSBBV1MgV0NDCiAqICAgICAgZ2xvYmFsRGF0YUxheWVyIG9iamVjdCBkb2VzIG5vdCBpbmNsdWRlIGtleXMgc2V0IGJ5IHBvcnRsZXRzIGVsc3dld2hlcmUgaW4gdGhlIFdlYnNwaGVyZSBXQ0MgYXBwbGljYXRpb24pIGFuZCwKICogIDIuICB3aGVyZSBwb3NzaWJsZSwgYXNzZXJ0IGdyZWF0ZXIgY29udHJvbCBvdmVyIGhvdyB2YWx1ZXMgYXJlIHNldCBvbiB0aGUgZ2xvYmFsIG9iamVjdC4gVGhlIHByZWZlcnJlZCBtZXRob2QgaXMgdG8gdXNlIHRoZSBvYmplY3QncyBzZXRWYWx1ZSgpIG1ldGhvZAogKiAgICAgIChpZiBpdCBoYXMgb25lKSB0byBlbnN1cmUgZGF0YSBpbnRlZ3JpdHkuCiAqLwpmdW5jdGlvbiBnZXRHbG9iYWxEYXRhTGF5ZXJGcm9tTG9jYWxTdG9yYWdlKCl7CiAgICB2YXIgZ2RsID0gKHdpbmRvdy5sb2NhbFN0b3JhZ2UgJiYgd2luZG93LmxvY2FsU3RvcmFnZS5oYXNPd25Qcm9wZXJ0eSgnZ2xvYmFsRGF0YUxheWVyJykpID8gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZ2xvYmFsRGF0YUxheWVyJykpIDogdW5kZWZpbmVkOwogICAgaWYgKHVuZGVmaW5lZCAhPT0gZ2RsKXsKICAgICAgICBmb3IgKHZhciBrIGluIGdkbCkgewogICAgICAgICAgICBpZiAoIm9iamVjdCIgPT0gdHlwZW9mIChnZGxba10pICYmIG51bGwgIT09IGdkbFtrXSkgewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyV3JpdGVyLnBhcnNlR0RMUHJvcGVydHkoaywgZ2RsW2tdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllcldyaXRlci53cml0ZUdsb2JhbERhdGFMYXllclZhbHVlKGssZ2RsW2tdKTsgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfTsKLyoqCiAqIFIxOTItMzY3OiBHbG9iYWwgRGF0YSBMYXllciBzaGFyaW5nIGJldHdlZW4gV2Vic3BoZXJlIFdDQyBhbmQgQVdTIFdDQyBhcHBsaWNhdGlvbnMgLS0KICogd3JpdGVHbG9iYWxEYXRhTGF5ZXJUb0xvY2FsU3RvcmFnZV9XUyBzZXRzIHRoZSBnbG9iYWxEYXRhTGF5ZXIgb2JqZWN0IGluIGxvY2FsU3RvcmFnZQogKi8KZnVuY3Rpb24gd3JpdGVHbG9iYWxEYXRhTGF5ZXJUb0xvY2FsU3RvcmFnZV9XUygpewogICAgdHJ5ewogICAgICAgIGlmKGdsb2JhbERhdGFMYXllciAmJiB3aW5kb3cubG9jYWxTdG9yYWdlKXsKICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdnbG9iYWxEYXRhTGF5ZXInLCBKU09OLnN0cmluZ2lmeShnbG9iYWxEYXRhTGF5ZXIpKTsKICAgICAgICB9CiAgICB9IGNhdGNoKGUpewogICAgICAgIGNvbnNvbGUubG9nKCJGYWlsZWQgdG8gc2V0IGdkbCBpbiBsb2NhbCBzdG9yYWdlICIgKyBlKTsKICAgIH0KfQovKiogUjE5Mi0zNjc6IEdsb2JhbCBEYXRhIExheWVyIHNoYXJpbmcgYmV0d2VlbiBXZWJzcGhlcmUgV0NDIGFuZCBBV1MgV0NDIGFwcGxpY2F0aW9ucyAtLQogKiAgSW5pdGlhbGl6ZSBnbG9iYWxEYXRhTGF5ZXIgd2l0aCB2YWx1ZXMgZnJvbSBsb2NhbCBzdG9yYWdlLiBWYWx1ZXMgd2lsbCBiZSB1cGRhdGVkIC8gb3ZlcndyaXR0ZW4KICogIGFzIGN1c3RvbWVyIGludGVyYWN0cyB3aXRoIHRoZSBQb3J0YWwgYXBwbGljYXRpb24uIAogKi8KdHJ5ewogICAgZ2V0R2xvYmFsRGF0YUxheWVyRnJvbUxvY2FsU3RvcmFnZSgpOwp9IGNhdGNoKGUpewogICAgY29uc29sZS5sb2coIkZhaWxlZCB0byByZWFkIGdkbCBmcm9tIGxvY2FsIHN0b3JhZ2UgIiArIGUpOwp9Ci8qKgogKiBSMTkyLTM2NzogR2xvYmFsIERhdGEgTGF5ZXIgc2hhcmluZyBiZXR3ZWVuIFdlYnNwaGVyZSBXQ0MgYW5kIEFXUyBXQ0MgYXBwbGljYXRpb25zIC0tCiAqIFBlcnNpc3QgZ2xvYmFsRGF0YUxheWVyIHZhbHVlcyBpbiBsb2NhbCBzdG9yYWdlIGJlZm9yZSBwYWdlIHVubG9hZCBldmVudC4KICovCndpbmRvdy5vbmJlZm9yZXVubG9hZCA9IGZ1bmN0aW9uKCl7CiAgICB3cml0ZUdsb2JhbERhdGFMYXllclRvTG9jYWxTdG9yYWdlX1dTKCk7Cn0KCiAgICAgLyotLS0tLS0tLVNldHRpbmcgRmxhZyBPYmplY3QtLS0tLS0tKi8KICAgICBmdW5jdGlvbiB1cGRhdGVEYXRhTGF5ZXJGbGFncyhmbGFnT2JqZWN0KXsKICAgICAgICBpZihmbGFnT2JqZWN0PT0iIil7CiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5GbGFnID0geydkb2N1bWVudFZpZXdlZCc6IGZhbHNlLCAnc2VhcmNoRXhlY3V0ZWQnOiBmYWxzZSwgJ3N3ZFZpc2l0ZWQnOiBmYWxzZSwgJ2NvbnRhY3RIUFZpc2l0ZWQnOiBmYWxzZSwgJ2lkZW50aWZ5Tm93RG1kJzogZmFsc2UsICdmaW5kU29sdXRpb25zRG1kJzogZmFsc2UsICdjaGVja05vd0RtZCc6IGZhbHNlLCdFQVNWaXNpdGVkJzogZmFsc2V9OwogICAgICAgICAgICBmbGFnT2JqZWN0ID0gSlNPTi5zdHJpbmdpZnkoZ2xvYmFsRGF0YUxheWVyLkZsYWcpOwogICAgICAgIH0KICAgICAgICBmbGFnT2JqZWN0ID0gJC5wYXJzZUpTT04oZmxhZ09iamVjdCk7CiAgICAgICAgaWYoZ2xvYmFsRGF0YUxheWVyLkZsYWcgPT09IHVuZGVmaW5lZCl7CiAgICAgICAgCWdsb2JhbERhdGFMYXllci5GbGFnID0geydkb2N1bWVudFZpZXdlZCc6IGZhbHNlLCAnc2VhcmNoRXhlY3V0ZWQnOiBmYWxzZSwgJ3N3ZFZpc2l0ZWQnOiBmYWxzZSwgJ2NvbnRhY3RIUFZpc2l0ZWQnOiBmYWxzZSwgJ2lkZW50aWZ5Tm93RG1kJzogZmFsc2UsICdmaW5kU29sdXRpb25zRG1kJzogZmFsc2UsICdjaGVja05vd0RtZCc6IGZhbHNlLCdFQVNWaXNpdGVkJzogZmFsc2V9OwogICAgICAgICAgICBjaGVja1Nlc3Npb25PYmplY3QoZmxhZ09iamVjdCk7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIGNoZWNrU2Vzc2lvbk9iamVjdChmbGFnT2JqZWN0KTsKICAgICAgICB9CiAgICAgfQoKICAgICBmdW5jdGlvbiB1cGRhdGVBdWRpZW5jZVR5cGUoKXsgLy9kZXRlcm1pbmUgaWYgcHJvZHVjdCBpcyBjb25zdW1lciBvciBjb21tZXJjaWFsCiAgICAgICBpZigkKCcjdG1zQ2xhc3NGb3JTZWFyY2gnKS52YWwoKSA9PSAncG1fc2VyaWVzX3ZhbHVlJyl7CiAgICAgICAgICAgaWYoJCgnI2lzQ29tbWVyY2lhbFByb2R1Y3QnKS52YWwoKSA9PSAndHJ1ZScpewogICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnYXVkaWVuY2VUeXBlJywnQ29tbWVyY2lhbCcpOwogICAgICAgICAgIH0KICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnYXVkaWVuY2VUeXBlJywnQ29uc3VtZXInKTsKICAgICAgICAgICB9CiAgICAgICB9ZWxzZSBpZigkKCcjdG1zQ2xhc3NGb3JTZWFyY2gnKS52YWwoKSA9PSAncG1fbmFtZV92YWx1ZScpewogICAgICAgICBpZigkKCcjaXNDb21tZXJjaWFsUHJvZHVjdCcpLnZhbCgpID09ICd0cnVlJyl7CiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnNldFZhbHVlKCdhdWRpZW5jZVR5cGUnLCdMYXJnZScpOwogICAgICAgICB9CiAgICAgICAgIGVsc2V7CiAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc2V0VmFsdWUoJ2F1ZGllbmNlVHlwZScsJ0hITycpOwogICAgICAgICB9CiAgICAgICB9CiAgICAgfQoKICAgICBmdW5jdGlvbiBjaGVja1Nlc3Npb25PYmplY3QoZmxhZ09iamVjdCl7CiAgICAgICAgICAgIGlmKGZsYWdPYmplY3QuZG9jdW1lbnRWaWV3ZWQgIT09IHRydWUpewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLkZsYWcuZG9jdW1lbnRWaWV3ZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLkZsYWcuZG9jdW1lbnRWaWV3ZWQgPSBmbGFnT2JqZWN0LmRvY3VtZW50Vmlld2VkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZihmbGFnT2JqZWN0LnNlYXJjaEV4ZWN1dGVkICE9PSB0cnVlKXsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5GbGFnLnNlYXJjaEV4ZWN1dGVkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5GbGFnLnNlYXJjaEV4ZWN1dGVkID0gZmxhZ09iamVjdC5zZWFyY2hFeGVjdXRlZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoZmxhZ09iamVjdC5zd2RWaXNpdGVkICE9PSB0cnVlKXsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5GbGFnLnN3ZFZpc2l0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLkZsYWcuc3dkVmlzaXRlZCA9IGZsYWdPYmplY3Quc3dkVmlzaXRlZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoZmxhZ09iamVjdC5jb250YWN0SFBWaXNpdGVkICE9PSB0cnVlKXsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5GbGFnLmNvbnRhY3RIUFZpc2l0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLkZsYWcuY29udGFjdEhQVmlzaXRlZCA9IGZsYWdPYmplY3QuY29udGFjdEhQVmlzaXRlZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoZmxhZ09iamVjdC5pZGVudGlmeU5vd0RtZCAhPT0gdHJ1ZSl7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5pZGVudGlmeU5vd0RtZCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5pZGVudGlmeU5vd0RtZCA9IGZsYWdPYmplY3QuaWRlbnRpZnlOb3dEbWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKGZsYWdPYmplY3QuZmluZFNvbHV0aW9uc0RtZCAhPT0gdHJ1ZSl7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5maW5kU29sdXRpb25zRG1kID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5GbGFnLmZpbmRTb2x1dGlvbnNEbWQgPSBmbGFnT2JqZWN0LmZpbmRTb2x1dGlvbnNEbWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKGZsYWdPYmplY3QuY2hlY2tOb3dEbWQgIT09IHRydWUpewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLkZsYWcuY2hlY2tOb3dEbWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLkZsYWcuY2hlY2tOb3dEbWQgPSBmbGFnT2JqZWN0LmNoZWNrTm93RG1kOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBFQVMgVmlzaXRlZCBGbGFnCiAgICAgICAgICAgIGlmKGZsYWdPYmplY3QuZWFzVmlzaXRlZCAhPT0gdHJ1ZSl7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5FQVNWaXNpdGVkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgCWdsb2JhbERhdGFMYXllci5GbGFnLkVBU1Zpc2l0ZWQgPSBmbGFnT2JqZWN0LmVhc1Zpc2l0ZWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKGZsYWdPYmplY3QuZG9jdW1lbnRHREwgPT0gbnVsbCl7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRG9jdW1lbnQuZG9jdW1lbnRJRCA9ICIiOwogICAgICAgICAgICAgICAgZGVsZXRlIGdsb2JhbERhdGFMYXllci5GbGFnLmRvY3VtZW50R0RMOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRG9jdW1lbnQuZG9jdW1lbnRJRCA9IGZsYWdPYmplY3QuZG9jdW1lbnRHREwuZG9jdW1lbnRJZDsgOwogICAgICAgICAgICAgICAgZGVsZXRlIGdsb2JhbERhdGFMYXllci5GbGFnLmRvY3VtZW50R0RMOwogICAgICAgICAgICB9CiAgICAgfQogICAKCi8qIFRoaXMgc2VjdGlvbiBmZWVkcyBzb21lIHZhbHVlcyBhdmFpbGFibGUgYXQgZG9tLnJlYWR5IHRvIHRoZSBkYXRhbGF5ZXIgKi8KJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgogICAgLy9CYXNlZCBvbiBqU2Vzc2lvbiBpZCB3ZSBtYWludGFpbiB0aGUgc3dTbmlmZmVkT1NzdXBwb3J0ZWQgd2VhdGhlciBpZiBpdCBpcyB0cnVlIG9yIGZsYXNlCiAgICBpZihsb2NhbFN0b3JhZ2Uuc3dkT1NTZXNzaW9uID09ICQoIiNqU2Vzc2lvbklkIikudmFsKCkpewogICAgICAgIGdsb2JhbERhdGFMYXllci5zd1NuaWZmZWRPU3N1cHBvcnRlZCA9IGxvY2FsU3RvcmFnZS5zd2RPU1ZhbDsKICAgIH0KCgl2YXIgcGFnZUluZm9NZXRhID0gJCgnaGVhZCBtZXRhW25hbWU9cGFnZWluZm9dJyk7CiAgICB2YXIgZGF0YWxheWVyQ0MgPSBwYWdlSW5mb01ldGEuZGF0YSgnY2MnKTsKICAgIHZhciBkYXRhbGF5ZXJMQyA9IHBhZ2VJbmZvTWV0YS5kYXRhKCdsYycpOwoJdmFyIHRlbXBsYXRlTmFtZSA9IHBhZ2VJbmZvTWV0YS5kYXRhKCd0ZW1wbGF0ZW5hbWUnKTsKCQogICAgaWYgKGRhdGFsYXllckxDID09IHVuZGVmaW5lZCkgewogICAgICAgIGRhdGFsYXllckNDID0gInVzIjsKICAgICAgICBkYXRhbGF5ZXJMQyA9ICJlbiI7CgogICAgfQoJCgkvL3NldCBUZW1wbGF0ZSB2YWx1ZQoJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsIHRlbXBsYXRlTmFtZSk7CgkKCS8vVE8tRE8gTG9naWMgdG8gdXBkYXRlIGN1c3RvbWVyU3RhdGUgb25jZSB1c2VyIGxvZ2luLgoKICAgIC8qIDY4OTc6IGNhbGxlZCBvbiBldmVyeSBwYWdlIGxvYWQgdG8gZGV0ZXJtaW5lIGlmIFNlYXJjaCByZWRpcmVjdCBoYXMgb2NjdXJlZAogICAgU2Vzc2lvbiBzdG9yYWdlIFNlYXJjaCBxdWVyeSB3aWxsIGJlIHByZXNlbnQgb25seSBmb3IgcmVkaXJlY3QqLwogICAvLyBnZXRTZXNzaW9uU3RvcmFnZUZvclNlYXJjaCgpOwoKICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgiQ291bnRyeUNvZGUiLCBkYXRhbGF5ZXJDQyk7IC8qIEZldGNoZXMgY2MgZnJvbSB0aGUgdXJsIGZvcm1hdDogLmNvbS9jYy1sYy8gKi8KICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgiTGFuZ3VhZ2VDb2RlIiwgZGF0YWxheWVyTEMpOyAvKiBGZXRjaGVzIGxjIGZyb20gdGhlIHVybCBmb3JtYXQ6IC5jb20vY2MtbGMvICovCiAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoIkxvY2FsZSIsIGRhdGFsYXllckNDICsgJy0nICsgZGF0YWxheWVyTEMpOwoKCgogICAgLy8gRGF0YSBmcm9tIHRoZSBUTVMgU0VTU0lPTiBoaWRkZW4gdmFyaWFibGUKICAgIHZhciB0bXNSZXNwb25zZTsKICAgIGlmICgkKCcjcHJvZHVjdEFScmVzcG9uc2UnKS5sZW5ndGggPiAwKSB7CgogICAgICAgIGlmICgkKCcjcHJvZHVjdEFScmVzcG9uc2UnKS52YWwoKSAhPSAiIikgewogICAgICAgICAgICB0bXNSZXNwb25zZSA9ICQoJyNwcm9kdWN0QVJyZXNwb25zZScpLnZhbCgpOwogICAgICAgIH0KCgogICAgICAgIGlmICh0bXNSZXNwb25zZSAhPSBudWxsICYmIHRtc1Jlc3BvbnNlICE9ICIiICYmIHRtc1Jlc3BvbnNlICE9ICJudWxsIikgewogICAgICAgICAgICB0bXNSZXNwb25zZSA9IEpTT04ucGFyc2UodG1zUmVzcG9uc2UpOwoKICAgICAgICAgICAgaWYgKHRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdiaWdTZXJpZXNOYW1lJykpIHsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnNldFZhbHVlKCdiaWdTZXJpZXNOYW1lJywgdG1zUmVzcG9uc2VbJ2JpZ1Nlcmllc05hbWUnXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gYmlnU2VyaWVzTmFtZScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ2JpZ1Nlcmllc09pZCcpKSB7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnYmlnU2VyaWVzT2lkJywgdG1zUmVzcG9uc2VbJ2JpZ1Nlcmllc09pZCddKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBiaWdTZXJpZXNPaWQnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdwbGF0Zm9ybUlkJykpIHsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnNldFZhbHVlKCdwbGF0Zm9ybUlkJywgdG1zUmVzcG9uc2VbJ3BsYXRmb3JtSWQnXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gcGxhdGZvcm1JZCcpOwogICAgICAgICAgICB9CgoKICAgICAgICAgICAgaWYgKHRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdwcm9kdWN0TGluZUNvZGUnKSkgewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc2V0VmFsdWUoJ3Byb2R1Y3RMaW5lQ29kZScsIHRtc1Jlc3BvbnNlWydwcm9kdWN0TGluZUNvZGUnXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gcHJvZHVjdCBwcm9kdWN0TGluZUNvZGUnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdzZXJpZXNOYW1lJykpIHsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnNldFZhbHVlKCdzZXJpZXNOYW1lJywgdG1zUmVzcG9uc2VbJ3Nlcmllc05hbWUnXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gcHJvZHVjdCBzZXJpZXNOYW1lJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0bXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnc2VyaWVzT2lkJykpIHsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnNldFZhbHVlKCdzZXJpZXNPaWQnLCB0bXNSZXNwb25zZVsnc2VyaWVzT2lkJ10pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIHByb2R1Y3Qgc2VyaWVzT2lkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0bXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnc3VwcG9ydENhdGVnb3J5TmFtZScpKSB7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnc3VwcG9ydENhdGVnb3J5TmFtZScsIHRtc1Jlc3BvbnNlWydzdXBwb3J0Q2F0ZWdvcnlOYW1lJ10pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIHByb2R1Y3Qgc3VwcG9ydENhdGVnb3J5TmFtZScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3N1cHBvcnRDYXRlZ29yeU9pZCcpKSB7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnc3VwcG9ydENhdGVnb3J5T2lkJywgdG1zUmVzcG9uc2VbJ3N1cHBvcnRDYXRlZ29yeU9pZCddKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBwcm9kdWN0IHN1cHBvcnRDYXRlZ29yeU9pZCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3N1cHBvcnROYW1lTmFtZScpKSB7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnc3VwcG9ydE5hbWVOYW1lJywgdG1zUmVzcG9uc2VbJ3N1cHBvcnROYW1lTmFtZSddKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBwcm9kdWN0IHN1cHBvcnROYW1lTmFtZScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3N1cHBvcnROYW1lT2lkJykpIHsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnNldFZhbHVlKCdzdXBwb3J0TmFtZU9pZCcsIHRtc1Jlc3BvbnNlWydzdXBwb3J0TmFtZU9pZCddKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBwcm9kdWN0IHN1cHBvcnROYW1lT2lkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKHRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdtb2RlbE51bWJlcicpKXsKICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgncHJvZHVjdE1vZGVsTnVtYmVyJyx0bXNSZXNwb25zZVsnbW9kZWxOdW1iZXInXSk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBwcm9kdWN0IG1vZGVsTnVtYmVyJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0bXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnd2ViUmVsZWFzZURhdGUnKSkgewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc2V0VmFsdWUoJ3dlYlJlbGVhc2VEYXRlJywgdG1zUmVzcG9uc2VbJ3dlYlJlbGVhc2VEYXRlJ10pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIHByb2R1Y3Qgd2ViUmVsZWFzZURhdGUnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdhdWRpZW5jZScpKSB7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnYXVkaWVuY2VUeXBlJywgdG1zUmVzcG9uc2VbJ2F1ZGllbmNlJ10pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIGF1ZGllbmNlIHR5cGUnKTsKICAgICAgICAgICAgfQoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gdmFsdWUgZnJvbSB0bXMnKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gRGF0YSBmcm9tIHRoZSBTRUFSQ0ggUFJPRCBJTkZPIGhpZGRlbiB2YXJpYWJsZQogICAgdmFyIHNlYXJjaFRtc1Jlc3BvbnNlOwogICAgaWYgKCQoJyNzZWFyY2hQcm9kdWN0QVJyZXNwb25zZScpLmxlbmd0aCA+IDApIHsKCiAgICAgICAgaWYgKCQoJyNzZWFyY2hQcm9kdWN0QVJyZXNwb25zZScpLnZhbCgpICE9ICIiKSB7CiAgICAgICAgICAgIHNlYXJjaFRtc1Jlc3BvbnNlID0gJCgnI3NlYXJjaFByb2R1Y3RBUnJlc3BvbnNlJykudmFsKCk7CiAgICAgICAgfQoKCiAgICAgICAgaWYgKHNlYXJjaFRtc1Jlc3BvbnNlICE9IG51bGwgJiYgc2VhcmNoVG1zUmVzcG9uc2UgIT0gIiIgJiYgc2VhcmNoVG1zUmVzcG9uc2UgIT0gIm51bGwiKSB7CiAgICAgICAgICAgIHNlYXJjaFRtc1Jlc3BvbnNlID0gSlNPTi5wYXJzZShzZWFyY2hUbXNSZXNwb25zZSk7CgogICAgICAgICAgICBpZiAoc2VhcmNoVG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ2JpZ1Nlcmllc05hbWUnKSkgewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5Qcm9kdWN0LnNldFZhbHVlKCdiaWdTZXJpZXNOYW1lJywgc2VhcmNoVG1zUmVzcG9uc2VbJ2JpZ1Nlcmllc05hbWUnXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gU2VhcmNoUHJvZHVjdCBiaWdTZXJpZXNOYW1lJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZWFyY2hUbXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnYmlnU2VyaWVzT2lkJykpIHsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5TZWFyY2guUHJvZHVjdC5zZXRWYWx1ZSgnYmlnU2VyaWVzT2lkJywgc2VhcmNoVG1zUmVzcG9uc2VbJ2JpZ1Nlcmllc09pZCddKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBTZWFyY2hQcm9kdWN0IGJpZ1Nlcmllc09pZCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2VhcmNoVG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3BsYXRmb3JtSWQnKSkgewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5Qcm9kdWN0LnNldFZhbHVlKCdwbGF0Zm9ybUlkJywgc2VhcmNoVG1zUmVzcG9uc2VbJ3BsYXRmb3JtSWQnXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gU2VhcmNoUHJvZHVjdCBwbGF0Zm9ybUlkJyk7CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICBpZiAoc2VhcmNoVG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3Byb2R1Y3RMaW5lQ29kZScpKSB7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLlByb2R1Y3Quc2V0VmFsdWUoJ3Byb2R1Y3RMaW5lQ29kZScsIHNlYXJjaFRtc1Jlc3BvbnNlWydwcm9kdWN0TGluZUNvZGUnXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gU2VhcmNoUHJvZHVjdCBwcm9kdWN0TGluZUNvZGUnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHNlYXJjaFRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdzZXJpZXNOYW1lJykpIHsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5TZWFyY2guUHJvZHVjdC5zZXRWYWx1ZSgnc2VyaWVzTmFtZScsIHNlYXJjaFRtc1Jlc3BvbnNlWydzZXJpZXNOYW1lJ10pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIFNlYXJjaFByb2R1Y3Qgc2VyaWVzTmFtZScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2VhcmNoVG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3Nlcmllc09pZCcpKSB7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLlByb2R1Y3Quc2V0VmFsdWUoJ3Nlcmllc09pZCcsIHNlYXJjaFRtc1Jlc3BvbnNlWydzZXJpZXNPaWQnXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gU2VhcmNoUHJvZHVjdCBzZXJpZXNPaWQnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHNlYXJjaFRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdzdXBwb3J0Q2F0ZWdvcnlOYW1lJykpIHsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5TZWFyY2guUHJvZHVjdC5zZXRWYWx1ZSgnc3VwcG9ydENhdGVnb3J5TmFtZScsIHNlYXJjaFRtc1Jlc3BvbnNlWydzdXBwb3J0Q2F0ZWdvcnlOYW1lJ10pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIFNlYXJjaFByb2R1Y3Qgc3VwcG9ydENhdGVnb3J5TmFtZScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2VhcmNoVG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3N1cHBvcnRDYXRlZ29yeU9pZCcpKSB7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLlByb2R1Y3Quc2V0VmFsdWUoJ3N1cHBvcnRDYXRlZ29yeU9pZCcsIHNlYXJjaFRtc1Jlc3BvbnNlWydzdXBwb3J0Q2F0ZWdvcnlPaWQnXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gU2VhcmNoUHJvZHVjdCBzdXBwb3J0Q2F0ZWdvcnlPaWQnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHNlYXJjaFRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdzdXBwb3J0TmFtZU5hbWUnKSkgewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5Qcm9kdWN0LnNldFZhbHVlKCdzdXBwb3J0TmFtZU5hbWUnLCBzZWFyY2hUbXNSZXNwb25zZVsnc3VwcG9ydE5hbWVOYW1lJ10pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIFNlYXJjaFByb2R1Y3Qgc3VwcG9ydE5hbWVOYW1lJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZWFyY2hUbXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnc3VwcG9ydE5hbWVPaWQnKSkgewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5Qcm9kdWN0LnNldFZhbHVlKCdzdXBwb3J0TmFtZU9pZCcsIHNlYXJjaFRtc1Jlc3BvbnNlWydzdXBwb3J0TmFtZU9pZCddKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBTZWFyY2hQcm9kdWN0IHN1cHBvcnROYW1lT2lkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZWFyY2hUbXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnd2ViUmVsZWFzZURhdGUnKSkgewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5Qcm9kdWN0LnNldFZhbHVlKCd3ZWJSZWxlYXNlRGF0ZScsIHNlYXJjaFRtc1Jlc3BvbnNlWyd3ZWJSZWxlYXNlRGF0ZSddKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBTZWFyY2hQcm9kdWN0IHdlYlJlbGVhc2VEYXRlJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFVTIDE4MiAzNSBSZXBsaWNhdGUgc2VhcmNoIHByb2R1Y3QgZGF0YSBpbnRvIGdsb2JhbCBkYXRhCiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0ID0gZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5Qcm9kdWN0OwogICAgICAgICAgICAvLyBVcGRhdGluZyBjb250YWN0IHN1cHBvcnQgdXJsIHdpdGggY29ycmVjdCBwcm9kdWN0IG51bWJlcgogICAgICAgICAgICB2YXIgZ2RsID0gZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Q7IC8vIHNob3J0aGFuZCBjb252aW5pZW5jZQogICAgICAgICAgICB2YXIgc2VyaWVzT3JNb2RlbElkID0gKGdkbC5zZXJpZXNOYW1lT2lkID8gZ2RsLnNlcmllc05hbWVPaWQgOiBnZGwuc2VyaWVzT2lkKTsKICAgICAgICAgICAgdXBkYXRlQ29udGFjdFN1cHBvcnRVUkwoIi9ocC1wcHMtc2VydmljZXMvaHViL25hdmlnYXRpb24iLCBzZXJpZXNPck1vZGVsSWQpOwoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gdmFsdWUgZnJvbSBzZWFyY2ggdG1zJyk7CiAgICAgICAgfQogICAgfQoKICAgIC8vRGF0YSBmcm9tIFNFQVJDSCBJRE9MIGhpZGRlbiB2YXJpYWJsZQogICAgdmFyIHNlYXJjaEFSRGF0YTsKICAgICBpZiAoJCgnI1NlYXJjaEFOUicpLmxlbmd0aCA+IDApIHsKCiAgICAgICAgaWYgKCQoJyNTZWFyY2hBTlInKS52YWwoKSAhPSAiIikgewogICAgICAgICAgICBzZWFyY2hBUkRhdGEgPSAkKCcjU2VhcmNoQU5SJykudmFsKCk7CiAgICAgICAgfQoKCiAgICAgICAgaWYgKHNlYXJjaEFSRGF0YSAhPSBudWxsICYmIHNlYXJjaEFSRGF0YSAhPSAiIiAmJiBzZWFyY2hBUkRhdGEgIT0gIm51bGwiKSB7CiAgICAgICAgICAgIHNlYXJjaEFSRGF0YSA9IEpTT04ucGFyc2Uoc2VhcmNoQVJEYXRhKQoKICAgICAgICAgICAgLy9jaGVjayAgU0VBUkNIIElET0wgaGlkZGVuIGZpZWxkIGZvciB2YWx1ZXMKICAgICAgICAgICAgLyogIGVnOgogICAgICAgICAgICAgICAgInByb2R1Y3ROYW1lIjogIkhQIEVOVlkgMTIwIGUtQWxsLWluLU9uZSBQcmludGVyIiwKICAgICAgICAgICAgICAgICJwcm9kdWN0VE1TT0lEIjogNTIwMzIwNiwKICAgICAgICAgICAgICAgICJwcm9kdWN0VE1TQ2xhc3MiOiAicG1fbmFtZV92YWx1ZSIKICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIGlmIChzZWFyY2hBUkRhdGEuaGFzT3duUHJvcGVydHkoJ3Byb2R1Y3ROYW1lJykpIHsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5TZWFyY2guSURPTFByb2R1Y3Quc2V0VmFsdWUoJ3Byb2R1Y3ROYW1lJywgc2VhcmNoQVJEYXRhWydwcm9kdWN0TmFtZSddKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBTZWFyY2ggSURPTCBwcm9kdWN0TmFtZScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChzZWFyY2hBUkRhdGEuaGFzT3duUHJvcGVydHkoJ3Byb2R1Y3RUTVNPSUQnKSkgewogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5JRE9MUHJvZHVjdC5zZXRWYWx1ZSgncHJvZHVjdFRNU09JRCcsIHNlYXJjaEFSRGF0YVsncHJvZHVjdFRNU09JRCddKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBTZWFyY2ggSURPTCBwcm9kdWN0VE1TT0lEJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZWFyY2hBUkRhdGEuaGFzT3duUHJvcGVydHkoJ3Byb2R1Y3RUTVNDbGFzcycpKSB7CiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLklET0xQcm9kdWN0LnNldFZhbHVlKCdwcm9kdWN0VE1TQ2xhc3MnLCBzZWFyY2hBUkRhdGFbJ3Byb2R1Y3RUTVNDbGFzcyddKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBTZWFyY2ggSURPTCBwcm9kdWN0VE1TQ2xhc3MnKTsKICAgICAgICAgICAgfQoKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIHZhbHVlIGZyb20gc2VhcmNoIElET0wnKTsKICAgICAgICB9CgogICAgfQoKCiAgICB2YXIgZXJyb3I0MDQ7CiAgICBpZiAobG9jYXRpb24uaHJlZi5pbmRleE9mKCJlcnJvclR5cGU9NDA0Iik+MCkgewogICAgICAgIGVycm9yNDA0ID0gJCgnI2Vycm9yNDA0JykudmFsKCk7CiAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdFcnJvckNvZGUnLCAnNDA0Jyk7CiAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdFcnJvcjQwNCcpOwoKICAgIH0KCiAgICB2YXIgZXJyb3I1MDA7CiAgICBpZiAobG9jYXRpb24uaHJlZi5pbmRleE9mKCJlcnJvclR5cGU9NTAwIik+MCkgewogICAgICAgIGVycm9yNTAwID0gJCgnI2Vycm9yNTAwJykudmFsKCk7CiAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdFcnJvckNvZGUnLCAnNTAwJyk7CiAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdFcnJvcjUwMCcpOwoKICAgIH0KCiAgICB2YXIgRW50aXRsZW1lbnRSZXN1bHQ7CiAgICBpZiAoJCgnI2lwV2FycmFudHlMZXZlbCcpLmxlbmd0aCA+IDApIHsKICAgICAgICBFbnRpdGxlbWVudFJlc3VsdCA9ICQoJyNpcFdhcnJhbnR5TGV2ZWwnKS52YWwoKTsKICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRW50aXRsZW1lbnRSZXN1bHRzLnNldFZhbHVlKCdFbnRSZXN1bHRzJywgRW50aXRsZW1lbnRSZXN1bHQpOwoKICAgIH0KCiAgIC8qIEFkZGluZyBkb3dubG9hZGVkIGRyaXZlciBmaWxlIG5hbWUgdG8gZGF0YWxheWVyIGZyb20gc2Vzc2lvbiAqLwogICAgdmFyIGRvd25sb2FkZWRGaWxlTmFtZSA9ICgkKCIjZG93bmxvYWRGaWxlTmFtZSIpLmxlbmd0aCA+IDApID8gJCgiI2Rvd25sb2FkRmlsZU5hbWUiKS52YWwoKSA6ICIiIDsKICAgIGlmIChkb3dubG9hZGVkRmlsZU5hbWUgIT09ICIiICYmIGRvd25sb2FkZWRGaWxlTmFtZSAhPT1udWxsICYmIHR5cGVvZihkb3dubG9hZGVkRmlsZU5hbWUpIT09InVuZGVmaW5lZCIpIHsKICAgIAkvLyBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoInNvZndhcmVEb3dubG9hZGVkRmlsZU5hbWUiLGRvd25sb2FkZWRGaWxlTmFtZSk7CiAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCJzb2Z0d2FyZURvd25sb2FkZWRGaWxlTmFtZXMiLGRvd25sb2FkZWRGaWxlTmFtZSk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCdubyBzb2Z0d2FyZURvd25sb2FkZWRGaWxlTmFtZScpOwogICAgfQoKICAgIC8qLS0tLS0tLS0tLS0tLS1UZW1wbGF0ZSBTZXR0aW5nLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgICAvL1NldCB2YWx1ZXMgYmFzZWQgc29sZWx5IG9uIHBhZ2UgbmFtZQoKICAgIHZhciBwYWdlTmFtZSA9ICQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpOwogICAgdmFyIGN1c3REZXRhaWxQYWdlTmFtZSA9ICQoJyNqc3BOYW1lJykudmFsKCk7CiAgICB2YXIgdXJsPWRvY3VtZW50LmxvY2F0aW9uLmhyZWY7CiAgICB2YXIgcHJvZE1vZGVsID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjdXJyZW50VXJsID0gZG9jdW1lbnQubG9jYXRpb24uaHJlZjsKICAgICAgICBpZihjdXJyZW50VXJsLmluZGV4T2YoIi9tb2RlbCIpID4gLTEpewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KICAgIGlmIChjdXN0RGV0YWlsUGFnZU5hbWUgPT0iY3VzdG9tZXJkZXRhaWxzIikgewogICAgCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnY3VzdG9tZXJkZXRhaWxzJyk7CiAgICB9CiAgICBpZiAocGFnZU5hbWUgIT0gIiIgJiYgcGFnZU5hbWUgIT0gIm51bGwiICYmIHBhZ2VOYW1lICE9IG51bGwpIHsKICAgICAgICBpZiAocGFnZU5hbWUgPT0gIlN1cHBvcnQgSG9tZSIpIHsKCiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnU2l0ZUhvbWUnKTsKICAgICAgICB9ZWxzZSBpZihwYWdlTmFtZSA9PSAiV2FycmFudHlPbmx5IikgeyAgLy8gd2FycmFudHkgcmVzdWx0cyAtIG5vIHByb2QgaW5mbyBwYWdlCgogICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ09TV2FycmFudHlPbmx5Jyk7CgogICAgICAgIH1lbHNlIGlmKHBhZ2VOYW1lID09ICJjYXNlQ3JlYXRpb24iKSB7ICAvL0FkZGVkIGFzIHBhcnQgb2YgNjU4MQoKICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdTdWJtaXRDYXNlRm9ybVBhZ2UnKTsKCiAgICAgICAgfSBlbHNlIGlmIChwYWdlTmFtZSA9PSAiUHJvZHVjdCBIb21lIikgewoKICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdQcm9kdWN0Q2F0ZWdvcnlMYW5kaW5nJyk7CiAgICAgICAgfSBlbHNlIGlmIChwYWdlTmFtZSA9PSAiU1dEU2VsZlNlcnZpY2UiICYmIGdsb2JhbERhdGFMYXllci5UZW1wbGF0ZSA9PSAiIikgewoKICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdTV0RMYW5kaW5nJyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHBhZ2VOYW1lID09ICJDb250YWN0IEhQIC0gQW5vbnltb3VzIikgewoKICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdDb250YWN0SFBMYW5kaW5nJyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYocGFnZU5hbWUgPT0gIlNlcnZpY2VMb2NhdG9yIil7CiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnU2VydmljZUxvY2F0b3InKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZihwYWdlTmFtZSA9PSAiU2VjdXJpdHlCdWxsZXRpbkFyY2hpdmUiKXsKICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdzZWN1cml0eWJ1bGxldGluYXJjaGl2ZScpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKHBhZ2VOYW1lID09ICJtdWx0aXBsZVdhcnJhbnR5Iil7CiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCdNdWx0aXBsZVdhcnJhbnR5SW5wdXRQYWdlJyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYocGFnZU5hbWUgPT0gJ0FkZCBEZXZpY2UnKXsgLy9BZGluZyBmb3IgYWRkIGRldmljZSBwYWdlCiAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywnQWRkRGV2aWNlJyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHBhZ2VOYW1lID09ICJTV0RTZWxmU2VydmljZVN0ZXAiICYmIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnByb2R1Y3RNb2RlbE51bWJlciA9PSBudWxsKSB7ICAgIC8vU1dEIENoYW5nZXMgZ2xvYmFsRGF0YUxheWVyCgogICAgICAgIAlpZihwcm9kTW9kZWwoKSA9PSB0cnVlKXsKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnU1dERG93bmxvYWRfTmV3Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdTV0RTZXJpZXNEb3dubG9hZF9OZXcnKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocGFnZU5hbWUgPT0gIlNXRFNlbGZTZXJ2aWNlU3RlcCIpIHsgICAgLy9TV0QgQ2hhbmdlcyBnbG9iYWxEYXRhTGF5ZXIKCiAgICAgICAgCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnU1dERG93bmxvYWRfTmV3Jyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHBhZ2VOYW1lID09ICJzd2REcml2ZXJEZXRhaWxzIikgeyAgICAvL1NXRCBDaGFuZ2VzIGdsb2JhbERhdGFMYXllcgogICAgCSAgIGlmKHByb2RNb2RlbCgpID09IHRydWUpewogICAgICAgICAgICAgICAgLy9TZXQgZm9yIG1vZGVsCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ1NXRE1vZGVsRHJpdmVyRGV0YWlsc1BhZ2UnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgLy9TZXQgZm9yIHNlcmllcwogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdTV0RTZXJpZXNEcml2ZXJEZXRhaWxzUGFnZScpOwogICAgICAgICAgICB9CgogICAgICAgfQogICAgICAgIGVsc2UgaWYgKHBhZ2VOYW1lID09ICJTV0RTZWxmU2VydmljZUZpbmlzaCIpIHsKICAgICAgICAJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdTV0RDbG9zdXJlX05ldycpOwogICAgICAgIH0gIGVsc2UgaWYgKHBhZ2VOYW1lID09ICJDb250YWN0IEhQIFByb2R1Y3QgQ29udGV4dCBWaWV3IikgewogICAgICAgICAgICAvKmdsb2JhbERhdGFMYXllci5GbGFnLmNvbnRhY3RIUFZpc2l0ZWQgPSAndHJ1ZSc7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5jb250YWN0SFBWaXNpdGVkID0gJ3RydWUnOwogICAgICAgICAgICB0cmlnZ2VyTG9jYWxTZXNzaW9uVGltZXIoKTsqLwogICAgICAgICAgICAvL3RoaXMgdmFsdWUgaXMgc2V0IG9uIEFKQVggc3VjY2VzcyBpbiBocC1wcm9kdWN0LWNvbnRhY3Qtb3B0aW9ucwoJICAgIH0gZWxzZSBpZiAocGFnZU5hbWUgPT0gIlNlYXJjaFJlc3VsdCIpIHsKCQkJCQkJCWlmICh1cmwuaW5kZXhPZigiY29udGFjdC1ocCIpID4gMCkgewoKCQkJCQkJCQlnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ01vZGVscycpOwoKCQkJCQkJCQlpZiAoZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpIHsKCQkJCQkJCQkJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdQZmluZGVyUXVlcnknLAoJCQkJCQkJCQkJCWdldFBhcmFtZXRlckJ5TmFtZSgncScpKTsKCQkJCQkJCQl9CgoJCQkJCQkJCS8vIGlmIGJhZCByZXN1bHRzIGNoYW5nZSB0aGUgVGVtcGxhdGVOYW1lCgkJCQkJCQkJaWYgKCQoJyNwRmluZGVyQmFkUmVzdWx0cycpLmxlbmd0aCA+IDApIHsKCQkJCQkJCQkJLy8gZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsCgkJCQkJCQkJCS8vICdNb2RlbHNCYWRSZXN1bHRzJyk7CgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSBpZiAodXJsLmluZGV4T2YoInByb2R1Y3RzIikgPiAwKSB7CgoJCQkJCQkJCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLAoJCQkJCQkJCQkJJ1Byb2R1Y3RNb2RlbHMnKTsKCQkJCQkJCQlpZiAoZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpIHsKCQkJCQkJCQkJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdQZmluZGVyUXVlcnknLAoJCQkJCQkJCQkJCWdldFBhcmFtZXRlckJ5TmFtZSgncScpKTsKCQkJCQkJCQl9CgkJCQkJCQkJLy8gaWYgYmFkIHJlc3VsdHMgY2hhbmdlIHRoZSBUZW1wbGF0ZU5hbWUKCQkJCQkJCQlpZiAoJCgnI3BGaW5kZXJCYWRSZXN1bHRzJykubGVuZ3RoID4gMCkgewoJCQkJCQkJCQkvLyBnbG9iYWxEYXRhTGF5ZXIuc2VcdFZhbHVlKCdUZW1wbGF0ZScsCgkJCQkJCQkJCS8vICdTV0RNb2RlbHNCYWRSZXN1bHRzJyk7CgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSBpZiAodXJsLmluZGV4T2YoImRyaXZlcnMiKSA+IDApIHsKCgkJCQkJCQkJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsCgkJCQkJCQkJCQknU1dETW9kZWxzJyk7CgkJCQkJCQkJaWYgKGdldFBhcmFtZXRlckJ5TmFtZSgncScpKSB7CgkJCQkJCQkJCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnUGZpbmRlclF1ZXJ5JywKCQkJCQkJCQkJCQlnZXRQYXJhbWV0ZXJCeU5hbWUoJ3EnKSk7CgkJCQkJCQkJfQoJCQkJCQkJCS8vIGlmIGJhZCByZXN1bHRzIGNoYW5nZSB0aGUgVGVtcGxhdGVOYW1lCgkJCQkJCQkJaWYgKCQoJyNwRmluZGVyQmFkUmVzdWx0cycpLmxlbmd0aCA+IDApIHsKCQkJCQkJCQkJLy8gZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsCgkJCQkJCQkJCS8vICdTV0RNb2RlbHNCYWRSZXN1bHRzJyk7CgkJCQkJCQkJfQoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdTZWFyY2gnKTsKCQkJCQkJCQlpZiAoZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpIHsKCQkJCQkJCQkJZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5zZXRWYWx1ZSgnUXVlcnknLAoJCQkJCQkJCQkJCWdldFBhcmFtZXRlckJ5TmFtZSgncScpKTsKCQkJCQkJCQl9CgkJCQkJCQkJLyoKCQkJCQkJCQkgKiBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5zZWFyY2hFeGVjdXRlZCA9ICd0cnVlJzsKCQkJCQkJCQkgKiBsb2NhbFN0b3JhZ2Uuc2VhcmNoRXhlY3V0ZWQgPSAndHJ1ZSc7CgkJCQkJCQkJICogdHJpZ2dlckxvY2FsU2Vzc2lvblRpbWVyKCk7CgkJCQkJCQkJICovCgkJCQkJCQl9CgkJCQkJCX0KICAgICAgICBlbHNlIGlmIChwYWdlTmFtZSA9PSAiQ29uY2VudHJhV3JhcHBlciIgfHwgcGFnZU5hbWUgPT0gIkNvbmNlbnRyYU5vbkNvbnRleHR1YWwiKSB7CiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnRG9jdW1lbnQnKTsKCiAgICAgICAgfSBlbHNlIGlmIChwYWdlTmFtZSA9PSAiUHJvZHVjdCBEZXRhaWxzIFBhZ2UiIHx8IHBhZ2VOYW1lID09ICJQcm9kdWN0IERldGFpbHMgUGFnZSIpIHsKICAgICAgICAgICAgaWYgKHRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdzdXBwb3J0TmFtZU9pZCcpKSB7CiAgICAgICAgICAgICAgICBpZiAodG1zUmVzcG9uc2VbJ3N1cHBvcnROYW1lT2lkJ10gIT0gbnVsbCAmJiB0bXNSZXNwb25zZVsnc3VwcG9ydE5hbWVPaWQnXSAhPSAnbnVsbCcgJiYgdG1zUmVzcG9uc2VbJ3N1cHBvcnROYW1lT2lkJ10gIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ1Byb2R1Y3RNb2RlbCcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ1Byb2R1Y3RTZXJpZXMnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocGFnZU5hbWUgPT0gIkRpc3B1dGVGb3JtIikgewoKICAgICAgICAgICAgaWYoJCgnI3dhcnJhbnR5RGlzcHV0ZUZvcm0nKS5sZW5ndGg+MCl7CgogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdEaXNwdXRlV2FycmFudHlGb3JtJyk7CgogICAgICAgICAgICB9IGVsc2V7CgogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdEaXNwdXRlV2FycmFudHlDb25maXJtYXRpb24nKTsKCiAgICAgICAgICAgIH0KCgogICAgICAgIH0gZWxzZSBpZiAocGFnZU5hbWUgPT0gIlJlbW90ZUNvbm5lY3Rpb24iKSB7CgogICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ1JlbW90ZUFzc2lzdGFuY2UnKTsKCiAgICAgICAgfSBlbHNlIGlmIChwYWdlTmFtZSA9PSAiV2FycmFudHkgQ2hlY2siKSB7CgogICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ1dhcnJhbnR5TGFuZGluZycpOwoKICAgICAgICB9IGVsc2UgaWYgKHBhZ2VOYW1lID09ICJQcm9kdWN0IFdhcnJhbnR5IFJlc3VsdCIpIHsKCiAgICAgICAgICAgIGlmKCQoJyN3YXJyYW50eVN0YXR1cycpLmxlbmd0aD4wKXsKICAgICAgICAgICAgICAgIHZhciB3U3RhdHVzID0gJCgnI3dhcnJhbnR5U3RhdHVzJykudmFsKCk7CiAgICAgICAgICAgICAgICBzd2l0Y2god1N0YXR1cyl7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnSVcnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdJV1Jlc3VsdHMnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ09XJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnT09XUmVzdWx0cycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnWFcnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdYV1Jlc3VsdHMnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSBlbHNlewoKICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnT09XUmVzdWx0cycpOwogICAgICAgICAgICB9CgoKICAgICAgICB9IGVsc2UgaWYgKHBhZ2VOYW1lID09ICJVbmtub3duIFdhcnJhbnR5IikgewoKCiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnVVdSZXN1bHRzJyk7CgogICAgICAgIH0KICAgICAgICBlbHNlIGlmKHBhZ2VOYW1lID09ICJtdWx0aXBsZVdhcnJhbnR5Iil7CiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCdNdWx0aXBsZVdhcnJhbnR5SW5wdXRQYWdlJykKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAocGFnZU5hbWUgPT0gIkhpc3RvcmljYWwgUHJvZHVjdHMiKSB7CgoKICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdIaXN0b3JpY2FsUHJvZHVjdHNMYW5kaW5nJyk7CgogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChwYWdlTmFtZSA9PSAiTWVkaWFPcmRlcmluZyIpIHsKICAgICAgICAgICAgdmFyIHN0ZXBzdmFsdWUgPSAkKCcuc3RlcHNfbWVkaWEnKS52YWwoKSA7CiAgICAgICAgICAgIHN3aXRjaChzdGVwc3ZhbHVlKXsKICAgICAgICAgICAgICAgIGNhc2UgInN0ZXAxIjoKICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdNZWRpYUN1c3RvbWVySW5mb3JtYXRpb24nKTsKICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJzdGVwMiI6CiAgICAgICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnTWVkaWFTaGlwcGluZ0luZm9ybWF0aW9uJyk7CiAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAic3RlcDMiOgogICAgICAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ01lZGlhQmlsbGluZ0luZm9ybWF0aW9uJyk7CiAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAic3RlcDQiOgogICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdNZWRpYVBheW1lbnRJbmZvcm1hdGlvbicpOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJzdGVwNSI6CiAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdNZWRpYU9yZGVyQ29uZmlybWF0aW9uJyk7CgogICAgICAgICAgICAgICAgfQoKICAgICAgICB9IGVsc2UgaWYgKHBhZ2VOYW1lID09ICJwcm9kdWN0cmVwbGFjZW1lbnQiKSB7CiAgICAgICAgCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAncHJvZHVjdHJlcGxhY2VtZW50Jyk7CiAgICAgICAgfSBlbHNlIGlmIChwYWdlTmFtZSA9PSAib3JkZXJjb25maXJtYXRpb24iKSB7CiAgICAgICAgCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnb3JkZXJjb25maXJtYXRpb24nKTsKICAgICAgICB9CiAgICAgICAgLy9lcnJvciBwYWdlCiAgICAgICAgZWxzZSBpZihwYWdlTmFtZSA9PSAiRXJyb3IgUGFnZSIpewogICAgICAgICAgICB2YXIgZXJyb3J2YWx1ZSA9ICQoJy5tZWRpYWVycm9yJykudmFsKCkgfCAwIDsKICAgICAgICAgICAgdmFyIHByb2R1Y3RSZXBsYWNlbWVudEVycm9yVmFsdWUgPSAkKCcjcHJvZHVjdHJlcGxhY2VtZW50ZXJyb3InKS52YWwoKSB8IDAgOwogICAgICAgICAgICBzd2l0Y2goZXJyb3J2YWx1ZSl7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ01lZGlhTm90T3JkZXJhYmxlJyk7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCdNZWRpYUxpbWl0UmVhY2hlZCcpOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywnTWVkaWFQYXltZW50RmFpbGVkJyk7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBzd2l0Y2gocHJvZHVjdFJlcGxhY2VtZW50RXJyb3JWYWx1ZSl7CgkgICAgICAgICAgICBjYXNlIDE6CgkgICAgICAgICAgCSAgCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnSW5lbGlnaWJsZVByb2R1Y3QnKTsKCSAgICAgICAgICAJICAJYnJlYWs7CgkgICAgICAgICAgICBjYXNlIDI6CgkgICAgICAgICAgCSAgCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnU3VibWlzc2lvbkZhaWxlZCcpOwoJICAgICAgICAgICAgCWJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICB9CgogICAgICAgICBlbHNlIGlmKHBhZ2VOYW1lID09ICJJZGVudGlmeVByb2R1Y3QiKXsKICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdDaGFuZ2VQcm9kdWN0Jyk7CiAgICAgICAgIH0KICAgICAgICAgZWxzZSBpZihwYWdlTmFtZSA9PSAiU1dEcGZpbmRlckJhZFJlc3VsdHMiKXsgIC8vQWRkZWQgYXMgcGFydCBvZiA2NTM5CgogICAgICAgICAgICBpZiAodXJsLmluZGV4T2YoImNvbnRhY3QtaHAiKSA+IDApIHsKCiAgICAgICAgICAgIAlnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ0NvbnRhY3RIUEJhZFJlc3VsdHMnKTsKCgkJCX0gZWxzZSBpZiAodXJsLmluZGV4T2YoInByb2R1Y3RzIikgPiAwKSB7CgkJCQkgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdQRFBCYWRSZXN1bHRzJyk7CgoJCQl9IGVsc2UgaWYgKHVybC5pbmRleE9mKCJkcml2ZXJzIikgPiAwKSB7CgkJCQkgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdTV0RCYWRSZXN1bHRzJyk7CgoJCQl9CiAgICAgICAgIH0KICAgICAgICAgZWxzZSBpZiAocGFnZU5hbWUgPT0gInByb2R1Y3RJZGVudGlmaWNhdGlvbiIpewogICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsJ0RNRCcpOwogICAgICAgICB9CiAgICB9CgogICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwp9KTsKCmNsZWFyTG9jYWxTdG9yYWdlRUFTKCk7CgpmdW5jdGlvbiBjbGVhckxvY2FsU3RvcmFnZUVBUygpewoJaWYobG9jYWxTdG9yYWdlLmVhc1N0YXJ0VGltZSl7Cgl2YXIgaW5pdGlhbFRpbWUgPSBwYXJzZUludChsb2NhbFN0b3JhZ2UuZWFzU3RhcnRUaW1lKTsKCXZhciBleHBpcmF5RHVyYXRpb24gPSA2MCo2MCoxMDAwOwoJdmFyIGN1cnJlbnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CgkJaWYoY3VycmVudFRpbWUgLSBpbml0aWFsVGltZSA+PSBleHBpcmF5RHVyYXRpb24pewoJCQlsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgidXNlckVBU0luZm8iKTsKCQl9Cgl9Cn0KfQpjYXRjaChlcnIpIHsKICBjb25zb2xlLmxvZyhlcnIpOwp9CgokKGZ1bmN0aW9uKCkgewogICAgY29uc3QgY2xhc3NOYW1lID0gJy5kb2N1bWVudC11cmwnOwogICAgdmFyIGRvY3VtZW50QW5jaG9ycyA9ICQoY2xhc3NOYW1lKTsKICAgIHZhciBkb2N1bWVudFBhdGhDaGVjayA9ICJ1cy1lbi9kb2N1bWVudC8iOwogICAgdmFyIHBhZ2VJbmZvTWV0YSA9ICQoJ2hlYWQgbWV0YVtuYW1lPXBhZ2VpbmZvXScpOwogICAgdmFyIGNjID0gcGFnZUluZm9NZXRhLmRhdGEoJ2NjJyk7CiAgICB2YXIgbGMgPSBwYWdlSW5mb01ldGEuZGF0YSgnbGMnKTsKICAgIHZhciBkb2N1bWVudEFQSVVSTCA9ICIvaHAtcHBzLXNlcnZpY2VzL2thYVMvZ2V0RG9jdW1lbnRUcmFuc2xhdGlvbnM/bGM9IiArIGxjICsgIiZjYz0iICsgY2M7CiAgICB2YXIgd2Vic2VydmVyVVJMID0gcGFnZUluZm9NZXRhLmRhdGEoJ3dlYnNlcnZlcnVybCcpOwogICAgdmFyIGZpbmFsRG9jdW1lbnRBbmNob3JzID0gW107CiAgICBpZiAod2Vic2VydmVyVVJMLmluZGV4T2Yod2luZG93LmxvY2F0aW9uLmhvc3RuYW1lKSA+IC0xKSB7CiAgICAgICAgJChkb2N1bWVudEFuY2hvcnMpLmVhY2goZnVuY3Rpb24oaSkgewogICAgICAgICAgICBjb25zdCBhY3R1YWxUYWdnZWREb20gPSAkKHRoaXMpOwogICAgICAgICAgICB2YXIgZG9jdW1lbnRBbmNob3JEb20gPSBhY3R1YWxUYWdnZWREb20uY2xvc2VzdCgnYScpOwogICAgICAgICAgICB2YXIgbGluayA9IGRvY3VtZW50QW5jaG9yRG9tLmF0dHIoJ2hyZWYnKTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBsaW5rID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgZG9jdW1lbnRBbmNob3JEb20gPSAkKHRoaXMpLmNoaWxkcmVuKCI6Zmlyc3QiKTsKICAgICAgICAgICAgICAgIGxpbmsgPSBkb2N1bWVudEFuY2hvckRvbS5hdHRyKCdocmVmJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxpbmsuaW5kZXhPZihkb2N1bWVudFBhdGhDaGVjaykgPiAtMSkgewogICAgICAgICAgICAgICAgdmFyIHNwbGl0dGVkTGluayA9IGxpbmsuc3BsaXQoJy8nKTsKICAgICAgICAgICAgICAgIHZhciBkb2N1bWVudElkID0gc3BsaXR0ZWRMaW5rW3NwbGl0dGVkTGluay5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIHZhciBkb2N1bWVudElkQXJyYXkgPSBbXTsKICAgICAgICAgICAgICAgIGRvY3VtZW50SWRBcnJheS5wdXNoKGRvY3VtZW50SWQpOwogICAgICAgICAgICAgICAgdmFyIGpzb25EYXRhID0gewogICAgICAgICAgICAgICAgICAgICJkb2NJRHMiOiBkb2N1bWVudElkQXJyYXksCiAgICAgICAgICAgICAgICAgICAgImRvY1RpdGxlcyI6IGRvY3VtZW50SWRBcnJheQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB1cmw6IGRvY3VtZW50QVBJVVJMLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGpzb25EYXRhKSwKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50TGFuZ3VhZ2VJREpTT04gPSBkYXRhWydkb2N1bWVudFVSTE1hcCddOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudExhbmd1YWdlVGl0bGVKU09OID0gZGF0YVsnZG9jdW1lbnRUaXRsZU1hcCddOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnRMYW5ndWFnZUlESlNPTiAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdXBkYXRlIHBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRvY1VSTCA9IGN1cnJlbnRMYW5ndWFnZUlESlNPTlsnZG9jdXJsJyArIGRvY3VtZW50SWRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsaWRhdGVFeHRlcm5hbFVybChkb2NVUkwpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudEFuY2hvckRvbS5hdHRyKCdocmVmJyxkb2NVUkwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY3VycmVudExhbmd1YWdlVGl0bGVKU09OICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy91cGRhdGUgdGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50QW5jaG9yRG9tLmZpbmQoY2xhc3NOYW1lKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudEFuY2hvckRvbSA9IGRvY3VtZW50QW5jaG9yRG9tLmZpbmQoY2xhc3NOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50QW5jaG9yRG9tLnRleHQoY3VycmVudExhbmd1YWdlVGl0bGVKU09OWydkb2N0aXRsZScgKyBkb2N1bWVudElkXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCn0pOwoKZnVuY3Rpb24gdmFsaWRhdGVFeHRlcm5hbFVybCh2YWx1ZSkgewogIHJldHVybiAvXig/Oig/Oig/Omh0dHBzP3xmdHApOik/XC9cLykoPzpcUysoPzo6XFMqKT9AKT8oPzooPyEoPzoxMHwxMjcpKD86XC5cZHsxLDN9KXszfSkoPyEoPzoxNjlcLjI1NHwxOTJcLjE2OCkoPzpcLlxkezEsM30pezJ9KSg/ITE3MlwuKD86MVs2LTldfDJcZHwzWzAtMV0pKD86XC5cZHsxLDN9KXsyfSkoPzpbMS05XVxkP3wxXGRcZHwyWzAxXVxkfDIyWzAtM10pKD86XC4oPzoxP1xkezEsMn18MlswLTRdXGR8MjVbMC01XSkpezJ9KD86XC4oPzpbMS05XVxkP3wxXGRcZHwyWzAtNF1cZHwyNVswLTRdKSl8KD86KD86W2Etelx1MDBhMS1cdWZmZmYwLTldLSopKlthLXpcdTAwYTEtXHVmZmZmMC05XSspKD86XC4oPzpbYS16XHUwMGExLVx1ZmZmZjAtOV0tKikqW2Etelx1MDBhMS1cdWZmZmYwLTldKykqKD86XC4oPzpbYS16XHUwMGExLVx1ZmZmZl17Mix9KSkpKD86OlxkezIsNX0pPyg/OlsvPyNdXFMqKT8kL2kudGVzdCh2YWx1ZSk7Cn0KJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkgewoKCSQoIi5tZW51QmFySGVhZCB1bCBsaSIpLm9uKCJtb3VzZWVudGVyIiwgZnVuY3Rpb24gKCkgewoJCSQodGhpcykuY2hpbGRyZW4oInVsIikuc2libGluZ3MoImEiKS5jaGlsZHJlbigic3BhbiIpLmFkZENsYXNzKCJpY29uLXVwIikucmVtb3ZlQ2xhc3MoImljb24tZHduIik7CgkJJCh0aGlzKS5jaGlsZHJlbigidWwiKS5zaWJsaW5ncygiYSIpLmF0dHIoImFyaWEtZXhwYW5kZWQiLCAidHJ1ZSIpOwoJCSQodGhpcykuY2hpbGRyZW4oInVsIikuc2hvdygpOwoJfSk7CgkKCSQoIi5tZW51QmFySGVhZCB1bCA+IGxpICIpLm9uKCJtb3VzZWxlYXZlIiwgZnVuY3Rpb24gKCkgewoJCSQodGhpcykuY2hpbGRyZW4oInVsIikuc2libGluZ3MoImEiKS5jaGlsZHJlbigic3BhbiIpLnJlbW92ZUNsYXNzKCJpY29uLXVwIikuYWRkQ2xhc3MoImljb24tZHduIik7CgkJJCh0aGlzKS5jaGlsZHJlbigidWwiKS5zaWJsaW5ncygiYSIpLmF0dHIoImFyaWEtZXhwYW5kZWQiLCAiZmFsc2UiKTsKCQkkKHRoaXMpLmNoaWxkcmVuKCJ1bCIpLmhpZGUoKTsKCX0pOwoKCgl2YXIgY2hlY2tTaXplID0gZnVuY3Rpb24gKGUpIHsKCQllLnByZXZlbnREZWZhdWx0KCk7CgkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQlub3JtYWxEcm9wZG93bih0aGlzKTsKCX07CgoJRHJvcGRvd24gPSAoZnVuY3Rpb24gKCkgewoKCQl2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHsKCQkJaWYgKCQoJ1tkYXRhLXRvZ2dsZT0iY3VzdG9tRHJvcGRvd24iXScpLmxlbmd0aCkgewoJCQkJYWRkSGFuZGxlcnMoKTsKCQkJfQoJCX07CgoJCXZhciBhZGRIYW5kbGVycyA9IGZ1bmN0aW9uICgpIHsKCQkJJCgnW2RhdGEtdG9nZ2xlPSJjdXN0b21Ecm9wZG93biJdJykub24oJ3RhcCBjbGljaycsIGNoZWNrU2l6ZSk7CgoJCQkkKCcuY3VzdG9tRHJvcGRvd24nKS5vbignZENsb3NlJywgZENsb3NlKTsKCQkJJCgnLmN1c3RvbURyb3Bkb3duJykub24oJ2RPcGVuJywgZE9wZW4pOwoJCQkkKGRvY3VtZW50KS5vbigndGFwIGNsaWNrJywgY2xlYXJEcm9wZG93bnMpOwoJCQkkKCcuY3VzdG9tRHJvcGRvd24nKS5vbigndGFwIGNsaWNrJywgZnVuY3Rpb24gKGUpIHsKCQkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7CgoJCQl9KTsKCQl9OwoKCQl2YXIgY2hlY2tTaXplID0gZnVuY3Rpb24gKGUpIHsKCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQllLnN0b3BQcm9wYWdhdGlvbigpOwoJCQlub3JtYWxEcm9wZG93bih0aGlzKTsKCgkJfTsKCQl2YXIgY2xlYXJEcm9wZG93bnMgPSBmdW5jdGlvbiAoZSkgewoJCQl2YXIgY29udGFpbmVyID0gJCgiLmN1c3RvbURyb3Bkb3duIik7CgkJCWlmICghY29udGFpbmVyLmlzKGUudGFyZ2V0KQoJCQkJJiYKCQkJCWNvbnRhaW5lci5oYXMoZS50YXJnZXQpLmxlbmd0aCA9PT0gMCkKCQkJewoJCQkJJGRyb3Bkb3ducyA9ICQoJy5jdXN0b21Ecm9wZG93bicpOwoJCQkJJGRyb3Bkb3ducy50cmlnZ2VyKCdkQ2xvc2UnKTsKCQkJfQoJCX07CgkJdmFyIG5vcm1hbERyb3Bkb3duID0gZnVuY3Rpb24gKHRhcmdldCkgewoJCQkkZHJvcGRvd24gPSAkKHRhcmdldCkucGFyZW50KCk7CgoJCQkkZHJvcGRvd25zID0gJCgnLmN1c3RvbURyb3Bkb3duJyk7CgkJCWlmICgkZHJvcGRvd24uaGFzQ2xhc3MoJ29wZW4nKSkgewoJCQkJJGRyb3Bkb3duLnRyaWdnZXIoJ2RDbG9zZScpOwoJCQl9IGVsc2UgewoJCQkJJGRyb3Bkb3ducy5ub3QoJGRyb3Bkb3duKS50cmlnZ2VyKCdkQ2xvc2UnKTsKCQkJCSRkcm9wZG93bi50cmlnZ2VyKCdkT3BlbicpOwoJCQl9CgkJfTsKCQl2YXIgZENsb3NlID0gZnVuY3Rpb24gKGUpIHsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQkJJHRoaXMgPSAkKHRoaXMpOwoJCQkkdGhpcy5yZW1vdmVDbGFzcygnb3BlbicpOwoJCX07CgoJCXZhciBkT3BlbiA9IGZ1bmN0aW9uIChlKSB7CgkJCSR0aGlzID0gJCh0aGlzKTsKCQkJJHRoaXMuYWRkQ2xhc3MoJ29wZW4nKTsKCQl9OwoKCQlyZXR1cm4gewoJCQlpbml0OiBpbml0CgkJfTsKCX0oKSk7CgoJRHJvcGRvd24uaW5pdCgpOwoKCgl2YXIgc2VjX25hdl93aWR0aCA9IDc3NTsKCXZhciBzZWNfbmF2X2NvbnQgPSAiLm1vYmlsZS1uYXYtd3JhcHBlciAuY29udGFpbmVyIjsKCXZhciBzZWNfbmF2X21lbnUsIHNlY19uYXZfZGRfbWVudSwgc2VjX25hdl9kZF90cmlnZ2dlcjsKCglzZWNfbmF2X2RkX21lbnUgPSAkKHNlY19uYXZfY29udCArICI+IHVsID4gbGkgPiB1bCIpOwoJc2VjX25hdl9kZF90cmlnZ2dlciA9ICQoc2VjX25hdl9kZF9tZW51KS5zaWJsaW5ncygiYSIpOwoKCXNlY19uYXZfZGRfdHJpZ2dnZXIuYXR0cigiYXJpYS1leHBhbmRlZCIsICJmYWxzZSIpOwoKCgkKCWlmICgkKHdpbmRvdykud2lkdGgoKSA8PSBzZWNfbmF2X3dpZHRoKSB7CgkJc2V0U2VjTmF2RHJvcGRvd25NYXhIZWlnaHQoKTsKCgkKCQkkKCIuY3VzdG9tRHJvcGRvd24gPiBhLmRyb3Bkb3duLXRvZ2dsZS5oaWRkZW4tbGcgPiBzcGFuIikuYWRkQ2xhc3MoInNlY05hdlRvZ2dsZUNhcnJvdCIpOwoJfQoKCXNlY19uYXZfZGRfbWVudS5wYXJlbnRzKCJsaSIpLm9uKCJjbGljayIsIGZ1bmN0aW9uICgpIHsKCQlpZiAoJCh3aW5kb3cpLndpZHRoKCkgPD0gc2VjX25hdl93aWR0aCkgewoKCQkJaWYgKCQodGhpcykuY2hpbGRyZW4oInVsIikuaXMoIjp2aXNpYmxlIikgPT0gdHJ1ZSkgewoKCQkJCQoJCQkJJCh0aGlzKS5jaGlsZHJlbigidWwiKS5oaWRlKCk7CgkJCQlzZWNfbmF2X2RkX3RyaWdnZ2VyLmFkZENsYXNzKCJzZWMtbmF2LW12IikucmVtb3ZlQ2xhc3MoInNlYy1uYXYtbXYtb3BlbiBzZWMtbmF2LWR2IikuZmluZCgic3BhbiIpLmFkZENsYXNzKCJpY29uLWR3biIpLnJlbW92ZUNsYXNzKCJpY29uLXVwIik7CgkJCQkkKHRoaXMpLmNzcygiYmFja2dyb3VuZC1jb2xvciIsICIjZmZmIik7CgkJCX0gZWxzZSB7CgkJCQoJCQkJJCh0aGlzKS5jaGlsZHJlbigidWwiKS5zaG93KCk7CgkJCQlzZWNfbmF2X2RkX3RyaWdnZ2VyLmFkZENsYXNzKCJzZWMtbmF2LW12LW9wZW4iKS5yZW1vdmVDbGFzcygic2VjLW5hdi1tdiBzZWMtbmF2LWR2IikuZmluZCgic3BhbiIpLmFkZENsYXNzKCJpY29uLXVwIikucmVtb3ZlQ2xhc3MoImljb24tZHduIik7CgkJCX0KCQl9IGVsc2UgewoJCQlzZWNfbmF2X2RkX3RyaWdnZ2VyLmFkZENsYXNzKCJzZWMtbmF2LWR2IikucmVtb3ZlQ2xhc3MoInNlYy1uYXYtbXYtb3BlbiBzZWMtbmF2LW12Iik7CgkJfQoJfSk7CgoKCglmdW5jdGlvbiBzZXRTZWNOYXZEcm9wZG93bk1heEhlaWdodCgpIHsKCQl2YXIgbWF4SGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpICogMC44NTsKCQkkKHNlY19uYXZfY29udCArICIgPiB1bCIpLmNzcygibWF4LWhlaWdodCIsIG1heEhlaWdodCArICJweCIpOwoJfQoKCSQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKCkgewoJCXNlY19uYXZfZGRfbWVudS5oaWRlKCk7CgoJCSQoc2VjX25hdl9jb250ICsgIj4gdWwgPiBsaSA+IHVsIikuc2libGluZ3MoImEiKS5jaGlsZHJlbigic3BhbiIpLmFkZENsYXNzKCJpY29uLWR3biIpLnJlbW92ZUNsYXNzKCJpY29uLXVwIik7CgkJaWYgKCQod2luZG93KS53aWR0aCgpIDw9IHNlY19uYXZfd2lkdGgpIHsKCQkJc2V0U2VjTmF2RHJvcGRvd25NYXhIZWlnaHQoKTsKCQoJCQkkKHNlY19uYXZfY29udCArICI+IHVsID4gbGkgPiB1bCIpLnNpYmxpbmdzKCJhIikuY2hpbGRyZW4oInNwYW4iKS5hZGRDbGFzcygicHVsbC1yaWdodCIpLnJlbW92ZUNsYXNzKCJzZWNuYXYtZHJvcGRvd24tY2Fycm90Iik7CgkJCgkJCXNlY19uYXZfZGRfdHJpZ2dnZXIuYWRkQ2xhc3MoInNlYy1uYXYtbXYiKS5yZW1vdmVDbGFzcygic2VjLW5hdi1kdiBzZWMtbmF2LW12LW9wZW4iKTsKCgkJCQoJCQkkKCIuY3VzdG9tRHJvcGRvd24gPiBhLmRyb3Bkb3duLXRvZ2dsZS5oaWRkZW4tbGcgPiBzcGFuIikuYWRkQ2xhc3MoInNlY05hdlRvZ2dsZUNhcnJvdCIpOwoJCX0gZWxzZSB7CgkJCgkJCSQoc2VjX25hdl9jb250ICsgIj4gdWwgPiBsaSA+IHVsIikuc2libGluZ3MoImEiKS5jaGlsZHJlbigic3BhbiIpLnJlbW92ZUNsYXNzKCJwdWxsLXJpZ2h0IikuYWRkQ2xhc3MoInNlY25hdi1kcm9wZG93bi1jYXJyb3QiKTsKCQkJCgkJCXNlY19uYXZfZGRfdHJpZ2dnZXIuYWRkQ2xhc3MoInNlYy1uYXYtZHYiKS5yZW1vdmVDbGFzcygic2VjLW5hdi1tdiBzZWMtbmF2LW12LW9wZW4iKTsKCgkJCSQoIi5jdXN0b21Ecm9wZG93biA+IGEuZHJvcGRvd24tdG9nZ2xlLmhpZGRlbi1sZyA+IHNwYW4iKS5yZW1vdmVDbGFzcygic2VjTmF2VG9nZ2xlQ2Fycm90Iik7CgkJfQoJfSk7CgoKCgkkKHNlY19uYXZfY29udCArICI+IHVsID4gbGkgPiB1bCIpLnBhcmVudHMoImxpIikub24oIm1vdXNlZW50ZXIiLCBmdW5jdGlvbiAoKSB7CgoJCQoJCSQodGhpcykuY2hpbGRyZW4oInVsIikuc2libGluZ3MoImEiKS5jaGlsZHJlbigic3BhbiIpLmFkZENsYXNzKCJpY29uLXVwIikucmVtb3ZlQ2xhc3MoImljb24tZHduIik7CgkJJCh0aGlzKS5jaGlsZHJlbigidWwiKS5zaWJsaW5ncygiYSIpLmF0dHIoImFyaWEtZXhwYW5kZWQiLCAidHJ1ZSIpOwoJCgkJJCh0aGlzKS5jaGlsZHJlbigidWwiKS5zaG93KCk7Cgl9KTsKCSQoc2VjX25hdl9jb250ICsgIj4gdWwgPiBsaSA+IHVsIikucGFyZW50cygibGkiKS5vbigibW91c2VsZWF2ZSIsIGZ1bmN0aW9uICgpIHsKCQkKCQkkKHRoaXMpLmNoaWxkcmVuKCJ1bCIpLnNpYmxpbmdzKCJhIikuY2hpbGRyZW4oInNwYW4iKS5yZW1vdmVDbGFzcygiaWNvbi11cCIpLmFkZENsYXNzKCJpY29uLWR3biIpOwoJCSQodGhpcykuY2hpbGRyZW4oInVsIikuc2libGluZ3MoImEiKS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwgImZhbHNlIik7CgkJCgkJJCh0aGlzKS5jaGlsZHJlbigidWwiKS5oaWRlKCk7Cgl9KTsKCgoJdmFyIG5hdiA9ICQoc2VjX25hdl9jb250ICsgIiA+IHVsIik7CgoJCgluYXYuYXR0cigncm9sZScsICdtZW51YmFyJykuZmluZCgnPiBsaScpLmF0dHIoJ3JvbGUnLCAnbWVudWl0ZW0nKS5maW5kKCI+IGEiKTsKCgoJdmFyIHRvcF9sZXZlbF9saW5rcyA9IG5hdi5maW5kKCc+IGxpID4gYScpOwoJdmFyIHN1Yk1lbnVMaW5rcyA9IHRvcF9sZXZlbF9saW5rcy5zaWJsaW5ncygidWwiKS5jaGlsZHJlbigibGkiKS5jaGlsZHJlbigiYSIpOwoKCSQodG9wX2xldmVsX2xpbmtzKS5uZXh0KCd1bCcpCgkJLmF0dHIoewoJCQknYXJpYS1oaWRkZW4nOiAndHJ1ZScsCgkJCSdyb2xlJzogJ21lbnUnCgkJfSk7CgoKCSQoc3ViTWVudUxpbmtzKS5hdHRyKHsKCQkicm9sZSI6ICJtZW51aXRlbSIsCgkJImFyaWEtaGFzcG9wdXAiOiB0cnVlCgl9KTsKCW5hdi5maW5kKCI+IGxpID4gdWwgbGkgYSIpLmF0dHIoInJvbGUiLCAibWVudWl0ZW0iKTsKCgoJCgkkKHRvcF9sZXZlbF9saW5rcykua2V5ZG93bihmdW5jdGlvbiAoZSkgewoJCXZhciBlbGVtID0gJCh0aGlzKS5zaWJsaW5ncygidWwiKTsKCQl2YXIgdGhhdCA9ICQodGhpcyk7CgkJLy9Fc2MgS2V5CgkJaWYgKGUua2V5Q29kZSA9PSAyNykgewoJCQlpZiAoZWxlbS5sZW5ndGggPiAwKSB7CgkJCQlpZiAoJCh0aGlzKS5zaWJsaW5ncygidWwiKS5pcygiOnZpc2libGUiKSkgewoJCQkJCWVsZW0uc2libGluZ3MoImEiKS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwgImZhbHNlIik7CgkJCQkJaGlkZURyb3Bkb3duQWNjZXNzaWJpbGl0eShlbGVtKTsKCQkJCQllbGVtLnNpYmxpbmdzKCJhIikuY2hpbGRyZW4oInNwYW4iKS5yZW1vdmVDbGFzcygiaWNvbi11cCIpLmFkZENsYXNzKCJpY29uLWR3biIpOwoJCQkJfQoJCQl9CgkJfQoKCQkvL0VudGVyIG9yIFNwYWNlIGtleQoJCWlmIChlLmtleUNvZGUgPT0gMTMgfHwgZS5rZXlDb2RlID09IDMyKSB7IAoJCQlpZiAoZWxlbS5sZW5ndGggPiAwKSB7CgkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQlpZiAoISQodGhpcykuc2libGluZ3MoInVsIikuaXMoIjp2aXNpYmxlIikpIHsKCQkJCQlzaG93RHJvcGRvd25BY2Nlc3NpYmlsaXR5KGVsZW0pOwoJCQkJCSQoJCh0aGlzKS5zaWJsaW5ncygidWwiKS5jaGlsZHJlbigibGkiKVswXSkuY2hpbGRyZW4oImEiKS5maXJzdCgpLnByZXYoKS5mb2N1cygpOwoJCQkJCWlmICgkKHRoaXMpLmNoaWxkcmVuKCJzcGFuIikuaGFzQ2xhc3MoImljb24tdXAiKSkgewoJCQkJCQkkKHRoaXMpLmNoaWxkcmVuKCJzcGFuIikucmVtb3ZlQ2xhc3MoImljb24tdXAiKS5hZGRDbGFzcygiaWNvbi1kd24iKTsKCQkJCQkJZWxlbS5zaWJsaW5ncygiYSIpLmF0dHIoImFyaWEtZXhwYW5kZWQiLCAiZmFsc2UiKTsKCQkJCQl9IGVsc2UgewoJCQkJCQkkKHRoaXMpLmNoaWxkcmVuKCJzcGFuIikuYWRkQ2xhc3MoImljb24tdXAiKS5yZW1vdmVDbGFzcygiaWNvbi1kd24iKTsKCQkJCQkJZWxlbS5zaWJsaW5ncygiYSIpLmF0dHIoImFyaWEtZXhwYW5kZWQiLCAidHJ1ZSIpOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJZWxlbS5zaWJsaW5ncygiYSIpLmF0dHIoImFyaWEtZXhwYW5kZWQiLCAiZmFsc2UiKTsKCQkJCQloaWRlRHJvcGRvd25BY2Nlc3NpYmlsaXR5KGVsZW0pOwoJCQkJCWVsZW0uc2libGluZ3MoImEiKS5jaGlsZHJlbigic3BhbiIpLnJlbW92ZUNsYXNzKCJpY29uLXVwIikuYWRkQ2xhc3MoImljb24tZHduIik7CgkJCQl9CgkJCX0KCQl9CgoKCX0pOwoKICAgIC8qc2hvdyBkcm9wZG93biovCglmdW5jdGlvbiBzaG93RHJvcGRvd25BY2Nlc3NpYmlsaXR5KGVsZW1lbnQpewoJCWVsZW1lbnQKCQkJLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJykKCQkJLmNzcygiZGlzcGxheSIsImJsb2NrIik7Cgl9CgogICAgLypoaWRlIGRyb3Bkb3duKi8KCWZ1bmN0aW9uIGhpZGVEcm9wZG93bkFjY2Vzc2liaWxpdHkoZWxlbWVudCl7CgkJZWxlbWVudAoJCQkuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpCgkJCS5jc3MoImRpc3BsYXkiLCJub25lIik7Cgl9CgoKCXN1Yk1lbnVMaW5rcy5rZXlkb3duKGZ1bmN0aW9uIChlKSB7CgkJLy9Fc2MgS2V5CgkJaWYgKGUua2V5Q29kZSA9PSAyNykgewoJCQllbGVtID0gJCh0aGlzKS5wYXJlbnQoImxpIikucGFyZW50KCJ1bCIpOwoJCQlpZiAoZWxlbS5sZW5ndGggPiAwKSB7CgkJCQllbGVtLnNpYmxpbmdzKCJhIikuYXR0cigiYXJpYS1leHBhbmRlZCIsICJmYWxzZSIpOwoJCQkJaGlkZURyb3Bkb3duQWNjZXNzaWJpbGl0eShlbGVtKTsKCQkJCWVsZW0uc2libGluZ3MoImEiKS5jaGlsZHJlbigic3BhbiIpLnJlbW92ZUNsYXNzKCJpY29uLXVwIikuYWRkQ2xhc3MoImljb24tZHduIik7CgkJCQllbGVtLnNpYmxpbmdzKCJhIikuZm9jdXMoKTsKCQkJfQoJCX0KCgkJaWYgKGUua2V5Q29kZSA9PSA5ICYmICFlLnNoaWZ0S2V5KSB7CgkJCWVsZW0gPSAkKHRoaXMpLnBhcmVudCgibGkiKS5wYXJlbnQoInVsIik7CgkJCWlmIChPYmplY3QuaXMoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCwgKGVsZW0uY2hpbGRyZW4oImxpOmxhc3QtY2hpbGQiKS5maW5kKCJhIilbMF0pKSkgewoJCQkJZWxlbS5zaWJsaW5ncygiYSIpLmF0dHIoImFyaWEtZXhwYW5kZWQiLCAiZmFsc2UiKTsKCQkJCWhpZGVEcm9wZG93bkFjY2Vzc2liaWxpdHkoZWxlbSk7CgkJCQllbGVtLnNpYmxpbmdzKCJhIikuY2hpbGRyZW4oInNwYW4iKS5yZW1vdmVDbGFzcygiaWNvbi11cCIpLmFkZENsYXNzKCJpY29uLWR3biIpOwoJCQl9CgkJfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gOSAmJiBlLnNoaWZ0S2V5KSB7CgkJCWVsZW0gPSAkKHRoaXMpLnBhcmVudCgibGkiKS5wYXJlbnQoInVsIik7CgkJCWlmIChPYmplY3QuaXMoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCwgKGVsZW0uY2hpbGRyZW4oImxpOmZpcnN0LWNoaWxkIikuZmluZCgiYSIpWzBdKSkpIHsKCQkJCWVsZW0uc2libGluZ3MoImEiKS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwgImZhbHNlIik7CgkJCQloaWRlRHJvcGRvd25BY2Nlc3NpYmlsaXR5KGVsZW0pOwoJCQkJZWxlbS5zaWJsaW5ncygiYSIpLmNoaWxkcmVuKCJzcGFuIikucmVtb3ZlQ2xhc3MoImljb24tdXAiKS5hZGRDbGFzcygiaWNvbi1kd24iKTsKCQkJfQoJCX0KCX0pOwoKCgkvLyBzaG93IGJvcmRlciBvbiBhY3RpdmUgdGFiIG9uIHRhYiBhY2Nlc3MKCXZhciBjdXJyZW50QWN0aXZlU2VjTmF2VGFiID0gJCgiLm1vYmlsZS1uYXYtd3JhcHBlciAuY29udGFpbmVyID4gdWwgPiBsaS5hY3RpdmUiKS5pbmRleCgpOwoJJChkb2N1bWVudCkub24oImZvY3VzIiwgIi5tb2JpbGUtbmF2LXdyYXBwZXIgLmNvbnRhaW5lciA+IHVsID4gbGkgPiBhIiwgZnVuY3Rpb24gKCkgewoJCSQodGhpcykucGFyZW50cygidWwiKS5maW5kKCI+IGxpIikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpOwoJCSQodGhpcykucGFyZW50KCkuYWRkQ2xhc3MoImFjdGl2ZSIpOwoJfSk7CgoJLy9zaG93IGJvcmRlciBvbiBjdXJyZW50IGFjdGl2ZSB0YWIgaWYgY2xpY2sgb3V0c2lkZSBzZWMgbmF2CgkkKCJib2R5Iikub24oImNsaWNrIiwgZnVuY3Rpb24gKGUpIHsKCQlpZiAoISQoZS50YXJnZXQpLmlzKHNlY19uYXZfY29udCkpIHsKCQkJJChzZWNfbmF2X2NvbnQgKyAiID4gdWwgPiBsaSA+IHVsIikuaGlkZSgpOwoJCQkkKHNlY19uYXZfY29udCArICIgPiB1bCA+IGxpIikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpOwoJCQkkKHNlY19uYXZfY29udCArICI+IHVsID4gbGkgPiB1bCIpLnNpYmxpbmdzKCJhIikuY2hpbGRyZW4oInNwYW4iKS5hZGRDbGFzcygiaWNvbi1kd24iKS5yZW1vdmVDbGFzcygiaWNvbi11cCIpOwoJCQlpZiAoY3VycmVudEFjdGl2ZVNlY05hdlRhYiA+PSAwICYmIGN1cnJlbnRBY3RpdmVTZWNOYXZUYWIgIT0gdW5kZWZpbmVkKSB7CgkJCQkkKHNlY19uYXZfY29udCArICIgPiB1bCA+IGxpIikuZXEoY3VycmVudEFjdGl2ZVNlY05hdlRhYikuYWRkQ2xhc3MoImFjdGl2ZSIpOwoJCQl9CgkJfQoJfSk7CgoKCS8vZG9uJ3QgZm9jdXMgb24gaGVhZGluZ3MgaW4gZHJvcGRvd24gbGlua3MKCXZhciBkZF9saW5rcyA9ICIgPiB1bCA+IGxpID4gdWwgPiBsaSA+IGEiOwoJJC5lYWNoKCQoc2VjX25hdl9jb250ICsgZGRfbGlua3MpLCBmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHsKCQl2YXIgbGlua1ZhbCA9ICQoZWxlbWVudCkuYXR0cigiaHJlZiIpOwoJCWlmIChsaW5rVmFsID09IHVuZGVmaW5lZCB8fCBsaW5rVmFsID09ICJqYXZhc2NyaXB0OnZvaWQoMCkiKSB7CgkJCSQoZWxlbWVudCkucmVtb3ZlQXR0cigiaHJlZiIpOwoJCX0KCX0pOwoKCS8vY2hhbmdlIGRlZmF1bHQgY3Vyc29yIG9uIGhlYWRpbmcKCSQoc2VjX25hdl9jb250ICsgZGRfbGlua3MpLm1vdXNlb3ZlcihmdW5jdGlvbiAoKSB7CgkJdmFyIGxpbmtWYWwgPSAkKHRoaXMpLmF0dHIoImhyZWYiKTsKCQlpZiAobGlua1ZhbCA9PSB1bmRlZmluZWQgfHwgbGlua1ZhbCA9PSAiamF2YXNjcmlwdDp2b2lkKDApIikgewoJCQkkKHRoaXMpLmNzcygiY3Vyc29yIiwgImRlZmF1bHQiKTsKCQl9Cgl9KTsKCgkvL3NldCBtYXhpbXVtIGhlaWdodCBvZiBzZWMgbmF2IHRvIG1ha2UgaXQgc2Nyb2xsYWJsZQoJZnVuY3Rpb24gc2V0U2VjTmF2RHJvcGRvd25NYXhIZWlnaHQoKSB7CgkJdmFyIG1heEhlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKSAqIDAuODU7CgkJJChzZWNfbmF2X2NvbnQgKyAiID4gdWwiKS5jc3MoIm1heC1oZWlnaHQiLCBtYXhIZWlnaHQgKyAicHgiKTsKCX0KCgogICAgLy8gVG9nZ2xlIHRoZSBQU0Ygb24gbW9iaWxlCiAgICAkKCcjcHNmLWdyaXBwZXInKS5vbigndGFwIGNsaWNrIHN3aXBlbGVmdCBzd2lwZXJpZ2h0JywgZnVuY3Rpb24oKSB7CiAgICAgIC8vSW9zIHRyYW5zaXRpb24gaGFjayBmaXgKICAgICAgaWYgKCQoJyNwc2Yub3BlbicpLmxlbmd0aCkgewogICAgICAgICAgcHNmV2lkZ2V0VmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgJCgnI3BzZicpLmNzcygnLXdlYmtpdC10cmFuc2l0aW9uJywgJ3JpZ2h0IDMwMG1zIGVhc2UtaW4tb3V0Jyk7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICQoJyNwc2YnKS5yZW1vdmVBdHRyKCdzdHlsZScpOwogICAgICAgICAgICAgIC8vUmVzdG9yZSBwb3NpdGlvbiBvZiBQU0YKICAgICAgICAgICAgICBzZXRQU0ZQb3NpdGlvbigpOwogICAgICAgICAgfSwgMzAwKTsKICAgICAgICAgICQoJyNwc2Yub3BlbiAjcHNmLWdyaXBwZXIgLmljb24nKS5yZW1vdmVDbGFzcygnaWNvbi1yZ2h0JykuYWRkQ2xhc3MoJ2ljb24tbGZ0Jyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkKCcjcHNmLWdyaXBwZXIgLmljb24nKS5yZW1vdmVDbGFzcygnaWNvbi1sZnQnKS5hZGRDbGFzcygnaWNvbi1yZ2h0Jyk7CiAgICAgICAgICAvL1Jlc3RvcmUgcG9zaXRpb24gb2YgUFNGCiAgICAgICAgICBwc2ZXaWRnZXRWaXNpYmxlID0gdHJ1ZTsKICAgICAgICAgIHNldFBTRlBvc2l0aW9uKCk7CiAgICAgIH0KICAgICAgJCgnI3BzZicpLnRvZ2dsZUNsYXNzKCdvcGVuJyk7CiAgICB9KTsKCiAgICAvLzM0Mzkgc3RhcnQ6IHBvc2l0aW9uIHBzZiBhY2NvcmRpbmcgdG8gc3RlcHMgYmFyIHByZXNlbmNlIAogICAgc2V0UFNGUG9zaXRpb24oKTsKICAgIGZ1bmN0aW9uIHNldFBTRlBvc2l0aW9uKCkgewogICAgICAgIHZhciBwYWdlSWRlbnRpZmllciA9ICQoIiNwYWdlSWRlbnRpZmllciIpLnZhbCgpOwogICAgICAgIGlmICgkKHdpbmRvdykud2lkdGgoKSA8IDc3NikgewogICAgICAgICAgICBpZiAoJCgiI3N0ZXBzLWJhciIpLmlzKCI6dmlzaWJsZSIpKSB7CiAgICAgICAgICAgICAgICAkKCIjcHNmIikuY3NzKCJ0b3AiLCAiNTNweCIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJCgiI3BzZiIpLmNzcygidG9wIiwgIjBweCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocGFnZUlkZW50aWZpZXIgPT0gIm11bHRpcGxlV2FycmFudHkiIHx8IHBhZ2VJZGVudGlmaWVyID09ICJtdWx0aXBsZVdhcnJhbnR5UmVzdWx0cyIpIHsKICAgICAgICAgICAgICAgIGlmIChwc2ZXaWRnZXRWaXNpYmxlKSB7CiAgICAgICAgICAgICAgICAgICAgJCgiI3BzZiIpLmNzcygicmlnaHQiLCAiLTQxcHgiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJCgiI3BzZiIpLmNzcygicmlnaHQiLCAiLTEwMyUiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoIiNwc2YiKS5jc3MoInRvcCIsICI3MnB4Iik7CiAgICAgICAgICAgIGlmIChwYWdlSWRlbnRpZmllciA9PSAibXVsdGlwbGVXYXJyYW50eSIgfHwgcGFnZUlkZW50aWZpZXIgPT0gIm11bHRpcGxlV2FycmFudHlSZXN1bHRzIikgewogICAgICAgICAgICAgICAgJCgiI3BzZiIpLmNzcygicmlnaHQiLCAiMHB4Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy9wb3NpdGlvbiBwc2Ygb24gd2luZG93IHJlc2l6ZQogICAgJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbigpIHsKICAgICAgICBzZXRQU0ZQb3NpdGlvbigpOwogICAgfSk7CgoJLy9Nb2JpbGUgVGFicwogICAgJCgnLmhwLW5hdi10YWJzLWJnIGEnKS5vbigndGFwIGNsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICQoJy50YWItY29udGVudCcpLmFkZENsYXNzKCdvcGVuJyk7CiAgICB9KTsKCn0pOyAKJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkgewogIC8vc2Vjb25kYXJ5IG5hdmlnYXRpb24gdGV4dCB1cGRhdGUgbW9iaWxlCiAgY29uc3QgbmF2TGlua3MgPSAkKCd1bFtyb2xlPW1lbnViYXJdIGEnKTsKICBjb25zdCBwYWdlSW5mb01ldGEgPSAkKCdoZWFkIG1ldGFbbmFtZT1wYWdlaW5mb10nKTsKICBjb25zdCB1cmkgPSBwYWdlSW5mb01ldGEuZGF0YSgndXJpJyk7CiAgY29uc3QgY2MgPSBwYWdlSW5mb01ldGEuZGF0YSgnY2MnKTsKICBjb25zdCBsYyA9IHBhZ2VJbmZvTWV0YS5kYXRhKCdsYycpOwogIHZhciBsaW5rRm91bmQgPSBmYWxzZTsKCiAgLyoqICByZXBhaXIgbWljcm9zaXRlICAqKi8KICBpZigkKCIjYnRuQ29udGFjdEhQU3VwcG9ydCIpLmxlbmd0aCA+IDApewogICAgdmFyIGxpbmtDb250YWN0SFAgPSAiLyIrY2MrIi0iK2xjKyIvY29udGFjdC1ocCI7CiAgICAkKCIjYnRuQ29udGFjdEhQU3VwcG9ydCIpLmF0dHIoImhyZWYiLCBsaW5rQ29udGFjdEhQKTsKICB9CiAgaWYoJCgiI2J0blNlcnZpY2VDZW50ZXIiKS5sZW5ndGggPiAwKXsKICAgIHZhciBsaW5rU2VydmljZUNlbnRlciA9ICIvIitjYysiLSIrbGMrIi9zZXJ2aWNlLWNlbnRlciI7CiAgICAkKCIjYnRuU2VydmljZUNlbnRlciIpLmF0dHIoImhyZWYiLCBsaW5rU2VydmljZUNlbnRlcik7CiAgfQoKICAkKG5hdkxpbmtzKS5lYWNoKGZ1bmN0aW9uKGkpIHsKCWNvbnN0IGFuY2hvciA9ICQobmF2TGlua3NbaV0pOwoJdmFyIGhyZWYgPSBhbmNob3IuYXR0cignaHJlZicpOwoJaWYodHlwZW9mIGhyZWYgIT09ICd1bmRlZmluZWQnICYmIChocmVmLmluZGV4T2YoIi8iLCAwKSA+IC0xKSApewoJCWlmKGhyZWYuaW5kZXhPZigiPyIpICE9IC0xKXsKCQlocmVmID0gIGhyZWYuc3Vic3RyaW5nKDAsaHJlZi5pbmRleE9mKCI/IikpOwoJCX0KCQlpZihocmVmID09PSB1cmkgKXsKCQkJbGlua0ZvdW5kID0gdHJ1ZTsKCQkJJCgnLmhwLXNlY3Rpb24gLm5hdi10aXRsZScpLnRleHQoYW5jaG9yLnRleHQoKSsiICIpOwogICAgICAgICAgICBhbmNob3IucGFyZW50cygnbGlbcm9sZT1tZW51aXRlbV0nKS5jaGlsZHJlbignYScpLmF0dHIoJ2NsYXNzJywnYWN0aXZlJyk7CgkJfQoJfQogIH0pOwoKICBpZighbGlua0ZvdW5kKXsKICAgIGNvbnN0IHByb2R1Y3RzTGlua3MgPSAiLyIrY2MgKyAiLSIgK2xjKyIvcHJvZHVjdHMiOwogICAgY29uc3QgcHJvZHVjdHNMaW5rQW5jaG9yID0gJCgndWxbcm9sZT1tZW51YmFyXSBhW2hyZWY9IicrcHJvZHVjdHNMaW5rcysnIl0nKQogICAgJCgnLmhwLXNlY3Rpb24gLm5hdi10aXRsZScpLnRleHQocHJvZHVjdHNMaW5rQW5jaG9yLnRleHQoKSsiICIpOwogIH0KCiAgJCgiLmhwLXdjYy1jb2x1bW4tY29udHJvbCIpLnBhcmVudCgpLmFkZENsYXNzKCJjb250YWluZXIiKTsKCiAgJCgiLmJnLWNvbnRhaW5lci1ibHVlIikucmVtb3ZlQ2xhc3MoImNvbnRhaW5lciIpOwoKICAkKCIuYmctY29udGFpbmVyLWdyZXkiKS5yZW1vdmVDbGFzcygiY29udGFpbmVyIik7CgogICQoIi5iZy1jb250YWluZXItZGVmYXVsdCIpLnJlbW92ZUNsYXNzKCJjb250YWluZXIiKTsKCiAgJCgiLmhwLXdjYy1idG4tY29tcHV0aW5nLCAuaHAtd2NjLWJ0bi1wcmludGVyIikucmVtb3ZlQ2xhc3MoImJ1dHRvbiIpOwoKICAkKCIuZm9vdGVyLWJhbm5lciIpLnJlbW92ZUNsYXNzKCJjb250YWluZXIiKTsKCiAgJCgiLmhwLXdjYy10aXRsZS1oZWFkZXIgLmNtcC10aXRsZSIpLmFkZENsYXNzKCJjb250YWluZXIiKTsKCiAgLyogQ29tcHV0aW5nIFBhZ2UgKi8KICAkKCIuY29tcHV0aW5nLWhlYWRlci1idG4gLnJvdyAuY29sLXNtLTYiKS5maXJzdCgpLmFkZENsYXNzKCJidG4xIik7CiAgJCgiLmNvbXB1dGluZy1oZWFkZXItYnRuIC5yb3cgLmNvbC1zbS02IikubGFzdCgpLmFkZENsYXNzKCJidG4yIik7CgogICQoIi5vcmRlcmVkLWxpc3QtYmlvcyIpLnBhcmVudHMoKS5lcSgyKS5hZGRDbGFzcygib2xsaXN0T25lIik7CiAgJCgiLm9sbGlzdE9uZSIpLmZpbmQoIm9sIikuYXR0cigic3RhcnQiLCAiMyIpOwogICQoIi5vcmRlcmVkLWxpc3QtdXBkYXRlLWJpb3MiKS5maW5kKCJvbCIpLmF0dHIoInN0YXJ0IiwgIjMiKTsKCiAgLypGaXggSXNzdWUgUGFnZSovCiAgJCgiLmJsdWV0b290aCIpLmF0dHIoImlkIiwgImJsdWV0b290aCIpOwogICQoIi5zbG93IikuYXR0cigiaWQiLCAic2xvdyIpOwogICQoIi5zb3VuZCIpLmF0dHIoImlkIiwgInNvdW5kIik7CiAgJCgiLndpcmVsZXNzIikuYXR0cigiaWQiLCAid2lyZWxlc3MiKTsKICAkKCIuYmx1ZXNjcmVlbiIpLmF0dHIoImlkIiwgImJsdWVzY3JlZW4iKTsKICAkKCIudG91Y2hzY3JlZW4iKS5hdHRyKCJpZCIsICJ0b3VjaHNjcmVlbiIpOwogICQoIi5iYXR0ZXJ5IikuYXR0cigiaWQiLCAiYmF0dGVyeSIpOwogICQoIi5tYW5hZ2UtbG9naW4iKS5hdHRyKCJpZCIsICJtYW5hZ2UtbG9naW4iKTsKICAkKCIuc3lzcmVjb3ZlcnkiKS5hdHRyKCJpZCIsICJzeXNyZWNvdmVyeSIpOwogICQoIi5maXhJc3N1ZXNTbGVlcCIpLmF0dHIoImlkIiwgImZpeElzc3Vlc1NsZWVwIik7CiAgJCgiLmtub3duIikuYXR0cigiaWQiLCAia25vd25MaW5rIik7CgogIC8vaGlkaW5nIGNoYXRub3cgZXh0cmEgZGl2cyBmb3IgSW1wcm92ZXRhYgogICQoIi5pbXByb3ZlLXRhYi1yZW1vdmUtZWxlbWVudCIpLmhpZGUoKTsKCiAgLyogUHJpbnRlciBTZWN0aW9uICovCiAgJCgiLnByaW50ZXItaGVhZGVyLWJ0biAucm93IC5jb2wtc20tNiIpLmZpcnN0KCkuYWRkQ2xhc3MoImJ0bjEiKTsKICAkKCIucHJpbnRlci1oZWFkZXItYnRuIC5yb3cgLmNvbC1zbS02IikubGFzdCgpLmFkZENsYXNzKCJidG4yIik7CiAgJCgiLmJnLWNvbnRhaW5lci1ibHVlIikucGFyZW50KCkucmVtb3ZlQ2xhc3MoImNvbnRhaW5lciIpOwoKICAkKCIucHJpbnRlci1iYW5uZXIgLnNwb3NDYXB0aW9uIikKICAgIC5yZW1vdmVDbGFzcygic3Bvc0NhcHRpb24iKQogICAgLmFkZENsYXNzKCJib3hMQWxpZ24iKTsKICAkKCIucHJpbnRlci1iYW5uZXIgLnNwb3NCdG4iKS5yZW1vdmVDbGFzcygic3Bvc0J0biIpOwogICQoIi5wcmludGVyLWJhbm5lciAuc3Bvc0Jhbm5lciIpLnJlbW92ZUNsYXNzKCJzcG9zQmFubmVyIik7CgogICQoIi5jb21wdXRpbmctYmFubmVyIC5ib3hMQWxpZ24iKS5yZW1vdmVDbGFzcygiYm94TEFsaWduIik7CiAgJCgiLmNvbXB1dGluZy1iYW5uZXIgLmJhbm5lckJ0biIpLnJlbW92ZUNsYXNzKCJiYW5uZXJCdG4iKTsKICAkKCIuY29tcHV0aW5nLWJhbm5lciAudHJhbnNwYXJlbnQiKS5yZW1vdmVDbGFzcygidHJhbnNwYXJlbnQiKTsKCiAgLyogUHJpbnRlciBTZWN0aW9uIC0gY29ubmVjdGl2aXR5IElzc3VlIFRhYiAqLwogICQoIi5jaGF0LW5vdy1jb25uZWN0aXZpdHktaXNzdWVzIC52YS1jYWxsb3V0LXR3by1jb2wiKS5yZW1vdmVDbGFzcygKICAgICJ2YS1jYWxsb3V0LXR3by1jb2wiCiAgKTsKCiAgaWYgKCQoIi50YWJzLXByaW50ZXItbGF5b3V0IHVsIGxpIikubGVuZ3RoID09IDMpIHsKICAgICQoIi50YWJDb250YWluZXIiKS5hZGRDbGFzcygidGFibGVuZ3RoMyIpOwogIH0KCiAgLyogU2FtZSBQYWdlIGhyZWYgbmF2aWdhdGlvbiBzdXBwb3J0LWNlbnRlci1wcmludGluZyAqLwogICQoIi5wcmludGVyLWNvbXBhdGliaWxpdHktd2luMTAiKS5hdHRyKCJpZCIsICJwcmludGVyLWNvbXBhdGliaWxpdHktd2luMTAiKTsKICAkKCIuZG93bmxvYWQtbGF0ZXN0LXN3ZCIpLmF0dHIoImlkIiwgImRvd25sb2FkLWxhdGVzdC1zd2QiKTsKICAkKCIucHJpbnRlcnMtbWFudWZhY3R1cmVkLTIwMTAiKS5hdHRyKCJpZCIsICJwcmludGVycy1tYW51ZmFjdHVyZWQtMjAxMCIpOwogICQoIi5wcmludGVycy1tYW51ZmFjdHVyZWQtMjAwOSIpLmF0dHIoImlkIiwgInByaW50ZXJzLW1hbnVmYWN0dXJlZC0yMDA5Iik7CiAgJCgiLndpcmVsZXNzLW5ldHdvcmstc2V0dXAiKS5hdHRyKCJpZCIsICJ3aXJlbGVzcy1uZXR3b3JrLXNldHVwIik7CiAgJCgiLndpcmVkLW5ldHdvcmstc2V0dXAiKS5hdHRyKCJpZCIsICJ3aXJlZC1uZXR3b3JrLXNldHVwIik7CiAgJCgiLlVTQi1zZXR1cCIpLmF0dHIoImlkIiwgIlVTQi1zZXR1cCIpOwoKICAvKiBIUCBBY2NvdW50IFBhZ2UgU3RhcnRzICovCiAgJCgiLmFjY3QiKS5jaGlsZHJlbigpLmFkZENsYXNzKCJjb250YWluZXIiKTsKCiAgJCgiLmFjY291bnQtYm94IikuZmluZCgiLmNtcC1jb250YWluZXIiKS5yZW1vdmVDbGFzcygiY29udGFpbmVyIik7CgogICQoIi5sb2NhdGUtYWxsLWFjY3QtYmVuZSIpLmNoaWxkcmVuKCkuYWRkQ2xhc3MoImFjY3QtYmVuZSIpOwoKICAkKCIjaHBpZENyZWF0ZVBlcnNvbmFsQWNjdEJ0bkJvdHRvbSIpLmFkZENsYXNzKAogICAgImNyZWF0ZS1hY2N0LWJ0biBta3RnLWJ0bi1wcmltYXJ5IGFjY3QtdGV4dCIKICApOwoKICAkKCIuYmctY29udGFpbmVyLWRhcmstYmx1ZSIpLnJlbW92ZUNsYXNzKCJjb250YWluZXIiKTsKCiAgJCgiLnBlcnNvbmFsaXplZC1kYXNoYm9hcmQiKS5maW5kKCIucGFuZVNlYyIpLnJlbW92ZUNsYXNzKCJwYW5lU2VjIik7CgogICQoIi5ocC1hY2NvdW50LW5vLXRpdGxlIikucmVtb3ZlKCk7CiAgLyogSFAgQWNjb3VudCBQYWdlIEVuZHMgKi8KCiAgLyogUHJpbnQgJiBTY2FuIFN0YXJ0cyAqLwogICQoIi5iZy1jb250YWluZXItZGFyay1ncmV5IikucmVtb3ZlQ2xhc3MoImNvbnRhaW5lciIpOwoKICAkKCIuYmctY29udGFpbmVyLWRhcmstZ3JleSIpLmZpbmQoIi5yb3ciKS5hZGRDbGFzcygiY29udGFpbmVyIik7CgogICQoIi5wcmludE1pY3Jvc2l0ZUJveCIpLmZpbmQoIi5jbXAtY29udGFpbmVyIikuYWRkQ2xhc3MoImNvbnRhaW5lciIpOwoKICAkKCIucHJpbnRNaWNyb3NpdGVCb3giKS5yZW1vdmVDbGFzcygiY29udGFpbmVyIik7CgogICQoIi5wcmludC1zY2FuLWhlYWRlciIpLmZpbmQoIi5jbXAtdGV4dCIpLmFkZENsYXNzKCJjb250YWluZXIiKTsKCiAgJCgiLnByaW50LXNjYW4taGVhZGVyIikuZmluZCgiLmNtcC10ZXh0IGgyIikuYWRkQ2xhc3MoInByaW50U2NhbkgyIik7CgogICQoIi5wcmludC1zY2FuLWRvd25sb2FkLXNlY3Rpb24iKQogICAgLmZpbmQoIi5jbXAtY29udGFpbmVyIikKICAgIC5hZGRDbGFzcygidHJvdWJsZXNob290aW5nU2VjdGlvbiIpOwoKICAkKCIjZG93bmxvYWRCdG4iKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygiYnV0dG9uIik7CgogICQoIiNkb3dubG9hZE1vZGFsIikuZmluZCgiLm1vZGFsLWRpYWxvZyIpLmFkZENsYXNzKCJtb2RhbC1zbSIpOwoKICAvKiBJcyB5b3VyIHByaW50ZXIgY3VycmVudGx5IG9mZmxpbmUgKi8KICAkKCIjeWVzQnRuIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgJCgiI2ZpcnN0TW9kYWwiKS5hZGRDbGFzcygiaGlkZGVuIik7CiAgICAkKCIjc2Vjb25kTW9kYWwiKS5yZW1vdmVDbGFzcygiaGlkZGVuIik7CgogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICQoIiNkb3dubG9hZE1vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgdmFyIHBhZ2VJbmZvTWV0YSA9ICQoImhlYWQgbWV0YVtuYW1lPXBhZ2VpbmZvXSIpOwogICAgICB2YXIgY2MgPSBwYWdlSW5mb01ldGEuZGF0YSgiY2MiKTsKICAgICAgdmFyIGxjID0gcGFnZUluZm9NZXRhLmRhdGEoImxjIik7CiAgICAgIHZhciBsb2NhbGl6ZWRNaWNyb3NpdGVMaW5rID0KICAgICAgICB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKwogICAgICAgICIvLyIgKwogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ob3N0ICsKICAgICAgICAiLyIgKwogICAgICAgIGNjICsKICAgICAgICAiLSIgKwogICAgICAgIGxjICsKICAgICAgICAiLyIgKwogICAgICAgICJoZWxwL3ByaW50c2NhbmRvY3Rvci1wcmludGluZy1wcm9ibGVtcyIgKyAnI3ByaW50ZXItb2ZmbGluZSc7CiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbG9jYWxpemVkTWljcm9zaXRlTGluazsKICAgIH0sIDgwMDApOwogIH0pOwoKICAkKCIjbm9CdG4iKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAkKCIjZG93bmxvYWRNb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAkKCIubW9kYWwtYmFja2Ryb3AiKS5yZW1vdmUoKTsKICB9KTsKCiAgLyogRG93bmxvYWQgTW9kYWwgQ2xvc2UgKi8KICAkKCIuY2xvc2UiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAkKCIjZG93bmxvYWRNb2RhbCIpLmhpZGUoKTsKICAgICQoIi5tb2RhbC1iYWNrZHJvcCIpLmFkZENsYXNzKCJoaWRkZW4iKTsKICAgICQoIiNmaXJzdE1vZGFsIikucmVtb3ZlQ2xhc3MoImhpZGRlbiIpOwogICAgJCgiI3NlY29uZE1vZGFsIikuYWRkQ2xhc3MoImhpZGRlbiIpOwogIH0pOwoKICAkKCIuZG93bmxvYWRMaW5rIikucGFyZW50KCkuYXR0cigiZGF0YS10b2dnbGUiLCAibW9kYWwiKTsKCiAgLyogQWNjb3JkaWFuIENsaWNrICovCiAgJCgiLnByaW50LXNjYW4tYWNjb3JkaW9uLW1haW4gaDMiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCJ0b2dnbGVkIik7CiAgfSk7CgogICQoIi5wcmludC1zY2FuLWV0aGVybmV0LWNhYmxlIikucGFyZW50KCkuYWRkQ2xhc3MoImV0aGNhYlBhcmVudFAiKTsKCiAgJCgiLnByaW50LXNjYW4tc2hvcnRjdXQiKS5maW5kKCJvbCIpLmF0dHIoInN0YXJ0IiwgIjYiKTsKCiAgJCgiI3ByaW50c2NhbmRvY3RvciIpLmZpbmQoIi5wYW5lU2VjIikucmVtb3ZlQ2xhc3MoInBhbmVTZWMiKTsKCiAgJCgiLnByaW50LXNjYW4tZml4LXByaW50aW5nIikucGFyZW50KCkuYWRkQ2xhc3MoImZpeFByaW50aW5nQ29udGFpbmVyIik7CgogICQoIi5wcmludGVyLW9mZmxpbmUiKS5hdHRyKCJpZCIsICJwcmludGVyLW9mZmxpbmUiKTsKCiAgJCgiLnByaW50ZXItam9iLXN0dWNrIikuYXR0cigiaWQiLCAicHJpbnRlci1qb2Itc3R1Y2siKTsKCiAgJCgiLnByaW50LXNjYW4tYm9va21hcmtzIikuYXR0cigiaWQiLCAicHJpbnQtc2Nhbi1ib29rbWFya3MiKTsKCiAgLyogUHJpbnQgJiBTY2FuIEVuZHMgKi8KCiAgLyogVUFURklYICovCgogICQoIiNpc3N1ZXNDb250ZW50IC5jbXAtY29udGFpbmVyIikucmVtb3ZlQ2xhc3MoImNvbnRhaW5lciIpOwoKICAkKCIuYWRkaXRpb25hbC1zZXR1cC1pbnN0YWxsIikuYXR0cigiaWQiLCAiYWRkaXRpb25hbC1zZXR1cC1pbnN0YWxsIik7CgogICQoIiNzZXR1cENvbnRlbnQgIikKICAgIC5maW5kKCIueW91dHViZS1jb21wb25lbnQgLnBhbmVTZWMiKQogICAgLnJlbW92ZUNsYXNzKCJwYW5lU2VjIik7CgogICQoJ2FbaHJlZl49IiNrbm93biJdJykuYWRkQ2xhc3MoImtub3duTGluayIpOwogICQoIi5rbm93bkxpbmsiKS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAkKCIudGFiQ29udGFpbmVyIikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpOwogICAgJCgiI2ZpeENvbnRlbnQiKS5oaWRlKCk7CiAgICAkKCIjbGVhcm5Db250ZW50Iikuc2hvdygpOwogICAgJCgiI2xlYXJuVGFiICIpLnBhcmVudCgpLmFkZENsYXNzKCJhY3RpdmUiKTsKICAgICQoIiNsZWFybkNvbnRlbnQiKS5hZGRDbGFzcygiYWN0aXZlIik7CiAgICBkb2N1bWVudC5sb2NhdGlvbi5oYXNoID0gImtub3duTGluayI7CiAgfSk7CgogICQoIiNsZWFybkNvbnRlbnQgLmJvZHlDb250YWluZXIgLmNtcC1jb250YWluZXIiKS5yZW1vdmVDbGFzcygiY29udGFpbmVyIik7CiAgJCgiI3JlY292ZXJDb250ZW50IC5ib2R5Q29udGFpbmVyIC5jbXAtY29udGFpbmVyIikucmVtb3ZlQ2xhc3MoImNvbnRhaW5lciIpOwogICQoIiNpbXByb3ZlQ29udGVudCAuYm9keUNvbnRhaW5lciAuY21wLWNvbnRhaW5lciIpLnJlbW92ZUNsYXNzKCJjb250YWluZXIiKTsKCiAgJCgiLnRhYi1oZWFkZXItcHJpbnRlci1zZWN0aW9uICNtaWNyb3NpdGVXcmFwcGVyIikucmVtb3ZlQ2xhc3MoImNvbnRhaW5lciIpOwogICQoIiNzZXR1cENvbnRlbnQgLmJvZHlDb250YWluZXIgLmNtcC1jb250YWluZXIiKS5yZW1vdmVDbGFzcygiY29udGFpbmVyIik7CiAgJCgiI2Nvbm5lY3RDb250ZW50IC5ib2R5Q29udGFpbmVyIC5jbXAtY29udGFpbmVyIikucmVtb3ZlQ2xhc3MoImNvbnRhaW5lciIpOwoKICAkKCIucHJpbnQtc2Nhbi1maXgtc2Nhbm5pbmciKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygiY29udGFpbmVyIik7CgogIC8qKiogQ29kZSBmb3IgUmVzcG9uc2l2ZSBXaW4xMCAtIExhbmRpbmcgKiovCgogIGZ1bmN0aW9uIHJldmVyc2VCdXR0b24oeCkgewogICAgaWYgKHgubWF0Y2hlcykgewogICAgICAkKCIubGFuZGluZy1idG4tY29udGFpbmVyIC5jb2wtc20tNCIpLmluc2VydEFmdGVyKAogICAgICAgICIubGFuZGluZy1idG4tY29udGFpbmVyIC5ocC13Y2MtcnRlIgogICAgICApOwogICAgfSBlbHNlIHsKICAgICAgJCgiLmxhbmRpbmctYnRuLWNvbnRhaW5lciAuY29sLXNtLTQiKS5pbnNlcnRBZnRlcigKICAgICAgICAiLmxhbmRpbmctYnRuLWNvbnRhaW5lciAuY29sLXNtLTgiCiAgICAgICk7CiAgICB9CiAgfQoKICB2YXIgeCA9IHdpbmRvdy5tYXRjaE1lZGlhKCIobWF4LXdpZHRoOiA3NjhweCkiKTsKICByZXZlcnNlQnV0dG9uKHgpOwogIHguYWRkTGlzdGVuZXIocmV2ZXJzZUJ1dHRvbik7CgogICQod2luZG93KS5vbigicmVzaXplIiwgZnVuY3Rpb24gKGUpIHsKICAgIGNoZWNrU2NyZWVuU2l6ZSgpOwogIH0pOwoKICBjaGVja1NjcmVlblNpemUoKTsKCiAgLy9NYWtlIG1lbnViYXIgU3RpY2t5IGluIGlQYWQgYW5kIFNtYWxsIFBob25lcwogIGZ1bmN0aW9uIGNoZWNrU2NyZWVuU2l6ZSgpIHsKICAgIHZhciBuZXdXaW5kb3dXaWR0aCA9ICQod2luZG93KS53aWR0aCgpOwogICAgaWYgKG5ld1dpbmRvd1dpZHRoIDwgNzY5KSB7CiAgICAgICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBuZXdXaW5kb3dXaWR0aCA9ICQod2luZG93KS53aWR0aCgpOwogICAgICAgIGlmIChuZXdXaW5kb3dXaWR0aCA8IDc2OSkgewogICAgICAgICAgdmFyIGhlaWdodCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTsKCiAgICAgICAgICBpZiAoaGVpZ2h0ID4gMTAwKSB7CiAgICAgICAgICAgICQoIi5taWNyb3NpdGVzZWNvbmRhcnluYXZpZ2F0aW9uIikuYWRkQ2xhc3MoIm1ha2VTdGlja3kiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoIi5taWNyb3NpdGVzZWNvbmRhcnluYXZpZ2F0aW9uIikucmVtb3ZlQ2xhc3MoIm1ha2VTdGlja3kiKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy9kZXNrdG9wIHJlc28KICAgICAgICAgICQoIi5taWNyb3NpdGVzZWNvbmRhcnluYXZpZ2F0aW9uIikucmVtb3ZlQ2xhc3MoIm1ha2VTdGlja3kiKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIC8vZGV0YWNoaW5nIHNpZGVhbGVydCBmcm9tIGJvdHRvbSBhbmQgYXR0YWNoaW5nIHRvIGN1c3RvbS1kcm9wZG93bgogICAgaWYgKG5ld1dpbmRvd1dpZHRoIDwgNzY5KSB7CiAgICAgICQoIi5maXhlZFdpZGdldHMiKS5kZXRhY2goKS5hcHBlbmRUbygiLmlibVBvcnRhbENvbnRyb2wiKTsKICAgIH0gZWxzZSBpZiAobmV3V2luZG93V2lkdGggPiA3NjkpIHsKICAgICAgJCgiLmZpeGVkV2lkZ2V0cyIpLmRldGFjaCgpLmFwcGVuZFRvKCIuc2lkZS13aWRnZXQiKTsKICAgIH0KICB9CgogIC8qKiogIEhQIEFjY291dG4gRml4KioqLwoKICAkKCIubG9jYXRlLW9uZS1wbGFjZSIpLmNoaWxkcmVuKCkuYWRkQ2xhc3MoImFjY3QtYmVuZSIpOwoKICAkKCIucHJpbnRpbmctZm9vdGVyLWJhbm5lciIpLmFkZENsYXNzKCJjb250YWluZXIiKTsKCiAgJCgiLnByaW50ZXItaXNzdWVzLXN1Yi1oZWFkaW5nIikuYWRkQ2xhc3MoImhpZGRlbi1sZyIpOwoKICAkKCIjaG93VG9Vc2VUYWJfYm94IC5ib2R5Q29udGFpbmVyIC5jbXAtY29udGFpbmVyIikucmVtb3ZlQ2xhc3MoImNvbnRhaW5lciIpOwoKICAkKCIuZml4UHJpbnRpbmdDb250YWluZXIiKS5yZW1vdmVDbGFzcygiY29udGFpbmVyIik7CgogICAkKCJhLnNwb3NCYW5uZXJQcmludGluZyIpLmFkZENsYXNzKCJsb2NhbGl6ZS11cmwiKTsKCiAgdXBkYXRlTG9jYWxpemVVUkwoKTsKICBnZXRTUE9TTG9jYWxpemVkTGluaygpOwoKICAkKCIucHJpbnQtc2Nhbi1hY2NvcmRpb24tbWFpbiAuY21wLWFjY29yZGlvbiBkaXYiKS5hZGRDbGFzcygKICAgICJzZWN0aW9uIGV4cGFuZGFibGUiCiAgKTsKICAkKCIucHJpbnQtc2Nhbi1hY2NvcmRpb24tbWFpbiAuY21wLWFjY29yZGlvbiBkaXYgaDIiKS5hZGRDbGFzcygKICAgICJleHBhbmRhYmxlSGVhZGluZyIKICApOwoKICAkKCIuY29tcHV0aW5nLXRvcC1idG4tYm94IikuYWRkQ2xhc3MoImNvbnRhaW5lciIpOwoKICAkKCIubGFuZGluZy1idG4tY29udGFpbmVyIikucmVtb3ZlQ2xhc3MoImNvbnRhaW5lciIpOwoKICAkKCIuY29tcHV0aW5nLXRvcC1idG4tYm94IikuYWRkQ2xhc3MoImNvbnRhaW5lciIpOwoKICAkKCIjaHBpZEV4aXN0aW5nQWNjdFNpZ25JbkJ0biIpLmFkZENsYXNzKCJta3RnLWJ0bi1zZWNvbmRhcnkiKTsKCiAgJCgiLmNvbXB1dGluZy1oZWFkZXItYnRuIC5ocC13Y2MtYnRuLWNvbXB1dGluZyBidXR0b24iKS5hdHRyKAogICAgInRhYmluZGV4IiwKICAgICItMSIKICApOwoKICAkKCIucHJpbnRlci1oZWFkZXItYnRuIC5ocC13Y2MtYnRuLXByaW50ZXIgYnV0dG9uIikuYXR0cigidGFiaW5kZXgiLCAiLTEiKTsKCiAgLy9NYWtlIFRhYiBGb2N1cyB0byBDb250ZW50IHRoYW4gZm9vdGVyIGZvciBmaXJzdCB0aW1lCiAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAkKCIjZm9vdGVyIFt0YWJpbmRleF0iKS5yZW1vdmVBdHRyKCJ0YWJpbmRleCIpOwogIH0sIDMwMDApOwoKICAvLyBQYXVzZSB5b3V0dWJlIHZpZGVvIG9uIHRhYiBjaGFuZ2UKICAkKCdhW2RhdGEtdG9nZ2xlPSJ0YWIiXScpLm9uKCJzaG93bi5icy50YWIiLCBmdW5jdGlvbiAoZSkgewogICAgaWYgKHdpbmRvdy5jYyA9PSAiY24iKSB7CiAgICAgICQuZWFjaCh2aWRlb2pzLnBsYXllcnMsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgdmlkZW9qcyhwKS5wYXVzZSgpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBpZnJhbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJpZnJhbWUiKTsKICAgICAgaWYgKGlmcmFtZSAhPT0gbnVsbCkgewogICAgICAgIHZhciBpZnJhbWVTcmMgPSBpZnJhbWUuc3JjOwogICAgICAgIHZhciBzcmMgPSBpZnJhbWVTcmMucmVwbGFjZSgiYXV0b3BsYXk9MSIsICJhdXRvcGxheT0wIik7CiAgICAgICAgaWZyYW1lLnNyYyA9IHNyYzsKICAgICAgfQogICAgfQogIH0pOwoKICAvL1JlbW92ZSBPdXRsaW5lIG9uIGNsaWNrIGFjY29yZGlhbiBpbiBwcmludHNjYW5kb2N0b3IKICAkKCIuZXhwYW5kYWJsZUhlYWRpbmcgYnV0dG9uIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgJCh0aGlzKS5jc3MoIm91dGxpbmUtd2lkdGgiLCAiMHB4Iik7CgogICAgJCh0aGlzKS5mb2N1cyhmdW5jdGlvbiAoKSB7CiAgICAgICQodGhpcykuY3NzKCJvdXRsaW5lLXdpZHRoIiwgIjFweCIpOwogICAgfSk7CiAgfSk7CgoKICAgIC8vUmVtb3ZlIE91dGxpbmUgb24gY2xpY2sgQ2hpbGQtYWNjb3JkaWFuIGluIHByaW50c2NhbmRvY3RvcgogICAgJCgiLnByaW50LXNjYW4taW5uZXItYWNjb3JkaW9uIGJ1dHRvbiIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAkKHRoaXMpLmNzcygib3V0bGluZS13aWR0aCIsICIwcHgiKTsKICAgICAgICAkKHRoaXMpLmZvY3VzKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICQodGhpcykuY3NzKCJvdXRsaW5lLXdpZHRoIiwgIjFweCIpOwogICAgICAgIH0pOwogICAgIH0pOwoKCiAgIC8vUHJpbnRTY2FuRHIgLSBGaXhQcmludGluZwogICAkKCIucHJpbnQtc2Nhbi1maXgtcHJpbnRpbmcgYSIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAkKHRoaXMpLnBhcmVudHMoJ3VsJykuZmluZCgnbGkgYScpLnJlbW92ZUNsYXNzKCdhY3RpdmVsaW5rJyk7CiAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnYWN0aXZlbGluaycpOwoKICAgfSk7CgogICAgLy9QcmludFNjYW5EciAtIEZpeFByaW50aW5nIC0gcmVtb3ZpbmcgYWN0aXZlIGNsYXNzCiAgICAkKGRvY3VtZW50KS5vbigiY2xpY2siLCBmdW5jdGlvbihlKSB7CiAgICAgICAgJCgiLnByaW50LXNjYW4tZml4LXByaW50aW5nIGEiKS5yZW1vdmVDbGFzcygnYWN0aXZlbGluaycpOwogICAgfSk7CgoKICAgLy9IcC1BY2NvdW50IFRleHQgUmV2ZXJzZSBmb3IgQ291bnRyeSBJc3JhZWwgCiAgIGlmKGxjID09ICdoZScgfHwgbGMgPT0gJ2FyJyl7CiAgICAgICAkKCcubWt0Zy1oZXJvIHAnKS5hZGRDbGFzcygncmV2ZXJzZUltZycpOwogICAgICAgJCgnLmxvY2F0ZS1hbGwtYWNjdC1iZW5lIC5yb3cnKS5hZGRDbGFzcygncmV2ZXJzZURpdicpOwogICAgICAgJCgnLmxvY2F0ZUFsbEltZyBpbWcnKS5hZGRDbGFzcygncmV2ZXJzZUltZycpOwogICAgICAgJCgnLmFjY3QgLmNvbnRhaW5lcicpLmFkZENsYXNzKCdyZXZlcnNlRGl2Jyk7CiAgICAgICAkKCcubG9jYXRlLW9uZS1wbGFjZSAucm93JykuYWRkQ2xhc3MoJ3JldmVyc2VEaXYnKTsKICAgICAgICQoJy5hY2Nlc3NBY291bnRBbnl3aGVyZScpLmFkZENsYXNzKCdyZXZlcnNlSW1nJyk7CiAgICAgICAkKCcucGVyc29uYWxpemVkLWRhc2hib2FyZCAucm93JykuYWRkQ2xhc3MoJ3JldmVyc2VEaXYnKTsKICAgICAgICQoJy5hY2N0LWJvdHRvbS1iYW5uZXIgLmNvbnRhaW5lcicpLmFkZENsYXNzKCdyZXZlcnNlRGl2Jyk7CiAgICAgICAkKCcuY291bnRyeVNlbGVjdG9yJykuYWRkQ2xhc3MoJ2NzcHVsbFJpZ2h0Jyk7CiAgICAgICAkKCcuaHAtbG9jYXRlLWFsbCBkaXYnKS5hZGRDbGFzcygnY29sb3VtblJldmVyc2UnKTsKICAgICAgICQoJy5ocC1sb2NhdGUtYWxsIGRpdiBwJykuYWRkQ2xhc3MoJ2FkZEV4dHJhTWFyZ2luJyk7CiAgICAgICAkKCcubG9jYXRlLW9uZS1wbGFjZSAuY21wLXRleHQnKS5hZGRDbGFzcygnY29sb3VtblJldmVyc2UnKTsKICAgICAgICQoJy5sb2NhdGUtb25lLXBsYWNlIC5jbXAtdGV4dCBoMycpLmFkZENsYXNzKCdhZGRFeHRyYU1hcmdpbnRvcCcpOwogICAgICAgJCgnLmxvY2F0ZS1hbGwtYWNjdC1iZW5lIC5jbXAtdGV4dCcpLmFkZENsYXNzKCdjb2xvdW1uUmV2ZXJzZScpOwogICAgICAgJCgnLnBlcnNvbmFsaXplZC1kYXNoYm9hcmQgLmNtcC10ZXh0JykuYWRkQ2xhc3MoJ2NvbG91bW5SZXZlcnNlJyk7CiAgICAgICAkKCcucHJpbnRlckltZyBpbWcnKS5hZGRDbGFzcygncmV2ZXJzZUltZycpOwogICAgICAgJCgnLm1hbnktdXNlcy1pbWcgaW1nJykuYWRkQ2xhc3MoJ3JldmVyc2VJbWcnKTsKICAgICAgICQoJy5ocC1hY2NvdW50LWZvb3Rlci1ib3ggaW1nJykuYWRkQ2xhc3MoJ3JldmVyc2VJbWcnKTsKICAgICAgICQoJy5wZXJzb25hbGl6ZWQtZGFzaGJvYXJkIC55b3V0dWJlLWNvbXBvbmVudCcpLmFkZENsYXNzKCdyZXZlcnNlSW1nJyk7CiAgICAgICAkKCcuYWNjb3VudC1ib3ggLnNlY3Rpb24taGVhZCBoMicpLmFkZENsYXNzKCdyZXZlcnNlRGl2Jyk7CiAgICAgICAkKCcubWVudUJhckhlYWQnKS5hZGRDbGFzcygnbWVudVJldmVyc2UnKTsKICAgfSAgICAgCgoKCgoKICAvKioqKioqIERvYyByZWFkeSBFbmQgICoqKioqKi8KfSk7CgpmdW5jdGlvbiB1cGRhdGVMb2NhbGl6ZVVSTCgpIHsKICBjb25zdCBjbGFzc05hbWUgPSAiLmxvY2FsaXplLXVybCI7CiAgY29uc3QgbG9jYWxpemVBbmNob3JzID0gJChjbGFzc05hbWUpOwogICQobG9jYWxpemVBbmNob3JzKS5lYWNoKGZ1bmN0aW9uIChpKSB7CiAgICBjb25zdCBhbmNob3JUYWcgPSAkKHRoaXMpOwogICAgY29uc3QgcGFnZUluZm9NZXRhID0gJCgiaGVhZCBtZXRhW25hbWU9cGFnZWluZm9dIik7CiAgICBjb25zdCBjYyA9IHBhZ2VJbmZvTWV0YS5kYXRhKCJjYyIpOwogICAgY29uc3QgbGMgPSBwYWdlSW5mb01ldGEuZGF0YSgibGMiKTsKICAgIHZhciBsb2NhbGl6ZUFuY2hvckRvbSA9IGFuY2hvclRhZy5jbG9zZXN0KCJhIik7CiAgICB2YXIgbGluayA9IGxvY2FsaXplQW5jaG9yRG9tLmF0dHIoImhyZWYiKTsKICAgIHZhciBsb2NhbGl6ZWRNU0xpbms7CiAgICBpZiAodHlwZW9mIGxpbmsgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIGxvY2FsaXplQW5jaG9yRG9tID0gJCh0aGlzKS5jaGlsZHJlbigiOmZpcnN0Iik7CiAgICAgIGxpbmsgPSBsb2NhbGl6ZUFuY2hvckRvbS5hdHRyKCJocmVmIik7CiAgICB9CiAgICAvL2ZvciBleHRlcm5hbCBIUCBsaW5rcwogICAgaWYgKGxpbmsuaW5kZXhPZigiaHR0cHM6Ly8iKSA+IC0xIHx8IGxpbmsuaW5kZXhPZigiaHR0cDovLyIpID4gLTEpIHsKICAgICAgbGluayA9IGxpbmsucmVwbGFjZSgiL3VzLyIsICIvIiArIGxjICsgIi8iKTsKICAgICAgbGluayA9IGxpbmsucmVwbGFjZSgiL2VuLyIsICIvIiArIGNjICsgIi8iKTsKICAgICAgbG9jYWxpemVkTVNMaW5rID0gbGluazsKICAgIH0gZWxzZSB7CiAgICAgIGxpbmsgPSBsaW5rLnJlcGxhY2UoIiMiLCAiIik7CiAgICAgIGxvY2FsaXplZE1TTGluayA9ICIvIiArIGNjICsgIi0iICsgbGMgKyAiLyIgKyBsaW5rOwogICAgfQoKICAgIGxvY2FsaXplQW5jaG9yRG9tLmF0dHIoImhyZWYiLCBsb2NhbGl6ZWRNU0xpbmspOwogIH0pOwp9CgpmdW5jdGlvbiBnZXRTUE9TTG9jYWxpemVkTGluaygpIHsKICAgIHZhciBzdG9yZURvbWFpbiA9IiI7Cgl2YXIgc3RvcmVOYW1lID0iIjsKCXZhciBzcG9zQmFubmVyVHlwZT0iIjsKCWNvbnN0IHBhZ2VJbmZvTWV0YSA9ICQoJ2hlYWQgbWV0YVtuYW1lPXBhZ2VpbmZvXScpOwogICAgY29uc3QgY2MgPSBwYWdlSW5mb01ldGEuZGF0YSgnY2MnKTsKICAgIGNvbnN0IGxjID0gcGFnZUluZm9NZXRhLmRhdGEoJ2xjJyk7CgoJc3dpdGNoIChjYykgewoJCWNhc2UgInVzIjoKCQkJc3RvcmVOYW1lID0gY2MgKyAiLyIgKyBsYzsKCQkJc3RvcmVEb21haW4gPSJzdG9yZS5ocC5jb20iOwoJCQlzcG9zQmFubmVyVHlwZT0ic2xwL3dlZWtseS1kZWFscy90b3AtZGVhbHM/IjsKCQkJYnJlYWs7CgoJCWNhc2UgImNhIjoKCQkJc3RvcmVOYW1lID0iQ2FuYWRhU3RvcmUiOwoJCQlzdG9yZURvbWFpbiA9InN0b3JlLmhwLmNvbSI7CgkJCXNwb3NCYW5uZXJUeXBlID0iTWVyY2gvT2ZmZXIuYXNweD9wPWMtaHAtY2FuYWRhLWxhcHRvcHMtZGVza3RvcHMtcHJpbnRlcnMtZGVhbHMmbGFuZz1lbi1DQSYiOwoJCQlicmVhazsKCgkJY2FzZSAiZ2IiOgoJCQlzdG9yZU5hbWUgPSJVS1N0b3JlIjsKCQkJc3RvcmVEb21haW4gPSJzdG9yZS5ocC5jb20iOwoJCQlzcG9zQmFubmVyVHlwZSA9Ik1lcmNoL09mZmVyLmFzcHg/cD1jLWxhdGVzdC1sYXB0b3Atb2ZmZXJzJiI7CgkJCWJyZWFrOwoKCQljYXNlICJhdSI6CgkJCXN0b3JlRG9tYWluID0iaDIwMzg2Lnd3dzIuaHAuY29tIjsKCQkJc3RvcmVOYW1lID0iQXVzdHJhbGlhU3RvcmUiOwoJCQlzcG9zQmFubmVyVHlwZSA9Ik1lcmNoL29mZmVyLmFzcHg/IjsKCQkJYnJlYWs7CgoJCWNhc2UgImVzIjoKCQkJc3RvcmVOYW1lID0iU3BhaW5TdG9yZSI7CgkJCXN0b3JlRG9tYWluID0ic3RvcmUuaHAuY29tIjsKCQkJc3Bvc0Jhbm5lclR5cGUgPSJNZXJjaC9vZmZlci5hc3B4P3A9Yy1vZmVydGFzLXBvcnRhdGlsZXMmIjsKCQkJYnJlYWs7CgoJCSAgY2FzZSAibmwiOgoJCQlzdG9yZU5hbWUgPSJOZXRoZXJsYW5kc1N0b3JlIjsKCQkJc3RvcmVEb21haW4gPSJzdG9yZS5ocC5jb20iOwoJCQlzcG9zQmFubmVyVHlwZSA9Ik1lcmNoL09mZmVyLmFzcHg/cD1jLWxhcHRvcC1hYW5iaWVkaW5nZW4mIjsKCQkJYnJlYWs7CgoJCSAgY2FzZSAiZnIiOgoJCQlzdG9yZU5hbWUgPSJGcmFuY2VTdG9yZSI7CgkJCXN0b3JlRG9tYWluID0ic3RvcmUuaHAuY29tIjsKCQkJc3Bvc0Jhbm5lclR5cGUgPSJNZXJjaC9PZmZlci5hc3B4P3A9Yy1vZmZyZXMtcGMtcG9ydGFibGVzJiI7CgkJCWJyZWFrOwoKCQkgIGNhc2UgImRlIjoKCQkJc3RvcmVOYW1lID0iR2VybWFueVN0b3JlIjsKCQkJc3RvcmVEb21haW4gPSJzdG9yZS5ocC5jb20iOwoJCQlzcG9zQmFubmVyVHlwZSA9Ik1lcmNoL09mZmVyLmFzcHg/cD10b3AtYW5nZWJvdGUmIjsKCQkJYnJlYWs7CgoJCSAgIGNhc2UgImpwIjoKCQkJc3RvcmVOYW1lID0iZGlyZWN0cGx1cyI7CgkJCXN0b3JlRG9tYWluID0ianAuZXh0LmhwLmNvbSI7CgkJCXNwb3NCYW5uZXJUeXBlID0icGVyc29uYWwvPyI7CgkJCWJyZWFrOwoKCQkgICBjYXNlICJjbiI6CgkJCXN0b3JlTmFtZSA9Ind3dy5ocHN0b3JlLmNuIjsKCQkJc3RvcmVEb21haW4gPSIiOwoJCQlzcG9zQmFubmVyVHlwZSA9Ij8iOwoJCQlicmVhazsKCgkJICBjYXNlICJzZyI6IGNhc2UgIm15IjogY2FzZSAiaWQiOiBjYXNlICJ0aCI6IGNhc2UgImluIjogY2FzZSAiaGsiOiBjYXNlICJrciI6CgkJCXN0b3JlTmFtZSA9IGNjICsgIi0iICsgbGM7CgkJCXN0b3JlRG9tYWluID0ic3RvcmUuaHAuY29tIjsKCQkJc3Bvc0Jhbm5lclR5cGUgPSJkZWZhdWx0L3Byb21vdGlvbi9vZmZlcj8iOwoJCQlicmVhazsKCQl9CgoJCXZhciBTUE9TTG9jYWxpemVkTGluayA9IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICIvLyIgKyBzdG9yZURvbWFpbiArICIvIiArIHN0b3JlTmFtZSArICIvIiArIHNwb3NCYW5uZXJUeXBlICsgImp1bXBpZD1yZV9yMTE4MzlfIiArIGNjICsgIi8iICsgbGMgKyAiL3dlZWtseS1kZWFscy93aW4xMG1pY3Jvc2l0ZSZ1dG1fbWVkaXVtPUhQV2ViJnV0bV9zb3VyY2U9aHBzdXBwb3J0JnV0bV9jYW1wYWlnbj13ZWVrbHlkZWFscyZ1dG1fY29udGVudD13aW4xMG1pY3Jvc2l0ZSI7CiAgICAgICAgJCgiI3Nwb3NCYW5uZXJXaW4xMENsaWNrIikuYXR0cigiaHJlZiIsU1BPU0xvY2FsaXplZExpbmspOwp9Ci8qKiAgcmVwYWlyIG1pY3Jvc2l0ZSAgKiovCgpjb25zdCByY0hvc3QgPSBnZXRFbnZyaW9ubWVudFJlcGFpckNlbnRlcigpOwpjb25zdCByc0hvc3QgPSAiaHR0cHM6Ly9nbmNwZ3NsYnBybzEuaG91c3Rvbi5ocC5jb20vQ3NvX1N0YXR1cy9Dc29TdGF0dXMuYXNweCI7CgpmdW5jdGlvbiBnZXRFbnZyaW9ubWVudFJlcGFpckNlbnRlcigpewogICAgbGV0IHJlY0hvc3QgPSAiIjsKICAgIGxldCBoID0gIiI7CiAgICB0cnl7CiAgICAgICAgaCA9IGxvY2F0aW9uLmhvc3Q7CiAgICB9Y2F0Y2goZSl7fQoKICAgIGlmKC9sb2NhbGhvc3QvLnRlc3QoaCkpewogICAgICAgIHJlY0hvc3QgPSAiaHR0cHM6Ly9zdXBwb3J0LmhwLmNvbSI7CiAgICB9ZWxzZSBpZiAoL3VhdC8udGVzdChoKSl7CiAgICAgICAgcmVjSG9zdCA9ICJodHRwczovL3VhdC5zdXBwb3J0LmhwLmNvbSI7CiAgICB9ZWxzZXsKICAgICAgICByZWNIb3N0ID0gImh0dHBzOi8vc3VwcG9ydC5ocC5jb20iOwogICAgfQogICAgcmV0dXJuIHJlY0hvc3Q7Cn0KCmZ1bmN0aW9uIHNldFJlcGFpckxpbmtzKHApewogICAgaWYoJCgiI2J0bkNvbnRhY3RIUFN1cHBvcnQiKS5sZW5ndGggPiAwKXsKICAgICAgICB2YXIgbGlua0NvbnRhY3RIUCA9IHJjSG9zdCArICIvIitwWzBdKyItIitwWzFdKyIvY29udGFjdC1ocCI7CiAgICAgICAgJCgiI2J0bkNvbnRhY3RIUFN1cHBvcnQiKS5hdHRyKCJocmVmIiwgbGlua0NvbnRhY3RIUCk7CiAgICB9CgogICAgaWYoJCgiI2J0blNlcnZpY2VDZW50ZXIiKS5sZW5ndGggPiAwKXsKICAgICAgICB2YXIgbGlua1NlcnZpY2VDZW50ZXIgPSByY0hvc3QgKyAiLyIrcFswXSsiLSIrcFsxXSsiL3NlcnZpY2UtY2VudGVyIjsKICAgICAgICAkKCIjYnRuU2VydmljZUNlbnRlciIpLmF0dHIoImhyZWYiLCBsaW5rU2VydmljZUNlbnRlcik7CiAgICB9Cn0KCmZ1bmN0aW9uIHNldFRhYkNvbXBvbmVudENvbnRlbnRMaW5rcyhwKXsKICAgIC8vdGhlc2UgbGlua3MgYXJlIGVtYmVkZGVkIGluIHRhYnMgYnMgdGFicyBhbmQgc28gbmVlZCB0byBiZSBzZXQgYWZ0ZXIgdGFiIGlzIGV4cG9zZWQgYW5kIGNvbXBvbmVudCBjb250ZW50IGlzIHJlbmRlcmVkIC0tIHRoaXMgaXMgYSBoYWNrCiAgICBpZigkKCIjbG5rSHBQY0hhcmR3YXJlRGlhZ1NpdGUiKS5sZW5ndGggPiAwKXsKICAgICAgICB2YXIgbGlua1BDSGFyZHdhcmVEaWFnU2l0ZSA9ICJodHRwczovL3d3dzguaHAuY29tLyIrcFswXSsiLyIrcFsxXSsiL2NhbXBhaWducy9ocHN1cHBvcnRhc3Npc3RhbnQvcGMtZGlhZ3MuaHRtbCI7CiAgICAgICAgJCgiI2xua0hwUGNIYXJkd2FyZURpYWdTaXRlIikuYXR0cigiaHJlZiIsIGxpbmtQQ0hhcmR3YXJlRGlhZ1NpdGUpOwogICAgfQoKICAgIGlmKCQoIiNidG5QcmludFRzIikubGVuZ3RoID4gMCl7CiAgICAgICAgdmFyIGxpbmtEaWFnU2l0ZVByaW50aW5nID0gcmNIb3N0ICsgIi8iK3BbMF0rIi0iK3BbMV0rIi90b3BpYy9kaWFnbm9zdGljcz9jYXRlZ29yeT1wcmludGluZyI7CiAgICAgICAgJCgiI2J0blByaW50VHMiKS5hdHRyKCJocmVmIiwgbGlua0RpYWdTaXRlUHJpbnRpbmcpOwogICAgfQoKICAgIGlmKCQoIiNidG5QY1RzIikubGVuZ3RoID4gMCl7CiAgICAgICAgdmFyIGxpbmtEaWFnU2l0ZUNvbXB1dGluZyA9IHJjSG9zdCArICIvIitwWzBdKyItIitwWzFdKyIvdG9waWMvZGlhZ25vc3RpY3M/Y2F0ZWdvcnk9Y29tcHV0aW5nIjsKICAgICAgICAkKCIjYnRuUGNUcyIpLmF0dHIoImhyZWYiLCBsaW5rRGlhZ1NpdGVDb21wdXRpbmcpOwogICAgfQoKICAgIGlmKCQoIiNidG5DaGVja1JlcGFpclN0YXR1cyIpLmxlbmd0aCA+IDApewogICAgICAgIHZhciBsaW5rQ2hlY2tSZXBhaXJTdGF0dXMgPSByc0hvc3QgKyAiP2xjPSIrcFsxXSArIiZjYz0iK3BbMF07CiAgICAgICAgJCgiI2J0bkNoZWNrUmVwYWlyU3RhdHVzIikuYXR0cigiaHJlZiIsIGxpbmtDaGVja1JlcGFpclN0YXR1cyk7CiAgICB9Cn0KCgokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7CiAgICBjb25zdCBwYWdlSW5mb01ldGFSZXBhaXJDZW50ZXIgPSAkKCdoZWFkIG1ldGFbbmFtZT1wYWdlaW5mb10nKTsKICAgIGNvbnN0IGNjUkMgPSBwYWdlSW5mb01ldGFSZXBhaXJDZW50ZXIuZGF0YSgnY2MnKTsKICAgIGNvbnN0IGxjUkMgPSBwYWdlSW5mb01ldGFSZXBhaXJDZW50ZXIuZGF0YSgnbGMnKTsKICAgICQoJ2FbZGF0YS10b2dnbGU9InRhYiJdJykub24oJ3Nob3duLmJzLnRhYicsIGZ1bmN0aW9uICgpIHsKICAgICAgICBzZXRUYWJDb21wb25lbnRDb250ZW50TGlua3MoW2NjUkMsbGNSQ10pOwogICAgfSk7CiAgICBzZXRSZXBhaXJMaW5rcyhbY2NSQyxsY1JDXSk7Cn0pOwokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7CiAgJCgiLm9yZGVyZWQtbGlzdC1zdGFydC00IikuZmluZCgib2wiKS5hdHRyKCJzdGFydCIsICI0Iik7CiAgJCgiLnBzZi1oZWFkZXIiKS5maW5kKCIuY21wLXRleHQiKS5hZGRDbGFzcygiY29udGFpbmVyIik7CgogICQoIi5wc2YtaGVhZGVyIikuZmluZCgiLmNtcC10ZXh0IGgyIikuYWRkQ2xhc3MoInBzZmgyIik7ICAgIAogICQoIi5ib3R0b20tYmFubmVyIikuZmluZCgiLnJvdyIpLmFkZENsYXNzKCJjb250YWluZXIiKTsgICAgCiAgJCgiLndpbmRvd3Njb250YWluZXIiKS5maW5kKCIuY21wLWNvbnRhaW5lciIpLnJlbW92ZUNsYXNzKCJjb250YWluZXIiKTsKICAkKCIubWFjY29udGFpbmVyIikuZmluZCgiLmNtcC1jb250YWluZXIiKS5yZW1vdmVDbGFzcygiY29udGFpbmVyIik7ICAgIAogICQoIi5ob3dUb1RpbGVzQ29udGFpbmVyIikucmVtb3ZlQ2xhc3MoImNvbnRhaW5lciIpOyAgICAKICAkKCIjaG93VG9QcmludCAuaG93VG9UaWxlcyIpLmZpcnN0KCkuYXR0cigiaWQiLCAiaG93VG9TZWN0aW9uIik7CiAgJCgiI2hvd1RvUHJpbnQgLm1hY2NvbnRhaW5lciAuaG93VG9UaWxlcyIpLmZpcnN0KCkuYXR0cigiaWQiLCAiaG93VG9TZWN0aW9uTWFjIik7ICAgIAogICQoIiNob3dUb1ByaW50IC5ib3R0b20tYmFubmVyIikuYXR0cigiaWQiLCAidHJvdWJsZXNob290aW5nU2VjdGlvbiIpOyAgICAKCi8veW91dHViZSBhbmQgYXBwbGUgbGlua3Mgb24gaG93IHRvIHNjYW4gcGFnZSAoYm90aCB3aW5kb3dzIGFuZCBtYWMpCgoJCXZhciBZb3V0dWJlTGlua1dpbiA9ICcnOwoJCXZhciBZb3V0dWJlTGlua01hYyA9ICcnOyAgCiAgICAJY29uc3QgcGFnZUluZm9NZXRhID0gJCgiaGVhZCBtZXRhW25hbWU9cGFnZWluZm9dIik7ICAgIAogICAgICAJdmFyIGxjID0gcGFnZUluZm9NZXRhLmRhdGEoImxjIik7CiAgICAJdmFyIGNjID0gcGFnZUluZm9NZXRhLmRhdGEoImNjIik7CiAgICAJdmFyIGFwcGxlTGluayA9ICdodHRwczovL2l0dW5lcy5hcHBsZS5jb20vJyArICBjYyArICcvYXBwL2hwLWVhc3ktc2Nhbi9pZDk2NzAwNDg2MSc7CgkJJCgnI2FwcGxlTGluaycpLmF0dHIoJ2hyZWYnLCBhcHBsZUxpbmspOwoKCQlzd2l0Y2ggKGxjKXsKCQkJY2FzZSAncnUnOgoJCQlZb3V0dWJlTGlua1dpbiA9ICdodHRwOi8veW91dHUuYmUvRWZJMXozRWpxdFEnOwoJCQlZb3V0dWJlTGlua01hYyA9ICdodHRwOi8veW91dHUuYmUvQWE4X1prSnFjcUUnOwoJCQkkKCcjeW91dHViZV93aW5kb3dzJykuYXR0cignaHJlZicsIFlvdXR1YmVMaW5rV2luKTsKCQkJJCgnI3lvdXR1YmVfbWFjJykuYXR0cignaHJlZicsIFlvdXR1YmVMaW5rTWFjKTsKCQkJYnJlYWs7CgoJCQljYXNlICdrbyc6CgkJCVlvdXR1YmVMaW5rV2luID0gJ2h0dHA6Ly95b3V0dS5iZS80YWx4aDAxR1Ntcyc7CgkJCVlvdXR1YmVMaW5rTWFjID0gJ2h0dHA6Ly95b3V0dS5iZS8yUGU1d0xQWWU0byc7CgkJCSQoJyN5b3V0dWJlX3dpbmRvd3MnKS5hdHRyKCdocmVmJywgWW91dHViZUxpbmtXaW4pOwoJCQkkKCcjeW91dHViZV9tYWMnKS5hdHRyKCdocmVmJywgWW91dHViZUxpbmtNYWMpOwoJCQlicmVhazsKCgkJCWNhc2UgJ2phJzoKCQkJWW91dHViZUxpbmtXaW4gPSAnaHR0cDovL3lvdXR1LmJlLzhOMlVIS2lIa1A0JzsKCQkJWW91dHViZUxpbmtNYWMgPSAnaHR0cDovL3lvdXR1LmJlL2pGS0lBOXYxSUNnJzsKCQkJJCgnI3lvdXR1YmVfd2luZG93cycpLmF0dHIoJ2hyZWYnLCBZb3V0dWJlTGlua1dpbik7CgkJCSQoJyN5b3V0dWJlX21hYycpLmF0dHIoJ2hyZWYnLCBZb3V0dWJlTGlua01hYyk7CgkJCWJyZWFrOwoKCQkJY2FzZSAnemgnOgoJCQlZb3V0dWJlTGlua1dpbiA9ICdodHRwczovL3lvdXR1LmJlL2EtbUgxdlpERndVJzsKCQkJWW91dHViZUxpbmtNYWMgPSAnaHR0cHM6Ly95b3V0dS5iZS9CUkFQYnRFV3d0QSc7CgkJCSQoJyN5b3V0dWJlX3dpbmRvd3MnKS5hdHRyKCdocmVmJywgWW91dHViZUxpbmtXaW4pOwoJCQkkKCcjeW91dHViZV9tYWMnKS5hdHRyKCdocmVmJywgWW91dHViZUxpbmtNYWMpOwoJCQlicmVhazsKCgkJCWNhc2UgJ2RlJzoKCQkJWW91dHViZUxpbmtXaW4gPSAnaHR0cHM6Ly95b3V0dS5iZS8tTTM1alEwZjZjNCc7CgkJCVlvdXR1YmVMaW5rTWFjID0gJ2h0dHBzOi8veW91dHUuYmUvV0VKUy00ZXFkVW8nOwoJCQkkKCcjeW91dHViZV93aW5kb3dzJykuYXR0cignaHJlZicsIFlvdXR1YmVMaW5rV2luKTsKCQkJJCgnI3lvdXR1YmVfbWFjJykuYXR0cignaHJlZicsIFlvdXR1YmVMaW5rTWFjKTsKCQkJYnJlYWs7CgoJCQljYXNlICdlcyc6CgkJCVlvdXR1YmVMaW5rV2luID0gJ2h0dHBzOi8veW91dHUuYmUvdnd0SXlPYWZ0YVEnOwoJCQlZb3V0dWJlTGlua01hYyA9ICdodHRwczovL3lvdXR1LmJlL2VMNmxDdFp3Z1F3JzsKCQkJJCgnI3lvdXR1YmVfd2luZG93cycpLmF0dHIoJ2hyZWYnLCBZb3V0dWJlTGlua1dpbik7CgkJCSQoJyN5b3V0dWJlX21hYycpLmF0dHIoJ2hyZWYnLCBZb3V0dWJlTGlua01hYyk7CgkJCWJyZWFrOwoKCQkJY2FzZSAnZnInOgoJCQlZb3V0dWJlTGlua1dpbiA9ICdodHRwczovL3lvdXR1LmJlL0k5TTI2UTQwdnBjJzsKCQkJWW91dHViZUxpbmtNYWMgPSAnaHR0cHM6Ly95b3V0dS5iZS9GZTZmeTVtZ1NtZyc7CgkJCSQoJyN5b3V0dWJlX3dpbmRvd3MnKS5hdHRyKCdocmVmJywgWW91dHViZUxpbmtXaW4pOwoJCQkkKCcjeW91dHViZV9tYWMnKS5hdHRyKCdocmVmJywgWW91dHViZUxpbmtNYWMpOwoJCQlicmVhazsKCgkJCWNhc2UgJ3B0JzoKCQkJWW91dHViZUxpbmtXaW4gPSAnaHR0cHM6Ly95b3V0dS5iZS9CdjVadTZ0b3kzMCc7CgkJCVlvdXR1YmVMaW5rTWFjID0gJ2h0dHBzOi8veW91dHUuYmUvQ3pLckZ3N0dVaGcnOwoJCQkkKCcjeW91dHViZV93aW5kb3dzJykuYXR0cignaHJlZicsIFlvdXR1YmVMaW5rV2luKTsKCQkJJCgnI3lvdXR1YmVfbWFjJykuYXR0cignaHJlZicsIFlvdXR1YmVMaW5rTWFjKTsKCQkJYnJlYWs7ICAgIAoKCQkJZGVmYXVsdDoKCQkJWW91dHViZUxpbmtXaW4gPSAnaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1vNWh6Z0dYX0cySSZmZWF0dXJlPXlvdXR1LmJlJzsKCQkJWW91dHViZUxpbmtNYWMgPSAnaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj00RXB2MWw0cUNDbyc7CgkJCSQoJyN5b3V0dWJlX3dpbmRvd3MnKS5hdHRyKCdocmVmJywgWW91dHViZUxpbmtXaW4pOwoJCQkkKCcjeW91dHViZV9tYWMnKS5hdHRyKCdocmVmJywgWW91dHViZUxpbmtNYWMpOwoJCQlicmVhazsJCSAgICAgICAgICAgICAgICAKICAgICAgCX0KfSk7ICAgIAo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPBody>
        <TcpPackets>
          <PacketInfo time="364148359" offset="0" length="16384" />
          <PacketInfo time="364148406" offset="16384" length="16384" />
          <PacketInfo time="364148421" offset="32768" length="16384" />
          <PacketInfo time="364148421" offset="49152" length="16384" />
          <PacketInfo time="364148421" offset="65536" length="16384" />
          <PacketInfo time="364148437" offset="81920" length="16384" />
          <PacketInfo time="364148453" offset="98304" length="16384" />
          <PacketInfo time="364148453" offset="114688" length="16384" />
          <PacketInfo time="364148453" offset="131072" length="16384" />
          <PacketInfo time="364148453" offset="147456" length="14435" />
        </TcpPackets>
      </HTTPResponse>
    </HTTPTask>
    <HTTPTask id="3378" hostname="ppssupport-itgllbh7.inc.hp.com" path="/content/dam/hp-wcc/microsite-assets/images/windows-10/u3715.png" url="https://ppssupport-itgllbh7.inc.hp.com/content/dam/hp-wcc/microsite-assets/images/windows-10/u3715.png" ip="15.72.22.19" port="443" connectionId="96" origin="HTML" frame="1" startDateTime="2021-02-24T08:15:04.284+00:00" startTime="364148453" endTime="364148687">
      <HTTPRequest method="GET">
        <HTTPHeaders>
          <HTTPHeaderEntity name="Host" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>cHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29t</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="sec-ch-ua" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>IkNocm9taXVtIjt2PSI4OCIsICJHb29nbGUgQ2hyb21lIjt2PSI4OCIsICI7Tm90IEEgQnJhbmQiO3Y9Ijk5Ig==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="sec-ch-ua-mobile" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>PzA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="User-Agent" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg4LjAuNDMyNC4xODIgU2FmYXJpLzUzNy4zNg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aW1hZ2UvYXZpZixpbWFnZS93ZWJwLGltYWdlL2FwbmcsaW1hZ2Uvc3ZnK3htbCxpbWFnZS8qLCovKjtxPTAuOA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Site" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>c2FtZS1vcmlnaW4=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Mode" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tY29ycw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Dest" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aW1hZ2U=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referer" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aHR0cHM6Ly9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20vdXMtZW4vaGVscC93aW5kb3dzLTEwLXN1cHBvcnQtY2VudGVyLWNvbXB1dGluZw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Encoding" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Language" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cookie" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>X2NzX2M9MTsgQXBwbGljYXRpb25HYXRld2F5QWZmaW5pdHlDT1JTPTZlOTMwNjk1YjNkZGM4MmY1NmM3NjE5Y2U1MDBmOGM3OyBBcHBsaWNhdGlvbkdhdGV3YXlBZmZpbml0eT02ZTkzMDY5NWIzZGRjODJmNTZjNzYxOWNlNTAwZjhjNzsgV1JJZ25vcmU9dHJ1ZTsgQU1DVlNfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTsgc19lY2lkPU1DTUlEJTdDODE5ODU3NjQ1NzUyODA0OTc4NzQzMjYxNjkxMzQ3NzU3ODA3Nzg7IEFNQ1ZfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4NjgzJTdDTUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OCU3Q01DQUFNTEgtMTYxNDc1ODk1NCU3QzklN0NNQ0FBTUItMTYxNDc1ODk1NCU3QzZHMXluWWNMUHVpUXhZWnJzel9wa3FmTEc5eU1YQnBiMnpYNWR2SmRZUUp6UFhJbWRqMHklN0NNQ09QVE9VVC0xNjE0MTYxMzU1cyU3Q05PTkUlN0NNQ0FJRCU3Q05PTkUlN0NNQ1NZTkNTT1AlN0M0MTEtMTg2OTAlN0N2VmVyc2lvbiU3QzQuNC4wOyBrYW1weWxlX3VzZXJpZD0wZmEyLTgyODctYWMzNy1jMTMxLTcyMTEtMGY4Yi1kYzU3LTRmNjg7IGNkX3VzZXJfaWQ9MTc3ZDMxNWU0Y2M2ZmYtMGQ5NWRkMWUwN2JhZjMtNzNlMzU2Yi0xMjVmNTEtMTc3ZDMxNWU0Y2RiYTg7IHNfY2M9dHJ1ZTsgYWFtX3V1aWQ9ODgxMDAzNjU1NjgwMjc3MTk2NzQwMDI4ODYwMzM2NTEzNzE1NjY7IEpTRVNTSU9OSUQ9MDAwMEZhRGFCcDY5TFZaMkNRUXN4RkpCLUFKOjE5ZTBpZmY0Mjsgb3B0aW1pemVseUVuZFVzZXJJZD1vZXUxNjE0MTU0MjQ4NzAycjAuNzQxNjE1MDIxMDU0MjA1OyBfZ2NsX2F1PTEuMS4yOTM3OTkzNDEuMTYxNDE1NDI1MDsgaHBldWNrX3ByZWZzPTExMTExMTsgaHBldWNrX2Fuc3c9MTsgX3JkdF91dWlkPTE2MTQxNTQyNTE0OTAuZDZmZTlhZTMtYjgwNi00NmI4LThhOWUtMTcyZDc0ZDViNGY5OyBfdWV0c2lkPWNmM2ZmYWEwNzY3NzExZWJiNTE3OTk4ZDJiMmIzYWY0OyBfdWV0dmlkPWNmNDA2YTEwNzY3NzExZWJiNTdmN2Q5NjM4YTU4NTAwOyBfY3NfY3ZhcnM9JTdCJTIyMSUyMiUzQSU1QiUyMlRlbXBsYXRlJTIyJTJDJTIyTWljcm9zaXRlLXdpbjEwX2xlYXJuaW5nX2xhbmRpbmclMjIlNUQlN0Q7IF9jc19pZD0wNDM5MTRhOS02NmYyLWEyMDQtYWFlOC02MDJkYWJlZmJiYTQuMTYxNDE1NDE1Mi4xLjE2MTQxNTQyNTEuMTYxNDE1NDE1Mi4xNTg5MzgwMDk4LjE2NDgzMTgxNTI5NzkuTm9uZS4xOyBfY3Nfcz0yLjE7IF9fQ1RfRGF0YT1ncHY9MiZja3A9dGxkJmRtPWhwLmNvbSZhcHZfMzI1X3d3dzExPTImY3B2XzMyNV93d3cxMT0yOyBPcHRhbm9uQWxlcnRCb3hDbG9zZWQ9MjAyMS0wMi0yNFQwODoxMDo1Mi4xOTFaOyBPcHRhbm9uQ29uc2VudD1pc0lBQkdsb2JhbD1mYWxzZSZkYXRlc3RhbXA9V2VkK0ZlYisyNCsyMDIxKzA4JTNBMTAlM0E1MitHTVQlMkIwMDAwKyhHcmVlbndpY2grTWVhbitUaW1lKSZ2ZXJzaW9uPTYuMTQuMCZob3N0cz0mY29uc2VudElkPWFlNjBlOGU5LWMwNzMtNDY3Yy04YzY1LTQ5Y2Q2OTVmZGE1MCZpbnRlcmFjdGlvbkNvdW50PTEmbGFuZGluZ1BhdGg9Tm90TGFuZGluZ1BhZ2UmZ3JvdXBzPTElM0ExJTJDMiUzQTElMkMzJTNBMSUyQzQlM0ExJTJDNSUzQTElMkM2JTNBMSZnZW9sb2NhdGlvbj1VUyUzQk9SJkF3YWl0aW5nUmVjb25zZW50PWZhbHNlOyBrYW1weWxlVXNlclNlc3Npb249MTYxNDE1NDI1MjU0Mjsga2FtcHlsZVVzZXJTZXNzaW9uc0NvdW50PTI7IGthbXB5bGVTZXNzaW9uUGFnZUNvdW50ZXI9MTsgc19wX2NudD0xOyBocF9wdjFfcHJlZnM9MTExMTExOyBzX3ZudW09MTsgc19pbnZpc2l0PTE7IHNfaW52aXNpdGM9MTsgc19wcmV2aW91c1VybD1odHRwcyUzQS8vcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tL3VzLWVuL2hlbHAvd2luZG93cy0xMC1zdXBwb3J0LWNlbnRlcjsgc19wcG49RCUzRHY1NTsgc19wcHZsPXBwcy1jZXMlMjU3Q3NpdGVob21lX25ldyUyQzM3JTJDMzclMkM3MTMlMkMxNDYzJTJDNzEzJTJDMTQ2MyUyQzgyMyUyQzEuNzUlMkNQOyBzX3Bwdj1EJTI1M0R2NTUlMkM0OSUyQzQ5JTJDNzEzJTJDMTQ2MyUyQzcxMyUyQzE0NjMlMkM4MjMlMkMxLjc1JTJDUA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>R0VUIC9jb250ZW50L2RhbS9ocC13Y2MvbWljcm9zaXRlLWFzc2V0cy9pbWFnZXMvd2luZG93cy0xMC91MzcxNS5wbmcgSFRUUC8xLjENCkhvc3Q6IHBwc3N1cHBvcnQtaXRnbGxiaDcuaW5jLmhwLmNvbQ0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0Kc2VjLWNoLXVhOiAiQ2hyb21pdW0iO3Y9Ijg4IiwgIkdvb2dsZSBDaHJvbWUiO3Y9Ijg4IiwgIjtOb3QgQSBCcmFuZCI7dj0iOTkiDQpzZWMtY2gtdWEtbW9iaWxlOiA/MA0KVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg4LjAuNDMyNC4xODIgU2FmYXJpLzUzNy4zNg0KQWNjZXB0OiBpbWFnZS9hdmlmLGltYWdlL3dlYnAsaW1hZ2UvYXBuZyxpbWFnZS9zdmcreG1sLGltYWdlLyosKi8qO3E9MC44DQpTZWMtRmV0Y2gtU2l0ZTogc2FtZS1vcmlnaW4NClNlYy1GZXRjaC1Nb2RlOiBuby1jb3JzDQpTZWMtRmV0Y2gtRGVzdDogaW1hZ2UNClJlZmVyZXI6IGh0dHBzOi8vcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tL3VzLWVuL2hlbHAvd2luZG93cy0xMC1zdXBwb3J0LWNlbnRlci1jb21wdXRpbmcNCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZSwgYnINCkFjY2VwdC1MYW5ndWFnZTogZW4tVVMsZW47cT0wLjkNCkNvb2tpZTogX2NzX2M9MTsgQXBwbGljYXRpb25HYXRld2F5QWZmaW5pdHlDT1JTPTZlOTMwNjk1YjNkZGM4MmY1NmM3NjE5Y2U1MDBmOGM3OyBBcHBsaWNhdGlvbkdhdGV3YXlBZmZpbml0eT02ZTkzMDY5NWIzZGRjODJmNTZjNzYxOWNlNTAwZjhjNzsgV1JJZ25vcmU9dHJ1ZTsgQU1DVlNfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTsgc19lY2lkPU1DTUlEJTdDODE5ODU3NjQ1NzUyODA0OTc4NzQzMjYxNjkxMzQ3NzU3ODA3Nzg7IEFNQ1ZfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4NjgzJTdDTUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OCU3Q01DQUFNTEgtMTYxNDc1ODk1NCU3QzklN0NNQ0FBTUItMTYxNDc1ODk1NCU3QzZHMXluWWNMUHVpUXhZWnJzel9wa3FmTEc5eU1YQnBiMnpYNWR2SmRZUUp6UFhJbWRqMHklN0NNQ09QVE9VVC0xNjE0MTYxMzU1cyU3Q05PTkUlN0NNQ0FJRCU3Q05PTkUlN0NNQ1NZTkNTT1AlN0M0MTEtMTg2OTAlN0N2VmVyc2lvbiU3QzQuNC4wOyBrYW1weWxlX3VzZXJpZD0wZmEyLTgyODctYWMzNy1jMTMxLTcyMTEtMGY4Yi1kYzU3LTRmNjg7IGNkX3VzZXJfaWQ9MTc3ZDMxNWU0Y2M2ZmYtMGQ5NWRkMWUwN2JhZjMtNzNlMzU2Yi0xMjVmNTEtMTc3ZDMxNWU0Y2RiYTg7IHNfY2M9dHJ1ZTsgYWFtX3V1aWQ9ODgxMDAzNjU1NjgwMjc3MTk2NzQwMDI4ODYwMzM2NTEzNzE1NjY7IEpTRVNTSU9OSUQ9MDAwMEZhRGFCcDY5TFZaMkNRUXN4RkpCLUFKOjE5ZTBpZmY0Mjsgb3B0aW1pemVseUVuZFVzZXJJZD1vZXUxNjE0MTU0MjQ4NzAycjAuNzQxNjE1MDIxMDU0MjA1OyBfZ2NsX2F1PTEuMS4yOTM3OTkzNDEuMTYxNDE1NDI1MDsgaHBldWNrX3ByZWZzPTExMTExMTsgaHBldWNrX2Fuc3c9MTsgX3JkdF91dWlkPTE2MTQxNTQyNTE0OTAuZDZmZTlhZTMtYjgwNi00NmI4LThhOWUtMTcyZDc0ZDViNGY5OyBfdWV0c2lkPWNmM2ZmYWEwNzY3NzExZWJiNTE3OTk4ZDJiMmIzYWY0OyBfdWV0dmlkPWNmNDA2YTEwNzY3NzExZWJiNTdmN2Q5NjM4YTU4NTAwOyBfY3NfY3ZhcnM9JTdCJTIyMSUyMiUzQSU1QiUyMlRlbXBsYXRlJTIyJTJDJTIyTWljcm9zaXRlLXdpbjEwX2xlYXJuaW5nX2xhbmRpbmclMjIlNUQlN0Q7IF9jc19pZD0wNDM5MTRhOS02NmYyLWEyMDQtYWFlOC02MDJkYWJlZmJiYTQuMTYxNDE1NDE1Mi4xLjE2MTQxNTQyNTEuMTYxNDE1NDE1Mi4xNTg5MzgwMDk4LjE2NDgzMTgxNTI5NzkuTm9uZS4xOyBfY3Nfcz0yLjE7IF9fQ1RfRGF0YT1ncHY9MiZja3A9dGxkJmRtPWhwLmNvbSZhcHZfMzI1X3d3dzExPTImY3B2XzMyNV93d3cxMT0yOyBPcHRhbm9uQWxlcnRCb3hDbG9zZWQ9MjAyMS0wMi0yNFQwODoxMDo1Mi4xOTFaOyBPcHRhbm9uQ29uc2VudD1pc0lBQkdsb2JhbD1mYWxzZSZkYXRlc3RhbXA9V2VkK0ZlYisyNCsyMDIxKzA4JTNBMTAlM0E1MitHTVQlMkIwMDAwKyhHcmVlbndpY2grTWVhbitUaW1lKSZ2ZXJzaW9uPTYuMTQuMCZob3N0cz0mY29uc2VudElkPWFlNjBlOGU5LWMwNzMtNDY3Yy04YzY1LTQ5Y2Q2OTVmZGE1MCZpbnRlcmFjdGlvbkNvdW50PTEmbGFuZGluZ1BhdGg9Tm90TGFuZGluZ1BhZ2UmZ3JvdXBzPTElM0ExJTJDMiUzQTElMkMzJTNBMSUyQzQlM0ExJTJDNSUzQTElMkM2JTNBMSZnZW9sb2NhdGlvbj1VUyUzQk9SJkF3YWl0aW5nUmVjb25zZW50PWZhbHNlOyBrYW1weWxlVXNlclNlc3Npb249MTYxNDE1NDI1MjU0Mjsga2FtcHlsZVVzZXJTZXNzaW9uc0NvdW50PTI7IGthbXB5bGVTZXNzaW9uUGFnZUNvdW50ZXI9MTsgc19wX2NudD0xOyBocF9wdjFfcHJlZnM9MTExMTExOyBzX3ZudW09MTsgc19pbnZpc2l0PTE7IHNfaW52aXNpdGM9MTsgc19wcmV2aW91c1VybD1odHRwcyUzQS8vcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tL3VzLWVuL2hlbHAvd2luZG93cy0xMC1zdXBwb3J0LWNlbnRlcjsgc19wcG49RCUzRHY1NTsgc19wcHZsPXBwcy1jZXMlMjU3Q3NpdGVob21lX25ldyUyQzM3JTJDMzclMkM3MTMlMkMxNDYzJTJDNzEzJTJDMTQ2MyUyQzgyMyUyQzEuNzUlMkNQOyBzX3Bwdj1EJTI1M0R2NTUlMkM0OSUyQzQ5JTJDNzEzJTJDMTQ2MyUyQzcxMyUyQzE0NjMlMkM4MjMlMkMxLjc1JTJDUA0KDQo=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
          <HTTPCookies>
            <HTTPHeaderEntity name="_cs_c" index="0">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="ApplicationGatewayAffinityCORS" index="1">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>NmU5MzA2OTViM2RkYzgyZjU2Yzc2MTljZTUwMGY4Yzc=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="ApplicationGatewayAffinity" index="2">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>NmU5MzA2OTViM2RkYzgyZjU2Yzc2MTljZTUwMGY4Yzc=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="WRIgnore" index="3">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>dHJ1ZQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="AMCVS_5E34123F5245B2CD0A490D45%40AdobeOrg" index="4">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ecid" index="5">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>TUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OA==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="AMCV_5E34123F5245B2CD0A490D45%40AdobeOrg" index="6">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4NjgzJTdDTUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OCU3Q01DQUFNTEgtMTYxNDc1ODk1NCU3QzklN0NNQ0FBTUItMTYxNDc1ODk1NCU3QzZHMXluWWNMUHVpUXhZWnJzel9wa3FmTEc5eU1YQnBiMnpYNWR2SmRZUUp6UFhJbWRqMHklN0NNQ09QVE9VVC0xNjE0MTYxMzU1cyU3Q05PTkUlN0NNQ0FJRCU3Q05PTkUlN0NNQ1NZTkNTT1AlN0M0MTEtMTg2OTAlN0N2VmVyc2lvbiU3QzQuNC4w</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyle_userid" index="7">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MGZhMi04Mjg3LWFjMzctYzEzMS03MjExLTBmOGItZGM1Ny00ZjY4</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="cd_user_id" index="8">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTc3ZDMxNWU0Y2M2ZmYtMGQ5NWRkMWUwN2JhZjMtNzNlMzU2Yi0xMjVmNTEtMTc3ZDMxNWU0Y2RiYTg=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_cc" index="9">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>dHJ1ZQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="aam_uuid" index="10">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>ODgxMDAzNjU1NjgwMjc3MTk2NzQwMDI4ODYwMzM2NTEzNzE1NjY=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="JSESSIONID" index="11">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MDAwMEZhRGFCcDY5TFZaMkNRUXN4RkpCLUFKOjE5ZTBpZmY0Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="optimizelyEndUserId" index="12">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>b2V1MTYxNDE1NDI0ODcwMnIwLjc0MTYxNTAyMTA1NDIwNQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_gcl_au" index="13">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MS4xLjI5Mzc5OTM0MS4xNjE0MTU0MjUw</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="hpeuck_prefs" index="14">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTExMTEx</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="hpeuck_answ" index="15">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_rdt_uuid" index="16">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTYxNDE1NDI1MTQ5MC5kNmZlOWFlMy1iODA2LTQ2YjgtOGE5ZS0xNzJkNzRkNWI0Zjk=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_uetsid" index="17">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Y2YzZmZhYTA3Njc3MTFlYmI1MTc5OThkMmIyYjNhZjQ=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_uetvid" index="18">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Y2Y0MDZhMTA3Njc3MTFlYmI1N2Y3ZDk2MzhhNTg1MDA=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_cs_cvars" index="19">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>JTdCJTIyMSUyMiUzQSU1QiUyMlRlbXBsYXRlJTIyJTJDJTIyTWljcm9zaXRlLXdpbjEwX2xlYXJuaW5nX2xhbmRpbmclMjIlNUQlN0Q=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_cs_id" index="20">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MDQzOTE0YTktNjZmMi1hMjA0LWFhZTgtNjAyZGFiZWZiYmE0LjE2MTQxNTQxNTIuMS4xNjE0MTU0MjUxLjE2MTQxNTQxNTIuMTU4OTM4MDA5OC4xNjQ4MzE4MTUyOTc5Lk5vbmUuMQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_cs_s" index="21">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Mi4x</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="__CT_Data" index="22">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Z3B2PTImY2twPXRsZCZkbT1ocC5jb20mYXB2XzMyNV93d3cxMT0yJmNwdl8zMjVfd3d3MTE9Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="OptanonAlertBoxClosed" index="23">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MjAyMS0wMi0yNFQwODoxMDo1Mi4xOTFa</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="OptanonConsent" index="24">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>aXNJQUJHbG9iYWw9ZmFsc2UmZGF0ZXN0YW1wPVdlZCtGZWIrMjQrMjAyMSswOCUzQTEwJTNBNTIrR01UJTJCMDAwMCsoR3JlZW53aWNoK01lYW4rVGltZSkmdmVyc2lvbj02LjE0LjAmaG9zdHM9JmNvbnNlbnRJZD1hZTYwZThlOS1jMDczLTQ2N2MtOGM2NS00OWNkNjk1ZmRhNTAmaW50ZXJhY3Rpb25Db3VudD0xJmxhbmRpbmdQYXRoPU5vdExhbmRpbmdQYWdlJmdyb3Vwcz0xJTNBMSUyQzIlM0ExJTJDMyUzQTElMkM0JTNBMSUyQzUlM0ExJTJDNiUzQTEmZ2VvbG9jYXRpb249VVMlM0JPUiZBd2FpdGluZ1JlY29uc2VudD1mYWxzZQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyleUserSession" index="25">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTYxNDE1NDI1MjU0Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyleUserSessionsCount" index="26">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyleSessionPageCounter" index="27">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_p_cnt" index="28">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="hp_pv1_prefs" index="29">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTExMTEx</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_vnum" index="30">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_invisit" index="31">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_invisitc" index="32">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_previousUrl" index="33">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>aHR0cHMlM0EvL3Bwc3N1cHBvcnQtaXRnbGxiaDcuaW5jLmhwLmNvbS91cy1lbi9oZWxwL3dpbmRvd3MtMTAtc3VwcG9ydC1jZW50ZXI=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ppn" index="34">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>RCUzRHY1NQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ppvl" index="35">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>cHBzLWNlcyUyNTdDc2l0ZWhvbWVfbmV3JTJDMzclMkMzNyUyQzcxMyUyQzE0NjMlMkM3MTMlMkMxNDYzJTJDODIzJTJDMS43NSUyQ1A=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ppv" index="36">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>RCUyNTNEdjU1JTJDNDklMkM0OSUyQzcxMyUyQzE0NjMlMkM3MTMlMkMxNDYzJTJDODIzJTJDMS43NSUyQ1A=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
          </HTTPCookies>
        </HTTPHeaders>
      </HTTPRequest>
      <HTTPResponse>
        <contentLenght>5313</contentLenght>
        <HTTPHeaders>
          <HTTPHeaderEntity name="Server" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bmdpbngvMS4xOC4w</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Date" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAyNCBGZWIgMjAyMSAwODoxMTozNiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Content-Type" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aW1hZ2UvcG5n</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Content-Length" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NTMxMw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Dispatcher" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZGlzcGF0Y2hlcjFlYXN0dXMy</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Vhost" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>d2ViLWN1c3RvbWVyLWNhcmU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Content-Type-Options" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm9zbmlmZg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Last-Modified" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAwMiBEZWMgMjAyMCAyMTo1NDoyNiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ETag" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>IjE0YzEtNWI1ODI0OTZmZTg4MCI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Ranges" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Ynl0ZXM=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frame-Options" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>U0FNRU9SSUdJTg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frame-Options" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>REVOWQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Content-Type-Options" index="13">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm9zbmlmZg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-XSS-Protection" index="14">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTsgbW9kZT1ibG9jaw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Strict-Transport-Security" index="15">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referrer-Policy" index="16">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Access-Control-Allow-Origin" index="17">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Kg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Access-Control-Allow-Credentials" index="18">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dHJ1ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frame-Options" index="19">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>REVOWQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Content-Type-Options" index="20">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm9zbmlmZg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-XSS-Protection" index="21">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTsgbW9kZT1ibG9jaw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Strict-Transport-Security" index="22">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referrer-Policy" index="23">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Expires" index="24">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAwMyBNYXIgMjAyMSAwODoxMTozNiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cache-Control" index="25">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT02MDQ4MDA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IG5naW54LzEuMTguMA0KRGF0ZTogV2VkLCAyNCBGZWIgMjAyMSAwODoxMTozNiBHTVQNCkNvbnRlbnQtVHlwZTogaW1hZ2UvcG5nDQpDb250ZW50LUxlbmd0aDogNTMxMw0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KWC1EaXNwYXRjaGVyOiBkaXNwYXRjaGVyMWVhc3R1czINClgtVmhvc3Q6IHdlYi1jdXN0b21lci1jYXJlDQpYLUNvbnRlbnQtVHlwZS1PcHRpb25zOiBub3NuaWZmDQpMYXN0LU1vZGlmaWVkOiBXZWQsIDAyIERlYyAyMDIwIDIxOjU0OjI2IEdNVA0KRVRhZzogIjE0YzEtNWI1ODI0OTZmZTg4MCINCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpYLUZyYW1lLU9wdGlvbnM6IFNBTUVPUklHSU4NClgtRnJhbWUtT3B0aW9uczogREVOWQ0KWC1Db250ZW50LVR5cGUtT3B0aW9uczogbm9zbmlmZg0KWC1YU1MtUHJvdGVjdGlvbjogMTsgbW9kZT1ibG9jaw0KU3RyaWN0LVRyYW5zcG9ydC1TZWN1cml0eTogbWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQNClJlZmVycmVyLVBvbGljeTogbm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGUNCkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbjogKg0KQWNjZXNzLUNvbnRyb2wtQWxsb3ctQ3JlZGVudGlhbHM6IHRydWUNClgtRnJhbWUtT3B0aW9uczogREVOWQ0KWC1Db250ZW50LVR5cGUtT3B0aW9uczogbm9zbmlmZg0KWC1YU1MtUHJvdGVjdGlvbjogMTsgbW9kZT1ibG9jaw0KU3RyaWN0LVRyYW5zcG9ydC1TZWN1cml0eTogbWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQNClJlZmVycmVyLVBvbGljeTogbm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGUNCkV4cGlyZXM6IFdlZCwgMDMgTWFyIDIwMjEgMDg6MTE6MzYgR01UDQpDYWNoZS1Db250cm9sOiBtYXgtYWdlPTYwNDgwMA0KDQo=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
        </HTTPHeaders>
        <HTTPBody>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAMh2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDggNzkuMTY0MDUwLCAyMDE5LzEwLzAxLTE4OjAzOjE2ICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZGFtPSJodHRwOi8vd3d3LmRheS5jb20vZGFtLzEuMCIKICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICBkYW06UGh5c2ljYWxoZWlnaHRpbmluY2hlcz0iLTEuMCIKICAgZGFtOlBoeXNpY2Fsd2lkdGhpbmluY2hlcz0iLTEuMCIKICAgZGFtOkZpbGVmb3JtYXQ9IlBORyIKICAgZGFtOlByb2dyZXNzaXZlPSJubyIKICAgZGFtOnNjZW5lN0NvbXBhbnlJRD0iY3wyMzA0NzgiCiAgIGRhbTpzY2VuZTdQdWJsaXNoZWRCeT0iYXNoaXNoLnRyaXBhdGhpQGhwLmNvbSIKICAgZGFtOmV4dHJhY3RlZD0iMjAyMC0xMS0xNVQwODo0ODo1NS4wNjVaIgogICBkYW06Qml0c3BlcnBpeGVsPSIzMiIKICAgZGFtOnNjZW5lN0lEPSJhfDkxNjQ3MDI0MiIKICAgZGFtOnNjZW5lN0Nsb3VkQ29uZmlnUGF0aD0iL2NvbmYvZ2xvYmFsL3NldHRpbmdzL2Nsb3VkY29uZmlncy9kbXNjZW5lNyIKICAgZGFtOk1JTUV0eXBlPSJpbWFnZS9wbmciCiAgIGRhbTpDb21tZW50cz0iU29mdHdhcmU6IEFkb2JlIEltYWdlUmVhZHkmI3hBO1hNTDpjb20uYWRvYmUueG1wOiAmbHQ7P3hwYWNrZXQgYmVnaW49JnF1b3Q777u/JnF1b3Q7IGlkPSZxdW90O1c1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCZxdW90Oz8mZ3Q7JiN4QTsmbHQ7eDp4bXBtZXRhIHhtbG5zOng9JnF1b3Q7YWRvYmU6bnM6bWV0YS8mcXVvdDsgeDp4bXB0az0mcXVvdDtBZG9iZSBYTVAgQ29yZSA1LjYtYzE0OCA3OS4xNjQwNTAsIDIwMTkvMTAvMDEtMTg6MDM6MTYgICAgICAgICZxdW90OyZndDsmI3hBOyAmbHQ7cmRmOlJERiB4bWxuczpyZGY9JnF1b3Q7aHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyZxdW90OyZndDsmI3hBOyAgJmx0O3JkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JnF1b3Q7JnF1b3Q7JiN4QTsgICAgeG1sbnM6ZGFtPSZxdW90O2h0dHA6Ly93d3cuZGF5LmNvbS9kYW0vMS4wJnF1b3Q7JiN4QTsgICAgeG1sbnM6dGlmZj0mcXVvdDtodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyZxdW90OyYjeEE7ICAgIHhtbG5zOmRjPSZxdW90O2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJnF1b3Q7JiN4QTsgICBkYW06UGh5c2ljYWxoZWlnaHRpbmluY2hlcz0mcXVvdDstMS4wJnF1b3Q7JiN4QTsgICBkYW06UGh5c2ljYWx3aWR0aGluaW5jaGVzPSZxdW90Oy0xLjAmcXVvdDsmI3hBOyAgIGRhbTpGaWxlZm9ybWF0PSZxdW90O1BORyZxdW90OyYjeEE7ICAgZGFtOlByb2dyZXNzaXZlPSZxdW90O25vJnF1b3Q7JiN4QTsgICBkYW06ZXh0cmFjdGVkPSZxdW90OzIwMjAtMTEtMTBUMTk6MzY6NDQuODMwKzA1OjMwJnF1b3Q7JiN4QTsgICBkYW06Qml0c3BlcnBpeGVsPSZxdW90OzMyJnF1b3Q7JiN4QTsgICBkYW06TUlNRXR5cGU9JnF1b3Q7aW1hZ2UvcG5nJnF1b3Q7JiN4QTsgICBkYW06Q29tbWVudHM9JnF1b3Q7U29mdHdhcmU6IEFkb2JlIEltYWdlUmVhZHkmYW1wOyN4QTsmcXVvdDsmI3hBOyAgIGRhbTpQaHlzaWNhbHdpZHRoaW5kcGk9JnF1b3Q7LTEmcXVvdDsmI3hBOyAgIGRhbTpQaHlzaWNhbGhlaWdodGluZHBpPSZxdW90Oy0xJnF1b3Q7JiN4QTsgICBkYW06TnVtYmVyb2ZpbWFnZXM9JnF1b3Q7MSZxdW90OyYjeEE7ICAgZGFtOk51bWJlcm9mdGV4dHVhbGNvbW1lbnRzPSZxdW90OzEmcXVvdDsmI3hBOyAgIGRhbTpzaGExPSZxdW90OzAyNmNiNzNiZjVhZjMxZDk5YTRkZmQzODBjODJkNGJiMmM1YzExNWUmcXVvdDsmI3hBOyAgIGRhbTpzaXplPSZxdW90OzIwOTQmcXVvdDsmI3hBOyAgIHRpZmY6SW1hZ2VMZW5ndGg9JnF1b3Q7ODAmcXVvdDsmI3hBOyAgIHRpZmY6SW1hZ2VXaWR0aD0mcXVvdDs4MCZxdW90OyYjeEE7ICAgZGM6Zm9ybWF0PSZxdW90O2ltYWdlL3BuZyZxdW90OyYjeEE7ICAgZGM6bW9kaWZpZWQ9JnF1b3Q7MjAyMC0xMS0xMFQyMDo0ODoxNi40MjMrMDU6MzAmcXVvdDsvJmd0OyYjeEE7ICZsdDsvcmRmOlJERiZndDsmI3hBOyZsdDsveDp4bXBtZXRhJmd0OyYjeEE7Jmx0Oz94cGFja2V0IGVuZD0mcXVvdDtyJnF1b3Q7PyZndDsmI3hBOyIKICAgZGFtOlBoeXNpY2Fsd2lkdGhpbmRwaT0iLTEiCiAgIGRhbTpQaHlzaWNhbGhlaWdodGluZHBpPSItMSIKICAgZGFtOnNjZW5lN0ZpbGVTdGF0dXM9IlB1Ymxpc2hDb21wbGV0ZSIKICAgZGFtOnNjZW5lN0ZpbGU9Imhwc2l0ZXNkZXYvdTM3MTUiCiAgIGRhbTpzY2VuZTdOYW1lPSJ1MzcxNSIKICAgZGFtOnNjZW5lN1R5cGU9IkltYWdlIgogICBkYW06TnVtYmVyb2ZpbWFnZXM9IjEiCiAgIGRhbTpzY2VuZTdVcGxvYWRUaW1lU3RhbXA9IjIwMjAtMTEtMTVUMDg6NDk6MjUuNzgzWiIKICAgZGFtOk51bWJlcm9mdGV4dHVhbGNvbW1lbnRzPSIyIgogICBkYW06c2NlbmU3UHVibGlzaFRpbWVTdGFtcD0iMjAyMC0xMS0xNlQwODo0MTo0NC44MTVaIgogICBkYW06c2NlbmU3RG9tYWluPSJodHRwOi8vczdkNi5zY2VuZTcuY29tLyIKICAgZGFtOnNjZW5lN0ZvbGRlcj0iaHBzaXRlc2Rldi9ocC13Y2MvbWljcm9zaXRlLWFzc2V0cy9pbWFnZXMvd2luZG93cy0xMC8iCiAgIGRhbTpzaGExPSJmYjIzMDk4MTIwMjZlOTAwYTZjYzZmMzJjZGNlMTMzMWQ5MzIyN2JjIgogICBkYW06c2l6ZT0iMzE2NyIKICAgZGFtOnNjZW5lN0FQSVNlcnZlcj0iaHR0cHM6Ly9zN3NwczFhcGlzc2wuc2NlbmU3LmNvbSIKICAgZGFtOnNjZW5lN0xhc3RNb2RpZmllZD0iMTYwNTQzMDEzNjI0MSIKICAgdGlmZjpJbWFnZUxlbmd0aD0iODAiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iODAiCiAgIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIgogICBkYzptb2RpZmllZD0iMjAyMC0xMS0xMFQyMDo0ODoxNi40MjMrMDU6MzAiLz4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz6Il8DmAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB9BJREFUeNrsXN9PHEUcH6BCa3+wtJDGWuVIjZqmyjXKg/GBwwfjk8BDfTIBfKwxpX+AAfwHStPkfBNIfOOh4JPpgxwmxoeacG3Ts5o2LNofaYqwpb8Ei3E+szPLsOwduzuzx96532SPPfZmf3zm8/05M0tIIokkkkgiiSSSSCKJVLJkCym2lVlqYgaCQT/T/Ju8n6eb5eyfPm55tJ3jbU56Hq9KALOFDP3E1snBMgK0znFgZ+lm0m3O+f/p413VC6ANWh/detyAGQ11JH2owf7bvHtTM3NljZiP/nG2bWSUgni2ugDMFvrp5xDdHDsFkDJHXiTdbfsd4HzT7+5TMku3qflHJL/4t9dPBiiI45UPoAu41P4XSP+bBul7o5Htq8r4bw/JwA93vQ7BDnZREPNRPt6uSL0iIWPcxjGwhjpaSD8FTqecv7rk+X/KZqN5d13mpm0nK4yB2cIgZ50BtTz3/mHtwAk5+9N9x352UnNg1NfK9hPO5WzN17/m2P1EYBdrNANncNbBQZAeatvGul4KZNuikE8u3bEmb60Y3Gt36QxzajWDNwPcANjFj46ybafBg5w+0WTw+0izcCdbSMeLgba9u4gbhPqAde4wZKfFWl0nXd/9ITy2NgdTo5F5DLyZj1+NBeuKgTgwc4+FPrpArPm/gLcpQKRhD8IfDiJSP3OnbOBYpYEHQVTATYzBTI9NhDIDmC0MC4cRB08bRHCv6HAeyMOhnCuvCttejCXv8LQIVypR4FBOTs6Lr71UlafKxUCoLhl8+2DFgidycaiz80whVLk2BPuQZaRZavZuM6l0AQlQ0OD2cChaFbZ7CJw3Kll1t1HltiBeOSgDwT4DPVYt4AlVlnL1oShVuI9doaOFVJtIz9QfxBbWBlDffvqZEkXQahPYdEmrBqNgYDc+zlCjW63St6HGfXqdiE3pZewuf/a6ctCMMQ3kowv0Lwy4GANpP9Tgy7aK9g/X/t1yDDVBFQ1p+/amGHM56SdP9luRdup7quChADrqUUXmCT4RmY0XkCgGoD3PY4vfLG2LKCGMoC2/PzxzXpcKdzIdVvS8SOJHi5TgZZB6v7/tOVCESsp24IlzhJXODfZ2+vm9XwZm2IeCamAUTX54nAueD6NxFlVFHAe7xMNjf6a7dVOsJlgq2sMew/hD/dFeVvGwIjE/oxPAFFRLZRRNHvxh1RsJHJwbcRjGM8A+AThAE4VZGSDch9xetXO94kKmAcj5t7GD26uwPRDOmKIiMgDFPDl6X+6kafOxsy87jKjDKOlZU9rCGJUSPXpTtkulAJCdR+7Ok6JeONKY8EC989g6AMwINQsrlivcKGUKil2nVWoDNsuM1i2tAUxVLSmDBGFMu2QqZJB6Uvs2/a5reoHZS9mx6MxKxO1oA7CxPjzWCxKA29mvYgxk8eEHR7bEjgCx6ZvfmdeOQLUNbQDGYZgSnhoBstsEwL4ivkQWIWYqlEt8Azgboc0JGqfNf/oaY6NXtgIgywliWWygrP66jL9gI8AcpgG5rPoAUZM6z+oA0NQRmIZhup92YmjBPayq4lyCaJtvAIvFZL4sscsBlcpV5WNGAMcFsOVg36tS4zvs2rgHSxuAKirhZlIpNc4FZGAUIhUyNFRj7AEWCwCqVDlkg19sUqTIfz0qI75YI3eyStiV/2tVI4DSiVQcgFwKw3lQ2pI7BP8ThQRh22TQRREVv3N3pIgHzQDxpo+00/Qzj9BvNWYa9wTjGnY0Dl5z4obldAJKW6Vqe9KAtwOgDHDJ3JOCF1b9JZLkdIYxOVXPBkHY4efBisV4fsELW42GTGx06rSf3/sfWM8WMPKcmjvVpmzc0RHTdHM7pszLe0vO3od6ocTlru4IhwMzoVLqwv0gm+Het02nCrPOodsQHIA7Jw3jUMIwjIUqEXpmiX1TfudRB3FV48J2qXjjOMv4DUsmi+ZUzg5nGIjnry1XH3iUGNykYDFjTj+AUs9ozDVjIdCokcsPnDA1umKC3TPjrgtWvECjOCFyQdfXhQnXR9BpoHwuJiUu1bRteIMMI9GXs2xbyGiOwLbSHQoG67mMBrF9KgwEiMPoPLHuomLBo+kkz73NMOwLD6AtvVBlBMXlLqPr8rpSKtkbdv1ceABtVe4VXtnPnJU4gSetMR5QWa2kVtK3bcaAUIdKANEF3qjqqnZdiw37CV/6gPGJuM7ed4E3TsEbUD2nvvXCEogoXaEcFafVS655iVrA0wugDWIPB9GIy7JXUUeUKt1aX0ahf8m/vQyMLULE1y/eOmh+1dGc2gE2WiO/LBo0SIZ3xQwDi3vbnM6LRPXOBLHqh812B3gURJOCaZBgL9cJBdyFa0vW0OVFY3l1XVxrijNP+xuNon3tiT23EEBmhEZREMmX7zSbLXvqMjovtbS6bl64tmyev7qUloAzOXC5qB6xPC/e8XjpDgUw9/mJg+TUsf3keFNDiviYzOg2bw+erZvZ68tk8tYKub60Kr86ys4squLFO1sZeYbwWf8yGKiEnDp2IPXe4T35o/t2pRvr66wPX9l7BQcv/fmk/eHaunH78fP8z/efpX+899S6//R5imydAAmmTZQDuJ0BcLONBIjdXL1V7CLs2yyxy/BmuR8lHq+/sz23YFRrCXWGE7jCGZuP+rVOiSSSSCKJJJJIIlUs/wkwAKi+b/CN4rARAAAAAElFTkSuQmCC</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPBody>
        <TcpPackets>
          <PacketInfo time="364148671" offset="0" length="6239" />
        </TcpPackets>
      </HTTPResponse>
    </HTTPTask>
    <HTTPTask id="3382" hostname="ppssupport-itgllbh7.inc.hp.com" path="/content/dam/hp-wcc/microsite-assets/images/windows-10/u3711.png" url="https://ppssupport-itgllbh7.inc.hp.com/content/dam/hp-wcc/microsite-assets/images/windows-10/u3711.png" ip="15.72.22.19" port="443" connectionId="95" origin="HTML" frame="1" startDateTime="2021-02-24T08:15:04.296+00:00" startTime="364148578" endTime="364148796">
      <HTTPRequest method="GET">
        <HTTPHeaders>
          <HTTPHeaderEntity name="Host" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>cHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29t</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="sec-ch-ua" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>IkNocm9taXVtIjt2PSI4OCIsICJHb29nbGUgQ2hyb21lIjt2PSI4OCIsICI7Tm90IEEgQnJhbmQiO3Y9Ijk5Ig==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="sec-ch-ua-mobile" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>PzA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="User-Agent" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg4LjAuNDMyNC4xODIgU2FmYXJpLzUzNy4zNg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aW1hZ2UvYXZpZixpbWFnZS93ZWJwLGltYWdlL2FwbmcsaW1hZ2Uvc3ZnK3htbCxpbWFnZS8qLCovKjtxPTAuOA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Site" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>c2FtZS1vcmlnaW4=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Mode" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tY29ycw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Dest" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aW1hZ2U=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referer" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aHR0cHM6Ly9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20vdXMtZW4vaGVscC93aW5kb3dzLTEwLXN1cHBvcnQtY2VudGVyLWNvbXB1dGluZw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Encoding" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Language" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cookie" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>X2NzX2M9MTsgQXBwbGljYXRpb25HYXRld2F5QWZmaW5pdHlDT1JTPTZlOTMwNjk1YjNkZGM4MmY1NmM3NjE5Y2U1MDBmOGM3OyBBcHBsaWNhdGlvbkdhdGV3YXlBZmZpbml0eT02ZTkzMDY5NWIzZGRjODJmNTZjNzYxOWNlNTAwZjhjNzsgV1JJZ25vcmU9dHJ1ZTsgQU1DVlNfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTsgc19lY2lkPU1DTUlEJTdDODE5ODU3NjQ1NzUyODA0OTc4NzQzMjYxNjkxMzQ3NzU3ODA3Nzg7IEFNQ1ZfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4NjgzJTdDTUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OCU3Q01DQUFNTEgtMTYxNDc1ODk1NCU3QzklN0NNQ0FBTUItMTYxNDc1ODk1NCU3QzZHMXluWWNMUHVpUXhZWnJzel9wa3FmTEc5eU1YQnBiMnpYNWR2SmRZUUp6UFhJbWRqMHklN0NNQ09QVE9VVC0xNjE0MTYxMzU1cyU3Q05PTkUlN0NNQ0FJRCU3Q05PTkUlN0NNQ1NZTkNTT1AlN0M0MTEtMTg2OTAlN0N2VmVyc2lvbiU3QzQuNC4wOyBrYW1weWxlX3VzZXJpZD0wZmEyLTgyODctYWMzNy1jMTMxLTcyMTEtMGY4Yi1kYzU3LTRmNjg7IGNkX3VzZXJfaWQ9MTc3ZDMxNWU0Y2M2ZmYtMGQ5NWRkMWUwN2JhZjMtNzNlMzU2Yi0xMjVmNTEtMTc3ZDMxNWU0Y2RiYTg7IHNfY2M9dHJ1ZTsgYWFtX3V1aWQ9ODgxMDAzNjU1NjgwMjc3MTk2NzQwMDI4ODYwMzM2NTEzNzE1NjY7IEpTRVNTSU9OSUQ9MDAwMEZhRGFCcDY5TFZaMkNRUXN4RkpCLUFKOjE5ZTBpZmY0Mjsgb3B0aW1pemVseUVuZFVzZXJJZD1vZXUxNjE0MTU0MjQ4NzAycjAuNzQxNjE1MDIxMDU0MjA1OyBfZ2NsX2F1PTEuMS4yOTM3OTkzNDEuMTYxNDE1NDI1MDsgaHBldWNrX3ByZWZzPTExMTExMTsgaHBldWNrX2Fuc3c9MTsgX3JkdF91dWlkPTE2MTQxNTQyNTE0OTAuZDZmZTlhZTMtYjgwNi00NmI4LThhOWUtMTcyZDc0ZDViNGY5OyBfdWV0c2lkPWNmM2ZmYWEwNzY3NzExZWJiNTE3OTk4ZDJiMmIzYWY0OyBfdWV0dmlkPWNmNDA2YTEwNzY3NzExZWJiNTdmN2Q5NjM4YTU4NTAwOyBfY3NfY3ZhcnM9JTdCJTIyMSUyMiUzQSU1QiUyMlRlbXBsYXRlJTIyJTJDJTIyTWljcm9zaXRlLXdpbjEwX2xlYXJuaW5nX2xhbmRpbmclMjIlNUQlN0Q7IF9jc19pZD0wNDM5MTRhOS02NmYyLWEyMDQtYWFlOC02MDJkYWJlZmJiYTQuMTYxNDE1NDE1Mi4xLjE2MTQxNTQyNTEuMTYxNDE1NDE1Mi4xNTg5MzgwMDk4LjE2NDgzMTgxNTI5NzkuTm9uZS4xOyBfY3Nfcz0yLjE7IF9fQ1RfRGF0YT1ncHY9MiZja3A9dGxkJmRtPWhwLmNvbSZhcHZfMzI1X3d3dzExPTImY3B2XzMyNV93d3cxMT0yOyBPcHRhbm9uQWxlcnRCb3hDbG9zZWQ9MjAyMS0wMi0yNFQwODoxMDo1Mi4xOTFaOyBPcHRhbm9uQ29uc2VudD1pc0lBQkdsb2JhbD1mYWxzZSZkYXRlc3RhbXA9V2VkK0ZlYisyNCsyMDIxKzA4JTNBMTAlM0E1MitHTVQlMkIwMDAwKyhHcmVlbndpY2grTWVhbitUaW1lKSZ2ZXJzaW9uPTYuMTQuMCZob3N0cz0mY29uc2VudElkPWFlNjBlOGU5LWMwNzMtNDY3Yy04YzY1LTQ5Y2Q2OTVmZGE1MCZpbnRlcmFjdGlvbkNvdW50PTEmbGFuZGluZ1BhdGg9Tm90TGFuZGluZ1BhZ2UmZ3JvdXBzPTElM0ExJTJDMiUzQTElMkMzJTNBMSUyQzQlM0ExJTJDNSUzQTElMkM2JTNBMSZnZW9sb2NhdGlvbj1VUyUzQk9SJkF3YWl0aW5nUmVjb25zZW50PWZhbHNlOyBrYW1weWxlVXNlclNlc3Npb249MTYxNDE1NDI1MjU0Mjsga2FtcHlsZVVzZXJTZXNzaW9uc0NvdW50PTI7IGthbXB5bGVTZXNzaW9uUGFnZUNvdW50ZXI9MTsgc19wX2NudD0xOyBocF9wdjFfcHJlZnM9MTExMTExOyBzX3ZudW09MTsgc19pbnZpc2l0PTE7IHNfaW52aXNpdGM9MTsgc19wcmV2aW91c1VybD1odHRwcyUzQS8vcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tL3VzLWVuL2hlbHAvd2luZG93cy0xMC1zdXBwb3J0LWNlbnRlcjsgc19wcG49RCUzRHY1NTsgc19wcHZsPXBwcy1jZXMlMjU3Q3NpdGVob21lX25ldyUyQzM3JTJDMzclMkM3MTMlMkMxNDYzJTJDNzEzJTJDMTQ2MyUyQzgyMyUyQzEuNzUlMkNQOyBzX3Bwdj1EJTI1M0R2NTUlMkM0OSUyQzQ5JTJDNzEzJTJDMTQ2MyUyQzcxMyUyQzE0NjMlMkM4MjMlMkMxLjc1JTJDUA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>R0VUIC9jb250ZW50L2RhbS9ocC13Y2MvbWljcm9zaXRlLWFzc2V0cy9pbWFnZXMvd2luZG93cy0xMC91MzcxMS5wbmcgSFRUUC8xLjENCkhvc3Q6IHBwc3N1cHBvcnQtaXRnbGxiaDcuaW5jLmhwLmNvbQ0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0Kc2VjLWNoLXVhOiAiQ2hyb21pdW0iO3Y9Ijg4IiwgIkdvb2dsZSBDaHJvbWUiO3Y9Ijg4IiwgIjtOb3QgQSBCcmFuZCI7dj0iOTkiDQpzZWMtY2gtdWEtbW9iaWxlOiA/MA0KVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg4LjAuNDMyNC4xODIgU2FmYXJpLzUzNy4zNg0KQWNjZXB0OiBpbWFnZS9hdmlmLGltYWdlL3dlYnAsaW1hZ2UvYXBuZyxpbWFnZS9zdmcreG1sLGltYWdlLyosKi8qO3E9MC44DQpTZWMtRmV0Y2gtU2l0ZTogc2FtZS1vcmlnaW4NClNlYy1GZXRjaC1Nb2RlOiBuby1jb3JzDQpTZWMtRmV0Y2gtRGVzdDogaW1hZ2UNClJlZmVyZXI6IGh0dHBzOi8vcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tL3VzLWVuL2hlbHAvd2luZG93cy0xMC1zdXBwb3J0LWNlbnRlci1jb21wdXRpbmcNCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZSwgYnINCkFjY2VwdC1MYW5ndWFnZTogZW4tVVMsZW47cT0wLjkNCkNvb2tpZTogX2NzX2M9MTsgQXBwbGljYXRpb25HYXRld2F5QWZmaW5pdHlDT1JTPTZlOTMwNjk1YjNkZGM4MmY1NmM3NjE5Y2U1MDBmOGM3OyBBcHBsaWNhdGlvbkdhdGV3YXlBZmZpbml0eT02ZTkzMDY5NWIzZGRjODJmNTZjNzYxOWNlNTAwZjhjNzsgV1JJZ25vcmU9dHJ1ZTsgQU1DVlNfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTsgc19lY2lkPU1DTUlEJTdDODE5ODU3NjQ1NzUyODA0OTc4NzQzMjYxNjkxMzQ3NzU3ODA3Nzg7IEFNQ1ZfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4NjgzJTdDTUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OCU3Q01DQUFNTEgtMTYxNDc1ODk1NCU3QzklN0NNQ0FBTUItMTYxNDc1ODk1NCU3QzZHMXluWWNMUHVpUXhZWnJzel9wa3FmTEc5eU1YQnBiMnpYNWR2SmRZUUp6UFhJbWRqMHklN0NNQ09QVE9VVC0xNjE0MTYxMzU1cyU3Q05PTkUlN0NNQ0FJRCU3Q05PTkUlN0NNQ1NZTkNTT1AlN0M0MTEtMTg2OTAlN0N2VmVyc2lvbiU3QzQuNC4wOyBrYW1weWxlX3VzZXJpZD0wZmEyLTgyODctYWMzNy1jMTMxLTcyMTEtMGY4Yi1kYzU3LTRmNjg7IGNkX3VzZXJfaWQ9MTc3ZDMxNWU0Y2M2ZmYtMGQ5NWRkMWUwN2JhZjMtNzNlMzU2Yi0xMjVmNTEtMTc3ZDMxNWU0Y2RiYTg7IHNfY2M9dHJ1ZTsgYWFtX3V1aWQ9ODgxMDAzNjU1NjgwMjc3MTk2NzQwMDI4ODYwMzM2NTEzNzE1NjY7IEpTRVNTSU9OSUQ9MDAwMEZhRGFCcDY5TFZaMkNRUXN4RkpCLUFKOjE5ZTBpZmY0Mjsgb3B0aW1pemVseUVuZFVzZXJJZD1vZXUxNjE0MTU0MjQ4NzAycjAuNzQxNjE1MDIxMDU0MjA1OyBfZ2NsX2F1PTEuMS4yOTM3OTkzNDEuMTYxNDE1NDI1MDsgaHBldWNrX3ByZWZzPTExMTExMTsgaHBldWNrX2Fuc3c9MTsgX3JkdF91dWlkPTE2MTQxNTQyNTE0OTAuZDZmZTlhZTMtYjgwNi00NmI4LThhOWUtMTcyZDc0ZDViNGY5OyBfdWV0c2lkPWNmM2ZmYWEwNzY3NzExZWJiNTE3OTk4ZDJiMmIzYWY0OyBfdWV0dmlkPWNmNDA2YTEwNzY3NzExZWJiNTdmN2Q5NjM4YTU4NTAwOyBfY3NfY3ZhcnM9JTdCJTIyMSUyMiUzQSU1QiUyMlRlbXBsYXRlJTIyJTJDJTIyTWljcm9zaXRlLXdpbjEwX2xlYXJuaW5nX2xhbmRpbmclMjIlNUQlN0Q7IF9jc19pZD0wNDM5MTRhOS02NmYyLWEyMDQtYWFlOC02MDJkYWJlZmJiYTQuMTYxNDE1NDE1Mi4xLjE2MTQxNTQyNTEuMTYxNDE1NDE1Mi4xNTg5MzgwMDk4LjE2NDgzMTgxNTI5NzkuTm9uZS4xOyBfY3Nfcz0yLjE7IF9fQ1RfRGF0YT1ncHY9MiZja3A9dGxkJmRtPWhwLmNvbSZhcHZfMzI1X3d3dzExPTImY3B2XzMyNV93d3cxMT0yOyBPcHRhbm9uQWxlcnRCb3hDbG9zZWQ9MjAyMS0wMi0yNFQwODoxMDo1Mi4xOTFaOyBPcHRhbm9uQ29uc2VudD1pc0lBQkdsb2JhbD1mYWxzZSZkYXRlc3RhbXA9V2VkK0ZlYisyNCsyMDIxKzA4JTNBMTAlM0E1MitHTVQlMkIwMDAwKyhHcmVlbndpY2grTWVhbitUaW1lKSZ2ZXJzaW9uPTYuMTQuMCZob3N0cz0mY29uc2VudElkPWFlNjBlOGU5LWMwNzMtNDY3Yy04YzY1LTQ5Y2Q2OTVmZGE1MCZpbnRlcmFjdGlvbkNvdW50PTEmbGFuZGluZ1BhdGg9Tm90TGFuZGluZ1BhZ2UmZ3JvdXBzPTElM0ExJTJDMiUzQTElMkMzJTNBMSUyQzQlM0ExJTJDNSUzQTElMkM2JTNBMSZnZW9sb2NhdGlvbj1VUyUzQk9SJkF3YWl0aW5nUmVjb25zZW50PWZhbHNlOyBrYW1weWxlVXNlclNlc3Npb249MTYxNDE1NDI1MjU0Mjsga2FtcHlsZVVzZXJTZXNzaW9uc0NvdW50PTI7IGthbXB5bGVTZXNzaW9uUGFnZUNvdW50ZXI9MTsgc19wX2NudD0xOyBocF9wdjFfcHJlZnM9MTExMTExOyBzX3ZudW09MTsgc19pbnZpc2l0PTE7IHNfaW52aXNpdGM9MTsgc19wcmV2aW91c1VybD1odHRwcyUzQS8vcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tL3VzLWVuL2hlbHAvd2luZG93cy0xMC1zdXBwb3J0LWNlbnRlcjsgc19wcG49RCUzRHY1NTsgc19wcHZsPXBwcy1jZXMlMjU3Q3NpdGVob21lX25ldyUyQzM3JTJDMzclMkM3MTMlMkMxNDYzJTJDNzEzJTJDMTQ2MyUyQzgyMyUyQzEuNzUlMkNQOyBzX3Bwdj1EJTI1M0R2NTUlMkM0OSUyQzQ5JTJDNzEzJTJDMTQ2MyUyQzcxMyUyQzE0NjMlMkM4MjMlMkMxLjc1JTJDUA0KDQo=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
          <HTTPCookies>
            <HTTPHeaderEntity name="_cs_c" index="0">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="ApplicationGatewayAffinityCORS" index="1">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>NmU5MzA2OTViM2RkYzgyZjU2Yzc2MTljZTUwMGY4Yzc=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="ApplicationGatewayAffinity" index="2">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>NmU5MzA2OTViM2RkYzgyZjU2Yzc2MTljZTUwMGY4Yzc=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="WRIgnore" index="3">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>dHJ1ZQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="AMCVS_5E34123F5245B2CD0A490D45%40AdobeOrg" index="4">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ecid" index="5">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>TUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OA==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="AMCV_5E34123F5245B2CD0A490D45%40AdobeOrg" index="6">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4NjgzJTdDTUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OCU3Q01DQUFNTEgtMTYxNDc1ODk1NCU3QzklN0NNQ0FBTUItMTYxNDc1ODk1NCU3QzZHMXluWWNMUHVpUXhZWnJzel9wa3FmTEc5eU1YQnBiMnpYNWR2SmRZUUp6UFhJbWRqMHklN0NNQ09QVE9VVC0xNjE0MTYxMzU1cyU3Q05PTkUlN0NNQ0FJRCU3Q05PTkUlN0NNQ1NZTkNTT1AlN0M0MTEtMTg2OTAlN0N2VmVyc2lvbiU3QzQuNC4w</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyle_userid" index="7">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MGZhMi04Mjg3LWFjMzctYzEzMS03MjExLTBmOGItZGM1Ny00ZjY4</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="cd_user_id" index="8">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTc3ZDMxNWU0Y2M2ZmYtMGQ5NWRkMWUwN2JhZjMtNzNlMzU2Yi0xMjVmNTEtMTc3ZDMxNWU0Y2RiYTg=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_cc" index="9">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>dHJ1ZQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="aam_uuid" index="10">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>ODgxMDAzNjU1NjgwMjc3MTk2NzQwMDI4ODYwMzM2NTEzNzE1NjY=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="JSESSIONID" index="11">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MDAwMEZhRGFCcDY5TFZaMkNRUXN4RkpCLUFKOjE5ZTBpZmY0Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="optimizelyEndUserId" index="12">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>b2V1MTYxNDE1NDI0ODcwMnIwLjc0MTYxNTAyMTA1NDIwNQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_gcl_au" index="13">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MS4xLjI5Mzc5OTM0MS4xNjE0MTU0MjUw</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="hpeuck_prefs" index="14">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTExMTEx</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="hpeuck_answ" index="15">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_rdt_uuid" index="16">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTYxNDE1NDI1MTQ5MC5kNmZlOWFlMy1iODA2LTQ2YjgtOGE5ZS0xNzJkNzRkNWI0Zjk=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_uetsid" index="17">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Y2YzZmZhYTA3Njc3MTFlYmI1MTc5OThkMmIyYjNhZjQ=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_uetvid" index="18">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Y2Y0MDZhMTA3Njc3MTFlYmI1N2Y3ZDk2MzhhNTg1MDA=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_cs_cvars" index="19">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>JTdCJTIyMSUyMiUzQSU1QiUyMlRlbXBsYXRlJTIyJTJDJTIyTWljcm9zaXRlLXdpbjEwX2xlYXJuaW5nX2xhbmRpbmclMjIlNUQlN0Q=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_cs_id" index="20">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MDQzOTE0YTktNjZmMi1hMjA0LWFhZTgtNjAyZGFiZWZiYmE0LjE2MTQxNTQxNTIuMS4xNjE0MTU0MjUxLjE2MTQxNTQxNTIuMTU4OTM4MDA5OC4xNjQ4MzE4MTUyOTc5Lk5vbmUuMQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_cs_s" index="21">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Mi4x</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="__CT_Data" index="22">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Z3B2PTImY2twPXRsZCZkbT1ocC5jb20mYXB2XzMyNV93d3cxMT0yJmNwdl8zMjVfd3d3MTE9Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="OptanonAlertBoxClosed" index="23">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MjAyMS0wMi0yNFQwODoxMDo1Mi4xOTFa</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="OptanonConsent" index="24">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>aXNJQUJHbG9iYWw9ZmFsc2UmZGF0ZXN0YW1wPVdlZCtGZWIrMjQrMjAyMSswOCUzQTEwJTNBNTIrR01UJTJCMDAwMCsoR3JlZW53aWNoK01lYW4rVGltZSkmdmVyc2lvbj02LjE0LjAmaG9zdHM9JmNvbnNlbnRJZD1hZTYwZThlOS1jMDczLTQ2N2MtOGM2NS00OWNkNjk1ZmRhNTAmaW50ZXJhY3Rpb25Db3VudD0xJmxhbmRpbmdQYXRoPU5vdExhbmRpbmdQYWdlJmdyb3Vwcz0xJTNBMSUyQzIlM0ExJTJDMyUzQTElMkM0JTNBMSUyQzUlM0ExJTJDNiUzQTEmZ2VvbG9jYXRpb249VVMlM0JPUiZBd2FpdGluZ1JlY29uc2VudD1mYWxzZQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyleUserSession" index="25">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTYxNDE1NDI1MjU0Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyleUserSessionsCount" index="26">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyleSessionPageCounter" index="27">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_p_cnt" index="28">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="hp_pv1_prefs" index="29">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTExMTEx</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_vnum" index="30">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_invisit" index="31">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_invisitc" index="32">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_previousUrl" index="33">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>aHR0cHMlM0EvL3Bwc3N1cHBvcnQtaXRnbGxiaDcuaW5jLmhwLmNvbS91cy1lbi9oZWxwL3dpbmRvd3MtMTAtc3VwcG9ydC1jZW50ZXI=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ppn" index="34">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>RCUzRHY1NQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ppvl" index="35">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>cHBzLWNlcyUyNTdDc2l0ZWhvbWVfbmV3JTJDMzclMkMzNyUyQzcxMyUyQzE0NjMlMkM3MTMlMkMxNDYzJTJDODIzJTJDMS43NSUyQ1A=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ppv" index="36">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>RCUyNTNEdjU1JTJDNDklMkM0OSUyQzcxMyUyQzE0NjMlMkM3MTMlMkMxNDYzJTJDODIzJTJDMS43NSUyQ1A=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
          </HTTPCookies>
        </HTTPHeaders>
      </HTTPRequest>
      <HTTPResponse>
        <contentLenght>4444</contentLenght>
        <HTTPHeaders>
          <HTTPHeaderEntity name="Server" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bmdpbngvMS4xOC4w</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Date" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAyNCBGZWIgMjAyMSAwODoxMTozNiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Content-Type" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aW1hZ2UvcG5n</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Content-Length" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NDQ0NA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Dispatcher" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZGlzcGF0Y2hlcjFlYXN0dXMy</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Vhost" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>d2ViLWN1c3RvbWVyLWNhcmU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Content-Type-Options" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm9zbmlmZg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Last-Modified" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAwMiBEZWMgMjAyMCAyMTo1NDoxNyBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ETag" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>IjExNWMtNWI1ODI0OGU2OTQ0MCI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Ranges" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Ynl0ZXM=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frame-Options" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>U0FNRU9SSUdJTg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frame-Options" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>REVOWQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Content-Type-Options" index="13">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm9zbmlmZg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-XSS-Protection" index="14">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTsgbW9kZT1ibG9jaw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Strict-Transport-Security" index="15">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referrer-Policy" index="16">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Access-Control-Allow-Origin" index="17">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Kg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Access-Control-Allow-Credentials" index="18">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dHJ1ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frame-Options" index="19">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>REVOWQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Content-Type-Options" index="20">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm9zbmlmZg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-XSS-Protection" index="21">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTsgbW9kZT1ibG9jaw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Strict-Transport-Security" index="22">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referrer-Policy" index="23">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Expires" index="24">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAwMyBNYXIgMjAyMSAwODoxMTozNiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cache-Control" index="25">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT02MDQ4MDA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IG5naW54LzEuMTguMA0KRGF0ZTogV2VkLCAyNCBGZWIgMjAyMSAwODoxMTozNiBHTVQNCkNvbnRlbnQtVHlwZTogaW1hZ2UvcG5nDQpDb250ZW50LUxlbmd0aDogNDQ0NA0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KWC1EaXNwYXRjaGVyOiBkaXNwYXRjaGVyMWVhc3R1czINClgtVmhvc3Q6IHdlYi1jdXN0b21lci1jYXJlDQpYLUNvbnRlbnQtVHlwZS1PcHRpb25zOiBub3NuaWZmDQpMYXN0LU1vZGlmaWVkOiBXZWQsIDAyIERlYyAyMDIwIDIxOjU0OjE3IEdNVA0KRVRhZzogIjExNWMtNWI1ODI0OGU2OTQ0MCINCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpYLUZyYW1lLU9wdGlvbnM6IFNBTUVPUklHSU4NClgtRnJhbWUtT3B0aW9uczogREVOWQ0KWC1Db250ZW50LVR5cGUtT3B0aW9uczogbm9zbmlmZg0KWC1YU1MtUHJvdGVjdGlvbjogMTsgbW9kZT1ibG9jaw0KU3RyaWN0LVRyYW5zcG9ydC1TZWN1cml0eTogbWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQNClJlZmVycmVyLVBvbGljeTogbm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGUNCkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbjogKg0KQWNjZXNzLUNvbnRyb2wtQWxsb3ctQ3JlZGVudGlhbHM6IHRydWUNClgtRnJhbWUtT3B0aW9uczogREVOWQ0KWC1Db250ZW50LVR5cGUtT3B0aW9uczogbm9zbmlmZg0KWC1YU1MtUHJvdGVjdGlvbjogMTsgbW9kZT1ibG9jaw0KU3RyaWN0LVRyYW5zcG9ydC1TZWN1cml0eTogbWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQNClJlZmVycmVyLVBvbGljeTogbm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGUNCkV4cGlyZXM6IFdlZCwgMDMgTWFyIDIwMjEgMDg6MTE6MzYgR01UDQpDYWNoZS1Db250cm9sOiBtYXgtYWdlPTYwNDgwMA0KDQo=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
        </HTTPHeaders>
        <HTTPBody>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAMh2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDggNzkuMTY0MDUwLCAyMDE5LzEwLzAxLTE4OjAzOjE2ICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZGFtPSJodHRwOi8vd3d3LmRheS5jb20vZGFtLzEuMCIKICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICBkYW06UGh5c2ljYWxoZWlnaHRpbmluY2hlcz0iLTEuMCIKICAgZGFtOlBoeXNpY2Fsd2lkdGhpbmluY2hlcz0iLTEuMCIKICAgZGFtOkZpbGVmb3JtYXQ9IlBORyIKICAgZGFtOlByb2dyZXNzaXZlPSJubyIKICAgZGFtOnNjZW5lN0NvbXBhbnlJRD0iY3wyMzA0NzgiCiAgIGRhbTpzY2VuZTdQdWJsaXNoZWRCeT0iYXNoaXNoLnRyaXBhdGhpQGhwLmNvbSIKICAgZGFtOmV4dHJhY3RlZD0iMjAyMC0xMS0xNVQwODo0OTowNS4xMDhaIgogICBkYW06Qml0c3BlcnBpeGVsPSIzMiIKICAgZGFtOnNjZW5lN0lEPSJhfDkxNjQ2OTUzNiIKICAgZGFtOnNjZW5lN0Nsb3VkQ29uZmlnUGF0aD0iL2NvbmYvZ2xvYmFsL3NldHRpbmdzL2Nsb3VkY29uZmlncy9kbXNjZW5lNyIKICAgZGFtOk1JTUV0eXBlPSJpbWFnZS9wbmciCiAgIGRhbTpDb21tZW50cz0iU29mdHdhcmU6IEFkb2JlIEltYWdlUmVhZHkmI3hBO1hNTDpjb20uYWRvYmUueG1wOiAmbHQ7P3hwYWNrZXQgYmVnaW49JnF1b3Q777u/JnF1b3Q7IGlkPSZxdW90O1c1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCZxdW90Oz8mZ3Q7JiN4QTsmbHQ7eDp4bXBtZXRhIHhtbG5zOng9JnF1b3Q7YWRvYmU6bnM6bWV0YS8mcXVvdDsgeDp4bXB0az0mcXVvdDtBZG9iZSBYTVAgQ29yZSA1LjYtYzE0OCA3OS4xNjQwNTAsIDIwMTkvMTAvMDEtMTg6MDM6MTYgICAgICAgICZxdW90OyZndDsmI3hBOyAmbHQ7cmRmOlJERiB4bWxuczpyZGY9JnF1b3Q7aHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyZxdW90OyZndDsmI3hBOyAgJmx0O3JkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JnF1b3Q7JnF1b3Q7JiN4QTsgICAgeG1sbnM6ZGFtPSZxdW90O2h0dHA6Ly93d3cuZGF5LmNvbS9kYW0vMS4wJnF1b3Q7JiN4QTsgICAgeG1sbnM6dGlmZj0mcXVvdDtodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyZxdW90OyYjeEE7ICAgIHhtbG5zOmRjPSZxdW90O2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJnF1b3Q7JiN4QTsgICBkYW06UGh5c2ljYWxoZWlnaHRpbmluY2hlcz0mcXVvdDstMS4wJnF1b3Q7JiN4QTsgICBkYW06UGh5c2ljYWx3aWR0aGluaW5jaGVzPSZxdW90Oy0xLjAmcXVvdDsmI3hBOyAgIGRhbTpGaWxlZm9ybWF0PSZxdW90O1BORyZxdW90OyYjeEE7ICAgZGFtOlByb2dyZXNzaXZlPSZxdW90O25vJnF1b3Q7JiN4QTsgICBkYW06ZXh0cmFjdGVkPSZxdW90OzIwMjAtMTEtMTBUMTk6MzY6NDQuMjUwKzA1OjMwJnF1b3Q7JiN4QTsgICBkYW06Qml0c3BlcnBpeGVsPSZxdW90OzMyJnF1b3Q7JiN4QTsgICBkYW06TUlNRXR5cGU9JnF1b3Q7aW1hZ2UvcG5nJnF1b3Q7JiN4QTsgICBkYW06Q29tbWVudHM9JnF1b3Q7U29mdHdhcmU6IEFkb2JlIEltYWdlUmVhZHkmYW1wOyN4QTsmcXVvdDsmI3hBOyAgIGRhbTpQaHlzaWNhbHdpZHRoaW5kcGk9JnF1b3Q7LTEmcXVvdDsmI3hBOyAgIGRhbTpQaHlzaWNhbGhlaWdodGluZHBpPSZxdW90Oy0xJnF1b3Q7JiN4QTsgICBkYW06TnVtYmVyb2ZpbWFnZXM9JnF1b3Q7MSZxdW90OyYjeEE7ICAgZGFtOk51bWJlcm9mdGV4dHVhbGNvbW1lbnRzPSZxdW90OzEmcXVvdDsmI3hBOyAgIGRhbTpzaGExPSZxdW90OzNlZWRhMWU4YmY2NzE4OTBhZTk2MjdiNzg3MGUwZTM2N2Q0Yzc0ZjUmcXVvdDsmI3hBOyAgIGRhbTpzaXplPSZxdW90OzEyMjUmcXVvdDsmI3hBOyAgIHRpZmY6SW1hZ2VMZW5ndGg9JnF1b3Q7NTAmcXVvdDsmI3hBOyAgIHRpZmY6SW1hZ2VXaWR0aD0mcXVvdDs1MCZxdW90OyYjeEE7ICAgZGM6Zm9ybWF0PSZxdW90O2ltYWdlL3BuZyZxdW90OyYjeEE7ICAgZGM6bW9kaWZpZWQ9JnF1b3Q7MjAyMC0xMS0xMFQyMDo0ODoyMC40OTArMDU6MzAmcXVvdDsvJmd0OyYjeEE7ICZsdDsvcmRmOlJERiZndDsmI3hBOyZsdDsveDp4bXBtZXRhJmd0OyYjeEE7Jmx0Oz94cGFja2V0IGVuZD0mcXVvdDtyJnF1b3Q7PyZndDsmI3hBOyIKICAgZGFtOlBoeXNpY2Fsd2lkdGhpbmRwaT0iLTEiCiAgIGRhbTpQaHlzaWNhbGhlaWdodGluZHBpPSItMSIKICAgZGFtOnNjZW5lN0ZpbGVTdGF0dXM9IlB1Ymxpc2hDb21wbGV0ZSIKICAgZGFtOnNjZW5lN0ZpbGU9Imhwc2l0ZXNkZXYvdTM3MTEiCiAgIGRhbTpzY2VuZTdOYW1lPSJ1MzcxMSIKICAgZGFtOnNjZW5lN1R5cGU9IkltYWdlIgogICBkYW06TnVtYmVyb2ZpbWFnZXM9IjEiCiAgIGRhbTpzY2VuZTdVcGxvYWRUaW1lU3RhbXA9IjIwMjAtMTEtMTVUMDg6NDk6MzUuNzYyWiIKICAgZGFtOk51bWJlcm9mdGV4dHVhbGNvbW1lbnRzPSIyIgogICBkYW06c2NlbmU3UHVibGlzaFRpbWVTdGFtcD0iMjAyMC0xMS0xNlQwODo0MTo0NS4wMzhaIgogICBkYW06c2NlbmU3RG9tYWluPSJodHRwOi8vczdkNi5zY2VuZTcuY29tLyIKICAgZGFtOnNjZW5lN0ZvbGRlcj0iaHBzaXRlc2Rldi9ocC13Y2MvbWljcm9zaXRlLWFzc2V0cy9pbWFnZXMvd2luZG93cy0xMC8iCiAgIGRhbTpzaGExPSJjZjcwZjdkYzc1Nzc1NGVjOThiOWM1NjNhZmNiNTYzMzI0NTUxM2Q1IgogICBkYW06c2l6ZT0iMjI5OCIKICAgZGFtOnNjZW5lN0FQSVNlcnZlcj0iaHR0cHM6Ly9zN3NwczFhcGlzc2wuc2NlbmU3LmNvbSIKICAgZGFtOnNjZW5lN0xhc3RNb2RpZmllZD0iMTYwNTQzMDE0ODk5OSIKICAgdGlmZjpJbWFnZUxlbmd0aD0iNTAiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iNTAiCiAgIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIgogICBkYzptb2RpZmllZD0iMjAyMC0xMS0xMFQyMDo0ODoyMC40OTArMDU6MzAiLz4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5Cn0MHAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABGtJREFUeNrsWTlvE0EUHhtxCBGxIBBShMhGSBClgKWgosCmoiKmoKLAoUwT8guIf4FJ4w4ciY7GhooG7IYqSHYoLAJS4iASCSXBTsKRhMPMNztjjTez2cPrI8hPGq+9u55937zje2+WkJ70pCc92U8Scn1nqqTTzxgdl+nQ+dkiHbN0ZMnYcLX7gaRKAJDB10j/UWKcOmKiWN0i+eUf+AoQUxTMZPfbLlVK01FLv6/WZKls/a5NzqzUcI2OAh3avgUDKaz8rGmP5/47MMluUTbOFPYBJjm7JtxMb6fKYZvz43TYgxkbHqWf0xNvvpDy5q+GSw8unSR630ExRweBmP5txC8eJ3uCIWSiuv2nml3Y3HUhNtjHElynLWLg4+HV0yR9o98ejMkbxfWdv7suXacpWszjw6017rpaEK7F3ANWsQWTKkHRyIDpRg2iHT5AfIMgJMeeh6MHMLZAhO9bwGToiLBkQB8EYuQuqPyvHxB0EQw8D0cvYMIKl8njwBm7DiZz8yysFOMrlqbntNytc8pJF00gVW41TyAwJ56Ho1cwqokzkWy55lfA9sazeaTgiiMYMyYK4B/wkF+SDdnyCF313MgAq638CM1oJPriE+oxJIVRXo+pJCksIWo4WVDPYR46HwrUqF1xGtpjpWDqyMLd876Cd/T1MpmeW3e8D3PbgfAKZi+TV/SnH3eZ3Enir5YYu4Plg5IGN/OZ0+GfTLmFjR3XIFTlSxBgePkT8duPTPKSQwO/8BKEZTYpPdfdCb9VablZQdydePKBcPfK++sQTUARRekxjlQ8QsuS2y8/E2uCANjEzAqLBREHIFHcoyvI1GXyGLTGSajpZTLTKxIDS4+V+xfql2AdWAm1FxRhCtGSBsHrJshtQMAaxVaV/QbnjHps4Chiy45nVNzhl5NCgYIxWV+z1mxwN6sbiVVGOWNnGS+WCAVuGUJYekxeO8NcKvp8kYGAwnArJAFccwLj1Z3CATsZa6aQtUSDhaBGwIsC89G7r2zIZIj7uNJtjgn79riBP1RxghrOWsfJMZNb+u6+TmuRRUaw+oI/RMaSeQYrXlzbZq6EayKTNViGuqIfSwQJpAwloSxcRwUC7sIatiGNZMvfCHp+LzVXMFum7rs7Q/Tt6GGsIHifQRJvVxlgmXeaiY/gLAKmHRu+wh4OPzM3IJQgoCw2LXBOuJfCMhpvqoz2WsSy70UVisf0Y8yFrCDkDIVzhTuDtjzTqfQrbxUlaMAXoRBcTAaBYIfycCvtUJhM8XTcjGVaA8R0M1TME2IzQkV+UFYAdGi6NKfePdxSbjFL7SJSKspvK4Mjs8HF7g1pjh0kL0rjnQFighEJoIiYkUGAa8A9TvsCAIP/Iod0DohkGQQ+spXUzydo+VLFbze9fSeC3S4B5NF8URDmzooZR1H8dgLD99nKpKuF9zOq3kWu2VS9eteCQcGYmd9gALDZIb3WS7efEJvrZ/DSVZe5kbh40RrqWuuITtOyW9KTnvTEn/wTYACftw/LekjnSgAAAABJRU5ErkJggg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPBody>
        <TcpPackets>
          <PacketInfo time="364148796" offset="0" length="5370" />
        </TcpPackets>
      </HTTPResponse>
    </HTTPTask>
    <HTTPTask id="3384" hostname="ppssupport-itgllbh7.inc.hp.com" path="/content/dam/hp-wcc/microsite-assets/images/windows-10/win10-setup.png" url="https://ppssupport-itgllbh7.inc.hp.com/content/dam/hp-wcc/microsite-assets/images/windows-10/win10-setup.png" ip="15.72.22.19" port="443" connectionId="97" origin="HTML" frame="1" startDateTime="2021-02-24T08:15:04.314+00:00" startTime="364148640" endTime="364148843">
      <HTTPRequest method="GET">
        <HTTPHeaders>
          <HTTPHeaderEntity name="Host" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>cHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29t</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="sec-ch-ua" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>IkNocm9taXVtIjt2PSI4OCIsICJHb29nbGUgQ2hyb21lIjt2PSI4OCIsICI7Tm90IEEgQnJhbmQiO3Y9Ijk5Ig==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="sec-ch-ua-mobile" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>PzA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="User-Agent" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg4LjAuNDMyNC4xODIgU2FmYXJpLzUzNy4zNg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aW1hZ2UvYXZpZixpbWFnZS93ZWJwLGltYWdlL2FwbmcsaW1hZ2Uvc3ZnK3htbCxpbWFnZS8qLCovKjtxPTAuOA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Site" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>c2FtZS1vcmlnaW4=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Mode" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tY29ycw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Sec-Fetch-Dest" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aW1hZ2U=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referer" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aHR0cHM6Ly9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20vdXMtZW4vaGVscC93aW5kb3dzLTEwLXN1cHBvcnQtY2VudGVyLWNvbXB1dGluZw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Encoding" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Language" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cookie" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>X2NzX2M9MTsgQXBwbGljYXRpb25HYXRld2F5QWZmaW5pdHlDT1JTPTZlOTMwNjk1YjNkZGM4MmY1NmM3NjE5Y2U1MDBmOGM3OyBBcHBsaWNhdGlvbkdhdGV3YXlBZmZpbml0eT02ZTkzMDY5NWIzZGRjODJmNTZjNzYxOWNlNTAwZjhjNzsgV1JJZ25vcmU9dHJ1ZTsgQU1DVlNfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTsgc19lY2lkPU1DTUlEJTdDODE5ODU3NjQ1NzUyODA0OTc4NzQzMjYxNjkxMzQ3NzU3ODA3Nzg7IEFNQ1ZfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4NjgzJTdDTUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OCU3Q01DQUFNTEgtMTYxNDc1ODk1NCU3QzklN0NNQ0FBTUItMTYxNDc1ODk1NCU3QzZHMXluWWNMUHVpUXhZWnJzel9wa3FmTEc5eU1YQnBiMnpYNWR2SmRZUUp6UFhJbWRqMHklN0NNQ09QVE9VVC0xNjE0MTYxMzU1cyU3Q05PTkUlN0NNQ0FJRCU3Q05PTkUlN0NNQ1NZTkNTT1AlN0M0MTEtMTg2OTAlN0N2VmVyc2lvbiU3QzQuNC4wOyBrYW1weWxlX3VzZXJpZD0wZmEyLTgyODctYWMzNy1jMTMxLTcyMTEtMGY4Yi1kYzU3LTRmNjg7IGNkX3VzZXJfaWQ9MTc3ZDMxNWU0Y2M2ZmYtMGQ5NWRkMWUwN2JhZjMtNzNlMzU2Yi0xMjVmNTEtMTc3ZDMxNWU0Y2RiYTg7IHNfY2M9dHJ1ZTsgYWFtX3V1aWQ9ODgxMDAzNjU1NjgwMjc3MTk2NzQwMDI4ODYwMzM2NTEzNzE1NjY7IEpTRVNTSU9OSUQ9MDAwMEZhRGFCcDY5TFZaMkNRUXN4RkpCLUFKOjE5ZTBpZmY0Mjsgb3B0aW1pemVseUVuZFVzZXJJZD1vZXUxNjE0MTU0MjQ4NzAycjAuNzQxNjE1MDIxMDU0MjA1OyBfZ2NsX2F1PTEuMS4yOTM3OTkzNDEuMTYxNDE1NDI1MDsgaHBldWNrX3ByZWZzPTExMTExMTsgaHBldWNrX2Fuc3c9MTsgX3JkdF91dWlkPTE2MTQxNTQyNTE0OTAuZDZmZTlhZTMtYjgwNi00NmI4LThhOWUtMTcyZDc0ZDViNGY5OyBfdWV0c2lkPWNmM2ZmYWEwNzY3NzExZWJiNTE3OTk4ZDJiMmIzYWY0OyBfdWV0dmlkPWNmNDA2YTEwNzY3NzExZWJiNTdmN2Q5NjM4YTU4NTAwOyBfY3NfY3ZhcnM9JTdCJTIyMSUyMiUzQSU1QiUyMlRlbXBsYXRlJTIyJTJDJTIyTWljcm9zaXRlLXdpbjEwX2xlYXJuaW5nX2xhbmRpbmclMjIlNUQlN0Q7IF9jc19pZD0wNDM5MTRhOS02NmYyLWEyMDQtYWFlOC02MDJkYWJlZmJiYTQuMTYxNDE1NDE1Mi4xLjE2MTQxNTQyNTEuMTYxNDE1NDE1Mi4xNTg5MzgwMDk4LjE2NDgzMTgxNTI5NzkuTm9uZS4xOyBfY3Nfcz0yLjE7IF9fQ1RfRGF0YT1ncHY9MiZja3A9dGxkJmRtPWhwLmNvbSZhcHZfMzI1X3d3dzExPTImY3B2XzMyNV93d3cxMT0yOyBPcHRhbm9uQWxlcnRCb3hDbG9zZWQ9MjAyMS0wMi0yNFQwODoxMDo1Mi4xOTFaOyBPcHRhbm9uQ29uc2VudD1pc0lBQkdsb2JhbD1mYWxzZSZkYXRlc3RhbXA9V2VkK0ZlYisyNCsyMDIxKzA4JTNBMTAlM0E1MitHTVQlMkIwMDAwKyhHcmVlbndpY2grTWVhbitUaW1lKSZ2ZXJzaW9uPTYuMTQuMCZob3N0cz0mY29uc2VudElkPWFlNjBlOGU5LWMwNzMtNDY3Yy04YzY1LTQ5Y2Q2OTVmZGE1MCZpbnRlcmFjdGlvbkNvdW50PTEmbGFuZGluZ1BhdGg9Tm90TGFuZGluZ1BhZ2UmZ3JvdXBzPTElM0ExJTJDMiUzQTElMkMzJTNBMSUyQzQlM0ExJTJDNSUzQTElMkM2JTNBMSZnZW9sb2NhdGlvbj1VUyUzQk9SJkF3YWl0aW5nUmVjb25zZW50PWZhbHNlOyBrYW1weWxlVXNlclNlc3Npb249MTYxNDE1NDI1MjU0Mjsga2FtcHlsZVVzZXJTZXNzaW9uc0NvdW50PTI7IGthbXB5bGVTZXNzaW9uUGFnZUNvdW50ZXI9MTsgc19wX2NudD0xOyBocF9wdjFfcHJlZnM9MTExMTExOyBzX3ZudW09MTsgc19pbnZpc2l0PTE7IHNfaW52aXNpdGM9MTsgc19wcmV2aW91c1VybD1odHRwcyUzQS8vcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tL3VzLWVuL2hlbHAvd2luZG93cy0xMC1zdXBwb3J0LWNlbnRlcjsgc19wcG49RCUzRHY1NTsgc19wcHZsPXBwcy1jZXMlMjU3Q3NpdGVob21lX25ldyUyQzM3JTJDMzclMkM3MTMlMkMxNDYzJTJDNzEzJTJDMTQ2MyUyQzgyMyUyQzEuNzUlMkNQOyBzX3Bwdj1EJTI1M0R2NTUlMkM0OSUyQzQ5JTJDNzEzJTJDMTQ2MyUyQzcxMyUyQzE0NjMlMkM4MjMlMkMxLjc1JTJDUA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>R0VUIC9jb250ZW50L2RhbS9ocC13Y2MvbWljcm9zaXRlLWFzc2V0cy9pbWFnZXMvd2luZG93cy0xMC93aW4xMC1zZXR1cC5wbmcgSFRUUC8xLjENCkhvc3Q6IHBwc3N1cHBvcnQtaXRnbGxiaDcuaW5jLmhwLmNvbQ0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0Kc2VjLWNoLXVhOiAiQ2hyb21pdW0iO3Y9Ijg4IiwgIkdvb2dsZSBDaHJvbWUiO3Y9Ijg4IiwgIjtOb3QgQSBCcmFuZCI7dj0iOTkiDQpzZWMtY2gtdWEtbW9iaWxlOiA/MA0KVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg4LjAuNDMyNC4xODIgU2FmYXJpLzUzNy4zNg0KQWNjZXB0OiBpbWFnZS9hdmlmLGltYWdlL3dlYnAsaW1hZ2UvYXBuZyxpbWFnZS9zdmcreG1sLGltYWdlLyosKi8qO3E9MC44DQpTZWMtRmV0Y2gtU2l0ZTogc2FtZS1vcmlnaW4NClNlYy1GZXRjaC1Nb2RlOiBuby1jb3JzDQpTZWMtRmV0Y2gtRGVzdDogaW1hZ2UNClJlZmVyZXI6IGh0dHBzOi8vcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tL3VzLWVuL2hlbHAvd2luZG93cy0xMC1zdXBwb3J0LWNlbnRlci1jb21wdXRpbmcNCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZSwgYnINCkFjY2VwdC1MYW5ndWFnZTogZW4tVVMsZW47cT0wLjkNCkNvb2tpZTogX2NzX2M9MTsgQXBwbGljYXRpb25HYXRld2F5QWZmaW5pdHlDT1JTPTZlOTMwNjk1YjNkZGM4MmY1NmM3NjE5Y2U1MDBmOGM3OyBBcHBsaWNhdGlvbkdhdGV3YXlBZmZpbml0eT02ZTkzMDY5NWIzZGRjODJmNTZjNzYxOWNlNTAwZjhjNzsgV1JJZ25vcmU9dHJ1ZTsgQU1DVlNfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTsgc19lY2lkPU1DTUlEJTdDODE5ODU3NjQ1NzUyODA0OTc4NzQzMjYxNjkxMzQ3NzU3ODA3Nzg7IEFNQ1ZfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4NjgzJTdDTUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OCU3Q01DQUFNTEgtMTYxNDc1ODk1NCU3QzklN0NNQ0FBTUItMTYxNDc1ODk1NCU3QzZHMXluWWNMUHVpUXhZWnJzel9wa3FmTEc5eU1YQnBiMnpYNWR2SmRZUUp6UFhJbWRqMHklN0NNQ09QVE9VVC0xNjE0MTYxMzU1cyU3Q05PTkUlN0NNQ0FJRCU3Q05PTkUlN0NNQ1NZTkNTT1AlN0M0MTEtMTg2OTAlN0N2VmVyc2lvbiU3QzQuNC4wOyBrYW1weWxlX3VzZXJpZD0wZmEyLTgyODctYWMzNy1jMTMxLTcyMTEtMGY4Yi1kYzU3LTRmNjg7IGNkX3VzZXJfaWQ9MTc3ZDMxNWU0Y2M2ZmYtMGQ5NWRkMWUwN2JhZjMtNzNlMzU2Yi0xMjVmNTEtMTc3ZDMxNWU0Y2RiYTg7IHNfY2M9dHJ1ZTsgYWFtX3V1aWQ9ODgxMDAzNjU1NjgwMjc3MTk2NzQwMDI4ODYwMzM2NTEzNzE1NjY7IEpTRVNTSU9OSUQ9MDAwMEZhRGFCcDY5TFZaMkNRUXN4RkpCLUFKOjE5ZTBpZmY0Mjsgb3B0aW1pemVseUVuZFVzZXJJZD1vZXUxNjE0MTU0MjQ4NzAycjAuNzQxNjE1MDIxMDU0MjA1OyBfZ2NsX2F1PTEuMS4yOTM3OTkzNDEuMTYxNDE1NDI1MDsgaHBldWNrX3ByZWZzPTExMTExMTsgaHBldWNrX2Fuc3c9MTsgX3JkdF91dWlkPTE2MTQxNTQyNTE0OTAuZDZmZTlhZTMtYjgwNi00NmI4LThhOWUtMTcyZDc0ZDViNGY5OyBfdWV0c2lkPWNmM2ZmYWEwNzY3NzExZWJiNTE3OTk4ZDJiMmIzYWY0OyBfdWV0dmlkPWNmNDA2YTEwNzY3NzExZWJiNTdmN2Q5NjM4YTU4NTAwOyBfY3NfY3ZhcnM9JTdCJTIyMSUyMiUzQSU1QiUyMlRlbXBsYXRlJTIyJTJDJTIyTWljcm9zaXRlLXdpbjEwX2xlYXJuaW5nX2xhbmRpbmclMjIlNUQlN0Q7IF9jc19pZD0wNDM5MTRhOS02NmYyLWEyMDQtYWFlOC02MDJkYWJlZmJiYTQuMTYxNDE1NDE1Mi4xLjE2MTQxNTQyNTEuMTYxNDE1NDE1Mi4xNTg5MzgwMDk4LjE2NDgzMTgxNTI5NzkuTm9uZS4xOyBfY3Nfcz0yLjE7IF9fQ1RfRGF0YT1ncHY9MiZja3A9dGxkJmRtPWhwLmNvbSZhcHZfMzI1X3d3dzExPTImY3B2XzMyNV93d3cxMT0yOyBPcHRhbm9uQWxlcnRCb3hDbG9zZWQ9MjAyMS0wMi0yNFQwODoxMDo1Mi4xOTFaOyBPcHRhbm9uQ29uc2VudD1pc0lBQkdsb2JhbD1mYWxzZSZkYXRlc3RhbXA9V2VkK0ZlYisyNCsyMDIxKzA4JTNBMTAlM0E1MitHTVQlMkIwMDAwKyhHcmVlbndpY2grTWVhbitUaW1lKSZ2ZXJzaW9uPTYuMTQuMCZob3N0cz0mY29uc2VudElkPWFlNjBlOGU5LWMwNzMtNDY3Yy04YzY1LTQ5Y2Q2OTVmZGE1MCZpbnRlcmFjdGlvbkNvdW50PTEmbGFuZGluZ1BhdGg9Tm90TGFuZGluZ1BhZ2UmZ3JvdXBzPTElM0ExJTJDMiUzQTElMkMzJTNBMSUyQzQlM0ExJTJDNSUzQTElMkM2JTNBMSZnZW9sb2NhdGlvbj1VUyUzQk9SJkF3YWl0aW5nUmVjb25zZW50PWZhbHNlOyBrYW1weWxlVXNlclNlc3Npb249MTYxNDE1NDI1MjU0Mjsga2FtcHlsZVVzZXJTZXNzaW9uc0NvdW50PTI7IGthbXB5bGVTZXNzaW9uUGFnZUNvdW50ZXI9MTsgc19wX2NudD0xOyBocF9wdjFfcHJlZnM9MTExMTExOyBzX3ZudW09MTsgc19pbnZpc2l0PTE7IHNfaW52aXNpdGM9MTsgc19wcmV2aW91c1VybD1odHRwcyUzQS8vcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tL3VzLWVuL2hlbHAvd2luZG93cy0xMC1zdXBwb3J0LWNlbnRlcjsgc19wcG49RCUzRHY1NTsgc19wcHZsPXBwcy1jZXMlMjU3Q3NpdGVob21lX25ldyUyQzM3JTJDMzclMkM3MTMlMkMxNDYzJTJDNzEzJTJDMTQ2MyUyQzgyMyUyQzEuNzUlMkNQOyBzX3Bwdj1EJTI1M0R2NTUlMkM0OSUyQzQ5JTJDNzEzJTJDMTQ2MyUyQzcxMyUyQzE0NjMlMkM4MjMlMkMxLjc1JTJDUA0KDQo=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
          <HTTPCookies>
            <HTTPHeaderEntity name="_cs_c" index="0">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="ApplicationGatewayAffinityCORS" index="1">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>NmU5MzA2OTViM2RkYzgyZjU2Yzc2MTljZTUwMGY4Yzc=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="ApplicationGatewayAffinity" index="2">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>NmU5MzA2OTViM2RkYzgyZjU2Yzc2MTljZTUwMGY4Yzc=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="WRIgnore" index="3">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>dHJ1ZQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="AMCVS_5E34123F5245B2CD0A490D45%40AdobeOrg" index="4">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ecid" index="5">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>TUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OA==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="AMCV_5E34123F5245B2CD0A490D45%40AdobeOrg" index="6">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4NjgzJTdDTUNNSUQlN0M4MTk4NTc2NDU3NTI4MDQ5Nzg3NDMyNjE2OTEzNDc3NTc4MDc3OCU3Q01DQUFNTEgtMTYxNDc1ODk1NCU3QzklN0NNQ0FBTUItMTYxNDc1ODk1NCU3QzZHMXluWWNMUHVpUXhZWnJzel9wa3FmTEc5eU1YQnBiMnpYNWR2SmRZUUp6UFhJbWRqMHklN0NNQ09QVE9VVC0xNjE0MTYxMzU1cyU3Q05PTkUlN0NNQ0FJRCU3Q05PTkUlN0NNQ1NZTkNTT1AlN0M0MTEtMTg2OTAlN0N2VmVyc2lvbiU3QzQuNC4w</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyle_userid" index="7">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MGZhMi04Mjg3LWFjMzctYzEzMS03MjExLTBmOGItZGM1Ny00ZjY4</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="cd_user_id" index="8">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTc3ZDMxNWU0Y2M2ZmYtMGQ5NWRkMWUwN2JhZjMtNzNlMzU2Yi0xMjVmNTEtMTc3ZDMxNWU0Y2RiYTg=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_cc" index="9">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>dHJ1ZQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="aam_uuid" index="10">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>ODgxMDAzNjU1NjgwMjc3MTk2NzQwMDI4ODYwMzM2NTEzNzE1NjY=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="JSESSIONID" index="11">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MDAwMEZhRGFCcDY5TFZaMkNRUXN4RkpCLUFKOjE5ZTBpZmY0Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="optimizelyEndUserId" index="12">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>b2V1MTYxNDE1NDI0ODcwMnIwLjc0MTYxNTAyMTA1NDIwNQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_gcl_au" index="13">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MS4xLjI5Mzc5OTM0MS4xNjE0MTU0MjUw</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="hpeuck_prefs" index="14">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTExMTEx</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="hpeuck_answ" index="15">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_rdt_uuid" index="16">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTYxNDE1NDI1MTQ5MC5kNmZlOWFlMy1iODA2LTQ2YjgtOGE5ZS0xNzJkNzRkNWI0Zjk=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_uetsid" index="17">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Y2YzZmZhYTA3Njc3MTFlYmI1MTc5OThkMmIyYjNhZjQ=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_uetvid" index="18">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Y2Y0MDZhMTA3Njc3MTFlYmI1N2Y3ZDk2MzhhNTg1MDA=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_cs_cvars" index="19">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>JTdCJTIyMSUyMiUzQSU1QiUyMlRlbXBsYXRlJTIyJTJDJTIyTWljcm9zaXRlLXdpbjEwX2xlYXJuaW5nX2xhbmRpbmclMjIlNUQlN0Q=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_cs_id" index="20">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MDQzOTE0YTktNjZmMi1hMjA0LWFhZTgtNjAyZGFiZWZiYmE0LjE2MTQxNTQxNTIuMS4xNjE0MTU0MjUxLjE2MTQxNTQxNTIuMTU4OTM4MDA5OC4xNjQ4MzE4MTUyOTc5Lk5vbmUuMQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="_cs_s" index="21">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Mi4x</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="__CT_Data" index="22">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Z3B2PTImY2twPXRsZCZkbT1ocC5jb20mYXB2XzMyNV93d3cxMT0yJmNwdl8zMjVfd3d3MTE9Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="OptanonAlertBoxClosed" index="23">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MjAyMS0wMi0yNFQwODoxMDo1Mi4xOTFa</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="OptanonConsent" index="24">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>aXNJQUJHbG9iYWw9ZmFsc2UmZGF0ZXN0YW1wPVdlZCtGZWIrMjQrMjAyMSswOCUzQTEwJTNBNTIrR01UJTJCMDAwMCsoR3JlZW53aWNoK01lYW4rVGltZSkmdmVyc2lvbj02LjE0LjAmaG9zdHM9JmNvbnNlbnRJZD1hZTYwZThlOS1jMDczLTQ2N2MtOGM2NS00OWNkNjk1ZmRhNTAmaW50ZXJhY3Rpb25Db3VudD0xJmxhbmRpbmdQYXRoPU5vdExhbmRpbmdQYWdlJmdyb3Vwcz0xJTNBMSUyQzIlM0ExJTJDMyUzQTElMkM0JTNBMSUyQzUlM0ExJTJDNiUzQTEmZ2VvbG9jYXRpb249VVMlM0JPUiZBd2FpdGluZ1JlY29uc2VudD1mYWxzZQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyleUserSession" index="25">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTYxNDE1NDI1MjU0Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyleUserSessionsCount" index="26">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>Mg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="kampyleSessionPageCounter" index="27">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_p_cnt" index="28">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="hp_pv1_prefs" index="29">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MTExMTEx</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_vnum" index="30">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_invisit" index="31">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_invisitc" index="32">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_previousUrl" index="33">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>aHR0cHMlM0EvL3Bwc3N1cHBvcnQtaXRnbGxiaDcuaW5jLmhwLmNvbS91cy1lbi9oZWxwL3dpbmRvd3MtMTAtc3VwcG9ydC1jZW50ZXI=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ppn" index="34">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>RCUzRHY1NQ==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ppvl" index="35">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>cHBzLWNlcyUyNTdDc2l0ZWhvbWVfbmV3JTJDMzclMkMzNyUyQzcxMyUyQzE0NjMlMkM3MTMlMkMxNDYzJTJDODIzJTJDMS43NSUyQ1A=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="s_ppv" index="36">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>RCUyNTNEdjU1JTJDNDklMkM0OSUyQzcxMyUyQzE0NjMlMkM3MTMlMkMxNDYzJTJDODIzJTJDMS43NSUyQ1A=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
          </HTTPCookies>
        </HTTPHeaders>
      </HTTPRequest>
      <HTTPResponse>
        <contentLenght>5567</contentLenght>
        <HTTPHeaders>
          <HTTPHeaderEntity name="Server" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bmdpbngvMS4xOC4w</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Date" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAyNCBGZWIgMjAyMSAwODoxMTozNiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Content-Type" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aW1hZ2UvcG5n</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Content-Length" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NTU2Nw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Dispatcher" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZGlzcGF0Y2hlcjFlYXN0dXMy</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Vhost" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>d2ViLWN1c3RvbWVyLWNhcmU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Content-Type-Options" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm9zbmlmZg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Last-Modified" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAwMiBEZWMgMjAyMCAyMTo1NDoyNCBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ETag" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>IjE1YmYtNWI1ODI0OTUxNjQwMCI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Ranges" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Ynl0ZXM=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frame-Options" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>U0FNRU9SSUdJTg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frame-Options" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>REVOWQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Content-Type-Options" index="13">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm9zbmlmZg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-XSS-Protection" index="14">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTsgbW9kZT1ibG9jaw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Strict-Transport-Security" index="15">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referrer-Policy" index="16">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Access-Control-Allow-Origin" index="17">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Kg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Access-Control-Allow-Credentials" index="18">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dHJ1ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frame-Options" index="19">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>REVOWQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Content-Type-Options" index="20">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm9zbmlmZg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-XSS-Protection" index="21">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTsgbW9kZT1ibG9jaw==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Strict-Transport-Security" index="22">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referrer-Policy" index="23">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Expires" index="24">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAwMyBNYXIgMjAyMSAwODoxMTozNiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cache-Control" index="25">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT02MDQ4MDA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IG5naW54LzEuMTguMA0KRGF0ZTogV2VkLCAyNCBGZWIgMjAyMSAwODoxMTozNiBHTVQNCkNvbnRlbnQtVHlwZTogaW1hZ2UvcG5nDQpDb250ZW50LUxlbmd0aDogNTU2Nw0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KWC1EaXNwYXRjaGVyOiBkaXNwYXRjaGVyMWVhc3R1czINClgtVmhvc3Q6IHdlYi1jdXN0b21lci1jYXJlDQpYLUNvbnRlbnQtVHlwZS1PcHRpb25zOiBub3NuaWZmDQpMYXN0LU1vZGlmaWVkOiBXZWQsIDAyIERlYyAyMDIwIDIxOjU0OjI0IEdNVA0KRVRhZzogIjE1YmYtNWI1ODI0OTUxNjQwMCINCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpYLUZyYW1lLU9wdGlvbnM6IFNBTUVPUklHSU4NClgtRnJhbWUtT3B0aW9uczogREVOWQ0KWC1Db250ZW50LVR5cGUtT3B0aW9uczogbm9zbmlmZg0KWC1YU1MtUHJvdGVjdGlvbjogMTsgbW9kZT1ibG9jaw0KU3RyaWN0LVRyYW5zcG9ydC1TZWN1cml0eTogbWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQNClJlZmVycmVyLVBvbGljeTogbm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGUNCkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbjogKg0KQWNjZXNzLUNvbnRyb2wtQWxsb3ctQ3JlZGVudGlhbHM6IHRydWUNClgtRnJhbWUtT3B0aW9uczogREVOWQ0KWC1Db250ZW50LVR5cGUtT3B0aW9uczogbm9zbmlmZg0KWC1YU1MtUHJvdGVjdGlvbjogMTsgbW9kZT1ibG9jaw0KU3RyaWN0LVRyYW5zcG9ydC1TZWN1cml0eTogbWF4LWFnZT0xNTc2ODAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQNClJlZmVycmVyLVBvbGljeTogbm8tcmVmZXJyZXItd2hlbi1kb3duZ3JhZGUNCkV4cGlyZXM6IFdlZCwgMDMgTWFyIDIwMjEgMDg6MTE6MzYgR01UDQpDYWNoZS1Db250cm9sOiBtYXgtYWdlPTYwNDgwMA0KDQo=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
        </HTTPHeaders>
        <HTTPBody>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAT8mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDggNzkuMTY0MDUwLCAyMDE5LzEwLzAxLTE4OjAzOjE2ICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZGFtPSJodHRwOi8vd3d3LmRheS5jb20vZGFtLzEuMCIKICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICBkYW06UGh5c2ljYWxoZWlnaHRpbmluY2hlcz0iLTEuMCIKICAgZGFtOlBoeXNpY2Fsd2lkdGhpbmluY2hlcz0iLTEuMCIKICAgZGFtOkZpbGVmb3JtYXQ9IlBORyIKICAgZGFtOlByb2dyZXNzaXZlPSJubyIKICAgZGFtOnNjZW5lN0NvbXBhbnlJRD0iY3wyMzA0NzgiCiAgIGRhbTpzY2VuZTdQdWJsaXNoZWRCeT0iYXNoaXNoLnRyaXBhdGhpQGhwLmNvbSIKICAgZGFtOmV4dHJhY3RlZD0iMjAyMC0xMS0xNVQwODo0OTowNS41NzVaIgogICBkYW06Qml0c3BlcnBpeGVsPSI4IgogICBkYW06c2NlbmU3SUQ9ImF8OTE2NDcxMTIwIgogICBkYW06c2NlbmU3Q2xvdWRDb25maWdQYXRoPSIvY29uZi9nbG9iYWwvc2V0dGluZ3MvY2xvdWRjb25maWdzL2Rtc2NlbmU3IgogICBkYW06TUlNRXR5cGU9ImltYWdlL3BuZyIKICAgZGFtOkNvbW1lbnRzPSJTb2Z0d2FyZTogQWRvYmUgSW1hZ2VSZWFkeSYjeEE7WE1MOmNvbS5hZG9iZS54bXA6ICZsdDs/eHBhY2tldCBiZWdpbj0mcXVvdDvvu78mcXVvdDsgaWQ9JnF1b3Q7VzVNME1wQ2VoaUh6cmVTek5UY3prYzlkJnF1b3Q7PyZndDsmI3hBOyZsdDt4OnhtcG1ldGEgeG1sbnM6eD0mcXVvdDthZG9iZTpuczptZXRhLyZxdW90OyB4OnhtcHRrPSZxdW90O0Fkb2JlIFhNUCBDb3JlIDUuNi1jMTQ4IDc5LjE2NDA1MCwgMjAxOS8xMC8wMS0xODowMzoxNiAgICAgICAgJnF1b3Q7Jmd0OyYjeEE7ICZsdDtyZGY6UkRGIHhtbG5zOnJkZj0mcXVvdDtodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjJnF1b3Q7Jmd0OyYjeEE7ICAmbHQ7cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0mcXVvdDsmcXVvdDsmI3hBOyAgICB4bWxuczpkYW09JnF1b3Q7aHR0cDovL3d3dy5kYXkuY29tL2RhbS8xLjAmcXVvdDsmI3hBOyAgICB4bWxuczp0aWZmPSZxdW90O2h0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvJnF1b3Q7JiN4QTsgICAgeG1sbnM6ZGM9JnF1b3Q7aHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8mcXVvdDsmI3hBOyAgIGRhbTpQaHlzaWNhbGhlaWdodGluaW5jaGVzPSZxdW90Oy0xLjAmcXVvdDsmI3hBOyAgIGRhbTpQaHlzaWNhbHdpZHRoaW5pbmNoZXM9JnF1b3Q7LTEuMCZxdW90OyYjeEE7ICAgZGFtOkZpbGVmb3JtYXQ9JnF1b3Q7UE5HJnF1b3Q7JiN4QTsgICBkYW06UHJvZ3Jlc3NpdmU9JnF1b3Q7bm8mcXVvdDsmI3hBOyAgIGRhbTpleHRyYWN0ZWQ9JnF1b3Q7MjAyMC0xMS0xMFQxOTozNjo0Ny4zNzIrMDU6MzAmcXVvdDsmI3hBOyAgIGRhbTpCaXRzcGVycGl4ZWw9JnF1b3Q7OCZxdW90OyYjeEE7ICAgZGFtOk1JTUV0eXBlPSZxdW90O2ltYWdlL3BuZyZxdW90OyYjeEE7ICAgZGFtOkNvbW1lbnRzPSZxdW90O1NvZnR3YXJlOiBBZG9iZSBJbWFnZVJlYWR5JmFtcDsjeEE7WE1MOmNvbS5hZG9iZS54bXA6ICZhbXA7bHQ7P3hwYWNrZXQgYmVnaW49JmFtcDtxdW90O++7vyZhbXA7cXVvdDsgaWQ9JmFtcDtxdW90O1c1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCZhbXA7cXVvdDs/JmFtcDtndDsmYW1wOyN4QTsmYW1wO2x0O3g6eG1wbWV0YSB4bWxuczp4PSZhbXA7cXVvdDthZG9iZTpuczptZXRhLyZhbXA7cXVvdDsgeDp4bXB0az0mYW1wO3F1b3Q7QWRvYmUgWE1QIENvcmUgNS42LWMxMzcgMS4wMDAwMDAsIDAwMDAvMDAvMDAtMDA6MDA6MDAgICAgICAgICZhbXA7cXVvdDsmYW1wO2d0OyZhbXA7I3hBOyAmYW1wO2x0O3JkZjpSREYgeG1sbnM6cmRmPSZhbXA7cXVvdDtodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjJmFtcDtxdW90OyZhbXA7Z3Q7JmFtcDsjeEE7ICAmYW1wO2x0O3JkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JmFtcDtxdW90OyZhbXA7cXVvdDsmYW1wOyN4QTsgICAgeG1sbnM6bnMxPSZhbXA7cXVvdDtodHRwOi8vd3d3LmRheS5jb20vZGFtLzEuMCZhbXA7cXVvdDsmYW1wOyN4QTsgICAgeG1sbnM6dGlmZj0mYW1wO3F1b3Q7aHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8mYW1wO3F1b3Q7JmFtcDsjeEE7ICAgIHhtbG5zOmRjPSZhbXA7cXVvdDtodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyZhbXA7cXVvdDsmYW1wOyN4QTsgICBuczE6UGh5c2ljYWxoZWlnaHRpbmluY2hlcz0mYW1wO3F1b3Q7LTEuMCZhbXA7cXVvdDsmYW1wOyN4QTsgICBuczE6UGh5c2ljYWx3aWR0aGluaW5jaGVzPSZhbXA7cXVvdDstMS4wJmFtcDtxdW90OyZhbXA7I3hBOyAgIG5zMTpGaWxlZm9ybWF0PSZhbXA7cXVvdDtQTkcmYW1wO3F1b3Q7JmFtcDsjeEE7ICAgbnMxOlByb2dyZXNzaXZlPSZhbXA7cXVvdDtubyZhbXA7cXVvdDsmYW1wOyN4QTsgICBuczE6ZXh0cmFjdGVkPSZhbXA7cXVvdDsyMDIwLTExLTEwVDE5OjM2OjQ3LjM3MiswNTozMCZhbXA7cXVvdDsmYW1wOyN4QTsgICBuczE6Qml0c3BlcnBpeGVsPSZhbXA7cXVvdDs4JmFtcDtxdW90OyZhbXA7I3hBOyAgIG5zMTpNSU1FdHlwZT0mYW1wO3F1b3Q7aW1hZ2UvcG5nJmFtcDtxdW90OyZhbXA7I3hBOyAgIG5zMTpDb21tZW50cz0mYW1wO3F1b3Q7U29mdHdhcmU6IEFkb2JlIEltYWdlUmVhZHkmYW1wO2FtcDsjeEE7JmFtcDtxdW90OyZhbXA7I3hBOyAgIG5zMTpQaHlzaWNhbHdpZHRoaW5kcGk9JmFtcDtxdW90Oy0xJmFtcDtxdW90OyZhbXA7I3hBOyAgIG5zMTpQaHlzaWNhbGhlaWdodGluZHBpPSZhbXA7cXVvdDstMSZhbXA7cXVvdDsmYW1wOyN4QTsgICBuczE6TnVtYmVyb2ZpbWFnZXM9JmFtcDtxdW90OzEmYW1wO3F1b3Q7JmFtcDsjeEE7ICAgbnMxOk51bWJlcm9mdGV4dHVhbGNvbW1lbnRzPSZhbXA7cXVvdDsxJmFtcDtxdW90OyZhbXA7I3hBOyAgIG5zMTpzaGExPSZhbXA7cXVvdDsyNTZkZGYwZjhlZjVlYTlhYjEyYzdlNjNlODBhZTk1OTU5NDcwNjEzJmFtcDtxdW90OyZhbXA7I3hBOyAgIG5zMTpzaXplPSZhbXA7cXVvdDs0NDkmYW1wO3F1b3Q7JmFtcDsjeEE7ICAgdGlmZjpJbWFnZUxlbmd0aD0mYW1wO3F1b3Q7NTAmYW1wO3F1b3Q7JmFtcDsjeEE7ICAgdGlmZjpJbWFnZVdpZHRoPSZhbXA7cXVvdDs1MCZhbXA7cXVvdDsmYW1wOyN4QTsgICBkYzpmb3JtYXQ9JmFtcDtxdW90O2ltYWdlL3BuZyZhbXA7cXVvdDsmYW1wOyN4QTsgICBkYzptb2RpZmllZD0mYW1wO3F1b3Q7MjAyMC0xMS0xMFQyMDo0ODoxMi40NTgrMDU6MzAmYW1wO3F1b3Q7LyZhbXA7Z3Q7JmFtcDsjeEE7ICZhbXA7bHQ7L3JkZjpSREYmYW1wO2d0OyZhbXA7I3hBOyZhbXA7bHQ7L3g6eG1wbWV0YSZhbXA7Z3Q7JmFtcDsjeEE7JmFtcDtsdDs/eHBhY2tldCBlbmQ9JmFtcDtxdW90O3ImYW1wO3F1b3Q7PyZhbXA7Z3Q7JmFtcDsjeEE7JnF1b3Q7JiN4QTsgICBkYW06UGh5c2ljYWx3aWR0aGluZHBpPSZxdW90Oy0xJnF1b3Q7JiN4QTsgICBkYW06UGh5c2ljYWxoZWlnaHRpbmRwaT0mcXVvdDstMSZxdW90OyYjeEE7ICAgZGFtOk51bWJlcm9maW1hZ2VzPSZxdW90OzEmcXVvdDsmI3hBOyAgIGRhbTpOdW1iZXJvZnRleHR1YWxjb21tZW50cz0mcXVvdDsyJnF1b3Q7JiN4QTsgICBkYW06c2hhMT0mcXVvdDsyNTZkZGYwZjhlZjVlYTlhYjEyYzdlNjNlODBhZTk1OTU5NDcwNjEzJnF1b3Q7JiN4QTsgICBkYW06c2l6ZT0mcXVvdDs0NDkmcXVvdDsmI3hBOyAgIHRpZmY6SW1hZ2VMZW5ndGg9JnF1b3Q7NTAmcXVvdDsmI3hBOyAgIHRpZmY6SW1hZ2VXaWR0aD0mcXVvdDs1MCZxdW90OyYjeEE7ICAgZGM6Zm9ybWF0PSZxdW90O2ltYWdlL3BuZyZxdW90OyYjeEE7ICAgZGM6bW9kaWZpZWQ9JnF1b3Q7MjAyMC0xMS0xMFQyMDo0ODoxMi40NTgrMDU6MzAmcXVvdDsvJmd0OyYjeEE7ICZsdDsvcmRmOlJERiZndDsmI3hBOyZsdDsveDp4bXBtZXRhJmd0OyYjeEE7Jmx0Oz94cGFja2V0IGVuZD0mcXVvdDtyJnF1b3Q7PyZndDsmI3hBOyIKICAgZGFtOlBoeXNpY2Fsd2lkdGhpbmRwaT0iLTEiCiAgIGRhbTpQaHlzaWNhbGhlaWdodGluZHBpPSItMSIKICAgZGFtOnNjZW5lN0ZpbGVTdGF0dXM9IlB1Ymxpc2hDb21wbGV0ZSIKICAgZGFtOnNjZW5lN0ZpbGU9Imhwc2l0ZXNkZXYvd2luMTAtc2V0dXAiCiAgIGRhbTpzY2VuZTdOYW1lPSJ3aW4xMC1zZXR1cCIKICAgZGFtOnNjZW5lN1R5cGU9IkltYWdlIgogICBkYW06TnVtYmVyb2ZpbWFnZXM9IjEiCiAgIGRhbTpzY2VuZTdVcGxvYWRUaW1lU3RhbXA9IjIwMjAtMTEtMTVUMDg6NDk6MzYuMjQ4WiIKICAgZGFtOk51bWJlcm9mdGV4dHVhbGNvbW1lbnRzPSIyIgogICBkYW06c2NlbmU3UHVibGlzaFRpbWVTdGFtcD0iMjAyMC0xMS0xNlQwODo0MTo0Ni4zNDdaIgogICBkYW06c2NlbmU3RG9tYWluPSJodHRwOi8vczdkNi5zY2VuZTcuY29tLyIKICAgZGFtOnNjZW5lN0ZvbGRlcj0iaHBzaXRlc2Rldi9ocC13Y2MvbWljcm9zaXRlLWFzc2V0cy9pbWFnZXMvd2luZG93cy0xMC8iCiAgIGRhbTpzaGExPSIzYjU4ZWQ3ZTFkZjk3NDM4YzdhNjk0YzZiODMxODM5ZmZjNTJiNGY3IgogICBkYW06c2l6ZT0iMzAxNCIKICAgZGFtOnNjZW5lN0FQSVNlcnZlcj0iaHR0cHM6Ly9zN3NwczFhcGlzc2wuc2NlbmU3LmNvbSIKICAgZGFtOnNjZW5lN0xhc3RNb2RpZmllZD0iMTYwNTQzMDE0OTEyMCIKICAgdGlmZjpJbWFnZUxlbmd0aD0iNTAiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iNTAiCiAgIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIgogICBkYzptb2RpZmllZD0iMjAyMC0xMS0xMFQyMDo0ODoxMi40NTgrMDU6MzAiLz4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz7zPIaSAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAD9QTFRFgMvr7/j8YL3l3/L6z+v3ULfjr97yIKPbEJ3Zn9fwcMTon9jwj9HtMKreYL7lf8rqQLDgv+X1AJbW////////sfFWggAAABV0Uk5T//////////////////////////8AK9l96gAAAPdJREFUeNrs1sluwzAMBFDS2rzGIpn//9ZasqEmJ4+K9lC0c3+wRiQE07M79E++RKb9Piu/kaxAtneS7Tarxl5iun834UiL7yE8DFGEssCEs7/kgpLQjhQcRjy1z7kBI+RaJQ4YyZ/CCCW1fhEoIVeurAoLcH3OUgVav1zy+Q3LDh7lOXYOEV8YCovEOfiuTRYR9+PL/4tJQh4lnV+IaKD7pPGF5JGBgy06NeJ0NiQpNfJQB5FV5SKsAySMx3yRXQUjNquv5LCgMKePSiaNKLFBXSFbgoX5sgH0RMufr8/IBwlKAoeOcR71N+1JOqcvPfnrPyQfAgwAb7KwmZZfpnkAAAAASUVORK5CYII=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPBody>
        <TcpPackets>
          <PacketInfo time="364148828" offset="0" length="6493" />
        </TcpPackets>
      </HTTPResponse>
    </HTTPTask>
  </HTTPTask>
</HTTPSnapshot>