<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="34">
  <HTTPTask id="327" hostname="ppssupport-itgllbh7.inc.hp.com" path="/wps/contenthandler/pps/!ut/p/digest!3JKaotSk_gMd0aUfF0xN-w/mashup/ra:collection?themeID=ZJ_3054ICK0K8VR40ACSBJACA0001&amp;locale=en&amp;mime-type=text%2Fjavascript&amp;lm=1622771916000&amp;entry=wp_theme_edit__0.0%3Aconfig_js&amp;entry=wp_one_ui_30__0.0%3Aconfig_js&amp;entry=wp_theme_skin_region__0.0%3Aconfig_js&amp;entry=wp_status_bar__0.0%3Aconfig_js&amp;entry=wp_theme_menus__0.0%3Aconfig_js&amp;entry=hpStyleR2__1.0%3Aconfig_js&amp;entry=wp_theme_high_contrast__0.0%3Aconfig_js" url="https://ppssupport-itgllbh7.inc.hp.com/wps/contenthandler/pps/!ut/p/digest!3JKaotSk_gMd0aUfF0xN-w/mashup/ra:collection?themeID=ZJ_3054ICK0K8VR40ACSBJACA0001&amp;locale=en&amp;mime-type=text%2Fjavascript&amp;lm=1622771916000&amp;entry=wp_theme_edit__0.0%3Aconfig_js&amp;entry=wp_one_ui_30__0.0%3Aconfig_js&amp;entry=wp_theme_skin_region__0.0%3Aconfig_js&amp;entry=wp_status_bar__0.0%3Aconfig_js&amp;entry=wp_theme_menus__0.0%3Aconfig_js&amp;entry=hpStyleR2__1.0%3Aconfig_js&amp;entry=wp_theme_high_contrast__0.0%3Aconfig_js" ip="15.72.22.19" port="443" connectionId="11" origin="Primary" frame="1" startDateTime="2021-07-16T05:08:27.778+00:00" startTime="1512931437" endTime="1512931500">
    <QueryString>
      <HTTPDataSet>
        <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
          <ActualData>dGhlbWVJRD1aSl8zMDU0SUNLMEs4VlI0MEFDU0JKQUNBMDAwMSZsb2NhbGU9ZW4mbWltZS10eXBlPXRleHQlMkZqYXZhc2NyaXB0JmxtPTE2MjI3NzE5MTYwMDAmZW50cnk9d3BfdGhlbWVfZWRpdF9fMC4wJTNBY29uZmlnX2pzJmVudHJ5PXdwX29uZV91aV8zMF9fMC4wJTNBY29uZmlnX2pzJmVudHJ5PXdwX3RoZW1lX3NraW5fcmVnaW9uX18wLjAlM0Fjb25maWdfanMmZW50cnk9d3Bfc3RhdHVzX2Jhcl9fMC4wJTNBY29uZmlnX2pzJmVudHJ5PXdwX3RoZW1lX21lbnVzX18wLjAlM0Fjb25maWdfanMmZW50cnk9aHBTdHlsZVIyX18xLjAlM0Fjb25maWdfanMmZW50cnk9d3BfdGhlbWVfaGlnaF9jb250cmFzdF9fMC4wJTNBY29uZmlnX2pz</ActualData>
        </HTTPData>
      </HTTPDataSet>
      <IsExternalData>false</IsExternalData>
    </QueryString>
    <HTTPSplittedQueryStrings>
      <HTTPHeaderEntity name="themeID" index="0">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>WkpfMzA1NElDSzBLOFZSNDBBQ1NCSkFDQTAwMDE=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="locale" index="1">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>ZW4=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="mime-type" index="2">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>dGV4dCUyRmphdmFzY3JpcHQ=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="lm" index="3">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MTYyMjc3MTkxNjAwMA==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="entry" index="4">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>d3BfdGhlbWVfZWRpdF9fMC4wJTNBY29uZmlnX2pz</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="entry" index="5">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>d3Bfb25lX3VpXzMwX18wLjAlM0Fjb25maWdfanM=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="entry" index="6">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>d3BfdGhlbWVfc2tpbl9yZWdpb25fXzAuMCUzQWNvbmZpZ19qcw==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="entry" index="7">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>d3Bfc3RhdHVzX2Jhcl9fMC4wJTNBY29uZmlnX2pz</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="entry" index="8">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>d3BfdGhlbWVfbWVudXNfXzAuMCUzQWNvbmZpZ19qcw==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="entry" index="9">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>aHBTdHlsZVIyX18xLjAlM0Fjb25maWdfanM=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="entry" index="10">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>d3BfdGhlbWVfaGlnaF9jb250cmFzdF9fMC4wJTNBY29uZmlnX2pz</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
    </HTTPSplittedQueryStrings>
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29t</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="sec-ch-ua" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>IiBOb3Q7QSBCcmFuZCI7dj0iOTkiLCAiR29vZ2xlIENocm9tZSI7dj0iOTEiLCAiQ2hyb21pdW0iO3Y9IjkxIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="sec-ch-ua-mobile" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>PzA=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzkxLjAuNDQ3Mi4xMjQgU2FmYXJpLzUzNy4zNg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Sec-Fetch-Site" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>c2FtZS1vcmlnaW4=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Sec-Fetch-Mode" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bm8tY29ycw==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Sec-Fetch-Dest" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>c2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20vdXMtZW4vc2VydmljZS1jZW50ZXI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>T3B0YW5vbkNvbnNlbnQ9Y29uc2VudElkPWExNWJlM2ZlLWJlZjYtNDNhOS04YzczLWQ2NzQ3ZDEyZTk5OCZkYXRlc3RhbXA9RnJpK0p1bCsxNisyMDIxKzA0JTNBNDIlM0E0OStHTVQlMkIwMDAwKyhHcmVlbndpY2grTWVhbitUaW1lKSZ2ZXJzaW9uPTYuMTkuMCZpbnRlcmFjdGlvbkNvdW50PTA7IEpTRVNTSU9OSUQ9MDAwMFJmMXBIb1lfOXFYYk9BMGNwY21ZdnhtOjFiMGVkbWVlaDsgZHRDb29raWU9dl80X3Nydl8xX3NuXzVEOTI5RUNCMjJFODAxRjU0Njg3NUE1QzZDODAyMTkwX3BlcmNfMTAwMDAwX29sXzBfbXVsXzFfYXBwLTNBZWE3YzRiNTlmMjdkNDNlYl8xOyByeFZpc2l0b3I9MTYyNjQxMTc2OTMzNlZMUThSM0NQUkNTSFFLODhCNkRVUUlWVk85MDU0OU9VOyBkdFNhPS07IGR0TGF0Qz0xMTY1OyByeHZ0PTE2MjY0MTM1NjkzNTZ8MTYyNjQxMTc2OTM0NzsgZHRQQz0xJDQxMTc2OTMyOF85MzNoMXZTUVZLVEhQSENFSEZWRlJJUkdMVlBUSElXSFVNQ0FFUC0wZTE7IEFNQ1ZfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4ODI1JTdDdlZlcnNpb24lN0M0LjQuMA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC93cHMvY29udGVudGhhbmRsZXIvcHBzLyF1dC9wL2RpZ2VzdCEzSkthb3RTa19nTWQwYVVmRjB4Ti13L21hc2h1cC9yYTpjb2xsZWN0aW9uP3RoZW1lSUQ9WkpfMzA1NElDSzBLOFZSNDBBQ1NCSkFDQTAwMDEmbG9jYWxlPWVuJm1pbWUtdHlwZT10ZXh0JTJGamF2YXNjcmlwdCZsbT0xNjIyNzcxOTE2MDAwJmVudHJ5PXdwX3RoZW1lX2VkaXRfXzAuMCUzQWNvbmZpZ19qcyZlbnRyeT13cF9vbmVfdWlfMzBfXzAuMCUzQWNvbmZpZ19qcyZlbnRyeT13cF90aGVtZV9za2luX3JlZ2lvbl9fMC4wJTNBY29uZmlnX2pzJmVudHJ5PXdwX3N0YXR1c19iYXJfXzAuMCUzQWNvbmZpZ19qcyZlbnRyeT13cF90aGVtZV9tZW51c19fMC4wJTNBY29uZmlnX2pzJmVudHJ5PWhwU3R5bGVSMl9fMS4wJTNBY29uZmlnX2pzJmVudHJ5PXdwX3RoZW1lX2hpZ2hfY29udHJhc3RfXzAuMCUzQWNvbmZpZ19qcyBIVFRQLzEuMQ0KSG9zdDogcHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29tDQpDb25uZWN0aW9uOiBrZWVwLWFsaXZlDQpzZWMtY2gtdWE6ICIgTm90O0EgQnJhbmQiO3Y9Ijk5IiwgIkdvb2dsZSBDaHJvbWUiO3Y9IjkxIiwgIkNocm9taXVtIjt2PSI5MSINCnNlYy1jaC11YS1tb2JpbGU6ID8wDQpVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvOTEuMC40NDcyLjEyNCBTYWZhcmkvNTM3LjM2DQpBY2NlcHQ6ICovKg0KU2VjLUZldGNoLVNpdGU6IHNhbWUtb3JpZ2luDQpTZWMtRmV0Y2gtTW9kZTogbm8tY29ycw0KU2VjLUZldGNoLURlc3Q6IHNjcmlwdA0KUmVmZXJlcjogaHR0cHM6Ly9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20vdXMtZW4vc2VydmljZS1jZW50ZXINCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZSwgYnINCkFjY2VwdC1MYW5ndWFnZTogZW4tVVMsZW47cT0wLjkNCkNvb2tpZTogT3B0YW5vbkNvbnNlbnQ9Y29uc2VudElkPWExNWJlM2ZlLWJlZjYtNDNhOS04YzczLWQ2NzQ3ZDEyZTk5OCZkYXRlc3RhbXA9RnJpK0p1bCsxNisyMDIxKzA0JTNBNDIlM0E0OStHTVQlMkIwMDAwKyhHcmVlbndpY2grTWVhbitUaW1lKSZ2ZXJzaW9uPTYuMTkuMCZpbnRlcmFjdGlvbkNvdW50PTA7IEpTRVNTSU9OSUQ9MDAwMFJmMXBIb1lfOXFYYk9BMGNwY21ZdnhtOjFiMGVkbWVlaDsgZHRDb29raWU9dl80X3Nydl8xX3NuXzVEOTI5RUNCMjJFODAxRjU0Njg3NUE1QzZDODAyMTkwX3BlcmNfMTAwMDAwX29sXzBfbXVsXzFfYXBwLTNBZWE3YzRiNTlmMjdkNDNlYl8xOyByeFZpc2l0b3I9MTYyNjQxMTc2OTMzNlZMUThSM0NQUkNTSFFLODhCNkRVUUlWVk85MDU0OU9VOyBkdFNhPS07IGR0TGF0Qz0xMTY1OyByeHZ0PTE2MjY0MTM1NjkzNTZ8MTYyNjQxMTc2OTM0NzsgZHRQQz0xJDQxMTc2OTMyOF85MzNoMXZTUVZLVEhQSENFSEZWRlJJUkdMVlBUSElXSFVNQ0FFUC0wZTE7IEFNQ1ZfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4ODI1JTdDdlZlcnNpb24lN0M0LjQuMA0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="OptanonConsent" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Y29uc2VudElkPWExNWJlM2ZlLWJlZjYtNDNhOS04YzczLWQ2NzQ3ZDEyZTk5OCZkYXRlc3RhbXA9RnJpK0p1bCsxNisyMDIxKzA0JTNBNDIlM0E0OStHTVQlMkIwMDAwKyhHcmVlbndpY2grTWVhbitUaW1lKSZ2ZXJzaW9uPTYuMTkuMCZpbnRlcmFjdGlvbkNvdW50PTA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="JSESSIONID" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MDAwMFJmMXBIb1lfOXFYYk9BMGNwY21ZdnhtOjFiMGVkbWVlaA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="dtCookie" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dl80X3Nydl8xX3NuXzVEOTI5RUNCMjJFODAxRjU0Njg3NUE1QzZDODAyMTkwX3BlcmNfMTAwMDAwX29sXzBfbXVsXzFfYXBwLTNBZWE3YzRiNTlmMjdkNDNlYl8x</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="rxVisitor" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTYyNjQxMTc2OTMzNlZMUThSM0NQUkNTSFFLODhCNkRVUUlWVk85MDU0OU9V</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="dtSa" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>LQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="dtLatC" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTE2NQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="rxvt" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTYyNjQxMzU2OTM1NnwxNjI2NDExNzY5MzQ3</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="dtPC" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MSQ0MTE3NjkzMjhfOTMzaDF2U1FWS1RIUEhDRUhGVkZSSVJHTFZQVEhJV0hVTUNBRVAtMGUx</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="AMCV_5E34123F5245B2CD0A490D45%40AdobeOrg" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4ODI1JTdDdlZlcnNpb24lN0M0LjQuMA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>0</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bmdpbngvMS4xNC4y</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAxNiBKdWwgMjAyMSAwNTowMjo0OSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9qYXZhc2NyaXB0OyBjaGFyc2V0PVVURi04</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Transfer-Encoding" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Y2h1bmtlZA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Powered-By" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>U2VydmxldC8zLjE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Request-Digest" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SEZYOWJPWVdMcmhiemFrY0swd1FUUQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-DataSource-Digest" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>M0pLYW90U2tfZ01kMGFVZkYweE4tdw==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Expires" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAyMyBKdWwgMjAyMSAwNTowMjo0OSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bWF4LWFnZT02MDQ4MDA=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAwNCBKdW4gMjAyMSAwMTo1ODozNCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Location" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>L3dwcy9jb250ZW50aGFuZGxlci9wcHMvIXV0L3AvZGlnZXN0ITNKS2FvdFNrX2dNZDBhVWZGMHhOLXcvbWFzaHVwL21hc2h1cDpjeG1sLzFWcE5iOXN3RFAwMVBpWk8wMklvZHR0YURHdUJBa1BUblExYVlteWxzcWlKY2hJRF92R1RFcU1mMjJYcjJxRzhKRWhDUHowOVVjeWpMZHhmcno3dWZCVmI3TEJDYldKeGNyYllRU2hPVGotMXZsaDZDaEZzc1R3RUZFdU9FSTBxRDUtNF9IYjQ4WHktS0RkOF9HNi00WEdHRXlnNXJIcFRuUzR5WmtET21PWE9UNkUzcEh1YlFMcnBQVVgzcHR5ZXpoZnprNUl4ZmlZOTNFSERHWExzWUY4c29jSHhfTVBaWWpFYmU4WlFMQlc1aVBzNHJzRXl6a1lGcXMwY0ZYa2NmVjlibzJhakQ3UkJGWDhOZmlCNW5EbmZHMWNGYkF5NUZ3dVFNVzRQRU05VXlGZjBYTlVaOGc5azhHbVdkVy1zeHBCQm5VM0FEd2dWdWplVzQ5X1lQbDc5WDFhdFE5ZnppOWRyZ3M0Z3p4YnNOYkR6c2ozQm45YnRPRVRyVjNHd2VMdDhxdkJmd0xjLWoxQUgyaVU1THpFbW5hYWNleXZCWDRkeEhEeENpNkRmUDFYZ1ZJQXV5RzB4Y05MMktvM1RCSkFoc185aVhOcU9WeHJCM2lMM052TDdKODBJUWJWaTZPWUxjT19CYWFodGpwYXlCem4yMnREMXF0eWkweFJ5aldLeXVEWjdRZHdWZFQ2NUJSZExVSXFDbHFYOElfdEVSTjNYdEVjV1NWOEg4cHAyN3Z2cVNpVF90YkV4MVhlUjNGbXRSZkpPZnRFNGlGSjNMS05OZzRxazdpQWt4NWo4TzFpaDBtZUhJSko2SkxMUmVKbVZSbGtsczlLd3pBcVpHeVFNTXZNY2FwazUzdlJHb3haSm5UaDNIX2xmaVdRbVRYYVFsa0FuaE54TENTM3dUU09LLXRUOTFVU1JZd0NmNy1lSjhnV19UU0M5T0RZeW1fRE5qeDdETUYtRFU0TTRoem5OSVpKU01PLU1FNTFFUjZNbU5vTTZpS3I5aXFacG85ZzVLS0o3ZzJMcHN3cGs3UjFKM2dhZVBHMUZlZEJwQ2kxWkxaRjNSN1ZKX2tFZm51V0lUWDF6dUo4cGlIN3lDd0lLelJvVVNuZ21Ba29oczBtWmJPTHdfdWxhYWlTWWxkVFdKV3k2YUVGQVlmQVdCbXM0M2dCSENYWFlZMkJ5WUM5eGF4Uy1QZXVId3dWdHNtaFZqZ2hwekJjZk1zZ29GeFBJNFhqQlQwYktTdWchP3RoZW1lSUQ9WkpfMzA1NElDSzBLOFZSNDBBQ1NCSkFDQTAwMDEmbG9jYWxlPWVuJm1pbWUtdHlwZT10ZXh0L2phdmFzY3JpcHQmbG09MTYyMjc3MTkxNjAwMCZlbnRyeT13cF90aGVtZV9lZGl0X18wLjAlM2Fjb25maWdfanMmZW50cnk9d3Bfb25lX3VpXzMwX18wLjAlM2Fjb25maWdfanMmZW50cnk9d3BfdGhlbWVfc2tpbl9yZWdpb25fXzAuMCUzYWNvbmZpZ19qcyZlbnRyeT13cF9zdGF0dXNfYmFyX18wLjAlM2Fjb25maWdfanMmZW50cnk9d3BfdGhlbWVfbWVudXNfXzAuMCUzYWNvbmZpZ19qcyZlbnRyeT1ocFN0eWxlUjJfXzEuMCUzYWNvbmZpZ19qcyZlbnRyeT13cF90aGVtZV9oaWdoX2NvbnRyYXN0X18wLjAlM2Fjb25maWdfanM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="13">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="14">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>IjE2MjI3NzE5MTY6ZHRhZ2VudDEwMjE5MjEwNjI4MTMzMzQxUStVazpkdGFnZW50MTAyMTkyMTA2MjgxMzMzNDFRK1VrIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Language" index="15">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Server-Timing" index="16">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZHRScGlkO2Rlc2M9IjExOTM4NjY3NjUi</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Proxy-Cache" index="17">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TUlTUw==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-XSS-Protection" index="18">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTsgbW9kZT1ibG9jaw==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Strict-Transport-Security" index="19">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bWF4LWFnZT04NjQwMDsgaW5jbHVkZVN1YkRvbWFpbnM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IG5naW54LzEuMTQuMg0KRGF0ZTogRnJpLCAxNiBKdWwgMjAyMSAwNTowMjo0OSBHTVQNCkNvbnRlbnQtVHlwZTogdGV4dC9qYXZhc2NyaXB0OyBjaGFyc2V0PVVURi04DQpUcmFuc2Zlci1FbmNvZGluZzogY2h1bmtlZA0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KWC1Qb3dlcmVkLUJ5OiBTZXJ2bGV0LzMuMQ0KWC1SZXF1ZXN0LURpZ2VzdDogSEZYOWJPWVdMcmhiemFrY0swd1FUUQ0KWC1EYXRhU291cmNlLURpZ2VzdDogM0pLYW90U2tfZ01kMGFVZkYweE4tdw0KRXhwaXJlczogRnJpLCAyMyBKdWwgMjAyMSAwNTowMjo0OSBHTVQNCkNhY2hlLUNvbnRyb2w6IG1heC1hZ2U9NjA0ODAwDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA0IEp1biAyMDIxIDAxOjU4OjM0IEdNVA0KQ29udGVudC1Mb2NhdGlvbjogL3dwcy9jb250ZW50aGFuZGxlci9wcHMvIXV0L3AvZGlnZXN0ITNKS2FvdFNrX2dNZDBhVWZGMHhOLXcvbWFzaHVwL21hc2h1cDpjeG1sLzFWcE5iOXN3RFAwMVBpWk8wMklvZHR0YURHdUJBa1BUblExYVlteWxzcWlKY2hJRF92R1RFcU1mMjJYcjJxRzhKRWhDUHowOVVjeWpMZHhmcno3dWZCVmI3TEJDYldKeGNyYllRU2hPVGotMXZsaDZDaEZzc1R3RUZFdU9FSTBxRDUtNF9IYjQ4WHktS0RkOF9HNi00WEdHRXlnNXJIcFRuUzR5WmtET21PWE9UNkUzcEh1YlFMcnBQVVgzcHR5ZXpoZnprNUl4ZmlZOTNFSERHWExzWUY4c29jSHhfTVBaWWpFYmU4WlFMQlc1aVBzNHJzRXl6a1lGcXMwY0ZYa2NmVjlibzJhakQ3UkJGWDhOZmlCNW5EbmZHMWNGYkF5NUZ3dVFNVzRQRU05VXlGZjBYTlVaOGc5azhHbVdkVy1zeHBCQm5VM0FEd2dWdWplVzQ5X1lQbDc5WDFhdFE5ZnppOWRyZ3M0Z3p4YnNOYkR6c2ozQm45YnRPRVRyVjNHd2VMdDhxdkJmd0xjLWoxQUgyaVU1THpFbW5hYWNleXZCWDRkeEhEeENpNkRmUDFYZ1ZJQXV5RzB4Y05MMktvM1RCSkFoc185aVhOcU9WeHJCM2lMM052TDdKODBJUWJWaTZPWUxjT19CYWFodGpwYXlCem4yMnREMXF0eWkweFJ5aldLeXVEWjdRZHdWZFQ2NUJSZExVSXFDbHFYOElfdEVSTjNYdEVjV1NWOEg4cHAyN3Z2cVNpVF90YkV4MVhlUjNGbXRSZkpPZnRFNGlGSjNMS05OZzRxazdpQWt4NWo4TzFpaDBtZUhJSko2SkxMUmVKbVZSbGtsczlLd3pBcVpHeVFNTXZNY2FwazUzdlJHb3haSm5UaDNIX2xmaVdRbVRYYVFsa0FuaE54TENTM3dUU09LLXRUOTFVU1JZd0NmNy1lSjhnV19UU0M5T0RZeW1fRE5qeDdETUYtRFU0TTRoem5OSVpKU01PLU1FNTFFUjZNbU5vTTZpS3I5aXFacG85ZzVLS0o3ZzJMcHN3cGs3UjFKM2dhZVBHMUZlZEJwQ2kxWkxaRjNSN1ZKX2tFZm51V0lUWDF6dUo4cGlIN3lDd0lLelJvVVNuZ21Ba29oczBtWmJPTHdfdWxhYWlTWWxkVFdKV3k2YUVGQVlmQVdCbXM0M2dCSENYWFlZMkJ5WUM5eGF4Uy1QZXVId3dWdHNtaFZqZ2hwekJjZk1zZ29GeFBJNFhqQlQwYktTdWchP3RoZW1lSUQ9WkpfMzA1NElDSzBLOFZSNDBBQ1NCSkFDQTAwMDEmbG9jYWxlPWVuJm1pbWUtdHlwZT10ZXh0L2phdmFzY3JpcHQmbG09MTYyMjc3MTkxNjAwMCZlbnRyeT13cF90aGVtZV9lZGl0X18wLjAlM2Fjb25maWdfanMmZW50cnk9d3Bfb25lX3VpXzMwX18wLjAlM2Fjb25maWdfanMmZW50cnk9d3BfdGhlbWVfc2tpbl9yZWdpb25fXzAuMCUzYWNvbmZpZ19qcyZlbnRyeT13cF9zdGF0dXNfYmFyX18wLjAlM2Fjb25maWdfanMmZW50cnk9d3BfdGhlbWVfbWVudXNfXzAuMCUzYWNvbmZpZ19qcyZlbnRyeT1ocFN0eWxlUjJfXzEuMCUzYWNvbmZpZ19qcyZlbnRyeT13cF90aGVtZV9oaWdoX2NvbnRyYXN0X18wLjAlM2Fjb25maWdfanMNClZhcnk6IEFjY2VwdC1FbmNvZGluZw0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KRVRhZzogIjE2MjI3NzE5MTY6ZHRhZ2VudDEwMjE5MjEwNjI4MTMzMzQxUStVazpkdGFnZW50MTAyMTkyMTA2MjgxMzMzNDFRK1VrIg0KQ29udGVudC1MYW5ndWFnZTogZW4tVVMNClNlcnZlci1UaW1pbmc6IGR0UnBpZDtkZXNjPSIxMTkzODY2NzY1Ig0KWC1Qcm94eS1DYWNoZTogTUlTUw0KWC1YU1MtUHJvdGVjdGlvbjogMTsgbW9kZT1ibG9jaw0KU3RyaWN0LVRyYW5zcG9ydC1TZWN1cml0eTogbWF4LWFnZT04NjQwMDsgaW5jbHVkZVN1YkRvbWFpbnMNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>CnRyeXsoZnVuY3Rpb24oKXsKdmFyIF8xPWZhbHNlOwppZih0eXBlb2Ygd3B0aGVtZT09PSJ1bmRlZmluZWQifHwhd3B0aGVtZSl7CndwdGhlbWU9e307Cn0KaSQubWFzaCh3cHRoZW1lLHt0b2dnbGVQYWdlTW9kZTpmdW5jdGlvbigpewpyZXR1cm4gaSQubW9kdWxlcy5sb2FkRGVmZXJyZWQoKS50aGVuKGZ1bmN0aW9uKCl7CnZhciBfMj1pJC5mcm9tUGF0aCgiY29tLmlibS5tYXNodXBzIiksXzM9XzI/Y29tLmlibS5tYXNodXBzLmJ1aWxkZXIubW9kZWwuRmFjdG9yeS5nZXRSdW50aW1lTW9kZWwoKTpudWxsLF80PV8yP2NvbS5pYm0ubWFzaHVwcy5lbmFibGVyLnVzZXIuRmFjdG9yeS5nZXRVc2VyTW9kZWwoKTpudWxsLF81PWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0sXzY9ZnVuY3Rpb24oXzcpewppZihfMil7CmNvbS5pYm0ubWFzaHVwcy5zZXJ2aWNlcy5TZXJ2aWNlTWFuYWdlci5nZXRTZXJ2aWNlKCJldmVudFNlcnZpY2UiKS5icm9hZGNhc3RFdmVudCgiY29tLmlibS5tYXNodXBzLmJ1aWxkZXIuY2hhbmdlUGFnZU1vZGUiLF83KTsKXzMuZ2V0Q3VycmVudFBhZ2UoKS5zZXRQYWdlTW9kZShfNyk7Cn0KaSQuZmlyZUV2ZW50KCJ3cHRoZW1lL2NvbnRleHRNZW51L2ludmFsaWRhdGUvYWxsIik7Cn07CmlmKCghXzImJiFpJC5oYXNDbGFzcyhfNSwiZWRpdC1tb2RlIikpfHwoXzImJl80LmdldEFub255bW91c01vZGUoKSE9Y29tLmlibS5tYXNodXBzLmVuYWJsZXIudXNlci5Bbm9ueW1vdXNNb2RlLkFOT05ZTU9VUyYmXzMuZ2V0Q3VycmVudFBhZ2UoKS5nZXRQYWdlTW9kZSgpIT0iZWRpdCIpKXsKXzYoImVkaXQiKTsKaSQuYWRkQ2xhc3MoXzUsImVkaXQtbW9kZSIpOwppZighXzEpewppZighaSQuaXNJRSYmIWkkLmlzT3BlcmEmJl8yKXsKd2luZG93Lm9uYmVmb3JldW5sb2FkPWZ1bmN0aW9uKCl7CmlmKGNvbS5pYm0ubWFzaHVwcy5idWlsZGVyLm1vZGVsLkZhY3RvcnkuZ2V0UnVudGltZU1vZGVsKCkuZ2V0Q3VycmVudFBhZ2UoKS5pc0RpcnR5KCkpewpyZXR1cm4gY29tLmlibS5tbS5idWlsZGVyLmNvcmVXaWRnZXRzU3RyaW5ncy5JX1BBR0VfU0FWRV9XQVJOSU5HOwp9Cn07Cn0KXzE9dHJ1ZTsKfQp9ZWxzZXsKXzYoInZpZXciKTsKaSQucmVtb3ZlQ2xhc3MoXzUsImVkaXQtbW9kZSIpOwp9Cn0sZnVuY3Rpb24oXzgpewpjb25zb2xlLmxvZygiRXJyb3IgZ29pbmcgaW50byBlZGl0IG1vZGUuIE1vc3QgbGlrZWx5IGEgc2Vzc2lvbiB0aW1lb3V0LiBSZWZyZXNoaW5nLiAiK184KTsKd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwp9KTsKfSxtb2JpbGVHb1RvU2VhcmNoOmZ1bmN0aW9uKGlkLF85LF9hLF9iLF9jLF9kLF9lKXsKdmFyIF9mPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKF9jKTsKdmFyIF8xMD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid3B0aGVtZVNlYXJjaEJveElucHV0Iik7CmlmKGkkLmhhc0NsYXNzKF9mLF85KSl7CndwdGhlbWUudG9nZ2xlTW9iaWxlTmF2KGlkLF85LF9hLF9iLF9jLF9kLF9lKTsKaWYoXzEwKXsKc2V0VGltZW91dChmdW5jdGlvbigpewpfMTAuZm9jdXMoKTsKfSw1NTApOwp9Cn1lbHNlewppZihfMTApewpfMTAuZm9jdXMoKTsKfQp9Cn0sbW9iaWxlTmF2UmVzaXplQmluZGluZzpudWxsLG1vYmlsZU5hdlNpZGVMYXN0RXhwYW5kZWQ6W10sbW9iaWxlTmF2U2lkZUV4cGFuZGVkOltdLG1vYmlsZU5hdlNpZGVUb2dnbGluZ1Jvb3Q6ZmFsc2UscmVzaXplTW9iaWxlTmF2U2lkZTpmdW5jdGlvbihlKXsKdmFyIF8xMT1kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZGVyIilbMF07CnZhciBfMTIsaWQ7Cl8xMj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid3B0aGVtZU5hdlJvb3QiKTsKaWYoXzEyKXsKXzEyLnN0eWxlLnRvcD1fMTEub2Zmc2V0SGVpZ2h0KyJweCI7Cl8xMi5zdHlsZS5oZWlnaHQ9KHdpbmRvdy5pbm5lckhlaWdodC1fMTEub2Zmc2V0SGVpZ2h0KSsicHgiOwp9CmZvcih2YXIgaT0wO2k8d3B0aGVtZS5tb2JpbGVOYXZTaWRlRXhwYW5kZWQubGVuZ3RoO2krKyl7CmlkPXdwdGhlbWUubW9iaWxlTmF2U2lkZUV4cGFuZGVkW2ldOwppZD1pZC5zdWJzdHIoMCxpZC5sZW5ndGgtNCkrIlN1Ym5hdiI7Cl8xMj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CmlmKF8xMil7Cl8xMi5zdHlsZS50b3A9XzExLm9mZnNldEhlaWdodCsicHgiOwpfMTIuc3R5bGUuaGVpZ2h0PSh3aW5kb3cuaW5uZXJIZWlnaHQtXzExLm9mZnNldEhlaWdodCkrInB4IjsKfQp9Cn0sYW5pbWF0ZU1vYmlsZU5hdlNpZGVQYW5lbDpmdW5jdGlvbihfMTMsXzE0LF8xNSl7CnZhciBfMTY9XzEzLm9mZnNldExlZnQ7CmlmKGlibUNmZy50aGVtZUNvbmZpZy5pc1JUTCl7Cl8xNj1wYXJzZUludChfMTMuc3R5bGUucmlnaHQpOwp9CmlmKHRoaXMubW9iaWxlTmF2U2lkZVRvZ2dsaW5nUm9vdCYmXzE0PF8xNil7Cl8xND0tXzEzLm9mZnNldFdpZHRoOwp9CnZhciBfMTc9MDsKdmFyIF8xOD1NYXRoLmNlaWwoTWF0aC5hYnMoXzE0LV8xNikvNSk7CmlmKF8xNj09XzE0KXsKXzE4PTA7Cn1lbHNlewppZihfMTY+XzE0KXsKXzE4PS1fMTg7Cn0KfQppZihfMTg+MCYmIXRoaXMubW9iaWxlTmF2U2lkZVRvZ2dsaW5nUm9vdCl7CmlmKGlibUNmZy50aGVtZUNvbmZpZy5pc1JUTCl7Cl8xMy5zdHlsZS5jbGlwPSJyZWN0KDBweCwwcHgsIitfMTMub2Zmc2V0SGVpZ2h0KyJweCwwcHgpIjsKfWVsc2V7Cl8xMy5zdHlsZS5jbGlwPSJyZWN0KDBweCwiK18xMy5vZmZzZXRXaWR0aCsicHgsIitfMTMub2Zmc2V0SGVpZ2h0KyJweCwiK18xMy5vZmZzZXRXaWR0aCsicHgpIjsKfQp9CnZhciBfMTk9c2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXsKaWYoXzE4PjAmJl8xNitfMTg+XzE0KXsKXzE4PV8xNC1fMTY7Cn0KaWYoXzE4PDAmJl8xNitfMTg8XzE0KXsKXzE4PS0oXzE2LV8xNCk7Cn0KaWYoXzE4PDAmJiF3cHRoZW1lLm1vYmlsZU5hdlNpZGVUb2dnbGluZ1Jvb3QpewppZihpYm1DZmcudGhlbWVDb25maWcuaXNSVEwpewpfMTMuc3R5bGUuY2xpcD0icmVjdCgwcHgsIisoXzEzLm9mZnNldFdpZHRoLShfMTctPV8xOCkpKyJweCwiK18xMy5vZmZzZXRIZWlnaHQrInB4LDBweCkiOwp9ZWxzZXsKXzEzLnN0eWxlLmNsaXA9InJlY3QoMHB4LCIrXzEzLm9mZnNldFdpZHRoKyJweCwiK18xMy5vZmZzZXRIZWlnaHQrInB4LCIrKF8xNy09XzE4KSsicHgpIjsKfQp9CmlmKF8xOD4wJiYhd3B0aGVtZS5tb2JpbGVOYXZTaWRlVG9nZ2xpbmdSb290KXsKaWYoaWJtQ2ZnLnRoZW1lQ29uZmlnLmlzUlRMKXsKXzEzLnN0eWxlLmNsaXA9InJlY3QoMHB4LCIrKF8xNys9XzE4KSsicHgsIitfMTMub2Zmc2V0SGVpZ2h0KyJweCwwcHgpIjsKfWVsc2V7Cl8xMy5zdHlsZS5jbGlwPSJyZWN0KDBweCwiK18xMy5vZmZzZXRXaWR0aCsicHgsIitfMTMub2Zmc2V0SGVpZ2h0KyJweCwiKyhfMTMub2Zmc2V0V2lkdGgtKF8xNys9XzE4KSkrInB4KSI7Cn0KfQppZihpYm1DZmcudGhlbWVDb25maWcuaXNSVEwpewpfMTMuc3R5bGUucmlnaHQ9KF8xNis9XzE4KSsicHgiOwp9ZWxzZXsKXzEzLnN0eWxlLmxlZnQ9KF8xNis9XzE4KSsicHgiOwp9CmlmKF8xOD4wJiZfMTY+PV8xNHx8XzE4PDAmJl8xNjw9XzE0fHxfMTg9PTApewpjbGVhckludGVydmFsKF8xOSk7Cl8xMy5zdHlsZS5jbGlwPSIiOwppZihfMTUpewpfMTUuY2FsbCgpOwp9Cn0KfSwxKTsKfSx0b2dnbGVNb2JpbGVOYXY6ZnVuY3Rpb24oaWQsXzFhLF8xYixfMWMsXzFkLF8xZSxfMWYpewp2YXIgXzIwPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKdmFyIF8yMT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid3B0aGVtZU5hdlJvb3RMaW5rIik7CnZhciBfMjI9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQrIkxpbmsiKTsKdmFyIF8yMz1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCsiQWNjZXNzIik7CnZhciBfMjQ9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQrIlN1Ym5hdiIpOwp2YXIgXzI1PWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkZXIiKVswXTsKdmFyIF8yNj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGF5b3V0Q29udGFpbmVycyIpOwppZihfMjApewppZihfMWY9PTApewppZihpJC5oYXNDbGFzcyhfMjEsIndwdGhlbWVOYXZPcGVuZWQiKSl7CmkkLnJlbW92ZUNsYXNzKF8yMSwid3B0aGVtZU5hdk9wZW5lZCIpOwp9ZWxzZXsKaSQuYWRkQ2xhc3MoXzIxLCJ3cHRoZW1lTmF2T3BlbmVkIik7Cn0KfQppZihpJC5oYXNDbGFzcyhfMjAsXzFhKSl7CmlmKGlkPT1fMWQmJl8xZSl7CnRoaXMubW9iaWxlTmF2U2lkZVRvZ2dsaW5nUm9vdD10cnVlOwpfMjAuc3R5bGUudG9wPV8yNS5vZmZzZXRIZWlnaHQrInB4IjsKXzIwLnN0eWxlLmhlaWdodD0od2luZG93LmlubmVySGVpZ2h0LV8yMC5vZmZzZXRUb3ApKyJweCI7CmlmKGlibUNmZy50aGVtZUNvbmZpZy5pc1JUTCl7Cl8yMC5zdHlsZS5yaWdodD0oLV8yMC5vZmZzZXRXaWR0aCkrInB4IjsKfWVsc2V7Cl8yMC5zdHlsZS5sZWZ0PSgtXzIwLm9mZnNldFdpZHRoKSsicHgiOwp9CnRoaXMubW9iaWxlTmF2UmVzaXplQmluZGluZz1pJC5iaW5kRG9tRXZ0KHdpbmRvdywicmVzaXplIix0aGlzLnJlc2l6ZU1vYmlsZU5hdlNpZGUpOwp9CmkkLnJlbW92ZUNsYXNzKF8yMCxfMWEpOwpfMjAuc2V0QXR0cmlidXRlKCJhcmlhLWV4cGFuZGVkIiwidHJ1ZSIpOwpfMjIuc2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIixfMWMpOwpfMjIudGl0bGU9XzIzLmlubmVySFRNTD1fMWM7CmlmKGlkPT1fMWQmJl8xZSl7Cl8yNS5zdHlsZS5wb3NpdGlvbj0iZml4ZWQiOwpfMjUuc3R5bGUud2lkdGg9IjEwMCUiOwpfMjYuc3R5bGUucGFkZGluZ1RvcD1fMjUub2Zmc2V0SGVpZ2h0KzEwKyJweCI7Cl8yNS5zdHlsZS56SW5kZXg9Ijk5OTgiOwpfMjUuc3R5bGUudG9wPSIwcHgiOwp0aGlzLmFuaW1hdGVNb2JpbGVOYXZTaWRlUGFuZWwoXzIwLDAsZnVuY3Rpb24oKXsKaWYod3B0aGVtZS5tb2JpbGVOYXZTaWRlTGFzdEV4cGFuZGVkLmxlbmd0aD09MCl7CndwdGhlbWUubW9iaWxlTmF2U2lkZVRvZ2dsaW5nUm9vdD1mYWxzZTsKfQp9KTsKfQppZihfMWUpewppZihpZD09XzFkKXsKZm9yKHZhciBpPTA7aTx0aGlzLm1vYmlsZU5hdlNpZGVMYXN0RXhwYW5kZWQubGVuZ3RoO2krKyl7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMubW9iaWxlTmF2U2lkZUxhc3RFeHBhbmRlZFtpXSkub25jbGljay5jYWxsKCk7Cn0KfWVsc2V7CnRoaXMubW9iaWxlTmF2U2lkZUV4cGFuZGVkLnB1c2goaWQrIkxpbmsiKTsKXzIyLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLm9uY2xpY2s9XzIyLm9uY2xpY2s7Cn0KfQppZihfMjQmJl8xZSl7CnZhciBfMjc9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXzFkKTsKdmFyIF8yOD1fMjcucGFyZW50Tm9kZTsKaWYoXzI0LnBhcmVudE5vZGUhPV8yOCl7Cl8yND1fMjQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChfMjQpOwpfMjguYXBwZW5kQ2hpbGQoXzI0KTsKfQp2YXIgXzI5PU1hdGgubWluKChfMWYqNzApLE1hdGguZmxvb3Iod2luZG93LmlubmVyV2lkdGgtXzI0Lm9mZnNldFdpZHRoKS0xKTsKXzI0LnN0eWxlLnRvcD1fMjcub2Zmc2V0VG9wKyJweCI7Cl8yNC5zdHlsZS5oZWlnaHQ9KHdpbmRvdy5pbm5lckhlaWdodC1fMjQub2Zmc2V0VG9wKSsicHgiOwppZih0aGlzLm1vYmlsZU5hdlNpZGVUb2dnbGluZ1Jvb3QpewppZihpYm1DZmcudGhlbWVDb25maWcuaXNSVEwpewpfMjQuc3R5bGUucmlnaHQ9KC1fMjQub2Zmc2V0V2lkdGgpKyJweCI7Cn1lbHNlewpfMjQuc3R5bGUubGVmdD0oLV8yNC5vZmZzZXRXaWR0aCkrInB4IjsKfQp9ZWxzZXsKaWYoaWJtQ2ZnLnRoZW1lQ29uZmlnLmlzUlRMKXsKXzI0LnN0eWxlLnJpZ2h0PShfMjktXzI0Lm9mZnNldFdpZHRoKSsicHgiOwp9ZWxzZXsKXzI0LnN0eWxlLmxlZnQ9KF8yOS1fMjQub2Zmc2V0V2lkdGgpKyJweCI7Cn0KfQppJC5yZW1vdmVDbGFzcyhfMjQsXzFhKTsKdGhpcy5hbmltYXRlTW9iaWxlTmF2U2lkZVBhbmVsKF8yNCxfMjksZnVuY3Rpb24oKXsKaWYod3B0aGVtZS5tb2JpbGVOYXZTaWRlVG9nZ2xpbmdSb290JiZpZCsiTGluayI9PXdwdGhlbWUubW9iaWxlTmF2U2lkZUxhc3RFeHBhbmRlZFt3cHRoZW1lLm1vYmlsZU5hdlNpZGVMYXN0RXhwYW5kZWQubGVuZ3RoLTFdKXsKd3B0aGVtZS5tb2JpbGVOYXZTaWRlVG9nZ2xpbmdSb290PWZhbHNlOwp9Cn0pOwp9Cn1lbHNlewppZihfMWUpewppZihpZD09XzFkKXsKdGhpcy5tb2JpbGVOYXZTaWRlVG9nZ2xpbmdSb290PXRydWU7CnRoaXMubW9iaWxlTmF2U2lkZUxhc3RFeHBhbmRlZD10aGlzLm1vYmlsZU5hdlNpZGVFeHBhbmRlZC5zbGljZSgwKTsKZm9yKHZhciBpPXRoaXMubW9iaWxlTmF2U2lkZUV4cGFuZGVkLmxlbmd0aC0xO2k+PTA7aS0tKXsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5tb2JpbGVOYXZTaWRlRXhwYW5kZWRbaV0pLm9uY2xpY2suY2FsbCgpOwp9Cn1lbHNlewp2YXIgXzJhPWlkKyJMaW5rIjsKdmFyIGk9LTE7CmZvcih2YXIgaj10aGlzLm1vYmlsZU5hdlNpZGVFeHBhbmRlZC5sZW5ndGgtMTtqPj0wO2otLSl7CmlmKHRoaXMubW9iaWxlTmF2U2lkZUV4cGFuZGVkW2pdPT1fMmEpewppPWo7CmJyZWFrOwp9Cn0KaWYoaSE9LTEpewp2YXIgXzJiOwpmb3IodmFyIGo9dGhpcy5tb2JpbGVOYXZTaWRlRXhwYW5kZWQubGVuZ3RoLTE7aj49aTtqLS0pewpfMmI9dGhpcy5tb2JpbGVOYXZTaWRlRXhwYW5kZWQucG9wKCk7CmlmKF8yYSE9XzJiKXsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXzJiKS5vbmNsaWNrLmNhbGwoKTsKfQp9Cn0KXzIyLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLm9uY2xpY2s9bnVsbDsKfQp9CmlmKF8yNCYmXzFlKXsKdmFyIF8yOT1fMjQub2Zmc2V0TGVmdDsKaWYoaWJtQ2ZnLnRoZW1lQ29uZmlnLmlzUlRMKXsKXzI5PXBhcnNlSW50KF8yNC5zdHlsZS5yaWdodCk7Cn0KdGhpcy5hbmltYXRlTW9iaWxlTmF2U2lkZVBhbmVsKF8yNCxfMjktXzI0Lm9mZnNldFdpZHRoLGZ1bmN0aW9uKCl7CmkkLmFkZENsYXNzKF8yNCxfMWEpOwppZihfMjQucGFyZW50Tm9kZSE9XzIwKXsKXzI0PV8yNC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKF8yNCk7Cl8yMC5hcHBlbmRDaGlsZChfMjQpOwp9Cn0pOwp9CmlmKGlkPT1fMWQmJl8xZSl7Cl8yNS5zdHlsZS5wb3NpdGlvbj0ic3RhdGljIjsKXzI2LnN0eWxlLnBhZGRpbmdUb3A9IiI7Cl8yNS5zdHlsZS53aWR0aD0iYXV0byI7Cl8yNS5zdHlsZS56SW5kZXg9ImF1dG8iOwp0aGlzLmFuaW1hdGVNb2JpbGVOYXZTaWRlUGFuZWwoXzIwLC1fMjAub2Zmc2V0V2lkdGgsZnVuY3Rpb24oKXsKaSQuYWRkQ2xhc3MoXzIwLF8xYSk7Cl8yMC5zZXRBdHRyaWJ1dGUoImFyaWEtZXhwYW5kZWQiLCJmYWxzZSIpOwpfMjIuc2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIixfMWIpOwpfMjIudGl0bGU9XzIzLmlubmVySFRNTD1fMWI7CndwdGhlbWUubW9iaWxlTmF2U2lkZVRvZ2dsaW5nUm9vdD1mYWxzZTsKfSk7CmkkLnVuYmluZERvbUV2dCh0aGlzLm1vYmlsZU5hdlJlc2l6ZUJpbmRpbmcpOwp0aGlzLm1vYmlsZU5hdlJlc2l6ZUJpbmRpbmc9bnVsbDsKfWVsc2V7CmkkLmFkZENsYXNzKF8yMCxfMWEpOwpfMjAuc2V0QXR0cmlidXRlKCJhcmlhLWV4cGFuZGVkIiwiZmFsc2UiKTsKXzIyLnNldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIsXzFiKTsKXzIyLnRpdGxlPV8yMy5pbm5lckhUTUw9XzFiOwp9Cn0KfQp9LHRvZ2dsZU1vYmlsZVRvcE5hdjpmdW5jdGlvbihfMmMsXzJkKXsKdmFyIF8yZT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid3B0aGVtZVRvcE5hdlRvZ2dsZUJ0biIpOwp2YXIgXzJmPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3cHRoZW1lVG9wTmF2VG9nZ2xlQnRuQWNjZXNzIik7CnZhciBfMzA9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWRlciIpWzBdOwp2YXIgXzMxPV8zMC5jaGlsZHJlblswXTsKaWYoaSQuaGFzQ2xhc3MoXzJlLCJ3cHRoZW1lVG9wTmF2T3BlbmVkIikpewpfMzEuc3R5bGUuZGlzcGxheT0ibm9uZSI7CmkkLnJlbW92ZUNsYXNzKF8yZSwid3B0aGVtZVRvcE5hdk9wZW5lZCIpOwpfMmUuc2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIixfMmMpOwpfMmUudGl0bGU9XzJmLmlubmVySFRNTD1fMmM7Cn1lbHNlewpfMzEuc3R5bGUuZGlzcGxheT0iYmxvY2siOwppJC5hZGRDbGFzcyhfMmUsIndwdGhlbWVUb3BOYXZPcGVuZWQiKTsKXzJlLnNldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIsXzJkKTsKXzJlLnRpdGxlPV8yZi5pbm5lckhUTUw9XzJkOwp9CnRoaXMucmVzaXplTW9iaWxlTmF2U2lkZSgpOwp9fSk7CnZhciBfMzI9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndwdGhlbWVIZWxwTGluayIpOwp2YXIgXzMzPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3cHRoZW1lSGVscE9uQ2xpY2siKTsKdmFyIF8zND1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid3B0aGVtZUhlbHBBbmNob3IiKTsKaWYoIShfMzI9PT1udWxsJiZfMzM9PT1udWxsKSYmXzM0IT1udWxsKXsKaWYoXzMyIT1udWxsKXsKdmFyIF8zNT1fMzIuaW5uZXJIVE1MOwpfMzQub25jbGljaz1mdW5jdGlvbigpewp3aW5kb3cub3BlbihfMzUsIndwdGhlbWVIZWxwIiwid2lkdGg9ODAwLGhlaWdodD02MDAiKTsKfTsKfWVsc2V7CmlmKF8zMyE9bnVsbCl7CnZhciBfMzY9XzMzLmlubmVySFRNTDsKXzM0Lm9uY2xpY2s9ZnVuY3Rpb24oKXsKZXZhbChfMzYpOwp9Owp9Cn0KfQp9KSgpOwoKCn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICd3cF90aGVtZV9lZGl0JzogIixlKTt9CnRyeXsvLyBjcmVhdGUgYSB0ZXN0IG5vZGUgb2ZmIHRoZSBicm93c2VyIHNjcmVlbiB0byBjYWxjdWxhdGUgaGlnaCBjb250cmFzdCBtb2RlCnZhciB0ZXN0Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwp0ZXN0Tm9kZS5jbGFzc05hbWUgPSAiaGlnaENvbnRyYXN0VGVzdE5vZGUiOwpkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRlc3ROb2RlKTsKLy8gbG9vayBhdCB0aGUgY29tcHV0ZWQgc3R5bGUgZm9yIHRoZSB0ZXN0IG5vZGUKdmFyIHN0eWxlcyA9IG51bGw7CnRyeSB7CglzdHlsZXMgPSBkb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKHRlc3ROb2RlLCAiIik7Cn0gY2F0Y2goZSkgewoJc3R5bGVzID0gdGVzdE5vZGUuY3VycmVudFN0eWxlOwp9CnZhciB0ZXN0SW1nID0gc3R5bGVzLmJhY2tncm91bmRJbWFnZTsKaWYgKChzdHlsZXMuYm9yZGVyVG9wQ29sb3IgPT0gc3R5bGVzLmJvcmRlclJpZ2h0Q29sb3IpIHx8ICh0ZXN0SW1nICE9IG51bGwgJiYgKHRlc3RJbWcgPT0gIm5vbmUiIHx8IHRlc3RJbWcgPT0gInVybChpbnZhbGlkLXVybDopIiApKSkgewoJZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXS5jbGFzc05hbWUrPSIgbG90dXNJbWFnZXNPZmYiOwp9CmRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGVzdE5vZGUpOwoKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ3dwX29uZV91aV8zMCc6ICIsZSk7fQp0cnl7KGZ1bmN0aW9uKCl7CmlmKCFpJC5pc0lFKXsKaSQuYWRkT25Mb2FkKGZ1bmN0aW9uKCl7CnZhciBfMT1kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiU0VDVElPTiIpOwpmb3IodmFyIGk9MDtpPF8xLmxlbmd0aDtpKyspewppZihpJC5oYXNDbGFzcyhfMVtpXSwiYTExeVJlZ2lvblRhcmdldCIpKXsKdmFyIF8yPV8xW2ldOwp2YXIgXzM9bnVsbDsKdmFyIF80PV8yLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJTUEFOIik7CmZvcih2YXIgaj0wO2o8XzQubGVuZ3RoO2orKyl7CmlmKGkkLmhhc0NsYXNzKF80W2pdLCJhMTF5UmVnaW9uTGFiZWwiKSl7Cl8zPV80W2pdOwp9Cn0KaWYoXzMpewp2YXIgXzU9XzM7CnZhciBfNj1fMjsKdmFyIF83PW51bGw7CndoaWxlKChfNj1fNi5wYXJlbnROb2RlKSE9bnVsbCl7CmlmKGkkLmhhc0NsYXNzKF82LCJjb21wb25lbnQtY29udHJvbCIpKXsKdmFyIG09XzYmJihfNi5jbGFzc05hbWV8fCIiKS5tYXRjaCgvaWQtKFtcU10rKS8pOwpfNz1tJiZtWzFdOwpicmVhazsKfQp9CmlmKF83KXsKdmFyIF84PSJ3cFJlZ2lvbklkIitfNzsKXzUuc2V0QXR0cmlidXRlKCJpZCIsXzgpOwpfMi5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWxsZWRieSIsXzgpOwp9Cn0KfQp9Cn0pOwp9Cn0pKCk7CgoKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ3dwX3RoZW1lX3NraW5fcmVnaW9uJzogIixlKTt9CnRyeXsoZnVuY3Rpb24oKXsKICAgIGkkLm1lcmdlKHsKCSJXQVJOSU5HXzAiOiJXYXJuaW5nIiwKCSJERUxFVEVfMCI6IkRlbGV0ZSIsCgkiSU5GT18wIjoiSW5mb3JtYXRpb24iLAoJIk1FU1NBR0VTX0FWQUlMQUJMRV8xIjoiJHswfSBtZXNzYWdlcyBhcmUgYXZhaWxhYmxlIGZvciByZXZpZXciLAoJIlNIT1dfREVUQUlMU18wIjoiU2hvdyBEZXRhaWxzIiwKCSJFUlJPUl8wIjoiRXJyb3IiLAoJIkhJREVfREVUQUlMU18wIjoiSGlkZSBEZXRhaWxzIgp9LGkkLmZyb21QYXRoKCJ3cHRoZW1lLnN0YXR1c0Jhci5ubHMiLHRydWUpKTsKfSkoKTsKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ3dwX3N0YXR1c19iYXInOiAiLGUpO30KdHJ5eyhmdW5jdGlvbigpewppZih0eXBlb2YgY29tPT09InVuZGVmaW5lZCJ8fCFjb20pewpjb209e307Cn0KaWYodHlwZW9mIGNvbS5pYm09PT0idW5kZWZpbmVkInx8IWNvbS5pYm0pewpjb20uaWJtPXt9Owp9CmlmKHR5cGVvZiBjb20uaWJtLndpZGdldHM9PT0idW5kZWZpbmVkInx8IWNvbS5pYm0ud2lkZ2V0cyl7CmNvbS5pYm0ud2lkZ2V0cz17fTsKfQppZih0eXBlb2YgY29tLmlibS53aWRnZXRzLlN0YXR1c1R5cGU9PT0idW5kZWZpbmVkInx8IWNvbS5pYm0ud2lkZ2V0cy5TdGF0dXNUeXBlKXsKY29tLmlibS53aWRnZXRzLlN0YXR1c1R5cGU9ZnVuY3Rpb24oaWQsXzEsXzIsXzMpewp0aGlzLl9pZD1pZDsKdGhpcy5fc3R5bGVDbGFzcz1fMTsKdGhpcy5faWNvblBhdGg9XzI7CnRoaXMuX2ljb25BbHQ9XzM7Cn07Cn0KaWYodHlwZW9mIGNvbS5pYm0ud2lkZ2V0cy5TdGF0dXNNZXNzYWdlPT09InVuZGVmaW5lZCJ8fCFjb20uaWJtLndpZGdldHMuU3RhdHVzTWVzc2FnZSl7CmNvbS5pYm0ud2lkZ2V0cy5TdGF0dXNNZXNzYWdlPWZ1bmN0aW9uKF80LF81LF82KXsKdGhpcy5fdHlwZT1fNDsKdGhpcy5fbWVzc2FnZT1fNTsKaWYoIWkkLmlzU3RyaW5nKF81KSYmXzUubWVzc2FnZSYmaSQuaXNTdHJpbmcoXzUubWVzc2FnZSkpewp0aGlzLl9tZXNzYWdlPV81Lm1lc3NhZ2U7Cn0KdGhpcy5fZGV0YWlscz1fNjsKfTsKfQppZih0eXBlb2YgY29tLmlibS53aWRnZXRzLlN0YXR1c0JhclYyPT09InVuZGVmaW5lZCJ8fCFjb20uaWJtLndpZGdldHMuU3RhdHVzQmFyVjIpewpjb20uaWJtLndpZGdldHMuU3RhdHVzQmFyVjI9ZnVuY3Rpb24oXzcpewp0aGlzLnVpZD1fNzsKdGhpcy5zaG93RGV0YWlscz1mYWxzZTsKdGhpcy5fbWVzc2FnZXM9W107CnRoaXMuX2Nvbm5lY3Rpb25zPVtdOwp0aGlzLl9udW1NZXNzYWdlcz0wOwp0aGlzLl9iYXNlVVJMPXdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCsiLy8iK3dpbmRvdy5sb2NhdGlvbi5ob3N0Owp0aGlzLmJsYW5rR2lmSWNvbj0iZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFJQUFBUC8vL3dBQUFDSDVCQUVBQUFBQUxBQUFBQUFCQUFFQUFBSUNSQUVBT3c9PSI7CnRoaXMuX3N0YXR1c1R5cGVzTWFwPXsiZXJyb3IiOm5ldyBjb20uaWJtLndpZGdldHMuU3RhdHVzVHlwZSgwLCJ3cHRoZW1lRXJyb3IiLHRoaXMuYmxhbmtHaWZJY29uLHdwdGhlbWUuc3RhdHVzQmFyLm5scy5FUlJPUl8wKSwid2FybmluZyI6bmV3IGNvbS5pYm0ud2lkZ2V0cy5TdGF0dXNUeXBlKDEsIndwdGhlbWVXYXJuaW5nIix0aGlzLmJsYW5rR2lmSWNvbix3cHRoZW1lLnN0YXR1c0Jhci5ubHMuV0FSTklOR18wKSwiaW5mbyI6bmV3IGNvbS5pYm0ud2lkZ2V0cy5TdGF0dXNUeXBlKDIsIndwdGhlbWVJbmZvIix0aGlzLmJsYW5rR2lmSWNvbix3cHRoZW1lLnN0YXR1c0Jhci5ubHMuSU5GT18wKX07CmkkLmFkZExpc3RlbmVyKCIvcG9ydGFsL3N0YXR1cyIsaSQuc2NvcGUodGhpcyx0aGlzLmFkZE1lc3NhZ2UpKTsKaSQuYWRkTGlzdGVuZXIoIi9tZXNzYWdlL3N0YXR1cyIsaSQuc2NvcGUodGhpcyx0aGlzLmFkZE1lc3NhZ2UpKTsKaSQuYWRkTGlzdGVuZXIoIi9wb3J0YWwvc3RhdHVzL2NsZWFyIixpJC5zY29wZSh0aGlzLHRoaXMuY2xlYXJNZXNzYWdlKSk7CmkkLmFkZExpc3RlbmVyKCIvbWVzc2FnZS9zdGF0dXMvY2xlYXIiLGkkLnNjb3BlKHRoaXMsdGhpcy5jbGVhck1lc3NhZ2UpKTsKaWYodHlwZW9mIChpYm1DZmcpIT0idW5kZWZpbmVkIiYmaWJtQ2ZnLnBvcnRhbENvbmZpZyl7CnRoaXMuaXNCaWRpPWlibUNmZy5wb3J0YWxDb25maWcuaXNSVEw7Cn1lbHNlewppZih0eXBlb2YgKGlibVBvcnRhbENvbmZpZykhPSJ1bmRlZmluZWQiKXsKdGhpcy5pc0JpZGk9aWJtUG9ydGFsQ29uZmlnLmlzUlRMOwp9ZWxzZXsKaWYodHlwZW9mIChpYm1Db25maWcpIT0idW5kZWZpbmVkIil7CnRoaXMuaXNCaWRpPWlibUNvbmZpZy5pc0JpZGk7Cn0KfQp9CmkkLmFkZE9uVW5sb2FkKGkkLnNjb3BlKHRoaXMsdGhpcy5fb25XaW5kb3dVbmxvYWQpKTsKdGhpcy5jb250YWluZXJOb2RlPWkkLmJ5SWQoIndwdGhlbWVTdGF0dXNCYXJDb250YWluZXIiKTsKfTsKfQppJC5hdWdtZW50KGNvbS5pYm0ud2lkZ2V0cy5TdGF0dXNCYXJWMix7X29uV2luZG93VW5sb2FkOmZ1bmN0aW9uKCl7CmkkLmZvckVhY2godGhpcy5fY29ubmVjdGlvbnMsZnVuY3Rpb24oXzgpewppJC51bmJpbmREb21FdnQoXzgpOwp9KTsKdGhpcy5fY29ubmVjdGlvbnM9bnVsbDsKdGhpcy5jbGVhcigpOwp0aGlzLl9tZXNzYWdlcz1udWxsOwp9LF9nZXRTdGF0dXNDb250YWluZXI6ZnVuY3Rpb24oKXsKcmV0dXJuIHRoaXMuY29udGFpbmVyTm9kZTsKfSxfZXNjYXBlSFRNTDpmdW5jdGlvbihfOSl7CmlmKF85LnJlcGxhY2UpewpyZXR1cm4gXzkucmVwbGFjZSgvJi9nLCImYW1wOyIpLnJlcGxhY2UoLz4vZywiJmd0OyIpLnJlcGxhY2UoLzwvZywiJmx0OyIpLnJlcGxhY2UoLyIvZywiJnF1b3Q7Iik7Cn0KcmV0dXJuIF85Owp9LHNldFNob3dEZXRhaWxzOmZ1bmN0aW9uKF9hKXsKdGhpcy5zaG93RGV0YWlscz1fYTsKfSx0b2dnbGVTaG93RGV0YWlsczpmdW5jdGlvbigpewp0aGlzLnNldFNob3dEZXRhaWxzKCF0aGlzLnNob3dEZXRhaWxzKTsKdGhpcy5yZW5kZXIoKTsKfSxjbGVhcjpmdW5jdGlvbigpewp2YXIgX2I9dGhpcy5fZ2V0U3RhdHVzQ29udGFpbmVyKCk7CmlmKCEhX2IpewpfYi5pbm5lckhUTUw9IiI7Cl9iLnNldEF0dHJpYnV0ZSgicm9sZSIsIiIpOwpfYi5zZXRBdHRyaWJ1dGUoIndhaXJvbGUiLCIiKTsKfQp0aGlzLl9tZXNzYWdlcy5sZW5ndGg9MDsKfSxjbGVhck1lc3NhZ2U6ZnVuY3Rpb24oX2MpewppZihfYy51aWQmJl9jLnVpZCE9dGhpcy51aWQpewpyZXR1cm47Cn0KdmFyIF9kPV9jLm1lc3NhZ2U7CmlmKHR5cGVvZiBfZD09PSJ1bmRlZmluZWQifHxfZD09PW51bGwpewp0aGlzLmNsZWFyKCk7Cn1lbHNlewpmb3IodmFyIGk9dGhpcy5fbWVzc2FnZXMubGVuZ3RoLTE7aT49MDtpLS0pewppZih0aGlzLl9tZXNzYWdlc1tpXS5fdHlwZT09X2QuX3R5cGUmJnRoaXMuX21lc3NhZ2VzW2ldLl9tZXNzYWdlPT1fZC5fbWVzc2FnZSYmdGhpcy5fbWVzc2FnZXNbaV0uX2RldGFpbHM9PV9kLl9kZXRhaWxzKXsKdGhpcy5fbWVzc2FnZXMuc3BsaWNlKGksMSk7Cn0KfQppZih0aGlzLl9tZXNzYWdlcy5sZW5ndGg9PTApewp0aGlzLmNsZWFyKCk7Cn1lbHNlewppZih0aGlzLl9tZXNzYWdlcy5sZW5ndGg8MTAwKXsKdGhpcy5yZW5kZXIodGhpcy5fZ2V0U3RhdHVzQ29udGFpbmVyKCkpOwp9Cn0KfQp9LGFkZE1lc3NhZ2U6ZnVuY3Rpb24oX2UpewppZihfZS51aWQmJl9lLnVpZCE9dGhpcy51aWQpewpyZXR1cm47Cn0KdmFyIF9mPV9lLm1lc3NhZ2U7CnRoaXMuX21lc3NhZ2VzLnB1c2goX2YpOwppZih0aGlzLl9tZXNzYWdlcy5sZW5ndGg8MTAwKXsKdGhpcy5yZW5kZXIodGhpcy5fZ2V0U3RhdHVzQ29udGFpbmVyKCkpOwp9Cn0scmVuZGVyOmZ1bmN0aW9uKF8xMCl7CmlmKF8xMD09bnVsbCl7Cl8xMD10aGlzLl9nZXRTdGF0dXNDb250YWluZXIoKTsKfQpfMTAuaW5uZXJIVE1MPSIiOwppZih0aGlzLl9tZXNzYWdlcy5sZW5ndGg+MSl7CnRoaXMucmVuZGVySGVhZGVyKF8xMCk7Cn1lbHNlewppZih0aGlzLl9tZXNzYWdlcy5sZW5ndGg9PTEpewp0aGlzLnJlbmRlck1lc3NhZ2UoXzEwLHRoaXMuX21lc3NhZ2VzWzBdLHRoaXMuc2hvd0RldGFpbHMsMCk7Cn0KfQppZih0aGlzLnNob3dEZXRhaWxzJiZ0aGlzLl9tZXNzYWdlcy5sZW5ndGg+MSl7CmZvcih4IGluIHRoaXMuX21lc3NhZ2VzKXsKdGhpcy5yZW5kZXJNZXNzYWdlKF8xMCx0aGlzLl9tZXNzYWdlc1t4XSx0aGlzLnNob3dEZXRhaWxzLHgpOwp9Cn0KfSxyZW5kZXJIZWFkZXI6ZnVuY3Rpb24oXzExKXsKaWYodGhpcy5fbWVzc2FnZXMubGVuZ3RoPjEpewp2YXIgXzEyPTI7CmZvcih2YXIgaT0wO2k8dGhpcy5fbWVzc2FnZXMubGVuZ3RoO2krKyl7Cl8xMj1NYXRoLm1pbihfMTIsdGhpcy5fc3RhdHVzVHlwZXNNYXBbdGhpcy5fbWVzc2FnZXNbaV0uX3R5cGVdLl9pZCk7Cn0KdmFyIF8xMz0iaW5mbyI7CmZvcih4IGluIHRoaXMuX3N0YXR1c1R5cGVzTWFwKXsKaWYodGhpcy5fc3RhdHVzVHlwZXNNYXBbeF0uX2lkPT1fMTIpewpfMTM9eDsKYnJlYWs7Cn0KfQp2YXIgXzE0PW5ldyBjb20uaWJtLndpZGdldHMuU3RhdHVzTWVzc2FnZShfMTMsd3B0aGVtZS5zdGF0dXNCYXIubmxzLk1FU1NBR0VTX0FWQUlMQUJMRV8xLnJlcGxhY2UoIiR7MH0iLHRoaXMuX21lc3NhZ2VzLmxlbmd0aCksIiIpOwp0aGlzLnJlbmRlck1lc3NhZ2UoXzExLF8xNCx0aGlzLnNob3dEZXRhaWxzLC0xKTsKfQp9LHJlbmRlck1lc3NhZ2U6ZnVuY3Rpb24oXzE1LF8xNixfMTcsXzE4KXsKdmFyIF8xOT10aGlzLl9zdGF0dXNUeXBlc01hcFtfMTYuX3R5cGVdOwp2YXIgXzFhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwpfMWEuY2xhc3NOYW1lPSJ3cHRoZW1lTWVzc2FnZSAiK18xOS5fc3R5bGVDbGFzczsKaWYodGhpcy5fbWVzc2FnZXMubGVuZ3RoPjEmJl8xOD49MCl7Cl8xYS5jbGFzc05hbWUrPSIgd3B0aGVtZU1vcmVNc2ciOwp9CnZhciBfMWI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7Cl8xYi5jbGFzc05hbWU9IndwdGhlbWVNc2dJY29uICIrKF8xOS5fc3R5bGVDbGFzcz09IndwdGhlbWVFcnJvciI/IndwdGhlbWVNc2dJY29uRXJyb3IiOl8xOS5fc3R5bGVDbGFzcz09IndwdGhlbWVXYXJuaW5nIj8id3B0aGVtZU1zZ0ljb25XYXJuaW5nIjoid3B0aGVtZU1zZ0ljb25JbmZvIik7Cl8xYi5zcmM9XzE5Ll9pY29uUGF0aDsKXzFiLmFsdD1fMWIudGl0bGU9XzE5Ll9pY29uQWx0OwpfMWEuYXBwZW5kQ2hpbGQoXzFiKTsKdmFyIF8xYz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7Cl8xYy5jbGFzc05hbWU9IndwdGhlbWVBbHRUZXh0IjsKXzFjLmlubmVySFRNTD10aGlzLl9lc2NhcGVIVE1MKF8xOS5faWNvbkFsdCsiOiIpOwpfMWEuYXBwZW5kQ2hpbGQoXzFjKTsKdmFyIF8xZD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKXzFkLmNsYXNzTmFtZT0id3B0aGVtZU1lc3NhZ2VCb2R5IjsKXzFkLmlubmVySFRNTD10aGlzLl9lc2NhcGVIVE1MKF8xNi5fbWVzc2FnZSk7Cl8xYS5hcHBlbmRDaGlsZChfMWQpOwppZigodGhpcy5fbWVzc2FnZXMubGVuZ3RoPjEmJl8xODwwKXx8KHRoaXMuX21lc3NhZ2VzLmxlbmd0aD09MSkpewppZihfMTYuX2RldGFpbHMmJl8xNi5fZGV0YWlscy5sZW5ndGg+MHx8XzE4PDApewp2YXIgXzFlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKXzFlLmhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSI7Cl8xZS5jbGFzc05hbWU9IndwdGhlbWVIaWRlU2hvdyI7Cl8xZS5yb2xlPSJidXR0b24iOwp0aGlzLl9jb25uZWN0aW9ucy5wdXNoKGkkLmJpbmREb21FdnQoXzFlLCJvbmNsaWNrIixpJC5zY29wZSh0aGlzLHRoaXMudG9nZ2xlU2hvd0RldGFpbHMpKSk7CnZhciBfMWY9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7Cl8xZi5jbGFzc05hbWU9IndwdGhlbWVNc2dJY29uMTYiOwpfMWYuc3JjPWlibUNmZy50aGVtZUNvbmZpZy5tb2R1bGVzV2ViQXBwQmFzZVVSSSsiL3RoZW1lcy9odG1sL2R5bmFtaWNTcG90cy9pY29ucy9ibGFuay5naWYiOwpfMWUuYXBwZW5kQ2hpbGQoXzFmKTsKdmFyIF8yMD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7Cl8yMC5jbGFzc05hbWU9IndwdGhlbWVBbHRUZXh0IjsKXzFlLmFwcGVuZENoaWxkKF8yMCk7Cn1lbHNlewpfMTc9ZmFsc2U7Cn0KdmFyIF8yMT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7Cl8yMS5ocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCk7IjsKXzIxLmNsYXNzTmFtZT0id3B0aGVtZURlbGV0ZSI7Cl8yMS5yb2xlPSJidXR0b24iOwpfMjEudGl0bGU9d3B0aGVtZS5zdGF0dXNCYXIubmxzLkRFTEVURV8wOwp0aGlzLl9jb25uZWN0aW9ucy5wdXNoKGkkLmJpbmREb21FdnQoXzIxLCJvbmNsaWNrIixpJC5zY29wZSh0aGlzLHRoaXMuY2xlYXIpKSk7CnZhciBfMjI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7Cl8yMi5hbHQ9d3B0aGVtZS5zdGF0dXNCYXIubmxzLkRFTEVURV8wOwpfMjIuc3JjPWlibUNmZy50aGVtZUNvbmZpZy5tb2R1bGVzV2ViQXBwQmFzZVVSSSsiL3RoZW1lcy9odG1sL2R5bmFtaWNTcG90cy9pY29ucy9ibGFuay5naWYiOwpfMjEuYXBwZW5kQ2hpbGQoXzIyKTsKdmFyIF8yMz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7Cl8yMy5jbGFzc05hbWU9IndwdGhlbWVBbHRUZXh0IjsKXzIzLmlubmVySFRNTD10aGlzLl9lc2NhcGVIVE1MKHdwdGhlbWUuc3RhdHVzQmFyLm5scy5ERUxFVEVfMCk7Cl8yMS5hcHBlbmRDaGlsZChfMjMpOwppZihfMTYuX2RldGFpbHMmJl8xNi5fZGV0YWlscy5sZW5ndGg+MHx8XzE4PDApewppZihfMTcpewpfMWUudGl0bGU9d3B0aGVtZS5zdGF0dXNCYXIubmxzLkhJREVfREVUQUlMU18wOwpfMWYuY2xhc3NOYW1lKz0iIHdwdGhlbWVNc2dJY29uSGlkZSI7Cl8xZi5hbHQ9d3B0aGVtZS5zdGF0dXNCYXIubmxzLkhJREVfREVUQUlMU18wOwpfMjAuaW5uZXJIVE1MPXRoaXMuX2VzY2FwZUhUTUwod3B0aGVtZS5zdGF0dXNCYXIubmxzLkhJREVfREVUQUlMU18wKTsKfWVsc2V7Cl8xZS50aXRsZT13cHRoZW1lLnN0YXR1c0Jhci5ubHMuU0hPV19ERVRBSUxTXzA7Cl8xZi5jbGFzc05hbWUrPSIgd3B0aGVtZU1zZ0ljb25TaG93IjsKXzFmLmFsdD13cHRoZW1lLnN0YXR1c0Jhci5ubHMuU0hPV19ERVRBSUxTXzA7Cl8yMC5pbm5lckhUTUw9dGhpcy5fZXNjYXBlSFRNTCh3cHRoZW1lLnN0YXR1c0Jhci5ubHMuU0hPV19ERVRBSUxTXzApOwp9Cl8xYS5hcHBlbmRDaGlsZChfMWUpOwp9Cl8xYS5hcHBlbmRDaGlsZChfMjEpOwp9CnZhciBfMjQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7Cl8yNC5jbGFzc05hbWU9IndwdGhlbWVDbGVhciI7Cl8xYS5hcHBlbmRDaGlsZChfMjQpOwppZihfMTYuX2RldGFpbHMmJl8xNi5fZGV0YWlscy5sZW5ndGg+MCYmXzE3JiZfMTg+PTApewp2YXIgXzI1PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwpfMjUuY2xhc3NOYW1lPSJ3cHRoZW1lRGV0YWlscyI7Cl8yNS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShfMTYuX2RldGFpbHMpKTsKXzFhLmFwcGVuZENoaWxkKF8yNSk7Cn0KXzE1LmFwcGVuZENoaWxkKF8xYSk7Cl8xNS5zZXRBdHRyaWJ1dGUoInJvbGUiLCJhbGVydCIpOwpfMTUuc2V0QXR0cmlidXRlKCJ3YWlyb2xlIiwiYWxlcnQiKTsKfX0pOwppZih0eXBlb2Ygd3BzdGF0dXNiYXI9PT0idW5kZWZpbmVkInx8IXdwc3RhdHVzYmFyKXsKd3BzdGF0dXNiYXI9bmV3IGNvbS5pYm0ud2lkZ2V0cy5TdGF0dXNCYXJWMigiaWJtU3RhdHVzQm94Iik7Cn0KdmFyIF8yNj1pJC5nZXRDb29raWUoImlibS5wb3J0YWwub3BlcmF0aW9ucy5lcnJvciIpOwppZihfMjYpewp2YXIgXzI3PWkkLmZyb21Kc29uKGRlY29kZVVSSUNvbXBvbmVudChfMjYpKTsKdmFyIF8yOD0iZXJyb3IiOwppZihfMjcuZXJyb3JUeXBlKXsKXzI4PV8yNy5lcnJvclR5cGU7Cn1lbHNlewppZihfMjcuZXJyb3JDb2RlKXsKaWYoXzI3LmVycm9yQ29kZT09IjQwMCIpewpfMjg9ImVycm9yIjsKfQp9Cn0KaSQuZmlyZUV2ZW50KCIvcG9ydGFsL3N0YXR1cyIsW3ttZXNzYWdlOm5ldyBjb20uaWJtLndpZGdldHMuU3RhdHVzTWVzc2FnZShfMjgsXzI3LmVycm9yTWVzc2FnZT9fMjcuZXJyb3JNZXNzYWdlOiIiLF8yNy5lcnJvckRldGFpbHM/XzI3LmVycm9yRGV0YWlsczoiIiksdWlkOiJpYm1TdGF0dXNCb3gifV0pOwppJC5kZWxldGVDb29raWUoImlibS5wb3J0YWwub3BlcmF0aW9ucy5lcnJvciIpOwp9CmkkLmFkZE9uTG9hZChmdW5jdGlvbigpewppZigibG9jYWxTdG9yYWdlIiBpbiB3aW5kb3cmJndpbmRvd1sibG9jYWxTdG9yYWdlIl0hPT1udWxsKXsKaWYobG9jYWxTdG9yYWdlWyJjb20uaWJtLndwLnRvb2xiYXIubXNnLm1zZyJdIT1udWxsKXsKaSQuZmlyZUV2ZW50KCIvbWVzc2FnZS9zdGF0dXMiLFt7bWVzc2FnZTpuZXcgY29tLmlibS53aWRnZXRzLlN0YXR1c01lc3NhZ2UobG9jYWxTdG9yYWdlWyJjb20uaWJtLndwLnRvb2xiYXIubXNnLnR5cGUiXSxsb2NhbFN0b3JhZ2VbImNvbS5pYm0ud3AudG9vbGJhci5tc2cubXNnIl0sIiIpLHVpZDoiaWJtU3RhdHVzQm94In1dKTsKbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oImNvbS5pYm0ud3AudG9vbGJhci5tc2cudHlwZSIpOwpsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiY29tLmlibS53cC50b29sYmFyLm1zZy5tc2ciKTsKfQp9Cn0pOwp9KSgpOwoKCn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICd3cF9zdGF0dXNfYmFyJzogIixlKTt9CnRyeXsoZnVuY3Rpb24oKXsKdmFyIF8xPWlibUNmZy5wb3J0YWxDb25maWcuY29udGVudEhhbmRsZXJVUkkrKChpYm1DZmcucG9ydGFsQ29uZmlnLmNvbnRlbnRIYW5kbGVyVVJJLmluZGV4T2YoIj8iKTwwKT8iPyI6IiYiKSsidXJpPW1lbnU6JHtpZH0iOwp2YXIgXzI9ZmFsc2U7CnZhciBfMz1mdW5jdGlvbigpewpyZXR1cm4gaSQuaGFzQ2xhc3MoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXSwiZWRpdC1tb2RlIik7Cn07CmlmKHR5cGVvZiB3cHRoZW1lPT09InVuZGVmaW5lZCJ8fCF3cHRoZW1lKXsKd3B0aGVtZT17fTsKfQppJC5tYXNoKHdwdGhlbWUse2dldFdpbmRvd0lERnJvbVNraW46ZnVuY3Rpb24oXzQpewp3aGlsZSgoXzQ9XzQucGFyZW50Tm9kZSkhPW51bGwpewppZihpJC5oYXNDbGFzcyhfNCwiY29tcG9uZW50LWNvbnRyb2wiKSl7CnZhciBtPV80JiYoXzQuY2xhc3NOYW1lfHwiIikubWF0Y2goL2lkLShbXFNdKykvKTsKcmV0dXJuIG0mJm1bMV07Cn0KfQpyZXR1cm4gbnVsbDsKfSxnZXRQb3J0bGV0U3RhdGU6ZnVuY3Rpb24oXzUpewp2YXIgXzY9aSQuYnlJZCgicG9ydGxldFN0YXRlIik7CmlmKF82KXsKaWYoIV82Ll9jYWNoZSl7Cl82Ll9jYWNoZT1pJC5mcm9tSnNvbihfNi5pbm5lckhUTUwpOwpfNi5fY2FjaGUuX2RlZmF1bHRzPXsid2luZG93U3RhdGUiOiJub3JtYWwiLCJwb3J0bGV0TW9kZSI6InZpZXcifTsKfQppZihfNi5fY2FjaGVbXzVdKXsKcmV0dXJuIF82Ll9jYWNoZVtfNV07Cn1lbHNlewpyZXR1cm4gXzYuX2NhY2hlLl9kZWZhdWx0czsKfQp9CnJldHVybiB7fTsKfSxpc1ZhbGlkT3A6ZnVuY3Rpb24oXzcpewppZihfNy52aXNpYmlsaXR5PT09ZmFsc2UpewpyZXR1cm4gZmFsc2U7Cn0KdmFyIF84PV83Lm1ldGFkYXRhfHx7fTsKc3dpdGNoKF83LmlkKXsKY2FzZSAiaWJtLnBvcnRhbC5vcGVyYXRpb25zLmNoYW5nZVBvcnRsZXRNb2RlIjoKcmV0dXJuIHdwdGhlbWUuZ2V0UG9ydGxldFN0YXRlKF84LndpZCkucG9ydGxldE1vZGUhPV84LnBvcnRsZXRNb2RlOwpjYXNlICJpYm0ucG9ydGFsLm9wZXJhdGlvbnMuY2hhbmdlV2luZG93U3RhdGUiOgpyZXR1cm4gd3B0aGVtZS5nZXRQb3J0bGV0U3RhdGUoXzgud2lkKS53aW5kb3dTdGF0ZSE9Xzgud2luZG93U3RhdGU7CmRlZmF1bHQ6Cn0KcmV0dXJuIHRydWU7Cn0sb3BlcmF0aW9uOntjaGFuZ2VUb0hlbHBNb2RlOmZ1bmN0aW9uKF85KXsKdmFyIF9hPXdpbmRvdy5sb2NhdGlvbi5ocmVmOwppZihfOS5hY3Rpb25VcmwpewppZihfOS5hY3Rpb25VcmwuaW5kZXhPZigiPyIpPT0wKXsKdmFyIF9iPV9hLmluZGV4T2YoIiMiKTsKaWYoX2IhPS0xKXsKdmFyIF9jPV9hLnN1YnN0cmluZygwLF9iKTsKdmFyIF9kPV9hLnN1YnN0cmluZyhfYik7Cl9hPV9jKyhfYy5pbmRleE9mKCI/Iik9PS0xPyI/IjoiJiIpK185LmFjdGlvblVybC5zdWJzdHJpbmcoMSk7Cl9hKz1fZDsKfWVsc2V7Cl9hKz0oX2EuaW5kZXhPZigiPyIpPT0tMT8iPyI6IiYiKStfOS5hY3Rpb25Vcmwuc3Vic3RyaW5nKDEpOwp9Cn1lbHNlewpfYT1fOS5hY3Rpb25Vcmw7Cn0KfQp3aW5kb3cub3BlbihfYSwiIiwicmVzaXphYmxlPXllcyxzY3JvbGxiYXJzPXllcyxtZW51YmFyPW5vLHRvb2xiYXI9bm8sc3RhdHVzPW5vLHdpZHRoPTgwMCxoZWlnaHQ9NjAwLHNjcmVlblg9MTAsc2NyZWVuWT0xMCx0b3A9MTAsbGVmdD0xMCIpOwp9fSxjYW5JbXBlcnNvbmF0ZTpmdW5jdGlvbigpewpyZXR1cm4gaWJtQ2ZnLnBvcnRhbENvbmZpZy5jYW5JbXBlcnNvbmF0ZTsKfSxjb250ZXh0TWVudTp7Y2FjaGU6e30sY3NzOntmb2N1czoid3B0aGVtZU1lbnVGb2N1cyIsZGlzYWJsZWQ6IndwdGhlbWVNZW51RGlzYWJsZWQiLHNob3c6IndwdGhlbWVNZW51U2hvdyIsZXJyb3I6IndwdGhlbWVNZW51RXJyb3IiLG1lbnVUZW1wbGF0ZToid3B0aGVtZVRlbXBsYXRlTWVudSIsc3VibWVudVRlbXBsYXRlOiJ3cHRoZW1lVGVtcGxhdGVTdWJtZW51Iixsb2FkaW5nVGVtcGxhdGU6IndwdGhlbWVUZW1wbGF0ZUxvYWRpbmcifSxpbml0OmZ1bmN0aW9uKF9lLF9mLF8xMCl7Cl9lLl9jb250ZXh0TWVudT1fZS5fY29udGV4dE1lbnV8fHt9OwpfZS5fY29udGV4dE1lbnUuaWQ9X2UuX2NvbnRleHRNZW51LmlkfHxNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkqMTAwMDAwMDAwMCk7Cl9lLnNldEF0dHJpYnV0ZSgiaWQiLF9lLl9jb250ZXh0TWVudS5pZCk7Cl9lLl9jb250ZXh0TWVudS5tZW51SWQ9X2Y7Cl9lLl9jb250ZXh0TWVudS5qc29uUXVlcnk9XzEwOwp2YXIgXzExPV9lLl9jb250ZXh0TWVudTsKdmFyIF8xMj1mdW5jdGlvbihfMTMpewppZihfMTMuZGlzcGxheU1lbnUpewppJC5maXJlRXZlbnQoIndwdGhlbWUvY29udGV4dE1lbnUvY2xvc2UvYWxsIik7CmlmKCFfMTEuX3N1Ym1lbnUpewppJC5maXJlRXZlbnQoIndwdGhlbWUvY29udGV4dE1lbnUvY2xvc2UvYWxsIik7CndwdGhlbWUuY29udGV4dE1lbnUuX3VwZGF0ZUFic29sdXRlUG9zaXRpb24oaSQuYnlJZChfMTEuaWQpKTsKfQp2YXIgXzE0PXdwdGhlbWUuY29udGV4dE1lbnUuX2FkanVzdFNjcmVlblBvc2l0aW9uU3RhcnQoKTsKaSQuYWRkQ2xhc3MoKF8xMS5zaGFkb3dOb2RlKT9fMTEuc2hhZG93Tm9kZTppJC5ieUlkKF8xMS5pZCksd3B0aGVtZS5jb250ZXh0TWVudS5jc3Muc2hvdyk7CndwdGhlbWUuY29udGV4dE1lbnUuX2FkanVzdFNjcmVlblBvc2l0aW9uRW5kKF8xNCk7CnZhciBfMTU9aSQuYnlJZChfMTEuaWQpLl9maXJzdFNlbGVjdGFibGU7CmlmKF8xNSl7Cl8xNS5mb2N1cygpOwppJC5ieUlkKF8xMS5pZCkuX2N1cnJlbnRTZWxlY3RlZD1fMTU7Cn0KaSQuYWRkTGlzdGVuZXIoIndwdGhlbWUvY29udGV4dE1lbnUvY2xvc2UvYWxsIixmdW5jdGlvbigpewp2YXIgXzE2PWkkLmJ5SWQoXzExLmlkKTsKfSk7Cn0KfTsKd3B0aGVtZS5jb250ZXh0TWVudS5faW5pdGlhbGl6ZShfZSkudGhlbihfMTIsXzEyKTsKX2U9bnVsbDsKfSxpbml0U3VibWVudTpmdW5jdGlvbihfMTcsXzE4LF8xOSl7Cl8xNy5fY29udGV4dE1lbnU9XzE3Ll9jb250ZXh0TWVudXx8e307Cl8xNy5fY29udGV4dE1lbnUuX3N1Ym1lbnU9dHJ1ZTsKXzE3Ll9jb250ZXh0TWVudS5fbWVudWl0ZW1UZW1wbGF0ZT1fMTkuX21lbnVpdGVtVGVtcGxhdGU7Cl8xNy5fY29udGV4dE1lbnUuX3N1Yk1lbnVUZW1wbGF0ZT1fMTkuX3N1Yk1lbnVUZW1wbGF0ZTsKXzE3Ll9jb250ZXh0TWVudS5fbG9hZGluZ1RlbXBsYXRlPV8xOS5fbG9hZGluZ1RlbXBsYXRlOwp3cHRoZW1lLmNvbnRleHRNZW51LmluaXQoXzE3LF8xOCxfMTkuanNvblF1ZXJ5KTsKfSxfZmluZEZvY3VzTm9kZTpmdW5jdGlvbihfMWEpewp2YXIgXzFiLGksXzFjOwp2YXIgXzFkPWZ1bmN0aW9uKF8xZSxfMWYpewp2YXIgbD1fMWUuY2hpbGROb2Rlcy5sZW5ndGg7CmZvcihpPTA7aTxsO2krKyl7CmlmKF8xYil7CmJyZWFrOwp9Cl8xYz1fMWUuY2hpbGROb2Rlc1tpXTsKaWYoaSQuaGFzQ2xhc3MoXzFjLHdwdGhlbWUuY29udGV4dE1lbnUuY3NzLmZvY3VzKSl7Cl8xYj1fMWM7CmJyZWFrOwp9CmlmKF8xYy5jaGlsZE5vZGVzKXsKaT1fMWQoXzFjLGkpOwp9Cn0KcmV0dXJuIF8xZjsKfTsKaWYoaSQuaGFzQ2xhc3MoXzFhLHdwdGhlbWUuY29udGV4dE1lbnUuY3NzLmZvY3VzKSl7CnJldHVybiBfMWE7Cn0KXzFkKF8xYSk7CnJldHVybiBfMWI7Cn0sX2ZpbmROb2RlczpmdW5jdGlvbihfMjApewp2YXIgXzIxLF8yMixfMjMsaSxfMjQ7CnZhciBfMjU9ZnVuY3Rpb24oXzI2LF8yNyl7CmZvcihpPV8yNi5jaGlsZE5vZGVzLmxlbmd0aC0xO2k+PTA7aS0tKXsKXzI0PV8yNi5jaGlsZE5vZGVzW2ldOwppZihpJC5oYXNDbGFzcyhfMjQsd3B0aGVtZS5jb250ZXh0TWVudS5jc3MubWVudVRlbXBsYXRlKSl7Cl8yMT1fMjQ7CmNvbnRpbnVlOwp9CmlmKGkkLmhhc0NsYXNzKF8yNCx3cHRoZW1lLmNvbnRleHRNZW51LmNzcy5zdWJtZW51VGVtcGxhdGUpKXsKXzIyPV8yNDsKY29udGludWU7Cn0KaWYoaSQuaGFzQ2xhc3MoXzI0LHdwdGhlbWUuY29udGV4dE1lbnUuY3NzLmxvYWRpbmdUZW1wbGF0ZSkpewpfMjM9XzI0Owpjb250aW51ZTsKfQppZihfMjQuY2hpbGROb2Rlcyl7Cmk9XzI1KF8yNCxpKTsKfQp9CnJldHVybiBfMjc7Cn07Cl8yNShfMjApOwpyZXR1cm4geyJtZW51IjpfMjEsInN1Ym1lbnUiOl8yMiwibG9hZGluZyI6XzIzfTsKfSxfaW52YWxpZGF0ZUNhbGxiYWNrOmZ1bmN0aW9uKCl7CndwdGhlbWUuY29udGV4dE1lbnUuY2FjaGU9e307Cn0sX2luaXRpYWxpemU6ZnVuY3Rpb24oXzI4KXsKdmFyIF8yOT10cnVlOwp2YXIgXzJhPV8yOC5fY29udGV4dE1lbnU7CmlmKHdwdGhlbWUuY29udGV4dE1lbnUuY2FjaGVbXzJhLmlkXXx8XzJhLl9pblByb2dyZXNzKXsKcmV0dXJuIGkkLnByb21pc2UucmVzb2x2ZWQoe2Rpc3BsYXlNZW51Ol8yOX0pOwp9Cl8yYS5faW5Qcm9ncmVzcz10cnVlOwppJC5hZGRMaXN0ZW5lcigid3B0aGVtZS9jb250ZXh0TWVudS9pbnZhbGlkYXRlL2FsbCIsd3B0aGVtZS5jb250ZXh0TWVudS5faW52YWxpZGF0ZUNhbGxiYWNrKTsKdmFyIF8yYixfMmMsdG1wPWkkLmNyZWF0ZURvbSgiZGl2Iik7CmlmKF8yYS5fc3VibWVudSl7CnRtcC5pbm5lckhUTUw9XzJhLl9zdWJNZW51VGVtcGxhdGUucmVwbGFjZSgvXCRce3N1Ym1lbnUtaWRcfS9nLF8yYS5pZCsiX21lbnUiKTsKXzI4LmFwcGVuZENoaWxkKHRtcC5maXJzdENoaWxkKTsKXzJiPWkkLmJ5SWQoXzJhLmlkKyJfbWVudSIpOwpfMmM9aSQuY3JlYXRlRG9tKCJkaXYiKTsKXzJjLmlubmVySFRNTD1fMmEuX2xvYWRpbmdUZW1wbGF0ZTsKfWVsc2V7CnZhciBfMmQ9d3B0aGVtZS5jb250ZXh0TWVudS5fZmluZE5vZGVzKChfMmEuc2hhZG93Tm9kZSk/XzJhLnNoYWRvd05vZGU6XzI4KTsKXzJiPV8yZC5tZW51OwppZighXzJhLl9tZW51aXRlbVRlbXBsYXRlKXsKXzJhLl9tZW51aXRlbVRlbXBsYXRlPWkkLnRyaW0oXzJiLmlubmVySFRNTCk7Cn0KaWYoIV8yYS5fbG9hZGluZ1RlbXBsYXRlKXsKXzJjPWkkLmNyZWF0ZURvbSgiZGl2Iik7Cl8yYy5hcHBlbmRDaGlsZChfMmQubG9hZGluZyk7Cl8yYS5fbG9hZGluZ1RlbXBsYXRlPWkkLnRyaW0oXzJjLmlubmVySFRNTCk7Cl8yYz1udWxsOwp9Cl8yYz1pJC5jcmVhdGVEb20oImRpdiIpOwpfMmMuaW5uZXJIVE1MPV8yYS5fbG9hZGluZ1RlbXBsYXRlOwp0bXAuYXBwZW5kQ2hpbGQoXzJkLnN1Ym1lbnUuY2xvbmVOb2RlKHRydWUpKTsKaWYoIV8yYS5fc3ViTWVudVRlbXBsYXRlKXsKXzJhLl9zdWJNZW51VGVtcGxhdGU9aSQudHJpbSh0bXAuaW5uZXJIVE1MKTsKfQp9CndoaWxlKF8yYi5maXJzdENoaWxkKXsKXzJiLnJlbW92ZUNoaWxkKF8yYi5maXJzdENoaWxkKTsKfQpfMmIuYXBwZW5kQ2hpbGQoXzJjKTsKdmFyIF8yZTsKaWYoXzJhLl9zdWJtZW51KXsKXzJlPV8yYS5zaGFkb3dOb2RlOwp9ZWxzZXsKaWYoXzJhLnNoYWRvd05vZGUpewpfMmU9XzJhLnNoYWRvd05vZGU7Cn1lbHNlewpfMmU9d3B0aGVtZS5jb250ZXh0TWVudS5fdHJhbnNmb3JtSW50b0Fic29sdXRlUG9zaXRpb24oXzI4KTsKfQp9CmkkLmFkZENsYXNzKChfMmUpP18yZTpfMjgsd3B0aGVtZS5jb250ZXh0TWVudS5jc3Muc2hvdyk7CmkkLmJpbmREb21FdnQoKF8yZSk/XzJlOl8yOCwib25tb3VzZWxlYXZlIixmdW5jdGlvbigpewppZihfMmEuX2luUHJvZ3Jlc3MpewpfMjk9ZmFsc2U7Cn0KdmFyIF8yZj1pJC5ieUlkKF8yYS5pZCk7CmkkLnJlbW92ZUNsYXNzKChfMmEuc2hhZG93Tm9kZSk/XzJhLnNoYWRvd05vZGU6XzJmLHdwdGhlbWUuY29udGV4dE1lbnUuY3NzLnNob3cpOwppZighXzJhLmFjdGl2ZUFjdGlvbil7CnZhciBfMzA9XzJmLl9jdXJyZW50U2VsZWN0ZWQ7CmlmKF8zMCl7Cl8zMC5ibHVyKCk7Cn0KdmFyIF8zMT13cHRoZW1lLmNvbnRleHRNZW51Ll9maW5kRm9jdXNOb2RlKF8yZik7CigoXzMxKT9fMzE6XzJmKS5mb2N1cygpOwp9Cn0pOwpyZXR1cm4gd3B0aGVtZS5jb250ZXh0TWVudS5fbG9hZChfMmEpLnRoZW4oZnVuY3Rpb24oXzMyKXsKdmFyIF8zMz13cHRoZW1lLmNvbnRleHRNZW51Ll9wYXJzZURhdGEoXzMyKS50aGVuKGZ1bmN0aW9uKF8zNCl7Cl8zND13cHRoZW1lLmNvbnRleHRNZW51Ll9maWx0ZXJNZW51KF8zNCk7CmlmKCFfMzR8fF8zNC5sZW5ndGg9PTApewp2YXIgdG1wPWkkLmNyZWF0ZURvbSgiZGl2Iik7CnRtcC5pbm5lckhUTUw9d3B0aGVtZS5jb250ZXh0TWVudS5fZnJvbVRlbXBsYXRlKF8yYS5fbWVudWl0ZW1UZW1wbGF0ZSx3cHRoZW1lLmNvbnRleHRNZW51LmNzcy5lcnJvcix3cHRoZW1lLmNvbnRleHRNZW51Lm5scy5OT19JVEVNU18wKTsKd2hpbGUoXzJiLmZpcnN0Q2hpbGQpewpfMmIucmVtb3ZlQ2hpbGQoXzJiLmZpcnN0Q2hpbGQpOwp9Cl8yYi5hcHBlbmRDaGlsZCh0bXApOwp9ZWxzZXsKd3B0aGVtZS5jb250ZXh0TWVudS5fYnVpbGRNZW51KF8yYSxfMmIsXzM0KTsKfQpfMmEuX2luUHJvZ3Jlc3M9ZmFsc2U7CndwdGhlbWUuY29udGV4dE1lbnUuY2FjaGVbXzJhLmlkXT10cnVlOwpyZXR1cm4ge2Rpc3BsYXlNZW51Ol8yOX07Cn0pOwpyZXR1cm4gXzMzOwp9LGZ1bmN0aW9uKCl7CnZhciB0bXA9aSQuY3JlYXRlRG9tKCJkaXYiKTsKdG1wLmlubmVySFRNTD13cHRoZW1lLmNvbnRleHRNZW51Ll9mcm9tVGVtcGxhdGUoXzJhLl9tZW51aXRlbVRlbXBsYXRlLHdwdGhlbWUuY29udGV4dE1lbnUuY3NzLmVycm9yLHdwdGhlbWUuY29udGV4dE1lbnUubmxzLkVSUk9SX0xPQURJTkdfMCk7CndoaWxlKF8yYi5maXJzdENoaWxkKXsKXzJiLnJlbW92ZUNoaWxkKF8yYi5maXJzdENoaWxkKTsKfQpfMmIuYXBwZW5kQ2hpbGQodG1wKTsKXzJhLl9pblByb2dyZXNzPWZhbHNlOwp3cHRoZW1lLmNvbnRleHRNZW51LmNhY2hlW18yYS5pZF09dHJ1ZTsKcmV0dXJuIHtkaXNwbGF5TWVudTpfMjl9Owp9KTsKfSxfbG9hZDpmdW5jdGlvbihfMzUpewp2YXIgXzM2PV8xLnJlcGxhY2UoL1wkXHtpZFx9L2csXzM1Lm1lbnVJZCk7CmlmKF8zNS5qc29uUXVlcnkpewpfMzYrPShfMzYuaW5kZXhPZigiPyIpPT0tMT8iPyI6IiYiKStpJC50b1F1ZXJ5KF8zNS5qc29uUXVlcnkpOwp9CnJldHVybiBpJC54aHJHZXQoe3VybDpfMzYsaGVhZGVyczp7IlgtSUJNLVhIUiI6InRydWUifSxyZXNwb25zZVR5cGU6Impzb24ifSkudGhlbihmdW5jdGlvbihfMzcpewpyZXR1cm4gXzM3LmRhdGE7Cn0sZnVuY3Rpb24oXzM4KXsKdmFyIF8zOT1fMzgueGhyLmdldFJlc3BvbnNlSGVhZGVyKCJDb250ZW50LVR5cGUiKXx8IiI7CmlmKChfMzkuaW5kZXhPZigidGV4dC9odG1sIik9PTApfHwoXzM4Lnhoci5zdGF0dXM9PTQwMSkpewp3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpewpkb2N1bWVudC5sb2NhdGlvbi5yZWxvYWQoKTsKfSwwKTsKfQpjb25zb2xlLmxvZygiRXJyb3IgdHJ5aW5nIHRvIGxvYWQgdGhlIGNvbnRleHQgbWVudSBmZWVkIGZvciAnIitfMzUubWVudUlkKyInOiAiK18zOCk7CnJldHVybiBudWxsOwp9KTsKfSxfcGFyc2VEYXRhOmZ1bmN0aW9uKF8zYSl7CnZhciBfM2I9W107CmkkLmVhY2goXzNhLGZ1bmN0aW9uKF8zYyl7CnZhciBfM2Q9aSQuZnJvbVBhdGgoIm1vZHVsZUluZm8uZGVmZXJyZWQiLGZhbHNlLF8zYyk/aSQubW9kdWxlcy5sb2FkRGVmZXJyZWQoKTppJC5wcm9taXNlLnJlc29sdmVkKHRydWUpOwpfM2IucHVzaChfM2QudGhlbihmdW5jdGlvbigpewp2YXIgXzNlPXdwdGhlbWUuY29udGV4dE1lbnUuX2NoZWNrRnVuY3Rpb24oXzNjLF8zYy52aXNpYmlsaXR5Rm4sXzNjLCh0eXBlb2YgXzNjLnZpc2liaWxpdHkhPSJ1bmRlZmluZWQiKT9fM2MudmlzaWJpbGl0eTp0cnVlKTsKdmFyIF8zZj13cHRoZW1lLmNvbnRleHRNZW51Ll9jaGVja0Z1bmN0aW9uKF8zYyxfM2MuZW5hYmxlRm4sXzNjLCh0eXBlb2YgXzNjLmVuYWJsZWQhPSJ1bmRlZmluZWQiKT9fM2MuZW5hYmxlZDp0cnVlKTsKcmV0dXJuIGkkLndoZW5BbGwoXzNlLF8zZikudGhlbihmdW5jdGlvbihfNDApewpfM2MuX3Zpc2libGU9XzQwWzBdOwpfM2MuX2VuYWJsZWQ9XzQwWzFdOwpyZXR1cm4gXzNjOwp9KTsKfSkpOwp9KTsKcmV0dXJuIGkkLndoZW5BbGwuYXBwbHkoaSQsXzNiKTsKfSxfZmlsdGVyTWVudTpmdW5jdGlvbihfNDEpewp2YXIgXzQyPVtdLF80MyxfNDQ9eyJ0eXBlIjoiU2VwYXJhdG9yIn07CmZvcih2YXIgaT1fNDEubGVuZ3RoLTE7aT49MDtpLS0pewpfNDM9XzQxW2ldOwppZighXzQzLl92aXNpYmxlKXsKY29udGludWU7Cn0KaWYoXzQzLnR5cGU9PSJTZXBhcmF0b3IiKXsKaWYoXzQ0LnR5cGU9PSJTZXBhcmF0b3IiKXsKY29udGludWU7Cn0KfWVsc2V7CmlmKF80My50eXBlPT0iSGVhZGVyIil7CmlmKChfNDQudHlwZT09IlNlcGFyYXRvciIpfHwoXzQ0LnR5cGU9PSJIZWFkZXIiKSl7CmNvbnRpbnVlOwp9Cn0KfQpfNDQ9XzQzOwpfNDIudW5zaGlmdChfNDMpOwp9CndoaWxlKF80Mi5sZW5ndGg+MCYmXzQyWzBdLnR5cGU9PSJTZXBhcmF0b3IiKXsKXzQyPV80Mi5zbGljZSgxKTsKfQpyZXR1cm4gXzQyOwp9LF9idWlsZE1lbnU6ZnVuY3Rpb24oXzQ1LF80NixfNDcpewp2YXIgXzQ4PWRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSx0bXA9aSQuY3JlYXRlRG9tKCJkaXYiKSxfNDksXzRhLF80YixfNGM7CmZvcih2YXIgaT0wLGw9XzQ3Lmxlbmd0aDtpPGw7aSsrKXsKXzQ5PV80N1tpXTsKdG1wLmlubmVySFRNTD13cHRoZW1lLmNvbnRleHRNZW51Ll9mcm9tVGVtcGxhdGUoXzQ1Ll9tZW51aXRlbVRlbXBsYXRlLF80OSk7CndoaWxlKF80YT10bXAuZmlyc3RDaGlsZCl7CmlmKF80YS5ub2RlVHlwZT09MSl7CmlmKF80OS50eXBlPT0iU3VibWVudSIpewpfNGEuX21lbnVpdGVtPV80OTsKXzRhLl9qc29uRGF0YT1fNDU7CmkkLmJpbmREb21FdnQoXzRhLCJvbm1vdXNlb3ZlciIsd3B0aGVtZS5jb250ZXh0TWVudS5fYXBwbHlTdWJtZW51KTsKfWVsc2V7CmlmKF80OS5fZW5hYmxlZCl7Cl80YS5saW5rcz17cHJldmlvdXM6XzRiLG5leHQ6bnVsbCxzdWI6bnVsbH07CmlmKF80Yil7Cl80Yi5saW5rcy5uZXh0PV80YTsKfQppZighXzRjJiZfNDkudHlwZSE9IkhlYWRlciIpewpfNGM9XzRhOwp9Cl80YS5fbWVudWl0ZW09XzQ5OwpfNGI9XzRhOwppJC5iaW5kRG9tRXZ0KF80YSwib25jbGljayIsZnVuY3Rpb24oZXZ0KXsKd3B0aGVtZS5jb250ZXh0TWVudS5fc3RvcEV2ZW50UHJvcGFnYXRpb24oZXZ0KTsKd3B0aGVtZS5jb250ZXh0TWVudS5fYXBwbHlBY3Rpb24oZXZ0KTsKc2V0VGltZW91dChmdW5jdGlvbigpewp2YXIgXzRkPWkkLmJ5SWQoXzQ1LmlkKTsKaSQucmVtb3ZlQ2xhc3MoKF80NS5zaGFkb3dOb2RlKT9fNDUuc2hhZG93Tm9kZTpfNGQsd3B0aGVtZS5jb250ZXh0TWVudS5jc3Muc2hvdyk7Cn0sMCk7Cn0pOwppJC5iaW5kRG9tRXZ0KF80YSwib25rZXlkb3duIixmdW5jdGlvbihldnQpewpyZXR1cm4gd3B0aGVtZS5jb250ZXh0TWVudS5fYXBwbHlLZXlBY3Rpb24oZXZ0KTsKfSk7CmkkLmJpbmREb21FdnQoXzRhLCJvbm1vdXNlb3ZlciIsZnVuY3Rpb24oZXZ0KXsKcmV0dXJuIHdwdGhlbWUuY29udGV4dE1lbnUuX2FwcGx5Rm9jdXNBY3Rpb24oZXZ0KTsKfSk7Cn0KfQppZigoXzQ5LnRpdGxlKSYmKGkkLmlzUlRMKF80OS50aXRsZS5sYW5nKSkpewppJC5hZGRDbGFzcyhfNGEsInJ0bCIpOwpfNGEuc2V0QXR0cmlidXRlKCJkaXIiLCJSVEwiKTsKfQppZihfNDkubWFya3VwSWQpewpfNGEuc2V0QXR0cmlidXRlKCJpZCIsXzQ5Lm1hcmt1cElkKTsKfQp9Cl80OC5hcHBlbmRDaGlsZChfNGEpOwp9Cn0Kd2hpbGUoXzQ2LmZpcnN0Q2hpbGQpewpfNDYucmVtb3ZlQ2hpbGQoXzQ2LmZpcnN0Q2hpbGQpOwp9Cl80Ni5hcHBlbmRDaGlsZChfNDgpOwppJC5ieUlkKF80NS5pZCkuX2ZpcnN0U2VsZWN0YWJsZT1fNGM7CmkkLmJ5SWQoXzQ1LmlkKS5fY3VycmVudFNlbGVjdGVkPW51bGw7Cn0sX2Zyb21UZW1wbGF0ZTpmdW5jdGlvbihfNGUsXzRmLF81MCl7CnZhciBfNTEsXzUyLF81MzsKaWYodHlwZW9mIChfNGYpPT0ic3RyaW5nIil7Cl81MT1fNGY7Cl81Mj1fNTA7Cl81Mz0iIjsKfWVsc2V7Cl81MT0idHlwZSIrXzRmLnR5cGU7CmlmKF80Zi5pdGVtQ2xhc3MpewpfNTErPSIgIitfNGYuaXRlbUNsYXNzOwp9CmlmKCFfNGYuX2VuYWJsZWQpewpfNTErPSIgIit3cHRoZW1lLmNvbnRleHRNZW51LmNzcy5kaXNhYmxlZDsKfQpfNTI9KF80Zi50aXRsZSk/XzRmLnRpdGxlLnZhbHVlOiIiOwpfNTM9KChfNGYuZGVzY3JpcHRpb24pP180Zi5kZXNjcmlwdGlvbi52YWx1ZToiIik7Cn0KcmV0dXJuIF80ZS5yZXBsYWNlKC9cJFx7dGl0bGVcfS9nLF81MikucmVwbGFjZSgvIlwkXHtjc3MtY2xhc3NcfSIvZywiXCIiKyhfNTEpKyJcIiIpLnJlcGxhY2UoL1wkXHtjc3MtY2xhc3NcfS9nLCJcIiIrKF81MSkrIlwiIikucmVwbGFjZSgvIlwkXHtkZXNjcmlwdGlvblx9Ii9nLCJcIiIrXzUzKyJcIiIpLnJlcGxhY2UoL1wkXHtkZXNjcmlwdGlvblx9L2csIlwiIitfNTMrIlwiIik7Cn0sX2NoZWNrRnVuY3Rpb246ZnVuY3Rpb24oXzU0LGZuLGFyZyxfNTUpewppZihmbil7CmlmKCFfNTQuZnJvbVBhdGgpewpfNTQuZnJvbVBhdGg9e307Cn0KdmFyIF81Nj1fNTQuZnJvbVBhdGhbZm5dfHxpJC5mcm9tUGF0aChmbik7Cl81NC5mcm9tUGF0aFtmbl09XzU2OwppZihpJC5pc0Z1bmN0aW9uKF81Nikpewp0cnl7CnJldHVybiBfNTYoYXJnKTsKfQpjYXRjaChleGMpewpjb25zb2xlLmxvZygiZXJyb3IgZXhlY3V0aW5nIGZ1bmN0aW9uICIrZm4rIiAtICIrZXhjKTsKfQp9Cn0KcmV0dXJuIGkkLnByb21pc2UucmVzb2x2ZWQoXzU1KTsKfSxfc3RvcEV2ZW50UHJvcGFnYXRpb246ZnVuY3Rpb24oZXZ0KXsKaWYoZXZ0KXsKaWYoZXZ0LnN0b3BQcm9wYWdhdGlvbil7CmV2dC5zdG9wUHJvcGFnYXRpb24oKTsKfWVsc2V7CmV2dC5jYW5jZWxCdWJibGU9dHJ1ZTsKfQp9Cn0sX2FwcGx5S2V5QWN0aW9uOmZ1bmN0aW9uKGV2dCl7CnZhciBfNTc9ZXZ0LnRhcmdldHx8ZXZ0LnNyY0VsZW1lbnQ7CnZhciBfNTg9XzU3Owp2YXIgXzU5PW51bGw7CndoaWxlKCFfNTkpewpfNTg9XzU4LnBhcmVudE5vZGU7CmlmKF81OC5fY29udGV4dE1lbnUpewpfNTk9XzU4Owp9Cn0KdmFyIF81YT1fNTkuX2NvbnRleHRNZW51Owpzd2l0Y2goZXZ0LmtleUNvZGUpewpjYXNlIDEzOgp3cHRoZW1lLmNvbnRleHRNZW51Ll9zdG9wRXZlbnRQcm9wYWdhdGlvbihldnQpOwp2YXIgXzViPWkkLmJ5SWQoXzVhLmlkKTsKaSQucmVtb3ZlQ2xhc3MoKF81YS5zaGFkb3dOb2RlKT9fNWEuc2hhZG93Tm9kZTpfNWIsd3B0aGVtZS5jb250ZXh0TWVudS5jc3Muc2hvdyk7CnZhciBfNWM9d3B0aGVtZS5jb250ZXh0TWVudS5fZmluZEZvY3VzTm9kZShfNWIpOwp3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpewooKF81Yyk/XzVjOl81OSkuZm9jdXMoKTsKd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXsKd3B0aGVtZS5jb250ZXh0TWVudS5fYXBwbHlBY3Rpb24oZXZ0KTsKfSwwKTsKfSwwKTsKcmV0dXJuIGZhbHNlOwpjYXNlIDk6CmNhc2UgMjc6CnZhciBfNWI9aSQuYnlJZChfNWEuaWQpOwppJC5yZW1vdmVDbGFzcygoXzVhLnNoYWRvd05vZGUpP181YS5zaGFkb3dOb2RlOl81Yix3cHRoZW1lLmNvbnRleHRNZW51LmNzcy5zaG93KTsKdmFyIF81Yz13cHRoZW1lLmNvbnRleHRNZW51Ll9maW5kRm9jdXNOb2RlKF81Yik7CigoXzVjKT9fNWM6XzU5KS5mb2N1cygpOwpicmVhazsKY2FzZSA0MDoKd3B0aGVtZS5jb250ZXh0TWVudS5fbW92ZUZvY3VzKGV2dCxfNWEsXzU3LCJuZXh0Iik7CnJldHVybiBmYWxzZTsKY2FzZSAzODoKd3B0aGVtZS5jb250ZXh0TWVudS5fbW92ZUZvY3VzKGV2dCxfNWEsXzU3LCJwcmV2aW91cyIpOwpyZXR1cm4gZmFsc2U7Cn0KcmV0dXJuIHRydWU7Cn0sX21vdmVGb2N1czpmdW5jdGlvbihldnQsXzVkLF81ZSxfNWYpewp2YXIgXzYwPV81ZS5saW5rc1tfNWZdOwppZihfNjAmJihfNjAuX21lbnVpdGVtLnR5cGU9PSJIZWFkZXIifHxfNjAuX21lbnVpdGVtLnR5cGU9PSJTZXBhcmF0b3IiKSl7CnZhciBfNjE9ZmFsc2U7CnZhciBfNjI9bnVsbDsKd2hpbGUoIV82MiYmIV82MSl7Cl82MD1fNjAubGlua3NbXzVmXTsKaWYoIV82MCl7Cl82MT10cnVlOwp9ZWxzZXsKaWYoXzYwLl9tZW51aXRlbS50eXBlIT0iSGVhZGVyIiYmXzYwLl9tZW51aXRlbS50eXBlIT0iU2VwYXJhdG9yIil7Cl82Mj1fNjA7Cn0KfQp9Cl82MD1fNjI7Cn0KaWYoXzYwKXsKdmFyIF82Mz1pJC5ieUlkKF81ZC5pZCkuX2N1cnJlbnRTZWxlY3RlZDsKaWYoXzYzKXsKXzYzLmJsdXIoKTsKfQppJC5ieUlkKF81ZC5pZCkuX2N1cnJlbnRTZWxlY3RlZD1fNjA7Cl82MC5mb2N1cygpOwp9CmlmKGV2dC5wcmV2ZW50RGVmYXVsdCl7CmV2dC5wcmV2ZW50RGVmYXVsdCgpOwp9Cn0sX2FwcGx5Rm9jdXNBY3Rpb246ZnVuY3Rpb24oZXZ0KXsKdmFyIF82ND1ldnQudGFyZ2V0fHxldnQuc3JjRWxlbWVudDsKdmFyIF82NT1fNjQ7CnZhciBfNjY9bnVsbDsKdmFyIF82Nz1fNjQuX21lbnVpdGVtOwp3aGlsZSghXzY2KXsKXzY1PV82NS5wYXJlbnROb2RlOwppZihfNjUuX2NvbnRleHRNZW51KXsKXzY2PV82NTsKfQppZighXzY3KXsKXzY0PV82NC5wYXJlbnROb2RlOwpfNjc9XzY0Ll9tZW51aXRlbTsKfQp9CnZhciBfNjg9XzY2Ll9jb250ZXh0TWVudTsKdmFyIF82OT1pJC5ieUlkKF82OC5pZCkuX2N1cnJlbnRTZWxlY3RlZDsKaWYoXzY5IT1fNjQpewppZihfNjkpewpfNjkuYmx1cigpOwppJC5ieUlkKF82OC5pZCkuX2N1cnJlbnRTZWxlY3RlZD1udWxsOwp9CmlmKF82Ny50eXBlIT0iSGVhZGVyIiYmXzY3LnR5cGUhPSJTZXBhcmF0b3IiKXsKaSQuYnlJZChfNjguaWQpLl9jdXJyZW50U2VsZWN0ZWQ9XzY0OwpfNjQuZm9jdXMoKTsKfQp9CnJldHVybiBmYWxzZTsKfSxfYXBwbHlBY3Rpb246ZnVuY3Rpb24oZXZ0KXsKdmFyIF82YT1ldnQudGFyZ2V0fHxldnQuc3JjRWxlbWVudDsKdmFyIF82Yj1fNmE7CnZhciBfNmM9bnVsbDsKdmFyIF82ZD1fNmEuX21lbnVpdGVtOwp3aGlsZSghXzZjKXsKXzZiPV82Yi5wYXJlbnROb2RlOwppZihfNmIuX2NvbnRleHRNZW51KXsKXzZjPV82YjsKfQppZighXzZkKXsKXzZhPV82YS5wYXJlbnROb2RlOwpfNmQ9XzZhLl9tZW51aXRlbTsKfQp9CnZhciBfNmU9XzZjLl9jb250ZXh0TWVudTsKXzZlLmFjdGl2ZUFjdGlvbj10cnVlOwp2YXIgcD13cHRoZW1lLmNvbnRleHRNZW51Ll9jaGVja0Z1bmN0aW9uKF82ZCxfNmQuYWN0aW9uRm4sXzZkLF82ZC5hY3Rpb25VcmwpOwppZihwKXsKcC50aGVuKGZ1bmN0aW9uKF82Zil7CmlmKF82ZiYmaSQuaXNTdHJpbmcoXzZmKSl7CnZhciBfNzA9XzZkLmFjdGlvbkh0dHBNZXRob2R8fCJHRVQiOwppZihfNzAhPSJHRVQiKXsKdmFyIF83MT1pJC5jcmVhdGVEb20oImZvcm0iKTsKXzcxLnNldEF0dHJpYnV0ZSgiYWN0aW9uIixfNmYpOwpfNzA9XzcwLnRvTG93ZXJDYXNlKCk7CnN3aXRjaChfNzApewpjYXNlICJnZXQiOgpfNzEuc2V0QXR0cmlidXRlKCJtZXRob2QiLCJHRVQiKTsKYnJlYWs7CmNhc2UgImRlbGV0ZSI6CmNhc2UgInB1dCI6CnZhciBfNzI9aSQuY3JlYXRlRG9tKCJpbnB1dCIseyJ0eXBlIjoiaGlkZGVuIiwibmFtZSI6IngtbWV0aG9kLW92ZXJyaWRlIiwidmFsdWUiOl83MC50b1VwcGVyQ2FzZSgpfSk7Cl83MS5hcHBlbmRDaGlsZChfNzIpOwpjYXNlICJwb3N0IjoKXzcxLnNldEF0dHJpYnV0ZSgibWV0aG9kIiwiUE9TVCIpOwpfNzEuc2V0QXR0cmlidXRlKCJlbmN0eXBlIiwibXVsdGlwYXJ0L2Zvcm0tZGF0YSIpOwpicmVhazsKZGVmYXVsdDoKfQppJC5ieUlkKCJ3cHRoZW1lQ29tcGxlbWVudGFyeUNvbnRlbnQiKS5hcHBlbmRDaGlsZChfNzEpOwpfNzEuc3VibWl0KCk7Cn1lbHNlewp3aW5kb3cubG9jYXRpb24uaHJlZj1fNmY7Cn0KfQp9KTsKfQp9LF9hcHBseVN1Ym1lbnU6ZnVuY3Rpb24oZXZ0KXsKdmFyIF83Mz1ldnQudGFyZ2V0fHxldnQuc3JjRWxlbWVudDsKaWYoIV83My5fanNvbkRhdGEpewpfNzM9XzczLnBhcmVudE5vZGU7Cn0KaWYoXzczLl9qc29uRGF0YSl7Cl83My5zZXRBdHRyaWJ1dGUoImlkIixfNzMuX2pzb25EYXRhLmlkKyJfIitfNzMuX21lbnVpdGVtLmlkKTsKd3B0aGVtZS5jb250ZXh0TWVudS5pbml0U3VibWVudShfNzMsXzczLl9tZW51aXRlbS5pZCxfNzMuX2pzb25EYXRhKTsKfQp9LF90cmFuc2Zvcm1JbnRvQWJzb2x1dGVQb3NpdGlvbjpmdW5jdGlvbihfNzQpewp2YXIgXzc1PV83NC5jaGlsZE5vZGVzLF83NixpPTAsXzc3PWZhbHNlOwp3aGlsZShfNzY9Xzc1W2krK10pewppZihpJC5oYXNDbGFzcyhfNzYsIndwdGhlbWVNZW51UmlnaHQiKSl7Cl83Nz10cnVlOwpicmVhazsKfWVsc2V7CmlmKGkkLmhhc0NsYXNzKF83Niwid3B0aGVtZU1lbnVMZWZ0IikpewpicmVhazsKfQp9Cn0KdmFyIF83OD1pJC5jcmVhdGVEb20oImRpdiIpOwpfNzguY2xhc3NOYW1lPV83NC5jbGFzc05hbWU7Cl83OC5hcHBlbmRDaGlsZChfNzYpOwppJC5ieUlkKCJ3cHRoZW1lQ29tcGxlbWVudGFyeUNvbnRlbnQiKS5hcHBlbmRDaGlsZChfNzgpOwpfNzguX2NvbnRleHRNZW51PV83NC5fY29udGV4dE1lbnU7Cl83NC5fY29udGV4dE1lbnUuc2hhZG93Tm9kZT1fNzg7Cl83NC5fY29udGV4dE1lbnUuX21lbnVJc1JpZ2h0PV83NzsKdmFyIF83OT1pJC5jcmVhdGVEb20oInNwYW4iKTsKXzc4LmFwcGVuZENoaWxkKF83OSk7CmkkLmFkZENsYXNzKF83OSwid3B0aGVtZU1lbnVPdmVybGF5Iik7Cl83NC5fY29udGV4dE1lbnUub3ZlcmxheU5vZGU9Xzc5OwpfNzQuX2NvbnRleHRNZW51Lm1lbnVOb2RlPV83NjsKd3B0aGVtZS5jb250ZXh0TWVudS5fdXBkYXRlQWJzb2x1dGVQb3NpdGlvbihfNzQpOwpyZXR1cm4gXzc4Owp9LF91cGRhdGVBYnNvbHV0ZVBvc2l0aW9uOmZ1bmN0aW9uKF83YSl7CnZhciBfN2I9XzdhLl9jb250ZXh0TWVudS5fbWVudUlzUmlnaHQ7CnZhciBfN2M9XzdhLl9jb250ZXh0TWVudS5tZW51Tm9kZTsKdmFyIF83ZD1fN2EuX2NvbnRleHRNZW51Lm92ZXJsYXlOb2RlOwp2YXIgXzdlPXdwdGhlbWUuY29udGV4dE1lbnUuX2ZpbmRQb3MoXzdhKTsKdmFyIF83Zj0yOwpfN2Quc3R5bGUubGVmdD0oXzdlWzBdLV83ZikrInB4IjsKXzdkLnN0eWxlLnRvcD0oXzdlWzFdLV83ZikrInB4IjsKXzdkLnN0eWxlLndpZHRoPShfN2Eub2Zmc2V0V2lkdGgrKDIqXzdmKSkrInB4IjsKXzdkLnN0eWxlLmhlaWdodD0oXzdhLm9mZnNldEhlaWdodCsoMipfN2YpKSsicHgiOwp2YXIgZGlyPWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJodG1sIilbMF0uZ2V0QXR0cmlidXRlKCJkaXIiKTsKaWYoZGlyIT1udWxsKXsKZGlyPWRpci50b0xvd2VyQ2FzZSgpOwp9ZWxzZXsKZGlyPSIiOwp9CmlmKCEoZGlyPT0icnRsIikpewpfN2Muc3R5bGUubGVmdD0oKF83Yik/XzdlWzBdK183YS5vZmZzZXRXaWR0aDpfN2VbMF0pKyJweCI7Cn1lbHNlewpfN2Muc3R5bGUubGVmdD0oKF83Yik/XzdlWzBdK183YS5vZmZzZXRXaWR0aC1fN2Euc2Nyb2xsV2lkdGg6XzdlWzBdKSsicHgiOwp9Cl83Yy5zdHlsZS50b3A9XzdlWzFdKyJweCI7Cn0sX2FkanVzdFNjcmVlblBvc2l0aW9uU3RhcnQ6ZnVuY3Rpb24oKXsKcmV0dXJuIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQ7Cn0sX2FkanVzdFNjcmVlblBvc2l0aW9uRW5kOmZ1bmN0aW9uKF84MCl7CnZhciBfODE9ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodDsKaWYoXzgwIT1fODEpewpkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQ7Cn0KfSxfZmluZFBvczpmdW5jdGlvbihvYmopewp2YXIgXzgyPWN1cnRvcD0wOwppZihvYmoub2Zmc2V0UGFyZW50KXsKZG97Cl84Mis9b2JqLm9mZnNldExlZnQ7CmN1cnRvcCs9b2JqLm9mZnNldFRvcDsKfXdoaWxlKG9iaj1vYmoub2Zmc2V0UGFyZW50KTsKcmV0dXJuIFtfODIsY3VydG9wXTsKfQp9fX0pOwp9KSgpOwoKCn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICd3cF90aGVtZV9tZW51cyc6ICIsZSk7fQp0cnl7KGZ1bmN0aW9uKCl7CiAgICBpJC5tZXJnZSh7CgkiTk9fSVRFTVNfMCI6Ik5vIGl0ZW1zIHRvIGRpc3BsYXkiLAoJIkVSUk9SX0xPQURJTkdfMCI6IkVycm9yIGhhcHBlbmVkIHdoaWxlIGxvYWRpbmcgdGhlIG1lbnUuIgp9LGkkLmZyb21QYXRoKCJ3cHRoZW1lLmNvbnRleHRNZW51Lm5scyIsdHJ1ZSkpOwp9KSgpOwoKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ3dwX3RoZW1lX21lbnVzJzogIixlKTt9CnRyeXtqUXVlcnkoImRvY3VtZW50IikucmVhZHkoZnVuY3Rpb24oKSB7DQogICBpZiAoICQoICIjc2hvd0NvbnRlbnQiICkubGVuZ3RoICkgew0KCQl2YXIgb2JqYXBwVmVyc2lvbiA9IG5hdmlnYXRvci5hcHBWZXJzaW9uOw0KICAgICAgICB2YXIgb2JqQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50Ow0KICAgICAgICB2YXIgb2JqYnJvd3Nlck5hbWUgID0gbmF2aWdhdG9yLmFwcE5hbWU7DQogICAgICAgIHZhciBvYmpmdWxsVmVyc2lvbiAgPSAnJytwYXJzZUZsb2F0KG5hdmlnYXRvci5hcHBWZXJzaW9uKTsNCiAgICAgICAgdmFyIG9iakJyTWFqb3JWZXJzaW9uID0gcGFyc2VJbnQobmF2aWdhdG9yLmFwcFZlcnNpb24sMTApOw0KICAgICAgICB2YXIgb2JqT2Zmc2V0TmFtZSxvYmpPZmZzZXRWZXJzaW9uLGl4Ow0KICAgICAgICAgDQogICAgICAgIC8vIEluIENocm9tZQ0KICAgICAgICBpZiAoKG9iak9mZnNldFZlcnNpb249b2JqQWdlbnQuaW5kZXhPZigiQ2hyb21lIikpIT0tMSkgew0KICAgICAgICAgb2JqYnJvd3Nlck5hbWUgPSAiQ2hyb21lIjsNCiAgICAgICAgIG9iamZ1bGxWZXJzaW9uID0gb2JqQWdlbnQuc3Vic3RyaW5nKG9iak9mZnNldFZlcnNpb24rNyk7DQogICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2hvd0NvbnRlbnQiKS5pbm5lckhUTUw9Ijx1bD48bGk+ICAiKyQoJyNJRF9wcHNfbGJsX0RldGVjdE15RGV2aWNlX0Nocm9tZVN0ZXAxJykudmFsKCkrIjwvbGk+PGxpPiIrJCgnI0lEX3Bwc19sYmxfRGV0ZWN0TXlEZXZpY2VfQ2hyb21lU3RlcDInKS52YWwoKSsiPC9saT48bGk+IiskKCcjSURfcHBzX2xibF9EZXRlY3RNeURldmljZV9DaHJvbWVTdGVwMycpLnZhbCgpKyI8L2xpPjwvdWw+IjsNCiAgICAgICAgfQ0KICAgICAgICAvLyBJbiBNaWNyb3NvZnQgaW50ZXJuZXQgZXhwbG9yZXINCiAgICAgICAgZWxzZSBpZiAoISEobmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvVHJpZGVudC8pKXx8KG9iak9mZnNldFZlcnNpb249b2JqQWdlbnQuaW5kZXhPZigiTVNJRSIpKSE9LTEpIHsNCiAgICAgICAgIG9iamJyb3dzZXJOYW1lID0gIk1pY3Jvc29mdCBJbnRlcm5ldCBFeHBsb3JlciI7DQogICAgICAgICBvYmpmdWxsVmVyc2lvbiA9IG9iakFnZW50LnN1YnN0cmluZyhvYmpPZmZzZXRWZXJzaW9uKzUpOw0KCSAgICAgICAgIGlmIChkb2N1bWVudC5hbGwgJiYgZG9jdW1lbnQucXVlcnlTZWxlY3RvciAmJiAhZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgeyAgICANCgkgICAgICAgIAkgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNob3dDb250ZW50IikuaW5uZXJIVE1MPSI8dWw+PGxpPiAgIiskKCcjSURfcHBzX2xibF9EZXRlY3RNeURldmljZV9JRThTdGVwMScpLnZhbCgpKyI8L2xpPjxsaT4iKyQoJyNJRF9wcHNfbGJsX0RldGVjdE15RGV2aWNlX0lFOFN0ZXAyJykudmFsKCkrIjwvbGk+PGxpPiIrJCgnI0lEX3Bwc19sYmxfRGV0ZWN0TXlEZXZpY2VfSUU4U3RlcDMnKS52YWwoKSsiPC9saT48L3VsPiI7DQoJICAgICAgICAJfQ0KCSAgICAgICAgIA0KCSAgICAgICAgIGVsc2V7DQoJICAgICAgICAJIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzaG93Q29udGVudCIpLmlubmVySFRNTD0iPHVsPjxsaT4gICIrJCgnI0lEX3Bwc19sYmxfRGV0ZWN0TXlEZXZpY2VfSUVTdGVwMScpLnZhbCgpKyI8L2xpPjxsaT4iKyQoJyNJRF9wcHNfbGJsX0RldGVjdE15RGV2aWNlX0lFU3RlcDInKS52YWwoKSsiPC9saT48L3VsPiI7DQoJICAgICAgICAgfQ0KDQogICAgICAgIH0NCiAgICAgICAgLy8gSW4gRmlyZWZveA0KICAgICAgICBlbHNlIGlmICgob2JqT2Zmc2V0VmVyc2lvbj1vYmpBZ2VudC5pbmRleE9mKCJGaXJlZm94IikpIT0tMSkgew0KICAgICAgICAgb2JqYnJvd3Nlck5hbWUgPSAiRmlyZWZveCI7DQogICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2hvd0NvbnRlbnQiKS5pbm5lckhUTUw9Ijx1bD48bGk+IiskKCcjSURfcHBzX2xibF9EZXRlY3RNeURldmljZV9GaXJlZm94U3RlcDEnKS52YWwoKSsiPC9saT48bGk+IiskKCcjSURfcHBzX2xibF9EZXRlY3RNeURldmljZV9GaXJlZm94U3RlcDInKS52YWwoKSsiIDxwPjxpbWcgc3JjPVwiaHR0cHM6Ly9oMjA2MTQud3d3Mi5ocC5jb20vZWRpYWdzL2dtZC9Db250ZW50L2ltYWdlcy9maXJlZm94LWRvd25sb2FkLWluc3RydWN0aW9uLXN0ZXAucG5nXCIgd2lkdGg9XCI4NFwiIGhlaWdodD1cIjU4XCI+PC9wPjwvbGk+PGxpPiIrJCgnI0lEX3Bwc19sYmxfRGV0ZWN0TXlEZXZpY2VfRmlyZWZveFN0ZXAzJykudmFsKCkrIjwvbGk+PGxpPiIrJCgnI0lEX3Bwc19sYmxfRGV0ZWN0TXlEZXZpY2VfRmlyZWZveFN0ZXA0JykudmFsKCkrIjwvbGk+PC91bD4iOw0KICAgICAgICB9DQogICAgICAgIC8vIEluIFNhZmFyaQ0KICAgICAgICBlbHNlIGlmICgob2JqT2Zmc2V0VmVyc2lvbj1vYmpBZ2VudC5pbmRleE9mKCJTYWZhcmkiKSkhPS0xKSB7DQogICAgICAgICBvYmpicm93c2VyTmFtZSA9ICJTYWZhcmkiOw0KICAgICAgICAgb2JqZnVsbFZlcnNpb24gPSBvYmpBZ2VudC5zdWJzdHJpbmcob2JqT2Zmc2V0VmVyc2lvbis3KTsNCiAgICAgICAgIGlmICgob2JqT2Zmc2V0VmVyc2lvbj1vYmpBZ2VudC5pbmRleE9mKCJWZXJzaW9uIikpIT0tMSkNCiAgICAgICAgICAgb2JqZnVsbFZlcnNpb24gPSBvYmpBZ2VudC5zdWJzdHJpbmcob2JqT2Zmc2V0VmVyc2lvbis4KTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBGb3Igb3RoZXIgYnJvd3NlciAibmFtZS92ZXJzaW9uIiBpcyBhdCB0aGUgZW5kIG9mIHVzZXJBZ2VudA0KICAgICAgICBlbHNlIGlmICggKG9iak9mZnNldE5hbWU9b2JqQWdlbnQubGFzdEluZGV4T2YoJyAnKSsxKSA8DQogICAgICAgICAgICAgICAgICAob2JqT2Zmc2V0VmVyc2lvbj1vYmpBZ2VudC5sYXN0SW5kZXhPZignLycpKSApDQogICAgICAgIHsNCiAgICAgICAgIG9iamJyb3dzZXJOYW1lID0gb2JqQWdlbnQuc3Vic3RyaW5nKG9iak9mZnNldE5hbWUsb2JqT2Zmc2V0VmVyc2lvbik7DQogICAgICAgICBvYmpmdWxsVmVyc2lvbiA9IG9iakFnZW50LnN1YnN0cmluZyhvYmpPZmZzZXRWZXJzaW9uKzEpOw0KICAgICAgICAgaWYgKG9iamJyb3dzZXJOYW1lLnRvTG93ZXJDYXNlKCk9PW9iamJyb3dzZXJOYW1lLnRvVXBwZXJDYXNlKCkpIHsNCiAgICAgICAgICBvYmpicm93c2VyTmFtZSA9IG5hdmlnYXRvci5hcHBOYW1lOw0KICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIHRyaW1taW5nIHRoZSBmdWxsVmVyc2lvbiBzdHJpbmcgYXQgc2VtaWNvbG9uL3NwYWNlIGlmIHByZXNlbnQNCiAgICAgICAgaWYgKChpeD1vYmpmdWxsVmVyc2lvbi5pbmRleE9mKCI7IikpIT0tMSkNCiAgICAgICAgICAgb2JqZnVsbFZlcnNpb249b2JqZnVsbFZlcnNpb24uc3Vic3RyaW5nKDAsaXgpOw0KICAgICAgICBpZiAoKGl4PW9iamZ1bGxWZXJzaW9uLmluZGV4T2YoIiAiKSkhPS0xKQ0KICAgICAgICAgICBvYmpmdWxsVmVyc2lvbj1vYmpmdWxsVmVyc2lvbi5zdWJzdHJpbmcoMCxpeCk7DQogICAgICAgICANCiAgICAgICAgb2JqQnJNYWpvclZlcnNpb24gPSBwYXJzZUludCgnJytvYmpmdWxsVmVyc2lvbiwxMCk7DQogICAgICAgIGlmIChpc05hTihvYmpCck1ham9yVmVyc2lvbikpIHsNCiAgICAgICAgIG9iamZ1bGxWZXJzaW9uICA9ICcnK3BhcnNlRmxvYXQobmF2aWdhdG9yLmFwcFZlcnNpb24pOw0KICAgICAgICAgb2JqQnJNYWpvclZlcnNpb24gPSBwYXJzZUludChuYXZpZ2F0b3IuYXBwVmVyc2lvbiwxMCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgfQ0KICAgICAgIA0KCQl9KTsNCiAgICAgICAKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7LyogR2xvYmFsIHZhcmlhYmxlIGRlY2xhcmF0aW9uKi8NCnZhciB0eXBlQWhlYWRUaW1lb3V0OyAvLyB0byBjbGVhciBUaW1lb3V0DQp2YXIgY3VycmVudFZhbHVlOw0KdmFyIGFqYXhQYXJhbSA9IHsgICAgICAgLy8gdG8gaG9sZCBwYXJhbWF0ZXJzIHRvIHNlbmQgdG8gYWpheA0KICAgIHVybDEgOiAnJywgLy9mb3IgMXN0IElET0wgY2FsbA0KICAgIHVybDIgOiAnJywgLy8gZm9yIHNlY29uZCBJRE9MIGNhbGwNCiAgICB1cmwgOiAnJywNCiAgICBwYXJhbURhdGEgOiB7fQ0KfTsNCnZhciBjb3VudEVhY2hCaW5kID0gMDsNCg0KdmFyIEtFWSA9IHsNCiAgICAgICAgVVAgOiAzOCwNCiAgICAgICAgRE9XTiA6IDQwLA0KICAgICAgICBUQUIgOiA5LA0KICAgICAgICBFTlRFUiA6IDI3DQp9Ow0KdmFyIGNvbWluZ0Zyb21QRmluZGVyID0gZmFsc2U7DQp2YXIgdXJsQ3JlYXRpb25GaWx0ZXJlZERhdGE7DQoNCiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgew0KICAgIHR5cGVBaGVhZEluaXQoKTsNCn0pOw0KZnVuY3Rpb24gY2hlY2tWYWxpZGl0eSh2YWwpIHsNCiAgICBpZiAodHlwZW9mIHZhbCAhPT0gInVuZGVmaW5lZCIgJiYgdmFsICE9IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCn0NCg0KLyogSW5pdGlhbGlzZSB0aGUgdHlwZWFoZWFkIGFuZCBhdHRhY2ggZXZlbnQgaGFuZGxlcnMgKi8NCmZ1bmN0aW9uIHR5cGVBaGVhZEluaXQoKSB7DQoNCiAgICAkKCJpbnB1dFt0eXBlPSd0ZXh0J10iKS5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygicmVxVHlwZUFoZWFkIikpIHsNCiAgICAgICAgICAgIHZhciB0eXBlQWhlYWRPYmpDbGFzcyA9ICQodGhpcykuZGF0YSgicHJlZGVjdGl2ZWNvbnRhaW5lciIpOw0KICAgICAgICAgICAgaGFuZGxlRXZlbnRzKHR5cGVBaGVhZE9iakNsYXNzLCAkKHRoaXMpKTsNCg0KICAgICAgICB9DQogICAgfSk7DQoNCn0NCg0KDQovKiBFdmVudCBoYW5kbGVyIGZvciBrZXlib2FyZCBhbmQgbW91c2UgZXZlbnRzICAqLw0KZnVuY3Rpb24gaGFuZGxlRXZlbnRzKHR5cGVBaGVhZE9iakNsYXNzLCByZXFUeXBlYWhlYWRCb3gpIHsNCg0KICAgIC8vIGNsb3NlIHR5cGVhaGVhZCBvbiBvdXRzaWRlIGNsaWNrIC0gc3RhcnQgLSBSaWNoYQ0KICAgICQoZG9jdW1lbnQpLmNsaWNrKGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgaWYgKGUudGFyZ2V0LmlkICE9ICJzZWFyY2gtaW5wdXQiKSB7DQogICAgICAgICAgICAkKCcucHJlZGljdGl2ZS1yZXN1bHRzLnNlYXJjaC1wcmVkaWN0aXZlLXJlc3VsdHMnKS5oaWRlKCk7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICAvLyBjbG9zZSB0eXBlYWhlYWQgb24gb3V0c2lkZSBjbGljayAtIGVuZCAtIFJpY2hhDQoNCiAgICAvLyBjYWxsIHRoZSB0eXBlYWhlYWQgZnVuY3Rpb24gb24gaW5wdXQgLSBpbnNlcnQgb3IgZGVsZXRlDQogICAgKHJlcVR5cGVhaGVhZEJveCkub24oImlucHV0IiwgZnVuY3Rpb24oKSB7DQogICAgICAgIGlmKChyZXFUeXBlYWhlYWRCb3gudmFsKCkgIT0gdW5kZWZpbmVkKSAmJiAocmVxVHlwZWFoZWFkQm94LnZhbCgpICE9IChyZXFUeXBlYWhlYWRCb3gpLmF0dHIoImdob3N0VGV4dCIpKSl7DQogICAgICAgIGNhbGxUeXBlQWhlYWQocmVxVHlwZWFoZWFkQm94LCB0eXBlQWhlYWRPYmpDbGFzcyk7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8vIGNhbGwgdGhlIHR5cGVhaGVhZCBmdW5jdGlvbiBvbiBpbnB1dCAtIElFOA0KICAgIGlmICgkKCJib2R5IikuaGFzQ2xhc3MoImllOCIpKSB7DQogICAgICAgIChyZXFUeXBlYWhlYWRCb3gpLm9uKCJrZXlkb3duIiwgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgIGlmICgoZXZlbnQud2hpY2ggIT0gS0VZLkRPV04pICYmIChldmVudC53aGljaCAhPSBLRVkuVVApDQogICAgICAgICAgICAgICAgICAgICYmIChjdXJyZW50VmFsdWUgIT0gKHJlcVR5cGVhaGVhZEJveCkuYXR0cigiZ2hvc3RUZXh0IikpKSB7DQogICAgICAgICAgICAgICAgY2FsbFR5cGVBaGVhZChyZXFUeXBlYWhlYWRCb3gsIHR5cGVBaGVhZE9iakNsYXNzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIChyZXFUeXBlYWhlYWRCb3gpLm9uKCJwYXN0ZSIsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGNhbGxUeXBlQWhlYWQocmVxVHlwZWFoZWFkQm94LCB0eXBlQWhlYWRPYmpDbGFzcykNCiAgICAgICAgICAgIH0sIDEpOw0KICAgICAgICB9KTsNCiAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vbigiZHJhZ2VuZCIscmVxVHlwZWFoZWFkQm94LCBmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgY2FsbFR5cGVBaGVhZChyZXFUeXBlYWhlYWRCb3gsIHR5cGVBaGVhZE9iakNsYXNzKTsNCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgLy8gaGFuZGxlIGFycm93IGtleXMgLCBlbnRlciwgdGFiIG9uIHR5cGVhaGVhZCBib3gNCiAgICAocmVxVHlwZWFoZWFkQm94KS5vbigia2V5ZG93biIsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgIGlmICgkKCIuIiArIHR5cGVBaGVhZE9iakNsYXNzKS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBpZiAoKGV2ZW50LndoaWNoICE9IEtFWS5ET1dOKSAmJiAoZXZlbnQud2hpY2ggIT0gS0VZLlVQKSkgew0KDQogICAgICAgICAgICB9IGVsc2UgaWYgKChldmVudC53aGljaCA9PSBLRVkuRE9XTikpIHsNCiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgICAgICQoIi4iICsgdHlwZUFoZWFkT2JqQ2xhc3MgKyAiIGxpIGEiKS5maXJzdCgpLmZvY3VzKCk7DQogICAgICAgICAgICAgICAgJCgiLiIgKyB0eXBlQWhlYWRPYmpDbGFzcyArICIgbGkgYSIpLnJlbW92ZUNsYXNzKCJob3ZlciIpOw0KICAgICAgICAgICAgICAgICQoIi4iICsgdHlwZUFoZWFkT2JqQ2xhc3MgKyAiIGxpIGEiKS5maXJzdCgpLmFkZENsYXNzKCJob3ZlciIpOw0KICAgICAgICAgICAgICAgIChyZXFUeXBlYWhlYWRCb3gpLnZhbCgkKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLnRleHQoKSk7DQogICAgICAgICAgICAgICAgLy8gJCgiLnR5cGVBaGVhZEJveCIpLnZhbCgkKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLnRleHQoKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgICAgIGVsc2UgaWYoZXZlbnQud2hpY2ggPT0gS0VZLlRBQil7DQogICAgICAgICAgICAgICAgdmFyIGNsZWFySWNvbiA9IChyZXFUeXBlYWhlYWRCb3gpLnBhcmVudHMoIi5zZWFyY2gtYmciKS5maW5kKCIuY2xlYXItc2VhcmNoIik7DQogICAgICAgICAgICAgICAgaWYoJChjbGVhckljb24pLmxlbmd0aCA+IDAgKXsNCiAgICAgICAgICAgICAgICAgICAgJChjbGVhckljb24pLmZvY3VzKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0qLw0KDQogICAgICAgICAgICBlbHNlIGlmICgoZXZlbnQud2hpY2ggPT0gS0VZLlVQKSkgew0KICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgICAgJCgiLiIgKyB0eXBlQWhlYWRPYmpDbGFzcyArICIgbGkgYSIpLmxhc3QoKS5mb2N1cygpOw0KICAgICAgICAgICAgICAgICQoIi4iICsgdHlwZUFoZWFkT2JqQ2xhc3MgKyAiIGxpIGEiKS5yZW1vdmVDbGFzcygiaG92ZXIiKTsNCiAgICAgICAgICAgICAgICAkKCIuIiArIHR5cGVBaGVhZE9iakNsYXNzICsgIiBsaSBhIikubGFzdCgpLmFkZENsYXNzKCJob3ZlciIpOw0KICAgICAgICAgICAgICAgIChyZXFUeXBlYWhlYWRCb3gpLnZhbCgkKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLnRleHQoKSk7DQogICAgICAgICAgICAgICAgLy8gJCgiLnR5cGVBaGVhZEJveCIpLnZhbCgkKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLnRleHQoKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICBlbHNlew0KICAgICAgICAgICAgaWYoZXZlbnQud2hpY2ggPT0gS0VZLlRBQil7DQogICAgICAgICAgICAgICAgdmFyIGNsZWFySWNvbiA9IChyZXFUeXBlYWhlYWRCb3gpLnBhcmVudHMoIi5zZWFyY2gtYmciKS5maW5kKCIuY2xlYXItc2VhcmNoIik7DQogICAgICAgICAgICAgICAgaWYoJChjbGVhckljb24pLmxlbmd0aCA+IDAgKXsNCiAgICAgICAgICAgICAgICAgICAgJChjbGVhckljb24pLmZvY3VzKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ki8NCiAgICAgICAgIGlmICgoZXZlbnQud2hpY2ggPT0gS0VZLkVOVEVSKSkgew0KDQogICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAocmVxVHlwZWFoZWFkQm94KS52YWwoIiIpOw0KICAgICAgICAgICAgICQoIi4iICsgdHlwZUFoZWFkT2JqQ2xhc3MpLnJlbW92ZSgpOw0KICAgICB9DQoNCiAgICB9KTsNCg0KICAgIC8vIGhhbmRsZSBibHVyIG9uIHR5cGVhaGVhZCBib3gNCiAgICAgJChyZXFUeXBlYWhlYWRCb3gpLm9uKCJibHVyVHlwZWFoZWFkIiwgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgIGlzSGlkZVByZWRpY3Rpb24odHlwZUFoZWFkT2JqQ2xhc3MsIHJlcVR5cGVhaGVhZEJveCk7DQogICAgICAgIH0pOw0KICAgICAkKGRvY3VtZW50KS5vbigiYmx1ciIsIi4iICsgdHlwZUFoZWFkT2JqQ2xhc3MgKyAiIGxpIGEiLCBmdW5jdGlvbihldmVudCkgew0KDQogICAgICAgICAgICBpc0hpZGVQcmVkaWN0aW9uKHR5cGVBaGVhZE9iakNsYXNzLCByZXFUeXBlYWhlYWRCb3gpOw0KICAgICAgICB9KTsNCg0KDQoNCiAgICAgLy8gQ2xpY2sgb24gdGhlIHByZWRpY3RpdmUgcmVzdWx0cw0KICAgICAkKGRvY3VtZW50KS5vbigiY2xpY2siLCAiLiIgKyB0eXBlQWhlYWRPYmpDbGFzcyArICIgbGkgYSIsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAocmVxVHlwZWFoZWFkQm94KS52YWwoJCh0aGlzKS50ZXh0KCkpOw0KICAgICAgICAgLy8gSWYgbW9iaWxlIGRldmljZSB0aGVuIGNoZWNrIHRoZSB0eXBlIGFoZWFkIGJlaGF2aW91cg0KICAgICAgICAgaWYoaXNNb2JpbGVEZXZpY2UoKSl7DQogICAgICAgICAJLy9TaW5jZSB0aGlzIGlzIG1vYmlsZSAmIGlmIHRoZSBrZXkgaXMgbm90IHRydWUgdGhlbiB3ZSBuZWVkIHRvIHN0b3AgdHlwZSBhaGVhZA0KICAgICAJCWlmKHR5cGVBaGVhZENsaWNrQmVoYXZpb3JNb2JpbGUgJiYgdHlwZUFoZWFkQ2xpY2tCZWhhdmlvck1vYmlsZSAhPSAidHJ1ZSIpew0KICAgICAJCQkkKHRoaXMpLnBhcmVudHMoIi5wcmVkaWN0aXZlLXJlc3VsdHMiKS5yZW1vdmUoKTsNCiAgICAgCQkJKHJlcVR5cGVhaGVhZEJveCkuZm9jdXMoKTsNCiAgICAgCQkJLy9BbHNvIHdlIGFyZSBmb3JjZSByZXR1cm5pbmcgdGhlIGV2ZW50IGhlcmUgdG8gc3RvcCB0aGUgYWpheCBjYWxsDQogICAgIAkJCXJldHVybjsNCiAgICAgICAgIAl9DQogICAgIAl9DQogICAgIAllbHNlIHsNCiAgICAgCQkvL05vdyB0aGlzIGlzIG5vdCBNb2JpbGUNCiAgICAgCQkvL0NoZWNraW5nIGlmIHRoZSBpbiBEZXNrdG9wL1RhYmxldCBpZiB0aGUgdHlwZSBhaGVhZCBiZWhhdmlvdXIgaXMgZGlzYWJsZWQuDQogICAgIAkJaWYodHlwZUFoZWFkQ2xpY2tCZWhhdmlvckRlc2t0b3AgJiYgdHlwZUFoZWFkQ2xpY2tCZWhhdmlvckRlc2t0b3AgIT0gInRydWUiKXsNCiAgICAgCQkJLy9TaW5jZSBpdCBpcyBzZXQgIHRvIHNvbWV0aGluZyBvdGhlciB0aGFuIHRydWUsIHdlIGFyZSBzdG9waW5nIHRoaXMgYWN0aW9uDQogICAgIAkJCSQodGhpcykucGFyZW50cygiLnByZWRpY3RpdmUtcmVzdWx0cyIpLnJlbW92ZSgpOw0KICAgICAJCQkocmVxVHlwZWFoZWFkQm94KS5mb2N1cygpOw0KICAgICAJCQkvL0Fsc28gd2UgYXJlIGZvcmNlIHJldHVybmluZyB0aGUgZXZlbnQgaGVyZSB0byBzdG9wIHRoZSBhamF4IGNhbGwNCiAgICAgICAgIAkJcmV0dXJuOw0KICAgICAgICAgCX0NCiAgICAgCSAgICB9DQogICAgICAgICAgICAocmVxVHlwZWFoZWFkQm94KS5kYXRhKCJwcm9kdWN0aWQiLCQodGhpcykuZGF0YSgicHJvZHVjdGlkIikpOw0KICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnRzKCIucHJlZGljdGl2ZS1yZXN1bHRzIikucmVtb3ZlKCk7DQogICAgICAgICAgICAocmVxVHlwZWFoZWFkQm94KS5mb2N1cygpOw0KDQogICAgICAgICAgICAvKiA2NTIzIC0gcEZpbmRlciggU1dEKSB3aXRoIHR5cGVhaGVhZCBmdW5jdGlvbmFsaXR5DQogICAgICAgICAgICAgaWYgaXQgaXMgcGZpbmRlciB0aGVuIG5hdmlnYXRlIHRvIFNXRCBzdGVwIDIgcGFnZQ0KICAgICAgICAgICAgIHNlcmllcyA9IHVzLWVuL2RyaXZlcnMvc2VsZnNlcnZpY2UvaHAtZGVza2pldC1kMjYwMC1wcmludGVyLXNlcmllcy8zNzQyOTMzDQogICAgICAgICAgICAgbW9kZWwgPSB1cy1lbi9kcml2ZXJzL3NlbGZzZXJ2aWNlL2hwLWRlc2tqZXQtZDI2MDAtcHJpbnRlci1zZXJpZXMvMzc0MjkzMy9tb2RlbC8zNzQyOTM1DQogICAgICAgICAgICAgICAgbm9kZURlcHRoID0gNCBmb3IgU0tVDQogICAgICAgICAgICAgICAgICAgICAgICA9IDYgZm9yIHByb2R1Y3QNCiAgICAgICAgICAgICAgICAgICAgICAgID0gMiBmb3Igc2VyaWVzDQogICAgICAgICAgICAqLw0KICAgICAgICAgICAgLy9odHRwczovL2c5dDAxNDQuaG91c3Rvbi5ocC5jb20vYXBwcy9OYXY/aF9jbGllbnQ9cy1hLXIxMTgzOS0xJmhfcHJvZHVjdD01NDM2OTc3JmhfbGFuZz1lbiZoX2NjPXVzJmhfcGFnZXR5cGU9cy0wMTcNCiAgICAgICAgICAgIHZhciBzZWFyY2hRdWVyeSA9ICQoImlucHV0W25hbWU9J3NlYXJjaFF1ZXJ5J10iKTsNCiAgICAgICAgICAgIGlmKHNlYXJjaFF1ZXJ5ICYmIHJlcVR5cGVhaGVhZEJveC5oYXNDbGFzcygicGZpbmRlci1zZWFyY2giKSAmJiBjb21pbmdGcm9tUEZpbmRlciApIHsNCiAgICAgICAgICAgICAgICB2YXIgcHJvZElkU2VsZWN0ZWRUeXBlYWhlYWQgPSAkKHRoaXMpLmRhdGEoInByb2R1Y3RpZCIpOw0KICAgICAgICAgICAgICAgIHZhciBzZXBhcmF0b3IgPSAiLyI7DQogICAgICAgICAgICAgICAgdmFyIHVybCA9IGRvY3VtZW50LmxvY2F0aW9uLm9yaWdpbiArIHNlcGFyYXRvcjsNCiAgICAgICAgICAgICAgICB2YXIgY0NvZGUgPSBnZXRDQ0xDKCJjYyIpIDsNCiAgICAgICAgICAgICAgICB2YXIgbENvZGUgPSBnZXRDQ0xDKCJsYyIpOw0KICAgICAgICAgICAgICAgIC8vQ2hlY2tpbmcgZm9yIHNwZWNpYWwgY2MgbGMgY29uZGl0aW9ucw0KICAgICAgICAgICAgICAgIC8qaWYoY0NvZGUgPT0gImdiIiAmJiBsQ29kZSA9PSAiZW4iKXsNCiAgICAgICAgICAgICAgICAgICAgY0NvZGUgPSAidWsiIDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgbENvZGUgPSBsb2NhbGVDb252ZXJzaW9uKGNDb2RlLGxDb2RlKTsNCiAgICAgICAgICAgICAgICB9ICovDQogICAgICAgICAgICAgICAgdXJsICs9IGNDb2RlICsgIi0iOw0KICAgICAgICAgICAgICAgIHVybCArPSBsQ29kZSArIHNlcGFyYXRvcjsNCg0KICAgICAgICAgICAgICAgIHZhciBwYWdlSWRlbnRpZmllciA9ICQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgdmFyIHVybElkZW50aWZpZXIgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmOw0KDQogICAgICAgICAgICAgICAgLy9hZGRpbmcgdXJsIGNyZWF0aW9uIGNvZGUgZm9yIGNvbnRhY3QtaHANCiAgICAgICAgICAgICAgICAvKmlmKHBhZ2VJZGVudGlmaWVyID09ICJjb250YWN0IGhwIC0gYW5vbnltb3VzIiB8fCB1cmxJZGVudGlmaWVyLmluZGV4T2YoImNvbnRhY3QtaHAiKSAhPSAtMSl7DQogICAgICAgICAgICAgICAgICAgIHVybCArPSAiY29udGFjdC1ocC9wcm9kdWN0IiArIHNlcGFyYXRvcjsNCiAgICAgICAgICAgICAgICB9Ki8NCg0KICAgICAgICAgICAgICAgIGlmKHBhZ2VJZGVudGlmaWVyID09ICJzd2RzZWxmc2VydmljZSIgfHwgdXJsSWRlbnRpZmllci5pbmRleE9mKCJkcml2ZXJzIikgIT0gLTEpew0KICAgICAgICAgICAgICAgICAgICB1cmwgKz0gImRyaXZlcnMvc2VsZnNlcnZpY2UiICsgc2VwYXJhdG9yOyAvLyBoYXMgdG8gY29tZSBmcm9tIFNTQyAtIFRCRA0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8qZWxzZSBpZihwYWdlSWRlbnRpZmllciA9PSAiaWRlbnRpZnlwcm9kdWN0IiB8fCB1cmxJZGVudGlmaWVyLmluZGV4T2YoInByb2R1Y3RzIikgIT0gLTEgKXsNCiAgICAgICAgICAgICAgICAgICAgdXJsICs9ICJwcm9kdWN0IiArIHNlcGFyYXRvcjsNCiAgICAgICAgICAgICAgICB9Ki8NCg0KICAgICAgICAgICAgICAgIHZhciBwcm9kdWN0SURDb250YWN0Ow0KICAgICAgICAgICAgICAgIHZhciBzZXJpZXNJRENvbnRhY3Q7DQogICAgICAgICAgICAgICAgdmFyIHNrdUlEQ29udGFjdDsNCg0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHVybENyZWF0aW9uRmlsdGVyZWREYXRhKTsNCiAgICAgICAgICAgICAgICBpZih1cmxDcmVhdGlvbkZpbHRlcmVkRGF0YSkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgdGl0bGU7DQogICAgICAgICAgICAgICAgICAgIGlmKHVybENyZWF0aW9uRmlsdGVyZWREYXRhLmxlbmd0aCA+PSAxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2godXJsQ3JlYXRpb25GaWx0ZXJlZERhdGEsIGZ1bmN0aW9uKGluZGV4LCBvYmopIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gdXJsQ3JlYXRpb25GaWx0ZXJlZERhdGFbaW5kZXhdOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5pZCA9PSBwcm9kSWRTZWxlY3RlZFR5cGVhaGVhZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvb3BpbmcgZWFjaCBwcm9kIGlkIGZyb20gcmVzcG9uc2UganNvbiB0byBtYXRjaCB3aXRoIHByb2QgaWQgb2YgY2xpY2tlZCB0eXBlYWhlYWQgc2VsZWN0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXJsIGZvciBzZXJpZXMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKjY1OTQgLSB1cmwgY3JlYXRpb24gdXNpbmcgc2VvZnJpZW5kbHluYW1lKi8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihkYXRhLnNlb0ZyaWVuZGx5TmFtZSE9dW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gZGF0YS5zZW9GcmllbmRseU5hbWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSBkYXRhLnNlcmllc05hbWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gdGl0bGUucmVwbGFjZSgvIC9nLCItIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsICs9IHRpdGxlICsgc2VwYXJhdG9yOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCArPSBkYXRhLnNlcmllc0lkICsgc2VwYXJhdG9yOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcmllc0lEQ29udGFjdCA9IGRhdGEuc2VyaWVzSWQ7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihkYXRhLmNsYXNzVHlwZSA9PSAzIHx8IGRhdGEuY2xhc3NUeXBlID09IDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsICs9ICJtb2RlbCIgKyBzZXBhcmF0b3I7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCArPSBkYXRhLnByb2R1Y3RJZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdElEQ29udGFjdCA9IGRhdGEucHJvZHVjdElkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihkYXRhLmNsYXNzVHlwZSA9PSA0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCArPSAiP3NrdT0iOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgKz0gZGF0YS5za3VJZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2t1SURDb250YWN0ID0gZGF0YS5za3VJZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvKjY1OTQgLSB1cmwgY3JlYXRpb24gdXNpbmcgc2VvZnJpZW5kbHluYW1lKi8NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHVybENyZWF0aW9uRmlsdGVyZWREYXRhLnNlb0ZyaWVuZGx5TmFtZSE9dW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSB1cmxDcmVhdGlvbkZpbHRlcmVkRGF0YS5zZW9GcmllbmRseU5hbWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gdXJsQ3JlYXRpb25GaWx0ZXJlZERhdGEuc2VyaWVzTmFtZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZSA9IHRpdGxlLnJlcGxhY2UoLyAvZywiLSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICB1cmwgKz0gdGl0bGUgKyBzZXBhcmF0b3I7DQogICAgICAgICAgICAgICAgICAgICAgICB1cmwgKz0gdXJsQ3JlYXRpb25GaWx0ZXJlZERhdGEuc2VyaWVzSWQgKyBzZXBhcmF0b3I7DQogICAgICAgICAgICAgICAgICAgICAgICBzZXJpZXNJRENvbnRhY3QgPSB1cmxDcmVhdGlvbkZpbHRlcmVkRGF0YS5zZXJpZXNJZDsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYodXJsQ3JlYXRpb25GaWx0ZXJlZERhdGEuY2xhc3NUeXBlID09IDMgfHwgdXJsQ3JlYXRpb25GaWx0ZXJlZERhdGEuY2xhc3NUeXBlID09IDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgKz0gIm1vZGVsIiArIHNlcGFyYXRvcjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgKz0gdXJsQ3JlYXRpb25GaWx0ZXJlZERhdGEucHJvZHVjdElkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RJRENvbnRhY3QgPSB1cmxDcmVhdGlvbkZpbHRlcmVkRGF0YS5wcm9kdWN0SWQ7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZih1cmxDcmVhdGlvbkZpbHRlcmVkRGF0YS5jbGFzc1R5cGUgPT0gNCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCArPSAiJnNrdT0iOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCArPSB1cmxDcmVhdGlvbkZpbHRlcmVkRGF0YS5za3VJZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza3VJRENvbnRhY3QgPSB1cmxDcmVhdGlvbkZpbHRlcmVkRGF0YS5za3VJZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAvL2FkZGluZyB1cmwgY3JlYXRpb24gY29kZSBmb3IgY29udGFjdC1ocA0KICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgcGFnZUlkZW50aWZpZXIgPSAkKCcjcGFnZUlkZW50aWZpZXInKS52YWwoKS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgcmVkaXJlY3RIdWJVcmwgPSAnPGhwOmNvbmZpZ3VyYXRpb24gbmFtZT0iSFVCX05BVl9VUkwiIHR5cGVFbnVtPSIkeydQUk9QRVJUWSd9IiAvPic7DQogICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciByZWRpcmVjdEh1YlVybCA9ICJodHRwOi8vZzl0MDE0NC5ob3VzdG9uLmhwLmNvbS9hcHBzL05hdj9oX2NsaWVudD1zLWEtcjExODM5LTEiIDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWRpcmVjdEh1YlVybCA9ICBodWJOYXZpZ2F0aW9uQmFzZVVybCA7DQogICAgICAgICAgICAgICAgICAgICAgICBpZihwcm9kdWN0SURDb250YWN0ICE9IHVuZGVmaW5lZCl7IC8vbm8gcHJvZHVjdCBvaWQgaXMgcmV0dXJuZWQgYnkgSWRvbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdEh1YlVybCArPSAgIiZoX3Byb2R1Y3Q9IiArIHByb2R1Y3RJRENvbnRhY3Q7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdEh1YlVybCArPSAgIiZoX3Byb2R1Y3Q9IiArIHNlcmllc0lEQ29udGFjdDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIC8vQ2hlY2tpbmcgZm9yIHNwZWNpYWwgY2MgbGMgY29uZGl0aW9ucw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoY0NvZGUgPT0gImdiIiAmJiBsQ29kZSA9PSAiZW4iKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjQ29kZSA9ICJ1ayIgOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsQ29kZSA9IGxvY2FsZUNvbnZlcnNpb24oY0NvZGUsbENvZGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3RIdWJVcmwgKz0gIiZoX2xhbmc9IiArIGxDb2RlICsiJmhfY2M9IiArIGNDb2RlIDsNCg0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZihwYWdlSWRlbnRpZmllciA9PSAiY29udGFjdCBocCAtIGFub255bW91cyIgfHwgdXJsSWRlbnRpZmllci5pbmRleE9mKCJjb250YWN0LWhwIikhPSAtMSl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdEh1YlVybCArPSAiJmhfcGFnZXR5cGU9cy0wMTciOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNrdUlEQ29udGFjdCE9IHVuZGVmaW5lZCl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3RIdWJVcmwgKz0gIiZza3U9IiArIHNrdUlEQ29udGFjdDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlZGlyZWN0SHViVXJsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcmVkaXJlY3RIdWJVcmw7DQogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihwYWdlSWRlbnRpZmllciA9PSAiaWRlbnRpZnlwcm9kdWN0IiANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBJdCdzIG5vdCBTV0QgbGFuZGluZyBidXQgdGhlIFByb2R1Y3RzIGxhbmRpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIAl8fCAodXJsSWRlbnRpZmllci5pbmRleE9mKCJwcm9kdWN0cyIpICE9IC0xICYmIHVybElkZW50aWZpZXIuaW5kZXhPZigiL2RyaXZlcnMvcHJvZHVjdHMiKSA9PSAtMSkgKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0SHViVXJsICs9ICImaF9wYWdldHlwZT1zLTAwMSI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2t1SURDb250YWN0IT0gdW5kZWZpbmVkKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdEh1YlVybCArPSAiJnNrdT0iICsgc2t1SURDb250YWN0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVkaXJlY3RIdWJVcmwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZWRpcmVjdEh1YlVybDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgdXJsIGNvbnRhaW5zICcvJyBhdCBlbmQsIHJlbW92ZSBpdA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cmxMYXN0SW5kZXggPSB1cmwubGVuZ3RoIC0gMTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih1cmwuY2hhckF0KHVybExhc3RJbmRleCkgPT0gc2VwYXJhdG9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5zdWJzdHIoMCx1cmxMYXN0SW5kZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh1cmwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdXJsOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIChyZXFUeXBlYWhlYWRCb3gpLnBhcmVudHMoImZvcm0iKS5zdWJtaXQoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICB9KTsNCi8vIGtleWJvYXJkIGV2ZW50cyBvbiB0aGUgcHJlZGljdGl2ZSByZXN1bHRzDQogICAgJChkb2N1bWVudCkub24oImtleWRvd24iLCIuIiArIHR5cGVBaGVhZE9iakNsYXNzICsgIiBsaSBhIixmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGV2ZW50LndoaWNoID09IEtFWS5ET1dOKSkgew0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoJChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5wYXJlbnRzKCJsaSIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaXMoJzpsYXN0LWNoaWxkJykpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qMzI0NCBzdGFydDogc3RvcCBhbGwgaGFuZGxlcnMgZnJvbSBiZWluZyBleGVjdXRlZCBpbiBET00gdHJlZSovDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKjMyNDQgZW5kKi8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5wYXJlbnRzKCJsaSIpLmZpbmQoImEiKS5yZW1vdmVDbGFzcygiaG92ZXIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5wYXJlbnRzKCJsaSIpLm5leHQoKS5jaGlsZHJlbigiYSIpLmFkZENsYXNzKCJob3ZlciIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLnBhcmVudHMoImxpIikubmV4dCgpLmNoaWxkcmVuKCJhIikuZm9jdXMoKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKkZvciBkLTM1ODkgKi8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5jbG9zZXN0KCIuaGFzVHlwZWFoZWFkIikuZmluZCgiaW5wdXQuc2VhcmNoLWlucHV0IikudmFsKCQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkudGV4dCgpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gJCgiLnR5cGVBaGVhZEJveCIpLnZhbCgkKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLnRleHQoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vKHJlcVR5cGVhaGVhZEJveCkudmFsKCQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkudGV4dCgpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIuIiArIHR5cGVBaGVhZE9iakNsYXNzICsgIiBsaSBhIikucmVtb3ZlQ2xhc3MoImhvdmVyIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChyZXFUeXBlYWhlYWRCb3gpLmZvY3VzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChyZXFUeXBlYWhlYWRCb3gpLnZhbChjdXJyZW50VmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhdXRvY29tcGxldGUocmVxVHlwZWFoZWFkQm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0eXBlQWhlYWRPYmpDbGFzcyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKGV2ZW50LndoaWNoID09IEtFWS5UQUIpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGVhckljb24gPSAocmVxVHlwZWFoZWFkQm94KS5wYXJlbnRzKCIuc2VhcmNoLWJnIikuZmluZCgiLmNsZWFyLXNlYXJjaCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQoY2xlYXJJY29uKS5sZW5ndGggPiAwICl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoY2xlYXJJY29uKS5mb2N1cygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiLiIgKyB0eXBlQWhlYWRPYmpDbGFzcykucmVtb3ZlKCk7DQoNCg0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKGV2ZW50LndoaWNoID09IEtFWS5VUCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISgkKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLnBhcmVudHMoImxpIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5pcygnOmZpcnN0LWNoaWxkJykpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qMzI0NCBzdGFydDogc3RvcCBhbGwgaGFuZGxlcnMgZnJvbSBiZWluZyBleGVjdXRlZCBpbiBET00gdHJlZSovDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKjMyNDQgZW5kKi8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5wYXJlbnRzKCJsaSIpLmZpbmQoImEiKS5yZW1vdmVDbGFzcygiaG92ZXIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5wYXJlbnRzKCJsaSIpLnByZXYoKS5jaGlsZHJlbigiYSIpLmFkZENsYXNzKCJob3ZlciIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLnBhcmVudHMoImxpIikucHJldigpLmNoaWxkcmVuKCJhIikuZm9jdXMoKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKkZvciBkLTM1ODkgKi8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5jbG9zZXN0KCIuaGFzVHlwZWFoZWFkIikuZmluZCgiaW5wdXQuc2VhcmNoLWlucHV0IikudmFsKCQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkudGV4dCgpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gJCgiLnR5cGVBaGVhZEJveCIpLnZhbCgkKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLnRleHQoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vKHJlcVR5cGVhaGVhZEJveCkudmFsKCQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkudGV4dCgpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIuIiArIHR5cGVBaGVhZE9iakNsYXNzICsgIiBsaSBhIikucmVtb3ZlQ2xhc3MoImhvdmVyIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChyZXFUeXBlYWhlYWRCb3gpLmZvY3VzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChyZXFUeXBlYWhlYWRCb3gpLnZhbChjdXJyZW50VmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhdXRvY29tcGxldGUocmVxVHlwZWFoZWFkQm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0eXBlQWhlYWRPYmpDbGFzcyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LndoaWNoID09IDEzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS50cmlnZ2VyKCJjbGljayIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCn0NCg0KDQovLyBUaGlzIGZ1bmN0aW9uIG1ha2VzIHRoZSBhamF4IGNhbGwgZm9yIHR5cGVhaGVhZA0KZnVuY3Rpb24gYXV0b2NvbXBsZXRlKGN1cnJlbnRJbnB1dCwgdHlwZUFoZWFkT2JqQ2xhc3MpIHsNCiAgICAkKCIuIiArIHR5cGVBaGVhZE9iakNsYXNzICsgIiIpLnJlbW92ZSgpOw0KICAgIGN1cnJlbnRWYWx1ZSA9ICQudHJpbSgoY3VycmVudElucHV0KS52YWwoKSk7DQogICAgYWpheFBhcmFtLnBhcmFtRGF0YVsiY2MiXSA9IGdldENDTEMoImNjIik7DQogICAgYWpheFBhcmFtLnBhcmFtRGF0YVsibGMiXSA9IGdldENDTEMoImxjIik7DQogICAgYWpheFBhcmFtLnBhcmFtRGF0YVsic2VhcmNoQ29udGV4dCJdID0gJCgNCiAgICAgICAgICAgICIjc2VhcmNoLWRyb3Bkb3duIC5zZWFyY2gtY2F0ZWdvcnkiKS52YWwoKSAhPSAiIiA/ICQoDQogICAgICAgICAgICAiI3NlYXJjaC1kcm9wZG93biAuc2VhcmNoLWNhdGVnb3J5IikudmFsKCkgOiAiQWxsIFN1cHBvcnQiOw0KDQogIA0KICAgIHZhciByZXF1ZXN0SnNvbiA9IEpTT04uc3RyaW5naWZ5KGFqYXhQYXJhbS5wYXJhbURhdGEpOw0KDQoNCiAgICB2YXIgc3VjY2Vzc0hhbmRsZXJQYXJhbXMgPSB7DQogICAgICAgICAgICAnY3VycmVudFZhbHVlJzpjdXJyZW50VmFsdWUsICAvL2NoYW5nZWQgdGhlIGN1cnJlbnRWYWx1ZSBhcyBtb2RpZmllZEN1cnJlbnRWYWx1ZSBpcyBub3QgcmVxdWlyZWQgbm93Lg0KICAgICAgICAgICAgJ2N1cnJlbnRJbnB1dCc6Y3VycmVudElucHV0LA0KICAgICAgICAgICAgJ3R5cGVBaGVhZE9iakNsYXNzJzp0eXBlQWhlYWRPYmpDbGFzcw0KICAgICAgICAgICB9Ow0KDQogICAgYWJvcnRBamF4VXRpbCgpOyAvLyBhYm9ydCBjYWxsZWQgdG8gYWJvcnQgYW55IHByZXZpb3VzIHR5cGVhaGVhZCBhamF4IGNhbGwNCiAgICAvL2Jhc2UgVVJMIGZyb20gcG9ydGFsDQoJdmFyIHR5cGVhaGVhZEFjY2Vzc1Rva2VuID0gJCgiI2FjY2Vzc1Rva2VuSWQiKS52YWwoKTsNCiAgICB2YXIgdXJsMSA9IGFqYXhQYXJhbS51cmwxOyAgICAgICAgICAvL2NvbW1lbnRpbmcgZm9yIG5vdyBzaW5jZSB1cmwgaXMgaGFyZGNvZGVkIGZvciBVUyA4ODY1NiBLQUFTIEFQSSBpbnRlZ3JhdGlvbg0KICAgLy8gdmFyIHVybDEgPSAiaHR0cHM6Ly9wcHNzdXBwb3J0LXFhYXV0aC5ob3VzdG9uLmhwaWNvcnAubmV0L3R5cGVhaGVhZD9xPTx0ZXh0PiZyZXN1bHRMaW1pdD0xMCZzdG9yZT10bXNzdG9yZSZsYW5ndWFnZT1lbiZwcmludEZpZWxkcz10bXNwbW5hbWV2YWx1ZSx0aXRsZSxib2R5LGNoaWxkbm9kZXMsY2xhc3MscHJvZHVjdGlkLHNlb2ZyaWVuZGx5bmFtZSxzaG9ydGVzdG5hdmlnYXRpb25wYXRoIjsgICAvL2hhcmRjb2RpbmcgbmV3IFRBIHVybCBmb3IgdGVzdGluZyBwdXJwb3NlIGZvciBVUyA4ODY1Ng0KICAgIGFqYXhQYXJhbS51cmwgPSB1cmwxOw0KICAgIGFqYXhQYXJhbS51cmwgPSBhamF4UGFyYW0udXJsLnJlcGxhY2UoIjx0ZXh0PiIsY3VycmVudFZhbHVlKTsgICAvL0NoYW5nZSBhcyBwYXJ0IG9mIFVTIDg4NjU2IEtBQVMgQVBJIGludGVncmF0aW9uDQogICAgLy9hamF4UGFyYW0udXJsID0gYWpheFBhcmFtLnVybC5yZXBsYWNlKCI8YWNjZXNzVG9rZW4+Iix0eXBlYWhlYWRBY2Nlc3NUb2tlbik7DQoNCgkvLyBpZiB0aGUgdXNlciBpcyBvbiB1cy1lbi9kcml2ZXJzL3ByaW50ZXIgL2xhcHRvcCBldGMuIGZvciBVUyA5NzM4MSBmaW5kIG15IHByb2R1Y3QgLSBpbmNsdWRlIGZpbHRlcnMgZm9yIFRBDQogICAgICAgIHZhciBmaWx0ZXJJZCA9IGdldEZpbHRlcklkRm9yRHJpdmVyc1BhZ2UoKTsNCiAgICAgICAgLy9BcHBlbmRpbmcgdGhlIGZpbHRlcklkIGZvciBVUyA5NzM4MSBmaW5kIG15IHByb2R1Y3QgLSBpbmNsdWRlIGZpbHRlcnMgZm9yIFRBDQogICAgICAgIHZhciBmaWx0ZXJTdHJpbmcgPSAnJzsNCiAgICAJaWYgKGZpbHRlcklkICE9PSBudWxsICYmIGZpbHRlcklkICE9PSAnICcgJiYgZmlsdGVySWQgIT09ICIiKSB7DQogICAgCQlmaWx0ZXJTdHJpbmcgPSAibmF2aWdhdGlvbnBhdGg6KCIgKyBmaWx0ZXJJZCArICIpIEFORCAiOw0KICAgIAl9DQogICAgCXZhciBpbmRleE9mRmlsdGVyID0gYWpheFBhcmFtLnVybC5pbmRleE9mKCImZmlsdGVycz0iKTsNCiAgICAJdmFyIGZpbHRlclR4dCA9ICImZmlsdGVycz0iOw0KICAgIAl2YXIgZmlsdGVyTGVuZ3RoID0gaW5kZXhPZkZpbHRlciArIGZpbHRlclR4dC5sZW5ndGg7DQogICAgCXZhciB1cmwxID0gYWpheFBhcmFtLnVybC5zbGljZSgwLCBmaWx0ZXJMZW5ndGgpOw0KICAgIAl2YXIgdXJsMiA9IGFqYXhQYXJhbS51cmwuc2xpY2UoZmlsdGVyTGVuZ3RoLCBhamF4UGFyYW0udXJsLmxlbmd0aCk7DQogICAgCWlmIChmaWx0ZXJTdHJpbmcgIT09ICcnKSB7DQogICAgCQlhamF4UGFyYW0udXJsID0gdXJsMSArIGZpbHRlclN0cmluZyArIHVybDI7DQogICAgCX0gZWxzZSB7DQogICAgCQlhamF4UGFyYW0udXJsID0gdXJsMSArIHVybDI7DQogICAgCX0NCiAgICAgICAgICAgICAgDQogICAgLy8gTWFrZSB0aGUgY2FsbCBoZXJlDQogICAgY2FsbEFqYXhVdGlsKCd0eXBlYWhlYWQnLGFqYXhQYXJhbS51cmwsJ0dFVCcscmVjYWxsU2VhcmNoLCdKU09OJyxudWxsLHN1Y2Nlc3NIYW5kbGVyUGFyYW1zLGFqYXhGYWlsdXJlSGFuZGxlcik7IC8vQWRkaW5nIEdFVCBhcyBwYXJ0IG9mIFVTIDg4NjU2IEtBQVMgQVBJIGludGVncmF0aW9uDQogICAgJChjdXJyZW50SW5wdXQpLnBhcmVudCgiLmhhc1R5cGVhaGVhZCIpLmZpbmQoIi5zZWFyY2hpbmciKS5zaG93KCk7DQp9DQoNCnZhciBnZXRGaWx0ZXJJZEZvckRyaXZlcnNQYWdlID0gZnVuY3Rpb24oKXsJCQkvL21vdmVkIHRoaXMgZnVuY3Rpb24gb3V0c2lkZSBmb3IgVVMgOTczODE6IGZuZCBteSBwcm9kdWN0IC0gaW5jbHVkZSBUQSBmaWx0ZXJzLg0KCQ0KCXZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsNCgl2YXIgaWQgPSAiIjsNCgkNCglpZih1cmwuaW5kZXhPZignZHJpdmVycy9wcmludGVyJykgPiAwKXsNCgkJDQoJCWlkID0gcHJpbnRlcklkOwkNCgl9ZWxzZSBpZih1cmwuaW5kZXhPZignZHJpdmVycy9sYXB0b3AnKSA+IDApew0KCQkNCgkJaWQgPSBsYXB0b3BJZDsJDQoJfWVsc2UgaWYodXJsLmluZGV4T2YoJ2RyaXZlcnMvZGVza3RvcCcpID4gMCl7DQoJCQ0KCQlpZCA9IGRlc2t0b3BJZDsJCQ0KCX0NCglpZih1cmwuaW5kZXhPZignY29udGFjdC9wcmludGVycycpID4gMCl7DQoJCQ0KCQlpZCA9IHByaW50ZXJJZDsJDQoJfWVsc2UgaWYodXJsLmluZGV4T2YoJ2NvbnRhY3QvbGFwdG9wcycpID4gMCl7DQoJCQ0KCQlpZCA9IGxhcHRvcElkOwkNCgl9ZWxzZSBpZih1cmwuaW5kZXhPZignY29udGFjdC9kZXNrdG9wcycpID4gMCl7DQoJCQ0KCQlpZCA9IGRlc2t0b3BJZDsJCQ0KCX0NCgkNCglyZXR1cm4gaWQ7DQp9DQovKlRoaXMgZnVuY3Rpb24gdGFrZXMgdGhlIElET0wgSlNPTiByZXNwb25zZSBhbmQgbWFrZXMgc2Vuc2Ugb3V0IG9mIGl0LiovDQp2YXIgUkVMRVZBTlRfRElGRjsgIC8vIHN0b3JlcyB0aGUgcmVsZXZhbmNlIGRpZmYgZnJvbSBqc3AgIGFzIHBhcnQgb2YgVVMgODg2NTYgS2FhcyBBUEkgaW50ZWdyYXRpb24NCnZhciBUWVBFQUhFQURfTUFYX0xJTUlUID0gNjsgLy90byBiZSBleHRlcm5hbGl6ZWQuY2hhbmdlZCB0aGUgbGltaXQgdG8gNi4gY2hhbmdlcyBpbiByZXNwb25zZSByZW5kZXJpbmcgYXMgcGFydCBvZiBVUyA4ODY1NiBLYWFzIEFQSSBpbnRlZ3JhdGlvbg0KDQovKioNCiAqICBUaGlzIG1ldGhvZCBpcyB1c2VkIHdoZW4gaHAtY29yZS1zZXJ2aWNlIGlzIHV0aWxpemVkDQogKiAgZm9yIHR5cGUgYWhlYWQgaW4gc2VhcmNoLg0KICogIFRoaXMgbWV0aG9kIHBvcHVsYXRlcyB0eXBlIGFoZWFkLg0KICoNCiAqICBAc2luY2UgUjMuMA0KICogIEBhdXRob3IgYXJrYS5zaW5oYUBocC5jb20NCiAqLw0KdmFyIG5vbklkb2xUeXBlQWhlYWQgPSBmdW5jdGlvbihkYXRhLHN1Y2Nlc3NIYW5kbGVyUGFyYW1zKXsNCg0KICAgIHZhciBleHRyYWN0ZWREYXRhID0gW107DQogICAgZm9yICh2YXIgaT0wOyBpPGRhdGEubGVuZ3RoOyBpKyspew0KDQogICAgICAgICAgICBleHRyYWN0ZWREYXRhLnB1c2goZGF0YVtpXS5tYXRjaFJlc3V0KTsNCg0KDQogICAgfQ0KICAgIGlmKGV4dHJhY3RlZERhdGEubGVuZ3RoID4gMCl7DQogICAgICAgIGNyZWF0ZUxpc3QoZXh0cmFjdGVkRGF0YSwgZXh0cmFjdGVkRGF0YS5sZW5ndGgsIHN1Y2Nlc3NIYW5kbGVyUGFyYW1zLmN1cnJlbnRJbnB1dCwgc3VjY2Vzc0hhbmRsZXJQYXJhbXMuY3VycmVudFZhbHVlLCBzdWNjZXNzSGFuZGxlclBhcmFtcy50eXBlQWhlYWRPYmpDbGFzcyk7DQogICAgfQ0KfQ0KDQp2YXIgcmVjYWxsU2VhcmNoID0gZnVuY3Rpb24oZGF0YSxzdWNjZXNzSGFuZGxlclBhcmFtcyl7DQogICAgdmFyIHRvdGFsUmVzdWx0czsNCg0KDQogICAgIHZhciByZXNwb25zZURhdGFKU09OID0gZGF0YS5tYXRjaGVzOyAgIC8vIGNoYW5nZXMgaW4gcmVzcG9uc2UgcmVuZGVyaW5nIGFzIHBhcnQgb2YgVVMgODg2NTYgS2FhcyBBUEkgaW50ZWdyYXRpb24NCg0KICAgIC8qaWYodHlwZW9mKHJlc3BvbnNlRGF0YUpTT04pPT0nb2JqZWN0Jyl7ICAgICAgICAgICAgICAgICAgICAvLyBjaGFuZ2VzIGluIHJlc3BvbnNlIHJlbmRlcmluZyBhcyBwYXJ0IG9mIFVTIDg4NjU2IEthYXMgQVBJIGludGVncmF0aW9uDQogICAgICAgICAgICByZXNwb25zZURhdGFKU09OID0gcmVzcG9uc2VEYXRhSlNPTi5qb2luKCk7DQogICAgfQ0KDQogICAgcmVzcG9uc2VEYXRhSlNPTiA9ICQucGFyc2VKU09OKHJlc3BvbnNlRGF0YUpTT04pOyovDQoNCiAgICAvKiByZXNwb25zZURhdGFKU09OID0gZGF0YTsgKi8NCiAgICBpZighKHJlc3BvbnNlRGF0YUpTT04gPT0gdW5kZWZpbmVkKSl7IC8vIC8vIGNoYW5nZXMgaW4gcmVzcG9uc2UgcmVuZGVyaW5nIGFzIHBhcnQgb2YgVVMgODg2NTYgS2FhcyBBUEkgaW50ZWdyYXRpb24NCiAgICB0b3RhbFJlc3VsdHMgPSByZXNwb25zZURhdGFKU09OLmxlbmd0aDsNCiAgICB9DQogICAgZWxzZXsNCiAgICAgICAgdG90YWxSZXN1bHRzID0gMDsNCiAgICB9DQoNCiAgICB2YXIgbW9kaWZpZWRDdXJyZW50VmFsdWUgPSBzdWNjZXNzSGFuZGxlclBhcmFtcy5jdXJyZW50VmFsdWU7DQoNCiAgICB2YXIgd29yZHMgPSBtb2RpZmllZEN1cnJlbnRWYWx1ZS5zcGxpdCgnICcpOw0KICAgIHZhciBsZW5ndGhPZldvcmRMaXN0ID0gd29yZHMubGVuZ3RoOw0KDQogICAgIGlmICh0b3RhbFJlc3VsdHMgPT0gMCAmJiBsZW5ndGhPZldvcmRMaXN0PjEpIHsgLy8gaWYgdGhlcmUgYXJlIG5vIHJlc3VsdHMNCg0KICAgICAgICAgICAgdmFyIGZpZWxkdGV4dCA9ICIiOw0KICAgICAgICAgICAgdmFyIGFkZEZpZWxkVGV4dCA9ICdNQVRDSHsnK2NjKycsTm9WYWx1ZX06Q09VTlRSWV9DT0RFJzsNCg0KICAgICAgICAgICAgaWYoKGNjPT0ndHcnfHwgY2M9PSdoaycgfHwgY2M9PSdjbicpICYmIGxjPT0nemgnKXsNCiAgICAgICAgICAgICAgICBmaWVsZHRleHQgPSAiJmZpZWxkdGV4dD0iK2FkZEZpZWxkVGV4dDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYWpheFBhcmFtLnVybCA9IGFqYXhQYXJhbS51cmwxKycmdGV4dD0nK21vZGlmaWVkQ3VycmVudFZhbHVlK2ZpZWxkdGV4dDsNCiAgICAgICAgLy9jb21tZW50aW5nIHRvIGNhbmNlbCB0aGUgc2Vjb25kIGNhbGwgdG8gSURPTA0KICAgICAgICAgLy9jYWxsQWpheFV0aWwoJ3R5cGVhaGVhZCcsYWpheFBhcmFtLnVybCwnUE9TVCcsY2FsbFR5cGVBaGVhZFJlc3VsdENvbnN0cnVjdG9yLCdKU09OJyxudWxsLHN1Y2Nlc3NIYW5kbGVyUGFyYW1zLGFqYXhGYWlsdXJlSGFuZGxlcik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjYWxsVHlwZUFoZWFkUmVzdWx0Q29uc3RydWN0b3IoZGF0YSxzdWNjZXNzSGFuZGxlclBhcmFtcyk7DQogICAgICAgICAgfQ0KfQ0KdmFyIGNhbGxUeXBlQWhlYWRSZXN1bHRDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uKHJhd0RhdGEsIHN1Y2Nlc3NIYW5kbGVyUGFyYW1zKXsNCiAgICAgbmV3IHR5cGVBaGVhZFJlc3VsdENvbnN0cnVjdG9yKHJhd0RhdGEsc3VjY2Vzc0hhbmRsZXJQYXJhbXMpLmZpbHRlcigpOw0KfQ0KDQp2YXIgdHlwZUFoZWFkUmVzdWx0Q29uc3RydWN0b3IgPSBmdW5jdGlvbihyYXdEYXRhLCBzdWNjZXNzSGFuZGxlclBhcmFtcykgew0KICAgIHZhciByYXdEYXRhID0gcmF3RGF0YTsNCiAgICB2YXIgcmVsZXZhbnREYXRhSW50cmltID0gW107DQogICAgdmFyIHVybENyZWF0aW9uVGVtcERhdGEgPSBbXTsgLy82NTIzIC0gd2lsbCBzdG9yZSByZXNwb29uc2UgZGF0YSB0byBiZSB1c2VkIGZvciB1cmwgY3JlYXRpb24NCiAgICB2YXIgcmVsZXZhbnREYXRhID0gew0KICAgICAgICAidG9waWMiOiB7DQogICAgICAgICAgICAic3VnZ2VzdGlvbnMiOiBbXQ0KICAgICAgICB9LA0KICAgICAgICAicHJvZHVjdCI6IHsNCiAgICAgICAgICAgICJzdWdnZXN0aW9ucyI6IFtdDQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgdmFyIHRvdGFsUmVzdWx0czsNCiAgICB2YXIgcmVzcG9uc2VEYXRhSlNPTiA9IHJhd0RhdGEubWF0Y2hlczsgICAvLyBjaGFuZ2VzIGluIHJlc3BvbnNlIHJlbmRlcmluZyBhcyBwYXJ0IG9mIFVTIDg4NjU2IEthYXMgQVBJIGludGVncmF0aW9uDQoNCiAgICAvKiAgICAgICByZXNwb25zZURhdGFKU09OID0gcmVzcG9uc2VEYXRhSlNPTi5qb2luKCk7DQogICAgfQ0KDQogICAgcmVzcG9uc2VEYXRhSlNPTiA9ICQucGFyc2VKU09OKHJlc3BvbnNlRGF0YUpTT04pOyovDQogICAgLyogcmVzcG9uc2VEYXRhSlNPTiA9IHJhd0RhdGE7ICovDQogICAgaWYoIShyZXNwb25zZURhdGFKU09OID09IHVuZGVmaW5lZCkpeyAvLyBjaGFuZ2VzIGluIHJlc3BvbnNlIHJlbmRlcmluZyBhcyBwYXJ0IG9mIFVTIDg4NjU2IEthYXMgQVBJIGludGVncmF0aW9uDQogICAgdG90YWxSZXN1bHRzID0gcmVzcG9uc2VEYXRhSlNPTi5sZW5ndGg7DQogICAgfQ0KICAgIGVsc2V7DQogICAgICAgIHRvdGFsUmVzdWx0cyA9IDA7DQogICAgfQ0KDQogICAgdmFyIGxvd2VzdE5vZGVEZXB0aCA9IDA7DQogICAgdmFyIGxvd2VzdE5vZGVEZXB0aENvdW50ID0gMDsNCiAgICB2YXIgbWF4V2VpZ2h0YWdlID0gMC4wOw0KICAgIHZhciB0eXBlYWhlYWRSZXN1bHRDb3VudGVyID0gMDsNCg0KICAgIHZhciBjYWxjTm9kZURlcHRoID0gZnVuY3Rpb24oY2xhenpUeXBlLCBuYXZQYXRoVmFsdWUpew0KICAgICAgICBzd2l0Y2goY2xhenpUeXBlKXsNCiAgICAgICAgY2FzZSAiY2F0ZWdvcnlfbmF2aWdhdGlvbiI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIGNhc2UgInBtX3Nlcmllc192YWx1ZSI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDI7DQogICAgICAgIGNhc2UgInBtX25hbWVfdmFsdWUiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAzOw0KICAgICAgICBjYXNlICJwbV9udW1iZXJfdmFsdWUiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA0Ow0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIHJldHVybiA1Ow0KICAgICAgICB9DQoNCiAgICB9DQoNCiAgICB0aGlzLmZpbHRlciA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAvL2luaXRpYWxpc2UgYXJyYXkgdG8gc3RvcmUgY2hpbGQgbm9kZSBwYXRocyAoYXJyYXkgb3IgYXJyYXlzKSB1cy02NTIzDQogICAgICAgICB2YXIgY2hpbGROb2RlUGFyZW50QXJyYXk9W107DQoNCiAgICAgICAgaWYgKHRvdGFsUmVzdWx0cyA9PSAwKSB7IC8vIGlmIHRoZXJlIGFyZSBubyByZXN1bHRzDQogICAgICAgICAgICBnZXRNYXRjaChyZWxldmFudERhdGEsc3VjY2Vzc0hhbmRsZXJQYXJhbXMpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmF3RGF0YSA9IHJlc3BvbnNlRGF0YUpTT047DQogICAgICAgICAgICAvL0luaXRpYWxpemUgdGhpcyBmdW5jdGlvbiBieSBjcmVhdGluZyBhbiBhcnJheSBvZiB0aGUgcmVsZXZhbnQgZGF0YSBmcm9tIHRoZSByYXcgZGF0YSBzZXQgYnkgdXNpbmcgdGhlIGZpbHRlcmluZyBsb2dpYyBieSBWS1MNCg0KICAgICAgICAgICAgdmFyIGlzTXVsdGlwbGVSZXN1bHQgPSAocmF3RGF0YSAhPSB1bmRlZmluZWQpID8gdHJ1ZSA6IGZhbHNlOyAgICAgICAgICAgICAgICAgICAgIC8vIGNoYW5nZXMgaW4gcmVzcG9uc2UgcmVuZGVyaW5nIGFzIHBhcnQgb2YgVVMgODg2NTYgS2FhcyBBUEkgaW50ZWdyYXRpb24NCiAgICAgICAgICAgIGlmIChpc011bHRpcGxlUmVzdWx0KSB7IA0KICAgICAgICAgICAgICAgICQuZWFjaChyYXdEYXRhLCBmdW5jdGlvbihpbmRleCwgb2JqKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wRGF0YSA9IHt9Ow0KICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcERhdGFmb3JVUkwgPSB7fTsNCg0KICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbU5hdlBhdGhWYWx1ZSA9ICgodGhpcy5zaG9ydGVzdE5hdmlnYXRpb25QYXRoKS5zcGxpdCgnfCcpLmxlbmd0aCkgLSAyOyAvL2hhdmluZyBhIC0yIGFzIGFuIGVtcHR5IHN0cmluZyBpcyBjcmVhdGVkIGFmdGVyIHRoZSBsYXN0ICd8Jw0KICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbUNsYXp6VHlwZSA9IHRoaXMucG1DbGFzczsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHNob3J0ZXN0TmF2UGF0aExlbmd0aCA9IGNhbGNOb2RlRGVwdGgoZWxlbUNsYXp6VHlwZSwgZWxlbU5hdlBhdGhWYWx1ZSk7DQoNCg0KICAgICAgICAgICAgICAgICAgICB2YXIgd2VpZ2h0YWdlID0gdGhpcy5tYXRjaFNjb3JlOwkJCQkJCS8vIGNoYW5nZXMgaW4gcmVzcG9uc2UgcmVuZGVyaW5nIGFzIHBhcnQgb2YgVVMgODg2NTYgS2FhcyBBUEkgaW50ZWdyYXRpb24NCiAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGVEZXB0aCA9IHNob3J0ZXN0TmF2UGF0aExlbmd0aDsNCg0KDQogICAgICAgICAgICAgICAgICAgIHRlbXBEYXRhWyJ0aXRsZSJdID0gdGhpcy5uYW1lOw0KICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YVsibm9kZURlcHRoIl0gPSBub2RlRGVwdGg7DQogICAgICAgICAgICAgICAgICAgIHRlbXBEYXRhWyJ3ZWlnaHRhZ2UiXSA9IHdlaWdodGFnZTsNCiAgICAgICAgICAgICAgICAgICAgdGVtcERhdGFbInByb2R1Y3QiXSA9IChjaGVja1ZhbGlkaXR5KHRoaXMucHJvZHVjdElkKSkgPyAgdGhpcy5wcm9kdWN0SWQgOiAiIjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG1heFdlaWdodGFnZSA9PSAwLjApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1heFdlaWdodGFnZSA9IHdlaWdodGFnZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlbGV2YW5jZURpZmZlcmVuY2UgPT0gbnVsbCB8fCByZWxldmFuY2VEaWZmZXJlbmNlID09ICIiKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZWxldmFuY2VEaWZmZXJlbmNlID0gMTA7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBSRUxFVkFOVF9ESUZGID0gcmVsZXZhbmNlRGlmZmVyZW5jZTsgIC8vY2FwdHVyaW5nIHRoZSByZWxldmFuY2UgZGlmZiBmcm9tIGpzcA0KICAgICAgICAgICAgICAgICAgICAgICAgUkVMRVZBTlRfRElGRiA9IChSRUxFVkFOVF9ESUZGICogbWF4V2VpZ2h0YWdlKS8xMDA7DQogICAgICAgICAgICAgICAgICAgICAgICByZWxldmFudERhdGFJbnRyaW0ucHVzaCh0ZW1wRGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICBsb3dlc3ROb2RlRGVwdGggPSBub2RlRGVwdGg7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuY2hpbGRub2RlcykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsJCQkJCQkJCQkJCQkJCQ0KICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGRBcnJheT10aGlzLmNoaWxkbm9kZXMuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGROb2RlUGFyZW50QXJyYXkucHVzaChjaGlsZEFycmF5KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKChtYXhXZWlnaHRhZ2UgLSB3ZWlnaHRhZ2UpIDwgUkVMRVZBTlRfRElGRikgew0KDQoNCg0KICAgICAgICAgICAgICAgICAgICAJaWYgKG5vZGVEZXB0aCA8PSBsb3dlc3ROb2RlRGVwdGgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxldmFudERhdGFJbnRyaW0ucHVzaCh0ZW1wRGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXN0Tm9kZURlcHRoID0gbm9kZURlcHRoOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobm9kZURlcHRoIC0gbG93ZXN0Tm9kZURlcHRoID09IDEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxldmFudERhdGFJbnRyaW0ucHVzaCh0ZW1wRGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgCSBpZih0aGlzLmNoaWxkbm9kZXMpDQogICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGRBcnJheT10aGlzLmNoaWxkbm9kZXMuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZE5vZGVQYXJlbnRBcnJheS5wdXNoKGNoaWxkQXJyYXkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgLyo2NTIzIC0gaW4gY2FzZSBvZiBwZmluZGVyLCBzdG9yaW5nIHJlc3VsdHMgZm9yIGZvcm1pbmcgVVJMIG9mIGRyaXZlcnMgcGFnZSAob24gY2xpY2sNCiAgICAgICAgICAgICAgICAgICAgb2YgdHlwZWFoZWFkIHJlc3VsdHMpKi8NCiAgICAgICAgICAgICAgICAgICAgdGVtcERhdGFmb3JVUkxbInNlcmllc05hbWUiXSA9IHRlbXBEYXRhWyJ0aXRsZSJdOw0KICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YWZvclVSTFsiY2xhc3NUeXBlIl0gPSBzaG9ydGVzdE5hdlBhdGhMZW5ndGg7DQogICAgICAgICAgICAgICAgICAgIHZhciBzZXJpZXNJZDsNCg0KICAgICAgICAgICAgICAgICAgICAvKjY1OTQgLSB1cmwgY3JlYXRpb24gdXNpbmcgc2VvZnJpZW5kbHluYW1lICovDQogICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VvRnJpZW5kbHlOYW1lID09IHVuZGVmaW5lZCl7DQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YWZvclVSTFsic2VvRnJpZW5kbHlOYW1lIl0gPSAibnVsbCI7IC8vSWYgbm8gc2VvRnJpZW5kbHlOYW1lIGlzIGZvdW5kLCB1c2UgbnVsbA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YWZvclVSTFsic2VvRnJpZW5kbHlOYW1lIl0gPSB0aGlzLnNlb0ZyaWVuZGx5TmFtZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIGlmKHNob3J0ZXN0TmF2UGF0aExlbmd0aCA9PSAyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YWZvclVSTFsic2VyaWVzSWQiXSA9IHRlbXBEYXRhWyJwcm9kdWN0Il07DQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YWZvclVSTFsiaWQiXSA9IHRlbXBEYXRhWyJwcm9kdWN0Il07DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzaG9ydGVzdE5hdlBhdGhMZW5ndGggPT0gMyB8fCBzaG9ydGVzdE5hdlBhdGhMZW5ndGggPT0gNCkgewkJLy9jb2RlIG9wdGltaXphdGlvbiBmb3IgVVMgODg2NTYNCiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEYXRhZm9yVVJMWyJwcm9kdWN0SWQiXSA9IHRlbXBEYXRhWyJwcm9kdWN0Il07DQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YWZvclVSTFsiaWQiXSA9IHRlbXBEYXRhZm9yVVJMWyJwcm9kdWN0SWQiXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlcmllc0lkID0gdGhpcy5zaG9ydGVzdE5hdmlnYXRpb25QYXRoOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWVzSWQgPSAoY2hlY2tWYWxpZGl0eShzZXJpZXNJZCkpID8gc2VyaWVzSWQuc3BsaXQoInwiKSA6ICIiOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmKHNob3J0ZXN0TmF2UGF0aExlbmd0aCA9PSAzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHNlcmllc0lkID09ICIiID8gIiIgOiAoc2VyaWVzSWQgPSBzZXJpZXNJZFtzZXJpZXNJZC5sZW5ndGgtM10pOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGVtcERhdGFmb3JVUkxbInNlcmllc0lkIl0gPSBzZXJpZXNJZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYoc2hvcnRlc3ROYXZQYXRoTGVuZ3RoID09IDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEYXRhZm9yVVJMWyJza3VJZCJdID0gdGVtcERhdGFbInRpdGxlIl07DQogICAgICAgICAgICAgICAgICAgICAgICBzZXJpZXNJZCA9PSAiIiA/ICIiIDogKHNlcmllc0lkID0gc2VyaWVzSWRbc2VyaWVzSWQubGVuZ3RoLTRdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEYXRhZm9yVVJMWyJzZXJpZXNJZCJdID0gc2VyaWVzSWQ7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvZHVjdElkID0gdGhpcy5zaG9ydGVzdE5hdmlnYXRpb25QYXRoOw0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdElkID0gKGNoZWNrVmFsaWRpdHkoc2VyaWVzSWQpKSA/IHByb2R1Y3RJZC5zcGxpdCgifCIpIDogIiI7DQogICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0SWQgPT0gIiIgPyAiIiA6IChwcm9kdWN0SWQgPSBwcm9kdWN0SWRbcHJvZHVjdElkLmxlbmd0aC0zXSk7DQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YWZvclVSTFsicHJvZHVjdElkIl0gPSBwcm9kdWN0SWQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgdXJsQ3JlYXRpb25UZW1wRGF0YS5wdXNoKHRlbXBEYXRhZm9yVVJMKTsNCiAgICAgICAgICAgICAgICAgICAgIC8qIDY1MjMgLSBpbiBjYXNlIG9mIHBmaW5kZXIsIHN0b3JpbmcgcmVzdWx0cyBmb3IgZm9ybWluZyBVUkwgb2YgZHJpdmVycyBwYWdlIChvbiBjbGljaw0KICAgICAgICAgICAgICAgICAgICBvZiB0eXBlYWhlYWQgcmVzdWx0cyAtIEVuZCAqLw0KDQogICAgICAgICAgICAgICAgfSk7DQoNCg0KDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHZhciB0ZW1wRGF0YSA9IHt9Ow0KICAgICAgICAgICAgICAgIHZhciB0ZW1wRGF0YWZvclVSTCA9IHt9OwkJCQkvLyBjaGFuZ2VzIGluIHJlc3BvbnNlIHJlbmRlcmluZyBhcyBwYXJ0IG9mIFVTIDg4NjU2IEthYXMgQVBJIGludGVncmF0aW9uDQoNCiAgICAgICAgICAgICAgICB2YXIgZWxlbU5hdlBhdGhWYWx1ZSA9ICgocmF3RGF0YS5zaG9ydGVzdE5hdmlnYXRpb25QYXRoKS5zcGxpdCgnfCcpLmxlbmd0aCkgLSAyOyAvL2hhdmluZyBhIC0yIGFzIGFuIGVtcHR5IHN0cmluZyBpcyBjcmVhdGVkIGFmdGVyIHRoZSBsYXN0ICd8Jw0KICAgICAgICAgICAgICAgIHZhciBlbGVtQ2xhenpUeXBlID0gcmF3RGF0YS5wbUNsYXNzOw0KICAgICAgICAgICAgICAgIHZhciBzaG9ydGVzdE5hdlBhdGhMZW5ndGggPSBjYWxjTm9kZURlcHRoKGVsZW1DbGF6elR5cGUsIGVsZW1OYXZQYXRoVmFsdWUpDQoNCg0KDQogICAgICAgICAgICAgICAgdmFyIHdlaWdodGFnZSA9IHJhd0RhdGEubWF0Y2hTY29yZTsNCiAgICAgICAgICAgICAgICB0ZW1wRGF0YVsidGl0bGUiXSA9IHJhd0RhdGEubmFtZTsNCiAgICAgICAgICAgICAgICB0ZW1wRGF0YVsibm9kZURlcHRoIl0gPSBzaG9ydGVzdE5hdlBhdGhMZW5ndGg7DQogICAgICAgICAgICAgICAgdGVtcERhdGFbIndlaWdodGFnZSJdID0gd2VpZ2h0YWdlOw0KICAgICAgICAgICAgICAgIHRlbXBEYXRhWyJwcm9kdWN0Il09IChjaGVja1ZhbGlkaXR5KHJhd0RhdGEucHJvZHVjdElkKSkgPyByYXdEYXRhLnByb2R1Y3RJZCA6ICIiIDsNCiAgICAgICAgICAgICAgICBsb3dlc3ROb2RlRGVwdGggPSBzaG9ydGVzdE5hdlBhdGhMZW5ndGg7DQogICAgICAgICAgICAgICAgcmVsZXZhbnREYXRhSW50cmltLnB1c2godGVtcERhdGEpOw0KDQogICAgICAgICAgICAgICAgdGVtcERhdGFmb3JVUkxbInNlcmllc05hbWUiXSA9IHRlbXBEYXRhWyJ0aXRsZSJdOw0KICAgICAgICAgICAgICAgIHRlbXBEYXRhZm9yVVJMWyJjbGFzc1R5cGUiXSA9IHNob3J0ZXN0TmF2UGF0aExlbmd0aDsNCg0KICAgICAgICAgICAgICAgIC8qNjU5NCAtIHVybCBjcmVhdGlvbiB1c2luZyBzZW9mcmllbmRseW5hbWUqLw0KICAgICAgICAgICAgICAgIHRlbXBEYXRhZm9yVVJMWyJzZW9GcmllbmRseU5hbWUiXSA9IHJhd0RhdGEuc2VvRnJpZW5kbHlOYW1lOw0KDQogICAgICAgICAgICAgICAgaWYoc2hvcnRlc3ROYXZQYXRoTGVuZ3RoID09IDIpIHsNCiAgICAgICAgICAgICAgICAgICAgdGVtcERhdGFmb3JVUkxbInNlcmllc0lkIl0gPSB0ZW1wRGF0YVsicHJvZHVjdCJdOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzaG9ydGVzdE5hdlBhdGhMZW5ndGggPT0gMykgew0KICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YWZvclVSTFsicHJvZHVjdElkIl0gPSB0ZW1wRGF0YVsicHJvZHVjdCJdOw0KICAgICAgICAgICAgICAgICAgICB2YXIgc2VyaWVzSWQgPSByYXdEYXRhLnNob3J0ZXN0TmF2aWdhdGlvblBhdGg7DQogICAgICAgICAgICAgICAgICAgIHNlcmllc0lkID0gKGNoZWNrVmFsaWRpdHkoc2VyaWVzSWQpKSA/IHNlcmllc0lkLnNwbGl0KCJ8IikgOiAiIjsNCiAgICAgICAgICAgICAgICAgICAgc2VyaWVzSWQgPT0gIiIgPyAiIiA6IChzZXJpZXNJZCA9IHNlcmllc0lkW3Nlcmllc0lkLmxlbmd0aC0zXSk7DQogICAgICAgICAgICAgICAgICAgIHRlbXBEYXRhZm9yVVJMWyJzZXJpZXNJZCJdID0gc2VyaWVzSWQ7DQogICAgICAgICAgICAgICAgICAgIHRlbXBEYXRhZm9yVVJMWyJpZCJdID0gdGVtcERhdGFmb3JVUkxbInByb2R1Y3RJZCJdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmKHNob3J0ZXN0TmF2UGF0aExlbmd0aCA9PSA0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YWZvclVSTFsic2t1SWQiXSA9IHRlbXBEYXRhWyJ0aXRsZSJdOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGVtcERhdGFmb3JVUkxbInByb2R1Y3RJZCJdID0gdGVtcERhdGFbInByb2R1Y3QiXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEYXRhZm9yVVJMWyJpZCJdID0gdGVtcERhdGFmb3JVUkxbInByb2R1Y3RJZCJdOw0KDQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VyaWVzSWQgPSByYXdEYXRhLnNob3J0ZXN0TmF2aWdhdGlvblBhdGg7DQogICAgICAgICAgICAgICAgICAgICAgICBzZXJpZXNJZCA9IChjaGVja1ZhbGlkaXR5KHNlcmllc0lkKSkgPyBzZXJpZXNJZC5zcGxpdCgifCIpIDogIiI7DQogICAgICAgICAgICAgICAgICAgICAgICBzZXJpZXNJZCA9PSAiIiA/ICIiIDogKHNlcmllc0lkID0gc2VyaWVzSWRbc2VyaWVzSWQubGVuZ3RoLTRdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEYXRhZm9yVVJMWyJzZXJpZXNJZCJdID0gc2VyaWVzSWQ7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvZHVjdElkID0gcmF3RGF0YS5zaG9ydGVzdE5hdmlnYXRpb25QYXRoOw0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdElkID0gKGNoZWNrVmFsaWRpdHkoc2VyaWVzSWQpKSA/IHByb2R1Y3RJZC5zcGxpdCgifCIpIDogIiI7DQogICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0SWQgPT0gIiIgPyAiIiA6IChwcm9kdWN0SWQgPSBwcm9kdWN0SWRbcHJvZHVjdElkLmxlbmd0aC0zXSk7DQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YWZvclVSTFsicHJvZHVjdElkIl0gPSBwcm9kdWN0SWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHVybENyZWF0aW9uVGVtcERhdGEucHVzaCh0ZW1wRGF0YWZvclVSTCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB1cmxDcmVhdGlvbkZpbHRlcmVkRGF0YSA9IHVybENyZWF0aW9uVGVtcERhdGE7DQoNCg0KDQogICAgICAgICAgICAkLmVhY2gocmVsZXZhbnREYXRhSW50cmltLCBmdW5jdGlvbihpbmRleCwgb2JqKSB7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9maWx0ZXIgcmVsZXZhbnREYXRhSW50cmltIG9iamVjdCB1c2VyIHN0b3J5IDY1MjMNCiAgICAgICAgICAgICAgICB2YXIgaXNDaGlsZEl0ZW0gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB0aGlzWyJwcm9kdWN0Il0gPSB0aGlzWyJwcm9kdWN0Il0udG9TdHJpbmcoKTsJCQkvL2NvbnZlcnRpbmcgdGhlIHByb2R1Y3RJZCB0byBzdHJpbmcgZm9yIGNvbXBhcmlzb24gZm9yIFVTIDg4NjU2DQogICAgICAgICAgICAgICAgLy8gY2hlY2sgd2hldGhlciB0aGUgcHJvZHVjdCBpcyBjaGlsZCBpdGVtICBmcm9tIGNoaWxkbm9kZSBhcnJheQ0KICAgICAgICAgICAgICAgIGZvcih2YXIgaT0wO2kgPCBjaGlsZE5vZGVQYXJlbnRBcnJheS5sZW5ndGg7aSsrKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICBpZihjaGlsZE5vZGVQYXJlbnRBcnJheVtpXS5pbmRleE9mKHRoaXNbInByb2R1Y3QiXSkgPiAtMSkNCiAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpc0NoaWxkSXRlbSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLy9pZiB0aGlzIGl0ZW0gaXMgYSBjaGlsZCBpdGVtIGRlbiBkaXNjYXJkDQogICAgICAgICAgICAgICAgaWYoaXNDaGlsZEl0ZW0pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8vLy8vIGVuZCA2NTIzDQoNCg0KDQogICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZFJlc3VsdENvdW50ZXIgPCBUWVBFQUhFQURfTUFYX0xJTUlUKSB7DQogICAgICAgICAgICAgICAgCQ0KICAgICAgICAgICAgICAgIC8vRklYIGZvciBBTE0gMjU2Ny0gcmVtb3ZpbmcgdGhlIG5vZGUgZGVwdGggY29uZGl0aW9uDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAJdHlwZWFoZWFkUmVzdWx0Q291bnRlcisrOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXBEYXRhID0ge307DQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YVsibGFiZWwiXSA9IHRoaXNbInRpdGxlIl07DQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGF0YVsicHJvZHVjdElkIl0gPSB0aGlzWyJwcm9kdWN0Il07DQogICAgICAgICAgICAgICAgICAgICAgICByZWxldmFudERhdGEucHJvZHVjdC5zdWdnZXN0aW9ucy5wdXNoKHRlbXBEYXRhKTsJDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGdldE1hdGNoKHJlbGV2YW50RGF0YSxzdWNjZXNzSGFuZGxlclBhcmFtcyk7DQogICAgICAgIH0NCiAgICB9DQoNCg0KfQ0KLypFbmQqLw0KLy8gRmFpbHVyZSBoYW5kbGVyIGZvciBhamF4IGNhbGwNCmZ1bmN0aW9uIGFqYXhGYWlsdXJlSGFuZGxlcigpew0KICAgICQoIi5oYXNUeXBlYWhlYWQgLnNlYXJjaGluZyIpLmhpZGUoKTsNCg0KICAgIH0NCg0KLy8gR2V0IHRoZSBtYXRjaGVkIHJlc3VsdHMgZm9yIHByb2R1Y3RzIGFuZCB0b3BpY3MNCmZ1bmN0aW9uIGdldE1hdGNoKGpzb25EYXRhLCBwYXJhbU9iaikgew0KICAgIC8vIGpzb25EYXRhID0galF1ZXJ5LnBhcnNlSlNPTihqc29uRGF0YSk7DQoNCiAgICB2YXIgY3VycmVudFZhbHVlID0gcGFyYW1PYmouY3VycmVudFZhbHVlOw0KICAgIHZhciBjdXJyZW50SW5wdXQgPSBwYXJhbU9iai5jdXJyZW50SW5wdXQ7DQogICAgdmFyIHR5cGVBaGVhZE9iakNsYXNzID0gcGFyYW1PYmoudHlwZUFoZWFkT2JqQ2xhc3M7DQoNCiAgICAkKCIuaGFzVHlwZWFoZWFkIC5zZWFyY2hpbmciKS5oaWRlKCk7DQogICAgdmFyIGpzb25Qcm9kTGVuID0ganNvbkRhdGEucHJvZHVjdC5zdWdnZXN0aW9ucy5sZW5ndGg7DQogICAgdmFyIGpzb25Ub3BpY0xlbiA9IGpzb25EYXRhLnRvcGljLnN1Z2dlc3Rpb25zLmxlbmd0aDsNCiAgICB2YXIganNvblRvdGFsTGVuZ3RoID0ganNvblByb2RMZW4gKyBqc29uVG9waWNMZW47DQoNCiAgICB2YXIganNvbk9iaiA9IG5ldyBBcnJheSgpOw0KICAgIHZhciBqID0gMDsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGpzb25Qcm9kTGVuOyBpKyspIHsNCiAgICAgICAgaWYgKChjdXJyZW50VmFsdWUgIT0gIiIpKSB7DQogICAgICAgICAgICB2YXIgdGVtcERhdGEgPSB7fTsNCiAgICAgICAgICAgIHRlbXBEYXRhWyJsYWJlbCJdID0ganNvbkRhdGEucHJvZHVjdC5zdWdnZXN0aW9uc1tpXS5sYWJlbDsNCiAgICAgICAgICAgIHRlbXBEYXRhWyJwcm9kdWN0SWQiXSA9IGpzb25EYXRhLnByb2R1Y3Quc3VnZ2VzdGlvbnNbaV0ucHJvZHVjdElkOw0KICAgICAgICAgICAganNvbk9ialtqXSA9IHRlbXBEYXRhOw0KICAgICAgICAgICAgaisrOw0KICAgICAgICB9DQogICAgfQ0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwganNvblRvcGljTGVuOyBpKyspIHsNCiAgICAgICAgaWYgKChjdXJyZW50VmFsdWUgIT0gIiIpKSB7DQogICAgICAgICAgICB2YXIgdGVtcERhdGEgPSB7fTsNCiAgICAgICAgICAgIHRlbXBEYXRhWyJsYWJlbCJdID0ganNvbkRhdGEudG9waWMuc3VnZ2VzdGlvbnNbaV0ubGFiZWw7DQogICAgICAgICAgICB0ZW1wRGF0YVsicHJvZHVjdElkIl0gPSAoanNvbkRhdGEudG9waWMuc3VnZ2VzdGlvbnNbaV0ucHJvZHVjdElkKTsNCiAgICAgICAgICAgIGpzb25PYmpbal0gPSB0ZW1wRGF0YTsNCiAgICAgICAgICAgIGorKzsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGNyZWF0ZUxpc3QoanNvbk9iaiwganNvblByb2RMZW4sIGN1cnJlbnRJbnB1dCwgY3VycmVudFZhbHVlLA0KICAgICAgICAgICAgdHlwZUFoZWFkT2JqQ2xhc3MpOw0KfQ0KDQovLyBUaGlzIGNyZWF0ZXMgdGhlIERPTSBmb3IgdGhlIHByZWRpY3RpdmUgcmVzdWx0cyBhbmQgYXBwZW5kIGl0DQpmdW5jdGlvbiBjcmVhdGVMaXN0KGpzb25PYmosIGpzb25Qcm9kTGVuLCBjdXJyZW50SW5wdXQsIGN1cnJlbnRWYWx1ZSx0eXBlQWhlYWRPYmpDbGFzcykgew0KDQogICAgKGN1cnJlbnRJbnB1dCkuc2libGluZ3MoInVsIikucmVtb3ZlKCk7DQoNCiAgICAvKg0KICAgICAqIHR5cGUgaGVhZCBoaWdobGlnaHRpbmcgLSBjcmVhdGluZyBhcnJheSB3aXRoIGVhY2ggd29yZCBpbiB1c2VyIHF1ZXJ5IGZvcg0KICAgICAqIHNlYXJjaCBib3gNCiAgICAgKi8NCiAgICB2YXIgdXNlclF1ZXJ5ID0gKGN1cnJlbnRJbnB1dCkudmFsKCk7DQogICAgdmFyIHVzZXJRdWVyeVdvcmQ7DQogICAgdmFyIHVzZXJRdWVyeVdvcmRMZW4gPSAwOw0KICAgIGlmICh1c2VyUXVlcnkgIT0gdW5kZWZpbmVkICYmIHVzZXJRdWVyeSAhPSAiIikgew0KICAgICAgICB1c2VyUXVlcnlXb3JkID0gdXNlclF1ZXJ5LnNwbGl0KCIgIik7DQogICAgfQ0KICAgIC8qDQogICAgICogdHlwZSBoZWFkIGhpZ2hsaWdodGluZyAtIGNyZWF0aW5nIGFycmF5IHdpdGggZWFjaCB3b3JkIGluIHVzZXIgcXVlcnkgZm9yDQogICAgICogc2VhcmNoIGJveCAtIGVuZA0KICAgICAqLw0KICAgIHZhciBqc29uTGVuID0ganNvbk9iai5sZW5ndGg7DQogICAgdmFyIHR5cGVhaGVhZExlZnRIb29rID0gKGN1cnJlbnRJbnB1dCkuc2libGluZ3MoIi50eXBlYWhlYWRIb29rIikudmFsKCkgKyAicHgiOw0KICAgIGlmKCQoImh0bWwiKS5hdHRyKCJkaXIiKT09Imx0ciIpew0KICAgIHZhciBzdHJpbmdMaXN0ID0gIjx1bCBjbGFzcz1cInByZWRpY3RpdmUtcmVzdWx0cyAiICsgdHlwZUFoZWFkT2JqQ2xhc3MNCiAgICAgICAgICAgICsgIiBcIiBzdHlsZT1cImxlZnQ6Iit0eXBlYWhlYWRMZWZ0SG9vaysiXCI+IjsNCiAgICB9DQogICAgZWxzZXsNCiAgICAgICAgdmFyIHN0cmluZ0xpc3QgPSAiPHVsIGNsYXNzPVwicHJlZGljdGl2ZS1yZXN1bHRzICIgKyB0eXBlQWhlYWRPYmpDbGFzcw0KICAgICAgICArICIgXCIgc3R5bGU9XCJyaWdodDoiK3R5cGVhaGVhZExlZnRIb29rKyJcIj4iOw0KICAgIH0NCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGpzb25MZW47IGkrKykgew0KICAgICAgICAvKg0KICAgICAgICAgKiB0eXBlIGhlYWQgaGlnaGxpZ2h0aW5nIC0gdXNpbmcgYXJyYXkgdG8gaGlnaGxpZ2h0IHR5cGUgYWhlYWQNCiAgICAgICAgICogc3VnZ2VzdGlvbnMNCiAgICAgICAgICovDQogICAgICAgIGZvciAodmFyIGNvdW50ID0gMDsgY291bnQgPCB1c2VyUXVlcnlXb3JkLmxlbmd0aDsgY291bnQrKykgew0KICAgICAgICAgICAgdmFyIHRvQmVIaWdobGlnaHRlZCA9IHVzZXJRdWVyeVdvcmRbY291bnRdOw0KICAgICAgICAgICAgdmFyIHN1Z2dlc3RlZFN0ciA9IGpzb25PYmpbaV0ubGFiZWw7DQogICAgICAgICAgICBpZiAodG9CZUhpZ2hsaWdodGVkICE9ICIiKSB7DQogICAgICAgICAgICAgICAgICAgIHN1Z2dlc3RlZFN0ciA9IGhpZ2hsaWdodFN1Z2dlc3Rpb24oc3VnZ2VzdGVkU3RyLHRvQmVIaWdobGlnaHRlZCk7DQogICAgICAgICAgICAgICAgICAgIGpzb25PYmpbaV0ubGFiZWwgPSBzdWdnZXN0ZWRTdHI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLyoNCiAgICAgICAgICogdHlwZSBoZWFkIGhpZ2hsaWdodGluZyAtIHVzaW5nIGFycmF5IHRvIGhpZ2hsaWdodCB0eXBlIGFoZWFkDQogICAgICAgICAqIHN1Z2dlc3Rpb25zIC0gZW5kDQogICAgICAgICAqLw0KICAgICAgICBpZiAoaSA9PSBqc29uUHJvZExlbikgew0KICAgICAgICAgICAgc3RyaW5nTGlzdCArPSAiIDxsaT48YSBocmVmPVwiamF2YXNjcmlwdDp2b2lkKDApO1wiIGNsYXNzPVwiZmlyc3RUb3BpY1wiIFwiPiINCiAgICAgICAgICAgICAgICAgICAgKyBqc29uT2JqW2ldICsgIjwvYT48L2xpPiAiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc3RyaW5nTGlzdCArPSAiIDxsaT48YSBocmVmPVwiamF2YXNjcmlwdDp2b2lkKDApO1wiIGRhdGEtcHJvZHVjdGlkPVwiIitqc29uT2JqW2ldLnByb2R1Y3RJZCsiXCIgPiIgKyBqc29uT2JqW2ldLmxhYmVsDQogICAgICAgICAgICAgICAgICAgICsgIjwvYT48L2xpPiAiOw0KICAgICAgICB9DQogICAgfQ0KICAgIHN0cmluZ0xpc3QgKz0gIjwvdWw+Ig0KICAgIGlmICgoY3VycmVudFZhbHVlICE9ICIiKSAmJiAoanNvbkxlbiAhPSAwKSkgew0KICAgICAgICBpZiAoKGN1cnJlbnRWYWx1ZS50b0xvd2VyQ2FzZSgpICE9IGpzb25PYmpbMF0ubGFiZWwudG9Mb3dlckNhc2UoKSkpIHsNCiAgICAgICAgICAgIChjdXJyZW50SW5wdXQpLnBhcmVudHMoIi5oYXNUeXBlYWhlYWQiKS5hcHBlbmQoc3RyaW5nTGlzdCk7DQogICAgICAgICAgICBpZiggKGN1cnJlbnRJbnB1dCkuaGFzQ2xhc3MoInBmaW5kZXItc2VhcmNoIikgKXsNCiAgICAgICAgICAgICAgICBjb21pbmdGcm9tUEZpbmRlcj10cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICBjb21pbmdGcm9tUEZpbmRlcj1mYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvLyAkKCIuYXV0b0NvbXBsZXRlTGlzdCIpLmNzcygidG9wIiwgKGN1cnJlbnRJbnB1dCkuY3NzKCJoZWlnaHQiKSk7DQogICAgLy8gJCgiLnR5cGVBaGVhZEJveCIpLnZhbChqc29uT2JqWzBdKTsNCg0KfQ0KDQovL1RoaXMgZnVuY3Rpb24gY2FsbHMgdGhlIHR5cGVhaGVhZCBmdW5jdGlvbiBhZnRlciBhbiBpbnRlcnZhbCBvZiAxMDBtcyBhZnRlciB1c2VyIGlucHV0cw0KZnVuY3Rpb24gY2FsbFR5cGVBaGVhZChyZXFUeXBlYWhlYWRCb3gsIHR5cGVBaGVhZE9iakNsYXNzKSB7DQoNCiAgICAvLyB0aGlzIGlzIHRvIGdldCB0aGUgdHlwZUFoZWFkTGltaXQgaS5lLiBiZXlvbmQgdGhpcyBjb3VudCBubyB0eXBlYWhlYWQgY2FsbCwgI2Fya2ENCiAgICB2YXIgdHlwZUFoZWFkTGltaXQgPSByZXFUeXBlYWhlYWRCb3guZGF0YSgidHlwZWFoZWFkbGltaXQiKTsNCg0KICAgIC8vIERvbid0IGNhbGwgSURPTCBmb3IgdHlwZSBhaGVhZCBpZiB0aGUgbGVuZ2h0IG9mIHRleHQgaXMgbGVzcyB0aGFuIDIgb3IgZ3JlYXRlciB0aGFuIHRoZSBjb25maWd1cmVkIGxpbWl0ICNhcmthDQogICAgaWYgKChyZXFUeXBlYWhlYWRCb3gpLnZhbCgpLmxlbmd0aCA+IDEgJiYgKHJlcVR5cGVhaGVhZEJveCkudmFsKCkubGVuZ3RoIDwgdHlwZUFoZWFkTGltaXQpIHsNCiAgICAgICAgY2xlYXJUaW1lb3V0KHR5cGVBaGVhZFRpbWVvdXQpOw0KICAgICAgICB0eXBlQWhlYWRUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIGF1dG9jb21wbGV0ZShyZXFUeXBlYWhlYWRCb3gsIHR5cGVBaGVhZE9iakNsYXNzKQ0KICAgICAgICB9LCAxMDApOw0KICAgICAgICAvLyBhdXRvY29tcGxldGUocmVxVHlwZWFoZWFkQm94LCB0eXBlQWhlYWRPYmpDbGFzcyk7DQoNCiAgICB9IGVsc2Ugew0KICAgICAgICBjbGVhclRpbWVvdXQodHlwZUFoZWFkVGltZW91dCk7DQogICAgICAgICQoIi4iICsgdHlwZUFoZWFkT2JqQ2xhc3MgKyAiIikucmVtb3ZlKCk7DQogICAgICAgICQoIi5oYXNUeXBlYWhlYWQgLnNlYXJjaGluZyIpLmhpZGUoKTsNCiAgICB9DQoNCn0NCg0KLyogY3JlYXRlZCBmb3IgdHlwZWFoZWFkIGtleXdvcmQgaGlnaGxpZ2h0aW5nIC0gUmljaGENCiAqIHRoaXMgZnVuY3Rpb24gY3JlYXRlcyBhbmQgYXJyYXkgZnJvbSBzdWdnZXN0ZWQgc3RyaW5nLiBMb2dpYyBpcyB0byBzZXBhcmF0ZSBhbHJlYWR5IGhpZ2hsaWdodGVkDQogKiAoa2V5d29yZHMgZW5mb2xkZWQgd2l0aCA8c3Ryb25nPikgZnJvbSBvdGhlciB3b3Jkcy4NCiAqICB0byBoYW5kbGUgaWYgdXNlciBzZWFyY2hlcyBmb3Igcy90L3Ivby9uL2csIG5lZWQgdG8gcmVtb3ZlIDxzdHJvbmc+aGlnaGxpZ2h0ZWQ8L3N0cm9uZz4gZnJvbQ0KICAgIHRoZSBzdWdnZXN0ZWRTdHINCiAqLw0KZnVuY3Rpb24gY3JlYXRlU3VnZ2VzdGVkQXJyKHN1Z2dlc3RlZFN0cikgew0KICAgIHZhciBzdGFydFRhZyA9ICI8c3Ryb25nPiI7DQogICAgdmFyIGxhc3RUYWcgPSAiPC9zdHJvbmc+IjsNCiAgICB2YXIgcmVtYWluaW5nU3VnZ2VzdGVkU3RyID0gc3VnZ2VzdGVkU3RyOw0KICAgIHZhciBzdWdnZXN0ZWRBcnIgPSBbXSwgYXJyQ291bnRlcj0wOw0KICAgIHZhciBzdHJvbmdMYXN0VGFnTCA9IEtFWS5UQUI7DQogICAgdmFyIHN0cm9uZ0ZpcnN0SW5kZXggPSByZW1haW5pbmdTdWdnZXN0ZWRTdHIuaW5kZXhPZihzdGFydFRhZyk7DQogICAgdmFyIHN0cm9uZ0xhc3RJbmRleCA9IHJlbWFpbmluZ1N1Z2dlc3RlZFN0ci5pbmRleE9mKGxhc3RUYWcpOw0KDQogICAgd2hpbGUoc3Ryb25nRmlyc3RJbmRleCE9LTEpIHsNCg0KICAgICAgICBpZiAoc3Ryb25nRmlyc3RJbmRleCA9PSAwKXsNCiAgICAgICAgICAgIHZhciBlbmRUYWdMYXN0SW5kZXggPSBzdHJvbmdMYXN0SW5kZXggKyBzdHJvbmdMYXN0VGFnTDsNCiAgICAgICAgICAgIHN1Z2dlc3RlZEFyclthcnJDb3VudGVyXSA9IHJlbWFpbmluZ1N1Z2dlc3RlZFN0ci5zdWJzdHJpbmcoMCxlbmRUYWdMYXN0SW5kZXgpOw0KICAgICAgICAgICAgcmVtYWluaW5nU3VnZ2VzdGVkU3RyID0gcmVtYWluaW5nU3VnZ2VzdGVkU3RyLnN1YnN0cmluZyhlbmRUYWdMYXN0SW5kZXgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc3VnZ2VzdGVkQXJyW2FyckNvdW50ZXJdID0gcmVtYWluaW5nU3VnZ2VzdGVkU3RyLnN1YnN0cmluZygwLHN0cm9uZ0ZpcnN0SW5kZXgpOw0KICAgICAgICAgICAgcmVtYWluaW5nU3VnZ2VzdGVkU3RyID0gcmVtYWluaW5nU3VnZ2VzdGVkU3RyLnN1YnN0cmluZyhzdHJvbmdGaXJzdEluZGV4KTsNCiAgICAgICAgfQ0KICAgICAgICBhcnJDb3VudGVyKys7DQogICAgICAgIHN0cm9uZ0ZpcnN0SW5kZXggPSByZW1haW5pbmdTdWdnZXN0ZWRTdHIuaW5kZXhPZihzdGFydFRhZyk7DQogICAgICAgIHN0cm9uZ0xhc3RJbmRleCA9IHJlbWFpbmluZ1N1Z2dlc3RlZFN0ci5pbmRleE9mKGxhc3RUYWcpOw0KICAgIH0NCg0KICAgIC8vc3Ryb25nIGRvZXNudCBvY2N1cg0KICAgIGlmKHJlbWFpbmluZ1N1Z2dlc3RlZFN0ciE9IiIpIHsNCiAgICAgICAgc3VnZ2VzdGVkQXJyW2FyckNvdW50ZXJdID0gcmVtYWluaW5nU3VnZ2VzdGVkU3RyOw0KICAgIH0NCg0KICAgIHJldHVybiBzdWdnZXN0ZWRBcnI7DQp9DQoNCg0KLyogY3JlYXRlZCBmb3IgdHlwZWFoZWFkIGtleXdvcmQgaGlnaGxpZ2h0aW5nIC0gUmljaGENCiAqIHRoaXMgZnVuY3Rpb24gc2VuZHMgc3VnZ2VzdGlvbiBhcnJheSB0byBjcmVhdGVIaWdsaWdodGVkU3RyIGZvciBhZGRpbmcgc3Ryb25nIHRhZ3MNCiAqICovDQpmdW5jdGlvbiBoaWdobGlnaHRTdWdnZXN0aW9uKHN1Z2dlc3RlZFN0ckNvbXBsZXRlLCB0b0JlSGlnaGxpZ2h0ZWQpIHsNCg0KICAgIHZhciBzdWdnZXN0ZWRBcnIgPSBjcmVhdGVTdWdnZXN0ZWRBcnIoc3VnZ2VzdGVkU3RyQ29tcGxldGUpOw0KICAgIHZhciBzdWdnZXN0ZWRBcnJMID0gc3VnZ2VzdGVkQXJyLmxlbmd0aDsNCiAgICB2YXIgc3VnZ2VzdGVkU3RyLCBmaW5hbFN1Z2dlc3RlZFN0ciA9ICIiOw0KICAgIHZhciBub09mTWF0Y2hlczsNCiAgICB2YXIgcmVnRXggPSBuZXcgUmVnRXhwKHRvQmVIaWdobGlnaHRlZCwgImdpIik7DQogICAgZm9yKHZhciBjb3VudGVyQXJyPTA7IGNvdW50ZXJBcnI8c3VnZ2VzdGVkQXJyTDsgY291bnRlckFycisrKSB7DQogICAgICAgIHN1Z2dlc3RlZFN0ciA9IHN1Z2dlc3RlZEFycltjb3VudGVyQXJyXTsNCiAgICAgICAgbm9PZk1hdGNoZXMgPSBzdWdnZXN0ZWRTdHIubWF0Y2gocmVnRXgpICE9IG51bGwgPyBzdWdnZXN0ZWRTdHIubWF0Y2gocmVnRXgpLmxlbmd0aCA6IDA7DQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgICogZm9yIHRoZSBmaXJzdCBtYXRjaGVkIHN0cmluZywgYWRkIDxzdHJvbmc+PC9zdHJvbmc+IHRvIHRoZSBrZXl3b3JkIGJhc2VkDQogICAgICAgICAgICAgKiBvbiBpdHMgImtleXdvcmQiIG9jY3VycmVuY2UNCiAgICAgICAgICAgICAqLw0KICAgICAgICBpZiAobm9PZk1hdGNoZXMgIT0gMCkgew0KDQogICAgICAgICAgICBpZiAoc3VnZ2VzdGVkU3RyLmluZGV4T2YoIjxzdHJvbmc+Iik9PS0xKSB7DQogICAgICAgICAgICAgICAgc3VnZ2VzdGVkU3RyID0gY3JlYXRlSGlnbGlnaHRlZFN0cihzdWdnZXN0ZWRTdHIsIHRvQmVIaWdobGlnaHRlZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgICogZnJvbSB0aGUgc2Vjb25kIG1hdGNoIG9ud2FyZHMsIGFkZCA8c3Ryb25nPjwvc3Ryb25nPiB0byB0aGUga2V5d29yZA0KICAgICAgICAgICAgICogYmFzZWQgb24gaXRzICJrZXl3b3JkKzwvc3Ryb25nPiIgb2NjdXJyZW5jZQ0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBzdWdnZXN0ZWRTdHIubGFzdEluZGV4T2YodG9CZUhpZ2hsaWdodGVkKyc8L3N0cm9uZz4nKTsNCiAgICAgICAgICAgICAgICBpZiAoaW5kZXggIT0gLTEpIHsNCiAgICAgICAgICAgICAgICAgICAgZmlyc3RQYXJ0U3RyID0gc3VnZ2VzdGVkU3RyLnN1YnN0cmluZygwLCBpbmRleCk7DQogICAgICAgICAgICAgICAgICAgICAgICBsYXN0UGFydFN0ciA9IHN1Z2dlc3RlZFN0ci5zdWJzdHJpbmcoaW5kZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdGVkU3RyID0gZmlyc3RQYXJ0U3RyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBjcmVhdGVIaWdsaWdodGVkU3RyKGxhc3RQYXJ0U3RyLCB0b0JlSGlnaGxpZ2h0ZWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZpbmFsU3VnZ2VzdGVkU3RyID0gZmluYWxTdWdnZXN0ZWRTdHIgKyBzdWdnZXN0ZWRTdHI7DQogICAgfQ0KDQogICAgcmV0dXJuIGZpbmFsU3VnZ2VzdGVkU3RyOw0KfQ0KDQovKmNyZWF0ZWQgZm9yIHR5cGVhaGVhZCBrZXl3b3JkIGhpZ2hsaWdodGluZyAtIFJpY2hhDQogKiB0aGlzIGZ1bmN0aW9uIGFkZHMgc3Ryb25nIHRhZyBhcm91bmQgbWF0Y2hpbmcgdGV4dA0KICogKi8NCmZ1bmN0aW9uIGNyZWF0ZUhpZ2xpZ2h0ZWRTdHIoc3RyVmFsdWUsIHRvQmVIaWdobGlnaHRlZCkgew0KICAgIHZhciBzdGFydFRhZyA9ICI8c3Ryb25nPiI7DQogICAgdmFyIGxhc3RUYWcgPSAiPC9zdHJvbmc+IjsNCiAgICB2YXIgaW5kZXggPSBzdHJWYWx1ZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodG9CZUhpZ2hsaWdodGVkLnRvTG93ZXJDYXNlKCkpOw0KICAgIHN0clZhbHVlID0gc3RyVmFsdWUuc3Vic3RyaW5nKDAsIGluZGV4KSArIHN0YXJ0VGFnDQogICAgICAgICAgICArIHN0clZhbHVlLnN1YnN0cmluZyhpbmRleCwgaW5kZXggKyB0b0JlSGlnaGxpZ2h0ZWQubGVuZ3RoKQ0KICAgICAgICAgICAgKyBsYXN0VGFnICsgc3RyVmFsdWUuc3Vic3RyaW5nKGluZGV4ICsgdG9CZUhpZ2hsaWdodGVkLmxlbmd0aCk7DQogICAgcmV0dXJuIHN0clZhbHVlOw0KfQ0KDQovKiBjcmVhdGVkIGZvciB0eXBlYWhlYWQga2V5d29yZCBoaWdobGlnaHRpbmcgLSBlbmQgLSBSaWNoYSAqLw0KZnVuY3Rpb24gaXNIaWRlUHJlZGljdGlvbih0eXBlQWhlYWRPYmpDbGFzcywgcmVxVHlwZWFoZWFkQm94KXsNCg0KICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgaWYoJCgiLiIgKyB0eXBlQWhlYWRPYmpDbGFzcyArICIgbGkgYSIpLmlzKCI6Zm9jdXMiKSB8fCAkKCIuY2xlYXJRdWVzdGlvblRleHQiKS5pcygiOmZvY3VzIikgfHwocmVxVHlwZWFoZWFkQm94KS5pcygiOmZvY3VzIikgICApew0KDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2V7DQogICAgICAgICAgICAgICAgICAgICQoIi4iICsgdHlwZUFoZWFkT2JqQ2xhc3MpLnJlbW92ZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIDIwMCk7DQp9DQoNCi8qKg0KICogQHJldHVybnMNCiAqLw0KLypmdW5jdGlvbiBnZXRGaWx0ZXJJZEZvckRyaXZlcnNQYWdlKCl7DQoJDQoJdmFyIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOw0KCXZhciBpZCA9ICIiOw0KCQ0KCWlmKHVybC5pbmRleE9mKCdkcml2ZXJzL3ByaW50ZXInKSA+IDApew0KCQkNCgkJaWQgPSBwcmludGVySWQ7CQ0KCX1lbHNlIGlmKHVybC5pbmRleE9mKCdkcml2ZXJzL2xhcHRvcCcpID4gMCl7DQoJCQ0KCQlpZCA9IGxhcHRvcElkOwkNCgl9ZWxzZSBpZih1cmwuaW5kZXhPZignZHJpdmVycy9kZXNrdG9wJykgPiAwKXsNCgkJDQoJCWlkID0gZGVza3RvcElkOwkJDQoJfQ0KCQ0KCXJldHVybiBpZDsNCn0qLw0KDQovKioNCiAqIFRoaXMgbWV0aG9kIHdpbGwgZmluZCB0aGUgcGFyYW1ldGVyIG5hbWVkIGZpZWxkVGV4dCBhbmQNCiAqIGFwcGVuZCBhZGRpdGlvbmFsRmllbGRUZXh0IHRvIGl0IGFuZCBtb2RpZnkgdGhlIG9yaWdpbmFsDQogKiBVUkwgd2l0aCB0aGUgbmV3IG92ZXJhbGwgZmllbGRUZXh0DQogKiANCiAqIEBwYXJhbSB1cmwNCiAqIEBwYXJhbSBhZGRpdGlvbmFsRmllbGRUZXh0DQogKiBAcmV0dXJucw0KICovDQpmdW5jdGlvbiBhZGRGaWVsZFRleHRDb25kaXRpb25Ub1VSTCh1cmwsIGFkZGl0aW9uYWxGaWVsZFRleHQsIGZpbHRlcklkKXsNCgkNCgl2YXIgZmluYWxVcmwgPSB1cmw7DQoJDQoJaWYodXJsLmluZGV4T2YoJ306TkFWSUdBVElPTlBBVEgnKSA9PSAtMSl7DQoJDQoJCXZhciBpbmRleE9mRmllbGRUZXh0ID0gdXJsLmluZGV4T2YoImZpZWxkdGV4dCIpOw0KCQl2YXIgdXJsUGFydE9uZSA9IHVybC5zdWJzdHIoMCwgaW5kZXhPZkZpZWxkVGV4dCk7DQoJCXZhciB1cmxQYXJ0VHdvID0gdXJsLnN1YnN0cihpbmRleE9mRmllbGRUZXh0LCB1cmwubGVuZ3RoKTsNCgkJDQoJCXZhciBpbmRleE9mRmllbGRUZXh0RW5kID0gdXJsUGFydFR3by5pbmRleE9mKCcmJyk7DQoJCXZhciBvbGRGaWVsZFRleHQgPSB1cmxQYXJ0VHdvLnN1YnN0cigwLCBpbmRleE9mRmllbGRUZXh0RW5kKTsNCgkJdmFyIG5ld0ZpZWxkVGV4dCA9IG9sZEZpZWxkVGV4dCArIGFkZGl0aW9uYWxGaWVsZFRleHQ7DQoJCQ0KCQl2YXIgdXJsUGFydFRocmVlID0gdXJsUGFydFR3by5zdWJzdHIoaW5kZXhPZkZpZWxkVGV4dEVuZCwgdXJsUGFydFR3by5sZW5ndGgpOw0KCQkNCgkJZmluYWxVcmwgPSB1cmxQYXJ0T25lICsgbmV3RmllbGRUZXh0ICsgdXJsUGFydFRocmVlOw0KCQ0KCS8vIFVSTCBhbHJlYWR5IGhhcyB0aGlzIGNvbmRpdGlvbiANCgl9ZWxzZXsNCgkJDQoJCS8vIHRoZSBVUkwgaGFzIHRoaXMgY29uZGl0aW9uIHdpdGggc29tZSBvdGhlciBJRA0KCQlpZih1cmwuaW5kZXhPZihmaWx0ZXJJZCkgPT0gLTEpew0KCQkJDQoJCQl2YXIgZmllbGRUZXh0UGFyYW1TdHJpbmcgPSAnK0FORCtTVFJJTkd7JzsJCQkNCgkJCXZhciBpID0gdXJsLmluZGV4T2YoZmllbGRUZXh0UGFyYW1TdHJpbmcpOw0KCQkJaSA9IGkgKyBmaWVsZFRleHRQYXJhbVN0cmluZy5sZW5ndGg7DQoJCQl2YXIgaiA9IHVybC5pbmRleE9mKCd9Ok5BVklHQVRJT05QQVRIJyk7DQoJCQkNCgkJCWZpbmFsVXJsID0gdXJsLnNsaWNlKDAsIGkpICsgZmlsdGVySWQgKyB1cmwuc2xpY2UoaiwgdXJsLmxlbmd0aCk7CQkJDQoJCX0NCgl9DQoJDQoJcmV0dXJuIGZpbmFsVXJsOw0KfQ0KDQovKioNCiAqIFJlbW92ZSBmaWVsZFRleHQgcGFyYW0gb2YgbmF2aWdhdGlvbg0KICogcGF0aC4gRm9yIGFueSBzZWFyY2ggb3RoZXIgdGhhbg0KICogU1dEIFR5cGUgQWhlYWQNCiAqIEBwYXJhbSB1cmwNCiAqIEByZXR1cm5zDQogKi8NCmZ1bmN0aW9uIHJlbW92ZUZpZWxkVGV4dENvbmRpdGlvbih1cmwpew0KCQ0KCXZhciBmaWVsZFRleHRQYXJhbVN0cmluZyA9ICcrQU5EK1NUUklOR3snOw0KCXZhciBmaWVsZFRleHRQYXJhbU5hdmlnYXRpb24gPSAnfTpOQVZJR0FUSU9OUEFUSCc7DQoJDQoJdmFyIGkgPSB1cmwuaW5kZXhPZihmaWVsZFRleHRQYXJhbVN0cmluZyk7CQ0KCXZhciBqID0gdXJsLmluZGV4T2YoZmllbGRUZXh0UGFyYW1OYXZpZ2F0aW9uKTsNCglqID0gaiArIGZpZWxkVGV4dFBhcmFtTmF2aWdhdGlvbi5sZW5ndGg7CQ0KCQ0KCXJldHVybiB1cmwuc2xpY2UoMCwgaSkgKyB1cmwuc2xpY2UoaiwgdXJsLmxlbmd0aCk7DQp9Cn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ey8qIENvcHlyaWdodCAoYykgMjAxNiwgMjAxNywgSFAgYW5kL29yIGl0cyBhZmZpbGlhdGVzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiAqLwoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogKiBOQU1FCiAqICAgYXNzZXRDb252ZXJzaW9uSW50ZWdyYXRpb24uanMKICoKICogREVTQ1JJUFRJT04KICogICBIYXMgZnVuY3Rpb25zIHdoaWNoIGNhbiBjb252ZXJ0IGEgcG90ZW50aWFsIFNhbXN1bmcgcHJvZHVjdCdzCiAqICAgcHJvZHVjdCBvciBzZXJpYWwgbnVtYmVyIGludG8gZXF1aXZhbGVudCBIUCBwcm9kdWN0IG51bWJlcgogKiAgIG9yIHNlcmlhbCBudW1iZXIsIGFuZCB2aWNlLXZlcnNhLgogKgogKgogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgovKioKICogQ29udmVydHMgSFAgcHJvZHVjdCBudW1iZXIgdG8gU2Ftc3VuZwogKiBhbmQgdmljZS12ZXJzYSB1c2luZyBDQUwKICoKICogQGF1dGhvciBhcmthLnNpbmhhQGhwLmNvbQogKgogKi8KZnVuY3Rpb24gY29udmVydFByb2R1Y3ROdW1iZXIocHJvZHVjdE51bWJlclJlcXVlc3QsIGNhbGxiYWNrKXsKCgl2YXIgcmVzcG9uc2VEYXRhID0ge307CgoJLy8gc2V0IHRoZSByZXF1ZXN0IG9iamVjdAoJdmFyIHJlcXVlc3RKU09OID0ge307CglyZXF1ZXN0SlNPTi5wcm9kdWN0TnVtYmVyID0gcHJvZHVjdE51bWJlclJlcXVlc3QucHJvZHVjdE51bWJlcjsKCXJlcXVlc3RKU09OLmNhcHRjaGFUb2tlbiA9IHByb2R1Y3ROdW1iZXJSZXF1ZXN0LmNhcHRjaGFUb2tlbjsKCXJlcXVlc3RKU09OLmNjPXByb2R1Y3ROdW1iZXJSZXF1ZXN0LmNjOwoJcmVxdWVzdEpTT04ubGM9cHJvZHVjdE51bWJlclJlcXVlc3QubGM7Cgl2YXIgc3NpZCA9IGdldFNTSURGb3JBc3NldENvbnYoJ3Byb2R1Y3QnKTsKCXZhciB1cmwgPSAiL2hwLXBwcy1zZXJ2aWNlcy9hc3NldC9jb252ZXJzaW9uL3Byb2R1Y3RudW1iZXI/c3NpZD0iICsgc3NpZDsKCSQuYWpheCh7CiAgICAgIAl0eXBlOiAnUE9TVCcsCiAgICAgIAl1cmwgOiB1cmwsCiAgICAgIAlkYXRhVHlwZTonanNvbicsCiAgICAgIAlkYXRhOiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0SlNPTiksCiAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uKHhocikgewogICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICAgICAgJCgiI2NvbnZlcnNpb25HaWZTcGlubmVyIikubW9kYWwoInNob3ciKTsKICAgICAgICB9LAoJICAgIHN1Y2Nlc3MgOiBmdW5jdGlvbihkYXRhKSB7CgoJICAgIAkvLyBTZXQgSFBQTiBhbmQgRVBOIGluIGZpbmFsIHJlc3BvbnNlCgkgICAgCXJlc3BvbnNlRGF0YS5ocFByb2R1Y3ROdW1iZXIgPSBkYXRhLmhwUHJvZHVjdE51bWJlcjsKCSAgICAJcmVzcG9uc2VEYXRhLmVxdWl2YWxlbnRQcm9kdWN0TnVtYmVyID0gZGF0YS5lcXVpdmFsZW50UHJvZHVjdE51bWJlcjsKCgkgICAgCS8vIENoZWNrIGlmIGl0IGlzIGFuIEhQIGFzc2V0CgkgICAgCWlmKHByb2R1Y3ROdW1iZXJSZXF1ZXN0LnByb2R1Y3ROdW1iZXIgPT0gZGF0YS5ocFByb2R1Y3ROdW1iZXIpewoKCSAgICAJCS8vIGlucHV0IFBOIG1hdGNoZXMgSFBQTiBpbiByZXNwb25zZSwgSFAgQXNzZXQKCSAgICAJCXJlc3BvbnNlRGF0YS5pc0hQQXNzZXQgPSB0cnVlOwoJICAgIAl9ZWxzZXsKCgkgICAgCQkvLyBOb3QgYW4gSFAgYXNzZXQKCSAgICAJCXJlc3BvbnNlRGF0YS5pc0hQQXNzZXQgPSBmYWxzZTsKCSAgICAJfQoKCSAgICAJLy8gQ2hlY2sgaWYgdGhlIHJlc3BvbnNlIGhhcyBib3RoIEhQUE4gYW5kIEVQTgoJICAgIAlpZigoZGF0YS5ocFByb2R1Y3ROdW1iZXIgIT0gbnVsbCAmJiBkYXRhLmhwUHJvZHVjdE51bWJlciAhPSAnJykKCSAgICAJCSYmKGRhdGEuZXF1aXZhbGVudFByb2R1Y3ROdW1iZXIgIT0gbnVsbCAmJiBkYXRhLmVxdWl2YWxlbnRQcm9kdWN0TnVtYmVyICE9ICcnKSl7CgoJICAgIAkJLy8gc2V0IG1hdGNoIGZvdW5kIGFzIHRydWUKCSAgICAJCXJlc3BvbnNlRGF0YS5pc01hdGNoRm91bmQgPSB0cnVlOwoJICAgIAl9ZWxzZSB7CgoJICAgIAkJLy8gbm8gbWF0Y2ggZm91bmQKCSAgICAJCXJlc3BvbnNlRGF0YS5pc01hdGNoRm91bmQgPSBmYWxzZTsKCSAgICAJfQoJICAgIAljb25zb2xlLmxvZyhyZXNwb25zZURhdGEpOwoJICAgIAlwb3B1bGF0ZVNTSUQoKTsKCSAgICAJY2FsbGJhY2socHJvZHVjdE51bWJlclJlcXVlc3QscmVzcG9uc2VEYXRhKTsKCSAgICB9LAoJICAgIGVycm9yIDogZnVuY3Rpb24oZSkgewoKCSAgICAJcmVzcG9uc2VEYXRhLmVycm9yID0gJ3NlcnZpY2UgZXJyb3InOwoJICAgICAgICBjb25zb2xlLmxvZygnRVJST1I6ICcsIGUpOwoJICAgICAgICBjb25zb2xlLmxvZyh4aHIuc3RhdHVzKTsKCSAgICAgICAgcG9wdWxhdGVTU0lEKCk7CgkgICAgICAgIHZhciBlcnJvckRhdGEgPSB7CQkvL2NyZWF0aW5nIHRoZSBqc29uIG9iamVjdCBhbmQgYXBwZW5kaW5nIHNvdXJjZSBmb3IgIEFMTSAyODY2IDUwMCBlcnJvciBhbmFseXNpcwoJICAgICAgICAJCSJyZXF1ZXN0VXJsIiA6IHVybCwKCSAgICAgICAgCQkiZGF0YSI6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RKU09OKSwKCSAgICAgICAgCQkiZXJyb3JSZWFzb24iOmUucmVzcG9uc2VUZXh0CgkgICAgICAgIH07CgkgICAgICAgIGxvY2FsU3RvcmFnZS5wcm9kdWN0TnVtYmVyQ29udmVyc2lvblNlcnZpY2VFcnJvciA9IEpTT04uc3RyaW5naWZ5KGVycm9yRGF0YSk7CgkgICAgICAgIAoJICAgICAgICBjYWxsYmFjayhwcm9kdWN0TnVtYmVyUmVxdWVzdCxyZXNwb25zZURhdGEpOwoJICAgIH0sCgkgICAgY29tcGxldGUgOiBmdW5jdGlvbihlKSB7CgkgICAgCSQoIiNjb252ZXJzaW9uR2lmU3Bpbm5lciIpLm1vZGFsKCJoaWRlIik7CgkgICAgfQogICAgfSk7Cn0KCmZ1bmN0aW9uIGdldFNTSURGb3JBc3NldENvbnYodHlwZSl7Cgl2YXIgc2VjdXJlVG9rZW5WYWwgPSAkKCcjc2VjdXJlVG9rZW5GaWVsZCcpLnZhbCgpOyAvL3JldHJpZXZlIHN0cmluZyBpbiB3aGljaCBrZXkgaXMgc3RvcmVkCgl2YXIgdG9rZW5JZDsKCWlmKHR5cGUgPT0gInByb2R1Y3QiKXsKCQl0b2tlbklkID0gICQoJyNzYW1zdW5nUHJvZHVjdEJ0bicpLmF0dHIoInRva2VuIik7CgkJaWYodG9rZW5JZCA9PSBudWxsKXsKCQkJdG9rZW5JZCA9ICAkKCcjaHBQcm9kdWN0QnRuJykuYXR0cigidG9rZW4iKTsKCQl9Cgl9CglpZih0eXBlID09ICJzZXJpYWwiKXsKCQl0b2tlbklkID0gICQoJyNzYW1zdW5nU2VyaWFsQnRuJykuYXR0cigidG9rZW4iKTsKCQlpZih0b2tlbklkID09IG51bGwpewoJCQl0b2tlbklkID0gICQoJyNocFNlcmlhbEJ0bicpLmF0dHIoInRva2VuIik7CgkJfQoJfQogICAgdmFyIHNzaWRWYWx1ZSA9ICIiOwogICAgaWYoc2VjdXJlVG9rZW5WYWwuaW5kZXhPZih0b2tlbklkKSE9LTEpeyAgLy9jaGVjayBpZiB0aGUgdG9rZW4ga2V5IGlzIHByZXNlbnQgaW4gdGhlIHN0cmluZyBvZiB0b2tlbnMKICAgICAgICAgICAgc3NpZFZhbHVlID0gSlNPTi5wYXJzZSgkKCIjc2VjdXJlRmllbGRKc29uIikudmFsKCkpOwogICAgfQogICAgcmV0dXJuIHNzaWRWYWx1ZVt0b2tlbklkXTsKfQoKCi8qKgogKiBDb252ZXJ0cyBIUCBzZXJpYWwgbnVtYmVyIHRvIFNhbXN1bmcKICogYW5kIHZpY2UtdmVyc2EgdXNpbmcgYW4gZXh0ZXJuYWwgc2VydmljZQogKgogKiBAYXV0aG9yIGJhZGFsLnNoYXJtYUBocC5jb20KICoKICovCmZ1bmN0aW9uIGNvbnZlcnRTZXJpYWxOdW1iZXIoc2VyaWFsTnVtYmVyUmVxdWVzdCwgY2FsbGJhY2spewoKCXZhciByZXNwb25zZURhdGEgPSB7fTsKCgkvLyBzZXQgdGhlIHJlcXVlc3Qgb2JqZWN0Cgl2YXIgcmVxdWVzdEpTT04gPSB7fTsKCXJlcXVlc3RKU09OLnNlcmlhbE51bWJlciA9IHNlcmlhbE51bWJlclJlcXVlc3Quc2VyaWFsTnVtYmVyOwoJcmVxdWVzdEpTT04uY2FwdGNoYVRva2VuID0gc2VyaWFsTnVtYmVyUmVxdWVzdC5jYXB0Y2hhUmVzcG9uc2U7CglyZXF1ZXN0SlNPTi5jYz1zZXJpYWxOdW1iZXJSZXF1ZXN0LmNjOwoJcmVxdWVzdEpTT04ubGM9c2VyaWFsTnVtYmVyUmVxdWVzdC5sYzsKCXZhciBzc2lkID0gZ2V0U1NJREZvckFzc2V0Q29udignc2VyaWFsJyk7Cgl2YXIgdXJsID0gIi9ocC1wcHMtc2VydmljZXMvYXNzZXQvY29udmVyc2lvbi9zZXJpYWxudW1iZXI/c3NpZD0iICsgc3NpZDsKCSQuYWpheCh7CiAgICAgIAl0eXBlOiAnUE9TVCcsCiAgICAgIAl1cmwgOiB1cmwsCiAgICAgIAlkYXRhVHlwZTonanNvbicsCiAgICAgIAlkYXRhOiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0SlNPTiksCiAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uKHhocikgewogICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICAgICAgJCgiI2NvbnZlcnNpb25HaWZTcGlubmVyIikubW9kYWwoInNob3ciKTsKICAgICAgICB9LAoJICAgIHN1Y2Nlc3MgOiBmdW5jdGlvbihkYXRhKSB7CgoJICAgIAkvLyBTZXQgSFBQTiBhbmQgRVBOIGluIGZpbmFsIHJlc3BvbnNlCgkgICAgCXJlc3BvbnNlRGF0YS5ocFNlcmlhbE51bWJlciA9IGRhdGEuaHBTZXJpYWxOdW1iZXI7CgkgICAgCXJlc3BvbnNlRGF0YS5lcXVpdmFsZW50U2VyaWFsTnVtYmVyID0gZGF0YS5lcXVpdmFsZW50U2VyaWFsTnVtYmVyOwoJICAgIAlyZXNwb25zZURhdGEuc3RhdHVzPWRhdGEuc3RhdHVzOwoJICAgIAlyZXNwb25zZURhdGEuc3RhdHVzTWVzc2FnZT1kYXRhLnN0YXR1c01lc3NhZ2U7CgkgICAgCWlmKChkYXRhLmVxdWl2YWxlbnRTZXJpYWxOdW1iZXIgIT0gbnVsbCAmJiBkYXRhLmVxdWl2YWxlbnRTZXJpYWxOdW1iZXIgIT0gJycpKXsKCgkgICAgCQkvLyBzZXQgbWF0Y2ggZm91bmQgYXMgdHJ1ZQoJICAgIAkJcmVzcG9uc2VEYXRhLmlzTWF0Y2hGb3VuZCA9IHRydWU7CgkgICAgCX1lbHNlIHsKCgkgICAgCQkvLyBubyBtYXRjaCBmb3VuZAoJICAgIAkJcmVzcG9uc2VEYXRhLmlzTWF0Y2hGb3VuZCA9IGZhbHNlOwoJICAgIAl9CgkgICAgCWNvbnNvbGUubG9nKHJlc3BvbnNlRGF0YSk7CgkgICAgCXBvcHVsYXRlU1NJRCgpOwoJICAgIAljYWxsYmFjayhzZXJpYWxOdW1iZXJSZXF1ZXN0LHJlc3BvbnNlRGF0YSk7CgkgICAgfSwKCSAgICBlcnJvciA6IGZ1bmN0aW9uKGUpIHsKCgkgICAgCXJlc3BvbnNlRGF0YS5lcnJvciA9ICdzZXJ2aWNlIGVycm9yJzsKCSAgICAgICAgY29uc29sZS5sb2coJ0VSUk9SOiAnLCBlKTsKCSAgICAgICAgY29uc29sZS5sb2coeGhyLnN0YXR1cyk7CgkgICAgICAgIHBvcHVsYXRlU1NJRCgpOwoJICAgICAgICB2YXIgZXJyb3JEYXRhID0gewkJLy9jcmVhdGluZyB0aGUganNvbiBvYmplY3QgYW5kIGFwcGVuZGluZyBzb3VyY2UgZm9yICBBTE0gMjg2NiA1MDAgZXJyb3IgYW5hbHlzaXMKCSAgICAgICAgCQkicmVxdWVzdFVybCIgOiB1cmwsCgkgICAgICAgIAkJImRhdGEiOiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0SlNPTiksCgkgICAgICAgIAkJImVycm9yUmVhc29uIjplLnJlc3BvbnNlVGV4dAoJICAgICAgICB9OwoJICAgICAgICBsb2NhbFN0b3JhZ2Uuc2VyaWFsTnVtYmVyQ29udmVyc2lvblNlcnZpY2VFcnJvciA9IEpTT04uc3RyaW5naWZ5KGVycm9yRGF0YSk7CgkgICAgICAgIAoJICAgICAgICBjYWxsYmFjayhzZXJpYWxOdW1iZXJSZXF1ZXN0LHJlc3BvbnNlRGF0YSk7CgkgICAgfSwKCSAgICBjb21wbGV0ZSA6IGZ1bmN0aW9uKGUpIHsKCSAgICAJJCgiI2NvbnZlcnNpb25HaWZTcGlubmVyIikubW9kYWwoImhpZGUiKTsKCSAgICB9CiAgICB9KTsKfQoKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7Ci8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gU01PIHdpdGggc3BsaXQgaHBpIGFuZCBocGUgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKIHBhaW50UEZpbmRlclJlc3VsdHNXaXRoU3BsaXQgPSBmdW5jdGlvbiAoanNvbkRhdGEsY2F0ZWdvcnlsaXN0aGVhZGluZykgewoJICAgIHZhciB0b3RhbFJlc0NvdW50ID0gMDsKCSAgICB2YXIgZ2xvYmFsTGVuZ3RoPTA7CgkgICAgdmFyIGxvY2FsTGVuZ3RoPTA7CgkgICAgdmFyIGNhdGVnb3JpZXNMZW5ndGggPSAwOwoJICAgIGlmICghKGpzb25EYXRhLnBmaW5kZXIubG9jYWwuY2F0ZWdvcmllc1swXSA9PSB1bmRlZmluZWQpKSB7CgkKCSAgICAgICAgdmFyIGxvY2FsQ2F0ZWdvcmllcyA9IGpzb25EYXRhLnBmaW5kZXIubG9jYWwuY2F0ZWdvcmllczsKCSAgICAgICAgdmFyIGNhdGVnb3J5U3RyaW5nID0gIiI7CgkgICAgICAgICAgICAgICAgCgkgICAgICAgICQuZWFjaChsb2NhbENhdGVnb3JpZXMsIGZ1bmN0aW9uKGluZGV4LCBvYmopIHsKCSAgICAgICAgICAgIGlmKGlzU1dEUGFnZSgpKXsKCSAgICAgICAgICAgICAgICAgY2F0ZWdvcnlTdHJpbmcgPSBjYXRlZ29yeVN0cmluZyArIGNyZWF0ZVNXRENhdGVnb3J5TGlzdFdpdGhTcGxpdChpbmRleCwgb2JqLGNhdGVnb3J5bGlzdGhlYWRpbmcpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZXsKCSAgICAgICAgICAgICAgICAgY2F0ZWdvcnlTdHJpbmcgPSBjYXRlZ29yeVN0cmluZyArIGNyZWF0ZUNhdGVnb3J5TGlzdFdpdGhTcGxpdChvYmosY2F0ZWdvcnlsaXN0aGVhZGluZyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgIAoJICAgICAgICAgICAgbG9jYWxMZW5ndGggPSBsb2NhbExlbmd0aCArIGdldFJlc3VsdENvdW50V2l0aFNwbGl0KG9iaik7CgkgICAgICAgIH0pOwoJICAgICAgICAKCSAgICAgICAgJCgiLmxvY2FsUmVzdWx0cyIpLmFwcGVuZChjYXRlZ29yeVN0cmluZyk7CgkgICAgICAgICQoIi5sb2NhbFJlc3VsdHNIb2xkZXIiKS50ZXh0KCIoIitsb2NhbExlbmd0aCsiKSIpOwoJICAgICAgICAkKCIubG9jYWxSZXN1bHRzIikuY3NzKCJkaXNwbGF5IiwiYmxvY2siKTsgICAgICAgCgkKCSAgICAgICAgaWYoaXNTV0RQYWdlKCkpewoJICAgICAgICAgICAgLy9vcGVuIHRoZSBmaXJzdCBkcm9wZG93biBpZiBsZW5ndGggPSAxCgkgICAgICAgICAgICBpZihsb2NhbENhdGVnb3JpZXMubGVuZ3RoPT0xKXsKCSAgICAgICAgICAgICAgICB2YXIgcGFuZWxBbmNob3IgPSAkKCcucEZpbmRlclJlc3VsdHMgLmhwLXNlY3Rpb24tbWQgLnBhbmVsLXRpdGxlIGEnKVswXTsKCSAgICAgICAgICAgICAgICB2YXIgcGFuZWxUaXRsZSA9ICQoJy5wRmluZGVyUmVzdWx0cyAuaHAtc2VjdGlvbi1tZCAucGFuZWwtdGl0bGUnKVswXTsKCSAgICAgICAgICAgICAgICB2YXIgcGFuZWxDb2xsYXBzZSA9ICQoJy5wRmluZGVyUmVzdWx0cyAuaHAtc2VjdGlvbi1tZCAucGFuZWwtY29sbGFwc2UnKVswXTsKCQoJCgkgICAgICAgICAgICAgICAgJChwYW5lbEFuY2hvcikuYWRkQ2xhc3MoJ3RvZ2dsZWQnKTsKCSAgICAgICAgICAgICAgICAkKHBhbmVsQW5jaG9yKS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwidHJ1ZSIpOwoJICAgICAgICAgICAgICAgICQocGFuZWxUaXRsZSkuYWRkQ2xhc3MoJ29wZW4nKTsKCSAgICAgICAgICAgICAgICAkKHBhbmVsQ29sbGFwc2UpLmFkZENsYXNzKCdpbicpLnJlbW92ZUF0dHIoJ3N0eWxlJyk7CgkKCSAgICAgICAgICAgIH0gICAgCgkgICAgICAgIH0KCSAgICAgICAgCgkgICAgICAgIAoJCgkgICAgfQoJCgkgICAgaWYgKCEoanNvbkRhdGEucGZpbmRlci53b3JsZHdpZGUuY2F0ZWdvcmllc1swXSA9PSB1bmRlZmluZWQpKSB7ICAgICAKCSAgICAgICAgdmFyIGdsb2JhbENhdGVnb3JpZXMgPSBqc29uRGF0YS5wZmluZGVyLndvcmxkd2lkZS5jYXRlZ29yaWVzOwoJICAgICAgICB2YXIgY2F0ZWdvcnlTdHJpbmcgPSAiIjsKCQoJICAgICAgICAkLmVhY2goZ2xvYmFsQ2F0ZWdvcmllcywgZnVuY3Rpb24oaW5kZXgsIG9iaikgewoJICAgICAgICAgICAgY2F0ZWdvcnlTdHJpbmcgPSBjYXRlZ29yeVN0cmluZyArIGNyZWF0ZUNhdGVnb3J5TGlzdChvYmopOwoJICAgICAgICAgICAgZ2xvYmFsTGVuZ3RoID0gZ2xvYmFsTGVuZ3RoICsgZ2V0UmVzdWx0Q291bnQob2JqKTsKCSAgICAgICAgfSk7CgkgICAgICAgICQoIi5nbG9iYWxSZXN1bHRzIikuYXBwZW5kKGNhdGVnb3J5U3RyaW5nKTsKCSAgICAgICAgJCgiLmdsb2JhbFJlc3VsdHNIb2xkZXIiKS50ZXh0KCIoIitnbG9iYWxMZW5ndGgrIikiKTsKCSAgICAgICAgJCgiLmdsb2JhbFJlc3VsdHMiKS5jc3MoImRpc3BsYXkiLCJibG9jayIpOyAgICAgCgkgICAgfQoJICAgIAoJICAgIGNhdGVnb3JpZXNMZW5ndGggPSBqc29uRGF0YS5wZmluZGVyLndvcmxkd2lkZS5jYXRlZ29yaWVzLmxlbmd0aCArIGpzb25EYXRhLnBmaW5kZXIubG9jYWwuY2F0ZWdvcmllcy5sZW5ndGggOwoJICAgIAoJICAgIGlmKGNhdGVnb3JpZXNMZW5ndGggPT0gMSl7CgkgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkgICAgICAgICQoIi5ocC1leHBhbmQtY29sYXBzZSIpLnRyaWdnZXIoImNsaWNrIik7CgkgICAgICAgIH0sMTAwKTsKCSAgICB9CgkgICAgCgkgICAgdG90YWxSZXNDb3VudCA9IGdsb2JhbExlbmd0aCArIGxvY2FsTGVuZ3RoOwoJICAgICQoIi50b3RhbFJlc0NvdW50SG9sZGVyIikudGV4dCgiKCIrdG90YWxSZXNDb3VudCsiKSIpOwoJfTsKCiAKIGNyZWF0ZUNhdGVnb3J5TGlzdFdpdGhTcGxpdCA9IGZ1bmN0aW9uKGNhdGVnb3JpZXMsY2F0ZWdvcnlsaXN0aGVhZGluZykgewogICAgdmFyIGJ1aWx0U3RyaW5nOwogICAgdmFyIHByb2R1Y3RzTGVuZ3RoID0gZ2V0UmVzdWx0Q291bnRXaXRoU3BsaXQoY2F0ZWdvcmllcyk7CiAgICBidWlsdFN0cmluZyA9ICI8ZGl2IGNsYXNzPVwicEZpbmRlckNhdGVnb3J5XCI+PGRpdiBjbGFzcz1cImhwLWV4cGFuZGFibGUtd3JhcHBlclwiPlwKICAgIDxhIGNsYXNzPVwiaHAtZXhwYW5kLWNvbGFwc2UgcnRsVGV4dFdyYXBwZXJcIj48c3BhbiBjbGFzcz1cImxpbmtUZXh0IFwiPjxzcGFuIGNsYXNzPVwiIHJ0bEFsaWduVGV4dCBcIj4iCiAgICAgICAgKyBjYXRlZ29yaWVzLmNhdGVnb3J5Lm5hbWUgKyAiPC9zcGFuPjxzcGFuIGNsYXNzPVwicnRsQWxpZ25UZXh0XCI+ICgiKyBwcm9kdWN0c0xlbmd0aCArIilcCiAgICA8L3NwYW4+PC9zcGFuPjxzcGFuIGNsYXNzPVwiZXhwYW5kSWNvblwiPjwvc3Bhbj48L2E+XAogICAgPGRpdiBjbGFzcz1cImhwLWV4cGFuZGFibGUtc2VjdGlvblwiPjx1bCBjbGFzcz1cIiBsaXN0LXdyYXBwZXJcIj4iOwogICAgCiAgICBpZighKHR5cGVvZiBjYXRlZ29yaWVzLmNhdGVnb3J5WzBdICE9PSAndW5kZWZpbmVkJyAmJiAoY2F0ZWdvcmllcy5jYXRlZ29yeVswXSE9PSBudWxsKSkpeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgdmFyIGhwZVN0cmluZyA9ICIiOwogICAgICAgIHZhciBocGlTdHJpbmcgPSAiIjsKICAgICAgICBmb3IodmFyIGtleSBpbiBjYXRlZ29yaWVzLmNhdGVnb3J5KSAgICAgIAogICAgICAgIHsKICAgICAgICAgICAgdmFyIHZhbD0gY2F0ZWdvcmllcy5jYXRlZ29yeVtrZXldOwogICAgICAgICAgICAgaWYoa2V5PT0iaHBpUHJvZHVjdHMiICYmIHZhbC5sZW5ndGg+MCl7CiAgICAgICAgICAgIAkgaHBpU3RyaW5nICs9ICBvdGhlclByb2R1Y3RzKCIiLHZhbCxrZXksY2F0ZWdvcnlsaXN0aGVhZGluZyk7LypzZW5kaW5nIGEgbnVsbCBzdHJpbmcgdG8gb3RoZXIgcHJvZHVjdHMgYXMgaXQgaXMgYmVpbmcgYXBwZW5kZWQgb24gcmV0dXJuKi8KICAgICAgICAgICAgfQogICAgICAgICAgICAgZWxzZSBpZihrZXk9PSJocGVQcm9kdWN0cyImJiB2YWwubGVuZ3RoPjApewogICAgICAgICAgICAJIGhwZVN0cmluZyArPSAgb3RoZXJQcm9kdWN0cygiIix2YWwsa2V5LGNhdGVnb3J5bGlzdGhlYWRpbmcpOyAKICAgICAgICAgICAgICAgfSAgICAKICAgICAgICB9CgogICAgICAgIGJ1aWx0U3RyaW5nICs9IGhwaVN0cmluZytocGVTdHJpbmcgKyAnICAgICAgICAgICAgPC91bD4nKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JysKICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2Pic7CiAgICAgICAgcmV0dXJuIGJ1aWx0U3RyaW5nOwogICAgCiAgICB9CgogfTsKCiBjcmVhdGVTV0RDYXRlZ29yeUxpc3RXaXRoU3BsaXQgPSBmdW5jdGlvbihpbmRleCwgY2F0ZWdvcmllcyxjYXRlZ29yeWxpc3RoZWFkaW5nKXsKCiAgICB2YXIgYnVpbHRTdHJpbmc7CiAgICB2YXIgcHJvZHVjdHNMZW5ndGggPSBnZXRSZXN1bHRDb3VudFdpdGhTcGxpdChjYXRlZ29yaWVzKTsKCiAgICBidWlsdFN0cmluZyA9ICc8ZGl2IGNsYXNzPSJwYW5lbCI+JysKICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJwYW5lbC1oZWFkaW5nIj4nKwogICAgICAgICAgICAgICAgICAgICAgICAnPGg0IGNsYXNzPSJwYW5lbC10aXRsZSI+JysKICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgYXJpYS1leHBhbmRlZD0iZmFsc2UiIGRhdGEtdG9nZ2xlPSJjb2xsYXBzZSIgaHJlZj0iI3BmaW5kZXJBY2NvcmRpYW4nK2luZGV4KyciIGNsYXNzPSIiPicgKyBjYXRlZ29yaWVzLmNhdGVnb3J5Lm5hbWUgICsnIDxzcGFuIGNsYXNzPSJjb3VudCI+KCcrcHJvZHVjdHNMZW5ndGgrJyk8L3NwYW4+PC9hPicrCiAgICAgICAgICAgICAgICAgICAgICAgICc8L2g0PicrCiAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JysKCiAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBpZD0icGZpbmRlckFjY29yZGlhbicraW5kZXgrJyIgY2xhc3M9InBhbmVsLWNvbGxhcHNlIGNvbGxhcHNlIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPicrCiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJwYW5lbC1ib2R5Ij4nKwogICAgICAgICAgICAgICAgICAgICAgICAgICc8dWw+JzsKCiAgICBpZighKHR5cGVvZiBjYXRlZ29yaWVzLmNhdGVnb3J5WzBdICE9PSAndW5kZWZpbmVkJyAmJiAoY2F0ZWdvcmllcy5jYXRlZ29yeVswXSE9PSBudWxsKSkpeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAJIHZhciBocGVTdHJpbmcgPSAiIjsKICAgICAgICAgdmFyIGhwaVN0cmluZyA9ICIiOwogICAgICAgIGZvcih2YXIga2V5IGluIGNhdGVnb3JpZXMuY2F0ZWdvcnkpICAgICAgCiAgICAgICAgewogICAgICAgICAgICB2YXIgdmFsPSBjYXRlZ29yaWVzLmNhdGVnb3J5W2tleV07CiAgICAgICAgICAgICBpZihrZXk9PSJocGlQcm9kdWN0cyIgJiYgdmFsLmxlbmd0aD4wKXsKICAgICAgICAgICAgCSBocGlTdHJpbmcgKz0gIG90aGVyUHJvZHVjdHMoIiIsdmFsLGtleSxjYXRlZ29yeWxpc3RoZWFkaW5nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAgZWxzZSBpZihrZXk9PSJocGVQcm9kdWN0cyImJiB2YWwubGVuZ3RoPjApewogICAgICAgICAgICAJIGhwZVN0cmluZyArPSAgb3RoZXJQcm9kdWN0cygiIix2YWwsa2V5LGNhdGVnb3J5bGlzdGhlYWRpbmcpOyAKICAgICAgICAgICAgICAgfSAgICAKICAgICAgICB9CgogICAgICAgIGJ1aWx0U3RyaW5nICs9IGhwaVN0cmluZytocGVTdHJpbmcgKyAnICAgICAgICAgICAgPC91bD4nKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JysKICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2Pic7CiAgICAgICAgcmV0dXJuIGJ1aWx0U3RyaW5nOwogICAgCiAgICB9Cgp9OwoKIGdldFJlc3VsdENvdW50V2l0aFNwbGl0ID0gZnVuY3Rpb24oY2F0ZWdvcmllcyl7CiAgICB2YXIgbGVuPSBjYXRlZ29yaWVzLmNhdGVnb3J5LmhwaVByb2R1Y3RzLmxlbmd0aCArIGNhdGVnb3JpZXMuY2F0ZWdvcnkuaHBlUHJvZHVjdHMubGVuZ3RoOwogICAgcmV0dXJuIGxlbjsKIH07Cgogb3RoZXJQcm9kdWN0cyA9IGZ1bmN0aW9uKGFjY3JvZGlhbnN0cmluZyx2YWwscHJvZHVjdFR5cGUsY2F0ZWdvcnlsaXN0aGVhZGluZyl7CiAgICBpZihwcm9kdWN0VHlwZT09ImhwaVByb2R1Y3RzIikKICAgIHsKICAgICAgICBhY2Nyb2RpYW5zdHJpbmcgKz0gIjxsaT48aDQgY2xhc3M9J2g0Zm9udCc+IitjYXRlZ29yeWxpc3RoZWFkaW5nLmhwaVByb2R1Y3RzKyI8L2g0PjwvbGk+IjsKICAgIH0KICAgIGVsc2UgaWYocHJvZHVjdFR5cGU9PSJocGVQcm9kdWN0cyIpIHsKICAgICAgICBhY2Nyb2RpYW5zdHJpbmcgKz0gIjxsaT48aDQgY2xhc3M9J2g0Zm9udCc+IitjYXRlZ29yeWxpc3RoZWFkaW5nLmhwZVByb2R1Y3RzKyI8L2g0PjwvbGk+IjsKICAgIH0KCiAgICAgJC5lYWNoKHZhbCwgZnVuY3Rpb24oaW5kZXgsIG9iaikgewogICAgICBhY2Nyb2RpYW5zdHJpbmcgKz0gIjxsaT48YSBocmVmPSciICsgb2JqLnByb2R1Y3QudXJsICsgIic+IiArIG9iai5wcm9kdWN0LnByb2R1Y3ROYW1lICsgIjwvYT48L2xpPiIKICAgIH0pOwoKICAgIHJldHVybiBhY2Nyb2RpYW5zdHJpbmc7IAogfTsKCgovKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIGVuZCBTTU8gd2l0aCBzcGxpdCBocGkgYW5kIGhwZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgoKLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBvbGQgc3RydWN0dXJlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiBwYWludFBGaW5kZXJSZXN1bHRzID0gZnVuY3Rpb24oanNvbkRhdGEpIHsKCXZhciB0b3RhbFJlc0NvdW50ID0gMDsKCXZhciBnbG9iYWxMZW5ndGg9MDsKCXZhciBsb2NhbExlbmd0aD0wOwoJdmFyIGNhdGVnb3JpZXNMZW5ndGggPSAwOwogICAgaWYgKCEoanNvbkRhdGEucGZpbmRlci5sb2NhbC5jYXRlZ29yaWVzWzBdID09IHVuZGVmaW5lZCkpIHsKCiAgICAgICAgdmFyIGxvY2FsQ2F0ZWdvcmllcyA9IGpzb25EYXRhLnBmaW5kZXIubG9jYWwuY2F0ZWdvcmllczsKICAgICAgICB2YXIgY2F0ZWdvcnlTdHJpbmcgPSAiIjsKICAgICAgICAgICAgICAgIAogICAgICAgICQuZWFjaChsb2NhbENhdGVnb3JpZXMsIGZ1bmN0aW9uKGluZGV4LCBvYmopIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vVVMgNTI0NzogYWx3YXlzIGNyZWF0ZSB0aGUgU1dEIGV4cGVyaWVuY2UgLSBISAogICAgICAgICAgICBjYXRlZ29yeVN0cmluZyA9IGNhdGVnb3J5U3RyaW5nICsgY3JlYXRlU1dEQ2F0ZWdvcnlMaXN0KGluZGV4LCBvYmopOwogICAgICAgICAgIAogICAgICAgICAgICBsb2NhbExlbmd0aCA9IGxvY2FsTGVuZ3RoICsgZ2V0UmVzdWx0Q291bnQob2JqKTsKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICAkKCIubG9jYWxSZXN1bHRzIikuYXBwZW5kKGNhdGVnb3J5U3RyaW5nKTsKICAgICAgICAkKCIubG9jYWxSZXN1bHRzSG9sZGVyIikudGV4dCgiKCIrbG9jYWxMZW5ndGgrIikiKTsKICAgICAgICAkKCIubG9jYWxSZXN1bHRzIikuY3NzKCJkaXNwbGF5IiwiYmxvY2siKTsgICAgICAgCgogICAgICAgIC8vVVMgNTI0NzogYWx3YXlzIGNyZWF0ZSB0aGUgU1dEIGV4cGVyaWVuY2UgLSBISAogICAgICAgIC8vcmVtb3ZlZCB0aGUgaWYoU1dEUGFnZSkgY29uZGl0aW9uCiAgICAgICAgICAgIC8vb3BlbiB0aGUgZmlyc3QgZHJvcGRvd24gaWYgbGVuZ3RoID0gMQogICAgICAgICAgICBpZihsb2NhbENhdGVnb3JpZXMubGVuZ3RoPT0xKXsKICAgICAgICAgICAgICAgIHZhciBwYW5lbEFuY2hvciA9ICQoJy5wRmluZGVyUmVzdWx0cyAuaHAtc2VjdGlvbiAucGFuZWwtdGl0bGUgYScpWzBdOwogICAgICAgICAgICAgICAgdmFyIHBhbmVsVGl0bGUgPSAkKCcucEZpbmRlclJlc3VsdHMgLmhwLXNlY3Rpb24gLnBhbmVsLXRpdGxlJylbMF07CiAgICAgICAgICAgICAgICB2YXIgcGFuZWxDb2xsYXBzZSA9ICQoJy5wRmluZGVyUmVzdWx0cyAuaHAtc2VjdGlvbiAucGFuZWwtY29sbGFwc2UnKVswXTsKCgogICAgICAgICAgICAgICAgJChwYW5lbEFuY2hvcikuYWRkQ2xhc3MoJ3RvZ2dsZWQnKTsKICAgICAgICAgICAgICAgICQocGFuZWxBbmNob3IpLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCJ0cnVlIik7CiAgICAgICAgICAgICAgICAkKHBhbmVsVGl0bGUpLmFkZENsYXNzKCdvcGVuJyk7CiAgICAgICAgICAgICAgICAkKHBhbmVsQ29sbGFwc2UpLmFkZENsYXNzKCdpbicpLnJlbW92ZUF0dHIoJ3N0eWxlJyk7CgogICAgICAgICAgICB9ICAgIAogICAgICAgIAogICAgICAgIAogICAgICAgIAoKICAgIH0KCiAgICBpZiAoIShqc29uRGF0YS5wZmluZGVyLndvcmxkd2lkZS5jYXRlZ29yaWVzWzBdID09IHVuZGVmaW5lZCkpIHsgIAkKICAgICAgICB2YXIgZ2xvYmFsQ2F0ZWdvcmllcyA9IGpzb25EYXRhLnBmaW5kZXIud29ybGR3aWRlLmNhdGVnb3JpZXM7CiAgICAgICAgdmFyIGNhdGVnb3J5U3RyaW5nID0gIiI7CgogICAgICAgICQuZWFjaChnbG9iYWxDYXRlZ29yaWVzLCBmdW5jdGlvbihpbmRleCwgb2JqKSB7CiAgICAgICAgICAgIGNhdGVnb3J5U3RyaW5nID0gY2F0ZWdvcnlTdHJpbmcgKyBjcmVhdGVDYXRlZ29yeUxpc3Qob2JqKTsKICAgICAgICAgICAgZ2xvYmFsTGVuZ3RoID0gZ2xvYmFsTGVuZ3RoICsgZ2V0UmVzdWx0Q291bnQob2JqKTsKICAgICAgICB9KTsKICAgICAgICAkKCIuZ2xvYmFsUmVzdWx0cyIpLmFwcGVuZChjYXRlZ29yeVN0cmluZyk7CiAgICAgICAgJCgiLmdsb2JhbFJlc3VsdHNIb2xkZXIiKS50ZXh0KCIoIitnbG9iYWxMZW5ndGgrIikiKTsKICAgICAgICAkKCIuZ2xvYmFsUmVzdWx0cyIpLmNzcygiZGlzcGxheSIsImJsb2NrIik7ICAgICAKICAgIH0KICAgIAogICAgY2F0ZWdvcmllc0xlbmd0aCA9IGpzb25EYXRhLnBmaW5kZXIud29ybGR3aWRlLmNhdGVnb3JpZXMubGVuZ3RoICsganNvbkRhdGEucGZpbmRlci5sb2NhbC5jYXRlZ29yaWVzLmxlbmd0aCA7CiAgICAKICAgIGlmKGNhdGVnb3JpZXNMZW5ndGggPT0gMSl7CiAgICAJc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgIAkkKCIuaHAtZXhwYW5kLWNvbGFwc2UiKS50cmlnZ2VyKCJjbGljayIpOwogICAgCX0sMTAwKTsKICAgIH0KICAgIAogICAgdG90YWxSZXNDb3VudCA9IGdsb2JhbExlbmd0aCArIGxvY2FsTGVuZ3RoOwogICAgJCgiLnRvdGFsUmVzQ291bnRIb2xkZXIiKS50ZXh0KCIoIit0b3RhbFJlc0NvdW50KyIpIik7Cn0KCmZ1bmN0aW9uIGNyZWF0ZUNhdGVnb3J5TGlzdChjYXRlZ29yaWVzKSB7CiAgICB2YXIgYnVpbHRTdHJpbmc7CiAgICB2YXIgcHJvZHVjdHNMZW5ndGggPSBnZXRSZXN1bHRDb3VudChjYXRlZ29yaWVzKTsKICAgIGJ1aWx0U3RyaW5nID0gIjxkaXYgY2xhc3M9XCJwRmluZGVyQ2F0ZWdvcnlcIj48ZGl2IGNsYXNzPVwiaHAtZXhwYW5kYWJsZS13cmFwcGVyXCI+XAogICAgPGEgY2xhc3M9XCJocC1leHBhbmQtY29sYXBzZSBydGxUZXh0V3JhcHBlclwiPjxzcGFuIGNsYXNzPVwibGlua1RleHQgXCI+PHNwYW4gY2xhc3M9XCIgcnRsQWxpZ25UZXh0IFwiPiIKICAgICAgICArIGNhdGVnb3JpZXMuY2F0ZWdvcnkubmFtZSArICI8L3NwYW4+PHNwYW4gY2xhc3M9XCJydGxBbGlnblRleHRcIj4gKCIrIHByb2R1Y3RzTGVuZ3RoICsiKVwKICAgIDwvc3Bhbj48L3NwYW4+PHNwYW4gY2xhc3M9XCJleHBhbmRJY29uXCI+PC9zcGFuPjwvYT5cCiAgICA8ZGl2IGNsYXNzPVwiaHAtZXhwYW5kYWJsZS1zZWN0aW9uXCI+PHVsIGNsYXNzPVwiIGxpc3Qtd3JhcHBlclwiPiI7CiAgICB2YXIgcHJvZHVjdHNJbkNhdGVnb3J5ID0gY2F0ZWdvcmllcy5jYXRlZ29yeS5wcm9kdWN0czsKICAgICQuZWFjaChwcm9kdWN0c0luQ2F0ZWdvcnksIGZ1bmN0aW9uKGluZGV4LCBvYmopIHsKICAgICAgICBidWlsdFN0cmluZyArPSAiPGxpPjxhIGhyZWY9JyIgKyBvYmoucHJvZHVjdC51cmwgKyAiJz4iICsgb2JqLnByb2R1Y3QucHJvZHVjdE5hbWUgKyAiPC9hPjwvbGk+IgogICAgfSk7CgogICAgYnVpbHRTdHJpbmcgKz0gIjwvdWw+PC9kaXY+PC9kaXY+PC9kaXY+IgogICAgcmV0dXJuIGJ1aWx0U3RyaW5nOwp9CgoKZnVuY3Rpb24gY3JlYXRlU1dEQ2F0ZWdvcnlMaXN0KGluZGV4LCBjYXRlZ29yaWVzKXsKCiAgICB2YXIgYnVpbHRTdHJpbmc7CiAgICB2YXIgcHJvZHVjdHNMZW5ndGggPSBnZXRSZXN1bHRDb3VudChjYXRlZ29yaWVzKTsKCiAgICBidWlsdFN0cmluZyA9ICc8ZGl2IGNsYXNzPSJwYW5lbCI+JysKICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJwYW5lbC1oZWFkaW5nIj4nKwogICAgICAgICAgICAgICAgICAgICAgICAnPGg0IGNsYXNzPSJwYW5lbC10aXRsZSI+JysKICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgZGF0YS10b2dnbGU9ImNvbGxhcHNlIiBocmVmPSIjcGZpbmRlckFjY29yZGlhbicraW5kZXgrJyIgY2xhc3M9IiI+JyArIGNhdGVnb3JpZXMuY2F0ZWdvcnkubmFtZSAgKycgPHNwYW4gY2xhc3M9ImNvdW50Ij4oJytwcm9kdWN0c0xlbmd0aCsnKTwvc3Bhbj48L2E+JysKICAgICAgICAgICAgICAgICAgICAgICAgJzwvaDQ+JysKICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nKwoKICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGlkPSJwZmluZGVyQWNjb3JkaWFuJytpbmRleCsnIiBjbGFzcz0icGFuZWwtY29sbGFwc2UgY29sbGFwc2UiIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+JysKICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9InBhbmVsLWJvZHkiPicrCiAgICAgICAgICAgICAgICAgICAgICAgICAgJzx1bD4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgdmFyIHByb2R1Y3RzSW5DYXRlZ29yeSA9IGNhdGVnb3JpZXMuY2F0ZWdvcnkucHJvZHVjdHM7CiAgICAkLmVhY2gocHJvZHVjdHNJbkNhdGVnb3J5LCBmdW5jdGlvbihpbmRleCwgb2JqKSB7CiAgICAgICAgYnVpbHRTdHJpbmcgKz0gIjxsaT48YSBocmVmPSciICsgb2JqLnByb2R1Y3QudXJsICsgIic+IiArIG9iai5wcm9kdWN0LnByb2R1Y3ROYW1lICsgIjwvYT48L2xpPiIKICAgIH0pOwoKICAgIGJ1aWx0U3RyaW5nICs9ICcgICAgICAgICAgICA8L3VsPicrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JysKICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JysKICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JzsKICAgIHJldHVybiBidWlsdFN0cmluZzsKCgoKfQoKZnVuY3Rpb24gZ2V0UmVzdWx0Q291bnQoY2F0ZWdvcmllcyl7CiAgICByZXR1cm4gY2F0ZWdvcmllcy5jYXRlZ29yeS5wcm9kdWN0cy5sZW5ndGg7Cn0KCgpwRmluZGVyUmVzdWx0Q2xpY2sgPSBmdW5jdGlvbihwT2lkKXsKLy9vbiBjbGljayBvZiBjZXJ0YWluIHBmaW5kZXIgcmVzdWx0cyBwb3B1bGF0ZSB0aGUgdmFsdWUgaW4gYSBmb3JtIGFuZCBzdWJtaXQgaXQgaW5zdGVhZCBvZiByZWRpcmVjdGluZyBkaXJlY3RseQogICAgaWYoJCgnI3BGaW5kZXJDbGlja0Zvcm0nKS5sZW5ndGg+MCl7ICAgICAgICAKICAgICAgICAkKCcjcEZpbmRlckNsaWNrUE9pZCcpLmF0dHIoJ3ZhbHVlJyxwT2lkKTsKICAgICAgICAkKCcjcEZpbmRlckNsaWNrRm9ybScpLnN1Ym1pdCgpOwoKICAgIH0KICAgIAp9CgoKZnVuY3Rpb24gaXNTV0RQYWdlKCl7CgogICAgcmV0dXJuIHRydWU7Ci8qICAgIHZhciBwYWdlTmFtZSA9ICQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpCgogICAgaWYocGFnZU5hbWUuaW5kZXhPZignU1dEJyk9PTApewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZWxzZXsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Ki8KCgp9Cn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ey8qDQokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsNCiAgICBhdXRvY29tcGxldGVTUigpOw0KDQp9KTsNCg0KZnVuY3Rpb24gYXV0b2NvbXBsZXRlU1IoKSB7DQoNCiAgICAkLmFqYXgoew0KICAgICAgICB0eXBlOiAnUE9TVCcsDQogICAgICAgIHVybDogImpzL3NlYXJjaFJlc3VsdC5qc29uIiwNCiAgICAgICAgZGF0YVR5cGU6ICdKU09OJywNCiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0cykgew0KICAgICAgICAgICAgcGFpbnRTZWFyY2hSZXN1bHRzKHJlc3VsdHMpOw0KICAgICAgICB9LA0KICAgICAgICBlcnJvcjogZnVuY3Rpb24oeG1sLCBzdGF0dXMsIGVycm9yKSB7DQogICAgICAgICAgICAvLyQoIi5oYXNUeXBlYWhlYWQgLnNlYXJjaGluZyIpLmhpZGUoKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICANCn0qLw0KDQpmdW5jdGlvbiBwYWludFNlYXJjaFJlc3VsdHMoanNvbkRhdGEpIHsNCiAgICBKc29uRGF0YTIgPSBqc29uRGF0YTsNCiAgICANCiAgICBpZiAoIShqc29uRGF0YS5zZWFyY2hSZXN1bHRPYmpBcnIgPT0gdW5kZWZpbmVkKSkgew0KDQogICAgICAgIHZhciBzZWFyY2hSZXN1bHRzID0ganNvbkRhdGEuc2VhcmNoUmVzdWx0T2JqQXJyOw0KICAgICAgICB2YXIgc2VhcmNoUmVzdWx0TWFya3VwU3RyaW5nID0gIiI7DQogICAgICAgIHZhciBzZWFyY2hSZXN1bHRzUHJvbW90aW9uID0gIiI7DQogICAgICAgIHZhciBzZWFyY2hSZXN1bHRzT3JnYW5pYyA9ICIiOw0KDQoNCiAgICAgICAgJC5lYWNoKHNlYXJjaFJlc3VsdHMsIGZ1bmN0aW9uKGluZGV4LCBvYmopIHsNCiAgICAgICAgCXZhciByZXN1bHRPYmogPSBvYmouc2VhcmNoUmVzdWx0Ow0KICAgIAkJaWYoKHR5cGVvZihyZXN1bHRPYmouc2VhcmNoSWQpID09ICJ1bmRlZmluZWQiKSAmJiAodHlwZW9mKHJlc3VsdE9iai5zZWFyY2hUeXBlKSA9PSAidW5kZWZpbmVkIikpew0KICAgIAkJCXNlYXJjaFJlc3VsdHNPcmdhbmljID0gc2VhcmNoUmVzdWx0c09yZ2FuaWMgKyBjcmVhdGVTZWFyY2hSZXN1bHRNYXJrdXAob2JqKTsNCiAgICAJCX0NCiAgICAJCWVsc2UgaWYoKHR5cGVvZihyZXN1bHRPYmouc2VhcmNoSWQpID09ICJ1bmRlZmluZWQiKSAmJiAodHlwZW9mKHJlc3VsdE9iai5zZWFyY2hUeXBlKSAhPSAidW5kZWZpbmVkIikNCiAgICAJCSYmIChyZXN1bHRPYmouc2VhcmNoVHlwZT09InByb21vdGlvbiIpKXsNCiAgICAJCQlzZWFyY2hSZXN1bHRzUHJvbW90aW9uID0gc2VhcmNoUmVzdWx0c1Byb21vdGlvbiArIGNyZWF0ZVNlYXJjaFJlc3VsdE1hcmt1cChvYmopOw0KICAgIAkJfQ0KICAgIAkJZWxzZXsNCiAgICAJCQlzZWFyY2hSZXN1bHRzUHJvbW90aW9uID0gc2VhcmNoUmVzdWx0c1Byb21vdGlvbiArIGNyZWF0ZVNlYXJjaFJlc3VsdE1hcmt1cChvYmopOw0KICAgIAkJfQ0KDQogICAgICAgICAgICAvLyBzZWFyY2hSZXN1bHRNYXJrdXBTdHJpbmcgPSBzZWFyY2hSZXN1bHRNYXJrdXBTdHJpbmcgKyBjcmVhdGVTZWFyY2hSZXN1bHRNYXJrdXAob2JqKTsNCiAgICAgICAgfSk7DQogICAgICAgIGlmKHByb21vSWRzQXJyLmxlbmd0aCAhPSAwKXsNCiAgICAgICAgCWdsb2JhbERhdGFMYXllci5TZWFyY2guUHJvbW90aW9uSWRzID0gcHJvbW9JZHNBcnI7DQogICAgICAgIH0NCiAgICAgICAgc2VhcmNoUmVzdWx0TWFya3VwU3RyaW5nID0gIjxkaXYgY2xhc3M9J3Byb21vdGlvblJlc3VsdHNDb250YWluZXInPiIrc2VhcmNoUmVzdWx0c1Byb21vdGlvbisiPC9kaXY+PGRpdiBjbGFzcz0nb3JnYW5pY1Jlc3VsdHNDb250YWluZXInPiIrc2VhcmNoUmVzdWx0c09yZ2FuaWMrIjwvZGl2PiI7DQogICAgICAgIC8vY29uc29sZS5sb2coInNlYXJjaCBTdHJpbmc6ICIrc2VhcmNoUmVzdWx0TWFya3VwU3RyaW5nKTsNCiAgICAgICAgJCgiI3NlYXJjaFJlc3VsdHNXcmFwcGVyIikuYXBwZW5kKHNlYXJjaFJlc3VsdE1hcmt1cFN0cmluZyk7DQogICAgICAgICQoIi5zZWFyY2gtcmVzdWx0Om5vdCg6bGFzdCkiKS5hZnRlcigiPGhyIGNsYXNzPVwicmVzdWx0cy1oclwiIC8+Iik7DQogICAgICAgIA0KICAgIH0NCiAgICANCiAgICAvLyBFeHRlcm5hbCBMaW5rIEltYWdlIGZvciBTZWFyY2ggUmVzdWx0IFBhZ2UNCiAgICAvLyBhZGQgZXh0ZXJuYWwgaW1hZ2Ugc3ltYm9sIGlmIG5lZWRlZAkJDQoJJCgnLnNlYXJjaC1yZXN1bHQgYScpLmVhY2goZnVuY3Rpb24gKCkgew0KCQkNCgkJLy8gInRoaXMiIGlzIHRoZSBjdXJyZW50IGVsZW1lbnQgaW4gdGhlIGxvb3ANCgkJdmFyIGxpbmsgPSB0aGlzLmhyZWY7IA0KCQkNCgkJLy8gaW50ZXJuYWwgc2l0ZSByZWdleA0KCQlpZihsaW5rLmluZGV4T2YoImhwaWNvcnAubmV0Iik+IC0xKXsJCQkJCQkJLy8gZml4IGZvciBidWcgOTg1OTcNCgkJICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAoIihbXHcwLTkuXzovLV0raHBpY29ycC5uZXQoLiopKSIpOwkJLy9yZWdleCBmb3IgbG93ZXIgZW52aXJvbm1lbnRzDQoJCX1lbHNlIGlmKGxpbmsuaW5kZXhPZigiYW1hem9uYXdzLmNvbSIpPiAtMSkNCgkJew0KCQkgICAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cCgiKFtcdzAtOS5fOi8tXSthbWF6b25hd3MuY29tKC4qKSkiKTsNCgkJfWVsc2UgaWYobGluay5pbmRleE9mKCJjbG91ZGZyb250Lm5ldCIpPiAtMSkNCgkJew0KCQkJLy9BZGRlZCBjb25kaXRpb24gZm9yIGdyb29tZWQgc2RsIHBkZiB1cmwNCgkJICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAoIihbXHcwLTkuXzovLV0rY2xvdWRmcm9udC5uZXQoLiopKSIpOw0KCQl9ZWxzZXsNCgkJCXZhciByZWdleCA9IG5ldyBSZWdFeHAoIihbXHcwLTkuXzovLV0raHAuY29tKC4qKSkiKTsNCgkJfQ0KDQoJCWlmKGxpbmsuaW5kZXhPZignaHR0cCcpID4gLTEgJiYgIXJlZ2V4LnRlc3QobGluaykpew0KCQkJJCh0aGlzKS5hcHBlbmQoJyA8aSBjbGFzcz0iaWNvbi1leHRlcm5hbC1saW5rIj48L2k+Jyk7DQoJCX0NCgl9KTsNCg0KfQ0KDQp2YXIgcHJvbW9JZHNBcnIgPSBbXTsNCmZ1bmN0aW9uIGNyZWF0ZVNlYXJjaFJlc3VsdE1hcmt1cChzZWFyY2hSZXN1bHRzT2JqKSB7DQogICAgdmFyIGJ1aWx0U3RyaW5nOw0KICAgIHZhciByZXN1bHRPYmogPSBzZWFyY2hSZXN1bHRzT2JqLnNlYXJjaFJlc3VsdDsNCiAgICBjb25zb2xlLmxvZyhyZXN1bHRPYmopOw0KICAgIGlmKCh0eXBlb2YocmVzdWx0T2JqLnNlYXJjaElkKSA9PSAidW5kZWZpbmVkIikgJiYgKHR5cGVvZihyZXN1bHRPYmouc2VhcmNoVHlwZSkgPT0gInVuZGVmaW5lZCIpKXsNCiAgICAJdmFyIFVybD0gcmVzdWx0T2JqLnNlYXJjaFVSTDsNCiAgICAJdmFyIHNwbGl0VXJsID0gVXJsLnNwbGl0KCIvIik7DQogICAgCXZhciBkb2NJRCA9IHNwbGl0VXJsW3NwbGl0VXJsLmxlbmd0aCAtIDFdOw0KICAgIAljb25zb2xlLmxvZyhkb2NJRCk7DQogICAgCXZhciBzcGxpdFBkZj1kb2NJRC5zcGxpdCgiLiIpOw0KICAgIAlpZihzcGxpdFBkZltzcGxpdFBkZi5sZW5ndGggLTFdPT0icGRmIikNCiAgICAJCXsNCiAgICAJCWJ1aWx0U3RyaW5nID0gIjxkaXYgb3JnYW5pYy1zZWFyY2gtaWQ9Iitkb2NJRCsiIGNsYXNzPSdzZWFyY2gtcmVzdWx0IHBhZ2luYXRpb24taXRlbSc+PGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9ICIrcmVzdWx0T2JqLnNlYXJjaFVSTCsiPiIgKyByZXN1bHRPYmouc2VhcmNoVGl0bGUgKyI8L2E+PHA+IityZXN1bHRPYmouc2VhcmNoRGVzYysiPC9wPjwvZGl2PiI7DQogICAgCQl9ZWxzZXsNCiAgICAJIGJ1aWx0U3RyaW5nID0gIjxkaXYgb3JnYW5pYy1zZWFyY2gtaWQ9Iitkb2NJRCsiIGNsYXNzPSdzZWFyY2gtcmVzdWx0IHBhZ2luYXRpb24taXRlbSc+PGEgaHJlZj0gIityZXN1bHRPYmouc2VhcmNoVVJMKyI+IiArIHJlc3VsdE9iai5zZWFyY2hUaXRsZSArIjwvYT48cD4iK3Jlc3VsdE9iai5zZWFyY2hEZXNjKyI8L3A+PC9kaXY+IjsNCiAgICAJCX0NCiAgICB9ZWxzZSBpZigodHlwZW9mKHJlc3VsdE9iai5zZWFyY2hJZCkgPT0gInVuZGVmaW5lZCIpICYmICh0eXBlb2YocmVzdWx0T2JqLnNlYXJjaFR5cGUpICE9ICJ1bmRlZmluZWQiKQ0KICAgIAkJJiYgKHJlc3VsdE9iai5zZWFyY2hUeXBlPT0icHJvbW90aW9uIikpew0KICAgIAkgYnVpbHRTdHJpbmcgPSAiPGRpdiBwcm9tb3Rpb24taWQ9J2RlZmF1bHQtcHJvbW90aW9uJyBjbGFzcz0nc2VhcmNoLXJlc3VsdCBwYWdpbmF0aW9uLWl0ZW0nPjxhIGhyZWY9IFwiIityZXN1bHRPYmouc2VhcmNoVVJMLnJlcGxhY2UoLyAvZywnJTIwJykgKyJcIj4iICsgcmVzdWx0T2JqLnNlYXJjaFRpdGxlICsiPC9hPjxwPiIrcmVzdWx0T2JqLnNlYXJjaERlc2MrIjwvcD48L2Rpdj4iOyAgICAJICANCiAgICAJfQ0KICAgIGVsc2V7DQogICAJIGJ1aWx0U3RyaW5nID0gIjxkaXYgcHJvbW90aW9uLWlkPSIrcmVzdWx0T2JqLnNlYXJjaElkKyIgY2xhc3M9J3NlYXJjaC1yZXN1bHQgcGFnaW5hdGlvbi1pdGVtJz48YSBocmVmPSAiK3Jlc3VsdE9iai5zZWFyY2hVUkwucmVwbGFjZSgvIC9nLCclMjAnKSsiPiIgKyByZXN1bHRPYmouc2VhcmNoVGl0bGUgKyI8L2E+PHA+IityZXN1bHRPYmouc2VhcmNoRGVzYysiPC9wPjwvZGl2PiI7ICAgIAkgIA0KICAgCSBwcm9tb0lkc0Fyci5wdXNoKHJlc3VsdE9iai5zZWFyY2hJZCk7DQogICB9DQogICAgcmV0dXJuIGJ1aWx0U3RyaW5nOw0KfQ0KDQovKlBhZ2luYXRpb24gLSBSaWNoYSAqLw0KDQpmdW5jdGlvbiBwYXJzZVBhZ2luYXRpb25Kc29uKHBhZ2VKc29uKSB7DQoJdmFyIHBhZ2VKc29uMiA9IHBhZ2VKc29uOw0KCXZhciBjdXJyZW50ID0gcGFnZUpzb24ucGFnaW5hdGlvbi5jdXJyZW50Ow0KCXZhciB0b3RhbCA9IHBhZ2VKc29uLnBhZ2luYXRpb24udG90YWw7DQoJdmFyIGZpcnN0ID0gcGFnZUpzb24ucGFnaW5hdGlvbi5maXJzdDsNCgl2YXIgbGFzdCA9IHBhZ2VKc29uLnBhZ2luYXRpb24ubGFzdDsNCgl2YXIgdG90YWxDb3VudCA9IHBhZ2VKc29uLnRvdGFsQ291bnQ7DQoJdmFyIHNlYXJjaFF1ZXJ5Rm9yRGlzcGxheSA9IHBhZ2VKc29uLnNlYXJjaFF1ZXJ5Rm9yRGlzcGxheTsNCgl2YXIgc2VhcmNoUXVlcnkgPSBwYWdlSnNvbi5zZWFyY2hRdWVyeTsNCgl2YXIgYWN0dWFsUXVlcnkgPSBwYWdlSnNvbi5hY3R1YWxRdWVyeTsNCgl2YXIgc2VhcmNoUmVzdWx0TGluayA9IHBhZ2VKc29uLnNlYXJjaFJlc3VsdExpbms7DQoJdmFyIHJlc3VsdHNGb3IgPSBwYWdlSnNvbi5mb3VuZFJlc3VsdEZvcjsNCgl2YXIgZmFjZXRzID0gcGFnZUpzb24uZmFjZXRzOw0KCXZhciBwcm9kdWN0RmFjZXRzID0gcGFnZUpzb24uUHJvZHVjdEZhY2V0czsNCgl2YXIgb3NGYWNldHMgPSBwYWdlSnNvbi5PU0ZhY2V0czsNCgl2YXIgdG9waWNGYWNldHMgPSBwYWdlSnNvbi5Ub3BpY0ZhY2V0czsNCgl2YXIgcHJvbW90aW9uTGlzdCA9IHBhZ2VKc29uLnByb21vdGlvbkxpc3Q7DQoJJCgiI3Byb21vdGlvbkxpc3QiKS52YWwoSlNPTi5zdHJpbmdpZnkocHJvbW90aW9uTGlzdCkpOw0KCSQoIiNzZWFyY2hSZXN1bHRzV3JhcHBlciIpLmh0bWwoIiIpOw0KCXZhciBzZW9GcmllbmRseU5hbWUgPSBwYWdlSnNvbi5zZWFyY2hSZXN1bHRzLnNlb0ZyaWVuZGx5TmFtZTsNCgkkKCIjc2VvRnJpZW5kbHlOYW1lIikudmFsKHNlb0ZyaWVuZGx5TmFtZSk7DQoJcGFpbnRQYWdpbmF0aW9uU2VjdGlvbihmaXJzdCxsYXN0LGN1cnJlbnQsdG90YWwpOw0KCXBhaW50U2VhcmNoUmVzdWx0cyhwYWdlSnNvbi5zZWFyY2hSZXN1bHRzKTsNCglwYWludENvdW50UXVlcnkodG90YWxDb3VudCxzZWFyY2hRdWVyeUZvckRpc3BsYXksYWN0dWFsUXVlcnksc2VhcmNoUmVzdWx0TGluayxzZWFyY2hRdWVyeSxyZXN1bHRzRm9yKTsNCgkNCgkvLyBkbyBub3QgcmVsb2FkIGZhY2V0cw0KCWlmKGZhY2V0cz09dW5kZWZpbmVkIHx8IChmYWNldHMhPXVuZGVmaW5lZCAmJiBmYWNldHMhPSdlbXB0eScpKQ0KCQlwYWludEZhY2V0cyhwcm9kdWN0RmFjZXRzLG9zRmFjZXRzLHRvcGljRmFjZXRzKTsNCgkNCgkkKCIuc2VhcmNoU2VjdGlvbldyYXBwZXIiKS5zaG93KCk7DQoJDQoJLy8gdG8gYmluZCAtIG9uIGNsaWNrIG9mIGNsZWFyIGFuZCBjbGVhciBhbGwgDQoJYmluZENsZWFyRmFjZXRzKCk7DQp9DQoNCmZ1bmN0aW9uIG5vbkVuZ2xpc2hMb2NhbGUoKXsNCgkJJCgiLmVuZ2xpc2hSZXN1bHRzIikub24oImNsaWNrIHRhcCIsZnVuY3Rpb24gKGV2ZW50KXsNCgkJc2VhcmNobGMgPSAiZW4iOw0KCQl2YXIgY291bnQgPSAkKCQoIi5yZXN1bHRzQ291bnQyIilbMF0pLnRleHQoKTsNCgkJJCgiI3N0b3JlUmVzdWx0Q291bnQiKS52YWwoY291bnQpOw0KCQllbmdsaXNoUmVzdWx0c0FqYXgoc2VhcmNobGMpOw0KCX0pOw0KCSQoIi5sb2NhbGVSZXN1bHRzIikub24oImNsaWNrIHRhcCIsZnVuY3Rpb24gKGV2ZW50KXsNCgkJc2VhcmNobGMgPSBnZXRDQ0xDKGxjKTsNCgkJJCgiI3N0b3JlUmVzdWx0Q291bnQiKS52YWwoIiIpOw0KCQlsb2NhbFJlc3VsdHNBamF4KHNlYXJjaGxjKTsNCgl9KTsNCn0NCg0KLypMb2NhbGUgYmFzZWQgcmVuZGVyaW5nICovDQpmdW5jdGlvbiBwYXJzZVBhZ2luYXRpb25Kc29uRW5nbGlzaChwYWdlSnNvbikgew0KCQ0KCS8vJCgiI3Jlc3VsdHNJbkxjIikuYWRkQ2xhc3MoImhpZGUiKTsNCglpZihwYWdlSnNvbi50b3RhbENvdW50PjApew0KCQkNCgkJcGFyc2VQYWdpbmF0aW9uSnNvbihwYWdlSnNvbik7DQoJCXJlc3VsdHNFbmdsaXNoSnNvbigpOw0KCX0NCgllbHNlew0KCQlub1Jlc3VsdHNFbmdsaXNoSnNvbigpOw0KCX0NCn0NCmZ1bmN0aW9uIHBhcnNlUGFnaW5hdGlvbkpzb25Mb2NhbGUocGFnZUpzb24pIHsNCgkNCglwYXJzZVBhZ2luYXRpb25Kc29uKHBhZ2VKc29uKTsNCgkvLyQoIiNyZXN1bHRzSW5MYyIpLnJlbW92ZUNsYXNzKCJoaWRlIik7DQoJJCgiLm9wdGlvbnNSZXN1bHRzSW5MYyIpLnJlbW92ZUNsYXNzKCJoaWRlIik7DQoJJCgiLmVuZ2xpc2hSZXN1bHRzIikucmVtb3ZlQ2xhc3MoImhpZGUiKTsJDQoJJCgiLmxvY2FsZVJlc3VsdHMiKS5hZGRDbGFzcygiaGlkZSIpOw0KCSQoIi5yZXN1bHRzSW5FbmciKS5hZGRDbGFzcygiaGlkZSIpOw0KCSQoIi5lbmdsaXNoTG9jYWxlIikuYWRkQ2xhc3MoImhpZGUiKTsNCgkkKCIjcmVzdWx0Q3VycmVudExvY2FsZSIpLnJlbW92ZUNsYXNzKCJoaWRlIik7DQoJJCgiLnJlc3VsdHNJbkxvY2FsIikucmVtb3ZlQ2xhc3MoImxvY2FsZS1yZXN1bHRzIik7DQoJJCgiI25vblVTTG9jYWxlU2Vjb25kVmlldyIpLmh0bWwoIiIpOw0KCSQoIi5zZWFyY2hGb3JOb25FTkxvY2FsZSIpLmNsb25lKCkuYXBwZW5kVG8oIiNub25VU0xvY2FsZVNlY29uZFZpZXciKTsNCgkkKCIucmVzdWx0c0NvbG9yIikuYWRkQ2xhc3MoImNvbG9yLWJsYWNrIik7DQoJJCgiI3NlYXJjaFByb2RJbmZvIikucmVtb3ZlQ2xhc3MoImhpZGUiKTsNCglub25FbmdsaXNoTG9jYWxlKCk7DQp9DQpmdW5jdGlvbiByZXN1bHRzRW5nbGlzaEpzb24oKQ0Kew0KCQ0KCSQoIi5vcHRpb25zUmVzdWx0c0luTGMiKS5hZGRDbGFzcygiaGlkZSIpOw0KCSQoIi5lbmdsaXNoUmVzdWx0cyIpLmFkZENsYXNzKCJoaWRlIik7CQ0KCSQoIi5sb2NhbGVSZXN1bHRzIikucmVtb3ZlQ2xhc3MoImhpZGUiKTsNCgkkKCIucmVzdWx0c0luRW5nIikucmVtb3ZlQ2xhc3MoImhpZGUiKTsNCgkkKCIuZW5nbGlzaExvY2FsZSIpLnJlbW92ZUNsYXNzKCJoaWRlIik7DQoJJCgiI3Jlc3VsdEN1cnJlbnRMb2NhbGUiKS5hZGRDbGFzcygiaGlkZSIpOw0KCSQoIiNub25VU0xvY2FsZVNlY29uZFZpZXciKS5odG1sKCIiKTsNCgkkKCIuc2VhcmNoRm9yTm9uRU5Mb2NhbGUiKS5jbG9uZSgpLmFwcGVuZFRvKCIjbm9uVVNMb2NhbGVTZWNvbmRWaWV3Iik7DQoJJCgiLnJlc3VsdHNJbkxvY2FsIikuYWRkQ2xhc3MoImxvY2FsZS1yZXN1bHRzIik7DQoJJCgiLnJlc3VsdHNDb2xvciIpLnJlbW92ZUNsYXNzKCJjb2xvci1ibGFjayIpOw0KCSQoIiNzZWFyY2hQcm9kSW5mbyIpLmFkZENsYXNzKCJoaWRlIik7DQoJbm9uRW5nbGlzaExvY2FsZSgpOw0KCQ0KfQ0KDQpmdW5jdGlvbiBub1Jlc3VsdHNFbmdsaXNoSnNvbigpDQp7DQoJDQoJJCgiLm5vRW5nbGlzaFJlc3VsdHMiKS5yZW1vdmVDbGFzcygiaGlkZSIpOw0KCSQoIi5vcHRpb25zUmVzdWx0c0luTGMiKS5hZGRDbGFzcygiaGlkZSIpOw0KCSQoIi5lbmdsaXNoUmVzdWx0cyIpLmFkZENsYXNzKCJoaWRlIik7DQoJJCgiI25vblVTTG9jYWxlU2Vjb25kVmlldyIpLmh0bWwoIiIpOw0KCSQoIi5zZWFyY2hGb3JOb25FTkxvY2FsZSIpLmNsb25lKCkuYXBwZW5kVG8oIiNub25VU0xvY2FsZVNlY29uZFZpZXciKTsNCglub25FbmdsaXNoTG9jYWxlKCk7DQoJDQoJDQp9DQoNCg0KZnVuY3Rpb24gcGFpbnRDb3VudFF1ZXJ5KHRvdGFsQ291bnQsc2VhcmNoUXVlcnlGb3JEaXNwbGF5LGFjdHVhbFF1ZXJ5LHNlYXJjaFJlc3VsdExpbmssc2VhcmNoUXVlcnkscmVzdWx0c0Zvcikgew0KCS8vIHBvcHVsYXRlIDEudG90YWwgY291bnQsIDIsc2VhcmNoIHF1ZXJ5IC0gdXNlciBlbnRlcnMgYW5kIDMuYWN0dWFsIHF1ZXJ5IC0gc2VhcmNoIHF1ZXJ5IGlmIHNlYXJjaCBxdWVyeSBpcyBtaXNzcGVsbGVkLiANCgkNCglnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLnNldFZhbHVlKCdDb3VudCcsdG90YWxDb3VudCk7DQoJJCh3aW5kb3cpLnRyaWdnZXIoJ1NlYXJjaENvdW50Jyx7IFNlYXJjaENvdW50IDogdG90YWxDb3VudCB9KTsNCg0KCSQoJy5yZXN1bHRzQ291bnQxJykuaHRtbCh0b3RhbENvdW50KTsNCgl2YXIgdG90YWxDb3VudExvY2FsID0gJCgiI3N0b3JlUmVzdWx0Q291bnQiKS52YWwoKTsNCglpZih0b3RhbENvdW50TG9jYWwhPSB1bmRlZmluZWQgJiYgdG90YWxDb3VudExvY2FsIT10b3RhbENvdW50ICYmIHRvdGFsQ291bnRMb2NhbCE9IiIpew0KCQkkKCcucmVzdWx0c0NvdW50MicpLmh0bWwodG90YWxDb3VudExvY2FsKTsNCgl9DQoJZWxzZXsNCgkJJCgnLnJlc3VsdHNDb3VudDInKS5odG1sKHRvdGFsQ291bnQpOw0KCX0JCQ0KCQ0KCSQoJy5yZXN1bHRzQ291bnQzJykuaHRtbCh0b3RhbENvdW50KTsNCg0KCS8qICQoJyNzZWFyY2gtaW5wdXQnKS52YWwoc2VhcmNoUXVlcnlGb3JEaXNwbGF5KTsgUmVtb3ZpbmcgdGhpcyBhcyB0aGUgc2VhcmNoIHF1ZXJ5IG5vdyBpcyBwYWludGVkIGRpcmVjdGx5IGZyb20gc2VhcmNocGFyZW50LmpzcCAqLw0KCSQoJyNzZWFyY2hRdWVyeScpLnZhbChzZWFyY2hRdWVyeSk7DQoJaWYoJCgnI2FjdHVhbFF1ZXJ5JykhPXVuZGVmaW5lZCkgew0KCQkkKCcjYWN0dWFsUXVlcnknKS52YWwoYWN0dWFsUXVlcnkpOw0KCQkvLyQoJyNhY3R1YWxRdWVyeScpLmF0dHIoImhyZWYiLHNlYXJjaFJlc3VsdExpbmspOw0KCX0NCglpZihyZXN1bHRzRm9yIT0nJykgew0KCQkvLyQoJyNyZXN1bHRzQ291bnRTZWFyY2gnKS5odG1sKHJlc3VsdHNGb3IpOw0KCQkvLyQoJyNyZXN1bHRzQ291bnRTZWFyY2hfdmFsJykudmFsKHJlc3VsdHNGb3IpOw0KCQkvL0NoYW5nZXMgbWFkZSBmb3IgWFNTIFZ1bG5lcmFiaWxpdHkNCgkJJCgnI3Jlc3VsdHNDb3VudFNlYXJjaCcpLmh0bWwoIiIpOw0KCQl2YXIgc2VhcmNoSW5wdXRfVGV4dCA9ICQoJyNzZWFyY2gtaW5wdXQnKS52YWwoKTsNCgkJc2VhcmNoSW5wdXRfVGV4dCA9ICQoJzxzcGFuPicsIHt0ZXh0OiBzZWFyY2hJbnB1dF9UZXh0fSk7DQoJCSQoJyNyZXN1bHRzQ291bnRTZWFyY2gnKS5hcHBlbmQoc2VhcmNoSW5wdXRfVGV4dCk7DQoJfQ0KCQ0KfQ0KDQpmdW5jdGlvbiBwYWludFBhZ2luYXRpb25TZWN0aW9uKGZpcnN0LGxhc3QsY3VycmVudCx0b3RhbCkgew0KCS8vIGNsZWFyIHRoZSBleGlzdGluZyBwYWdlcyBhbmQgcmVtb3ZlIGRpc2FibGVkIGNsYXNzIGZyb20gYnV0dG9uLg0KCSQoJy5wYWdpbmF0aW9uLWNvbnRhaW5lciB1bC5wYWdpbmF0aW9uLXBhZ2VzJykuaHRtbCgnJyk7DQoJZW5hYmxlRGlzYWJsZVBhZ2VCdXR0b24oJ2VuYWJsZScpOw0KCQ0KCS8vIGlmIG9ubHkgMXN0IHBhZ2UgaXMgZGlzcGxheWVkLg0KCWlmKGZpcnN0ID09IDApIHsNCgkJJCgnLnBhZ2luYXRpb25XcmFwcGVyJykuaGlkZSgpOw0KCQlyZXR1cm47DQoJfSBlbHNlIGlmKCAkKCcucGFnaW5hdGlvbldyYXBwZXInKS5jc3MoJ2Rpc3BsYXknKSA9PSAnbm9uZScgKSB7DQoJCSQoJy5wYWdpbmF0aW9uV3JhcHBlcicpLnNob3coKTsNCgl9DQoJLy9wYWludCB0aGUgcGFnZXMgYW5kIGFkZCBhY3RpdmUgY2xhc3MNCglmb3IodmFyIGNvdW50PWZpcnN0OyBjb3VudDw9bGFzdDsgY291bnQrKykgew0KCQlpZihjb3VudCA9PSBjdXJyZW50KSB7DQoJCQkkKCcucGFnaW5hdGlvbi1jb250YWluZXIgdWwucGFnaW5hdGlvbi1wYWdlcycpLmFwcGVuZCgnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImFjdGl2ZSI+PHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTowIj4nK3BhZ2luYXRpb25UQksucGFnZXMgKycgPC9zcGFuPjxzcGFuIGNsYXNzPSJwYWdlQ291bnQiPicrY291bnQrJzwvc3Bhbj48c3BhbiBzdHlsZT0iZm9udC1zaXplOjBweCI+ICcgKyBwYWdpbmF0aW9uVEJLLm9mICsgIGxhc3QgKyc8L3NwYW4+PC9hPjwvbGk+Jyk7DQoJCX0gZWxzZSB7DQoJCQkkKCcucGFnaW5hdGlvbi1jb250YWluZXIgdWwucGFnaW5hdGlvbi1wYWdlcycpLmFwcGVuZCgnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSI+PHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTowIj4nK3BhZ2luYXRpb25UQksucGFnZXMgKycgPC9zcGFuPjxzcGFuIGNsYXNzPSJwYWdlQ291bnQiPicrY291bnQrJzwvc3Bhbj48c3BhbiBzdHlsZT0iZm9udC1zaXplOjBweCI+ICcgKyBwYWdpbmF0aW9uVEJLLm9mICsgIGxhc3QgKyc8L3NwYW4+PC9hPjwvbGk+Jyk7DQoJCX0NCgl9DQogCQ0KCS8vY2hlY2sgZm9yIGRpc2FibGluZyBmaXJzdC9sYXN0IGJ1dHRvbg0KCWlmKGN1cnJlbnQgPT0gMSkgew0KCQllbmFibGVEaXNhYmxlUGFnZUJ1dHRvbignZGlzYWJsZScsJ2xlc3MnKTsNCgl9DQoJaWYoY3VycmVudCA9PSB0b3RhbCkgew0KCQllbmFibGVEaXNhYmxlUGFnZUJ1dHRvbignZGlzYWJsZScsJ21vcmUnKTsNCgl9DQoJDQoJJCgndWwucGFnaW5hdGlvbi1wYWdlcyBsaScpLm9uKCdjbGljaycsZnVuY3Rpb24oKSB7DQoJCWlmKCEoJCh0aGlzKS5maW5kKCdhJykuaGFzQ2xhc3MoJ2FjdGl2ZScpKSkgew0KCQkJdmFyIGN1cnJlbnQgPSAkKHRoaXMpLmZpbmQoJ2EgLnBhZ2VDb3VudCcpLmh0bWwoKTsNCgkJCXZhciBjdXJyZW50TnVtID0gcGFyc2VJbnQoY3VycmVudCk7DQoJCQlwYWdpbmF0aW9uKGN1cnJlbnROdW0pOw0KCQl9CQkNCgl9KTsNCn0NCg0KZnVuY3Rpb24gcGFnaW5hdGlvbihwYWdlTnVtKSB7DQoJdmFyIGFqYXhQYXJhbSA9IGZhY2V0c1BhZ2luYXRpb25QYXJhbXMocGFnZU51bSk7DQoJdmFyIHJlcXVlc3RKc29uID0gSlNPTi5zdHJpbmdpZnkoYWpheFBhcmFtLnBhcmFtRGF0YSk7DQoJdmFyIHBhZ2VVUkwgPSAkKCcjcGFnaW5hdGlvblVSTCcpLnZhbCgpOw0KCWNhbGxBamF4VXRpbCgicGFnaW5hdGlvbiIscGFnZVVSTCwiUE9TVCIscGFyc2VQYWdpbmF0aW9uSnNvbiwiSlNPTiIsIHJlcXVlc3RKc29uLA0KCQkJbnVsbCxudWxsLG51bGwsdHJ1ZSxoYW5kbGVMb2FkaW5nUmVzdWx0LHRydWUsaGFuZGxlTG9hZGluZ1Jlc3VsdCxmYWxzZSk7DQp9DQoNCmZ1bmN0aW9uIHBhZ2VCdXR0b25IYW5kbGUoYnV0dG9uVmFsKSB7DQoJdmFyIGN1cnJlbnQgPSAkKCd1bC5wYWdpbmF0aW9uLXBhZ2VzIGxpIGEuYWN0aXZlIC5wYWdlQ291bnQnKS5odG1sKCk7DQoJdmFyIGN1cnJlbnROdW0gPSBwYXJzZUludChjdXJyZW50KTsNCglpZihidXR0b25WYWwgPT0gImxlc3MiKSB7DQoJCXBhZ2luYXRpb24oY3VycmVudE51bS0xKTsNCgl9ZWxzZSBpZihidXR0b25WYWwgPT0gIm1vcmUiKSB7DQoJCXBhZ2luYXRpb24oY3VycmVudE51bSsxKTsNCgl9DQp9DQoNCi8vdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgb24gYmVmb3Jlc2VuZCBhbmQgY29tcGxldGUgb2YgYWpheCBjYWxsIGZvciBwYWdpbmF0aW9uDQpmdW5jdGlvbiBoYW5kbGVMb2FkaW5nUmVzdWx0KHNob3dPckhpZGUpIHsNCgkvLyBzaG93T3JIaWRlIHdpbGwgYmUgdHJ1ZSBmb3IgYmVmb3Jlc2VuZCBhbmQgZmFsc2UgZm9yIGNvbXBsZXRlDQoJaWYoc2hvd09ySGlkZSA9PSB0cnVlKSB7DQoJCSQoJy5ocC1sb2FkaW5nLXJlc3VsdHMnKS5zaG93KCk7DQoJfSBlbHNlIHsNCgkJJCgnLmhwLWxvYWRpbmctcmVzdWx0cycpLmhpZGUoKTsNCgkJJCh3aW5kb3cpLnNjcm9sbFRvcCgwKTsNCgkJJCgiI3NlYXJjaFJlc3VsdHNXcmFwcGVyIikuZmluZCgiYSIpWzBdLmZvY3VzKCk7IC8vIFRoaXMgaXMgdG8gdGFrZSB0aGUgZm9jdXMgdG8gdGhlIGZpcnN0IHJlc3VsdC4NCgl9DQp9DQoNCg0KZnVuY3Rpb24gZW5hYmxlRGlzYWJsZVBhZ2VCdXR0b24oZW5hYmxlRGlzYWJsZSxidXR0b25OYW1lKSB7DQoJaWYoZW5hYmxlRGlzYWJsZSA9PSAnZGlzYWJsZScpIHsNCgkJaWYoYnV0dG9uTmFtZSA9PSAnbGVzcycpIHsNCgkJCSQoJy5wYWdpbmF0aW9uLWJ1dHRvbi5wYWdpbmF0aW9uLWxlc3MnKS5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJyk7DQoJCQkkKCcucGFnaW5hdGlvbi1idXR0b24ucGFnaW5hdGlvbi1sZXNzJykuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywnI0RERCcpOw0KCQl9IGVsc2Ugew0KCQkJJCgnLnBhZ2luYXRpb24tYnV0dG9uLnBhZ2luYXRpb24tbW9yZScpLmF0dHIoJ2Rpc2FibGVkJywnZGlzYWJsZWQnKTsNCgkJCSQoJy5wYWdpbmF0aW9uLWJ1dHRvbi5wYWdpbmF0aW9uLW1vcmUnKS5jc3MoJ2JhY2tncm91bmQtY29sb3InLCcjREREJyk7DQoJCX0NCgl9IGVsc2Ugew0KCQkJLy8gZW5hYmxlIGxlc3MNCgkJCSQoJy5wYWdpbmF0aW9uLWJ1dHRvbi5wYWdpbmF0aW9uLWxlc3MnKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpOw0KCQkJJCgnLnBhZ2luYXRpb24tYnV0dG9uLnBhZ2luYXRpb24tbGVzcycpLmNzcygnYmFja2dyb3VuZC1jb2xvcicsJyNGRkYnKTsNCg0KCQkJLy8gZW5hYmxlIG1vcmUNCgkJCSQoJy5wYWdpbmF0aW9uLWJ1dHRvbi5wYWdpbmF0aW9uLW1vcmUnKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpOw0KCQkJJCgnLnBhZ2luYXRpb24tYnV0dG9uLnBhZ2luYXRpb24tbW9yZScpLmNzcygnYmFja2dyb3VuZC1jb2xvcicsJyNGRkYnKTsNCgl9DQoJDQp9DQoNCi8qUGFnaW5hdGlvbiAtIFJJY2hhIC0gZW5kICovDQoNCmZ1bmN0aW9uIGhhbmRsZVBhZ2luYXRpb25SdGwoKSB7DQoJLy8gUlRMIGZvciBwYWdpbmF0aW9uIGJ1dHRvbnMgLSBSaWNoYSANCglpZigkKCdodG1sJykuYXR0cignZGlyJykgPT0gJ3J0bCcpIHsNCgkJJCgnLnBhZ2luYXRpb24tYnV0dG9uLnBhZ2luYXRpb24tbGVzcyBpJykucmVtb3ZlQ2xhc3MoJ2ZhIGZhLWNoZXZyb24tbGVmdCcpLmFkZENsYXNzKCdmYSBmYS1jaGV2cm9uLXJpZ2h0Jyk7DQoJCSQoJy5wYWdpbmF0aW9uLWJ1dHRvbi5wYWdpbmF0aW9uLW1vcmUgaScpLnJlbW92ZUNsYXNzKCdmYSBmYS1jaGV2cm9uLXJpZ2h0JykuYWRkQ2xhc3MoJ2ZhIGZhLWNoZXZyb24tbGVmdCcpOw0KCX0NCgkvLyBSVEwgZm9yIHBhZ2luYXRpb24gYnV0dG9ucyAtIFJpY2hhIC0gZW5kDQp9DQoNCg0KCn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5eyQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewogICAgaHBFeHBhbmRhYmxlSW5pdCgpOwp9KTsKCmZ1bmN0aW9uIGhwRXhwYW5kYWJsZUluaXQoKSB7CiAgICAkKGRvY3VtZW50KS5vbigiY2xpY2siLCAiLmhwLWV4cGFuZC1jb2xhcHNlIiwgZnVuY3Rpb24oKSB7CgogICAgICAgICQodGhpcykuYWRkQ2xhc3MoIm9wZW5lZCIpOwogICAgICAgICQodGhpcykuc2libGluZ3MoIi5ocC1leHBhbmRhYmxlLXNlY3Rpb24iKS5zbGlkZURvd24oKS5hZGRDbGFzcygib3BlbmVkIik7CgogICAgfSk7CiAgICAkKGRvY3VtZW50KS5vbigiY2xpY2siLCAiLmhwLWV4cGFuZC1jb2xhcHNlLm9wZW5lZCIsIGZ1bmN0aW9uKCkgewoKICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCJvcGVuZWQiKTsKICAgICAgICAkKHRoaXMpLnNpYmxpbmdzKCIuaHAtZXhwYW5kYWJsZS1zZWN0aW9uIikucmVtb3ZlQ2xhc3MoIm9wZW5lZCIpLnNsaWRlVXAoKTsKCiAgICB9KTsKfQoKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7LyoqDQogKiBQcm90ZWN0IHdpbmRvdy5jb25zb2xlIG1ldGhvZCBjYWxscywgZS5nLiBjb25zb2xlIGlzIG5vdCBkZWZpbmVkIG9uIElFDQogKiB1bmxlc3MgZGV2IHRvb2xzIGFyZSBvcGVuLCBhbmQgSUUgZG9lc24ndCBkZWZpbmUgY29uc29sZS5kZWJ1Zw0KICovDQooZnVuY3Rpb24oKSB7DQogIGlmICghd2luZG93LmNvbnNvbGUpIHsNCiAgICB3aW5kb3cuY29uc29sZSA9IHt9Ow0KICB9DQogIC8vIHVuaW9uIG9mIENocm9tZSwgRkYsIElFLCBhbmQgU2FmYXJpIGNvbnNvbGUgbWV0aG9kcw0KICB2YXIgbSA9IFsNCiAgICAibG9nIiwgImluZm8iLCAid2FybiIsICJlcnJvciIsICJkZWJ1ZyIsICJ0cmFjZSIsICJkaXIiLCAiZ3JvdXAiLA0KICAgICJncm91cENvbGxhcHNlZCIsICJncm91cEVuZCIsICJ0aW1lIiwgInRpbWVFbmQiLCAicHJvZmlsZSIsICJwcm9maWxlRW5kIiwNCiAgICAiZGlyeG1sIiwgImFzc2VydCIsICJjb3VudCIsICJtYXJrVGltZWxpbmUiLCAidGltZVN0YW1wIiwgImNsZWFyIg0KICBdOw0KICAvLyBkZWZpbmUgdW5kZWZpbmVkIG1ldGhvZHMgYXMgbm9vcHMgdG8gcHJldmVudCBlcnJvcnMNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBtLmxlbmd0aDsgaSsrKSB7DQogICAgaWYgKCF3aW5kb3cuY29uc29sZVttW2ldXSkgew0KICAgICAgd2luZG93LmNvbnNvbGVbbVtpXV0gPSBmdW5jdGlvbigpIHt9Ow0KICAgIH0gICAgDQogIH0gDQp9KSgpOwp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvLyBUaGlzIHBsdWdpbiBpcyBiYXNlZCBvbiB0aGUgQm9vdHN0cmFwIGNvbGxhcHNlIGNvbXBvbmVudCwgd2l0aCBzb21lIGV4dGVuZGVkIGZ1bmN0aW9uYWxpdHkNCi8vIFRoaXMgcGx1Z2luIGxvb2tzIGZvciBhbiBlbGVtZW50IHdpdGggYSBkYXRhLXRvZ2dsZT0iY29sbGFwc2UiDQovLyBUaGUgaHJlZiBhdHRyIG9mIHRoZSB0b2dnbGUgd2lsbCBkZXRlcm1pbmUgd2hpY2ggYWNjb3JkaW9uIHRvIGNvbGxhcHNlL2V4cGFuZA0KLy8gSWYgdGhlIHRvZ2dsZSBlbGVtZW50IGFsc28gaGFzIGEgZGF0YS1ncm91cCBhdHRyLCBhbnkgYWNjb3JkaW9uIGluc2lkZSB0aGF0ICNpZCB3aWxsIGNvbGxhcHNlLCBhbGxvd2luZyBvbmx5IG9uZSB0byBiZSB2aXNpYmxlYSBhdCBhIHRpbWUNCi8vIEFsc28geW91IGNhbiBwYXNzIGluIGEgZGF0YS1zY3JvbGwgYm9vbGVhbiBvbiB0aGUgdG9nZ2xlIGVsZW1lbnQsIHRvIGRldGVybWluZSB3ZXRoZXIgdGhlIHBhZ2Ugd2lsbCBzY3JvbGxUbyB0aGUgbm93IHZpc2libGUgYWNjb3JkaW9uIGNvbnRlbnQNCi8vDQovLyBUaGlzIHdpbGwgY29udHJvbCBhbnkgZXhwYW5kYWJsZSBjb21wb25lbnQsIGluY2x1ZGluZyBBY2NvcmRpb25zLCBTb3J0YWJsZSBUYWJsZSwgYW5kIEluc3RydWN0aW9uIFBhbmVscw0KDQoNCkFjY29yZGlvbiA9IChmdW5jdGlvbigpew0KCXZhciBpbml0ID0gZnVuY3Rpb24oKXsNCgkJaWYoJCgnW2RhdGEtdG9nZ2xlPSJjb2xsYXBzZSJdJykubGVuZ3RoKXsNCgkJCWFkZEhhbmRsZXJzKCk7DQoJCX0NCgl9Ow0KCXZhciBhZGRIYW5kbGVycyA9IGZ1bmN0aW9uKCl7DQoJCSQoJ1tkYXRhLXRvZ2dsZT0iY29sbGFwc2UiXScpLm9uKCd0YXAgY2xpY2snLCBjaGVja1N0YXRlKTsNCgkJJCgnW2RhdGEtdG9nZ2xlPSJjb2xsYXBzZSJdJykub24oJ3NsaWRlRG93bicsIHNsaWRlRG93bik7DQoJCSQoJ1tkYXRhLXRvZ2dsZT0iY29sbGFwc2UiXScpLm9uKCdzbGlkZVVwJywgc2xpZGVVcCk7DQoJCSQoJy5hY2MtZXgtYWxsJykub24oJ3RhcCBjbGljaycsIGV4cGFuZEFsbCk7DQoJCSQoJy5hY2MtY29sbC1hbGwnKS5vbigndGFwIGNsaWNrJywgY29sbGFwc2VBbGwpOw0KCX07DQoNCgl2YXIgY2hlY2tTdGF0ZSA9IGZ1bmN0aW9uKGUpew0KCQkvLyBUaGlzIGlzIHRoZSBlbnRyeSBwb2ludC4gSXQgY2hlY2tzIHRoZSBzdGF0ZSBvZiB0aGUgYWNjb3JkaW9uIGFuZCBoYW5kbGVzIGl0cyBhY2NvcmRpbmdseSAobG9seikuDQoJCWUucHJldmVudERlZmF1bHQoKTsNCgkgCWUuc3RvcFByb3BhZ2F0aW9uKCk7DQoJIAkvL0dldCB0aGUgZS50YXJnZXQgaGFuZGxlcg0KCQl2YXIgJHRvZ2dsZSA9ICQodGhpcyk7DQoJCXZhciBzY3JvbGwgPSAkdG9nZ2xlLmRhdGEoJ3Njcm9sbCcpOw0KCQkvL0lGIElUIElTIFVQLCBzbGlkZSBpdCBkb3duDQoJCWlmKCEkKCR0b2dnbGUuYXR0cignaHJlZicpKS5oYXNDbGFzcygnaW4nKSl7DQoJCQkvL0lGIElOIEdST1VQLCB0aGVuIHdlIG5lZWQgdG8gY2xvc2UgYWxsIHNpYmxpbmcgcGFuZWxzIGluIHRoZSBncm91cA0KCQkJaWYoJHRvZ2dsZS5kYXRhKCdwYXJlbnQnKSl7DQoJCQkJdmFyIGdyb3VwID0gJHRvZ2dsZS5kYXRhKCdwYXJlbnQnKTsNCgkJCQkkKGdyb3VwKS5maW5kKCdbZGF0YS10b2dnbGU9ImNvbGxhcHNlIl0nKS5ub3QoJHRvZ2dsZSkudHJpZ2dlcignc2xpZGVVcCcpOw0KCQkJCSR0b2dnbGUudHJpZ2dlcignc2xpZGVEb3duJywgW3Njcm9sbF0pOw0KCQkJfSBlbHNlIHsNCgkJCQkkdG9nZ2xlLnRyaWdnZXIoJ3NsaWRlRG93bicsIFtzY3JvbGxdKTsNCgkJCX0NCgkJLy9JRiBET1dOLCBzbGlkZSB0aGF0IHVwDQoJCX0gZWxzZSB7DQoJCQkkdG9nZ2xlLnRyaWdnZXIoJ3NsaWRlVXAnKTsNCgkJfQ0KDQoJfTsNCg0KCXZhciBleHBhbmRBbGwgPSBmdW5jdGlvbihlKXsNCgkJLy9UaGlzIGV4cGFuZHMgYWxsIHBhbmVscyBpbiB0aGUgZ3JvdXANCgkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQl2YXIgJHRvZ2dsZSA9ICQodGhpcyk7DQoJCXZhciAkZ3JvdXAgPSAkKCR0b2dnbGUuZGF0YSgnZ3JvdXAnKSk7DQoJCSRncm91cC5maW5kKCdbZGF0YS10b2dnbGU9ImNvbGxhcHNlIl0nKS50cmlnZ2VyKCdzbGlkZURvd24nLCBbZmFsc2VdKTsNCgl9Ow0KDQoJdmFyIGNvbGxhcHNlQWxsID0gZnVuY3Rpb24oZSl7DQoJCS8vQ29sbGFwc2VzIGFsbCBwYW5lbHMgaW4gdGhlaXIgZ3JvdXANCgkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQl2YXIgJHRvZ2dsZSA9ICQodGhpcyk7DQoJCXZhciAkZ3JvdXAgPSAkKCR0b2dnbGUuZGF0YSgnZ3JvdXAnKSk7DQoJCSRncm91cC5maW5kKCdbZGF0YS10b2dnbGU9ImNvbGxhcHNlIl0nKS50cmlnZ2VyKCdzbGlkZVVwJyk7DQoJfTsNCg0KCXZhciBzbGlkZURvd24gPSBmdW5jdGlvbihlLCBzY3JvbGwpew0KCQkvL1NsaWRlcyBkb3duIGFuIGluZGl2aWR1YWwgcGFuZWwNCgkJdmFyICR0b2dnbGUgPSAkKHRoaXMpOw0KCQl2YXIgJHBhbmVsID0gJCh0aGlzKS5hZGRDbGFzcygndG9nZ2xlZCcpLmNsb3Nlc3QoJ1tjbGFzc149InBhbmVsIl0nKS5hZGRDbGFzcygnb3BlbicpOw0KCQl2YXIgYWNjb3JkaW9uSWQgPSAkdG9nZ2xlLmF0dHIoJ2hyZWYnKTsNCgkJdmFyICRhY2NvcmRpb24gPSAkKGFjY29yZGlvbklkKTsNCgkJJHRvZ2dsZS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwidHJ1ZSIpOw0KCQkkYWNjb3JkaW9uLnNsaWRlRG93bihmdW5jdGlvbigpew0KCQkJJCh0aGlzKS5hZGRDbGFzcygnaW4nKTsNCgkJCWlmKHNjcm9sbCl7DQoJCQkJJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe3Njcm9sbFRvcDogJGFjY29yZGlvbi5vZmZzZXQoKS50b3AtMjAwfSwgdHJ1ZSk7DQoJCQl9DQoJCQlpZigkKHRoaXMpLmF0dHIoImlkIikgPT0gIm9zLXNlbGVjdG9yIil7DQogICAgICAgICAgICAgICAgJCgiLm9zLWhlYWRpbmciKS5jc3MoInBvaW50ZXItZXZlbnRzIiwiIik7DQogICAgICAgICAgICB9DQoJCX0pOw0KCX07DQoJdmFyIHNsaWRlVXAgPSBmdW5jdGlvbihlKXsNCgkJdmFyICR0b2dnbGUgPSAkKHRoaXMpOw0KCQl2YXIgJHBhbmVsID0gJCh0aGlzKS5yZW1vdmVDbGFzcygndG9nZ2xlZCcpLmNsb3Nlc3QoJ1tjbGFzc149InBhbmVsIl0nKS5yZW1vdmVDbGFzcygnb3BlbicpOw0KCQl2YXIgYWNjb3JkaW9uSWQgPSAkdG9nZ2xlLmF0dHIoJ2hyZWYnKTsNCgkJdmFyICRhY2NvcmRpb24gPSAkKGFjY29yZGlvbklkKTsNCgkJJHRvZ2dsZS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwiZmFsc2UiKTsNCgkJJGFjY29yZGlvbi5zbGlkZVVwKGZ1bmN0aW9uKCl7DQoJCQkkKHRoaXMpLnJlbW92ZUNsYXNzKCdpbicpOw0KCQkJaWYoJCh0aGlzKS5hdHRyKCJpZCIpID09ICJvcy1zZWxlY3RvciIpew0KICAgICAgICAgICAgICAgICQoIi5vcy1oZWFkaW5nIikuY3NzKCJwb2ludGVyLWV2ZW50cyIsIiIpOw0KICAgICAgICAgICAgfQ0KCQl9KTsNCgl9Ow0KCXJldHVybiB7DQoJCWluaXQ6IGluaXQNCgl9Ow0KfSgpKTsKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7Ly8gVGhpcyBoYXMgYmVlbiBtYWRlIG9ic29sZXRlIGJ5IHRoZSBhZGRpdGlvbiBvZiBpQ2hlY2sgcGx1Z2luDQovLyBTYXZpbmcgY29kZSBoZXJlIGZvciBiYWNrdXAgZm9yIG5vdw0KDQoNCg0KDQovLyBDaGVja2JveGVzID0gKGZ1bmN0aW9uKCl7DQovLyAJdmFyIGluaXQgPSBmdW5jdGlvbigpew0KLy8gCQl2YXIgJGlucHV0cyA9ICQoJ2lucHV0W3R5cGU9ImNoZWNrYm94Il0nKTsNCi8vIAkJaWYoJGlucHV0cy5sZW5ndGgpew0KLy8gCQkJJGlucHV0cy5lYWNoKGZ1bmN0aW9uKCl7DQovLyAJCQkJdmFyICRsYWJlbCA9ICQodGhpcykucGFyZW50KCdsYWJlbCcpOw0KLy8gCQkJCXByZUNoZWNrQm94KCRsYWJlbCk7DQovLyAJCQl9KTsNCi8vIAkJCWFkZEhhbmRsZXJzKCk7DQovLyAJCX0NCi8vIAl9DQoNCi8vIAl2YXIgYWRkSGFuZGxlcnMgPSBmdW5jdGlvbigpew0KLy8gCQkkKCdpbnB1dFt0eXBlPSJjaGVja2JveCJdJykucGFyZW50KCdsYWJlbCcpLm9uKCd0YXAgY2xpY2snLCBjaGVja0JveCk7DQovLyAJfQ0KLy8gCXZhciBjaGVja0JveCA9IGZ1bmN0aW9uKGUpew0KLy8gCQllLnN0b3BQcm9wYWdhdGlvbigpOw0KLy8gCQllLnByZXZlbnREZWZhdWx0KCk7DQovLyAJCXZhciAkbGFiZWwgPSAkKHRoaXMpOw0KLy8gCQl2YXIgJGlucHV0ID0gJGxhYmVsLmZpbmQoJ2lucHV0Jyk7DQovLyAJCWlmKCRpbnB1dC5hdHRyKCdjaGVja2VkJykpew0KLy8gCQkJJGlucHV0LnJlbW92ZUF0dHIoJ2NoZWNrZWQnKS5jaGFuZ2UoKTsNCi8vIAkJCSRsYWJlbC5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTsNCi8vIAkJfSBlbHNlIHsNCi8vIAkJCSRpbnB1dC5hdHRyKCdjaGVja2VkJywgJ2NoZWNrZWQnKS5jaGFuZ2UoKTsNCi8vIAkJCSRsYWJlbC5hZGRDbGFzcygnc2VsZWN0ZWQnKTsNCi8vIAkJfQ0KLy8gCX0NCi8vIAl2YXIgcHJlQ2hlY2tCb3ggPSBmdW5jdGlvbigkbGFiZWwpew0KLy8gCQl2YXIgJGlucHV0ID0gJGxhYmVsLmZpbmQoJCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXScpKTsNCi8vIAkJaWYoJGlucHV0LmF0dHIoJ2NoZWNrZWQnKSl7DQovLyAJCQkkaW5wdXQuYXR0cignY2hlY2tlZCcsICdjaGVja2VkJykuY2hhbmdlKCk7DQovLyAJCQkkbGFiZWwuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7DQovLyAJCX0gZWxzZSB7DQovLyAJCQkkaW5wdXQucmVtb3ZlQXR0cignY2hlY2tlZCcpLmNoYW5nZSgpOw0KLy8gCQkJJGxhYmVsLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpOwkNCi8vIAkJfQ0KLy8gCX0NCi8vIAlyZXR1cm4gew0KLy8gCQlpbml0OiBpbml0DQovLyAJfQ0KLy8gfSgpKTsNCg0KDQogIC8vIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gRklMVEVSUy1ERVNLVE9QDQoNCiAgLy8gJCgnLmZpbHRlcnMtZGVza3RvcCAuZXhwYW5kYWJsZScpLm9uKCdjbGljayB0b3VjaHN0YXJ0JywgZnVuY3Rpb24oZSkgew0KICAvLyAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgLy8gICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuJyk7DQogIC8vIH0pOw0KDQogIC8vICQoJy5maWx0ZXJzLWRlc2t0b3AgLmZpbHRlci1vcHRpb25zIGxhYmVsJykub24oJ2NsaWNrIHRvdWNoc3RhcnQnLCBmdW5jdGlvbihlKSB7DQogIC8vICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAvLyAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ3NlbGVjdGVkJyk7DQogIC8vIH0pOw0KDQogIC8vICQoJy5zaG93LW1vcmUnKS5vbignY2xpY2sgdG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpIHsNCiAgLy8gICBlLnByZXZlbnREZWZhdWx0KCk7DQogIC8vICAgJCh0aGlzKS5jbG9zZXN0KCcuZmlsdGVyLW9wdGlvbnMtbmVzdGVkJykuZmluZCgnLm1vcmUnKS5yZW1vdmVDbGFzcygnbW9yZScpLmFkZENsYXNzKCdsZXNzJyk7DQogIC8vICAgJCh0aGlzKS5oaWRlKCk7DQogIC8vICAgJCgnLnNob3ctbGVzcycpLnNob3coKTsNCiAgLy8gfSk7DQoNCiAgLy8gJCgnLnNob3ctbGVzcycpLm9uKCdjbGljayB0b3VjaHN0YXJ0JywgZnVuY3Rpb24oZSkgew0KICAvLyAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgLy8gICAkKHRoaXMpLmNsb3Nlc3QoJy5maWx0ZXItb3B0aW9ucy1uZXN0ZWQnKS5maW5kKCcubGVzcycpLnJlbW92ZUNsYXNzKCdsZXNzJykuYWRkQ2xhc3MoJ21vcmUnKTsNCiAgLy8gICAkKHRoaXMpLmhpZGUoKTsNCiAgLy8gICAkKCcuc2hvdy1tb3JlJykuc2hvdygpOw0KICAvLyB9KTsNCg0KICAvLyAkKCcuc2hvdy1tb3JlLWV4cGFuZGFibGVzJykub24oJ2NsaWNrIHRvdWNoc3RhcnQnLCBmdW5jdGlvbihlKSB7DQogIC8vICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAvLyAgICQodGhpcykuY2xvc2VzdCgnLmZpbHRlci1sZXZlbC0xJykuZmluZCgnLm1vcmUtY2F0ZWdvcnknKS5yZW1vdmVDbGFzcygnbW9yZS1jYXRlZ29yeScpLmFkZENsYXNzKCdsZXNzLWNhdGVnb3J5Jyk7DQogIC8vICAgJCh0aGlzKS5oaWRlKCk7DQogIC8vICAgJCgnLnNob3ctbGVzcy1leHBhbmRhYmxlcycpLnNob3coKTsNCiAgLy8gfSk7DQoNCiAgLy8gJCgnLnNob3ctbGVzcy1leHBhbmRhYmxlcycpLm9uKCdjbGljayB0b3VjaHN0YXJ0JywgZnVuY3Rpb24oZSkgew0KICAvLyAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgLy8gICAkKHRoaXMpLmNsb3Nlc3QoJy5maWx0ZXItbGV2ZWwtMScpLmZpbmQoJy5sZXNzLWNhdGVnb3J5JykucmVtb3ZlQ2xhc3MoJ2xlc3MtY2F0ZWdvcnknKS5hZGRDbGFzcygnbW9yZS1jYXRlZ29yeScpOw0KICAvLyAgICQodGhpcykuaGlkZSgpOw0KICAvLyAgICQoJy5zaG93LW1vcmUtZXhwYW5kYWJsZXMnKS5zaG93KCk7DQogIC8vIH0pOw0KDQogIC8vIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gRklMVEVSUy1UUklHR0VSDQoNCiAgLy8gJCgnI2ZpbHRlci10cmlnZ2VyJykub24oJ2NsaWNrIHRvdWNoc3RhcnQnLCBmdW5jdGlvbihlKSB7DQogIC8vICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAvLyAgICQoJy5maWx0ZXJzJykudG9nZ2xlQ2xhc3MoJ29wZW4nKTsNCiAgLy8gfSk7DQoNCiAgLy8gJCgnLmZpbHRlcnMgLmNsb3NlJykub24oJ2NsaWNrIHRvdWNoc3RhcnQnLCBmdW5jdGlvbihlKSB7DQogIC8vICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAvLyAgICQoJy5maWx0ZXJzJykucmVtb3ZlQ2xhc3MoJ29wZW4nKTsNCiAgLy8gfSk7DQoNCiAgLy8gJCgnLmZpbHRlcnMnKS5vbignc2Nyb2xsJywgZnVuY3Rpb24oZSkgew0KICAvLyAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogIC8vIH0pOw0KDQogIC8vIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gRklMVEVSUy1NT0JJTEUNCg0KICAvLyAkKCcjY2xvc2UtdGFiLWNvbnRlbnQnKS5vbignY2xpY2sgdG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpIHsNCiAgLy8gICBlLnByZXZlbnREZWZhdWx0KCk7DQogIC8vICAgJCgnLnRhYi1jb250ZW50JykucmVtb3ZlQ2xhc3MoJ29wZW4nKTsNCiAgLy8gfSk7DQoNCiAgLy8gJCgnLmhwLW5hdi10YWJzIGEnKS5vbignY2xpY2sgdG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpIHsNCiAgLy8gICBlLnByZXZlbnREZWZhdWx0KCk7DQogIC8vICAgJCgnLnRhYi1jb250ZW50JykudG9nZ2xlQ2xhc3MoJ29wZW4nKTsNCiAgLy8gfSk7DQoNCiAgLy8gJCgnLmZpbHRlci10cmlnZ2VyJykub24oJ2NsaWNrIHRvdWNoc3RhcnQnLCBmdW5jdGlvbihlKSB7DQogIC8vICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAvLyAgICQoJy5maWx0ZXJzLW1vYmlsZScpLnRvZ2dsZUNsYXNzKCdvcGVuJyk7DQogIC8vIH0pOw0KDQogIC8vICQoJy5maWx0ZXItdGl0bGUnKS5vbignY2xpY2sgdG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpIHsNCiAgLy8gICBlLnByZXZlbnREZWZhdWx0KCk7DQogIC8vICAgJCh0aGlzKS5uZXh0KCcuZmlsdGVyLW9wdGlvbnMnKS50b2dnbGVDbGFzcygnb3BlbicpOw0KICAvLyAgICQodGhpcykuY2xvc2VzdCgnLmZpbHRlci1jYXRlZ29yeScpLnRvZ2dsZUNsYXNzKCdvcGVuJyk7DQogIC8vIH0pOw0KDQogIC8vICQoJy5maWx0ZXItb3B0aW9ucyBsYWJlbCcpLm9uKCdjbGljayB0b3VjaHN0YXJ0JywgZnVuY3Rpb24oZSkgew0KICAvLyAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgLy8gICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuJyk7DQogICAgDQogIC8vICAgdmFyICRmaWx0ZXJPcHRpb24gPSAkKHRoaXMpLmZpbmQoJ2lucHV0W3R5cGU9ImNoZWNrYm94Il0nKTsNCiAgLy8gICAkZmlsdGVyT3B0aW9uLmF0dHIoJ2NoZWNrZWQnLCAhJGZpbHRlck9wdGlvbi5pcygnOmNoZWNrZWQnKSk7DQoNCiAgLy8gICAkKHRoaXMpLm5leHQoJy5maWx0ZXItb3B0aW9ucy1uZXN0ZWQnKS50b2dnbGVDbGFzcygnb3BlbicpOw0KICAvLyB9KTsgIA0KCn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ey8vIFRoaXMgY29tcG9uZW50IG1pbWljcyB0aGUgYmFzaWMgZnVuY3Rpb25hbGl0eSBvZiB0aGUgYm9vdHN0cmFwIGRyb3Bkb3duIGNvbXBvbmVudA0KDQoNCkRyb3Bkb3duID0gKGZ1bmN0aW9uKCl7DQoJDQoJdmFyIGluaXQgPSBmdW5jdGlvbigpew0KCQlpZigkKCdbZGF0YS10b2dnbGU9ImN1c3RvbURyb3Bkb3duIl0nKS5sZW5ndGgpew0KCQkJYWRkSGFuZGxlcnMoKTsNCgkJfQ0KCX07DQoNCgl2YXIgYWRkSGFuZGxlcnMgPSBmdW5jdGlvbigpew0KCQkkKCdbZGF0YS10b2dnbGU9ImN1c3RvbURyb3Bkb3duIl0nKS5vbigndGFwIGNsaWNrJywgY2hlY2tTaXplKTsNCgkNCgkJJCgnLmN1c3RvbURyb3Bkb3duJykub24oJ2RDbG9zZScsIGRDbG9zZSk7DQoJCSQoJy5jdXN0b21Ecm9wZG93bicpLm9uKCdkT3BlbicsIGRPcGVuKTsNCgkJJChkb2N1bWVudCkub24oJ3RhcCBjbGljaycsIGNsZWFyRHJvcGRvd25zKTsNCgkJJCgnLmN1c3RvbURyb3Bkb3duJykub24oJ3RhcCBjbGljaycsIGZ1bmN0aW9uKGUpew0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsNCg0KCQl9KTsNCgl9Ow0KDQoJdmFyIGNoZWNrU2l6ZSA9IGZ1bmN0aW9uKGUpew0KCQkvLyBpZigkKHdpbmRvdykud2lkdGgoKSA+IDc2Nyl7DQoJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQllLnN0b3BQcm9wYWdhdGlvbigpOw0KCQkJbm9ybWFsRHJvcGRvd24odGhpcyk7DQoJCS8vIH0gZWxzZSB7DQoJCS8vIAltb2JpbGVEcm9wZG93bih0aGlzKTsNCgkJLy8gfQ0KCX07DQoJdmFyIGNsZWFyRHJvcGRvd25zID0gZnVuY3Rpb24oZSl7DQoJCXZhciBjb250YWluZXIgPSAkKCIuY3VzdG9tRHJvcGRvd24iKTsNCgkgICAgaWYgKCFjb250YWluZXIuaXMoZS50YXJnZXQpIC8vIGlmIHRoZSB0YXJnZXQgb2YgdGhlIGNsaWNrIGlzbid0IHRoZSBjb250YWluZXIuLi4NCgkgICAgICAgICYmIGNvbnRhaW5lci5oYXMoZS50YXJnZXQpLmxlbmd0aCA9PT0gMCkgLy8gLi4uIG5vciBhIGRlc2NlbmRhbnQgb2YgdGhlIGNvbnRhaW5lcg0KCSAgICB7DQoJICAgICAgICAkZHJvcGRvd25zID0gJCgnLmN1c3RvbURyb3Bkb3duJyk7DQoJCQkkZHJvcGRvd25zLnRyaWdnZXIoJ2RDbG9zZScpOw0KCSAgICB9DQoJfTsNCgl2YXIgbm9ybWFsRHJvcGRvd24gPSBmdW5jdGlvbih0YXJnZXQpew0KCQkkZHJvcGRvd24gPSAkKHRhcmdldCkucGFyZW50KCk7DQoNCgkJJGRyb3Bkb3ducyA9ICQoJy5jdXN0b21Ecm9wZG93bicpOw0KCQlpZigkZHJvcGRvd24uaGFzQ2xhc3MoJ29wZW4nKSl7DQoJCQkkZHJvcGRvd24udHJpZ2dlcignZENsb3NlJyk7DQoJCX0gZWxzZSB7DQoJCQkkZHJvcGRvd25zLm5vdCgkZHJvcGRvd24pLnRyaWdnZXIoJ2RDbG9zZScpOw0KCQkJJGRyb3Bkb3duLnRyaWdnZXIoJ2RPcGVuJyk7DQoJCX0NCgl9Ow0KCXZhciBkQ2xvc2UgPSBmdW5jdGlvbihlKXsNCgkJZS5zdG9wUHJvcGFnYXRpb24oKTsNCgkJJHRoaXMgPSAkKHRoaXMpOw0KCQkkdGhpcy5yZW1vdmVDbGFzcygnb3BlbicpOw0KCX07DQoNCgl2YXIgZE9wZW4gPSBmdW5jdGlvbihlKXsNCgkJJHRoaXMgPSAkKHRoaXMpOw0KCQkkdGhpcy5hZGRDbGFzcygnb3BlbicpOw0KCX07DQoNCglyZXR1cm4gew0KCQlpbml0OiBpbml0DQoJfTsNCn0oKSk7Cn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ey8vIFRoaXMgaXMgcGxhY2Vob2xkZXIgY29kZSB0byBkZW1vbnN0cmF0ZSBmaWx0ZXIgZnVuY3Rpb25hbGl0eQ0KLy8gSXQgYmFzaWNhbGx5IGFkZHMgYSBidW5jaCBvZiBoYW5kbGVycyB0byBmaXJlIG1vY2stQUpBWCBjYWxscyBhbmQgdXBkYXRlIHRoZSBmaWx0ZXIgYnJlYWRjcnVtYnMNCi8vIFRoaXMgaGFzIGEgZGVwZW5kZW5jeSBvbiBpQ2hlY2sNCg0KDQpGaWx0ZXJzID0gKGZ1bmN0aW9uKCl7DQogIHZhciBmaWx0ZXJUaXRsZXMgPSB7fTsNCgl2YXIgaW5pdCA9IGZ1bmN0aW9uKCl7DQoJCXZhciAkaW5wdXRzID0gJCgnLmZpbHRlci1vcHRpb25zIGlucHV0W3R5cGU9ImNoZWNrYm94Il0nKTsNCgkJaWYoJGlucHV0cy5sZW5ndGgpew0KCQkJYWRkSGFuZGxlcnMoJGlucHV0cyk7DQoJCX0NCgl9Ow0KDQogIHZhciBhZGRIYW5kbGVycyA9IGZ1bmN0aW9uKCRpbnB1dHMpew0KICAgICRpbnB1dHMub24oJ2NoYW5nZScsIGFwcGx5RmlsdGVyKTsNCiAgICAkKCdbZGF0YS1maWx0ZXI9ImNsZWFyIl0nKS5vbigndGFwIGNsaWNrJywgY2xlYXJGaWx0ZXJzKTsNCiAgICAkKCdbZGF0YS1maWx0ZXI9ImFsbCJdJykub24oJ2NoYW5nZScsIGNsZWFyU2libGluZ0ZpbHRlcnMpOw0KICAgICQoJyNmaWx0ZXItZm9ybScpLm9uKCdzdWJtaXQnLCBzdWJtaXRGaWx0ZXJzKTsNCiAgICAkKCcuZXhwYW5kYWJsZScpLm9uKCd0YXAgY2xpY2snLCBleHBhbmQpOw0KICAgICQoJ1tkYXRhLW1vcmVdJykub24oJ3RhcCBjbGljaycsIGV4cGFuZExldmVsKTsNCiAgICAkKCcjZmlsdGVyLXRyaWdnZXInKS5vbigndGFwIGNsaWNrJywgc2hvd01vYmlsZSk7DQogICAgJCgnI2ZpbHRlci1jbG9zZScpLm9uKCd0YXAgY2xpY2snLCBzaG93TW9iaWxlKTsNCiAgICBpZiAod2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsNCiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIGZ1bmN0aW9uKCl7DQogICAgICAgIGlmICh3aW5kb3cuaW5uZXJXaWR0aCA+IDgwMCl7DQogICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ2hwLWZpbHRlci1vcGVuJyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgaWYgKCQoJy5maWx0ZXJzLm9wZW4nKS5sZW5ndGgpIHsNCiAgICAgICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygnaHAtZmlsdGVyLW9wZW4nKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0NCiAgfTsNCg0KICB2YXIgYXBwbHlGaWx0ZXIgPSBmdW5jdGlvbihlKXsNCiAgICAvLyBtYWtlIGFqYXggY2FsbA0KICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpOw0KICAgIGlmKCRpbnB1dC5pcygnW2RhdGEtZmlsdGVyPSJhbGwiXScpKXsNCiAgICAgICQoJyNmaWx0ZXItZm9ybScpLnN1Ym1pdCgpOw0KICAgIH0gZWxzZSB7DQogICAgICAkaW5wdXQucGFyZW50cygnLmZpbHRlci1jYXRlZ29yeScpLmZpbmQoJ1tkYXRhLWZpbHRlcj0iYWxsIl0nKS5pY2hlY2soJ3VuY2hlY2tlZCcpOw0KICAgICAgJCgnI2ZpbHRlci1mb3JtJykuc3VibWl0KCk7DQogICAgfQ0KICB9Ow0KDQogIHZhciBleHBhbmQgPSBmdW5jdGlvbihlKXsNCiAgICB2YXIgJGV4cGFuZGVyID0gJCh0aGlzKTsNCiAgICBpZigkZXhwYW5kZXIuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpew0KICAgICAgJGV4cGFuZGVyLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpOw0KICAgICAgJGV4cGFuZGVyLmZpbmQoImFbZGF0YS1leHBhbmRhYmxlXSIpLmF0dHIoImFyaWEtZXhwYW5kZWQiLCJmYWxzZSIpOw0KICAgICAgJGV4cGFuZGVyLnNpYmxpbmdzKCcuZmlsdGVyLW9wdGlvbnMtbmVzdGVkJykuaGlkZSgpOw0KICAgIH0gZWxzZSB7DQogICAgICAkZXhwYW5kZXIuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7DQogICAgICAkZXhwYW5kZXIuc2libGluZ3MoJy5maWx0ZXItb3B0aW9ucy1uZXN0ZWQnKS5zaG93KCk7DQogICAgICAkZXhwYW5kZXIuZmluZCgiYVtkYXRhLWV4cGFuZGFibGVdIikuYXR0cigiYXJpYS1leHBhbmRlZCIsInRydWUiKTsNCiAgICB9DQogIH07DQoNCiAgdmFyIGV4cGFuZExldmVsID0gZnVuY3Rpb24oZSl7DQogICAgdmFyICRleHBhbmRlciA9ICQodGhpcyk7DQogICAgdmFyIGdyb3VwID0gJCh0aGlzKS5kYXRhKCdtb3JlJyk7DQogICAgdmFyIHRleHQ7DQogICAgaWYoJGV4cGFuZGVyLmhhc0NsYXNzKCdpbicpKXsNCiAgICAgICQoJy4nK2dyb3VwKS5zaG93KCk7DQogICAgICB0ZXh0ID0gJGV4cGFuZGVyLnRleHQoKTsNCiAgICAgICRleHBhbmRlci50ZXh0KCRleHBhbmRlci5kYXRhKCd0ZXh0JykpLnJlbW92ZUNsYXNzKCdpbicpOw0KICAgICAgJGV4cGFuZGVyLmRhdGEoJ3RleHQnLHRleHQpOw0KDQogICAgfSBlbHNlIHsNCiAgICAgICQoJy4nK2dyb3VwKS5oaWRlKCk7DQogICAgICB0ZXh0ID0gJGV4cGFuZGVyLnRleHQoKTsNCiAgICAgICRleHBhbmRlci50ZXh0KCRleHBhbmRlci5kYXRhKCd0ZXh0JykpLmFkZENsYXNzKCdpbicpOyAgDQogICAgICAkZXhwYW5kZXIuZGF0YSgndGV4dCcsdGV4dCk7DQogICAgfQ0KICAgIA0KICB9Ow0KDQogIHZhciBzaG93TW9iaWxlID0gZnVuY3Rpb24oZSl7DQogICAgdmFyICRmaWx0ZXJzID0gJCgnI2ZpbHRlci1mb3JtJyk7DQogICAgaWYoJGZpbHRlcnMuaGFzQ2xhc3MoJ29wZW4nKSl7DQogICAgICANCiAgICAgDQogICAgICAkZmlsdGVycy5jc3MoJy13ZWJraXQtdHJhbnNpdGlvbicsICdhbGwgMzAwbXMgZWFzZS1pbi1vdXQnKTsNCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCiAgICAgICAgJGZpbHRlcnMucmVtb3ZlQXR0cignc3R5bGUnKTsNCiAgICAgIH0sIDMwMCk7DQogICAgICANCiAgICAgICRmaWx0ZXJzLnJlbW92ZUNsYXNzKCdvcGVuJyk7DQogICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ2hwLWZpbHRlci1vcGVuJyk7DQogICAgfSBlbHNlIHsNCiAgICAgICRmaWx0ZXJzLmFkZENsYXNzKCdvcGVuJyk7DQogICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ2hwLWZpbHRlci1vcGVuJyk7DQogICAgfQ0KICB9Ow0KDQogIHZhciBzdWJtaXRGaWx0ZXJzID0gZnVuY3Rpb24oZSl7DQogICAgdmFyIHVybCA9ICIjIjsgLy8gdGhlIHNjcmlwdCB3aGVyZSB5b3UgaGFuZGxlIHRoZSBmb3JtIGlucHV0Lg0KICAgIC8vZG8gbm90IHVuY29tbWVudCAtIFJpY2hhICQoJyNsb2FkaW5nLXJlc3VsdHMnKS5zaG93KCk7DQogICAgdmFyICRmaWx0ZXJMaXN0ID0gJCgnLmFwcGxpZWQtZmlsdGVycycpOw0KICAgIHZhciAkZmlsdGVyQ2xlYXIgPSAkKCcjZmlsdGVyLWNsZWFyJyk7DQogICAgLy92YXIgJHNjZiA9ICQoJyNzY2YnKTsNCiAgICAkZmlsdGVyTGlzdC5maW5kKCdsaSwgdWwnKS5yZW1vdmUoKTsNCiAgICAvLyQoJyNzY2YgbGknKS5yZW1vdmUoJ2xpJyk7DQogICAgdmFyIG51bUZpbHRlcnMgPSAwOw0KICAgIC8vdmFyICRjbGVhckJ1dHRvbiA9ICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJykpLmFkZENsYXNzKCdhcHBsaWVkLWZpbHRlcnMtaXRlbScpLmF0dHIoJ2RhdGEtZmlsdGVyJywnY2xlYXInKTsNCiAgICAkKCcuZmlsdGVyLW9wdGlvbnMgaW5wdXRbdHlwZT0iY2hlY2tib3giXScpLm5vdCgnW2RhdGEtZmlsdGVyPSJhbGwiXScpLmVhY2goZnVuY3Rpb24oKXsNCiAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpOw0KICAgICAgaWYoJGlucHV0LnByb3AoJ2NoZWNrZWQnKSl7DQogICAgICAgIHZhciAkdGFnID0gJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpKTsNCiAgICAgICAgdmFyICRidXR0b24gPSAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpKTsNCiAgICAgICAgdmFyIHBhcmVudFRpdGxlID0gJCh0aGlzKS5wYXJlbnRzKCcuZmlsdGVyLWNhdGVnb3J5JykuY2hpbGRyZW4oJy5maWx0ZXItdGl0bGUnKS5odG1sKCk7DQogICAgICAgIHZhciB0aXRsZTsNCiAgICAgICAgdmFyIGNhdGVnb3J5TGlzdDsNCiAgICAgICAgLy92YXIgJHRvcDsNCiAgICAgICAgJGJ1dHRvbi5hZGRDbGFzcygnZmlsdGVyLWNsb3NlIGljb24nKS5hdHRyKCdyZWYnLCAkaW5wdXQuYXR0cignY2xhc3MnKS5zcGxpdCgnICcpLnBvcCgpKTsNCiAgICAgICAgJHRhZy50ZXh0KCQodGhpcykucGFyZW50cygnbGFiZWwnKS50ZXh0KCkpLmF0dHIoJ3JlZicsICRpbnB1dC5hdHRyKCdjbGFzcycpLnNwbGl0KCcgJykucG9wKCkpLmFkZENsYXNzKCdhcHBsaWVkLWZpbHRlcnMtaXRlbScpLnByZXBlbmQoJGJ1dHRvbik7DQogICAgICAgIGlmICgkKCcuZmlsdGVyLXNlbGVjdGVkLXRpdGxlW2RhdGEtc2VsZWN0ZWQtdGl0bGU9IicgKyBwYXJlbnRUaXRsZSArICciXScpLmxlbmd0aCl7DQogICAgICAgICAgJCgnLmZpbHRlci1zZWxlY3RlZC10aXRsZVtkYXRhLXNlbGVjdGVkLXRpdGxlPSInICsgcGFyZW50VGl0bGUgKyAnIl0nKS5hcHBlbmQoJHRhZyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgdGl0bGUgPSAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJykpLmh0bWwocGFyZW50VGl0bGUpOw0KICAgICAgICAgIGNhdGVnb3J5TGlzdCA9ICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKSkuYWRkQ2xhc3MoJ2ZpbHRlci1zZWxlY3RlZC10aXRsZScpLmF0dHIoJ2RhdGEtc2VsZWN0ZWQtdGl0bGUnLHBhcmVudFRpdGxlKS5hcHBlbmQodGl0bGUpLmFwcGVuZCgkdGFnKTsNCiAgICAgICAgICAkZmlsdGVyTGlzdC5hcHBlbmQoY2F0ZWdvcnlMaXN0KTsNCiAgICAgICAgfQ0KICAgICAgICBTQ0YuaW5pdEVsZW0oJHRhZyk7DQogICAgICAgIC8vQWRkaW5nIGZpbHRlciBvbiB0b3ANCiAgICAgICAgLy8kdG9wID0gJHRhZy5jbG9uZSgpLnJlbW92ZUNsYXNzKCdoaWRkZW4tbGcnKTsNCiAgICAgICAgLy8kc2NmLmFwcGVuZCgkdG9wLnJlbW92ZUNsYXNzKCdoaWRkZW4tbGcnKVswXSk7DQogICAgICAgIC8vU0NGLmluaXRFbGVtKCR0b3ApOw0KICAgICAgICBudW1GaWx0ZXJzICs9IDE7DQogICAgICB9DQogICAgICBpZihudW1GaWx0ZXJzID09PSAwKXsNCiAgICAgICAgJCgnI2ZpbHRlci1iYWRnZScpLnRleHQoJycpOw0KICAgICAgICAvLyRzY2YubmV4dCgpLmhpZGUoKS5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7ICANCiAgICAgIH0gZWxzZSB7DQogICAgICAgICQoJyNmaWx0ZXItYmFkZ2UnKS50ZXh0KG51bUZpbHRlcnMpOw0KICAgICAgICAvLyRzY2YubmV4dCgpLnNob3coKS5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpOw0KICAgICAgfQ0KICAgIH0pOw0KICAgICQoJyNmaWx0ZXItdHJpZ2dlciBzcGFuJykucmVtb3ZlKCk7DQogICAgaWYgKG51bUZpbHRlcnMgPiAwKXsNCiAgICAgICRmaWx0ZXJMaXN0LnNob3coKTsNCiAgICAgICQoJyNmaWx0ZXItdHJpZ2dlcicpLmFwcGVuZCgnPHNwYW4+ICgnKyBudW1GaWx0ZXJzICsnKTwvc3Bhbj4nKTsNCiAgICAgICQoJyNmaWx0ZXItdGl0bGUnKS5jc3MoJ2Rpc3BsYXknLCdpbmxpbmUnKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAkZmlsdGVyTGlzdC5oaWRlKCk7DQogICAgICAkKCcjZmlsdGVyLXRpdGxlJykuaGlkZSgpOw0KICAgICAgJCgnI2ZpbHRlci10cmlnZ2VyJykucmVtb3ZlKCdzcGFuJyk7DQogICAgfQ0KICAgIGlmIChudW1GaWx0ZXJzID49IDMpIHsNCiAgICAgICRmaWx0ZXJDbGVhci5zaG93KCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgJGZpbHRlckNsZWFyLmhpZGUoKTsNCiAgICB9DQogIC8qZG8gbm90IHVuY29tbWVudCAtIFJpY2hhICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQogICAgICAkLmFqYXgoew0KICAgICAgIHR5cGU6ICJQT1NUIiwNCiAgICAgICB1cmw6IHVybCwNCiAgICAgICBkYXRhOiAkKCIjZmlsdGVyLWZvcm0iKS5zZXJpYWxpemUoKSwgLy8gc2VyaWFsaXplcyB0aGUgZm9ybSdzIGVsZW1lbnRzLg0KICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpDQogICAgICAgew0KICAgICAgICAgICQoJyNsb2FkaW5nLXJlc3VsdHMnKS5oaWRlKCk7DQogICAgICAgfSwNCiAgICAgICBlcnJvcjogZnVuY3Rpb24oZGF0YSl7DQogICAgICAgICAgJCgnI2xvYWRpbmctcmVzdWx0cycpLmhpZGUoKTsNCiAgICAgICB9DQogICAgIH0pOw0KICAgIH0sIDEwMDApOyAqLw0KICAgIHJldHVybiBmYWxzZTsNCiAgfTsNCiAgdmFyIGNsZWFyRmlsdGVycyA9IGZ1bmN0aW9uKGUpew0KICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICB2YXIgJGlucHV0cyA9ICQoJy5maWx0ZXItb3B0aW9ucyBpbnB1dFt0eXBlPSJjaGVja2JveCJdJyk7DQogICAgJCgnLmFwcGxpZWQtZmlsdGVycyBsaScpLnJlbW92ZSgpOw0KICAgICRpbnB1dHMubm90KCdbZGF0YS1maWx0ZXI9ImFsbCJdJykuaWNoZWNrKCd1bmNoZWNrZWQnKTsNCiAgICB2YXIgJGFsbCA9ICQoJ1tkYXRhLWZpbHRlcj0iYWxsIl0nKTsNCiAgICAkYWxsLmF0dHIoJ2NoZWNrZWQnLCAnY2hlY2tlZCcpLnBhcmVudCgnbGFiZWwnKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsNCiAgICBhcHBseUZpbHRlcigpOw0KICB9Ow0KICB2YXIgY2xlYXJTaWJsaW5nRmlsdGVycyA9IGZ1bmN0aW9uKGUpew0KICAgIHZhciAkYWxsID0gJCh0aGlzKTsNCiAgICBpZigkYWxsLmF0dHIoJ2NoZWNrZWQnKSl7DQogICAgICB2YXIgJGlucHV0cyA9ICRhbGwucGFyZW50cygnLmZpbHRlci1vcHRpb25zJykuZmluZCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXScpOw0KICAgICAgJGlucHV0cy5ub3QoJGFsbCkuaWNoZWNrKCd1bmNoZWNrZWQnKTsNCiAgICAgIGFwcGx5RmlsdGVyKCk7DQogICAgfQ0KICB9Ow0KCXJldHVybiB7DQoJCWluaXQ6IGluaXQNCgl9Ow0KfSgpKTsNCgp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvL1RoZXNlIGVsZW1lbnRzIGFyZSBjcmVhdGVkIGZyb20gZmlsdGVycy5qcyBieSBjbGlja2luZyB0aGUgaW5wdXQgZmlsdGVycw0KU0NGID0gKGZ1bmN0aW9uKCl7DQoJdmFyIGluaXQgPSBmdW5jdGlvbigpew0KCQl2YXIgJHRvZ2dsZXM7DQoJCWlmICgkKCcuYXBwbGllZC1maWx0ZXJzLWl0ZW0nKS5sZW5ndGgpIHsNCgkJCSR0b2dnbGVzID0gJCgnLmFwcGxpZWQtZmlsdGVycy1pdGVtJykuZmluZCgnLmZpbHRlci1jbG9zZScpOw0KCQkJYWRkSGFuZGxlcnMoJHRvZ2dsZXMpOw0KCQl9DQoJfTsNCg0KCXZhciBpbml0RWxlbSA9IGZ1bmN0aW9uKCRlbCl7DQoJCWFkZEhhbmRsZXJzKCRlbC5maW5kKCcuZmlsdGVyLWNsb3NlJykpOw0KCX07DQoNCgl2YXIgYWRkSGFuZGxlcnMgPSBmdW5jdGlvbigkdG9nZ2xlcyl7DQoJCSR0b2dnbGVzLm9uKCdjbGljaycsIGNsb3NlKTsNCgl9Ow0KDQoJdmFyIGNsb3NlID0gZnVuY3Rpb24oZSl7DQoJCXZhciAkdGFyZ2V0ID0gJChlLmN1cnJlbnRUYXJnZXQpOw0KCQl2YXIgJHBhcmVudCA9ICR0YXJnZXQucGFyZW50KCk7DQoJCXZhciAkaW5wdXQ7DQoJCSRpbnB1dCA9ICQoJyNmaWx0ZXItZm9ybSBpbnB1dC5pY2hlY2tcXFsnICsgJHRhcmdldC5hdHRyKCdyZWYnKS5zcGxpdCgnWycpLnBvcCgpLnNwbGl0KCddJykuc2hpZnQoKSArICdcXF0nKTsNCgkJJGlucHV0LnByb3AoJ2NoZWNrZWQnLCBmYWxzZSkuY2hhbmdlKCk7DQoJCWNvbnNvbGUubG9nKCRpbnB1dC5wcm9wKCdjaGVja2VkJykpOw0KCQlpZiAoJHRhcmdldC5wcm9wKCd0YWdOYW1lJykgPT09ICdMSScpew0KCQkJJHRhcmdldC5yZW1vdmUoKTsNCgkJfQ0KCQllbHNlIGlmICgkcGFyZW50LnByb3AoJ3RhZ05hbWUnKSA9PT0gJ0xJJyl7DQoJCQkkcGFyZW50LnJlbW92ZSgpOw0KCQl9DQoJfTsNCglyZXR1cm4gew0KCQlpbml0OiBpbml0LA0KCQlpbml0RWxlbTogaW5pdEVsZW0NCgl9Ow0KfSkoKTsKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7UGFnaW5hdGlvbiA9IChmdW5jdGlvbigpew0KDQogICAgdmFyICRwYWdDb250YWluZXIsDQogICAgICAgICRjb250ZW50U2VsZWN0b3IsDQogICAgICAgICRjb250cm9scywNCiAgICAgICAgY29udHJvbFRyaWdnZXJzLA0KICAgICAgICBtYXhSZXN1bHRzLA0KICAgICAgICB0b3RhbFJlc3VsdHM7DQoNCiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCl7DQogICAgICAgICRwYWdDb250YWluZXIgPSAkKCcucGFnaW5hdGlvbi1jb250YWluZXInKTsNCiAgICAgICAgaWYoJHBhZ0NvbnRhaW5lci5sZW5ndGgpew0KICAgICAgICAgICAgJGNvbnRlbnRTZWxlY3RvciA9ICQoJy5wYWdpbmF0aW9uLWNvbnRhaW5lciBsaScpOw0KICAgICAgICAgICAgJGNvbnRyb2xzID0gJCgnLnBhZ2luYXRpb24nKTsNCiAgICAgICAgICAgIGNvbnRyb2xUcmlnZ2VycyA9ICcucGFnaW5hdGlvbiBsaSBhJzsNCiAgICAgICAgICAgIG1heFJlc3VsdHMgPSAxMDsNCiAgICAgICAgICAgIHRvdGFsUmVzdWx0cyA9ICRjb250ZW50U2VsZWN0b3IubGVuZ3RoOw0KICAgICAgICAgICAgcmVuZGVyQ29udHJvbHMoKTsNCg0KICAgICAgICB9DQogICAgfTsNCg0KICAgIHZhciByZW5kZXJDb250cm9scyA9IGZ1bmN0aW9uKCl7DQogICAgICAgIC8vIA0KICAgICAgICAvLyBUSElTIE1PRFVMRSBJUyBTVElMTCBJTiBQUk9DRVNTDQogICAgICAgIC8vIA0KICAgICAgICAvLyANCiAgICB9Ow0KDQogICAgcmV0dXJuIHsNCiAgICAgICAgaW5pdDogaW5pdA0KICAgIH07DQp9KCkpOwp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvLyBUaGlzIGlzIHRvIGRlbW9uc3RyYXRlIGZ1bmN0aW9uYWxpdHkgb2YgdGhlIGRlcGVuZGVudCBzZWxlY3QgYm94ZXMNCi8vIHdoZW5ldmVyIGEgY2hhbmdlIGlzIG1hZGUgaW4gYSBwYXJlbnQgc2VsZWN0IGJveCwgYW4gYWpheCBjYWxsIG5lZWRzIHRvIGZpcmUNCi8vIHRvIHB1bGwgaW4gdGhlIG5leHQgc2V0IG9mIG9wdGlvbnMgYXZhaWxhYmxlDQovLyB0aGlzIGlzIGRlcGVuZGFudCBvbiB0aGUgZmFuY3kgc2VsZWN0IHBsdWdpbg0KDQphamF4U2VsZWN0ID0gKGZ1bmN0aW9uKCl7DQoNCgkvLyBjcmVhdGUgYSBibGFuayBpbWFnZSBvYmplY3QgdG8gcmVzZXJ2ZXIgZm9yIG91ciBsb2FkZXIgZ2lmDQoJdmFyIGxvYWRlckdpZiA9IG5ldyBJbWFnZSgpOw0KDQoJLy8gDQoJdmFyIGluaXQgPSBmdW5jdGlvbigpew0KCQkvLyBncmFiIGFsbCBvdXIgaW5zdGFuY2VzDQoJCXZhciAkYWpheFNlbGVjdHMgPSAkKCdbZGF0YS1jbGFzcz0iYWpheC1zZWxlY3QiXScpOw0KCQl2YXIgJGZhbmN5U2VsZWN0cyA9ICQoJy5mYW5jeS1zZWxlY3QnKTsNCgkJaWYoJGFqYXhTZWxlY3RzLmxlbmd0aCl7DQoJCQkvLyBhZGQgaGFuZGxlcnMNCgkJCWFkZEhhbmRsZXJzKCRhamF4U2VsZWN0cywgJGZhbmN5U2VsZWN0cyk7DQoNCgkJCS8vIHRoaXMgaXMgZHVtbXkgY2FsbA0KCQkJZmFrZUl0KCk7DQoNCgkJCS8vIHNldCB0aGUgaW1hZ2Ugb2JqZWN0J3Mgc3JjDQoJCQlsb2FkZXJHaWYuc3JjID0gKCdfL2ltYWdlcy9pLXByZS1zbS1ocGUuZ2lmJyk7DQoJCQkkKGxvYWRlckdpZikuYWRkQ2xhc3MoJ3NlbGVjdC1sb2FkZXInKTsNCg0KCQkJLy8gYXBwZW5kIGEgbG9hZGVyIGdpZCBiZWZvcmUgZWFjaCBpbnN0YW5jZSBvZiB0aGUgc3VibWl0IGJ1dHRvbiBvciBpZiBubyBzdWJtaXQgYnV0dG9uDQoJCQkvLyBhZnRlciBhbGwgdGhlIHNlbGVjdCBib3hlcw0KCQkJJCgnLmRlcGVuZGFudC1zZWxlY3QnKS5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkJaWYoJCh0aGlzKS5maW5kKCdpbnB1dFt0eXBlPSJzdWJtaXQiXScpLmxlbmd0aCl7DQoJCQkJCSQodGhpcykuZmluZCgnaW5wdXRbdHlwZT0ic3VibWl0Il0nKS5iZWZvcmUobG9hZGVyR2lmKTsJDQoJCQkJfSBlbHNlIHsNCgkJCQkJJCh0aGlzKS5hcHBlbmQoJChsb2FkZXJHaWYpLmNsb25lKCkpOw0KCQkJCX0NCgkJCX0pOw0KCQl9DQoJfTsNCg0KCS8vIGFkZCBvdXIgaGFuZGxlcnMNCgl2YXIgYWRkSGFuZGxlcnMgPSBmdW5jdGlvbigkYWpheFNlbGVjdHMsICRmYW5jeVNlbGVjdHMpew0KCQkvLyBjaGFuZ2UuZnMgaXMgYW4gZXZlbnQgcHJvdmlkZWQgdG8gdXMgYnkgZmFuY3kgc2VsZWN0DQoJCSRhamF4U2VsZWN0cy5vbignY2hhbmdlLmZzJywgY2FsbE5leHRMZXZlbCk7DQoJCSRmYW5jeVNlbGVjdHMub24oJ29wZW4nLCBvcGVuKTsNCgl9Ow0KCS8vIHZhciBvcGVuID0gZnVuY3Rpb24oZSl7DQoJCQ0KCS8vIH0NCg0KCS8vIFRoaXMgaXMgYSBkdW1teSBjYWxsIHRvIGhpZGUgYWxsIHRoZSByZXN1bHRzIG9uIG9uZSBvZiB0aGUgdGFicyBpbiBQRFAsIGFzIHdlbGwgYXMgaGlkZSBhbGwgdGhlIA0KCS8vIGRlcGVuZGFudCBzZWxlY3Qgd291bGQgb3RoZXJ3aXNlIG5vdCBiZSB2aXNpYmxlL3JldHVybmVkIGJ5IHRoZXIgc2VydmVyIHlldA0KCXZhciBmYWtlSXQgPSBmdW5jdGlvbigpew0KCQkkKCcudHJvdWJsZXNob290LXJlc3VsdHMnKS5oaWRlKCk7DQoJCS8vIEhpZGUgYWxsIHRoZSBzZWxlY3RzIGV4Y2VwdCB0aGUgZmlyc3QNCgkJJCgnLmRlcGVuZGFudC1zZWxlY3QnKS5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkkKHRoaXMpLmZpbmQoJy5mYW5jeS1zZWxlY3QuYWpheC1zZWxlY3QnKS5zbGljZSgxKS5oaWRlKCk7DQoJCX0pOw0KCQkvLyBNYWtlIGl0IHNvIHRoZSBmaXJzdCBkcm9wZG93biBpcyBleHBhbmRlZCBieSBkZWZhdWx0LiBvbWcgdGhpcyBpcyBzbyB1Z2x5IHdoeS4gbXVjaCBiYWQgdXguDQoJCSQoJy5kZXBlbmRhbnQtc2VsZWN0Lm9wZW4nKS5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkkKHRoaXMpLmZpbmQoJy5mYW5jeS1zZWxlY3QuYWpheC1zZWxlY3QnKS5maXJzdCgpLmNoaWxkcmVuKCkuYWRkQ2xhc3MoJ29wZW4nKTsNCgkJfSk7DQoJfTsNCg0KCS8vIHRoaXMgZmlyZXMgYWZ0ZXIgdGhlIGNoYW5nZSBldmVudCBvbiBhIGZhbmN5IHNlbGVjdCBib3gNCgl2YXIgY2FsbE5leHRMZXZlbCA9IGZ1bmN0aW9uKGUpew0KCQkvLyBzZXQgdXAgc29tZSB2YXJpYWJsZXMgZm9yIHRoZSBBSkFYIGNhbGwNCgkJdmFyICRzZWxlY3QgPSAkKHRoaXMpOw0KCQl2YXIgJHBhcmVudCA9ICRzZWxlY3QucGFyZW50KCk7DQoJCXZhciAkZm9ybSA9ICQodGhpcykucGFyZW50cygnZm9ybScpOw0KCQl2YXIgdXJsID0gJGZvcm0uYXR0cignYWN0aW9uJyk7DQoJCS8vIHNob3cgdGhlIGxvYWRlciB3aGlsZSB0aGUgQUpBWCBjYWxsIGlzIG1hZGUNCgkJaWYoICRzZWxlY3QucGFyZW50KCkubmV4dCgnLmZhbmN5LXNlbGVjdCcpLmxlbmd0aCl7DQoJICAgICAgICAkc2VsZWN0LnBhcmVudCgpLnNpYmxpbmdzKCcuc2VsZWN0LWxvYWRlcicpLmNzcyh7J2Rpc3BsYXknOiAnYmxvY2snfSk7DQoJCX0NCgkJZWxzZSB7DQoJCQkkc2VsZWN0LnBhcmVudCgpLnJlbW92ZUNsYXNzKCdsYXN0Jyk7DQoJCX0NCgkJLy8gdGhpcyB0aW1lb3V0IGZha2VzIHRoZSB0aW1lIGl0IHdvdWxkIHRha2UgZm9yIGFuIGFqYXggdG8gY29tcGxldGUNCgkJc2V0VGltZW91dChmdW5jdGlvbigpew0KCSAgICAgICQuYWpheCh7DQoJICAgICAgIHR5cGU6ICJQT1NUIiwNCgkgICAgICAgdXJsOiB1cmwsDQoJICAgICAgIGRhdGE6ICRmb3JtLnNlcmlhbGl6ZSgpLCAvLyBzZXJpYWxpemVzIHRoZSBmb3JtJ3MgZWxlbWVudHMuDQoJICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpDQoJICAgICAgIHsNCgkJCS8vIERPIFNPTUUgU1RVRkYgSU4gSEVSRSBUTyBCVUlMRCBPVVQgVEhFIE5FWFQgTEVWRUwncyBTRUxFQ1QgT1BUSU9OUyBCQVNFRCBPTiBEQVRBIFJFVFVSTkVEIEZST00gU0VSVkVSDQoJCQlpZiggJHNlbGVjdC5wYXJlbnQoKS5uZXh0KCcuZmFuY3ktc2VsZWN0JykubGVuZ3RoKXsNCgkJCQkkc2VsZWN0LnBhcmVudCgpLnJlbW92ZUNsYXNzKCdsYXN0Jyk7DQoJCQkJJHNlbGVjdC5wYXJlbnQoKS5uZXh0KCcuZmFuY3ktc2VsZWN0Jykuc2hvdygpLmFkZENsYXNzKCdsYXN0JykuY2hpbGRyZW4oJ3NlbGVjdCcpLmZvY3VzKCk7DQoJCQkJJHNlbGVjdC5wYXJlbnQoKS5zaWJsaW5ncygnLnNlbGVjdC1sb2FkZXInKS5oaWRlKCk7DQoJCQl9IGVsc2Ugew0KCQkJCSRzZWxlY3QucGFyZW50KCkuc2libGluZ3MoJy5zZWxlY3QtbG9hZGVyJykuaGlkZSgpOw0KCQkJCSQoJy50cm91Ymxlc2hvb3QtcmVzdWx0cycpLnNob3coKTsNCgkJCX0NCgkgICAgICAgfSwNCgkgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGRhdGEpew0KCSAgICAgICAJIGlmKCAkc2VsZWN0LnBhcmVudCgpLm5leHQoJy5mYW5jeS1zZWxlY3QnKS5sZW5ndGgpew0KCSAgICAgICAgICAJJHNlbGVjdC5wYXJlbnQoKS5uZXh0KCcuZmFuY3ktc2VsZWN0Jykuc2hvdygpOw0KCSAgICAgICAgICAJJHNlbGVjdC5wYXJlbnQoKS5yZW1vdmVDbGFzcygnbGFzdCcpOw0KCQkJCSRzZWxlY3QucGFyZW50KCkubmV4dCgnLmZhbmN5LXNlbGVjdCcpLnNob3coKS5hZGRDbGFzcygnbGFzdCcpOw0KCSAgICAgICAgICAJJGZvcm0uZmluZCgnLnNlbGVjdC1sb2FkZXInKS5oaWRlKCk7DQoJICAgICAgICAgIH0gZWxzZSB7DQoJICAgICAgICAgIAkkZm9ybS5maW5kKCcuc2VsZWN0LWxvYWRlcicpLmhpZGUoKTsNCgkgICAgICAgICAgCSQoJy50cm91Ymxlc2hvb3QtcmVzdWx0cycpLnNob3coKTsNCgkgICAgICAgICAgfQ0KCSAgICAgICB9DQoJICAgICB9KTsNCgkgICAgfSwgMTAwMCk7DQoJICAgIHJldHVybiBmYWxzZTsNCgl9Ow0KDQoJcmV0dXJuIHsNCgkJaW5pdDogaW5pdA0KCX07DQp9KCkpOw0KCn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5e25hcnJvd01vZGFsID0gKGZ1bmN0aW9uKCl7DQoNCiAgICB2YXIgJHJlc3VsdHNNb2RhbCwNCiAgICAgICAgJG5hcnJvd0Zvcm07DQoNCiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCl7DQogICAgICAgICRyZXN1bHRzTW9kYWwgPSAkKCcjcmVmaW5lLXJlc3VsdHMtbW9kYWwnKTsNCiAgICAgICAgaWYoJHJlc3VsdHNNb2RhbC5sZW5ndGgpew0KICAgICAgICAgICAgJG5hcnJvd0Zvcm0gPSAkKCcjbmFycm93LXJlc3VsdHMnKTsNCiAgICAgICAgICAgIGFkZEhhbmRsZXJzKCk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgdmFyIGFkZEhhbmRsZXJzID0gZnVuY3Rpb24oKXsNCiAgICAgICAgJG5hcnJvd0Zvcm0ub24oJ3N1Ym1pdCcsIGZldGNoUmVzdWx0cyk7DQogICAgfTsNCg0KICAgIHZhciBmZXRjaFJlc3VsdHMgPSBmdW5jdGlvbihlKXsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAkKCcjcmVmaW5lLXJlc3VsdHMtbW9kYWwnKS5tb2RhbCgndG9nZ2xlJyk7DQogICAgICAgIHZhciB1cmwgPSAkbmFycm93Rm9ybS5hdHRyKCdhY3Rpb24nKTsNCiAgICAgICAgJC5hamF4KHsNCiAgICAgICAgICAgdHlwZTogIlBPU1QiLA0KICAgICAgICAgICB1cmw6IHVybCwNCiAgICAgICAgICAgZGF0YTogJG5hcnJvd0Zvcm0uc2VyaWFsaXplKCksIC8vIHNlcmlhbGl6ZXMgdGhlIGZvcm0ncyBlbGVtZW50cy4NCiAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkNCiAgICAgICAgICAgew0KICAgICAgICAgICAgICAvL0hBTkRMRSBTVUNDRVNTDQogICAgICAgICAgIH0sDQogICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihkYXRhKXsNCiAgICAgICAgICAgICAgLy9IQU5ETEUgVEhFIEVSUk9SDQogICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9Ow0KDQogICAgcmV0dXJuIHsNCiAgICAgICAgaW5pdDogaW5pdA0KICAgIH07DQp9KCkpOwp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvLyBUaGlzIGlzIHBsYWNlaG9sZGVyIGNvZGUgZm9yIHByZWRpY2l0dmUgcmVzdWx0cyBpbiB0aGUgc2VhcmNoIGJhcg0KLy8gWW91IGNhbiBzZWUgdGhpcyBpbiBhY3Rpb24gb24gc2VhcmNoLnBocA0KLy8gQXMgb2YgY3VycmVudCwgdGhpcyBmdW5jdGlvbmFsaXR5IHdpbGwgaGFwcGVuIGlmIHRoZXJlIGlzIGEgI3ByZWRpY3RpdmUtcmVzdWx0cyBlbGVtZW50DQoNClNlYXJjaCA9IChmdW5jdGlvbigpew0KICAgIC8vIE1vZHVrbGUgdmFyaWFibGVzDQogICAgdmFyICRzZWFyY2hJbnB1dCwNCiAgICAgICAgJHByZWRpY3RpdmVMaXN0Ow0KICAgIC8vIENoZWNrIGlmIHdlIG5lZWQgdG8gaW5pdGlhbGl6ZQ0KICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKXsNCiAgICAgICAgJHNlYXJjaElucHV0ID0gJCgnI3NlYXJjaC1pbnB1dC5wcmVkaWN0aXZlJyk7DQogICAgICAgICRwcmVkaWN0aXZlTGlzdCA9ICQoJyNwcmVkaWN0aXZlLXJlc3VsdHMnKTsNCiAgICAgICAgaWYoJHNlYXJjaElucHV0Lmxlbmd0aCl7DQogICAgICAgICAgICBhZGRIYW5kbGVycygpOw0KICAgICAgICB9DQogICAgfTsNCiAgICAvLyBhZGQgb3VyIGhhbmRsZXJzDQogICAgdmFyIGFkZEhhbmRsZXJzID0gZnVuY3Rpb24oKXsNCiAgICAgICAgJHNlYXJjaElucHV0Lm9uKCdrZXlkb3duJywgc3dpdGNoVG9MaXN0KTsNCiAgICAgICAgJHNlYXJjaElucHV0Lm9uKCdmb2N1cycsIHNob3dMaXN0KTsNCiAgICAgICAgJHByZWRpY3RpdmVMaXN0Lm9uKCdrZXlkb3duJywnYScsIGNoZWNrS2V5bWFwKTsNCiAgICAgICAgJHByZWRpY3RpdmVMaXN0Lm9uKCdjbGljayB0YXAnLCdhJywgY2hhbmdlVmFsdWUpOw0KDQogICAgfTsNCiAgICAvLyBUaGlzIGNvZGUgd2lsbCBjaGFuZ2UgZm9jdXMgdG8gdGhlIGxpc3Qgd2hlbiB0aGUgdXNlciBoaXRzIHRoZSBkb3duIGFycm93DQogICAgdmFyIHN3aXRjaFRvTGlzdCA9IGZ1bmN0aW9uKGUpew0KICAgICAgICAvLyBDaGVjayBmb3IgZG93biBhcnJvdyBldmVudA0KICAgICAgICBpZihlLmtleUNvZGUgPT0gNDAgJiYgJHByZWRpY3RpdmVMaXN0Lmxlbmd0aCl7DQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAvLyBGaW5kIGZpcnN0IGxpIGluIHRoZSBsaXN0IGFuZCBmb2N1cyBpdCBhbmQgYWRkIGEgaG92ZXIgY2xhc3MNCiAgICAgICAgICAgIC8vIGluIHNvbWUgYnJvd3NlcnMsIHNpbXBseSBmb2N1c2luZyBhbiBlbGVtZW50IGRvZXMgbm90IGFkZCBhIGhvdmVyIHN0YXRlDQogICAgICAgICAgICAvLyBzbyB3ZSBuZWVkIHRvIGRvIHRoaXMgbWFudWxseQ0KICAgICAgICAgICAgJHByZWRpY3RpdmVMaXN0LmZpbmQoJ2xpOmZpcnN0IGEnKS50cmlnZ2VyKCdmb2N1cycpLmFkZENsYXNzKCdob3ZlcicpOw0KICAgICAgICB9DQogICAgfTsNCiAgICB2YXIgc2hvd0xpc3QgPSBmdW5jdGlvbihlKXsNCiAgICAgICAgLy8gU2ltcGxlIGNhbGwgdG8gc2hvdyB0aGUgbGlzdA0KICAgICAgICAkcHJlZGljdGl2ZUxpc3Quc2hvdygpOw0KICAgIH07DQoNCiAgICB2YXIgY2hlY2tLZXltYXAgPSBmdW5jdGlvbihlKXsNCiAgICAgICAgLy8gQSBzd2l0Y2ggc3RhdGVtZW50ISBXb3chDQogICAgICAgIHN3aXRjaChlLmtleUNvZGUpew0KICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZG93biBhcnJvdw0KICAgICAgICAgICAgY2FzZSA0MDoNCiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgcGFyZW50IGlzIG5vdCB0aGUgbGFzdCBlbGVtZW50DQogICAgICAgICAgICAgICAgaWYoISQodGhpcykucGFyZW50KCkuaXMoJzpsYXN0LWNoaWxkJykpew0KICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdob3ZlcicpLnBhcmVudCgpLm5leHQoKS5maW5kKCdhJykuZm9jdXMoKS5hZGRDbGFzcygnaG92ZXInKTsgICAgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vIGlmIGl0IGlzLCBub3RoaW5nIHNob3VsZCBoYXBwZW4NCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQoNCiAgICAgICAgICAgICAgICAvL1VQDQogICAgICAgICAgICAvLyBDaGVjayBpZiBwYXJlbnQgbGkgaXMgdGhlIGZpcnN0IGVsZW1lbnQNCiAgICAgICAgICAgIGNhc2UgMzg6DQogICAgICAgICAgICAgICAgaWYoJCh0aGlzKS5wYXJlbnQoKS5pcygnOmZpcnN0LWNoaWxkJykpew0KICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdob3ZlcicpOw0KICAgICAgICAgICAgICAgICAgICAvL2lmIGl0IGlzLCBmb2N1cyBvbiB0aGUgc2VhcmNoDQogICAgICAgICAgICAgICAgICAgICRzZWFyY2hJbnB1dC5mb2N1cygpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIC8vIGlmIGl0IGlzbnQsIHRoZW4gc2ltcGx5IGl0ZXJhdGUgdXAgdGhlIGxpc3QNCiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnaG92ZXInKS5wYXJlbnQoKS5wcmV2KCkuZmluZCgnYScpLmZvY3VzKCkuYWRkQ2xhc3MoJ2hvdmVyJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIC8vIENoZWNrIGlmICdlbnRlcicga2V5IGlzIHByZXNzZWQNCiAgICAgICAgICAgIGNhc2UgMTM6DQogICAgICAgICAgICAgICAgLy8gdHJpZ2dlciBhIGNsaWNrIGV2ZW50IHRvIHNlbGVjdCB0aGlzIHZhbHVlDQogICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnaG92ZXInKTsNCiAgICAgICAgICAgICAgICAkKHRoaXMpLnRyaWdnZXIoJ2NsaWNrJyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLy8gdGhpcyBpcyB0aGUgZnVuY3Rpb24gdGhhdCBzd2FwcyB0aGUgdmFsdWUgZnJvbSB0aGUgbGlzdCB0byBzZWFyY2ggYmFyDQogICAgdmFyIGNoYW5nZVZhbHVlID0gZnVuY3Rpb24oZSl7DQogICAgICAgICRzZWFyY2hJbnB1dC52YWwoJCh0aGlzKS50ZXh0KCkpOw0KICAgICAgICAkcHJlZGljdGl2ZUxpc3QuaGlkZSgpOw0KICAgIH07DQoNCiAgICByZXR1cm4gew0KICAgICAgICBpbml0OiBpbml0DQogICAgfTsNCn0oKSk7Cn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5e1Rvb2x0aXBzID0gKGZ1bmN0aW9uKCl7DQoNCgkNCgl2YXIgJG1vZGFsVGVtcGxhdGUgPSAkKCcjdG9vbHRpcC1tb2RhbCcpOw0KDQoJdmFyIGluaXQgPSBmdW5jdGlvbigpew0KCQlpZigkKCcuYmFkZ2UtdG9vbHRpcCcpLmxlbmd0aCB8fCAoJCgnLndpdGgtdG9vbHRpcCcpLmxlbmd0aCkpeyAvLyBEbyBub3QgcmVtb3ZlIC8gbW9kaWZ5IC0gVmFydW4uDQoJCQljaGVja0Jyb3dzZXIoKTsNCgkJfQ0KCX07DQoJdmFyIGNoZWNrQnJvd3NlciA9IGZ1bmN0aW9uKCl7DQoJCWlmKE1vZGVybml6ci50b3VjaCB8fCAkKHdpbmRvdykud2lkdGgoKTw3Njgpew0KCQkJYWRkVG91Y2hIYW5kbGVycygpOw0KCQl9IGVsc2Ugew0KCQkJYWRkVG91Y2hsZXNzSGFuZGxlcnMoKTsNCgkJfQ0KCX07DQoJdmFyIGFkZFRvdWNobGVzc0hhbmRsZXJzID0gZnVuY3Rpb24oKXsNCgkJJCgnLmJhZGdlLXRvb2x0aXAnKS5wb3BvdmVyKHsNCgkJCXRyaWdnZXI6ICdmb2N1cycsDQoJCQlodG1sOiB0cnVlLA0KCQkJY29udGFpbmVyOiAnYm9keScNCgkJfSkuY2xpY2soZnVuY3Rpb24oZSl7DQoJCQlpZighJCh0aGlzKS5pcygnOmZvY3VzJykpew0KCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQkkKHRoaXMpLmZvY3VzKCk7DQoJCQl9DQoJCX0pOw0KCQkkKCcud2l0aC10b29sdGlwJykucG9wb3Zlcih7DQoJCQl0cmlnZ2VyOiAnaG92ZXInLA0KCQkJaHRtbDogdHJ1ZSwNCgkJCWNvbnRhaW5lcjogJ2JvZHknDQoJCX0pLmNsaWNrKGZ1bmN0aW9uKGUpew0KCQkJaWYoISQodGhpcykuaXMoJzpmb2N1cycpKXsNCgkJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQkJJCh0aGlzKS5mb2N1cygpOw0KCQkJfQ0KCQkJDQoJCX0pOw0KCX07DQoJdmFyIGFkZFRvdWNoSGFuZGxlcnMgPSBmdW5jdGlvbigpew0KCQkkKCcuYmFkZ2UtdG9vbHRpcCcpLm9uKCd0YXAgY2xpY2snLCBidWlsZE1vZGFsKTsNCgl9Ow0KDQoJdmFyIGJ1aWxkTW9kYWwgPSBmdW5jdGlvbigpew0KCQl2YXIgJGJhZGdlID0gJCh0aGlzKTsNCgkJdmFyICRtb2RhbCA9ICQoJyN0b29sdGlwLW1vZGFsJyk7DQoJCWlmKCRiYWRnZS5kYXRhKCd0aXRsZScpKXsNCgkJCSRtb2RhbC5maW5kKCdoMycpLmVtcHR5KCkuaHRtbCgkYmFkZ2UuZGF0YSgndGl0bGUnKSkuc2hvdygpOwkNCgkJfSBlbHNlIHsNCgkJCSRtb2RhbC5maW5kKCdoMycpLmhpZGUoKTsNCgkJfQ0KCQlpZiAoJGJhZGdlLmRhdGEoJ2NvbnRlbnQnKSl7DQoJCQkkbW9kYWwuZmluZCgnLmNvbnRlbnQnKS5lbXB0eSgpLmh0bWwoJGJhZGdlLmRhdGEoJ2NvbnRlbnQnKSk7DQoJCQlzaG93TW9kYWwoKTsNCgkJfQ0KCX07DQoNCgl2YXIgc2hvd01vZGFsID0gZnVuY3Rpb24oKXsNCgkJJG1vZGFsVGVtcGxhdGUubW9kYWwoKTsNCgl9Ow0KDQoJcmV0dXJuIHsNCgkJaW5pdDogaW5pdA0KCX07DQp9KCkpOwp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXtDTEMgPSAoZnVuY3Rpb24oKXsNCg0KCXZhciBpbml0ID0gZnVuY3Rpb24oKXsNCg0KCQkvLyBBZnRlciBzZWxlY3RpbmcgYSBjb3VudHJ5LCANCgkJLy8gZGlzcGxheSB0aGF0IGNvdW50cnkgZmxhZyBhbmQgY291bnRyeSBuYW1lIGluIHRoZSBuZXh0IHN0ZXANCgkgICQoJyNjbGMtY2hvb3NlLWNvdW50cnkgLmNvdW50cnktb3B0aW9ucyBhJykub24oJ3RhcCBjbGljaycsIGZ1bmN0aW9uKGUpIHsNCgkgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KCSAgICB2YXIgc2VsZWN0ZWRDb3VudHJ5ID0gJCh0aGlzKS50ZXh0KCk7DQoJICAgIHZhciBzZWxlY3RlZENvdW50cnlGbGFnID0gJCh0aGlzKS5maW5kKCcuZmxhZycpLmF0dHIoJ2NsYXNzJyk7DQoJICAgIHZhciB0b3RhbExhbmd1YWdlcyA9ICQoJyNjbGMtY2hvb3NlLWxhbmd1YWdlIC5sYW5ndWFnZS1vcHRpb25zIGxpJykuc2l6ZSgpOw0KCSAgICAkKCcjY2xjLWNob29zZS1sYW5ndWFnZScpLmZpbmQoJyNzZWxlY3RlZENvdW50cnknKS50ZXh0KHNlbGVjdGVkQ291bnRyeSk7DQoJICAgICQoJyNjbGMtY2hvb3NlLWxhbmd1YWdlJykuZmluZCgnI3NlbGVjdGVkQ291bnRyeUZsYWcnKS5hZGRDbGFzcyhzZWxlY3RlZENvdW50cnlGbGFnKTsNCgkgICAgLy8gQ291bnQgdGhlIG51bWJlciBvZiBzdXBwb3J0ZWQgbGFuZ3VhZ2VzDQoJICAgIC8vIGFuZCBkaXNwbGF5IHRoZW0gaW4gdGhlIG1vZGFsLXRpdGxlDQoJICAgICQoJyN0b3RhbExhbmd1YWdlcycpLnRleHQodG90YWxMYW5ndWFnZXMpOw0KCSAgfSk7DQoNCgkgIC8vIFdoZW4gc3dpdGNoaW5nIGZyb20gQ291bnRyeSB0byBMYW5ndWFnZSwNCgkgIC8vIGNoYW5nZSB0aGUgc2l6ZSBvZiB0aGUgbW9kYWwgZnJvbSBtb2RhbC14bCB0byBtb2RhbC1zbQ0KCSAgJCgnLmNvdW50cnktb3B0aW9ucyBhJykub24oJ3RhcCBjbGljaycsIGZ1bmN0aW9uKGUpIHsNCgkgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KCSAgICAkKCcjY2xjLWNob29zZS1jb3VudHJ5JykuaGlkZSgpOw0KCSAgICAvLyAkKCcjY2xjLWNob29zZS1sYW5ndWFnZScpLnNob3coKTsNCgkgICAgJCgnI2NsYy1tb2RhbCcpLmZpbmQoJy5tb2RhbC1kaWFsb2cnKS5yZW1vdmVDbGFzcygnbW9kYWwteGwnKS5hZGRDbGFzcygnbW9kYWwtc20nKTsNCgkgIH0pOw0KDQoJICAvLyBXaGVuIHN3aXRjaGluZyBiYWNrIGZyb20gTGFuZ3VhZ2UgdG8gQ291bnRyeSwNCgkgIC8vIGNoYW5nZSB0aGUgc2l6ZSBvZiB0aGUgbW9kYWwgYmFjayB0byBtb2RhbC14bA0KCSAgJCgnI2NsYy1iYWNrJykub24oJ3RhcCBjbGljaycsIGZ1bmN0aW9uKGUpIHsNCgkgIAllLnByZXZlbnREZWZhdWx0KCk7DQoJICAJJCgnI2NsYy1jaG9vc2UtbGFuZ3VhZ2UnKS5oaWRlKCk7DQoJICAgICQoJyNjbGMtY2hvb3NlLWNvdW50cnknKS5zaG93KCk7DQoJICAgIC8vJCgnI2NsYy1tb2RhbCcpLmZpbmQoJy5tb2RhbC1kaWFsb2cnKS5yZW1vdmVDbGFzcygnbW9kYWwtc20nKS5hZGRDbGFzcygnbW9kYWwteGwnKTsvL2RvIG5vdCByZW1vdmUgdGhpcyAtIFByYXRpc2hhDQoJICB9KTsNCg0KCSAgLy8gQWZ0ZXIgY2xpY2tpbmcgb24gYSBzdXBwb3J0IGxhbmd1YWdlLA0KCSAgLy8gYWRkIHRoZSBzZWxlY3RlZCBsYW5ndWFnZSB0byB0aGUgQ29uZmlybSBidXR0b24gYW5kIGVuYWJsZSBpdA0KCSAgJCgnI2NsYy1jaG9vc2UtbGFuZ3VhZ2UgLmxhbmd1YWdlLW9wdGlvbnMgYScpLm9uKCd0YXAgY2xpY2snLCBmdW5jdGlvbihlKSB7DQoJICAgIGUucHJldmVudERlZmF1bHQoKTsNCgkgICAgJCgnI2NsYy1jaG9vc2UtbGFuZ3VhZ2UgLmxhbmd1YWdlLW9wdGlvbnMgYScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpOw0KCSAgICAkKHRoaXMpLmFkZENsYXNzKCdzZWxlY3RlZCcpOw0KCSAgICB2YXIgc2VsZWN0ZWRMYW5ndWFnZSA9ICQodGhpcykudGV4dCgpOw0KCSAgICAkKCcjc2VsZWN0ZWQtbGFuZ3VhZ2UnKS50ZXh0KHNlbGVjdGVkTGFuZ3VhZ2UpOw0KCSAgICAkKCcjY29uZmlybS1sYW5ndWFnZScpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7DQoJICB9KTsNCgl9Ow0KDQoJcmV0dXJuIHsNCgkJaW5pdDogaW5pdA0KCX07DQp9KCkpOwp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXtQU0YgPSAoZnVuY3Rpb24oKXsNCg0KCXZhciAkd2luZG93Ow0KCXZhciAkZm9vdGVyOw0KCXZhciAkcHNmOw0KCXZhciBwc2ZIZWlnaHQ7DQoNCgl2YXIgaW5pdCA9IGZ1bmN0aW9uKCl7DQoJCWlmKCQoJyNwc2YnKS5sZW5ndGgpew0KCQkJJHdpbmRvdyA9ICQod2luZG93KTsNCgkJCSRmb290ZXIgPSAkKCcjZm9vdGVyJyk7DQoJCQkkcHNmID0gJCgnI3BzZicpOw0KCQkJcHNmSGVpZ2h0ID0gJCgnI3BzZicpLmhlaWdodCgpOw0KCQkJYWRkSGFuZGxlcnMoKTsNCgkJCS8vJCgnI25vdGlmaWNhdGlvbnMtdHJpZ2dlcicpLnRyaWdnZXIoJ2NsaWNrJyk7ICAvL1BsZWFzZSBkbyBub3QgdW5jb21tZW50IHRoaXMuIFRoaXMgaXMgaGFuZGxlZCBpbiB0aGUgcG9ydGxldCB3aXRoIHNlc3Npb24NCgkJfQ0KCX07DQoJdmFyIGlzTW9iaWxlID0gZnVuY3Rpb24oKXsNCgkgIGlmKHZpZXdwb3J0KCkud2lkdGggPD0gODAwKXsNCgkgICAgcmV0dXJuIHRydWU7DQoJICB9IGVsc2Ugew0KCSAgICByZXR1cm4gZmFsc2U7DQoJICB9DQoJfTsNCg0KCWZ1bmN0aW9uIHZpZXdwb3J0KCkgew0KCSAgICB2YXIgZSA9IHdpbmRvdywgYSA9ICdpbm5lcic7DQoJICAgIGlmICghKCdpbm5lcldpZHRoJyBpbiB3aW5kb3cgKSkgew0KCSAgICAgICAgYSA9ICdjbGllbnQnOw0KCSAgICAgICAgZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCB8fCBkb2N1bWVudC5ib2R5Ow0KCSAgICB9DQoJICAgIHJldHVybiB7IHdpZHRoIDogZVsgYSsnV2lkdGgnIF0gLCBoZWlnaHQgOiBlWyBhKydIZWlnaHQnIF0gfTsNCgl9DQoJDQoJdmFyIGFkZEhhbmRsZXJzID0gZnVuY3Rpb24oKXsNCgkJLy8gJHdpbmRvdy5vbignc2Nyb2xsJywgY2hlY2tQb3MpOw0KCX07DQoNCglmdW5jdGlvbiBkZWJvdW5jZShmdW5jLCB3YWl0LCBpbW1lZGlhdGUpIHsNCgkJdmFyIHRpbWVvdXQ7DQoJCXJldHVybiBmdW5jdGlvbigpIHsNCgkJCXZhciBjb250ZXh0ID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsNCgkJCWNsZWFyVGltZW91dCh0aW1lb3V0KTsNCgkJCXRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KCQkJCXRpbWVvdXQgPSBudWxsOw0KCQkJCWlmICghaW1tZWRpYXRlKSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOw0KCQkJfSwgd2FpdCk7DQoJCQlpZiAoaW1tZWRpYXRlICYmICF0aW1lb3V0KSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOw0KCQl9Ow0KCX07DQoNCgkvLyB2YXIgY2hlY2tQb3MgPSBkZWJvdW5jZShmdW5jdGlvbigpew0KCS8vIAlpZigkZm9vdGVyKXsNCgkvLyAJCXZhciBmb290ZXJQb3MgPSAkZm9vdGVyLm9mZnNldCgpLnRvcDsNCgkvLyAJCXZhciBwc2ZQb3MgPSAkcHNmLm9mZnNldCgpLnRvcCArIHBzZkhlaWdodDsNCgkvLyAJCXZhciB3aW5kb3dTY3JvbGwgPSAkd2luZG93LnNjcm9sbFRvcCgpOw0KCS8vIAkJdmFyIHdpbmRvd0hlaWdodCA9ICR3aW5kb3cuaGVpZ2h0KCk7DQoJLy8gCQl2YXIgb2xkRml4Ow0KCS8vIAkJaWYoaXNNb2JpbGUoKSl7DQoJLy8gCQkJb2xkRml4ID0gMDsNCgkvLyAJCX0gZWxzZSB7DQoJLy8gCQkJb2xkRml4ID0gNzI7DQoJLy8gCQl9DQoNCgkvLyAJCWlmKChwc2ZQb3MgPiBmb290ZXJQb3MpIHx8ICh3aW5kb3dTY3JvbGwgKyB3aW5kb3dIZWlnaHQgPj0gJChkb2N1bWVudCkuaGVpZ2h0KCkpKXsNCgkvLyAJCQkkcHNmLmNzcyh7J2JvdHRvbSc6JzAnLCAncG9zaXRpb24nOidhYnNvbHV0ZSd9KTsNCgkvLyAJCX0NCgkvLyAJCWlmKCEocHNmUG9zK29sZEZpeCA8PSAod2luZG93U2Nyb2xsK3dpbmRvd0hlaWdodCkpICYmICAoJHBzZi5vZmZzZXQoKS50b3AgPj0gd2luZG93U2Nyb2xsKSl7DQoJLy8gCQkJJHBzZi5jc3Moeyd0b3AnOm9sZEZpeCwgJ3Bvc2l0aW9uJzonZml4ZWQnfSk7DQoJLy8gCQl9DQoJLy8gCX0NCgkvLyB9LCAxMCk7DQoNCgl2YXIgY291bnROb3RpZmljYXRpb25zID0gZnVuY3Rpb24oKSB7DQoJCXZhciB0b3RhbE5vdGlmaWNhdGlvbnMgPSAkKCcubm90aWZpY2F0aW9ucy1iZycpLmZpbmQoJy5ub3RpZmljYXRpb24nKS5zaXplKCk7DQoJCSQoJyN0b3RhbE5vdGlmaWNhdGlvbnMnKS50ZXh0KHRvdGFsTm90aWZpY2F0aW9ucyk7DQoJfTsNCg0KCWNvdW50Tm90aWZpY2F0aW9ucygpOw0KDQoJLy8gT3BlbiBub3RpZmljYXRpb25zIG9uIGNsaWNrDQoJJCgnI25vdGlmaWNhdGlvbnMtdHJpZ2dlcicpLm9uKCd0YXAgY2xpY2snLCBmdW5jdGlvbihlKSB7DQoJCWUucHJldmVudERlZmF1bHQoKTsNCgkJJCgnLm5vdGlmaWNhdGlvbnMtYmcnKS5hZGRDbGFzcygnb3BlbicpOw0KCQkkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuJyk7DQoJCSQoIiNkaXNtaXNzLW5vdGlmaWNhdGlvbnMiKS5hdHRyKCJhcmlhLWhpZGRlbiIsImZhbHNlIik7DQoJfSk7DQoNCgkvLyBDbG9zZSBub3RpZmljYXRpb25zIG9uIGNsaWNrIG9mIGRpc21pc3NhbA0KCSQoJyNkaXNtaXNzLW5vdGlmaWNhdGlvbnMnKS5vbigndGFwIGNsaWNrJywgZnVuY3Rpb24oZSkgew0KCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCSQodGhpcykuYXR0cigiYXJpYS1oaWRkZW4iLCJ0cnVlIik7DQoJCSQoJy5ub3RpZmljYXRpb25zLWJnJykucmVtb3ZlQ2xhc3MoJ29wZW4nKS5hZGRDbGFzcygndmlld2VkJyk7DQoJCSQoJyNub3RpZmljYXRpb25zLXRyaWdnZXInKS5hZGRDbGFzcygndmlld2VkJyk7DQoJCWNvdW50Tm90aWZpY2F0aW9ucygpOw0KCQkvLyBJZiB0aGVyZSBubyBtb3JlIG5vdGlmaWNhdGlvbnMsIHNob3cgdGhlIGVtcHR5IG5vdGlmaWNhdGlvbnMgbWVzc2FnZQ0KCQlpZiAoJCgnLm5vdGlmaWNhdGlvbicpLmxlbmd0aCA9PT0gMCkgew0KCQkJJCgnI2VtcHR5LW5vdGlmaWNhdGlvbnMnKS5zaG93KCk7DQoJCQkvLyBBdXRvbWF0aWNhbGx5IGNsb3NlIG5vdGlmaWNhdGlvbnMgYWZ0ZXIgMiBzZWMuDQoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KCQkJCSQoJy5ub3RpZmljYXRpb25zLWJnJykucmVtb3ZlQ2xhc3MoJ29wZW4nKTsNCgkJCX0sIDIwMDApOw0KCQl9DQoJfSk7DQoNCgl2YXIgcHNmV2lkZ2V0VmlzaWJsZT1mYWxzZTsNCg0KCS8vIFRvZ2dsZSB0aGUgUFNGIG9uIG1vYmlsZQ0KCSQoJyNwc2YtZ3JpcHBlcicpLm9uKCd0YXAgY2xpY2sgc3dpcGVsZWZ0IHN3aXBlcmlnaHQnLCBmdW5jdGlvbigpIHsNCgkJLy9Jb3MgdHJhbnNpdGlvbiBoYWNrIGZpeA0KCQlpZiAoJCgnI3BzZi5vcGVuJykubGVuZ3RoKSB7DQoJCQlwc2ZXaWRnZXRWaXNpYmxlPWZhbHNlOw0KCQkJJCgnI3BzZicpLmNzcygnLXdlYmtpdC10cmFuc2l0aW9uJywgJ3JpZ2h0IDMwMG1zIGVhc2UtaW4tb3V0Jyk7DQoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQoJCQkJJCgnI3BzZicpLnJlbW92ZUF0dHIoJ3N0eWxlJyk7DQoJCQkJLy8zNDM5OiByZXN0b3JlIHBvc2l0aW9uIG9mIFBTRg0KCQkJCXNldFBTRlBvc2l0aW9uKCk7DQoJCQl9LCAzMDApOw0KCQkJJCgnI3BzZi5vcGVuICNwc2YtZ3JpcHBlciAuaWNvbicpLnJlbW92ZUNsYXNzKCdpY29uLXJnaHQnKS5hZGRDbGFzcygnaWNvbi1sZnQnKTsNCgkJfSBlbHNlIHsNCgkJCSQoJyNwc2YtZ3JpcHBlciAuaWNvbicpLnJlbW92ZUNsYXNzKCdpY29uLWxmdCcpLmFkZENsYXNzKCdpY29uLXJnaHQnKTsNCgkJCS8vMzQzOTogcmVzdG9yZSBwb3NpdGlvbiBvZiBQU0YNCgkJCXBzZldpZGdldFZpc2libGU9dHJ1ZTsNCgkJCXNldFBTRlBvc2l0aW9uKCk7DQoJCX0NCgkJJCgnI3BzZicpLnRvZ2dsZUNsYXNzKCdvcGVuJyk7DQoJfSk7DQoNCgkvLzM0Mzkgc3RhcnQ6IHBvc2l0aW9uIHBzZiBhY2NvcmRpbmcgdG8gc3RlcHMgYmFyIHByZXNlbmNlIA0KICAgIHNldFBTRlBvc2l0aW9uKCk7DQogICAgZnVuY3Rpb24gc2V0UFNGUG9zaXRpb24oKXsNCiAgICAJdmFyIHBhZ2VJZGVudGlmaWVyPSQoIiNwYWdlSWRlbnRpZmllciIpLnZhbCgpOw0KICAgICAgICBpZigkKHdpbmRvdykud2lkdGgoKSA8IDc3Nil7DQogICAgICAgICAgICBpZigkKCIjc3RlcHMtYmFyIikuaXMoIjp2aXNpYmxlIikpew0KICAgICAgICAgICAgICAgICQoIiNwc2YiKS5jc3MoInRvcCIsICI1M3B4Iik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlew0KICAgICAgICAgICAgICAgICQoIiNwc2YiKS5jc3MoInRvcCIsICIwcHgiKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYocGFnZUlkZW50aWZpZXIgPT0gIm11bHRpcGxlV2FycmFudHkiIHx8IHBhZ2VJZGVudGlmaWVyID09ICJtdWx0aXBsZVdhcnJhbnR5UmVzdWx0cyIpew0KCSAgICAgICAgICAgIGlmKHBzZldpZGdldFZpc2libGUpew0KCSAgICAgICAgICAgIAkkKCIjcHNmIikuY3NzKCJyaWdodCIsICItNDFweCIpOw0KCSAgICAgICAgICAgIH0NCgkJCQllbHNlew0KCQkJCSAgICAkKCIjcHNmIikuY3NzKCJyaWdodCIsICItMTAzJSIpOw0KCQkJCX0NCgkgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlew0KICAgICAgICAgICAgJCgiI3BzZiIpLmNzcygidG9wIiwgIjcycHgiKTsNCiAgICAgICAgICAgIGlmKHBhZ2VJZGVudGlmaWVyID09ICJtdWx0aXBsZVdhcnJhbnR5IiB8fCBwYWdlSWRlbnRpZmllciA9PSAibXVsdGlwbGVXYXJyYW50eVJlc3VsdHMiKXsNCiAgICAgICAgICAgIAkkKCIjcHNmIikuY3NzKCJyaWdodCIsICIwcHgiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vcG9zaXRpb24gcHNmIG9uIHdpbmRvdyByZXNpemUNCiAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCl7DQogICAgICAgIHNldFBTRlBvc2l0aW9uKCk7DQogICAgfSk7DQogICAgLy8zNDM5IGVuZA0KDQoJcmV0dXJuIHsNCgkJaW5pdDogaW5pdA0KCX07DQp9KCkpOwp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvLyBUaGlzIGNvbXBvbmVudCBoYW5kbGVzIHN0aWNreW5lc3MgaW4gdGhlIHJlc3BvbnNpdmUgZm9vdGVyDQovLyBOb3RlLCB0aGUgZGVza3RvcCBhbmQgbW9iaWxlIGhlYWRlciB1c2UgdGhlIHNhbWUgbWFya3VwDQoNCg0KSGVhZGVyID0gZnVuY3Rpb24oKXsNCg0KICAgIC8vU2V0IHNvbWUgbW9kdWxlIHZhcmlhYmxlcw0KICAgIHZhciAkd2luZG93ID0gJCh3aW5kb3cpOw0KICAgIHZhciAkaGVhZGVyID0gJCgnLmhwLWhlYWRlcicpOw0KICAgIHZhciAkaW5wdXQgPSAkKCcjc2VhcmNoLWlucHV0Jyk7DQoNCiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCl7DQogICAgICBhZGRIYW5kbGVycygpOw0KICAgICAgLy9maXJlIHRoZSByZXNldCBmdW5jdGlvbiBvbiBsb2FkIGp1c3QgdG8gc3luYyBldmVyeXRoaW5nIHVwDQogICAgICByZXNldCgpOw0KICAgICAgLy8gQ2hlY2sgY29va2llIHRvIHNlZSBpZiB1c2VycyBhbHJlYWR5IHZpc3RlZCB0aGUgc2l0ZSwgaWYgdHJ1ZSB0aGVuIGhpZGUgdGhlIHNlYXJjaCBiYXINCiAgICAgaWYgKCEoZG9jdW1lbnQuY29va2llLnJlcGxhY2UoLyg/Oig/Ol58Lio7XHMqKWhwU2Vzc2lvblxzKlw9XHMqKFteO10qKS4qJCl8Xi4qJC8sICIkMSIpKSkgew0KICAgICAgICAgICAgaWYgKGlzTW9iaWxlKCkpIHsNCiAgICAgICAgICAgICAgICAkKCcjaHAtc2VhcmNoJykuc2xpZGVEb3duKDApOw0KICAgICAgICAgICAgICAgICQoJy5tb2JpbGUtc2VhcmNoLXRvZ2dsZScpLnRyaWdnZXIoJ3NsaWRlRG93bicpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgaWYgKGlzTW9iaWxlKCkpew0KICAgICAgICAgICAgICAgICQoJy5tb2JpbGUtc2VhcmNoLXRvZ2dsZScpLnRyaWdnZXIoJ3NsaWRlVXAnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgJC5jb29raWUoJ2hwU2Vzc2lvbicsJ3RydWUnKTsNCg0KICAgIH07DQogICAgLy8gY2hlY2sgaWYgd2UgYXJlIGluIG1vYmlsZSBsYXlvdXQNCiAgICB2YXIgaXNNb2JpbGUgPSBmdW5jdGlvbigpew0KICAgICAgaWYodmlld3BvcnQoKS53aWR0aCA8PSA4MDApew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgLy8gdGhpcyBnaXZlcyB1cyBhIGJldHRlciByZXByZXNlbnRhdGlvbiBvZiBzY3JlZW4gd2lkdGggdGhhbiB3aW5kb3cud2lkdGgNCiAgICBmdW5jdGlvbiB2aWV3cG9ydCgpIHsNCiAgICAgICAgdmFyIGUgPSB3aW5kb3csIGEgPSAnaW5uZXInOw0KICAgICAgICBpZiAoISgnaW5uZXJXaWR0aCcgaW4gd2luZG93ICkpIHsNCiAgICAgICAgICAgIGEgPSAnY2xpZW50JzsNCiAgICAgICAgICAgIGUgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgfHwgZG9jdW1lbnQuYm9keTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4geyB3aWR0aCA6IGVbIGErJ1dpZHRoJyBdICwgaGVpZ2h0IDogZVsgYSsnSGVpZ2h0JyBdIH07DQogICAgfQ0KDQogICAgLy90aGlzIGxpbWl0cyBhIGZ1bmN0aW9uIGZyb20gZmlyaW5nIHRvbyBtYW55IHRpbWVzIHVuZWNlc3NhcmlseSwgZ29vZCBmb3Igb3B0aW1pemF0aW9uDQogICAgZnVuY3Rpb24gZGVib3VuY2UoZnVuYywgd2FpdCwgaW1tZWRpYXRlKSB7DQogICAgICB2YXIgdGltZW91dDsNCiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsNCiAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzOw0KICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7DQogICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHRpbWVvdXQgPSBudWxsOw0KICAgICAgICAgIGlmICghaW1tZWRpYXRlKSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOw0KICAgICAgICB9LCB3YWl0KTsNCiAgICAgICAgaWYgKGltbWVkaWF0ZSAmJiAhdGltZW91dCkgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsNCiAgICAgIH07DQogICAgfTsNCg0KICAgIC8vIFRoaXMgZnVuY3Rpb24gY2hlY2sgb3VyIHNjcm9sbCBwb3NpdGlvbiBhbmQgcG9zaXRpb25zIHRoZSBoZWFkZXIgY29ycmVjdGx5DQogICAvLyBTdGFydCBIUCA0NTMNCiAgICAvLyBUaGlzIGZ1bmN0aW9uIGNoZWNrIG91ciBzY3JvbGwgcG9zaXRpb24gYW5kIHBvc2l0aW9ucyB0aGUgaGVhZGVyIGNvcnJlY3RseQ0KICAgIC8vIERlcHJpY2F0ZWQ6IGNhdXNlZCBidWdneSBpbnB1dCBmb2N1cyB3aGVuIGtleWJvYXJkIHRyaWdnZXJlZCBzY3JvbGwgZXZlbnQgb24gc2VhcmNoLg0KLy8gICAgdmFyIGNoZWNrUG9zID0gZGVib3VuY2UoZnVuY3Rpb24gKCkgew0KLy8gICAgICAgIGlmIChpc01vYmlsZSgpKSB7DQovLyAgICAgICAgICAgIHZhciB3aW5kb3dTY3JvbGwgPSAkd2luZG93LnNjcm9sbFRvcCgpOw0KLy8gICAgICAgICAgICAvLyBpZiB3ZSBhcmUgcGFzdCA4MCBwaXhlbHMsIHN0aWNreSBuYXYNCi8vICAgICAgICAgICAgaWYgKHdpbmRvd1Njcm9sbCA+IDgwKSB7DQovLyAgICAgICAgICAgICAgICAkaGVhZGVyLmNzcyh7J3Bvc2l0aW9uJzogJ2ZpeGVkJywgJ3RvcCc6ICcwJywgJ3otaW5kZXgnOiAnOTk5J30pOw0KLy8gICAgICAgICAgICB9IGVsc2Ugew0KLy8gICAgICAgICAgICAgICAgLy8gb3RoZXIgd2lzZSwgbWFrZSBpdCBub3Qgc3RpY2t5DQovLyAgICAgICAgICAgICAgICAkaGVhZGVyLmNzcyh7J3Bvc2l0aW9uJzogJ2Fic29sdXRlJ30pOw0KLy8gICAgICAgICAgICB9DQovLyAgICAgICAgICAgIC8vIG9uY2Ugd2Ugc2Nyb2xsIHBhc3QgODAsIHdlIHdhbnQgdGhlIHNlYXJjaCBiYXIgdG8gcG9wIHVwLCBidXQgd2UgZG9udCB3YW50IGl0IHRvIGhhcHBlbiBldmVyeSB0aW1lIHdlDQovLyAgICAgICAgICAgIC8vIHNjcm9sbCwgc28gd2UgbGltaXQgdGhpcyBmdW5jdGlvbmFsaXR5IGJldHdlZW4gODAgYW5kIDEyMHB4DQovLyAgICAgICAgICAgIC8vIE5vdGU6IFRoZXJlIGlzIGEgYmV0dGVyIHdheSB0byBkbyB0aGlzLCBwZXJoYXBzIG1ha2luZyB1c2Ugb2YgYSBsaWJyYXJpZXMgLm9uY2UoKSBmdW5jdGlvbg0KLy8gICAgICAgICAgICBpZiAod2luZG93U2Nyb2xsID4gODAgJiYgd2luZG93U2Nyb2xsIDwgMTIwKSB7DQovLyAgICAgICAgICAgICAgICAkKCcubW9iaWxlLW5hdi10b2dnbGUnKS5yZW1vdmVDbGFzcygnb3V0Jyk7DQovLyAgICAgICAgICAgICAgICAkaGVhZGVyLmZpbmQoJy5tb2JpbGUtc2VhcmNoLXRvZ2dsZScpLnRyaWdnZXIoJ3NsaWRlVXAnKTsgTGVhdmUgdGhlIHNlYXJjaCBib3ggb3BlbiBhbmQgbm90IGF0dGFjaGVkIHRvIHNjcm9sbCBmb3Iga2V5Ym9hcmRzIG9uIG1vYmlsZSB0aGF0IHRyaWdnZXIgc2Nyb2xsIGV2ZW50Lg0KLy8gICAgICAgICAgICB9DQovLyAgICAgICAgfSBlbHNlIHsNCi8vICAgICAgICAgICAgLy8gaWYgd2UgYXJlIG5vdCBpbiBtb2JpbGUsIGVuc3VyZSBoZWFkZXIgaXMgbm90IHN0aWNreQ0KLy8gICAgICAgICAgICAkaGVhZGVyLmNzcyh7J3Bvc2l0aW9uJzogJ3JlbGF0aXZlJ30pOw0KLy8gICAgICAgIH0NCi8vICAgIH0sIDEwKTsNCg0KICAgICR3aW5kb3cuc2Nyb2xsKGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgc3QgPSBzY3JvbGxZKCksDQogICAgICAgICAgICBjaGFuZ2VIZWFkZXJBdCA9IDEyMCwNCiAgICAgICAgICAgICRoZWFkZXIgPSAkKCcuaHAtaGVhZGVyJyk7DQoNCiAgICAgICAgICAgIHZhciBwYWdlVGl0bGUgPSAkKCcjaHBQcm9kdWN0Q29udGV4dFBhZ2VUaXRsZScpOw0KICAgICAgICAvLyBTaHJpbmsgSGVhZGVyIG9ubHkgaWYgc2Nyb2xsaW5nIGRvd24NCiAgICAgICAgaWYoIHN0ID49IGNoYW5nZUhlYWRlckF0ICkgew0KICAgICAgICAgICAgLy9wYWdlVGl0bGUuaGlkZSgpOw0KICAgICAgICAgICAgJGhlYWRlci5hZGRDbGFzcygnc3RpY2t5Jyk7DQoNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAvL3BhZ2VUaXRsZS5zaG93KCk7DQoNCiAgICAgICAgICAgICRoZWFkZXIucmVtb3ZlQ2xhc3MoJ3N0aWNreScpOw0KICAgICAgICB9DQogICAgfSk7DQogICAgZnVuY3Rpb24gc2Nyb2xsWSgpIHsNCiAgICAgICAgcmV0dXJuIHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wOw0KICAgIH0NCiAgICAvLyBFbmQgSFAgNDUzDQoNCiAgLy8gdGhpcyBmdW5jdGlvbiBmaXJlcyBvbiB3aW5kb3cgcmVzaXplLCBhbmQgbWFrZXMgc3VyZSBhbGwgZnVuY3Rpb25hbGl0eSBpcyBjbGVhcmVkIG91dCBiZXR3ZWVuIGxheW91dHMNCiAgLy8gTm90IHN1cmUgd2h5IHRoaXMgaXNudCBoYW5kbGVkIGJ5IGNzcyBjbGFzc2VzLCBzdXJlbHkgSSBoYWQgYSBnb29kIHJlYXNvbg0KICAgIHZhciByZXNldCA9IGRlYm91bmNlKGZ1bmN0aW9uKCl7DQogICAgICAvLyBpZiBub3QgaW4gbW9iaWxlLCBjbGVhciBvdXQgYWxsIGFwcGxpZWQgaW5saW5lIHN0eWxlcyBhbmQgY2hhbmdlIHBsYWNlaG9sZGVyIGNvbnRlbnQNCiAgICAgIC8vRG8gbm90IHJlbW92ZSAtIFZhcnVuDQogICAgCXZhciB0eXBlYWhlYWRMZWZ0SG9va0Rlc2t0b3AgPSAiMCI7DQogICAgCXZhciBpc0Rlc2t0b3AgPSB0cnVlOw0KICAgICAgaWYoIWlzTW9iaWxlKCkpew0KICAgICAgICAgICAgJCgnI2hwLXNlYXJjaCcpLmhhc0NsYXNzKCdpbicpICYmICQoJy5ocC1oZWFkZXIgLmhwLXNlYXJjaCcpLmNzcyh7J2Rpc3BsYXknOiAnYmxvY2snfSk7DQoJCQkNCgkJCSQoJyNwc2YnKS5pbnNlcnRBZnRlcignI2Zvb3RlcicpOy8qTW92ZWQgdGhpcyB0byBzaXRlLmpzIFZWICovDQogICAgICAgICAgIC8vcmVtb3ZlZCBhcyBpdCBoaWRlcyB0aGUgSDEgdGFnIHdoZW4gYnJvd3NlciBpcyByZXNpemVkDQogICAgICAgICAgIC8vICQoJyNib2R5JykuY3NzKHsncGFkZGluZy10b3AnOiAnMCd9KTsNCgkNCgkNCgkvL0RvIG5vdCByZW1vdmUgLSBWYXJ1bg0KICAgICAgICAkKCIuc2VhcmNoLWlucHV0IikuZWFjaChmdW5jdGlvbigpew0KICAgICAgICAJICQodGhpcykuYXR0cigiZ2hvc3R0ZXh0IiwkKHRoaXMpLmRhdGEoInBsYWNlaG9sZGVybGciKSk7DQogICAgICAgICAgICAgaWYoJCh0aGlzKS52YWwoKT09JCh0aGlzKS5kYXRhKCJwbGFjZWhvbGRlcnNtIikgKXsgLy8gcmVtb3ZlZCB0aGUgbnVsbCBjaGVjayBhcyBrZWVwaW5nIGl0IG9uIG51bGwgbWFkZSBnaG9zdCB0ZXh0IGVkaXRhYmxlIHdoaWxlIHNpemUgY2hhbmdlZCBvbiBmb2N1cw0KICAgICAgICAgICAgIAkkKHRoaXMpLnZhbCgkKHRoaXMpLmRhdGEoInBsYWNlaG9sZGVybGciKSk7DQogICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICANCiAgICAgICAgICAgICB0eXBlYWhlYWRMZWZ0SG9va0Rlc2t0b3AgPSAkKHRoaXMpLnBhcmVudHMoIi5zZWFyY2gtYmciKS5maW5kKCIjc2VhcmNoLWRyb3Bkb3duIikuaW5uZXJXaWR0aCgpICsgMTU7DQogICAgICAgICAgICAgJCh0aGlzKS5zaWJsaW5ncygiLnR5cGVhaGVhZEhvb2siKS52YWwodHlwZWFoZWFkTGVmdEhvb2tEZXNrdG9wKTsNCiAgICAgICAgICAgICAkKHRoaXMpLmNzcygicGFkZGluZy1sZWZ0Iix0eXBlYWhlYWRMZWZ0SG9va0Rlc2t0b3ApOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudHMoIi5zZWFyY2gtYmciKS5maW5kKCIjc2VhcmNoLWRyb3Bkb3duIikuaW5uZXJXaWR0aCgpICsgMTU7DQogICAgICAgICAgICAgaXNEZXNrdG9wPXRydWU7DQogICAgICAgICAgICAgJCh0aGlzKS51bmJpbmQoImJsdXIiKTsNCiAgICAgICAgICAgICBoYW5kbGVHaG9zdFNjcmlwdChqUXVlcnkodGhpcykpOw0KICAgICAgICAJJCh0aGlzKS5vbigiYmx1ciIsZnVuY3Rpb24oKXsNCiAgICAgICAgCQkkKHRoaXMpLnRyaWdnZXIoImJsdXJUeXBlYWhlYWQiKTsNCiAgICAgICAgCX0pDQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICANCiAgICAgICAgDQogICAgICAgLy8gZG8gbm90IHVuY29tbWVudCAtIFZhcnVuICQoJy5ocC1oZWFkZXIgI3NlYXJjaC1pbnB1dCcpLmF0dHIoJ3BsYWNlaG9sZGVyJywgJ0VudGVyIHlvdXIgcHJvZHVjdCBudW1iZXIsIGEgcXVlc3Rpb24gb3Iga2V5d29yZHMnKTsNCiAgICAgICAgLy8gaWYgaXQgaXMgbW9iaWxlLCBhcHBseSBtb2JpbGUgc3R5bGluZyBhbmQgY2hhbmdlIHNlYXJjaCBib3ggcGxhY2Vob2xkZXIgY29udGVudA0KICAgICAgfSBlbHNlIHsNCi8vICAgICAgICAgICAgJGhlYWRlci5jc3Moeydwb3NpdGlvbic6ICdhYnNvbHV0ZSd9KTsgLy8gbm93IGhhbmRsZWQgYnkgLnN0aWNreSBpbiBfaHAtbmF2aWdhdGlvbi5sZXNzDQovLyAgICAgICAgICAgICQoJyNib2R5JykuY3NzKHsncGFkZGluZy10b3AnOiAnNjBweCd9KTsgLy9tb3ZlZCB0byBfaHAtc3RydWN0dXJlLmxlc3MNCiAgICAgICAgIC8vZm9yIHBvc2l0aW9uaW5nIHRoZSB3aWRnZXRzIGluIG1vYmlsZSBkZXZpY2VzIDo6IFByYXRpc2hhDQoNCgkJICQoJyNwc2YnKS5hcHBlbmRUbygnLmZpeGVkV2lkZ2V0cycpOw0KCQkgDQoJCSANCiAgICAgICAgLy9EbyBub3QgcmVtb3ZlIC0gVmFydW4NCiAgICAgICAgJCgiLnNlYXJjaC1pbnB1dCIpLmVhY2goZnVuY3Rpb24oKXsNCiAgICAgICAJICQodGhpcykuYXR0cigiZ2hvc3R0ZXh0IiwkKHRoaXMpLmRhdGEoInBsYWNlaG9sZGVyc20iKSk7DQogICAgICAgCSBpZighKCQodGhpcykuaXMoIjpmb2N1cyIpKSl7DQogICAgICAgICAgICBpZigkKHRoaXMpLnZhbCgpPT0kKHRoaXMpLmRhdGEoInBsYWNlaG9sZGVybGciKSApew0KICAgICAgICAgICAgCSQodGhpcykudmFsKCQodGhpcykuZGF0YSgicGxhY2Vob2xkZXJzbSIpKTsNCiAgICAgICAgICAgIAl9DQogICAgICAgICAgDQogICAgICAgICAgICAJDQoJICAgICAgICAgICB0eXBlYWhlYWRMZWZ0SG9va0Rlc2t0b3AgPSAkKHRoaXMpLnNpYmxpbmdzKCIudHlwZWFoZWFkSG9vayIpLnZhbCgpOw0KCSAgICAgICAgICAgJCh0aGlzKS5zaWJsaW5ncygiLnR5cGVhaGVhZEhvb2siKS52YWwoIjAiKQ0KCSAgICAgICAgICAgDQogICAgICAgICAgIGlzRGVza3RvcCA9IGZhbHNlOw0KICAgICAgICAgICAgJCh0aGlzKS51bmJpbmQoImJsdXIiKTsNCiAgICAgICAgICAgIGhhbmRsZUdob3N0U2NyaXB0KGpRdWVyeSh0aGlzKSk7DQogICAgICAgICAgICAkKHRoaXMpLm9uKCJibHVyIixmdW5jdGlvbigpew0KICAgICAgICAJCSQodGhpcykudHJpZ2dlcigiYmx1clR5cGVhaGVhZCIpOw0KICAgICAgICAJfSkNCiAgICAgICAJIH0NCiAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAvLyBkbyBub3QgdW5jb21tZW50IC0gVmFydW4gJCgnLmhwLWhlYWRlciAjc2VhcmNoLWlucHV0JykuYXR0cigncGxhY2Vob2xkZXInLCAnU2VhcmNoIEhQIFN1cHBvcnQnKTsNCiAgICAgIH0NCiAgICB9LCAxMCk7DQoNCiAgICAvLyB0aGlzIGlzIGEgc2ltcGxlIGhhbmRsZXIgdG8gY2xlYXIgdGV4dCBvdXQgb2Ygc2VhcmNoIGJveA0KICAgIHZhciBjbGVhclNlYXJjaCA9IGZ1bmN0aW9uKCl7DQogICAgLy9tb2RpZmllZCBieSBWYXJ1biBkbyBub3QgY2hhbmdlDQogICAgICAkKCcuaHAtaGVhZGVyICNzZWFyY2gtaW5wdXQnKS52YWwoJCgnLmhwLWhlYWRlciAjc2VhcmNoLWlucHV0JykuYXR0cigiZ2hvc3R0ZXh0IikpOw0KICAgICAgJCgnLmhwLWhlYWRlciAjc2VhcmNoLWlucHV0JykuYWRkQ2xhc3MoInBsYWNlaG9sZGVyVGV4dCIpOw0KICAgIH07DQoNCiAgICAvLyBhZGQgb3VyIGV2ZW50IGhhbmRsZXJzDQogICAgdmFyIGFkZEhhbmRsZXJzID0gZnVuY3Rpb24oKXsNCiAgICAgIC8vJHdpbmRvdy5vbignc2Nyb2xsJywgY2hlY2tQb3MpOw0KICAgICAgJHdpbmRvdy5vbigncmVzaXplJywgcmVzZXQpOw0KICAgICAgLy9EbyBub3QgcmVtb3ZlIC0gVmFydW4NCiAgICAgIC8vJCgnI2NsZWFyLXNlYXJjaCcpLm9uKCd0YXAgY2xpY2snLCBjbGVhclNlYXJjaCk7DQogICAgICAkKCcubW9iaWxlLW5hdi10b2dnbGUnKS5vbignY2xpY2snLCBmdW5jdGlvbigpew0KICAgICAgICAkKCcubW9iaWxlLXNlYXJjaC10b2dnbGUnKS50cmlnZ2VyKCdzbGlkZVVwJyk7DQogICAgICB9KTsNCiAgICAgICQoJy5tb2JpbGUtc2VhcmNoLXRvZ2dsZS1jbG9zZScpLm9uKCdjbGljaycsIGNsZWFyU2VhcmNoKTsgLy9hZGRlZCBieSB2YXJ1bg0KICAgICAgJCgnLm1vYmlsZS1zZWFyY2gtdG9nZ2xlJykub24oJ3RhcCBjbGljaycsIGZ1bmN0aW9uKCl7DQogICAgICAgICQoJy5tb2JpbGUtbmF2LXRvZ2dsZScpLnRyaWdnZXIoJ2RDbG9zZScpOw0KICAgICAgfSk7DQogICAgfTsNCg0KICAgIHJldHVybiB7DQogICAgICBpbml0OiBpbml0LA0KICAgICAgaXNNb2JpbGU6aXNNb2JpbGUsDQogICAgICB2aWV3cG9ydDp2aWV3cG9ydCwNCiAgICAgIGRlYm91bmNlOmRlYm91bmNlDQogICAgfTsNCg0KfSgpOwp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvKg0KTW9kaWZpZWQgYnkgUGF2YW4gS2FtYXRoDQpEbyBub3QgbWVyZ2UNCk1vZGlmaWVkIEJ5IEFBIHRvIGFkZCBhY2Nlc3NpYmlsaXR5IGZvciB0aGUgcGFnZQ0KKi8NClRhYnMgPSAoZnVuY3Rpb24oKXsNCg0KCXZhciAkdG9nZ2xlczsNCgkNCgl2YXIgaW5pdCA9ICBmdW5jdGlvbigpew0KCQlpZigkKCdbZGF0YS10b2dnbGU9InRhYiJdJykubGVuZ3RoKXsNCgkJCWFkZEhhbmRsZXJzKCk7DQoJCQkkdG9nZ2xlcyA9ICQoJ1tkYXRhLXRvZ2dsZT0idGFiIl0nKTsNCgkJCWNoZWNrU3RhdGUoKTsNCgkJCWluaXRDdXJyZW50VVJMKCk7DQoJCX0NCgl9DQoNCgl2YXIgaW5pdEN1cnJlbnRVUkwgPSBmdW5jdGlvbigpew0KCQlwcm9kdWN0U2VyaWVzID0gJCgnI3Byb2R1Y3RTZXJpZXMnKS52YWwoKTsNCgkJbW9kZWxEZXRhaWxzID0gJCgnI21vZGVsRGV0YWlscycpLnZhbCgpOw0KCQlwcm9kdWN0TmFtZU9pZCA9ICQoJyNwcm9kdWN0U2VyaWVzSWQnKS52YWwoKTsNCgkJLy8gVUFUIGRlZmVjdCBmaXg6IHVuZGVmaW5lZCBpcyBhcHBlbmRpbmcgaW4gdXJsIGFmdGVyIGNsaWNraW5nIG9uIGhvbWVwYWdlIHRhYnMNCgkJdmFyIGlkZW50aWZpZXIgPSAkKCcjcGFnZUlkZW50aWZpZXInKS52YWwoKTsNCgkJaWYoIGlkZW50aWZpZXIgPT0gIlByb2R1Y3QgRGV0YWlscyBQYWdlIil7DQoJCQljdXJyZW50VVJMID0gIi8iK2dldENDTEMoJ2NjJykrIi0iK2dldENDTEMoJ2xjJykrIi9wcm9kdWN0LyIrcHJvZHVjdFNlcmllcysiLyIrcHJvZHVjdE5hbWVPaWQ7DQoNCgkJCWlmKG1vZGVsRGV0YWlscyE9IiIpew0KCQkJCWN1cnJlbnRVUkwgPSBjdXJyZW50VVJMICsgIi9tb2RlbC8iICsgbW9kZWxEZXRhaWxzOw0KCQkJfQ0KCQl9DQoJCWlmKGlkZW50aWZpZXIgPT0gImNhc2VDcmVhdGlvbiIpew0KCQkJCWN1cnJlbnRVUkwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsNCgkJfQ0KCQkNCgl9DQoNCgl2YXIgYWRkSGFuZGxlcnMgPSBmdW5jdGlvbigpew0KCQkkKCdbZGF0YS10b2dnbGU9InRhYiJdJykub24oJ3RhcCBjbGljaycsIHB1c2hTdGF0ZSk7DQoJCSQoJ1tkYXRhLXRvZ2dsZT0idGFiIl0nKS5vbignc2hvd1RhYicsIHNob3dUYWIpOw0KCQkkKCdbZGF0YS10b2dnbGU9InRhYiJdJykub24oJ2hpZGVUYWInLCBoaWRlVGFiKTsNCgkJDQoJCXdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb3BzdGF0ZSIsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICAJY2hlY2tTdGF0ZSgpOw0KICAgICAgICAgICAgfSwgZmFsc2UpOw0KICAgICAgICB9LCAxKTsNCgkJDQoJCQ0KCX0NCgkNCgl2YXIgcHVzaFN0YXRlID0gZnVuY3Rpb24oKXsNCgkJdmFyIGFjdGl2ZWxpbmsgPSAkKHRoaXMpLmF0dHIoImlkIik7DQoJCWlmKCQoIiNwYWdlSWRlbnRpZmllciIpLnZhbCgpID09ICJjYXNlQ3JlYXRpb24iIHx8IGFjdGl2ZWxpbmsgPT0gInNob3AiKXsNCgkJCWxpbmsgPSBjdXJyZW50VVJMOw0KCQl9DQoJCWVsc2V7DQoJCQlsaW5rID0gY3VycmVudFVSTCArICcvJyArIGFjdGl2ZWxpbms7CQ0KCQl9DQoJCQ0KCQkvL1JlbW92ZSBxdWVyeSBwYXJhbWV0ZXMgYXMgdGhleSB3aWxsIG5ldmVyIGNvbWUgYWdhaW4NCgkJaWYoIGxvY2F0aW9uLmhyZWYuaW5kZXhPZignPycpPjApew0KCQkJdmFyIHF1ZXJ5cGFyYW1zID0gbG9jYXRpb24uaHJlZi5zcGxpdCgnPycpOw0KCQkJbGluayA9IGxpbmsgKyAnPycgK3F1ZXJ5cGFyYW1zWzFdOw0KCQl9DQogICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKG51bGwsIG51bGwsIGxpbmspOw0KCQljaGVja1N0YXRlKCk7DQoJCS8vY29uc29sZS5sb2coJ3NldENhbm9uaWNhbFVybCBjYWxsZWQgZnJvbSB0YWJzLmpzLi4uLi4nKTsNCgkJc2V0Q2Fub25pY2FsVXJsKCk7DQoJfQ0KDQoJdmFyIGNoZWNrU3RhdGUgPSBmdW5jdGlvbigpew0KCQl2YXIgJHRvZ2dsZSA9IGdldEFjdGl2ZVRhYkZyb21VUkwoKTsNCgkJaWYoJHRvZ2dsZS5wYXJlbnQoKS5oYXNDbGFzcygnYWN0aXZlJykpIHJldHVybjsNCgkJJCgnLnRhYi1jb250ZW50LmNvbC1sZy0xNj5kaXYuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpLmFkZENsYXNzKCdmYWRlJyk7DQoJCSR0b2dnbGUudHJpZ2dlcignc2hvd1RhYicpOw0KCQkkdG9nZ2xlcy5ub3QoJHRvZ2dsZSkudHJpZ2dlcignaGlkZVRhYicpOw0KCX0NCg0KCXZhciBoaWRlVGFiID0gZnVuY3Rpb24oKXsNCgkJdmFyICR0b2dnbGUgPSAkKHRoaXMpOw0KCQlpZighJHRvZ2dsZS5wYXJlbnQoKS5oYXNDbGFzcygnYWN0aXZlJykpIHJldHVybjsNCgkJJHRvZ2dsZS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoJCSR0b2dnbGUucGFyZW50KCkuYXR0cih7InRhYmluZGV4IiA6ICItMSJ9KTsNCgkJdmFyICR0YWJDb250ZW50ID0gJCgkdG9nZ2xlLmF0dHIoJ2hyZWYnKSk7DQoJCSR0YWJDb250ZW50LnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJJHRhYkNvbnRlbnQuYXR0cih7InRhYmluZGV4IiA6ICItMSJ9KTsNCgkJJHRhYkNvbnRlbnQuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpOw0KCX0NCg0KCXZhciBzaG93VGFiID0gZnVuY3Rpb24oKXsNCgkJdmFyICR0b2dnbGUgPSAkKHRoaXMpOw0KCQkkKCIudGFiIikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpOw0KCQkkdG9nZ2xlLnBhcmVudCgpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJJHRvZ2dsZS5wYXJlbnQoKS5hdHRyKHsidGFiaW5kZXgiIDogIjAifSk7DQoNCgkJdmFyIGFjdGl2ZWxpbmsgPSAkKHRoaXMpLmF0dHIoImlkIik7DQoJCS8vIGlmKGFjdGl2ZWxpbmsgPT0gImRyaXZlcnMiKXsNCgkJLy8gCWlmKHR5cGVvZiBjdXJyZW50VVJMID09ICJ1bmRlZmluZWQiIHx8IGN1cnJlbnRVUkwgPT0gbnVsbCB8fCBjdXJyZW50VVJMID09ICIiKXsNCgkJLy8gCQlpbml0Q3VycmVudFVSTCgpOw0KCQkvLyAJfQ0KCQkvLyAJbGluayA9IGN1cnJlbnRVUkwgKyAnLyc7DQoJCS8vIAkvL1JlbW92ZSBxdWVyeSBwYXJhbWV0ZXMgYXMgdGhleSB3aWxsIG5ldmVyIGNvbWUgYWdhaW4NCgkJLy8gCWlmKCBsb2NhdGlvbi5ocmVmLmluZGV4T2YoJz8nKT4wKXsNCgkJLy8gCQl2YXIgcXVlcnlwYXJhbXMgPSBsb2NhdGlvbi5ocmVmLnNwbGl0KCc/Jyk7DQoJCS8vIAkJbGluayA9IGxpbmsgKyAnPycgK3F1ZXJ5cGFyYW1zWzFdOw0KCQkvLyAJfQ0KCSAvLyAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUobnVsbCwgbnVsbCwgbGluayk7DQoJCS8vIAlzZXRDYW5vbmljYWxVcmwoKTsNCgkJLy8gfQ0KDQoJCXZhciAkdGFiQ29udGVudCA9ICQoJHRvZ2dsZS5hdHRyKCdocmVmJykpOw0KCQkkdGFiQ29udGVudC5hZGRDbGFzcygnYWN0aXZlJyk7IA0KCQkkdGFiQ29udGVudC5hdHRyKHsidGFiaW5kZXgiIDogIjAifSk7DQoJCSR0YWJDb250ZW50LmF0dHIoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7DQoJfQ0KCQ0KCXZhciBnZXRBY3RpdmVUYWJGcm9tVVJMID0gZnVuY3Rpb24oKXsNCgkJdmFyIHRhYlN0cmluZyA9ICJzb2x1dGlvbnMrZHJpdmVycyt0cm91Ymxlc2hvb3RpbmcraG93LXRvK3Byb2R1Y3QtaW5mbyttYW51YWxzK3ZpZGVvcyttb3JlLW9wdGlvbnMiOw0KCQl2YXIgcmVtb3ZlSGFzaCA9IGxvY2F0aW9uLmhyZWYuc3BsaXQoIiMiKTsNCgkJdmFyIHVybGxvY2F0aW9uID0gcmVtb3ZlSGFzaFswXS5zcGxpdCgiLyIpOw0KCQkvL3N1cHBvcnQgZm9yIHF1ZXJ5IFBhcmFtcw0KCQl1cmxsb2NhdGlvbiA9IHVybGxvY2F0aW9uW3VybGxvY2F0aW9uLmxlbmd0aC0xXS5zcGxpdCgiPyIpOw0KCQkNCgkJdmFyIGlkZW50aWZ5QWN0aXZlVGFiID0gIiI7DQoJCWN1cnJlbnRUYWIgPSAgJyc7DQoJCQ0KDQoJCQlpZih0YWJTdHJpbmcuaW5kZXhPZih1cmxsb2NhdGlvblswXSk+MCl7DQoJCQkJDQoJCQkJY3VycmVudFRhYiA9ICQoIiMiK3VybGxvY2F0aW9uWzBdKTsNCgkJCQlpZighY3VycmVudFRhYi5pcygnOnZpc2libGUnKSl7DQoJCQkJCWN1cnJlbnRUYWIgPSAkKCdbZGF0YS10b2dnbGU9dGFiXTp2aXNpYmxlJykuZmlyc3QoKTsNCgkJCQkJY3VycmVudFRhYi5hdHRyKHsidGFiaW5kZXgiIDogIjAifSk7DQoJCQkJfQ0KDQoJCQl9DQoJCQllbHNlew0KCQkJDQoJCQkJY3VycmVudFRhYiA9ICQoJ1tkYXRhLXRvZ2dsZT10YWJdOnZpc2libGUnKS5maXJzdCgpOw0KCQkJCWN1cnJlbnRUYWIuYXR0cih7InRhYmluZGV4IiA6ICIwIn0pOw0KCQkJfQ0KDQoNCgkJCQ0KCQkJLyppZih1cmxsb2NhdGlvbi5pbmRleE9mKCc/Jyk+MCl7DQoJCQkJDQoJCQkJdmFyIHVybFNwbGl0ID0gaWRlbnRpZnlBY3RpdmVUYWIuc3BsaXQoJz8nKTsNCgkJCQljdXJyZW50VGFiID0gJCgiIyIrdXJsU3BsaXRbMF0pOw0KCQkJCQ0KCQkJCS8vY3VycmVudFRhYiA9IHVybGxvY2F0aW9uW3VybGxvY2F0aW9uLmxlbmd0aCAtIDFdOw0KCQkJCWlmKHRhYlN0cmluZy5pbmRleG9mKGN1cnJlbnRUYWIpPjApew0KCQkJCQljdXJyZW50VGFiID0gJCgiIyIrdXJsbG9jYXRpb25bdXJsbG9jYXRpb24ubGVuZ3RoIC0gMV0pOw0KCQkJCQkNCgkJCQl9DQoJCQkJDQoJCQl9DQoJCQllbHNlew0KCQkJCWN1cnJlbnRUYWIgPSAgJCgiI2ZpbmRTb2x1dGlvbnMiKTsNCgkJCX0qLw0KDQoNCgkJcmV0dXJuIGN1cnJlbnRUYWI7DQoJfQ0KDQoJcmV0dXJuIHsNCgkJaW5pdDogaW5pdA0KCX0NCn0oKSk7DQoNCi8qJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXsNCgloYW5kbGVBY2Nlc3NpYmlsaXR5KCk7DQoJZnVuY3Rpb24gaGFuZGxlQWNjZXNzaWJpbGl0eSgpew0KCXZhciBpbmRleFZhbHVlID0gJCgiLm5hdi5uYXYtdGFicy5ocC1uYXYtdGFicyBsaSIpLmZpbHRlcigiLmFjdGl2ZSIpLmluZGV4KCk7DQoJJCgiLmhwLW5hdi10YWJzIGFbZGF0YS10b2dnbGU9J3RhYiddIikuZWFjaChmdW5jdGlvbigpew0KDQoJCQlpZih0eXBlb2YgKCQodGhpcykuYXR0cigidGFiaW5kZXgiKSkgPT09ICd1bmRlZmluZWQnICYmICgkKCIuaHAtbmF2LXRhYnMgbGkiKS5pbmRleCgkKHRoaXMpLnBhcmVudCgpKTxpbmRleFZhbHVlKSl7DQoJCQkJJCh0aGlzKS5hdHRyKCJ0YWJpbmRleCIsIjAiKTsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCSQodGhpcykuYXR0cigidGFiaW5kZXgiLCItMSIpOw0KCQkJfQ0KDQoJfSk7DQoJJCgiLnRhYi1wYW5lIikub24oImZvY3Vzb3V0IixmdW5jdGlvbihlKXsNCgkJJCh0aGlzKS5hdHRyKCJ0YWJpbmRleCIsICItMSIpOw0KCQl2YXIgbmV4dEVsZW1lbnQgPSAkKCIuaHAtbmF2LXRhYnMgbGkuYWN0aXZlIikubmV4dCgpOw0KCQkJd2hpbGUoJChuZXh0RWxlbWVudCkuZmluZCgiYVtkYXRhLXRvZ2dsZT0ndGFiJ10iKS5jc3MoImRpc3BsYXkiKSA9PSAibm9uZSIpew0KCQkJCW5leHRFbGVtZW50ID0gJChuZXh0RWxlbWVudCkubmV4dCgpOw0KCQkJfQ0KCQkkKG5leHRFbGVtZW50KS5maW5kKCJhW2RhdGEtdG9nZ2xlPSd0YWInXSIpLmF0dHIoInRhYmluZGV4IiwiMCIpOyANCgkJJChuZXh0RWxlbWVudCkuZmluZCgiYVtkYXRhLXRvZ2dsZT0ndGFiJ10iKS5mb2N1cygpOw0KCQkkKCIudGFiLXBhbmUiKS5maW5kKCJhIikuYXR0cigidGFiaW5kZXgiLCItMSIpOw0KCX0pOw0KCSQoIi5ocC1uYXYtdGFicyBhW2RhdGEtdG9nZ2xlPSd0YWInXSIpLm9uKCJmb2N1c291dCIsZnVuY3Rpb24oZSl7DQoJCWlmKCQodGhpcykucGFyZW50KCkuaGFzQ2xhc3MoImFjdGl2ZSIpKXsNCgkJCXJldHVybjsNCgkJfQ0KCQkkKHRoaXMpLnBhcmVudCgpLm5leHQoKS5maW5kKCJhW2RhdGEtdG9nZ2xlPSd0YWInXSIpLmF0dHIoInRhYmluZGV4IiwiMCIpOw0KCQkkKHRoaXMpLnBhcmVudCgpLm5leHQoKS5maW5kKCJhW2RhdGEtdG9nZ2xlPSd0YWInXSIpLmZvY3VzKCk7DQoJfSk7DQp9DQoNCgkkKCIuaHAtbmF2LXRhYnMgYVtkYXRhLXRvZ2dsZT0ndGFiJ10iKS5vbigia2V5ZG93biBrZXlwcmVzcyBrZXl1cCIsZnVuY3Rpb24oZSl7DQoJCXZhciBrZXljb2RlID0gZS5rZXljb2RlIHx8IGUud2hpY2g7DQoJCWlmKGtleWNvZGUgPT0gMTMpew0KCQkJaGFuZGxlQWNjZXNzaWJpbGl0eSgpOw0KCQl9DQoJfSk7DQoNCg0KLyoJJCgiLmhwLW5hdi10YWJzIGFbZGF0YS10b2dnbGU9J3RhYiddIikub24oImtleWRvd24ga2V5cHJlc3Mga2V5dXAiLGZ1bmN0aW9uKGUpew0KCQl2YXIga2V5Q29kZSA9IGUua2V5Q29kZSB8fCBlLndoaWNoOyANCg0KICAJCWlmIChrZXlDb2RlID09IDkpIHsgDQoJCQl2YXIgbmV4dEVsZW1lbnQgPSAkKCIuaHAtbmF2LXRhYnMgbGkuYWN0aXZlIikubmV4dCgpOw0KCQkJd2hpbGUoJChuZXh0RWxlbWVudCkuZmluZCgiYVtkYXRhLXRvZ2dsZT0ndGFiJ10iKS5jc3MoImRpc3BsYXkiKSA9PSAibm9uZSIpew0KCQkJCW5leHRFbGVtZW50ID0gJChuZXh0RWxlbWVudCkubmV4dCgpOw0KCQkJfQ0KCQkJJChuZXh0RWxlbWVudCkuZmluZCgiYVtkYXRhLXRvZ2dsZT0ndGFiJ10iKS5hdHRyKCJ0YWJpbmRleCIsIjAiKTsgDQoJCX0NCgl9KTsNCn0pOw0KKi8gLy9EbyBub3QgcmVtb3ZlIHRoZSBjb21tZW50IC8vUHJhdGlzaGENCi8qCSQoImJvZHkiKS5vbigna2V5ZG93biBrZXlwcmVzcyBrZXl1cCcsICIubmF2Lm5hdi10YWJzLmhwLW5hdi10YWJzIC5hY3RpdmUiLCBmdW5jdGlvbihlKSB7IA0KCQ0KICAJdmFyIGtleUNvZGUgPSBlLmtleUNvZGUgfHwgZS53aGljaDsgDQoNCiAgCWlmIChrZXlDb2RlID09IDkpIHsgDQoJaWYoJCgiLnRhYi1wYW5lLmhwLXJvdy5mYWRlLmFjdGl2ZSIpLmxlbmd0aCA+IDApew0KICAgIC8qZS5wcmV2ZW50RGVmYXVsdCgpOyANCiAgICAvLyBjYWxsIGN1c3RvbSBmdW5jdGlvbiBoZXJlDQogICAgJCgiLnRhYi1wYW5lLmhwLXJvdy5mYWRlLmFjdGl2ZSIpLmF0dHIoeyJ0YWJpbmRleCI6IjAiLCJhcmlhLWV4cGFuZGVkIjp0cnVlfSk7DQoJfQ0KCWVsc2V7DQoJCXJldHVybiBmYWxzZTsNCgl9DQogIH0gDQp9KTsqLwp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXtHdWlkZWQgPSAoZnVuY3Rpb24oKXsNCgl2YXIgc3RlcCA9IDE7DQoJdmFyIHN0ZXAxMXN0YXRlID0gMTsNCgl2YXIgdGltZW91dDsNCgl2YXIgaW5pdCA9IGZ1bmN0aW9uKCl7DQoJCWlmKCQoJyNndWlkZWQnKS5sZW5ndGgpew0KDQoJCQlhZGRIYW5kbGVycygpOw0KCQl9DQoJCXN0ZXBzTGFiZWwoKTsNCgl9Ow0KDQoJdmFyIGFkZEhhbmRsZXJzID0gZnVuY3Rpb24oKXsNCgkJJCgnI3N0ZXAtMSAuZ3VpZGVkLWFjdGlvbicpLm9uKCdjbGljaycsIHNob3dOZXh0KTsNCgkJJCgnI3N0ZXAtMiAuZ3VpZGVkLWFjdGlvbicpLm9uKCdjbGljaycsIHNob3dTdGVwMyk7DQoJCSQoJyNzdGVwLTMgLnByb2R1Y3Qtc2VsZWN0aW9uIGEnKS5vbignY2xpY2snLCBzaG93TG9hZGluZyk7DQoJCSQoJy5zdGVwdHJpZ2dlcicpLm9uKCdjbGljaycsIHRyaWdnZXJTdGF0ZSk7DQoJCSQoJyNzdGVwLTMgLnJlLXNjYW4nKS5vbignY2xpY2snLCByZXNldFN0ZXAzKTsNCgkJJCgnI3N0ZXAtNSAuZG93bmxvYWQtbGlzdCAuYnV0dG9uJykub24oJ2NsaWNrJywgc2hvd05leHQpOw0KCQkkKCcjc3RlcC01IGlucHV0Jykub24oJ2NoYW5nZScsIGhhbmRsZVVuY2hlY2spOw0KCQkkKCcjc3RlcC03IC5ndWlkZWQtYWN0aW9uJykub24oJ2NsaWNrJywgc2hvd1Byb2dyZXNzQmFyKTsNCgkJJCgnI3N0ZXAtOSAuZ3VpZGVkLWFjdGlvbicpLm9uKCdjbGljaycsIHNob3dMb2FkaW5nKTsNCgl9Ow0KDQoJdmFyIHRyaWdnZXJTdGF0ZSA9IGZ1bmN0aW9uKGUpew0KCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCXZhciAkZWwgPSAkKCcuc3RlcCcrIHN0ZXAgKyAncm90YXRpb246dmlzaWJsZScpOw0KCQkkZWwuYWRkQ2xhc3MoJ2hpZGRlbicpOw0KCQlpZiAoJGVsLm5leHQoJy5zdGVwJysgc3RlcCArJ3JvdGF0aW9uJylbMF0pew0KCQkJJGVsLm5leHQoKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7DQoJCX0NCgkJZWxzZSB7DQoJCQkkKCcuc3RlcCcrIHN0ZXAgKydyb3RhdGlvbicpLmZpcnN0KCkucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOw0KCQl9DQoJCWlmIChzdGVwID09PSAxMSl7DQoJCQlzdGVwNnN0YXRlKys7DQoNCgkJCWNoYW5nZVRpdGxlMSgpOw0KDQoJCQlpZiAoc3RlcDZzdGF0ZSA9PT0gMyl7DQoJCQkJc3RlcDZzdGF0ZSA9IDE7DQoJCQl9DQoJCX0NCgl9Ow0KDQoJdmFyIHN0ZXBzTGFiZWwgPSBmdW5jdGlvbigpew0KCQl2YXIgJGNvbnRhaW5lciA9ICQoJ2RpdiNndWlkZWQgI3N0ZXBzLWJhcicpOw0KCQl2YXIgJGxpc3QgPSAkKCdkaXYjZ3VpZGVkICNzdGVwcy1iYXIgbGknKTsNCgkJc3dpdGNoIChzdGVwKXsNCgkJCWNhc2UgMToNCgkJCWNhc2UgMjoNCgkJCWNhc2UgMzoNCgkJCQkkbGlzdC5maXJzdCgpLnJlbW92ZUNsYXNzKCduZXh0Jyk7DQoJCQkJYnJlYWs7DQoJCQljYXNlIDQ6DQoJCQljYXNlIDU6DQoJCQljYXNlIDc6DQoJCQljYXNlIDg6DQoJCQljYXNlIDk6DQoJCQljYXNlIDEwOg0KCQkJCSRsaXN0LmZpcnN0KCkuYWRkQ2xhc3MoJ2RvbmUnKTsNCgkJCQkkbGlzdC5lcSgxKS5yZW1vdmVDbGFzcygnbmV4dCcpOw0KCQkJCWJyZWFrOw0KCQkJY2FzZSA2Og0KCQkJCSRsaXN0LmVxKDEpLmFkZENsYXNzKCdkb25lJyk7DQoJCQkJJGxpc3QuZXEoMikucmVtb3ZlQ2xhc3MoJ25leHQnKTsNCgkJCQlicmVhazsNCgkJfQ0KCX07DQoNCgl2YXIgc2hvd05leHQgPSBmdW5jdGlvbihlKXsNCgkJJCgnI3N0ZXAtJyArIHN0ZXApLmFkZENsYXNzKCdoaWRkZW4nKTsNCgkJc3RlcCsrOw0KCQkkKCcjc3RlcC0nICsgc3RlcCkucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOw0KCQlzdGVwc0xhYmVsKCk7DQoJCWlmIChzdGVwID09IDYpIHsNCgkJCWNoYW5nZVRpdGxlMSgpOw0KCQl9DQoJfTsNCg0KCXZhciBjaGFuZ2VUaXRsZTEgPSBmdW5jdGlvbigpew0KCQkkKCcjc3dkLXRpdGxlJykudGV4dCgnVGhhbmsgeW91IGZvciB1c2luZyB0aGUgSFAgZ3VpZGVkIGV4cGVyaWVuY2UgZm9yIHlvdXIgc29mdHdhcmUgYW5kIGRyaXZlcnMnKTsNCgkJJCgnI3N3ZC10aXRsZS10ZXh0JykucmVtb3ZlKCk7DQoJfTsNCg0KCXZhciBoYW5kbGVVbmNoZWNrID0gZnVuY3Rpb24oZSl7DQoJCXZhciBzZWxmID0gdGhpczsNCgkJaWYgKCF0aGlzLmNoZWNrZWQgJiYgdGhpcy52YWx1ZSA9PSAxKSB7DQoJCQkkKCcjZHJpdmVyLWRvd25sb2FkLXdhcm5pbmcnKS5tb2RhbCgndG9nZ2xlJyk7DQoJCQkkKCcuY2FuY2VsJykudW5iaW5kKCkub24oJ2NsaWNrJywgZnVuY3Rpb24oKXsNCgkJCQkkKHNlbGYpLmNsaWNrKCk7DQoJCQl9KTsNCgkJfQ0KCQlpZiAoISQoJy5kb3dubG9hZC1saXN0IC5saXN0LWJvZHkgaW5wdXQnKS5pcygnOmNoZWNrZWQnKSkgew0KCQkJJCgnLmRvd25sb2FkLWxpc3QgLmJ1dHRvbicpLmFkZENsYXNzKCdidXR0b24tZGlzYWJsZWQnKS51bmJpbmQoKTsNCgkJfQ0KCQllbHNlIHsNCgkJCSQoJy5kb3dubG9hZC1saXN0IC5idXR0b24nKS5yZW1vdmVDbGFzcygnYnV0dG9uLWRpc2FibGVkJykub24oJ2NsaWNrJyxzaG93UHJvZ3Jlc3NCYXIpOw0KCQl9DQoJfTsNCg0KCXZhciByZXNldFN0ZXAzID0gZnVuY3Rpb24oZSkgew0KCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCXN0ZXAgPSAyOw0KCQlzaG93U3RlcDMoKTsNCgl9Ow0KDQoJdmFyIHNob3dTdGVwMyA9IGZ1bmN0aW9uKCl7DQoJCXZhciAkaXRlbXMgPSAkKCcjc3RlcC0zIC5zZWxlY3Rpb24tZ3JvdXAgLnByb2R1Y3Qtc2VsZWN0aW9uJyk7DQoJCXZhciBmaW5pc2hMb2FkaW5nID0gNjAwMDsNCgkJJCgnI3N0ZXAtMyAucHJvZ3Jlc3MtYmFyLWNvbXBvbmVudCcpLnNob3coKTsNCgkJJCgnI2ZvdW5kLWNvdW50JykuaHRtbCgnKDApJyk7DQoJCSQoJyNuZXR3b3JrLWNvdW50JykuaHRtbCgnKDApJyk7DQoJCSQoJyNzdGVwLTMgLmhlYWRlcjEnKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7DQoJCSQoJyNzdGVwLTMgLmhlYWRlcjInKS5hZGRDbGFzcygnaGlkZGVuJyk7DQoJCXdpbmRvdy5ydW5Qcm9ncmVzc0JhcigpOw0KCQlpZiAodGltZW91dCkgew0KCQkJY2xlYXJUaW1lb3V0KHRpbWVvdXQpOw0KCQl9DQoJCSRpdGVtcy5oaWRlKCk7DQoJCXNob3dOZXh0KCk7DQoJCSRpdGVtcy5lYWNoKGZ1bmN0aW9uKGluZGV4LCBlbCl7DQoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQoJCQkJJCgnI2ZvdW5kLXNlbGVjdGlvbnMnKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7DQoJCQl9LCBmaW5pc2hMb2FkaW5nIC8gNCk7DQoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQoJCQkJJCgnI25ldHdvcmstc2VsZWN0aW9ucycpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsNCgkJCX0sIGZpbmlzaExvYWRpbmcgLyAyKTsNCgkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCgkJCQkkKGVsKS5zaG93KCk7DQoJCQkJdmFyICRuZXR3b3JrID0gJCgnI25ldHdvcmstc2VsZWN0aW9ucyAucHJvZHVjdC1zZWxlY3Rpb246dmlzaWJsZScpOw0KCQkJCXZhciAkZm91bmQgPSAkKCcjZm91bmQtc2VsZWN0aW9ucyAucHJvZHVjdC1zZWxlY3Rpb246dmlzaWJsZScpOw0KCQkJCSQoJyNmb3VuZC1jb3VudCcpLmh0bWwoJygnICsgJGZvdW5kLmxlbmd0aCsnKScpOw0KCQkJCSQoJyNuZXR3b3JrLWNvdW50JykuaHRtbCgnKCcgKyAkbmV0d29yay5sZW5ndGgrJyknKTsNCgkJCX0sZmluaXNoTG9hZGluZy80ICogKGluZGV4ICsgMSkpOw0KCQl9KTsNCgkJdGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCgkJCSQoJyNzdGVwLTMgLnByb2dyZXNzLWJhci1jb21wb25lbnQnKS5oaWRlKCk7DQoJCQkkKCcjc3RlcC0zIC5oZWFkZXIxJykuZmlyc3QoKS5hZGRDbGFzcygnaGlkZGVuJyk7DQoJCQkkKCcjc3RlcC0zIC5oZWFkZXIyJykuZmlyc3QoKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7DQoJCQkkKCcjaWRlbnRpZnktdGV4dDEnKS5hZGRDbGFzcygnaGlkZGVuJyk7DQoJCQkkKCcjaWRlbnRpZnktdGV4dDInKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7DQoJCX0sZmluaXNoTG9hZGluZyArIDUwMCk7DQoJfTsNCg0KCXZhciBzaG93TG9hZGluZyA9IGZ1bmN0aW9uKGUpew0KCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCXNob3dOZXh0KCk7DQoJCXNldFRpbWVvdXQoc2hvd05leHQsNDAwMCk7DQoJfTsNCg0KCXZhciBzaG93UHJvZ3Jlc3NCYXIgPSBmdW5jdGlvbigpew0KCQl3aW5kb3cucnVuUHJvZ3Jlc3NCYXIoKTsNCgkJc2V0VGltZW91dChzaG93TmV4dCw2MDAwKTsNCgkJc2hvd05leHQoKTsNCgl9Ow0KCXJldHVybiB7DQoJCWluaXQ6IGluaXQNCgl9Ow0KfSgpKTsKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7T3NTZWxlY3RvciA9IChmdW5jdGlvbigpew0KDQoJdmFyIGluaXQgPSBmdW5jdGlvbigpew0KCQlpZiAoJCgnI29zLXNlbGVjdG9yJykubGVuZ3RoKSB7DQoJLyogYWRkZWQgYXMgYSBwYXJ0IG9mIG5ldyBidWlsZCBkdXJpbmcgbWVyZ2UuIE5lZWRzIHRvIGJlIHZhbGlkYXRlZCANCgkJCSQoJyNvcy1zZWxlY3RvcicpLmhpZGUoKTsNCgkJCSQoJyNvcy1oZWFkaW5nMicpLmhpZGUoKTsqLw0KCQkJYWRkSGFuZGxlcnMoKTsNCgkJfSAgICANCgl9Ow0KDQoJdmFyIGFkZEhhbmRsZXJzID0gZnVuY3Rpb24oKXsNCgkJJCgnI29zLXVwZGF0ZScpLm9uKCdjbGljaycsIHVwZGF0ZU9zKTsgDQoJCSQoJyNvcy1oZWFkaW5nMScpLm9uKCdjbGljaycsIHdvcmRIYW5kbGVyKTsNCgkJJCgnI29zLWhlYWRpbmcyJykub24oJ2NsaWNrJywgeEhhbmRsZXIpOw0KCQkvKiBhZGRlZCBhcyBhIHBhcnQgb2YgbmV3IGJ1aWxkLiBQcmF0aXNoYSB0byB2YWxpZGF0ZSANCgkJJCgnI29zLXdvcmQtdHJpZ2dlcicpLm9uKCdjbGljaycsIHdvcmRIYW5kbGVyKTsNCgkJJCgnI29zLXgtdHJpZ2dlcicpLm9uKCdjbGljaycsIHhIYW5kbGVyKTsqLw0KCQkkKCcuZmFuY3ktc2VsZWN0IC50cmlnZ2VyJykub24oJ2NsaWNrJywgZHJvcGRvd25IYW5kbGVyKTsgDQoJfTsNCg0KCXZhciBkcm9wZG93bkhhbmRsZXIgPSBmdW5jdGlvbihlKXsNCgkJJCgnLmZhbmN5LXNlbGVjdCAudHJpZ2dlciArIC5vcHRpb25zJykubm90KCQodGhpcykpLm5vdCgkKHRoaXMpLm5leHQoKSkucmVtb3ZlQ2xhc3MoJ29wZW4nKTsNCgl9Ow0KDQoJdmFyIHhIYW5kbGVyID0gZnVuY3Rpb24oKXsNCgkJJCgiI29zLWhlYWRpbmcxIikuY3NzKCJwb2ludGVyLWV2ZW50cyIsIm5vbmUiKTsNCgkJLy8kKCcjb3MtaGVhZGluZzEnKS5zaG93KCk7DQoJCSQoJyNvcy1oZWFkaW5nMicpLmhpZGUoKTsNCgkJJCgnI29zLXgtdHJpZ2dlcicpLnNob3coKTsNCgl9Ow0KDQoJdmFyIHdvcmRIYW5kbGVyID0gZnVuY3Rpb24oKXsNCgkJJCgiI29zLWhlYWRpbmcyIikuY3NzKCJwb2ludGVyLWV2ZW50cyIsIm5vbmUiKTsNCgkJLy8kKCcjb3MtaGVhZGluZzInKS5zaG93KCk7DQoJCSQoJyNvcy1oZWFkaW5nMScpLmhpZGUoKTsNCgkJJCgnI29zLXNlbGVjdG9yJykuc2hvdygpOw0KCX07DQoJdmFyIHVwZGF0ZU9zID0gZnVuY3Rpb24oZSl7DQoJCSQoIiNtb2RhbC1zZWxlY3QtZGlmZi1vcyIpLmhpZGUoKTsNCgkJJCgiI21vZGFsLXNlbGVjdC1kaWZmLW9zLW5vZHJpdmVycyIpLmhpZGUoKTsNCgkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQl2YXIgcmVzdWx0QXJyYXkgPSAkKCcjb3Mtc2VsZWN0b3InKS5zZXJpYWxpemVBcnJheSgpOw0KCQkkLmVhY2gocmVzdWx0QXJyYXksIGZ1bmN0aW9uKGluZGV4LCB2YWx1ZSl7DQoJCQljb25zb2xlLmxvZyh2YWx1ZSk7DQoJCQl2YXIgcGxhdGZvcm0gPSAnb3MtJyArIHZhbHVlLm5hbWU7DQoJCQl2YXIgdGV4dCA9IHZhbHVlLnZhbHVlOw0KCQkJJCgnIycrcGxhdGZvcm0pLmh0bWwodGV4dCk7DQoJCX0pOw0KCQkkKCcjb3Mtc2VsZWN0b3InKS5yZW1vdmVDbGFzcygnaW4nKS5zbGlkZVVwKCk7DQoJCSQoJy5vcy1zZWxlY3Rvci10cmlnZ2VyJykucmVtb3ZlQ2xhc3MoJ3RvZ2dsZWQnKTsNCgkJJCgnI29zLWhlYWRpbmcyJykuaGlkZSgpOw0KCQkvLyQoJyNvcy1oZWFkaW5nMScpLnNob3coKTsNCgl9Ow0KDQoJcmV0dXJuIHsNCgkJaW5pdCA6IGluaXQNCgl9Ow0KfSkoKTsKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7RG93bmxvYWRUYWJsZSA9IChmdW5jdGlvbigpew0KICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCl7DQogICAgaWYgKCQoJy5kb3dubG9hZC10YWJsZScpLmxlbmd0aCl7DQogICAgICBhZGRIYW5kbGVycygpOw0KICAgIH0NCiAgfTsNCiAgdmFyIGFkZEhhbmRsZXJzID0gZnVuY3Rpb24oKSB7DQogICAgICAkKCcjZG93bmxvYWQtdGFibGUgLnN3ZC1kcm9wZG93bicpLm9uKCdjbGljaycsIHN3ZERyb3Bkb3duKTsNCiAgICAgICQoJ2EuYWNjb3JkaW9uVGl0bGUnKS5vbignY2xpY2snLCBmZWF0dXJlZERyaXZlclNob3cpOyAvKlZWKi8NCiAgfTsNCg0KDQogIC8qIGZlYXR1cmVkRHJpdmVyIGFuZCBzd2REcm9wZG93biBmdW5jdGlvbiBtb3ZlZCB0byBzd2RBY2NvcmRpb24uanMgaW4gdGhlIHBvcnRsZXQgVlYqLw0KDQoJICAgIC8qQUEgLSBmdW5jdGlvbiBlbmRzIGhlcmUqLw0KCXZhciBzb3J0ID0gZnVuY3Rpb24oZXYpew0KCQl2YXIgcmV2ZXJzZTsNCgkJdmFyICR0aGlzID0gJCh0aGlzKTsNCgkJdmFyIHNvcnRDYXQgPSAkdGhpcy5kYXRhKCdzb3J0LXRyaWdnZXInKTsNCgkJdmFyICR0b2dnbGVzID0gJCgnI3NvcnRhYmxlLXRhYmxlIC5wYW5lbCcpOw0KCQlldi5wcmV2ZW50RGVmYXVsdCgpOw0KCQkkKCdbZGF0YS1zb3J0LXRyaWdnZXJdJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJJCgnW2RhdGEtc29ydC10cmlnZ2VyXScpLm5vdCgkKHRoaXMpKS5yZW1vdmVDbGFzcygncmV2ZXJzZScpOw0KCQkkdGhpcy5hZGRDbGFzcygnYWN0aXZlJykucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkkdGhpcy5oYXNDbGFzcygncmV2ZXJzZScpID8JcmV2ZXJzZSA9IHRydWUgOiByZXZlcnNlID0gZmFsc2UNCgkJJHRvZ2dsZXMuZWFjaChmdW5jdGlvbihpbmRleCl7DQoJCQl2YXIgc29ydEVscyA9ICQodGhpcykuZmluZCgnW2RhdGEtc29ydD0iJytzb3J0Q2F0KyciXScpOw0KCQkJc29ydEVscy5zb3J0KGZ1bmN0aW9uKGEsYil7DQoJCQkJdmFyIHJlc3VsdDsNCgkJCQlpZiAoc29ydENhdCA9PT0gJ2RhdGUnKSB7DQoJCQkJCWEgPSBuZXcgRGF0ZSgkKGEpLmh0bWwoKSk7DQoJCQkJCWIgPSBuZXcgRGF0ZSgkKGIpLmh0bWwoKSk7DQoJCQkJfQ0KCQkJCWVsc2Ugew0KCQkJCQlhID0gJChhKS5odG1sKCk7DQoJCQkJCWIgPSAkKGIpLmh0bWwoKTsNCgkJCQl9DQoJCQkJaWYgKGEgPiBiKSB7DQoJCQkJCXJlc3VsdCA9IDE7DQoJCQkJfQ0KCQkJCWVsc2UgaWYgKGEgPCBiKSB7DQoJCQkJCXJlc3VsdCA9IC0xOw0KCQkJCX0NCgkJCQllbHNlIHsNCgkJCQkJcmVzdWx0ID0gMDsNCgkJCQl9DQoJCQkJcmV0dXJuIAlyZXZlcnNlID8gcmVzdWx0IDogLXJlc3VsdDsNCgkJCX0pOw0KCQkJJHNvcnRFbHMgPSAkKHNvcnRFbHMpLm1hcChmdW5jdGlvbihpbmRleCl7DQoJCQkJcmV0dXJuICQodGhpcykucGFyZW50cygnLnNvcnRhYmxlLXJvdycpWzBdOw0KCQkJfSk7DQoJCQljb25zb2xlLmxvZygkKHRoaXMpLmZpbmQoJy50YWJsZSA+IHRib2R5JykpOw0KCQkJY29uc29sZS5sb2coJHNvcnRFbHMpOw0KCQkJJCh0aGlzKS5maW5kKCcudGFibGUgPiB0Ym9keScpLmh0bWwoJHNvcnRFbHMpOw0KCQl9KTsNCgkJJHRoaXMudG9nZ2xlQ2xhc3MoJ3JldmVyc2UnKTsNCgkJJCgnLnN3ZC1kcm9wZG93bicpLm9uKCdjbGljaycsIHN3ZERyb3Bkb3duKTsNCgl9Ow0KCXZhciBtb2JpbGVTb3J0ID0gZnVuY3Rpb24oZXYpew0KCQl2YXIgJHRoaXMgPSAkKHRoaXMpOw0KCQl2YXIgc29ydENhdCAgPSAkdGhpcy5kYXRhKCdtb2JpbGUtdHJpZ2dlcicpOw0KCQl2YXIgcmV2ZXJzZSA9ICR0aGlzLmRhdGEoJ3JldmVyc2UnKTsNCgkJdmFyICR0b2dnbGVzID0gJCgnI3NvcnRhYmxlLXRhYmxlIC5wYW5lbCcpOw0KCX07DQogIHJldHVybiB7DQogICAgaW5pdCA6IGluaXQNCiAgICANCiAgfTsNCn0oKSk7Cn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5eyQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7DQogIHZhciBzZXRfdGFiID0gZnVuY3Rpb24odGFiX2NvbnRhaW5lcl9pZCwgdGFiX2lkKXsNCiAgICAkKCcjJyArIHRhYl9jb250YWluZXJfaWQgKyAnIHVsIGxpJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KDQoNCiAgICAvLyAgTm93IGFkZCBjbGFzcyAiYWN0aXZlIiB0byB0aGUgc2VsZWN0ZWQvY2xpY2tlZCB0YWINCiAgICAkKCcjJyArIHRhYl9jb250YWluZXJfaWQgKyAnIGFbcmVsPSInK3RhYl9pZCsnIl0nKS5wYXJlbnQoKS5hZGRDbGFzcygiYWN0aXZlIik7DQogICAgJCgnIycgKyB0YWJfY29udGFpbmVyX2lkICsgJy1jb250ZW50IC50YWItcGFuZScpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKS5oaWRlKCk7DQoNCiAgICAvLyAgU2hvdyB0aGUgc2VsZWN0ZWQgdGFiIGNvbnRlbnQNCiAgICAkKCcjJyArIHRhYl9jb250YWluZXJfaWQgKyAnLWNvbnRlbnQgIycgKyB0YWJfaWQpLmFkZENsYXNzKCJhY3RpdmUiKS5mYWRlSW4oKTsNCiAgfQ0KDQogIC8vICBGdW5jdGlvbiB0aGF0IGdldHMgdGhlIGhhc2ggZnJvbSBVUkwNCiAgdmFyIGdldF9oYXNoID0gZnVuY3Rpb24oKXsNCiAgICBpZiAod2luZG93LmxvY2F0aW9uLmhhc2gpIHsNCiAgICAgIC8vICBHZXQgdGhlIGhhc2ggZnJvbSBVUkwNCiAgICAgIHZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaGFzaDsNCg0KICAgICAgLy8gIFJlbW92ZSB0aGUgIw0KICAgICAgdmFyIGN1cnJlbnRfaGFzaCA9IHVybC5zdWJzdHJpbmcoMSk7DQoNCiAgICAgIC8vICBTcGxpdCB0aGUgSURzIHdpdGggY29tbWENCiAgICAgIHZhciBjdXJyZW50X2hhc2hlcyA9IGN1cnJlbnRfaGFzaC5zcGxpdCgiLCIpOw0KICAgICAgJC5lYWNoKGN1cnJlbnRfaGFzaGVzLCBmdW5jdGlvbihpLCB2KXsNCiAgICAgICAgc2V0X3RhYigkKCdhW3JlbD0iJyt2KyciXScpLnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgpLmF0dHIoJ2lkJyksIHYpOw0KICAgICAgfSk7DQogICAgfQ0KICB9DQoNCiAgLy8gIENhbGxlZCB3aGVuIHBhZ2UgaXMgZmlyc3QgbG9hZGVkIG9yIHJlZnJlc2hlZA0KICBnZXRfaGFzaCgpOw0KDQogIC8vICBMb29rcyBmb3IgY2hhbmdlcyBpbiB0aGUgVVJMIGhhc2gNCiAgJCh3aW5kb3cpLmJpbmQoJ2hhc2hjaGFuZ2UnLCBmdW5jdGlvbigpIHsNCiAgICBnZXRfaGFzaCgpOw0KICB9KTsNCg0KICAvLyAgQ2FsbGVkIHdoZW4gd2UgY2xpY2sgb24gdGhlIHRhYiBpdHNlbGYNCiAgJCgnLnRhYi1ib3ggdWwgbGknKS5jbGljayhmdW5jdGlvbigpIHsNCiAgICB2YXIgdGFiX2lkID0gJCh0aGlzKS5jaGlsZHJlbignYScpLmF0dHIoJ3JlbCcpOw0KDQogICAgLy8gIFVwZGF0ZSB0aGUgaGFzaCBpbiB0aGUgdXJsDQogICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSB0YWJfaWQ7DQoNCiAgICAvLyAgRG8gbm90aGluZyB3aGVuIHRhYiBpcyBjbGlja2VkDQogICAgcmV0dXJuIGZhbHNlOw0KICB9KTsNCn0pOwp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIEJvb3RzdHJhcDogbW9kYWwuanMgdjMuMC4yDQogKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNtb2RhbHMNCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTMgVHdpdHRlciwgSW5jLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KDQorZnVuY3Rpb24gKCQpIHsgInVzZSBzdHJpY3QiOw0KDQogIC8vIE1PREFMIENMQVNTIERFRklOSVRJT04NCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PQ0KDQogIHZhciBNb2RhbCA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7DQogICAgdGhpcy5vcHRpb25zICAgPSBvcHRpb25zDQogICAgdGhpcy4kZWxlbWVudCAgPSAkKGVsZW1lbnQpDQogICAgdGhpcy4kYmFja2Ryb3AgPQ0KICAgIHRoaXMuaXNTaG93biAgID0gbnVsbA0KDQogICAgaWYgKHRoaXMub3B0aW9ucy5yZW1vdGUpIHRoaXMuJGVsZW1lbnQubG9hZCh0aGlzLm9wdGlvbnMucmVtb3RlKQ0KICB9DQoNCiAgTW9kYWwuREVGQVVMVFMgPSB7DQogICAgICBiYWNrZHJvcDogdHJ1ZQ0KICAgICwga2V5Ym9hcmQ6IHRydWUNCiAgICAsIHNob3c6IHRydWUNCiAgfQ0KDQogIE1vZGFsLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiAoX3JlbGF0ZWRUYXJnZXQpIHsNCiAgICByZXR1cm4gdGhpc1shdGhpcy5pc1Nob3duID8gJ3Nob3cnIDogJ2hpZGUnXShfcmVsYXRlZFRhcmdldCkNCiAgfQ0KDQogIE1vZGFsLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKF9yZWxhdGVkVGFyZ2V0KSB7DQogICAgdmFyIHRoYXQgPSB0aGlzDQogICAgdmFyIGUgICAgPSAkLkV2ZW50KCdzaG93LmJzLm1vZGFsJywgeyByZWxhdGVkVGFyZ2V0OiBfcmVsYXRlZFRhcmdldCB9KQ0KDQogICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpDQoNCiAgICBpZiAodGhpcy5pc1Nob3duIHx8IGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVybg0KDQogICAgdGhpcy5pc1Nob3duID0gdHJ1ZQ0KDQogICAgdGhpcy5lc2NhcGUoKQ0KDQogICAgdGhpcy4kZWxlbWVudC5vbignY2xpY2suZGlzbWlzcy5tb2RhbCcsICdbZGF0YS1kaXNtaXNzPSJtb2RhbCJdJywgJC5wcm94eSh0aGlzLmhpZGUsIHRoaXMpKQ0KDQogICAgdGhpcy5iYWNrZHJvcChmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgdHJhbnNpdGlvbiA9ICQuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoYXQuJGVsZW1lbnQuaGFzQ2xhc3MoJ2ZhZGUnKQ0KDQogICAgICBpZiAoIXRoYXQuJGVsZW1lbnQucGFyZW50KCkubGVuZ3RoKSB7DQogICAgICAgIHRoYXQuJGVsZW1lbnQuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSkgLy8gZG9uJ3QgbW92ZSBtb2RhbHMgZG9tIHBvc2l0aW9uDQogICAgICB9DQoNCiAgICAgIHRoYXQuJGVsZW1lbnQuc2hvdygpDQoNCiAgICAgIGlmICh0cmFuc2l0aW9uKSB7DQogICAgICAgIHRoYXQuJGVsZW1lbnRbMF0ub2Zmc2V0V2lkdGggLy8gZm9yY2UgcmVmbG93DQogICAgICB9DQoNCiAgICAgIHRoYXQuJGVsZW1lbnQNCiAgICAgICAgLmFkZENsYXNzKCdpbicpDQogICAgICAgIC5hdHRyKCdhcmlhLWhpZGRlbicsIGZhbHNlKQ0KDQogICAgICB0aGF0LmVuZm9yY2VGb2N1cygpDQoNCiAgICAgIHZhciBlID0gJC5FdmVudCgnc2hvd24uYnMubW9kYWwnLCB7IHJlbGF0ZWRUYXJnZXQ6IF9yZWxhdGVkVGFyZ2V0IH0pDQoNCiAgICAgIHRyYW5zaXRpb24gPw0KICAgICAgICB0aGF0LiRlbGVtZW50LmZpbmQoJy5tb2RhbC1kaWFsb2cnKSAvLyB3YWl0IGZvciBtb2RhbCB0byBzbGlkZSBpbg0KICAgICAgICAgIC5vbmUoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0aGF0LiRlbGVtZW50LmZvY3VzKCkudHJpZ2dlcihlKQ0KICAgICAgICAgIH0pDQogICAgICAgICAgLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDMwMCkgOg0KICAgICAgICB0aGF0LiRlbGVtZW50LmZvY3VzKCkudHJpZ2dlcihlKQ0KICAgIH0pDQogIH0NCg0KICBNb2RhbC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uIChlKSB7DQogICAgaWYgKGUpIGUucHJldmVudERlZmF1bHQoKQ0KDQogICAgZSA9ICQuRXZlbnQoJ2hpZGUuYnMubW9kYWwnKQ0KDQogICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpDQoNCiAgICBpZiAoIXRoaXMuaXNTaG93biB8fCBlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm4NCg0KICAgIHRoaXMuaXNTaG93biA9IGZhbHNlDQoNCiAgICB0aGlzLmVzY2FwZSgpDQoNCiAgICAkKGRvY3VtZW50KS5vZmYoJ2ZvY3VzaW4uYnMubW9kYWwnKQ0KDQogICAgdGhpcy4kZWxlbWVudA0KICAgICAgLnJlbW92ZUNsYXNzKCdpbicpDQogICAgICAuYXR0cignYXJpYS1oaWRkZW4nLCB0cnVlKQ0KICAgICAgLm9mZignY2xpY2suZGlzbWlzcy5tb2RhbCcpDQoNCiAgICAkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiB0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdmYWRlJykgPw0KICAgICAgdGhpcy4kZWxlbWVudA0KICAgICAgICAub25lKCQuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCwgJC5wcm94eSh0aGlzLmhpZGVNb2RhbCwgdGhpcykpDQogICAgICAgIC5lbXVsYXRlVHJhbnNpdGlvbkVuZCgzMDApIDoNCiAgICAgIHRoaXMuaGlkZU1vZGFsKCkNCiAgfQ0KDQogIE1vZGFsLnByb3RvdHlwZS5lbmZvcmNlRm9jdXMgPSBmdW5jdGlvbiAoKSB7DQogICAgJChkb2N1bWVudCkNCiAgICAgIC5vZmYoJ2ZvY3VzaW4uYnMubW9kYWwnKSAvLyBndWFyZCBhZ2FpbnN0IGluZmluaXRlIGZvY3VzIGxvb3ANCiAgICAgIC5vbignZm9jdXNpbi5icy5tb2RhbCcsICQucHJveHkoZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgaWYgKHRoaXMuJGVsZW1lbnRbMF0gIT09IGUudGFyZ2V0ICYmICF0aGlzLiRlbGVtZW50LmhhcyhlLnRhcmdldCkubGVuZ3RoKSB7DQogICAgICAgICAgdGhpcy4kZWxlbWVudC5mb2N1cygpDQogICAgICAgIH0NCiAgICAgIH0sIHRoaXMpKQ0KICB9DQoNCiAgTW9kYWwucHJvdG90eXBlLmVzY2FwZSA9IGZ1bmN0aW9uICgpIHsNCiAgICBpZiAodGhpcy5pc1Nob3duICYmIHRoaXMub3B0aW9ucy5rZXlib2FyZCkgew0KICAgICAgdGhpcy4kZWxlbWVudC5vbigna2V5dXAuZGlzbWlzcy5icy5tb2RhbCcsICQucHJveHkoZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgZS53aGljaCA9PSAyNyAmJiB0aGlzLmhpZGUoKQ0KICAgICAgfSwgdGhpcykpDQogICAgfSBlbHNlIGlmICghdGhpcy5pc1Nob3duKSB7DQogICAgICB0aGlzLiRlbGVtZW50Lm9mZigna2V5dXAuZGlzbWlzcy5icy5tb2RhbCcpDQogICAgfQ0KICB9DQoNCiAgTW9kYWwucHJvdG90eXBlLmhpZGVNb2RhbCA9IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgdGhhdCA9IHRoaXMNCiAgICB0aGlzLiRlbGVtZW50LmhpZGUoKQ0KICAgIHRoaXMuYmFja2Ryb3AoZnVuY3Rpb24gKCkgew0KICAgICAgdGhhdC5yZW1vdmVCYWNrZHJvcCgpDQogICAgICB0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ2hpZGRlbi5icy5tb2RhbCcpDQogICAgfSkNCiAgfQ0KDQogIE1vZGFsLnByb3RvdHlwZS5yZW1vdmVCYWNrZHJvcCA9IGZ1bmN0aW9uICgpIHsNCiAgICB0aGlzLiRiYWNrZHJvcCAmJiB0aGlzLiRiYWNrZHJvcC5yZW1vdmUoKQ0KICAgIHRoaXMuJGJhY2tkcm9wID0gbnVsbA0KICB9DQoNCiAgTW9kYWwucHJvdG90eXBlLmJhY2tkcm9wID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7DQogICAgdGhpcy5vcHRpb25zLmJhY2tkcm9wID0gJ3N0YXRpYycNCiAgICB2YXIgdGhhdCAgICA9IHRoaXMNCiAgICB2YXIgYW5pbWF0ZSA9IHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2ZhZGUnKSA/ICdmYWRlJyA6ICcnDQoNCiAgICBpZiAodGhpcy5pc1Nob3duICYmIHRoaXMub3B0aW9ucy5iYWNrZHJvcCkgew0KICAgICAgdmFyIGRvQW5pbWF0ZSA9ICQuc3VwcG9ydC50cmFuc2l0aW9uICYmIGFuaW1hdGUNCg0KICAgICAgdGhpcy4kYmFja2Ryb3AgPSAkKCc8ZGl2IGNsYXNzPSJtb2RhbC1iYWNrZHJvcCAnICsgYW5pbWF0ZSArICciIC8+JykNCiAgICAgICAgLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpDQoNCiAgICAgIHRoaXMuJGVsZW1lbnQub24oJ2NsaWNrLmRpc21pc3MubW9kYWwnLCAkLnByb3h5KGZ1bmN0aW9uIChlKSB7DQogICAgICAgIGlmIChlLnRhcmdldCAhPT0gZS5jdXJyZW50VGFyZ2V0KSByZXR1cm4NCiAgICAgICAgdGhpcy5vcHRpb25zLmJhY2tkcm9wID09ICdzdGF0aWMnDQogICAgICAgICAgPyB0aGlzLiRlbGVtZW50WzBdLmZvY3VzLmNhbGwodGhpcy4kZWxlbWVudFswXSkNCiAgICAgICAgICA6IHRoaXMuaGlkZS5jYWxsKHRoaXMpDQogICAgICB9LCB0aGlzKSkNCg0KICAgICAgaWYgKGRvQW5pbWF0ZSkgdGhpcy4kYmFja2Ryb3BbMF0ub2Zmc2V0V2lkdGggLy8gZm9yY2UgcmVmbG93DQoNCiAgICAgIHRoaXMuJGJhY2tkcm9wLmFkZENsYXNzKCdpbicpDQoNCiAgICAgIGlmICghY2FsbGJhY2spIHJldHVybg0KDQogICAgICBkb0FuaW1hdGUgPw0KICAgICAgICB0aGlzLiRiYWNrZHJvcA0KICAgICAgICAgIC5vbmUoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLCBjYWxsYmFjaykNCiAgICAgICAgICAuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKSA6DQogICAgICAgIGNhbGxiYWNrKCkNCg0KICAgIH0gZWxzZSBpZiAoIXRoaXMuaXNTaG93biAmJiB0aGlzLiRiYWNrZHJvcCkgew0KICAgICAgdGhpcy4kYmFja2Ryb3AucmVtb3ZlQ2xhc3MoJ2luJykNCg0KICAgICAgJC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnZmFkZScpPw0KICAgICAgICB0aGlzLiRiYWNrZHJvcA0KICAgICAgICAgIC5vbmUoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLCBjYWxsYmFjaykNCiAgICAgICAgICAuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKSA6DQogICAgICAgIGNhbGxiYWNrKCkNCg0KICAgIH0gZWxzZSBpZiAoY2FsbGJhY2spIHsNCiAgICAgIGNhbGxiYWNrKCkNCiAgICB9DQogIH0NCg0KDQogIC8vIE1PREFMIFBMVUdJTiBERUZJTklUSU9ODQogIC8vID09PT09PT09PT09PT09PT09PT09PT09DQoNCiAgdmFyIG9sZCA9ICQuZm4ubW9kYWwNCg0KICAkLmZuLm1vZGFsID0gZnVuY3Rpb24gKG9wdGlvbiwgX3JlbGF0ZWRUYXJnZXQpIHsNCiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciAkdGhpcyAgID0gJCh0aGlzKQ0KICAgICAgdmFyIGRhdGEgICAgPSAkdGhpcy5kYXRhKCdicy5tb2RhbCcpDQogICAgICB2YXIgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBNb2RhbC5ERUZBVUxUUywgJHRoaXMuZGF0YSgpLCB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvbikNCg0KICAgICAgaWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdicy5tb2RhbCcsIChkYXRhID0gbmV3IE1vZGFsKHRoaXMsIG9wdGlvbnMpKSkNCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0oX3JlbGF0ZWRUYXJnZXQpDQogICAgICBlbHNlIGlmIChvcHRpb25zLnNob3cpIGRhdGEuc2hvdyhfcmVsYXRlZFRhcmdldCkNCiAgICB9KQ0KICB9DQoNCiAgJC5mbi5tb2RhbC5Db25zdHJ1Y3RvciA9IE1vZGFsDQoNCg0KICAvLyBNT0RBTCBOTyBDT05GTElDVA0KICAvLyA9PT09PT09PT09PT09PT09PQ0KDQogICQuZm4ubW9kYWwubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsNCiAgICAkLmZuLm1vZGFsID0gb2xkDQogICAgcmV0dXJuIHRoaXMNCiAgfQ0KDQoNCiAgLy8gTU9EQUwgREFUQS1BUEkNCiAgLy8gPT09PT09PT09PT09PT0NCg0KICAkKGRvY3VtZW50KS5vbignY2xpY2suYnMubW9kYWwuZGF0YS1hcGknLCAnW2RhdGEtdG9nZ2xlPSJtb2RhbCJdJywgZnVuY3Rpb24gKGUpIHsNCiAgICB2YXIgJHRoaXMgICA9ICQodGhpcykNCiAgICB2YXIgaHJlZiAgICA9ICR0aGlzLmF0dHIoJ2hyZWYnKQ0KICAgIHZhciAkdGFyZ2V0ID0gJCgkdGhpcy5hdHRyKCdkYXRhLXRhcmdldCcpIHx8IChocmVmICYmIGhyZWYucmVwbGFjZSgvLiooPz0jW15cc10rJCkvLCAnJykpKSAvL3N0cmlwIGZvciBpZTcNCiAgICB2YXIgb3B0aW9uICA9ICR0YXJnZXQuZGF0YSgnbW9kYWwnKSA/ICd0b2dnbGUnIDogJC5leHRlbmQoeyByZW1vdGU6ICEvIy8udGVzdChocmVmKSAmJiBocmVmIH0sICR0YXJnZXQuZGF0YSgpLCAkdGhpcy5kYXRhKCkpDQoNCiAgICBlLnByZXZlbnREZWZhdWx0KCkNCg0KICAgICR0YXJnZXQNCiAgICAgIC5tb2RhbChvcHRpb24sIHRoaXMpDQogICAgICAub25lKCdoaWRlJywgZnVuY3Rpb24gKCkgew0KICAgICAgICAkdGhpcy5pcygnOnZpc2libGUnKSAmJiAkdGhpcy5mb2N1cygpDQogICAgICB9KQ0KICB9KQ0KDQogICQoZG9jdW1lbnQpDQogICAgLm9uKCdzaG93LmJzLm1vZGFsJywgICcubW9kYWwnLCBmdW5jdGlvbiAoKSB7ICQoZG9jdW1lbnQuYm9keSkuYWRkQ2xhc3MoJ21vZGFsLW9wZW4nKSB9KQ0KICAgIC5vbignaGlkZGVuLmJzLm1vZGFsJywgJy5tb2RhbCcsIGZ1bmN0aW9uICgpIHsgJChkb2N1bWVudC5ib2R5KS5yZW1vdmVDbGFzcygnbW9kYWwtb3BlbicpIH0pDQoNCn0oalF1ZXJ5KTsNCgp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIEJvb3RzdHJhcDogdHJhbnNpdGlvbi5qcyB2My4wLjINCiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI3RyYW5zaXRpb25zDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIENvcHlyaWdodCAyMDEzIFR3aXR0ZXIsIEluYy4NCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCg0KK2Z1bmN0aW9uICgkKSB7ICJ1c2Ugc3RyaWN0IjsNCg0KICAvLyBDU1MgVFJBTlNJVElPTiBTVVBQT1JUIChTaG91dG91dDogaHR0cDovL3d3dy5tb2Rlcm5penIuY29tLykNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoNCiAgZnVuY3Rpb24gdHJhbnNpdGlvbkVuZCgpIHsNCiAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdib290c3RyYXAnKQ0KDQogICAgdmFyIHRyYW5zRW5kRXZlbnROYW1lcyA9IHsNCiAgICAgICdXZWJraXRUcmFuc2l0aW9uJyA6ICd3ZWJraXRUcmFuc2l0aW9uRW5kJw0KICAgICwgJ01velRyYW5zaXRpb24nICAgIDogJ3RyYW5zaXRpb25lbmQnDQogICAgLCAnT1RyYW5zaXRpb24nICAgICAgOiAnb1RyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQnDQogICAgLCAndHJhbnNpdGlvbicgICAgICAgOiAndHJhbnNpdGlvbmVuZCcNCiAgICB9DQoNCiAgICBmb3IgKHZhciBuYW1lIGluIHRyYW5zRW5kRXZlbnROYW1lcykgew0KICAgICAgaWYgKGVsLnN0eWxlW25hbWVdICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgcmV0dXJuIHsgZW5kOiB0cmFuc0VuZEV2ZW50TmFtZXNbbmFtZV0gfQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIC8vIGh0dHA6Ly9ibG9nLmFsZXhtYWNjYXcuY29tL2Nzcy10cmFuc2l0aW9ucw0KICAkLmZuLmVtdWxhdGVUcmFuc2l0aW9uRW5kID0gZnVuY3Rpb24gKGR1cmF0aW9uKSB7DQogICAgdmFyIGNhbGxlZCA9IGZhbHNlLCAkZWwgPSB0aGlzDQogICAgJCh0aGlzKS5vbmUoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLCBmdW5jdGlvbiAoKSB7IGNhbGxlZCA9IHRydWUgfSkNCiAgICB2YXIgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7IGlmICghY2FsbGVkKSAkKCRlbCkudHJpZ2dlcigkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQpIH0NCiAgICBzZXRUaW1lb3V0KGNhbGxiYWNrLCBkdXJhdGlvbikNCiAgICByZXR1cm4gdGhpcw0KICB9DQoNCiAgJChmdW5jdGlvbiAoKSB7DQogICAgJC5zdXBwb3J0LnRyYW5zaXRpb24gPSB0cmFuc2l0aW9uRW5kKCkNCiAgfSkNCg0KfShqUXVlcnkpOw0KCn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ey8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS40LjANCihmdW5jdGlvbigpIHsNCg0KDQogICQgPSB3aW5kb3cualF1ZXJ5IHx8IHdpbmRvdy5aZXB0byB8fCB3aW5kb3cuJDsNCg0KICAkLmZuLmZhbmN5U2VsZWN0ID0gZnVuY3Rpb24ob3B0cykgew0KICAgIHZhciBpc2lPUywgc2V0dGluZ3M7DQogICAgaWYgKG9wdHMgPT0gbnVsbCkgew0KICAgICAgb3B0cyA9IHt9Ow0KICAgIH0NCiAgICBzZXR0aW5ncyA9ICQuZXh0ZW5kKHsNCiAgICAgIGZvcmNlaU9TOiBmYWxzZSwNCiAgICAgIGluY2x1ZGVCbGFuazogZmFsc2UsDQogICAgICBvcHRpb25UZW1wbGF0ZTogZnVuY3Rpb24ob3B0aW9uRWwpIHsNCiAgICAgICAgcmV0dXJuIG9wdGlvbkVsLnRleHQoKTsNCiAgICAgIH0sDQogICAgICB0cmlnZ2VyVGVtcGxhdGU6IGZ1bmN0aW9uKG9wdGlvbkVsKSB7DQogICAgICAgIHJldHVybiBvcHRpb25FbC50ZXh0KCk7DQogICAgICB9DQogICAgfSwgb3B0cyk7DQogICAgaXNpT1MgPSAhIW5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL2lQKGhvbmV8b2R8YWQpL2kpOw0KICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICB2YXIgY29weU9wdGlvbnNUb0xpc3QsIGRpc2FibGVkLCBvcHRpb25zLCBzZWwsIHRyaWdnZXIsIHVwZGF0ZVRyaWdnZXJUZXh0LCB3cmFwcGVyOw0KICAgICAgc2VsID0gJCh0aGlzKTsNCiAgICAgIGlmIChzZWwuaGFzQ2xhc3MoJ2ZhbmNpZmllZCcpIHx8IHNlbFswXS50YWdOYW1lICE9PSAnU0VMRUNUJykgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIC8qDQogICAgICAgKiBAYXV0aG9yIFRZUE9XT1JYIDxpbmZvQHR5cG93b3J4LmRlPg0KICAgICAgICogQWRkIGNsb3NlIG9uIGJvZHktY2xpY2sNCiAgICAgICovDQogICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkgew0KICAgICAgICBpZigkKCcuZmFuY3ktc2VsZWN0ID4gLnRyaWdnZXInKS5pcygnLm9wZW4nKSkgew0KICAgICAgICAgIGlmKCEkKGUudGFyZ2V0KS5pcygnLnRyaWdnZXInKSAmJiAkKGUudGFyZ2V0KS5jbG9zZXN0KCcuZmFuY3ktc2VsZWN0ID4gLnRyaWdnZXInKS5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgdHJpZ2dlci50cmlnZ2VyKCdjbG9zZS5mcycpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSk7DQoNCiAgICAgIHNlbC5hZGRDbGFzcygnZmFuY2lmaWVkJyk7DQogICAgICBzZWwuY3NzKHsNCiAgICAgICAgd2lkdGg6IDEsDQogICAgICAgIGhlaWdodDogMSwNCiAgICAgICAgZGlzcGxheTogJ2Jsb2NrJywNCiAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsDQogICAgICAgIHRvcDogMCwNCiAgICAgICAgbGVmdDogMCwNCiAgICAgICAgb3BhY2l0eTogMA0KICAgICAgfSk7DQogICAgICBzZWwud3JhcCgnPGRpdiBjbGFzcz0iZmFuY3ktc2VsZWN0Ij4nKTsNCiAgICAgIHdyYXBwZXIgPSBzZWwucGFyZW50KCk7DQogICAgICBpZiAoc2VsLmRhdGEoJ2NsYXNzJykpIHsNCiAgICAgICAgd3JhcHBlci5hZGRDbGFzcyhzZWwuZGF0YSgnY2xhc3MnKSk7DQogICAgICB9DQogICAgICB3cmFwcGVyLmFwcGVuZCgnPGRpdiBjbGFzcz0idHJpZ2dlciI+Jyk7DQogICAgICBpZiAoIShpc2lPUyAmJiAhc2V0dGluZ3MuZm9yY2VpT1MpKSB7DQogICAgICAgIHdyYXBwZXIuYXBwZW5kKCc8dWwgY2xhc3M9Im9wdGlvbnMiPicpOw0KICAgICAgfQ0KICAgICAgdHJpZ2dlciA9IHdyYXBwZXIuZmluZCgnLnRyaWdnZXInKTsNCiAgICAgIG9wdGlvbnMgPSB3cmFwcGVyLmZpbmQoJy5vcHRpb25zJyk7DQogICAgICBkaXNhYmxlZCA9IHNlbC5wcm9wKCdkaXNhYmxlZCcpOw0KICAgICAgaWYgKGRpc2FibGVkKSB7DQogICAgICAgIHdyYXBwZXIuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7DQogICAgICB9DQogICAgICB1cGRhdGVUcmlnZ2VyVGV4dCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgdHJpZ2dlckh0bWw7DQogICAgICAgIHRyaWdnZXJIdG1sID0gc2V0dGluZ3MudHJpZ2dlclRlbXBsYXRlKHNlbC5maW5kKCc6c2VsZWN0ZWQnKSk7DQogICAgICAgIHJldHVybiB0cmlnZ2VyLmh0bWwodHJpZ2dlckh0bWwpOw0KICAgICAgfTsNCiAgICAgIHNlbC5vbignYmx1ci5mcycsIGZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAodHJpZ2dlci5oYXNDbGFzcygnb3BlbicpKSB7DQogICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICByZXR1cm4gdHJpZ2dlci50cmlnZ2VyKCdjbG9zZS5mcycpOw0KICAgICAgICAgIH0sIDEyMCk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgICAgdHJpZ2dlci5vbignY2xvc2UuZnMnLCBmdW5jdGlvbigpIHsNCiAgICAgICAgdHJpZ2dlci5yZW1vdmVDbGFzcygnb3BlbicpOw0KICAgICAgICByZXR1cm4gb3B0aW9ucy5yZW1vdmVDbGFzcygnb3BlbicpOw0KICAgICAgfSk7DQogICAgICB0cmlnZ2VyLm9uKCdjbGljay5mcycsIGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgb2ZmUGFyZW50LCBwYXJlbnQ7DQogICAgICAgIGlmICghZGlzYWJsZWQpIHsNCiAgICAgICAgICB0cmlnZ2VyLnRvZ2dsZUNsYXNzKCdvcGVuJyk7DQogICAgICAgICAgaWYgKGlzaU9TICYmICFzZXR0aW5ncy5mb3JjZWlPUykgew0KICAgICAgICAgICAgaWYgKHRyaWdnZXIuaGFzQ2xhc3MoJ29wZW4nKSkgew0KICAgICAgICAgICAgICByZXR1cm4gc2VsLmZvY3VzKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0cmlnZ2VyLmhhc0NsYXNzKCdvcGVuJykpIHsNCiAgICAgICAgICAgICAgcGFyZW50ID0gdHJpZ2dlci5wYXJlbnQoKTsNCiAgICAgICAgICAgICAgb2ZmUGFyZW50ID0gcGFyZW50Lm9mZnNldFBhcmVudCgpOw0KICAgICAgICAgICAgICBpZiAoKHBhcmVudC5vZmZzZXQoKS50b3AgKyBwYXJlbnQub3V0ZXJIZWlnaHQoKSArIG9wdGlvbnMub3V0ZXJIZWlnaHQoKSArIDIwKSA+ICQod2luZG93KS5oZWlnaHQoKSArICQod2luZG93KS5zY3JvbGxUb3AoKSkgew0KICAgICAgICAgICAgICAgIG9wdGlvbnMuYWRkQ2xhc3MoJ292ZXJmbG93aW5nJyk7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgb3B0aW9ucy5yZW1vdmVDbGFzcygnb3ZlcmZsb3dpbmcnKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgb3B0aW9ucy50b2dnbGVDbGFzcygnb3BlbicpOw0KDQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgICogQGF1dGhvciBUWVBPV09SWCA8aW5mb0B0eXBvd29yeC5kZT4NCiAgICAgICAgICAgICAqIEJ1Z2ZpeCwgZG9uJ3QgdXNlIHdpbGwgY2xvc2Ugb24gc2Nyb2xsIQ0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIC8vaWYgKCFpc2lPUykgew0KICAgICAgICAgICAgLy8gIHJldHVybiBzZWwuZm9jdXMoKTsNCiAgICAgICAgICAgIC8vfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgICBzZWwub24oJ2VuYWJsZScsIGZ1bmN0aW9uKCkgew0KICAgICAgICBzZWwucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7DQogICAgICAgIHdyYXBwZXIucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7DQogICAgICAgIGRpc2FibGVkID0gZmFsc2U7DQogICAgICAgIHJldHVybiBjb3B5T3B0aW9uc1RvTGlzdCgpOw0KICAgICAgfSk7DQogICAgICBzZWwub24oJ2Rpc2FibGUnLCBmdW5jdGlvbigpIHsNCiAgICAgICAgc2VsLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7DQogICAgICAgIHdyYXBwZXIuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7DQogICAgICAgIHJldHVybiBkaXNhYmxlZCA9IHRydWU7DQogICAgICB9KTsNCiAgICAgIHNlbC5vbignY2hhbmdlLmZzJywgZnVuY3Rpb24oZSkgew0KICAgICAgICBpZiAoZS5vcmlnaW5hbEV2ZW50ICYmIGUub3JpZ2luYWxFdmVudC5pc1RydXN0ZWQpIHsNCiAgICAgICAgICByZXR1cm4gZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gdXBkYXRlVHJpZ2dlclRleHQoKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgICBzZWwub24oJ2tleWRvd24nLCBmdW5jdGlvbihlKSB7DQogICAgICAgIHZhciBob3ZlcmVkLCBuZXdIb3ZlcmVkLCB3Ow0KICAgICAgICB3ID0gZS53aGljaDsNCiAgICAgICAgaG92ZXJlZCA9IG9wdGlvbnMuZmluZCgnLmhvdmVyJyk7DQogICAgICAgIGhvdmVyZWQucmVtb3ZlQ2xhc3MoJ2hvdmVyJyk7DQogICAgICAgIGlmICghb3B0aW9ucy5oYXNDbGFzcygnb3BlbicpKSB7DQogICAgICAgICAgaWYgKHcgPT09IDEzIHx8IHcgPT09IDMyIHx8IHcgPT09IDM4IHx8IHcgPT09IDQwKSB7DQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICByZXR1cm4gdHJpZ2dlci50cmlnZ2VyKCdjbGljay5mcycpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpZiAodyA9PT0gMzgpIHsNCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIGlmIChob3ZlcmVkLmxlbmd0aCAmJiBob3ZlcmVkLmluZGV4KCkgPiAwKSB7DQogICAgICAgICAgICAgIGhvdmVyZWQucHJldigpLmFkZENsYXNzKCdob3ZlcicpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgb3B0aW9ucy5maW5kKCdsaTpsYXN0LWNoaWxkJykuYWRkQ2xhc3MoJ2hvdmVyJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIGlmICh3ID09PSA0MCkgew0KICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgaWYgKGhvdmVyZWQubGVuZ3RoICYmIGhvdmVyZWQuaW5kZXgoKSA8IG9wdGlvbnMuZmluZCgnbGknKS5sZW5ndGggLSAxKSB7DQogICAgICAgICAgICAgIGhvdmVyZWQubmV4dCgpLmFkZENsYXNzKCdob3ZlcicpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgb3B0aW9ucy5maW5kKCdsaTpmaXJzdC1jaGlsZCcpLmFkZENsYXNzKCdob3ZlcicpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gZWxzZSBpZiAodyA9PT0gMjcpIHsNCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIHRyaWdnZXIudHJpZ2dlcignY2xpY2suZnMnKTsNCiAgICAgICAgICB9IGVsc2UgaWYgKHcgPT09IDEzIHx8IHcgPT09IDMyKSB7DQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBob3ZlcmVkLnRyaWdnZXIoJ2NsaWNrLmZzJyk7DQogICAgICAgICAgfSBlbHNlIGlmICh3ID09PSA5KSB7DQogICAgICAgICAgICBpZiAodHJpZ2dlci5oYXNDbGFzcygnb3BlbicpKSB7DQogICAgICAgICAgICAgIHRyaWdnZXIudHJpZ2dlcignY2xvc2UuZnMnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgbmV3SG92ZXJlZCA9IG9wdGlvbnMuZmluZCgnLmhvdmVyJyk7DQogICAgICAgICAgaWYgKG5ld0hvdmVyZWQubGVuZ3RoKSB7DQogICAgICAgICAgICBvcHRpb25zLnNjcm9sbFRvcCgwKTsNCiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLnNjcm9sbFRvcChuZXdIb3ZlcmVkLnBvc2l0aW9uKCkudG9wIC0gMTIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgICBvcHRpb25zLm9uKCdjbGljay5mcycsICdsaScsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgdmFyIGNsaWNrZWQ7DQogICAgICAgIGNsaWNrZWQgPSAkKHRoaXMpOw0KICAgICAgICBzZWwudmFsKGNsaWNrZWQuZGF0YSgncmF3LXZhbHVlJykpOw0KICAgICAgICBpZiAoIWlzaU9TKSB7DQogICAgICAgICAgc2VsLnRyaWdnZXIoJ2JsdXIuZnMnKS50cmlnZ2VyKCdmb2N1cy5mcycpOw0KICAgICAgICB9DQogICAgICAgIG9wdGlvbnMuZmluZCgnLnNlbGVjdGVkJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7DQogICAgICAgIGNsaWNrZWQuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7DQogICAgICAgIHJldHVybiBzZWwudmFsKGNsaWNrZWQuZGF0YSgncmF3LXZhbHVlJykpLnRyaWdnZXIoJ2NoYW5nZS5mcycpLnRyaWdnZXIoJ2JsdXIuZnMnKS50cmlnZ2VyKCdmb2N1cy5mcycpOw0KICAgICAgfSk7DQogICAgICBvcHRpb25zLm9uKCdtb3VzZWVudGVyLmZzJywgJ2xpJywgZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBob3ZlcmVkLCBub3dIb3ZlcmVkOw0KICAgICAgICBub3dIb3ZlcmVkID0gJCh0aGlzKTsNCiAgICAgICAgaG92ZXJlZCA9IG9wdGlvbnMuZmluZCgnLmhvdmVyJyk7DQogICAgICAgIGhvdmVyZWQucmVtb3ZlQ2xhc3MoJ2hvdmVyJyk7DQogICAgICAgIHJldHVybiBub3dIb3ZlcmVkLmFkZENsYXNzKCdob3ZlcicpOw0KICAgICAgfSk7DQogICAgICBvcHRpb25zLm9uKCdtb3VzZWxlYXZlLmZzJywgJ2xpJywgZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBvcHRpb25zLmZpbmQoJy5ob3ZlcicpLnJlbW92ZUNsYXNzKCdob3ZlcicpOw0KICAgICAgfSk7DQogICAgICBjb3B5T3B0aW9uc1RvTGlzdCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgc2VsT3B0czsNCiAgICAgICAgdXBkYXRlVHJpZ2dlclRleHQoKTsNCiAgICAgICAgaWYgKGlzaU9TICYmICFzZXR0aW5ncy5mb3JjZWlPUykgew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBzZWxPcHRzID0gc2VsLmZpbmQoJ29wdGlvbicpOw0KICAgICAgICByZXR1cm4gc2VsLmZpbmQoJ29wdGlvbicpLmVhY2goZnVuY3Rpb24oaSwgb3B0KSB7DQogICAgICAgICAgdmFyIG9wdEh0bWw7DQogICAgICAgICAgb3B0ID0gJChvcHQpOw0KICAgICAgICAgIGlmICghb3B0LnByb3AoJ2Rpc2FibGVkJykgJiYgKG9wdC52YWwoKSB8fCBzZXR0aW5ncy5pbmNsdWRlQmxhbmspKSB7DQogICAgICAgICAgICBvcHRIdG1sID0gc2V0dGluZ3Mub3B0aW9uVGVtcGxhdGUob3B0KTsNCiAgICAgICAgICAgIGlmIChvcHQucHJvcCgnc2VsZWN0ZWQnKSkgew0KICAgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5hcHBlbmQoIjxsaSBkYXRhLXJhdy12YWx1ZT1cIiIgKyAob3B0LnZhbCgpKSArICJcIiBjbGFzcz1cInNlbGVjdGVkXCI+IiArIG9wdEh0bWwgKyAiPC9saT4iKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmFwcGVuZCgiPGxpIGRhdGEtcmF3LXZhbHVlPVwiIiArIChvcHQudmFsKCkpICsgIlwiPiIgKyBvcHRIdG1sICsgIjwvbGk+Iik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgIH07DQogICAgICBzZWwub24oJ3VwZGF0ZS5mcycsIGZ1bmN0aW9uKCkgew0KICAgICAgICB3cmFwcGVyLmZpbmQoJy5vcHRpb25zJykuZW1wdHkoKTsNCiAgICAgICAgcmV0dXJuIGNvcHlPcHRpb25zVG9MaXN0KCk7DQogICAgICB9KTsNCiAgICAgIHJldHVybiBjb3B5T3B0aW9uc1RvTGlzdCgpOw0KICAgIH0pOw0KICB9Ow0KDQp9KS5jYWxsKHRoaXMpOwp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvKioNCioNCiogVmVyc2lvbjogMC4wLjgNCiogQXV0aG9yOiBHaWFubHVjYSBHdWFyaW5pDQoqIENvbnRhY3Q6IGdpYW5sdWNhLmd1YXJpbmlAZ21haWwuY29tDQoqIFdlYnNpdGU6IGh0dHA6Ly93d3cuZ2lhbmx1Y2FndWFyaW5pLmNvbS8NCiogVHdpdHRlcjogQGdpYW5sdWNhZ3VhcmluaQ0KKg0KKiBDb3B5cmlnaHQgKGMpIDIwMTMgR2lhbmx1Y2EgR3VhcmluaQ0KKg0KKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbg0KKiBvYnRhaW5pbmcgYSBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbg0KKiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0DQoqIHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLA0KKiBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbA0KKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUNCiogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcNCiogY29uZGl0aW9uczoNCioNCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUNCiogaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuDQoqDQoqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELA0KKiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMNCiogT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQNCiogTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQNCiogSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksDQoqIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORw0KKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SDQoqIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4NCioqLw0KDQooZnVuY3Rpb24oZG9jLCB3aW4pIHsNCgkndXNlIHN0cmljdCc7DQoJaWYgKHR5cGVvZiBkb2MuY3JlYXRlRXZlbnQgIT09ICdmdW5jdGlvbicpIHJldHVybiBmYWxzZTsgLy8gbm8gdG91Y2ggZXZlbnRzIGhlcmUNCgkvLyBoZWxwZXJzDQoJdmFyIHVzZUpxdWVyeSA9IHR5cGVvZiBqUXVlcnkgIT09ICd1bmRlZmluZWQnLA0KCQlpc1RvdWNoID0gISEoJ29udG91Y2hzdGFydCcgaW4gd2luZG93KSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ1BoYW50b21KUycpIDwgMCwNCgkJc2V0TGlzdGVuZXIgPSBmdW5jdGlvbihlbG0sIGV2ZW50cywgY2FsbGJhY2spIHsNCgkJCXZhciBldmVudHNBcnJheSA9IGV2ZW50cy5zcGxpdCgnICcpLA0KCQkJCWkgPSBldmVudHNBcnJheS5sZW5ndGg7DQoNCgkJCXdoaWxlIChpLS0pIHsNCgkJCQllbG0uYWRkRXZlbnRMaXN0ZW5lcihldmVudHNBcnJheVtpXSwgY2FsbGJhY2ssIGZhbHNlKTsNCgkJCX0NCgkJfSwNCgkJZ2V0UG9pbnRlckV2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHsNCgkJCXJldHVybiBldmVudC50YXJnZXRUb3VjaGVzID8gZXZlbnQudGFyZ2V0VG91Y2hlc1swXSA6IGV2ZW50Ow0KCQl9LA0KCQlzZW5kRXZlbnQgPSBmdW5jdGlvbihlbG0sIGV2ZW50TmFtZSwgb3JpZ2luYWxFdmVudCwgZGF0YSkgew0KCQkJdmFyIGN1c3RvbUV2ZW50ID0gZG9jLmNyZWF0ZUV2ZW50KCdFdmVudCcpOw0KDQoJCQlkYXRhID0gZGF0YSB8fCB7fTsNCgkJCWRhdGEueCA9IGN1cnJYOw0KCQkJZGF0YS55ID0gY3Vyclk7DQoJCQlkYXRhLmRpc3RhbmNlID0gZGF0YS5kaXN0YW5jZTsNCgkJCWlmICh1c2VKcXVlcnkpDQoJCQkJalF1ZXJ5KGVsbSkudHJpZ2dlcihldmVudE5hbWUsIGRhdGEpOw0KCQkJZWxzZSB7DQoJCQkJY3VzdG9tRXZlbnQub3JpZ2luYWxFdmVudCA9IG9yaWdpbmFsRXZlbnQ7DQoJCQkJZm9yICh2YXIga2V5IGluIGRhdGEpIHsNCgkJCQkJY3VzdG9tRXZlbnRba2V5XSA9IGRhdGFba2V5XTsNCgkJCQl9DQoJCQkJY3VzdG9tRXZlbnQuaW5pdEV2ZW50KGV2ZW50TmFtZSwgdHJ1ZSwgdHJ1ZSk7DQoJCQkJZWxtLmRpc3BhdGNoRXZlbnQoY3VzdG9tRXZlbnQpOw0KCQkJfQ0KCQl9Ow0KDQoJdmFyIHRvdWNoU3RhcnRlZCA9IGZhbHNlLCAvLyBkZXRlY3QgaWYgYSB0b3VjaCBldmVudCBpcyBzYXJ0ZWQNCgkJc3dpcGVUcmVzaG9sZCA9IHdpbi5TV0lQRV9UUkVTSE9MRCB8fCA4MCwNCgkJdGFwdHJlc2hvbGQgPSB3aW4uVEFQX1RSRVNIT0xEIHx8IDUwLA0KCQlwcmVjaXNpb24gPSAgd2luLlRBUF9QUkVDSVNJT04gLyAyIHx8IDYwIC8gMiwgLy8gdG91Y2ggZXZlbnRzIGJvdW5kYXJpZXMgKCA2MHB4IGJ5IGRlZmF1bHQgKQ0KCQl0YXBOdW0gPSAwLA0KCQljdXJyWCwgY3VyclksIGNhY2hlZFgsIGNhY2hlZFksIHRhcFRpbWVyOw0KDQoJLy8gc2hhbGwgd2UgdXNlIGl0IGp1c3Qgb24gdGhlIHRvdWNoIGRldmljZXM/DQoJLy8gYnkgZGVmYXVsdCBUb2NjYS5qcyBkZXRlY3RzIGFsc28gdGhlIG1vdXNlIGV2ZW50cw0KCWlzVG91Y2ggPSB0cnVlOw0KDQoJLy9zZXR0aW5nIHRoZSBldmVudHMgbGlzdGVuZXJzDQoJc2V0TGlzdGVuZXIoZG9jLCBpc1RvdWNoID8gJ3RvdWNoc3RhcnQnIDogJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHsNCgkJdmFyIHBvaW50ZXIgPSBnZXRQb2ludGVyRXZlbnQoZSk7DQoJCS8vIGNhY2hpbmcgdGhlIGN1cnJlbnQgeA0KCQljYWNoZWRYID0gY3VyclggPSBwb2ludGVyLnBhZ2VYOw0KCQkvLyBjYWNoaW5nIHRoZSBjdXJyZW50IHkNCgkJY2FjaGVkWSA9IGN1cnJZID0gcG9pbnRlci5wYWdlWTsNCgkJLy8gYSB0b3VjaCBldmVudCBpcyBkZXRlY3RlZA0KCQl0b3VjaFN0YXJ0ZWQgPSB0cnVlOw0KCQl0YXBOdW0gKys7DQoJCS8vIGRldGVjdGluZyBpZiBhZnRlciAyMDBtcyB0aGUgZmluZ2VyIGlzIHN0aWxsIGluIHRoZSBzYW1lIHBvc2l0aW9uDQoJCWNsZWFyVGltZW91dCh0YXBUaW1lcik7DQoJCXRhcFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsNCgkJCWlmICgNCgkJCQljYWNoZWRYID49IGN1cnJYIC0gcHJlY2lzaW9uICYmDQoJCQkJY2FjaGVkWCA8PSBjdXJyWCArIHByZWNpc2lvbiAmJg0KCQkJCWNhY2hlZFkgPj0gY3VyclkgLSBwcmVjaXNpb24gJiYNCgkJCQljYWNoZWRZIDw9IGN1cnJZICsgcHJlY2lzaW9uICYmDQoJCQkJIXRvdWNoU3RhcnRlZA0KCQkJKSB7DQoJCQkJLy8gSGVyZSB5b3UgZ2V0IHRoZSBUYXAgZXZlbnQNCgkJCQlzZW5kRXZlbnQoZS50YXJnZXQsICh0YXBOdW0gPT09IDIpID8gJ2RibHRhcCcgOiAndGFwJywgZSk7DQoJCQl9DQoJCQl0YXBOdW0gPSAwOw0KCQl9LCB0YXB0cmVzaG9sZCk7DQoNCgl9KTsNCglzZXRMaXN0ZW5lcihkb2MsIGlzVG91Y2ggPyAndG91Y2hlbmQnIDogJ21vdXNldXAnLCBmdW5jdGlvbihlKSB7DQoJCXZhciBldmVudHNBcnIgPSBbXSwNCgkJCWRlbHRhWSA9IGNhY2hlZFkgLSBjdXJyWSwNCgkJCWRlbHRhWCA9IGNhY2hlZFggLSBjdXJyWDsNCgkJdG91Y2hTdGFydGVkID0gZmFsc2U7DQoJCWlmIChkZWx0YVggPD0gLXN3aXBlVHJlc2hvbGQpDQoJCQlldmVudHNBcnIucHVzaCgnc3dpcGVyaWdodCcpOw0KDQoJCWlmIChkZWx0YVggPj0gc3dpcGVUcmVzaG9sZCkNCgkJCWV2ZW50c0Fyci5wdXNoKCdzd2lwZWxlZnQnKTsNCg0KCQlpZiAoZGVsdGFZIDw9IC1zd2lwZVRyZXNob2xkKQ0KCQkJZXZlbnRzQXJyLnB1c2goJ3N3aXBlZG93bicpOw0KDQoJCWlmIChkZWx0YVkgPj0gc3dpcGVUcmVzaG9sZCkNCgkJCWV2ZW50c0Fyci5wdXNoKCdzd2lwZXVwJyk7DQoJCWlmIChldmVudHNBcnIubGVuZ3RoKSB7DQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50c0Fyci5sZW5ndGg7IGkrKykgew0KCQkJCXZhciBldmVudE5hbWUgPSBldmVudHNBcnJbaV07DQoJCQkJc2VuZEV2ZW50KGUudGFyZ2V0LCBldmVudE5hbWUsIGUsew0KCQkJCQlkaXN0YW5jZTp7DQoJCQkJCQl4Ok1hdGguYWJzKGRlbHRhWCksDQoJCQkJCQl5Ok1hdGguYWJzKGRlbHRhWSkNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfQ0KCQl9DQoJfSk7DQoJc2V0TGlzdGVuZXIoZG9jLCBpc1RvdWNoID8gJ3RvdWNobW92ZScgOiAnbW91c2Vtb3ZlJywgZnVuY3Rpb24oZSkgew0KCQl2YXIgcG9pbnRlciA9IGdldFBvaW50ZXJFdmVudChlKTsNCgkJY3VyclggPSBwb2ludGVyLnBhZ2VYOw0KCQljdXJyWSA9IHBvaW50ZXIucGFnZVk7DQoJfSk7DQp9KGRvY3VtZW50LCB3aW5kb3cpKTsKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7LyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogKiBCb290c3RyYXA6IHRvb2x0aXAuanMgdjMuMC4yDQogKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyN0b29sdGlwDQogKiBJbnNwaXJlZCBieSB0aGUgb3JpZ2luYWwgalF1ZXJ5LnRpcHN5IGJ5IEphc29uIEZyYW1lDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIENvcHlyaWdodCAyMDEzIFR3aXR0ZXIsIEluYy4NCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCg0KK2Z1bmN0aW9uICgkKSB7ICJ1c2Ugc3RyaWN0IjsNCg0KICAvLyBUT09MVElQIFBVQkxJQyBDTEFTUyBERUZJTklUSU9ODQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCg0KICB2YXIgVG9vbHRpcCA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7DQogICAgdGhpcy50eXBlICAgICAgID0NCiAgICB0aGlzLm9wdGlvbnMgICAgPQ0KICAgIHRoaXMuZW5hYmxlZCAgICA9DQogICAgdGhpcy50aW1lb3V0ICAgID0NCiAgICB0aGlzLmhvdmVyU3RhdGUgPQ0KICAgIHRoaXMuJGVsZW1lbnQgICA9IG51bGwNCg0KICAgIHRoaXMuaW5pdCgndG9vbHRpcCcsIGVsZW1lbnQsIG9wdGlvbnMpDQogIH0NCg0KICBUb29sdGlwLkRFRkFVTFRTID0gew0KICAgIGFuaW1hdGlvbjogdHJ1ZQ0KICAsIHBsYWNlbWVudDogJ3RvcCcNCiAgLCBzZWxlY3RvcjogZmFsc2UNCiAgLCB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9InRvb2x0aXAiPjxkaXYgY2xhc3M9InRvb2x0aXAtYXJyb3ciPjwvZGl2PjxkaXYgY2xhc3M9InRvb2x0aXAtaW5uZXIiPjwvZGl2PjwvZGl2PicNCiAgLCB0cmlnZ2VyOiAnaG92ZXIgZm9jdXMnDQogICwgdGl0bGU6ICcnDQogICwgZGVsYXk6IDANCiAgLCBodG1sOiBmYWxzZQ0KICAsIGNvbnRhaW5lcjogZmFsc2UNCiAgfQ0KDQogIFRvb2x0aXAucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAodHlwZSwgZWxlbWVudCwgb3B0aW9ucykgew0KICAgIHRoaXMuZW5hYmxlZCAgPSB0cnVlDQogICAgdGhpcy50eXBlICAgICA9IHR5cGUNCiAgICB0aGlzLiRlbGVtZW50ID0gJChlbGVtZW50KQ0KICAgIHRoaXMub3B0aW9ucyAgPSB0aGlzLmdldE9wdGlvbnMob3B0aW9ucykNCg0KICAgIHZhciB0cmlnZ2VycyA9IHRoaXMub3B0aW9ucy50cmlnZ2VyLnNwbGl0KCcgJykNCg0KICAgIGZvciAodmFyIGkgPSB0cmlnZ2Vycy5sZW5ndGg7IGktLTspIHsNCiAgICAgIHZhciB0cmlnZ2VyID0gdHJpZ2dlcnNbaV0NCg0KICAgICAgaWYgKHRyaWdnZXIgPT0gJ2NsaWNrJykgew0KICAgICAgICB0aGlzLiRlbGVtZW50Lm9uKCdjbGljay4nICsgdGhpcy50eXBlLCB0aGlzLm9wdGlvbnMuc2VsZWN0b3IsICQucHJveHkodGhpcy50b2dnbGUsIHRoaXMpKQ0KICAgICAgfSBlbHNlIGlmICh0cmlnZ2VyICE9ICdtYW51YWwnKSB7DQogICAgICAgIHZhciBldmVudEluICA9IHRyaWdnZXIgPT0gJ2hvdmVyJyA/ICdtb3VzZWVudGVyJyA6ICdmb2N1cycNCiAgICAgICAgdmFyIGV2ZW50T3V0ID0gdHJpZ2dlciA9PSAnaG92ZXInID8gJ21vdXNlbGVhdmUnIDogJ2JsdXInDQoNCiAgICAgICAgdGhpcy4kZWxlbWVudC5vbihldmVudEluICArICcuJyArIHRoaXMudHlwZSwgdGhpcy5vcHRpb25zLnNlbGVjdG9yLCAkLnByb3h5KHRoaXMuZW50ZXIsIHRoaXMpKQ0KICAgICAgICB0aGlzLiRlbGVtZW50Lm9uKGV2ZW50T3V0ICsgJy4nICsgdGhpcy50eXBlLCB0aGlzLm9wdGlvbnMuc2VsZWN0b3IsICQucHJveHkodGhpcy5sZWF2ZSwgdGhpcykpDQogICAgICB9DQogICAgfQ0KDQogICAgdGhpcy5vcHRpb25zLnNlbGVjdG9yID8NCiAgICAgICh0aGlzLl9vcHRpb25zID0gJC5leHRlbmQoe30sIHRoaXMub3B0aW9ucywgeyB0cmlnZ2VyOiAnbWFudWFsJywgc2VsZWN0b3I6ICcnIH0pKSA6DQogICAgICB0aGlzLmZpeFRpdGxlKCkNCiAgfQ0KDQogIFRvb2x0aXAucHJvdG90eXBlLmdldERlZmF1bHRzID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiBUb29sdGlwLkRFRkFVTFRTDQogIH0NCg0KICBUb29sdGlwLnByb3RvdHlwZS5nZXRPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsNCiAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIHRoaXMuZ2V0RGVmYXVsdHMoKSwgdGhpcy4kZWxlbWVudC5kYXRhKCksIG9wdGlvbnMpDQoNCiAgICBpZiAob3B0aW9ucy5kZWxheSAmJiB0eXBlb2Ygb3B0aW9ucy5kZWxheSA9PSAnbnVtYmVyJykgew0KICAgICAgb3B0aW9ucy5kZWxheSA9IHsNCiAgICAgICAgc2hvdzogb3B0aW9ucy5kZWxheQ0KICAgICAgLCBoaWRlOiBvcHRpb25zLmRlbGF5DQogICAgICB9DQogICAgfQ0KDQogICAgcmV0dXJuIG9wdGlvbnMNCiAgfQ0KDQogIFRvb2x0aXAucHJvdG90eXBlLmdldERlbGVnYXRlT3B0aW9ucyA9IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgb3B0aW9ucyAgPSB7fQ0KICAgIHZhciBkZWZhdWx0cyA9IHRoaXMuZ2V0RGVmYXVsdHMoKQ0KDQogICAgdGhpcy5fb3B0aW9ucyAmJiAkLmVhY2godGhpcy5fb3B0aW9ucywgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsNCiAgICAgIGlmIChkZWZhdWx0c1trZXldICE9IHZhbHVlKSBvcHRpb25zW2tleV0gPSB2YWx1ZQ0KICAgIH0pDQoNCiAgICByZXR1cm4gb3B0aW9ucw0KICB9DQoNCiAgVG9vbHRpcC5wcm90b3R5cGUuZW50ZXIgPSBmdW5jdGlvbiAob2JqKSB7DQogICAgdmFyIHNlbGYgPSBvYmogaW5zdGFuY2VvZiB0aGlzLmNvbnN0cnVjdG9yID8NCiAgICAgIG9iaiA6ICQob2JqLmN1cnJlbnRUYXJnZXQpW3RoaXMudHlwZV0odGhpcy5nZXREZWxlZ2F0ZU9wdGlvbnMoKSkuZGF0YSgnYnMuJyArIHRoaXMudHlwZSkNCg0KICAgIGNsZWFyVGltZW91dChzZWxmLnRpbWVvdXQpDQoNCiAgICBzZWxmLmhvdmVyU3RhdGUgPSAnaW4nDQoNCiAgICBpZiAoIXNlbGYub3B0aW9ucy5kZWxheSB8fCAhc2VsZi5vcHRpb25zLmRlbGF5LnNob3cpIHJldHVybiBzZWxmLnNob3coKQ0KDQogICAgc2VsZi50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICBpZiAoc2VsZi5ob3ZlclN0YXRlID09ICdpbicpIHNlbGYuc2hvdygpDQogICAgfSwgc2VsZi5vcHRpb25zLmRlbGF5LnNob3cpDQogIH0NCg0KICBUb29sdGlwLnByb3RvdHlwZS5sZWF2ZSA9IGZ1bmN0aW9uIChvYmopIHsNCiAgICB2YXIgc2VsZiA9IG9iaiBpbnN0YW5jZW9mIHRoaXMuY29uc3RydWN0b3IgPw0KICAgICAgb2JqIDogJChvYmouY3VycmVudFRhcmdldClbdGhpcy50eXBlXSh0aGlzLmdldERlbGVnYXRlT3B0aW9ucygpKS5kYXRhKCdicy4nICsgdGhpcy50eXBlKQ0KDQogICAgY2xlYXJUaW1lb3V0KHNlbGYudGltZW91dCkNCg0KICAgIHNlbGYuaG92ZXJTdGF0ZSA9ICdvdXQnDQoNCiAgICBpZiAoIXNlbGYub3B0aW9ucy5kZWxheSB8fCAhc2VsZi5vcHRpb25zLmRlbGF5LmhpZGUpIHJldHVybiBzZWxmLmhpZGUoKQ0KDQogICAgc2VsZi50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICBpZiAoc2VsZi5ob3ZlclN0YXRlID09ICdvdXQnKSBzZWxmLmhpZGUoKQ0KICAgIH0sIHNlbGYub3B0aW9ucy5kZWxheS5oaWRlKQ0KICB9DQoNCiAgVG9vbHRpcC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgZSA9ICQuRXZlbnQoJ3Nob3cuYnMuJysgdGhpcy50eXBlKQ0KDQogICAgaWYgKHRoaXMuaGFzQ29udGVudCgpICYmIHRoaXMuZW5hYmxlZCkgew0KICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpDQoNCiAgICAgIGlmIChlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm4NCg0KICAgICAgdmFyICR0aXAgPSB0aGlzLnRpcCgpDQoNCiAgICAgIHRoaXMuc2V0Q29udGVudCgpDQoNCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYW5pbWF0aW9uKSAkdGlwLmFkZENsYXNzKCdmYWRlJykNCg0KICAgICAgdmFyIHBsYWNlbWVudCA9IHR5cGVvZiB0aGlzLm9wdGlvbnMucGxhY2VtZW50ID09ICdmdW5jdGlvbicgPw0KICAgICAgICB0aGlzLm9wdGlvbnMucGxhY2VtZW50LmNhbGwodGhpcywgJHRpcFswXSwgdGhpcy4kZWxlbWVudFswXSkgOg0KICAgICAgICB0aGlzLm9wdGlvbnMucGxhY2VtZW50DQoNCiAgICAgIHZhciBhdXRvVG9rZW4gPSAvXHM/YXV0bz9ccz8vaQ0KICAgICAgdmFyIGF1dG9QbGFjZSA9IGF1dG9Ub2tlbi50ZXN0KHBsYWNlbWVudCkNCiAgICAgIGlmIChhdXRvUGxhY2UpIHBsYWNlbWVudCA9IHBsYWNlbWVudC5yZXBsYWNlKGF1dG9Ub2tlbiwgJycpIHx8ICd0b3AnDQoNCiAgICAgICR0aXANCiAgICAgICAgLmRldGFjaCgpDQogICAgICAgIC5jc3MoeyB0b3A6IDAsIGxlZnQ6IDAsIGRpc3BsYXk6ICdibG9jaycgfSkNCiAgICAgICAgLmFkZENsYXNzKHBsYWNlbWVudCkNCg0KICAgICAgdGhpcy5vcHRpb25zLmNvbnRhaW5lciA/ICR0aXAuYXBwZW5kVG8odGhpcy5vcHRpb25zLmNvbnRhaW5lcikgOiAkdGlwLmluc2VydEFmdGVyKHRoaXMuJGVsZW1lbnQpDQoNCiAgICAgIHZhciBwb3MgICAgICAgICAgPSB0aGlzLmdldFBvc2l0aW9uKCkNCiAgICAgIHZhciBhY3R1YWxXaWR0aCAgPSAkdGlwWzBdLm9mZnNldFdpZHRoDQogICAgICB2YXIgYWN0dWFsSGVpZ2h0ID0gJHRpcFswXS5vZmZzZXRIZWlnaHQNCg0KICAgICAgaWYgKGF1dG9QbGFjZSkgew0KICAgICAgICB2YXIgJHBhcmVudCA9IHRoaXMuJGVsZW1lbnQucGFyZW50KCkNCg0KICAgICAgICB2YXIgb3JnUGxhY2VtZW50ID0gcGxhY2VtZW50DQogICAgICAgIHZhciBkb2NTY3JvbGwgICAgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wDQogICAgICAgIHZhciBwYXJlbnRXaWR0aCAgPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyID09ICdib2R5JyA/IHdpbmRvdy5pbm5lcldpZHRoICA6ICRwYXJlbnQub3V0ZXJXaWR0aCgpDQogICAgICAgIHZhciBwYXJlbnRIZWlnaHQgPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyID09ICdib2R5JyA/IHdpbmRvdy5pbm5lckhlaWdodCA6ICRwYXJlbnQub3V0ZXJIZWlnaHQoKQ0KICAgICAgICB2YXIgcGFyZW50TGVmdCAgID0gdGhpcy5vcHRpb25zLmNvbnRhaW5lciA9PSAnYm9keScgPyAwIDogJHBhcmVudC5vZmZzZXQoKS5sZWZ0DQoNCiAgICAgICAgcGxhY2VtZW50ID0gcGxhY2VtZW50ID09ICdib3R0b20nICYmIHBvcy50b3AgICArIHBvcy5oZWlnaHQgICsgYWN0dWFsSGVpZ2h0IC0gZG9jU2Nyb2xsID4gcGFyZW50SGVpZ2h0ICA/ICd0b3AnICAgIDoNCiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID09ICd0b3AnICAgICYmIHBvcy50b3AgICAtIGRvY1Njcm9sbCAgIC0gYWN0dWFsSGVpZ2h0IDwgMCAgICAgICAgICAgICAgICAgICAgICAgICA/ICdib3R0b20nIDoNCiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID09ICdyaWdodCcgICYmIHBvcy5yaWdodCArIGFjdHVhbFdpZHRoID4gcGFyZW50V2lkdGggICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICdsZWZ0JyAgIDoNCiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID09ICdsZWZ0JyAgICYmIHBvcy5sZWZ0ICAtIGFjdHVhbFdpZHRoIDwgcGFyZW50TGVmdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICdyaWdodCcgIDoNCiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50DQoNCiAgICAgICAgJHRpcA0KICAgICAgICAgIC5yZW1vdmVDbGFzcyhvcmdQbGFjZW1lbnQpDQogICAgICAgICAgLmFkZENsYXNzKHBsYWNlbWVudCkNCiAgICAgIH0NCg0KICAgICAgdmFyIGNhbGN1bGF0ZWRPZmZzZXQgPSB0aGlzLmdldENhbGN1bGF0ZWRPZmZzZXQocGxhY2VtZW50LCBwb3MsIGFjdHVhbFdpZHRoLCBhY3R1YWxIZWlnaHQpDQoNCiAgICAgIHRoaXMuYXBwbHlQbGFjZW1lbnQoY2FsY3VsYXRlZE9mZnNldCwgcGxhY2VtZW50KQ0KICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKCdzaG93bi5icy4nICsgdGhpcy50eXBlKQ0KICAgIH0NCiAgfQ0KDQogIFRvb2x0aXAucHJvdG90eXBlLmFwcGx5UGxhY2VtZW50ID0gZnVuY3Rpb24ob2Zmc2V0LCBwbGFjZW1lbnQpIHsNCiAgICB2YXIgcmVwbGFjZQ0KICAgIHZhciAkdGlwICAgPSB0aGlzLnRpcCgpDQogICAgdmFyIHdpZHRoICA9ICR0aXBbMF0ub2Zmc2V0V2lkdGgNCiAgICB2YXIgaGVpZ2h0ID0gJHRpcFswXS5vZmZzZXRIZWlnaHQNCg0KICAgIC8vIG1hbnVhbGx5IHJlYWQgbWFyZ2lucyBiZWNhdXNlIGdldEJvdW5kaW5nQ2xpZW50UmVjdCBpbmNsdWRlcyBkaWZmZXJlbmNlDQogICAgdmFyIG1hcmdpblRvcCA9IHBhcnNlSW50KCR0aXAuY3NzKCdtYXJnaW4tdG9wJyksIDEwKQ0KICAgIHZhciBtYXJnaW5MZWZ0ID0gcGFyc2VJbnQoJHRpcC5jc3MoJ21hcmdpbi1sZWZ0JyksIDEwKQ0KDQogICAgLy8gd2UgbXVzdCBjaGVjayBmb3IgTmFOIGZvciBpZSA4LzkNCiAgICBpZiAoaXNOYU4obWFyZ2luVG9wKSkgIG1hcmdpblRvcCAgPSAwDQogICAgaWYgKGlzTmFOKG1hcmdpbkxlZnQpKSBtYXJnaW5MZWZ0ID0gMA0KDQogICAgb2Zmc2V0LnRvcCAgPSBvZmZzZXQudG9wICArIG1hcmdpblRvcA0KICAgIG9mZnNldC5sZWZ0ID0gb2Zmc2V0LmxlZnQgKyBtYXJnaW5MZWZ0DQoNCiAgICAkdGlwDQogICAgICAub2Zmc2V0KG9mZnNldCkNCiAgICAgIC5hZGRDbGFzcygnaW4nKQ0KDQogICAgLy8gY2hlY2sgdG8gc2VlIGlmIHBsYWNpbmcgdGlwIGluIG5ldyBvZmZzZXQgY2F1c2VkIHRoZSB0aXAgdG8gcmVzaXplIGl0c2VsZg0KICAgIHZhciBhY3R1YWxXaWR0aCAgPSAkdGlwWzBdLm9mZnNldFdpZHRoDQogICAgdmFyIGFjdHVhbEhlaWdodCA9ICR0aXBbMF0ub2Zmc2V0SGVpZ2h0DQoNCiAgICBpZiAocGxhY2VtZW50ID09ICd0b3AnICYmIGFjdHVhbEhlaWdodCAhPSBoZWlnaHQpIHsNCiAgICAgIHJlcGxhY2UgPSB0cnVlDQogICAgICBvZmZzZXQudG9wID0gb2Zmc2V0LnRvcCArIGhlaWdodCAtIGFjdHVhbEhlaWdodA0KICAgIH0NCg0KICAgIGlmICgvYm90dG9tfHRvcC8udGVzdChwbGFjZW1lbnQpKSB7DQogICAgICB2YXIgZGVsdGEgPSAwDQoNCiAgICAgIGlmIChvZmZzZXQubGVmdCA8IDApIHsNCiAgICAgICAgZGVsdGEgICAgICAgPSBvZmZzZXQubGVmdCAqIC0yDQogICAgICAgIG9mZnNldC5sZWZ0ID0gMA0KDQogICAgICAgICR0aXAub2Zmc2V0KG9mZnNldCkNCg0KICAgICAgICBhY3R1YWxXaWR0aCAgPSAkdGlwWzBdLm9mZnNldFdpZHRoDQogICAgICAgIGFjdHVhbEhlaWdodCA9ICR0aXBbMF0ub2Zmc2V0SGVpZ2h0DQogICAgICB9DQoNCiAgICAgIHRoaXMucmVwbGFjZUFycm93KGRlbHRhIC0gd2lkdGggKyBhY3R1YWxXaWR0aCwgYWN0dWFsV2lkdGgsICdsZWZ0JykNCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5yZXBsYWNlQXJyb3coYWN0dWFsSGVpZ2h0IC0gaGVpZ2h0LCBhY3R1YWxIZWlnaHQsICd0b3AnKQ0KICAgIH0NCg0KICAgIGlmIChyZXBsYWNlKSAkdGlwLm9mZnNldChvZmZzZXQpDQogIH0NCg0KICBUb29sdGlwLnByb3RvdHlwZS5yZXBsYWNlQXJyb3cgPSBmdW5jdGlvbihkZWx0YSwgZGltZW5zaW9uLCBwb3NpdGlvbikgew0KICAgIHRoaXMuYXJyb3coKS5jc3MocG9zaXRpb24sIGRlbHRhID8gKDUwICogKDEgLSBkZWx0YSAvIGRpbWVuc2lvbikgKyAiJSIpIDogJycpDQogIH0NCg0KICBUb29sdGlwLnByb3RvdHlwZS5zZXRDb250ZW50ID0gZnVuY3Rpb24gKCkgew0KICAgIHZhciAkdGlwICA9IHRoaXMudGlwKCkNCiAgICB2YXIgdGl0bGUgPSB0aGlzLmdldFRpdGxlKCkNCg0KICAgICR0aXAuZmluZCgnLnRvb2x0aXAtaW5uZXInKVt0aGlzLm9wdGlvbnMuaHRtbCA/ICdodG1sJyA6ICd0ZXh0J10odGl0bGUpDQogICAgJHRpcC5yZW1vdmVDbGFzcygnZmFkZSBpbiB0b3AgYm90dG9tIGxlZnQgcmlnaHQnKQ0KICB9DQoNCiAgVG9vbHRpcC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgdGhhdCA9IHRoaXMNCiAgICB2YXIgJHRpcCA9IHRoaXMudGlwKCkNCiAgICB2YXIgZSAgICA9ICQuRXZlbnQoJ2hpZGUuYnMuJyArIHRoaXMudHlwZSkNCg0KICAgIGZ1bmN0aW9uIGNvbXBsZXRlKCkgew0KICAgICAgaWYgKHRoYXQuaG92ZXJTdGF0ZSAhPSAnaW4nKSAkdGlwLmRldGFjaCgpDQogICAgfQ0KDQogICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpDQoNCiAgICBpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuDQoNCiAgICAkdGlwLnJlbW92ZUNsYXNzKCdpbicpDQoNCiAgICAkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiB0aGlzLiR0aXAuaGFzQ2xhc3MoJ2ZhZGUnKSA/DQogICAgICAkdGlwDQogICAgICAgIC5vbmUoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLCBjb21wbGV0ZSkNCiAgICAgICAgLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDE1MCkgOg0KICAgICAgY29tcGxldGUoKQ0KDQogICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKCdoaWRkZW4uYnMuJyArIHRoaXMudHlwZSkNCg0KICAgIHJldHVybiB0aGlzDQogIH0NCg0KICBUb29sdGlwLnByb3RvdHlwZS5maXhUaXRsZSA9IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgJGUgPSB0aGlzLiRlbGVtZW50DQogICAgaWYgKCRlLmF0dHIoJ3RpdGxlJykgfHwgdHlwZW9mKCRlLmF0dHIoJ2RhdGEtb3JpZ2luYWwtdGl0bGUnKSkgIT0gJ3N0cmluZycpIHsNCiAgICAgICRlLmF0dHIoJ2RhdGEtb3JpZ2luYWwtdGl0bGUnLCAkZS5hdHRyKCd0aXRsZScpIHx8ICcnKS5hdHRyKCd0aXRsZScsICcnKQ0KICAgIH0NCiAgfQ0KDQogIFRvb2x0aXAucHJvdG90eXBlLmhhc0NvbnRlbnQgPSBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIHRoaXMuZ2V0VGl0bGUoKQ0KICB9DQoNCiAgVG9vbHRpcC5wcm90b3R5cGUuZ2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7DQogICAgdmFyIGVsID0gdGhpcy4kZWxlbWVudFswXQ0KICAgIHJldHVybiAkLmV4dGVuZCh7fSwgKHR5cGVvZiBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QgPT0gJ2Z1bmN0aW9uJykgPyBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IHsNCiAgICAgIHdpZHRoOiBlbC5vZmZzZXRXaWR0aA0KICAgICwgaGVpZ2h0OiBlbC5vZmZzZXRIZWlnaHQNCiAgICB9LCB0aGlzLiRlbGVtZW50Lm9mZnNldCgpKQ0KICB9DQoNCiAgVG9vbHRpcC5wcm90b3R5cGUuZ2V0Q2FsY3VsYXRlZE9mZnNldCA9IGZ1bmN0aW9uIChwbGFjZW1lbnQsIHBvcywgYWN0dWFsV2lkdGgsIGFjdHVhbEhlaWdodCkgew0KICAgIHJldHVybiBwbGFjZW1lbnQgPT0gJ2JvdHRvbScgPyB7IHRvcDogcG9zLnRvcCArIHBvcy5oZWlnaHQsICAgbGVmdDogcG9zLmxlZnQgKyBwb3Mud2lkdGggLyAyIC0gYWN0dWFsV2lkdGggLyAyICB9IDoNCiAgICAgICAgICAgcGxhY2VtZW50ID09ICd0b3AnICAgID8geyB0b3A6IHBvcy50b3AgLSBhY3R1YWxIZWlnaHQsIGxlZnQ6IHBvcy5sZWZ0ICsgcG9zLndpZHRoIC8gMiAtIGFjdHVhbFdpZHRoIC8gMiAgfSA6DQogICAgICAgICAgIHBsYWNlbWVudCA9PSAnbGVmdCcgICA/IHsgdG9wOiBwb3MudG9wICsgcG9zLmhlaWdodCAvIDIgLSBhY3R1YWxIZWlnaHQgLyAyLCBsZWZ0OiBwb3MubGVmdCAtIGFjdHVhbFdpZHRoIH0gOg0KICAgICAgICAvKiBwbGFjZW1lbnQgPT0gJ3JpZ2h0JyAqLyB7IHRvcDogcG9zLnRvcCArIHBvcy5oZWlnaHQgLyAyIC0gYWN0dWFsSGVpZ2h0IC8gMiwgbGVmdDogcG9zLmxlZnQgKyBwb3Mud2lkdGggICB9DQogIH0NCg0KICBUb29sdGlwLnByb3RvdHlwZS5nZXRUaXRsZSA9IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgdGl0bGUNCiAgICB2YXIgJGUgPSB0aGlzLiRlbGVtZW50DQogICAgdmFyIG8gID0gdGhpcy5vcHRpb25zDQoNCiAgICB0aXRsZSA9ICRlLmF0dHIoJ2RhdGEtb3JpZ2luYWwtdGl0bGUnKQ0KICAgICAgfHwgKHR5cGVvZiBvLnRpdGxlID09ICdmdW5jdGlvbicgPyBvLnRpdGxlLmNhbGwoJGVbMF0pIDogIG8udGl0bGUpDQoNCiAgICByZXR1cm4gdGl0bGUNCiAgfQ0KDQogIFRvb2x0aXAucHJvdG90eXBlLnRpcCA9IGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gdGhpcy4kdGlwID0gdGhpcy4kdGlwIHx8ICQodGhpcy5vcHRpb25zLnRlbXBsYXRlKQ0KICB9DQoNCiAgVG9vbHRpcC5wcm90b3R5cGUuYXJyb3cgPSBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIHRoaXMuJGFycm93ID0gdGhpcy4kYXJyb3cgfHwgdGhpcy50aXAoKS5maW5kKCcudG9vbHRpcC1hcnJvdycpDQogIH0NCg0KICBUb29sdGlwLnByb3RvdHlwZS52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICBpZiAoIXRoaXMuJGVsZW1lbnRbMF0ucGFyZW50Tm9kZSkgew0KICAgICAgdGhpcy5oaWRlKCkNCiAgICAgIHRoaXMuJGVsZW1lbnQgPSBudWxsDQogICAgICB0aGlzLm9wdGlvbnMgID0gbnVsbA0KICAgIH0NCiAgfQ0KDQogIFRvb2x0aXAucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uICgpIHsNCiAgICB0aGlzLmVuYWJsZWQgPSB0cnVlDQogIH0NCg0KICBUb29sdGlwLnByb3RvdHlwZS5kaXNhYmxlID0gZnVuY3Rpb24gKCkgew0KICAgIHRoaXMuZW5hYmxlZCA9IGZhbHNlDQogIH0NCg0KICBUb29sdGlwLnByb3RvdHlwZS50b2dnbGVFbmFibGVkID0gZnVuY3Rpb24gKCkgew0KICAgIHRoaXMuZW5hYmxlZCA9ICF0aGlzLmVuYWJsZWQNCiAgfQ0KDQogIFRvb2x0aXAucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uIChlKSB7DQogICAgdmFyIHNlbGYgPSBlID8gJChlLmN1cnJlbnRUYXJnZXQpW3RoaXMudHlwZV0odGhpcy5nZXREZWxlZ2F0ZU9wdGlvbnMoKSkuZGF0YSgnYnMuJyArIHRoaXMudHlwZSkgOiB0aGlzDQogICAgc2VsZi50aXAoKS5oYXNDbGFzcygnaW4nKSA/IHNlbGYubGVhdmUoc2VsZikgOiBzZWxmLmVudGVyKHNlbGYpDQogIH0NCg0KICBUb29sdGlwLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgew0KICAgIHRoaXMuaGlkZSgpLiRlbGVtZW50Lm9mZignLicgKyB0aGlzLnR5cGUpLnJlbW92ZURhdGEoJ2JzLicgKyB0aGlzLnR5cGUpDQogIH0NCg0KDQogIC8vIFRPT0xUSVAgUExVR0lOIERFRklOSVRJT04NCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PQ0KDQogIHZhciBvbGQgPSAkLmZuLnRvb2x0aXANCg0KICAkLmZuLnRvb2x0aXAgPSBmdW5jdGlvbiAob3B0aW9uKSB7DQogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgJHRoaXMgICA9ICQodGhpcykNCiAgICAgIHZhciBkYXRhICAgID0gJHRoaXMuZGF0YSgnYnMudG9vbHRpcCcpDQogICAgICB2YXIgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uDQoNCiAgICAgIGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMudG9vbHRpcCcsIChkYXRhID0gbmV3IFRvb2x0aXAodGhpcywgb3B0aW9ucykpKQ0KICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXSgpDQogICAgfSkNCiAgfQ0KDQogICQuZm4udG9vbHRpcC5Db25zdHJ1Y3RvciA9IFRvb2x0aXANCg0KDQogIC8vIFRPT0xUSVAgTk8gQ09ORkxJQ1QNCiAgLy8gPT09PT09PT09PT09PT09PT09PQ0KDQogICQuZm4udG9vbHRpcC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgew0KICAgICQuZm4udG9vbHRpcCA9IG9sZA0KICAgIHJldHVybiB0aGlzDQogIH0NCg0KfShqUXVlcnkpOw0KCn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ey8qKg0KKiBqcXVlcnkubWF0Y2hIZWlnaHQuanMgdjAuNS4yDQoqIGh0dHA6Ly9icm0uaW8vanF1ZXJ5LW1hdGNoLWhlaWdodC8NCiogTGljZW5zZTogTUlUDQoqLw0KDQooZnVuY3Rpb24oJCkgew0KDQogICAgJC5mbi5tYXRjaEhlaWdodCA9IGZ1bmN0aW9uKGJ5Um93KSB7DQoNCiAgICAgICAgLy8gaGFuZGxlIG1hdGNoSGVpZ2h0KCdyZW1vdmUnKQ0KICAgICAgICBpZiAoYnlSb3cgPT09ICdyZW1vdmUnKSB7DQogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7DQoNCiAgICAgICAgICAgIC8vIHJlbW92ZSBmaXhlZCBoZWlnaHQgZnJvbSBhbGwgc2VsZWN0ZWQgZWxlbWVudHMNCiAgICAgICAgICAgIHRoaXMuY3NzKCdoZWlnaHQnLCAnJyk7DQoNCiAgICAgICAgICAgIC8vIHJlbW92ZSBzZWxlY3RlZCBlbGVtZW50cyBmcm9tIGFsbCBncm91cHMNCiAgICAgICAgICAgICQuZWFjaCgkLmZuLm1hdGNoSGVpZ2h0Ll9ncm91cHMsIGZ1bmN0aW9uKGtleSwgZ3JvdXApIHsNCiAgICAgICAgICAgICAgICBncm91cC5lbGVtZW50cyA9IGdyb3VwLmVsZW1lbnRzLm5vdCh0aGF0KTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAvLyBUT0RPOiBjbGVhbnVwIGVtcHR5IGdyb3Vwcw0KDQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICh0aGlzLmxlbmd0aCA8PSAxKQ0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQoNCiAgICAgICAgLy8gYnlSb3cgZGVmYXVsdCB0byB0cnVlDQogICAgICAgIGJ5Um93ID0gKHR5cGVvZiBieVJvdyAhPT0gJ3VuZGVmaW5lZCcpID8gYnlSb3cgOiB0cnVlOw0KDQogICAgICAgIC8vIGtlZXAgdHJhY2sgb2YgdGhpcyBncm91cCBzbyB3ZSBjYW4gcmUtYXBwbHkgbGF0ZXIgb24gbG9hZCBhbmQgcmVzaXplIGV2ZW50cw0KICAgICAgICAkLmZuLm1hdGNoSGVpZ2h0Ll9ncm91cHMucHVzaCh7DQogICAgICAgICAgICBlbGVtZW50czogdGhpcywNCiAgICAgICAgICAgIGJ5Um93OiBieVJvdw0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBtYXRjaCBlYWNoIGVsZW1lbnQncyBoZWlnaHQgdG8gdGhlIHRhbGxlc3QgZWxlbWVudCBpbiB0aGUgc2VsZWN0aW9uDQogICAgICAgICQuZm4ubWF0Y2hIZWlnaHQuX2FwcGx5KHRoaXMsIGJ5Um93KTsNCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9Ow0KDQogICAgJC5mbi5tYXRjaEhlaWdodC5fYXBwbHkgPSBmdW5jdGlvbihlbGVtZW50cywgYnlSb3cpIHsNCiAgICAgICAgdmFyICRlbGVtZW50cyA9ICQoZWxlbWVudHMpLA0KICAgICAgICAgICAgcm93cyA9IFskZWxlbWVudHNdOw0KDQogICAgICAgIC8vIHRha2Ugbm90ZSBvZiBzY3JvbGwgcG9zaXRpb24NCiAgICAgICAgdmFyIHNjcm9sbFRvcCA9ICQod2luZG93KS5zY3JvbGxUb3AoKSwNCiAgICAgICAgICAgIGh0bWxIZWlnaHQgPSAkKCdodG1sJykub3V0ZXJIZWlnaHQodHJ1ZSk7DQoNCiAgICAgICAgLy8gZ2V0IHJvd3MgaWYgdXNpbmcgYnlSb3csIG90aGVyd2lzZSBhc3N1bWUgb25lIHJvdw0KICAgICAgICBpZiAoYnlSb3cpIHsNCg0KICAgICAgICAgICAgLy8gbXVzdCBmaXJzdCBmb3JjZSBhbiBhcmJpdHJhcnkgZXF1YWwgaGVpZ2h0IHNvIGZsb2F0aW5nIGVsZW1lbnRzIGJyZWFrIGV2ZW5seQ0KICAgICAgICAgICAgJGVsZW1lbnRzLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgdmFyICR0aGF0ID0gJCh0aGlzKSwNCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheSA9ICR0aGF0LmNzcygnZGlzcGxheScpID09PSAnaW5saW5lLWJsb2NrJyA/ICdpbmxpbmUtYmxvY2snIDogJ2Jsb2NrJzsNCg0KICAgICAgICAgICAgICAgICR0aGF0LmNzcyh7DQogICAgICAgICAgICAgICAgICAgICdkaXNwbGF5JzogZGlzcGxheSwNCiAgICAgICAgICAgICAgICAgICAgJ3BhZGRpbmctdG9wJzogJzAnLA0KICAgICAgICAgICAgICAgICAgICAncGFkZGluZy1ib3R0b20nOiAnMCcsDQogICAgICAgICAgICAgICAgICAgICdib3JkZXItdG9wLXdpZHRoJzogJzAnLA0KICAgICAgICAgICAgICAgICAgICAnYm9yZGVyLWJvdHRvbS13aWR0aCc6ICcwJywNCiAgICAgICAgICAgICAgICAgICAgJ2hlaWdodCc6ICcxMDBweCcNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAvLyBnZXQgdGhlIGFycmF5IG9mIHJvd3MgKGJhc2VkIG9uIGVsZW1lbnQgdG9wIHBvc2l0aW9uKQ0KICAgICAgICAgICAgcm93cyA9IF9yb3dzKCRlbGVtZW50cyk7DQoNCiAgICAgICAgICAgIC8vIHJldmVydCB0aGUgdGVtcG9yYXJ5IGZvcmNlZCBzdHlsZQ0KICAgICAgICAgICAgJGVsZW1lbnRzLmNzcyh7DQogICAgICAgICAgICAgICAgJ2Rpc3BsYXknOiAnJywNCiAgICAgICAgICAgICAgICAncGFkZGluZy10b3AnOiAnJywNCiAgICAgICAgICAgICAgICAncGFkZGluZy1ib3R0b20nOiAnJywNCiAgICAgICAgICAgICAgICAnYm9yZGVyLXRvcC13aWR0aCc6ICcnLA0KICAgICAgICAgICAgICAgICdib3JkZXItYm90dG9tLXdpZHRoJzogJycsDQogICAgICAgICAgICAgICAgJ2hlaWdodCc6ICcnDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgICQuZWFjaChyb3dzLCBmdW5jdGlvbihrZXksIHJvdykgew0KICAgICAgICAgICAgdmFyICRyb3cgPSAkKHJvdyksDQogICAgICAgICAgICAgICAgbWF4SGVpZ2h0ID0gMDsNCg0KICAgICAgICAgICAgLy8gZW5zdXJlIGVsZW1lbnRzIGFyZSB2aXNpYmxlIHRvIHByZXZlbnQgMCBoZWlnaHQNCiAgICAgICAgICAgIHZhciBoaWRkZW5QYXJlbnRzID0gJHJvdy5wYXJlbnRzKCkuYWRkKCRyb3cpLmZpbHRlcignOmhpZGRlbicpOw0KICAgICAgICAgICAgaGlkZGVuUGFyZW50cy5jc3MoeyAnZGlzcGxheSc6ICdibG9jaycgfSk7DQoNCiAgICAgICAgICAgIC8vIGl0ZXJhdGUgdGhlIHJvdyBhbmQgZmluZCB0aGUgbWF4IGhlaWdodA0KICAgICAgICAgICAgJHJvdy5lYWNoKGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgdmFyICR0aGF0ID0gJCh0aGlzKSwNCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheSA9ICR0aGF0LmNzcygnZGlzcGxheScpID09PSAnaW5saW5lLWJsb2NrJyA/ICdpbmxpbmUtYmxvY2snIDogJ2Jsb2NrJzsNCg0KICAgICAgICAgICAgICAgIC8vIGVuc3VyZSB3ZSBnZXQgdGhlIGNvcnJlY3QgYWN0dWFsIGhlaWdodCAoYW5kIG5vdCBhIHByZXZpb3VzbHkgc2V0IGhlaWdodCB2YWx1ZSkNCiAgICAgICAgICAgICAgICAkdGhhdC5jc3MoeyAnZGlzcGxheSc6IGRpc3BsYXksICdoZWlnaHQnOiAnJyB9KTsNCg0KICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIG1heCBoZWlnaHQgKGluY2x1ZGluZyBwYWRkaW5nLCBidXQgbm90IG1hcmdpbikNCiAgICAgICAgICAgICAgICBpZiAoJHRoYXQub3V0ZXJIZWlnaHQoZmFsc2UpID4gbWF4SGVpZ2h0KQ0KICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQgPSAkdGhhdC5vdXRlckhlaWdodChmYWxzZSk7DQoNCiAgICAgICAgICAgICAgICAvLyByZXZlcnQgZGlzcGxheSBibG9jaw0KICAgICAgICAgICAgICAgICR0aGF0LmNzcyh7ICdkaXNwbGF5JzogJycgfSk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgLy8gcmV2ZXJ0IGRpc3BsYXkgYmxvY2sNCiAgICAgICAgICAgIGhpZGRlblBhcmVudHMuY3NzKHsgJ2Rpc3BsYXknOiAnJyB9KTsNCg0KICAgICAgICAgICAgLy8gaXRlcmF0ZSB0aGUgcm93IGFuZCBhcHBseSB0aGUgaGVpZ2h0IHRvIGFsbCBlbGVtZW50cw0KICAgICAgICAgICAgJHJvdy5lYWNoKGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgdmFyICR0aGF0ID0gJCh0aGlzKSwNCiAgICAgICAgICAgICAgICAgICAgdmVydGljYWxQYWRkaW5nID0gMDsNCg0KICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBwYWRkaW5nIGFuZCBib3JkZXIgY29ycmVjdGx5IChyZXF1aXJlZCB3aGVuIG5vdCB1c2luZyBib3JkZXItYm94KQ0KICAgICAgICAgICAgICAgIGlmICgkdGhhdC5jc3MoJ2JveC1zaXppbmcnKSAhPT0gJ2JvcmRlci1ib3gnKSB7DQogICAgICAgICAgICAgICAgICAgIHZlcnRpY2FsUGFkZGluZyArPSBfcGFyc2UoJHRoYXQuY3NzKCdib3JkZXItdG9wLXdpZHRoJykpICsgX3BhcnNlKCR0aGF0LmNzcygnYm9yZGVyLWJvdHRvbS13aWR0aCcpKTsNCiAgICAgICAgICAgICAgICAgICAgdmVydGljYWxQYWRkaW5nICs9IF9wYXJzZSgkdGhhdC5jc3MoJ3BhZGRpbmctdG9wJykpICsgX3BhcnNlKCR0aGF0LmNzcygncGFkZGluZy1ib3R0b20nKSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gc2V0IHRoZSBoZWlnaHQgKGFjY291bnRpbmcgZm9yIHBhZGRpbmcgYW5kIGJvcmRlcikNCiAgICAgICAgICAgICAgICAkdGhhdC5jc3MoJ2hlaWdodCcsIG1heEhlaWdodCAtIHZlcnRpY2FsUGFkZGluZyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gcmVzdG9yZSBzY3JvbGwgcG9zaXRpb24gaWYgZW5hYmxlZA0KICAgICAgICBpZiAoJC5mbi5tYXRjaEhlaWdodC5fbWFpbnRhaW5TY3JvbGwpDQogICAgICAgICAgICAkKHdpbmRvdykuc2Nyb2xsVG9wKChzY3JvbGxUb3AgLyBodG1sSGVpZ2h0KSAqICQoJ2h0bWwnKS5vdXRlckhlaWdodCh0cnVlKSk7DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfTsNCg0KICAgIC8qDQogICAgKiAgX2FwcGx5RGF0YUFwaSB3aWxsIGFwcGx5IG1hdGNoSGVpZ2h0IHRvIGFsbCBlbGVtZW50cyB3aXRoIGEgZGF0YS1tYXRjaC1oZWlnaHQgYXR0cmlidXRlDQogICAgKi8NCiAgIA0KICAgICQuZm4ubWF0Y2hIZWlnaHQuX2FwcGx5RGF0YUFwaSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgZ3JvdXBzID0ge307DQoNCiAgICAgICAgLy8gZ2VuZXJhdGUgZ3JvdXBzIGJ5IHRoZWlyIGdyb3VwSWQgc2V0IGJ5IGVsZW1lbnRzIHVzaW5nIGRhdGEtbWF0Y2gtaGVpZ2h0DQogICAgICAgICQoJ1tkYXRhLW1hdGNoLWhlaWdodF0sIFtkYXRhLW1oXScpLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLA0KICAgICAgICAgICAgICAgIGdyb3VwSWQgPSAkdGhpcy5hdHRyKCdkYXRhLW1hdGNoLWhlaWdodCcpIHx8ICR0aGlzLmF0dHIoJ2RhdGEtbWgnKTsNCiAgICAgICAgICAgIGlmIChncm91cElkIGluIGdyb3Vwcykgew0KICAgICAgICAgICAgICAgIGdyb3Vwc1tncm91cElkXSA9IGdyb3Vwc1tncm91cElkXS5hZGQoJHRoaXMpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBncm91cHNbZ3JvdXBJZF0gPSAkdGhpczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gYXBwbHkgbWF0Y2hIZWlnaHQgdG8gZWFjaCBncm91cA0KICAgICAgICAkLmVhY2goZ3JvdXBzLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHRoaXMubWF0Y2hIZWlnaHQodHJ1ZSk7DQogICAgICAgIH0pOw0KICAgIH07DQoNCiAgICAvKiANCiAgICAqICBfdXBkYXRlIGZ1bmN0aW9uIHdpbGwgcmUtYXBwbHkgbWF0Y2hIZWlnaHQgdG8gYWxsIGdyb3VwcyB3aXRoIHRoZSBjb3JyZWN0IG9wdGlvbnMNCiAgICAqLw0KICAgDQogICAgJC5mbi5tYXRjaEhlaWdodC5fZ3JvdXBzID0gW107DQogICAgJC5mbi5tYXRjaEhlaWdodC5fdGhyb3R0bGUgPSA4MDsNCiAgICAkLmZuLm1hdGNoSGVpZ2h0Ll9tYWludGFpblNjcm9sbCA9IGZhbHNlOw0KDQogICAgdmFyIHByZXZpb3VzUmVzaXplV2lkdGggPSAtMSwNCiAgICAgICAgdXBkYXRlVGltZW91dCA9IC0xOw0KDQogICAgJC5mbi5tYXRjaEhlaWdodC5fdXBkYXRlID0gZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgLy8gcHJldmVudCB1cGRhdGUgaWYgZmlyZWQgZnJvbSBhIHJlc2l6ZSBldmVudCANCiAgICAgICAgLy8gd2hlcmUgdGhlIHZpZXdwb3J0IHdpZHRoIGhhc24ndCBhY3R1YWxseSBjaGFuZ2VkDQogICAgICAgIC8vIGZpeGVzIGFuIGV2ZW50IGxvb3BpbmcgYnVnIGluIElFOA0KICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQudHlwZSA9PT0gJ3Jlc2l6ZScpIHsNCiAgICAgICAgICAgIHZhciB3aW5kb3dXaWR0aCA9ICQod2luZG93KS53aWR0aCgpOw0KICAgICAgICAgICAgaWYgKHdpbmRvd1dpZHRoID09PSBwcmV2aW91c1Jlc2l6ZVdpZHRoKQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIHByZXZpb3VzUmVzaXplV2lkdGggPSB3aW5kb3dXaWR0aDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHRocm90dGxlIHVwZGF0ZXMNCiAgICAgICAgaWYgKHVwZGF0ZVRpbWVvdXQgPT09IC0xKSB7DQogICAgICAgICAgICB1cGRhdGVUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsNCg0KICAgICAgICAgICAgICAgICQuZWFjaCgkLmZuLm1hdGNoSGVpZ2h0Ll9ncm91cHMsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAkLmZuLm1hdGNoSGVpZ2h0Ll9hcHBseSh0aGlzLmVsZW1lbnRzLCB0aGlzLmJ5Um93KTsNCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgIHVwZGF0ZVRpbWVvdXQgPSAtMTsNCg0KICAgICAgICAgICAgfSwgJC5mbi5tYXRjaEhlaWdodC5fdGhyb3R0bGUpOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qIA0KICAgICogIGJpbmQgZXZlbnRzDQogICAgKi8NCg0KICAgIC8vIGFwcGx5IG9uIERPTSByZWFkeSBldmVudA0KICAgICQoJC5mbi5tYXRjaEhlaWdodC5fYXBwbHlEYXRhQXBpKTsNCg0KICAgIC8vIHVwZGF0ZSBoZWlnaHRzIG9uIGxvYWQgYW5kIHJlc2l6ZSBldmVudHMNCiAgICAkKHdpbmRvdykuYmluZCgnbG9hZCByZXNpemUgb3JpZW50YXRpb25jaGFuZ2UnLCAkLmZuLm1hdGNoSGVpZ2h0Ll91cGRhdGUpOw0KDQogICAgLyoNCiAgICAqICByb3dzIHV0aWxpdHkgZnVuY3Rpb24NCiAgICAqICByZXR1cm5zIGFycmF5IG9mIGpRdWVyeSBzZWxlY3Rpb25zIHJlcHJlc2VudGluZyBlYWNoIHJvdyANCiAgICAqICAoYXMgZGlzcGxheWVkIGFmdGVyIGZsb2F0IHdyYXBwaW5nIGFwcGxpZWQgYnkgYnJvd3NlcikNCiAgICAqLw0KDQogICAgdmFyIF9yb3dzID0gZnVuY3Rpb24oZWxlbWVudHMpIHsNCiAgICAgICAgdmFyIHRvbGVyYW5jZSA9IDEsDQogICAgICAgICAgICAkZWxlbWVudHMgPSAkKGVsZW1lbnRzKSwNCiAgICAgICAgICAgIGxhc3RUb3AgPSBudWxsLA0KICAgICAgICAgICAgcm93cyA9IFtdOw0KDQogICAgICAgIC8vIGdyb3VwIGVsZW1lbnRzIGJ5IHRoZWlyIHRvcCBwb3NpdGlvbg0KICAgICAgICAkZWxlbWVudHMuZWFjaChmdW5jdGlvbigpew0KICAgICAgICAgICAgdmFyICR0aGF0ID0gJCh0aGlzKSwNCiAgICAgICAgICAgICAgICB0b3AgPSAkdGhhdC5vZmZzZXQoKS50b3AgLSBfcGFyc2UoJHRoYXQuY3NzKCdtYXJnaW4tdG9wJykpLA0KICAgICAgICAgICAgICAgIGxhc3RSb3cgPSByb3dzLmxlbmd0aCA+IDAgPyByb3dzW3Jvd3MubGVuZ3RoIC0gMV0gOiBudWxsOw0KDQogICAgICAgICAgICBpZiAobGFzdFJvdyA9PT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIC8vIGZpcnN0IGl0ZW0gb24gdGhlIHJvdywgc28ganVzdCBwdXNoIGl0DQogICAgICAgICAgICAgICAgcm93cy5wdXNoKCR0aGF0KTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gaWYgdGhlIHJvdyB0b3AgaXMgdGhlIHNhbWUsIGFkZCB0byB0aGUgcm93IGdyb3VwDQogICAgICAgICAgICAgICAgaWYgKE1hdGguZmxvb3IoTWF0aC5hYnMobGFzdFRvcCAtIHRvcCkpIDw9IHRvbGVyYW5jZSkgew0KICAgICAgICAgICAgICAgICAgICByb3dzW3Jvd3MubGVuZ3RoIC0gMV0gPSBsYXN0Um93LmFkZCgkdGhhdCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHN0YXJ0IGEgbmV3IHJvdyBncm91cA0KICAgICAgICAgICAgICAgICAgICByb3dzLnB1c2goJHRoYXQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8ga2VlcCB0cmFjayBvZiB0aGUgbGFzdCByb3cgdG9wDQogICAgICAgICAgICBsYXN0VG9wID0gdG9wOw0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gcm93czsNCiAgICB9Ow0KDQogICAgdmFyIF9wYXJzZSA9IGZ1bmN0aW9uKHZhbHVlKSB7DQogICAgICAgIC8vIHBhcnNlIHZhbHVlIGFuZCBjb252ZXJ0IE5hTiB0byAwDQogICAgICAgIHJldHVybiBwYXJzZUZsb2F0KHZhbHVlKSB8fCAwOw0KICAgIH07DQoNCn0pKGpRdWVyeSk7Cn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ey8qIQ0KICogalF1ZXJ5IENvb2tpZSBQbHVnaW4gdjEuNC4xDQogKiBodHRwczovL2dpdGh1Yi5jb20vY2FyaGFydGwvanF1ZXJ5LWNvb2tpZQ0KICoNCiAqIENvcHlyaWdodCAyMDA2LCAyMDE0IEtsYXVzIEhhcnRsDQogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UNCiAqLw0KKGZ1bmN0aW9uIChmYWN0b3J5KSB7DQoJaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgew0KCQkvLyBBTUQNCgkJZGVmaW5lKFsnanF1ZXJ5J10sIGZhY3RvcnkpOw0KCX0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7DQoJCS8vIENvbW1vbkpTDQoJCWZhY3RvcnkocmVxdWlyZSgnanF1ZXJ5JykpOw0KCX0gZWxzZSB7DQoJCS8vIEJyb3dzZXIgZ2xvYmFscw0KCQlmYWN0b3J5KGpRdWVyeSk7DQoJfQ0KfShmdW5jdGlvbiAoJCkgew0KDQoJdmFyIHBsdXNlcyA9IC9cKy9nOw0KDQoJZnVuY3Rpb24gZW5jb2RlKHMpIHsNCgkJcmV0dXJuIGNvbmZpZy5yYXcgPyBzIDogZW5jb2RlVVJJQ29tcG9uZW50KHMpOw0KCX0NCg0KCWZ1bmN0aW9uIGRlY29kZShzKSB7DQoJCXJldHVybiBjb25maWcucmF3ID8gcyA6IGRlY29kZVVSSUNvbXBvbmVudChzKTsNCgl9DQoNCglmdW5jdGlvbiBzdHJpbmdpZnlDb29raWVWYWx1ZSh2YWx1ZSkgew0KCQlyZXR1cm4gZW5jb2RlKGNvbmZpZy5qc29uID8gSlNPTi5zdHJpbmdpZnkodmFsdWUpIDogU3RyaW5nKHZhbHVlKSk7DQoJfQ0KDQoJZnVuY3Rpb24gcGFyc2VDb29raWVWYWx1ZShzKSB7DQoJCWlmIChzLmluZGV4T2YoJyInKSA9PT0gMCkgew0KCQkJLy8gVGhpcyBpcyBhIHF1b3RlZCBjb29raWUgYXMgYWNjb3JkaW5nIHRvIFJGQzIwNjgsIHVuZXNjYXBlLi4uDQoJCQlzID0gcy5zbGljZSgxLCAtMSkucmVwbGFjZSgvXFwiL2csICciJykucmVwbGFjZSgvXFxcXC9nLCAnXFwnKTsNCgkJfQ0KDQoJCXRyeSB7DQoJCQkvLyBSZXBsYWNlIHNlcnZlci1zaWRlIHdyaXR0ZW4gcGx1c2VzIHdpdGggc3BhY2VzLg0KCQkJLy8gSWYgd2UgY2FuJ3QgZGVjb2RlIHRoZSBjb29raWUsIGlnbm9yZSBpdCwgaXQncyB1bnVzYWJsZS4NCgkJCS8vIElmIHdlIGNhbid0IHBhcnNlIHRoZSBjb29raWUsIGlnbm9yZSBpdCwgaXQncyB1bnVzYWJsZS4NCgkJCXMgPSBkZWNvZGVVUklDb21wb25lbnQocy5yZXBsYWNlKHBsdXNlcywgJyAnKSk7DQoJCQlyZXR1cm4gY29uZmlnLmpzb24gPyBKU09OLnBhcnNlKHMpIDogczsNCgkJfSBjYXRjaChlKSB7fQ0KCX0NCg0KCWZ1bmN0aW9uIHJlYWQocywgY29udmVydGVyKSB7DQoJCXZhciB2YWx1ZSA9IGNvbmZpZy5yYXcgPyBzIDogcGFyc2VDb29raWVWYWx1ZShzKTsNCgkJcmV0dXJuICQuaXNGdW5jdGlvbihjb252ZXJ0ZXIpID8gY29udmVydGVyKHZhbHVlKSA6IHZhbHVlOw0KCX0NCg0KCXZhciBjb25maWcgPSAkLmNvb2tpZSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlLCBvcHRpb25zKSB7DQoNCgkJLy8gV3JpdGUNCg0KCQlpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgISQuaXNGdW5jdGlvbih2YWx1ZSkpIHsNCgkJCW9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgY29uZmlnLmRlZmF1bHRzLCBvcHRpb25zKTsNCg0KCQkJaWYgKHR5cGVvZiBvcHRpb25zLmV4cGlyZXMgPT09ICdudW1iZXInKSB7DQoJCQkJdmFyIGRheXMgPSBvcHRpb25zLmV4cGlyZXMsIHQgPSBvcHRpb25zLmV4cGlyZXMgPSBuZXcgRGF0ZSgpOw0KCQkJCXQuc2V0VGltZSgrdCArIGRheXMgKiA4NjRlKzUpOw0KCQkJfQ0KDQoJCQlyZXR1cm4gKGRvY3VtZW50LmNvb2tpZSA9IFsNCgkJCQllbmNvZGUoa2V5KSwgJz0nLCBzdHJpbmdpZnlDb29raWVWYWx1ZSh2YWx1ZSksDQoJCQkJb3B0aW9ucy5leHBpcmVzID8gJzsgZXhwaXJlcz0nICsgb3B0aW9ucy5leHBpcmVzLnRvVVRDU3RyaW5nKCkgOiAnJywgLy8gdXNlIGV4cGlyZXMgYXR0cmlidXRlLCBtYXgtYWdlIGlzIG5vdCBzdXBwb3J0ZWQgYnkgSUUNCgkJCQlvcHRpb25zLnBhdGggICAgPyAnOyBwYXRoPScgKyBvcHRpb25zLnBhdGggOiAnJywNCgkJCQlvcHRpb25zLmRvbWFpbiAgPyAnOyBkb21haW49JyArIG9wdGlvbnMuZG9tYWluIDogJycsDQoJCQkJb3B0aW9ucy5zZWN1cmUgID8gJzsgc2VjdXJlJyA6ICcnDQoJCQldLmpvaW4oJycpKTsNCgkJfQ0KDQoJCS8vIFJlYWQNCg0KCQl2YXIgcmVzdWx0ID0ga2V5ID8gdW5kZWZpbmVkIDoge307DQoNCgkJLy8gVG8gcHJldmVudCB0aGUgZm9yIGxvb3AgaW4gdGhlIGZpcnN0IHBsYWNlIGFzc2lnbiBhbiBlbXB0eSBhcnJheQ0KCQkvLyBpbiBjYXNlIHRoZXJlIGFyZSBubyBjb29raWVzIGF0IGFsbC4gQWxzbyBwcmV2ZW50cyBvZGQgcmVzdWx0IHdoZW4NCgkJLy8gY2FsbGluZyAkLmNvb2tpZSgpLg0KCQl2YXIgY29va2llcyA9IGRvY3VtZW50LmNvb2tpZSA/IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOyAnKSA6IFtdOw0KDQoJCWZvciAodmFyIGkgPSAwLCBsID0gY29va2llcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsNCgkJCXZhciBwYXJ0cyA9IGNvb2tpZXNbaV0uc3BsaXQoJz0nKTsNCgkJCXZhciBuYW1lID0gZGVjb2RlKHBhcnRzLnNoaWZ0KCkpOw0KCQkJdmFyIGNvb2tpZSA9IHBhcnRzLmpvaW4oJz0nKTsNCg0KCQkJaWYgKGtleSAmJiBrZXkgPT09IG5hbWUpIHsNCgkJCQkvLyBJZiBzZWNvbmQgYXJndW1lbnQgKHZhbHVlKSBpcyBhIGZ1bmN0aW9uIGl0J3MgYSBjb252ZXJ0ZXIuLi4NCgkJCQlyZXN1bHQgPSByZWFkKGNvb2tpZSwgdmFsdWUpOw0KCQkJCWJyZWFrOw0KCQkJfQ0KDQoJCQkvLyBQcmV2ZW50IHN0b3JpbmcgYSBjb29raWUgdGhhdCB3ZSBjb3VsZG4ndCBkZWNvZGUuDQoJCQlpZiAoIWtleSAmJiAoY29va2llID0gcmVhZChjb29raWUpKSAhPT0gdW5kZWZpbmVkKSB7DQoJCQkJcmVzdWx0W25hbWVdID0gY29va2llOw0KCQkJfQ0KCQl9DQoNCgkJcmV0dXJuIHJlc3VsdDsNCgl9Ow0KDQoJY29uZmlnLmRlZmF1bHRzID0ge307DQoNCgkkLnJlbW92ZUNvb2tpZSA9IGZ1bmN0aW9uIChrZXksIG9wdGlvbnMpIHsNCgkJaWYgKCQuY29va2llKGtleSkgPT09IHVuZGVmaW5lZCkgew0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoNCgkJLy8gTXVzdCBub3QgYWx0ZXIgb3B0aW9ucywgdGh1cyBleHRlbmRpbmcgYSBmcmVzaCBvYmplY3QuLi4NCgkJJC5jb29raWUoa2V5LCAnJywgJC5leHRlbmQoe30sIG9wdGlvbnMsIHsgZXhwaXJlczogLTEgfSkpOw0KCQlyZXR1cm4gISQuY29va2llKGtleSk7DQoJfTsNCg0KfSkpOwp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvKiENCiAqIGpRdWVyeS5zY3JvbGxUbw0KICogQ29weXJpZ2h0IChjKSAyMDA3LTIwMTQgQXJpZWwgRmxlc2xlciAtIGFmbGVzbGVyPGE+Z21haWw8ZD5jb20gfCBodHRwOi8vZmxlc2xlci5ibG9nc3BvdC5jb20NCiAqIExpY2Vuc2VkIHVuZGVyIE1JVA0KICogaHR0cDovL2ZsZXNsZXIuYmxvZ3Nwb3QuY29tLzIwMDcvMTAvanF1ZXJ5c2Nyb2xsdG8uaHRtbA0KICogQHByb2plY3REZXNjcmlwdGlvbiBFYXN5IGVsZW1lbnQgc2Nyb2xsaW5nIHVzaW5nIGpRdWVyeS4NCiAqIEBhdXRob3IgQXJpZWwgRmxlc2xlcg0KICogQHZlcnNpb24gMS40LjEzDQogKi8NCjsoZnVuY3Rpb24gKGRlZmluZSkgew0KCSd1c2Ugc3RyaWN0JzsNCg0KCWRlZmluZShbJ2pxdWVyeSddLCBmdW5jdGlvbiAoJCkgew0KDQoJCXZhciAkc2Nyb2xsVG8gPSAkLnNjcm9sbFRvID0gZnVuY3Rpb24oIHRhcmdldCwgZHVyYXRpb24sIHNldHRpbmdzICkgew0KCQkJcmV0dXJuICQod2luZG93KS5zY3JvbGxUbyggdGFyZ2V0LCBkdXJhdGlvbiwgc2V0dGluZ3MgKTsNCgkJfTsNCg0KCQkkc2Nyb2xsVG8uZGVmYXVsdHMgPSB7DQoJCQlheGlzOid4eScsDQoJCQlkdXJhdGlvbjogcGFyc2VGbG9hdCgkLmZuLmpxdWVyeSkgPj0gMS4zID8gMCA6IDEsDQoJCQlsaW1pdDp0cnVlDQoJCX07DQoNCgkJLy8gUmV0dXJucyB0aGUgZWxlbWVudCB0aGF0IG5lZWRzIHRvIGJlIGFuaW1hdGVkIHRvIHNjcm9sbCB0aGUgd2luZG93Lg0KCQkvLyBLZXB0IGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSAoc3BlY2lhbGx5IGZvciBsb2NhbFNjcm9sbCAmIHNlcmlhbFNjcm9sbCkNCgkJJHNjcm9sbFRvLndpbmRvdyA9IGZ1bmN0aW9uKCBzY29wZSApIHsNCgkJCXJldHVybiAkKHdpbmRvdykuX3Njcm9sbGFibGUoKTsNCgkJfTsNCg0KCQkvLyBIYWNrLCBoYWNrLCBoYWNrIDopDQoJCS8vIFJldHVybnMgdGhlIHJlYWwgZWxlbWVudHMgdG8gc2Nyb2xsIChzdXBwb3J0cyB3aW5kb3cvaWZyYW1lcywgZG9jdW1lbnRzIGFuZCByZWd1bGFyIG5vZGVzKQ0KCQkkLmZuLl9zY3JvbGxhYmxlID0gZnVuY3Rpb24oKSB7DQoJCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKSB7DQoJCQkJdmFyIGVsZW0gPSB0aGlzLA0KCQkJCQlpc1dpbiA9ICFlbGVtLm5vZGVOYW1lIHx8ICQuaW5BcnJheSggZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLCBbJ2lmcmFtZScsJyNkb2N1bWVudCcsJ2h0bWwnLCdib2R5J10gKSAhPSAtMTsNCg0KCQkJCQlpZiAoIWlzV2luKQ0KCQkJCQkJcmV0dXJuIGVsZW07DQoNCgkJCQl2YXIgZG9jID0gKGVsZW0uY29udGVudFdpbmRvdyB8fCBlbGVtKS5kb2N1bWVudCB8fCBlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbTsNCg0KCQkJCXJldHVybiAvd2Via2l0L2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSB8fCBkb2MuY29tcGF0TW9kZSA9PSAnQmFja0NvbXBhdCcgPw0KCQkJCQlkb2MuYm9keSA6DQoJCQkJCWRvYy5kb2N1bWVudEVsZW1lbnQ7DQoJCQl9KTsNCgkJfTsNCg0KCQkkLmZuLnNjcm9sbFRvID0gZnVuY3Rpb24oIHRhcmdldCwgZHVyYXRpb24sIHNldHRpbmdzICkgew0KCQkJaWYgKHR5cGVvZiBkdXJhdGlvbiA9PSAnb2JqZWN0Jykgew0KCQkJCXNldHRpbmdzID0gZHVyYXRpb247DQoJCQkJZHVyYXRpb24gPSAwOw0KCQkJfQ0KCQkJaWYgKHR5cGVvZiBzZXR0aW5ncyA9PSAnZnVuY3Rpb24nKQ0KCQkJCXNldHRpbmdzID0geyBvbkFmdGVyOnNldHRpbmdzIH07DQoNCgkJCWlmICh0YXJnZXQgPT0gJ21heCcpDQoJCQkJdGFyZ2V0ID0gOWU5Ow0KDQoJCQlzZXR0aW5ncyA9ICQuZXh0ZW5kKCB7fSwgJHNjcm9sbFRvLmRlZmF1bHRzLCBzZXR0aW5ncyApOw0KCQkJLy8gU3BlZWQgaXMgc3RpbGwgcmVjb2duaXplZCBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkNCgkJCWR1cmF0aW9uID0gZHVyYXRpb24gfHwgc2V0dGluZ3MuZHVyYXRpb247DQoJCQkvLyBNYWtlIHN1cmUgdGhlIHNldHRpbmdzIGFyZSBnaXZlbiByaWdodA0KCQkJc2V0dGluZ3MucXVldWUgPSBzZXR0aW5ncy5xdWV1ZSAmJiBzZXR0aW5ncy5heGlzLmxlbmd0aCA+IDE7DQoNCgkJCWlmIChzZXR0aW5ncy5xdWV1ZSkNCgkJCQkvLyBMZXQncyBrZWVwIHRoZSBvdmVyYWxsIGR1cmF0aW9uDQoJCQkJZHVyYXRpb24gLz0gMjsNCgkJCXNldHRpbmdzLm9mZnNldCA9IGJvdGgoIHNldHRpbmdzLm9mZnNldCApOw0KCQkJc2V0dGluZ3Mub3ZlciA9IGJvdGgoIHNldHRpbmdzLm92ZXIgKTsNCg0KCQkJcmV0dXJuIHRoaXMuX3Njcm9sbGFibGUoKS5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCS8vIE51bGwgdGFyZ2V0IHlpZWxkcyBub3RoaW5nLCBqdXN0IGxpa2UgalF1ZXJ5IGRvZXMNCgkJCQlpZiAodGFyZ2V0ID09IG51bGwpIHJldHVybjsNCg0KCQkJCXZhciBlbGVtID0gdGhpcywNCgkJCQkJJGVsZW0gPSAkKGVsZW0pLA0KCQkJCQl0YXJnID0gdGFyZ2V0LCB0b2ZmLCBhdHRyID0ge30sDQoJCQkJCXdpbiA9ICRlbGVtLmlzKCdodG1sLGJvZHknKTsNCg0KCQkJCXN3aXRjaCAodHlwZW9mIHRhcmcpIHsNCgkJCQkJLy8gQSBudW1iZXIgd2lsbCBwYXNzIHRoZSByZWdleA0KCQkJCQljYXNlICdudW1iZXInOg0KCQkJCQljYXNlICdzdHJpbmcnOg0KCQkJCQkJaWYgKC9eKFsrLV09Pyk/XGQrKFwuXGQrKT8ocHh8JSk/JC8udGVzdCh0YXJnKSkgew0KCQkJCQkJCXRhcmcgPSBib3RoKCB0YXJnICk7DQoJCQkJCQkJLy8gV2UgYXJlIGRvbmUNCgkJCQkJCQlicmVhazsNCgkJCQkJCX0NCgkJCQkJCS8vIFJlbGF0aXZlL0Fic29sdXRlIHNlbGVjdG9yLCBubyBicmVhayENCgkJCQkJCXRhcmcgPSB3aW4gPyAkKHRhcmcpIDogJCh0YXJnLCB0aGlzKTsNCgkJCQkJCWlmICghdGFyZy5sZW5ndGgpIHJldHVybjsNCgkJCQkJY2FzZSAnb2JqZWN0JzoNCgkJCQkJCS8vIERPTUVsZW1lbnQgLyBqUXVlcnkNCgkJCQkJCWlmICh0YXJnLmlzIHx8IHRhcmcuc3R5bGUpDQoJCQkJCQkJLy8gR2V0IHRoZSByZWFsIHBvc2l0aW9uIG9mIHRoZSB0YXJnZXQNCgkJCQkJCQl0b2ZmID0gKHRhcmcgPSAkKHRhcmcpKS5vZmZzZXQoKTsNCgkJCQl9DQoNCgkJCQl2YXIgb2Zmc2V0ID0gJC5pc0Z1bmN0aW9uKHNldHRpbmdzLm9mZnNldCkgJiYgc2V0dGluZ3Mub2Zmc2V0KGVsZW0sIHRhcmcpIHx8IHNldHRpbmdzLm9mZnNldDsNCg0KCQkJCSQuZWFjaCggc2V0dGluZ3MuYXhpcy5zcGxpdCgnJyksIGZ1bmN0aW9uKCBpLCBheGlzICkgew0KCQkJCQl2YXIgUG9zCT0gYXhpcyA9PSAneCcgPyAnTGVmdCcgOiAnVG9wJywNCgkJCQkJCXBvcyA9IFBvcy50b0xvd2VyQ2FzZSgpLA0KCQkJCQkJa2V5ID0gJ3Njcm9sbCcgKyBQb3MsDQoJCQkJCQlvbGQgPSBlbGVtW2tleV0sDQoJCQkJCQltYXggPSAkc2Nyb2xsVG8ubWF4KGVsZW0sIGF4aXMpOw0KDQoJCQkJCWlmICh0b2ZmKSB7Ly8galF1ZXJ5IC8gRE9NRWxlbWVudA0KCQkJCQkJYXR0cltrZXldID0gdG9mZltwb3NdICsgKCB3aW4gPyAwIDogb2xkIC0gJGVsZW0ub2Zmc2V0KClbcG9zXSApOw0KDQoJCQkJCQkvLyBJZiBpdCdzIGEgZG9tIGVsZW1lbnQsIHJlZHVjZSB0aGUgbWFyZ2luDQoJCQkJCQlpZiAoc2V0dGluZ3MubWFyZ2luKSB7DQoJCQkJCQkJYXR0cltrZXldIC09IHBhcnNlSW50KHRhcmcuY3NzKCdtYXJnaW4nK1BvcykpIHx8IDA7DQoJCQkJCQkJYXR0cltrZXldIC09IHBhcnNlSW50KHRhcmcuY3NzKCdib3JkZXInK1BvcysnV2lkdGgnKSkgfHwgMDsNCgkJCQkJCX0NCg0KCQkJCQkJYXR0cltrZXldICs9IG9mZnNldFtwb3NdIHx8IDA7DQoNCgkJCQkJCWlmKHNldHRpbmdzLm92ZXJbcG9zXSkNCgkJCQkJCQkvLyBTY3JvbGwgdG8gYSBmcmFjdGlvbiBvZiBpdHMgd2lkdGgvaGVpZ2h0DQoJCQkJCQkJYXR0cltrZXldICs9IHRhcmdbYXhpcz09J3gnPyd3aWR0aCc6J2hlaWdodCddKCkgKiBzZXR0aW5ncy5vdmVyW3Bvc107DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQl2YXIgdmFsID0gdGFyZ1twb3NdOw0KCQkJCQkJLy8gSGFuZGxlIHBlcmNlbnRhZ2UgdmFsdWVzDQoJCQkJCQlhdHRyW2tleV0gPSB2YWwuc2xpY2UgJiYgdmFsLnNsaWNlKC0xKSA9PSAnJScgPw0KCQkJCQkJCXBhcnNlRmxvYXQodmFsKSAvIDEwMCAqIG1heA0KCQkJCQkJCTogdmFsOw0KCQkJCQl9DQoNCgkJCQkJLy8gTnVtYmVyIG9yICdudW1iZXInDQoJCQkJCWlmIChzZXR0aW5ncy5saW1pdCAmJiAvXlxkKyQvLnRlc3QoYXR0cltrZXldKSkNCgkJCQkJCS8vIENoZWNrIHRoZSBsaW1pdHMNCgkJCQkJCWF0dHJba2V5XSA9IGF0dHJba2V5XSA8PSAwID8gMCA6IE1hdGgubWluKCBhdHRyW2tleV0sIG1heCApOw0KDQoJCQkJCS8vIFF1ZXVlaW5nIGF4ZXMNCgkJCQkJaWYgKCFpICYmIHNldHRpbmdzLnF1ZXVlKSB7DQoJCQkJCQkvLyBEb24ndCB3YXN0ZSB0aW1lIGFuaW1hdGluZywgaWYgdGhlcmUncyBubyBuZWVkLg0KCQkJCQkJaWYgKG9sZCAhPSBhdHRyW2tleV0pDQoJCQkJCQkJLy8gSW50ZXJtZWRpYXRlIGFuaW1hdGlvbg0KCQkJCQkJCWFuaW1hdGUoIHNldHRpbmdzLm9uQWZ0ZXJGaXJzdCApOw0KCQkJCQkJLy8gRG9uJ3QgYW5pbWF0ZSB0aGlzIGF4aXMgYWdhaW4gaW4gdGhlIG5leHQgaXRlcmF0aW9uLg0KCQkJCQkJZGVsZXRlIGF0dHJba2V5XTsNCgkJCQkJfQ0KCQkJCX0pOw0KDQoJCQkJYW5pbWF0ZSggc2V0dGluZ3Mub25BZnRlciApOw0KDQoJCQkJZnVuY3Rpb24gYW5pbWF0ZSggY2FsbGJhY2sgKSB7DQoJCQkJCSRlbGVtLmFuaW1hdGUoIGF0dHIsIGR1cmF0aW9uLCBzZXR0aW5ncy5lYXNpbmcsIGNhbGxiYWNrICYmIGZ1bmN0aW9uKCkgew0KCQkJCQkJY2FsbGJhY2suY2FsbCh0aGlzLCB0YXJnLCBzZXR0aW5ncyk7DQoJCQkJCX0pOw0KCQkJCX0NCgkJCX0pLmVuZCgpOw0KCQl9Ow0KDQoJCS8vIE1heCBzY3JvbGxpbmcgcG9zaXRpb24sIHdvcmtzIG9uIHF1aXJrcyBtb2RlDQoJCS8vIEl0IG9ubHkgZmFpbHMgKG5vdCB0b28gYmFkbHkpIG9uIElFLCBxdWlya3MgbW9kZS4NCgkJJHNjcm9sbFRvLm1heCA9IGZ1bmN0aW9uKCBlbGVtLCBheGlzICkgew0KCQkJdmFyIERpbSA9IGF4aXMgPT0gJ3gnID8gJ1dpZHRoJyA6ICdIZWlnaHQnLA0KCQkJCXNjcm9sbCA9ICdzY3JvbGwnK0RpbTsNCg0KCQkJaWYgKCEkKGVsZW0pLmlzKCdodG1sLGJvZHknKSkNCgkJCQlyZXR1cm4gZWxlbVtzY3JvbGxdIC0gJChlbGVtKVtEaW0udG9Mb3dlckNhc2UoKV0oKTsNCg0KCQkJdmFyIHNpemUgPSAnY2xpZW50JyArIERpbSwNCgkJCQlodG1sID0gZWxlbS5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwNCgkJCQlib2R5ID0gZWxlbS5vd25lckRvY3VtZW50LmJvZHk7DQoNCgkJCXJldHVybiBNYXRoLm1heCggaHRtbFtzY3JvbGxdLCBib2R5W3Njcm9sbF0gKSAtIE1hdGgubWluKCBodG1sW3NpemVdICAsIGJvZHlbc2l6ZV0gICApOw0KCQl9Ow0KDQoJCWZ1bmN0aW9uIGJvdGgoIHZhbCApIHsNCgkJCXJldHVybiAkLmlzRnVuY3Rpb24odmFsKSB8fCB0eXBlb2YgdmFsID09ICdvYmplY3QnID8gdmFsIDogeyB0b3A6dmFsLCBsZWZ0OnZhbCB9Ow0KCQl9DQoNCgkJLy8gQU1EIHJlcXVpcmVtZW50DQoJCXJldHVybiAkc2Nyb2xsVG87DQoJfSkNCn0odHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lIDogZnVuY3Rpb24gKGRlcHMsIGZhY3RvcnkpIHsNCglpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHsNCgkJLy8gTm9kZQ0KCQltb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnanF1ZXJ5JykpOw0KCX0gZWxzZSB7DQoJCWZhY3RvcnkoalF1ZXJ5KTsNCgl9DQp9KSk7DQoKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7LyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogKiBCb290c3RyYXA6IHBvcG92ZXIuanMgdjMuMC4yDQogKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNwb3BvdmVycw0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogKiBDb3B5cmlnaHQgMjAxMyBUd2l0dGVyLCBJbmMuDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQoNCitmdW5jdGlvbiAoJCkgeyAidXNlIHN0cmljdCI7DQoNCiAgLy8gUE9QT1ZFUiBQVUJMSUMgQ0xBU1MgREVGSU5JVElPTg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoNCiAgdmFyIFBvcG92ZXIgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucykgew0KICAgIHRoaXMuaW5pdCgncG9wb3ZlcicsIGVsZW1lbnQsIG9wdGlvbnMpDQogIH0NCg0KICBpZiAoISQuZm4udG9vbHRpcCkgdGhyb3cgbmV3IEVycm9yKCdQb3BvdmVyIHJlcXVpcmVzIHRvb2x0aXAuanMnKQ0KDQogIFBvcG92ZXIuREVGQVVMVFMgPSAkLmV4dGVuZCh7fSAsICQuZm4udG9vbHRpcC5Db25zdHJ1Y3Rvci5ERUZBVUxUUywgew0KICAgIHBsYWNlbWVudDogJ3JpZ2h0Jw0KICAsIHRyaWdnZXI6ICdjbGljaycNCiAgLCBjb250ZW50OiAnJw0KICAsIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz0icG9wb3ZlciI+PGRpdiBjbGFzcz0iYXJyb3ciPjwvZGl2PjxoMyBjbGFzcz0icG9wb3Zlci10aXRsZSI+PC9oMz48ZGl2IGNsYXNzPSJwb3BvdmVyLWNvbnRlbnQiPjwvZGl2PjwvZGl2PicNCiAgfSkNCg0KDQogIC8vIE5PVEU6IFBPUE9WRVIgRVhURU5EUyB0b29sdGlwLmpzDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoNCiAgUG9wb3Zlci5wcm90b3R5cGUgPSAkLmV4dGVuZCh7fSwgJC5mbi50b29sdGlwLkNvbnN0cnVjdG9yLnByb3RvdHlwZSkNCg0KICBQb3BvdmVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFBvcG92ZXINCg0KICBQb3BvdmVyLnByb3RvdHlwZS5nZXREZWZhdWx0cyA9IGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gUG9wb3Zlci5ERUZBVUxUUw0KICB9DQoNCiAgUG9wb3Zlci5wcm90b3R5cGUuc2V0Q29udGVudCA9IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgJHRpcCAgICA9IHRoaXMudGlwKCkNCiAgICB2YXIgdGl0bGUgICA9IHRoaXMuZ2V0VGl0bGUoKQ0KICAgIHZhciBjb250ZW50ID0gdGhpcy5nZXRDb250ZW50KCkNCg0KICAgICR0aXAuZmluZCgnLnBvcG92ZXItdGl0bGUnKVt0aGlzLm9wdGlvbnMuaHRtbCA/ICdodG1sJyA6ICd0ZXh0J10odGl0bGUpDQogICAgJHRpcC5maW5kKCcucG9wb3Zlci1jb250ZW50JylbdGhpcy5vcHRpb25zLmh0bWwgPyAnaHRtbCcgOiAndGV4dCddKGNvbnRlbnQpDQoNCiAgICAkdGlwLnJlbW92ZUNsYXNzKCdmYWRlIHRvcCBib3R0b20gbGVmdCByaWdodCBpbicpDQoNCiAgICAvLyBJRTggZG9lc24ndCBhY2NlcHQgaGlkaW5nIHZpYSB0aGUgYDplbXB0eWAgcHNldWRvIHNlbGVjdG9yLCB3ZSBoYXZlIHRvIGRvDQogICAgLy8gdGhpcyBtYW51YWxseSBieSBjaGVja2luZyB0aGUgY29udGVudHMuDQogICAgaWYgKCEkdGlwLmZpbmQoJy5wb3BvdmVyLXRpdGxlJykuaHRtbCgpKSAkdGlwLmZpbmQoJy5wb3BvdmVyLXRpdGxlJykuaGlkZSgpDQogIH0NCg0KICBQb3BvdmVyLnByb3RvdHlwZS5oYXNDb250ZW50ID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLmdldFRpdGxlKCkgfHwgdGhpcy5nZXRDb250ZW50KCkNCiAgfQ0KDQogIFBvcG92ZXIucHJvdG90eXBlLmdldENvbnRlbnQgPSBmdW5jdGlvbiAoKSB7DQogICAgdmFyICRlID0gdGhpcy4kZWxlbWVudA0KICAgIHZhciBvICA9IHRoaXMub3B0aW9ucw0KDQogICAgcmV0dXJuICRlLmF0dHIoJ2RhdGEtY29udGVudCcpDQogICAgICB8fCAodHlwZW9mIG8uY29udGVudCA9PSAnZnVuY3Rpb24nID8NCiAgICAgICAgICAgIG8uY29udGVudC5jYWxsKCRlWzBdKSA6DQogICAgICAgICAgICBvLmNvbnRlbnQpDQogIH0NCg0KICBQb3BvdmVyLnByb3RvdHlwZS5hcnJvdyA9IGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gdGhpcy4kYXJyb3cgPSB0aGlzLiRhcnJvdyB8fCB0aGlzLnRpcCgpLmZpbmQoJy5hcnJvdycpDQogIH0NCg0KICBQb3BvdmVyLnByb3RvdHlwZS50aXAgPSBmdW5jdGlvbiAoKSB7DQogICAgaWYgKCF0aGlzLiR0aXApIHRoaXMuJHRpcCA9ICQodGhpcy5vcHRpb25zLnRlbXBsYXRlKQ0KICAgIHJldHVybiB0aGlzLiR0aXANCiAgfQ0KDQoNCiAgLy8gUE9QT1ZFUiBQTFVHSU4gREVGSU5JVElPTg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09DQoNCiAgdmFyIG9sZCA9ICQuZm4ucG9wb3Zlcg0KDQogICQuZm4ucG9wb3ZlciA9IGZ1bmN0aW9uIChvcHRpb24pIHsNCiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciAkdGhpcyAgID0gJCh0aGlzKQ0KICAgICAgdmFyIGRhdGEgICAgPSAkdGhpcy5kYXRhKCdicy5wb3BvdmVyJykNCiAgICAgIHZhciBvcHRpb25zID0gdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb24NCg0KICAgICAgaWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdicy5wb3BvdmVyJywgKGRhdGEgPSBuZXcgUG9wb3Zlcih0aGlzLCBvcHRpb25zKSkpDQogICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKCkNCiAgICB9KQ0KICB9DQoNCiAgJC5mbi5wb3BvdmVyLkNvbnN0cnVjdG9yID0gUG9wb3Zlcg0KDQoNCiAgLy8gUE9QT1ZFUiBOTyBDT05GTElDVA0KICAvLyA9PT09PT09PT09PT09PT09PT09DQoNCiAgJC5mbi5wb3BvdmVyLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7DQogICAgJC5mbi5wb3BvdmVyID0gb2xkDQogICAgcmV0dXJuIHRoaXMNCiAgfQ0KDQp9KGpRdWVyeSk7DQoKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7LyohDQoNCkhvbGRlciAtIGNsaWVudCBzaWRlIGltYWdlIHBsYWNlaG9sZGVycw0KVmVyc2lvbiAyLjQuMCtieGxpbQ0KwqkgMjAxNCBJdmFuIE1hbG9waW5za3kgLSBodHRwOi8vaW1za3kuY28NCg0KU2l0ZTogICAgIGh0dHA6Ly9pbXNreS5naXRodWIuaW8vaG9sZGVyDQpJc3N1ZXM6ICAgaHR0cHM6Ly9naXRodWIuY29tL2ltc2t5L2hvbGRlci9pc3N1ZXMNCkxpY2Vuc2U6ICBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUDQoNCiovDQohZnVuY3Rpb24oZSx0LHIpe3RbZV09cn0oIm9uRG9tUmVhZHkiLHRoaXMsZnVuY3Rpb24oZSl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHQoZSl7aWYoIWIpe2lmKCFhLmJvZHkpcmV0dXJuIGkodCk7Zm9yKGI9ITA7ZT1TLnNoaWZ0KCk7KWkoZSl9fWZ1bmN0aW9uIHIoZSl7KHl8fGUudHlwZT09PXN8fGFbY109PT11KSYmKG4oKSx0KCkpfWZ1bmN0aW9uIG4oKXt5PyhhW3hdKG0scixkKSxlW3hdKHMscixkKSk6KGFbZ10odixyKSxlW2ddKGgscikpfWZ1bmN0aW9uIGkoZSx0KXtzZXRUaW1lb3V0KGUsK3Q+PTA/dDoxKX1mdW5jdGlvbiBvKGUpe2I/aShlKTpTLnB1c2goZSl9bnVsbD09ZG9jdW1lbnQucmVhZHlTdGF0ZSYmZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciYmKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLGZ1bmN0aW9uIEUoKXtkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixFLCExKSxkb2N1bWVudC5yZWFkeVN0YXRlPSJjb21wbGV0ZSJ9LCExKSxkb2N1bWVudC5yZWFkeVN0YXRlPSJsb2FkaW5nIik7dmFyIGE9ZS5kb2N1bWVudCxsPWEuZG9jdW1lbnRFbGVtZW50LHM9ImxvYWQiLGQ9ITEsaD0ib24iK3MsdT0iY29tcGxldGUiLGM9InJlYWR5U3RhdGUiLGY9ImF0dGFjaEV2ZW50IixnPSJkZXRhY2hFdmVudCIscD0iYWRkRXZlbnRMaXN0ZW5lciIsbT0iRE9NQ29udGVudExvYWRlZCIsdj0ib25yZWFkeXN0YXRlY2hhbmdlIix4PSJyZW1vdmVFdmVudExpc3RlbmVyIix5PXAgaW4gYSx3PWQsYj1kLFM9W107aWYoYVtjXT09PXUpaSh0KTtlbHNlIGlmKHkpYVtwXShtLHIsZCksZVtwXShzLHIsZCk7ZWxzZXthW2ZdKHYsciksZVtmXShoLHIpO3RyeXt3PW51bGw9PWUuZnJhbWVFbGVtZW50JiZsfWNhdGNoKEMpe313JiZ3LmRvU2Nyb2xsJiYhZnVuY3Rpb24gaygpe2lmKCFiKXt0cnl7dy5kb1Njcm9sbCgibGVmdCIpfWNhdGNoKGUpe3JldHVybiBpKGssNTApfW4oKSx0KCl9fSgpfXJldHVybiBvLnZlcnNpb249IjEuNC4wIixvLmlzUmVhZHk9ZnVuY3Rpb24oKXtyZXR1cm4gYn0sb30odGhpcykpLGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGx8fChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsPWZ1bmN0aW9uKGUpe3ZhciB0LHI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKSxuPVtdO2Zvcihkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZmlyc3RDaGlsZC5hcHBlbmRDaGlsZChyKSxkb2N1bWVudC5fcXNhPVtdLHIuc3R5bGVTaGVldC5jc3NUZXh0PWUrInt4LXFzYTpleHByZXNzaW9uKGRvY3VtZW50Ll9xc2EgJiYgZG9jdW1lbnQuX3FzYS5wdXNoKHRoaXMpKX0iLHdpbmRvdy5zY3JvbGxCeSgwLDApLHIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyKTtkb2N1bWVudC5fcXNhLmxlbmd0aDspdD1kb2N1bWVudC5fcXNhLnNoaWZ0KCksdC5zdHlsZS5yZW1vdmVBdHRyaWJ1dGUoIngtcXNhIiksbi5wdXNoKHQpO3JldHVybiBkb2N1bWVudC5fcXNhPW51bGwsbn0pLGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3J8fChkb2N1bWVudC5xdWVyeVNlbGVjdG9yPWZ1bmN0aW9uKGUpe3ZhciB0PWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZSk7cmV0dXJuIHQubGVuZ3RoP3RbMF06bnVsbH0pLGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWV8fChkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lPWZ1bmN0aW9uKGUpe3JldHVybiBlPVN0cmluZyhlKS5yZXBsYWNlKC9efFxzKy9nLCIuIiksZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChlKX0pLE9iamVjdC5rZXlzfHwoT2JqZWN0LmtleXM9ZnVuY3Rpb24oZSl7aWYoZSE9PU9iamVjdChlKSl0aHJvdyBUeXBlRXJyb3IoIk9iamVjdC5rZXlzIGNhbGxlZCBvbiBub24tb2JqZWN0Iik7dmFyIHQscj1bXTtmb3IodCBpbiBlKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLHQpJiZyLnB1c2godCk7cmV0dXJuIHJ9KSxmdW5jdGlvbihlKXt2YXIgdD0iQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0iO2UuYXRvYj1lLmF0b2J8fGZ1bmN0aW9uKGUpe2U9U3RyaW5nKGUpO3ZhciByLG49MCxpPVtdLG89MCxhPTA7aWYoZT1lLnJlcGxhY2UoL1xzL2csIiIpLGUubGVuZ3RoJTQ9PT0wJiYoZT1lLnJlcGxhY2UoLz0rJC8sIiIpKSxlLmxlbmd0aCU0PT09MSl0aHJvdyBFcnJvcigiSW52YWxpZENoYXJhY3RlckVycm9yIik7aWYoL1teKy8wLTlBLVphLXpdLy50ZXN0KGUpKXRocm93IEVycm9yKCJJbnZhbGlkQ2hhcmFjdGVyRXJyb3IiKTtmb3IoO248ZS5sZW5ndGg7KXI9dC5pbmRleE9mKGUuY2hhckF0KG4pKSxvPW88PDZ8cixhKz02LDI0PT09YSYmKGkucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKG8+PjE2JjI1NSkpLGkucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKG8+PjgmMjU1KSksaS5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoMjU1Jm8pKSxhPTAsbz0wKSxuKz0xO3JldHVybiAxMj09PWE/KG8+Pj00LGkucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKDI1NSZvKSkpOjE4PT09YSYmKG8+Pj0yLGkucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKG8+PjgmMjU1KSksaS5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoMjU1Jm8pKSksaS5qb2luKCIiKX0sZS5idG9hPWUuYnRvYXx8ZnVuY3Rpb24oZSl7ZT1TdHJpbmcoZSk7dmFyIHIsbixpLG8sYSxsLHMsZD0wLGg9W107aWYoL1teXHgwMC1ceEZGXS8udGVzdChlKSl0aHJvdyBFcnJvcigiSW52YWxpZENoYXJhY3RlckVycm9yIik7Zm9yKDtkPGUubGVuZ3RoOylyPWUuY2hhckNvZGVBdChkKyspLG49ZS5jaGFyQ29kZUF0KGQrKyksaT1lLmNoYXJDb2RlQXQoZCsrKSxvPXI+PjIsYT0oMyZyKTw8NHxuPj40LGw9KDE1Jm4pPDwyfGk+PjYscz02MyZpLGQ9PT1lLmxlbmd0aCsyPyhsPTY0LHM9NjQpOmQ9PT1lLmxlbmd0aCsxJiYocz02NCksaC5wdXNoKHQuY2hhckF0KG8pLHQuY2hhckF0KGEpLHQuY2hhckF0KGwpLHQuY2hhckF0KHMpKTtyZXR1cm4gaC5qb2luKCIiKX19KHRoaXMpLGZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LHIsbil7dC5kb2N1bWVudDt2YXIgaSxvPXQuY3VycmVudFN0eWxlW3JdLm1hdGNoKC8oW1xkXC5dKykoJXxjbXxlbXxpbnxtbXxwY3xwdHwpLyl8fFswLDAsIiJdLGE9b1sxXSxsPW9bMl07cmV0dXJuIG49bj8vJXxlbS8udGVzdChsKSYmdC5wYXJlbnRFbGVtZW50P2UodC5wYXJlbnRFbGVtZW50LCJmb250U2l6ZSIsbnVsbCk6MTY6bixpPSJmb250U2l6ZSI9PXI/bjovd2lkdGgvaS50ZXN0KHIpP3QuY2xpZW50V2lkdGg6dC5jbGllbnRIZWlnaHQsIiUiPT1sP2EvMTAwKmk6ImNtIj09bD8uMzkzNyphKjk2OiJlbSI9PWw/YSpuOiJpbiI9PWw/OTYqYToibW0iPT1sPy4zOTM3KmEqOTYvMTA6InBjIj09bD8xMiphKjk2LzcyOiJwdCI9PWw/OTYqYS83MjphfWZ1bmN0aW9uIHQoZSx0KXt2YXIgcj0iYm9yZGVyIj09dD8iV2lkdGgiOiIiLG49dCsiVG9wIityLGk9dCsiUmlnaHQiK3Isbz10KyJCb3R0b20iK3IsYT10KyJMZWZ0IityO2VbdF09KGVbbl09PWVbaV0mJmVbbl09PWVbb10mJmVbbl09PWVbYV0/W2Vbbl1dOmVbbl09PWVbb10mJmVbYV09PWVbaV0/W2Vbbl0sZVtpXV06ZVthXT09ZVtpXT9bZVtuXSxlW2ldLGVbb11dOltlW25dLGVbaV0sZVtvXSxlW2FdXSkuam9pbigiICIpfWZ1bmN0aW9uIHIocil7dmFyIG4saT10aGlzLG89ci5jdXJyZW50U3R5bGUsYT1lKHIsImZvbnRTaXplIiksbD1mdW5jdGlvbihlKXtyZXR1cm4iLSIrZS50b0xvd2VyQ2FzZSgpfTtmb3IobiBpbiBvKWlmKEFycmF5LnByb3RvdHlwZS5wdXNoLmNhbGwoaSwic3R5bGVGbG9hdCI9PW4/ImZsb2F0IjpuLnJlcGxhY2UoL1tBLVpdLyxsKSksIndpZHRoIj09bilpW25dPXIub2Zmc2V0V2lkdGgrInB4IjtlbHNlIGlmKCJoZWlnaHQiPT1uKWlbbl09ci5vZmZzZXRIZWlnaHQrInB4IjtlbHNlIGlmKCJzdHlsZUZsb2F0Ij09bilpLmZsb2F0PW9bbl07ZWxzZSBpZigvbWFyZ2luLnxwYWRkaW5nLnxib3JkZXIuK1cvLnRlc3QobikmJiJhdXRvIiE9aVtuXSlpW25dPU1hdGgucm91bmQoZShyLG4sYSkpKyJweCI7ZWxzZSBpZigvXm91dGxpbmUvLnRlc3QobikpdHJ5e2lbbl09b1tuXX1jYXRjaChzKXtpLm91dGxpbmVDb2xvcj1vLmNvbG9yLGkub3V0bGluZVN0eWxlPWkub3V0bGluZVN0eWxlfHwibm9uZSIsaS5vdXRsaW5lV2lkdGg9aS5vdXRsaW5lV2lkdGh8fCIwcHgiLGkub3V0bGluZT1baS5vdXRsaW5lQ29sb3IsaS5vdXRsaW5lV2lkdGgsaS5vdXRsaW5lU3R5bGVdLmpvaW4oIiAiKX1lbHNlIGlbbl09b1tuXTt0KGksIm1hcmdpbiIpLHQoaSwicGFkZGluZyIpLHQoaSwiYm9yZGVyIiksaS5mb250U2l6ZT1NYXRoLnJvdW5kKGEpKyJweCJ9d2luZG93LmdldENvbXB1dGVkU3R5bGV8fChyLnByb3RvdHlwZT17Y29uc3RydWN0b3I6cixnZXRQcm9wZXJ0eVByaW9yaXR5OmZ1bmN0aW9uKCl7dGhyb3cgbmV3IEVycm9yKCJOb3RTdXBwb3J0ZWRFcnJvcjogRE9NIEV4Y2VwdGlvbiA5Iil9LGdldFByb3BlcnR5VmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXNbZS5yZXBsYWNlKC8tXHcvZyxmdW5jdGlvbihlKXtyZXR1cm4gZVsxXS50b1VwcGVyQ2FzZSgpfSldfSxpdGVtOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzW2VdfSxyZW1vdmVQcm9wZXJ0eTpmdW5jdGlvbigpe3Rocm93IG5ldyBFcnJvcigiTm9Nb2RpZmljYXRpb25BbGxvd2VkRXJyb3I6IERPTSBFeGNlcHRpb24gNyIpfSxzZXRQcm9wZXJ0eTpmdW5jdGlvbigpe3Rocm93IG5ldyBFcnJvcigiTm9Nb2RpZmljYXRpb25BbGxvd2VkRXJyb3I6IERPTSBFeGNlcHRpb24gNyIpfSxnZXRQcm9wZXJ0eUNTU1ZhbHVlOmZ1bmN0aW9uKCl7dGhyb3cgbmV3IEVycm9yKCJOb3RTdXBwb3J0ZWRFcnJvcjogRE9NIEV4Y2VwdGlvbiA5Iil9fSx3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZT1XaW5kb3cucHJvdG90eXBlLmdldENvbXB1dGVkU3R5bGU9ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyByKGUpfSl9KCksT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eXx8KE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5fX3Byb3RvX198fHRoaXMuY29uc3RydWN0b3IucHJvdG90eXBlO3JldHVybiBlIGluIHRoaXMmJighKGUgaW4gdCl8fHRbZV0hPT10aGlzW2VdKX0pLGZ1bmN0aW9uKGUsdCl7ZS5hdWdtZW50PXQoKX0odGhpcyxmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijt2YXIgZT1mdW5jdGlvbigpe30sdD1BcnJheS5wcm90b3R5cGUuc2xpY2Uscj1mdW5jdGlvbihyLG4pe3ZhciBpPWUucHJvdG90eXBlPSJmdW5jdGlvbiI9PXR5cGVvZiByP3IucHJvdG90eXBlOnIsbz1uZXcgZSxhPW4uYXBwbHkobyx0LmNhbGwoYXJndW1lbnRzLDIpLmNvbmNhdChpKSk7aWYoIm9iamVjdCI9PXR5cGVvZiBhKWZvcih2YXIgbCBpbiBhKW9bbF09YVtsXTtpZighby5oYXNPd25Qcm9wZXJ0eSgiY29uc3RydWN0b3IiKSlyZXR1cm4gbzt2YXIgcz1vLmNvbnN0cnVjdG9yO3JldHVybiBzLnByb3RvdHlwZT1vLHN9O3JldHVybiByLmRlZmNsYXNzPWZ1bmN0aW9uKGUpe3ZhciB0PWUuY29uc3RydWN0b3I7cmV0dXJuIHQucHJvdG90eXBlPWUsdH0sci5leHRlbmQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gcihlLGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnViZXI9ZSx0fSl9LHJ9KSxmdW5jdGlvbihlLHQpe2Z1bmN0aW9uIHIoZSx0LHIsbyl7dmFyIGE9bihyLnN1YnN0cihyLmxhc3RJbmRleE9mKGUuZG9tYWluKSksZSk7YSYmaShudWxsLG8sYSx0KX1mdW5jdGlvbiBuKGUsdCl7Zm9yKHZhciByPXt0aGVtZTpwKEEuc2V0dGluZ3MudGhlbWVzLmdyYXksbnVsbCksc3R5bGVzaGVldHM6dC5zdHlsZXNoZWV0cyxob2xkZXJVUkw6W119LG49ITEsaT1TdHJpbmcuZnJvbUNoYXJDb2RlKDExKSxvPWUucmVwbGFjZSgvKFteXFxdKVwvL2csIiQxIitpKS5zcGxpdChpKSxhPS8lWzAtOWEtZl17Mn0vZ2ksbD1vLmxlbmd0aCxzPTA7bD5zO3MrKyl7dmFyIGQ9b1tzXTtpZihkLm1hdGNoKGEpKXRyeXtkPWRlY29kZVVSSUNvbXBvbmVudChkKX1jYXRjaChoKXtkPW9bc119dmFyIHU9ITE7aWYoQS5mbGFncy5kaW1lbnNpb25zLm1hdGNoKGQpKW49ITAsci5kaW1lbnNpb25zPUEuZmxhZ3MuZGltZW5zaW9ucy5vdXRwdXQoZCksdT0hMDtlbHNlIGlmKEEuZmxhZ3MuZmx1aWQubWF0Y2goZCkpbj0hMCxyLmRpbWVuc2lvbnM9QS5mbGFncy5mbHVpZC5vdXRwdXQoZCksci5mbHVpZD0hMCx1PSEwO2Vsc2UgaWYoQS5mbGFncy50ZXh0bW9kZS5tYXRjaChkKSlyLnRleHRtb2RlPUEuZmxhZ3MudGV4dG1vZGUub3V0cHV0KGQpLHU9ITA7ZWxzZSBpZihBLmZsYWdzLmNvbG9ycy5tYXRjaChkKSl7dmFyIGM9QS5mbGFncy5jb2xvcnMub3V0cHV0KGQpO3IudGhlbWU9cChyLnRoZW1lLGMpLHU9ITB9ZWxzZSBpZih0LnRoZW1lc1tkXSl0LnRoZW1lcy5oYXNPd25Qcm9wZXJ0eShkKSYmKHIudGhlbWU9cCh0LnRoZW1lc1tkXSxudWxsKSksdT0hMDtlbHNlIGlmKEEuZmxhZ3MuZm9udC5tYXRjaChkKSlyLmZvbnQ9QS5mbGFncy5mb250Lm91dHB1dChkKSx1PSEwO2Vsc2UgaWYoQS5mbGFncy5hdXRvLm1hdGNoKGQpKXIuYXV0bz0hMCx1PSEwO2Vsc2UgaWYoQS5mbGFncy50ZXh0Lm1hdGNoKGQpKXIudGV4dD1BLmZsYWdzLnRleHQub3V0cHV0KGQpLHU9ITA7ZWxzZSBpZihBLmZsYWdzLnJhbmRvbS5tYXRjaChkKSl7bnVsbD09QS52YXJzLmNhY2hlLnRoZW1lS2V5cyYmKEEudmFycy5jYWNoZS50aGVtZUtleXM9T2JqZWN0LmtleXModC50aGVtZXMpKTt2YXIgZj1BLnZhcnMuY2FjaGUudGhlbWVLZXlzWzB8TWF0aC5yYW5kb20oKSpBLnZhcnMuY2FjaGUudGhlbWVLZXlzLmxlbmd0aF07ci50aGVtZT1wKHQudGhlbWVzW2ZdLG51bGwpLHU9ITB9dSYmci5ob2xkZXJVUkwucHVzaChkKX1yZXR1cm4gci5ob2xkZXJVUkwudW5zaGlmdCh0LmRvbWFpbiksci5ob2xkZXJVUkw9ci5ob2xkZXJVUkwuam9pbigiLyIpLG4/cjohMX1mdW5jdGlvbiBpKGUsdCxyLG4pe3ZhciBpPXIuZGltZW5zaW9ucyxhPXIudGhlbWUsbD1pLndpZHRoKyJ4IitpLmhlaWdodDtpZihlPW51bGw9PWU/ci5mbHVpZD8iZmx1aWQiOiJpbWFnZSI6ZSxudWxsIT1yLnRleHQmJihhLnRleHQ9ci50ZXh0LCJvYmplY3QiPT09dC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSl7Zm9yKHZhciBkPWEudGV4dC5zcGxpdCgiXFxuIiksdT0wO3U8ZC5sZW5ndGg7dSsrKWRbdV09YihkW3VdKTthLnRleHQ9ZC5qb2luKCJcXG4iKX12YXIgZj1yLmhvbGRlclVSTCxnPXAobixudWxsKTtyLmZvbnQmJihhLmZvbnQ9ci5mb250LCFnLm5vRm9udEZhbGxiYWNrJiYiaW1nIj09PXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSYmQS5zZXR1cC5zdXBwb3J0c0NhbnZhcyYmInN2ZyI9PT1nLnJlbmRlcmVyJiYoZz1wKGcse3JlbmRlcmVyOiJjYW52YXMifSkpKSxyLmZvbnQmJiJjYW52YXMiPT1nLnJlbmRlcmVyJiYoZy5yZVJlbmRlcj0hMCksImJhY2tncm91bmQiPT1lP251bGw9PXQuZ2V0QXR0cmlidXRlKCJkYXRhLWJhY2tncm91bmQtc3JjIikmJmModCx7ImRhdGEtYmFja2dyb3VuZC1zcmMiOmZ9KTpjKHQseyJkYXRhLXNyYyI6Zn0pLHIudGhlbWU9YSx0LmhvbGRlckRhdGE9e2ZsYWdzOnIscmVuZGVyU2V0dGluZ3M6Z30sKCJpbWFnZSI9PWV8fCJmbHVpZCI9PWUpJiZjKHQse2FsdDphLnRleHQ/KGEudGV4dC5sZW5ndGg+MTY/YS50ZXh0LnN1YnN0cmluZygwLDE2KSsi4oCmIjphLnRleHQpKyIgWyIrbCsiXSI6bH0pLCJpbWFnZSI9PWU/KCJodG1sIiE9Zy5yZW5kZXJlciYmci5hdXRvfHwodC5zdHlsZS53aWR0aD1pLndpZHRoKyJweCIsdC5zdHlsZS5oZWlnaHQ9aS5oZWlnaHQrInB4IiksImh0bWwiPT1nLnJlbmRlcmVyP3Quc3R5bGUuYmFja2dyb3VuZENvbG9yPWEuYmFja2dyb3VuZDoobyhlLHtkaW1lbnNpb25zOmksdGhlbWU6YSxmbGFnczpyfSx0LGcpLHIudGV4dG1vZGUmJiJleGFjdCI9PXIudGV4dG1vZGUmJihBLnZhcnMucmVzaXphYmxlSW1hZ2VzLnB1c2godCkscyh0KSkpKToiYmFja2dyb3VuZCI9PWUmJiJodG1sIiE9Zy5yZW5kZXJlcj9vKGUse2RpbWVuc2lvbnM6aSx0aGVtZTphLGZsYWdzOnJ9LHQsZyk6ImZsdWlkIj09ZSYmKCIlIj09aS5oZWlnaHQuc2xpY2UoLTEpP3Quc3R5bGUuaGVpZ2h0PWkuaGVpZ2h0Om51bGwhPXIuYXV0byYmci5hdXRvfHwodC5zdHlsZS5oZWlnaHQ9aS5oZWlnaHQrInB4IiksIiUiPT1pLndpZHRoLnNsaWNlKC0xKT90LnN0eWxlLndpZHRoPWkud2lkdGg6bnVsbCE9ci5hdXRvJiZyLmF1dG98fCh0LnN0eWxlLndpZHRoPWkud2lkdGgrInB4IiksKCJpbmxpbmUiPT10LnN0eWxlLmRpc3BsYXl8fCIiPT09dC5zdHlsZS5kaXNwbGF5fHwibm9uZSI9PXQuc3R5bGUuZGlzcGxheSkmJih0LnN0eWxlLmRpc3BsYXk9ImJsb2NrIiksaCh0KSwiaHRtbCI9PWcucmVuZGVyZXI/dC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I9YS5iYWNrZ3JvdW5kOihBLnZhcnMucmVzaXphYmxlSW1hZ2VzLnB1c2godCkscyh0KSkpfWZ1bmN0aW9uIG8oZSx0LHIsbil7ZnVuY3Rpb24gaSgpe3ZhciBlPW51bGw7c3dpdGNoKG4ucmVuZGVyZXIpe2Nhc2UiY2FudmFzIjplPUwocyk7YnJlYWs7Y2FzZSJzdmciOmU9TyhzLG4pO2JyZWFrO2RlZmF1bHQ6dGhyb3ciSG9sZGVyOiBpbnZhbGlkIHJlbmRlcmVyOiAiK24ucmVuZGVyZXJ9cmV0dXJuIGV9dmFyIG89bnVsbDtzd2l0Y2gobi5yZW5kZXJlcil7Y2FzZSJzdmciOmlmKCFBLnNldHVwLnN1cHBvcnRzU1ZHKXJldHVybjticmVhaztjYXNlImNhbnZhcyI6aWYoIUEuc2V0dXAuc3VwcG9ydHNDYW52YXMpcmV0dXJuO2JyZWFrO2RlZmF1bHQ6cmV0dXJufXt2YXIgbD17d2lkdGg6dC5kaW1lbnNpb25zLndpZHRoLGhlaWdodDp0LmRpbWVuc2lvbnMuaGVpZ2h0LHRoZW1lOnQudGhlbWUsZmxhZ3M6dC5mbGFnc30scz1hKGwpOyh7dGV4dDpsLnRleHQsd2lkdGg6bC53aWR0aCxoZWlnaHQ6bC5oZWlnaHQsdGV4dEhlaWdodDpsLmZvbnQuc2l6ZSxmb250OmwuZm9udC5mYW1pbHksZm9udFdlaWdodDpsLmZvbnQud2VpZ2h0LHRlbXBsYXRlOmwudGhlbWV9KX1pZihvPWkoKSxudWxsPT1vKXRocm93IkhvbGRlcjogY291bGRuJ3QgcmVuZGVyIHBsYWNlaG9sZGVyIjsiYmFja2dyb3VuZCI9PWU/KHIuc3R5bGUuYmFja2dyb3VuZEltYWdlPSJ1cmwoIitvKyIpIixyLnN0eWxlLmJhY2tncm91bmRTaXplPWwud2lkdGgrInB4ICIrbC5oZWlnaHQrInB4Iik6KCJpbWciPT09ci5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpP2Mocix7c3JjOm99KToib2JqZWN0Ij09PXIubm9kZU5hbWUudG9Mb3dlckNhc2UoKSYmKGMocix7ZGF0YTpvfSksYyhyLHt0eXBlOiJpbWFnZS9zdmcreG1sIn0pKSxuLnJlUmVuZGVyJiZzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dmFyIGU9aSgpO2lmKG51bGw9PWUpdGhyb3ciSG9sZGVyOiBjb3VsZG4ndCByZW5kZXIgcGxhY2Vob2xkZXIiOyJpbWciPT09ci5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpP2Mocix7c3JjOmV9KToib2JqZWN0Ij09PXIubm9kZU5hbWUudG9Mb3dlckNhc2UoKSYmKGMocix7ZGF0YTplfSksYyhyLHt0eXBlOiJpbWFnZS9zdmcreG1sIn0pKX0sMTAwKSksYyhyLHsiZGF0YS1ob2xkZXItcmVuZGVyZWQiOiEwfSl9ZnVuY3Rpb24gYShlKXtmdW5jdGlvbiB0KGUsdCxyLG4pe3Qud2lkdGg9cix0LmhlaWdodD1uLGUud2lkdGg9TWF0aC5tYXgoZS53aWR0aCx0LndpZHRoKSxlLmhlaWdodCs9dC5oZWlnaHQsZS5hZGQodCl9c3dpdGNoKGUuZm9udD17ZmFtaWx5OmUudGhlbWUuZm9udD9lLnRoZW1lLmZvbnQ6IkFyaWFsLCBIZWx2ZXRpY2EsIE9wZW4gU2Fucywgc2Fucy1zZXJpZiIsc2l6ZTpsKGUud2lkdGgsZS5oZWlnaHQsZS50aGVtZS5zaXplP2UudGhlbWUuc2l6ZToxMiksd2VpZ2h0OmUudGhlbWUuZm9udHdlaWdodD9lLnRoZW1lLmZvbnR3ZWlnaHQ6ImJvbGQifSxlLnRleHQ9ZS50aGVtZS50ZXh0P2UudGhlbWUudGV4dDpNYXRoLmZsb29yKGUud2lkdGgpKyJ4IitNYXRoLmZsb29yKGUuaGVpZ2h0KSxlLmZsYWdzLnRleHRtb2RlKXtjYXNlImxpdGVyYWwiOmUudGV4dD1lLmZsYWdzLmRpbWVuc2lvbnMud2lkdGgrIngiK2UuZmxhZ3MuZGltZW5zaW9ucy5oZWlnaHQ7YnJlYWs7Y2FzZSJleGFjdCI6aWYoIWUuZmxhZ3MuZXhhY3REaW1lbnNpb25zKWJyZWFrO2UudGV4dD1NYXRoLmZsb29yKGUuZmxhZ3MuZXhhY3REaW1lbnNpb25zLndpZHRoKSsieCIrTWF0aC5mbG9vcihlLmZsYWdzLmV4YWN0RGltZW5zaW9ucy5oZWlnaHQpfXZhciByPW5ldyBGKHt3aWR0aDplLndpZHRoLGhlaWdodDplLmhlaWdodH0pLG49ci5TaGFwZSxpPW5ldyBuLlJlY3QoImhvbGRlckJnIix7ZmlsbDplLnRoZW1lLmJhY2tncm91bmR9KTtpLnJlc2l6ZShlLndpZHRoLGUuaGVpZ2h0KSxyLnJvb3QuYWRkKGkpO3ZhciBvPW5ldyBuLkdyb3VwKCJob2xkZXJUZXh0R3JvdXAiLHt0ZXh0OmUudGV4dCxhbGlnbjoiY2VudGVyIixmb250OmUuZm9udCxmaWxsOmUudGhlbWUuZm9yZWdyb3VuZH0pO28ubW92ZVRvKG51bGwsbnVsbCwxKSxyLnJvb3QuYWRkKG8pO3ZhciBhPW8udGV4dFBvc2l0aW9uRGF0YT1UKHIpO2lmKCFhKXRocm93IkhvbGRlcjogc3RhZ2luZyBmYWxsYmFjayBub3Qgc3VwcG9ydGVkIHlldC4iO28ucHJvcGVydGllcy5sZWFkaW5nPWEuYm91bmRpbmdCb3guaGVpZ2h0O3ZhciBzPW51bGwsZD1udWxsO2lmKGEubGluZUNvdW50PjEpe3ZhciBoPTAsdT0wLGM9ZS53aWR0aCpBLnNldHVwLmxpbmVXcmFwUmF0aW8sZj0wO2Q9bmV3IG4uR3JvdXAoImxpbmUiK2YpO2Zvcih2YXIgZz0wO2c8YS53b3Jkcy5sZW5ndGg7ZysrKXt2YXIgcD1hLndvcmRzW2ddO3M9bmV3IG4uVGV4dChwLnRleHQpO3ZhciBtPSJcXG4iPT1wLnRleHQ7KGgrcC53aWR0aD49Y3x8bT09PSEwKSYmKHQobyxkLGgsby5wcm9wZXJ0aWVzLmxlYWRpbmcpLGg9MCx1Kz1vLnByb3BlcnRpZXMubGVhZGluZyxmKz0xLGQ9bmV3IG4uR3JvdXAoImxpbmUiK2YpLGQueT11KSxtIT09ITAmJihzLm1vdmVUbyhoLDApLGgrPWEuc3BhY2VXaWR0aCtwLndpZHRoLGQuYWRkKHMpKX10KG8sZCxoLG8ucHJvcGVydGllcy5sZWFkaW5nKTtmb3IodmFyIHYgaW4gby5jaGlsZHJlbilkPW8uY2hpbGRyZW5bdl0sZC5tb3ZlVG8oKG8ud2lkdGgtZC53aWR0aCkvMixudWxsLG51bGwpO28ubW92ZVRvKChlLndpZHRoLW8ud2lkdGgpLzIsKGUuaGVpZ2h0LW8uaGVpZ2h0KS8yLG51bGwpLChlLmhlaWdodC1vLmhlaWdodCkvMjwwJiZvLm1vdmVUbyhudWxsLDAsbnVsbCl9ZWxzZSBzPW5ldyBuLlRleHQoZS50ZXh0KSxkPW5ldyBuLkdyb3VwKCJsaW5lMCIpLGQuYWRkKHMpLG8uYWRkKGQpLG8ubW92ZVRvKChlLndpZHRoLWEuYm91bmRpbmdCb3gud2lkdGgpLzIsKGUuaGVpZ2h0LWEuYm91bmRpbmdCb3guaGVpZ2h0KS8yLG51bGwpO3JldHVybiByfWZ1bmN0aW9uIGwoZSx0LHIpe3Q9cGFyc2VJbnQodCwxMCksZT1wYXJzZUludChlLDEwKTt2YXIgbj1NYXRoLm1heCh0LGUpLGk9TWF0aC5taW4odCxlKSxvPTEvMTIsYT1NYXRoLm1pbiguNzUqaSwuNzUqbipvKTtyZXR1cm4gTWF0aC5yb3VuZChNYXRoLm1heChyLGEpKX1mdW5jdGlvbiBzKGUpe3ZhciB0O3Q9bnVsbD09ZXx8bnVsbD09ZS5ub2RlVHlwZT9BLnZhcnMucmVzaXphYmxlSW1hZ2VzOltlXTtmb3IodmFyIHIgaW4gdClpZih0Lmhhc093blByb3BlcnR5KHIpKXt2YXIgbj10W3JdO2lmKG4uaG9sZGVyRGF0YSl7dmFyIGk9bi5ob2xkZXJEYXRhLmZsYWdzLGE9ZChuLGsuaW52aXNpYmxlRXJyb3JGbihzKSk7aWYoYSl7aWYoaS5mbHVpZCYmaS5hdXRvKXt2YXIgbD1uLmhvbGRlckRhdGEuZmx1aWRDb25maWc7c3dpdGNoKGwubW9kZSl7Y2FzZSJ3aWR0aCI6YS5oZWlnaHQ9YS53aWR0aC9sLnJhdGlvO2JyZWFrO2Nhc2UiaGVpZ2h0IjphLndpZHRoPWEuaGVpZ2h0KmwucmF0aW99fXZhciBoPXtkaW1lbnNpb25zOmEsdGhlbWU6aS50aGVtZSxmbGFnczppfTtpLnRleHRtb2RlJiYiZXhhY3QiPT1pLnRleHRtb2RlJiYoaS5leGFjdERpbWVuc2lvbnM9YSxoLmRpbWVuc2lvbnM9aS5kaW1lbnNpb25zKSxvKCJpbWFnZSIsaCxuLG4uaG9sZGVyRGF0YS5yZW5kZXJTZXR0aW5ncyl9fX19ZnVuY3Rpb24gZChlLHQpe3ZhciByPXtoZWlnaHQ6ZS5jbGllbnRIZWlnaHQsd2lkdGg6ZS5jbGllbnRXaWR0aH07cmV0dXJuIHIuaGVpZ2h0fHxyLndpZHRoPyhlLnJlbW92ZUF0dHJpYnV0ZSgiZGF0YS1ob2xkZXItaW52aXNpYmxlIikscik6KGMoZSx7ImRhdGEtaG9sZGVyLWludmlzaWJsZSI6ITB9KSx2b2lkIHQuY2FsbCh0aGlzLGUpKX1mdW5jdGlvbiBoKGUpe2lmKGUuaG9sZGVyRGF0YSl7dmFyIHQ9ZChlLGsuaW52aXNpYmxlRXJyb3JGbihoKSk7aWYodCl7dmFyIHI9ZS5ob2xkZXJEYXRhLmZsYWdzLG49e2ZsdWlkSGVpZ2h0OiIlIj09ci5kaW1lbnNpb25zLmhlaWdodC5zbGljZSgtMSksZmx1aWRXaWR0aDoiJSI9PXIuZGltZW5zaW9ucy53aWR0aC5zbGljZSgtMSksbW9kZTpudWxsLGluaXRpYWxEaW1lbnNpb25zOnR9O24uZmx1aWRXaWR0aCYmIW4uZmx1aWRIZWlnaHQ/KG4ubW9kZT0id2lkdGgiLG4ucmF0aW89bi5pbml0aWFsRGltZW5zaW9ucy53aWR0aC9wYXJzZUZsb2F0KHIuZGltZW5zaW9ucy5oZWlnaHQpKTohbi5mbHVpZFdpZHRoJiZuLmZsdWlkSGVpZ2h0JiYobi5tb2RlPSJoZWlnaHQiLG4ucmF0aW89cGFyc2VGbG9hdChyLmRpbWVuc2lvbnMud2lkdGgpL24uaW5pdGlhbERpbWVuc2lvbnMuaGVpZ2h0KSxlLmhvbGRlckRhdGEuZmx1aWRDb25maWc9bn19fWZ1bmN0aW9uIHUoZSx0KXtyZXR1cm4gbnVsbD09dD9FLmNyZWF0ZUVsZW1lbnQoZSk6RS5jcmVhdGVFbGVtZW50TlModCxlKX1mdW5jdGlvbiBjKGUsdCl7Zm9yKHZhciByIGluIHQpZS5zZXRBdHRyaWJ1dGUocix0W3JdKX1mdW5jdGlvbiBmKGUsdCxyKXtpZihudWxsPT1lKXtlPXUoInN2ZyIsQyk7dmFyIG49dSgiZGVmcyIsQyk7ZS5hcHBlbmRDaGlsZChuKX1yZXR1cm4gZS53ZWJraXRNYXRjaGVzU2VsZWN0b3ImJmUuc2V0QXR0cmlidXRlKCJ4bWxucyIsQyksYyhlLHt3aWR0aDp0LGhlaWdodDpyLHZpZXdCb3g6IjAgMCAiK3QrIiAiK3IscHJlc2VydmVBc3BlY3RSYXRpbzoibm9uZSJ9KSxlfWZ1bmN0aW9uIGcoZSxyKXtpZih0LlhNTFNlcmlhbGl6ZXIpe3t2YXIgbj1uZXcgWE1MU2VyaWFsaXplcixpPSIiLG89ci5zdHlsZXNoZWV0cztlLnF1ZXJ5U2VsZWN0b3IoImRlZnMiKX1pZihyLnN2Z1hNTFN0eWxlc2hlZXQpe2Zvcih2YXIgYT0obmV3IERPTVBhcnNlcikucGFyc2VGcm9tU3RyaW5nKCI8eG1sIC8+IiwiYXBwbGljYXRpb24veG1sIiksbD1vLmxlbmd0aC0xO2w+PTA7bC0tKXt2YXIgcz1hLmNyZWF0ZVByb2Nlc3NpbmdJbnN0cnVjdGlvbigieG1sLXN0eWxlc2hlZXQiLCdocmVmPSInK29bbF0rJyIgcmVsPSJzdHlsZXNoZWV0IicpO2EuaW5zZXJ0QmVmb3JlKHMsYS5maXJzdENoaWxkKX12YXIgZD1hLmNyZWF0ZVByb2Nlc3NpbmdJbnN0cnVjdGlvbigieG1sIiwndmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyInKTthLmluc2VydEJlZm9yZShkLGEuZmlyc3RDaGlsZCksYS5yZW1vdmVDaGlsZChhLmRvY3VtZW50RWxlbWVudCksaT1uLnNlcmlhbGl6ZVRvU3RyaW5nKGEpfXZhciBoPW4uc2VyaWFsaXplVG9TdHJpbmcoZSk7cmV0dXJuIGg9aC5yZXBsYWNlKC9cJmFtcDsoXCNbMC05XXsyLH1cOykvZywiJiQxIiksaStofX1mdW5jdGlvbiBwKGUsdCl7dmFyIHI9e307Zm9yKHZhciBuIGluIGUpZS5oYXNPd25Qcm9wZXJ0eShuKSYmKHJbbl09ZVtuXSk7aWYobnVsbCE9dClmb3IodmFyIGkgaW4gdCl0Lmhhc093blByb3BlcnR5KGkpJiYocltpXT10W2ldKTtyZXR1cm4gcn1mdW5jdGlvbiBtKGUpe3ZhciB0PVtdO2Zvcih2YXIgciBpbiBlKWUuaGFzT3duUHJvcGVydHkocikmJnQucHVzaChyKyI6IitlW3JdKTtyZXR1cm4gdC5qb2luKCI7Iil9ZnVuY3Rpb24gdihlKXtBLnZhcnMuZGVib3VuY2VUaW1lcnx8ZS5jYWxsKHRoaXMpLEEudmFycy5kZWJvdW5jZVRpbWVyJiZjbGVhclRpbWVvdXQoQS52YXJzLmRlYm91bmNlVGltZXIpLEEudmFycy5kZWJvdW5jZVRpbWVyPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtBLnZhcnMuZGVib3VuY2VUaW1lcj1udWxsLGUuY2FsbCh0aGlzKX0sQS5zZXR1cC5kZWJvdW5jZSl9ZnVuY3Rpb24geCgpe3YoZnVuY3Rpb24oKXtzKG51bGwpfSl9ZnVuY3Rpb24geShlKXt2YXIgcj1udWxsO3JldHVybiJzdHJpbmciPT10eXBlb2YgZT9yPUUucXVlcnlTZWxlY3RvckFsbChlKTp0Lk5vZGVMaXN0JiZlIGluc3RhbmNlb2YgdC5Ob2RlTGlzdD9yPWU6dC5Ob2RlJiZlIGluc3RhbmNlb2YgdC5Ob2RlP3I9W2VdOnQuSFRNTENvbGxlY3Rpb24mJmUgaW5zdGFuY2VvZiB0LkhUTUxDb2xsZWN0aW9uP3I9ZTpudWxsPT09ZSYmKHI9W10pLHJ9ZnVuY3Rpb24gdyhlLHQpe3ZhciByPW5ldyBJbWFnZTtyLm9uZXJyb3I9ZnVuY3Rpb24oKXt0LmNhbGwodGhpcywhMSxlKX0sci5vbmxvYWQ9ZnVuY3Rpb24oKXt0LmNhbGwodGhpcywhMCxlKX0sci5zcmM9ZS5zcmN9ZnVuY3Rpb24gYihlKXtmb3IodmFyIHQ9W10scj0wLG49ZS5sZW5ndGgtMTtuPj0wO24tLSlyPWVbbl0uY2hhckNvZGVBdCgpLHQudW5zaGlmdChyPjEyOD9bIiYjIixyLCI7Il0uam9pbigiIik6ZVtuXSk7cmV0dXJuIHQuam9pbigiIil9ZnVuY3Rpb24gUyhlKXtyZXR1cm4gZS5yZXBsYWNlKC8mIyhcZCspOy9nLGZ1bmN0aW9uKGUsdCl7cmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUodCl9KX12YXIgQz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLEU9dC5kb2N1bWVudCxrPXthZGRUaGVtZTpmdW5jdGlvbihlLHQpe3JldHVybiBudWxsIT1lJiZudWxsIT10JiYoQS5zZXR0aW5ncy50aGVtZXNbZV09dCksZGVsZXRlIEEudmFycy5jYWNoZS50aGVtZUtleXMsdGhpc30sYWRkSW1hZ2U6ZnVuY3Rpb24oZSx0KXt2YXIgcj1FLnF1ZXJ5U2VsZWN0b3JBbGwodCk7aWYoci5sZW5ndGgpZm9yKHZhciBuPTAsaT1yLmxlbmd0aDtpPm47bisrKXt2YXIgbz11KCJpbWciKTtjKG8seyJkYXRhLXNyYyI6ZX0pLHJbbl0uYXBwZW5kQ2hpbGQobyl9cmV0dXJuIHRoaXN9LHJ1bjpmdW5jdGlvbihlKXtlPWV8fHt9O3ZhciBvPXt9O0EudmFycy5wcmVlbXB0ZWQ9ITA7dmFyIGE9cChBLnNldHRpbmdzLGUpO28ucmVuZGVyZXI9YS5yZW5kZXJlcj9hLnJlbmRlcmVyOkEuc2V0dXAucmVuZGVyZXIsLTE9PT1BLnNldHVwLnJlbmRlcmVycy5qb2luKCIsIikuaW5kZXhPZihvLnJlbmRlcmVyKSYmKG8ucmVuZGVyZXI9QS5zZXR1cC5zdXBwb3J0c1NWRz8ic3ZnIjpBLnNldHVwLnN1cHBvcnRzQ2FudmFzPyJjYW52YXMiOiJodG1sIiksYS51c2VfY2FudmFzP28ucmVuZGVyZXI9ImNhbnZhcyI6YS51c2Vfc3ZnJiYoby5yZW5kZXJlcj0ic3ZnIik7dmFyIGw9eShhLmltYWdlcykscz15KGEuYmdub2RlcyksZD15KGEuc3R5bGVub2RlcyksaD15KGEub2JqZWN0cyk7by5zdHlsZXNoZWV0cz1bXSxvLnN2Z1hNTFN0eWxlc2hlZXQ9ITAsby5ub0ZvbnRGYWxsYmFjaz1hLm5vRm9udEZhbGxiYWNrP2Eubm9Gb250RmFsbGJhY2s6ITE7Zm9yKHZhciBjPTA7YzxkLmxlbmd0aDtjKyspe3ZhciBmPWRbY107aWYoZi5hdHRyaWJ1dGVzLnJlbCYmZi5hdHRyaWJ1dGVzLmhyZWYmJiJzdHlsZXNoZWV0Ij09Zi5hdHRyaWJ1dGVzLnJlbC52YWx1ZSl7dmFyIGc9Zi5hdHRyaWJ1dGVzLmhyZWYudmFsdWUsbT11KCJhIik7bS5ocmVmPWc7dmFyIHY9bS5wcm90b2NvbCsiLy8iK20uaG9zdCttLnBhdGhuYW1lK20uc2VhcmNoO28uc3R5bGVzaGVldHMucHVzaCh2KX19Zm9yKGM9MDtjPHMubGVuZ3RoO2MrKyl7dmFyIHg9dC5nZXRDb21wdXRlZFN0eWxlKHNbY10sbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZSgiYmFja2dyb3VuZC1pbWFnZSIpLGI9c1tjXS5nZXRBdHRyaWJ1dGUoImRhdGEtYmFja2dyb3VuZC1zcmMiKSxTPW51bGw7Uz1udWxsPT1iP3g6Yjt2YXIgQz1udWxsLEU9Ij8iK2EuZG9tYWluKyIvIjtpZigwPT09Uy5pbmRleE9mKEUpKUM9Uy5zbGljZSgxKTtlbHNlIGlmKC0xIT1TLmluZGV4T2YoRSkpe3ZhciBrPVMuc3Vic3RyKFMuaW5kZXhPZihFKSkuc2xpY2UoMSksVD1rLm1hdGNoKC8oW15cIl0qKSI/XCkvKTtudWxsIT1UJiYoQz1UWzFdKX1pZihudWxsIT1DKXt2YXIgTD1uKEMsYSk7TCYmaSgiYmFja2dyb3VuZCIsc1tjXSxMLG8pfX1mb3IoYz0wO2M8aC5sZW5ndGg7YysrKXt2YXIgTz1oW2NdLEY9e307dHJ5e0YuZGF0YT1PLmdldEF0dHJpYnV0ZSgiZGF0YSIpLEYuZGF0YVNyYz1PLmdldEF0dHJpYnV0ZSgiZGF0YS1zcmMiKX1jYXRjaCh6KXt9dmFyIE09bnVsbCE9Ri5kYXRhJiYwPT09Ri5kYXRhLmluZGV4T2YoYS5kb21haW4pLEQ9bnVsbCE9Ri5kYXRhU3JjJiYwPT09Ri5kYXRhU3JjLmluZGV4T2YoYS5kb21haW4pO00/cihhLG8sRi5kYXRhLE8pOkQmJnIoYSxvLEYuZGF0YVNyYyxPKX1mb3IoYz0wO2M8bC5sZW5ndGg7YysrKXt2YXIgUj1sW2NdLGo9e307dHJ5e2ouc3JjPVIuZ2V0QXR0cmlidXRlKCJzcmMiKSxqLmRhdGFTcmM9Ui5nZXRBdHRyaWJ1dGUoImRhdGEtc3JjIiksai5yZW5kZXJlZD1SLmdldEF0dHJpYnV0ZSgiZGF0YS1ob2xkZXItcmVuZGVyZWQiKX1jYXRjaCh6KXt9dmFyIEI9bnVsbCE9ai5zcmMsUD1udWxsIT1qLmRhdGFTcmMmJjA9PT1qLmRhdGFTcmMuaW5kZXhPZihhLmRvbWFpbiksTj1udWxsIT1qLnJlbmRlcmVkJiYidHJ1ZSI9PWoucmVuZGVyZWQ7Qj8wPT09ai5zcmMuaW5kZXhPZihhLmRvbWFpbik/cihhLG8sai5zcmMsUik6UCYmKE4/cihhLG8sai5kYXRhU3JjLFIpOncoe3NyYzpqLnNyYyxvcHRpb25zOmEscmVuZGVyU2V0dGluZ3M6byxkYXRhU3JjOmouZGF0YVNyYyxpbWFnZTpSfSxmdW5jdGlvbihlLHQpe2V8fHIodC5vcHRpb25zLHQucmVuZGVyU2V0dGluZ3MsdC5kYXRhU3JjLHQuaW1hZ2UpfSkpOlAmJnIoYSxvLGouZGF0YVNyYyxSKX1yZXR1cm4gdGhpc30saW52aXNpYmxlRXJyb3JGbjpmdW5jdGlvbigpe3JldHVybiBmdW5jdGlvbihlKXtpZihlLmhhc0F0dHJpYnV0ZSgiZGF0YS1ob2xkZXItaW52aXNpYmxlIikpdGhyb3ciSG9sZGVyOiBpbnZpc2libGUgcGxhY2Vob2xkZXIifX19O2suYWRkX3RoZW1lPWsuYWRkVGhlbWUsay5hZGRfaW1hZ2U9ay5hZGRJbWFnZSxrLmludmlzaWJsZV9lcnJvcl9mbj1rLmludmlzaWJsZUVycm9yRm47dmFyIEE9e3NldHRpbmdzOntkb21haW46ImhvbGRlci5qcyIsaW1hZ2VzOiJpbWciLG9iamVjdHM6Im9iamVjdCIsYmdub2RlczoiYm9keSAuaG9sZGVyanMiLHN0eWxlbm9kZXM6ImhlYWQgbGluay5ob2xkZXJqcyIsc3R5bGVzaGVldHM6W10sdGhlbWVzOntncmF5OntiYWNrZ3JvdW5kOiIjRUVFRUVFIixmb3JlZ3JvdW5kOiIjQUFBQUFBIn0sc29jaWFsOntiYWNrZ3JvdW5kOiIjM2E1YTk3Iixmb3JlZ3JvdW5kOiIjRkZGRkZGIn0saW5kdXN0cmlhbDp7YmFja2dyb3VuZDoiIzQzNEE1MiIsZm9yZWdyb3VuZDoiI0MyRjIwMCJ9LHNreTp7YmFja2dyb3VuZDoiIzBEOEZEQiIsZm9yZWdyb3VuZDoiI0ZGRkZGRiJ9LHZpbmU6e2JhY2tncm91bmQ6IiMzOURCQUMiLGZvcmVncm91bmQ6IiMxRTI5MkMifSxsYXZhOntiYWNrZ3JvdW5kOiIjRjg1OTFBIixmb3JlZ3JvdW5kOiIjMUMyODQ2IixzaXplOjEyfX19LGZsYWdzOntkaW1lbnNpb25zOntyZWdleDovXihcZCspeChcZCspJC8sb3V0cHV0OmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMucmVnZXguZXhlYyhlKTtyZXR1cm57d2lkdGg6K3RbMV0saGVpZ2h0Oit0WzJdfX19LGZsdWlkOntyZWdleDovXihbMC05XSslPyl4KFswLTldKyU/KSQvLG91dHB1dDpmdW5jdGlvbihlKXt2YXIgdD10aGlzLnJlZ2V4LmV4ZWMoZSk7cmV0dXJue3dpZHRoOnRbMV0saGVpZ2h0OnRbMl19fX0sY29sb3JzOntyZWdleDovKD86I3xcXikoWzAtOWEtZl17Myx9KVw6KD86I3xcXikoWzAtOWEtZl17Myx9KS9pLG91dHB1dDpmdW5jdGlvbihlKXt2YXIgdD10aGlzLnJlZ2V4LmV4ZWMoZSk7cmV0dXJue2ZvcmVncm91bmQ6IiMiK3RbMl0sYmFja2dyb3VuZDoiIyIrdFsxXX19fSx0ZXh0OntyZWdleDovdGV4dFw6KC4qKS8sb3V0cHV0OmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJlZ2V4LmV4ZWMoZSlbMV0ucmVwbGFjZSgiXFwvIiwiLyIpfX0sZm9udDp7cmVnZXg6L2ZvbnRcOiguKikvLG91dHB1dDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5yZWdleC5leGVjKGUpWzFdfX0sYXV0bzp7cmVnZXg6L15hdXRvJC99LHRleHRtb2RlOntyZWdleDovdGV4dG1vZGVcOiguKikvLG91dHB1dDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5yZWdleC5leGVjKGUpWzFdfX0scmFuZG9tOntyZWdleDovXnJhbmRvbSQvfX19LFQ9ZnVuY3Rpb24oKXt2YXIgZT1udWxsLHQ9bnVsbCxyPW51bGw7cmV0dXJuIGZ1bmN0aW9uKG4pe3ZhciBpPW4ucm9vdDtpZihBLnNldHVwLnN1cHBvcnRzU1ZHKXt2YXIgbz0hMSxhPWZ1bmN0aW9uKGUpe3JldHVybiBFLmNyZWF0ZVRleHROb2RlKGUpfTtudWxsPT1lJiYobz0hMCksZT1mKGUsaS5wcm9wZXJ0aWVzLndpZHRoLGkucHJvcGVydGllcy5oZWlnaHQpLG8mJih0PXUoInRleHQiLEMpLHI9YShudWxsKSxjKHQse3g6MH0pLHQuYXBwZW5kQ2hpbGQociksZS5hcHBlbmRDaGlsZCh0KSxFLmJvZHkuYXBwZW5kQ2hpbGQoZSksZS5zdHlsZS52aXNpYmlsaXR5PSJoaWRkZW4iLGUuc3R5bGUucG9zaXRpb249ImFic29sdXRlIixlLnN0eWxlLnRvcD0iLTEwMCUiLGUuc3R5bGUubGVmdD0iLTEwMCUiKTt2YXIgbD1pLmNoaWxkcmVuLmhvbGRlclRleHRHcm91cCxzPWwucHJvcGVydGllcztjKHQse3k6cy5mb250LnNpemUsc3R5bGU6bSh7ImZvbnQtd2VpZ2h0IjpzLmZvbnQud2VpZ2h0LCJmb250LXNpemUiOnMuZm9udC5zaXplKyJweCIsImZvbnQtZmFtaWx5IjpzLmZvbnQuZmFtaWx5LCJkb21pbmFudC1iYXNlbGluZSI6Im1pZGRsZSJ9KX0pLHIubm9kZVZhbHVlPXMudGV4dDt2YXIgZD10LmdldEJCb3goKSxoPU1hdGguY2VpbChkLndpZHRoLyhpLnByb3BlcnRpZXMud2lkdGgqQS5zZXR1cC5saW5lV3JhcFJhdGlvKSksZz1zLnRleHQuc3BsaXQoIiAiKSxwPXMudGV4dC5tYXRjaCgvXFxuL2cpO2grPW51bGw9PXA/MDpwLmxlbmd0aCxyLm5vZGVWYWx1ZT1zLnRleHQucmVwbGFjZSgvWyBdKy9nLCIiKTt2YXIgdj10LmdldENvbXB1dGVkVGV4dExlbmd0aCgpLHg9ZC53aWR0aC12LHk9TWF0aC5yb3VuZCh4L01hdGgubWF4KDEsZy5sZW5ndGgtMSkpLHc9W107aWYoaD4xKXtyLm5vZGVWYWx1ZT0iIjtmb3IodmFyIGI9MDtiPGcubGVuZ3RoO2IrKylpZigwIT09Z1tiXS5sZW5ndGgpe3Iubm9kZVZhbHVlPVMoZ1tiXSk7dmFyIGs9dC5nZXRCQm94KCk7dy5wdXNoKHt0ZXh0OmdbYl0sd2lkdGg6ay53aWR0aH0pfX1yZXR1cm57c3BhY2VXaWR0aDp5LGxpbmVDb3VudDpoLGJvdW5kaW5nQm94OmQsd29yZHM6d319cmV0dXJuITF9fSgpLEw9ZnVuY3Rpb24oKXt2YXIgZT11KCJjYW52YXMiKSx0PW51bGw7cmV0dXJuIGZ1bmN0aW9uKHIpe251bGw9PXQmJih0PWUuZ2V0Q29udGV4dCgiMmQiKSk7dmFyIG49ci5yb290O2Uud2lkdGg9QS5kcHIobi5wcm9wZXJ0aWVzLndpZHRoKSxlLmhlaWdodD1BLmRwcihuLnByb3BlcnRpZXMuaGVpZ2h0KSx0LnRleHRCYXNlbGluZT0ibWlkZGxlIix0LmZpbGxTdHlsZT1uLmNoaWxkcmVuLmhvbGRlckJnLnByb3BlcnRpZXMuZmlsbCx0LmZpbGxSZWN0KDAsMCxBLmRwcihuLmNoaWxkcmVuLmhvbGRlckJnLndpZHRoKSxBLmRwcihuLmNoaWxkcmVuLmhvbGRlckJnLmhlaWdodCkpO3t2YXIgaT1uLmNoaWxkcmVuLmhvbGRlclRleHRHcm91cDtpLnByb3BlcnRpZXN9dC5mb250PWkucHJvcGVydGllcy5mb250LndlaWdodCsiICIrQS5kcHIoaS5wcm9wZXJ0aWVzLmZvbnQuc2l6ZSkrInB4ICIraS5wcm9wZXJ0aWVzLmZvbnQuZmFtaWx5KyIsIG1vbm9zcGFjZSIsdC5maWxsU3R5bGU9aS5wcm9wZXJ0aWVzLmZpbGw7Zm9yKHZhciBvIGluIGkuY2hpbGRyZW4pe3ZhciBhPWkuY2hpbGRyZW5bb107Zm9yKHZhciBsIGluIGEuY2hpbGRyZW4pe3ZhciBzPWEuY2hpbGRyZW5bbF0sZD1BLmRwcihpLngrYS54K3MueCksaD1BLmRwcihpLnkrYS55K3MueStpLnByb3BlcnRpZXMubGVhZGluZy8yKTt0LmZpbGxUZXh0KHMucHJvcGVydGllcy50ZXh0LGQsaCl9fXJldHVybiBlLnRvRGF0YVVSTCgiaW1hZ2UvcG5nIil9fSgpLE89ZnVuY3Rpb24oKXtpZih0LlhNTFNlcmlhbGl6ZXIpe3ZhciBlPWYobnVsbCwwLDApLHI9dSgicmVjdCIsQyk7cmV0dXJuIGUuYXBwZW5kQ2hpbGQociksZnVuY3Rpb24odCxuKXt2YXIgaT10LnJvb3Q7ZihlLGkucHJvcGVydGllcy53aWR0aCxpLnByb3BlcnRpZXMuaGVpZ2h0KTtmb3IodmFyIG89ZS5xdWVyeVNlbGVjdG9yQWxsKCJnIiksYT0wO2E8by5sZW5ndGg7YSsrKW9bYV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvW2FdKTtjKHIse3dpZHRoOmkuY2hpbGRyZW4uaG9sZGVyQmcud2lkdGgsaGVpZ2h0OmkuY2hpbGRyZW4uaG9sZGVyQmcuaGVpZ2h0LGZpbGw6aS5jaGlsZHJlbi5ob2xkZXJCZy5wcm9wZXJ0aWVzLmZpbGx9KTt2YXIgbD1pLmNoaWxkcmVuLmhvbGRlclRleHRHcm91cCxzPWwucHJvcGVydGllcyxkPXUoImciLEMpO2UuYXBwZW5kQ2hpbGQoZCk7Zm9yKHZhciBoIGluIGwuY2hpbGRyZW4pe3ZhciBwPWwuY2hpbGRyZW5baF07Zm9yKHZhciB2IGluIHAuY2hpbGRyZW4pe3ZhciB4PXAuY2hpbGRyZW5bdl0seT1sLngrcC54K3gueCx3PWwueStwLnkreC55K2wucHJvcGVydGllcy5sZWFkaW5nLzIsYj11KCJ0ZXh0IixDKSxTPUUuY3JlYXRlVGV4dE5vZGUobnVsbCk7YyhiLHt4OnkseTp3LHN0eWxlOm0oe2ZpbGw6cy5maWxsLCJmb250LXdlaWdodCI6cy5mb250LndlaWdodCwiZm9udC1mYW1pbHkiOnMuZm9udC5mYW1pbHkrIiwgbW9ub3NwYWNlIiwiZm9udC1zaXplIjpzLmZvbnQuc2l6ZSsicHgiLCJkb21pbmFudC1iYXNlbGluZSI6ImNlbnRyYWwifSl9KSxTLm5vZGVWYWx1ZT14LnByb3BlcnRpZXMudGV4dCxiLmFwcGVuZENoaWxkKFMpLGQuYXBwZW5kQ2hpbGQoYil9fXZhciBrPSJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCIrYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoZyhlLG4pKSkpO3JldHVybiBrfX19KCksRj1mdW5jdGlvbihlKXtmdW5jdGlvbiB0KGUsdCl7Zm9yKHZhciByIGluIHQpZVtyXT10W3JdO3JldHVybiBlfXZhciByPTEsbj1hdWdtZW50LmRlZmNsYXNzKHtjb25zdHJ1Y3RvcjpmdW5jdGlvbihlKXtyKyssdGhpcy5wYXJlbnQ9bnVsbCx0aGlzLmNoaWxkcmVuPXt9LHRoaXMuaWQ9cix0aGlzLm5hbWU9Im4iK3IsbnVsbCE9ZSYmKHRoaXMubmFtZT1lKSx0aGlzLng9MCx0aGlzLnk9MCx0aGlzLno9MCx0aGlzLndpZHRoPTAsdGhpcy5oZWlnaHQ9MH0scmVzaXplOmZ1bmN0aW9uKGUsdCl7bnVsbCE9ZSYmKHRoaXMud2lkdGg9ZSksbnVsbCE9dCYmKHRoaXMuaGVpZ2h0PXQpfSxtb3ZlVG86ZnVuY3Rpb24oZSx0LHIpe3RoaXMueD1udWxsIT1lP2U6dGhpcy54LHRoaXMueT1udWxsIT10P3Q6dGhpcy55LHRoaXMuej1udWxsIT1yP3I6dGhpcy56fSxhZGQ6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5uYW1lO2lmKG51bGwhPXRoaXMuY2hpbGRyZW5bdF0pdGhyb3ciU2NlbmVHcmFwaDogY2hpbGQgd2l0aCB0aGF0IG5hbWUgYWxyZWFkeSBleGlzdHM6ICIrdDt0aGlzLmNoaWxkcmVuW3RdPWUsZS5wYXJlbnQ9dGhpc319KSxpPWF1Z21lbnQobixmdW5jdGlvbih0KXt0aGlzLmNvbnN0cnVjdG9yPWZ1bmN0aW9uKCl7dC5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsInJvb3QiKSx0aGlzLnByb3BlcnRpZXM9ZX19KSxvPWF1Z21lbnQobixmdW5jdGlvbihlKXtmdW5jdGlvbiByKHIsbil7aWYoZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsciksdGhpcy5wcm9wZXJ0aWVzPXtmaWxsOiIjMDAwIn0sbnVsbCE9bil0KHRoaXMucHJvcGVydGllcyxuKTtlbHNlIGlmKG51bGwhPXImJiJzdHJpbmciIT10eXBlb2Ygcil0aHJvdyJTY2VuZUdyYXBoOiBpbnZhbGlkIG5vZGUgbmFtZSJ9dGhpcy5Hcm91cD1hdWdtZW50LmV4dGVuZCh0aGlzLHtjb25zdHJ1Y3RvcjpyLHR5cGU6Imdyb3VwIn0pLHRoaXMuUmVjdD1hdWdtZW50LmV4dGVuZCh0aGlzLHtjb25zdHJ1Y3RvcjpyLHR5cGU6InJlY3QifSksdGhpcy5UZXh0PWF1Z21lbnQuZXh0ZW5kKHRoaXMse2NvbnN0cnVjdG9yOmZ1bmN0aW9uKGUpe3IuY2FsbCh0aGlzKSx0aGlzLnByb3BlcnRpZXMudGV4dD1lfSx0eXBlOiJ0ZXh0In0pfSksYT1uZXcgaTtyZXR1cm4gdGhpcy5TaGFwZT1vLHRoaXMucm9vdD1hLHRoaXN9O2Zvcih2YXIgeiBpbiBBLmZsYWdzKUEuZmxhZ3MuaGFzT3duUHJvcGVydHkoeikmJihBLmZsYWdzW3pdLm1hdGNoPWZ1bmN0aW9uKGUpe3JldHVybiBlLm1hdGNoKHRoaXMucmVnZXgpfSk7QS5zZXR1cD17cmVuZGVyZXI6Imh0bWwiLGRlYm91bmNlOjEwMCxyYXRpbzoxLHN1cHBvcnRzQ2FudmFzOiExLHN1cHBvcnRzU1ZHOiExLGxpbmVXcmFwUmF0aW86LjkscmVuZGVyZXJzOlsiaHRtbCIsImNhbnZhcyIsInN2ZyJdfSxBLmRwcj1mdW5jdGlvbihlKXtyZXR1cm4gZSpBLnNldHVwLnJhdGlvfSxBLnZhcnM9e3ByZWVtcHRlZDohMSxyZXNpemFibGVJbWFnZXM6W10sZGVib3VuY2VUaW1lcjpudWxsLGNhY2hlOnt9fSxmdW5jdGlvbigpe3ZhciBlPTEscj0xLG49dSgiY2FudmFzIiksaT1udWxsO24uZ2V0Q29udGV4dCYmLTEhPW4udG9EYXRhVVJMKCJpbWFnZS9wbmciKS5pbmRleE9mKCJkYXRhOmltYWdlL3BuZyIpJiYoQS5zZXR1cC5yZW5kZXJlcj0iY2FudmFzIixpPW4uZ2V0Q29udGV4dCgiMmQiKSxBLnNldHVwLnN1cHBvcnRzQ2FudmFzPSEwKSxBLnNldHVwLnN1cHBvcnRzQ2FudmFzJiYoZT10LmRldmljZVBpeGVsUmF0aW98fDEscj1pLndlYmtpdEJhY2tpbmdTdG9yZVBpeGVsUmF0aW98fGkubW96QmFja2luZ1N0b3JlUGl4ZWxSYXRpb3x8aS5tc0JhY2tpbmdTdG9yZVBpeGVsUmF0aW98fGkub0JhY2tpbmdTdG9yZVBpeGVsUmF0aW98fGkuYmFja2luZ1N0b3JlUGl4ZWxSYXRpb3x8MSksQS5zZXR1cC5yYXRpbz1lL3IsRS5jcmVhdGVFbGVtZW50TlMmJkUuY3JlYXRlRWxlbWVudE5TKEMsInN2ZyIpLmNyZWF0ZVNWR1JlY3QmJihBLnNldHVwLnJlbmRlcmVyPSJzdmciLEEuc2V0dXAuc3VwcG9ydHNTVkc9ITApfSgpLGUoaywiSG9sZGVyIix0KSx0Lm9uRG9tUmVhZHkmJnQub25Eb21SZWFkeShmdW5jdGlvbigpe0EudmFycy5wcmVlbXB0ZWR8fGsucnVuKCksdC5hZGRFdmVudExpc3RlbmVyPyh0LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIseCwhMSksdC5hZGRFdmVudExpc3RlbmVyKCJvcmllbnRhdGlvbmNoYW5nZSIseCwhMSkpOnQuYXR0YWNoRXZlbnQoIm9ucmVzaXplIix4KSwib2JqZWN0Ij09dHlwZW9mIHQuVHVyYm9saW5rcyYmdC5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJwYWdlOmNoYW5nZSIsZnVuY3Rpb24oKXtrLnJ1bigpfSl9KX0oZnVuY3Rpb24oZSx0LHIpe3ZhciBuPSJmdW5jdGlvbiI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ7bj9kZWZpbmUoZSk6clt0XT1lfSx0aGlzKTsKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7Ly93aW5kb3cubW9iaWxlY2hlY2sgPSBmdW5jdGlvbigpIHsNCi8vICAgIHZhciBjaGVjayA9IGZhbHNlOw0KLy8gICAgKGZ1bmN0aW9uKGEpeyhqUXVlcnkuYnJvd3Nlcj1qUXVlcnkuYnJvd3Nlcnx8e30pLm1vYmlsZT0vKGFuZHJvaWR8YmJcZCt8bWVlZ28pLittb2JpbGV8YXZhbnRnb3xiYWRhXC98YmxhY2tiZXJyeXxibGF6ZXJ8Y29tcGFsfGVsYWluZXxmZW5uZWN8aGlwdG9wfGllbW9iaWxlfGlwKGhvbmV8b2QpfGlyaXN8a2luZGxlfGxnZSB8bWFlbW98bWlkcHxtbXB8bW9iaWxlLitmaXJlZm94fG5ldGZyb250fG9wZXJhIG0ob2J8aW4paXxwYWxtKCBvcyk/fHBob25lfHAoaXhpfHJlKVwvfHBsdWNrZXJ8cG9ja2V0fHBzcHxzZXJpZXMoNHw2KTB8c3ltYmlhbnx0cmVvfHVwXC4oYnJvd3NlcnxsaW5rKXx2b2RhZm9uZXx3YXB8d2luZG93cyBjZXx4ZGF8eGlpbm8vaS50ZXN0KGEpfHwvMTIwN3w2MzEwfDY1OTB8M2dzb3w0dGhwfDUwWzEtNl1pfDc3MHN8ODAyc3xhIHdhfGFiYWN8YWMoZXJ8b298c1wtKXxhaShrb3xybil8YWwoYXZ8Y2F8Y28pfGFtb2l8YW4oZXh8bnl8eXcpfGFwdHV8YXIoY2h8Z28pfGFzKHRlfHVzKXxhdHR3fGF1KGRpfFwtbXxyIHxzICl8YXZhbnxiZShja3xsbHxucSl8YmkobGJ8cmQpfGJsKGFjfGF6KXxicihlfHYpd3xidW1ifGJ3XC0obnx1KXxjNTVcL3xjYXBpfGNjd2F8Y2RtXC18Y2VsbHxjaHRtfGNsZGN8Y21kXC18Y28obXB8bmQpfGNyYXd8ZGEoaXR8bGx8bmcpfGRidGV8ZGNcLXN8ZGV2aXxkaWNhfGRtb2J8ZG8oY3xwKW98ZHMoMTJ8XC1kKXxlbCg0OXxhaSl8ZW0obDJ8dWwpfGVyKGljfGswKXxlc2w4fGV6KFs0LTddMHxvc3x3YXx6ZSl8ZmV0Y3xmbHkoXC18Xyl8ZzEgdXxnNTYwfGdlbmV8Z2ZcLTV8Z1wtbW98Z28oXC53fG9kKXxncihhZHx1bil8aGFpZXxoY2l0fGhkXC0obXxwfHQpfGhlaVwtfGhpKHB0fHRhKXxocCggaXxpcCl8aHNcLWN8aHQoYyhcLXwgfF98YXxnfHB8c3x0KXx0cCl8aHUoYXd8dGMpfGlcLSgyMHxnb3xtYSl8aTIzMHxpYWMoIHxcLXxcLyl8aWJyb3xpZGVhfGlnMDF8aWtvbXxpbTFrfGlubm98aXBhcXxpcmlzfGphKHR8dilhfGpicm98amVtdXxqaWdzfGtkZGl8a2VqaXxrZ3QoIHxcLyl8a2xvbnxrcHQgfGt3Y1wtfGt5byhjfGspfGxlKG5vfHhpKXxsZyggZ3xcLyhrfGx8dSl8NTB8NTR8XC1bYS13XSl8bGlid3xseW54fG0xXC13fG0zZ2F8bTUwXC98bWEodGV8dWl8eG8pfG1jKDAxfDIxfGNhKXxtXC1jcnxtZShyY3xyaSl8bWkobzh8b2F8dHMpfG1tZWZ8bW8oMDF8MDJ8Yml8ZGV8ZG98dChcLXwgfG98dil8enopfG10KDUwfHAxfHYgKXxtd2JwfG15d2F8bjEwWzAtMl18bjIwWzItM118bjMwKDB8Mil8bjUwKDB8Mnw1KXxuNygwKDB8MSl8MTApfG5lKChjfG0pXC18b258dGZ8d2Z8d2d8d3QpfG5vayg2fGkpfG56cGh8bzJpbXxvcCh0aXx3dil8b3Jhbnxvd2cxfHA4MDB8cGFuKGF8ZHx0KXxwZHhnfHBnKDEzfFwtKFsxLThdfGMpKXxwaGlsfHBpcmV8cGwoYXl8dWMpfHBuXC0yfHBvKGNrfHJ0fHNlKXxwcm94fHBzaW98cHRcLWd8cWFcLWF8cWMoMDd8MTJ8MjF8MzJ8NjB8XC1bMi03XXxpXC0pfHF0ZWt8cjM4MHxyNjAwfHJha3N8cmltOXxybyh2ZXx6byl8czU1XC98c2EoZ2V8bWF8bW18bXN8bnl8dmEpfHNjKDAxfGhcLXxvb3xwXC0pfHNka1wvfHNlKGMoXC18MHwxKXw0N3xtY3xuZHxyaSl8c2doXC18c2hhcnxzaWUoXC18bSl8c2tcLTB8c2woNDV8aWQpfHNtKGFsfGFyfGIzfGl0fHQ1KXxzbyhmdHxueSl8c3AoMDF8aFwtfHZcLXx2ICl8c3koMDF8bWIpfHQyKDE4fDUwKXx0NigwMHwxMHwxOCl8dGEoZ3R8bGspfHRjbFwtfHRkZ1wtfHRlbChpfG0pfHRpbVwtfHRcLW1vfHRvKHBsfHNoKXx0cyg3MHxtXC18bTN8bTUpfHR4XC05fHVwKFwuYnxnMXxzaSl8dXRzdHx2NDAwfHY3NTB8dmVyaXx2aShyZ3x0ZSl8dmsoNDB8NVswLTNdfFwtdil8dm00MHx2b2RhfHZ1bGN8dngoNTJ8NTN8NjB8NjF8NzB8ODB8ODF8ODN8ODV8OTgpfHczYyhcLXwgKXx3ZWJjfHdoaXR8d2koZyB8bmN8bncpfHdtbGJ8d29udXx4NzAwfHlhc1wtfHlvdXJ8emV0b3x6dGVcLS9pLnRlc3QoYS5zdWJzdHIoMCw0KSl9KShuYXZpZ2F0b3IudXNlckFnZW50fHxuYXZpZ2F0b3IudmVuZG9yfHx3aW5kb3cub3BlcmEpOw0KLy8gICAgcmV0dXJuIGNoZWNrOw0KLy8gICAgY29uc29sZS5sb2coY2hlY2spOw0KLy8gICAgRG9uJ3QgbGlrZSB0aGlzIG1ldGhvZCBhcyBtdWNoIGJlY2F1c2Ugb2Ygc29tZSBvZiB0aGUgb3ZlcmhlYWQuIEFmcmFpZCBpdCdzIG5vdCBzY2FsYWJsZSBnb2luZyBmb3J3YXJkLiBUcnlpbmcgbWV0aG9kIGJlbG93Lg0KLy99DQp2YXIgaXNNb2JpbGUgPSB7DQogICAgQW5kcm9pZDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9BbmRyb2lkL2kpOw0KICAgIH0sDQogICAgQmxhY2tCZXJyeTogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9CbGFja0JlcnJ5L2kpOw0KICAgIH0sDQogICAgaU9TOiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL2lQaG9uZXxpUGFkfGlQb2QvaSk7DQogICAgfSwNCiAgICBPcGVyYTogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9PcGVyYSBNaW5pL2kpOw0KICAgIH0sDQogICAgV2luZG93czogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9JRU1vYmlsZS9pKTsNCiAgICB9LA0KICAgIGFueTogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiAoaXNNb2JpbGUuQW5kcm9pZCgpIHx8IGlzTW9iaWxlLkJsYWNrQmVycnkoKSB8fCBpc01vYmlsZS5pT1MoKSB8fCBpc01vYmlsZS5PcGVyYSgpIHx8IGlzTW9iaWxlLldpbmRvd3MoKSk7DQogICAgfSB9Ow0KLy8gdG8gdXNlOiBpZiggaXNNb2JpbGUuYW55KCkgKSBkbyBzb21ldGhpbmcgOw0KLy8gaWYoISBpc01vYmlsZS5hbnkoKSApIGRvIHNvbWV0aGluZzsNCg0KCn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ew0KLyohDQogKiBpQ2hlY2sgdjIuMC4wLCBodHRwOi8vZ2l0LmlvL2FybHplQQ0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIENyb3NzLXBsYXRmb3JtIGNoZWNrYm94ZXMgYW5kIHJhZGlvIGJ1dHRvbnMgY3VzdG9taXphdGlvbg0KICoNCiAqIChjKSBEYW1pciBTdWx0YW5vdiAtIGh0dHA6Ly9mcm9udGVlZC5jb20NCiAqIE1JVCBMaWNlbnNlZA0KICovDQoNCihmdW5jdGlvbih3aW4sIGRvYywgJCkgew0KDQogIC8vIHByZXZlbnQgbXVsdGlwbGUgaW5jbHVkZXMNCiAgaWYgKCF3aW4uaWNoZWNrZWQpIHsNCiAgICB3aW4uaWNoZWNrZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICQgPSB3aW4ualF1ZXJ5IHx8IHdpbi5aZXB0bzsNCg0KICAgICAgLy8gZGVmYXVsdCBvcHRpb25zDQogICAgICB2YXIgZGVmYXVsdHMgPSB7DQoNCiAgICAgICAgLy8gYXV0byBpbml0IG9uIGRvbXJlYWR5DQogICAgICAgIGF1dG9Jbml0OiB0cnVlLA0KDQogICAgICAgIC8vIGF1dG8gaGFuZGxlIGFqYXggbG9hZGVkIGlucHV0cw0KICAgICAgICBhdXRvQWpheDogdHJ1ZSwNCg0KICAgICAgICAvLyByZW1vdmUgMzAwbXMgY2xpY2sgZGVsYXkgb24gdG91Y2ggZGV2aWNlcw0KICAgICAgICB0YXA6IHRydWUsDQoNCiAgICAgICAgLy8gY3VzdG9taXphdGlvbiBjbGFzcyBuYW1lcw0KICAgICAgICBjaGVja2JveENsYXNzOiAnaWNoZWNrYm94JywNCiAgICAgICAgcmFkaW9DbGFzczogJ2lyYWRpbycsDQoNCiAgICAgICAgY2hlY2tlZENsYXNzOiAnY2hlY2tlZCcsDQogICAgICAgIGRpc2FibGVkQ2xhc3M6ICdkaXNhYmxlZCcsDQogICAgICAgIGluZGV0ZXJtaW5hdGVDbGFzczogJ2luZGV0ZXJtaW5hdGUnLA0KDQogICAgICAgIGhvdmVyQ2xhc3M6ICdob3ZlcicsDQogICAgICAgIC8vIGZvY3VzQ2xhc3M6ICdmb2N1cycsDQogICAgICAgIC8vIGFjdGl2ZUNsYXNzOiAnYWN0aXZlJywNCg0KICAgICAgICAvLyBkZWZhdWx0IGNhbGxiYWNrcw0KICAgICAgICBjYWxsYmFja3M6IHsNCiAgICAgICAgICBpZkNyZWF0ZWQ6IGZhbHNlDQogICAgICAgIH0sDQoNCiAgICAgICAgLy8gYXBwZW5kZWQgY2xhc3MgbmFtZXMNCiAgICAgICAgY2xhc3Nlczogew0KICAgICAgICAgIGJhc2U6ICdpY2hlY2snLA0KICAgICAgICAgIGRpdjogJyMtaXRlbScsIC8vIHtiYXNlfS1pdGVtDQogICAgICAgICAgYXJlYTogJyMtYXJlYS0nLCAvLyB7YmFzZX0tYXJlYS17dmFsdWV9DQogICAgICAgICAgaW5wdXQ6ICcjLWlucHV0JywgLy8ge2Jhc2V9LWlucHV0DQogICAgICAgICAgbGFiZWw6ICcjLWxhYmVsJyAvLyB7YmFzZX0tbGFiZWwNCiAgICAgICAgfQ0KICAgICAgfTsNCg0KICAgICAgLy8gZXh0ZW5kIGRlZmF1bHQgb3B0aW9ucw0KICAgICAgd2luLmljaGVjayA9ICQuZXh0ZW5kKGRlZmF1bHRzLCB3aW4uaWNoZWNrKTsNCg0KICAgICAgLy8gdXNlcmFnZW50IHNuaWZmaW5nDQogICAgICB2YXIgdWEgPSB3aW4ubmF2aWdhdG9yLnVzZXJBZ2VudDsNCiAgICAgIHZhciBpZSA9IC9NU0lFIFs1LThdLy50ZXN0KHVhKSB8fCBkb2MuZG9jdW1lbnRNb2RlIDwgOTsNCiAgICAgIHZhciBvcGVyYU1pbmkgPSAvT3BlcmEgTWluaS8udGVzdCh1YSk7DQoNCiAgICAgIC8vIGNsYXNzZXMgY2FjaGUNCiAgICAgIHZhciBiYXNlQ2xhc3MgPSBkZWZhdWx0cy5jbGFzc2VzLmJhc2U7DQogICAgICB2YXIgZGl2Q2xhc3MgPSBkZWZhdWx0cy5jbGFzc2VzLmRpdi5yZXBsYWNlKCcjJywgYmFzZUNsYXNzKTsNCiAgICAgIHZhciBhcmVhQ2xhc3MgPSBkZWZhdWx0cy5jbGFzc2VzLmFyZWEucmVwbGFjZSgnIycsIGJhc2VDbGFzcyk7DQogICAgICB2YXIgbm9kZUNsYXNzID0gZGVmYXVsdHMuY2xhc3Nlcy5pbnB1dC5yZXBsYWNlKCcjJywgYmFzZUNsYXNzKTsNCiAgICAgIHZhciBsYWJlbENsYXNzID0gZGVmYXVsdHMuY2xhc3Nlcy5sYWJlbC5yZXBsYWNlKCcjJywgYmFzZUNsYXNzKTsNCg0KICAgICAgLy8gdW5zZXQgaW5pdCBjbGFzc2VzDQogICAgICBkZWxldGUgZGVmYXVsdHMuY2xhc3NlczsNCg0KICAgICAgLy8gZGVmYXVsdCBmaWx0ZXINCiAgICAgIHZhciBmaWx0ZXIgPSAnaW5wdXRbdHlwZT1jaGVja2JveF0saW5wdXRbdHlwZT1yYWRpb10nOw0KDQogICAgICAvLyBjbGlja2FibGUgYXJlYXMgY29udGFpbmVyDQogICAgICB2YXIgYXJlYXMgPSB7fTsNCg0KICAgICAgLy8gaGFzaGVzIGNvbnRhaW5lcg0KICAgICAgdmFyIGhhc2hlcyA9IHt9Ow0KDQogICAgICAvLyBoYXNoIHJlY29nbml6ZXINCiAgICAgIHZhciByZWNvZ25pemVyID0gbmV3IFJlZ0V4cChiYXNlQ2xhc3MgKyAnXFxbKC4qPylcXF0nKTsNCg0KICAgICAgLy8gaGFzaCBleHRyYWN0b3INCiAgICAgIHZhciBleHRyYWN0ID0gZnVuY3Rpb24oY2xhc3NOYW1lLCBtYXRjaGVzLCB2YWx1ZSkgew0KICAgICAgICBpZiAoISFjbGFzc05hbWUpIHsNCiAgICAgICAgICBtYXRjaGVzID0gcmVjb2duaXplci5leGVjKGNsYXNzTmFtZSk7DQoNCiAgICAgICAgICBpZiAobWF0Y2hlcyAmJiBoYXNoZXNbbWF0Y2hlc1sxXV0pIHsNCiAgICAgICAgICAgIHZhbHVlID0gbWF0Y2hlc1sxXTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgICB9Ow0KDQogICAgICAvLyBkZXRlY3QgY29tcHV0ZWQgc3R5bGUgc3VwcG9ydA0KICAgICAgdmFyIGNvbXB1dGVkID0gd2luLmdldENvbXB1dGVkU3R5bGU7DQoNCiAgICAgIC8vIGRldGVjdCBwb2ludGVyIGV2ZW50cyBzdXBwb3J0DQogICAgICB2YXIgaXNQb2ludGVyID0gd2luLlBvaW50ZXJFdmVudCB8fCB3aW4uTVNQb2ludGVyRXZlbnQ7DQoNCiAgICAgIC8vIGRldGVjdCB0b3VjaCBldmVudHMgc3VwcG9ydA0KICAgICAgdmFyIGlzVG91Y2ggPSAnb250b3VjaGVuZCcgaW4gd2luOw0KDQogICAgICAvLyBkZXRlY3QgbW9iaWxlIHVzZXJzDQogICAgICB2YXIgaXNNb2JpbGUgPSAvbW9iaWxlfHRhYmxldHxwaG9uZXxpcChhZHxvZCl8YW5kcm9pZHxzaWxrfHdlYm9zL2kudGVzdCh1YSk7DQoNCiAgICAgIC8vIHNldHVwIGV2ZW50cw0KICAgICAgdmFyIG1vdXNlID0gWydtb3VzZScsICdkb3duJywgJ3VwJywgJ292ZXInLCAnb3V0J107IC8vIGJ1YmJsaW5nIGhvdmVyDQogICAgICB2YXIgcG9pbnRlciA9IHdpbi5Qb2ludGVyRXZlbnQgPyBbJ3BvaW50ZXInLCBtb3VzZVsxXSwgbW91c2VbMl0sIG1vdXNlWzNdLCBtb3VzZVs0XV0gOiBbJ01TUG9pbnRlcicsICdEb3duJywgJ1VwJywgJ092ZXInLCAnT3V0J107DQogICAgICB2YXIgdG91Y2ggPSBbJ3RvdWNoJywgJ3N0YXJ0JywgJ2VuZCddOw0KICAgICAgdmFyIG5vTW91c2UgPSAoaXNUb3VjaCAmJiBpc01vYmlsZSkgfHwgaXNQb2ludGVyOw0KDQogICAgICAvLyBjaG9vc2UgZXZlbnRzDQogICAgICB2YXIgaG92ZXJTdGFydCA9IG5vTW91c2UgPyAoaXNUb3VjaCA/IHRvdWNoWzBdICsgdG91Y2hbMV0gOiBwb2ludGVyWzBdICsgcG9pbnRlclszXSkgOiBtb3VzZVswXSArIG1vdXNlWzNdOw0KICAgICAgdmFyIGhvdmVyRW5kID0gbm9Nb3VzZSA/IChpc1RvdWNoID8gdG91Y2hbMF0gKyB0b3VjaFsyXSA6IHBvaW50ZXJbMF0gKyBwb2ludGVyWzRdKSA6IG1vdXNlWzBdICsgbW91c2VbNF07DQogICAgICB2YXIgdGFwU3RhcnQgPSBub01vdXNlID8gKGlzVG91Y2ggPyBmYWxzZSA6IHBvaW50ZXJbMF0gKyBwb2ludGVyWzFdKSA6IG1vdXNlWzBdICsgbW91c2VbMV07DQogICAgICB2YXIgdGFwRW5kID0gbm9Nb3VzZSA/IChpc1RvdWNoID8gZmFsc2UgOiBwb2ludGVyWzBdICsgcG9pbnRlclsyXSkgOiBtb3VzZVswXSArIG1vdXNlWzJdOw0KICAgICAgdmFyIGhvdmVyID0gIW9wZXJhTWluaSA/IGhvdmVyU3RhcnQgKyAnLmkgJyArIGhvdmVyRW5kICsgJy5pICcgOiAnJzsNCiAgICAgIHZhciB0YXAgPSAhb3BlcmFNaW5pICYmIHRhcFN0YXJ0ID8gdGFwU3RhcnQgKyAnLmkgJyArIHRhcEVuZCArICcuaScgOiAnJzsNCg0KICAgICAgLy8gc3R5bGVzIG9wdGlvbnMNCiAgICAgIHZhciBzdHlsZVRhZzsNCiAgICAgIHZhciBzdHlsZUxpc3Q7DQogICAgICB2YXIgc3R5bGVBcmVhID0gZGVmYXVsdHMuYXJlYVN0eWxlICE9PSBmYWxzZSA/ICdwb3NpdGlvbjphYnNvbHV0ZTtkaXNwbGF5OmJsb2NrO2NvbnRlbnQ6IiI7dG9wOiM7Ym90dG9tOiM7bGVmdDojO3JpZ2h0OiM7JyA6IDA7DQogICAgICB2YXIgc3R5bGVJbnB1dCA9ICdwb3NpdGlvbjphYnNvbHV0ZSE7ZGlzcGxheTpibG9jayE7b3V0bGluZTpub25lITsnICsgKGRlZmF1bHRzLmRlYnVnID8gJycgOiAnb3BhY2l0eTowITt6LWluZGV4Oi05OSE7Y2xpcDpyZWN0KDAgMCAwIDApITsnKTsNCg0KICAgICAgLy8gc3R5bGVzIGFkZGl0aW9uDQogICAgICB2YXIgc3R5bGUgPSBmdW5jdGlvbihydWxlcywgc2VsZWN0b3IsIGFyZWEpIHsNCiAgICAgICAgaWYgKCFzdHlsZVRhZykgew0KDQogICAgICAgICAgLy8gY3JlYXRlIGNvbnRhaW5lcg0KICAgICAgICAgIHN0eWxlVGFnID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7DQoNCiAgICAgICAgICAvLyBhcHBlbmQgdG8gaGVhZGVyDQogICAgICAgICAgKGRvYy5oZWFkIHx8IGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdKS5hcHBlbmRDaGlsZChzdHlsZVRhZyk7DQoNCiAgICAgICAgICAvLyB3ZWJraXQgaGFjaw0KICAgICAgICAgIGlmICghd2luLmNyZWF0ZVBvcHVwKSB7DQogICAgICAgICAgICBzdHlsZVRhZy5hcHBlbmRDaGlsZChkb2MuY3JlYXRlVGV4dE5vZGUoJycpKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBzdHlsZUxpc3QgPSBzdHlsZVRhZy5zaGVldCB8fCBzdHlsZVRhZy5zdHlsZVNoZWV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy8gY2hvb3NlIHNlbGVjdG9yDQogICAgICAgIGlmICghc2VsZWN0b3IpIHsNCiAgICAgICAgICBzZWxlY3RvciA9ICdkaXYuJyArIChhcmVhID8gYXJlYUNsYXNzICsgYXJlYSArICc6YWZ0ZXInIDogZGl2Q2xhc3MgKyAnIGlucHV0LicgKyBub2RlQ2xhc3MpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gcmVwbGFjZSBzaG9ydGhhbmQgcnVsZXMNCiAgICAgICAgcnVsZXMgPSBydWxlcy5yZXBsYWNlKC8hL2csICcgIWltcG9ydGFudCcpOw0KDQogICAgICAgIC8vIGFwcGVuZCBzdHlsZXMNCiAgICAgICAgaWYgKHN0eWxlTGlzdC5hZGRSdWxlKSB7DQogICAgICAgICAgc3R5bGVMaXN0LmFkZFJ1bGUoc2VsZWN0b3IsIHJ1bGVzLCAwKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzdHlsZUxpc3QuaW5zZXJ0UnVsZShzZWxlY3RvciArICd7JyArIHJ1bGVzICsgJ30nLCAwKTsNCiAgICAgICAgfQ0KICAgICAgfTsNCg0KICAgICAgLy8gYXBwZW5kIGlucHV0J3Mgc3R5bGVzDQogICAgICBzdHlsZShzdHlsZUlucHV0KTsNCg0KICAgICAgLy8gYXBwZW5kIHN0eWxlcidzIHN0eWxlcw0KICAgICAgaWYgKChpc1RvdWNoICYmIGlzTW9iaWxlKSB8fCBvcGVyYU1pbmkpIHsNCg0KICAgICAgICAvLyBmb3JjZSBjdXN0b3I6cG9pbnRlciBmb3IgbW9iaWxlIGRldmljZXMNCiAgICAgICAgc3R5bGUoJ2N1cnNvcjpwb2ludGVyITsnLCAnbGFiZWwuJyArIGxhYmVsQ2xhc3MgKyAnLGRpdi4nICsgZGl2Q2xhc3MpOw0KICAgICAgfQ0KDQogICAgICAvLyBhcHBlbmQgaWZyYW1lJ3Mgc3R5bGVzDQogICAgICBzdHlsZSgnZGlzcGxheTpub25lIScsICdpZnJhbWUuaWNoZWNrLWZyYW1lJyk7IC8vIHVzZWQgdG8gaGFuZGxlIGFqYXgtbG9hZGVkIGlucHV0cw0KDQogICAgICAvLyBjbGFzcyB0b2dnbGVyDQogICAgICB2YXIgdG9nZ2xlID0gZnVuY3Rpb24obm9kZSwgY2xhc3NOYW1lLCBzdGF0dXMsIGN1cnJlbnRDbGFzcywgdXBkYXRlZENsYXNzLCBhZGRDbGFzcywgcmVtb3ZlQ2xhc3MpIHsNCiAgICAgICAgY3VycmVudENsYXNzID0gbm9kZS5jbGFzc05hbWU7DQoNCiAgICAgICAgaWYgKCEhY3VycmVudENsYXNzKSB7DQogICAgICAgICAgdXBkYXRlZENsYXNzID0gJyAnICsgY3VycmVudENsYXNzICsgJyAnOw0KDQogICAgICAgICAgLy8gYWRkIGNsYXNzDQogICAgICAgICAgaWYgKHN0YXR1cyA9PT0gMSkgew0KICAgICAgICAgICAgYWRkQ2xhc3MgPSBjbGFzc05hbWU7DQoNCiAgICAgICAgICAvLyByZW1vdmUgY2xhc3MNCiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gMCkgew0KICAgICAgICAgICAgcmVtb3ZlQ2xhc3MgPSBjbGFzc05hbWU7DQoNCiAgICAgICAgICAvLyBhZGQgYW5kIHJlbW92ZSBjbGFzcw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBhZGRDbGFzcyA9IGNsYXNzTmFtZVswXTsNCiAgICAgICAgICAgIHJlbW92ZUNsYXNzID0gY2xhc3NOYW1lWzFdOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIGFkZCBjbGFzcw0KICAgICAgICAgIGlmICghIWFkZENsYXNzICYmIHVwZGF0ZWRDbGFzcy5pbmRleE9mKCcgJyArIGFkZENsYXNzICsgJyAnKSA8IDApIHsNCiAgICAgICAgICAgIHVwZGF0ZWRDbGFzcyArPSBhZGRDbGFzcyArICcgJzsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyByZW1vdmUgY2xhc3MNCiAgICAgICAgICBpZiAoISFyZW1vdmVDbGFzcyAmJiB+dXBkYXRlZENsYXNzLmluZGV4T2YoJyAnICsgcmVtb3ZlQ2xhc3MgKyAnICcpKSB7DQogICAgICAgICAgICB1cGRhdGVkQ2xhc3MgPSB1cGRhdGVkQ2xhc3MucmVwbGFjZSgnICcgKyByZW1vdmVDbGFzcyArICcgJywgJyAnKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyB0cmltIGNsYXNzDQogICAgICAgICAgdXBkYXRlZENsYXNzID0gdXBkYXRlZENsYXNzLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyk7DQoNCiAgICAgICAgICAvLyB1cGRhdGUgY2xhc3MNCiAgICAgICAgICBpZiAodXBkYXRlZENsYXNzICE9PSBjdXJyZW50Q2xhc3MpIHsNCiAgICAgICAgICAgIG5vZGUuY2xhc3NOYW1lID0gdXBkYXRlZENsYXNzOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIHJldHVybiB1cGRhdGVkIGNsYXNzDQogICAgICAgICAgcmV0dXJuIHVwZGF0ZWRDbGFzczsNCiAgICAgICAgfQ0KICAgICAgfTsNCg0KICAgICAgLy8gdHJhY2VzIHJlbW92ZXINCiAgICAgIHZhciB0aWR5ID0gZnVuY3Rpb24obm9kZSwga2V5LCB0cmlnZ2VyLCBzZXR0aW5ncywgY2xhc3NOYW1lLCBwYXJlbnQpIHsNCiAgICAgICAgaWYgKGhhc2hlc1trZXldKSB7DQogICAgICAgICAgc2V0dGluZ3MgPSBoYXNoZXNba2V5XTsNCiAgICAgICAgICBjbGFzc05hbWUgPSBzZXR0aW5ncy5jbGFzc05hbWU7DQogICAgICAgICAgcGFyZW50ID0gJChjbG9zZXN0KG5vZGUsICdkaXYnLCBjbGFzc05hbWUpKTsNCg0KICAgICAgICAgIC8vIHByZXZlbnQgb3ZlcmxhcHBpbmcNCiAgICAgICAgICBpZiAocGFyZW50Lmxlbmd0aCkgew0KDQogICAgICAgICAgICAvLyBpbnB1dA0KICAgICAgICAgICAgJChub2RlKS5yZW1vdmVDbGFzcyhub2RlQ2xhc3MgKyAnICcgKyBjbGFzc05hbWUpLmF0dHIoJ3N0eWxlJywgc2V0dGluZ3Muc3R5bGUpOw0KDQogICAgICAgICAgICAvLyBsYWJlbA0KICAgICAgICAgICAgJCgnbGFiZWwuJyArIHNldHRpbmdzLmVzYykucmVtb3ZlQ2xhc3MobGFiZWxDbGFzcyArICcgJyArIGNsYXNzTmFtZSk7DQoNCiAgICAgICAgICAgIC8vIHBhcmVudA0KICAgICAgICAgICAgJChwYXJlbnQpLnJlcGxhY2VXaXRoKCQobm9kZSkpOw0KDQogICAgICAgICAgICAvLyBjYWxsYmFjaw0KICAgICAgICAgICAgaWYgKHRyaWdnZXIpIHsNCiAgICAgICAgICAgICAgY2FsbGJhY2sobm9kZSwga2V5LCB0cmlnZ2VyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyB1bnNldCBjdXJyZW50IGtleQ0KICAgICAgICAgIGhhc2hlc1trZXldID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH07DQoNCiAgICAgIC8vIG5vZGVzIGluc3BlY3Rvcg0KICAgICAgdmFyIGluc3BlY3QgPSBmdW5jdGlvbihvYmplY3QsIG5vZGUsIHN0YWNrLCBkaXJlY3QsIGluZGlyZWN0KSB7DQogICAgICAgIHN0YWNrID0gW107DQogICAgICAgIGRpcmVjdCA9IG9iamVjdC5sZW5ndGg7DQoNCiAgICAgICAgLy8gaW5zcGVjdCBvYmplY3QNCiAgICAgICAgd2hpbGUgKGRpcmVjdC0tKSB7DQogICAgICAgICAgbm9kZSA9IG9iamVjdFtkaXJlY3RdOw0KDQogICAgICAgICAgLy8gZGlyZWN0IGlucHV0DQogICAgICAgICAgaWYgKG5vZGUudHlwZSkgew0KDQogICAgICAgICAgICAvLyBjaGVja2JveCBvciByYWRpbyBidXR0b24NCiAgICAgICAgICAgIGlmICh+ZmlsdGVyLmluZGV4T2Yobm9kZS50eXBlKSkgew0KICAgICAgICAgICAgICBzdGFjay5wdXNoKG5vZGUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gaW5kaXJlY3QgaW5wdXQNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbm9kZSA9ICQobm9kZSkuZmluZChmaWx0ZXIpOw0KICAgICAgICAgICAgaW5kaXJlY3QgPSBub2RlLmxlbmd0aDsNCg0KICAgICAgICAgICAgd2hpbGUgKGluZGlyZWN0LS0pIHsNCiAgICAgICAgICAgICAgc3RhY2sucHVzaChub2RlW2luZGlyZWN0XSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHN0YWNrOw0KICAgICAgfTsNCg0KICAgICAgLy8gcGFyZW50IHNlYXJjaGVyDQogICAgICB2YXIgY2xvc2VzdCA9IGZ1bmN0aW9uKG5vZGUsIHRhZywgY2xhc3NOYW1lLCBwYXJlbnQpIHsNCiAgICAgICAgd2hpbGUgKG5vZGUgJiYgbm9kZS5ub2RlVHlwZSAhPT0gOSkgew0KICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7DQoNCiAgICAgICAgICBpZiAobm9kZSAmJiBub2RlLnRhZ05hbWUgPT0gdGFnLnRvVXBwZXJDYXNlKCkgJiYgfm5vZGUuY2xhc3NOYW1lLmluZGV4T2YoY2xhc3NOYW1lKSkgew0KICAgICAgICAgICAgcGFyZW50ID0gbm9kZTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBwYXJlbnQ7DQogICAgICB9Ow0KDQogICAgICAvLyBjYWxsYmFja3MgZmFybQ0KICAgICAgdmFyIGNhbGxiYWNrID0gZnVuY3Rpb24obm9kZSwga2V5LCBuYW1lKSB7DQogICAgICAgIG5hbWUgPSAnaWYnICsgbmFtZTsNCg0KICAgICAgICAvLyBjYWxsYmFja3MgYXJlIGFsbG93ZWQNCiAgICAgICAgaWYgKGhhc2hlc1trZXldLmNhbGxiYWNrcyAhPT0gZmFsc2UpIHsNCg0KICAgICAgICAgIC8vIGRpcmVjdCBjYWxsYmFjaw0KICAgICAgICAgIGlmICh0eXBlb2YgaGFzaGVzW2tleV0uY2FsbGJhY2tzW25hbWVdID09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgIGhhc2hlc1trZXldLmNhbGxiYWNrc1tuYW1lXShub2RlLCBoYXNoZXNba2V5XSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gaW5kaXJlY3QgY2FsbGJhY2sNCiAgICAgICAgICBpZiAoaGFzaGVzW2tleV0uY2FsbGJhY2tzW25hbWVdICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgJChub2RlKS50cmlnZ2VyKG5hbWUpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfTsNCg0KICAgICAgLy8gc2VsZWN0aW9uIHByb2Nlc3Nvcg0KICAgICAgdmFyIHByb2Nlc3MgPSBmdW5jdGlvbihkYXRhLCBvcHRpb25zLCBhamF4LCBzaWxlbnQpIHsNCg0KICAgICAgICAvLyBnZXQgaW5wdXRzDQogICAgICAgIHZhciBlbGVtZW50cyA9IGluc3BlY3QoZGF0YSk7DQogICAgICAgIHZhciBlbGVtZW50ID0gZWxlbWVudHMubGVuZ3RoOw0KDQogICAgICAgIC8vIGxvb3AgdGhyb3VnaCBpbnB1dHMNCiAgICAgICAgd2hpbGUgKGVsZW1lbnQtLSkgew0KICAgICAgICAgIHZhciBub2RlID0gZWxlbWVudHNbZWxlbWVudF07DQogICAgICAgICAgdmFyIG5vZGVBdHRyID0gbm9kZS5hdHRyaWJ1dGVzOw0KICAgICAgICAgIHZhciBub2RlQXR0ckNhY2hlID0ge307DQogICAgICAgICAgdmFyIG5vZGVBdHRyTGVuZ3RoID0gbm9kZUF0dHIubGVuZ3RoOw0KICAgICAgICAgIHZhciBub2RlQXR0ck5hbWU7DQogICAgICAgICAgdmFyIG5vZGVBdHRyVmFsdWU7DQogICAgICAgICAgdmFyIG5vZGVEYXRhID0ge307DQogICAgICAgICAgdmFyIG5vZGVEYXRhQ2FjaGUgPSB7fTsgLy8gbWVyZ2VkIGRhdGENCiAgICAgICAgICB2YXIgbm9kZURhdGFQcm9wZXJ0eTsNCiAgICAgICAgICB2YXIgbm9kZUlkID0gbm9kZS5pZDsNCiAgICAgICAgICB2YXIgbm9kZUluaGVyaXQ7DQogICAgICAgICAgdmFyIG5vZGVJbmhlcml0SXRlbTsNCiAgICAgICAgICB2YXIgbm9kZUluaGVyaXRMZW5ndGg7DQogICAgICAgICAgdmFyIG5vZGVTdHJpbmcgPSBub2RlLmNsYXNzTmFtZTsNCiAgICAgICAgICB2YXIgbm9kZVN0eWxlOw0KICAgICAgICAgIHZhciBub2RlVHlwZSA9IG5vZGUudHlwZTsNCiAgICAgICAgICB2YXIgcXVlcnlEYXRhID0gJC5jYWNoZSA/ICQuY2FjaGVbbm9kZVskLmV4cGFuZG9dXSA6IDA7IC8vIGNhY2hlZCBkYXRhDQogICAgICAgICAgdmFyIHNldHRpbmdzOw0KICAgICAgICAgIHZhciBrZXkgPSBleHRyYWN0KG5vZGVTdHJpbmcpOw0KICAgICAgICAgIHZhciBrZXlDbGFzczsNCiAgICAgICAgICB2YXIgaGFuZGxlOw0KICAgICAgICAgIHZhciBzdHlsZXI7DQogICAgICAgICAgdmFyIHN0eWxlckNsYXNzID0gJyc7DQogICAgICAgICAgdmFyIHN0eWxlclN0eWxlOw0KICAgICAgICAgIHZhciBhcmVhID0gZmFsc2U7DQogICAgICAgICAgdmFyIGxhYmVsOw0KICAgICAgICAgIHZhciBsYWJlbERpcmVjdDsNCiAgICAgICAgICB2YXIgbGFiZWxJbmRpcmVjdDsNCiAgICAgICAgICB2YXIgbGFiZWxLZXk7DQogICAgICAgICAgdmFyIGxhYmVsU3RyaW5nOw0KICAgICAgICAgIHZhciBsYWJlbHMgPSBbXTsNCiAgICAgICAgICB2YXIgbGFiZWxzTGVuZ3RoOw0KICAgICAgICAgIHZhciBmYXN0Q2xhc3MgPSB3aW4uRmFzdENsaWNrID8gJyBuZWVkc2NsaWNrJyA6ICcnOw0KDQogICAgICAgICAgLy8gcGFyc2Ugb3B0aW9ucyBmcm9tIEhUTUwgYXR0cmlidXRlcw0KICAgICAgICAgIHdoaWxlIChub2RlQXR0ckxlbmd0aC0tKSB7DQogICAgICAgICAgICBub2RlQXR0ck5hbWUgPSBub2RlQXR0cltub2RlQXR0ckxlbmd0aF0ubmFtZTsNCiAgICAgICAgICAgIG5vZGVBdHRyVmFsdWUgPSBub2RlQXR0cltub2RlQXR0ckxlbmd0aF0udmFsdWU7DQoNCiAgICAgICAgICAgIGlmICh+bm9kZUF0dHJOYW1lLmluZGV4T2YoJ2RhdGEtJykpIHsNCiAgICAgICAgICAgICAgbm9kZURhdGFbbm9kZUF0dHJOYW1lLnN1YnN0cig1KV0gPSBub2RlQXR0clZhbHVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAobm9kZUF0dHJOYW1lID09ICdzdHlsZScpIHsNCiAgICAgICAgICAgICAgbm9kZVN0eWxlID0gbm9kZUF0dHJWYWx1ZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbm9kZUF0dHJDYWNoZVtub2RlQXR0ck5hbWVdID0gbm9kZUF0dHJWYWx1ZTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyBwYXJzZSBvcHRpb25zIGZyb20galF1ZXJ5IG9yIFplcHRvIGNhY2hlDQogICAgICAgICAgaWYgKHF1ZXJ5RGF0YSAmJiBxdWVyeURhdGEuZGF0YSkgew0KICAgICAgICAgICAgbm9kZURhdGEgPSAkLmV4dGVuZChub2RlRGF0YSwgcXVlcnlEYXRhLmRhdGEpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIHBhcnNlIG1lcmdlZCBvcHRpb25zDQogICAgICAgICAgZm9yIChub2RlRGF0YVByb3BlcnR5IGluIG5vZGVEYXRhKSB7DQogICAgICAgICAgICBub2RlQXR0clZhbHVlID0gbm9kZURhdGFbbm9kZURhdGFQcm9wZXJ0eV07DQoNCiAgICAgICAgICAgIGlmIChub2RlQXR0clZhbHVlID09ICd0cnVlJyB8fCBub2RlQXR0clZhbHVlID09ICdmYWxzZScpIHsNCiAgICAgICAgICAgICAgbm9kZUF0dHJWYWx1ZSA9IG5vZGVBdHRyVmFsdWUgPT0gJ3RydWUnOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBub2RlRGF0YUNhY2hlW25vZGVEYXRhUHJvcGVydHkucmVwbGFjZSgvY2hlY2tib3h8cmFkaW98Y2xhc3N8aWR8bGFiZWwvZywgZnVuY3Rpb24oc3RyaW5nLCBwb3NpdGlvbikgew0KICAgICAgICAgICAgICByZXR1cm4gcG9zaXRpb24gPT09IDAgPyBzdHJpbmcgOiBzdHJpbmcuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzdHJpbmcuc2xpY2UoMSk7DQogICAgICAgICAgICB9KV0gPSBub2RlQXR0clZhbHVlOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIG1lcmdlIG9wdGlvbnMNCiAgICAgICAgICBzZXR0aW5ncyA9ICQuZXh0ZW5kKHt9LCBkZWZhdWx0cywgd2luLmljaGVjaywgbm9kZURhdGFDYWNoZSwgb3B0aW9ucyk7DQoNCiAgICAgICAgICAvLyBpbnB1dCB0eXBlIGZpbHRlcg0KICAgICAgICAgIGhhbmRsZSA9IHNldHRpbmdzLmhhbmRsZTsNCg0KICAgICAgICAgIGlmIChoYW5kbGUgIT09ICdjaGVja2JveCcgJiYgaGFuZGxlICE9PSAncmFkaW8nKSB7DQogICAgICAgICAgICBoYW5kbGUgPSBmaWx0ZXI7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gcHJldmVudCB1bndhbnRlZCBpbml0DQogICAgICAgICAgaWYgKHNldHRpbmdzLmluaXQgIT09IGZhbHNlICYmIH5oYW5kbGUuaW5kZXhPZihub2RlVHlwZSkpIHsNCg0KICAgICAgICAgICAgLy8gdGlkeSBiZWZvcmUgcHJvY2Vzc2luZw0KICAgICAgICAgICAgaWYgKGtleSkgew0KICAgICAgICAgICAgICB0aWR5KG5vZGUsIGtleSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIGdlbmVyYXRlIHJhbmRvbSBrZXkNCiAgICAgICAgICAgIHdoaWxlKCFoYXNoZXNba2V5XSkgew0KICAgICAgICAgICAgICBrZXkgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgNSk7IC8vIDUgc3ltYm9scw0KDQogICAgICAgICAgICAgIGlmICghaGFzaGVzW2tleV0pIHsNCiAgICAgICAgICAgICAgICBrZXlDbGFzcyA9IGJhc2VDbGFzcyArICdbJyArIGtleSArICddJzsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBwcmV2ZW50IHVud2FudGVkIGR1cGxpY2F0ZXMNCiAgICAgICAgICAgIGRlbGV0ZSBzZXR0aW5ncy5hdXRvSW5pdDsNCiAgICAgICAgICAgIGRlbGV0ZSBzZXR0aW5ncy5hdXRvQWpheDsNCg0KICAgICAgICAgICAgLy8gc2F2ZSBzZXR0aW5ncw0KICAgICAgICAgICAgc2V0dGluZ3Muc3R5bGUgPSBub2RlU3R5bGUgfHwgJyc7DQogICAgICAgICAgICBzZXR0aW5ncy5jbGFzc05hbWUgPSBrZXlDbGFzczsNCiAgICAgICAgICAgIHNldHRpbmdzLmVzYyA9IGtleUNsYXNzLnJlcGxhY2UoLyhcW3xcXSkvZywgJ1xcJDEnKTsNCiAgICAgICAgICAgIGhhc2hlc1trZXldID0gc2V0dGluZ3M7DQoNCiAgICAgICAgICAgIC8vIGZpbmQgZGlyZWN0IGxhYmVsDQogICAgICAgICAgICBsYWJlbERpcmVjdCA9IGNsb3Nlc3Qobm9kZSwgJ2xhYmVsJywgJycpOw0KDQogICAgICAgICAgICBpZiAobGFiZWxEaXJlY3QpIHsNCg0KICAgICAgICAgICAgICAvLyBub3JtYWxpemUgImZvciIgYXR0cmlidXRlDQogICAgICAgICAgICAgIGlmICghISFsYWJlbERpcmVjdC5odG1sRm9yICYmICEhbm9kZUlkKSB7DQogICAgICAgICAgICAgICAgbGFiZWxEaXJlY3QuaHRtbEZvciA9IG5vZGVJZDsNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGxhYmVscy5wdXNoKGxhYmVsRGlyZWN0KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gZmluZCBpbmRpcmVjdCBsYWJlbA0KICAgICAgICAgICAgaWYgKCEhbm9kZUlkKSB7DQogICAgICAgICAgICAgIGxhYmVsSW5kaXJlY3QgPSAkKCdsYWJlbFtmb3I9IicgKyBub2RlSWQgKyAnIl0nKTsNCg0KICAgICAgICAgICAgICAvLyBtZXJnZSBsYWJlbHMNCiAgICAgICAgICAgICAgd2hpbGUgKGxhYmVsSW5kaXJlY3QubGVuZ3RoLS0pIHsNCiAgICAgICAgICAgICAgICBsYWJlbCA9IGxhYmVsSW5kaXJlY3RbbGFiZWxJbmRpcmVjdC5sZW5ndGhdOw0KDQogICAgICAgICAgICAgICAgaWYgKGxhYmVsICE9PSBsYWJlbERpcmVjdCkgew0KICAgICAgICAgICAgICAgICAgbGFiZWxzLnB1c2gobGFiZWwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBsb29wIHRocm91Z2ggbGFiZWxzDQogICAgICAgICAgICBsYWJlbHNMZW5ndGggPSBsYWJlbHMubGVuZ3RoOw0KDQogICAgICAgICAgICB3aGlsZSAobGFiZWxzTGVuZ3RoLS0pIHsNCiAgICAgICAgICAgICAgbGFiZWwgPSBsYWJlbHNbbGFiZWxzTGVuZ3RoXTsNCiAgICAgICAgICAgICAgbGFiZWxTdHJpbmcgPSBsYWJlbC5jbGFzc05hbWU7DQogICAgICAgICAgICAgIGxhYmVsS2V5ID0gZXh0cmFjdChsYWJlbFN0cmluZyk7DQoNCiAgICAgICAgICAgICAgLy8gcmVtb3ZlIHByZXZpb3VzIGtleQ0KICAgICAgICAgICAgICBpZiAobGFiZWxLZXkpIHsNCiAgICAgICAgICAgICAgICBsYWJlbFN0cmluZyA9IHRvZ2dsZShsYWJlbCwgYmFzZUNsYXNzICsgJ1snICsgbGFiZWxLZXkgKyAnXScsIDApOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGxhYmVsU3RyaW5nID0gKCEhbGFiZWxTdHJpbmcgPyBsYWJlbFN0cmluZyArICcgJyA6ICcnKSArIGxhYmVsQ2xhc3M7DQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAvLyB1cGRhdGUgbGFiZWwncyBjbGFzcw0KICAgICAgICAgICAgICBsYWJlbC5jbGFzc05hbWUgPSBsYWJlbFN0cmluZyArICcgJyArIGtleUNsYXNzICsgZmFzdENsYXNzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBwcmVwYXJlIHN0eWxlcg0KICAgICAgICAgICAgc3R5bGVyID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KDQogICAgICAgICAgICAvLyBwYXJzZSBpbmhlcml0ZWQgb3B0aW9ucw0KICAgICAgICAgICAgaWYgKCEhc2V0dGluZ3MuaW5oZXJpdCkgew0KICAgICAgICAgICAgICBub2RlSW5oZXJpdCA9IHNldHRpbmdzLmluaGVyaXQuc3BsaXQoL1xzKixccyovKTsNCiAgICAgICAgICAgICAgbm9kZUluaGVyaXRMZW5ndGggPSBub2RlSW5oZXJpdC5sZW5ndGg7DQoNCiAgICAgICAgICAgICAgd2hpbGUgKG5vZGVJbmhlcml0TGVuZ3RoLS0pIHsNCiAgICAgICAgICAgICAgICBub2RlSW5oZXJpdEl0ZW0gPSBub2RlSW5oZXJpdFtub2RlSW5oZXJpdExlbmd0aF07DQoNCiAgICAgICAgICAgICAgICBpZiAobm9kZUF0dHJDYWNoZVtub2RlSW5oZXJpdEl0ZW1dICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgIGlmIChub2RlSW5oZXJpdEl0ZW0gPT0gJ2NsYXNzJykgew0KICAgICAgICAgICAgICAgICAgICBzdHlsZXJDbGFzcyArPSBub2RlQXR0ckNhY2hlW25vZGVJbmhlcml0SXRlbV0gKyAnICc7DQogICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBzdHlsZXIuc2V0QXR0cmlidXRlKG5vZGVJbmhlcml0SXRlbSwgbm9kZUluaGVyaXRJdGVtID09ICdpZCcgPyBiYXNlQ2xhc3MgKyAnLScgKyBub2RlQXR0ckNhY2hlW25vZGVJbmhlcml0SXRlbV0gOiBub2RlQXR0ckNhY2hlW25vZGVJbmhlcml0SXRlbV0pOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBzZXQgaW5wdXQncyB0eXBlIGNsYXNzDQogICAgICAgICAgICBzdHlsZXJDbGFzcyArPSBzZXR0aW5nc1tub2RlVHlwZSArICdDbGFzcyddOw0KDQogICAgICAgICAgICAvLyBzZXQgc3R5bGVyJ3Mga2V5DQogICAgICAgICAgICBzdHlsZXJDbGFzcyArPSAnICcgKyBkaXZDbGFzcyArICcgJyArIGtleUNsYXNzOw0KDQogICAgICAgICAgICAvLyBhcHBlbmQgYXJlYSBzdHlsZXMNCiAgICAgICAgICAgIGlmIChzZXR0aW5ncy5hcmVhICYmIHN0eWxlQXJlYSkgew0KICAgICAgICAgICAgICBhcmVhID0gKCcnICsgc2V0dGluZ3MuYXJlYSkucmVwbGFjZSgvJXxweHxlbXxcK3wtL2csICcnKSB8IDA7DQoNCiAgICAgICAgICAgICAgaWYgKGFyZWEpIHsNCg0KICAgICAgICAgICAgICAgIC8vIGFwcGVuZCBhcmVhJ3Mgc3R5bGVzDQogICAgICAgICAgICAgICAgaWYgKCFhcmVhc1thcmVhXSkgew0KICAgICAgICAgICAgICAgICAgc3R5bGUoc3R5bGVBcmVhLnJlcGxhY2UoLyMvZywgJy0nICsgYXJlYSArICclJyksIGZhbHNlLCBhcmVhKTsNCiAgICAgICAgICAgICAgICAgIGFyZWFzW2FyZWFdID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBzdHlsZXJDbGFzcyArPSAnICcgKyBhcmVhQ2xhc3MgKyBhcmVhOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIHVwZGF0ZSBzdHlsZXIncyBjbGFzcw0KICAgICAgICAgICAgc3R5bGVyLmNsYXNzTmFtZSA9IHN0eWxlckNsYXNzICsgZmFzdENsYXNzOw0KDQogICAgICAgICAgICAvLyB1cGRhdGUgbm9kZSdzIGNsYXNzDQogICAgICAgICAgICBub2RlLmNsYXNzTmFtZSA9ICghIW5vZGVTdHJpbmcgPyBub2RlU3RyaW5nICsgJyAnIDogJycpICsgbm9kZUNsYXNzICsgJyAnICsga2V5Q2xhc3M7DQoNCiAgICAgICAgICAgIC8vIHJlcGxhY2Ugbm9kZQ0KICAgICAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChzdHlsZXIsIG5vZGUpOw0KDQogICAgICAgICAgICAvLyBhcHBlbmQgbm9kZQ0KICAgICAgICAgICAgc3R5bGVyLmFwcGVuZENoaWxkKG5vZGUpOw0KDQogICAgICAgICAgICAvLyBhcHBlbmQgYWRkaXRpb25zDQogICAgICAgICAgICBpZiAoISFzZXR0aW5ncy5pbnNlcnQpIHsNCiAgICAgICAgICAgICAgJChzdHlsZXIpLmFwcGVuZChzZXR0aW5ncy5pbnNlcnQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBzZXQgcmVsYXRpdmUgcG9zaXRpb24NCiAgICAgICAgICAgIGlmIChhcmVhKSB7DQoNCiAgICAgICAgICAgICAgLy8gZ2V0IHN0eWxlcidzIHBvc2l0aW9uDQogICAgICAgICAgICAgIGlmIChjb21wdXRlZCkgew0KICAgICAgICAgICAgICAgIHN0eWxlclN0eWxlID0gY29tcHV0ZWQoc3R5bGVyLCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKCdwb3NpdGlvbicpOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHN0eWxlclN0eWxlID0gc3R5bGVyLmN1cnJlbnRTdHlsZS5wb3NpdGlvbjsNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIC8vIHVwZGF0ZSBzdHlsZXIncyBwb3NpdGlvbg0KICAgICAgICAgICAgICBpZiAoc3R5bGVyU3R5bGUgPT0gJ3N0YXRpYycpIHsNCiAgICAgICAgICAgICAgICBzdHlsZXIuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIG9wZXJhdGUNCiAgICAgICAgICAgIG9wZXJhdGUobm9kZSwgc3R5bGVyLCBrZXksICd1cGRhdGVkJywgdHJ1ZSwgZmFsc2UsIGFqYXgpOw0KICAgICAgICAgICAgaGFzaGVzW2tleV0uZG9uZSA9IHRydWU7DQoNCiAgICAgICAgICAgIC8vIGlmQ3JlYXRlZCBjYWxsYmFjaw0KICAgICAgICAgICAgaWYgKCFzaWxlbnQpIHsNCiAgICAgICAgICAgICAgY2FsbGJhY2sobm9kZSwga2V5LCAnQ3JlYXRlZCcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfTsNCg0KICAgICAgLy8gb3BlcmF0aW9ucyBjZW50ZXINCiAgICAgIHZhciBvcGVyYXRlID0gZnVuY3Rpb24obm9kZSwgcGFyZW50LCBrZXksIG1ldGhvZCwgc2lsZW50LCBiZWZvcmUsIGFqYXgpIHsNCiAgICAgICAgdmFyIHNldHRpbmdzID0gaGFzaGVzW2tleV07DQogICAgICAgIHZhciBzdGF0ZXMgPSB7fTsNCiAgICAgICAgdmFyIGNoYW5nZXMgPSB7fTsNCg0KICAgICAgICAvLyBjdXJyZW50IHN0YXRlcw0KICAgICAgICBzdGF0ZXMuY2hlY2tlZCA9IFtub2RlLmNoZWNrZWQsICdDaGVja2VkJywgJ1VuY2hlY2tlZCddOw0KDQogICAgICAgIGlmICgoIWJlZm9yZSB8fCBhamF4KSAmJiBtZXRob2QgIT09ICdjbGljaycpIHsNCiAgICAgICAgICBzdGF0ZXMuZGlzYWJsZWQgPSBbbm9kZS5kaXNhYmxlZCwgJ0Rpc2FibGVkJywgJ0VuYWJsZWQnXTsNCiAgICAgICAgICBzdGF0ZXMuaW5kZXRlcm1pbmF0ZSA9IFtub2RlLmdldEF0dHJpYnV0ZSgnaW5kZXRlcm1pbmF0ZScpID09ICd0cnVlJyB8fCAhIW5vZGUuaW5kZXRlcm1pbmF0ZSwgJ0luZGV0ZXJtaW5hdGUnLCAnRGV0ZXJtaW5hdGUnXTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIG1ldGhvZHMNCiAgICAgICAgaWYgKG1ldGhvZCA9PSAndXBkYXRlZCcgfHwgbWV0aG9kID09ICdjbGljaycpIHsNCiAgICAgICAgICBjaGFuZ2VzLmNoZWNrZWQgPSBiZWZvcmUgPyAhc3RhdGVzLmNoZWNrZWRbMF0gOiBzdGF0ZXMuY2hlY2tlZFswXTsNCg0KICAgICAgICAgIGlmICgoIWJlZm9yZSB8fCBhamF4KSAmJiBtZXRob2QgIT09ICdjbGljaycpIHsNCiAgICAgICAgICAgIGNoYW5nZXMuZGlzYWJsZWQgPSBzdGF0ZXMuZGlzYWJsZWRbMF07DQogICAgICAgICAgICBjaGFuZ2VzLmluZGV0ZXJtaW5hdGUgPSBzdGF0ZXMuaW5kZXRlcm1pbmF0ZVswXTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgfSBlbHNlIGlmIChtZXRob2QgPT0gJ2NoZWNrZWQnIHx8IG1ldGhvZCA9PSAndW5jaGVja2VkJykgew0KICAgICAgICAgIGNoYW5nZXMuY2hlY2tlZCA9IG1ldGhvZCA9PSAnY2hlY2tlZCc7DQoNCiAgICAgICAgfSBlbHNlIGlmIChtZXRob2QgPT0gJ2Rpc2FibGVkJyB8fCBtZXRob2QgPT0gJ2VuYWJsZWQnKSB7DQogICAgICAgICAgY2hhbmdlcy5kaXNhYmxlZCA9IG1ldGhvZCA9PSAnZGlzYWJsZWQnOw0KDQogICAgICAgIH0gZWxzZSBpZiAobWV0aG9kID09ICdpbmRldGVybWluYXRlJyB8fCBtZXRob2QgPT0gJ2RldGVybWluYXRlJykgew0KICAgICAgICAgIGNoYW5nZXMuaW5kZXRlcm1pbmF0ZSA9IG1ldGhvZCAhPT0gJ2RldGVybWluYXRlJzsNCg0KICAgICAgICAvLyAidG9nZ2xlIiBtZXRob2QNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBjaGFuZ2VzLmNoZWNrZWQgPSAhc3RhdGVzLmNoZWNrZWRbMF07DQogICAgICAgIH0NCg0KICAgICAgICAvLyBhcHBseSBjaGFuZ2VzDQogICAgICAgIGNoYW5nZShub2RlLCBwYXJlbnQsIHN0YXRlcywgY2hhbmdlcywga2V5LCBzZXR0aW5ncywgbWV0aG9kLCBzaWxlbnQsIGJlZm9yZSwgYWpheCk7DQogICAgICB9Ow0KDQogICAgICAvLyBzdGF0ZSBjaGFuZ2VyDQogICAgICB2YXIgY2hhbmdlID0gZnVuY3Rpb24obm9kZSwgcGFyZW50LCBzdGF0ZXMsIGNoYW5nZXMsIGtleSwgc2V0dGluZ3MsIG1ldGhvZCwgc2lsZW50LCBiZWZvcmUsIGFqYXgsIGxvb3ApIHsNCiAgICAgICAgdmFyIHR5cGUgPSBub2RlLnR5cGU7DQogICAgICAgIHZhciB0eXBlQ2FwaXRhbCA9IHR5cGUgPT0gJ3JhZGlvJyA/ICdSYWRpbycgOiAnQ2hlY2tib3gnOw0KICAgICAgICB2YXIgcHJvcGVydHk7DQogICAgICAgIHZhciB2YWx1ZTsNCiAgICAgICAgdmFyIGNsYXNzZXM7DQogICAgICAgIHZhciBpbnB1dENsYXNzOw0KICAgICAgICB2YXIgbGFiZWw7DQogICAgICAgIHZhciBsYWJlbENsYXNzID0gJ0xhYmVsQ2xhc3MnOw0KICAgICAgICB2YXIgZm9ybTsNCiAgICAgICAgdmFyIHJhZGlvczsNCiAgICAgICAgdmFyIHJhZGlvc0xlbmd0aDsNCiAgICAgICAgdmFyIHJhZGlvOw0KICAgICAgICB2YXIgcmFkaW9LZXk7DQogICAgICAgIHZhciByYWRpb1N0YXRlczsNCiAgICAgICAgdmFyIHJhZGlvQ2hhbmdlczsNCiAgICAgICAgdmFyIGNoYW5nZWQ7DQogICAgICAgIHZhciB0b2dnbGVkOw0KDQogICAgICAgIC8vIGNoZWNrIHBhcmVudA0KICAgICAgICBpZiAoIXBhcmVudCkgew0KICAgICAgICAgIHBhcmVudCA9IGNsb3Nlc3Qobm9kZSwgJ2RpdicsIHNldHRpbmdzLmNsYXNzTmFtZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBjb250aW51ZSBpZiBwYXJlbnQgZXhpc3RzDQogICAgICAgIGlmIChwYXJlbnQpIHsNCg0KICAgICAgICAgIC8vIGRldGVjdCBjaGFuZ2VzDQogICAgICAgICAgZm9yIChwcm9wZXJ0eSBpbiBjaGFuZ2VzKSB7DQogICAgICAgICAgICB2YWx1ZSA9IGNoYW5nZXNbcHJvcGVydHldOw0KDQogICAgICAgICAgICAvLyB1cGRhdGUgbm9kZSdzIHByb3BlcnR5DQogICAgICAgICAgICBpZiAoc3RhdGVzW3Byb3BlcnR5XVswXSAhPT0gdmFsdWUgJiYgbWV0aG9kICE9PSAndXBkYXRlZCcgJiYgbWV0aG9kICE9PSAnY2xpY2snKSB7DQogICAgICAgICAgICAgIG5vZGVbcHJvcGVydHldID0gdmFsdWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIHVwZGF0ZSBhamF4IGF0dHJpYnV0ZXMNCiAgICAgICAgICAgIGlmIChhamF4KSB7DQogICAgICAgICAgICAgIGlmICh2YWx1ZSkgew0KICAgICAgICAgICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKHByb3BlcnR5LCBwcm9wZXJ0eSk7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUocHJvcGVydHkpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIHVwZGF0ZSBrZXkncyBwcm9wZXJ0eQ0KICAgICAgICAgICAgaWYgKHNldHRpbmdzW3Byb3BlcnR5XSAhPT0gdmFsdWUpIHsNCiAgICAgICAgICAgICAgc2V0dGluZ3NbcHJvcGVydHldID0gdmFsdWU7DQogICAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOw0KDQogICAgICAgICAgICAgIGlmIChwcm9wZXJ0eSA9PSAnY2hlY2tlZCcpIHsNCiAgICAgICAgICAgICAgICB0b2dnbGVkID0gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgIC8vIGZpbmQgYXNzaWduZWQgcmFkaW9zDQogICAgICAgICAgICAgICAgaWYgKCFsb29wICYmIHZhbHVlICYmICghIWhhc2hlc1trZXldLmRvbmUgfHwgYWpheCkgJiYgdHlwZSA9PSAncmFkaW8nICYmICEhbm9kZS5uYW1lKSB7DQogICAgICAgICAgICAgICAgICBmb3JtID0gY2xvc2VzdChub2RlLCAnZm9ybScsICcnKTsNCiAgICAgICAgICAgICAgICAgIHJhZGlvcyA9ICdpbnB1dFtuYW1lPSInICsgbm9kZS5uYW1lICsgJyJdJzsNCiAgICAgICAgICAgICAgICAgIHJhZGlvcyA9IGZvcm0gJiYgIWFqYXggPyAkKGZvcm0pLmZpbmQocmFkaW9zKSA6ICQocmFkaW9zKTsNCiAgICAgICAgICAgICAgICAgIHJhZGlvc0xlbmd0aCA9IHJhZGlvcy5sZW5ndGg7DQoNCiAgICAgICAgICAgICAgICAgIHdoaWxlIChyYWRpb3NMZW5ndGgtLSkgew0KICAgICAgICAgICAgICAgICAgICByYWRpbyA9IHJhZGlvc1tyYWRpb3NMZW5ndGhdOw0KICAgICAgICAgICAgICAgICAgICByYWRpb0tleSA9IGV4dHJhY3QocmFkaW8uY2xhc3NOYW1lKTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyB0b2dnbGUgcmFkaW9zDQogICAgICAgICAgICAgICAgICAgIGlmIChub2RlICE9PSByYWRpbyAmJiBoYXNoZXNbcmFkaW9LZXldICYmIGhhc2hlc1tyYWRpb0tleV0uY2hlY2tlZCkgew0KICAgICAgICAgICAgICAgICAgICAgIHJhZGlvU3RhdGVzID0ge2NoZWNrZWQ6IFt0cnVlLCAnQ2hlY2tlZCcsICdVbmNoZWNrZWQnXX07DQogICAgICAgICAgICAgICAgICAgICAgcmFkaW9DaGFuZ2VzID0ge2NoZWNrZWQ6IGZhbHNlfTsNCg0KICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZShyYWRpbywgZmFsc2UsIHJhZGlvU3RhdGVzLCByYWRpb0NoYW5nZXMsIHJhZGlvS2V5LCBoYXNoZXNbcmFkaW9LZXldLCAndXBkYXRlZCcsIHNpbGVudCwgYmVmb3JlLCBhamF4LCB0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIC8vIGNhY2hlIGNsYXNzZXMNCiAgICAgICAgICAgICAgY2xhc3NlcyA9IFsNCiAgICAgICAgICAgICAgICBzZXR0aW5nc1twcm9wZXJ0eSArICdDbGFzcyddLCAvLyAwLCBleGFtcGxlOiBjaGVja2VkQ2xhc3MNCiAgICAgICAgICAgICAgICBzZXR0aW5nc1twcm9wZXJ0eSArIHR5cGVDYXBpdGFsICsgJ0NsYXNzJ10sIC8vIDEsIGV4YW1wbGU6IGNoZWNrZWRDaGVja2JveENsYXNzDQogICAgICAgICAgICAgICAgc2V0dGluZ3Nbc3RhdGVzW3Byb3BlcnR5XVsxXSArICdDbGFzcyddLCAvLyAyLCBleGFtcGxlOiB1bmNoZWNrZWRDbGFzcw0KICAgICAgICAgICAgICAgIHNldHRpbmdzW3N0YXRlc1twcm9wZXJ0eV1bMV0gKyB0eXBlQ2FwaXRhbCArICdDbGFzcyddLCAvLyAzLCBleGFtcGxlOiB1bmNoZWNrZWRDaGVja2JveENsYXNzDQogICAgICAgICAgICAgICAgc2V0dGluZ3NbcHJvcGVydHkgKyBsYWJlbENsYXNzXSAvLyA0LCBleGFtcGxlOiBjaGVja2VkTGFiZWxDbGFzcw0KICAgICAgICAgICAgICBdOw0KDQogICAgICAgICAgICAgIC8vIHZhbHVlID09IGZhbHNlDQogICAgICAgICAgICAgIGlucHV0Q2xhc3MgPSBbY2xhc3Nlc1szXSB8fCBjbGFzc2VzWzJdLCBjbGFzc2VzWzFdIHx8IGNsYXNzZXNbMF1dOw0KDQogICAgICAgICAgICAgIC8vIHZhbHVlID09IHRydWUNCiAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7DQogICAgICAgICAgICAgICAgaW5wdXRDbGFzcy5yZXZlcnNlKCk7DQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAvLyB1cGRhdGUgcGFyZW50J3MgY2xhc3MNCiAgICAgICAgICAgICAgdG9nZ2xlKHBhcmVudCwgaW5wdXRDbGFzcyk7DQoNCiAgICAgICAgICAgICAgLy8gdXBkYXRlIGxhYmVscydzIGNsYXNzDQogICAgICAgICAgICAgIGlmICghIXNldHRpbmdzLm1pcnJvciAmJiAhIWNsYXNzZXNbNF0pIHsNCiAgICAgICAgICAgICAgICBsYWJlbCA9ICQoJ2xhYmVsLicgKyBzZXR0aW5ncy5lc2MpOw0KDQogICAgICAgICAgICAgICAgd2hpbGUgKGxhYmVsLmxlbmd0aC0tKSB7DQogICAgICAgICAgICAgICAgICB0b2dnbGUobGFiZWxbbGFiZWwubGVuZ3RoXSwgY2xhc3Nlc1s0XSwgdmFsdWUgPyAxIDogMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgLy8gY2FsbGJhY2sNCiAgICAgICAgICAgICAgaWYgKCFzaWxlbnQgfHwgbG9vcCkgew0KICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5vZGUsIGtleSwgc3RhdGVzW3Byb3BlcnR5XVt2YWx1ZSA/IDEgOiAyXSk7IC8vIGlmQ2hlY2tlZCBvciBpZlVuY2hlY2tlZA0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gYWRkaXRpb25hbCBjYWxsYmFja3MNCiAgICAgICAgICBpZiAoIXNpbGVudCB8fCBsb29wKSB7DQogICAgICAgICAgICBpZiAoY2hhbmdlZCkgew0KICAgICAgICAgICAgICBjYWxsYmFjayhub2RlLCBrZXksICdDaGFuZ2VkJyk7IC8vIGlmQ2hhbmdlZA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAodG9nZ2xlZCkgew0KICAgICAgICAgICAgICBjYWxsYmFjayhub2RlLCBrZXksICdUb2dnbGVkJyk7IC8vIGlmVG9nZ2xlZA0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIGN1cnNvciBhZGRpdGlvbg0KICAgICAgICAgIGlmICghIXNldHRpbmdzLmN1cnNvciAmJiAhaXNNb2JpbGUpIHsNCg0KICAgICAgICAgICAgLy8gJ3BvaW50ZXInIGZvciBlbmFibGVkDQogICAgICAgICAgICBpZiAoIXNldHRpbmdzLmRpc2FibGVkICYmICFzZXR0aW5ncy5wb2ludGVyKSB7DQogICAgICAgICAgICAgIHBhcmVudC5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7DQogICAgICAgICAgICAgIHNldHRpbmdzLnBvaW50ZXIgPSB0cnVlOw0KDQogICAgICAgICAgICAvLyAnZGVmYXVsdCcgZm9yIGRpc2FibGVkDQogICAgICAgICAgICB9IGVsc2UgaWYgKHNldHRpbmdzLmRpc2FibGVkICYmIHNldHRpbmdzLnBvaW50ZXIpIHsNCiAgICAgICAgICAgICAgcGFyZW50LnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0JzsNCiAgICAgICAgICAgICAgc2V0dGluZ3MucG9pbnRlciA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIHVwZGF0ZSBzZXR0aW5ncw0KICAgICAgICAgIGhhc2hlc1trZXldID0gc2V0dGluZ3M7DQogICAgICAgIH0NCiAgICAgIH07DQoNCiAgICAgIC8vIHBsdWdpbiBkZWZpbml0aW9uDQogICAgICAkLmZuLmljaGVjayA9IGZ1bmN0aW9uKG9wdGlvbnMsIGZpcmUpIHsNCg0KICAgICAgICAvLyBkZXRlY3QgbWV0aG9kcw0KICAgICAgICBpZiAoL14oY2hlY2tlZHx1bmNoZWNrZWR8aW5kZXRlcm1pbmF0ZXxkZXRlcm1pbmF0ZXxkaXNhYmxlZHxlbmFibGVkfHVwZGF0ZWR8dG9nZ2xlfGRlc3Ryb3l8ZGF0YXxzdHlsZXIpJC8udGVzdChvcHRpb25zKSkgew0KICAgICAgICAgIHZhciBpdGVtcyA9IGluc3BlY3QodGhpcyk7DQogICAgICAgICAgdmFyIGl0ZW1zTGVuZ3RoID0gaXRlbXMubGVuZ3RoOw0KDQogICAgICAgICAgLy8gbG9vcCB0aHJvdWdoIGlucHV0cw0KICAgICAgICAgIHdoaWxlIChpdGVtc0xlbmd0aC0tKSB7DQogICAgICAgICAgICB2YXIgaXRlbSA9IGl0ZW1zW2l0ZW1zTGVuZ3RoXTsNCiAgICAgICAgICAgIHZhciBrZXkgPSBleHRyYWN0KGl0ZW0uY2xhc3NOYW1lKTsNCg0KICAgICAgICAgICAgaWYgKGtleSkgew0KDQogICAgICAgICAgICAgIC8vICdkYXRhJyBtZXRob2QNCiAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT0gJ2RhdGEnKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGhhc2hlc1trZXldOw0KDQogICAgICAgICAgICAgIC8vICdzdHlsZXInIG1ldGhvZA0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMgPT0gJ3N0eWxlcicpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gY2xvc2VzdChpdGVtLCAnZGl2JywgaGFzaGVzW2tleV0uY2xhc3NOYW1lKTsNCg0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zID09ICdkZXN0cm95Jykgew0KICAgICAgICAgICAgICAgICAgdGlkeShpdGVtLCBrZXksICdEZXN0cm95ZWQnKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgb3BlcmF0ZShpdGVtLCBmYWxzZSwga2V5LCBvcHRpb25zKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBjYWxsYmFjaw0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZmlyZSA9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgICAgICBmaXJlKGl0ZW0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAvLyBiYXNpYyBzZXR1cA0KICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zID09ICdvYmplY3QnIHx8ICFvcHRpb25zKSB7DQogICAgICAgICAgcHJvY2Vzcyh0aGlzLCBvcHRpb25zIHx8IHt9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIGNoYWluDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfTsNCg0KICAgICAgLy8gY2FjaGVkIGxhc3Qga2V5DQogICAgICB2YXIgbGFzdEtleTsNCg0KICAgICAgLy8gYmluZCBsYWJlbCBhbmQgc3R5bGVyDQogICAgICAkKGRvYykub24oJ2NsaWNrLmkgJyArIGhvdmVyICsgdGFwLCAnbGFiZWwuJyArIGxhYmVsQ2xhc3MgKyAnLGRpdi4nICsgZGl2Q2xhc3MsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgIHZhciBzZWxmID0gdGhpczsNCiAgICAgICAgdmFyIGtleSA9IGV4dHJhY3Qoc2VsZi5jbGFzc05hbWUpOw0KDQogICAgICAgIGlmIChrZXkpIHsNCiAgICAgICAgICB2YXIgZW1pdHRlciA9IGV2ZW50LnR5cGU7DQogICAgICAgICAgdmFyIHNldHRpbmdzID0gaGFzaGVzW2tleV07DQogICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IHNldHRpbmdzLmVzYzsgLy8gZXNjYXBlZCBjbGFzcyBuYW1lDQogICAgICAgICAgdmFyIGRpdiA9IHNlbGYudGFnTmFtZSA9PSAnRElWJzsNCiAgICAgICAgICB2YXIgaW5wdXQ7DQogICAgICAgICAgdmFyIHRhcmdldDsNCiAgICAgICAgICB2YXIgcGFydG5lcjsNCiAgICAgICAgICB2YXIgYWN0aXZhdGU7DQogICAgICAgICAgdmFyIHN0YXRlcyA9IFsNCiAgICAgICAgICAgIFsnbGFiZWwnLCBzZXR0aW5ncy5hY3RpdmVMYWJlbENsYXNzLCBzZXR0aW5ncy5ob3ZlckxhYmVsQ2xhc3NdLA0KICAgICAgICAgICAgWydkaXYnLCBzZXR0aW5ncy5hY3RpdmVDbGFzcywgc2V0dGluZ3MuaG92ZXJDbGFzc10NCiAgICAgICAgICBdOw0KDQogICAgICAgICAgLy8gcmV2ZXJzZSBhcnJheQ0KICAgICAgICAgIGlmIChkaXYpIHsNCiAgICAgICAgICAgIHN0YXRlcy5yZXZlcnNlKCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIA0KICAgICAgICAgIC8vIGFjdGl2ZSBzdGF0ZQ0KICAgICAgICAgIGlmIChlbWl0dGVyID09IHRhcFN0YXJ0IHx8IGVtaXR0ZXIgPT0gdGFwRW5kKSB7DQoNCiAgICAgICAgICAgIC8vIHRvZ2dsZSBzZWxmJ3MgYWN0aXZlIGNsYXNzDQogICAgICAgICAgICBpZiAoISFzdGF0ZXNbMF1bMV0pIHsNCiAgICAgICAgICAgICAgdG9nZ2xlKHNlbGYsIHN0YXRlc1swXVsxXSwgZW1pdHRlciA9PSB0YXBTdGFydCA/IDEgOiAwKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gdG9nZ2xlIHBhcnRuZXIncyBhY3RpdmUgY2xhc3MNCiAgICAgICAgICAgIGlmICghIXNldHRpbmdzLm1pcnJvciAmJiAhIXN0YXRlc1sxXVsxXSkgew0KICAgICAgICAgICAgICBwYXJ0bmVyID0gJChzdGF0ZXNbMV1bMF0gKyAnLicgKyBjbGFzc05hbWUpOw0KDQogICAgICAgICAgICAgIHdoaWxlIChwYXJ0bmVyLmxlbmd0aC0tKSB7DQogICAgICAgICAgICAgICAgdG9nZ2xlKHBhcnRuZXJbcGFydG5lci5sZW5ndGhdLCBzdGF0ZXNbMV1bMV0sIGVtaXR0ZXIgPT0gdGFwU3RhcnQgPyAxIDogMCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gZmFzdCBjbGljaw0KICAgICAgICAgICAgaWYgKGRpdiAmJiBlbWl0dGVyID09IHRhcEVuZCAmJiAhIXNldHRpbmdzLnRhcCAmJiBpc01vYmlsZSAmJiBpc1BvaW50ZXIgJiYgIW9wZXJhTWluaSkgew0KICAgICAgICAgICAgICBhY3RpdmF0ZSA9IHRydWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyBob3ZlciBzdGF0ZQ0KICAgICAgICAgIH0gZWxzZSBpZiAoZW1pdHRlciA9PSBob3ZlclN0YXJ0IHx8IGVtaXR0ZXIgPT0gaG92ZXJFbmQpIHsNCg0KICAgICAgICAgICAgLy8gdG9nZ2xlIHNlbGYncyBob3ZlciBjbGFzcw0KICAgICAgICAgICAgaWYgKCEhc3RhdGVzWzBdWzJdKSB7DQogICAgICAgICAgICAgIHRvZ2dsZShzZWxmLCBzdGF0ZXNbMF1bMl0sIGVtaXR0ZXIgPT0gaG92ZXJTdGFydCA/IDEgOiAwKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gdG9nZ2xlIHBhcnRuZXIncyBob3ZlciBjbGFzcw0KICAgICAgICAgICAgaWYgKCEhc2V0dGluZ3MubWlycm9yICYmICEhc3RhdGVzWzFdWzJdKSB7DQogICAgICAgICAgICAgIHBhcnRuZXIgPSAkKHN0YXRlc1sxXVswXSArICcuJyArIGNsYXNzTmFtZSk7DQoNCiAgICAgICAgICAgICAgd2hpbGUgKHBhcnRuZXIubGVuZ3RoLS0pIHsNCiAgICAgICAgICAgICAgICB0b2dnbGUocGFydG5lcltwYXJ0bmVyLmxlbmd0aF0sIHN0YXRlc1sxXVsyXSwgZW1pdHRlciA9PSBob3ZlclN0YXJ0ID8gMSA6IDApOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIGZhc3QgY2xpY2sNCiAgICAgICAgICAgIGlmIChkaXYgJiYgZW1pdHRlciA9PSBob3ZlckVuZCAmJiAhIXNldHRpbmdzLnRhcCAmJiBpc01vYmlsZSAmJiBpc1RvdWNoICYmICFvcGVyYU1pbmkpIHsNCiAgICAgICAgICAgICAgYWN0aXZhdGUgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gY2xpY2sNCiAgICAgICAgICB9IGVsc2UgaWYgKGRpdikgew0KICAgICAgICAgICAgaWYgKCEoaXNNb2JpbGUgJiYgKGlzVG91Y2ggfHwgaXNQb2ludGVyKSkgfHwgISEhc2V0dGluZ3MudGFwIHx8IG9wZXJhTWluaSkgew0KICAgICAgICAgICAgICBhY3RpdmF0ZSA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gdHJpZ2dlciBpbnB1dCdzIGNsaWNrDQogICAgICAgICAgaWYgKGFjdGl2YXRlKSB7DQoNCiAgICAgICAgICAgIC8vIGN1cnJlbnRUYXJnZXQgaGFjaw0KICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgdGFyZ2V0ID0gZXZlbnQuY3VycmVudFRhcmdldCB8fCB7fTsNCg0KICAgICAgICAgICAgICBpZiAodGFyZ2V0LnRhZ05hbWUgIT09ICdMQUJFTCcpIHsNCiAgICAgICAgICAgICAgICBpZiAoIXNldHRpbmdzLmNoYW5nZSB8fCAoK25ldyBEYXRlKCkgLSBzZXR0aW5ncy5jaGFuZ2UgPiAxMDApKSB7DQogICAgICAgICAgICAgICAgICBpbnB1dCA9ICQoc2VsZikuZmluZCgnaW5wdXQuJyArIGNsYXNzTmFtZSkuY2xpY2soKTsNCg0KICAgICAgICAgICAgICAgICAgaWYgKGllIHx8IG9wZXJhTWluaSkgew0KICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGFuZ2UoKTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIDIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAvLyBiaW5kIGlucHV0DQogICAgICB9KS5vbignY2xpY2suaSBjaGFuZ2UuaSBmb2N1c2luLmkgZm9jdXNvdXQuaSBrZXl1cC5pIGtleWRvd24uaScsICdpbnB1dC4nICsgbm9kZUNsYXNzLCBmdW5jdGlvbihldmVudCkgew0KICAgICAgICB2YXIgc2VsZiA9IHRoaXM7DQogICAgICAgIHZhciBrZXkgPSBleHRyYWN0KHNlbGYuY2xhc3NOYW1lKTsNCiAgICAgICAgaWYgKGtleSkgew0KICAgICAgICAgIHZhciBlbWl0dGVyID0gZXZlbnQudHlwZTsNCiAgICAgICAgICB2YXIgc2V0dGluZ3MgPSBoYXNoZXNba2V5XTsNCiAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gc2V0dGluZ3MuZXNjOyAvLyBlc2NhcGVkIGNsYXNzIG5hbWUNCiAgICAgICAgICB2YXIgcGFyZW50ID0gZW1pdHRlciA9PSAnY2xpY2snID8gZmFsc2UgOiBjbG9zZXN0KHNlbGYsICdkaXYnLCBzZXR0aW5ncy5jbGFzc05hbWUpOw0KICAgICAgICAgIHZhciBsYWJlbDsNCiAgICAgICAgICB2YXIgc3RhdGVzOw0KDQogICAgICAgICAgLy8gY2xpY2sNCiAgICAgICAgICBpZiAoZW1pdHRlciA9PSAnY2xpY2snKSB7DQogICAgICAgICAgICBoYXNoZXNba2V5XS5jaGFuZ2UgPSArbmV3IERhdGUoKTsNCg0KICAgICAgICAgICAgLy8gcHJldmVudCBldmVudCBidWJibGluZyB0byBwYXJlbnQNCiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOw0KDQogICAgICAgICAgLy8gY2hhbmdlDQogICAgICAgICAgfSBlbHNlIGlmIChlbWl0dGVyID09ICdjaGFuZ2UnKSB7DQoNCiAgICAgICAgICAgIGlmIChwYXJlbnQgJiYgIXNlbGYuZGlzYWJsZWQpIHsNCiAgICAgICAgICAgICAgb3BlcmF0ZShzZWxmLCBwYXJlbnQsIGtleSwgJ2NsaWNrJyk7IC8vICdjbGljaycgbWV0aG9kDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyBmb2N1cyBzdGF0ZQ0KICAgICAgICAgIH0gZWxzZSBpZiAofmVtaXR0ZXIuaW5kZXhPZignZm9jdXMnKSkgew0KICAgICAgICAgICAgc3RhdGVzID0gW3NldHRpbmdzLmZvY3VzQ2xhc3MsIHNldHRpbmdzLmZvY3VzTGFiZWxDbGFzc107DQoNCiAgICAgICAgICAgIC8vIHRvZ2dsZSBwYXJlbnQncyBmb2N1cyBjbGFzcw0KICAgICAgICAgICAgaWYgKCEhc3RhdGVzWzBdICYmIHBhcmVudCkgew0KICAgICAgICAgICAgICB0b2dnbGUocGFyZW50LCBzdGF0ZXNbMF0sIGVtaXR0ZXIgPT0gJ2ZvY3VzaW4nID8gMSA6IDApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyB0b2dnbGUgbGFiZWwncyBmb2N1cyBjbGFzcw0KICAgICAgICAgICAgaWYgKCEhc2V0dGluZ3MubWlycm9yICYmICEhc3RhdGVzWzFdKSB7DQogICAgICAgICAgICAgIGxhYmVsID0gJCgnbGFiZWwuJyArIGNsYXNzTmFtZSk7DQoNCiAgICAgICAgICAgICAgd2hpbGUgKGxhYmVsLmxlbmd0aC0tKSB7DQogICAgICAgICAgICAgICAgdG9nZ2xlKGxhYmVsW2xhYmVsLmxlbmd0aF0sIHN0YXRlc1sxXSwgZW1pdHRlciA9PSAnZm9jdXNpbicgPyAxIDogMCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIGtleXVwIG9yIGtleWRvd24gKGV2ZW50IGZpcmVkIGJlZm9yZSBzdGF0ZSBpcyBjaGFuZ2VkLCBleGNlcHQgT3BlcmEgOS0xMikNCiAgICAgICAgICB9IGVsc2UgaWYgKHBhcmVudCAmJiAhc2VsZi5kaXNhYmxlZCkgew0KDQogICAgICAgICAgICAvLyBrZXl1cA0KICAgICAgICAgICAgaWYgKGVtaXR0ZXIgPT0gJ2tleXVwJykgew0KDQogICAgICAgICAgICAgIC8vIHNwYWNlYmFyIG9yIGFycm93DQogICAgICAgICAgICAgIGlmIChzZWxmLnR5cGUgPT0gJ2NoZWNrYm94JyAmJiBldmVudC5rZXlDb2RlID09IDMyICYmIHNldHRpbmdzLmtleWRvd24gfHwgc2VsZi50eXBlID09ICdyYWRpbycgJiYgIXNlbGYuY2hlY2tlZCkgew0KICAgICAgICAgICAgICAgIG9wZXJhdGUoc2VsZiwgcGFyZW50LCBrZXksICdjbGljaycsIGZhbHNlLCB0cnVlKTsgLy8gJ3RvZ2dsZScgbWV0aG9kDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgbGFzdEtleSA9IGtleTsNCiAgICAgICAgICAgICAgaGFzaGVzW2tleV0ua2V5ZG93biA9IGhhc2hlc1tsYXN0S2V5XS5rZXlkb3duID0gZmFsc2U7DQoNCiAgICAgICAgICAgIC8vIGtleWRvd24NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGxhc3RLZXkgPSBrZXk7DQogICAgICAgICAgICAgIGhhc2hlc1trZXldLmtleWRvd24gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAvLyBkb21yZWFkeQ0KICAgICAgfSkucmVhZHkoZnVuY3Rpb24oKSB7DQoNCiAgICAgICAgLy8gYXV0byBpbml0DQogICAgICAgIGlmICh3aW4uaWNoZWNrLmF1dG9Jbml0KSB7DQogICAgICAgICAgJCgnLicgKyBiYXNlQ2xhc3MpLmljaGVjaygpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gYXV0byBhamF4DQogICAgICAgIGlmICh3aW4ualF1ZXJ5KSB7DQoNCiAgICAgICAgICAvLyBib2R5IHNlbGVjdG9yIGNhY2hlDQogICAgICAgICAgdmFyIGJvZHkgPSBkb2MuYm9keSB8fCBkb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXTsNCg0KICAgICAgICAgIC8vIGFwcGx5IGNvbnZlcnRlcg0KICAgICAgICAgICQuYWpheFNldHVwKHsNCiAgICAgICAgICAgIGNvbnZlcnRlcnM6IHsNCiAgICAgICAgICAgICAgJ3RleHQgaHRtbCc6IGZ1bmN0aW9uKGRhdGEpIHsNCiAgICAgICAgICAgICAgICBpZiAod2luLmljaGVjay5hdXRvQWpheCAmJiBib2R5KSB7DQogICAgICAgICAgICAgICAgICB2YXIgZnJhbWUgPSBkb2MuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7IC8vIGNyZWF0ZSBjb250YWluZXINCiAgICAgICAgICAgICAgICAgIHZhciBmcmFtZURhdGE7DQoNCiAgICAgICAgICAgICAgICAgIC8vIHNldCBhdHRyaWJ1dGVzDQogICAgICAgICAgICAgICAgICBpZiAoIWllKSB7DQogICAgICAgICAgICAgICAgICAgIGZyYW1lLnN0eWxlID0gJ2Rpc3BsYXk6bm9uZSc7DQogICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgIGZyYW1lLmNsYXNzTmFtZSA9ICdpZnJhbWUuaWNoZWNrLWZyYW1lJzsNCiAgICAgICAgICAgICAgICAgIGZyYW1lLnNyYyA9J2Fib3V0OmJsYW5rJzsNCg0KICAgICAgICAgICAgICAgICAgLy8gYXBwZW5kIGNvbnRhaW5lciB0byBkb2N1bWVudA0KICAgICAgICAgICAgICAgICAgYm9keS5hcHBlbmRDaGlsZChmcmFtZSk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIHNhdmUgY29udGFpbmVyJ3MgY29udGVudA0KICAgICAgICAgICAgICAgICAgZnJhbWVEYXRhID0gZnJhbWUuY29udGVudERvY3VtZW50ID8gZnJhbWUuY29udGVudERvY3VtZW50IDogZnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudDsNCg0KICAgICAgICAgICAgICAgICAgLy8gYXBwZW5kIGRhdGEgdG8gY29udGVudA0KICAgICAgICAgICAgICAgICAgZnJhbWVEYXRhLm9wZW4oKTsNCiAgICAgICAgICAgICAgICAgIGZyYW1lRGF0YS53cml0ZShkYXRhKTsNCiAgICAgICAgICAgICAgICAgIGZyYW1lRGF0YS5jbG9zZSgpOw0KDQogICAgICAgICAgICAgICAgICAvLyByZW1vdmUgY29udGFpbmVyIGZyb20gZG9jdW1lbnQNCiAgICAgICAgICAgICAgICAgIGJvZHkucmVtb3ZlQ2hpbGQoZnJhbWUpOw0KDQogICAgICAgICAgICAgICAgICAvLyBzZXR1cCBvYmplY3QNCiAgICAgICAgICAgICAgICAgIGZyYW1lRGF0YSA9ICQoZnJhbWVEYXRhKTsNCg0KICAgICAgICAgICAgICAgICAgLy8gY3VzdG9taXplIGlucHV0cw0KICAgICAgICAgICAgICAgICAgcHJvY2VzcyhmcmFtZURhdGEuZmluZCgnLicgKyBiYXNlQ2xhc3MpLCB7fSwgdHJ1ZSk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIGV4dHJhY3QgSFRNTA0KICAgICAgICAgICAgICAgICAgZnJhbWVEYXRhID0gZnJhbWVEYXRhWzBdOw0KICAgICAgICAgICAgICAgICAgZGF0YSA9IChmcmFtZURhdGEuYm9keSB8fCBmcmFtZURhdGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXSkuaW5uZXJIVE1MOw0KICAgICAgICAgICAgICAgICAgZnJhbWVEYXRhID0gbnVsbDsgLy8gcHJldmVudCBtZW1vcnkgbGVha3MNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9Ow0KDQogICAgLy8gZXhwb3NlIGlDaGVjayBhcyBhbiBBTUQgbW9kdWxlDQogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7DQogICAgICBkZWZpbmUoJ2ljaGVjaycsIFt3aW4ualF1ZXJ5ID8gJ2pxdWVyeScgOiAnemVwdG8nXSwgd2luLmljaGVja2VkKTsNCiAgICB9IGVsc2Ugew0KICAgICAgd2luLmljaGVja2VkKCk7DQogICAgfQ0KICB9DQp9KHdpbmRvdywgZG9jdW1lbnQpKTsKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7JChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7DQp2YXIgbW9kYWxQb3M7DQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIEJPT1NUUkFQL1ZFTkRPUiBKUyBJTklUDQoNCiAgLy8gb24gZGVza3RvcA0KICAkKCcuc2VhcmNoLWJnIC5kcm9wZG93bi1tZW51IGxpIGEnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7DQogICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICQoJy5kcm9wZG93bi10b2dnbGUgLnNlYXJjaC1jYXRlZ29yeScpLnRleHQoJCh0aGlzKS50ZXh0KCkpOw0KICAgIHZhciBkeW5hbWljRHJvcGRvd25Ib29rID0gJCh0aGlzKS5wYXJlbnRzKCIuc2VhcmNoLWJnIikuZmluZCgiI3NlYXJjaC1kcm9wZG93biIpLmlubmVyV2lkdGgoKSArIDE1Ow0KICAgIGlmKCQoImh0bWwiKS5hdHRyKCJkaXIiKT09Imx0ciIpew0KCSAgICAkKHRoaXMpLnBhcmVudHMoIi5zZWFyY2gtYmciKS5maW5kKCIuc2VhcmNoLWlucHV0IikuY3NzKCJwYWRkaW5nLWxlZnQiLGR5bmFtaWNEcm9wZG93bkhvb2spLmZvY3VzKCk7IC8vIERvIG5vdCByZW1vdmUgLSBWVg0KCSAgICAkKHRoaXMpLnBhcmVudHMoIi5zZWFyY2gtYmciKS5maW5kKCIucHJlZGljdGl2ZS1yZXN1bHRzIikuY3NzKCJsZWZ0IiwgZHluYW1pY0Ryb3Bkb3duSG9vayk7IC8vIERvIG5vdCByZW1vdmUgLSBWVg0KICAgICAgICBpZigkKCJib2R5IikuaGFzQ2xhc3MoImllMTAiKSl7IC8qIENvei0gaXNzdWUgaW4gSUUxMCAtIHNlYXJjaCB0ZXh0IG5vdCByZWFsaWduaW5nIC0gVlYqLw0KICAgICAgICAgICAgdmFyIGVsPSQodGhpcykucGFyZW50cygiLnNlYXJjaC1iZyIpLmZpbmQoIi5zZWFyY2gtaW5wdXQiKTsNCiAgICAgICAgICAgICQoZWwpLnZhbCgkKGVsKS52YWwoKSsiICIpOw0KICAgICAgICAgICAgJChlbCkudmFsKCQoZWwpLnZhbCgpLnRyaW0oKSk7DQogICAgICAgIH0NCgkgICB9DQogICAgZWxzZXsNCiAgICAJJCh0aGlzKS5wYXJlbnRzKCIuc2VhcmNoLWJnIikuZmluZCgiLnNlYXJjaC1pbnB1dCIpLmNzcygicGFkZGluZy1yaWdodCIsZHluYW1pY0Ryb3Bkb3duSG9vaykuZm9jdXMoKTsgLy8gRG8gbm90IHJlbW92ZSAtIFZWDQoJICAgICQodGhpcykucGFyZW50cygiLnNlYXJjaC1iZyIpLmZpbmQoIi5wcmVkaWN0aXZlLXJlc3VsdHMiKS5jc3MoInJpZ2h0IiwgZHluYW1pY0Ryb3Bkb3duSG9vayk7IC8vIERvIG5vdCByZW1vdmUgLSBWVg0KCSAgICBpZigkKCJib2R5IikuaGFzQ2xhc3MoImllMTAiKSl7IC8qIENvei0gaXNzdWUgaW4gSUUxMCAtIHNlYXJjaCB0ZXh0IG5vdCByZWFsaWduaW5nIC0gVlYqLw0KICAgICAgICAgICAgdmFyIGVsPSQodGhpcykucGFyZW50cygiLnNlYXJjaC1iZyIpLmZpbmQoIi5zZWFyY2gtaW5wdXQiKTsNCiAgICAgICAgICAgICQoZWwpLnZhbCgkKGVsKS52YWwoKSsiICIpOw0KICAgICAgICAgICAgJChlbCkudmFsKCQoZWwpLnZhbCgpLnRyaW0oKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgJCh0aGlzKS5wYXJlbnRzKCIuc2VhcmNoLWJnIikuZmluZCgiLnR5cGVhaGVhZEhvb2siKS52YWwoZHluYW1pY0Ryb3Bkb3duSG9vayk7IC8vIERvIG5vdCByZW1vdmUgLSBWVg0KICAgICQoJy5kcm9wZG93bi10b2dnbGUgLnNlYXJjaC1jYXRlZ29yeScpLnZhbCgoJCh0aGlzKS5hdHRyKCJkYXRhLXZhbHVlIikpKTsNCiAgICAkKCcuc2VhcmNoLWJnICNzZWFyY2hDYXRlZ29yeScpLnZhbCgoJCh0aGlzKS5wYXJlbnQoImxpIikuaW5kZXgoKSkpOw0KICAgDQogICAgJCh0aGlzKS5wYXJlbnRzKCIuZHJvcGRvd24iKS5yZW1vdmVDbGFzcygib3BlbiIpOw0KICB9KTsNCg0KICAvLyBpZiB0aGUgcmVzdWx0cyBkcm9wZG93biBpcyBvcGVuIGFuZCB0aGUgc2VsZWN0IGRyb3Bkb3duIGlzIGNsaWNrZWQsIGhpZGUgdGhlIHJlc3VsdHMNCiAgJCgnLnNlYXJjaC1iZyAuZHJvcGRvd24tdG9nZ2xlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7DQogICAgJCgnLnByZWRpY3RpdmUtcmVzdWx0cycpLmhpZGUoKTsNCiAgfSk7DQoNCiAgJCgnLnNlYXJjaC1iZyBpbnB1dCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkgew0KICAgICQoJy5wcmVkaWN0aXZlLXJlc3VsdHMnKS5zaG93KCk7DQogIH0pOw0KDQogIC8vIG9uIGlPUyAoU2FmYXJpKSwgcmVtb3ZlIHRoZSBrZXlib2FyZCBvbiBhY3RpdmUgaW5wdXRzIHdoZW4gcm90YXRpbmcgZGV2aWNlIHNvIGxheW91dCBjYW4gcmVhZGp1c3QNCiAgaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7DQogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgZnVuY3Rpb24oKSB7DQogICAgICAkKCcubW9kYWwgaW5wdXQsIC5tb2RhbCB0ZXh0YXJlYScpLmJsdXIoKTsNCiAgICB9KTsNCiAgfQ0KDQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIE1PQklMRSBUQUJTDQoNCiAgJCgnLmhwLW5hdi10YWJzLWJnIGEnKS5vbigndGFwIGNsaWNrJywgZnVuY3Rpb24oZSkgew0KICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAkKCcudGFiLWNvbnRlbnQnKS5hZGRDbGFzcygnb3BlbicpOw0KICB9KTsNCg0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBQQ1AgVklFVyBUT0dHTEUNCg0KICAkKCcudmlldy1idXR0b24nKS5vbigndGFwIGNsaWNrJywgZnVuY3Rpb24oZSkgew0KICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAkKCcudmlldy1idXR0b24nKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQogICAgJCh0aGlzKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoNCiAgICB2YXIgdmlld1R5cGUgPSAkKHRoaXMpLmF0dHIoJ2lkJyk7DQogICAgJCgnI3Byb2R1Y3QtZ3JpZCAucHJvZHVjdCBhJykucmVtb3ZlQXR0cignc3R5bGUnKTsNCiAgICAkKCcjcHJvZHVjdC1ncmlkJykucmVtb3ZlQ2xhc3MoKTsNCiAgICAkKCcjcHJvZHVjdC1ncmlkJykuYWRkQ2xhc3Modmlld1R5cGUpOw0KICB9KTsNCiAgDQogICQoJyNwcm9kdWN0LWdyaWQgLnByb2R1Y3QgYScpLm1hdGNoSGVpZ2h0KCk7DQogICQoJ3NlbGVjdC50by1mYW5jaWZ5JykuZmFuY3lTZWxlY3QoKTsgDQoNCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gQUZGSVggU0lERUJBUg0KDQogICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24oKSB7ICAgIA0KICAgIHZhciBzY3JvbGwgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7DQogICAgaWYgKHNjcm9sbCA+PSAzMDApIHsNCiAgICAgICQoJyNzdHlsZWd1aWRlLXNpZGViYXInKS5hZGRDbGFzcygiYWZmaXgiKTsNCiAgICB9IGVsc2Ugew0KICAgICAgJCgnI3N0eWxlZ3VpZGUtc2lkZWJhcicpLnJlbW92ZUNsYXNzKCJhZmZpeCIpOw0KICAgIH0NCiAgfSk7DQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIElPUyBGSVhFUyBGT1IgU0VBUkNIIEhFQURFUg0KDQppZiAoTW9kZXJuaXpyLnRvdWNoICYmICh3aW5kb3cuaW5uZXJXaWR0aCA8PSA4MDAgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIDw9IDgwMCkpIHsNCiAgJChkb2N1bWVudCkNCiAgICAub24oJ2ZvY3VzJywgJ2lucHV0JywgZnVuY3Rpb24oZSkgew0KICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdmaXhmaXhlZCcpOw0KICAgICAgJCgnLmhwLWRlc2t0b3AtaGVhZGVyJykucmVtb3ZlQ2xhc3MoJ3N0aWNreScpOw0KICAgIH0pDQogICAgLm9uKCdibHVyJywgJ2lucHV0JywgZnVuY3Rpb24oZSkgew0KICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnZml4Zml4ZWQnKTsNCiAgICAkKCcuaHAtZGVza3RvcC1oZWFkZXInKS5hZGRDbGFzcygnc3RpY2t5Jyk7DQogIH0pOw0KfQ0KDQoNCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gTkFWIC5BQ1RJVkUgRk9SIEJPT1RTVFJBUCBPTkxZDQogICAvKiBEbyBub3QgdW5jb21tZW50IC0gSGltYW5zaHUNCiAgdmFyIHBhdGhuYW1lID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lOw0KICANCiAgaWYocGF0aG5hbWUuaW5kZXhPZignaW5kZXgnKSA+IC0xKSB7DQogICAgJCgnI25hdi1ob21lJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KDQogIH0gZWxzZSBpZiAocGF0aG5hbWUuaW5kZXhPZigncHJvZHVjdHMnKSA+IC0xIHx8IHBhdGhuYW1lLmluZGV4T2YoJ3BkcCcpID4gLTEgfHwgcGF0aG5hbWUuaW5kZXhPZigncGNwJykgPiAtMSkgew0KICAgICQoJyNuYXYtcHJvZHVjdHMnKS5hZGRDbGFzcygnYWN0aXZlJyk7DQogICAgJCgnI3BhZ2UtdGl0bGUnKS50ZXh0KCctIFByb2R1Y3RzJyk7DQoNCiAgfSBlbHNlIGlmIChwYXRobmFtZS5pbmRleE9mKCdzd2QnKSA+IC0xKSB7DQogICAgJCgnI25hdi1zd2QnKS5hZGRDbGFzcygnYWN0aXZlJyk7DQogICAgJCgnI3BhZ2UtdGl0bGUnKS50ZXh0KCctIFNvZnR3YXJlICYgRHJpdmVycycpOw0KDQogIH0gZWxzZSBpZiAocGF0aG5hbWUuaW5kZXhPZignY29udGFjdCcpID4gLTEgfHwgcGF0aG5hbWUuaW5kZXhPZignbWlnaHR5JykgPiAtMSkgew0KICAgICQoJyNuYXYtY29udGFjdCcpLmFkZENsYXNzKCdhY3RpdmUnKTsNCiAgICAkKCcjcGFnZS10aXRsZScpLnRleHQoJy0gQ29udGFjdCcpOw0KDQogIH0gZWxzZSBpZiAocGF0aG5hbWUuaW5kZXhPZignd2FycmFudHknKSA+IC0xKSB7DQogICAgJCgnI25hdi1wcm9kdWN0cycpLmFkZENsYXNzKCdhY3RpdmUnKTsNCg0KICB9IGVsc2UgeyQoJyNuYXYtZGV2JykuYWRkQ2xhc3MoJ2FjdGl2ZScpO30NCiovDQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIElDSEVDSw0KICANCiAgaWYoJCgiI3BhZ2VJZGVudGlmaWVyIikudmFsKCkgIT09ICJTV0RTZWxmU2VydmljZVN0ZXAiKXsNCiAgICAgICQoJ2lucHV0JykuaWNoZWNrKHsNCiAgICAgICAgY2hlY2tib3hDbGFzczogJ2ljaGVja2JveF9mbGF0LWJsdWUnLA0KICAgICAgICByYWRpb0NsYXNzOiAnaXJhZGlvX2ZsYXQtYmx1ZScsDQogICAgICAgIGNoZWNrZWRDbGFzczogJ2NoZWNrZWQnLA0KICAgICAgICBkaXNhYmxlZENsYXNzOiAnZGlzYWJsZWQnDQogICAgICB9KTsNCiAgfQ0KDQoNCiAgJCgnLmRpc3B1dGUtYmFyLWNvbnRhaW5lciAuY2xvc2UnKS5vbigndGFwIGNsaWNrJywgZnVuY3Rpb24oKXsNCiAgICAkKHRoaXMpLnBhcmVudHMoJy5kaXNwdXRlLWJhci1jb250YWluZXInKS5zbGlkZVVwKCk7DQogIH0pOw0KDQogIC8vIE1ha2luZyB0aGUgc2VhcmNoIGluIHRvb2x0aXAgcnRsDQogIGlmKCQoImh0bWwiKS5hdHRyKCJkaXIiKSA9PSAicnRsIil7DQogICAgJCgiLndpdGgtdG9vbHRpcCIpLmF0dHIoImRhdGEtcGxhY2VtZW50IiwicmlnaHQiKTsNCiAgfQ0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBNSUdIVFktMiBOVU1CRVIgU1lOQw0KDQppZiAoJCgnaW5wdXRbbmFtZT0icGhvbmUtbnVtYmVyIl0nKS5sZW5ndGggPiAwKSB7DQogICQoJ2lucHV0W25hbWU9InBob25lIicpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpew0KICAgICQoJ2lucHV0W25hbWU9InBob25lLW51bWJlciJdJykudmFsKCQodGhpcykudmFsKCkpOw0KICB9KTsNCn0NCg0KLyogICAgaWYgKCQoJ2lucHV0W3R5cGU9InRlbCJdJykubGVuZ3RoID4gMCkgew0KICAgICAgICAkKCdpbnB1dFt0eXBlPSJ0ZWwiXScpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpew0KICAgICAgICAgICAgJCgnaW5wdXRbdHlwZT0idGVsIl0nKS52YWwoJCh0aGlzKS52YWwoKSk7DQogICAgICAgIH0pOw0KICAgIH0qLw0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBNQUtFIENPTlRBQ1QgVElMRVMgRVFVQUwgSEVJR0hUUw0KDQogICQoJy50aWxlLWJsb2NrJykubWF0Y2hIZWlnaHQoKTsNCiAgJCgnLmVxdWFsaXplIC5jb2x1bW4tYmxvY2snKS5tYXRjaEhlaWdodCgpOw0KICAgJCgnLmVxdWFsaXplIC5ncmF5LWJsb2NrJykubWF0Y2hIZWlnaHQoKTsNCg0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gUFJPR1JFU1MgQkFSDQp2YXIgaW5jcmVtZW50UHJvZ3Jlc3NCYXIgPSBmdW5jdGlvbihudW0pew0KICB2YXIgJGNvbnRhaW5lciA9ICQoJy5wcm9ncmVzcy1iYXItY29udGFpbmVyJyk7DQogIHZhciAkYmFyID0gJCgnLnByb2dyZXNzLWJhcicpOw0KICB2YXIgJHN0YXR1cyA9ICQoJy5wcm9ncmVzcy1iYXItc3RhdHVzJyk7DQogICRiYXIuYXR0cignYXJpYS12YWx1ZW5vdycsbnVtKS5jc3MoJ3dpZHRoJyxudW0gKyAnJScpOw0KICAkc3RhdHVzLnRleHQobnVtICsgJyUnKTsNCn07DQp3aW5kb3cucnVuUHJvZ3Jlc3NCYXIgPSBmdW5jdGlvbigpew0KICBpbmNyZW1lbnRQcm9ncmVzc0JhcigwKTsNCiAgdmFyIHByb2dyZXNzU3RhdHVzID0gMTsNCiAgdmFyIHByb2dyZXNzSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpew0KICAgIGluY3JlbWVudFByb2dyZXNzQmFyKHByb2dyZXNzU3RhdHVzKTsNCiAgICBpZiAocHJvZ3Jlc3NTdGF0dXMgPT09IDEwMCkgew0KICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwocHJvZ3Jlc3NJbnRlcnZhbCk7DQogICAgICByZXR1cm47DQogICAgfQ0KICAgIHByb2dyZXNzU3RhdHVzKys7DQogIH0sMjApOw0KfTsNCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tTU9EQUwNCi8qDQokKCdbZGF0YS10b2dnbGU9Im1vZGFsIl0nKS5jbGljayhmdW5jdGlvbihlKXsNCiAgbW9kYWxQb3MgPSAkKGUuY3VycmVudFRhcmdldCkub2Zmc2V0KCk7DQp9KTsNCg0KJCgnLm1vZGFsJykub24oJ3Nob3cuYnMubW9kYWwnLGZ1bmN0aW9uKGUpew0KbW9kYWxQb3MgPSAkKGUuY3VycmVudFRhcmdldCkub2Zmc2V0KCk7DQp9KTsNCg0KJCgnLm1vZGFsJykub24oJ2hpZGRlbi5icy5tb2RhbCcsZnVuY3Rpb24oZSl7DQogICQoJ2JvZHknKS5zY3JvbGxUb3AobW9kYWxQb3MudG9wLTIwMCk7DQp9KTsNCiovDQovKiBkbyBub3QgdW5jb21tZW50DQokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsNCiAgJCgnI3JlZmluZS1yZXN1bHRzLW1vZGFsJykubW9kYWwoJ3Nob3cnKTsNCn0pOyAqLw0KDQogLy8gLS0tLS0tLS0tLS0gU2hvdyBhbGwNCiBpZiAoJCgnW2RhdGEtdG9nZ2xlPSJzaG93LWFsbCJdJykubGVuZ3RoKSB7DQogICQoJ1tkYXRhLXRvZ2dsZT0ic2hvdy1hbGwiXScpLmNsaWNrKGZ1bmN0aW9uKCl7DQogICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2FsbCcpKXsNCiAgICAgICQoJ1tkYXRhLXRvZ2dsZT0ic2hvdy1hbGwiXScpLmh0bWwoJ1Nob3cgYWxsJykucmVtb3ZlQ2xhc3MoJ2FsbCcpOw0KICAgICAgJCgnLnBhZ2luYXRpb24tY291bnQsIC5wYWdpbmF0aW9uLW1vcmUsIC5wYWdpbmF0aW9uLWxlc3MnKS5zaG93KCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgJCgnW2RhdGEtdG9nZ2xlPSJzaG93LWFsbCJdJykuaHRtbCgnU2hvdyBsZXNzJykuYWRkQ2xhc3MoJ2FsbCcpOw0KICAgICAgJCgnLnBhZ2luYXRpb24tY291bnQsIC5wYWdpbmF0aW9uLW1vcmUsIC5wYWdpbmF0aW9uLWxlc3MnKS5oaWRlKCk7DQogICAgfQ0KICB9KTsNCiB9DQoNCiAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gUFNGDQpmdW5jdGlvbiBpc0lFICgpIHsNCiAgdmFyIHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsNCiAgcmV0dXJuICh1c2VyQWdlbnQuaW5kZXhPZignbXNpZScpICE9IC0xIHx8IG5hdmlnYXRvci5hcHBWZXJzaW9uLmluZGV4T2YoJ1RyaWRlbnQvJykgPiAwKSA/IHRydWUgOiBmYWxzZTsNCn0NCmlmICgoISh3aW5kb3cuQWN0aXZlWE9iamVjdCkgJiYgIkFjdGl2ZVhPYmplY3QiIGluIHdpbmRvdykgfHwgaXNJRSgpKSB7DQogIC8qJCgnLnBzZi1saW5rJykuYWRkQ2xhc3MoJ3BzZi1saW5rLWllJyk7IENvbW1lbnRlZCBieSBWViAqLw0KfQ0KDQogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFNob3cvSGlkZSBUYWJzIG5vdCBib290c3RyYXAgbW9kaWZpY2F0aW9uDQoNCiAgaWYgKCQoJ1tkYXRhLXRvZ2dsZT0idGFiLWJveCJdJykubGVuZ3RoKSB7DQoNCiAgICAgICQoJ1tkYXRhLXRvZ2dsZT0idGFiLWJveCJdJykuY2xpY2soZnVuY3Rpb24oZSl7DQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgJCh0aGlzKS5wYXJlbnQoIi5uYXYtdGFicyB+IGxpIikucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KICAgICAgICAkKHRoaXMpLnBhcmVudCgnbGknKS5hZGRDbGFzcygnYWN0aXZlJyk7DQogICAgICAgIHZhciB0YWJTaG93ID0gJCh0aGlzKS5hdHRyKCdocmVmJyk7DQogICAgICAgJCh0YWJTaG93KS5hZGRDbGFzcygnYWN0aXZlJyk7DQoNCiAgICAgfSk7DQogIH0NCg0KICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBTaG93L0hpZGUgc2Vjb25kYXJ5IGNvbnRlbnQgbGlrZSBjb3VudHJ5LWVsaWdpYmlsaXR5IHNlbGVjdCBtb2RlbCBudW1iZXIgbW9kYWwgbW92ZWQgLSBWVg0KICANCg0KICANCg0KICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gQWpheCBTV0QgTGFuZGluZyBQYWdlDQoNCiAgJCgnI2FqYXhNZScpLmNsaWNrKGZ1bmN0aW9uIChlKSB7DQogICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICR1cmwgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTsNCiAgICAkKCcjY29udGVudCcpLmxvYWQoJHVybCwgZnVuY3Rpb24oaHRtbCkgew0KICAgICAgaWYgKCBzdGF0dXMgPT0gImVycm9yIiApIHsNCiAgICAgICAgdmFyIG1zZyA9ICJTb3JyeSBidXQgdGhlcmUgd2FzIGFuIGVycm9yOiAiOw0KICAgICAgICAkKCAiI2NvbnRlbnQiICkuaHRtbCggbXNnICsgeGhyLnN0YXR1cyArICIgIiArIHhoci5zdGF0dXNUZXh0ICk7DQogICAgICB9DQogICAgfSkNCiAgfSk7DQoNCiAgJCgnYS5zaG93LW5leHQnKS5jbGljayggZnVuY3Rpb24oZSkgew0KICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICB2YXIgcGFyZW50U2VjdGlvbiA9ICQodGhpcykuY2xvc2VzdCgic2VjdGlvbiIpLmF0dHIoImlkIik7DQogICAkKCcjJytwYXJlbnRTZWN0aW9uKS5oaWRlKCk7DQogICAgdmFyIG5leHQgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTsNCiAgICAkKG5leHQpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsNCiAgICAkKCJodG1sLCBib2R5IikuYW5pbWF0ZSgpOw0KICAgIHJldHVybiBmYWxzZTsNCiAgIH0pOw0KDQogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIEFGRklYIHN0ZXBzIGJhciBidXQgb25seSBvbiBkZXNrdG9wIGFuZCBtb2JpbGUgYWZ0ZXIgc2Nyb2xsaW5nLiBSZW1vdmUgcGVyIEhQLTk5NC4gSmFuIDEzLCAyMDE1DQogIC8vICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uKCkgew0KICAvLyAgICBpZiAoISQoJyNzd2QnKS5oYXNDbGFzcygnY2xvc3VyZScpKSB7IC8veW91IGRvbid0IHdhbnQgdGhlIHN0aWNreSB0aGluZyB0byBoYXBwZW4gb24gY2xvc3VyZSBwYWdlIGJlY2F1c2Ugd2UncmUgYnJpbmdpbmcgaW4gdGhlIG5hdiBhZ2Fpbg0KICAvLyAgICAgIHZhciBzY3JvbGwgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7DQogIC8vICAgICAgaWYgKHNjcm9sbCA+PSA3NSkgew0KICAvLyAgICAgICAgJCgnI3N0ZXBzLWJhcicpLmFkZENsYXNzKCJzdGlja3kiKTsNCiAgLy8gICAgICAgICQoJy5ocC1oZXJvJykuYWRkQ2xhc3MoImJhbm5lci1tYXJnaW4iKTsNCiAgLy8NCiAgLy8gICAgICB9IGVsc2Ugew0KICAvLyAgICAgICAgJCgnI3N0ZXBzLWJhcicpLnJlbW92ZUNsYXNzKCJzdGlja3kiKTsNCiAgLy8gICAgICAgICQoJy5ocC1oZXJvJykucmVtb3ZlQ2xhc3MoImJhbm5lci1tYXJnaW4iKTsNCiAgLy8gICAgICB9DQogIC8vICAgIH0NCg0KLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFN0eWxlIFVwbG9hZCBCdXR0b25zIHdpdGggY2xhc3MgLnN0eWxlZFVwbG9hZA0KLyogRG8gbm90IG1lcmdlIC0gbW92ZWQgdG8gcG9ydGxldCBieSBISA0KICBpZiAoISQoJyN1cGxvYWRCdG4nKS5sZW5ndGgpIHsNCiAgfSBlbHNlIHsNCiAgICAvL3ZhciB1cGxvYWRGaWxlID0gJCgnI3VwbG9hZEZpbGUnKTsNCiAgICAkKCcjdXBsb2FkQnRuJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciBmaWxlTmFtZSA9ICQodGhpcykudmFsKCkucmVwbGFjZSgiQzpcXGZha2VwYXRoXFwiLCAiIik7DQogICAgICAkKCcjdXBsb2FkRmlsZScpLnZhbChmaWxlTmFtZSk7DQogICAgICAvLyQoJyNmaWxlRXhpdCcpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsNCiAgICAgICQoJyN1cGxvYWRCdG5UZXh0JykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7DQogICAgICAkKCcjdXBsb2FkRmlsZScpLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpOw0KICAgIH0pOw0KICAgIC8vJCgnI2ZpbGVFeGl0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgew0KICAgIC8vICAkKCcjdXBsb2FkRmlsZScpLnZhbCgnJyk7DQogICAgLy8gICQodGhpcykuYWRkQ2xhc3MoJ2hpZGRlbicpOw0KICAgIC8vICByZXR1cm47DQogICAgLy99KTsNCg0KICB9ICovDQogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tSE9MREVSDQogIA0KICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gQWRkZWQgYWZ0ZXIgbWVyZ2UgNS83LzIwMTUgU3R5bGUgVXBsb2FkIEJ1dHRvbnMgd2l0aCBjbGFzcyAuc3R5bGVkVXBsb2FkDQoJICAvL3VwbG9hZCBoYW5kbGVyIG1vdmVkIHRvIHBvcnRsZXQgZG8gbm90IG1lcmdlLSBIaW1hbnNodQ0KCSAgICAgDQoNCiAgICBIb2xkZXIucnVuKHsNCiAgICAgICAgdGhlbWVzOiB7DQogICAgICAgICAgICAiY29uY2VudHJhUHJvZHVjdCI6IHsNCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAiIzAwOTZkNiIsDQogICAgICAgICAgICAgICAgZm9yZWdyb3VuZDogIiNmZmZmZmYiLA0KICAgICAgICAgICAgICAgIHNpemU6IDEyDQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGltYWdlczogIiNwbGFjZWhvbGRlciINCiAgICB9KTsNCg0KICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIEFzc2lnbiBJRCBvZiB1cmwgdG8gYm9keSBmb3Igc3R5bGluZyBIUC03MDUNCg0KICB2YXIgc2VnbWVudF9zdHIgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7DQogIHZhciBzZWdtZW50X2FycmF5ID0gc2VnbWVudF9zdHIuc3BsaXQoICcvJyApOw0KICB2YXIgbGFzdF9zZWdtZW50ID0gc2VnbWVudF9hcnJheS5wb3AoKTsNCiAgdmFyIGlkID0gbGFzdF9zZWdtZW50LnJlcGxhY2UoL1wuKGh0bVtsXT98YXNwW3hdP3xwaHBcI1x3K3xwaHB8anNwKSQvLCcnKTsNCiAgdmFyIHNlZ21lbnRfY2xhc3MgPSBpZC5zcGxpdCgnLScpOw0KICAkKCdib2R5JykuYXR0cignaWQnLCBzZWdtZW50X2NsYXNzWzJdKTsNCg0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBUcmlnZ2VyIFByb2dyZXNzIEJhciBWaXN1YWxseSBkb250IGFkZCBpdCBzaW5jZSB3ZSBhcmUgbm90IHVzaW5nIGl0Lg0KDQogIC8vIENoYW5nZSBJTUcgU1ZHIHRvIGlubGluZSBTVkcNCiAgalF1ZXJ5KCdpbWcuc3ZnJykuZWFjaChmdW5jdGlvbigpew0KICAgIHZhciAkaW1nID0galF1ZXJ5KHRoaXMpOw0KICAgIHZhciBpbWdJRCA9ICRpbWcuYXR0cignaWQnKTsNCiAgICB2YXIgaW1nQ2xhc3MgPSAkaW1nLmF0dHIoJ2NsYXNzJyk7DQogICAgdmFyIGltZ1VSTCA9ICRpbWcuYXR0cignc3JjJyk7DQoNCiAgICBqUXVlcnkuZ2V0KGltZ1VSTCwgZnVuY3Rpb24oZGF0YSkgew0KICAgICAgLy8gR2V0IHRoZSBTVkcgdGFnLCBpZ25vcmUgdGhlIHJlc3QNCiAgICAgIHZhciAkc3ZnID0galF1ZXJ5KGRhdGEpLmZpbmQoJ3N2ZycpOw0KDQogICAgICAvLyBBZGQgcmVwbGFjZWQgaW1hZ2UncyBJRCB0byB0aGUgbmV3IFNWRw0KICAgICAgaWYodHlwZW9mIGltZ0lEICE9PSAndW5kZWZpbmVkJykgew0KICAgICAgICAkc3ZnID0gJHN2Zy5hdHRyKCdpZCcsIGltZ0lEKTsNCiAgICAgIH0NCiAgICAgIC8vIEFkZCByZXBsYWNlZCBpbWFnZSdzIGNsYXNzZXMgdG8gdGhlIG5ldyBTVkcNCiAgICAgIGlmKHR5cGVvZiBpbWdDbGFzcyAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgJHN2ZyA9ICRzdmcuYXR0cignY2xhc3MnLCBpbWdDbGFzcysnIHJlcGxhY2VkLXN2ZycpOw0KICAgICAgfQ0KDQogICAgICAvLyBSZW1vdmUgYW55IGludmFsaWQgWE1MIHRhZ3MgYXMgcGVyIGh0dHA6Ly92YWxpZGF0b3IudzMub3JnDQogICAgICAkc3ZnID0gJHN2Zy5yZW1vdmVBdHRyKCd4bWxuczphJyk7DQoNCiAgICAgIC8vIFJlcGxhY2UgaW1hZ2Ugd2l0aCBuZXcgU1ZHDQogICAgICAkaW1nLnJlcGxhY2VXaXRoKCRzdmcpOw0KDQogICAgfSwgJ3htbCcpOw0KDQogIH0pOw0KICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIE1ha2UgVGFicyBXb3JrIGRpZmZlcmVudGx5IGlmIG5vdCBpbiB2ZXJ0aWNhbCBhbGlnbm1lbnQNCg0KIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gSU5JVCBDT01QT05FTlRTDQogaWYod2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZigndG9waWMnKTw9IC0xKXsgICAgLyogZml4IGZvciBBTE0gMTUzMiovDQogICBUYWJzLmluaXQoKTsNCiAgfQ0KICBEcm9wZG93bi5pbml0KCk7DQogIEFjY29yZGlvbi5pbml0KCk7DQogIC8vQ2hlY2tib3hlcy5pbml0KCk7IGRvIG5vdCB1bmNvbW1lbnQsIA0KICBQYWdpbmF0aW9uLmluaXQoKTsNCiAgLy9GaWx0ZXJzLmluaXQoKTsgIERvIG5vdCB1bmNvbW1lbnQgLiBpbml0aWF0aWx6ZWQgaW4gZmFjZXRzLmpzIA0KICBhamF4U2VsZWN0LmluaXQoKTsNCiAgbmFycm93TW9kYWwuaW5pdCgpOw0KICBTZWFyY2guaW5pdCgpOw0KICBUb29sdGlwcy5pbml0KCk7DQogIENMQy5pbml0KCk7DQogIEhlYWRlci5pbml0KCk7DQogIC8vZG8gbm90IHVuY29tbWVudCwgbm90IHVzaW5nIHRoZWlyIHZhbGlkYXRlZm9ybVZhbGlkYXRlLmluaXQoKTsNCiAgUFNGLmluaXQoKTsNCiAgU0NGLmluaXQoKTsNCiAgDQogIE9zU2VsZWN0b3IuaW5pdCgpOw0KICBHdWlkZWQuaW5pdCgpOw0KICAvL2RvIG5vdCB1bmNvbW1lbnQsIG5vdCB1c2luZyB0aGlzIGZpbGUgc2VsZkd1aWRlZC5pbml0KCk7DQpEb3dubG9hZFRhYmxlLmluaXQoKTsNCiAgLy8gZG8gbm90IHVuY29tbWVudCwgbm90IHVzaW5nUGRwLmluaXQoKTsNCn0pOw0KDQoKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7dmFyIHNlYXJjaGNjID0gZ2V0Q0NMQygiY2MiKTsNCnZhciBzZWFyY2hsYyA9IGdldENDTEMoImxjIik7DQoNCg0KZnVuY3Rpb24gcGFpbnRGYWNldHMocHJvZHVjdEZhY2V0cyxvc0ZhY2V0cyx0b3BpY0ZhY2V0cykgew0KCS8vIGNoZWNrIGlmIHRoZXJlIGFyZSBubyBmYWNldHMNCglpZigocHJvZHVjdEZhY2V0cyA9PSB1bmRlZmluZWQgJiYgb3NGYWNldHMgPT0gdW5kZWZpbmVkICYmIHRvcGljRmFjZXRzID09IHVuZGVmaW5lZCkgfHwNCgkJKEpTT04uc3RyaW5naWZ5KHByb2R1Y3RGYWNldHMpPT0ie30iICYmIEpTT04uc3RyaW5naWZ5KG9zRmFjZXRzKT09Int9IiAmJiB0b3BpY0ZhY2V0cy5sZW5ndGggPT0gMCkpIHsNCgkJaGlkZUZhY2V0cygpOw0KCQlyZXR1cm47DQoJfQ0KDQoJLy8gcHJvZHVjdCBmYWNldHMgZGlzcGxheQ0KCWlmKCEkLmlzRW1wdHlPYmplY3QocHJvZHVjdEZhY2V0cykpIHsNCgkJcGFpbnRQcm9kdWN0c0ZhY2V0cyhwcm9kdWN0RmFjZXRzKTsNCgl9IGVsc2Ugew0KCQkkKCcjcHJvZHVjdEZhY2V0cycpLmhpZGUoKTsNCgl9DQoNCgkvLyB0b3BpYyBmYWNldHMgZGlzcGxheQ0KCWlmKHRvcGljRmFjZXRzLmxlbmd0aCA+IDApIHsNCgkJcGFpbnRUb3BpY0ZhY2V0cyh0b3BpY0ZhY2V0cyk7DQoJfSBlbHNlIHsNCgkJJCgnI3RvcGljc0ZhY2V0cycpLmhpZGUoKTsNCgl9DQoNCgkvLyBvcyBmYWNldHMgZGlzcGxheQ0KCWlmKCEkLmlzRW1wdHlPYmplY3Qob3NGYWNldHMpKSB7DQoJCXBhaW50T1NGYWNldHMob3NGYWNldHMpOw0KCX0gZWxzZSB7DQoJCSQoJyNvc0ZhY2V0cycpLmhpZGUoKTsNCgl9DQoJaGFuZGxlRmFjZXRzTW9iaWxlVmlldygpOw0KCW9zUHJlUG9wdWxhdGlvbigpOw0KCUZpbHRlcnMuaW5pdCgpOw0KfQ0KDQovKiB0aGlzIGZ1bmN0aW9uIHdpbGwgYmluZCBjbGljayBldmVudCBmb3IgY2xlYXIgYW5kIGNsZWFyIGFsbCBsaW5rcyBpbiB5b3VyIHNlbGVjdGlvbiBzZWN0aW9uICovDQpmdW5jdGlvbiBiaW5kQ2xlYXJGYWNldHMoKSB7DQoJaWYgKCQoJy5hcHBsaWVkLWZpbHRlcnMtaXRlbScpLmxlbmd0aCkgew0KCQkkKCcuZmlsdGVyLWNsb3NlLmljb24nKS5vbignY2xpY2snLCBmYWNldHNBamF4KTsNCgkJJCgnI2ZpbHRlci1jbGVhcicpLm9uKCdjbGljaycsIGZhY2V0c0FqYXgpOw0KCX0NCn0NCg0KZnVuY3Rpb24gaGFuZGxlRmFjZXRzTW9iaWxlVmlldygpIHsNCgkkKCIjZmlsdGVyLWNsb3NlIikub24oImNsaWNrIixmdW5jdGlvbigpeyQoImJvZHkiKS5jc3MoIm92ZXJmbG93IiwiYXV0byIpO30pOw0KCSQoIiNmaWx0ZXItdHJpZ2dlciIpLm9uKCJjbGljayIsZnVuY3Rpb24oKXskKCJib2R5IikuY3NzKCJvdmVyZmxvdyIsImhpZGRlbiIpO30pOw0KfQ0KDQovKiBjcmVhdGUgbWFya3VwIGZvciBwcm9kdWN0cyBmYWNldHMgKi8NCmZ1bmN0aW9uIHBhaW50UHJvZHVjdHNGYWNldHMocHJvZHVjdEZhY2V0cykgew0KCXZhciBoaWVyYXJjaHlMZXZlbDFDdCA9IDA7DQoJZm9yKHZhciBoaWVyYXJjaHlMZXZlbDEgaW4gcHJvZHVjdEZhY2V0cykgew0KCQl2YXIgaGllcmFyY2h5TGV2ZWwyID0gcHJvZHVjdEZhY2V0c1toaWVyYXJjaHlMZXZlbDFdOw0KCQl2YXIgbGV2ZWwyTGFiZWwsIGxldmVsMklkOw0KDQoJCS8vIGZvciB1cHRvIDUgcHJvZHVjdHMNCgkJaWYoaGllcmFyY2h5TGV2ZWwxQ3Q8NSkgew0KCQkJJCgnZGl2I3Byb2R1Y3RGYWNldHMgdWwuZmlsdGVyLWxldmVsLTEnKQ0KCQkJCS5hcHBlbmQoJzxsaT48bGFiZWwgY2xhc3M9ImV4cGFuZGFibGUiPjxzcGFuPjwvc3Bhbj48YSBkYXRhLWV4cGFuZGFibGU9InRydWUiIGFyaWEtZXhwYW5kZWQ9ImZhbHNlIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiPicraGllcmFyY2h5TGV2ZWwxKyc8L2E+PC9sYWJlbD48dWwgaWQ9InByb2R1Y3RGYWNldHMnK2hpZXJhcmNoeUxldmVsMUN0KyciIGNsYXNzPSJmaWx0ZXItb3B0aW9ucyBmaWx0ZXItb3B0aW9ucy1uZXN0ZWQiPjwvdWw+PC9saT4nKTsNCgkJfQ0KCQllbHNlIHsNCgkJCS8vIGZvciBtb3JlIHRoYW4gNSByZWNvcmRzDQoJCQkkKCdkaXYjcHJvZHVjdEZhY2V0cyB1bC5maWx0ZXItbGV2ZWwtMScpDQoJCQkuYXBwZW5kKCc8bGkgY2xhc3M9ImhpZGVGYWNldCI+PGxhYmVsIGNsYXNzPSJleHBhbmRhYmxlIj48c3Bhbj48L3NwYW4+PGEgZGF0YS1leHBhbmRhYmxlPSJ0cnVlIiBhcmlhLWV4cGFuZGVkPSJmYWxzZSIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIj4nK2hpZXJhcmNoeUxldmVsMSsnPC9hPjwvbGFiZWw+PHVsIGlkPSJwcm9kdWN0RmFjZXRzJytoaWVyYXJjaHlMZXZlbDFDdCsnIiBjbGFzcz0iZmlsdGVyLW9wdGlvbnMgZmlsdGVyLW9wdGlvbnMtbmVzdGVkIj48L3VsPjwvbGk+Jyk7DQoJCX0NCg0KCQlmb3IodmFyIGNvdW50Mj0wO2NvdW50MjxoaWVyYXJjaHlMZXZlbDIubGVuZ3RoO2NvdW50MisrKSB7DQoJCQlsZXZlbDJMYWJlbCA9IGhpZXJhcmNoeUxldmVsMltjb3VudDJdLnNwbGl0KCd8JylbMF07DQoJCQlsZXZlbDJJZCA9IGhpZXJhcmNoeUxldmVsMltjb3VudDJdLnNwbGl0KCd8JylbMV07DQoJCQkkKCd1bCNwcm9kdWN0RmFjZXRzJytoaWVyYXJjaHlMZXZlbDFDdCkuYXBwZW5kKCc8bGk+PGRpdiBjbGFzcz0iY2hlY2tib3giPjxsYWJlbD48aW5wdXQgY2xhc3M9ImNoZWNrYm94IiB0eXBlPSJjaGVja2JveCIgb25jbGljaz0iZmFjZXRzQWpheCgpOyI+JytsZXZlbDJMYWJlbCsNCgkJCQkJJzwvaW5wdXQ+PC9sYWJlbD48aW5wdXQgdHlwZT0iaGlkZGVuIiB2YWx1ZT0iJytsZXZlbDJJZCsnIj48L2lucHV0PjwvbGFiZWw+PC9kaXY+PC9saT4nKTsNCg0KCQl9DQoJCWhpZXJhcmNoeUxldmVsMUN0Kys7DQoJfQ0KDQoJLy8gZm9yIG1vcmUgdGhhbiA1IHJlY29yZHMsIGFkZCBzaG93IG1vcmUgcHJvZHVjdHMNCglpZihoaWVyYXJjaHlMZXZlbDFDdD41KQ0KCQkkKCdkaXYjcHJvZHVjdEZhY2V0cyB1bC5maWx0ZXItbGV2ZWwtMScpLmFwcGVuZCgnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9InNob3ctbW9yZSBpbiIgZGF0YS1tb3JlPSJtb3JlLWNhdGVnb3J5IiBkYXRhLXRleHQ9IicrJCgiI3NlYXJjaExlc3NQcm9kdWN0cyIpLnZhbCgpKyciPicrJCgiI3NlYXJjaE1vcmVQcm9kdWN0cyIpLnZhbCgpKyc8L2E+PC9saT4nKTsNCg0KCSQoIi5zaG93LW1vcmUiKS5vbigiY2xpY2siLGZ1bmN0aW9uKCkgew0KCQlpZigkKCIuc2hvdy1tb3JlIikuaGFzQ2xhc3MoJ2luJykpIHsNCgkJCSQoJy5oaWRlRmFjZXQnKS5jc3MoJ2Rpc3BsYXknLCdibG9jaycpOw0KCQl9IGVsc2Ugew0KCQkJJCgnLmhpZGVGYWNldCcpLmNzcygnZGlzcGxheScsJ25vbmUnKTsNCgkJfQ0KCX0pOw0KfQ0KLypjcmVhdGUgbWFya3VwIGZvciBvcyBmYWNldHMgKi8NCmZ1bmN0aW9uIHBhaW50T1NGYWNldHMob3NGYWNldHMpIHsNCgl2YXIgaGllcmFyY2h5TGV2ZWwxQ3QgPSAwOw0KCWZvcih2YXIgaGllcmFyY2h5TGV2ZWwxIGluIG9zRmFjZXRzKSB7DQoJCXZhciBoaWVyYXJjaHlMZXZlbDIgPSBvc0ZhY2V0c1toaWVyYXJjaHlMZXZlbDFdOw0KCQl2YXIgbGV2ZWwyTGFiZWwsIGxldmVsMklkOw0KCQkvLyBmb3IgdXB0byA1IHByb2R1Y3RzDQoJCWlmKGhpZXJhcmNoeUxldmVsMUN0PDUpIHsNCgkJCSQoJ2RpdiNvc0ZhY2V0cyB1bC5maWx0ZXItbGV2ZWwtMScpDQoJCQkJLmFwcGVuZCgnPGxpPjxsYWJlbCBjbGFzcz0iZXhwYW5kYWJsZSI+PHNwYW4+PC9zcGFuPjxhIGRhdGEtZXhwYW5kYWJsZT0idHJ1ZSIgYXJpYS1leHBhbmRlZD0iZmFsc2UiIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSI+JytoaWVyYXJjaHlMZXZlbDErJzwvYT48L2xhYmVsPjx1bCBpZD0iT1NGYWNldHMnK2hpZXJhcmNoeUxldmVsMUN0KyciIGNsYXNzPSJmaWx0ZXItb3B0aW9ucyBmaWx0ZXItb3B0aW9ucy1uZXN0ZWQiPjwvdWw+PC9saT4nKTsNCgkJfQ0KCQllbHNlIHsNCgkJCS8vIGZvciBtb3JlIHRoYW4gNSByZWNvcmRzDQoJCQkkKCdkaXYjb3NGYWNldHMgdWwuZmlsdGVyLWxldmVsLTEnKQ0KCQkJLmFwcGVuZCgnPGxpIGNsYXNzPSJoaWRlRmFjZXRPUyI+PGxhYmVsIGNsYXNzPSJleHBhbmRhYmxlIj48c3Bhbj48L3NwYW4+PGEgZGF0YS1leHBhbmRhYmxlPSJ0cnVlIiBhcmlhLWV4cGFuZGVkPSJmYWxzZSIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIj4nK2hpZXJhcmNoeUxldmVsMSsnPC9hPjwvbGFiZWw+PHVsIGlkPSJPU0ZhY2V0cycraGllcmFyY2h5TGV2ZWwxQ3QrJyIgY2xhc3M9ImZpbHRlci1vcHRpb25zIGZpbHRlci1vcHRpb25zLW5lc3RlZCI+PC91bD48L2xpPicpOw0KCQl9DQoJCWZvcih2YXIgY291bnQyPTA7Y291bnQyPGhpZXJhcmNoeUxldmVsMi5sZW5ndGg7Y291bnQyKyspIHsNCgkJCWxldmVsMkxhYmVsID0gaGllcmFyY2h5TGV2ZWwyW2NvdW50Ml0uc3BsaXQoJ3wnKVswXTsNCgkJCWxldmVsMklkID0gaGllcmFyY2h5TGV2ZWwyW2NvdW50Ml0uc3BsaXQoJ3wnKVsxXTsNCgkJCSQoJ3VsI09TRmFjZXRzJytoaWVyYXJjaHlMZXZlbDFDdCkuYXBwZW5kKCc8bGk+PGRpdiBjbGFzcz0iY2hlY2tib3giPjxsYWJlbD48aW5wdXQgY2xhc3M9ImNoZWNrYm94IiB0eXBlPSJjaGVja2JveCIgb25jbGljaz0iZmFjZXRzQWpheCgpOyI+JytsZXZlbDJMYWJlbCsNCgkJCQkJJzwvaW5wdXQ+PC9sYWJlbD48aW5wdXQgdHlwZT0iaGlkZGVuIiB2YWx1ZT0iJytsZXZlbDJJZCsnIj48L2lucHV0PjwvbGFiZWw+PC9kaXY+PC9saT4nKTsNCg0KCQl9DQoJCWhpZXJhcmNoeUxldmVsMUN0Kys7DQoJfQ0KCS8vIGZvciBtb3JlIHRoYW4gNSByZWNvcmRzLCBhZGQgc2hvdyBtb3JlIHByb2R1Y3RzDQoJaWYoaGllcmFyY2h5TGV2ZWwxQ3Q+NSkNCgkJJCgnZGl2I29zRmFjZXRzIHVsLmZpbHRlci1sZXZlbC0xJykuYXBwZW5kKCc8bGk+PGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0ic2hvdy1tb3JlLU9TIGluIiBkYXRhLW1vcmU9Im1vcmUtY2F0ZWdvcnkiIGRhdGEtdGV4dD0iJyskKCIjc2VhcmNoTGVzc09TIikudmFsKCkrJyI+JyskKCIjc2VhcmNoTW9yZU9TIikudmFsKCkrJzwvYT48L2xpPicpOw0KDQoJJCgiLnNob3ctbW9yZS1PUyIpLm9uKCJjbGljayIsZnVuY3Rpb24oKSB7DQoJCWlmKCQoIi5zaG93LW1vcmUtT1MiKS5oYXNDbGFzcygnaW4nKSkgew0KCQkJJCgnLmhpZGVGYWNldE9TJykuY3NzKCdkaXNwbGF5JywnYmxvY2snKTsNCgkJfSBlbHNlIHsNCgkJCSQoJy5oaWRlRmFjZXRPUycpLmNzcygnZGlzcGxheScsJ25vbmUnKTsNCgkJfQ0KCX0pOw0KfQ0KDQovKmNyZWF0ZSBtYXJrdXAgZm9yIHRvcGljIGZhY2V0cyAqLw0KZnVuY3Rpb24gcGFpbnRUb3BpY0ZhY2V0cyh0b3BpY0ZhY2V0cykgew0KCXZhciB0b3BpY0NvdW50ID0gdG9waWNGYWNldHMubGVuZ3RoOw0KCXZhciB0b3BpY0xhYmVsLHRvcGljSWQsdG9waWNGYWNldE1hcmt1cCA9ICcnOw0KCWZvcih2YXIgY291bnQgPSAwOyBjb3VudCA8IHRvcGljQ291bnQ7IGNvdW50KyspIHsNCgkJdG9waWNMYWJlbCA9IHRvcGljRmFjZXRzW2NvdW50XS5zcGxpdCgnfCcpWzBdOw0KCQl0b3BpY0lkID0gdG9waWNGYWNldHNbY291bnRdLnNwbGl0KCd8JylbMV07DQoJCXRvcGljRmFjZXRNYXJrdXAgPSB0b3BpY0ZhY2V0TWFya3VwICsgJzxsaT48ZGl2IGNsYXNzPSJjaGVja2JveCI+PGxhYmVsPjxpbnB1dCBjbGFzcz0iY2hlY2tib3giIHR5cGU9ImNoZWNrYm94IiBvbmNsaWNrPSJmYWNldHNBamF4KCk7Ij4nDQoJCQkrdG9waWNMYWJlbCsnPC9sYWJlbD48aW5wdXQgdHlwZT0iaGlkZGVuIiB2YWx1ZT0iJyt0b3BpY0lkKyciPjwvZGl2PjwvbGk+JzsNCgl9DQoJJCgnI3RvcGljc0ZhY2V0cycpLmZpbmQoJy5maWx0ZXItb3B0aW9ucycpLmFwcGVuZCh0b3BpY0ZhY2V0TWFya3VwKTsNCn0NCg0KZnVuY3Rpb24gZmFjZXRzU2VhcmNoKCkgew0KCXZhciBzZWxlY3RlZEZhY2V0c0lkLCBmaW5hbFNlbGVjdGVkRmFjZXQgPSAiIiwgZmFjZXRWYWw7DQoJdmFyIHByb2R1Y3RzRmFjZXRzID0gIlByb2R1Y3RzOiI7DQoJdmFyIG9zRmFjZXRzID0gIk9TOiI7DQoJdmFyIHRvcGljRmFjZXRzID0gIlRvcGljczoiOw0KCS8qdmFyIGFsbEZhY2V0cyA9ICQoJy5pY2hlY2tib3hfZmxhdC1ibHVlJyk7DQoNCgkkLmVhY2goYWxsRmFjZXRzLGZ1bmN0aW9uKGNvdW50LHNlbGVjdGVkRmFjZXQpICB7DQoJCWlmKCQoc2VsZWN0ZWRGYWNldCkuaGFzQ2xhc3MoJ2NoZWNrZWQnKSl7DQoJCQlzZWxlY3RlZEZhY2V0c0lkID0gJChzZWxlY3RlZEZhY2V0KS5wYXJlbnQoKS5zaWJsaW5ncygnaW5wdXRbdHlwZT0iaGlkZGVuIl0nKS52YWwoKTsNCgkJCWZhY2V0VmFsID0gKCQoc2VsZWN0ZWRGYWNldCkucGFyZW50cygndWwuZmlsdGVyLW9wdGlvbnMtbmVzdGVkJykuYXR0cignaWQnKSkgPyAkKHNlbGVjdGVkRmFjZXQpLnBhcmVudHMoJ3VsLmZpbHRlci1vcHRpb25zLW5lc3RlZCcpLmF0dHIoJ2lkJykgOiAndG9waWNGYWNldHMnOw0KCQkJaWYoc2VsZWN0ZWRGYWNldHNJZCE9dW5kZWZpbmVkKSB7DQoJCQkJaWYoZmFjZXRWYWwuaW5kZXhPZigncHJvZHVjdCcpIT0tMSkNCgkJCQkJcHJvZHVjdHNGYWNldHMgPSBwcm9kdWN0c0ZhY2V0cyArIHNlbGVjdGVkRmFjZXRzSWQgKyAnLCc7DQoJCQkJZWxzZSBpZihmYWNldFZhbC5pbmRleE9mKCdPUycpIT0tMSkNCgkJCQkJb3NGYWNldHMgPSBvc0ZhY2V0cyArIHNlbGVjdGVkRmFjZXRzSWQgKyAnLCc7DQoJCQkJZWxzZQ0KCQkJCQl0b3BpY0ZhY2V0cyA9IHRvcGljRmFjZXRzICsgc2VsZWN0ZWRGYWNldHNJZCArICcsJzsNCgkJCX0NCgkJfQ0KCX0pKi8NCg0KCXZhciBhbGxGYWNldHMgPSAkKCcuaWNoZWNrLWlucHV0Jyk7DQoNCgkkLmVhY2goYWxsRmFjZXRzLGZ1bmN0aW9uKGNvdW50LHNlbGVjdGVkRmFjZXQpICB7DQoJCWlmKCQoc2VsZWN0ZWRGYWNldCkuaXMoJzpjaGVja2VkJykpew0KCQkJc2VsZWN0ZWRGYWNldHNJZCA9ICQoc2VsZWN0ZWRGYWNldCkucGFyZW50cygnbGFiZWwnKS5zaWJsaW5ncygnaW5wdXRbdHlwZT0iaGlkZGVuIl0nKS52YWwoKTsNCgkJCWZhY2V0VmFsID0gKCQoc2VsZWN0ZWRGYWNldCkucGFyZW50cygndWwuZmlsdGVyLW9wdGlvbnMtbmVzdGVkJykuYXR0cignaWQnKSkgPyAkKHNlbGVjdGVkRmFjZXQpLnBhcmVudHMoJ3VsLmZpbHRlci1vcHRpb25zLW5lc3RlZCcpLmF0dHIoJ2lkJykgOiAndG9waWNGYWNldHMnOw0KCQkJaWYoc2VsZWN0ZWRGYWNldHNJZCE9dW5kZWZpbmVkKSB7DQoJCQkJaWYoZmFjZXRWYWwuaW5kZXhPZigncHJvZHVjdCcpIT0tMSkNCgkJCQkJcHJvZHVjdHNGYWNldHMgPSBwcm9kdWN0c0ZhY2V0cyArIHNlbGVjdGVkRmFjZXRzSWQgKyAnLCc7DQoJCQkJZWxzZSBpZihmYWNldFZhbC5pbmRleE9mKCdPUycpIT0tMSkNCgkJCQkJb3NGYWNldHMgPSBvc0ZhY2V0cyArIHNlbGVjdGVkRmFjZXRzSWQgKyAnLCc7DQoJCQkJZWxzZQ0KCQkJCQl0b3BpY0ZhY2V0cyA9IHRvcGljRmFjZXRzICsgc2VsZWN0ZWRGYWNldHNJZCArICcsJzsNCgkJCX0NCgkJfQ0KCX0pDQoNCg0KCWlmKHByb2R1Y3RzRmFjZXRzLmluZGV4T2YoIiwiKSE9LTEpIHsNCgkJcHJvZHVjdHNGYWNldHMgPSBwcm9kdWN0c0ZhY2V0cy5zdWJzdHJpbmcoMCxwcm9kdWN0c0ZhY2V0cy5sZW5ndGgtMSk7DQoJCWZpbmFsU2VsZWN0ZWRGYWNldCA9IHByb2R1Y3RzRmFjZXRzICsgJ3wnOw0KCX0NCglpZihvc0ZhY2V0cy5pbmRleE9mKCIsIikhPS0xKSB7DQoJCW9zRmFjZXRzID0gb3NGYWNldHMuc3Vic3RyaW5nKDAsb3NGYWNldHMubGVuZ3RoLTEpOw0KCQlmaW5hbFNlbGVjdGVkRmFjZXQgPSBmaW5hbFNlbGVjdGVkRmFjZXQgKyBvc0ZhY2V0cyArICd8JzsNCgl9DQoNCglpZih0b3BpY0ZhY2V0cy5pbmRleE9mKCIsIikhPS0xKSB7DQoJCXRvcGljRmFjZXRzID0gdG9waWNGYWNldHMuc3Vic3RyaW5nKDAsdG9waWNGYWNldHMubGVuZ3RoLTEpOw0KCQlmaW5hbFNlbGVjdGVkRmFjZXQgPSBmaW5hbFNlbGVjdGVkRmFjZXQgKyB0b3BpY0ZhY2V0cyArICd8JzsNCgl9DQoNCglpZihmaW5hbFNlbGVjdGVkRmFjZXQhPSIiKSB7DQoJCWZpbmFsU2VsZWN0ZWRGYWNldCA9IGZpbmFsU2VsZWN0ZWRGYWNldC5zdWJzdHJpbmcoMCxmaW5hbFNlbGVjdGVkRmFjZXQubGVuZ3RoLTEpOw0KCX0NCg0KCXJldHVybiBmaW5hbFNlbGVjdGVkRmFjZXQ7DQp9DQoNCg0KDQoNCi8qdG8gY3JlYXRlIHBhcmFtcyBmb3IgYWpheCBjYWxsIGZvciBwYWdpbmF0aW9uIGFuZCBmYWNldHMgc2VhcmNoIC0gUmljaGEqLw0KZnVuY3Rpb24gZmFjZXRzUGFnaW5hdGlvblBhcmFtcyhwYWdlTnVtKSB7DQoNCgl2YXIgc2VhcmNoUXVlcnlGb3JEaXNwbGF5ID0gJCgiI3NlYXJjaC1pbnB1dCIpLnZhbCgpOw0KCXZhciBvc1ZhbHVlID0gJCgiI2ludGVyc3RpdGlhbFNlYXJjaE9TTDEiKS52YWwoKTsNCgl2YXIga2V5d29yZFZhbHVlID0gJCgiI2ludGVyc3RpdGlhbFNlYXJjaEtleXdvcmRzIikudmFsKCk7DQoJdmFyIHByb2RDYXRWYWx1ZSA9ICQoIiNpbnRlcnN0aXRpYWxTZWFyY2hQcm9kQ2F0ZWdvcnlMMSIpLnZhbCgpOw0KCXZhciBjb250ZXh0Q2xhc3MgPSAkKCIjY29udGV4dENsYXNzIikudmFsKCk7DQoJdmFyIGNvbnRleHRWYWx1ZSA9ICQoIiNjb250ZXh0VmFsdWUiKS52YWwoKTsNCgl2YXIgcG1OYW1lVmFsdWUgPSAkKCIjcG1OYW1lVmFsdWUiKS52YWwoKTsNCgl2YXIgcG1OdW1iZXJWYWx1ZSA9ICQoIiNwbU51bWJlclZhbHVlIikudmFsKCk7DQoJdmFyIHBtU2VyaWVzVmFsdWUgPSAkKCIjcG1TZXJpZXNWYWx1ZSIpLnZhbCgpOw0KDQoJYWpheFBhcmFtLnBhcmFtRGF0YVsiY2MiXSA9IHNlYXJjaGNjOw0KCWlmKG5vTG9jYWxSZXN1bHRzT25Mb2FkKXsNCgkJYWpheFBhcmFtLnBhcmFtRGF0YVsibGMiXSA9ICJlbiI7DQoJfQ0KCWVsc2V7DQoJCWFqYXhQYXJhbS5wYXJhbURhdGFbImxjIl0gPSBzZWFyY2hsYzsNCgl9DQoNCglhamF4UGFyYW0ucGFyYW1EYXRhWyJzZWFyY2hDb250ZXh0Il0gPSAkKCIjc2VhcmNoQ2F0ZWdvcnkiKS52YWwoKTsNCglhamF4UGFyYW0ucGFyYW1EYXRhWyJxdWVyeSJdID0gJCgnI3NlYXJjaFF1ZXJ5JykudmFsKCk7DQoJYWpheFBhcmFtLnBhcmFtRGF0YVsicGFnZU51bSJdID0gcGFnZU51bTsNCglhamF4UGFyYW0ucGFyYW1EYXRhWyJvcyJdID0gb3NWYWx1ZTsNCglhamF4UGFyYW0ucGFyYW1EYXRhWyJrZXl3b3JkIl0gPSBrZXl3b3JkVmFsdWU7DQoJYWpheFBhcmFtLnBhcmFtRGF0YVsicHJvZENhdCJdID0gcHJvZENhdFZhbHVlOw0KCWFqYXhQYXJhbS5wYXJhbURhdGFbImNvbnRleHRDbGFzcyJdID0gY29udGV4dENsYXNzOw0KCWFqYXhQYXJhbS5wYXJhbURhdGFbImNvbnRleHRWYWx1ZSJdID0gY29udGV4dFZhbHVlOw0KCWFqYXhQYXJhbS5wYXJhbURhdGFbInNlYXJjaFF1ZXJ5Rm9yRGlzcGxheSJdID0gc2VhcmNoUXVlcnlGb3JEaXNwbGF5Ow0KCWFqYXhQYXJhbS5wYXJhbURhdGFbIkN1c3RvbUhpZXJhcmNoeTIiXSA9IGZhY2V0c1NlYXJjaCgpOw0KCWFqYXhQYXJhbS5wYXJhbURhdGFbIlVSTCJdID0gbG9jYXRpb24uaHJlZjsNCglhamF4UGFyYW0ucGFyYW1EYXRhWyJwbU5hbWVWYWx1ZSJdID0gcG1OYW1lVmFsdWU7DQoJYWpheFBhcmFtLnBhcmFtRGF0YVsicG1OdW1iZXJWYWx1ZSJdID0gcG1OdW1iZXJWYWx1ZTsNCglhamF4UGFyYW0ucGFyYW1EYXRhWyJwbVNlcmllc1ZhbHVlIl0gPSBwbVNlcmllc1ZhbHVlOw0KCWFqYXhQYXJhbS5wYXJhbURhdGFbInNlb0ZyaWVuZGx5TmFtZSJdID0gJCgnI3Nlb0ZyaWVuZGx5TmFtZScpLnZhbCgpOw0KCWFqYXhQYXJhbS5wYXJhbURhdGFbImFjdHVhbFF1ZXJ5Il0gPSAkKCcjYWN0dWFsUXVlcnknKS52YWwoKTsgLy8gbWlzLXNwZWxsZWQgcXVlcnkNCgl2YXIgcHJvbW90aW9uTGlzdCA9ICQoJyNwcm9tb3Rpb25MaXN0JykudmFsKCk7DQoJaWYocHJvbW90aW9uTGlzdCA9PSAiIil7DQogICAgICAgIGFqYXhQYXJhbS5wYXJhbURhdGFbInByb21vdGlvbkxpc3QiXSA9IG51bGw7DQoJfQ0KCWVsc2V7DQoJICBhamF4UGFyYW0ucGFyYW1EYXRhWyJwcm9tb3Rpb25MaXN0Il0gPSBKU09OLnBhcnNlKHByb21vdGlvbkxpc3QpOw0KCX0NCglyZXR1cm4gYWpheFBhcmFtOw0KfQ0KDQovKmNhbGxlZCBvbiBjbGljayBvZiBmYWNldHMgLSBhamF4IGNhbGwgdG8gcmVsb2FkIHNlYXJjaCBhbmQgcGFnaW5hdGlvbiAtIFJpY2hhKi8NCmZ1bmN0aW9uIGZhY2V0c0FqYXgoKSB7DQoJdmFyIGFqYXhQYXJhbSA9IGZhY2V0c1BhZ2luYXRpb25QYXJhbXMoMSk7DQoJdmFyIHJlcXVlc3RKc29uID0gSlNPTi5zdHJpbmdpZnkoYWpheFBhcmFtLnBhcmFtRGF0YSk7DQoJdmFyIHBhZ2VVUkwgPSAkKCcjcGFnaW5hdGlvblVSTCcpLnZhbCgpOw0KCWNhbGxBamF4VXRpbCgiZmFjZXRzIixwYWdlVVJMLCJQT1NUIixwYXJzZVBhZ2luYXRpb25Kc29uLCJKU09OIiwgcmVxdWVzdEpzb24sDQoJCQludWxsLG51bGwsbnVsbCx0cnVlLGhhbmRsZUxvYWRpbmdSZXN1bHQsdHJ1ZSxoYW5kbGVMb2FkaW5nUmVzdWx0LGZhbHNlKTsNCn0NCg0KLypjYWxsZWQgb24gY2xpY2sgb2YgVmlldyBFbmdsaXNoIHJlc3VsdHMgLSBhamF4IGNhbGwgdG8gcmVsb2FkIHNlYXJjaCBhbmQgcGFnaW5hdGlvbiAtIFN1c2htaXRhKi8NCmZ1bmN0aW9uIGVuZ2xpc2hSZXN1bHRzQWpheChzZWFyY2hMYykgew0KCXZhciBhamF4UGFyYW0gPSBmYWNldHNQYWdpbmF0aW9uUGFyYW1zKDEpOw0KCWFqYXhQYXJhbS5wYXJhbURhdGFbImxjIl0gPSBzZWFyY2hMYzsNCgl2YXIgcmVxdWVzdEpzb24gPSBKU09OLnN0cmluZ2lmeShhamF4UGFyYW0ucGFyYW1EYXRhKTsNCgl2YXIgcGFnZVVSTCA9ICQoJyNwYWdpbmF0aW9uVVJMJykudmFsKCk7DQoJY2FsbEFqYXhVdGlsKCJmYWNldHMiLHBhZ2VVUkwsIlBPU1QiLHBhcnNlUGFnaW5hdGlvbkpzb25FbmdsaXNoLCJKU09OIiwgcmVxdWVzdEpzb24sDQoJCQludWxsLG51bGwsbnVsbCx0cnVlLGhhbmRsZUxvYWRpbmdSZXN1bHQsdHJ1ZSxoYW5kbGVMb2FkaW5nUmVzdWx0LGZhbHNlKTsNCn0NCmZ1bmN0aW9uIGxvY2FsUmVzdWx0c0FqYXgoc2VhcmNoTGMpIHsNCg0KCXZhciBhamF4UGFyYW0gPSBmYWNldHNQYWdpbmF0aW9uUGFyYW1zKDEpOw0KCWFqYXhQYXJhbS5wYXJhbURhdGFbImxjIl0gPSBzZWFyY2hMYzsNCgl2YXIgcmVxdWVzdEpzb24gPSBKU09OLnN0cmluZ2lmeShhamF4UGFyYW0ucGFyYW1EYXRhKTsNCgl2YXIgcGFnZVVSTCA9ICQoJyNwYWdpbmF0aW9uVVJMJykudmFsKCk7DQoJY2FsbEFqYXhVdGlsKCJmYWNldHMiLHBhZ2VVUkwsIlBPU1QiLHBhcnNlUGFnaW5hdGlvbkpzb25Mb2NhbGUsIkpTT04iLCByZXF1ZXN0SnNvbiwNCgkJCW51bGwsbnVsbCxudWxsLHRydWUsaGFuZGxlTG9hZGluZ1Jlc3VsdCx0cnVlLGhhbmRsZUxvYWRpbmdSZXN1bHQsZmFsc2UpOw0KfQ0KDQoNCi8vIGhpZGUgZmFjZXRzIGluIGNhc2Ugb2YgbGVzcyB0aGFuIDEwIHJlc3VsdHMNCmZ1bmN0aW9uIGhpZGVGYWNldHMoKSB7DQoJJCgnI2ZpbHRlcnMtYmxvY2snKS5jc3MoJ3Zpc2liaWxpdHknLCdoaWRkZW4nKTsNCgkkKCcjbGVzc1Jlc3VsdHNUZXh0JykuaGlkZSgpOw0KCSQoIiNmaWx0ZXItdHJpZ2dlciIpLmhpZGUoKTsNCgkkKCcjbmFycm93LXNlYXJjaC1yZXN1bHRzJykuaGlkZSgpOw0KCSQoJy5maWx0ZXItaGVhZGVyJykuaGlkZSgpOw0KfQ0KDQovKiBGb3Igb3MgZmFjZXQgcHJlLXBvcHVsYXRpb24gd2hpY2ggaXMgc2VsZWN0ZWQgYnkgdXNlciBmcm9tIDMwMCBtb2RhbCBwb3B1cCAqLw0KZnVuY3Rpb24gb3NQcmVQb3B1bGF0aW9uKCkgew0KCXZhciBzZWxlY3RlZE1vZGFsVmFsID0gJCgiI2ludGVyc3RpdGlhbFNlYXJjaE9TTDEiKS52YWwoKTsNCglpZihzZWxlY3RlZE1vZGFsVmFsIT0iIikgew0KCQl2YXIgYWxsT1NGYWNldHMgPSAkKCIjb3NGYWNldHMiKS5maW5kKCdpbnB1dFt0eXBlPSJoaWRkZW4iXScpOw0KCQl2YXIgdG9iZVNlbGVjdGVkRmFjZXQsIHNlbGVjdGVkRmFjZXRTZWN0aW9uOw0KCQkkLmVhY2goYWxsT1NGYWNldHMsIGZ1bmN0aW9uKGluZGV4LCBvYmopIHsNCgkJCWlmKCQob2JqKS52YWwoKSA9PSBzZWxlY3RlZE1vZGFsVmFsKSB7DQoJCQkJdG9iZVNlbGVjdGVkRmFjZXQgPSAkKG9iaikucGFyZW50KCk7DQoJCQkJc2VsZWN0ZWRGYWNldFNlY3Rpb24gPSB0b2JlU2VsZWN0ZWRGYWNldC5wYXJlbnRzKCcuZmlsdGVyLW9wdGlvbnMtbmVzdGVkJyk7DQoJCQkJdG9iZVNlbGVjdGVkRmFjZXQuZmluZCgnLmNoZWNrYm94JykucHJvcCgnY2hlY2tlZCcsdHJ1ZSk7IC8vIG1ha2luZyBhY3R1YWwgaGlkZGVuIGNoZWNrYm94IGNoZWNrZWQNCgkJCQl0b2JlU2VsZWN0ZWRGYWNldC5maW5kKCcuaWNoZWNrYm94X2ZsYXQtYmx1ZScpLmFkZENsYXNzKCdjaGVja2VkJyk7ICAvLyBtYWtpbmcgY3NzIGNyZWF0ZWQgY2hlY2tib3ggY2hlY2tlZA0KCQkJCW9zUHJlUG9wdWxhdGVDbGVhckZpbHRlcigpOyAvLyBzaG93aW5nIHNlbGVjdGVkIGZhY2V0IGluIGNsZWFyIGZhY2V0cyBzZWN0aW9uDQoJCQkJc2VsZWN0ZWRGYWNldFNlY3Rpb24uc2hvdygpOyAvLyBvcGVuIHNlbGVjdGVkIGZhY2V0IGN1c3RvbSBoZWlyYXJjeSBsZXZlbCAxIHNlY3Rpb24NCgkJCQlzZWxlY3RlZEZhY2V0U2VjdGlvbi5zaWJsaW5ncygnLmV4cGFuZGFibGUnKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsgIC8vIGNoYW5naW5nIGljb24gdG8gZXhwYW5kZWQNCgkJCX0NCgkJfSk7DQoJfQ0KfQ0KDQpmdW5jdGlvbiBvc1ByZVBvcHVsYXRlQ2xlYXJGaWx0ZXIoKSB7DQoJJCgnLmZpbHRlci1vcHRpb25zIGlucHV0W3R5cGU9ImNoZWNrYm94Il0nKS5ub3QoJ1tkYXRhLWZpbHRlcj0iYWxsIl0nKS5lYWNoKGZ1bmN0aW9uKCl7DQoJCXZhciAkaW5wdXQgPSAkKHRoaXMpOw0KCQl2YXIgJGZpbHRlckxpc3QgPSAkKCcuYXBwbGllZC1maWx0ZXJzJyk7DQoJCWlmKCRpbnB1dC5wcm9wKCdjaGVja2VkJykpew0KCQkJdmFyICR0YWcgPSAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJykpOw0KCQkJdmFyICRidXR0b24gPSAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpKTsNCgkJCXZhciBwYXJlbnRUaXRsZSA9ICQodGhpcykucGFyZW50cygnLmZpbHRlci1jYXRlZ29yeScpLmNoaWxkcmVuKCcuZmlsdGVyLXRpdGxlJykuaHRtbCgpOw0KCQkJdmFyIHRpdGxlOw0KCQkJdmFyIGNhdGVnb3J5TGlzdDsNCgkJCSRidXR0b24uYWRkQ2xhc3MoJ2ZpbHRlci1jbG9zZSBpY29uJykuYXR0cigncmVmJywgJGlucHV0LmF0dHIoJ2NsYXNzJykuc3BsaXQoJyAnKS5wb3AoKSk7DQoJCQkkdGFnLnRleHQoJCh0aGlzKS5wYXJlbnRzKCdsYWJlbCcpLnRleHQoKSkuYXR0cigncmVmJywgJGlucHV0LmF0dHIoJ2NsYXNzJykuc3BsaXQoJyAnKS5wb3AoKSkuYWRkQ2xhc3MoJ2FwcGxpZWQtZmlsdGVycy1pdGVtJykucHJlcGVuZCgkYnV0dG9uKTsNCgkJCWlmICgkKCcuZmlsdGVyLXNlbGVjdGVkLXRpdGxlW2RhdGEtc2VsZWN0ZWQtdGl0bGU9IicgKyBwYXJlbnRUaXRsZSArICciXScpLmxlbmd0aCl7DQoJCQkJJCgnLmZpbHRlci1zZWxlY3RlZC10aXRsZVtkYXRhLXNlbGVjdGVkLXRpdGxlPSInICsgcGFyZW50VGl0bGUgKyAnIl0nKS5hcHBlbmQoJHRhZyk7DQoJCQl9DQoJCQllbHNlIHsNCgkJCQl0aXRsZSA9ICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKSkuaHRtbChwYXJlbnRUaXRsZSk7DQoJCQkJY2F0ZWdvcnlMaXN0ID0gJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpKS5hZGRDbGFzcygnZmlsdGVyLXNlbGVjdGVkLXRpdGxlJykuYXR0cignZGF0YS1zZWxlY3RlZC10aXRsZScscGFyZW50VGl0bGUpLmFwcGVuZCh0aXRsZSkuYXBwZW5kKCR0YWcpOw0KCQkJCSRmaWx0ZXJMaXN0LmFwcGVuZChjYXRlZ29yeUxpc3QpOw0KCQkJfQ0KCQkJU0NGLmluaXRFbGVtKCR0YWcpOw0KICAgICAgfQ0KCSQoJy5hcHBsaWVkLWZpbHRlcnMnKS5zaG93KCk7DQoJfSk7DQoNCn0NCgp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvL0RvY3VtZW50IENyZWF0ZWQgb24gMzAvTWFyY2gvMjAxNQoKCi8vVGhpcyBpcyB0byBwcmV2ZW50IGFsbCB0aGUgcG9ydGxldCdzIHRpdGxlIGJlaW5nIHJlYWQgdmlhIHNjcmVlbiByZWFkZXIuCiQoJ2RvY3VtZW50JykucmVhZHkoZnVuY3Rpb24oKXsKCgl2YXIgYXJpYVRpbWVyID0gd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uKCl7CgoJCSQoIi5pYm1Qb3J0YWxDb250cm9sIikuYXR0cigiYXJpYS1sYWJlbGxlZGJ5IiwiICIpOwoJCQoJCS8vY29uc29sZS5sb2coJ2FyaWEgbGFibGVsbGVkJyk7CgkJd2luZG93LmNsZWFySW50ZXJ2YWwoYXJpYVRpbWVyKTsKCgl9LCAxMDAwICk7CgkKCQoJCgkvKnNlYXJjaCBCbHVlIGRyb3Bkb3duICovCgoJLy8gJCgiI3NlYXJjaC1kcm9wZG93biIpCgkvLyAJLm9uKCJjbGljayIsZnVuY3Rpb24oKXsKCS8vIAkJJCgiI3NlYXJjaERkRGl2QVQuZHJvcGRvd24iKS50b2dnbGVDbGFzcygib3BlbiIpCgkvLyAJfSkKCS8vIAkub24oIm1vdXNlZG93biIsZnVuY3Rpb24oZSl7CgkvLyAJCWlmKGUud2hpY2g9PTEpJCgiI3NlYXJjaERkRGl2QVQuZHJvcGRvd24iKS50b2dnbGVDbGFzcygib3BlbiIpCgkvLyAJfSkKCn0pOwovLyBjb21tdW5pdGllcyBsaW5rCi8qCiAqIGNvbW1lbnRpbmcgdGhpcyBhcyBhZnRlciBjb2RlIG1lcmdlLCB0aGUgZm9jdXMgaXMgY29taW5nIGluaGVyZW50bHkKICQoICIjbmF2Q29tbXVuaXRpZXMiICkuZm9jdXMoZnVuY3Rpb24oKSB7CgogICQodGhpcykuY3NzKCAib3V0bGluZS13aWR0aCIsICI1cHgiICkuY3NzKCAib3V0bGluZS1zdHlsZSIsICJhdXRvIiApLmNzcyggIm91dGxpbmUtY29sb3IiLCAiIzRkOTBmZSIgKTsKCn0pOwokKCAiI25hdkNvbW11bml0aWVzIiApLmZvY3Vzb3V0KGZ1bmN0aW9uKCkgewoKICAkKHRoaXMpLmNzcyggIm91dGxpbmUtd2lkdGgiLCAiIiApLmNzcyggIm91dGxpbmUtc3R5bGUiLCAiIiApLmNzcyggIm91dGxpbmUtY29sb3IiLCAiIiApOwoKfSk7Ki8KfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7dmFyIGlzVXNlckxvZ2dlZEluID0gZmFsc2U7CnZhciBpc1VzZXJBZHhMb2dnZWRJbiA9IGZhbHNlOwp2YXIgaHBVc2VyUHJvZmlsZU9iamVjdCA9IHt9Owp2YXIgJHVzZXJFbWFpbCA9ICQoJyNIUFBFbWFpbElkJyk7CnZhciAkQ1JNX0NEWF9VUkwgPSAkKCcjQ1JNX0NEWF9VUkwnKTsgLy8gQ3JlYXRlIGJ1c2luZXNzIGFjY291bnQgaW4gcmVnaXN0ZXIvc2lnbiBpbiBtb2RhbAoKZnVuY3Rpb24gcmVkaXJlY3RUb0hQU0FMb2dpbigpewkJLy9GdW50aW9uIHRoYXQgcmVkaXJlY3RzIHRvIEhQU0EgbG9naW4KCXZhciBkb21haW4gPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luOwoJdmFyIHVybCA9IGRvbWFpbiArICIvaHAtcHBzLXNlcnZpY2VzL2F1dGgvbG9naW4/Y2M9IiArIGdldENDTEMoImNjIikgKyAiJmxjPSIgKyBnZXRDQ0xDKCJsYyIpICsgIiZwYWdldXJsPSIgKyB3aW5kb3cubG9jYXRpb24uaHJlZjsKCXdpbmRvdy5vcGVuKHVybCwgIl9zZWxmIik7Cn0KCi8qIAoJQ3JlYXRlIGR5bmFtaWMgbWVudSBpdGVtIGFuZCBhcHBlbmQgdG8gc2lnbiBpbiBtZW51CglAUGFyYW06IGRhdGE6e2FycmF5fSAtIGNvbnRhaW4gbGluayBvYmplY3RzIHdpdGggVVJMIGFuZCBuYW1lIGF0dHJpYnV0ZQoqLwpmdW5jdGlvbiBjcmVhdGVEeW5hbWljTWVudShkYXRhKSB7CglpZiAoZGF0YSkgewoJCXZhciAkbWVudUhvbGRlciA9ICQoIiNzaWduSW5PckVkaXRNb2IiKTsKCQlmb3IgKHZhciBpdGVtIGluIGRhdGEpIHsKCQkJdmFyIG5ld01lbnVJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgoJCQluZXdNZW51SXRlbS5jbGFzc05hbWUgPSAibW9iTWVudUVsZW1lbnQiOwoJCQluZXdNZW51SXRlbS5hcHBlbmRDaGlsZChjcmVhdGVMaW5rKGRhdGFbaXRlbV0pKTsKCgkJCSRtZW51SG9sZGVyLmFwcGVuZChuZXdNZW51SXRlbSk7CgkJfQoJfQp9CgovKiAKCUNyZWF0ZSBkeW5hbWljIGFuY2hvciBlbGVtZW50IGZvciBwYXNzZWQgaXRlbS4KCUBQYXJhbTogYWNjZXB0IGRhdGEgb2JqZWN0IHdpdGggbmFtZSBhbmQgdXJsIHByb3BlcnRpZXMKCUAgcmV0dXJuOiBhbmNob3IgZWxlbWVudAoqLwpmdW5jdGlvbiBjcmVhdGVMaW5rKGl0ZW0pIHsKCXZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwoJdmFyIGxpbmtUZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoaXRlbS5uYW1lKTsKCglhLmFwcGVuZENoaWxkKGxpbmtUZXh0KTsKCWEuaHJlZiA9IGl0ZW0udXJsOwoKCXJldHVybiBhOwp9CgokKCJkb2N1bWVudCIpLnJlYWR5KGZ1bmN0aW9uKCl7CgkKCXBhaW50V2VsY29tZUhlYWRlcigpOwoJCgkvLyBkZWZpbmVkIGluIGhlYWQuanNwCglpZihzaWduT3V0TWVudU9wdGlvbnMgJiYgJC5wYXJzZUpTT04oc2lnbk91dE1lbnVPcHRpb25zKQkJCgkgICAmJiAkLnBhcnNlSlNPTihzaWduT3V0TWVudU9wdGlvbnMpLm1lbnVPcHRpb25zKXsKCQkKCQljcmVhdGVEeW5hbWljTWVudSgkLnBhcnNlSlNPTihzaWduT3V0TWVudU9wdGlvbnMpLm1lbnVPcHRpb25zKTsKCX0KCQkKCWZ1bmN0aW9uIHJlYWRDb29raWUoa2V5KXsKCQljb29raWVOYW1lID0ga2V5KyI9IjsKCQljb29raWVBcnJheSA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgiOyIpOwoJCXZhciBudW1iZXJPZk1hdGNoID0gMDsKCQlmb3IoaT0wOyBpPGNvb2tpZUFycmF5Lmxlbmd0aDsgaSsrKXsKCQkJaWYoY29va2llQXJyYXlbaV0uaW5kZXhPZihjb29raWVOYW1lKSA+PSAwKXsKCQkJCXZhciBpbmRleE9mRXEgPSBjb29raWVBcnJheVtpXS5pbmRleE9mKCI9Iik7CgkJCQl2YXIgdmFsdWUgPSBjb29raWVBcnJheVtpXS5zdWJzdHIoKGluZGV4T2ZFcSsxKSwgKGNvb2tpZUFycmF5W2ldLmxlbmd0aC0xKSk7CgkJCQludW1iZXJPZk1hdGNoICs9IDE7CgkJCQlpZih2YWx1ZSAhPSIiKXsKCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQl9CgkJCQllbHNlewoJCQkJCXJldHVybiBudWxsOwoJCQkJfQoJCQl9CgkJfQoJCWlmKG51bWJlck9mTWF0Y2ggPT0gMCl7CgkJCXJldHVybiBudWxsCgkJfQoJfQoKCWlmICgkdXNlckVtYWlsLnZhbCgpICE9PSAibnVsbCIgJiYgJHVzZXJFbWFpbC52YWwoKSAhPSB1bmRlZmluZWQpIHsKCQlpZigkdXNlckVtYWlsLnZhbCgpLmxlbmd0aCA+IDApewoJCQkkKCcjbW9kYWxMb2dpblR4dCcpLnZhbCgkdXNlckVtYWlsLnZhbCgpKTsKCQkJJCgnI2xvZ2luLW1vZGFsJykubW9kYWwoJ3Nob3cnKTsKCQl9IAoJfQoKCS8vIGNsaWNrIGV2ZW50IGZvciBhZnRlciBzaWduIGluIG1lbnUgZm9yIG1vYmlsZSBhbmQgZGVza3RvcAoJJCgiI3dlbGNvbWVNZXNzYWdlTmV3Iikub24oImNsaWNrIiwgZnVuY3Rpb24gKCkgewoJCWlmICgkKCIjcHJvZmlsZVV0aWxpdHlNZW51TW9iIikuaXMoIjp2aXNpYmxlIikpewoJCQkkKCIjcHJvZmlsZVV0aWxpdHlNZW51TW9iIikuc2xpZGVVcCgiZmFzdCIpOwoJCQkkKCIud2VsY29tZU92ZXJsYXkiKS5zbGlkZVVwKCk7CgkJCSQoIiN3ZWxjb21lVXNlckxpbmsgaS5oaWRkZW4tbGciKS5yZW1vdmVDbGFzcygiaWNvbi11cCIpLmFkZENsYXNzKCJpY29uLWR3biIpOwoJCQkkKCIjd2VsY29tZVVzZXJMaW5rIGkuZmEtY2FyZXQtdXAiKS5yZW1vdmVDbGFzcygiZmEtY2FyZXQtdXAiKS5hZGRDbGFzcygiZmEtY2FyZXQtZG93biIpOwoJCQkkKCJib2R5IikuY3NzKCJvdmVyZmxvdyIsICJhdXRvIik7CgkJfQoJCWVsc2V7CgkJCSQoIiNwcm9maWxlVXRpbGl0eU1lbnVNb2IiKS5zbGlkZURvd24oImZhc3QiKTsKCQkJJCgiYm9keSIpLmFuaW1hdGUoeyBzY3JvbGxUb3A6ICIwcHgiIH0sIDEwMCk7CgkJCSQoImJvZHkiKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiAiMHB4IiB9LCAxMDAsIGZ1bmN0aW9uICgpIHsKCQkJCSQoIi53ZWxjb21lT3ZlcmxheSIpLnNsaWRlRG93bigpOwoJCQkJaWYgKCQod2luZG93KS5pbm5lcldpZHRoKCkgPCA3ODYpeyAvLyBvdmVyZmxvdyBoaWRkZW4gb25seSBmb3IgbW9iaWxlCgkJCQkJJCgiYm9keSIpLmNzcygib3ZlcmZsb3ciLCAiaGlkZGVuIik7CgkJCQkJJCgiI3dlbGNvbWVVc2VyTGluayBpLmhpZGRlbi1sZyIpLnJlbW92ZUNsYXNzKCJpY29uLWR3biIpLmFkZENsYXNzKCJpY29uLXVwIik7CgkJCQl9CgkJCX0pOwoJCQkkKCIjd2VsY29tZVVzZXJMaW5rIGkuZmEtY2FyZXQtZG93biIpLnJlbW92ZUNsYXNzKCJmYS1jYXJldC1kb3duIikuYWRkQ2xhc3MoImZhLWNhcmV0LXVwIik7CgkJfQoJfSk7CgkKCS8vIE92ZXJsYXkgY2xpY2sgZXZlbnQgdG8gdG9nZ2xlIGljb24gY2xhc3MgYW5kIGNsb3NlIG92ZXJsYXkKCSQoIi53ZWxjb21lT3ZlcmxheSIpLm9uKCJjbGljayIsIGZ1bmN0aW9uKCl7CgkJJCgiI3dlbGNvbWVVc2VyTGluayBpLmhpZGRlbi1sZyIpLnJlbW92ZUNsYXNzKCJpY29uLXVwIikuYWRkQ2xhc3MoImljb24tZHduIik7CgkJJCgiI3Byb2ZpbGVVdGlsaXR5TWVudU1vYiIpLnNsaWRlVXAoImZhc3QiKTsKCQkkKCIud2VsY29tZU92ZXJsYXkiKS5zbGlkZVVwKCk7CgkJJCgiYm9keSIpLmNzcygib3ZlcmZsb3ciLCJhdXRvIik7Cgl9KTsKCgkvLyBzaWdub3V0IGJ1dHRvbiBjbGljayBjYWxsaW5nIG1ldGhvZAoJJCgiI3NpZ25PdXRMaW5rTW9iIikub24oImNsaWNrIiwgZnVuY3Rpb24gKCkgewoJCXZhciBkb21haW4gPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luOwoJCXZhciB1cmwgPSBkb21haW4gKyAnL2hwLXBwcy1zZXJ2aWNlcy9hdXRoL2xvZ291dD9jYz0nICsgZ2V0Q0NMQygiY2MiKSArICImbGM9IiArIGdldENDTEMoImxjIikgKyAiJnBhZ2V1cmw9IiArIHdpbmRvdy5sb2NhdGlvbi5ocmVmIDsKCQl3aW5kb3cub3Blbih1cmwsICJfc2VsZiIpOyAvLyBvcGVuIGluIG5ldyB0YWIKCX0pOwoJCgkvLyBlZGl0IHByb2ZpbGUgYnV0dG9uIGNsaWNrIGNhbGxpbmcgbWV0aG9kCgkkKCIjZWRpdFByb2ZpbGVMaW5rTW9iIikub24oImNsaWNrIiwgZnVuY3Rpb24gKCkgewoJCXZhciBkb21haW4gPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luOwoJCXZhciB1cmwgPSBkb21haW4gKyAnL2hwLXBwcy1zZXJ2aWNlcy9hdXRoL2VkaXRwcm9maWxlP2NjPScgKyBnZXRDQ0xDKCJjYyIpICsgIiZsYz0iICsgZ2V0Q0NMQygibGMiKSArICImcGFnZXVybD0iICsgd2luZG93LmxvY2F0aW9uLmhyZWY7CgkJLy93aW5kb3cub3Blbih1cmwsICJfc2VsZiIpOwoJCS8vT3BlbiBFZGl0IFByb2ZpbGUgV2luZG93IGluIG5ldyBUYWIgLS0gSFBJRAoJCXdpbmRvdy5vcGVuKHVybCk7Cgl9KTsKCglpZihyZWFkQ29va2llKCJIUFBTRVNTSU9OIikgIT0gbnVsbCB8fCByZWFkQ29va2llKCJTTVNFU1NJT04iKSAhPSBudWxsKXsKCQkvL2dldFVzZXJQcm9maWxlKCk7Cgl9CgoJJChkb2N1bWVudCkub24oImNsaWNrIiwgIiNidG5DcmVhdGVQZXJzb25hbEFDIiwgZnVuY3Rpb24gKCkgewoJCXZhciBsYyA9IGdldENDTEMoImxjIik7CgkJdmFyIGNjID0gZ2V0Q0NMQygiY2MiKTsKCQkKCQl2YXIgZG9tYWluID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbjsKCgkJdmFyIHVybCA9IGRvbWFpbiArICcvaHAtcHBzLXNlcnZpY2VzL2F1dGgvcmVnaXN0cmF0aW9uP2NjPScgKyBjYyArICcmbGM9JyArIGxjICsgIiZwYWdldXJsPSIgKyB3aW5kb3cubG9jYXRpb24uaHJlZjsKCQl3aW5kb3cub3Blbih1cmwsICJfc2VsZiIpOwoJfSk7CgoJCSQoZG9jdW1lbnQpLm9uKCJjbGljayIsICIjYnRuQ3JlYXRlQnVzaW5lc3NBQyIsIGZ1bmN0aW9uICgpIHsKCQlpZiAoJENSTV9DRFhfVVJMLnZhbCgpLmxlbmd0aCA+IDApIHsKCQkJd2luZG93Lm9wZW4oJENSTV9DRFhfVVJMLnZhbCgpLCAiX3NlbGYiKTsKCQl9Cgl9KTsKfSk7CgovKioKICogCiAqLwpmdW5jdGlvbiBwYWludFdlbGNvbWVIZWFkZXIoKXsKCQkKCQoJaWYgKHR5cGVvZiBwcm9maWxlRGV0YWlscyAhPT0gJ3VuZGVmaW5lZCcgJiYgcHJvZmlsZURldGFpbHMgJiYgKHByb2ZpbGVEZXRhaWxzLmZpcnN0TmFtZSB8fCBwcm9maWxlRGV0YWlscy5sYXN0TmFtZSkpIHsKCWlmKHByb2ZpbGVEZXRhaWxzLnNpZ25PdXRMaW5rKXsKCQkkKCIjc2lnbk91dExpbmtNb2IiKS5hdHRyKCJocmVmIixwcm9maWxlRGV0YWlscy5zaWduT3V0TGluayk7Cgl9CglpZihwcm9maWxlRGV0YWlscy5lZGl0UHJvZmlsZUxpbmspewoJCSQoIiNlZGl0UHJvZmlsZUxpbmtNb2IiKS5hdHRyKCJocmVmIixwcm9maWxlRGV0YWlscy5lZGl0UHJvZmlsZUxpbmspOwoJfQoJaXNVc2VyTG9nZ2VkSW4gPSB0cnVlOwoJCgkvLyAvLyBoaWRlIHNpZ24gaW4vcmVnaXN0ZXIKCS8vICQoIi5zaWduSW5SZWdpc3RlckxpbmsiKS5hZGRDbGFzcygiaGlkZSIpOwoJCgkvLyAvLyBzaG93IHdlbGNvbWUgdXNlciBtZXNzYWdlCgkvLyAkKCIjd2VsY29tZVVzZXJMaW5rIikucmVtb3ZlQ2xhc3MoImhpZGUiKTsKCQoJLy8gJCgiI3dlbGNvbWVIZWFkZXIiKS5zaG93KCk7CQoKCS8vYWRkaW5nIGNvZGUgc2FtZSBhcyBzcGxpdFNlYXJjaEJveC5qcyBmb3IgaGVhZGVyCgl2YXIgJHVzZXJOYW1lID0gJCgiLnVzZXJGaXJzdE5hbWUiKTsKCXZhciBjYyA9IGdldENDTEMoImNjIik7CgoJCXZhciB1c2VyTmFtZTsKCQkvL1N0b3J5IFIxODMtMjIyLSBEaXNwbGF5IGxhc3RuYW1lK2ZpcnN0bmFtZSt0aXRsZSBmb3IgZmV3IGxvY2FsZXMKCQlpZiAoY2MgPT0gJ2pwJyB8fCBjYyA9PSAna3InIHx8IGNjID09ICdjbicgfHwgY2MgPT0gJ3R3JyB8fCBjYyA9PSAnaGsnKSB7CgkJCXVzZXJOYW1lID0gcHJvZmlsZURldGFpbHMubGFzdE5hbWUrIiAiK3Byb2ZpbGVEZXRhaWxzLmZpcnN0TmFtZTsKCQkJaWYoY2M9PSdqcCcpewoJCQkJdXNlck5hbWU9dXNlck5hbWUrIiAiKyQoIiNqYXBhblNhbWFDaGFyYWN0ZXJUZXJtYmFzZSIpLnZhbCgpOwoJCQl9CgkJCWVsc2UgaWYoY2M9PSdrcicpewoJCQkJdXNlck5hbWU9dXNlck5hbWUrIiAiKyQoIiNrb3JlYW5TYW1hQ2hhcmFjdGVyVGVybWJhc2UiKS52YWwoKTsKCQkJfQoJCX0gZWxzZSB7CgkJCXVzZXJOYW1lID0gcHJvZmlsZURldGFpbHMuZmlyc3ROYW1lOwoJCX0KCQkkdXNlck5hbWUuaHRtbCh1c2VyTmFtZSk7CgkJJCgiI2xhc3ROYW1lIikuaHRtbChwcm9maWxlRGV0YWlscy5sYXN0TmFtZSk7CgkJCgkJJCgiLndlbGNvbWVNZXNzYWdlTmV3IikucmVtb3ZlQ2xhc3MoImhpZGUiKTsgLy8gc2hvd2luZyBXZWxjb21lLCB1c2VyTmFtZQoJCSQoIi5zaWduSW5SZWdpc3RlckxpbmsiKS5hZGRDbGFzcygiaGlkZSIpOyAvLyBoaWRpbmcgc2lnbiBpbiAvIHJlZ2lzdGVyCgl9IGVsc2UgewoJCS8vIG5vdCBzaWduZWQgaW4gdXNlcgoJCSQoIi5zaWduSW5SZWdpc3RlckxpbmsiKS5yZW1vdmVDbGFzcygiaGlkZSIpOyAvLyBzaG93aW5nIHNpZ24gaW4gLyByZWdpc3RlcgoJCSQoIi53ZWxjb21lTWVzc2FnZU5ldyIpLmFkZENsYXNzKCJoaWRlIik7IC8vIGhpZGluZyBXZWxjb21lLCB1c2VyTmFtZQoKCX0KfQoKCn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5e3ZhciB0b3JvbnRvID0ge307CnRvcm9udG8ubWF4SWRsZVRpbWUgPSBjaGF0Qm90TWF4SWRsZTsgLy8gcHVsbGVkIGZyb20gU1NDIGtleQp0b3JvbnRvLnRpbWVPdXRJZCA9IG51bGw7CnRvcm9udG8ucHJvbXB0RW5hYmxlZElkID0gbnVsbDsKdG9yb250by5jaGF0Qm90UHJvYWN0aXZlV2FpdCA9IGNoYXRCb3RQcm9hY3RpdmVXYWl0Owp0b3JvbnRvLnByb21wdERpc2FibGVkSWQgPSBudWxsOwp0b3JvbnRvLmNoYXRCb3RQcm9hY3RpdmVUaW1lb3V0ID0gY2hhdEJvdFByb2FjdGl2ZVRpbWVvdXQ7CgokKHdpbmRvdykub24oImxvYWQiLCBmdW5jdGlvbigpewoJaWYoIWlzTW9iaWxlRGV2aWNlKCkgJiYgc2NyZWVuLndpZHRoPjc1MCkgewoJCWhhbmRsZUhvdmVyVGV4dCgiYmluZCIpOwoJfQoJdmFyIHRvcm9udG9MYXVuY2hlZENoZWNrID0gZmFsc2U7CglpZihsb2NhbFN0b3JhZ2UudG9yb250b0NoYXRMYXVuY2hlZCA9PSAidHJ1ZSIpewoJCXRvcm9udG9MYXVuY2hlZENoZWNrID0gdHJ1ZTsKCX0KCglpZihsb2NhbFN0b3JhZ2UudG9yb250b1NOICE9IHVuZGVmaW5lZCkgewoJCWhhbmRsZVByb2R1Y3RDb250ZXh0KCJjb21wYXJlIik7CgkJaGFuZGxlUHJvZHVjdENvbnRleHQoInNhdmUiKTsKCX0KCgkvLyBvbiBsb2FkLCBzZXQvcmVzZXQgcHJvYWN0aXZlIHByb21wdCByZWxhdGVkIHRpbWVyCglpZihjaGF0Qm90UHJvYWN0aXZlVGVtcGxhdGVzICYmIGNoYXRCb3RQcm9hY3RpdmVUZW1wbGF0ZXMhPSJub25lIiAmJiBjaGF0Qm90UHJvYWN0aXZlVGVtcGxhdGVzIT0iIiAmJiBnbG9iYWxEYXRhTGF5ZXIuVGVtcGxhdGUhPSIiICYmCgkoY2hhdEJvdFByb2FjdGl2ZVRlbXBsYXRlcy5pbmRleE9mKGdsb2JhbERhdGFMYXllci5UZW1wbGF0ZSk+LTEgfHwgY2hhdEJvdFByb2FjdGl2ZVRlbXBsYXRlcy50b0xvd2VyQ2FzZSgpPT0iYWxsIikgCgkmJiBsb2NhbFN0b3JhZ2UuZGlzbWlzc1Byb21wdEZsYWcgIT0gInRydWUiKSB7CgkJaWYodG9yb250by5wcm9tcHRFbmFibGVkSWQpIHsKCQkJaGFuZGxlUHJvYWN0aXZlUHJvbXB0KCJyZXNldCIpOwoJCX0gZWxzZSB7CgkJCWhhbmRsZVByb2FjdGl2ZVByb21wdCgic3RhcnQiKTsKCQl9Cgl9IGVsc2UgewoJCWhhbmRsZVByb2FjdGl2ZVByb21wdCgiY2xvc2UiKTsKCQloYW5kbGVEaXNhYmxlUHJvYWN0aXZlUHJvbXB0KCJjbG9zZSIpOwoJfQoKCXZhciBwYWdlSWRlbnRpZmllclRvcm9udG9DaGVjayA9IGZhbHNlOwoJaWYodGVtcGxhdGVBcnJheSAhPSB1bmRlZmluZWQgJiYgKHRlbXBsYXRlQXJyYXkuaW5kZXhPZihnbG9iYWxEYXRhTGF5ZXIuVGVtcGxhdGUpID49IDAgfHwgdGVtcGxhdGVBcnJheS5pbmRleE9mKCJBbGwiKSA+PSAwKSkgewoJCXBhZ2VJZGVudGlmaWVyVG9yb250b0NoZWNrID0gdHJ1ZTsKCX0KCgl2YXIgdG1zTGV2ZWxUb3JvbnRvQ2hlY2sgPSB0cnVlOwoJaWYoJCgiI2lzQ2hhdEJvdFJlcXVpcmVkIikudmFsKCkgIT0gdW5kZWZpbmVkKXsKCQlpZigkKCIjaXNDaGF0Qm90UmVxdWlyZWQiKS52YWwoKSAhPSAieWVzIil7CgkJCXRtc0xldmVsVG9yb250b0NoZWNrID0gZmFsc2U7CgkJfQoJfQoJCglzaG93SGlkZUNoYXRib3RXaWRnZXQodG9yb250b0xhdW5jaGVkQ2hlY2ssIHBhZ2VJZGVudGlmaWVyVG9yb250b0NoZWNrLCB0bXNMZXZlbFRvcm9udG9DaGVjayk7Cn0pOwoKJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXsKCWlmKGxvY2FsU3RvcmFnZS50b3JvbnRvRW5kVGltZVN0YW1wICE9IHVuZGVmaW5lZCl7ICAgICAgIAkJCQkvL0NoZWNraW5nIGxvY2FsU3RvcmFnZSB0aW1lc3RhbXAKCQl2YXIgZW5kU3RhbXBUb3JvbnRvID0gcGFyc2VJbnQobG9jYWxTdG9yYWdlLnRvcm9udG9FbmRUaW1lU3RhbXApOwoJCXZhciBjdXJyZW50VGltZVN0YW1wID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CgkJaWYoY3VycmVudFRpbWVTdGFtcCA+PSBlbmRTdGFtcFRvcm9udG8pewoJCQlsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgidG9yb250b0NoYXRMYXVuY2hlZCIpOwoJCQlsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiZXhwaXJhdGlvblRpbWVXaXRoQnVmZmVyIik7CgkJCWxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJ0b3JvbnRvQ29udmVyc2F0aW9uSWQiKTsKCQkJbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInRvcm9udG9Db252ZXJzYXRpb25TdGFydCIpOwoJCQlsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgidG9yb250b0NoYXRCb3RUb2tlbiIpOwoJCQlsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiZGlzbWlzc1Byb21wdEZsYWciKTsKCQkJbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInRvcm9udG9Qcm9kdWN0Q29udGV4dCIpOwoJCQlsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgidG9yb250b1NOIik7CgkJCWxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJ0b3JvbnRvUE4iKTsKCQl9Cgl9CgoJJCgiI2NoYXRib3RUb3JvbnRvLCAuY2hhdE5vdGlmaWNhdGlvbkJhZGdlIikub24oImNsaWNrIiwgZnVuY3Rpb24oKXsKCQkvLyBvcGVuQ2hhdFdpbmRvdygpOwoJCW9wZW5DaGF0V2luZG93SW5OZXd0YWIoKTsKCX0pOwoJJCgiI3Nlc3Npb25UaW1lb3V0Q2xvc2UiKS5vbigiY2xpY2sgdGFwIiwgZnVuY3Rpb24oKXsKCQkkKCIjbW9kYWxTcGlubmVyIikuaGlkZSgpOwoJCSQoJyNzZXNzaW9uVGltZW91dE1vZGFsJykubW9kYWwoJ2hpZGUnKTsgIC8vY2xvc2Ugc2Vzc2lvbiBUaW1lb3V0IHBvcCB1cCBmb3IgVVMgMTk0LTI4NgoJCSQoIiNzaWduT3V0TGlua01vYiIpLmNsaWNrKCk7Cgl9KTsKCSQoZG9jdW1lbnQpLm9uKCdrZXlwcmVzcycsICIjc2Vzc2lvblRpbWVvdXRDbG9zZSIsIGZ1bmN0aW9uKGV2ZW50KSB7IC8vIGxvZ2ljIHRvIHNpbXVsYXRlIGxvZ291dCB3aGVuIHBvcCB1cCBpcyBjbG9zZWQgZm9yIFVTIDE5NC0yODYKCQkgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7CgkJICAgICAgICAkKCcjc2Vzc2lvblRpbWVvdXRNb2RhbCcpLm1vZGFsKCdoaWRlJyk7CgkJICAgICAgICAkKCIjbW9kYWxTcGlubmVyIikuaGlkZSgpOwoJCSAgICAgICAgJCgiI3NpZ25PdXRMaW5rTW9iIikuY2xpY2soKTsKCQkgICAgfQoJfSk7CgkkKCIjc2Vzc2lvbnRpbWVkb3V0X3NpZ25pbiIpLm9uKCJjbGljayB0YXAiLCBmdW5jdGlvbigpewoJCSQoJyNzZXNzaW9uVGltZW91dE1vZGFsJykubW9kYWwoJ2hpZGUnKTsKCQl2YXIgaG9zdE5hbWUgPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWU7CQkvL3JlZGlyZWN0aW5nIHRvIEhQIGxvZ2luIGFuZCBiYWNrIHRvIHRoZSBjb250ZXh0dWFsIHBhZ2UgZm9yIFVTIDE5NC0yODYKCQl2YXIgbG9naW5VcmwgPSAiaHR0cHM6Ly8iK2hvc3ROYW1lKyIvaHAtcHBzLXNlcnZpY2VzL2F1dGgvbG9naW4/Y2M9IitnZXRDQ0xDKCdjYycpKyImbGM9IitnZXRDQ0xDKCdsYycpKyImcGFnZVVybD0iK3dpbmRvdy5sb2NhdGlvbi5ocmVmOwoJCWxvZ2luVXJsID0gZW5jb2RlVVJJQ29tcG9uZW50KGxvZ2luVXJsKTsKCQl2YXIgbG9nb3V0VXJsID0gImh0dHBzOi8vIitob3N0TmFtZSsiL2hwLXBwcy1zZXJ2aWNlcy9hdXRoL2xvZ291dD9jYz0iK2dldENDTEMoJ2NjJykrIiZsYz0iK2dldENDTEMoJ2xjJykrIiZwYWdldXJsPSIrbG9naW5Vcmw7CgkJd2luZG93LmxvY2F0aW9uLmhyZWYgPSBsb2dvdXRVcmw7Cgl9KTsKCgkkKCIudG9yb250b0Nsb3NlSWNvbiIpLm9uKCJjbGljayIsIGZ1bmN0aW9uKCl7CgkJY2xvc2VDaGF0V2luZG93KCk7Cgl9KTsKCQoJaWYobG9jYWxTdG9yYWdlLnRvcm9udG9DaGF0TGF1bmNoZWQgPT0gInRydWUiICl7CgkJaWYobG9jYWxTdG9yYWdlLmV4cGlyYXRpb25UaW1lV2l0aEJ1ZmZlcil7CgkJCXN0YXJ0UG9sbGluZ1Rva2VuRXhwaXJ5KCk7CgkJfQoJfQoKCS8vIDUzIC0gZmV0Y2ggaW1hZ2UgZm9yIG1vYmlsZSBmcm9tIFdDTQoJZmV0Y2hXQ01DaGF0Qm90TW9iaWxlSW1hZ2UoKTsKfSk7Cgp2YXIgY2hhdE1pbmltaXplZCA9IHRydWU7CnZhciBjaGF0TWVzc2FnZUNvdW50ZXJPbk1pbmltaXplID0gMDsKdmFyIGNoYXRCb3RVcmwgPSAkKCIjdG9yb250b0JvdFVybCIpLnZhbCgpOyAvLyJodHRwczovLy9ocC1jY2ktdmlydHVhbGFnZW50LmF6dXJld2Vic2l0ZXMubmV0IjsKdmFyIGNoYXRCb3RVcmxNb2JpbGUgPSAkKCIjdG9yb250b0JvdE1vYmlsZVVybCIpLnZhbCgpOwp2YXIgY2hhdFNlc3Npb25JbkhvdXJzID0gJCgiI3Rvcm9udG9Cb3RTZXNzaW9uSW5IcnMiKS52YWwoKTsgLy84Owp2YXIgY2hhdEJvdENsaWVudCA9ICQoIiN0b3JvbnRvQm90Q2xpZW50IikudmFsKCk7IC8vIHdlYndpZGdldAp2YXIgY2hhdEJvdFN1YkNsaWVudCA9ICQoIiN0b3JvbnRvQm90U3ViQ2xpZW50IikudmFsKCk7IC8vIHdlYndpZGdldAoKaWYobG9jYWxTdG9yYWdlLnRvcm9udG9DaGF0TGF1bmNoZWQgPT0gInRydWUiKXsKCWdsb2JhbERhdGFMYXllci5jaGF0Qm90QWNjZXNzZWQgPSB0cnVlOwp9CmVsc2V7CglnbG9iYWxEYXRhTGF5ZXIuY2hhdEJvdEFjY2Vzc2VkID0gZmFsc2U7Cn0KCmlmKGxvY2FsU3RvcmFnZS50b3JvbnRvQ29udmVyc2F0aW9uSWQgIT0gdW5kZWZpbmVkKXsKCWdsb2JhbERhdGFMYXllci5jb252ZXJzYXRpb25JZCA9IGxvY2FsU3RvcmFnZS50b3JvbnRvQ29udmVyc2F0aW9uSWQ7Cn0KCnZhciBwYXlsb2FkU2tlbGV0b24gPSB7CiAgICJ0eXBlIjoiZXZlbnQiLAogICAiZnJvbSI6ewogICAgICAiaWQiOiJkZWZhdWx0X3VzZXJpZCIsCiAgICAgICJuYW1lIjoiVXNlciIKICAgfSwKICAgInRleHQiOiIiLAogICAibmFtZSI6ImNvbnRleHRSZWNlaXZlZCIsICAgCiAgICJ2YWx1ZSI6ewoJICAgInN0YXRlIiA6IHsKCQkgICAiYm90Q2xpZW50IiA6IGNoYXRCb3RDbGllbnQsCgkJICAgImJvdFN1YkNsaWVudCI6IGNoYXRCb3RTdWJDbGllbnQKCSAgIH0sCiAgICAgICJwcm9kdWN0Ijp7CiAgICAgICAgICJwcm9kdWN0T2lkIjoiIiwKICAgICAgICAgImNvdW50cnlDb2RlIjoiIiwKICAgICAgICAgImxhbmd1YWdlQ29kZSI6IiIsCiAgICAgICAgICJwcm9kdWN0TnVtYmVyIjoiIiwKICAgICAgICAgInNlcmlhbE51bWJlciI6IiIsCiAgICAgICAgICJwcm9kdWN0U2VyaWVzT2lkIjoiIgogICAgICB9LAogICAgICAidXNlciI6ewogICAgICAgICAiRW1haWwiOiIiLAogICAgICAgICAiRmlyc3ROYW1lIjoiIiwKICAgICAgICAgIkxhc3ROYW1lIjoiIiwKICAgICAgICAgIlBob25lTnVtYmVyIjoiIgogICAgICB9LAogICAgICAiY29udmVyc2F0aW9uU3RhcnQiOmZhbHNlLAogICAgICAiR0RMIjp7fQogICAJfQp9OwoKdmFyIGNoYXRPcGVuZWRGaXJzdFRpbWVPblBhZ2UgPSB0cnVlOwp2YXIgdG9rZW4gPSAiIjsKCi8vR2xvYmFsIENoYXQgQm90IEhlbHBlciBGdW5jdGlvbnMKZnVuY3Rpb24gb3BlbkNoYXRXaW5kb3coKXsKCWlmKGxvY2FsU3RvcmFnZS50b3JvbnRvQ2hhdExhdW5jaGVkICE9ICJ0cnVlIiB8fCBsb2NhbFN0b3JhZ2UudG9yb250b1Byb2R1Y3RDb250ZXh0ID09ICJ0cnVlIil7CgkJbG9jYWxTdG9yYWdlLnRvcm9udG9Qcm9kdWN0Q29udGV4dCA9IGZhbHNlOwoJCWxhdW5jaENoYXRCb3QoKTsKCX0KCWVsc2V7CgkJaWYoY2hhdE9wZW5lZEZpcnN0VGltZU9uUGFnZSl7CgkJCXVwZGF0ZUJvdERhdGEoKTsJCgkJfQkKCX0KCWNoYXRNZXNzYWdlQ291bnRlck9uTWluaW1pemUgPSAwOwoJaWYoJCgiLmNoYXROb3RpZmljYXRpb25CYWRnZSIpLmlzKCI6dmlzaWJsZSIpKXsKCQkkKCIuY2hhdE5vdGlmaWNhdGlvbkJhZGdlIikuaGlkZSg1MDApOwoJfQoJJCgiI3Rvcm9udG9DaGF0UGFnZSIpLnNsaWRlRG93bigxMDAsIGZ1bmN0aW9uKCl7CgkJJCgiI2NoYXRib3RUb3JvbnRvIikuc2xpZGVVcCgxMDAsIG9uQ2hhdFdpbmRvd09wZW5Db21wbGV0ZSgpKTsKCX0pOwoKCS8vIFIxODItNzAgLSBzZXQgdGhlIGNoZWNrVGltZSBmbGFnIGFuZCBzdGFydCB0aGUgdGltZXIKCWhhbmRsZVRvcm9udG9UaW1lcigic3RhcnQiKTsKCS8vIFIxODItNjkgLSBzYXZlIFNOIGFuZCBQTiBpbiBsb2NhbHN0b3JhZ2UgaWYgcGFnZSBpcyBwcm9kdWN0IGNvbnRleHR1YWwKCWhhbmRsZVByb2R1Y3RDb250ZXh0KCJzYXZlIik7CgkvLyBkaXNtaXNzIGNoYXQgcHJvbXB0CglkaXNtaXNzQ2hhdFByb21wdCgpOwoJaGFuZGxlSG92ZXJUZXh0KCJ1bmJpbmQiKTsKfQoKZnVuY3Rpb24gbG9hZENoYXRCb3RJZnJhbWUodG9rZW4pewoJdmFyIGlmcmFtZUluc3RhbmNlID0gJCgiaWZyYW1lLnRvcm9udG9DaGF0Qm90SWZyYW1lIik7Cgl2YXIgY2hhdEJvdFVybEZvcklmcmFtZTsKCQoJaWYoaXNNb2JpbGVEZXZpY2UoKSkgewoJCWNoYXRCb3RVcmxGb3JJZnJhbWUgPSBjaGF0Qm90VXJsTW9iaWxlOwoJfSBlbHNlIHsKCQljaGF0Qm90VXJsRm9ySWZyYW1lID0gY2hhdEJvdFVybDsKCX0KCS8vIGlmIHRoZXJlIGFyZSBvdGhlciBxdWVyeSBzdHJpbmdzIGFkZGVkIHRvIHRoZSBib3QKCS8vIGlmcmFtZSBVUkwgdmlhIFNTQyAoZS5nLiBmb3IgZGVidWdnaW5nKQoJaWYoY2hhdEJvdFVybEZvcklmcmFtZS5pbmRleE9mKCI/Iik+PTApewoJCS8vIGFwcGVuZCBhICYgaW5zdGVhZCBvZiA/LCBpZiBuZWVkZWQKCQlpZihjaGF0Qm90VXJsRm9ySWZyYW1lLmNoYXJBdChjaGF0Qm90VXJsRm9ySWZyYW1lLmxlbmd0aC0xKSE9IiYiKXsKCQkJY2hhdEJvdFVybEZvcklmcmFtZSA9IGNoYXRCb3RVcmxGb3JJZnJhbWUuY29uY2F0KCImIik7CgkJfQoJfWVsc2V7CgkJLy8gbm8gcXVlcnkgc3RyaW5ncyBhZGRlZCB5ZXQKCQljaGF0Qm90VXJsRm9ySWZyYW1lID0gY2hhdEJvdFVybEZvcklmcmFtZS5jb25jYXQoIj8iKTsKCX0KCQoJLy8gYXBwZW5kIHRva2VuCgl2YXIgaWZyYW1lU3JjID0gY2hhdEJvdFVybEZvcklmcmFtZSsidD0iK3Rva2VuOwoJaWZyYW1lSW5zdGFuY2UuYXR0cigic3JjIiwgaWZyYW1lU3JjKTsKfQoKLyoqCiAqIEBwYXJhbSBpZnJhbWVJbnN0YW5jZQogKi8KZnVuY3Rpb24gaW5zZXJ0Q2hhdEJvdElmcmFtZShpZnJhbWVJbnN0YW5jZSl7CgkKCS8vIGlmIHRoZSBjaGF0IGJvdCBpZnJhbWUgaGFzIGxvYWRlZAoJaWYoJChpZnJhbWVJbnN0YW5jZSkuYXR0cigic3JjIikgIT0gdW5kZWZpbmVkKXsKCQkKCQkvLyBzaG93IGEgc3Bpbm5lcgoJCWhpZGVMb2FkaW5nU3Bpbm5lcigpOwoJCQoJCS8vIHNob3cgdGhlIGJvdCBmcmFtZQoJCSQoIi50b3JvbnRvQ2hhdEJvdElmcmFtZSIpLnJlbW92ZUNsYXNzKCJoaWRlQ2hhdGJvdCIpOwoJCSQoIiN0b3JvbnRvQ2hhdFByb21wdCIpLnJlbW92ZUNsYXNzKCJoaWRlQ2hhdGJvdCIpOwoJCSQoIiN0b3JvbnRvQ2hhdEhvdmVyVGV4dCIpLnJlbW92ZUNsYXNzKCJoaWRlQ2hhdGJvdCIpOwoJCQoJCS8vIHNldCB0aGUgZ2xvYmFsIGRhdGEgbGF5ZXIgdmFyaWFibGUgYXMgdHJ1ZQoJCWdsb2JhbERhdGFMYXllci5jaGF0Qm90QWNjZXNzZWQgPSB0cnVlOwoJfQp9CgpmdW5jdGlvbiBoaWRlTG9hZGluZ1NwaW5uZXIoKXsKCS8vSGlkZXMgdGhlIGxvYWRpbmcgc3Bpbm5lcgoJY29uc29sZS5sb2coIlNQSU5ORVIgSElEREVOIik7CgkkKCIuY2hhdEJvdExvYWRpbmdJbmRpY2F0b3IiKS5mYWRlT3V0KDIwMCk7Cn0KCmZ1bmN0aW9uIHNob3dMb2FkaW5nU3Bpbm5lcigpewoJaGlkZUNoYXRib3RVbmF2YWlsYWJsZSgpOwoJLy9TaG93cyB0aGUgbG9hZGluZyBzcGlubmVyCgljb25zb2xlLmxvZygiU1BJTk5FUiBTSE9XTiIpOwoJJCgiLmNoYXRCb3RMb2FkaW5nSW5kaWNhdG9yIikuZmFkZUluKDUwMCk7Cn0KCmZ1bmN0aW9uIHNob3dDaGF0Ym90VW5hdmFpbGFibGUoKXsKCSQoIi5jaGF0Qm90VW5hdmFpbGFibGUiKS5zaG93KCk7Cn0KCmZ1bmN0aW9uIGhpZGVDaGF0Ym90VW5hdmFpbGFibGUoKXsKCSQoIi5jaGF0Qm90VW5hdmFpbGFibGUiKS5oaWRlKCk7Cn0KCmZ1bmN0aW9uIGNsb3NlQ2hhdFdpbmRvdygpewoJJCgiI3Rvcm9udG9DaGF0UGFnZSIpLnNsaWRlVXAoMTAwLCBmdW5jdGlvbigpewoJCSQoIiNjaGF0Ym90VG9yb250byIpLnNsaWRlRG93bigzMDAsIG9uQ2hhdFdpbmRvd0Nsb3NlQ29tcGxldGUoKSk7Cgl9KTsKCS8vIFIxODItNzA6IHJlc2V0IGNoZWNrVGltZSBmbGFnIGFuZCBjbG9zZSB0aGUgdGltZXIKCWhhbmRsZVRvcm9udG9UaW1lcigiY2xvc2UiKTsKfQoKZnVuY3Rpb24gb25DaGF0V2luZG93T3BlbkNvbXBsZXRlKCl7Cgljb25zb2xlLmxvZygiQ2hhdCBXaW5kb3cgaXMgT1BFTiBub3chIik7CgljaGF0TWluaW1pemVkID0gZmFsc2U7CgkkKCIjb3BlbkNoYXRGb3JBY2Nlc3NpYmlsaXR5TWVzc2FnZSIpLmZvY3VzKCk7CgoJLy81NjogY2hlY2sgaWYgYWNjZXNzZWQgaW4gbW9iaWxlLCBtYWtlIGNoYXQgd2luZG93IGZ1bGwgc2l6ZQoJaWYoaXNNb2JpbGVEZXZpY2UoKSB8fCBzY3JlZW4ud2lkdGg8NzUwKSB7CgkJJCgiI3Rvcm9udG9DaGF0UGFnZSIpLmNzcygid2lkdGgiLHNjcmVlbi53aWR0aCsicHgiKTsKCQkkKCIjdG9yb250b0NoYXRQYWdlIikuY3NzKCJoZWlnaHQiLHNjcmVlbi5oZWlnaHQrInB4Iik7CgkJJCgiI3Rvcm9udG9DaGF0UGFnZSIpLmNzcygibGVmdCIsIjAiKTsKCQkvLyQoIiN0b3JvbnRvQ2hhdFBhZ2UiKS5jc3MoInRvcCIsIjAiKTsKCQkkKCIjdG9yb250b0NoYXRQYWdlIikuY3NzKCJoZWlnaHQiLHdpbmRvdy5pbm5lckhlaWdodCsicHgiKTsKCX0KfQoKZnVuY3Rpb24gb25DaGF0V2luZG93Q2xvc2VDb21wbGV0ZSgpewoJY29uc29sZS5sb2coIkNoYXQgV2luZG93IGlzIENMT1NFRCBub3chIik7CgljaGF0TWluaW1pemVkID0gdHJ1ZTsKCSQoIiNjaGF0Ym90VG9yb250byIpLmZvY3VzKCk7CgloYW5kbGVIb3ZlclRleHQoImJpbmQiKTsKCSQoIiN0b3JvbnRvQ2hhdEhvdmVyVGV4dCIpLmFkZENsYXNzKCJoaWRkZW4iKTsKfQoKZnVuY3Rpb24gc2hvd0FuZFVwZGF0ZUJhZGdlKG1lc3NhZ2VDb3VudCl7CglpZihtZXNzYWdlQ291bnQgPiAwKXsKCQkkKCIjYWNjZXNzaWJpbGl0eV9udW1iZXJfbm90aWZpY2F0aW9uIikudGV4dChtZXNzYWdlQ291bnQrJCgiI2FjY2Vzc2liaWxpdHlfbWVzc2FnZV9ub3RpZmljYXRpb24iKS50ZXh0KCkpOwoJCSQoIi5jaGF0Tm90aWZpY2F0aW9uQmFkZ2UiKS50ZXh0KG1lc3NhZ2VDb3VudCk7CgkJaWYoISQoIi5jaGF0Tm90aWZpY2F0aW9uQmFkZ2UiKS5pcygiOnZpc2libGUiKSl7CgkJCSQoIi5jaGF0Tm90aWZpY2F0aW9uQmFkZ2UiKS5zaG93KCk7CgkJfQoJfQp9CgpmdW5jdGlvbiBzaG93SGlkZUNoYXRib3RXaWRnZXQoY2hhdGJvdFVzZWQsIHBhZ2VBbmRMb2NhbGUsIHRtc1NwZWNpZmljRmxhZyl7CglpZihjaGF0Ym90VXNlZCB8fCAocGFnZUFuZExvY2FsZSAmJiB0bXNTcGVjaWZpY0ZsYWcpKXsKCQkkKCIjY2hhdGJvdFRvcm9udG8iKS5yZW1vdmVDbGFzcygiaGlkZUNoYXRib3QiKTsKCQkkKCIjdG9yb250b0NoYXRQcm9tcHQiKS5yZW1vdmVDbGFzcygiaGlkZUNoYXRib3QiKTsKCQkkKCIjdG9yb250b0NoYXRIb3ZlclRleHQiKS5yZW1vdmVDbGFzcygiaGlkZUNoYXRib3QiKTsKCQlnbG9iYWxEYXRhTGF5ZXIuY2hhdEJvdFdpZGdldElkID0gImNoYXRib3RUb3JvbnRvIjsKCX0KfQoKZnVuY3Rpb24gZ2V0UHJvZHVjdE9iakZvckJvdCgpewoJdmFyIHByb2RPYmogPSB7CiAgICAgICAgInByb2R1Y3RPaWQiOiBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zdXBwb3J0TmFtZU9pZCwKICAgICAgICAiY291bnRyeUNvZGUiOiBnZXRDQ0xDKCJjYyIpLAogICAgICAgICJsYW5ndWFnZUNvZGUiOiBnZXRDQ0xDKCJsYyIpLAogICAgICAgICJwcm9kdWN0TnVtYmVyIjogJCgiI3NrdUZyb21TZXNzaW9uIikudmFsKCksCiAgICAgICAgInNlcmlhbE51bWJlciI6ICQoIiNzZXJpYWxOdW1iZXJGcm9tU2Vzc2lvbiIpLnZhbCgpLAogICAgICAgICJwcm9kdWN0U2VyaWVzT2lkIjogZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc2VyaWVzT2lkCiAgICB9CiAgICByZXR1cm4gcHJvZE9iajsKfQoKZnVuY3Rpb24gbGF1bmNoQ2hhdEJvdCgpewoJc2hvd0xvYWRpbmdTcGlubmVyKCk7Cgljb25zb2xlLmxvZygiQk9UIExBVU5DSElORyIpOwoJLy9HZXRzIGNoYXQgdG9rZW4sIGFuZCBzZW5kcyB0aGUgR0RMLCBjb252ZXJzYXRpb24gSUQgYW5kIGNvbnZlcnNhdGlvblN0YXJ0Cgl2YXIgbGF1bmNoUGF5bG9hZCA9ICQuZXh0ZW5kKHRydWUsIHt9LCBwYXlsb2FkU2tlbGV0b24pOwoJbGF1bmNoUGF5bG9hZC52YWx1ZS5jb252ZXJzYXRpb25TdGFydCA9IHRydWU7CglsYXVuY2hQYXlsb2FkLnZhbHVlLnByb2R1Y3QgPSBnZXRQcm9kdWN0T2JqRm9yQm90KCk7CgkKCXZhciB3aW5kb3dPYmplY3RSZWZlcmVuY2U7Cgl2YXIgc3RyV2luZG93RmVhdHVyZXMgPSAibWVudWJhcj15ZXMsbG9jYXRpb249eWVzLHJlc2l6YWJsZT15ZXMsc2Nyb2xsYmFycz15ZXMsc3RhdHVzPXllcyI7Cgl3aW5kb3dPYmplY3RSZWZlcmVuY2UgPSB3aW5kb3cub3BlbigiaHR0cDovL3d3dy5zdXBwb3J0LmhwLmNvbS8iLCAiSFBfV2luZG93TmFtZSIsIHN0cldpbmRvd0ZlYXR1cmVzKTsKCgoKCWxhdW5jaFBheWxvYWQudmFsdWUuR0RMID0gZ2xvYmFsRGF0YUxheWVyOwoKCgkkLmFqYXgoewoJCXR5cGU6ICdQT1NUJywKCSAgICB1cmw6ICIvaHAtcHBzLXNlcnZpY2VzL2JvdC9hdXRoZW50aWNhdGVib3QiLAoJICAgIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24vanNvbiIsCgkgICAgZGF0YVR5cGU6ICdqc29uJywKCSAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShsYXVuY2hQYXlsb2FkKQoJfSkuZG9uZShmdW5jdGlvbihkYXRhKXsKCQkvL29uIHN1Y2Nlc3MKCQl2YXIgY2hhdFNlc3Npb25Jbk1pbGxpc2Vjb25kcyA9IHBhcnNlRmxvYXQoY2hhdFNlc3Npb25JbkhvdXJzKSAqIDM2MDAwMDA7CgkJLyoqKioqKioqKioqKioqKioqKioqTUFJTlRBSU5JTkcgVElNRVNUQU1QIFRPIEVYUElSRSBMT0NBTCBTVE9SQUdFKioqKioqKioqKioqKioqKioqKioqKioqKiovCgkJdmFyIHRvcm9udG9TdGFydFN0YW1wID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CgkJdmFyIHRvcm9udG9MYXVuY2hTZXNzaW9uRW5kU3RhbXAgPSBwYXJzZUludCh0b3JvbnRvU3RhcnRTdGFtcCkgKyBwYXJzZUludChjaGF0U2Vzc2lvbkluTWlsbGlzZWNvbmRzKTsgIC8vS2VlcGluZyBsb2NhbFN0b3JhZ2UgdGltZXN0YW1wIGV4cGlyeSBmb3IgOGhycy4KCQlsb2NhbFN0b3JhZ2UudG9yb250b1N0YXJ0VGltZVN0YW1wID0gdG9yb250b1N0YXJ0U3RhbXA7CgkJbG9jYWxTdG9yYWdlLnRvcm9udG9FbmRUaW1lU3RhbXAgPSB0b3JvbnRvTGF1bmNoU2Vzc2lvbkVuZFN0YW1wOwoJCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKCQljaGF0T3BlbmVkRmlyc3RUaW1lT25QYWdlID0gZmFsc2U7CgkJbG9jYWxTdG9yYWdlLnRvcm9udG9DaGF0TGF1bmNoZWQgPSB0cnVlOwoJCWxvY2FsU3RvcmFnZS50b3JvbnRvQ29udmVyc2F0aW9uU3RhcnQgPSB0cnVlOwoJCWxvY2FsU3RvcmFnZS50b3JvbnRvQ29udmVyc2F0aW9uSWQgPSBkYXRhLmNvbnZlcnNhdGlvbklkOwoJCWxvY2FsU3RvcmFnZS50b3JvbnRvQ2hhdEJvdFRva2VuID0gZGF0YS50b2tlbjsKCgkJZ2xvYmFsRGF0YUxheWVyLmNvbnZlcnNhdGlvbklkID0gZGF0YS5jb252ZXJzYXRpb25JZDsKCQlsb2FkQ2hhdEJvdElmcmFtZShkYXRhLnRva2VuKTsKCQlzZXRUb2tlbkJ1ZmZlcihwYXJzZUludChkYXRhLmV4cGlyZXNfaW4pKTsKCQlzdGFydFBvbGxpbmdUb2tlbkV4cGlyeSgpOwoJCQoJfSkuZmFpbChmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cyl7CgkJY29uc29sZS5sb2coIiEhISEhISEhTGF1bmNoIHNlcnZpY2UgZmFpbGVkISEhISEhISEhISEiKTsKCQloaWRlTG9hZGluZ1NwaW5uZXIoKTsKCQlzaG93Q2hhdGJvdFVuYXZhaWxhYmxlKCk7Cgl9KTsKfQoKLy9HbG9iYWwgQ2hhdCBCb3QgSW4gTmV3dGFiIEZ1bmN0aW9ucwoKZnVuY3Rpb24gb3BlbkNoYXRXaW5kb3dJbk5ld3RhYigpewoJdmFyIHdpbmRvd09iamVjdFJlZmVyZW5jZTsKCXZhciBzdHJXaW5kb3dGZWF0dXJlcyA9ICJtZW51YmFyPXllcyxsb2NhdGlvbj15ZXMscmVzaXphYmxlPXllcyxzY3JvbGxiYXJzPXllcyxzdGF0dXM9eWVzIjsKCXZhciBjb3VudHJ5Q29kZSA9ICBnZXRDQ0xDKCJjYyIpOwogICAgdmFyIGxhbmd1YWdlQ29kZSA9IGdldENDTEMoImxjIik7Cgl2YXIgc2VyaWFsTnVtYmVyID0gJCgiI3NlcmlhbE51bWJlckZyb21TZXNzaW9uIikudmFsKCk7Cgl2YXIgY2hhdEJvdFVybCA9ICQoIiN0b3JvbnRvQm90VXJsIikudmFsKCk7IC8vImh0dHBzOi8vL2hwLWNjaS12aXJ0dWFsYWdlbnQuYXp1cmV3ZWJzaXRlcy5uZXQiOwoJdmFyIGNoYXRCb3RVcmxNb2JpbGUgPSAkKCIjdG9yb250b0JvdE1vYmlsZVVybCIpLnZhbCgpOwoJdmFyIEJvdFN1YkNsaWVudCA9ICQoIiN0b3JvbnRvQm90U3ViQ2xpZW50IikudmFsKCk7Cgl2YXIgdGVtcGxhdGUgPSBnbG9iYWxEYXRhTGF5ZXIuVGVtcGxhdGUgPyBnbG9iYWxEYXRhTGF5ZXIuVGVtcGxhdGUgOicnOwoJdmFyIHF1ZXJ5ID0gZ2xvYmFsRGF0YUxheWVyLkRvY3VtZW50LlRNU0NhdGVnb3JpemF0aW9uID8gZ2xvYmFsRGF0YUxheWVyLkRvY3VtZW50LlRNU0NhdGVnb3JpemF0aW9uOiAnJzsgCgl2YXIgUEwgPSBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5wcm9kdWN0TGluZUNvZGUgPyBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5wcm9kdWN0TGluZUNvZGU6Jyc7Cgl2YXIgUHJvZHVjdE51bWJlciA9ICQoIiNza3VGcm9tU2Vzc2lvbiIpLnZhbCgpOwoJdmFyIFByb2R1Y3ROYW1lT0lEID0gZ2xvYmFsRGF0YUxheWVyLnN1cHBvcnROYW1lT2lkID8gZ2xvYmFsRGF0YUxheWVyLnN1cHBvcnROYW1lT2lkIDonJzsKCXZhciBQcm9kdWN0U2VyaWVzTmFtZSA9IGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LmJpZ1Nlcmllc05hbWUgPyBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5iaWdTZXJpZXNOYW1lIDonJzsKCXZhciBQcm9kdWN0U2VyaWVzTmFtZU9JRCA9ICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXJpZXNPaWQgID8gZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc2VyaWVzT2lkIDogJyc7Cgl2YXIgUHJvZHVjdE5hbWUgPSBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXJpZXNOYW1lID8gZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc2VyaWVzTmFtZSA6Jyc7CgkKCWlmKGlzTW9iaWxlRGV2aWNlKCkpIHsKCQljaGF0Qm90VXJsRm9yTmV3dGFiID0gY2hhdEJvdFVybE1vYmlsZTsKCX0gZWxzZSB7CgkJY2hhdEJvdFVybEZvck5ld3RhYiA9IGNoYXRCb3RVcmw7Cgl9Cgl3aW5kb3dPYmplY3RSZWZlcmVuY2UgPSB3aW5kb3cub3BlbihlbmNvZGVVUkkoY2hhdEJvdFVybEZvck5ld3RhYisiJkJvdFN1YkNsaWVudD0iK0JvdFN1YkNsaWVudCsiJlRlbXBsYXRlPSIrdGVtcGxhdGUrIiZxdWVyeT0iK3F1ZXJ5KyImU2VyaWFsTnVtYmVyPSIrc2VyaWFsTnVtYmVyKyImUEw9IitQTCsiJlByb2R1Y3ROdW1iZXI9IitQcm9kdWN0TnVtYmVyKyImUHJvZHVjdE5hbWU9IitQcm9kdWN0TmFtZSsiJlByb2R1Y3ROYW1lT0lEPSIrUHJvZHVjdE5hbWVPSUQrIiZQcm9kdWN0U2VyaWVzTmFtZT0iK1Byb2R1Y3RTZXJpZXNOYW1lKyImUHJvZHVjdFNlcmllc05hbWVPSUQ9IitQcm9kdWN0U2VyaWVzTmFtZU9JRCsiJkNDPSIrY291bnRyeUNvZGUrIiZMQz0iK2xhbmd1YWdlQ29kZSwgIlRvcm9udG9fV2luZG93TmFtZSIsIHN0cldpbmRvd0ZlYXR1cmVzKSk7CglnbG9iYWxEYXRhTGF5ZXIuY2hhdEJvdEFjY2Vzc2VkwqA9wqB0cnVlOwp9CgoKZnVuY3Rpb24gdXBkYXRlQm90RGF0YSgpewoJc2hvd0xvYWRpbmdTcGlubmVyKCk7Cgljb25zb2xlLmxvZygiVVBEQVRFIEJPVCBIQVBQRU5JTkciKTsKCXZhciB0b3JvbnRvQ2hhdFBheWxvYWQgPSAkLmV4dGVuZCh0cnVlLCB7fSwgcGF5bG9hZFNrZWxldG9uKTsKCS8vQWpheCBjYWxsIHRvIHVwZGF0ZSBib3Qgd2l0aCBHREwsIGNvbnZlcnNhdGlvbiBJRCBhbmQgY29udmVyc2F0aW9uU3RhcnQgZ29lcyBoZXJlCgl0b3JvbnRvQ2hhdFBheWxvYWQudmFsdWUuY29udmVyc2F0aW9uU3RhcnQgPSBmYWxzZTsKCXRvcm9udG9DaGF0UGF5bG9hZC52YWx1ZS5wcm9kdWN0ID0gZ2V0UHJvZHVjdE9iakZvckJvdCgpOwoJdG9yb250b0NoYXRQYXlsb2FkLnZhbHVlLkdETCA9IGdsb2JhbERhdGFMYXllcjsKCgkkLmFqYXgoewoJCXR5cGU6ICdQT1NUJywKCSAgICB1cmw6ICIvaHAtcHBzLXNlcnZpY2VzL2JvdC9zZW5kYm90YWN0aXZpdHk/dG9rZW49Iitsb2NhbFN0b3JhZ2UudG9yb250b0NoYXRCb3RUb2tlbisiJmlkPSIrbG9jYWxTdG9yYWdlLnRvcm9udG9Db252ZXJzYXRpb25JZCwKCSAgICBjb250ZW50VHlwZTogImFwcGxpY2F0aW9uL2pzb24iLAoJICAgIGRhdGFUeXBlOiAnanNvbicsCgkgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkodG9yb250b0NoYXRQYXlsb2FkKQoJfSkuZG9uZShmdW5jdGlvbihkYXRhKXsKCQkvLyBvbiBzdWNjZXNzCgkJLy9DaGF0IGhhcyBsYXVuY2hlZCBiZWNhdXNlIG9mIGxhdW5jaENoYXRCb3QoKSBoZW5jZSBsb2NhbFN0b3JhZ2UudG9yb250b0NoYXRMYXVuY2hlZCA9IHRydWU7IGFuZCBsb2NhbFN0b3JhZ2UudG9yb250b0NvbnZlcnNhdGlvblN0YXJ0ID0gdHJ1ZTsKCQkKCQkvLyoqKioqKioqKioqKioqKioqKioqKioKCQkvLyBnbG9iYWxEYXRhTGF5ZXIuY29udmVyc2F0aW9uSWQgPSBjb252ZXJzYXRpb25JRDsKCQkvLyoqKioqKioqKioqKioqKioqKioqKioKCQljaGF0T3BlbmVkRmlyc3RUaW1lT25QYWdlID0gZmFsc2U7CgkJbG9hZENoYXRCb3RJZnJhbWUobG9jYWxTdG9yYWdlLnRvcm9udG9DaGF0Qm90VG9rZW4pOwoJCQoJfSkuZmFpbChmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cyl7CgkJY29uc29sZS5sb2coIiEhISEhISEhVXBkYXRlIHNlcnZpY2UgZmFpbGVkISEhISEhISEhISEiKTsKCQlpZigkKCIudG9yb250b0NoYXRCb3RJZnJhbWUiKS5pcygiOnZpc2libGUiKSl7CgkJCSQoIi50b3JvbnRvQ2hhdEJvdElmcmFtZSIpLmFkZENsYXNzKCJoaWRlQ2hhdGJvdCIpOwoJCX0KCQloaWRlTG9hZGluZ1NwaW5uZXIoKTsKCQlzaG93Q2hhdGJvdFVuYXZhaWxhYmxlKCk7Cgl9KTsKfQoKZnVuY3Rpb24gcmVmcmVzaFRva2VuKCl7CgkvL0FKQVggQ0FMTCBUTyBSRUZSRVNIIFRPS0VOCgoJJC5hamF4KHsKCQl0eXBlOiAnUE9TVCcsCgkgICAgdXJsOiAiL2hwLXBwcy1zZXJ2aWNlcy9ib3QvcmVmcmVzaGNoYXRib3R0b2tlbj90b2tlbj0iK2xvY2FsU3RvcmFnZS50b3JvbnRvQ2hhdEJvdFRva2VuLAoJICAgIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24vanNvbiIsCgkgICAgZGF0YVR5cGU6ICdqc29uJwoJfSkuZG9uZShmdW5jdGlvbihkYXRhKXsKCQkvL29uIHN1Y2Nlc3MKCQlpZihkYXRhLnRva2VuICE9IG51bGwgJiYgbG9jYWxTdG9yYWdlLnRvcm9udG9DaGF0Qm90VG9rZW4gIT0gZGF0YS50b2tlbil7CgkJCWxvY2FsU3RvcmFnZS50b3JvbnRvQ2hhdEJvdFRva2VuID0gZGF0YS50b2tlbjsKCQkJJCgiLnRvcm9udG9DaGF0Qm90SWZyYW1lIikuYWRkQ2xhc3MoImhpZGVDaGF0Ym90Iik7CgkJCSQoIiN0b3JvbnRvQ2hhdFByb21wdCIpLmFkZENsYXNzKCJoaWRlQ2hhdGJvdCIpOwoJCQkkKCIjdG9yb250b0NoYXRIb3ZlclRleHQiKS5hZGRDbGFzcygiaGlkZUNoYXRib3QiKTsKCQkJc2hvd0xvYWRpbmdTcGlubmVyKCk7CgkJCWxvYWRDaGF0Qm90SWZyYW1lKGRhdGEudG9rZW4pOwoJCX0KCgkJaWYoZGF0YS5jb252ZXJzYXRpb25JZCAhPSBudWxsICYmIGxvY2FsU3RvcmFnZS50b3JvbnRvQ29udmVyc2F0aW9uSWQgIT0gZGF0YS5jb252ZXJzYXRpb25JZCl7CgkJCWxvY2FsU3RvcmFnZS50b3JvbnRvQ29udmVyc2F0aW9uSWQgPSBkYXRhLmNvbnZlcnNhdGlvbklkOwoJCQlnbG9iYWxEYXRhTGF5ZXIuY29udmVyc2F0aW9uSWQgPSBkYXRhLmNvbnZlcnNhdGlvbklkOwoJCX0KCgkJaWYoZGF0YS5leHBpcmVzX2luICE9IG51bGwpewoJCQlzZXRUb2tlbkJ1ZmZlcihwYXJzZUludChkYXRhLmV4cGlyZXNfaW4pKTsKCQkJc3RhcnRQb2xsaW5nVG9rZW5FeHBpcnkoKTsKCQl9CgoJfSkuZmFpbChmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cyl7CgkJY29uc29sZS5sb2coIiEhISEhISEhUmVmcmVzaCBUb2tlbiBzZXJ2aWNlIGZhaWxlZCEhISEhISEhISEhIik7CgkJaGlkZUxvYWRpbmdTcGlubmVyKCk7CgkJc2hvd0NoYXRib3RVbmF2YWlsYWJsZSgpOwoJfSk7Cn0KCmZ1bmN0aW9uIHNldFRva2VuQnVmZmVyKGFjdHVhbFRva2VuRXhwaXJ5KXsKCXZhciB0b2RheSA9IG5ldyBEYXRlKCk7Cgl2YXIgc2Vjc0Zyb21CZWdpbmluZyA9IHRvZGF5LmdldFRpbWUoKTsKCXZhciB0b2tlbkV4cGlyeVdpdGhCdWZmZXIgPSBhY3R1YWxUb2tlbkV4cGlyeSAtIDEyMDsgLy9pbiBzZWNvbmRzLCBhbHNvIGtlZXBpbmcgYSBidWZmZXIgb2YgMTIwIHNlYy4KCXZhciBleHBpcmF0aW9uVGltZSA9IHNlY3NGcm9tQmVnaW5pbmcgKyAodG9rZW5FeHBpcnlXaXRoQnVmZmVyKjEwMDApOyAgLy9taWxsaXNlY29uZHMKCWxvY2FsU3RvcmFnZS5leHBpcmF0aW9uVGltZVdpdGhCdWZmZXIgPSBleHBpcmF0aW9uVGltZTsKfQoKZnVuY3Rpb24gc3RhcnRQb2xsaW5nVG9rZW5FeHBpcnkoKXsKCXZhciBwb2xsaW5nSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpewoJCWlmKGNoZWNrRm9yVG9rZW5FeHBpcnkobG9jYWxTdG9yYWdlLmV4cGlyYXRpb25UaW1lV2l0aEJ1ZmZlcikpewoJCQljbGVhckludGVydmFsKHBvbGxpbmdJbnRlcnZhbCk7CgkJCWxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJleHBpcmF0aW9uVGltZVdpdGhCdWZmZXIiKTsKCQkJcmVmcmVzaFRva2VuKCk7CgkJfQoJfSwzMDAwKTsKfQoKZnVuY3Rpb24gY2hlY2tGb3JUb2tlbkV4cGlyeShleHBpcmF0aW9uVGltZSl7Cgl2YXIgdG9kYXkgPSBuZXcgRGF0ZSgpOwoJdmFyIHNlY3NGcm9tQmVnaW5pbmcgPSB0b2RheS5nZXRUaW1lKCk7CglpZihzZWNzRnJvbUJlZ2luaW5nID49IGV4cGlyYXRpb25UaW1lKXsKCQkvL3Rva2VuIGV4cGlyZWQKCQlyZXR1cm4gdHJ1ZTsKCX0KCWVsc2V7CgkJcmV0dXJuIGZhbHNlOwoJfQp9CgoKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCByZWNlaXZlTWVzc2FnZSwgZmFsc2UpOwoKZnVuY3Rpb24gcmVjZWl2ZU1lc3NhZ2UoZXZlbnQpewoJaWYoY2hhdEJvdFVybC5pbmRleE9mKGV2ZW50Lm9yaWdpbik+LTEpewoJCWlmKGV2ZW50LmRhdGEgPT0gImJvdFJlcGxpZWQiKXsKCQkJYm90UmVwbGllZCgpOwoJCQkvLyBSMTgyLTcwOiByZXNldCB0aW1lcgoJCQloYW5kbGVUb3JvbnRvVGltZXIoInJlc2V0Iik7CgkJfQoJCWVsc2UgaWYoZXZlbnQuZGF0YSA9PSAiYm90U3RhcnRPdmVyIil7CgkJCWJvdFN0YXJ0T3ZlcigpOwoJCQkvLyBSMTgyLTcwOiByZXNldCB0aW1lcgoJCQloYW5kbGVUb3JvbnRvVGltZXIoInJlc2V0Iik7CgkJfQoJCWNvbnNvbGUubG9nKCIrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKyIpOwoJICAJY29uc29sZS5sb2coZXZlbnQpOwoJCWNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGV2ZW50KSk7CgkJY29uc29sZS5sb2coIisrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrIik7Cgl9Cn0KCgovL0JPVCBDQUxMQkFDS1MsIERPIE5PVCBDSEFOR0UgRlVOQ1RJT04gTkFNRSEKZnVuY3Rpb24gYm90UmVwbGllZCgpewoJY29uc29sZS5sb2coIjw9PT09PT09PT09PT09PT09PT09PT09PT09PUJPVCBSRVBMSUVEPT09PT09PT09PT09PT09PT09PT09PT09PT0+Iik7CglpZihsb2NhbFN0b3JhZ2UudG9yb250b0NoYXRMYXVuY2hlZCA9PSAidHJ1ZSIgJiYgY2hhdE1pbmltaXplZCAmJiAhY2hhdE9wZW5lZEZpcnN0VGltZU9uUGFnZSl7CgkJY2hhdE1lc3NhZ2VDb3VudGVyT25NaW5pbWl6ZSArPSAxOwoJCXNob3dBbmRVcGRhdGVCYWRnZShjaGF0TWVzc2FnZUNvdW50ZXJPbk1pbmltaXplKTsKCX0KfQoKZnVuY3Rpb24gYm90U3RhcnRPdmVyKCl7Cgljb25zb2xlLmxvZygiPD09PT09PT09PT09PT09PT09PT09PT09PT09U1RBUlQgT1ZFUiBZRVM9PT09PT09PT09PT09PT09PT09PT09PT09PT4iKTsKCWNvbnNvbGUubG9nKCJTVEFSVCBPVkVSIEJPVCBIQVBQRU5JTkciKTsKCXZhciBzdGFydE92ZXJQYXlsb2FkID0gJC5leHRlbmQodHJ1ZSwge30sIHBheWxvYWRTa2VsZXRvbik7CgkvL0FqYXggY2FsbCB0byB1cGRhdGUgYm90IHdpdGggR0RMLCBjb252ZXJzYXRpb24gSUQgYW5kIGNvbnZlcnNhdGlvblN0YXJ0IGdvZXMgaGVyZQoJc3RhcnRPdmVyUGF5bG9hZC52YWx1ZS5jb252ZXJzYXRpb25TdGFydCA9IHRydWU7CglzdGFydE92ZXJQYXlsb2FkLnZhbHVlLnByb2R1Y3QgPSBnZXRQcm9kdWN0T2JqRm9yQm90KCk7CglzdGFydE92ZXJQYXlsb2FkLnZhbHVlLkdETCA9IGdsb2JhbERhdGFMYXllcjsKCS8vQUpBWCBDQUxMIFRPIFNUQVJUIE9WRVIgCgoJJC5hamF4KHsKCQl0eXBlOiAnUE9TVCcsCgkgICAgdXJsOiAiL2hwLXBwcy1zZXJ2aWNlcy9ib3Qvc2VuZGJvdGFjdGl2aXR5P3Rva2VuPSIrbG9jYWxTdG9yYWdlLnRvcm9udG9DaGF0Qm90VG9rZW4rIiZpZD0iK2xvY2FsU3RvcmFnZS50b3JvbnRvQ29udmVyc2F0aW9uSWQsCgkgICAgY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiwKCSAgICBkYXRhVHlwZTogJ2pzb24nLAoJICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHN0YXJ0T3ZlclBheWxvYWQpCgl9KS5kb25lKGZ1bmN0aW9uKGRhdGEpewoJCS8vIG9uIHN1Y2Nlc3MKCQkKCX0pLmZhaWwoZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMpewoJCWNvbnNvbGUubG9nKCIhISEhISEhIVN0YXJ0IG92ZXIgc2VydmljZSBmYWlsZWQhISEhISEhISEhISIpOwoJCSQoIi50b3JvbnRvQ2hhdEJvdElmcmFtZSIpLmFkZENsYXNzKCJoaWRlQ2hhdGJvdCIpOwoJCSQoIiN0b3JvbnRvQ2hhdFByb21wdCIpLmFkZENsYXNzKCJoaWRlQ2hhdGJvdCIpOwoJCSQoIiN0b3JvbnRvQ2hhdEhvdmVyVGV4dCIpLmFkZENsYXNzKCJoaWRlQ2hhdGJvdCIpOwoJCXNob3dDaGF0Ym90VW5hdmFpbGFibGUoKTsKCX0pOwp9CgovLyBSMTgyLTcwICBoYW5kbGUgc2V0dGluZywgcmVzZXR0aW5nIGFuZCBjbG9zaW5nIG9mIHRpbWVyCmZ1bmN0aW9uIGhhbmRsZVRvcm9udG9UaW1lcihzdGF0ZSkgewoJLy9zZXQgdGhlIGNoZWNrVGltZSBmbGFnIGFuZCBzdGFydCB0aGUgdGltZXIKCWlmKHN0YXRlID09ICJzdGFydCIpIHsKCQl0b3JvbnRvLnRpbWVPdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgCgkJCSQoIi50b3JvbnRvQ2xvc2VJY29uIikuY2xpY2soKTsgCgkJfSwgCgkJdG9yb250by5tYXhJZGxlVGltZSoxMDAwKTsJCgl9CgkvL2Nsb3NlIHRoZSB0aW1lcgoJZWxzZSBpZihzdGF0ZSA9PSAiY2xvc2UiKSB7CgkJY2xlYXJUaW1lb3V0KHRvcm9udG8udGltZU91dElkKTsKCX0KCS8vcmVzZXQgdGhlIHRpbWVyCgllbHNlIGlmKHN0YXRlID09ICJyZXNldCIpIHsKCQkkLndoZW4oaGFuZGxlVG9yb250b1RpbWVyKCJjbG9zZSIpKS50aGVuKGhhbmRsZVRvcm9udG9UaW1lcigic3RhcnQiKSk7Cgl9Cn0KCi8vIFIxODItNjkgIGhhbmRsZSBzYXZpbmcsIHJldHJpZXZpbmcgcHJvZHVjdCBjb250ZXh0IGFuZCBkZXRlY3RpbmcgY2hhbmdlCmZ1bmN0aW9uIGhhbmRsZVByb2R1Y3RDb250ZXh0KHN0YXRlKSB7CglpZihzdGF0ZSA9PSAic2F2ZSIpIHsKCQl2YXIgcHJvZHVjdCA9IGZldGNoUHJvZHVjdEluZm9ybWF0aW9uKCk7CgkJbG9jYWxTdG9yYWdlLnRvcm9udG9TTiA9IHByb2R1Y3QuU047CgkJbG9jYWxTdG9yYWdlLnRvcm9udG9QTiA9IHByb2R1Y3QuUE47CgkJCgl9IGVsc2UgaWYoc3RhdGUgPT0gImNvbXBhcmUiKSB7CgkJdmFyIHByb2R1Y3QgPSBmZXRjaFByb2R1Y3RJbmZvcm1hdGlvbigpOwoJCS8vcHJvZHVjdCBjb250ZXh0IGNoYW5nZSBpZiBsb2NhbHN0b3JhZ2UgU04gYW5kIFBOIGRvIG5vdCBtYXRjaCB3aXRoIGN1cnJlbnQgU04gYW5kIFBOCgkJaWYobG9jYWxTdG9yYWdlLnRvcm9udG9TTiAhPSBwcm9kdWN0LlNOIHx8IGxvY2FsU3RvcmFnZS50b3JvbnRvUE4gIT0gcHJvZHVjdC5QTikgewoJCQlsb2NhbFN0b3JhZ2UudG9yb250b1Byb2R1Y3RDb250ZXh0ID0gdHJ1ZTsKCQkJbG9jYWxTdG9yYWdlLnRvcm9udG9Db252ZXJzYXRpb25JZCA9ICIiOwoJCQlnbG9iYWxEYXRhTGF5ZXIuY29udmVyc2F0aW9uSWQgPSAiIjsKCQl9Cgl9CQp9CgpmdW5jdGlvbiBmZXRjaFByb2R1Y3RJbmZvcm1hdGlvbigpIHsKCXZhciBjdXJyZW50VXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7Cgl2YXIgdXJsQXJyYXkgPSBjdXJyZW50VXJsLnNwbGl0KCIvIik7Cgl2YXIgcHJvZHVjdCA9IHt9OwoJaWYoY3VycmVudFVybC5pbmRleE9mKCJtb2RlbCIpPi0xKSB7CgkJLy8gcGFnZSBjb250ZXh0dWFsIGF0IHByb2R1Y3QgbGV2ZWwKCQlwcm9kdWN0LlNOID0gdXJsQXJyYXlbdXJsQXJyYXkubGVuZ3RoLTNdOwoJCXByb2R1Y3QuUE4gPSB1cmxBcnJheVt1cmxBcnJheS5sZW5ndGgtMV07Cgl9IGVsc2UgewoJCS8vbGFzdFVybEluZm8gd2lsbCBiZSBhIG51bWJlciBpbiBjYXNlIG9mIHBhZ2UgY29udGV4dHVhbCBhdCBzZXJpZXMgbGV2ZWwKCQl2YXIgbGFzdFVybEluZm8gPSB1cmxBcnJheVt1cmxBcnJheS5sZW5ndGgtMV07CgkJaWYoaXNOYU4obGFzdFVybEluZm8pKSB7CgkJCXByb2R1Y3QuU04gPSAwOwoJCQlwcm9kdWN0LlBOID0gMDsKCQl9IGVsc2UgewoJCQlwcm9kdWN0LlNOID0gbGFzdFVybEluZm87CgkJCXByb2R1Y3QuUE4gPSAwOwoJCX0KCX0KCXJldHVybiBwcm9kdWN0Owp9CgovLyBSMTgyLTUzICBoYW5kbGUgc2V0dGluZywgcmVzZXR0aW5nIGFuZCBjbG9zaW5nIG9mIGVuYWJsaW5nIHByb2FjdGl2ZSBwcm9tcHQgdGltZXIKZnVuY3Rpb24gaGFuZGxlUHJvYWN0aXZlUHJvbXB0KHN0YXRlKSB7CgkvL3N0YXJ0IHRoZSB0aW1lcgoJaWYoc3RhdGUgPT0gInN0YXJ0IikgewkKCQl0b3JvbnRvLnByb21wdEVuYWJsZWRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgCgkJCS8vIHVuYmluZCBob3ZlciB0ZXh0CgkJCWhhbmRsZUhvdmVyVGV4dCgidW5iaW5kIik7CgkJCS8vIHNob3cgcHJvYXZ0aXZlIHByb21wdAoJCQkkKCIjdG9yb250b0NoYXRQcm9tcHQiKS5yZW1vdmVDbGFzcygiaGlkZGVuIik7IAoJCQkkKCIjdG9yb250b0NoYXRQcm9tcHQiKS5hdHRyKCJhcmlhLWhpZGRlbiIsZmFsc2UpOwoJCQkvLyBzdGFydCB0aGUgZGlzbWlzc2luZyB0aW1lcgoJCQloYW5kbGVEaXNhYmxlUHJvYWN0aXZlUHJvbXB0KCJzdGFydCIpOwoJCQkvL2Nsb3NlIHRoZSBzaG93aW5nIHByb2FjdGl2ZSB0aW1lciB0aW1lCgkJCWhhbmRsZVByb2FjdGl2ZVByb21wdCgiY2xvc2UiKTsKCQl9LCAKCQl0b3JvbnRvLmNoYXRCb3RQcm9hY3RpdmVXYWl0KjEwMDApOwkKCX0KCS8vY2xvc2UgdGhlIHRpbWVyCgllbHNlIGlmKHN0YXRlID09ICJjbG9zZSIpIHsKCQlpZih0b3JvbnRvLnByb21wdEVuYWJsZWRJZCE9bnVsbCkgewoJCQljbGVhclRpbWVvdXQodG9yb250by5wcm9tcHRFbmFibGVkSWQpOwoJCX0KCX0KCS8vcmVzZXQgdGhlIHRpbWVyCgllbHNlIGlmKHN0YXRlID09ICJyZXNldCIpIHsKCQloYW5kbGVQcm9hY3RpdmVQcm9tcHQoInN0YXJ0Iik7CgkJaGFuZGxlUHJvYWN0aXZlUHJvbXB0KCJjbG9zZSIpOwoJfQp9CgovLyBSMTgyLTUzICBoYW5kbGUgc2V0dGluZywgcmVzZXR0aW5nIGFuZCBjbG9zaW5nIG9mIGRpc2FibGluZyBwcm9hY3RpdmUgcHJvbXB0IHRpbWVyCmZ1bmN0aW9uIGhhbmRsZURpc2FibGVQcm9hY3RpdmVQcm9tcHQoc3RhdGUpIHsKCS8vc3RhcnQgdGhlIHRpbWVyCglpZihzdGF0ZSA9PSAic3RhcnQiKSB7CQoJCXRvcm9udG8ucHJvbXB0RGlzYWJsZWRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgCgkJCWhhbmRsZUhvdmVyVGV4dCgiYmluZCIpOwoJCQkkKCIjdG9yb250b0NoYXRQcm9tcHQiKS5hZGRDbGFzcygiaGlkZGVuIik7IAoJCQkkKCIjdG9yb250b0NoYXRQcm9tcHQiKS5hdHRyKCJhcmlhLWhpZGRlbiIsdHJ1ZSk7CgkJCS8vIGNsb3NlIHRoZSBkaXNtaXNzaW5nIHRpbWVyCgkJCWhhbmRsZURpc2FibGVQcm9hY3RpdmVQcm9tcHQoImNsb3NlIik7CgkJCS8vc3RhcnQgdGhlIHNob3dpbmcgcHJvYWN0aXZlIHRpbWVyIHRpbWUKCQkJaGFuZGxlUHJvYWN0aXZlUHJvbXB0KCJzdGFydCIpOwoJCX0sIAoJCXRvcm9udG8uY2hhdEJvdFByb2FjdGl2ZVRpbWVvdXQqMTAwMCk7CQoJfQoJLy9jbG9zZSB0aGUgdGltZXIKCWVsc2UgaWYoc3RhdGUgPT0gImNsb3NlIikgewoJCWlmKHRvcm9udG8ucHJvbXB0RGlzYWJsZWRJZCE9bnVsbCkgewoJCQljbGVhclRpbWVvdXQodG9yb250by5wcm9tcHREaXNhYmxlZElkKTsKCQl9Cgl9CgkvL3Jlc2V0IHRoZSB0aW1lcgoJZWxzZSBpZihzdGF0ZSA9PSAicmVzZXQiKSB7CgkJaGFuZGxlRGlzYWJsZVByb2FjdGl2ZVByb21wdCgic3RhcnQiKTsKCQloYW5kbGVEaXNhYmxlUHJvYWN0aXZlUHJvbXB0KCJjbG9zZSIpOwoJfQp9CgpmdW5jdGlvbiBkaXNtaXNzQ2hhdFByb21wdChldmVudCkgewoJLy8gaGlkZSB0aGUgcHJvbXB0CgkkKCIjdG9yb250b0NoYXRQcm9tcHQiKS5hZGRDbGFzcygiaGlkZGVuIik7CgkvLyBkaXNhYmxlIHRpbWVycwoJaGFuZGxlUHJvYWN0aXZlUHJvbXB0KCJjbG9zZSIpOwoJaGFuZGxlRGlzYWJsZVByb2FjdGl2ZVByb21wdCgiY2xvc2UiKTsKCS8vc2V0IGRpc21pc3NQcm9tcHRGbGFnLCBzbyB0aGF0IHVzZXIgaXMgbm90IHByb21wdCBpbiB0aGUgc2FtZSBzZXNzaW9uCglsb2NhbFN0b3JhZ2UuZGlzbWlzc1Byb21wdEZsYWcgPSB0cnVlOwoJaGFuZGxlSG92ZXJUZXh0KCJiaW5kIik7CglpZihldmVudCkgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7Cn0KCmZ1bmN0aW9uIGZldGNoV0NNQ2hhdEJvdE1vYmlsZUltYWdlKCkgewoJJC5hamF4KHsKCQl0eXBlOiAiR0VUIiwKICAgICAgICB1cmw6ICIvaHAtcHBzLXNlcnZpY2VzL3dlYmNvbnRlbnQvaW1hZ2UvdXJsIiwKICAgICAgICBkYXRhOnsKICAgICAgICAgICAgInNpdGVhcmVhIjogImFsbC1wYWdlcy9jaGF0LWJvdCIsCiAgICAgICAgICAgICJjb21wb25lbnQiOiAiaW1hZ2UtY29tcG9uZW50IgogICAgICAgIH0sCiAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICBiZWZvcmVTZW5kOiBmdW5jdGlvbih4aHIpIHsKICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7CiAgICAgICAgfQoJfSkuZG9uZShmdW5jdGlvbihkYXRhKXsKCQkkKCIjYm90TW9iaWxlSW1hZ2UiKS5hdHRyKCJzcmMiLGRhdGEpOwoJfSkuZmFpbChmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cyl7CgkJY29uc29sZS5sb2coImZhaWwgLSBmZXRjaCBtb2JpbGUgY2hhdGJvdCBpbWcgZnJvbSBXQ00iKTsKCQkkKCIjYm90TW9iaWxlSW1hZ2UiKS5hdHRyKCJzcmMiLCQoIiNib3RJbWFnZSIpLmF0dHIoInNyYyIpKTsKCX0pOwp9CgpmdW5jdGlvbiBpc01vYmlsZURldmljZSgpewogICAgdmFyIG1vYmlsZURldmljZXMgPSBbIkFuZHJvaWQiLCAiaVBhZCIsICJpUGhvbmUiXTsKICAgIHZhciBjdXJyZW50RGV2aWNlID0gaXNNb2JpbGUuYW55KCk7CiAgICBjdXJyZW50RGV2aWNlID0gY3VycmVudERldmljZSA9PSBudWxsID8gIiIgOiBjdXJyZW50RGV2aWNlWzBdOwogICAgcmV0dXJuICQuaW5BcnJheShjdXJyZW50RGV2aWNlLCBtb2JpbGVEZXZpY2VzKSAhPSAtMTsKfQoKZnVuY3Rpb24gaGFuZGxlSG92ZXJUZXh0KHN0YXRlKSB7CglpZihzdGF0ZSA9PSAiYmluZCIpIHsKCQkkKCIjY2hhdGJvdFRvcm9udG8iKS5vbigibW91c2VlbnRlciIsZnVuY3Rpb24oKSB7CgkJCSQoIiN0b3JvbnRvQ2hhdEhvdmVyVGV4dCIpLnJlbW92ZUNsYXNzKCJoaWRkZW4iKTsKCQkJZGlzbWlzc0NoYXRQcm9tcHQoKTsKCQl9KTsKCQkkKCIjY2hhdGJvdFRvcm9udG8iKS5vbigibW91c2VsZWF2ZSIsZnVuY3Rpb24oKSB7CgkJCSQoIiN0b3JvbnRvQ2hhdEhvdmVyVGV4dCIpLmFkZENsYXNzKCJoaWRkZW4iKTsKCQl9KTsKCQkKCX0gZWxzZSBpZihzdGF0ZSA9PSAidW5iaW5kIikgewoJCSQoIiNjaGF0Ym90VG9yb250byIpLm9mZigibW91c2VlbnRlciBtb3VzZWxlYXZlIik7Cgl9IAp9ICAKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7dmFyIHZpZHMgPSBbXTsJCS8vYXJyYXkgdG8gc3RvcmUgdGhlIHBsYXllciBvYmplY3RzIGFsbSMgMjYzNQp2YXIganNvblZpZGVvRGF0YTsKdmFyIGRvY1ZpZGVvRGF0YSA9IFtdOwp2YXIgd2lkZ2V0QVBJVXJsID0gJCgiI3dpZGdldEFwaVVybCIpLnZhbCgpOwkJLy9nZXQgdGhlIHZhbHVlcyBmcm9tIFNTQwp2YXIgaWZyYW1lQXBpVXJsID0gJCgiI2lmcmFtZUFwaVVybCIpLnZhbCgpOwp2YXIgYnJpZ2h0Q292ZUNvdW50cnlDb2RlcyA9ICQoIiNicmlnaHRDb3ZlVmlkZW9Mb2NhbGVzIikudmFsKCk7ICAvL2Zyb20gU1NDIEFMTSMgMjYzNQp2YXIgY291bnRlciA9IDA7CnZhciBpdGVtID0ge307CnZhciBkb2NWaWRlb0NvdW50ID0gMDsKdmFyIGpzb25WaWRlb0RhdGFDb3VudGVyID0gMDsKdmFyIHlvdXR1YmVTY3JpcHRDYWxsZWQgPSBmYWxzZTsKCiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgeyAKCWlmKHdpZGdldEFQSVVybCA9PSB1bmRlZmluZWQgfHwgd2lkZ2V0QVBJVXJsID09IG51bGwgfHwgd2lkZ2V0QVBJVXJsID09ICIiKXsJCQkJLy9udWxsIGNoZWNrcyBmb3IgU1NDIGtleXMgQUxNIyAyNjM1CgkJd2lkZ2V0QVBJVXJsID0gImh0dHBzOi8vcy55dGltZy5jb20veXRzL2pzYmluL3d3dy13aWRnZXRhcGktdmZsNnRnR1NWL3d3dy13aWRnZXRhcGkuanMiOwoJfQoJaWYoaWZyYW1lQXBpVXJsID09IHVuZGVmaW5lZCB8fCBpZnJhbWVBcGlVcmwgPT0gbnVsbCB8fCBpZnJhbWVBcGlVcmwgPT0gIiIpewoJCWlmcmFtZUFwaVVybCA9ICJodHRwczovL3d3dy55b3V0dWJlLmNvbS9pZnJhbWVfYXBpIjsKCX0KCWlmKGJyaWdodENvdmVDb3VudHJ5Q29kZXMgIT0gdW5kZWZpbmVkICYmIGJyaWdodENvdmVDb3VudHJ5Q29kZXMgIT0gbnVsbCAmJiBicmlnaHRDb3ZlQ291bnRyeUNvZGVzICE9ICIiICYmICFBcnJheS5pc0FycmF5KGJyaWdodENvdmVDb3VudHJ5Q29kZXMpKXsJCS8vYWRkaW5nIGlzQXJyYXkgY2hlY2sgdG8gdmFsaWRhdGUgaWYgYWxyZWFkeSBzcGxpdC4KCQlicmlnaHRDb3ZlQ291bnRyeUNvZGVzID0gYnJpZ2h0Q292ZUNvdW50cnlDb2Rlcy5zcGxpdCgiLCIpOwkJLy9jcmVhdGluZyBhbiBhcnJheQoJfQoKCS8vQUxNLTMxNDYgLSBpbnNlcnRpbmcgdGhlIHlvdXR1YmUgZnJhbWUgb25seSB3aGVuIHRoZSBsb2NhbGUgaXMgbm90IGNuCgoJaWYgKCQuaW5BcnJheShnZXRDQ0xDKCJjYyIpLGJyaWdodENvdmVDb3VudHJ5Q29kZXMpID09IC0xKSB7CgkJJCgiYVtpZCo9dmlkZW9dLCBhLnZpZGVvVGh1bWJuYWlsLCBbZGF0YS1wbGF5bGlzdC1pZF0gYSIpLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbigpIHsKCQkJdmFyIGZpcnN0U2NyaXB0VGFnID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOwoJCQlpZiAoIXlvdXR1YmVTY3JpcHRDYWxsZWQgJiYgZmlyc3RTY3JpcHRUYWcgJiYgZmlyc3RTY3JpcHRUYWcuZ2V0QXR0cmlidXRlKCdzcmMnKSAhPSBpZnJhbWVBcGlVcmwpIHsKCQkJCXlvdXR1YmVTY3JpcHRDYWxsZWQgPSB0cnVlOwoJCQkJdmFyIHRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwkJLy9pbnNlcnQgdGhlIHlvdXR1YmUgaWZyYW1lIHNjcmlwdCBBTE0jIDI2MzUKCQkJCXRhZy5zcmMgPSBpZnJhbWVBcGlVcmw7CgkJCQlmaXJzdFNjcmlwdFRhZy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0YWcsIGZpcnN0U2NyaXB0VGFnKTsKCQkJfQoJCX0pOwoJfQoKCSQoZG9jdW1lbnQpLm9uKCdoaWRkZW4uYnMubW9kYWwnLCAnLm1vZGFsLnBsYXlsaXN0VmlkZW9Nb2RhbCcsIGZ1bmN0aW9uKCkgewoJCSQodGhpcykuZmluZCgiLnZqcy1wbGF5aW5nIikudHJpZ2dlcigiY2xpY2siKTsKCQlpZihvcGVuVmlkZW9Nb2RhbElkICE9ICIiKXsKCQkJJCgiYVtkYXRhLXRhcmdldD0nIyIrb3BlblZpZGVvTW9kYWxJZCsiJ10iKS5mb2N1cygpOwoJCQlvcGVuVmlkZW9Nb2RhbElkID0gIiI7CgkJfQoJCWlmKCQodGhpcykucGFyZW50KCkuZmluZCgiaWZyYW1lIikubGVuZ3RoICE9IDApewkJLy9wYXVzZSB5b3V0dWJlIHZpZGVvIEFMTSMgMjYzNQoJCQl2YXIgaWZyYW1lSUQgPSAkKHRoaXMpLmZpbmQoImlmcmFtZSIpLmF0dHIoImlkIik7CgkJCWZvcih2YXIgaz0wO2s8dmlkcy5sZW5ndGg7aysrKXsKCQkJCWlmKHZpZHNba10uZiAhPSB1bmRlZmluZWQgJiYgdmlkc1trXS5mICE9IG51bGwpewoJCQkJCWlmIChpZnJhbWVJRCA9PSB2aWRzW2tdLmYuaWQpICB7ICAKCQkJCQkJdmlkc1trXS5wYXVzZVZpZGVvKCk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0pOwoKCSQoIi5wYWdlTGV2ZWxQbGF5bGlzdCIpLmVhY2goZnVuY3Rpb24oaW5kZXgsIHZhbHVlKXsKCQlmZXRjaFBsYXlsaXN0KCQodGhpcykuZGF0YSgicGxheWxpc3QtaWQiKSwgNCk7Cgl9KTsKCgoJaWYod2luZG93LmxvY2F0aW9uLmhyZWYuc2VhcmNoKCcvZG9jdW1lbnQnKSA+IC0xICAmJiB3aW5kb3cubG9jYXRpb24uaHJlZi5zZWFyY2goJ2lzaCcpID4gLTEpewoJCXZhciByZXF1ZXN0VXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CgkJdmFyIHggPSByZXF1ZXN0VXJsLnNwbGl0KCcvJyk7CgkJdmFyIG1vZEhvc3RVcmw9eFswXSsnLy8nK3hbMl0rJy8nK3hbM10rJy8nK3hbNF0rJy8nOwoJCWNvbnNvbGUubG9nKG1vZEhvc3RVcmwpOwoJCQoJCSQoJ2FbaHJlZio9ImlzaF8iXScpLmVhY2goZnVuY3Rpb24oaW5kZXgsdmFsKSB7CQoJCQl2YXIgaXNoTGluaz12YWwuaHJlZjsKCQkJdmFyIHN0ciA9IGlzaExpbmsuc3BsaXQoIi8iKTsKCQkJaWYoc3RyLmxlbmd0aCA+PSA3KXsKCQkJCXZhciBtb2RyZXMgPSBzdHJbN10uc3BsaXQoIj8iKTsKCQkJCXZhbC5ocmVmPW1vZEhvc3RVcmwrbW9kcmVzWzBdOwoJCQl9CgkJfSk7Cgl9Cn0pOwp2YXIgb3BlblZpZGVvTW9kYWxJZCA9ICIiOwp2YXIgZXZlbnRIYW5kbGVyc0F0dGFjaGVkID0gZmFsc2U7CiQoImh0bWwiKS5vbigiY2xpY2siLCAiLnZpZGVvQ29udGVudCIsIGZ1bmN0aW9uKCl7Cgl2YXIgdGFyZ2V0SWQgPSAkKHRoaXMpLmNoaWxkcmVuKCJhIikuZGF0YSgidGFyZ2V0Iik7CglvcGVuVmlkZW9Nb2RhbElkID0gdGFyZ2V0SWQuc3Vic3RyaW5nKDEsIHRhcmdldElkLmxlbmd0aCk7Cn0pOwoKdmFyIHBsYXlsaXN0TWFzdGVyT2JqZWN0ID0ge307CnZhciBhY2NvdW50SWQgPSBwYXJzZUludCgkKCIjYnJpZ2h0Q292ZUFjY291bnRJZCIpLnZhbCgpKTsgLy9TU0MgY29udHJvbGxlZAp2YXIgcGxheWVySWQgPSAkKCIjYnJpZ2h0Q292ZVBsYXllcklkIikudmFsKCk7ICAvL1NTQyBjb250cm9sbGVkCgokKGRvY3VtZW50KS50cmlnZ2VyKCJwYWdlTG9hZGVkIik7ICAvL0N1c3RvbSBFdmVudCB0cmlnZ2VyIHRoYXQgaXMgYmVpbmcgbGlzdGVuZWQgdG8sIGluIG1pY3Jvc2l0ZS5qcyBhcyBwYXJ0IG9mIEFMTSAxODczCgoKLy9mdW5jdGlvbiB0byBmZXRjaCB2aWRlbyBwbGF5bGlzdCBBTE0jIDI2MzUKZnVuY3Rpb24gZmV0Y2hQbGF5bGlzdChwbGF5bGlzdElkLCBudW1iZXJPZlZpZGVvc1BlclBhZ2UpewoJcGxheWxpc3RJZCA9IHBhcnNlSW50KHBsYXlsaXN0SWQpOwoJcGxheWxpc3RNYXN0ZXJPYmplY3RbcGxheWxpc3RJZF0gPSB7fTsKCXZhciBjYyA9IGdldENDTEMoImNjIik7Cgl2YXIgbGMgPSBnZXRDQ0xDKCJsYyIpOwoJLy8gdmFyIG51bWJlck9mVmlkZW9zUGVyUGFnZSA9ICQoImRpdltkYXRhLXBsYXlsaXN0LWlkPSciK3BsYXlsaXN0SWQrIiddIikuZGF0YSgicGVyUGFnZSIpOwoJLy9BamF4IGNhbGwgZ29lcyBoZXJlCgoJJC5hamF4KHsKCQl0eXBlOiAnR0VUJywKCQl1cmw6ICIvaHAtcHBzLXNlcnZpY2VzL3ZpZGVvcy9wbGF5bGlzdC8iK3BsYXlsaXN0SWQrIi9jYy8iK2NjKyIvbGMvIitsYywKCQljb250ZW50VHlwZTogImFwcGxpY2F0aW9uL2pzb24iLAoJCWRhdGFUeXBlOiAnanNvbicKCX0pLmRvbmUoZnVuY3Rpb24oZGF0YSl7CgkJaWYoZGF0YSAhPSB1bmRlZmluZWQgJiYgZGF0YSAhPSBudWxsICYmIGRhdGEgIT0gIiIpewoJCQkvLyBvbiBzdWNjZXNzCgkJCXBsYXlsaXN0TWFzdGVyT2JqZWN0W3BsYXlsaXN0SWRdLnBlclBhZ2UgPSBudW1iZXJPZlZpZGVvc1BlclBhZ2U7CgkJCXBsYXlsaXN0TWFzdGVyT2JqZWN0W3BsYXlsaXN0SWRdLnBsYXlsaXN0SWQgPSBwbGF5bGlzdElkOwoJCQlwbGF5bGlzdE1hc3Rlck9iamVjdFtwbGF5bGlzdElkXS5jb3B5b2Zqc29uRGF0YSA9IGRhdGE7CgkJCXBsYXlsaXN0TWFuYWdlcihwbGF5bGlzdElkKTsKCQl9CgoJfSkuZmFpbChmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cyl7CgoJfSk7Cn0KCmZ1bmN0aW9uIHBsYXlsaXN0TWFuYWdlcihwbGF5bGlzdElkKXsKCXBsYXlsaXN0SWQgPSBwYXJzZUludChwbGF5bGlzdElkKTsKCgl2YXIganNvbkRhdGEgPSBwbGF5bGlzdE1hc3Rlck9iamVjdFtwbGF5bGlzdElkXS5jb3B5b2Zqc29uRGF0YTsKCXZhciBwZXJQYWdlID0gcGxheWxpc3RNYXN0ZXJPYmplY3RbcGxheWxpc3RJZF0ucGVyUGFnZTsKCglpZighZXZlbnRIYW5kbGVyc0F0dGFjaGVkKXsKCQlldmVudEhhbmRsZXJzQXR0YWNoZWQgPSB0cnVlOwoJCSQoJy5wcmV2Jykub24oJ3RhcCBjbGljaycsIGZ1bmN0aW9uKCl7CgkJCXZhciBwbGF5bGlzdENvbnRleHQgPSAkKHRoaXMpLnBhcmVudHMoIi52aWRlb1BsYXlsaXN0V3JhcHBlciIpLmNoaWxkcmVuKCIudmlkZW9QbGF5bGlzdCIpOwoJCQl2YXIgcGxheWxpc3RJZCA9IHBsYXlsaXN0Q29udGV4dC5kYXRhKCJwbGF5bGlzdC1pZCIpOwoJCQl2YXIgcGVyUGFnZSA9IHBhcnNlSW50KHBsYXlsaXN0TWFzdGVyT2JqZWN0W3BsYXlsaXN0SWRdLnBlclBhZ2UpOwoJCQl2YXIgY29weW9manNvbkRhdGEgPSBwbGF5bGlzdE1hc3Rlck9iamVjdFtwbGF5bGlzdElkXS5jb3B5b2Zqc29uRGF0YTsKCgkJCXZhciBjdXJQYWdlID0gcGFyc2VJbnQocGFyc2VJbnQoJCh0aGlzKS5wYXJlbnRzKCIuY29udGFpbmVyRm9yUGFnaW5hdGlvbkZvb3QiKS5maW5kKCIucGFnaW5hdGlvbkVuZFZhbCIpLnRleHQoKSkvcGVyUGFnZSk7CgkJCXZhciByZW1haW5kZXIgPSBwYXJzZUludCgkKHRoaXMpLnBhcmVudHMoIi5jb250YWluZXJGb3JQYWdpbmF0aW9uRm9vdCIpLmZpbmQoIi5wYWdpbmF0aW9uRW5kVmFsIikudGV4dCgpKSVwZXJQYWdlOwoJCQlpZihyZW1haW5kZXIgPiAwKXsKCQkJCWN1clBhZ2UgPSBjdXJQYWdlICsgMTsKCQkJfSAKCQkJY3VyUGFnZS0tOwoJCQlyZXNwb25zZShjb3B5b2Zqc29uRGF0YSwgImZhbHNlIiwgcGxheWxpc3RDb250ZXh0LCBjdXJQYWdlKTsKCQl9KTsKCgkJJCgnLnNob3dBbGwnKS5vbigndGFwIGNsaWNrJywgZnVuY3Rpb24oKXsKCQkJdmFyIHBsYXlsaXN0V3JhcHBlckNvbnRleHQgPSAkKHRoaXMpLnBhcmVudHMoIi52aWRlb1BsYXlsaXN0V3JhcHBlciIpOwoJCQlwbGF5bGlzdFdyYXBwZXJDb250ZXh0LmZpbmQoJy5zaG93QWxsJykuaGlkZSgpOwoJCQlwbGF5bGlzdFdyYXBwZXJDb250ZXh0LmZpbmQoJy5zaG93TGVzcycpLnNob3coKTsKCQkJcGxheWxpc3RXcmFwcGVyQ29udGV4dC5maW5kKCcucGFnaW5hdGlvbi1sZXNzJykuYXR0cignZGlzYWJsZWQnLCdkaXNhYmxlZCcpOwoJCQlwbGF5bGlzdFdyYXBwZXJDb250ZXh0LmZpbmQoJy5wYWdpbmF0aW9uLWxlc3MnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTsKCQkJcGxheWxpc3RXcmFwcGVyQ29udGV4dC5maW5kKCcucGFnaW5hdGlvbi1tb3JlJykuYXR0cignZGlzYWJsZWQnLCdkaXNhYmxlZCcpOwoJCQlwbGF5bGlzdFdyYXBwZXJDb250ZXh0LmZpbmQoJy5wYWdpbmF0aW9uLW1vcmUnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTsKCgkJCXZhciBwbGF5bGlzdENvbnRleHQgPSAkKHRoaXMpLnBhcmVudHMoIi52aWRlb1BsYXlsaXN0V3JhcHBlciIpLmNoaWxkcmVuKCIudmlkZW9QbGF5bGlzdCIpOwoJCQl2YXIgcGxheWxpc3RJZCA9IHBsYXlsaXN0Q29udGV4dC5kYXRhKCJwbGF5bGlzdC1pZCIpOwoJCQl2YXIgcGVyUGFnZSA9IHBhcnNlSW50KHBsYXlsaXN0TWFzdGVyT2JqZWN0W3BsYXlsaXN0SWRdLnBlclBhZ2UpOwoJCQl2YXIgY29weW9manNvbkRhdGEgPSBwbGF5bGlzdE1hc3Rlck9iamVjdFtwbGF5bGlzdElkXS5jb3B5b2Zqc29uRGF0YTsKCQkJdmFyIGN1clBhZ2UgPSBwYXJzZUludCgkKHRoaXMpLnBhcmVudHMoIi5wYWdpbmF0aW9uVGV4dCIpLmZpbmQoIi5wYWdpbmF0aW9uRW5kVmFsIikudGV4dCgpKS9wZXJQYWdlOyAKCgkJCXJlc3BvbnNlKGNvcHlvZmpzb25EYXRhLCAidHJ1ZSIsIHBsYXlsaXN0Q29udGV4dCwgY3VyUGFnZSk7ICAgICAgIAoJCX0pOwoKCQkkKCcuc2hvd0xlc3MnKS5vbigndGFwIGNsaWNrJywgZnVuY3Rpb24oKXsKCQkJdmFyIHBsYXlsaXN0V3JhcHBlckNvbnRleHQgPSAkKHRoaXMpLnBhcmVudHMoIi52aWRlb1BsYXlsaXN0V3JhcHBlciIpOwoJCQlwbGF5bGlzdFdyYXBwZXJDb250ZXh0LmZpbmQoJy5zaG93QWxsJykuc2hvdygpOwoJCQlwbGF5bGlzdFdyYXBwZXJDb250ZXh0LmZpbmQoJy5zaG93TGVzcycpLmhpZGUoKTsKCgkJCXZhciBwbGF5bGlzdENvbnRleHQgPSAkKHRoaXMpLnBhcmVudHMoIi52aWRlb1BsYXlsaXN0V3JhcHBlciIpLmNoaWxkcmVuKCIudmlkZW9QbGF5bGlzdCIpOwoJCQl2YXIgcGxheWxpc3RJZCA9IHBsYXlsaXN0Q29udGV4dC5kYXRhKCJwbGF5bGlzdC1pZCIpOwoJCQl2YXIgcGVyUGFnZSA9IHBhcnNlSW50KHBsYXlsaXN0TWFzdGVyT2JqZWN0W3BsYXlsaXN0SWRdLnBlclBhZ2UpOwoJCQl2YXIgY29weW9manNvbkRhdGEgPSBwbGF5bGlzdE1hc3Rlck9iamVjdFtwbGF5bGlzdElkXS5jb3B5b2Zqc29uRGF0YTsKCQkJdmFyIGN1clBhZ2UgPSBwYXJzZUludCgkKHRoaXMpLnBhcmVudHMoIi5wYWdpbmF0aW9uVGV4dCIpLmZpbmQoIi5wYWdpbmF0aW9uRW5kVmFsIikudGV4dCgpKS9wZXJQYWdlOyAKCgkJCXJlc3BvbnNlKGNvcHlvZmpzb25EYXRhLCAiZmFsc2UiLCBwbGF5bGlzdENvbnRleHQsIGN1clBhZ2UpOyAgICAgCgkJfSk7CgoJCSQoJy5uZXh0Jykub24oJ3RhcCBjbGljaycsIGZ1bmN0aW9uKCl7CgkJCXZhciBwbGF5bGlzdENvbnRleHQgPSAkKHRoaXMpLnBhcmVudHMoIi52aWRlb1BsYXlsaXN0V3JhcHBlciIpLmNoaWxkcmVuKCIudmlkZW9QbGF5bGlzdCIpOwoJCQl2YXIgcGxheWxpc3RJZCA9IHBsYXlsaXN0Q29udGV4dC5kYXRhKCJwbGF5bGlzdC1pZCIpOwoJCQl2YXIgcGVyUGFnZSA9IHBhcnNlSW50KHBsYXlsaXN0TWFzdGVyT2JqZWN0W3BsYXlsaXN0SWRdLnBlclBhZ2UpOwoJCQl2YXIgY29weW9manNvbkRhdGEgPSBwbGF5bGlzdE1hc3Rlck9iamVjdFtwbGF5bGlzdElkXS5jb3B5b2Zqc29uRGF0YTsKCQkJdmFyIGN1clBhZ2UgPSBwYXJzZUludCgkKHRoaXMpLnBhcmVudHMoIi5jb250YWluZXJGb3JQYWdpbmF0aW9uRm9vdCIpLmZpbmQoIi5wYWdpbmF0aW9uRW5kVmFsIikudGV4dCgpKS9wZXJQYWdlOyAKCQkJY3VyUGFnZSsrOwoJCQlyZXNwb25zZShjb3B5b2Zqc29uRGF0YSwgImZhbHNlIiwgcGxheWxpc3RDb250ZXh0LCBjdXJQYWdlKTsKCQl9KTsKCX0KCgoKCgl2YXIgcGVyUGFnZT0gcGxheWxpc3RNYXN0ZXJPYmplY3RbcGxheWxpc3RJZF0ucGVyUGFnZTsKCS8vIHZhciBjdXJQYWdlPSAxOwoJdmFyIGNvcHlvZmpzb25EYXRhOwoJdmFyIG1vZGFsR2xvYmFsID0gIiI7Cgl2YXIgeW91dHViZUZsYWcgPSBmYWxzZTsKCXZhciBjb3VudHJ5Q29kZSA9IGdldENDTEMoImNjIik7CglpZigkLmluQXJyYXkoY291bnRyeUNvZGUsYnJpZ2h0Q292ZUNvdW50cnlDb2RlcykgIT0gLTEpewoJCWZvcih2YXIgaSA9IDA7IGkgPCBqc29uRGF0YS5sZW5ndGg7IGkrKyl7CgkJCXZhciB0aXRsZSA9IGpzb25EYXRhW2ldLmRlc2NyaXB0aW9uOwoJCQl2YXIgdmlkZW9JZCA9IGpzb25EYXRhW2ldLmlkOwoJCQl2YXIgdmlkZW9OYW1lID0ganNvbkRhdGFbaV0ubmFtZTsKCQkJdmFyIHZpZGVvRGVzY3JpcHRpb24gPSBqc29uRGF0YVtpXS5kZXNjcmlwdGlvbjsKCQkJdmFyIHZpZGVvUG9zdGVyID0ganNvbkRhdGFbaV0uaW1hZ2VzLnBvc3RlcjsKCQkJbW9kYWxHbG9iYWwgPSBtb2RhbEdsb2JhbCArICc8ZGl2IGNsYXNzPSJtb2RhbCBwbGF5bGlzdFZpZGVvTW9kYWwgZmFkZSIgaWQ9InZpZGVvLW1vZGFsJyt2aWRlb0lkKyciIHRhYmluZGV4PSItMSIgcm9sZT0iZGlhbG9nIiBhcmlhLWxhYmVsPSJIUCBWaWRlb3MiIGFyaWEtaGlkZGVuPSJ0cnVlIiBkYXRhLXNob3c9InRydWUiPjxkaXYgY2xhc3M9Im1vZGFsLWRpYWxvZyBtb2RhbC1tZCI+PGRpdiBpZD0iZGF0YS1jb2xsZWN0aW9uIiBjbGFzcz0ibW9kYWwtY29udGVudCI+PGRpdiBjbGFzcz0iZW1iZWQtY29udGFpbmVyIj48dmlkZW8gc3R5bGU9IndpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwcHg7IGJvdHRvbTogMHB4OyByaWdodDogMHB4OyBsZWZ0OiAwcHg7IiBkYXRhLXZpZGVvLWlkPSInK3ZpZGVvSWQrJyIgZGF0YS1hY2NvdW50PSInK2FjY291bnRJZCsnIiBkYXRhLXBsYXllcj0iJytwbGF5ZXJJZCsnIiBkYXRhLWVtYmVkPSJkZWZhdWx0IiBjbGFzcz0idmlkZW8tanMiIGNvbnRyb2xzPSIiIHBvc3Rlcj0iJyt2aWRlb1Bvc3RlcisnIj48L3ZpZGVvPjxcL2Rpdj48ZGl2IGNsYXNzPSJtb2RhbC1ib2R5Ij48ZGl2IGNsYXNzPSJocC1yb3ciPjxkaXYgY2xhc3M9ImNvbC1sZy0yNCI+PGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJidXR0b24gYnV0dG9uLWJsb2NrIHByaW1hcnkgZnIiIGRhdGEtZGlzbWlzcz0ibW9kYWwiPicrJCgiI3ZpZGVvX2Nsb3NlIikudmFsKCkrJzxcL2J1dHRvbj48aDMgY2xhc3M9Im5vLXN1YnRpdGxlIj4nK3ZpZGVvTmFtZSsnPFwvaDM+PHA+Jyt2aWRlb0Rlc2NyaXB0aW9uKyc8XC9wPjxcL2Rpdj48XC9kaXY+PFwvZGl2PjxcL2Rpdj48XC9kaXY+PFwvZGl2PlxuJzsKCQl9Cgl9ZWxzZSB7CQkJCQkJCQkJCQkJLy9jaGVja2luZyBpZiBicmlnaHRDb3ZlIG9yIHlvdVR1YmUgdmlkZW8gbmVlZHMgdG8gYmUgcmVuZGVyZWQgQUxNIyAyNjM1CgkJeW91dHViZUZsYWcgPSB0cnVlOwoJCWpzb25WaWRlb0RhdGEgPSBqc29uRGF0YTsKCQlmb3IodmFyIGkgPSAwOyBpIDwganNvbkRhdGEubGVuZ3RoOyBpKyspewoJCQl2YXIgdGl0bGUgPSBqc29uRGF0YVtpXS5kZXNjcmlwdGlvbjsKCQkJdmFyIHZpZGVvSWQgPSBqc29uRGF0YVtpXS5pZDsKCQkJdmFyIHZpZGVvTmFtZSA9IGpzb25EYXRhW2ldLm5hbWU7CgkJCXZhciB2aWRlb0Rlc2NyaXB0aW9uID0ganNvbkRhdGFbaV0uZGVzY3JpcHRpb247CgkJCXZhciB2aWRlb1Bvc3RlciA9IGpzb25EYXRhW2ldLmltYWdlcy5wb3N0ZXI7CgkJCW1vZGFsR2xvYmFsID0gbW9kYWxHbG9iYWwgKyAnPGRpdiBjbGFzcz0ibW9kYWwgcGxheWxpc3RWaWRlb01vZGFsIGZhZGUiIGlkPSJ2aWRlby1tb2RhbCcrdmlkZW9JZCsnIiB0YWJpbmRleD0iLTEiIHJvbGU9ImRpYWxvZyIgYXJpYS1sYWJlbD0iSFAgVmlkZW9zIiBhcmlhLWhpZGRlbj0idHJ1ZSIgZGF0YS1zaG93PSJ0cnVlIj48ZGl2IGNsYXNzPSJtb2RhbC1kaWFsb2cgbW9kYWwtbWQiPjxkaXYgaWQ9ImRhdGEtY29sbGVjdGlvbiIgY2xhc3M9Im1vZGFsLWNvbnRlbnQiPjxkaXYgY2xhc3M9ImVtYmVkLWNvbnRhaW5lciI+PGRpdiBzdHlsZT0id2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsgcG9zaXRpb246IGFic29sdXRlOyB0b3A6IDBweDsgYm90dG9tOiAwcHg7IHJpZ2h0OiAwcHg7IGxlZnQ6IDBweDsiIGNsYXNzPSJ2aWRlby1qcyIgaWQ9InBsYXllcicraSsnIiA+PC9kaXY+PFwvZGl2PjxkaXYgY2xhc3M9Im1vZGFsLWJvZHkiPjxkaXYgY2xhc3M9ImhwLXJvdyI+PGRpdiBjbGFzcz0iY29sLWxnLTI0Ij48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImJ1dHRvbiBidXR0b24tYmxvY2sgcHJpbWFyeSBmciIgZGF0YS1kaXNtaXNzPSJtb2RhbCI+JyskKCIjdmlkZW9fY2xvc2UiKS52YWwoKSsnPFwvYnV0dG9uPjxoMyBjbGFzcz0ibm8tc3VidGl0bGUiPicrdmlkZW9OYW1lKyc8XC9oMz48cD4nK3ZpZGVvRGVzY3JpcHRpb24rJzxcL3A+PFwvZGl2PjxcL2Rpdj48XC9kaXY+PFwvZGl2PjxcL2Rpdj48XC9kaXY+XG4nOwoJCX0KCX0KCSQoImJvZHkiKS5hcHBlbmQobW9kYWxHbG9iYWwpOwoJaWYoeW91dHViZUZsYWcpewoJCSQuZ2V0U2NyaXB0KHdpZGdldEFQSVVybCkuZG9uZShmdW5jdGlvbiggc2NyaXB0LCB0ZXh0U3RhdHVzICkgewoJCQljb25zb2xlLmxvZyggdGV4dFN0YXR1cyApOwoJCX0pCgkJLnN1Y2Nlc3MoZnVuY3Rpb24odGV4dFN0YXR1cyl7CgkJCWNvbnNvbGUubG9nKCJpbiBzdWNjZXNzIik7CgkJCWpzb25WaWRlb0RhdGFDb3VudGVyID0gMDsKCQkJb25Zb3VUdWJlSWZyYW1lQVBJUmVhZHkoKTsJCS8vaWYgeW91dHViZSBmbGFnIGlzIHRydWUgb25seSB0aGVuIGludm9rZSB0aGUgcGxheWVyIEFQSSBBTE0jIDI2MzUJCQkJCgkJfSkKCgl9CgoKCglpZigkKCIjcGFnZUlkZW50aWZpZXIiKS52YWwoKSAhPSAiSFAgTWljcm9zaXRlIil7CgkJbG9hZEJyaWdodGNvdmVTY3JpcHRGb3JWaWRlb3MoKTsKCX0KCglmdW5jdGlvbiByZW5kZXJQYWdpbmF0aW9uKHBhZ2UsanNvbkRhdGEsIHZpZGVvQ29udGFpbmVyUmVmZXJlbmNlKSB7CgkJdmFyIHZpZGVvQ29udGFpbmVyTWFpbldyYXBwZXI9IHZpZGVvQ29udGFpbmVyUmVmZXJlbmNlLnBhcmVudCgiLnZpZGVvUGxheWxpc3RXcmFwcGVyIik7CgkJc3RhcnRvblBhZ2UgPSBwYWdlICogcGVyUGFnZSAtIChwZXJQYWdlIC0xKTsKCQlsYXN0b25QYWdlID0gc3RhcnRvblBhZ2UgKyAocGVyUGFnZSAtIDEpOwoJCWlmIChzdGFydG9uUGFnZSA9PSAxKSB7CgkJCS8vIGRpc2FibGUgcHJldiBidXR0b24KCQkJdmlkZW9Db250YWluZXJNYWluV3JhcHBlci5maW5kKCcucGFnaW5hdGlvbi1sZXNzJykuYXR0cignZGlzYWJsZWQnLCdkaXNhYmxlZCcpOwoJCQl2aWRlb0NvbnRhaW5lck1haW5XcmFwcGVyLmZpbmQoJy5wYWdpbmF0aW9uLWxlc3MnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTsKCQl9IGVsc2UgewoJCQl2aWRlb0NvbnRhaW5lck1haW5XcmFwcGVyLmZpbmQoJy5wYWdpbmF0aW9uLWxlc3MnKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpOwoJCQl2aWRlb0NvbnRhaW5lck1haW5XcmFwcGVyLmZpbmQoJy5wYWdpbmF0aW9uLWxlc3MnKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTsKCQl9CgoJCWlmIChsYXN0b25QYWdlID49IGpzb25EYXRhLmxlbmd0aCkgewoJCQkvLyBkaXNhYmxlIG5leHQgYnV0dG9uCgkJCXZpZGVvQ29udGFpbmVyTWFpbldyYXBwZXIuZmluZCgnLnBhZ2luYXRpb24tbW9yZScpLmF0dHIoJ2Rpc2FibGVkJywnZGlzYWJsZWQnKTsKCQkJdmlkZW9Db250YWluZXJNYWluV3JhcHBlci5maW5kKCcucGFnaW5hdGlvbi1tb3JlJykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7CgkJfSBlbHNlIHsKCQkJdmlkZW9Db250YWluZXJNYWluV3JhcHBlci5maW5kKCcucGFnaW5hdGlvbi1tb3JlJykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsKCQkJdmlkZW9Db250YWluZXJNYWluV3JhcHBlci5maW5kKCcucGFnaW5hdGlvbi1tb3JlJykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7CgkJfQkJCQkJCQkgCgl9CgoJZnVuY3Rpb24gcmVzcG9uc2UoanNvbkRhdGEsIHNob3dhbGwsIHZpZGVvUGxheWxpc3RDb250ZXh0LCBjdXJQYWdlKSB7CgkJaWYodmlkZW9QbGF5bGlzdENvbnRleHQgPT09IHVuZGVmaW5lZCl7CgkJCXZhciB2aWRlb0NvbnRhaW5lclJlZmVyZW5jZSA9ICQoImRpdltkYXRhLXBsYXlsaXN0LWlkPSciK3BsYXlsaXN0SWQrIiddIik7CgkJfQoJCWVsc2V7CgkJCXZhciB2aWRlb0NvbnRhaW5lclJlZmVyZW5jZSA9IHZpZGVvUGxheWxpc3RDb250ZXh0OwoJCX0KCQl2YXIgdmlkZW9Db250YWluZXJNYWluV3JhcHBlcj0gdmlkZW9Db250YWluZXJSZWZlcmVuY2UucGFyZW50KCIudmlkZW9QbGF5bGlzdFdyYXBwZXIiKTsKCQljb3B5b2Zqc29uRGF0YSA9IGpzb25EYXRhOwkKCQlyZW5kZXJQYWdpbmF0aW9uKGN1clBhZ2UsanNvbkRhdGEsIHZpZGVvQ29udGFpbmVyUmVmZXJlbmNlKTsKCQlyZW5kZXJWaWRlb3MoanNvbkRhdGEsIHNob3dhbGwsIHZpZGVvQ29udGFpbmVyUmVmZXJlbmNlKTsKCQkkKCcudmlkZW9Db250ZW50IGZpZ2NhcHRpb24nKS5tYXRjaEhlaWdodCgpOwoKCQkvL2ZvciB0cnVuY2F0aW5nIHRoZSB2aWRlbyBkZXNjcmlwdGlvbiAKCQl2YXIgdHJ1bmNWYWwgPSAxMDA7IAoJCWlmKCQoJyN0cnVuY2F0aW9uTGltaXQnKS5sZW5ndGggPiAwKXsKCQkJdHJ1bmNWYWwgPSBwYXJzZUludCgkKCcjdHJ1bmNhdGlvbkxpbWl0JykudmFsKCkpOwoJCX0KCgkJdmlkZW9Db250YWluZXJNYWluV3JhcHBlci5maW5kKCJmaWdjYXB0aW9uIikuY2hpbGRyZW4oInNwYW4iKS5lYWNoIChmdW5jdGlvbiAoKSB7CgkJCWlmICgkKHRoaXMpLnRleHQoKS5sZW5ndGggPiB0cnVuY1ZhbCkKCQkJCSQodGhpcykudGV4dCgkKHRoaXMpLnRleHQoKS5zdWJzdHJpbmcoMCx0cnVuY1ZhbCkgKyAnLi4uJyk7CgkJfSk7CgoJCXZpZGVvQ29udGFpbmVyTWFpbldyYXBwZXIuZmluZCgnLnBsYXknKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkkKCIudmlkZW9Db250ZW50IGltZyIpLmxvYWQoZnVuY3Rpb24oKXsKCQkJCXZhciB0b3BQb3MgPSAoJCgiLnZpZGVvQ29udGVudCBpbWciKS5pbm5lckhlaWdodCgpLTM2KS8yOwoJCQkJJCgnLnBsYXknKS5jc3MoInRvcCIsIHRvcFBvcyk7CgoJCQkJdmFyIGxlZnRQb3MgPSAoJCgiLnZpZGVvQ29udGVudCIpLm91dGVyV2lkdGgoKSAtIDQ4KS8yOwoJCQkJJCgnLnBsYXknKS5jc3MoImxlZnQiLCBsZWZ0UG9zKTsKCQkJfSk7CgkJfSk7IAoJfQoKCWZpbGxQYWdpbmF0aW9uID0gZnVuY3Rpb24ob2JqZWN0SW5SZWZlcmVuY2UsIHBhZ2VTaXplLCBqc29uRGF0YSkgewoJCXZhciBwYWdlVG90YWxWYWw7CgkJdmFyIGVuZFZhbDsKCQl2YXIgc3RhcnRWYWw7CgkJdmFyIHN0YXJ0VmFsTG9jYXRpb24gPSBvYmplY3RJblJlZmVyZW5jZS5maW5kKCcucGFnaW5hdGlvblN0YXJ0VmFsJyk7CgkJdmFyIGVuZFZhbExvY2F0aW9uID0gb2JqZWN0SW5SZWZlcmVuY2UuZmluZCgnLnBhZ2luYXRpb25FbmRWYWwnKTsKCQl2YXIgdG90YWxWYWxMb2NhdGlvbiA9IG9iamVjdEluUmVmZXJlbmNlLmZpbmQoJy5wYWdpbmF0aW9uVG90YWxWYWwnKTsKCgkJaWYgKG51bGwgIT0ganNvbkRhdGEpCgkJCXBhZ2VUb3RhbFZhbCA9IGpzb25EYXRhLmxlbmd0aDsKCQllbHNlCgkJCXBhZ2VUb3RhbFZhbCA9ICIiOwoKCQlpZiAocGFnZVRvdGFsVmFsIDwgcGFnZVNpemUpIHsKCQkJZW5kVmFsID0gcGFnZVRvdGFsVmFsOwoJCX0gZWxzZSB7CgkJCWVuZFZhbCA9IHBhZ2VTaXplOwoJCX0KCgkJc3RhcnRWYWxMb2NhdGlvbi5odG1sKCcxJyk7CgkJZW5kVmFsTG9jYXRpb24uaHRtbChlbmRWYWwpOwoJCXRvdGFsVmFsTG9jYXRpb24uaHRtbChwYWdlVG90YWxWYWwpOwoJfTsKCgl1cGRhdGVQYWdpbmF0aW9uID0gZnVuY3Rpb24ob2JqZWN0SW5SZWZlcmVuY2UsIGpzb25EYXRhLCBwYWdlU3RhcnRWYWwsIHBhZ2VFbmRWYWwpIHsKCgkJdmFyIHBhZ2VUb3RhbFZhbDsKCQl2YXIgc3RhcnRWYWxMb2NhdGlvbiA9IG9iamVjdEluUmVmZXJlbmNlLmZpbmQoJy5wYWdpbmF0aW9uU3RhcnRWYWwnKTsKCQl2YXIgZW5kVmFsTG9jYXRpb24gPSBvYmplY3RJblJlZmVyZW5jZS5maW5kKCcucGFnaW5hdGlvbkVuZFZhbCcpOwoJCXZhciB0b3RhbFZhbExvY2F0aW9uID0gb2JqZWN0SW5SZWZlcmVuY2UuZmluZCgnLnBhZ2luYXRpb25Ub3RhbFZhbCcpOwoKCQlpZiAobnVsbCAhPSBqc29uRGF0YSl7CgkJCXBhZ2VUb3RhbFZhbCA9IGpzb25EYXRhLmxlbmd0aDsKCQl9CgkJZWxzZQoJCQlwYWdlVG90YWxWYWwgPSAiIjsKCgkJc3RhcnRWYWxMb2NhdGlvbi5odG1sKHBhZ2VTdGFydFZhbCk7CgkJZW5kVmFsTG9jYXRpb24uaHRtbChwYWdlRW5kVmFsKTsKCQl0b3RhbFZhbExvY2F0aW9uLmh0bWwocGFnZVRvdGFsVmFsKTsKCX07CgoKCWZ1bmN0aW9uIHJlbmRlclZpZGVvcyhqc29uRGF0YSwgc2hvd2FsbCwgdmlkZW9Db250YWluZXJSZWZlcmVuY2UpIHsKCQl2YXIgdmlkZW9Db250YWluZXJNYWluV3JhcHBlcj0gdmlkZW9Db250YWluZXJSZWZlcmVuY2UucGFyZW50KCIudmlkZW9QbGF5bGlzdFdyYXBwZXIiKTsKCQl2aWRlb0NvbnRhaW5lclJlZmVyZW5jZS5lbXB0eSgpOwoKCQl2YXIgc3RyID0gIiI7CgkJLy8gdmFyIG1vZGFsID0gIiI7CgoJCWlmIChqc29uRGF0YS5sZW5ndGggPiBsYXN0b25QYWdlKSB7CgkJCXVwcGVyTGltaXQgPSBsYXN0b25QYWdlOyAKCQkJdmlkZW9Db250YWluZXJNYWluV3JhcHBlci5maW5kKCcucGFnaW5hdGlvbi1jb250YWluZXInKS5zaG93KCk7CgkJfSBlbHNlIHsKCQkJdXBwZXJMaW1pdCA9IGpzb25EYXRhLmxlbmd0aDsKCQkJLy8gY29kZSB0byBkaXNhYmxlIG5leHQgZ29lcyBoZXJlCgkJCS8vJCgnLnBhZ2luYXRpb24tY29udGFpbmVyJykuaGlkZSgpOwoKCQl9CgoJCWlmKHNob3dhbGwgPT0gJ3RydWUnKXsKCgkJCXN0YXJ0b25QYWdlID0xOwoJCQl1cHBlckxpbWl0ID0ganNvbkRhdGEubGVuZ3RoOwoJCQl2aWRlb0NvbnRhaW5lck1haW5XcmFwcGVyLmZpbmQoJy5wYWdpbmF0aW9uLWxlc3MnKS5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJyk7CgkJCXZpZGVvQ29udGFpbmVyTWFpbldyYXBwZXIuZmluZCgnLnBhZ2luYXRpb24tbGVzcycpLmFkZENsYXNzKCdkaXNhYmxlZCcpOwoJCQl2aWRlb0NvbnRhaW5lck1haW5XcmFwcGVyLmZpbmQoJy5wYWdpbmF0aW9uLW1vcmUnKS5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJyk7CgkJCXZpZGVvQ29udGFpbmVyTWFpbldyYXBwZXIuZmluZCgnLnBhZ2luYXRpb24tbW9yZScpLmFkZENsYXNzKCdkaXNhYmxlZCcpOwoKCQl9CgoJCWZvciAodmFyIGk9KHN0YXJ0b25QYWdlIC0gMSk7IGk8dXBwZXJMaW1pdDsgaSsrKSB7CgkJCS8vIHZhciB0aXRsZSA9IGpzb25EYXRhW2ldOwoJCQl2YXIgdGl0bGUgPSBqc29uRGF0YVtpXS5kZXNjcmlwdGlvbjsKCQkJdmFyIHZpZGVvSWQgPSBqc29uRGF0YVtpXS5pZDsKCQkJdmFyIHZpZGVvVGh1bWJuYWlsID0ganNvbkRhdGFbaV0uaW1hZ2VzLnRodW1ibmFpbDsKCQkJdmFyIHZpZGVvUG9zdGVyID0ganNvbkRhdGFbaV0uaW1hZ2VzLnBvc3RlcjsKCQkJdmFyIHZpZGVvTmFtZSA9IGpzb25EYXRhW2ldLm5hbWU7CgkJCXZhciB2aWRlb0Rlc2NyaXB0aW9uID0ganNvbkRhdGFbaV0uZGVzY3JpcHRpb247CgoJCQlpZihwYXJzZUludChwbGF5bGlzdE1hc3Rlck9iamVjdFtwbGF5bGlzdElkXS5wZXJQYWdlKSA9PSA0KXsKCQkJCXN0ciA9IHN0ciArICc8ZGl2IGNsYXNzPSJjb2wtbGctNiBjb2wtbWQtMTIgY29sLXNtLTI0IHZpZGVvQ29udGVudCI+JyArICc8YSBhcmlhLWRlc2NyaWJlZGJ5PSJ2aWRlb0NhcHRpb24nK2krJyIgY2xhc3M9Im1vZGFsLXRyaWdnZXIiIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgZGF0YS10b2dnbGU9Im1vZGFsIiBkYXRhLWJhY2tkcm9wPSJzdGF0aWMiIGRhdGEtdGFyZ2V0PSIjdmlkZW8tbW9kYWwnK3ZpZGVvSWQrJyI+JyArICc8aW1nIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7Y2xlYXI6Ym90aDtkaXNwbGF5OmJsb2NrOyIgc3JjPSInICsgdmlkZW9Qb3N0ZXIgKyAnIj48c3BhbiB0aXRsZT1cInBsYXlcIiByZWw9XCJcIiBjbGFzcz1cInBsYXkganNfdmlkZW9fdHJpZ2dlclwiPjxcL3NwYW4+PC9hPicgICsgJzxmaWdjYXB0aW9uIGlkPSJ2aWRlb0NhcHRpb24nK2krJyI+PHN0cm9uZz4gJyt2aWRlb05hbWUrJyA8L3N0cm9uZz4gPHNwYW4+Jyt2aWRlb0Rlc2NyaXB0aW9uKyc8L3NwYW4+IDwvZmlnY2FwdGlvbj48L2Rpdj4nOwoJCQl9CgkJCWVsc2V7CgkJCQlzdHIgPSBzdHIgKyAnPGRpdiBjbGFzcz0iY29sLWxnLTggY29sLW1kLTEyIGNvbC1zbS0yNCB2aWRlb0NvbnRlbnQiPicgKyAnPGEgYXJpYS1kZXNjcmliZWRieT0idmlkZW9DYXB0aW9uJytpKyciIGNsYXNzPSJtb2RhbC10cmlnZ2VyIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGRhdGEtdG9nZ2xlPSJtb2RhbCIgZGF0YS1iYWNrZHJvcD0ic3RhdGljIiBkYXRhLXRhcmdldD0iI3ZpZGVvLW1vZGFsJyt2aWRlb0lkKyciPicgKyAnPGltZyBzdHlsZT0iY3Vyc29yOiBwb2ludGVyO2NsZWFyOmJvdGg7ZGlzcGxheTpibG9jazsiIHNyYz0iJyArIHZpZGVvUG9zdGVyICsgJyI+PHNwYW4gdGl0bGU9XCJwbGF5XCIgcmVsPVwiXCIgY2xhc3M9XCJwbGF5IGpzX3ZpZGVvX3RyaWdnZXJcIj48XC9zcGFuPjwvYT4nICArICc8ZmlnY2FwdGlvbiBpZD0idmlkZW9DYXB0aW9uJytpKyciPjxzdHJvbmc+ICcrdmlkZW9OYW1lKycgPC9zdHJvbmc+IDxzcGFuPicrdmlkZW9EZXNjcmlwdGlvbisnPC9zcGFuPiA8L2ZpZ2NhcHRpb24+PC9kaXY+JzsKCQkJfQoJCX0KCgkJdmlkZW9Db250YWluZXJSZWZlcmVuY2UuYXBwZW5kKHN0cik7CgkJLy8gdmlkZW9Db250YWluZXJSZWZlcmVuY2UuYXBwZW5kKG1vZGFsKTsKCgkJZmlsbFBhZ2luYXRpb24odmlkZW9Db250YWluZXJNYWluV3JhcHBlci5maW5kKCdjb250YWluZXJGb3JQYWdpbmF0aW9uSGVhZCcpLCBwZXJQYWdlLCBqc29uRGF0YSk7CgkJdXBkYXRlUGFnaW5hdGlvbih2aWRlb0NvbnRhaW5lck1haW5XcmFwcGVyLmZpbmQoJ2NvbnRhaW5lckZvclBhZ2luYXRpb25IZWFkJyksIGpzb25EYXRhLCBzdGFydG9uUGFnZSwgdXBwZXJMaW1pdCk7CQoJCWZpbGxQYWdpbmF0aW9uKHZpZGVvQ29udGFpbmVyTWFpbldyYXBwZXIuZmluZCgnLmNvbnRhaW5lckZvclBhZ2luYXRpb25Gb290JyksIHBlclBhZ2UsIGpzb25EYXRhKTsKCQl1cGRhdGVQYWdpbmF0aW9uKHZpZGVvQ29udGFpbmVyTWFpbldyYXBwZXIuZmluZCgnLmNvbnRhaW5lckZvclBhZ2luYXRpb25Gb290JyksIGpzb25EYXRhLCBzdGFydG9uUGFnZSwgdXBwZXJMaW1pdCk7Cgl9CglyZXNwb25zZShqc29uRGF0YSwgImZhbHNlIiwgdW5kZWZpbmVkLCAxKTsKfQoKJCgiLmJjU2luZ2xlVmlkZW9Db250YWluZXIiKS5lYWNoKGZ1bmN0aW9uKGluZGV4LCB2YWwpewoJdmFyIGFjdHVhbFZpZGVvSWQgPSAkKHRoaXMpLmF0dHIoImlkIik7CglpZihhY3R1YWxWaWRlb0lkLmluZGV4T2YoIjoiKSA+PSAwKXsKCQkkKHRoaXMpLmF0dHIoImlkIiwgJCh0aGlzKS5hdHRyKCJpZCIpLnJlcGxhY2UoIjoiLCAiIikpOwoJfQoJJCh0aGlzKS5hdHRyKCJkYXRhLWlkIiwgJCh0aGlzKS5hdHRyKCJpZCIpKTsKCgl2YXIgY29sbGVjdGlvbklEID0gYWN0dWFsVmlkZW9JZDsKCWZldGNoVmlkZW8oJCh0aGlzKS5kYXRhKCJpZCIpLCBjb2xsZWN0aW9uSUQpOwkJCS8vbWFrZSBjYWxsIHRvIGZldGNoIHlvdXR1YmUgdmlkZW8gQUxNIyAyNjM1Cgp9KTsKCi8vRmV0Y2ggdmlkZW8gZGV0YWlscyBBTE0jIDI2MzUKZnVuY3Rpb24gZmV0Y2hWaWRlbyh2aWRlb1RoTldyYXBwZXJJZCwgY29sbGVjdGlvbklEKXsKCXZhciBjYyA9IGdldENDTEMoImNjIik7Cgl2YXIgbGMgPSBnZXRDQ0xDKCJsYyIpOwoJdmFyIGRvY1NvdXJjZT0gJCgiI2RvY1NvdXJjZSIpLnZhbCgpOwoJdmFyIGRvY0xhbmd1YWdlPSQoIiNkb2NMYW5ndWFnZSIpLnZhbCgpOwoJY29uc29sZS5sb2coImRvY0xhbmd1YWdlIGlzPT09PiIrZG9jTGFuZ3VhZ2UpOwoJdmFyIHVkcEZsYWc9Jyc7CglpZihkb2NMYW5ndWFnZSE9dW5kZWZpbmVkICYmIGRvY0xhbmd1YWdlIT1udWxsICYmIGRvY0xhbmd1YWdlIT0nJyl7CgkJaWYoZG9jTGFuZ3VhZ2UgPT0gInpoIiB8IGRvY0xhbmd1YWdlID09ICJ6aC1oYW5zIiB8fCBkb2NMYW5ndWFnZSA9PSAiemgtaGFudCIpewoJCQlkb2NMYW5ndWFnZT0iemhjbiI7CgkJfQoJCWxjPWRvY0xhbmd1YWdlOwoJfQoJaWYoZG9jU291cmNlIT11bmRlZmluZWQgJiYgZG9jU291cmNlIT1udWxsICYmIGRvY1NvdXJjZSE9JycgJiYgZG9jU291cmNlID09ICdVRFAnKXsKCQl1ZHBGbGFnPXRydWU7Cgl9ZWxzZXsKCQl1ZHBGbGFnPWZhbHNlOwoJfQoJZG9jVmlkZW9Db3VudCsrOwkJCS8vY2hlY2tpbmcgdGhlIG51bWJlciBvZiB2aWRlb3MgaW4gYSBkb2N1bWVudCBBTE0jIDI2MzUKCSQuYWpheCh7CgkJdHlwZTogJ0dFVCcsCgkJdXJsOiAiL2hwLXBwcy1zZXJ2aWNlcy92aWRlb3MvY29sbGVjdGlvbi8iK2NvbGxlY3Rpb25JRCsiL2NjLyIrY2MrIi9sYy8iK2xjKyIvdWRwRmxhZy8iK3VkcEZsYWcsCgkJY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiwKCQlkYXRhVHlwZTogJ2pzb24nCgl9KS5kb25lKGZ1bmN0aW9uKGRhdGEpewoJCWlmKGRhdGEgIT0gdW5kZWZpbmVkICYmIGRhdGEgIT0gbnVsbCAmJiBkYXRhICE9ICIiKXsKCQkJLy8gb24gc3VjY2VzcwoJCQl2YXIgc291cmNlID0gJCgiI3NpbmdsZVZpZGVvVGVtcGxhdGUiKS5odG1sKCk7CgkJCXZhciB0ZW1wbGF0ZSA9IEhhbmRsZWJhcnMuY29tcGlsZShzb3VyY2UpOwoJCQkkKCcuYmNTaW5nbGVWaWRlb0NvbnRhaW5lcltkYXRhLWlkPSInK3ZpZGVvVGhOV3JhcHBlcklkKyciXScpLmh0bWwodGVtcGxhdGUoZGF0YSkpOwoJCQkvL2lmKCQuaW5BcnJheShjYyxicmlnaHRDb3ZlQ291bnRyeUNvZGVzKSA9PSAtMSl7CgkJCWlmKGRhdGFbMF0uc3RyZWFtaW5nU2VydmljZT09IllvdVR1YmUiKXsKCQkJCSQoJy5iY1NpbmdsZVZpZGVvQ29udGFpbmVyJykuZmluZCgidmlkZW8iKS5wYXJlbnQoKS5hcHBlbmQoIjxkaXYgc3R5bGU9J3dpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwcHg7IGJvdHRvbTogMHB4OyByaWdodDogMHB4OyBsZWZ0OiAwcHg7JyBpZD0ncGxheWVyIitjb3VudGVyKyInPjwvZGl2PiIpCgkJCQkkKCcuYmNTaW5nbGVWaWRlb0NvbnRhaW5lcicpLmZpbmQoInZpZGVvIikucmVtb3ZlKCk7CgkJCQl2YXIgaXRlbSA9IHt9OwoJCQkJaXRlbVsieW91dHViZV9pZCJdID0gZGF0YVswXS55b3V0dWJlX2lkOwoJCQkJaXRlbVsieW91dHViZV91cmwiXSA9IGRhdGFbMF0udmlkZW9VUkw7CgkJCQlpZihkYXRhWzBdLmxhbmdfY29kZSAhPSB1bmRlZmluZWQgJiYgZGF0YVswXS5sYW5nX2NvZGUgIT0gIiIgJiYgZGF0YVswXS5sYW5nX2NvZGUgIT0gbnVsbCl7CgkJCQkJaXRlbVsibGFuZ19jb2RlIl0gPSBkYXRhWzBdLmxhbmdfY29kZTsJCS8vYXNzaWduaW5nIHRoZSBmYWxsYmFjayBsYW5nY29kZSBBTE0jIDI2MzUKCQkJCX1lbHNlewoJCQkJCWl0ZW1bImxhbmdfY29kZSJdID0gIiI7CQkJCS8vc2V0dGluZyB0aGUgZGVmYXVsdCBsYW5nIGNvZGUgYXMgZW1wdHkgaWYgbm90IGZhbGxiYWNrIHZpZGVvIAoJCQkJfQoJCQkJZG9jVmlkZW9EYXRhLnB1c2goaXRlbSk7CgkJCQljb3VudGVyKys7CgkJCQlpZihkb2NWaWRlb0NvdW50ID09ICQoIi5iY1NpbmdsZVZpZGVvQ29udGFpbmVyIikubGVuZ3RoKXsKCQkJCQkkLmdldFNjcmlwdCh3aWRnZXRBUElVcmwpLmRvbmUoZnVuY3Rpb24oIHNjcmlwdCwgdGV4dFN0YXR1cyApIHsKCQkJCQkJY29uc29sZS5sb2coIHRleHRTdGF0dXMgKTsKCQkJCQl9KQoJCQkJCS5zdWNjZXNzKGZ1bmN0aW9uKHRleHRTdGF0dXMpewoJCQkJCQljb25zb2xlLmxvZygiaW4gc3VjY2VzcyIpOwoJCQkJCQlqc29uVmlkZW9EYXRhQ291bnRlciA9IDA7CgkJCQkJCWpzb25WaWRlb0RhdGEgPSBkb2NWaWRlb0RhdGE7CgkJCQkJCW9uWW91VHViZUlmcmFtZUFQSVJlYWR5KCk7CQkvL2ludm9rZSB0aGUgcGxheWVyIEFQSSBmdW5jdGlvbgkJCQoJCQkJCX0pCgkJCQl9CgkJCX0vL2VuZCBvZiBpZiBsb29wCgkJfQoKCX0pLmZhaWwoZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMpewoKCX0pOwp9Cgp2YXIgYnJpZ2h0Y292ZVNjcmlwdENhbGxlZCA9IGZhbHNlOwokKGRvY3VtZW50KS5vbigiY2xpY2siLCAiLnZpZGVvVGh1bWJuYWlsIiwgZnVuY3Rpb24oKXsKCWlmKCFicmlnaHRjb3ZlU2NyaXB0Q2FsbGVkKXsKCQlsb2FkQnJpZ2h0Y292ZVNjcmlwdEZvclZpZGVvcygpOwoJCWJyaWdodGNvdmVTY3JpcHRDYWxsZWQgPSB0cnVlOwoJfQp9KTsKCi8qCiAqIDE5LjQgQ1JzIC0gQUxNIDIyMjEKICovCi8qCiAqCSQod2luZG93KS5vbigibG9hZCIsIGZ1bmN0aW9uKCl7CgkJaWYoJCgiI3BhZ2VJZGVudGlmaWVyIikudmFsKCkgPT0gIkhQIE1pY3Jvc2l0ZSIpewoJCQlsb2FkQnJpZ2h0Y292ZVNjcmlwdEZvclZpZGVvcygpOwoJCX0KCX0pOwoKICovCgpmdW5jdGlvbiBsb2FkQnJpZ2h0Y292ZVNjcmlwdEZvclZpZGVvcygpewoJCSQoImJvZHkiKS5hcHBlbmQoIjxzY3JpcHQgdHlwZT0ndGV4dC9qYXZhc2NyaXB0JyBzcmM9JyIrd2luZG93LmxvY2F0aW9uLnByb3RvY29sKyIvL3BsYXllcnMuYnJpZ2h0Y292ZS5uZXQvIithY2NvdW50SWQrIi8iK3BsYXllcklkKyJfZGVmYXVsdC9pbmRleC5taW4uanMnPjwvc2NyaXB0PiIpOwp9CgovKiB5b3V0dWJlIGFwaSBmdW5jdGlvbiBBTE0jIDI2MzUgICovCgpmdW5jdGlvbiBvbllvdVR1YmVJZnJhbWVBUElSZWFkeSgpIHsKCXZhciBsYW5nQ29kZSA9ICIiOwoJaWYoanNvblZpZGVvRGF0YSAhPSB1bmRlZmluZWQgJiYganNvblZpZGVvRGF0YSAhPSAiIil7CgkJaWYoanNvblZpZGVvRGF0YUNvdW50ZXIgPiAwKXsKCQkJanNvblZpZGVvRGF0YSA9ICIiOwkJLy9hdm9pZCB0aGUgZnVuY3Rpb24gYmVpbmcgY2FsbGVkIHR3aWNlCgkJfQoJCWZvcih2YXIgaj0wO2o8anNvblZpZGVvRGF0YS5sZW5ndGg7aisrKXsKCQkJcGxheWVyID0gInBsYXllciIrajsKCQkJcGxheWVyID0gbmV3IFlULlBsYXllcigicGxheWVyIitqLCB7CgkJCQl2aWRlb0lkOiBqc29uVmlkZW9EYXRhW2pdLnlvdXR1YmVfaWQsCgkJCQlldmVudHM6IHt9CgkJCX0pOwoJCQkvKlVTLTEzMzI5NyBZb3V0dWJlIFVSTCBDaGFuZ2VzKi8KCQkJaWYoanNvblZpZGVvRGF0YVtqXS55b3V0dWJlX3VybCAhPXVuZGVmaW5lZCAmJiBqc29uVmlkZW9EYXRhW2pdLnlvdXR1YmVfdXJsICE9ICIiICYmIGpzb25WaWRlb0RhdGFbal0ueW91dHViZV91cmwgIT1udWxsKQoJCQkJewoJCQkJJCgiaWZyYW1lI3BsYXllciIraikuYXR0cigic3JjIixqc29uVmlkZW9EYXRhW2pdLnZpZGVvdXJsKTsKCQkJCX0KCQkJZWxzZXsKCQkJaWYoanNvblZpZGVvRGF0YVtqXS5sYW5nX2NvZGUgIT0gdW5kZWZpbmVkICYmIGpzb25WaWRlb0RhdGFbal0ubGFuZ19jb2RlICE9ICIiICYmIGpzb25WaWRlb0RhdGFbal0ubGFuZ19jb2RlICE9IG51bGwpewoJCQkJbGFuZ0NvZGUgPSBqc29uVmlkZW9EYXRhW2pdLmxhbmdfY29kZTsJCQkvL2NoZWNrIGlmIHRoZSBmYWxsYmFjayBsYW5nQ29kZSBpcyBlbXB0eSBvciBub3QgYW5kIGFzc2lnbiBpdC4KCQkJfWVsc2V7CQoJCQkJaWYoeW91dHViZUNDTENNYXAgIT0gbnVsbCAmJiB5b3V0dWJlQ0NMQ01hcCAhPSAiIiAmJiB5b3V0dWJlQ0NMQ01hcCAhPSB1bmRlZmluZWQpewkJLy9jaGVjayBpZiB0aGUgY2NsY01hcCBpcyBhdmFpbGFibGUuCgkJCQkJaWYoIWpzb25WaWRlb0RhdGFDb3VudGVyID4gMCAmJiB0eXBlb2YgeW91dHViZUNDTENNYXAgIT0gIm9iamVjdCIpewkJCS8vdG8gYXZvaWQgbXVsdGlwbGUgcGFyc2luZyBvZiB0aGUganNvbiBvYmplY3QKCQkJCQkJeW91dHViZUNDTENNYXAgPSBKU09OLnBhcnNlKHlvdXR1YmVDQ0xDTWFwKTsJCgkJCQkJfQoJCQkJCWxhbmdDb2RlID0geW91dHViZUNDTENNYXBbZ2V0Q0NMQygiY2MiKSsiLSIrZ2V0Q0NMQygibGMiKV07CgkJCQkJaWYobGFuZ0NvZGUgPT0gdW5kZWZpbmVkKXsKCQkJCQkJbGFuZ0NvZGUgPSBlbjsJCQkvL2RlZmF1bHQgdG8gZW4gaWYgdGhlIGNjbGMgY29tYmluYXRpb24gZG9lcyBub3QgZXhpc3QuCgkJCQkJfQoJCQkJfWVsc2V7CgkJCQkJbGFuZ0NvZGUgPSBlbjsJCQkJLy9kZWZhdWx0IHRvIGVuIGlmIHRoZSBjY2xjbWFwIFNTQyBrZXkgaXMgbm90IGF2YWlsYWJsZS4KCQkJCX0KCgkJCX0KCQkJdmFyIHlvdXR1YmVQbGF5ZXJVUkwgPSAkKCJpZnJhbWUjcGxheWVyIitqKS5hdHRyKCJzcmMiKTsKCQkJeW91dHViZVBsYXllclVSTCA9IHlvdXR1YmVQbGF5ZXJVUkwgKyAnJnJlbD0wJmhsPScrbGFuZ0NvZGU7CgkJCSQoImlmcmFtZSNwbGF5ZXIiK2opLmF0dHIoInNyYyIseW91dHViZVBsYXllclVSTCk7CgkJCX0KCQkJdmlkcy5wdXNoKHBsYXllcik7CgkJCWpzb25WaWRlb0RhdGFDb3VudGVyKys7CgkJfQoJfQoKfSAvL2VuZCBvZiBmdW5jdGlvbgoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcih7CglnZXRIaWRkZW5GaWVsZFZhbHVlczogZnVuY3Rpb24oaGlkZGVuX2ZpZWxkX2lkKXsgICAgICAgIAoJCXJldHVybiAkKCIjIitoaWRkZW5fZmllbGRfaWQpLnZhbCgpOwoJfQp9KTsKCiQoZG9jdW1lbnQpLm9uKCdoaWRkZW4uYnMubW9kYWwnLCAnLm1vZGFsLnNpbmdsZVZpZGVvTW9kYWwnLCBmdW5jdGlvbigpIHsKCS8vIFBhdXNlIHRoZSB2aWRlbyB3aGVuIG1vZGFsIGluIGRvY3VtZW50IHBhZ2UgaXMgY2xvc2VkCgl2YXIgdmlkZW9JZCA9ICQodGhpcykuZmluZCgidmlkZW8iKS5hdHRyKCJpZCIpOwoJaWYodmlkZW9JZCAhPSB1bmRlZmluZWQpewoJCXZpZGVvanModmlkZW9JZCkucGF1c2UoKTsKCX0KCWlmKCQodGhpcykucGFyZW50KCkuZmluZCgiaWZyYW1lIikubGVuZ3RoICE9IDApewkJLy9wYXVzZSB5b3V0dWJlIHZpZGVvIEFMTSMgMjYzNQoJCXZhciBpZnJhbWVJRCA9ICQodGhpcykuZmluZCgiaWZyYW1lIikuYXR0cigiaWQiKTsKCQlmb3IodmFyIGs9MDtrPHZpZHMubGVuZ3RoO2srKyl7CgkJCWlmKHZpZHNba10uZiAhPSB1bmRlZmluZWQgJiYgdmlkc1trXS5mICE9IG51bGwpewoJCQkJaWYgKGlmcmFtZUlEID09IHZpZHNba10uZi5pZCkgIHsgIAoJCQkJCXZpZHNba10ucGF1c2VWaWRlbygpOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJfQoJfQp9KTsKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7dmFyIGdsb2JhbERldmljZU9iamVjdCA9IHt9Owp2YXIgcGVyc29uYWxEZXZpY2VQTlNOQXJyID0gW107Ci8vIChmdW5jdGlvbigpewoKLy8gJCgiI21vZGFsTG9naW5CdG4iKS5vbigiY2xpY2siLCBsb2dpbkNhbGxIcHNhKTsKLy8gLy8gfSkoKTsKaWYodHlwZW9mIHByb2ZpbGVEZXRhaWxzICE9PSAndW5kZWZpbmVkJyAmJiBwcm9maWxlRGV0YWlscyl7CglpZihwcm9maWxlRGV0YWlscy5sb2dnZWRJbiA9PSB0cnVlKXsKCQkKCQkvLyBJZiB0aGUgdXNlciBpcyByZWdpc3RlcmluZyBmcm9tIEVBUyBvciBDb250YWN0IEhQCgkJaWYgKGxvY2FsU3RvcmFnZS5wcm9kdWN0VG9CZUFkZGVkRmxhZykgewoJCQkKCQkJLy8gdHJ5IGFkZGluZyB0aGUgZGV2aWNlIG9ubHkgaWYgdGhlIGRldGFpbHMgYXJlIHZhbGlkCgkJCWlmKGxvY2FsU3RvcmFnZS5zZXJpYWxOdW1iZXIgJiYgbG9jYWxTdG9yYWdlLnByb2R1Y3ROdW1iZXIpewoJCQkJYWRkRGV2aWNlSW5mb1Bvc3RSZWdpc3RyYXRpb24oKTsKCQkJfQoJCQkKCQl9IGVsc2UgewoJCQlmZXRjaEFsbERldmljZXMocHJvZmlsZURldGFpbHMucHJvZmlsZVR5cGUpOwoJCX0KCQkJaWYocHJvZmlsZURldGFpbHMucHJvZmlsZVR5cGUgPT0gIkNPTlNVTUVSIil7CgkJCQlnbG9iYWxEYXRhTGF5ZXIuY3VzdG9tZXJTdGF0ZSA9ICJQZXJzb25hbCI7CgkJCX0KCQkJZWxzZSBpZihwcm9maWxlRGV0YWlscy5wcm9maWxlVHlwZSA9PSAiQ09NTUVSQ0lBTCIpewoJCQkJZ2xvYmFsRGF0YUxheWVyLmN1c3RvbWVyU3RhdGUgPSAiQnVzaW5lc3MiOwoJCQl9CgkJCWVsc2V7CgkJCQlnbG9iYWxEYXRhTGF5ZXIuY3VzdG9tZXJTdGF0ZSA9IHByb2ZpbGVEZXRhaWxzLnByb2ZpbGVUeXBlOwoJCQl9CgkJCWlmKCQoIiNwYWdlSWRlbnRpZmllciIpLnZhbCgpID09ICJDb250YWN0IEhQIC0gQW5vbnltb3VzIil7CgkJCQl2YXIgZXJyb3JDb2RlUHJlc2VudCA9IGZhbHNlOwoJCQkJdmFyIHN0YXR1c0NvZGU7CgkJCQllcnJvckNvZGVQcmVzZW50ID0gKGdsb2JhbERldmljZU9iamVjdC5FcnJvckl0ZW0hPSB1bmRlZmluZWQpPyB0cnVlIDogZmFsc2U7CgkJCQlpZihlcnJvckNvZGVQcmVzZW50KXsKCQkJCQlzdGF0dXNDb2RlID0gZ2xvYmFsRGV2aWNlT2JqZWN0LkVycm9ySXRlbS5zdGF0dXNDb2RlOwoJCQkJCWlmKHN0YXR1c0NvZGUgPT0gJ1NFUlZJQ0VfRVJST1InKXsKCQkJCQkJLy8gZ28gdG8gc3RlcCAyIGRpcmVjdGx5IGluIGNhc2Ugc2VydmljZSBpcyBkb3duCgkJCQkJCXNob3dMb2dnZWRJblZpZXcoKTsKCQkJCQl9CgkJCQkJZWxzZXsKCQkJCQkJJCgnI21hc3RlckRpdicpLnJlbW92ZUNsYXNzKCdoaWRlJyk7CgkJCQkJfQoJCQkJfQoJCQkJLy8gZWxzZXsKCQkJCS8vIAkkKCcjbWFzdGVyRGl2JykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsKCQkJCS8vIH0KCQkJfQoJfQoJZWxzZXsKCQlnbG9iYWxEYXRhTGF5ZXIuY3VzdG9tZXJTdGF0ZSA9ICJBbm9ueW1vdXMiOwoJfQp9CmVsc2V7IC8vbm90IGxvZ2dlZCBpbiB2aWV3CglnbG9iYWxEYXRhTGF5ZXIuY3VzdG9tZXJTdGF0ZSA9ICJBbm9ueW1vdXMiOwogICAgICAgIGlmKCQoIiNwYWdlSWRlbnRpZmllciIpLnZhbCgpID09ICJEYXNoYm9hcmQiKXsKICAgICAgICAgICAgICAgIHBhaW50U2Vzc2lvblRpbWVkT3V0VmlldygpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKCQoIiNwYWdlSWRlbnRpZmllciIpLnZhbCgpID09ICJBZGQgRGV2aWNlIikgewogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAiLyIrZ2V0Q0NMQygiY2MiKSsiLSIrZ2V0Q0NMQygibGMiKSsiL2Rhc2hib2FyZCI7CiAgICAgICAgfQoJCWVsc2UgaWYoJCgiI3BhZ2VJZGVudGlmaWVyIikudmFsKCkgPT0gIkNvbnRhY3QgSFAgLSBBbm9ueW1vdXMiKSB7CgkJCSQoJyNtYXN0ZXJEaXYnKS5yZW1vdmVDbGFzcygnaGlkZScpOwoJCQl2YXIgY3VycmVudFVSTCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwoJCQlpZihjdXJyZW50VVJMLmluZGV4T2YoImNvbnRhY3QtaHAiKT4tMSkgewoJCQkJJCgiLnNpZ24taW4tZ3Vlc3QiKS5yZW1vdmVDbGFzcygiaGlkZSIpOwoJCQl9CiAgICAgICAgfQp9CgpmdW5jdGlvbiBsb2dpbkNhbGxIcHNhKCl7Cgl2YXIgcGF5bG9hZCA9IHsKCQkiS2VlcE1lU2lnbmVkSW4iOiB0cnVlLAoJCSJDcmVkZW50aWFscyI6IHsKCQkJIlVzZXJOYW1lIjogJCgiI21vZGFsTG9naW5UeHQiKS52YWwoKSwKCQkJIlBhc3N3b3JkIjogJCgnI2V4YW1wbGVJbnB1dFBhc3N3b3JkMScpLnZhbCgpLAoJCQkiQ2FsbGVySWQiOiAicG9ydGFsIgoJCX0sCgkJImNjIjogZ2V0Q0NMQygiY2MiKSwKCQkibGMiOiBnZXRDQ0xDKCJsYyIpCgl9OwoJdmFyICRsb2dpbk1vZGFsID0gJCgnI2xvZ2luLW1vZGFsJyk7CgkvL3ZhciAkc2lnbkluUmVnaXN0ZXJMaW5rID0gJCgnLnNpZ25JblJlZ2lzdGVyTGluaycpOwoJLy92YXIgJHdlbGNvbWVVc2VyTGluayA9ICQoJyN3ZWxjb21lVXNlckxpbmsnKTsKCS8vdmFyICR1c2VyTmFtZUhlYWRlciA9ICQoJyN1c2VyTmFtZScpOwoJLy92YXIgJHVzZXJOYW1lQmFubmVyID0gJCgnI3VzZXJOYW1lQmFubmVyJyk7CgkvL3ZhciAkc2lnbkluQmFubmVyID0gJCgnI3NpZ25JbkJhbm5lcicpOwoJLy92YXIgJGxvZ2dlZEluVXNlckJhbm5lciA9ICQoJyNsb2dnZWRJblVzZXJCYW5uZXInKTsKCgkkLmFqYXgoewoJCXR5cGU6ICJQT1NUIiwKCQl1cmw6ICIvaHAtcHBzLXNlcnZpY2VzL2hwc2EvbG9naW4iLAoJCWRhdGE6IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpLAoJCWNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24vanNvbiIsCgkJZGF0YVR5cGU6ICJqc29uIgoJfSkuZG9uZShmdW5jdGlvbiAoZGF0YSkgewoJCWNvbnNvbGUubG9nKCcjIyMgbG9naW4gc3VjY2VzcyAjIyMnLCBkYXRhKTsKCQlpZiAoZGF0YSkgewoJCQlpZiAoZGF0YS5HZXRQcm9maWxlLkN1c3RvbWVyUHJvZmlsZU9iamVjdC5GaXJzdE5hbWUpIHsKCQkJCXZhciBGaXJzdE5hbWUgPSBkYXRhLkdldFByb2ZpbGUuQ3VzdG9tZXJQcm9maWxlT2JqZWN0LkZpcnN0TmFtZTsKCgkJCQkvLyAvLyBUb3AgYmFyIGNoYW5nZXMgYW5kIHNob3dpbmcgZmlyc3QgbmFtZSBhZnRlciBsb2dpbgoJCQkJLy8gJHNpZ25JblJlZ2lzdGVyTGluay5hZGRDbGFzcygnaGlkZScpOwoJCQkJLy8gJHdlbGNvbWVVc2VyTGluay5yZW1vdmVDbGFzcygnaGlkZScpOwoJCQkJLy8gJHVzZXJOYW1lSGVhZGVyLnRleHQoRmlyc3ROYW1lKTsKCgkJCQkvLyAvLyBCYW5uZXIgdGV4dCwgc2V0dGluZyBmaXJzdCBuYW1lIGFuZCBoaWRpbmcgc2lnbiBpbi8gcmVnaXN0ZXIgbGlua3MKCQkJCS8vICRzaWduSW5CYW5uZXIuYWRkQ2xhc3MoJ2hpZGUnKTsKCQkJCS8vICRsb2dnZWRJblVzZXJCYW5uZXIucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsKCQkJCS8vICR1c2VyTmFtZUJhbm5lci50ZXh0KEZpcnN0TmFtZSk7CgoJCQkJLy8gLy9IYW5kbGluZyBIb21lcGFnZSB0YWJzCgkJCQkvLyBpZigkKCIjcGFnZUlkZW50aWZpZXIiKS52YWwoKSA9PSAiU3VwcG9ydCBIb21lIil7CgkJCQkvLyAJbWFuYWdlSG9tZVRhYnNQb3N0TG9naW4oZGF0YSk7CgkJCQkvLyB9CgoJCQkJLy8gLy9oaWRpbmcgd2VsY29tZSBtZXNzYWdlIHNob3dpbmcgZHVwbGljYXRlIGluIGRhc2hib2FyZCBwYWdlLiBUaGlzIGNvZGUgZXhleHV0ZSBhZnRlciB0aGUgc3BsaXRTZWFyY2guanMgc28gcmVtb3ZpbmcgJ2hpZGUnIGNsYXNzCgkJCQkvLyBpZiAoJCgiI3BhZ2VJZGVudGlmaWVyIikudmFsKCkgPT0gIkRhc2hib2FyZCIpIHsKCQkJCS8vIAkkKCcuc2lnbmVkSW5NZXNzYWdlJykuYWRkQ2xhc3MoJ2hpZGUnKTsKCQkJCS8vIH0KCQkJCWZldGNoQWxsRGV2aWNlcyhkYXRhLlByb2ZpbGVUeXBlKTsKCQkJfQoJCX0KCQkkbG9naW5Nb2RhbC5tb2RhbCgnaGlkZScpOwoJfSkuZmFpbChmdW5jdGlvbiAoanFYSFIsIHRleHRTdGF0dXMpIHsKCQljb25zb2xlLmxvZygnIyMjIGxvZ2luIGZhaWxlZCAjIyMnKTsKCQkkbG9naW5Nb2RhbC5tb2RhbCgnaGlkZScpOwoJfSk7Cn0KCmZ1bmN0aW9uIGZldGNoUHJvZHVjdERldGFpbHNHREwocHJvZHVjdE9iaikgewoJdmFyIHRtcFByb2R1Y3RPYmogPXt9OwoKCXRtcFByb2R1Y3RPYmouYXVkaWVuY2VUeXBlID0gcHJvZHVjdE9iai5BdWRpZW5jZVR5cGU7Cgl0bXBQcm9kdWN0T2JqLnByb2R1Y3RMaW5lQ29kZSA9IHByb2R1Y3RPYmouUHJvZHVjdExpbmVDb2RlOwoJdG1wUHJvZHVjdE9iai5wcm9kdWN0TnVtYmVyID0gcHJvZHVjdE9iai5Qcm9kdWN0TnVtYmVyOwoJdG1wUHJvZHVjdE9iai5zZXJpZXNOYW1lID0gcHJvZHVjdE9iai5GdWxsU2VyaWFsTnVtYmVyOyAgLy8gdGhpcyBmaWVsZCBuYW1lIHNheXMgbnVtYmVyIGJ1dCBpdHMgYWN0dWFsbHkgZ2l2aW5nIG5hbWUKCXRtcFByb2R1Y3RPYmoucHJvZHVjdFNlcmllc09JRCA9IHByb2R1Y3RPYmouUHJvZHVjdFNlcmllc09JRDsKCXRtcFByb2R1Y3RPYmouc2VyaWFsTnVtYmVyID0gcHJvZHVjdE9iai5TZXJpYWxOdW1iZXI7CgoJcmV0dXJuIHRtcFByb2R1Y3RPYmo7Cn0KCmZ1bmN0aW9uIGZldGNoQWxsRGV2aWNlcyhwcm9maWxlVHlwZSl7CgkkLmFqYXgoewoJCXR5cGU6ICJHRVQiLAoJCWNhY2hlOiBmYWxzZSwKCQl1cmw6ICIvaHAtcHBzLXNlcnZpY2VzL2hwc2EvZ2V0QWxsRGV2aWNlcz9jYz0iK2dldENDTEMoImNjIikrIiZsYz0iK2dldENDTEMoImxjIiksCgkJY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiwKCQlkYXRhVHlwZTogImpzb24iCgl9KS5kb25lKGZ1bmN0aW9uIChkYXRhKSB7CgkJZ2xvYmFsRGV2aWNlT2JqZWN0ID0gZGF0YTsKCQl2YXIgcmVxQXJyYXlGb3JXQ01Db250ZW50ID0gW107CgkJdmFyIHByb2R1Y3RzID0gW107CgkJdmFyIGVycm9yQ29kZVByZXNlbnQgPSBmYWxzZTsKCQl2YXIgc3RhdHVzQ29kZTsKCQllcnJvckNvZGVQcmVzZW50ID0gKGRhdGEuRXJyb3JJdGVtIT0gdW5kZWZpbmVkKT8gdHJ1ZSA6IGZhbHNlOwoKCQkvL0lmIGVycm9yIGNvZGVzIGFyZSBwcmVzZW50CgkJaWYoZXJyb3JDb2RlUHJlc2VudCl7CgkJCXN0YXR1c0NvZGUgPSBkYXRhLkVycm9ySXRlbS5zdGF0dXNDb2RlOwoJCQlpZihzdGF0dXNDb2RlID09ICdTRVNTSU9OX1RJTUVPVVQnKXsKCQkJCS8vU2VuZCB0aGVtIHRvIHRoZSBzZXNzaW9uIHRpbWVkIG91dCB2aWV3IG9mIGRhc2hib2FyZAoJCQkJaWYoJCgiI3BhZ2VJZGVudGlmaWVyIikudmFsKCkgPT0gIkRhc2hib2FyZCIpewoJCQkJCXBhaW50U2Vzc2lvblRpbWVkT3V0VmlldygpOwoJCQkJfQoJCQkJZWxzZSBpZigoJCgiI3BhZ2VJZGVudGlmaWVyIikudmFsKCkgPT0gIkFkZCBEZXZpY2UiKSB8fCAoJCgiI3BhZ2VJZGVudGlmaWVyIikudmFsKCkgPT0gIlN1cHBvcnQgSG9tZSIpKSB7CgkJCQkJd2luZG93LmxvY2F0aW9uLmhyZWYgPSAiLyIrZ2V0Q0NMQygiY2MiKSsiLSIrZ2V0Q0NMQygibGMiKSsiL2Rhc2hib2FyZCI7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZihzdGF0dXNDb2RlID09ICdTRVJWSUNFX0VSUk9SJyl7CgkJCQlpZigkKCIjcGFnZUlkZW50aWZpZXIiKS52YWwoKSA9PSAiU3VwcG9ydCBIb21lIil7CgkJCQkJLy9UcmlnZ2VyIHRoZSBlcnJvciBldmVudAoJCQkJCSQoZG9jdW1lbnQpLnRyaWdnZXIoInNlcnZpY2VFcnJvciIpOwoJCQkJfQoJCQkJLy9TZW5kIHRoZW0gdG8gdGhlIGVycm9yIHBhZ2UKCQkJCWlmKCQoIiNwYWdlSWRlbnRpZmllciIpLnZhbCgpID09ICJEYXNoYm9hcmQiIHx8ICQoIiNwYWdlSWRlbnRpZmllciIpLnZhbCgpID09ICJBZGQgRGV2aWNlIil7CgkJCQkJd2luZG93LmxvY2F0aW9uLmhyZWYgPSAiLyIgKyBnZXRDQ0xDKCdjYycpICsgJy0nICsgZ2V0Q0NMQygnbGMnKSArICcvZXJyb3I/ZXJyb3JUeXBlPTUwMCZzb3VyY2U9ZmV0Y2hEZXZpY2VzU2VydmljZUVycm9yJzsJCS8vYXBwZW5kaW5nIHRoZSBzb3VyY2UgZm9yIEFMTSAyODY2IDUwMCBlcnJvciBhbmFseXNpcwoJCQkJfQoJCQl9CgkJfQoJCWVsc2V7IC8vIG5vIGVycm9yIGNvZGVzCgkJCWdsb2JhbERhdGFMYXllci5EYXNoYm9hcmQuc2V0VmFsdWUoIk5vT2ZEZXZpY2VzIiwgZGF0YS5EZXZpY2VMaXN0Lmxlbmd0aCk7CgoJCQkvL3NvcnQgdG8ga2VlcCBwcmVmZXJyZWQgZGV2aWNlcyBmaXJzdAoJZGF0YS5EZXZpY2VMaXN0LnNvcnQoZnVuY3Rpb24oeCwgeSkgewogICAgICAgIC8vIHRydWUgdmFsdWVzIGZpcnN0CiAgICAgICAgcmV0dXJuICh4LkRldmljZVByb3BlcnR5LlByZWZlcnJlZCA9PT0geS5EZXZpY2VQcm9wZXJ0eS5QcmVmZXJyZWQpPyAwIDogeC5EZXZpY2VQcm9wZXJ0eS5QcmVmZXJyZWQ/IC0xIDogMTsKICAgIH0pOwoKCQkJZm9yKHZhciBpID0gMDsgaSA8IGRhdGEuRGV2aWNlTGlzdC5sZW5ndGg7IGkrKyl7CgkJCQkvL3Bhc3NpbmcgcHJvZHVjdCBvYmplY3QgdG8gZmV0Y2hQcm9kdWN0RGV0YWlsc0dETCB0byBhZGQgZGV0YWlscyBpbiBHbG9iYWwgRGF0YSBMYXllciBBJlIKCQkJCXByb2R1Y3RzLnB1c2goZmV0Y2hQcm9kdWN0RGV0YWlsc0dETChkYXRhLkRldmljZUxpc3RbaV0uRGV2aWNlUHJvcGVydHkpKTsKCQkJfQoJCQkKCQkJLy8gNzM1ODogQW5yIGZvciBhbGwgcGFnZXMKCQkJZm9yKHZhciBpID0gMDsgaSA8IGRhdGEuRGV2aWNlTGlzdC5sZW5ndGg7IGkrKyl7CgkJCQl2YXIgdGVtcE9iaiA9IHt9OwoJCQkJdGVtcE9iai5zZW9Qcm9kdWN0TmFtZSA9IGRhdGEuRGV2aWNlTGlzdFtpXS5EZXZpY2VQcm9wZXJ0eS5zZW9fZnJpZW5kbHlfbmFtZTsKCQkJCXRlbXBPYmouc2VyaWVzSWQgPSBkYXRhLkRldmljZUxpc3RbaV0uRGV2aWNlUHJvcGVydHkuUHJvZHVjdFNlcmllc09JRDsKCQkJCXRlbXBPYmoubW9kZWxJZCA9IGRhdGEuRGV2aWNlTGlzdFtpXS5EZXZpY2VQcm9wZXJ0eS5Qcm9kdWN0TmFtZU9JRDsKCQkJCXRlbXBPYmouc2t1ID0gZGF0YS5EZXZpY2VMaXN0W2ldLkRldmljZVByb3BlcnR5LlByb2R1Y3ROdW1iZXI7CgkJCQl0ZW1wT2JqLnByb2R1Y3RMaW5lID0gZGF0YS5EZXZpY2VMaXN0W2ldLkRldmljZVByb3BlcnR5LlByb2R1Y3RMaW5lQ29kZTsKCQkJCXRlbXBPYmouc2VyaWFsTnVtYmVyID0gZGF0YS5EZXZpY2VMaXN0W2ldLkRldmljZVByb3BlcnR5LlNlcmlhbE51bWJlcjsKCQkJCXJlcUFycmF5Rm9yV0NNQ29udGVudC5wdXNoKHRlbXBPYmopOwoJCQl9CgkJCQoJCQkvL3NldHRpbmdzIGFsbCBwcm9kdWN0cyBpbiBHbG9iYWwgRGF0YSBMYXllcgoJCQlnbG9iYWxEYXRhTGF5ZXIuRGFzaGJvYXJkLnNldFZhbHVlKCJQcm9kdWN0cyIsIHByb2R1Y3RzKTsKCQkJaWYoJCgiI3BhZ2VJZGVudGlmaWVyIikudmFsKCkgPT0gIkRhc2hib2FyZCIpewoJCQkJCgkJCQlwYWludERldmljZVZpZXcoZGF0YSk7CgoJCQkKCQkJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCJUZW1wbGF0ZSIsICJEYXNoYm9hcmQiKTsKCgkJCQkvL0NhbGwgdG8gZmV0Y2ggV0NNIERhdGEgZm9yIHByb2R1Y3RzCgkJCQlpZihkYXRhLkRldmljZUxpc3QubGVuZ3RoID4gMCAmJiByZXFBcnJheUZvcldDTUNvbnRlbnQubGVuZ3RoID4gMCl7CgkJCQkJZm9yKHZhciBsPTA7IGwgPCBkYXRhLkRldmljZUxpc3QubGVuZ3RoOyBsKyspewoJCQkJCQlwZXJzb25hbERldmljZVBOU05BcnJbbF0gPSBkYXRhLkRldmljZUxpc3RbbF0uRGV2aWNlUHJvcGVydHkuUHJvZHVjdE51bWJlcitkYXRhLkRldmljZUxpc3RbbF0uRGV2aWNlUHJvcGVydHkuU2VyaWFsTnVtYmVyOwoJCQkJCX0KCQkJCQlmZXRjaERldmljZVdDTURhdGEocmVxQXJyYXlGb3JXQ01Db250ZW50KTsKCQkJCX0KCQkJfQoJCQkkKGRvY3VtZW50KS50cmlnZ2VyKCJkZXZpY2VzRmV0Y2hlZCIpOyAgLy9DdXN0b20gRXZlbnQgdHJpZ2dlciB0aGF0IGlzIGJlaW5nIGxpc3RlbmQgdG8sIGluIGdldFdDTVRhYnNBamF4LmpzIG9ubHkgd2hlbiBnbG9iYWxEZXZpY2VPYmplY3QgaXMgZW1wdHkvdW5kZWZpbmVkCgkJfQoKCQkvLyBpZigkKCIjcGFnZUlkZW50aWZpZXIiKS52YWwoKSA9PSAiU3VwcG9ydCBIb21lIil7CgkJCS8vIGlmKCQoIi5teURldmljZXNEZXNrdG9wQ29udGVudCIpLmxlbmd0aCA+IDAgKXsKCQkJLy8gCS8vJiYgJCgiLm15RGV2aWNlc0Rlc2t0b3BDb250ZW50IikuaHRtbCgpID09ICIiCgkJCS8vIAlwYWludERldmljZVZpZXdIb21lKGRhdGEsIHByb2ZpbGVUeXBlKTsKCQkJLy8gfQoJCQkvLyBlbHNlewoKCQkJLy8gfQoKCQkvLyB9CgkJaWYoJCgiI3BhZ2VJZGVudGlmaWVyIikudmFsKCkgPT0gIlNXRFNlbGZTZXJ2aWNlIiB8fCAkKCIjcGFnZUlkZW50aWZpZXIiKS52YWwoKSA9PSAiUHJvZHVjdCBIb21lIiB8fCAkKCIjcGFnZUlkZW50aWZpZXIiKS52YWwoKSA9PSAiQ29udGFjdCBIUCAtIEFub255bW91cyIpewoJCQlwYWludERldmljZVZpZXdMYW5kaW5nUGFnZXMoZGF0YSk7CgkJfQoJfSkuZmFpbChmdW5jdGlvbiAoanFYSFIsIHRleHRTdGF0dXMpIHsKCQljb25zb2xlLmxvZygnIyMjIGZldGNoIERldmljZXMgZmFpbGVkICMjIycpOwoJCS8vICRsb2dpbk1vZGFsLm1vZGFsKCdoaWRlJyk7Cgl9KTsKfQoKZnVuY3Rpb24gZmV0Y2hEZXZpY2VXQ01EYXRhKHJlcUFycil7CgkkLmFqYXgoewoJCXR5cGU6ICJQT1NUIiwKCQl1cmw6ICIvaHAtcHBzLXNlcnZpY2VzL3dlYmNvbnRlbnQvZ2V0RGFzaGJvYXJkUHJvZHVjdFRpbGVJY29ucy9jYy8iK2dldENDTEMoImNjIikrIi9sYy8iK2dldENDTEMoImxjIiksCgkJY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiwKCQlkYXRhOiBKU09OLnN0cmluZ2lmeShyZXFBcnIpLAoJCWRhdGFUeXBlOiAianNvbiIKCX0pLmRvbmUoZnVuY3Rpb24gKGRhdGEpIHsKCQlmb3IodmFyIGVudHJ5IGluIGRhdGEpewoJCQl2YXIgY2FyZFBvc2l0aW9uID0gcGVyc29uYWxEZXZpY2VQTlNOQXJyLmluZGV4T2YoZW50cnkpOwoJCQl2YXIgcGFpbnRpbmdPYmogPSB7fTsKCQkJcGFpbnRpbmdPYmpbImNhcmRQb3NpdGlvbiJdID0gY2FyZFBvc2l0aW9uOwoJCQlwYWludGluZ09ialsiY29udGVudEFyciJdID0gZGF0YVtlbnRyeV07CgkJCXZhciBzb3VyY2UgPSAkKCIjZGV2aWNlU3BlY2lmaWNXQ01Db250ZW50VGVtcGxhdGUiKS5odG1sKCk7CgkJICAgIHZhciB0ZW1wbGF0ZSA9IEhhbmRsZWJhcnMuY29tcGlsZShzb3VyY2UpOwoJCSAgICAvLyAkKCcucmVsYXRlZFdjbUNvbnRlbnQtJytlbnRyeSkuaHRtbCh0ZW1wbGF0ZShkYXRhW2VudHJ5XSkpOwoJCSAgICAkKCcucmVsYXRlZFdjbUNvbnRlbnQtJytlbnRyeSkuaHRtbCh0ZW1wbGF0ZShwYWludGluZ09iaikpOwoJCX0KCX0pLmZhaWwoZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzKSB7CgkJY29uc29sZS5sb2coJyMjIyBmZXRjaCBXQ00gRGF0YSBmb3IgRGV2aWNlcyBmYWlsZWQgIyMjJyk7CgkJLy8gJGxvZ2luTW9kYWwubW9kYWwoJ2hpZGUnKTsKCX0pOwp9CgpmdW5jdGlvbiBnZXRDbGllbnREYXRlKGRhdGVGb3JtYXQpewoJLy9kYXRlRm9ybWF0IHBhc3NlZCBpbiBwYXJhbWV0ZXJzIHNob3VsZCBiZSBhIHN0cmluZwoKCXZhciBkYXRlVG9kYXkgPSBuZXcgRGF0ZSgpOwoJc3dpdGNoKGRhdGVGb3JtYXQpewoJCWNhc2UgIm1tLWRkLXl5eXkiIDogewoJCQl2YXIgZm9ybWF0dGVkRGF0ZTsKCQkJaWYoZGF0ZVRvZGF5LmdldE1vbnRoKCkgPCA5KXsKCQkJCWZvcm1hdHRlZERhdGUgPSAiMCIrKGRhdGVUb2RheS5nZXRNb250aCgpICsgMSk7CgkJCX0KCQkJZWxzZXsKCQkJCWZvcm1hdHRlZERhdGUgPSBkYXRlVG9kYXkuZ2V0TW9udGgoKSArIDE7CgkJCX0KCgkJCWlmKGRhdGVUb2RheS5nZXREYXRlKCkgPCAxMCl7CgkJCQlmb3JtYXR0ZWREYXRlVG9kYXkgPSAiMCIrKGRhdGVUb2RheS5nZXREYXRlKCkpOwoJCQl9CgkJCWVsc2V7CgkJCQlmb3JtYXR0ZWREYXRlVG9kYXkgPSBkYXRlVG9kYXkuZ2V0RGF0ZSgpOwoJCQl9CgoJCQlmb3JtYXR0ZWREYXRlID0gZm9ybWF0dGVkRGF0ZSArIi0iK2Zvcm1hdHRlZERhdGVUb2RheSsiLSIrZGF0ZVRvZGF5LmdldEZ1bGxZZWFyKCk7CgkJCXJldHVybiBmb3JtYXR0ZWREYXRlOwoJCX07CgkJYnJlYWs7CgkJY2FzZSAibW0vZGQveXl5eSIgOiB7CgkJCXZhciBmb3JtYXR0ZWREYXRlOwoJCQlpZihkYXRlVG9kYXkuZ2V0TW9udGgoKSA8IDkpewoJCQkJZm9ybWF0dGVkRGF0ZSA9ICIwIisoZGF0ZVRvZGF5LmdldE1vbnRoKCkgKyAxKTsKCQkJfQoJCQllbHNlewoJCQkJZm9ybWF0dGVkRGF0ZSA9IGRhdGVUb2RheS5nZXRNb250aCgpICsgMTsKCQkJfQoKCQkJaWYoZGF0ZVRvZGF5LmdldERhdGUoKSA8IDEwKXsKCQkJCWZvcm1hdHRlZERhdGVUb2RheSA9ICIwIisoZGF0ZVRvZGF5LmdldERhdGUoKSk7CgkJCX0KCQkJZWxzZXsKCQkJCWZvcm1hdHRlZERhdGVUb2RheSA9IGRhdGVUb2RheS5nZXREYXRlKCk7CgkJCX0KCgkJCWZvcm1hdHRlZERhdGUgPSBmb3JtYXR0ZWREYXRlICsiLyIrZm9ybWF0dGVkRGF0ZVRvZGF5KyIvIitkYXRlVG9kYXkuZ2V0RnVsbFllYXIoKTsKCQkJcmV0dXJuIGZvcm1hdHRlZERhdGU7CgkJfTsKCQlicmVhazsKCQljYXNlICJkZC1tbS15eXl5IiA6IHsKCQkJdmFyIGZvcm1hdHRlZERhdGU7CgkJCWlmKGRhdGVUb2RheS5nZXREYXRlKCkgPCAxMCl7CgkJCQlmb3JtYXR0ZWREYXRlVG9kYXkgPSAiMCIrKGRhdGVUb2RheS5nZXREYXRlKCkpOwoJCQl9CgkJCWVsc2V7CgkJCQlmb3JtYXR0ZWREYXRlVG9kYXkgPSBkYXRlVG9kYXkuZ2V0RGF0ZSgpOwoJCQl9CgkJCWZvcm1hdHRlZERhdGUgPSBmb3JtYXR0ZWREYXRlVG9kYXkrIi0iOwoJCQlpZihkYXRlVG9kYXkuZ2V0TW9udGgoKSA8IDkpewoJCQkJZm9ybWF0dGVkRGF0ZSA9IGZvcm1hdHRlZERhdGUrIjAiKyhkYXRlVG9kYXkuZ2V0TW9udGgoKSArIDEpOwoJCQl9CgkJCWVsc2V7CgkJCQlmb3JtYXR0ZWREYXRlID0gZm9ybWF0dGVkRGF0ZSsoZGF0ZVRvZGF5LmdldE1vbnRoKCkgKyAxKTsKCQkJfQoJCQlmb3JtYXR0ZWREYXRlID0gZm9ybWF0dGVkRGF0ZSsiLSIrZGF0ZVRvZGF5LmdldEZ1bGxZZWFyKCk7CgkJCXJldHVybiBmb3JtYXR0ZWREYXRlOwoJCX07CgkJYnJlYWs7CgkJY2FzZSAiZGQvbW0veXl5eSIgOiB7CgkJCXZhciBmb3JtYXR0ZWREYXRlOwoJCQlpZihkYXRlVG9kYXkuZ2V0RGF0ZSgpIDwgMTApewoJCQkJZm9ybWF0dGVkRGF0ZVRvZGF5ID0gIjAiKyhkYXRlVG9kYXkuZ2V0RGF0ZSgpKTsKCQkJfQoJCQllbHNlewoJCQkJZm9ybWF0dGVkRGF0ZVRvZGF5ID0gZGF0ZVRvZGF5LmdldERhdGUoKTsKCQkJfQoJCQlmb3JtYXR0ZWREYXRlID0gZm9ybWF0dGVkRGF0ZVRvZGF5KyIvIjsKCQkJaWYoZGF0ZVRvZGF5LmdldE1vbnRoKCkgPCA5KXsKCQkJCWZvcm1hdHRlZERhdGUgPSBmb3JtYXR0ZWREYXRlKyIwIisoZGF0ZVRvZGF5LmdldE1vbnRoKCkgKyAxKTsKCQkJfQoJCQllbHNlewoJCQkJZm9ybWF0dGVkRGF0ZSA9IGZvcm1hdHRlZERhdGUrKGRhdGVUb2RheS5nZXRNb250aCgpICsgMSk7CgkJCX0KCQkJZm9ybWF0dGVkRGF0ZSA9IGZvcm1hdHRlZERhdGUrIi8iK2RhdGVUb2RheS5nZXRGdWxsWWVhcigpOwoJCQlyZXR1cm4gZm9ybWF0dGVkRGF0ZTsKCQl9OwoJCWJyZWFrOwoJCWNhc2UgInl5eXktbW0tZGQiIDogewoJCQl2YXIgZm9ybWF0dGVkRGF0ZTsKCQkJZm9ybWF0dGVkRGF0ZSA9IGRhdGVUb2RheS5nZXRGdWxsWWVhcigpKyItIjsKCQkJaWYoZGF0ZVRvZGF5LmdldE1vbnRoKCkgPCA5KXsKCQkJCWZvcm1hdHRlZERhdGUgPSBmb3JtYXR0ZWREYXRlKyIwIisoZGF0ZVRvZGF5LmdldE1vbnRoKCkgKyAxKTsKCQkJfQoJCQllbHNlewoJCQkJZm9ybWF0dGVkRGF0ZSA9IGZvcm1hdHRlZERhdGUrKGRhdGVUb2RheS5nZXRNb250aCgpICsgMSk7CgkJCX0KCgkJCWlmKGRhdGVUb2RheS5nZXREYXRlKCkgPCAxMCl7CgkJCQlmb3JtYXR0ZWREYXRlVG9kYXkgPSAiMCIrKGRhdGVUb2RheS5nZXREYXRlKCkpOwoJCQl9CgkJCWVsc2V7CgkJCQlmb3JtYXR0ZWREYXRlVG9kYXkgPSBkYXRlVG9kYXkuZ2V0RGF0ZSgpOwoJCQl9CgoJCQlmb3JtYXR0ZWREYXRlID0gZm9ybWF0dGVkRGF0ZSsiLSIrZm9ybWF0dGVkRGF0ZVRvZGF5OwoJCQlyZXR1cm4gZm9ybWF0dGVkRGF0ZTsKCQl9OwoJCWJyZWFrOwoJCWNhc2UgInl5eXkvbW0vZGQiIDogewoJCQl2YXIgZm9ybWF0dGVkRGF0ZTsKCQkJZm9ybWF0dGVkRGF0ZSA9IGRhdGVUb2RheS5nZXRGdWxsWWVhcigpKyIvIjsKCQkJaWYoZGF0ZVRvZGF5LmdldE1vbnRoKCkgPCA5KXsKCQkJCWZvcm1hdHRlZERhdGUgPSBmb3JtYXR0ZWREYXRlKyIwIisoZGF0ZVRvZGF5LmdldE1vbnRoKCkgKyAxKTsKCQkJfQoJCQllbHNlewoJCQkJZm9ybWF0dGVkRGF0ZSA9IGZvcm1hdHRlZERhdGUrKGRhdGVUb2RheS5nZXRNb250aCgpICsgMSk7CgkJCX0KCgkJCWlmKGRhdGVUb2RheS5nZXREYXRlKCkgPCAxMCl7CgkJCQlmb3JtYXR0ZWREYXRlVG9kYXkgPSAiMCIrKGRhdGVUb2RheS5nZXREYXRlKCkpOwoJCQl9CgkJCWVsc2V7CgkJCQlmb3JtYXR0ZWREYXRlVG9kYXkgPSBkYXRlVG9kYXkuZ2V0RGF0ZSgpOwoJCQl9CgoJCQlmb3JtYXR0ZWREYXRlID0gZm9ybWF0dGVkRGF0ZSsiLyIrZm9ybWF0dGVkRGF0ZVRvZGF5OwoJCQlyZXR1cm4gZm9ybWF0dGVkRGF0ZTsKCQl9OwoJCWJyZWFrOwoJCWNhc2UgInl5eXktZGQtbW0iIDogewoJCQl2YXIgZm9ybWF0dGVkRGF0ZTsKCQkJZm9ybWF0dGVkRGF0ZSA9IGRhdGVUb2RheS5nZXRGdWxsWWVhcigpKyItIjsKCgkJCWlmKGRhdGVUb2RheS5nZXREYXRlKCkgPCAxMCl7CgkJCQlmb3JtYXR0ZWREYXRlVG9kYXkgPSAiMCIrKGRhdGVUb2RheS5nZXREYXRlKCkpOwoJCQl9CgkJCWVsc2V7CgkJCQlmb3JtYXR0ZWREYXRlVG9kYXkgPSBkYXRlVG9kYXkuZ2V0RGF0ZSgpOwoJCQl9CgoJCQlmb3JtYXR0ZWREYXRlID0gZm9ybWF0dGVkRGF0ZStmb3JtYXR0ZWREYXRlVG9kYXkrIi0iOwoJCQlpZihkYXRlVG9kYXkuZ2V0TW9udGgoKSA8IDkpewoJCQkJZm9ybWF0dGVkRGF0ZSA9IGZvcm1hdHRlZERhdGUrIjAiKyhkYXRlVG9kYXkuZ2V0TW9udGgoKSArIDEpOwoJCQl9CgkJCWVsc2V7CgkJCQlmb3JtYXR0ZWREYXRlID0gZm9ybWF0dGVkRGF0ZSsoZGF0ZVRvZGF5LmdldE1vbnRoKCkgKyAxKTsKCQkJfQoJCQlyZXR1cm4gZm9ybWF0dGVkRGF0ZTsKCQl9OwoJCWJyZWFrOwoJCWNhc2UgInl5eXkvZGQvbW0iIDogewoJCQl2YXIgZm9ybWF0dGVkRGF0ZTsKCQkJZm9ybWF0dGVkRGF0ZSA9IGRhdGVUb2RheS5nZXRGdWxsWWVhcigpKyIvIjsKCgkJCWlmKGRhdGVUb2RheS5nZXREYXRlKCkgPCAxMCl7CgkJCQlmb3JtYXR0ZWREYXRlVG9kYXkgPSAiMCIrKGRhdGVUb2RheS5nZXREYXRlKCkpOwoJCQl9CgkJCWVsc2V7CgkJCQlmb3JtYXR0ZWREYXRlVG9kYXkgPSBkYXRlVG9kYXkuZ2V0RGF0ZSgpOwoJCQl9CgoJCQlmb3JtYXR0ZWREYXRlID0gZm9ybWF0dGVkRGF0ZStmb3JtYXR0ZWREYXRlVG9kYXkrIi8iOwoJCQlpZihkYXRlVG9kYXkuZ2V0TW9udGgoKSA8IDkpewoJCQkJZm9ybWF0dGVkRGF0ZSA9IGZvcm1hdHRlZERhdGUrIjAiKyhkYXRlVG9kYXkuZ2V0TW9udGgoKSArIDEpOwoJCQl9CgkJCWVsc2V7CgkJCQlmb3JtYXR0ZWREYXRlID0gZm9ybWF0dGVkRGF0ZSsoZGF0ZVRvZGF5LmdldE1vbnRoKCkgKyAxKTsKCQkJfQoJCQlyZXR1cm4gZm9ybWF0dGVkRGF0ZTsKCQl9OwoJCWJyZWFrOwoJCWNhc2UgIm1tbSBkZCwgeXl5eSI6ewoJCQl2YXIgbW9udGhBcnIgPSBbIkphbiIsICJGZWIiLCAiTWFyIiwgIkFwciIsICJNYXkiLCAiSnVuIiwgIkp1bCIsICJBdWciLCAiU2VwIiwgIk9jdCIsICJOb3YiLCAiRGVjIl07CgkJCXZhciBkZCA9IGRhdGVUb2RheS5nZXREYXRlKCk7CgkJCWlmKGRkIDwgMTApewoJCQkJZGQgPSAiMCIrZGQ7CgkJCX0KCQkJdmFyIG1tbSA9IG1vbnRoQXJyW2RhdGVUb2RheS5nZXRNb250aCgpXTsKCQkJdmFyIHl5eXkgPSBkYXRlVG9kYXkuZ2V0RnVsbFllYXIoKTsKCgkJCXZhciBmb3JtYXR0ZWREYXRlID0gbW1tKyIgIitkZCsiLCAiK3l5eXk7CgkJCXJldHVybiBmb3JtYXR0ZWREYXRlOwoJCX0KCQlicmVhazsKCQlkZWZhdWx0OiB7CgkJCXJldHVybiBkYXRlVG9kYXk7IC8vRXhhbXBsZSBUdWUgU2VwIDEyIDIwMTcgMTQ6MTA6MDMgR01UKzA1MzAgKElTVCkKCQl9Cgl9Cn0KCmZ1bmN0aW9uIGNoZWNrQW5kQWRkRGV2aWNlKGFkZEJ0blJlZil7Cgl2YXIgc2VyaWFsTm8gPSAkKGFkZEJ0blJlZikuZGF0YSgic25vIik7Cgl2YXIgcHJvZE5vID0gJChhZGRCdG5SZWYpLmRhdGEoInByb2RubyIpOwoJdmFyIHdhcnJhbnR5RGF0ZSA9ICQoYWRkQnRuUmVmKS5kYXRhKCJ3YXJyYW50eWRhdGUiKTsKCS8vIGlmKCFpc1Byb2R1Y3RBZGRlZChzZXJpYWxObykpewoJCXZhciByZXFQYXlsb2FkID0ge307CgkJcmVxUGF5bG9hZC5zZXJpYWxOdW1iZXIgPSBzZXJpYWxObzsKCQlyZXFQYXlsb2FkLnByb2R1Y3ROdW1iZXIgPSBwcm9kTm87CgkJcmVxUGF5bG9hZC53YXJyYW50eURhdGUgPSB3YXJyYW50eURhdGU7CgkJYWRkRGV2aWNlKHJlcVBheWxvYWQsIGFkZERldmljZVN1Y2Nlc3MsIGFkZERldmljZUZhaWwpCgkvLyB9Cn0KCi8vQ2hlY2tzIGlmIHByb2R1Y3QgaXMgYWxyZWFkeSBhZGRlZCBjb21wYXJlcyBkYXRhIHdpdGggZ2xvYmFsRGV2aWNlIE9iamVjdApmdW5jdGlvbiBpc1Byb2R1Y3RBZGRlZChzZXJpYWxObyl7Cgl2YXIgZGV2aWNlRm91bmQgPSBmYWxzZTsKCWlmKCEkLmlzRW1wdHlPYmplY3QoZ2xvYmFsRGV2aWNlT2JqZWN0KSl7CgkJZm9yKHZhciBlbnRyeSBpbiBnbG9iYWxEZXZpY2VPYmplY3QuRGV2aWNlTGlzdCl7CgkJCWlmKGdsb2JhbERldmljZU9iamVjdC5EZXZpY2VMaXN0W2VudHJ5XS5EZXZpY2VQcm9wZXJ0eS5TZXJpYWxOdW1iZXIgPT0gc2VyaWFsTm8udG9VcHBlckNhc2UoKSl7CgkJCQlkZXZpY2VGb3VuZCA9IHRydWU7CS8vU2VyaWFsIG51bWJlciBwcmVzZW50CgkJCQlicmVhazsKCQkJfQoJCX0KCQlpZighZGV2aWNlRm91bmQpewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCWVsc2V7CgkJCXJldHVybiB0cnVlOwoJCX0KCX0KfQoKCmZ1bmN0aW9uIGFkZERldmljZUluZm9Qb3N0UmVnaXN0cmF0aW9uKCl7Cgl2YXIgc2VyaWFsTnVtYmVyID0gbG9jYWxTdG9yYWdlLnNlcmlhbE51bWJlcjsKCXZhciBwcm9kdWN0TnVtYmVyID0gbG9jYWxTdG9yYWdlLnByb2R1Y3ROdW1iZXI7Cgl2YXIgcHJvZHVjdFRvQmVBZGRlZEZsYWcgPSBsb2NhbFN0b3JhZ2UucHJvZHVjdFRvQmVBZGRlZEZsYWc7CgkKCXZhciByZXF1ZXN0SlNPTiA9IHt9OwoJcmVxdWVzdEpTT04uc2VyaWFsTnVtYmVyID0gc2VyaWFsTnVtYmVyOwoJcmVxdWVzdEpTT04ucHJvZHVjdE51bWJlciA9IHByb2R1Y3ROdW1iZXI7CglyZXF1ZXN0SlNPTi5wdXJjaGFzZURhdGUgPSAJIjE5ODAtMDEtMDEiOwoJY29uc29sZS5sb2coImFkZERldmljZUluZm9Qb3N0UmVnaXN0cmF0aW9uIC0+ICIrcHJvZHVjdFRvQmVBZGRlZEZsYWcpOwoJYWRkRGV2aWNlKHJlcXVlc3RKU09OLCBhZGREZXZpY2VTdWNjZXNzUG9zdFJlZ2lzdHJhdGlvbiwgYWRkRGV2aWNlRmFpbFBvc3RSZWdpc3RyYXRpb24pOwp9CgoKLy9BZGQgRGV2aWNlIHN1Y2Nlc3MgY2FsbCBzY2VuYXJpbwpmdW5jdGlvbiBhZGREZXZpY2VTdWNjZXNzUG9zdFJlZ2lzdHJhdGlvbigpewoJY29uc29sZS5sb2coIkVycm9yIGluIGFkZCBkZXZpY2UgY2FsbCBwb3N0IHJlZ2lzdHJhdGlvbiIpOwoJY2xlYXJMb2NhbFN0b3JhZ2VQb3N0UmVnaXN0cmF0aW9uKCk7Cn0KCi8vQWRkIERldmljZSBmYWlsdXJlIGNhbGwgc2NlbmFyaW8KZnVuY3Rpb24gYWRkRGV2aWNlRmFpbFBvc3RSZWdpc3RyYXRpb24oKXsKCWNvbnNvbGUubG9nKCJFcnJvciBpbiBhZGQgZGV2aWNlIGNhbGwgcG9zdCByZWdpc3RyYXRpb24iKTsKCWNsZWFyTG9jYWxTdG9yYWdlUG9zdFJlZ2lzdHJhdGlvbigpOwp9CgpmdW5jdGlvbiBjbGVhckxvY2FsU3RvcmFnZVBvc3RSZWdpc3RyYXRpb24oKXsKCWxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJzZXJpYWxOdW1iZXIiKTsKCWxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJwcm9kdWN0TnVtYmVyIik7Cglsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgicHJvZHVjdFRvQmVBZGRlZEZsYWciKTsKCWZldGNoQWxsRGV2aWNlcyhwcm9maWxlRGV0YWlscy5wcm9maWxlVHlwZSk7Cn0KCmZ1bmN0aW9uIGFkZERldmljZShhZGREZXZpY2VSZXFQYXlsb2FkLCBjdXN0b21TdWNjZXNzQ2FsbGJhY2ssIGN1c3RvbUZhaWxDYWxsYmFjayl7CgkvL2FkZERldmljZVJlcVBheWxvYWQgLSBPYmplY3QgaGF2aW5nIDIga2V5cyBhbmQgdGhlaXIgdmFsdWVzIC0gc2VyaWFsTnVtYmVyICYgcHJvZHVjdE51bWJlcgoJLy9jdXN0b21TdWNjZXNzQ2FsbGJhY2sgLSBwYXNzIHRoZSBmdW5jdGlvbiBuYW1lIHlvdSB3YW50IHRvIGNhbGwgb24gYWRkIGRldmljZSBzdWNjZXNzCgkvL2N1c3RvbUZhaWxDYWxsYmFjayAtIHBhc3MgdGhlIGZ1bmN0aW9uIG5hbWUgeW91IHdhbnQgdG8gY2FsbCBvbiBhZGQgZGV2aWNlIGZhaWwKCQoJLy9hZGRpbmcgdGhlIHNzaWQgbG9naWMgYXMgcGFydCBvZiBDUyBmb3IgMjAuNAoJIHZhciBzZWN1cmVUb2tlblZhbCA9ICQoJyNzZWN1cmVUb2tlbkZpZWxkJykudmFsKCk7IC8vcmV0cmlldmUgc3RyaW5nIGluIHdoaWNoIGtleSBpcyBzdG9yZWQKCSB2YXIgc3NpZFZhbHVlID0gIiI7CgkgdmFyIHRva2VuSWQgPSAiaHBzYXNpZCI7CS8vIGhhcmRjb2RpbmcgdGhlIHRva2VuIGFzIHdlIGNhbm5vdCBoYXZlIDIgdG9rZW4gdmFsdWVzIGZvciB0aGUgc2FtZSBidXR0b24KCSBpZihzZWN1cmVUb2tlblZhbC5pbmRleE9mKHRva2VuSWQpIT0tMSl7ICAvL2NoZWNrIGlmIHRoZSB0b2tlbiBrZXkgaXMgcHJlc2VudCBpbiB0aGUgc3RyaW5nIG9mIHRva2VucwoJCQlzc2lkVmFsdWUgPSBKU09OLnBhcnNlKCQoIiNzZWN1cmVGaWVsZEpzb24iKS52YWwoKSk7CQkKCSB9Cgl2YXIgcmVxdWVzdEpTT04gPSB7fTsKCXJlcXVlc3RKU09OLnNlcmlhbE51bWJlciA9IGFkZERldmljZVJlcVBheWxvYWQuc2VyaWFsTnVtYmVyOwoJcmVxdWVzdEpTT04ucHJvZHVjdE51bWJlciA9IGFkZERldmljZVJlcVBheWxvYWQucHJvZHVjdE51bWJlcjsKCXJlcXVlc3RKU09OLnB1cmNoYXNlRGF0ZSA9IGFkZERldmljZVJlcVBheWxvYWQud2FycmFudHlEYXRlOwoJcmVxdWVzdEpTT04uZW50aXRsZW1lbnRMYXN0Q2hlY2sgPSBnZXRDbGllbnREYXRlKCJ5eXl5LW1tLWRkIik7CglyZXF1ZXN0SlNPTi5jYyA9IGdldENDTEMoImNjIik7CglyZXF1ZXN0SlNPTi5sYyA9IGdldENDTEMoImxjIik7CgkkLmFqYXgoewoJCXR5cGU6ICJQT1NUIiwKCQl1cmw6ICIvaHAtcHBzLXNlcnZpY2VzL2hwc2EvYWRkRGV2aWNlP3NzaWQ9Iitzc2lkVmFsdWVbdG9rZW5JZF0sCgkJZGF0YSA6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RKU09OKSwKCQlkYXRhVHlwZTogImpzb24iLAoJCWJlZm9yZVNlbmQ6IGZ1bmN0aW9uKHhocikgeyAgICAgICAgICAgIAogICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICB9Cgl9KS5kb25lKGZ1bmN0aW9uIChkYXRhKSB7CgkJCXBvcHVsYXRlU1NJRCgpOwoJCQl2YXIgZXJyb3JDb2RlUHJlc2VudCA9IGZhbHNlOwoJCQl2YXIgc3RhdHVzQ29kZTsKCQkJZXJyb3JDb2RlUHJlc2VudCA9IChkYXRhLkVycm9ySXRlbSE9IHVuZGVmaW5lZCk/IHRydWUgOiBmYWxzZTsKCQkJLy9JZiBlcnJvciBjb2RlcyBhcmUgcHJlc2VudAoJCQlpZihlcnJvckNvZGVQcmVzZW50KXsKCQkJCXN0YXR1c0NvZGUgPSBkYXRhLkVycm9ySXRlbS5zdGF0dXNDb2RlOwoJCQkJaWYoc3RhdHVzQ29kZSA9PSAnU0VTU0lPTl9USU1FT1VUJyl7CgkJCQkJLy9TZW5kIHRoZW0gdG8gdGhlIHNlc3Npb24gdGltZWQgb3V0IHZpZXcgb2YgZGFzaGJvYXJkCgkJCQkJaWYoJCgiI3BhZ2VJZGVudGlmaWVyIikudmFsKCkgPT0gIkRhc2hib2FyZCIpewoJCQkJCQlwYWludFNlc3Npb25UaW1lZE91dFZpZXcoKTsKCQkJCQl9CgkJCQkJZWxzZXsKCQkJCQkJd2luZG93LmxvY2F0aW9uLmhyZWYgPSAiLyIrZ2V0Q0NMQygiY2MiKSsiLSIrZ2V0Q0NMQygibGMiKSsiL2Rhc2hib2FyZCI7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZSBpZihzdGF0dXNDb2RlID09ICdTRVJWSUNFX0VSUk9SJyl7CgkJCQkJY29uc29sZS5sb2coIkVycm9yIGluIGFkZCBkZXZpY2UgY2FsbCIpOwoJCQkJCSB2YXIgZXJyb3JEYXRhID0gewoJCQkJCQkicmVxdWVzdFVybCIgOiAiL2hwLXBwcy1zZXJ2aWNlcy9ocHNhL2FkZERldmljZT9zc2lkPSIrc3NpZFZhbHVlW3Rva2VuSWRdLAoJCQkJCQkiZGF0YSIgOiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0SlNPTiksCgkJCQkJCSJlcnJvclJlYXNvbiIgOiAic3RhdHVzIGNvZGUgaXMgc2VydmljZSBlcnJvciIKCQkJCQl9OwoJCQkJCXZhciBzb3VyY2VWYXIgPSAnYWRkRGV2aWNlU2VydmljZUVycm9yJzsKCQkJCQlsb2NhbFN0b3JhZ2Uuc2V0SXRlbShzb3VyY2VWYXIsSlNPTi5zdHJpbmdpZnkoZXJyb3JEYXRhKSk7CgkJCQkJd2luZG93LmxvY2F0aW9uLmhyZWYgPSIvIiArIGdldENDTEMoJ2NjJykgKyAnLScgKyBnZXRDQ0xDKCdsYycpICsgJy9lcnJvcj9lcnJvclR5cGU9NTAwJnNvdXJjZT0nK3NvdXJjZVZhcjsJCS8vYXBwZW5kaW5nIHRoZSBzb3VyY2UgZm9yIEFMTSAyODY2IDUwMCBlcnJvciBhbmFseXNpcwoJCQkJfQoJCQl9CgkJCWVsc2V7CgkJCQlpZih0eXBlb2YoYWRkRGV2aWNlUmVxUGF5bG9hZC5kbWRBZGRpdGlvbikgIT0gInVuZGVmaW5lZCIpewoJCQkJCWN1c3RvbVN1Y2Nlc3NDYWxsYmFjayhhZGREZXZpY2VSZXFQYXlsb2FkLnNlcmlhbE51bWJlcik7CgkJCQl9CgkJCQllbHNlIGlmKGFkZERldmljZVJlcVBheWxvYWQucGFnZSA9ICJlYXMiKXsJCQkJCQoJCQkJCWN1c3RvbVN1Y2Nlc3NDYWxsYmFjayhhZGREZXZpY2VSZXFQYXlsb2FkLnNlcmlhbE51bWJlciwgYWRkRGV2aWNlUmVxUGF5bG9hZC5wcm9kdWN0TnVtYmVyKTsKCQkJCX0KCQkJCWVsc2V7CgkJCQkJY3VzdG9tU3VjY2Vzc0NhbGxiYWNrKCk7CgkJCQl9CgkJCX0KCX0pLmZhaWwoZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzKSB7CgkJcG9wdWxhdGVTU0lEKCk7CgkJaWYodHlwZW9mKGFkZERldmljZVJlcVBheWxvYWQuZG1kQWRkaXRpb24pICE9ICJ1bmRlZmluZWQiKXsKCQkJY3VzdG9tRmFpbENhbGxiYWNrKGFkZERldmljZVJlcVBheWxvYWQuc2VyaWFsTnVtYmVyKTsKCQl9CgkJZWxzZSBpZihhZGREZXZpY2VSZXFQYXlsb2FkLnBhZ2UgPSAiZWFzIil7CgkJCWN1c3RvbVN1Y2Nlc3NDYWxsYmFjayhhZGREZXZpY2VSZXFQYXlsb2FkLnNlcmlhbE51bWJlciwgYWRkRGV2aWNlUmVxUGF5bG9hZC5wcm9kdWN0TnVtYmVyKTsKCQl9CgkJZWxzZXsKCQkJbG9jYWxTdG9yYWdlLmFkZERldmljZUZhaWxlZCA9IHsJCS8vY3JlYXRpbmcgSlNPTiBvYmplY3QgZm9yIGVycm9yIDUwMCBhbmFseXNpcyBBTE0jIDI4NjYKCQkJCSJyZXF1ZXN0VXJsIiA6ICIvaHAtcHBzLXNlcnZpY2VzL2hwc2EvYWRkRGV2aWNlP3NzaWQ9Iitzc2lkVmFsdWVbdG9rZW5JZF0sCgkJCQkiZGF0YSIgOiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0SlNPTiksCgkJCQkiZXJyb3JSZWFzb24iIDoganFYSFIucmVzcG9uc2VUZXh0CgkJCX0KCQkJY3VzdG9tRmFpbENhbGxiYWNrKCk7CgkJfQoJfSk7Cn0KfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7KGZ1bmN0aW9uKCl7CmlmKCFpJC5pc0lFKXsKaSQuYWRkT25Mb2FkKGZ1bmN0aW9uKCl7CnZhciBfMT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKdmFyIF8yPWlibUNmZy50aGVtZUNvbmZpZy50aGVtZVdlYkFwcEJhc2VVUkk7Cl8xLnN0eWxlLmNzc1RleHQ9ImJvcmRlcjoxcHggc29saWQ7Ym9yZGVyLWNvbG9yOnJlZCBncmVlbjtwb3NpdGlvbjphYnNvbHV0ZTtoZWlnaHQ6NXB4O3RvcDotOTk5cHg7YmFja2dyb3VuZC1pbWFnZTp1cmwoXCIiK18yKyIvaWNvbnMvYmxhbmsuZ2lmXCIpOyI7CmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoXzEpOwp2YXIgXzM9bnVsbDsKdHJ5ewpfMz1kb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKF8xLCIiKTsKfQpjYXRjaChlKXsKXzM9XzEuY3VycmVudFN0eWxlOwp9CnZhciBfND1fMy5iYWNrZ3JvdW5kSW1hZ2U7CmlmKChfMy5ib3JkZXJUb3BDb2xvcj09XzMuYm9yZGVyUmlnaHRDb2xvcil8fChfNCE9bnVsbCYmKF80PT0ibm9uZSJ8fF80PT0idXJsKGludmFsaWQtdXJsOikiKSkpewpkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdLmNsYXNzTmFtZSs9IiB3cHRoZW1lSW1hZ2VzT2ZmIjsKfQpkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKF8xKTsKfSk7Cn0KfSkoKTsKCgp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnd3BfdGhlbWVfaGlnaF9jb250cmFzdCc6ICIsZSk7fQ==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="1512931500" offset="0" length="16384" />
        <PacketInfo time="1512931515" offset="16384" length="16384" />
        <PacketInfo time="1512931515" offset="32768" length="16384" />
        <PacketInfo time="1512931515" offset="49152" length="16384" />
        <PacketInfo time="1512931515" offset="65536" length="16384" />
        <PacketInfo time="1512931515" offset="81920" length="16384" />
        <PacketInfo time="1512931531" offset="98304" length="1254" />
      </TcpPackets>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>