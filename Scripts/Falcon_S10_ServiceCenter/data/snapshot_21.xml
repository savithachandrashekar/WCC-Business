<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="21">
  <HTTPTask id="256" hostname="ppssupport-itgllbh7.inc.hp.com" path="/wps/contenthandler/pps/!ut/p/digest!3JKaotSk_gMd0aUfF0xN-w/mashup/ra:collection?themeID=ZJ_3054ICK0K8VR40ACSBJACA0001&amp;locale=en&amp;mime-type=text%2Fjavascript&amp;lm=1622771916000&amp;entry=wp_client_main__0.0%3Ahead_js&amp;entry=wp_client_ext__0.0%3Ahead_js&amp;entry=hpStyleR2__1.0%3Ahead_js" url="https://ppssupport-itgllbh7.inc.hp.com/wps/contenthandler/pps/!ut/p/digest!3JKaotSk_gMd0aUfF0xN-w/mashup/ra:collection?themeID=ZJ_3054ICK0K8VR40ACSBJACA0001&amp;locale=en&amp;mime-type=text%2Fjavascript&amp;lm=1622771916000&amp;entry=wp_client_main__0.0%3Ahead_js&amp;entry=wp_client_ext__0.0%3Ahead_js&amp;entry=hpStyleR2__1.0%3Ahead_js" ip="15.72.22.19" port="443" connectionId="10" origin="Primary" frame="1" startDateTime="2021-07-16T05:08:27.505+00:00" startTime="1512931171" endTime="1512931265">
    <QueryString>
      <HTTPDataSet>
        <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
          <ActualData>dGhlbWVJRD1aSl8zMDU0SUNLMEs4VlI0MEFDU0JKQUNBMDAwMSZsb2NhbGU9ZW4mbWltZS10eXBlPXRleHQlMkZqYXZhc2NyaXB0JmxtPTE2MjI3NzE5MTYwMDAmZW50cnk9d3BfY2xpZW50X21haW5fXzAuMCUzQWhlYWRfanMmZW50cnk9d3BfY2xpZW50X2V4dF9fMC4wJTNBaGVhZF9qcyZlbnRyeT1ocFN0eWxlUjJfXzEuMCUzQWhlYWRfanM=</ActualData>
        </HTTPData>
      </HTTPDataSet>
      <IsExternalData>false</IsExternalData>
    </QueryString>
    <HTTPSplittedQueryStrings>
      <HTTPHeaderEntity name="themeID" index="0">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>WkpfMzA1NElDSzBLOFZSNDBBQ1NCSkFDQTAwMDE=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="locale" index="1">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>ZW4=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="mime-type" index="2">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>dGV4dCUyRmphdmFzY3JpcHQ=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="lm" index="3">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MTYyMjc3MTkxNjAwMA==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="entry" index="4">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>d3BfY2xpZW50X21haW5fXzAuMCUzQWhlYWRfanM=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="entry" index="5">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>d3BfY2xpZW50X2V4dF9fMC4wJTNBaGVhZF9qcw==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="entry" index="6">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>aHBTdHlsZVIyX18xLjAlM0FoZWFkX2pz</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
    </HTTPSplittedQueryStrings>
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHBzc3VwcG9ydC1pdGdsbGJoNy5pbmMuaHAuY29t</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="sec-ch-ua" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>IiBOb3Q7QSBCcmFuZCI7dj0iOTkiLCAiR29vZ2xlIENocm9tZSI7dj0iOTEiLCAiQ2hyb21pdW0iO3Y9IjkxIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="sec-ch-ua-mobile" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>PzA=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzkxLjAuNDQ3Mi4xMjQgU2FmYXJpLzUzNy4zNg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Sec-Fetch-Site" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>c2FtZS1vcmlnaW4=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Sec-Fetch-Mode" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bm8tY29ycw==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Sec-Fetch-Dest" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>c2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly9wcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20vdXMtZW4vc2VydmljZS1jZW50ZXI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>T3B0YW5vbkNvbnNlbnQ9Y29uc2VudElkPWExNWJlM2ZlLWJlZjYtNDNhOS04YzczLWQ2NzQ3ZDEyZTk5OCZkYXRlc3RhbXA9RnJpK0p1bCsxNisyMDIxKzA0JTNBNDIlM0E0OStHTVQlMkIwMDAwKyhHcmVlbndpY2grTWVhbitUaW1lKSZ2ZXJzaW9uPTYuMTkuMCZpbnRlcmFjdGlvbkNvdW50PTA7IEpTRVNTSU9OSUQ9MDAwMFJmMXBIb1lfOXFYYk9BMGNwY21ZdnhtOjFiMGVkbWVlaDsgZHRDb29raWU9dl80X3Nydl8xX3NuXzVEOTI5RUNCMjJFODAxRjU0Njg3NUE1QzZDODAyMTkwX3BlcmNfMTAwMDAwX29sXzBfbXVsXzFfYXBwLTNBZWE3YzRiNTlmMjdkNDNlYl8xOyByeFZpc2l0b3I9MTYyNjQxMTc2OTMzNlZMUThSM0NQUkNTSFFLODhCNkRVUUlWVk85MDU0OU9VOyBkdFNhPS07IGR0TGF0Qz0xMTY1OyByeHZ0PTE2MjY0MTM1NjkzNTZ8MTYyNjQxMTc2OTM0NzsgZHRQQz0xJDQxMTc2OTMyOF85MzNoMXZTUVZLVEhQSENFSEZWRlJJUkdMVlBUSElXSFVNQ0FFUC0wZTE7IEFNQ1ZfNUUzNDEyM0Y1MjQ1QjJDRDBBNDkwRDQ1JTQwQWRvYmVPcmc9MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4ODI1JTdDdlZlcnNpb24lN0M0LjQuMA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC93cHMvY29udGVudGhhbmRsZXIvcHBzLyF1dC9wL2RpZ2VzdCEzSkthb3RTa19nTWQwYVVmRjB4Ti13L21hc2h1cC9yYTpjb2xsZWN0aW9uP3RoZW1lSUQ9WkpfMzA1NElDSzBLOFZSNDBBQ1NCSkFDQTAwMDEmbG9jYWxlPWVuJm1pbWUtdHlwZT10ZXh0JTJGamF2YXNjcmlwdCZsbT0xNjIyNzcxOTE2MDAwJmVudHJ5PXdwX2NsaWVudF9tYWluX18wLjAlM0FoZWFkX2pzJmVudHJ5PXdwX2NsaWVudF9leHRfXzAuMCUzQWhlYWRfanMmZW50cnk9aHBTdHlsZVIyX18xLjAlM0FoZWFkX2pzIEhUVFAvMS4xDQpIb3N0OiBwcHNzdXBwb3J0LWl0Z2xsYmg3LmluYy5ocC5jb20NCkNvbm5lY3Rpb246IGtlZXAtYWxpdmUNCnNlYy1jaC11YTogIiBOb3Q7QSBCcmFuZCI7dj0iOTkiLCAiR29vZ2xlIENocm9tZSI7dj0iOTEiLCAiQ2hyb21pdW0iO3Y9IjkxIg0Kc2VjLWNoLXVhLW1vYmlsZTogPzANClVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS85MS4wLjQ0NzIuMTI0IFNhZmFyaS81MzcuMzYNCkFjY2VwdDogKi8qDQpTZWMtRmV0Y2gtU2l0ZTogc2FtZS1vcmlnaW4NClNlYy1GZXRjaC1Nb2RlOiBuby1jb3JzDQpTZWMtRmV0Y2gtRGVzdDogc2NyaXB0DQpSZWZlcmVyOiBodHRwczovL3Bwc3N1cHBvcnQtaXRnbGxiaDcuaW5jLmhwLmNvbS91cy1lbi9zZXJ2aWNlLWNlbnRlcg0KQWNjZXB0LUVuY29kaW5nOiBnemlwLCBkZWZsYXRlLCBicg0KQWNjZXB0LUxhbmd1YWdlOiBlbi1VUyxlbjtxPTAuOQ0KQ29va2llOiBPcHRhbm9uQ29uc2VudD1jb25zZW50SWQ9YTE1YmUzZmUtYmVmNi00M2E5LThjNzMtZDY3NDdkMTJlOTk4JmRhdGVzdGFtcD1GcmkrSnVsKzE2KzIwMjErMDQlM0E0MiUzQTQ5K0dNVCUyQjAwMDArKEdyZWVud2ljaCtNZWFuK1RpbWUpJnZlcnNpb249Ni4xOS4wJmludGVyYWN0aW9uQ291bnQ9MDsgSlNFU1NJT05JRD0wMDAwUmYxcEhvWV85cVhiT0EwY3BjbVl2eG06MWIwZWRtZWVoOyBkdENvb2tpZT12XzRfc3J2XzFfc25fNUQ5MjlFQ0IyMkU4MDFGNTQ2ODc1QTVDNkM4MDIxOTBfcGVyY18xMDAwMDBfb2xfMF9tdWxfMV9hcHAtM0FlYTdjNGI1OWYyN2Q0M2ViXzE7IHJ4VmlzaXRvcj0xNjI2NDExNzY5MzM2VkxROFIzQ1BSQ1NIUUs4OEI2RFVRSVZWTzkwNTQ5T1U7IGR0U2E9LTsgZHRMYXRDPTExNjU7IHJ4dnQ9MTYyNjQxMzU2OTM1NnwxNjI2NDExNzY5MzQ3OyBkdFBDPTEkNDExNzY5MzI4XzkzM2gxdlNRVktUSFBIQ0VIRlZGUklSR0xWUFRISVdIVU1DQUVQLTBlMTsgQU1DVl81RTM0MTIzRjUyNDVCMkNEMEE0OTBENDUlNDBBZG9iZU9yZz0xNTg1NTQwMTM1JTdDTUNJRFRTJTdDMTg4MjUlN0N2VmVyc2lvbiU3QzQuNC4wDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="OptanonConsent" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Y29uc2VudElkPWExNWJlM2ZlLWJlZjYtNDNhOS04YzczLWQ2NzQ3ZDEyZTk5OCZkYXRlc3RhbXA9RnJpK0p1bCsxNisyMDIxKzA0JTNBNDIlM0E0OStHTVQlMkIwMDAwKyhHcmVlbndpY2grTWVhbitUaW1lKSZ2ZXJzaW9uPTYuMTkuMCZpbnRlcmFjdGlvbkNvdW50PTA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="JSESSIONID" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MDAwMFJmMXBIb1lfOXFYYk9BMGNwY21ZdnhtOjFiMGVkbWVlaA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="dtCookie" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dl80X3Nydl8xX3NuXzVEOTI5RUNCMjJFODAxRjU0Njg3NUE1QzZDODAyMTkwX3BlcmNfMTAwMDAwX29sXzBfbXVsXzFfYXBwLTNBZWE3YzRiNTlmMjdkNDNlYl8x</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="rxVisitor" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTYyNjQxMTc2OTMzNlZMUThSM0NQUkNTSFFLODhCNkRVUUlWVk85MDU0OU9V</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="dtSa" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>LQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="dtLatC" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTE2NQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="rxvt" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTYyNjQxMzU2OTM1NnwxNjI2NDExNzY5MzQ3</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="dtPC" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MSQ0MTE3NjkzMjhfOTMzaDF2U1FWS1RIUEhDRUhGVkZSSVJHTFZQVEhJV0hVTUNBRVAtMGUx</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="AMCV_5E34123F5245B2CD0A490D45%40AdobeOrg" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MTU4NTU0MDEzNSU3Q01DSURUUyU3QzE4ODI1JTdDdlZlcnNpb24lN0M0LjQuMA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>0</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bmdpbngvMS4xNC4y</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAxNiBKdWwgMjAyMSAwNTowMjo0OSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9qYXZhc2NyaXB0OyBjaGFyc2V0PVVURi04</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Transfer-Encoding" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Y2h1bmtlZA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Powered-By" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>U2VydmxldC8zLjE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Request-Digest" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SEZYOWJPWVdMcmhiemFrY0swd1FUUQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-DataSource-Digest" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>M0pLYW90U2tfZ01kMGFVZkYweE4tdw==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Expires" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAyMyBKdWwgMjAyMSAwNTowMjo0OSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bWF4LWFnZT02MDQ4MDA=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAwNCBKdW4gMjAyMSAwMTo1ODozNCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Location" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>L3dwcy9jb250ZW50aGFuZGxlci9wcHMvIXV0L3AvZGlnZXN0ITNKS2FvdFNrX2dNZDBhVWZGMHhOLXcvbWFzaHVwL21hc2h1cDpjeG1sLzFkWkJTOE13RkFmd1Q1UGoyaHFuREctQ1htUVRjZWgxdkNiUDlaVTB5WktYclpWLWVEc1ZVVTk2VU5wVENNa2pQOEtmbDJCN3M3NDQtSTB5aEpZM0RaQVZKX01pWUJRbnA1ZjV3Y2VjSzJ4dzVYUXlHUFBtZmFTeVVYazl6SWVDallFT1ExYkh2azhSZzVES1djYVcteWN3RVdlOUFsV2hrRkU1ajcxUHBTRTE2eHRvaFlRdDlvdnplVkhNZWg5Y2pZcV9GOF93SzNCWS1aVlB1WURIb3I4M1ZuN05uY0Y3LWRsWGVTRzlDd3hHeUZmbmNBUURrM3BUeF96dWRYR1JGY1BXbzdkMGppTUg4RmxEZHZ4Y3FLRjlZRExFM2ZpeFF6WXdXSHAtaThGM3dNX3BfMERkSlRBY1NNV2xBNDBUQUN2WE5NNGVveERIajlYQmVlME9kanJTSlcwckhqOTNENGIwc01GTjRHcnJYY0xRQ1psb19GYXcyMlFnZkx3SjQ4NHM4bkRDcXJ2Q1BTbDhsT01YUDVIVmEyZlNOSUtyQXhrempmWlZKaktUZUw2dWJUeDJXTFJYd0xEOC1DcU91eW5vOWhiMnRKMUl2NjNBYW9NbGhDamtmcDRWMmRrZm1WOEFpTkJNYWchIT90aGVtZUlEPVpKXzMwNTRJQ0swSzhWUjQwQUNTQkpBQ0EwMDAxJmxvY2FsZT1lbiZtaW1lLXR5cGU9dGV4dC9qYXZhc2NyaXB0JmxtPTE2MjI3NzE5MTYwMDAmZW50cnk9d3BfY2xpZW50X21haW5fXzAuMCUzYWhlYWRfanMmZW50cnk9d3BfY2xpZW50X2V4dF9fMC4wJTNhaGVhZF9qcyZlbnRyeT1ocFN0eWxlUjJfXzEuMCUzYWhlYWRfanM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="13">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="14">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>IjE2MjI3NzE5MTY6ZHRhZ2VudDEwMjE5MjEwNjI4MTMzMzQxUStVazpkdGFnZW50MTAyMTkyMTA2MjgxMzMzNDFRK1VrIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Language" index="15">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Server-Timing" index="16">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZHRScGlkO2Rlc2M9Ii0yMDYzMDYwMjUyIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Proxy-Cache" index="17">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TUlTUw==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-XSS-Protection" index="18">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTsgbW9kZT1ibG9jaw==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Strict-Transport-Security" index="19">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bWF4LWFnZT04NjQwMDsgaW5jbHVkZVN1YkRvbWFpbnM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IG5naW54LzEuMTQuMg0KRGF0ZTogRnJpLCAxNiBKdWwgMjAyMSAwNTowMjo0OSBHTVQNCkNvbnRlbnQtVHlwZTogdGV4dC9qYXZhc2NyaXB0OyBjaGFyc2V0PVVURi04DQpUcmFuc2Zlci1FbmNvZGluZzogY2h1bmtlZA0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KWC1Qb3dlcmVkLUJ5OiBTZXJ2bGV0LzMuMQ0KWC1SZXF1ZXN0LURpZ2VzdDogSEZYOWJPWVdMcmhiemFrY0swd1FUUQ0KWC1EYXRhU291cmNlLURpZ2VzdDogM0pLYW90U2tfZ01kMGFVZkYweE4tdw0KRXhwaXJlczogRnJpLCAyMyBKdWwgMjAyMSAwNTowMjo0OSBHTVQNCkNhY2hlLUNvbnRyb2w6IG1heC1hZ2U9NjA0ODAwDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA0IEp1biAyMDIxIDAxOjU4OjM0IEdNVA0KQ29udGVudC1Mb2NhdGlvbjogL3dwcy9jb250ZW50aGFuZGxlci9wcHMvIXV0L3AvZGlnZXN0ITNKS2FvdFNrX2dNZDBhVWZGMHhOLXcvbWFzaHVwL21hc2h1cDpjeG1sLzFkWkJTOE13RkFmd1Q1UGoyaHFuREctQ1htUVRjZWgxdkNiUDlaVTB5WktYclpWLWVEc1ZVVTk2VU5wVENNa2pQOEtmbDJCN3M3NDQtSTB5aEpZM0RaQVZKX01pWUJRbnA1ZjV3Y2VjSzJ4dzVYUXlHUFBtZmFTeVVYazl6SWVDallFT1ExYkh2azhSZzVES1djYVcteWN3RVdlOUFsV2hrRkU1ajcxUHBTRTE2eHRvaFlRdDlvdnplVkhNZWg5Y2pZcV9GOF93SzNCWS1aVlB1WURIb3I4M1ZuN05uY0Y3LWRsWGVTRzlDd3hHeUZmbmNBUURrM3BUeF96dWRYR1JGY1BXbzdkMGppTUg4RmxEZHZ4Y3FLRjlZRExFM2ZpeFF6WXdXSHAtaThGM3dNX3BfMERkSlRBY1NNV2xBNDBUQUN2WE5NNGVveERIajlYQmVlME9kanJTSlcwckhqOTNENGIwc01GTjRHcnJYY0xRQ1psb19GYXcyMlFnZkx3SjQ4NHM4bkRDcXJ2Q1BTbDhsT01YUDVIVmEyZlNOSUtyQXhrempmWlZKaktUZUw2dWJUeDJXTFJYd0xEOC1DcU91eW5vOWhiMnRKMUl2NjNBYW9NbGhDamtmcDRWMmRrZm1WOEFpTkJNYWchIT90aGVtZUlEPVpKXzMwNTRJQ0swSzhWUjQwQUNTQkpBQ0EwMDAxJmxvY2FsZT1lbiZtaW1lLXR5cGU9dGV4dC9qYXZhc2NyaXB0JmxtPTE2MjI3NzE5MTYwMDAmZW50cnk9d3BfY2xpZW50X21haW5fXzAuMCUzYWhlYWRfanMmZW50cnk9d3BfY2xpZW50X2V4dF9fMC4wJTNhaGVhZF9qcyZlbnRyeT1ocFN0eWxlUjJfXzEuMCUzYWhlYWRfanMNClZhcnk6IEFjY2VwdC1FbmNvZGluZw0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KRVRhZzogIjE2MjI3NzE5MTY6ZHRhZ2VudDEwMjE5MjEwNjI4MTMzMzQxUStVazpkdGFnZW50MTAyMTkyMTA2MjgxMzMzNDFRK1VrIg0KQ29udGVudC1MYW5ndWFnZTogZW4tVVMNClNlcnZlci1UaW1pbmc6IGR0UnBpZDtkZXNjPSItMjA2MzA2MDI1MiINClgtUHJveHktQ2FjaGU6IE1JU1MNClgtWFNTLVByb3RlY3Rpb246IDE7IG1vZGU9YmxvY2sNClN0cmljdC1UcmFuc3BvcnQtU2VjdXJpdHk6IG1heC1hZ2U9ODY0MDA7IGluY2x1ZGVTdWJEb21haW5zDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>CnRyeXsvKiogTGljZW5zZWQgTWF0ZXJpYWxzIC0gUHJvcGVydHkgb2YgSUJNLCA1NzI0LUU3NiBhbmQgNTcyNC1FNzcsIChDKSBDb3B5cmlnaHQgSUJNIENvcnAuIDIwMTEsIDIwMTIgLSBBbGwgUmlnaHRzIHJlc2VydmVkLiAgKiovCihmdW5jdGlvbigpewp2YXIgdz13aW5kb3csaSQ9ZnVuY3Rpb24oKXsKaWYoaSQucWVsKXsKcmV0dXJuIGkkLnFlbC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Cn0KfTsKdy5pJD1pJDsKaSQuZ2xvYmFsPXc7CmlmKHR5cGVvZiAoY29uc29sZSk9PSJ1bmRlZmluZWQiKXsKdmFyIGY9ZnVuY3Rpb24oKXsKfTsKY29uc29sZT17bG9nOmYsZGVidWc6ZixpbmZvOmYsd2FybjpmLGVycm9yOmYsYXNzZXJ0OmZ9Owp9CmkkLnBhcnRpYWw9ZnVuY3Rpb24oZil7CnZhciBfMT1pJC50b0FycmF5KGFyZ3VtZW50cykuc2xpY2UoMSk7CnJldHVybiBmdW5jdGlvbigpewp2YXIgXzI9XzEuc2xpY2UoMCksXzM9aSQudG9BcnJheShhcmd1bWVudHMpLGk9MDsKZm9yKDtpPF8yLmxlbmd0aDtpKyspewppZihfMltpXT09PXVuZGVmaW5lZCl7Cl8yW2ldPV8zLnNoaWZ0KCk7Cn0KfQpfMi5wdXNoLmFwcGx5KF8yLF8zKTsKcmV0dXJuIGYuYXBwbHkodGhpcyxfMik7Cn07Cn07CmkkLnNjb3BlPWZ1bmN0aW9uKHMsZil7CnZhciBvZj1mOwpmPWZ1bmN0aW9uKCl7CnJldHVybiAoaSQuaXNTdHJpbmcob2YpP3Nbb2ZdOm9mKS5hcHBseShzLGFyZ3VtZW50cyk7Cn07CnJldHVybiBpJC5wYXJ0aWFsLmFwcGx5KHRoaXMsaSQudG9BcnJheShhcmd1bWVudHMpLnNsaWNlKDEpKTsKfTsKaSQuZXJyb3I9ZnVuY3Rpb24oXzQsXzUpewpjb25zb2xlLmVycm9yKF81fHxuZXcgRXJyb3IoXzQpKTsKfTsKaSQuZm9yRWFjaD1mdW5jdGlvbihfNixmLF83KXsKaWYoXzc9PW51bGwpewpfNz0wOwp9CmZvcih2YXIgaT0oXzc+PTApP183OjA7aTxfNi5sZW5ndGg7aSsrKXsKZihfNltpXSxpLF82KTsKfQp9OwppJC5mb3JJbj1mdW5jdGlvbihvLGYpewpmb3IodmFyIGkgaW4gbyl7CmlmKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvLGkpKXsKZihvW2ldLGksbyk7Cn0KfQp9OwppJC5lYWNoPWZ1bmN0aW9uKG8sZixzKXsKaWYocyl7CmY9aSQuc2NvcGUocyxmKTsKfQppZihvKXsKaWYobyBpbnN0YW5jZW9mIEFycmF5fHx0eXBlb2Ygby5sZW5ndGg9PT0ibnVtYmVyIil7CmkkLmZvckVhY2gobyxmKTsKfWVsc2V7CmkkLmZvckluKG8sZik7Cn0KfQp9OwppJC5zb21lPWZ1bmN0aW9uKGEsZixzKXsKaWYocyl7CmY9aSQuc2NvcGUocyxmKTsKfQpmb3IodmFyIGk9MDtpPGEubGVuZ3RoO2krKyl7CmlmKGYoYVtpXSkpewpyZXR1cm4gdHJ1ZTsKfQp9CnJldHVybiBmYWxzZTsKfTsKaSQuZXZlcnk9ZnVuY3Rpb24obyxmLHMpewppZihzKXsKZj1pJC5zY29wZShzLGYpOwp9CnJldHVybiAhaSQuc29tZShvLGZ1bmN0aW9uKF84KXsKcmV0dXJuICFmKF84KTsKfSk7Cn07CmkkLndyYXA9ZnVuY3Rpb24obyxuLGYpewp2YXIgZm49b1tuXTsKb1tuXT1mdW5jdGlvbigpewpyZXR1cm4gZi5jYWxsKHRoaXMsZm4sYXJndW1lbnRzKTsKfTsKb1tuXS5fd3JhcHBlZD1mbjsKcmV0dXJuIG9bbl07Cn07CmkkLnVud3JhcD1mdW5jdGlvbihvLG4pewp2YXIgZm49b1tuXTsKaWYoZm4mJmZuLl93cmFwcGVkKXsKb1tuXT1mbi5fd3JhcHBlZDsKfQpyZXR1cm4gb1tuXTsKfTsKaSQuY29weVNoYWxsb3c9ZnVuY3Rpb24obyl7CnZhciByPWkkLmlzQXJyYXlMaWtlKG8pP1tdOnt9OwppJC5mb3JJbihvLGZ1bmN0aW9uKHYsayl7CnJba109djsKfSk7CnJldHVybiByOwp9Owp2YXIgXzk9ZnVuY3Rpb24oX2EsX2IsX2MsX2QpewppZihfY3x8X2JbX2RdPT09dW5kZWZpbmVkKXsKX2JbX2RdPWZ1bmN0aW9uKCl7CnJldHVybiB0aGlzW19hXVtfZF0uYXBwbHkodGhpc1tfYV0sYXJndW1lbnRzKTsKfTsKfQp9LF9lPWZ1bmN0aW9uKF9mLF8xMCxfMTEsXzEyKXsKaWYoXzExfHxfMTBbXzEyXT09PXVuZGVmaW5lZCl7Cl8xMFtfMTJdPWZ1bmN0aW9uKCl7CnJldHVybiBfZltfMTJdLmFwcGx5KF9mLGFyZ3VtZW50cyk7Cn07Cn0KfTsKaSQuc2hhZG93PWZ1bmN0aW9uKHMsdCxfMTMsXzE0KXsKaSQuZWFjaChfMTMsaSQucGFydGlhbChpJC5pc1N0cmluZyhzKT9fOTpfZSxzLHQsXzE0KSk7Cn07CnZhciBfMTU9ZnVuY3Rpb24oXzE2LGMscyl7CnZhciBpLHAsdHM9c3x8aSQuZ2xvYmFsOwpmb3IoaT0wO3RzIT1udWxsLGk8XzE2Lmxlbmd0aCxwPV8xNltpXTtpKyspewppZih0c1twXT09bnVsbCl7CmlmKGMpewp0c1twXT17fTsKfWVsc2V7CnRzPW51bGw7CmJyZWFrOwp9Cn0KdHM9dHNbcF07Cn0KcmV0dXJuIHRzOwp9OwppJC5mcm9tUGF0aD1mdW5jdGlvbihuLGMscyl7CnZhciBfMTc9bi5zcGxpdCgiLiIpOwpyZXR1cm4gXzE1KF8xNyxjLHMpOwp9OwppJC50b1BhdGg9ZnVuY3Rpb24obix2LHMpewp2YXIgXzE4PW4uc3BsaXQoIi4iKSxwPV8xOC5wb3AoKSxvPV8xNShfMTgsdHJ1ZSxzKTsKb1twXT12OwpyZXR1cm4gdjsKfTsKaSQuY2FjaGVkRm49ZnVuY3Rpb24oZixzKXsKdmFyIHZhbDsKdmFyIGZuPWZ1bmN0aW9uKCl7CmlmKCFmbi5jYWxsZWQpewpmbi5jYWxsZWQ9dHJ1ZTsKdmFsPWYuYXBwbHkocyxhcmd1bWVudHMpOwp9CnJldHVybiB2YWw7Cn07CnJldHVybiBmbjsKfTsKaSQueGhyRm10cz17dGV4dDpmdW5jdGlvbih4aHIpewpyZXR1cm4geGhyLnJlc3BvbnNlVGV4dDsKfSxqc29uOmZ1bmN0aW9uKHhocil7CnJldHVybiAhKC9bXiw6e31cW1xdMC05LlwtK0VhZWZsbnItdSBcblxyXHRdLy50ZXN0KHhoci5yZXNwb25zZVRleHQucmVwbGFjZSgvIihcXC58W14iXFxdKSoiL2csIiIpKSkmJmV2YWwoIigiK3hoci5yZXNwb25zZVRleHQrIikiKTsKfSx4bWw6ZnVuY3Rpb24oeGhyKXsKcmV0dXJuIHhoci5yZXNwb25zZVhNTDsKfSxqYXZhc2NyaXB0OmZ1bmN0aW9uKHhocil7CmlmKCgvW14sOnt9XFtcXTAtOS5cLStFYWVmbG5yLXUgXG5cclx0XS8udGVzdChzdHIucmVwbGFjZSgvIihcXC58W14iXFxdKSoiL2csIiIpKSkpewp0aHJvdyBuZXcgU3ludGF4RXJyb3IoIkludmFsaWQgY2hhcmFjdGVycyBpbiBqYXZhc2NyaXB0IG9iamVjdCIpOwp9ZWxzZXsKcmV0dXJuIGV2YWwoIigiK3hoci5yZXNwb25zZVRleHQrIikiKTsKfQp9fTsKfSkoKTsKKGZ1bmN0aW9uKCl7CnZhciBpJD13aW5kb3cuaSQ7CihmdW5jdGlvbih1YSl7CnZhciBfMTk9ZnVuY3Rpb24oXzFhKXsKcmV0dXJuIHBhcnNlRmxvYXQoXzFhKTsKfSxfMWI9W1siSUUiLC9NU0lFXHMqKFtcU10rKSovXSxbIkZGIiwvRmlyZWZveFwvKFtcU10rKSovXSxbIk9wZXJhIiwvT3BlcmFbXHNcL10oW1xTXSspKi9dLFsiU2FmYXJpIiwvVmVyc2lvblwvKFtcU10rKSpbXHNcU10qU2FmYXJpL10sWyJDaHJvbWUiLC9DaHJvbWVcLyhbXFNdKykqL10sWyJXZWJLaXQiLC9BcHBsZVdlYktpdFwvKFtcU10rKSovXV07CmkkLmVhY2goXzFiLGZ1bmN0aW9uKF8xYyl7CnZhciBtPV8xY1sxXS5leGVjKHVhKTsKaWYobSYmbS5sZW5ndGg+MSl7CmkkWyJpcyIrXzFjWzBdXT1fMTkobVsxXSk7Cn0KfSk7Cn0pKG5hdmlnYXRvci51c2VyQWdlbnQpOwp2YXIgXzFkPWRvY3VtZW50LmRvY3VtZW50TW9kZTsKaWYoXzFkJiZfMWQhPTUmJk1hdGguZmxvb3IoaSQuaXNJRSkhPV8xZCl7CmkkLmlzSUU9XzFkOwp9CmkkLmlzTm9kZT1mdW5jdGlvbihvKXsKcmV0dXJuIHR5cGVvZiBvPT09Im9iamVjdCImJnR5cGVvZiBvLm5vZGVUeXBlPT09Im51bWJlciImJnR5cGVvZiBvLm5vZGVOYW1lPT09InN0cmluZyI7Cn07CmkkLmlzRnVuY3Rpb249ZnVuY3Rpb24obyl7CnJldHVybiB0eXBlb2Ygbz09PSJmdW5jdGlvbiJ8fG8gaW5zdGFuY2VvZiBGdW5jdGlvbjsKfTsKaSQuaXNPYmplY3Q9ZnVuY3Rpb24obyl7CnJldHVybiB0eXBlb2Ygbz09PSJvYmplY3QiOwp9OwppJC5pc0FycmF5PWZ1bmN0aW9uKG8pewppZih0eXBlb2YgQXJyYXkuaXNBcnJheT09PSJmdW5jdGlvbiIpewpyZXR1cm4gQXJyYXkuaXNBcnJheShvKTsKfWVsc2V7CnJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobyk9PT0iW29iamVjdCBBcnJheV0iOwp9Cn07CmkkLmlzU3RyaW5nPWZ1bmN0aW9uKG8pewpyZXR1cm4gdHlwZW9mIG89PT0ic3RyaW5nIjsKfTsKaSQuaXNOdW1iZXI9ZnVuY3Rpb24obyl7CnJldHVybiB0eXBlb2Ygbz09PSJudW1iZXIiOwp9OwppJC5pc0Jvb2xlYW49ZnVuY3Rpb24obyl7CnJldHVybiB0eXBlb2Ygbz09PSJib29sZWFuIjsKfTsKaSQuaXNMaWtlQXJyYXk9ZnVuY3Rpb24obyl7CnJldHVybiBvIGluc3RhbmNlb2YgQXJyYXl8fHR5cGVvZiBvLmxlbmd0aD09PSJudW1iZXIiOwp9OwppJC50b0FycmF5PWZ1bmN0aW9uKG8pewpyZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwobyk7Cn07CmlmKGkkLmlzSUUpewp2YXIgXzFlPWkkLnRvQXJyYXk7CmkkLnRvQXJyYXk9ZnVuY3Rpb24obyl7CnRyeXsKcmV0dXJuIF8xZShvKTsKfQpjYXRjaChlcnIpewp2YXIgYT1uZXcgQXJyYXkoby5sZW5ndGgpOwpmb3IodmFyIGk9MDtpPG8ubGVuZ3RoO2krKyl7CmFbaV09b1tpXTsKfQpyZXR1cm4gYTsKfQp9Owp9CnZhciBfMWY9KGRvY3VtZW50LnJlYWR5U3RhdGU9PT0iY29tcGxldGUiKSxfMjA9W10sXzIxPVtdLF8yMj1mYWxzZTsKaSQuX2luaXRQYWdlPWZ1bmN0aW9uKCl7CnZhciBmbjsKXzFmPXRydWU7CmlmKHdpbmRvdy5kZXRhY2hFdmVudCl7CndpbmRvdy5kZXRhY2hFdmVudCgib25sb2FkIixpJC5faW5pdFBhZ2UpOwp9CndoaWxlKF8yMC5sZW5ndGg+MCl7CmlmKGZuPV8yMC5zaGlmdCgpKXsKdHJ5ewpmbigpOwp9CmNhdGNoKGVycil7CmNvbnNvbGUubG9nKGVycik7Cn0KfQp9Cn07CmkkLl9leGl0UGFnZT1mdW5jdGlvbigpewp2YXIgZm47CndoaWxlKF8yMS5sZW5ndGg+MCl7CmlmKGZuPV8yMS5zaGlmdCgpKXsKdHJ5ewpmbigpOwp9CmNhdGNoKGVycil7CmNvbnNvbGUubG9nKGVycik7Cn0KfQp9Cn07CmkkLl9hZGRFdmVudD1mdW5jdGlvbihlLGYsbyl7CnZhciB3PW8/bzp3aW5kb3c7CnZhciBzPXcuYXR0YWNoRXZlbnQ/ZTplLnN1YnN0cmluZygyKTsKdmFyIGE9dy5hdHRhY2hFdmVudHx8dy5hZGRFdmVudExpc3RlbmVyOwphKHMsZnVuY3Rpb24oKXsKZi5hcHBseSh3LGFyZ3VtZW50cyk7Cn0sZmFsc2UpOwp9OwppZighXzFmKXsKaSQuX2FkZEV2ZW50KCJvbmxvYWQiLGkkLl9pbml0UGFnZSk7CmlmKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpewpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixpJC5faW5pdFBhZ2UsZmFsc2UpOwp9Cn0KaSQuYWRkT25Mb2FkPWZ1bmN0aW9uKGYsbyl7CmlmKG8pewpmPWkkLnNjb3BlKG8sZik7Cn0KaWYoXzFmKXsKZigpOwp9ZWxzZXsKXzIwLnB1c2goZik7Cn0KfTsKaSQuYWRkT25VbmxvYWQ9ZnVuY3Rpb24oZixvKXsKaWYoIV8yMil7CmkkLl9hZGRFdmVudCgib251bmxvYWQiLGkkLl9leGl0UGFnZSk7Cl8yMj10cnVlOwp9CmlmKG8pewpmPWkkLnNjb3BlKG8sZik7Cn0KXzIxLnB1c2goZik7Cn07CnZhciBteD1mdW5jdGlvbihvLG0pewpmb3IodmFyIHAgaW4gbSl7CmlmKG0uaGFzT3duUHJvcGVydHkocCkpewpvW3BdPW1bcF07Cn0KfQp9LG14bj1mdW5jdGlvbihvLG0sXzIzKXsKaSQuZm9yRWFjaChfMjMsZnVuY3Rpb24ocCl7CmlmKG0uaGFzT3duUHJvcGVydHkocCkpewpvW3BdPW1bcF07Cn0KfSk7Cn07CmkkLm1hc2g9ZnVuY3Rpb24obyl7CmkkLmZvckVhY2goYXJndW1lbnRzLGZ1bmN0aW9uKHYpewpteChvLHYpOwp9LDEpOwpyZXR1cm4gbzsKfTsKaSQubWFzaFNwZWM9ZnVuY3Rpb24obixvKXsKaSQuZm9yRWFjaChhcmd1bWVudHMsZnVuY3Rpb24odil7Cm14bihvLHYsbik7Cn0sMik7CnJldHVybiBvOwp9OwppJC5hdWdtZW50PWZ1bmN0aW9uKGYpewp2YXIgcj1mOwppZihmJiZmLnByb3RvdHlwZSl7CmY9Zi5wcm90b3R5cGU7CmkkLm1hc2guYXBwbHkoaSQsYXJndW1lbnRzKTsKfQpyZXR1cm4gcjsKfTsKaSQubWFrZT0oZnVuY3Rpb24oKXsKdmFyIGw9ZnVuY3Rpb24oKXsKfTsKcmV0dXJuIGZ1bmN0aW9uKG8pewpsLnByb3RvdHlwZT1vOwpvPW5ldyBsKCk7CnJldHVybiBpJC5tYXNoLmFwcGx5KGkkLGFyZ3VtZW50cyk7Cn07Cn0pKCk7CnZhciBfMjQ9L15ccysvZzsKaSQudHJpbT1mdW5jdGlvbihzdHIpewpzdHI9c3RyLnJlcGxhY2UoXzI0LCIiKTsKdmFyIGk9c3RyLmxlbmd0aC0xOwp3aGlsZShzdHIuY2hhckF0KGkpPT0iICJ8fHN0ci5jaGFyQXQoaSk9PSJcdCJ8fHN0ci5jaGFyQXQoaSk9PSJcbiJ8fHN0ci5jaGFyQXQoaSk9PSJcciIpewppLS07Cn0KcmV0dXJuIHN0ci5zdWJzdHJpbmcoMCxpKzEpOwp9Owp2YXIgXzI1PWkkLmlzQXJyYXksXzI2PWkkLmlzT2JqZWN0OwppJC5tZXJnZT1mdW5jdGlvbihfMjcsXzI4LF8yOSl7CnZhciBfMjk9XzI5fHxbXSx2LGM7Cl8yOD1fMjh8fGkkLmdsb2JhbDsKaWYoXzI1KF8yNykmJl8yNShfMjgpKXsKXzI4LnB1c2guYXBwbHkoXzI4LF8yNyk7Cn1lbHNlewpmb3IodmFyIHggaW4gXzI3KXsKaWYoXzI3Lmhhc093blByb3BlcnR5KHgpKXsKdj1fMjdbeF0sYz1fMjhbeF07CmlmKGMhPW51bGwmJigoXzI1KHYpJiZfMjUoYykpfHwoXzI2KHYpJiZfMjYoYykpKSl7Cl8yOFt4XT1pJC5tZXJnZSh2LGMsXzI5LmNvbmNhdCh4KSk7Cn1lbHNlewpfMjhbeF09djsKfQp9Cn0KfQpyZXR1cm4gXzI4Owp9Owp2YXIgXzJhOwppJC5pc1JUTD1mdW5jdGlvbihfMmIpewppZighXzJhKXsKXzJhPWkkLmZyb21QYXRoKCJpYm1DZmcudGhlbWVDb25maWcuUlRMTWFwIik7Cn0KdmFyIF8yYz1fMmF8fHsiaXciOjEsImhlIjoxLCJhciI6MX07CnJldHVybiAoXzJiLnN1YnN0cmluZygwLDIpIGluIF8yYyk7Cn07Cn0pKCk7CgoKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ3dwX2NsaWVudF9tYWluJzogIixlKTt9CnRyeXsvKiogTGljZW5zZWQgTWF0ZXJpYWxzIC0gUHJvcGVydHkgb2YgSUJNLCA1NzI0LUU3NiBhbmQgNTcyNC1FNzcsIChDKSBDb3B5cmlnaHQgSUJNIENvcnAuIDIwMTEsIDIwMTIgLSBBbGwgUmlnaHRzIHJlc2VydmVkLiAgKiovCihmdW5jdGlvbigpewp2YXIgaSQ9d2luZG93LmkkOwppJC5Qcm9taXNlPWZ1bmN0aW9uKCl7CnRoaXMuX2Nicz1bXTsKdGhpcy5fc3RhdD0tMTsKfTsKaSQucHJvbWlzZT17fTsKaSQucHJvbWlzZS5Qcm9taXNlPWkkLlByb21pc2U7CmkkLm1hc2goaSQucHJvbWlzZSx7aXNQcm9taXNlOmZ1bmN0aW9uKG8pewpyZXR1cm4gbyYmaSQuaXNGdW5jdGlvbihvLnRoZW4pOwp9LHJlc29sdmVkOmZ1bmN0aW9uKG8pewp2YXIgcD1uZXcgaSQuUHJvbWlzZSgpOwpwLnJlc29sdmUobyk7CnJldHVybiBwOwp9LHJlamVjdGVkOmZ1bmN0aW9uKF8xKXsKdmFyIHA9bmV3IGkkLlByb21pc2UoKTsKcC5yZWplY3QoXzEpOwpyZXR1cm4gcDsKfSxqb2luOmZ1bmN0aW9uKF8yKXsKdmFyIF8zPW5ldyBpJC5Qcm9taXNlKCksXzQ9bmV3IEFycmF5KF8yLmxlbmd0aCksXzU9MCxfNj1mYWxzZSxfNz1mdW5jdGlvbigpewppZigrK181Pj1fNC5sZW5ndGgpewpfM1tfNj8icmVqZWN0IjoicmVzb2x2ZSJdKF80KTsKfQp9OwppZihfMi5sZW5ndGg+MCl7CmkkLmVhY2goXzIsZnVuY3Rpb24ocCxpKXsKcC50aGVuKGZ1bmN0aW9uKHYpewpfNFtpXT12OwpfNygpOwp9LGZ1bmN0aW9uKGUpewpfNj10cnVlOwpfNFtpXT1lOwpfNygpOwp9KTsKfSk7Cn1lbHNlewpfMy5yZXNvbHZlKFtdKTsKfQpyZXR1cm4gXzM7Cn19KTsKaSQubWFzaChpJCx7d2hlbjpmdW5jdGlvbihvKXsKcmV0dXJuIGkkLnByb21pc2UuaXNQcm9taXNlKG8pP286aSQucHJvbWlzZS5yZXNvbHZlZChvKTsKfSx3aGVuQWxsOmZ1bmN0aW9uKG8pewp2YXIgYT1bXTsKaSQuZWFjaChhcmd1bWVudHMsZnVuY3Rpb24ocCl7CmEucHVzaChpJC53aGVuKHApKTsKfSk7CnJldHVybiBpJC5wcm9taXNlLmpvaW4oYSk7Cn19KTsKaSQucHJvbWlzZS53aGVuPWkkLndoZW47CmkkLnByb21pc2Uud2hlbkFsbD1pJC53aGVuQWxsOwppJC5Qcm9taXNlLnByb3RvdHlwZT17X2ZpbjpmdW5jdGlvbih2LHMpewppZih0aGlzLl9zdGF0IT09LTEpewp0aHJvdyBuZXcgRXJyb3IoIlByb21pc2UgYWxyZWFkeSByZXNvbHZlZCIpOwp9CnRoaXMuX3Y9djsKdGhpcy5fc3RhdD1zOwp0aGlzLl9jYmsoKTsKcmV0dXJuIHRoaXM7Cn0sX2NiazpmdW5jdGlvbigpewp2YXIgc3Q9dGhpcy5fc3RhdCxfOD10aGlzLl9jYnMsdj10aGlzLl92LGY7CmlmKHN0PT09MCl7CmlmKGkkLnByb21pc2UuaXNQcm9taXNlKHYpKXsKd2hpbGUoXzgubGVuZ3RoPjApewp2LnRoZW4uYXBwbHkodixfOC5zaGlmdCgpKTsKfQp9Cn0Kd2hpbGUoXzgubGVuZ3RoPjApewpmPV84LnNoaWZ0KClbc3RdOwppZihmKXsKdHJ5ewpmKHYpOwp9CmNhdGNoKGVycil7Cn0KfQp9Cn0sX2RlbGVnYXRlOmZ1bmN0aW9uKGZuKXsKdmFyIHA9bmV3IGkkLlByb21pc2UoKTsKdGhpcy50aGVuKGkkLnBhcnRpYWwoZm4scCksaSQuc2NvcGUocCwicmVqZWN0IikpOwpyZXR1cm4gcDsKfSxyZXNvbHZlOmZ1bmN0aW9uKHYpewpyZXR1cm4gdGhpcy5fZmluKHYsMCk7Cn0scmVqZWN0OmZ1bmN0aW9uKGUpewpyZXR1cm4gdGhpcy5fZmluKGUsMSk7Cn0scHJvZ3Jlc3M6ZnVuY3Rpb24ocCl7CmkkLmVhY2godGhpcy5fY2JzLGZ1bmN0aW9uKF85KXsKaWYoXzlbMl0pewpfOVsyXShwKTsKfQp9KTsKcmV0dXJuIHRoaXM7Cn0sdGhlbjpmdW5jdGlvbihfYSxfYixfYyl7CnZhciBwPW5ldyBpJC5Qcm9taXNlKCk7CnRoaXMuX2Nicy5wdXNoKFtmdW5jdGlvbih2KXsKdHJ5ewppZihfYSl7CnZhciBydj1fYSh2KTsKaWYocnYhPT11bmRlZmluZWQpewp2PXJ2Owp9Cn0KcC5yZXNvbHZlKHYpOwp9CmNhdGNoKGV4Yyl7CnAucmVqZWN0KGV4Yyk7Cn0KfSxmdW5jdGlvbihlKXsKdmFyIHJ2PWU7CnRyeXsKaWYoX2Ipewpydj1fYihlKTsKaWYocnY9PT11bmRlZmluZWQpewpydj1lOwp9Cn0KfQpjYXRjaChleGMpewpydj1leGM7Cn0KcC5yZWplY3QocnYpOwp9LF9jXSk7CmlmKHRoaXMuX3N0YXQhPT0tMSl7CnRoaXMuX2NiaygpOwp9CnJldHVybiBwOwp9LGNhbGw6ZnVuY3Rpb24oX2QsX2UpewpyZXR1cm4gdGhpcy5fZGVsZWdhdGUoZnVuY3Rpb24ocCxfZil7CmlmKF9mJiZpJC5pc0Z1bmN0aW9uKF9mW19kXSkpewpwLnJlc29sdmUoX2ZbX2RdLmFwcGx5KF9mLF9lKSk7Cn1lbHNlewpwLnJlamVjdChuZXcgRXJyb3IoX2QrIiBpcyBub3QgYSBmdW5jdGlvbiBvbiAiK28pKTsKfQp9KTsKfSxnZXQ6ZnVuY3Rpb24oXzEwKXsKcmV0dXJuIHRoaXMuX2RlbGVnYXRlKGZ1bmN0aW9uKHAsXzExKXsKaWYoXzExKXsKcC5yZXNvbHZlKF8xMVtfMTBdKTsKfWVsc2V7CnAucmVqZWN0KG5ldyBFcnJvcihfMTErIiBpcyBudWxsIG9yIHVuZGVmaW5lZCIpKTsKfQp9KTsKfX07CmkkLm9uTG9hZFByb21pc2U9bmV3IGkkLlByb21pc2UoKTsKaSQuYWRkT25Mb2FkKGZ1bmN0aW9uKCl7CmkkLm9uTG9hZFByb21pc2UucmVzb2x2ZSh0cnVlKTsKfSk7Cn0pKCk7CihmdW5jdGlvbigpewp2YXIgaSQ9d2luZG93LmkkOwppJC5nZXRYSFI9dHlwZW9mIFhNTEh0dHBSZXF1ZXN0IT09InVuZGVmaW5lZCI/ZnVuY3Rpb24oKXsKcmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpOwp9OmZ1bmN0aW9uKCl7CnJldHVybiBuZXcgQWN0aXZlWE9iamVjdCgiTVNYTUwyLlhNTEhUVFAuMy4wIik7Cn07CmkkLnRvUXVlcnk9ZnVuY3Rpb24obyl7CnZhciBxPVtdOwp2YXIgZW5jPWVuY29kZVVSSUNvbXBvbmVudDsKaSQuZWFjaChvLGZ1bmN0aW9uKHYsayl7CnZhciBrZXk9ZW5jKGspKyI9IjsKaWYoaSQuaXNTdHJpbmcodikpewpxLnB1c2goa2V5K2VuYyh2KSk7Cn1lbHNlewppZihpJC5pc0FycmF5KHYpKXsKdmFyIGtleT1lbmMoaykrIj0iOwppJC5lYWNoKHYsZnVuY3Rpb24oYXYsaSl7CnEucHVzaChrZXkrZW5jKGF2KSk7Cn0pOwp9Cn0KfSk7CnJldHVybiBxLmpvaW4oIiYiKTsKfTsKaSQuYWRkUXVlcnlTdHJpbmc9ZnVuY3Rpb24odSxvKXsKaWYobyl7CnZhciBwPXUmJnUuaW5kZXhPZigiPyIpIT09LTEsdD1wPyImIjoiPyI7CnUrPXQraSQudG9RdWVyeShvKTsKfQpyZXR1cm4gdTsKfTsKaSQuZnJvbVF1ZXJ5PWZ1bmN0aW9uKHEpewp2YXIgbz17fTsKdmFyIGRlYz1kZWNvZGVVUklDb21wb25lbnQ7CmkkLmVhY2gocS5zcGxpdCgiJiIpLGZ1bmN0aW9uKGF2LGkpewp2YXIgcD1hdi5zcGxpdCgiPSIpLGs9ZGVjKHBbMF0pLHY9ZGVjKHBbMV0pLGN2PW9ba107CmlmKGN2KXsKaWYoIWkkLmlzQXJyYXkoY3YpKXsKY3Y9b1trXT1bY3ZdOwp9CmN2LnB1c2godik7Cn1lbHNlewpvW2tdPXY7Cn0KfSk7CnJldHVybiBvOwp9OwppJC54aHI9ZnVuY3Rpb24oXzEyLF8xMyl7CnZhciBfMTI9XzEyfHwiR0VUIixfMTQ9bmV3IGkkLlByb21pc2UoKSx1cmw9XzEzLnVybHx8IiIsXzE1PV8xMy5zeW5jfHxmYWxzZSxjYj1fMTMuY2FsbGJhY2t8fGZ1bmN0aW9uKCl7Cn0sXzE2PV8xMy5yZXNwb25zZVR5cGV8fCJ0ZXh0IixfMTc9XzEzLnBvc3REYXRhfHxudWxsLF8xOD1fMTMudGltZW91dHx8bnVsbCx4aHI9aSQuZ2V0WEhSKCksXzE5PWZhbHNlLF8xYT1mYWxzZTsKdmFyIF8xYj1mdW5jdGlvbigpewppZih4aHIucmVhZHlTdGF0ZT09PTQpewp4aHIub25yZWFkeXN0YXRlY2hhbmdlPWkkLmlzSUU8PTg/bmV3IEZ1bmN0aW9uKCk6bnVsbDsKdmFyIF8xYz1mdW5jdGlvbigpewppZih4aHIuc3RhdHVzPj00MDApewp2YXIgZXJyPW5ldyBFcnJvcih4aHIuc3RhdHVzKyI6ICIreGhyLnJlc3BvbnNlVGV4dCk7CnRyeXsKY2IoZXJyLHhocik7Cn0KZmluYWxseXsKaWYoIV8xOSl7Cl8xOT10cnVlOwpfMTQucmVqZWN0KHtkYXRhOmVycix4aHI6eGhyfSk7Cn0KfQp9ZWxzZXsKdHJ5ewp2YXIgcmV0PSIiOwppZihpJC54aHJGbXRzW18xNl0pewpyZXQ9aSQueGhyRm10c1tfMTZdKHhocik7Cn0KfQpjYXRjaChlcnIpewpjYihlcnIseGhyKTsKcmV0dXJuOwp9CnRyeXsKY2IocmV0LHhocik7Cn0KZmluYWxseXsKaWYoIV8xOSl7Cl8xOT10cnVlOwpfMTQucmVzb2x2ZSh7ZGF0YTpyZXQseGhyOnhocn0pOwp9Cn0KfQp9OwppZih4aHIudGltZW91dCl7CndpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CmlmKCFfMWEpewpfMWMoKTsKfQp9LDApOwp9ZWxzZXsKXzFjKCk7Cn0KfQp9OwppZighXzE1KXsKeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZT1fMWI7Cn0KeGhyLm9wZW4oXzEyLHVybCwhXzE1KTsKaSQuZWFjaChfMTMuaGVhZGVycyxmdW5jdGlvbih2LGspewp4aHIuc2V0UmVxdWVzdEhlYWRlcihrLHYpOwp9KTsKaWYoXzE4KXsKeGhyLnRpbWVvdXQ9XzE4Owp4aHIub250aW1lb3V0PWZ1bmN0aW9uKCl7Cl8xYT10cnVlOwppZighXzE5KXsKXzE5PXRydWU7Cl8xNC5yZWplY3Qoe2RhdGE6InRpbWVvdXQiLHhocjp4aHJ9KTsKfQp9Owp9Cnhoci5zZW5kKF8xNyk7CmlmKF8xNSl7Cl8xYigpOwp9CnJldHVybiBfMTQ7Cn07CmkkLmVhY2goWyJHZXQiLCJQdXQiLCJQb3N0IiwiRGVsZXRlIl0sZnVuY3Rpb24obSl7CmkkWyJ4aHIiK21dPWkkLnBhcnRpYWwoaSQueGhyLG0udG9VcHBlckNhc2UoKSk7Cn0pOwppJC5sb2FkU2NyaXB0PWZ1bmN0aW9uKF8xZCl7CnZhciBfMWU9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXSxfMWY9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0IiksXzIwPW5ldyBpJC5Qcm9taXNlKCksXzIxPWZhbHNlLF8yMj1mdW5jdGlvbihfMjMsXzI0KXsKXzFmLm9ucmVhZHlzdGF0ZWNoYW5nZT1fMWYub25sb2FkPW51bGw7Cl8yMT10cnVlOwpfMjBbXzIzPyJyZXNvbHZlIjoicmVqZWN0Il0oXzI0KTsKaWYoXzFkLmNhbGxiYWNrKXsKXzFkLmNhbGxiYWNrKF8yMyxfMjQpOwp9Cl8xZS5yZW1vdmVDaGlsZChfMWYpOwpfMWY9bnVsbDsKfTsKXzFmLnR5cGU9InRleHQvamF2YXNjcmlwdCI7Cl8xZi5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXsKaWYodGhpcy5yZWFkeVN0YXRlPT09ImxvYWRlZCJ8fHRoaXMucmVhZHlTdGF0ZT09PSJjb21wbGV0ZSIpewpfMjIodHJ1ZSk7Cn0KfTsKXzFmLm9ubG9hZD1mdW5jdGlvbigpewpfMjIodHJ1ZSk7Cn07CmkkLmVhY2goXzFkLnNjcmlwdEF0dHJzLGZ1bmN0aW9uKHYsayl7CmlmKHYhPW51bGwpewpfMWYuc2V0QXR0cmlidXRlKGssdik7Cn0KfSk7Cl8xZi5zcmM9XzFkLnVybDsKXzFlLmFwcGVuZENoaWxkKF8xZik7CmlmKF8xZC50aW1lb3V0KXsKc2V0VGltZW91dChmdW5jdGlvbigpewppZighXzIxKXsKXzIyKGZhbHNlLG5ldyBFcnJvcigiVGltZW91dCBleGNlZWRlZCIpKTsKfQp9LF8xZC50aW1lb3V0KTsKfQpyZXR1cm4gXzIwOwp9Owp9KSgpOwooZnVuY3Rpb24oKXsKdmFyIGkkPXdpbmRvdy5pJDsKaWYodHlwZW9mIChKU09OKSE9InVuZGVmaW5lZCImJkpTT04ucGFyc2UpewppJC5mcm9tSnNvbj1mdW5jdGlvbihzdHIpewpyZXR1cm4gSlNPTi5wYXJzZShzdHIpOwp9OwppJC50b0pzb249ZnVuY3Rpb24ob2JqLF8yNSl7CnJldHVybiBKU09OLnN0cmluZ2lmeShvYmosbnVsbCxfMjU/Ilx0IjoiIik7Cn07Cn1lbHNlewppJC5mcm9tSnNvbj1mdW5jdGlvbihzdHIpewpyZXR1cm4gZXZhbChbIigiLHN0ciwiKSJdLmpvaW4oIiIpKTsKfTsKdmFyIF8yNj1mdW5jdGlvbihzdHIpewpyZXR1cm4gWyJcIiIsc3RyLnJlcGxhY2UoL1tcXF0vZywiXFxcXCIpLnJlcGxhY2UoL1siXS9nLCJcXFwiIikucmVwbGFjZSgvW1xyXS9nLCJcXHIiKS5yZXBsYWNlKC9bXG5dL2csIlxcbiIpLnJlcGxhY2UoL1tcYl0vZywiXFxiIikucmVwbGFjZSgvW1x0XS9nLCJcXHQiKS5yZXBsYWNlKC9bXGZdL2csIlxcZiIpLCJcIiJdLmpvaW4oIiIpOwp9LF8yNz1mdW5jdGlvbihvYmoscCxfMjgsXzI5KXsKdmFyIGFwLF8yYTsKaWYoXzI4KXsKXzI5PV8yOXx8IiI7Cl8yYT1fMjkrIlx0IjsKfQppZihvYmo9PT1udWxsKXsKcC5wdXNoKCJudWxsIik7Cn1lbHNlewppZihvYmo9PT11bmRlZmluZWQpewpwLnB1c2goInVuZGVmaW5lZCIpOwp9ZWxzZXsKaWYoaSQuaXNCb29sZWFuKG9iail8fGkkLmlzTnVtYmVyKG9iaikpewpwLnB1c2gob2JqKTsKfWVsc2V7CmlmKGkkLmlzU3RyaW5nKG9iaikpewpwLnB1c2goXzI2KG9iaikpOwp9ZWxzZXsKaWYoaSQuaXNGdW5jdGlvbihvYmoudG9Kc29uKSl7CnAucHVzaChvYmoudG9Kc29uKCkpOwp9ZWxzZXsKaWYoaSQuaXNBcnJheShvYmopKXsKcC5wdXNoKCJbIik7CmFwPVtdOwppJC5lYWNoKG9iaixmdW5jdGlvbihlbCl7CnZhciBfMmI9W107Cl8yNyhlbCxfMmIsXzI4LF8yYSk7CmFwLnB1c2goXzJiLmpvaW4oIiIpKTsKfSk7CmlmKGFwLmxlbmd0aD4wKXsKaWYoXzI4KXsKcC5wdXNoKCJcbiIrXzJhKTsKfQpwLnB1c2goYXAuam9pbihfMjg/IixcbiIrXzJhOiIsIikpOwppZihfMjgpewpwLnB1c2goIlxuIitfMjkpOwp9Cn0KcC5wdXNoKCJdIik7Cn1lbHNlewppZihpJC5pc09iamVjdChvYmopKXsKcC5wdXNoKCJ7Iik7CmFwPVtdOwppJC5lYWNoKG9iaixmdW5jdGlvbihlbCxrZXkpewp2YXIgXzJjPVtfMjYoa2V5KSwiOiAiXTsKXzI3KGVsLF8yYyxfMjgsXzJhKTsKYXAucHVzaChfMmMuam9pbigiIikpOwp9KTsKaWYoYXAubGVuZ3RoPjApewppZihfMjgpewpwLnB1c2goIlxuIitfMmEpOwp9CnAucHVzaChhcC5qb2luKF8yOD8iLFxuIitfMmE6IiwiKSk7CmlmKF8yOCl7CnAucHVzaCgiXG4iK18yOSk7Cn0KfQpwLnB1c2goIn0iKTsKfQp9Cn0KfQp9Cn0KfQp9OwppJC50b0pzb249ZnVuY3Rpb24ob2JqLF8yZCl7CnZhciBwPVtdOwpfMjcob2JqLHAsXzJkKTsKcmV0dXJuIHAuam9pbigiIik7Cn07Cn0KaSQueGhyRm10cy5qc29uPWZ1bmN0aW9uKHhocil7CnJldHVybiBpJC5mcm9tSnNvbih4aHIucmVzcG9uc2VUZXh0KTsKfTsKfSkoKTsKKGZ1bmN0aW9uKCl7CnZhciBpJD13aW5kb3cuaSQ7CnZhciBfMmU9ZnVuY3Rpb24oKXsKdGhpcy5fZXZ0cz17fTsKfSxfMmY9ZnVuY3Rpb24oXzMwLF8zMSl7CnJldHVybiBfMzAuX2V2dHNbXzMxXXx8KF8zMC5fZXZ0c1tfMzFdPXtsOltdLGI6W119KTsKfSxhZGQ9ZnVuY3Rpb24oXzMyLF8zMyxfMzQsZm4pewp2YXIgZT1fMmYoXzMyLF8zMyksYz1lW18zNF0ucHVzaChmbik7CnJldHVybiBbXzMzLF8zNCxjLTFdOwp9LF8zNT1mdW5jdGlvbihfMzYsXzM3KXsKdmFyIGU9XzJmKF8zNixfMzdbMF0pOwpkZWxldGUgZVtfMzdbMV1dW18zN1syXV07Cn0sXzM4PWZ1bmN0aW9uKGV2dCxfMzksXzNhKXsKdmFyIF8zYj1ldnQuYixfM2E9XzNhfHwwLGIscjsKZm9yKHZhciBpPV8zYTtpPF8zYi5sZW5ndGg7aSsrKXsKYj1fM2JbaV07CmlmKGIpewpfMzk9dHlwZW9mIF8zOT09PSJ1bmRlZmluZWQiP1tdOl8zOTsKcj1iLmFwcGx5KG51bGwsXzM5fHxbXSk7CmlmKGkkLnByb21pc2UuaXNQcm9taXNlKHIpKXsKcmV0dXJuIHIudGhlbihmdW5jdGlvbihfM2MpewppZihfM2MhPT1mYWxzZSl7CnJldHVybiBfMzgoZXZ0LF8zOSxpKzEpOwp9CnJldHVybiBfM2M7Cn0pOwp9Cn0KfQp9LF8zZD1mdW5jdGlvbihldnQsXzNlKXsKdmFyIF8zZj1ldnQubCxsOwpmb3IodmFyIGk9MDtpPF8zZi5sZW5ndGg7aSsrKXsKbD1fM2ZbaV07CmlmKGwpewpsLmFwcGx5KG51bGwsXzNlfHxbXSk7Cn0KfQp9LF80MD1mdW5jdGlvbihfNDEsXzQyLF80Myl7CnZhciBlPV8yZihfNDEsXzQyKTsKcmV0dXJuIGkkLndoZW4oXzM4KGUsXzQzKSkudGhlbihmdW5jdGlvbihfNDQpewppZihfNDQhPT1mYWxzZSl7Cl8zZChlLF80Myk7Cn0KcmV0dXJuIF80NDsKfSk7Cn07CmkkLmF1Z21lbnQoXzJlLHthZGRMaXN0ZW5lcjpmdW5jdGlvbihfNDUsZm4pewpyZXR1cm4gYWRkKHRoaXMsXzQ1LCJsIixmbik7Cn0scmVtb3ZlTGlzdGVuZXI6ZnVuY3Rpb24oXzQ2KXsKcmV0dXJuIF8zNSh0aGlzLF80Nik7Cn0sYWRkQnJva2VyOmZ1bmN0aW9uKF80Nyxmbil7CnJldHVybiBhZGQodGhpcyxfNDcsImIiLGZuKTsKfSxyZW1vdmVCcm9rZXI6ZnVuY3Rpb24oXzQ4KXsKcmV0dXJuIF8zNSh0aGlzLF80OCk7Cn0sZmlyZUV2ZW50OmZ1bmN0aW9uKF80OSxfNGEpewpyZXR1cm4gXzQwKHRoaXMsXzQ5LF80YSk7Cn19KTsKdmFyIF80Yj1uZXcgXzJlKCk7CmkkLmVhY2goWyJhZGRMaXN0ZW5lciIsInJlbW92ZUxpc3RlbmVyIiwiYWRkQnJva2VyIiwicmVtb3ZlQnJva2VyIiwiZmlyZUV2ZW50Il0sZnVuY3Rpb24obil7CmkkW25dPWkkLnNjb3BlKF80YixuKTsKfSk7Cn0pKCk7CihmdW5jdGlvbigpewp2YXIgaSQ9d2luZG93LmkkOwp2YXIgXzRjPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwppJC5ieUlkPWZ1bmN0aW9uKGlkKXsKaWYoaSQuaXNOb2RlKGlkKSl7CnJldHVybiBpZDsKfWVsc2V7CnJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7Cn0KfTsKaSQuY3JlYXRlRG9tPWZ1bmN0aW9uKF80ZCxfNGUsXzRmKXsKdmFyIGVsPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXzRkKTsKaSQuZWFjaChfNGUsZnVuY3Rpb24odixrKXsKZWwuc2V0QXR0cmlidXRlKGssdik7Cn0pOwppZihfNGYpewpfNGYuYXBwZW5kQ2hpbGQoZWwpOwp9CnJldHVybiBlbDsKfTsKdmFyIF81MD1fNGMuYWRkRXZlbnRMaXN0ZW5lcj9mdW5jdGlvbihuKXsKcmV0dXJuIG4uaW5kZXhPZigib24iKT09MD9uLnN1YnN0cigyKTpuOwp9OmZ1bmN0aW9uKG4pewpyZXR1cm4gbi5pbmRleE9mKCJvbiIpIT0wPyJvbiIrbjpuOwp9LGFkZD1fNGMuYWRkRXZlbnRMaXN0ZW5lcj9mdW5jdGlvbihfNTEsXzUyLGYpewpfNTEuYWRkRXZlbnRMaXN0ZW5lcihfNTIsZixmYWxzZSk7Cn06ZnVuY3Rpb24oXzUzLF81NCxmKXsKXzUzLmF0dGFjaEV2ZW50KF81NCxmKTsKfSxfNTU9XzRjLnJlbW92ZUV2ZW50TGlzdGVuZXI/ZnVuY3Rpb24oXzU2LF81NyxmKXsKXzU2LnJlbW92ZUV2ZW50TGlzdGVuZXIoXzU3LGYsZmFsc2UpOwp9OmZ1bmN0aW9uKF81OCxfNTksZil7Cl81OC5kZXRhY2hFdmVudChfNTksZik7Cn07CmkkLmlzRGVzY2VuZGFudD1mdW5jdGlvbihfNWEsYW5jKXsKaWYoYW5jKXsKd2hpbGUoXzVhKXsKaWYoXzVhPT1hbmMpewpyZXR1cm4gdHJ1ZTsKfQpfNWE9XzVhLnBhcmVudE5vZGU7Cn0KfQpyZXR1cm4gZmFsc2U7Cn07CmkkLmJpbmREb21FdnQ9ZnVuY3Rpb24oXzViLF81YyxmKXsKXzVjPV81MChfNWMpOwppZigoXzVjPT0ibW91c2VsZWF2ZSJ8fF81Yz09Im1vdXNlZW50ZXIiKSYmIWkkLmlzSUUpewp2YXIgZnA9ZjsKXzVjPV81Yz09Im1vdXNlbGVhdmUiPyJtb3VzZW91dCI6Im1vdXNlb3ZlciI7CmY9ZnVuY3Rpb24oZSl7CmlmKCFpJC5pc0Rlc2NlbmRhbnQoZS5yZWxhdGVkVGFyZ2V0LF81YikpewpyZXR1cm4gZnAuY2FsbCh0aGlzLGUpOwp9Cn07Cn0KYWRkKF81YixfNWMsZik7CnJldHVybiBbXzViLF81YyxmXTsKfTsKaSQudW5iaW5kRG9tRXZ0PWZ1bmN0aW9uKF81ZCl7CmlmKF81ZFswXSl7Cl81NShfNWRbMF0sXzVkWzFdLF81ZFsyXSk7Cn0KXzVkLnNwbGljZSgwLDMpOwp9OwppZigiY2xhc3NMaXN0IiBpbiBfNGMpewppJC5tYXNoKGkkLHthZGRDbGFzczpmdW5jdGlvbihfNWUsXzVmKXsKXzVlJiZfNWUuY2xhc3NMaXN0JiZfNWUuY2xhc3NMaXN0LmFkZChfNWYpOwp9LHJlbW92ZUNsYXNzOmZ1bmN0aW9uKF82MCxfNjEpewpfNjAmJl82MC5jbGFzc0xpc3QmJl82MC5jbGFzc0xpc3QucmVtb3ZlKF82MSk7Cn0saGFzQ2xhc3M6ZnVuY3Rpb24oXzYyLF82Myl7CnJldHVybiBfNjImJl82Mi5jbGFzc0xpc3QmJl82Mi5jbGFzc0xpc3QuY29udGFpbnMoXzYzKTsKfSx0b2dnbGVDbGFzczpmdW5jdGlvbihfNjQsXzY1KXsKXzY0JiZfNjQuY2xhc3NMaXN0JiZfNjQuY2xhc3NMaXN0LnRvZ2dsZShfNjUpOwp9fSk7Cn1lbHNlewp2YXIgXzY2PWZ1bmN0aW9uKHN0cixfNjcpewppZighc3RyKXsKcmV0dXJuIC0xOwp9CnZhciBsZW49XzY3Lmxlbmd0aCxpPXN0ci5pbmRleE9mKF82NyksXzY4LF82OTsKd2hpbGUoaT4tMSl7Cl82OT1zdHIuY2hhckF0KGkrbGVuKTsKXzY4PXN0ci5jaGFyQXQoaS0xKTsKaWYoKCFfNjl8fF82OT09IiAiKSYmKCFfNjh8fF82OD09IiAiKSl7CmJyZWFrOwp9Cmk9c3RyLmluZGV4T2YoXzY3LGkrMSk7Cn0KcmV0dXJuIGk7Cn07CmkkLm1hc2goaSQse2FkZENsYXNzOmZ1bmN0aW9uKF82YSxfNmIpewppZighXzZhKXsKcmV0dXJuOwp9CmlmKF82NihfNmEuY2xhc3NOYW1lLF82Yik8MCl7Cl82YS5jbGFzc05hbWUrPSIgIitfNmI7Cn0KfSxyZW1vdmVDbGFzczpmdW5jdGlvbihfNmMsXzZkKXsKaWYoIV82Yyl7CnJldHVybjsKfQp2YXIgc3RyPV82Yy5jbGFzc05hbWUsbGVuPV82ZC5sZW5ndGgsaT1fNjYoc3RyLF82ZCksdmFsPVtdOwppZihpPi0xKXsKaWYoaT4wKXsKdmFsLnB1c2goc3RyLnN1YnN0cmluZygwLGkpKTsKfQppZihzdHIubGVuZ3RoPmkrbGVuKXsKdmFsLnB1c2goc3RyLnN1YnN0cihpK2xlbikpOwp9Cl82Yy5jbGFzc05hbWU9aSQudHJpbSh2YWwuam9pbigpKTsKfQp9LGhhc0NsYXNzOmZ1bmN0aW9uKF82ZSxfNmYpewppZighXzZlKXsKcmV0dXJuOwp9CnJldHVybiBfNjYoXzZlLmNsYXNzTmFtZSxfNmYpPi0xOwp9LHRvZ2dsZUNsYXNzOmZ1bmN0aW9uKF83MCxfNzEpewppZighXzcwKXsKcmV0dXJuOwp9CmkkW2kkLmhhc0NsYXNzKF83MCxfNzEpPyJyZW1vdmVDbGFzcyI6ImFkZENsYXNzIl0oXzcwLF83MSk7Cn19KTsKfQp9KSgpOwooZnVuY3Rpb24oKXsKdmFyIGkkPXdpbmRvdy5pJDsKdmFyIF83Mj0vKFteX10rKV8oW15fXSspX2RlZmVycmVkXz8oW1xkXSspPy8sXzczPS9hbHRlcm5hdGUvaSxfNzQ9ZnVuY3Rpb24odCl7CnJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0KTsKfSxfNzU9ZnVuY3Rpb24oKXsKcmV0dXJuIF83NCgiaGVhZCIpWzBdOwp9LF83Nj1mdW5jdGlvbih1cmwpewppJC5jcmVhdGVEb20oImxpbmsiLHtyZWw6InN0eWxlc2hlZXQiLHR5cGU6InRleHQvY3NzIixocmVmOnVybH0sXzc1KCkpOwpyZXR1cm4gaSQucHJvbWlzZS5yZXNvbHZlZCgpOwp9LF83Nz1mdW5jdGlvbih1cmwpewpyZXR1cm4gaSQubG9hZFNjcmlwdCh7dXJsOnVybH0pOwp9LF83OD1mdW5jdGlvbihtb2QpewpyZXR1cm4gaSQueGhyR2V0KHt1cmw6bW9kLnVybCxoZWFkZXJzOnsiWC1JQk0tWEhSIjoidHJ1ZSJ9LHJlc3BvbnNlVHlwZToidGV4dCJ9KS50aGVuKGZ1bmN0aW9uKF83OSl7CnJldHVybiB7bW9kOm1vZCxkYXRhOl83OS5kYXRhfTsKfSk7Cn0sXzdhPWZ1bmN0aW9uKF83Yil7CmkkLmVhY2goXzdiLGZ1bmN0aW9uKF83Yyl7CnZhciBtPV83Yy5tb2Q7CnZhciBfN2Q9bS5ub2RlLnBhcmVudE5vZGU7CnZhciBfN2U9bS5wIT0iaGVhZCI/bS5ub2RlOm51bGw7CnZhciBfN2Y9ZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLHRtcD1pJC5jcmVhdGVEb20oImRpdiIpOwp0bXAuaW5uZXJIVE1MPV83Yy5kYXRhOwp3aGlsZSh0bXAuZmlyc3RDaGlsZCl7Cl83Zi5hcHBlbmRDaGlsZCh0bXAuZmlyc3RDaGlsZCk7Cn0KXzdkLmluc2VydEJlZm9yZShfN2YsXzdlKTsKfSk7Cn0sXzgwPWZ1bmN0aW9uKF84MSl7CmlmKF83My50ZXN0KF84MS5yZWwpKXsKdmFyIGlkPV84MS5pZCxfODI9aWQubWF0Y2goXzcyKTsKaWYoXzgyKXsKcmV0dXJuIHtub2RlOl84MSx1cmw6XzgxLmhyZWYsaWQ6aWQscDpfODJbMV0sdDpfODJbMl0saTpfODJbM119Owp9Cn0KfSxfODM9ZnVuY3Rpb24oKXsKdmFyIG09e2hlYWQ6W10sY29uZmlnOltdfSxfODQ9e30sXzg1PXtsZW5ndGg6MH0sXzg2PV83NCgibGluayIpLF84Nz1fNzQoImEiKTsKaSQuZWFjaChbXzg2LF84N10sZnVuY3Rpb24oXzg4KXsKaSQuZWFjaChfODgsZnVuY3Rpb24oXzg5KXsKdmFyIG1vZD1fODAoXzg5KTsKaWYobW9kJiYhXzg0W21vZC5pZF0pewpfODRbbW9kLmlkXT1tb2Q7CmlmKCFfODVbbW9kLnRdKXsKXzg1W21vZC50XT1bXTsKXzg1Lmxlbmd0aD1fODUubGVuZ3RoKzE7Cn0KXzg1W21vZC50XS5wdXNoKG1vZCk7Cn0KfSk7Cn0pOwpyZXR1cm4gXzg1Owp9LF84YT1mdW5jdGlvbihfOGIpewp2YXIgXzhjPVtdOwp2YXIgXzhkPVtdOwppJC5lYWNoKF84YlsibWFya3VwIl0sZnVuY3Rpb24obW9kKXsKXzhkLnB1c2goXzc4KG1vZCkpOwp9KTsKcmV0dXJuIGkkLndoZW5BbGwuYXBwbHkodGhpcyxfOGQpLnRoZW4oZnVuY3Rpb24oXzhlKXsKXzhjPV84ZTsKXzhkPVtdOwppJC5lYWNoKF84YlsiY3NzIl0sZnVuY3Rpb24obW9kKXsKXzhkLnB1c2goXzc2KG1vZC51cmwpKTsKfSk7CnJldHVybiBpJC53aGVuQWxsLmFwcGx5KHRoaXMsXzhkKTsKfSxmdW5jdGlvbihlcnIpewpjb25zb2xlLmxvZygiRXJyb3I6ICIsZXJyKTsKfSkudGhlbihmdW5jdGlvbihfOGYpewpyZXR1cm4gXzkwKF84YlsianMiXSk7Cn0pLnRoZW4oZnVuY3Rpb24oKXsKXzdhKF84Yyk7Cn0pOwp9LF85MD1mdW5jdGlvbihfOTEpewp2YXIgbT1fOTEuc2hpZnQoKSxwOwppZihtKXsKcD1fNzcobS51cmwpOwp9CnJldHVybiBpJC53aGVuKHApLnRoZW4oZnVuY3Rpb24oKXsKcmV0dXJuIF85MS5sZW5ndGg+MD9fOTAoXzkxKTp0cnVlOwp9LGZ1bmN0aW9uKGVycil7CmNvbnNvbGUubG9nKCJFcnJvcjogIixlcnIpOwp9KTsKfSxfOTI9ZmFsc2UsXzkzPW51bGwsXzk0PWZhbHNlLF85NT1mYWxzZSxfOTY9bmV3IGkkLlByb21pc2UoKSxfOTc9ZnVuY3Rpb24oY2JrKXsKaSQuYWRkT25Mb2FkKGZ1bmN0aW9uKCl7CmlmKCFfOTIpewpfOTM9XzgzKCk7Cl85ND1fOTMubGVuZ3RoPjA/ZmFsc2U6dHJ1ZTsKaWYoXzk0KXsKXzk2LnJlc29sdmUoKTsKfQpfOTI9dHJ1ZTsKfQppZihjYmspewpjYmsoKTsKfQp9KTsKfTsKaSQubW9kdWxlcz17fTsKaSQubWFzaChpJC5tb2R1bGVzLHthcmVMb2FkZWQ6ZnVuY3Rpb24oKXsKcmV0dXJuIF85NDsKfSxhcmVMb2FkaW5nOmZ1bmN0aW9uKCl7CnJldHVybiBfOTU7Cn0sbG9hZERlZmVycmVkOmZ1bmN0aW9uKCl7CmlmKF85NSl7CnJldHVybiBfOTY7Cn0KdmFyIGNiaz1mdW5jdGlvbigpewppZighXzk0KXsKXzk1PXRydWU7Cl84YShfOTMpLnRoZW4oZnVuY3Rpb24oKXsKXzk0PXRydWU7Cl85NT1mYWxzZTsKXzk2LnJlc29sdmUoKTsKfSxmdW5jdGlvbihlKXsKXzk2LnJlamVjdChlKTsKfSk7Cn0KfTsKXzk3KGNiayk7CnJldHVybiBfOTY7Cn0sYWRkQWZ0ZXJMb2FkZWQ6ZnVuY3Rpb24oZil7CnZhciBjYms9ZnVuY3Rpb24oKXsKXzk2LnRoZW4oZik7Cn07Cl85NyhjYmspOwp9fSk7CnZhciBfOTg9aSQuYWRkT25Mb2FkLF85OT1bXTsKaSQuYWRkT25Mb2FkPWZ1bmN0aW9uKGYsbyl7CmlmKF85NSl7CmlmKG8pewpmPWkkLnNjb3BlKG8sZik7Cn0KXzk5LnB1c2goZik7Cn1lbHNlewpfOTgoZixvKTsKfQp9OwppJC5tb2R1bGVzLmFkZEFmdGVyTG9hZGVkKGZ1bmN0aW9uKCl7CndoaWxlKF85OS5sZW5ndGg+MCl7CmlmKGZuPV85OS5zaGlmdCgpKXsKZm4oKTsKfQp9Cn0pOwp9KSgpOwooZnVuY3Rpb24oKXsKdmFyIGkkPXdpbmRvdy5pJDsKaSQuZ2V0Q29va2llPWZ1bmN0aW9uKG4pewp2YXIgY3M9ZG9jdW1lbnQuY29va2llLnNwbGl0KCI7IiksYz0iIixfOWE9MCxjbj0iIixjdj1udWxsOwpmb3IodmFyIGk9MDtpPGNzLmxlbmd0aDtpKyspewpjPWNzW2ldOwpfOWE9Yy5pbmRleE9mKCI9Iik7CmNuPV85YTwwP251bGw6aSQudHJpbShjLnN1YnN0cmluZygwLF85YSkpOwppZihjbj09bil7CmlmKGMubGVuZ3RoPjEpewpjdj1fOWE8MD9udWxsOmkkLnRyaW0oYy5zdWJzdHJpbmcoXzlhKzEsYy5sZW5ndGgpKTsKfQpyZXR1cm4gY3Y7Cn0KfQpyZXR1cm4gbnVsbDsKfTsKaSQuc2V0Q29va2llPWZ1bmN0aW9uKG4sdixlLHAsZCxzKXsKaWYoIWUpewp2YXIgbT1uZXcgRGF0ZSgpLmdldFRpbWUoKTsKbSs9KDEwMDAqNjAqNjAqMjQqMzY1KjEwMCk7CmU9bmV3IERhdGUobSk7Cn0KdmFyIGM9bisiPSIrdisoKGUpPyI7IGV4cGlyZXM9IitlLnRvR01UU3RyaW5nKCk6IiIpKygocCk/IjsgcGF0aD0iK3A6IjsgcGF0aD0vIikrKChkKT8iOyBkb21haW49IitkOiIiKSsoKHMpPyI7IHNlY3VyZSI6IiIpOwpkb2N1bWVudC5jb29raWU9YzsKfTsKaSQuZGVsZXRlQ29va2llPWZ1bmN0aW9uKG4scCxkKXsKaWYoaSQuZ2V0Q29va2llKG4pKXsKZG9jdW1lbnQuY29va2llPW4rIj0iKygocCk/IjsgcGF0aD0iK3A6IjsgcGF0aD0vIikrKChkKT8iOyBkb21haW49IitkOiIiKSsiOyBleHBpcmVzPVRodSwgMDEtSmFuLTcwIDAwOjAwOjAxIEdNVCI7Cn0KfTsKfSkoKTsKCgp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnd3BfY2xpZW50X2V4dCc6ICIsZSk7fQp0cnl7LyohCiAqIEJvb3RzdHJhcCB2My4wLjMgKGh0dHA6Ly9nZXRib290c3RyYXAuY29tKQogKiBDb3B5cmlnaHQgMjAxMyBUd2l0dGVyLCBJbmMuCiAqIExpY2Vuc2VkIHVuZGVyIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKi8KCmlmKCJ1bmRlZmluZWQiPT10eXBlb2YgalF1ZXJ5KXRocm93IG5ldyBFcnJvcigiQm9vdHN0cmFwIHJlcXVpcmVzIGpRdWVyeSIpOytmdW5jdGlvbihhKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gYigpe3ZhciBhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJvb3RzdHJhcCIpLGI9e1dlYmtpdFRyYW5zaXRpb246IndlYmtpdFRyYW5zaXRpb25FbmQiLE1velRyYW5zaXRpb246InRyYW5zaXRpb25lbmQiLE9UcmFuc2l0aW9uOiJvVHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCIsdHJhbnNpdGlvbjoidHJhbnNpdGlvbmVuZCJ9O2Zvcih2YXIgYyBpbiBiKWlmKHZvaWQgMCE9PWEuc3R5bGVbY10pcmV0dXJue2VuZDpiW2NdfX1hLmZuLmVtdWxhdGVUcmFuc2l0aW9uRW5kPWZ1bmN0aW9uKGIpe3ZhciBjPSExLGQ9dGhpczthKHRoaXMpLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsZnVuY3Rpb24oKXtjPSEwfSk7dmFyIGU9ZnVuY3Rpb24oKXtjfHxhKGQpLnRyaWdnZXIoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kKX07cmV0dXJuIHNldFRpbWVvdXQoZSxiKSx0aGlzfSxhKGZ1bmN0aW9uKCl7YS5zdXBwb3J0LnRyYW5zaXRpb249YigpfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpeyJ1c2Ugc3RyaWN0Ijt2YXIgYj0nW2RhdGEtZGlzbWlzcz0iYWxlcnQiXScsYz1mdW5jdGlvbihjKXthKGMpLm9uKCJjbGljayIsYix0aGlzLmNsb3NlKX07Yy5wcm90b3R5cGUuY2xvc2U9ZnVuY3Rpb24oYil7ZnVuY3Rpb24gYygpe2YudHJpZ2dlcigiY2xvc2VkLmJzLmFsZXJ0IikucmVtb3ZlKCl9dmFyIGQ9YSh0aGlzKSxlPWQuYXR0cigiZGF0YS10YXJnZXQiKTtlfHwoZT1kLmF0dHIoImhyZWYiKSxlPWUmJmUucmVwbGFjZSgvLiooPz0jW15cc10qJCkvLCIiKSk7dmFyIGY9YShlKTtiJiZiLnByZXZlbnREZWZhdWx0KCksZi5sZW5ndGh8fChmPWQuaGFzQ2xhc3MoImFsZXJ0Iik/ZDpkLnBhcmVudCgpKSxmLnRyaWdnZXIoYj1hLkV2ZW50KCJjbG9zZS5icy5hbGVydCIpKSxiLmlzRGVmYXVsdFByZXZlbnRlZCgpfHwoZi5yZW1vdmVDbGFzcygiaW4iKSxhLnN1cHBvcnQudHJhbnNpdGlvbiYmZi5oYXNDbGFzcygiZmFkZSIpP2Yub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxjKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmMoKSl9O3ZhciBkPWEuZm4uYWxlcnQ7YS5mbi5hbGVydD1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMuYWxlcnQiKTtlfHxkLmRhdGEoImJzLmFsZXJ0IixlPW5ldyBjKHRoaXMpKSwic3RyaW5nIj09dHlwZW9mIGImJmVbYl0uY2FsbChkKX0pfSxhLmZuLmFsZXJ0LkNvbnN0cnVjdG9yPWMsYS5mbi5hbGVydC5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4uYWxlcnQ9ZCx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMuYWxlcnQuZGF0YS1hcGkiLGIsYy5wcm90b3R5cGUuY2xvc2UpfShqUXVlcnkpLCtmdW5jdGlvbihhKXsidXNlIHN0cmljdCI7dmFyIGI9ZnVuY3Rpb24oYyxkKXt0aGlzLiRlbGVtZW50PWEoYyksdGhpcy5vcHRpb25zPWEuZXh0ZW5kKHt9LGIuREVGQVVMVFMsZCl9O2IuREVGQVVMVFM9e2xvYWRpbmdUZXh0OiJsb2FkaW5nLi4uIn0sYi5wcm90b3R5cGUuc2V0U3RhdGU9ZnVuY3Rpb24oYSl7dmFyIGI9ImRpc2FibGVkIixjPXRoaXMuJGVsZW1lbnQsZD1jLmlzKCJpbnB1dCIpPyJ2YWwiOiJodG1sIixlPWMuZGF0YSgpO2ErPSJUZXh0IixlLnJlc2V0VGV4dHx8Yy5kYXRhKCJyZXNldFRleHQiLGNbZF0oKSksY1tkXShlW2FdfHx0aGlzLm9wdGlvbnNbYV0pLHNldFRpbWVvdXQoZnVuY3Rpb24oKXsibG9hZGluZ1RleHQiPT1hP2MuYWRkQ2xhc3MoYikuYXR0cihiLGIpOmMucmVtb3ZlQ2xhc3MoYikucmVtb3ZlQXR0cihiKX0sMCl9LGIucHJvdG90eXBlLnRvZ2dsZT1mdW5jdGlvbigpe3ZhciBhPXRoaXMuJGVsZW1lbnQuY2xvc2VzdCgnW2RhdGEtdG9nZ2xlPSJidXR0b25zIl0nKSxiPSEwO2lmKGEubGVuZ3RoKXt2YXIgYz10aGlzLiRlbGVtZW50LmZpbmQoImlucHV0Iik7InJhZGlvIj09PWMucHJvcCgidHlwZSIpJiYoYy5wcm9wKCJjaGVja2VkIikmJnRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImFjdGl2ZSIpP2I9ITE6YS5maW5kKCIuYWN0aXZlIikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpKSxiJiZjLnByb3AoImNoZWNrZWQiLCF0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJhY3RpdmUiKSkudHJpZ2dlcigiY2hhbmdlIil9YiYmdGhpcy4kZWxlbWVudC50b2dnbGVDbGFzcygiYWN0aXZlIil9O3ZhciBjPWEuZm4uYnV0dG9uO2EuZm4uYnV0dG9uPWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5idXR0b24iKSxmPSJvYmplY3QiPT10eXBlb2YgYyYmYztlfHxkLmRhdGEoImJzLmJ1dHRvbiIsZT1uZXcgYih0aGlzLGYpKSwidG9nZ2xlIj09Yz9lLnRvZ2dsZSgpOmMmJmUuc2V0U3RhdGUoYyl9KX0sYS5mbi5idXR0b24uQ29uc3RydWN0b3I9YixhLmZuLmJ1dHRvbi5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4uYnV0dG9uPWMsdGhpc30sYShkb2N1bWVudCkub24oImNsaWNrLmJzLmJ1dHRvbi5kYXRhLWFwaSIsIltkYXRhLXRvZ2dsZV49YnV0dG9uXSIsZnVuY3Rpb24oYil7dmFyIGM9YShiLnRhcmdldCk7Yy5oYXNDbGFzcygiYnRuIil8fChjPWMuY2xvc2VzdCgiLmJ0biIpKSxjLmJ1dHRvbigidG9nZ2xlIiksYi5wcmV2ZW50RGVmYXVsdCgpfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpeyJ1c2Ugc3RyaWN0Ijt2YXIgYj1mdW5jdGlvbihiLGMpe3RoaXMuJGVsZW1lbnQ9YShiKSx0aGlzLiRpbmRpY2F0b3JzPXRoaXMuJGVsZW1lbnQuZmluZCgiLmNhcm91c2VsLWluZGljYXRvcnMiKSx0aGlzLm9wdGlvbnM9Yyx0aGlzLnBhdXNlZD10aGlzLnNsaWRpbmc9dGhpcy5pbnRlcnZhbD10aGlzLiRhY3RpdmU9dGhpcy4kaXRlbXM9bnVsbCwiaG92ZXIiPT10aGlzLm9wdGlvbnMucGF1c2UmJnRoaXMuJGVsZW1lbnQub24oIm1vdXNlZW50ZXIiLGEucHJveHkodGhpcy5wYXVzZSx0aGlzKSkub24oIm1vdXNlbGVhdmUiLGEucHJveHkodGhpcy5jeWNsZSx0aGlzKSl9O2IuREVGQVVMVFM9e2ludGVydmFsOjVlMyxwYXVzZToiaG92ZXIiLHdyYXA6ITB9LGIucHJvdG90eXBlLmN5Y2xlPWZ1bmN0aW9uKGIpe3JldHVybiBifHwodGhpcy5wYXVzZWQ9ITEpLHRoaXMuaW50ZXJ2YWwmJmNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCksdGhpcy5vcHRpb25zLmludGVydmFsJiYhdGhpcy5wYXVzZWQmJih0aGlzLmludGVydmFsPXNldEludGVydmFsKGEucHJveHkodGhpcy5uZXh0LHRoaXMpLHRoaXMub3B0aW9ucy5pbnRlcnZhbCkpLHRoaXN9LGIucHJvdG90eXBlLmdldEFjdGl2ZUluZGV4PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuJGFjdGl2ZT10aGlzLiRlbGVtZW50LmZpbmQoIi5pdGVtLmFjdGl2ZSIpLHRoaXMuJGl0ZW1zPXRoaXMuJGFjdGl2ZS5wYXJlbnQoKS5jaGlsZHJlbigpLHRoaXMuJGl0ZW1zLmluZGV4KHRoaXMuJGFjdGl2ZSl9LGIucHJvdG90eXBlLnRvPWZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMsZD10aGlzLmdldEFjdGl2ZUluZGV4KCk7cmV0dXJuIGI+dGhpcy4kaXRlbXMubGVuZ3RoLTF8fDA+Yj92b2lkIDA6dGhpcy5zbGlkaW5nP3RoaXMuJGVsZW1lbnQub25lKCJzbGlkLmJzLmNhcm91c2VsIixmdW5jdGlvbigpe2MudG8oYil9KTpkPT1iP3RoaXMucGF1c2UoKS5jeWNsZSgpOnRoaXMuc2xpZGUoYj5kPyJuZXh0IjoicHJldiIsYSh0aGlzLiRpdGVtc1tiXSkpfSxiLnByb3RvdHlwZS5wYXVzZT1mdW5jdGlvbihiKXtyZXR1cm4gYnx8KHRoaXMucGF1c2VkPSEwKSx0aGlzLiRlbGVtZW50LmZpbmQoIi5uZXh0LCAucHJldiIpLmxlbmd0aCYmYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kJiYodGhpcy4kZWxlbWVudC50cmlnZ2VyKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCksdGhpcy5jeWNsZSghMCkpLHRoaXMuaW50ZXJ2YWw9Y2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKSx0aGlzfSxiLnByb3RvdHlwZS5uZXh0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2xpZGluZz92b2lkIDA6dGhpcy5zbGlkZSgibmV4dCIpfSxiLnByb3RvdHlwZS5wcmV2PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2xpZGluZz92b2lkIDA6dGhpcy5zbGlkZSgicHJldiIpfSxiLnByb3RvdHlwZS5zbGlkZT1mdW5jdGlvbihiLGMpe3ZhciBkPXRoaXMuJGVsZW1lbnQuZmluZCgiLml0ZW0uYWN0aXZlIiksZT1jfHxkW2JdKCksZj10aGlzLmludGVydmFsLGc9Im5leHQiPT1iPyJsZWZ0IjoicmlnaHQiLGg9Im5leHQiPT1iPyJmaXJzdCI6Imxhc3QiLGk9dGhpcztpZighZS5sZW5ndGgpe2lmKCF0aGlzLm9wdGlvbnMud3JhcClyZXR1cm47ZT10aGlzLiRlbGVtZW50LmZpbmQoIi5pdGVtIilbaF0oKX10aGlzLnNsaWRpbmc9ITAsZiYmdGhpcy5wYXVzZSgpO3ZhciBqPWEuRXZlbnQoInNsaWRlLmJzLmNhcm91c2VsIix7cmVsYXRlZFRhcmdldDplWzBdLGRpcmVjdGlvbjpnfSk7aWYoIWUuaGFzQ2xhc3MoImFjdGl2ZSIpKXtpZih0aGlzLiRpbmRpY2F0b3JzLmxlbmd0aCYmKHRoaXMuJGluZGljYXRvcnMuZmluZCgiLmFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKSx0aGlzLiRlbGVtZW50Lm9uZSgic2xpZC5icy5jYXJvdXNlbCIsZnVuY3Rpb24oKXt2YXIgYj1hKGkuJGluZGljYXRvcnMuY2hpbGRyZW4oKVtpLmdldEFjdGl2ZUluZGV4KCldKTtiJiZiLmFkZENsYXNzKCJhY3RpdmUiKX0pKSxhLnN1cHBvcnQudHJhbnNpdGlvbiYmdGhpcy4kZWxlbWVudC5oYXNDbGFzcygic2xpZGUiKSl7aWYodGhpcy4kZWxlbWVudC50cmlnZ2VyKGopLGouaXNEZWZhdWx0UHJldmVudGVkKCkpcmV0dXJuO2UuYWRkQ2xhc3MoYiksZVswXS5vZmZzZXRXaWR0aCxkLmFkZENsYXNzKGcpLGUuYWRkQ2xhc3MoZyksZC5vbmUoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLGZ1bmN0aW9uKCl7ZS5yZW1vdmVDbGFzcyhbYixnXS5qb2luKCIgIikpLmFkZENsYXNzKCJhY3RpdmUiKSxkLnJlbW92ZUNsYXNzKFsiYWN0aXZlIixnXS5qb2luKCIgIikpLGkuc2xpZGluZz0hMSxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7aS4kZWxlbWVudC50cmlnZ2VyKCJzbGlkLmJzLmNhcm91c2VsIil9LDApfSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoNjAwKX1lbHNle2lmKHRoaXMuJGVsZW1lbnQudHJpZ2dlcihqKSxqLmlzRGVmYXVsdFByZXZlbnRlZCgpKXJldHVybjtkLnJlbW92ZUNsYXNzKCJhY3RpdmUiKSxlLmFkZENsYXNzKCJhY3RpdmUiKSx0aGlzLnNsaWRpbmc9ITEsdGhpcy4kZWxlbWVudC50cmlnZ2VyKCJzbGlkLmJzLmNhcm91c2VsIil9cmV0dXJuIGYmJnRoaXMuY3ljbGUoKSx0aGlzfX07dmFyIGM9YS5mbi5jYXJvdXNlbDthLmZuLmNhcm91c2VsPWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5jYXJvdXNlbCIpLGY9YS5leHRlbmQoe30sYi5ERUZBVUxUUyxkLmRhdGEoKSwib2JqZWN0Ij09dHlwZW9mIGMmJmMpLGc9InN0cmluZyI9PXR5cGVvZiBjP2M6Zi5zbGlkZTtlfHxkLmRhdGEoImJzLmNhcm91c2VsIixlPW5ldyBiKHRoaXMsZikpLCJudW1iZXIiPT10eXBlb2YgYz9lLnRvKGMpOmc/ZVtnXSgpOmYuaW50ZXJ2YWwmJmUucGF1c2UoKS5jeWNsZSgpfSl9LGEuZm4uY2Fyb3VzZWwuQ29uc3RydWN0b3I9YixhLmZuLmNhcm91c2VsLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5jYXJvdXNlbD1jLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy5jYXJvdXNlbC5kYXRhLWFwaSIsIltkYXRhLXNsaWRlXSwgW2RhdGEtc2xpZGUtdG9dIixmdW5jdGlvbihiKXt2YXIgYyxkPWEodGhpcyksZT1hKGQuYXR0cigiZGF0YS10YXJnZXQiKXx8KGM9ZC5hdHRyKCJocmVmIikpJiZjLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywiIikpLGY9YS5leHRlbmQoe30sZS5kYXRhKCksZC5kYXRhKCkpLGc9ZC5hdHRyKCJkYXRhLXNsaWRlLXRvIik7ZyYmKGYuaW50ZXJ2YWw9ITEpLGUuY2Fyb3VzZWwoZiksKGc9ZC5hdHRyKCJkYXRhLXNsaWRlLXRvIikpJiZlLmRhdGEoImJzLmNhcm91c2VsIikudG8oZyksYi5wcmV2ZW50RGVmYXVsdCgpfSksYSh3aW5kb3cpLm9uKCJsb2FkIixmdW5jdGlvbigpe2EoJ1tkYXRhLXJpZGU9ImNhcm91c2VsIl0nKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9YSh0aGlzKTtiLmNhcm91c2VsKGIuZGF0YSgpKX0pfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpeyJ1c2Ugc3RyaWN0Ijt2YXIgYj1mdW5jdGlvbihjLGQpe3RoaXMuJGVsZW1lbnQ9YShjKSx0aGlzLm9wdGlvbnM9YS5leHRlbmQoe30sYi5ERUZBVUxUUyxkKSx0aGlzLnRyYW5zaXRpb25pbmc9bnVsbCx0aGlzLm9wdGlvbnMucGFyZW50JiYodGhpcy4kcGFyZW50PWEodGhpcy5vcHRpb25zLnBhcmVudCkpLHRoaXMub3B0aW9ucy50b2dnbGUmJnRoaXMudG9nZ2xlKCl9O2IuREVGQVVMVFM9e3RvZ2dsZTohMH0sYi5wcm90b3R5cGUuZGltZW5zaW9uPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy4kZWxlbWVudC5oYXNDbGFzcygid2lkdGgiKTtyZXR1cm4gYT8id2lkdGgiOiJoZWlnaHQifSxiLnByb3RvdHlwZS5zaG93PWZ1bmN0aW9uKCl7aWYoIXRoaXMudHJhbnNpdGlvbmluZyYmIXRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImluIikpe3ZhciBiPWEuRXZlbnQoInNob3cuYnMuY29sbGFwc2UiKTtpZih0aGlzLiRlbGVtZW50LnRyaWdnZXIoYiksIWIuaXNEZWZhdWx0UHJldmVudGVkKCkpe3ZhciBjPXRoaXMuJHBhcmVudCYmdGhpcy4kcGFyZW50LmZpbmQoIj4gLnBhbmVsID4gLmluIik7aWYoYyYmYy5sZW5ndGgpe3ZhciBkPWMuZGF0YSgiYnMuY29sbGFwc2UiKTtpZihkJiZkLnRyYW5zaXRpb25pbmcpcmV0dXJuO2MuY29sbGFwc2UoImhpZGUiKSxkfHxjLmRhdGEoImJzLmNvbGxhcHNlIixudWxsKX12YXIgZT10aGlzLmRpbWVuc2lvbigpO3RoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoImNvbGxhcHNlIikuYWRkQ2xhc3MoImNvbGxhcHNpbmciKVtlXSgwKSx0aGlzLnRyYW5zaXRpb25pbmc9MTt2YXIgZj1mdW5jdGlvbigpe3RoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoImNvbGxhcHNpbmciKS5hZGRDbGFzcygiaW4iKVtlXSgiYXV0byIpLHRoaXMudHJhbnNpdGlvbmluZz0wLHRoaXMuJGVsZW1lbnQudHJpZ2dlcigic2hvd24uYnMuY29sbGFwc2UiKX07aWYoIWEuc3VwcG9ydC50cmFuc2l0aW9uKXJldHVybiBmLmNhbGwodGhpcyk7dmFyIGc9YS5jYW1lbENhc2UoWyJzY3JvbGwiLGVdLmpvaW4oIi0iKSk7dGhpcy4kZWxlbWVudC5vbmUoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLGEucHJveHkoZix0aGlzKSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoMzUwKVtlXSh0aGlzLiRlbGVtZW50WzBdW2ddKX19fSxiLnByb3RvdHlwZS5oaWRlPWZ1bmN0aW9uKCl7aWYoIXRoaXMudHJhbnNpdGlvbmluZyYmdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiaW4iKSl7dmFyIGI9YS5FdmVudCgiaGlkZS5icy5jb2xsYXBzZSIpO2lmKHRoaXMuJGVsZW1lbnQudHJpZ2dlcihiKSwhYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl7dmFyIGM9dGhpcy5kaW1lbnNpb24oKTt0aGlzLiRlbGVtZW50W2NdKHRoaXMuJGVsZW1lbnRbY10oKSlbMF0ub2Zmc2V0SGVpZ2h0LHRoaXMuJGVsZW1lbnQuYWRkQ2xhc3MoImNvbGxhcHNpbmciKS5yZW1vdmVDbGFzcygiY29sbGFwc2UiKS5yZW1vdmVDbGFzcygiaW4iKSx0aGlzLnRyYW5zaXRpb25pbmc9MTt2YXIgZD1mdW5jdGlvbigpe3RoaXMudHJhbnNpdGlvbmluZz0wLHRoaXMuJGVsZW1lbnQudHJpZ2dlcigiaGlkZGVuLmJzLmNvbGxhcHNlIikucmVtb3ZlQ2xhc3MoImNvbGxhcHNpbmciKS5hZGRDbGFzcygiY29sbGFwc2UiKX07cmV0dXJuIGEuc3VwcG9ydC50cmFuc2l0aW9uPyh0aGlzLiRlbGVtZW50W2NdKDApLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsYS5wcm94eShkLHRoaXMpKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgzNTApLHZvaWQgMCk6ZC5jYWxsKHRoaXMpfX19LGIucHJvdG90eXBlLnRvZ2dsZT1mdW5jdGlvbigpe3RoaXNbdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiaW4iKT8iaGlkZSI6InNob3ciXSgpfTt2YXIgYz1hLmZuLmNvbGxhcHNlO2EuZm4uY29sbGFwc2U9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLmNvbGxhcHNlIiksZj1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGQuZGF0YSgpLCJvYmplY3QiPT10eXBlb2YgYyYmYyk7ZXx8ZC5kYXRhKCJicy5jb2xsYXBzZSIsZT1uZXcgYih0aGlzLGYpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKX0pfSxhLmZuLmNvbGxhcHNlLkNvbnN0cnVjdG9yPWIsYS5mbi5jb2xsYXBzZS5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4uY29sbGFwc2U9Yyx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMuY29sbGFwc2UuZGF0YS1hcGkiLCJbZGF0YS10b2dnbGU9Y29sbGFwc2VdIixmdW5jdGlvbihiKXt2YXIgYyxkPWEodGhpcyksZT1kLmF0dHIoImRhdGEtdGFyZ2V0Iil8fGIucHJldmVudERlZmF1bHQoKXx8KGM9ZC5hdHRyKCJocmVmIikpJiZjLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywiIiksZj1hKGUpLGc9Zi5kYXRhKCJicy5jb2xsYXBzZSIpLGg9Zz8idG9nZ2xlIjpkLmRhdGEoKSxpPWQuYXR0cigiZGF0YS1wYXJlbnQiKSxqPWkmJmEoaSk7ZyYmZy50cmFuc2l0aW9uaW5nfHwoaiYmai5maW5kKCdbZGF0YS10b2dnbGU9Y29sbGFwc2VdW2RhdGEtcGFyZW50PSInK2krJyJdJykubm90KGQpLmFkZENsYXNzKCJjb2xsYXBzZWQiKSxkW2YuaGFzQ2xhc3MoImluIik/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXSgiY29sbGFwc2VkIikpLGYuY29sbGFwc2UoaCl9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIGIoKXthKGQpLnJlbW92ZSgpLGEoZSkuZWFjaChmdW5jdGlvbihiKXt2YXIgZD1jKGEodGhpcykpO2QuaGFzQ2xhc3MoIm9wZW4iKSYmKGQudHJpZ2dlcihiPWEuRXZlbnQoImhpZGUuYnMuZHJvcGRvd24iKSksYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKXx8ZC5yZW1vdmVDbGFzcygib3BlbiIpLnRyaWdnZXIoImhpZGRlbi5icy5kcm9wZG93biIpKX0pfWZ1bmN0aW9uIGMoYil7dmFyIGM9Yi5hdHRyKCJkYXRhLXRhcmdldCIpO2N8fChjPWIuYXR0cigiaHJlZiIpLGM9YyYmLyMvLnRlc3QoYykmJmMucmVwbGFjZSgvLiooPz0jW15cc10qJCkvLCIiKSk7dmFyIGQ9YyYmYShjKTtyZXR1cm4gZCYmZC5sZW5ndGg/ZDpiLnBhcmVudCgpfXZhciBkPSIuZHJvcGRvd24tYmFja2Ryb3AiLGU9IltkYXRhLXRvZ2dsZT1kcm9wZG93bl0iLGY9ZnVuY3Rpb24oYil7YShiKS5vbigiY2xpY2suYnMuZHJvcGRvd24iLHRoaXMudG9nZ2xlKX07Zi5wcm90b3R5cGUudG9nZ2xlPWZ1bmN0aW9uKGQpe3ZhciBlPWEodGhpcyk7aWYoIWUuaXMoIi5kaXNhYmxlZCwgOmRpc2FibGVkIikpe3ZhciBmPWMoZSksZz1mLmhhc0NsYXNzKCJvcGVuIik7aWYoYigpLCFnKXtpZigib250b3VjaHN0YXJ0ImluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCYmIWYuY2xvc2VzdCgiLm5hdmJhci1uYXYiKS5sZW5ndGgmJmEoJzxkaXYgY2xhc3M9ImRyb3Bkb3duLWJhY2tkcm9wIi8+JykuaW5zZXJ0QWZ0ZXIoYSh0aGlzKSkub24oImNsaWNrIixiKSxmLnRyaWdnZXIoZD1hLkV2ZW50KCJzaG93LmJzLmRyb3Bkb3duIikpLGQuaXNEZWZhdWx0UHJldmVudGVkKCkpcmV0dXJuO2YudG9nZ2xlQ2xhc3MoIm9wZW4iKS50cmlnZ2VyKCJzaG93bi5icy5kcm9wZG93biIpLGUuZm9jdXMoKX1yZXR1cm4hMX19LGYucHJvdG90eXBlLmtleWRvd249ZnVuY3Rpb24oYil7aWYoLygzOHw0MHwyNykvLnRlc3QoYi5rZXlDb2RlKSl7dmFyIGQ9YSh0aGlzKTtpZihiLnByZXZlbnREZWZhdWx0KCksYi5zdG9wUHJvcGFnYXRpb24oKSwhZC5pcygiLmRpc2FibGVkLCA6ZGlzYWJsZWQiKSl7dmFyIGY9YyhkKSxnPWYuaGFzQ2xhc3MoIm9wZW4iKTsvKiByZW1vdmVkIGRlZmF1bHRFU0MgaGFuZGxlciBmb3IgQ1I3NDY4IC0gSGltYW5zaHUgaWYoIWd8fGcmJjI3PT1iLmtleUNvZGUpcmV0dXJuIDI3PT1iLndoaWNoJiZmLmZpbmQoZSkuZm9jdXMoKSxkLmNsaWNrKCk7Ki92YXIgaD1hKCJbcm9sZT1tZW51XSBsaTpub3QoLmRpdmlkZXIpOnZpc2libGUgYSIsZik7aWYoaC5sZW5ndGgpe3ZhciBpPWguaW5kZXgoaC5maWx0ZXIoIjpmb2N1cyIpKTszOD09Yi5rZXlDb2RlJiZpPjAmJmktLSw0MD09Yi5rZXlDb2RlJiZpPGgubGVuZ3RoLTEmJmkrKyx+aXx8KGk9MCksaC5lcShpKS5mb2N1cygpfX19fTt2YXIgZz1hLmZuLmRyb3Bkb3duO2EuZm4uZHJvcGRvd249ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZD1jLmRhdGEoImJzLmRyb3Bkb3duIik7ZHx8Yy5kYXRhKCJicy5kcm9wZG93biIsZD1uZXcgZih0aGlzKSksInN0cmluZyI9PXR5cGVvZiBiJiZkW2JdLmNhbGwoYyl9KX0sYS5mbi5kcm9wZG93bi5Db25zdHJ1Y3Rvcj1mLGEuZm4uZHJvcGRvd24ubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLmRyb3Bkb3duPWcsdGhpc30sYShkb2N1bWVudCkub24oImNsaWNrLmJzLmRyb3Bkb3duLmRhdGEtYXBpIixiKS5vbigiY2xpY2suYnMuZHJvcGRvd24uZGF0YS1hcGkiLCIuZHJvcGRvd24gZm9ybSIsZnVuY3Rpb24oYSl7YS5zdG9wUHJvcGFnYXRpb24oKX0pLm9uKCJjbGljay5icy5kcm9wZG93bi5kYXRhLWFwaSIsZSxmLnByb3RvdHlwZS50b2dnbGUpLm9uKCJrZXlkb3duLmJzLmRyb3Bkb3duLmRhdGEtYXBpIixlKyIsIFtyb2xlPW1lbnVdIixmLnByb3RvdHlwZS5rZXlkb3duKX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7InVzZSBzdHJpY3QiO3ZhciBiPWZ1bmN0aW9uKGIsYyl7dGhpcy5vcHRpb25zPWMsdGhpcy4kZWxlbWVudD1hKGIpLHRoaXMuJGJhY2tkcm9wPXRoaXMuaXNTaG93bj1udWxsLHRoaXMub3B0aW9ucy5yZW1vdGUmJnRoaXMuJGVsZW1lbnQubG9hZCh0aGlzLm9wdGlvbnMucmVtb3RlKX07Yi5ERUZBVUxUUz17YmFja2Ryb3A6ITAsa2V5Ym9hcmQ6ITAsc2hvdzohMH0sYi5wcm90b3R5cGUudG9nZ2xlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzW3RoaXMuaXNTaG93bj8iaGlkZSI6InNob3ciXShhKX0sYi5wcm90b3R5cGUuc2hvdz1mdW5jdGlvbihiKXt2YXIgYz10aGlzLGQ9YS5FdmVudCgic2hvdy5icy5tb2RhbCIse3JlbGF0ZWRUYXJnZXQ6Yn0pO3RoaXMuJGVsZW1lbnQudHJpZ2dlcihkKSx0aGlzLmlzU2hvd258fGQuaXNEZWZhdWx0UHJldmVudGVkKCl8fCh0aGlzLmlzU2hvd249ITAsdGhpcy5lc2NhcGUoKSx0aGlzLiRlbGVtZW50Lm9uKCJjbGljay5kaXNtaXNzLm1vZGFsIiwnW2RhdGEtZGlzbWlzcz0ibW9kYWwiXScsYS5wcm94eSh0aGlzLmhpZGUsdGhpcykpLHRoaXMuYmFja2Ryb3AoZnVuY3Rpb24oKXt2YXIgZD1hLnN1cHBvcnQudHJhbnNpdGlvbiYmYy4kZWxlbWVudC5oYXNDbGFzcygiZmFkZSIpO2MuJGVsZW1lbnQucGFyZW50KCkubGVuZ3RofHxjLiRlbGVtZW50LmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLGMuJGVsZW1lbnQuc2hvdygpLGQmJmMuJGVsZW1lbnRbMF0ub2Zmc2V0V2lkdGgsYy4kZWxlbWVudC5hZGRDbGFzcygiaW4iKS5hdHRyKCJhcmlhLWhpZGRlbiIsITEpLGMuZW5mb3JjZUZvY3VzKCk7dmFyIGU9YS5FdmVudCgic2hvd24uYnMubW9kYWwiLHtyZWxhdGVkVGFyZ2V0OmJ9KTtkP2MuJGVsZW1lbnQuZmluZCgiLm1vZGFsLWRpYWxvZyIpLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsZnVuY3Rpb24oKXtjLiRlbGVtZW50LmZvY3VzKCkudHJpZ2dlcihlKX0pLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDMwMCk6Yy4kZWxlbWVudC5mb2N1cygpLnRyaWdnZXIoZSl9KSl9LGIucHJvdG90eXBlLmhpZGU9ZnVuY3Rpb24oYil7YiYmYi5wcmV2ZW50RGVmYXVsdCgpLGI9YS5FdmVudCgiaGlkZS5icy5tb2RhbCIpLHRoaXMuJGVsZW1lbnQudHJpZ2dlcihiKSx0aGlzLmlzU2hvd24mJiFiLmlzRGVmYXVsdFByZXZlbnRlZCgpJiYodGhpcy5pc1Nob3duPSExLHRoaXMuZXNjYXBlKCksYShkb2N1bWVudCkub2ZmKCJmb2N1c2luLmJzLm1vZGFsIiksdGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcygiaW4iKS5hdHRyKCJhcmlhLWhpZGRlbiIsITApLm9mZigiY2xpY2suZGlzbWlzcy5tb2RhbCIpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIik/dGhpcy4kZWxlbWVudC5vbmUoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLGEucHJveHkodGhpcy5oaWRlTW9kYWwsdGhpcykpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDMwMCk6dGhpcy5oaWRlTW9kYWwoKSl9LGIucHJvdG90eXBlLmVuZm9yY2VGb2N1cz1mdW5jdGlvbigpe2EoZG9jdW1lbnQpLm9mZigiZm9jdXNpbi5icy5tb2RhbCIpLm9uKCJmb2N1c2luLmJzLm1vZGFsIixhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMuJGVsZW1lbnRbMF09PT1hLnRhcmdldHx8dGhpcy4kZWxlbWVudC5oYXMoYS50YXJnZXQpLmxlbmd0aHx8dGhpcy4kZWxlbWVudC5mb2N1cygpfSx0aGlzKSl9LGIucHJvdG90eXBlLmVzY2FwZT1mdW5jdGlvbigpe3RoaXMuaXNTaG93biYmdGhpcy5vcHRpb25zLmtleWJvYXJkP3RoaXMuJGVsZW1lbnQub24oImtleXVwLmRpc21pc3MuYnMubW9kYWwiLGEucHJveHkoZnVuY3Rpb24oYSl7Mjc9PWEud2hpY2gmJnRoaXMuaGlkZSgpfSx0aGlzKSk6dGhpcy5pc1Nob3dufHx0aGlzLiRlbGVtZW50Lm9mZigia2V5dXAuZGlzbWlzcy5icy5tb2RhbCIpfSxiLnByb3RvdHlwZS5oaWRlTW9kYWw9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3RoaXMuJGVsZW1lbnQuaGlkZSgpLHRoaXMuYmFja2Ryb3AoZnVuY3Rpb24oKXthLnJlbW92ZUJhY2tkcm9wKCksYS4kZWxlbWVudC50cmlnZ2VyKCJoaWRkZW4uYnMubW9kYWwiKX0pfSxiLnByb3RvdHlwZS5yZW1vdmVCYWNrZHJvcD1mdW5jdGlvbigpe3RoaXMuJGJhY2tkcm9wJiZ0aGlzLiRiYWNrZHJvcC5yZW1vdmUoKSx0aGlzLiRiYWNrZHJvcD1udWxsfSxiLnByb3RvdHlwZS5iYWNrZHJvcD1mdW5jdGlvbihiKXt2YXIgYz10aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIik/ImZhZGUiOiIiO2lmKHRoaXMuaXNTaG93biYmdGhpcy5vcHRpb25zLmJhY2tkcm9wKXt2YXIgZD1hLnN1cHBvcnQudHJhbnNpdGlvbiYmYztpZih0aGlzLiRiYWNrZHJvcD1hKCc8ZGl2IGNsYXNzPSJtb2RhbC1iYWNrZHJvcCAnK2MrJyIgLz4nKS5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KSx0aGlzLiRlbGVtZW50Lm9uKCJjbGljay5kaXNtaXNzLm1vZGFsIixhLnByb3h5KGZ1bmN0aW9uKGEpe2EudGFyZ2V0PT09YS5jdXJyZW50VGFyZ2V0JiYoInN0YXRpYyI9PXRoaXMub3B0aW9ucy5iYWNrZHJvcD90aGlzLiRlbGVtZW50WzBdLmZvY3VzLmNhbGwodGhpcy4kZWxlbWVudFswXSk6dGhpcy5oaWRlLmNhbGwodGhpcykpfSx0aGlzKSksZCYmdGhpcy4kYmFja2Ryb3BbMF0ub2Zmc2V0V2lkdGgsdGhpcy4kYmFja2Ryb3AuYWRkQ2xhc3MoImluIiksIWIpcmV0dXJuO2Q/dGhpcy4kYmFja2Ryb3Aub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxiKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmIoKX1lbHNlIXRoaXMuaXNTaG93biYmdGhpcy4kYmFja2Ryb3A/KHRoaXMuJGJhY2tkcm9wLnJlbW92ZUNsYXNzKCJpbiIpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIik/dGhpcy4kYmFja2Ryb3Aub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxiKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmIoKSk6YiYmYigpfTt2YXIgYz1hLmZuLm1vZGFsO2EuZm4ubW9kYWw9ZnVuY3Rpb24oYyxkKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGU9YSh0aGlzKSxmPWUuZGF0YSgiYnMubW9kYWwiKSxnPWEuZXh0ZW5kKHt9LGIuREVGQVVMVFMsZS5kYXRhKCksIm9iamVjdCI9PXR5cGVvZiBjJiZjKTtmfHxlLmRhdGEoImJzLm1vZGFsIixmPW5ldyBiKHRoaXMsZykpLCJzdHJpbmciPT10eXBlb2YgYz9mW2NdKGQpOmcuc2hvdyYmZi5zaG93KGQpfSl9LGEuZm4ubW9kYWwuQ29uc3RydWN0b3I9YixhLmZuLm1vZGFsLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5tb2RhbD1jLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy5tb2RhbC5kYXRhLWFwaSIsJ1tkYXRhLXRvZ2dsZT0ibW9kYWwiXScsZnVuY3Rpb24oYil7dmFyIGM9YSh0aGlzKSxkPWMuYXR0cigiaHJlZiIpLGU9YShjLmF0dHIoImRhdGEtdGFyZ2V0Iil8fGQmJmQucmVwbGFjZSgvLiooPz0jW15cc10rJCkvLCIiKSksZj1lLmRhdGEoIm1vZGFsIik/InRvZ2dsZSI6YS5leHRlbmQoe3JlbW90ZTohLyMvLnRlc3QoZCkmJmR9LGUuZGF0YSgpLGMuZGF0YSgpKTtiLnByZXZlbnREZWZhdWx0KCksZS5tb2RhbChmLHRoaXMpLm9uZSgiaGlkZSIsZnVuY3Rpb24oKXtjLmlzKCI6dmlzaWJsZSIpJiZjLmZvY3VzKCl9KX0pLGEoZG9jdW1lbnQpLm9uKCJzaG93LmJzLm1vZGFsIiwiLm1vZGFsIixmdW5jdGlvbigpe2EoZG9jdW1lbnQuYm9keSkuYWRkQ2xhc3MoIm1vZGFsLW9wZW4iKX0pLm9uKCJoaWRkZW4uYnMubW9kYWwiLCIubW9kYWwiLGZ1bmN0aW9uKCl7YShkb2N1bWVudC5ib2R5KS5yZW1vdmVDbGFzcygibW9kYWwtb3BlbiIpfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpeyJ1c2Ugc3RyaWN0Ijt2YXIgYj1mdW5jdGlvbihhLGIpe3RoaXMudHlwZT10aGlzLm9wdGlvbnM9dGhpcy5lbmFibGVkPXRoaXMudGltZW91dD10aGlzLmhvdmVyU3RhdGU9dGhpcy4kZWxlbWVudD1udWxsLHRoaXMuaW5pdCgidG9vbHRpcCIsYSxiKX07Yi5ERUZBVUxUUz17YW5pbWF0aW9uOiEwLHBsYWNlbWVudDoidG9wIixzZWxlY3RvcjohMSx0ZW1wbGF0ZTonPGRpdiBjbGFzcz0idG9vbHRpcCI+PGRpdiBjbGFzcz0idG9vbHRpcC1hcnJvdyI+PC9kaXY+PGRpdiBjbGFzcz0idG9vbHRpcC1pbm5lciI+PC9kaXY+PC9kaXY+Jyx0cmlnZ2VyOiJob3ZlciBmb2N1cyIsdGl0bGU6IiIsZGVsYXk6MCxodG1sOiExLGNvbnRhaW5lcjohMX0sYi5wcm90b3R5cGUuaW5pdD1mdW5jdGlvbihiLGMsZCl7dGhpcy5lbmFibGVkPSEwLHRoaXMudHlwZT1iLHRoaXMuJGVsZW1lbnQ9YShjKSx0aGlzLm9wdGlvbnM9dGhpcy5nZXRPcHRpb25zKGQpO2Zvcih2YXIgZT10aGlzLm9wdGlvbnMudHJpZ2dlci5zcGxpdCgiICIpLGY9ZS5sZW5ndGg7Zi0tOyl7dmFyIGc9ZVtmXTtpZigiY2xpY2siPT1nKXRoaXMuJGVsZW1lbnQub24oImNsaWNrLiIrdGhpcy50eXBlLHRoaXMub3B0aW9ucy5zZWxlY3RvcixhLnByb3h5KHRoaXMudG9nZ2xlLHRoaXMpKTtlbHNlIGlmKCJtYW51YWwiIT1nKXt2YXIgaD0iaG92ZXIiPT1nPyJtb3VzZWVudGVyIjoiZm9jdXMiLGk9ImhvdmVyIj09Zz8ibW91c2VsZWF2ZSI6ImJsdXIiO3RoaXMuJGVsZW1lbnQub24oaCsiLiIrdGhpcy50eXBlLHRoaXMub3B0aW9ucy5zZWxlY3RvcixhLnByb3h5KHRoaXMuZW50ZXIsdGhpcykpLHRoaXMuJGVsZW1lbnQub24oaSsiLiIrdGhpcy50eXBlLHRoaXMub3B0aW9ucy5zZWxlY3RvcixhLnByb3h5KHRoaXMubGVhdmUsdGhpcykpfX10aGlzLm9wdGlvbnMuc2VsZWN0b3I/dGhpcy5fb3B0aW9ucz1hLmV4dGVuZCh7fSx0aGlzLm9wdGlvbnMse3RyaWdnZXI6Im1hbnVhbCIsc2VsZWN0b3I6IiJ9KTp0aGlzLmZpeFRpdGxlKCl9LGIucHJvdG90eXBlLmdldERlZmF1bHRzPWZ1bmN0aW9uKCl7cmV0dXJuIGIuREVGQVVMVFN9LGIucHJvdG90eXBlLmdldE9wdGlvbnM9ZnVuY3Rpb24oYil7cmV0dXJuIGI9YS5leHRlbmQoe30sdGhpcy5nZXREZWZhdWx0cygpLHRoaXMuJGVsZW1lbnQuZGF0YSgpLGIpLGIuZGVsYXkmJiJudW1iZXIiPT10eXBlb2YgYi5kZWxheSYmKGIuZGVsYXk9e3Nob3c6Yi5kZWxheSxoaWRlOmIuZGVsYXl9KSxifSxiLnByb3RvdHlwZS5nZXREZWxlZ2F0ZU9wdGlvbnM9ZnVuY3Rpb24oKXt2YXIgYj17fSxjPXRoaXMuZ2V0RGVmYXVsdHMoKTtyZXR1cm4gdGhpcy5fb3B0aW9ucyYmYS5lYWNoKHRoaXMuX29wdGlvbnMsZnVuY3Rpb24oYSxkKXtjW2FdIT1kJiYoYlthXT1kKX0pLGJ9LGIucHJvdG90eXBlLmVudGVyPWZ1bmN0aW9uKGIpe3ZhciBjPWIgaW5zdGFuY2VvZiB0aGlzLmNvbnN0cnVjdG9yP2I6YShiLmN1cnJlbnRUYXJnZXQpW3RoaXMudHlwZV0odGhpcy5nZXREZWxlZ2F0ZU9wdGlvbnMoKSkuZGF0YSgiYnMuIit0aGlzLnR5cGUpO3JldHVybiBjbGVhclRpbWVvdXQoYy50aW1lb3V0KSxjLmhvdmVyU3RhdGU9ImluIixjLm9wdGlvbnMuZGVsYXkmJmMub3B0aW9ucy5kZWxheS5zaG93PyhjLnRpbWVvdXQ9c2V0VGltZW91dChmdW5jdGlvbigpeyJpbiI9PWMuaG92ZXJTdGF0ZSYmYy5zaG93KCl9LGMub3B0aW9ucy5kZWxheS5zaG93KSx2b2lkIDApOmMuc2hvdygpfSxiLnByb3RvdHlwZS5sZWF2ZT1mdW5jdGlvbihiKXt2YXIgYz1iIGluc3RhbmNlb2YgdGhpcy5jb25zdHJ1Y3Rvcj9iOmEoYi5jdXJyZW50VGFyZ2V0KVt0aGlzLnR5cGVdKHRoaXMuZ2V0RGVsZWdhdGVPcHRpb25zKCkpLmRhdGEoImJzLiIrdGhpcy50eXBlKTtyZXR1cm4gY2xlYXJUaW1lb3V0KGMudGltZW91dCksYy5ob3ZlclN0YXRlPSJvdXQiLGMub3B0aW9ucy5kZWxheSYmYy5vcHRpb25zLmRlbGF5LmhpZGU/KGMudGltZW91dD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Im91dCI9PWMuaG92ZXJTdGF0ZSYmYy5oaWRlKCl9LGMub3B0aW9ucy5kZWxheS5oaWRlKSx2b2lkIDApOmMuaGlkZSgpfSxiLnByb3RvdHlwZS5zaG93PWZ1bmN0aW9uKCl7dmFyIGI9YS5FdmVudCgic2hvdy5icy4iK3RoaXMudHlwZSk7aWYodGhpcy5oYXNDb250ZW50KCkmJnRoaXMuZW5hYmxlZCl7aWYodGhpcy4kZWxlbWVudC50cmlnZ2VyKGIpLGIuaXNEZWZhdWx0UHJldmVudGVkKCkpcmV0dXJuO3ZhciBjPXRoaXMudGlwKCk7dGhpcy5zZXRDb250ZW50KCksdGhpcy5vcHRpb25zLmFuaW1hdGlvbiYmYy5hZGRDbGFzcygiZmFkZSIpO3ZhciBkPSJmdW5jdGlvbiI9PXR5cGVvZiB0aGlzLm9wdGlvbnMucGxhY2VtZW50P3RoaXMub3B0aW9ucy5wbGFjZW1lbnQuY2FsbCh0aGlzLGNbMF0sdGhpcy4kZWxlbWVudFswXSk6dGhpcy5vcHRpb25zLnBsYWNlbWVudCxlPS9ccz9hdXRvP1xzPy9pLGY9ZS50ZXN0KGQpO2YmJihkPWQucmVwbGFjZShlLCIiKXx8InRvcCIpLGMuZGV0YWNoKCkuY3NzKHt0b3A6MCxsZWZ0OjAsZGlzcGxheToiYmxvY2sifSkuYWRkQ2xhc3MoZCksdGhpcy5vcHRpb25zLmNvbnRhaW5lcj9jLmFwcGVuZFRvKHRoaXMub3B0aW9ucy5jb250YWluZXIpOmMuaW5zZXJ0QWZ0ZXIodGhpcy4kZWxlbWVudCk7dmFyIGc9dGhpcy5nZXRQb3NpdGlvbigpLGg9Y1swXS5vZmZzZXRXaWR0aCxpPWNbMF0ub2Zmc2V0SGVpZ2h0O2lmKGYpe3ZhciBqPXRoaXMuJGVsZW1lbnQucGFyZW50KCksaz1kLGw9ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcHx8ZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AsbT0iYm9keSI9PXRoaXMub3B0aW9ucy5jb250YWluZXI/d2luZG93LmlubmVyV2lkdGg6ai5vdXRlcldpZHRoKCksbj0iYm9keSI9PXRoaXMub3B0aW9ucy5jb250YWluZXI/d2luZG93LmlubmVySGVpZ2h0Omoub3V0ZXJIZWlnaHQoKSxvPSJib2R5Ij09dGhpcy5vcHRpb25zLmNvbnRhaW5lcj8wOmoub2Zmc2V0KCkubGVmdDtkPSJib3R0b20iPT1kJiZnLnRvcCtnLmhlaWdodCtpLWw+bj8idG9wIjoidG9wIj09ZCYmZy50b3AtbC1pPDA/ImJvdHRvbSI6InJpZ2h0Ij09ZCYmZy5yaWdodCtoPm0/ImxlZnQiOiJsZWZ0Ij09ZCYmZy5sZWZ0LWg8bz8icmlnaHQiOmQsYy5yZW1vdmVDbGFzcyhrKS5hZGRDbGFzcyhkKX12YXIgcD10aGlzLmdldENhbGN1bGF0ZWRPZmZzZXQoZCxnLGgsaSk7dGhpcy5hcHBseVBsYWNlbWVudChwLGQpLHRoaXMuJGVsZW1lbnQudHJpZ2dlcigic2hvd24uYnMuIit0aGlzLnR5cGUpfX0sYi5wcm90b3R5cGUuYXBwbHlQbGFjZW1lbnQ9ZnVuY3Rpb24oYSxiKXt2YXIgYyxkPXRoaXMudGlwKCksZT1kWzBdLm9mZnNldFdpZHRoLGY9ZFswXS5vZmZzZXRIZWlnaHQsZz1wYXJzZUludChkLmNzcygibWFyZ2luLXRvcCIpLDEwKSxoPXBhcnNlSW50KGQuY3NzKCJtYXJnaW4tbGVmdCIpLDEwKTtpc05hTihnKSYmKGc9MCksaXNOYU4oaCkmJihoPTApLGEudG9wPWEudG9wK2csYS5sZWZ0PWEubGVmdCtoLGQub2Zmc2V0KGEpLmFkZENsYXNzKCJpbiIpO3ZhciBpPWRbMF0ub2Zmc2V0V2lkdGgsaj1kWzBdLm9mZnNldEhlaWdodDtpZigidG9wIj09YiYmaiE9ZiYmKGM9ITAsYS50b3A9YS50b3ArZi1qKSwvYm90dG9tfHRvcC8udGVzdChiKSl7dmFyIGs9MDthLmxlZnQ8MCYmKGs9LTIqYS5sZWZ0LGEubGVmdD0wLGQub2Zmc2V0KGEpLGk9ZFswXS5vZmZzZXRXaWR0aCxqPWRbMF0ub2Zmc2V0SGVpZ2h0KSx0aGlzLnJlcGxhY2VBcnJvdyhrLWUraSxpLCJsZWZ0Iil9ZWxzZSB0aGlzLnJlcGxhY2VBcnJvdyhqLWYsaiwidG9wIik7YyYmZC5vZmZzZXQoYSl9LGIucHJvdG90eXBlLnJlcGxhY2VBcnJvdz1mdW5jdGlvbihhLGIsYyl7dGhpcy5hcnJvdygpLmNzcyhjLGE/NTAqKDEtYS9iKSsiJSI6IiIpfSxiLnByb3RvdHlwZS5zZXRDb250ZW50PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy50aXAoKSxiPXRoaXMuZ2V0VGl0bGUoKTthLmZpbmQoIi50b29sdGlwLWlubmVyIilbdGhpcy5vcHRpb25zLmh0bWw/Imh0bWwiOiJ0ZXh0Il0oYiksYS5yZW1vdmVDbGFzcygiZmFkZSBpbiB0b3AgYm90dG9tIGxlZnQgcmlnaHQiKX0sYi5wcm90b3R5cGUuaGlkZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGIoKXsiaW4iIT1jLmhvdmVyU3RhdGUmJmQuZGV0YWNoKCl9dmFyIGM9dGhpcyxkPXRoaXMudGlwKCksZT1hLkV2ZW50KCJoaWRlLmJzLiIrdGhpcy50eXBlKTtyZXR1cm4gdGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpLGUuaXNEZWZhdWx0UHJldmVudGVkKCk/dm9pZCAwOihkLnJlbW92ZUNsYXNzKCJpbiIpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiR0aXAuaGFzQ2xhc3MoImZhZGUiKT9kLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsYikuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKTpiKCksdGhpcy4kZWxlbWVudC50cmlnZ2VyKCJoaWRkZW4uYnMuIit0aGlzLnR5cGUpLHRoaXMpfSxiLnByb3RvdHlwZS5maXhUaXRsZT1mdW5jdGlvbigpe3ZhciBhPXRoaXMuJGVsZW1lbnQ7KGEuYXR0cigidGl0bGUiKXx8InN0cmluZyIhPXR5cGVvZiBhLmF0dHIoImRhdGEtb3JpZ2luYWwtdGl0bGUiKSkmJmEuYXR0cigiZGF0YS1vcmlnaW5hbC10aXRsZSIsYS5hdHRyKCJ0aXRsZSIpfHwiIikuYXR0cigidGl0bGUiLCIiKX0sYi5wcm90b3R5cGUuaGFzQ29udGVudD1mdW5jdGlvbigpe3JldHVybiB0aGlzLmdldFRpdGxlKCl9LGIucHJvdG90eXBlLmdldFBvc2l0aW9uPWZ1bmN0aW9uKCl7dmFyIGI9dGhpcy4kZWxlbWVudFswXTtyZXR1cm4gYS5leHRlbmQoe30sImZ1bmN0aW9uIj09dHlwZW9mIGIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0P2IuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk6e3dpZHRoOmIub2Zmc2V0V2lkdGgsaGVpZ2h0OmIub2Zmc2V0SGVpZ2h0fSx0aGlzLiRlbGVtZW50Lm9mZnNldCgpKX0sYi5wcm90b3R5cGUuZ2V0Q2FsY3VsYXRlZE9mZnNldD1mdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4iYm90dG9tIj09YT97dG9wOmIudG9wK2IuaGVpZ2h0LGxlZnQ6Yi5sZWZ0K2Iud2lkdGgvMi1jLzJ9OiJ0b3AiPT1hP3t0b3A6Yi50b3AtZCxsZWZ0OmIubGVmdCtiLndpZHRoLzItYy8yfToibGVmdCI9PWE/e3RvcDpiLnRvcCtiLmhlaWdodC8yLWQvMixsZWZ0OmIubGVmdC1jfTp7dG9wOmIudG9wK2IuaGVpZ2h0LzItZC8yLGxlZnQ6Yi5sZWZ0K2Iud2lkdGh9fSxiLnByb3RvdHlwZS5nZXRUaXRsZT1mdW5jdGlvbigpe3ZhciBhLGI9dGhpcy4kZWxlbWVudCxjPXRoaXMub3B0aW9ucztyZXR1cm4gYT1iLmF0dHIoImRhdGEtb3JpZ2luYWwtdGl0bGUiKXx8KCJmdW5jdGlvbiI9PXR5cGVvZiBjLnRpdGxlP2MudGl0bGUuY2FsbChiWzBdKTpjLnRpdGxlKX0sYi5wcm90b3R5cGUudGlwPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuJHRpcD10aGlzLiR0aXB8fGEodGhpcy5vcHRpb25zLnRlbXBsYXRlKX0sYi5wcm90b3R5cGUuYXJyb3c9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy4kYXJyb3c9dGhpcy4kYXJyb3d8fHRoaXMudGlwKCkuZmluZCgiLnRvb2x0aXAtYXJyb3ciKX0sYi5wcm90b3R5cGUudmFsaWRhdGU9ZnVuY3Rpb24oKXt0aGlzLiRlbGVtZW50WzBdLnBhcmVudE5vZGV8fCh0aGlzLmhpZGUoKSx0aGlzLiRlbGVtZW50PW51bGwsdGhpcy5vcHRpb25zPW51bGwpfSxiLnByb3RvdHlwZS5lbmFibGU9ZnVuY3Rpb24oKXt0aGlzLmVuYWJsZWQ9ITB9LGIucHJvdG90eXBlLmRpc2FibGU9ZnVuY3Rpb24oKXt0aGlzLmVuYWJsZWQ9ITF9LGIucHJvdG90eXBlLnRvZ2dsZUVuYWJsZWQ9ZnVuY3Rpb24oKXt0aGlzLmVuYWJsZWQ9IXRoaXMuZW5hYmxlZH0sYi5wcm90b3R5cGUudG9nZ2xlPWZ1bmN0aW9uKGIpe3ZhciBjPWI/YShiLmN1cnJlbnRUYXJnZXQpW3RoaXMudHlwZV0odGhpcy5nZXREZWxlZ2F0ZU9wdGlvbnMoKSkuZGF0YSgiYnMuIit0aGlzLnR5cGUpOnRoaXM7Yy50aXAoKS5oYXNDbGFzcygiaW4iKT9jLmxlYXZlKGMpOmMuZW50ZXIoYyl9LGIucHJvdG90eXBlLmRlc3Ryb3k9ZnVuY3Rpb24oKXt0aGlzLmhpZGUoKS4kZWxlbWVudC5vZmYoIi4iK3RoaXMudHlwZSkucmVtb3ZlRGF0YSgiYnMuIit0aGlzLnR5cGUpfTt2YXIgYz1hLmZuLnRvb2x0aXA7YS5mbi50b29sdGlwPWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy50b29sdGlwIiksZj0ib2JqZWN0Ij09dHlwZW9mIGMmJmM7ZXx8ZC5kYXRhKCJicy50b29sdGlwIixlPW5ldyBiKHRoaXMsZikpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpfSl9LGEuZm4udG9vbHRpcC5Db25zdHJ1Y3Rvcj1iLGEuZm4udG9vbHRpcC5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4udG9vbHRpcD1jLHRoaXN9fShqUXVlcnkpLCtmdW5jdGlvbihhKXsidXNlIHN0cmljdCI7dmFyIGI9ZnVuY3Rpb24oYSxiKXt0aGlzLmluaXQoInBvcG92ZXIiLGEsYil9O2lmKCFhLmZuLnRvb2x0aXApdGhyb3cgbmV3IEVycm9yKCJQb3BvdmVyIHJlcXVpcmVzIHRvb2x0aXAuanMiKTtiLkRFRkFVTFRTPWEuZXh0ZW5kKHt9LGEuZm4udG9vbHRpcC5Db25zdHJ1Y3Rvci5ERUZBVUxUUyx7cGxhY2VtZW50OiJyaWdodCIsdHJpZ2dlcjoiY2xpY2siLGNvbnRlbnQ6IiIsdGVtcGxhdGU6JzxkaXYgY2xhc3M9InBvcG92ZXIiPjxkaXYgY2xhc3M9ImFycm93Ij48L2Rpdj48aDMgY2xhc3M9InBvcG92ZXItdGl0bGUiPjwvaDM+PGRpdiBjbGFzcz0icG9wb3Zlci1jb250ZW50Ij48L2Rpdj48L2Rpdj4nfSksYi5wcm90b3R5cGU9YS5leHRlbmQoe30sYS5mbi50b29sdGlwLkNvbnN0cnVjdG9yLnByb3RvdHlwZSksYi5wcm90b3R5cGUuY29uc3RydWN0b3I9YixiLnByb3RvdHlwZS5nZXREZWZhdWx0cz1mdW5jdGlvbigpe3JldHVybiBiLkRFRkFVTFRTfSxiLnByb3RvdHlwZS5zZXRDb250ZW50PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy50aXAoKSxiPXRoaXMuZ2V0VGl0bGUoKSxjPXRoaXMuZ2V0Q29udGVudCgpO2EuZmluZCgiLnBvcG92ZXItdGl0bGUiKVt0aGlzLm9wdGlvbnMuaHRtbD8iaHRtbCI6InRleHQiXShiKSxhLmZpbmQoIi5wb3BvdmVyLWNvbnRlbnQiKVt0aGlzLm9wdGlvbnMuaHRtbD8iaHRtbCI6InRleHQiXShjKSxhLnJlbW92ZUNsYXNzKCJmYWRlIHRvcCBib3R0b20gbGVmdCByaWdodCBpbiIpLGEuZmluZCgiLnBvcG92ZXItdGl0bGUiKS5odG1sKCl8fGEuZmluZCgiLnBvcG92ZXItdGl0bGUiKS5oaWRlKCl9LGIucHJvdG90eXBlLmhhc0NvbnRlbnQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaXRsZSgpfHx0aGlzLmdldENvbnRlbnQoKX0sYi5wcm90b3R5cGUuZ2V0Q29udGVudD1mdW5jdGlvbigpe3ZhciBhPXRoaXMuJGVsZW1lbnQsYj10aGlzLm9wdGlvbnM7cmV0dXJuIGEuYXR0cigiZGF0YS1jb250ZW50Iil8fCgiZnVuY3Rpb24iPT10eXBlb2YgYi5jb250ZW50P2IuY29udGVudC5jYWxsKGFbMF0pOmIuY29udGVudCl9LGIucHJvdG90eXBlLmFycm93PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuJGFycm93PXRoaXMuJGFycm93fHx0aGlzLnRpcCgpLmZpbmQoIi5hcnJvdyIpfSxiLnByb3RvdHlwZS50aXA9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy4kdGlwfHwodGhpcy4kdGlwPWEodGhpcy5vcHRpb25zLnRlbXBsYXRlKSksdGhpcy4kdGlwfTt2YXIgYz1hLmZuLnBvcG92ZXI7YS5mbi5wb3BvdmVyPWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5wb3BvdmVyIiksZj0ib2JqZWN0Ij09dHlwZW9mIGMmJmM7ZXx8ZC5kYXRhKCJicy5wb3BvdmVyIixlPW5ldyBiKHRoaXMsZikpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpfSl9LGEuZm4ucG9wb3Zlci5Db25zdHJ1Y3Rvcj1iLGEuZm4ucG9wb3Zlci5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4ucG9wb3Zlcj1jLHRoaXN9fShqUXVlcnkpLCtmdW5jdGlvbihhKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gYihjLGQpe3ZhciBlLGY9YS5wcm94eSh0aGlzLnByb2Nlc3MsdGhpcyk7dGhpcy4kZWxlbWVudD1hKGMpLmlzKCJib2R5Iik/YSh3aW5kb3cpOmEoYyksdGhpcy4kYm9keT1hKCJib2R5IiksdGhpcy4kc2Nyb2xsRWxlbWVudD10aGlzLiRlbGVtZW50Lm9uKCJzY3JvbGwuYnMuc2Nyb2xsLXNweS5kYXRhLWFwaSIsZiksdGhpcy5vcHRpb25zPWEuZXh0ZW5kKHt9LGIuREVGQVVMVFMsZCksdGhpcy5zZWxlY3Rvcj0odGhpcy5vcHRpb25zLnRhcmdldHx8KGU9YShjKS5hdHRyKCJocmVmIikpJiZlLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywiIil8fCIiKSsiIC5uYXYgbGkgPiBhIix0aGlzLm9mZnNldHM9YShbXSksdGhpcy50YXJnZXRzPWEoW10pLHRoaXMuYWN0aXZlVGFyZ2V0PW51bGwsdGhpcy5yZWZyZXNoKCksdGhpcy5wcm9jZXNzKCl9Yi5ERUZBVUxUUz17b2Zmc2V0OjEwfSxiLnByb3RvdHlwZS5yZWZyZXNoPWZ1bmN0aW9uKCl7dmFyIGI9dGhpcy4kZWxlbWVudFswXT09d2luZG93PyJvZmZzZXQiOiJwb3NpdGlvbiI7dGhpcy5vZmZzZXRzPWEoW10pLHRoaXMudGFyZ2V0cz1hKFtdKTt2YXIgYz10aGlzO3RoaXMuJGJvZHkuZmluZCh0aGlzLnNlbGVjdG9yKS5tYXAoZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJ0YXJnZXQiKXx8ZC5hdHRyKCJocmVmIiksZj0vXiNcdy8udGVzdChlKSYmYShlKTtyZXR1cm4gZiYmZi5sZW5ndGgmJltbZltiXSgpLnRvcCsoIWEuaXNXaW5kb3coYy4kc2Nyb2xsRWxlbWVudC5nZXQoMCkpJiZjLiRzY3JvbGxFbGVtZW50LnNjcm9sbFRvcCgpKSxlXV18fG51bGx9KS5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIGFbMF0tYlswXX0pLmVhY2goZnVuY3Rpb24oKXtjLm9mZnNldHMucHVzaCh0aGlzWzBdKSxjLnRhcmdldHMucHVzaCh0aGlzWzFdKX0pfSxiLnByb3RvdHlwZS5wcm9jZXNzPWZ1bmN0aW9uKCl7dmFyIGEsYj10aGlzLiRzY3JvbGxFbGVtZW50LnNjcm9sbFRvcCgpK3RoaXMub3B0aW9ucy5vZmZzZXQsYz10aGlzLiRzY3JvbGxFbGVtZW50WzBdLnNjcm9sbEhlaWdodHx8dGhpcy4kYm9keVswXS5zY3JvbGxIZWlnaHQsZD1jLXRoaXMuJHNjcm9sbEVsZW1lbnQuaGVpZ2h0KCksZT10aGlzLm9mZnNldHMsZj10aGlzLnRhcmdldHMsZz10aGlzLmFjdGl2ZVRhcmdldDtpZihiPj1kKXJldHVybiBnIT0oYT1mLmxhc3QoKVswXSkmJnRoaXMuYWN0aXZhdGUoYSk7Zm9yKGE9ZS5sZW5ndGg7YS0tOylnIT1mW2FdJiZiPj1lW2FdJiYoIWVbYSsxXXx8Yjw9ZVthKzFdKSYmdGhpcy5hY3RpdmF0ZShmW2FdKX0sYi5wcm90b3R5cGUuYWN0aXZhdGU9ZnVuY3Rpb24oYil7dGhpcy5hY3RpdmVUYXJnZXQ9YixhKHRoaXMuc2VsZWN0b3IpLnBhcmVudHMoIi5hY3RpdmUiKS5yZW1vdmVDbGFzcygiYWN0aXZlIik7dmFyIGM9dGhpcy5zZWxlY3RvcisnW2RhdGEtdGFyZ2V0PSInK2IrJyJdLCcrdGhpcy5zZWxlY3RvcisnW2hyZWY9IicrYisnIl0nLGQ9YShjKS5wYXJlbnRzKCJsaSIpLmFkZENsYXNzKCJhY3RpdmUiKTtkLnBhcmVudCgiLmRyb3Bkb3duLW1lbnUiKS5sZW5ndGgmJihkPWQuY2xvc2VzdCgibGkuZHJvcGRvd24iKS5hZGRDbGFzcygiYWN0aXZlIikpLGQudHJpZ2dlcigiYWN0aXZhdGUuYnMuc2Nyb2xsc3B5Iil9O3ZhciBjPWEuZm4uc2Nyb2xsc3B5O2EuZm4uc2Nyb2xsc3B5PWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5zY3JvbGxzcHkiKSxmPSJvYmplY3QiPT10eXBlb2YgYyYmYztlfHxkLmRhdGEoImJzLnNjcm9sbHNweSIsZT1uZXcgYih0aGlzLGYpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKX0pfSxhLmZuLnNjcm9sbHNweS5Db25zdHJ1Y3Rvcj1iLGEuZm4uc2Nyb2xsc3B5Lm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5zY3JvbGxzcHk9Yyx0aGlzfSxhKHdpbmRvdykub24oImxvYWQiLGZ1bmN0aW9uKCl7YSgnW2RhdGEtc3B5PSJzY3JvbGwiXScpLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1hKHRoaXMpO2Iuc2Nyb2xsc3B5KGIuZGF0YSgpKX0pfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpeyJ1c2Ugc3RyaWN0Ijt2YXIgYj1mdW5jdGlvbihiKXt0aGlzLmVsZW1lbnQ9YShiKX07Yi5wcm90b3R5cGUuc2hvdz1mdW5jdGlvbigpe3ZhciBiPXRoaXMuZWxlbWVudCxjPWIuY2xvc2VzdCgidWw6bm90KC5kcm9wZG93bi1tZW51KSIpLGQ9Yi5kYXRhKCJ0YXJnZXQiKTtpZihkfHwoZD1iLmF0dHIoImhyZWYiKSxkPWQmJmQucmVwbGFjZSgvLiooPz0jW15cc10qJCkvLCIiKSksIWIucGFyZW50KCJsaSIpLmhhc0NsYXNzKCJhY3RpdmUiKSl7dmFyIGU9Yy5maW5kKCIuYWN0aXZlOmxhc3QgYSIpWzBdLGY9YS5FdmVudCgic2hvdy5icy50YWIiLHtyZWxhdGVkVGFyZ2V0OmV9KTtpZihiLnRyaWdnZXIoZiksIWYuaXNEZWZhdWx0UHJldmVudGVkKCkpe3ZhciBnPWEoZCk7dGhpcy5hY3RpdmF0ZShiLnBhcmVudCgibGkiKSxjKSx0aGlzLmFjdGl2YXRlKGcsZy5wYXJlbnQoKSxmdW5jdGlvbigpe2IudHJpZ2dlcih7dHlwZToic2hvd24uYnMudGFiIixyZWxhdGVkVGFyZ2V0OmV9KX0pfX19LGIucHJvdG90eXBlLmFjdGl2YXRlPWZ1bmN0aW9uKGIsYyxkKXtmdW5jdGlvbiBlKCl7Zi5yZW1vdmVDbGFzcygiYWN0aXZlIikuZmluZCgiPiAuZHJvcGRvd24tbWVudSA+IC5hY3RpdmUiKS5yZW1vdmVDbGFzcygiYWN0aXZlIiksYi5hZGRDbGFzcygiYWN0aXZlIiksZz8oYlswXS5vZmZzZXRXaWR0aCxiLmFkZENsYXNzKCJpbiIpKTpiLnJlbW92ZUNsYXNzKCJmYWRlIiksYi5wYXJlbnQoIi5kcm9wZG93bi1tZW51IikmJmIuY2xvc2VzdCgibGkuZHJvcGRvd24iKS5hZGRDbGFzcygiYWN0aXZlIiksZCYmZCgpfXZhciBmPWMuZmluZCgiPiAuYWN0aXZlIiksZz1kJiZhLnN1cHBvcnQudHJhbnNpdGlvbiYmZi5oYXNDbGFzcygiZmFkZSIpO2c/Zi5vbmUoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLGUpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDE1MCk6ZSgpLGYucmVtb3ZlQ2xhc3MoImluIil9O3ZhciBjPWEuZm4udGFiO2EuZm4udGFiPWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy50YWIiKTtlfHxkLmRhdGEoImJzLnRhYiIsZT1uZXcgYih0aGlzKSksInN0cmluZyI9PXR5cGVvZiBjJiZlW2NdKCl9KX0sYS5mbi50YWIuQ29uc3RydWN0b3I9YixhLmZuLnRhYi5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4udGFiPWMsdGhpc30sYShkb2N1bWVudCkub24oImNsaWNrLmJzLnRhYi5kYXRhLWFwaSIsJ1tkYXRhLXRvZ2dsZT0idGFiIl0sIFtkYXRhLXRvZ2dsZT0icGlsbCJdJyxmdW5jdGlvbihiKXtiLnByZXZlbnREZWZhdWx0KCksYSh0aGlzKS50YWIoInNob3ciKX0pfShqUXVlcnkpLCtmdW5jdGlvbihhKXsidXNlIHN0cmljdCI7dmFyIGI9ZnVuY3Rpb24oYyxkKXt0aGlzLm9wdGlvbnM9YS5leHRlbmQoe30sYi5ERUZBVUxUUyxkKSx0aGlzLiR3aW5kb3c9YSh3aW5kb3cpLm9uKCJzY3JvbGwuYnMuYWZmaXguZGF0YS1hcGkiLGEucHJveHkodGhpcy5jaGVja1Bvc2l0aW9uLHRoaXMpKS5vbigiY2xpY2suYnMuYWZmaXguZGF0YS1hcGkiLGEucHJveHkodGhpcy5jaGVja1Bvc2l0aW9uV2l0aEV2ZW50TG9vcCx0aGlzKSksdGhpcy4kZWxlbWVudD1hKGMpLHRoaXMuYWZmaXhlZD10aGlzLnVucGluPW51bGwsdGhpcy5jaGVja1Bvc2l0aW9uKCl9O2IuUkVTRVQ9ImFmZml4IGFmZml4LXRvcCBhZmZpeC1ib3R0b20iLGIuREVGQVVMVFM9e29mZnNldDowfSxiLnByb3RvdHlwZS5jaGVja1Bvc2l0aW9uV2l0aEV2ZW50TG9vcD1mdW5jdGlvbigpe3NldFRpbWVvdXQoYS5wcm94eSh0aGlzLmNoZWNrUG9zaXRpb24sdGhpcyksMSl9LGIucHJvdG90eXBlLmNoZWNrUG9zaXRpb249ZnVuY3Rpb24oKXtpZih0aGlzLiRlbGVtZW50LmlzKCI6dmlzaWJsZSIpKXt2YXIgYz1hKGRvY3VtZW50KS5oZWlnaHQoKSxkPXRoaXMuJHdpbmRvdy5zY3JvbGxUb3AoKSxlPXRoaXMuJGVsZW1lbnQub2Zmc2V0KCksZj10aGlzLm9wdGlvbnMub2Zmc2V0LGc9Zi50b3AsaD1mLmJvdHRvbTsib2JqZWN0IiE9dHlwZW9mIGYmJihoPWc9ZiksImZ1bmN0aW9uIj09dHlwZW9mIGcmJihnPWYudG9wKCkpLCJmdW5jdGlvbiI9PXR5cGVvZiBoJiYoaD1mLmJvdHRvbSgpKTt2YXIgaT1udWxsIT10aGlzLnVucGluJiZkK3RoaXMudW5waW48PWUudG9wPyExOm51bGwhPWgmJmUudG9wK3RoaXMuJGVsZW1lbnQuaGVpZ2h0KCk+PWMtaD8iYm90dG9tIjpudWxsIT1nJiZnPj1kPyJ0b3AiOiExO3RoaXMuYWZmaXhlZCE9PWkmJih0aGlzLnVucGluJiZ0aGlzLiRlbGVtZW50LmNzcygidG9wIiwiIiksdGhpcy5hZmZpeGVkPWksdGhpcy51bnBpbj0iYm90dG9tIj09aT9lLnRvcC1kOm51bGwsdGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcyhiLlJFU0VUKS5hZGRDbGFzcygiYWZmaXgiKyhpPyItIitpOiIiKSksImJvdHRvbSI9PWkmJnRoaXMuJGVsZW1lbnQub2Zmc2V0KHt0b3A6ZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQtaC10aGlzLiRlbGVtZW50LmhlaWdodCgpfSkpfX07dmFyIGM9YS5mbi5hZmZpeDthLmZuLmFmZml4PWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5hZmZpeCIpLGY9Im9iamVjdCI9PXR5cGVvZiBjJiZjO2V8fGQuZGF0YSgiYnMuYWZmaXgiLGU9bmV3IGIodGhpcyxmKSksInN0cmluZyI9PXR5cGVvZiBjJiZlW2NdKCl9KX0sYS5mbi5hZmZpeC5Db25zdHJ1Y3Rvcj1iLGEuZm4uYWZmaXgubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLmFmZml4PWMsdGhpc30sYSh3aW5kb3cpLm9uKCJsb2FkIixmdW5jdGlvbigpe2EoJ1tkYXRhLXNweT0iYWZmaXgiXScpLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1hKHRoaXMpLGM9Yi5kYXRhKCk7Yy5vZmZzZXQ9Yy5vZmZzZXR8fHt9LGMub2Zmc2V0Qm90dG9tJiYoYy5vZmZzZXQuYm90dG9tPWMub2Zmc2V0Qm90dG9tKSxjLm9mZnNldFRvcCYmKGMub2Zmc2V0LnRvcD1jLm9mZnNldFRvcCksYi5hZmZpeChjKX0pfSl9KGpRdWVyeSk7Cn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ey8qIA0KICogQWpheCB1dGlsaXR5IHRvIGhhbmRsZSBhamF4IGNhbGxzIGZyb20gdmFyaW91cyBvYmplY3RzIGxpa2UgVE1TLCBTZWFyY2ggUGFnaW5hdGlvbiwgU2VhcmNoIHJlc3VsdHMgZXRjLi4NCiAqIEF1dGhvcjogVmFydW4gVmluYXlhaw0KICogDQogKiBQYXJhbWV0ZXJzOg0KICogYWN0aW9uTmFtZSAgLSAoU3RyaW5nKSAtIE5hbWUgb2YgdGhlIGZ1bmN0aW9uIHRoYXQgY2FsbHMgdGhlIHV0aWxpdHkgLSBSRVFVSVJFRA0KICogYWN0aW9uVXJsICAgLSAoU3RyaW5nKSAtIEVuZCBwb2ludCBVcmwgZm9yIHRoZSBhamF4IGNhbGwgLSBSRVFVSVJFRA0KICogcmVxdWVzdFR5cGUgLSAoU3RyaW5nKSAtIFR5cGUgb2YgYWpheCByZXF1ZXN0IC4gUE9TVCB8IEdFVCAtIFJFUVVJUkVEDQogKiBhc3luYyAtIChCb29sZWFuKSAtIHtUcnVlOiBBc3luY2hyb25vdXN9e0ZhbHNlOiBTeW5jaHJvbm91c30NCiAqIHN1Y2Nlc3NIYW5kbGVyIC0gKEZ1bmN0aW9uKSAtIFN1Y2Nlc3MgaGFuZGxlciBpcyBjYWxsZWQgaWYgYWpheCBjYWxsIHdhcyBzdWNjZXNzZnVsIC4gLSBSRVFVSVJFRA0KICogc3VjY2Vzc0hhbmRsZXJQYXJhbXMgLSAtIEFueSBhZGRpdGlvbmFsIHBhcmFtcyB0byBiZSBjYWxsZWQgb24gc3VjY2VzcyBoYW5kbGVyIC0ge051bGwgaWYgdGhlcmUgYXJlIG5vIGFkZGl0aW9uYWwgcGFyYW1zfQ0KICogZmFpbHVyZUhhbmRsZXIgLSAoRnVuY3Rpb24pIC0gRmFpbHVyZSBoYW5kbGVyIGlzIGNhbGxlZCBpZiBhamF4IGNhbGwgd2FzIGZhaWxlZC4NCiAqIGZhaWx1cmVIYW5kbGVyUGFyYW1zIC0gLSBBbnkgYWRkaXRpb25hbCBwYXJhbXMgdG8gYmUgY2FsbGVkIG9uIGZhaWx1cmUgaGFuZGxlciAtIHtOdWxsIGlmIHRoZXJlIGFyZSBubyBhZGRpdGlvbmFsIHBhcmFtc30NCiAqIHJlcXVlc3REYXRhVHlwZSAtIChTdHJpbmcpIC0gZGF0YSB0eXBlIG9mIHRoZSBleHBlY3RlZCByZXNwb25zZS4gVGhpcyBkYXRhIHNob3VsZCBiZSBlbmNyeXB0ZWQgYXMgYW5kIHdoZW4gcmVxdWlyZWQuIFNvbWV0aW1lcyB3ZSBhcmUgYWxzbyBtYWtpbmcgaHR0cHMgY2FsbHMNCiAqIHJlcXVlc3REYXRhSW5wdXQgLSAocmVxdWVzdERhdGFUeXBlKSAtIGRhdGEgdG8gYmUgc2VudCB3aXRoIHRoZSBhamF4IHJlcXVlc3QNCiAqIGJlZm9yZVNlbmRIYW5kbGVyIC0gKEZ1bmN0aW9uKSAtIEZ1bmN0aW9uIHdoaWNoIG5lZWRzIHRvIGJlIGNhbGxlZCBiZWZvcmUgYWpheCBjYWxsDQogKiBiZWZvcmVTZW5kUGFyYW1zIC0gLSBBbnkgYWRkaXRpb25hbCBwYXJhbXMgZm9yIGJlZm9yZVNlbmRIYW5kbGVyIC0ge051bGwgaWYgdGhlcmUgYXJlIG5vIGFkZGl0aW9uYWwgcGFyYW1zfQ0KICogY29tcGxldGVIYW5kbGVyIC0gKEZ1bmN0aW9uKSAtIEZ1bmN0aW9uIHdoaWNoIG5lZWRzIHRvIGJlIGNhbGxlZCBhZnRlZXIgY29tcGxldGlvbiBvZiBhamF4IGNhbGwNCiAqIGNvbXBsZXRlSGFuZGxlclBhcmFtcyAtIC0gQW55IGFkZGl0aW9uYWwgcGFyYW1zIGZvciBjb21wbGV0ZUhhbmRsZXIgLSB7TnVsbCBpZiB0aGVyZSBhcmUgbm8gYWRkaXRpb25hbCBwYXJhbXN9DQogKi8NCi8vIFBhc3MgbnVsbCB2YWx1ZXMgd2hlcmUgZXZlciBwYXJhbSBpcyBub3QgYXBwbGljYWJsZQ0KDQoNCnZhciBwcm9ncmVzcyA9IG51bGw7IC8vIHRoaXMgdmFyaWFibGUgbmFtZSBpcyB1c2VkIHRvIGFib3J0IGFqYXggd2hlbiByZXF1aXJlZC4NCg0KDQpmdW5jdGlvbiBjYWxsQWpheFV0aWwoYWN0aW9uTmFtZSxhY3Rpb25VcmwscmVxdWVzdFR5cGUsc3VjY2Vzc0hhbmRsZXIscmVxdWVzdERhdGFUeXBlLCByZXF1ZXN0RGF0YUlucHV0LHN1Y2Nlc3NIYW5kbGVyUGFyYW1zLCBmYWlsdXJlSGFuZGxlciwgDQoJCWZhaWx1cmVIYW5kbGVyUGFyYW1zLGFzeW5jLGJlZm9yZVNlbmRIYW5kbGVyLGJlZm9yZVNlbmRQYXJhbXMsY29tcGxldGVIYW5kbGVyLGNvbXBsZXRlSGFuZGxlclBhcmFtcykgew0KICAgIC8qIEluaXRpYWxpc2luZyBzb21lIG9wdGlvbmFsIHBhcmFtcyAqLw0KICAgIGlmKChhc3luYyA9PSAnJyl8fChhc3luYyA9PSBudWxsKXx8KGFzeW5jID09IHVuZGVmaW5lZCkgKQ0KCXsNCgkJYXN5bmMgPSB0cnVlOw0KCX0NCiAgICBpZigocmVxdWVzdERhdGFUeXBlID09ICcnKXx8KHJlcXVlc3REYXRhVHlwZSA9PSBudWxsKXx8KHJlcXVlc3REYXRhVHlwZSA9PSB1bmRlZmluZWQpICkNCiAgICB7DQogICAgCXJlcXVlc3REYXRhVHlwZSA9ICdKU09OJzsNCiAgICB9DQogICAgaWYoKHJlcXVlc3REYXRhSW5wdXQgPT0gJycpfHwocmVxdWVzdERhdGFJbnB1dCA9PSBudWxsKXx8KHJlcXVlc3REYXRhSW5wdXQgPT0gdW5kZWZpbmVkKSApDQogICAgew0KICAgIAlyZXF1ZXN0RGF0YUlucHV0ID0ge307DQogICAgfQ0KICAgDQogICAgLyogVGhlIG1hZ2ljIGhhcHBlbnMgYmVsb3cgKi8NCiAgICANCiAgICBwcm9ncmVzcyA9ICQuYWpheCh7DQogICAgICAgIHR5cGU6IHJlcXVlc3RUeXBlLA0KICAgICAgICBhc3luYzogYXN5bmMsDQogICAgICAgIHVybDogYWN0aW9uVXJsLA0KICAgICAgICBkYXRhVHlwZTogcmVxdWVzdERhdGFUeXBlLA0KICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICAncmVxdWVzdEpzb24nOiByZXF1ZXN0RGF0YUlucHV0DQogICAgICAgIH0sDQogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdHMpIHsNCiAgICAgICAgICAgIGlmICgoc3VjY2Vzc0hhbmRsZXJQYXJhbXMgPT0gbnVsbCkpDQogICAgICAgICAgICAJew0KICAgICAgICAgICAgICAgIHN1Y2Nlc3NIYW5kbGVyKHJlc3VsdHMpOw0KICAgICAgICAgICAgCX0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHN1Y2Nlc3NIYW5kbGVyKHJlc3VsdHMsIHN1Y2Nlc3NIYW5kbGVyUGFyYW1zKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHhtbCwgc3RhdHVzLCBlcnJvcikgew0KICAgICAgICAgICAgaWYgKGZhaWx1cmVIYW5kbGVyICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBpZiAoKGZhaWx1cmVIYW5kbGVyUGFyYW1zID09IG51bGwpKQ0KICAgICAgICAgICAgICAgICAgICBmYWlsdXJlSGFuZGxlcigpOw0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBmYWlsdXJlSGFuZGxlcihmYWlsdXJlSGFuZGxlclBhcmFtcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0sDQogICAgICAgIGJlZm9yZVNlbmQgOiBmdW5jdGlvbih4aHIpIHsNCiAgICAgICAgCWlmKChiZWZvcmVTZW5kSGFuZGxlciAhPSAnJykgJiYgKGJlZm9yZVNlbmRIYW5kbGVyICE9IG51bGwpICYmIChiZWZvcmVTZW5kSGFuZGxlciAhPSB1bmRlZmluZWQpKXsNCiAgICAgICAgICAgICAgICBpZiAoKGJlZm9yZVNlbmRQYXJhbXMgPT0gbnVsbCkpDQogICAgICAgICAgICAgICAgCWJlZm9yZVNlbmRIYW5kbGVyKCk7DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgCWJlZm9yZVNlbmRIYW5kbGVyKGJlZm9yZVNlbmRQYXJhbXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkgew0KICAgICAgICAJaWYoKGNvbXBsZXRlSGFuZGxlciAhPSAnJykmJihjb21wbGV0ZUhhbmRsZXIgIT0gbnVsbCkmJihjb21wbGV0ZUhhbmRsZXIgIT0gdW5kZWZpbmVkKSl7DQogICAgICAgICAgICAgICAgaWYgKChjb21wbGV0ZUhhbmRsZXJQYXJhbXMgPT0gbnVsbCkpDQogICAgICAgICAgICAgICAgCWNvbXBsZXRlSGFuZGxlcigpOw0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIAljb21wbGV0ZUhhbmRsZXIoY29tcGxldGVIYW5kbGVyUGFyYW1zKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9KTsNCn0NCi8qIFRoaXMgaXMgdG8gYWJvcnQgYW55IGFqYXggY2FsbC4qLw0KZnVuY3Rpb24gYWJvcnRBamF4VXRpbCgpew0KCSBpZihwcm9ncmVzcyAmJiBwcm9ncmVzcy5yZWFkeVN0YXRlICE9IDQgJiYgcHJvZ3Jlc3MucmVhZHlTdGF0ZSAhPSAwKXsNCgkJIHByb2dyZXNzLmFib3J0KCk7DQoJCSBwcm9ncmVzcyA9IG51bGw7DQogICAgIH0NCgkNCn0KfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7LyogTW9kZXJuaXpyIDIuNy4xIChDdXN0b20gQnVpbGQpIHwgTUlUICYgQlNECiAqIEJ1aWxkOiBodHRwOi8vbW9kZXJuaXpyLmNvbS9kb3dubG9hZC8jLWZvbnRmYWNlLWJhY2tncm91bmRzaXplLWJvcmRlcmltYWdlLWJvcmRlcnJhZGl1cy1ib3hzaGFkb3ctZmxleGJveC1mbGV4Ym94bGVnYWN5LWhzbGEtbXVsdGlwbGViZ3Mtb3BhY2l0eS1yZ2JhLXRleHRzaGFkb3ctY3NzYW5pbWF0aW9ucy1jc3Njb2x1bW5zLWdlbmVyYXRlZGNvbnRlbnQtY3NzZ3JhZGllbnRzLWNzc3JlZmxlY3Rpb25zLWNzc3RyYW5zZm9ybXMtY3NzdHJhbnNmb3JtczNkLWNzc3RyYW5zaXRpb25zLWFwcGxpY2F0aW9uY2FjaGUtY2FudmFzLWNhbnZhc3RleHQtZHJhZ2FuZGRyb3AtaGFzaGNoYW5nZS1oaXN0b3J5LWF1ZGlvLXZpZGVvLWluZGV4ZWRkYi1pbnB1dC1pbnB1dHR5cGVzLWxvY2Fsc3RvcmFnZS1wb3N0bWVzc2FnZS1zZXNzaW9uc3RvcmFnZS13ZWJzb2NrZXRzLXdlYnNxbGRhdGFiYXNlLXdlYndvcmtlcnMtc2hpdi1jc3NjbGFzc2VzLXRlc3RzdHlsZXMtdGVzdHByb3AtdGVzdGFsbHByb3BzLWhhc2V2ZW50LXByZWZpeGVzLWRvbXByZWZpeGVzLWxvYWQKICovCjt3aW5kb3cuTW9kZXJuaXpyPWZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBCKGEpe2ouY3NzVGV4dD1hfWZ1bmN0aW9uIEMoYSxiKXtyZXR1cm4gQihuLmpvaW4oYSsiOyIpKyhifHwiIikpfWZ1bmN0aW9uIEQoYSxiKXtyZXR1cm4gdHlwZW9mIGE9PT1ifWZ1bmN0aW9uIEUoYSxiKXtyZXR1cm4hIX4oIiIrYSkuaW5kZXhPZihiKX1mdW5jdGlvbiBGKGEsYil7Zm9yKHZhciBkIGluIGEpe3ZhciBlPWFbZF07aWYoIUUoZSwiLSIpJiZqW2VdIT09YylyZXR1cm4gYj09InBmeCI/ZTohMH1yZXR1cm4hMX1mdW5jdGlvbiBHKGEsYixkKXtmb3IodmFyIGUgaW4gYSl7dmFyIGY9YlthW2VdXTtpZihmIT09YylyZXR1cm4gZD09PSExP2FbZV06RChmLCJmdW5jdGlvbiIpP2YuYmluZChkfHxiKTpmfXJldHVybiExfWZ1bmN0aW9uIEgoYSxiLGMpe3ZhciBkPWEuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrYS5zbGljZSgxKSxlPShhKyIgIitwLmpvaW4oZCsiICIpK2QpLnNwbGl0KCIgIik7cmV0dXJuIEQoYiwic3RyaW5nIil8fEQoYiwidW5kZWZpbmVkIik/RihlLGIpOihlPShhKyIgIitxLmpvaW4oZCsiICIpK2QpLnNwbGl0KCIgIiksRyhlLGIsYykpfWZ1bmN0aW9uIEkoKXtlLmlucHV0PWZ1bmN0aW9uKGMpe2Zvcih2YXIgZD0wLGU9Yy5sZW5ndGg7ZDxlO2QrKyl0W2NbZF1dPWNbZF1pbiBrO3JldHVybiB0Lmxpc3QmJih0Lmxpc3Q9ISFiLmNyZWF0ZUVsZW1lbnQoImRhdGFsaXN0IikmJiEhYS5IVE1MRGF0YUxpc3RFbGVtZW50KSx0fSgiYXV0b2NvbXBsZXRlIGF1dG9mb2N1cyBsaXN0IHBsYWNlaG9sZGVyIG1heCBtaW4gbXVsdGlwbGUgcGF0dGVybiByZXF1aXJlZCBzdGVwIi5zcGxpdCgiICIpKSxlLmlucHV0dHlwZXM9ZnVuY3Rpb24oYSl7Zm9yKHZhciBkPTAsZSxmLGgsaT1hLmxlbmd0aDtkPGk7ZCsrKWsuc2V0QXR0cmlidXRlKCJ0eXBlIixmPWFbZF0pLGU9ay50eXBlIT09InRleHQiLGUmJihrLnZhbHVlPWwsay5zdHlsZS5jc3NUZXh0PSJwb3NpdGlvbjphYnNvbHV0ZTt2aXNpYmlsaXR5OmhpZGRlbjsiLC9ecmFuZ2UkLy50ZXN0KGYpJiZrLnN0eWxlLldlYmtpdEFwcGVhcmFuY2UhPT1jPyhnLmFwcGVuZENoaWxkKGspLGg9Yi5kZWZhdWx0VmlldyxlPWguZ2V0Q29tcHV0ZWRTdHlsZSYmaC5nZXRDb21wdXRlZFN0eWxlKGssbnVsbCkuV2Via2l0QXBwZWFyYW5jZSE9PSJ0ZXh0ZmllbGQiJiZrLm9mZnNldEhlaWdodCE9PTAsZy5yZW1vdmVDaGlsZChrKSk6L14oc2VhcmNofHRlbCkkLy50ZXN0KGYpfHwoL14odXJsfGVtYWlsKSQvLnRlc3QoZik/ZT1rLmNoZWNrVmFsaWRpdHkmJmsuY2hlY2tWYWxpZGl0eSgpPT09ITE6ZT1rLnZhbHVlIT1sKSksc1thW2RdXT0hIWU7cmV0dXJuIHN9KCJzZWFyY2ggdGVsIHVybCBlbWFpbCBkYXRldGltZSBkYXRlIG1vbnRoIHdlZWsgdGltZSBkYXRldGltZS1sb2NhbCBudW1iZXIgcmFuZ2UgY29sb3IiLnNwbGl0KCIgIikpfXZhciBkPSIyLjcuMSIsZT17fSxmPSEwLGc9Yi5kb2N1bWVudEVsZW1lbnQsaD0ibW9kZXJuaXpyIixpPWIuY3JlYXRlRWxlbWVudChoKSxqPWkuc3R5bGUsaz1iLmNyZWF0ZUVsZW1lbnQoImlucHV0IiksbD0iOikiLG09e30udG9TdHJpbmcsbj0iIC13ZWJraXQtIC1tb3otIC1vLSAtbXMtICIuc3BsaXQoIiAiKSxvPSJXZWJraXQgTW96IE8gbXMiLHA9by5zcGxpdCgiICIpLHE9by50b0xvd2VyQ2FzZSgpLnNwbGl0KCIgIikscj17fSxzPXt9LHQ9e30sdT1bXSx2PXUuc2xpY2Usdyx4PWZ1bmN0aW9uKGEsYyxkLGUpe3ZhciBmLGksaixrLGw9Yi5jcmVhdGVFbGVtZW50KCJkaXYiKSxtPWIuYm9keSxuPW18fGIuY3JlYXRlRWxlbWVudCgiYm9keSIpO2lmKHBhcnNlSW50KGQsMTApKXdoaWxlKGQtLSlqPWIuY3JlYXRlRWxlbWVudCgiZGl2Iiksai5pZD1lP2VbZF06aCsoZCsxKSxsLmFwcGVuZENoaWxkKGopO3JldHVybiBmPVsiJiMxNzM7IiwnPHN0eWxlIGlkPSJzJyxoLCciPicsYSwiPC9zdHlsZT4iXS5qb2luKCIiKSxsLmlkPWgsKG0/bDpuKS5pbm5lckhUTUwrPWYsbi5hcHBlbmRDaGlsZChsKSxtfHwobi5zdHlsZS5iYWNrZ3JvdW5kPSIiLG4uc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIsaz1nLnN0eWxlLm92ZXJmbG93LGcuc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIsZy5hcHBlbmRDaGlsZChuKSksaT1jKGwsYSksbT9sLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobCk6KG4ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuKSxnLnN0eWxlLm92ZXJmbG93PWspLCEhaX0seT1mdW5jdGlvbigpe2Z1bmN0aW9uIGQoZCxlKXtlPWV8fGIuY3JlYXRlRWxlbWVudChhW2RdfHwiZGl2IiksZD0ib24iK2Q7dmFyIGY9ZCBpbiBlO3JldHVybiBmfHwoZS5zZXRBdHRyaWJ1dGV8fChlPWIuY3JlYXRlRWxlbWVudCgiZGl2IikpLGUuc2V0QXR0cmlidXRlJiZlLnJlbW92ZUF0dHJpYnV0ZSYmKGUuc2V0QXR0cmlidXRlKGQsIiIpLGY9RChlW2RdLCJmdW5jdGlvbiIpLEQoZVtkXSwidW5kZWZpbmVkIil8fChlW2RdPWMpLGUucmVtb3ZlQXR0cmlidXRlKGQpKSksZT1udWxsLGZ9dmFyIGE9e3NlbGVjdDoiaW5wdXQiLGNoYW5nZToiaW5wdXQiLHN1Ym1pdDoiZm9ybSIscmVzZXQ6ImZvcm0iLGVycm9yOiJpbWciLGxvYWQ6ImltZyIsYWJvcnQ6ImltZyJ9O3JldHVybiBkfSgpLHo9e30uaGFzT3duUHJvcGVydHksQTshRCh6LCJ1bmRlZmluZWQiKSYmIUQoei5jYWxsLCJ1bmRlZmluZWQiKT9BPWZ1bmN0aW9uKGEsYil7cmV0dXJuIHouY2FsbChhLGIpfTpBPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGIgaW4gYSYmRChhLmNvbnN0cnVjdG9yLnByb3RvdHlwZVtiXSwidW5kZWZpbmVkIil9LEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kfHwoRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQ9ZnVuY3Rpb24oYil7dmFyIGM9dGhpcztpZih0eXBlb2YgYyE9ImZ1bmN0aW9uIil0aHJvdyBuZXcgVHlwZUVycm9yO3ZhciBkPXYuY2FsbChhcmd1bWVudHMsMSksZT1mdW5jdGlvbigpe2lmKHRoaXMgaW5zdGFuY2VvZiBlKXt2YXIgYT1mdW5jdGlvbigpe307YS5wcm90b3R5cGU9Yy5wcm90b3R5cGU7dmFyIGY9bmV3IGEsZz1jLmFwcGx5KGYsZC5jb25jYXQodi5jYWxsKGFyZ3VtZW50cykpKTtyZXR1cm4gT2JqZWN0KGcpPT09Zz9nOmZ9cmV0dXJuIGMuYXBwbHkoYixkLmNvbmNhdCh2LmNhbGwoYXJndW1lbnRzKSkpfTtyZXR1cm4gZX0pLHIuZmxleGJveD1mdW5jdGlvbigpe3JldHVybiBIKCJmbGV4V3JhcCIpfSxyLmZsZXhib3hsZWdhY3k9ZnVuY3Rpb24oKXtyZXR1cm4gSCgiYm94RGlyZWN0aW9uIil9LHIuY2FudmFzPWZ1bmN0aW9uKCl7dmFyIGE9Yi5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTtyZXR1cm4hIWEuZ2V0Q29udGV4dCYmISFhLmdldENvbnRleHQoIjJkIil9LHIuY2FudmFzdGV4dD1mdW5jdGlvbigpe3JldHVybiEhZS5jYW52YXMmJiEhRChiLmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpLmdldENvbnRleHQoIjJkIikuZmlsbFRleHQsImZ1bmN0aW9uIil9LHIucG9zdG1lc3NhZ2U9ZnVuY3Rpb24oKXtyZXR1cm4hIWEucG9zdE1lc3NhZ2V9LHIud2Vic3FsZGF0YWJhc2U9ZnVuY3Rpb24oKXtyZXR1cm4hIWEub3BlbkRhdGFiYXNlfSxyLmluZGV4ZWREQj1mdW5jdGlvbigpe3JldHVybiEhSCgiaW5kZXhlZERCIixhKX0sci5oYXNoY2hhbmdlPWZ1bmN0aW9uKCl7cmV0dXJuIHkoImhhc2hjaGFuZ2UiLGEpJiYoYi5kb2N1bWVudE1vZGU9PT1jfHxiLmRvY3VtZW50TW9kZT43KX0sci5oaXN0b3J5PWZ1bmN0aW9uKCl7cmV0dXJuISFhLmhpc3RvcnkmJiEhaGlzdG9yeS5wdXNoU3RhdGV9LHIuZHJhZ2FuZGRyb3A9ZnVuY3Rpb24oKXt2YXIgYT1iLmNyZWF0ZUVsZW1lbnQoImRpdiIpO3JldHVybiJkcmFnZ2FibGUiaW4gYXx8Im9uZHJhZ3N0YXJ0ImluIGEmJiJvbmRyb3AiaW4gYX0sci53ZWJzb2NrZXRzPWZ1bmN0aW9uKCl7cmV0dXJuIldlYlNvY2tldCJpbiBhfHwiTW96V2ViU29ja2V0ImluIGF9LHIucmdiYT1mdW5jdGlvbigpe3JldHVybiBCKCJiYWNrZ3JvdW5kLWNvbG9yOnJnYmEoMTUwLDI1NSwxNTAsLjUpIiksRShqLmJhY2tncm91bmRDb2xvciwicmdiYSIpfSxyLmhzbGE9ZnVuY3Rpb24oKXtyZXR1cm4gQigiYmFja2dyb3VuZC1jb2xvcjpoc2xhKDEyMCw0MCUsMTAwJSwuNSkiKSxFKGouYmFja2dyb3VuZENvbG9yLCJyZ2JhIil8fEUoai5iYWNrZ3JvdW5kQ29sb3IsImhzbGEiKX0sci5tdWx0aXBsZWJncz1mdW5jdGlvbigpe3JldHVybiBCKCJiYWNrZ3JvdW5kOnVybChodHRwczovLyksdXJsKGh0dHBzOi8vKSxyZWQgdXJsKGh0dHBzOi8vKSIpLC8odXJsXHMqXCguKj8pezN9Ly50ZXN0KGouYmFja2dyb3VuZCl9LHIuYmFja2dyb3VuZHNpemU9ZnVuY3Rpb24oKXtyZXR1cm4gSCgiYmFja2dyb3VuZFNpemUiKX0sci5ib3JkZXJpbWFnZT1mdW5jdGlvbigpe3JldHVybiBIKCJib3JkZXJJbWFnZSIpfSxyLmJvcmRlcnJhZGl1cz1mdW5jdGlvbigpe3JldHVybiBIKCJib3JkZXJSYWRpdXMiKX0sci5ib3hzaGFkb3c9ZnVuY3Rpb24oKXtyZXR1cm4gSCgiYm94U2hhZG93Iil9LHIudGV4dHNoYWRvdz1mdW5jdGlvbigpe3JldHVybiBiLmNyZWF0ZUVsZW1lbnQoImRpdiIpLnN0eWxlLnRleHRTaGFkb3c9PT0iIn0sci5vcGFjaXR5PWZ1bmN0aW9uKCl7cmV0dXJuIEMoIm9wYWNpdHk6LjU1IiksL14wLjU1JC8udGVzdChqLm9wYWNpdHkpfSxyLmNzc2FuaW1hdGlvbnM9ZnVuY3Rpb24oKXtyZXR1cm4gSCgiYW5pbWF0aW9uTmFtZSIpfSxyLmNzc2NvbHVtbnM9ZnVuY3Rpb24oKXtyZXR1cm4gSCgiY29sdW1uQ291bnQiKX0sci5jc3NncmFkaWVudHM9ZnVuY3Rpb24oKXt2YXIgYT0iYmFja2dyb3VuZC1pbWFnZToiLGI9ImdyYWRpZW50KGxpbmVhcixsZWZ0IHRvcCxyaWdodCBib3R0b20sZnJvbSgjOWY5KSx0byh3aGl0ZSkpOyIsYz0ibGluZWFyLWdyYWRpZW50KGxlZnQgdG9wLCM5ZjksIHdoaXRlKTsiO3JldHVybiBCKChhKyItd2Via2l0LSAiLnNwbGl0KCIgIikuam9pbihiK2EpK24uam9pbihjK2EpKS5zbGljZSgwLC1hLmxlbmd0aCkpLEUoai5iYWNrZ3JvdW5kSW1hZ2UsImdyYWRpZW50Iil9LHIuY3NzcmVmbGVjdGlvbnM9ZnVuY3Rpb24oKXtyZXR1cm4gSCgiYm94UmVmbGVjdCIpfSxyLmNzc3RyYW5zZm9ybXM9ZnVuY3Rpb24oKXtyZXR1cm4hIUgoInRyYW5zZm9ybSIpfSxyLmNzc3RyYW5zZm9ybXMzZD1mdW5jdGlvbigpe3ZhciBhPSEhSCgicGVyc3BlY3RpdmUiKTtyZXR1cm4gYSYmIndlYmtpdFBlcnNwZWN0aXZlImluIGcuc3R5bGUmJngoIkBtZWRpYSAodHJhbnNmb3JtLTNkKSwoLXdlYmtpdC10cmFuc2Zvcm0tM2QpeyNtb2Rlcm5penJ7bGVmdDo5cHg7cG9zaXRpb246YWJzb2x1dGU7aGVpZ2h0OjNweDt9fSIsZnVuY3Rpb24oYixjKXthPWIub2Zmc2V0TGVmdD09PTkmJmIub2Zmc2V0SGVpZ2h0PT09M30pLGF9LHIuY3NzdHJhbnNpdGlvbnM9ZnVuY3Rpb24oKXtyZXR1cm4gSCgidHJhbnNpdGlvbiIpfSxyLmZvbnRmYWNlPWZ1bmN0aW9uKCl7dmFyIGE7cmV0dXJuIHgoJ0Bmb250LWZhY2Uge2ZvbnQtZmFtaWx5OiJmb250IjtzcmM6dXJsKCJodHRwczovLyIpfScsZnVuY3Rpb24oYyxkKXt2YXIgZT1iLmdldEVsZW1lbnRCeUlkKCJzbW9kZXJuaXpyIiksZj1lLnNoZWV0fHxlLnN0eWxlU2hlZXQsZz1mP2YuY3NzUnVsZXMmJmYuY3NzUnVsZXNbMF0/Zi5jc3NSdWxlc1swXS5jc3NUZXh0OmYuY3NzVGV4dHx8IiI6IiI7YT0vc3JjL2kudGVzdChnKSYmZy5pbmRleE9mKGQuc3BsaXQoIiAiKVswXSk9PT0wfSksYX0sci5nZW5lcmF0ZWRjb250ZW50PWZ1bmN0aW9uKCl7dmFyIGE7cmV0dXJuIHgoWyIjIixoLCJ7Zm9udDowLzAgYX0jIixoLCc6YWZ0ZXJ7Y29udGVudDoiJyxsLCciO3Zpc2liaWxpdHk6aGlkZGVuO2ZvbnQ6M3B4LzEgYX0nXS5qb2luKCIiKSxmdW5jdGlvbihiKXthPWIub2Zmc2V0SGVpZ2h0Pj0zfSksYX0sci52aWRlbz1mdW5jdGlvbigpe3ZhciBhPWIuY3JlYXRlRWxlbWVudCgidmlkZW8iKSxjPSExO3RyeXtpZihjPSEhYS5jYW5QbGF5VHlwZSljPW5ldyBCb29sZWFuKGMpLGMub2dnPWEuY2FuUGxheVR5cGUoJ3ZpZGVvL29nZzsgY29kZWNzPSJ0aGVvcmEiJykucmVwbGFjZSgvXm5vJC8sIiIpLGMuaDI2ND1hLmNhblBsYXlUeXBlKCd2aWRlby9tcDQ7IGNvZGVjcz0iYXZjMS40MkUwMUUiJykucmVwbGFjZSgvXm5vJC8sIiIpLGMud2VibT1hLmNhblBsYXlUeXBlKCd2aWRlby93ZWJtOyBjb2RlY3M9InZwOCwgdm9yYmlzIicpLnJlcGxhY2UoL15ubyQvLCIiKX1jYXRjaChkKXt9cmV0dXJuIGN9LHIuYXVkaW89ZnVuY3Rpb24oKXt2YXIgYT1iLmNyZWF0ZUVsZW1lbnQoImF1ZGlvIiksYz0hMTt0cnl7aWYoYz0hIWEuY2FuUGxheVR5cGUpYz1uZXcgQm9vbGVhbihjKSxjLm9nZz1hLmNhblBsYXlUeXBlKCdhdWRpby9vZ2c7IGNvZGVjcz0idm9yYmlzIicpLnJlcGxhY2UoL15ubyQvLCIiKSxjLm1wMz1hLmNhblBsYXlUeXBlKCJhdWRpby9tcGVnOyIpLnJlcGxhY2UoL15ubyQvLCIiKSxjLndhdj1hLmNhblBsYXlUeXBlKCdhdWRpby93YXY7IGNvZGVjcz0iMSInKS5yZXBsYWNlKC9ebm8kLywiIiksYy5tNGE9KGEuY2FuUGxheVR5cGUoImF1ZGlvL3gtbTRhOyIpfHxhLmNhblBsYXlUeXBlKCJhdWRpby9hYWM7IikpLnJlcGxhY2UoL15ubyQvLCIiKX1jYXRjaChkKXt9cmV0dXJuIGN9LHIubG9jYWxzdG9yYWdlPWZ1bmN0aW9uKCl7dHJ5e3JldHVybiBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShoLGgpLGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGgpLCEwfWNhdGNoKGEpe3JldHVybiExfX0sci5zZXNzaW9uc3RvcmFnZT1mdW5jdGlvbigpe3RyeXtyZXR1cm4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShoLGgpLHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oaCksITB9Y2F0Y2goYSl7cmV0dXJuITF9fSxyLndlYndvcmtlcnM9ZnVuY3Rpb24oKXtyZXR1cm4hIWEuV29ya2VyfSxyLmFwcGxpY2F0aW9uY2FjaGU9ZnVuY3Rpb24oKXtyZXR1cm4hIWEuYXBwbGljYXRpb25DYWNoZX07Zm9yKHZhciBKIGluIHIpQShyLEopJiYodz1KLnRvTG93ZXJDYXNlKCksZVt3XT1yW0pdKCksdS5wdXNoKChlW3ddPyIiOiJuby0iKSt3KSk7cmV0dXJuIGUuaW5wdXR8fEkoKSxlLmFkZFRlc3Q9ZnVuY3Rpb24oYSxiKXtpZih0eXBlb2YgYT09Im9iamVjdCIpZm9yKHZhciBkIGluIGEpQShhLGQpJiZlLmFkZFRlc3QoZCxhW2RdKTtlbHNle2E9YS50b0xvd2VyQ2FzZSgpO2lmKGVbYV0hPT1jKXJldHVybiBlO2I9dHlwZW9mIGI9PSJmdW5jdGlvbiI/YigpOmIsdHlwZW9mIGYhPSJ1bmRlZmluZWQiJiZmJiYoZy5jbGFzc05hbWUrPSIgIisoYj8iIjoibm8tIikrYSksZVthXT1ifXJldHVybiBlfSxCKCIiKSxpPWs9bnVsbCxmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGwoYSxiKXt2YXIgYz1hLmNyZWF0ZUVsZW1lbnQoInAiKSxkPWEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXXx8YS5kb2N1bWVudEVsZW1lbnQ7cmV0dXJuIGMuaW5uZXJIVE1MPSJ4PHN0eWxlPiIrYisiPC9zdHlsZT4iLGQuaW5zZXJ0QmVmb3JlKGMubGFzdENoaWxkLGQuZmlyc3RDaGlsZCl9ZnVuY3Rpb24gbSgpe3ZhciBhPXMuZWxlbWVudHM7cmV0dXJuIHR5cGVvZiBhPT0ic3RyaW5nIj9hLnNwbGl0KCIgIik6YX1mdW5jdGlvbiBuKGEpe3ZhciBiPWpbYVtoXV07cmV0dXJuIGJ8fChiPXt9LGkrKyxhW2hdPWksaltpXT1iKSxifWZ1bmN0aW9uIG8oYSxjLGQpe2N8fChjPWIpO2lmKGspcmV0dXJuIGMuY3JlYXRlRWxlbWVudChhKTtkfHwoZD1uKGMpKTt2YXIgZztyZXR1cm4gZC5jYWNoZVthXT9nPWQuY2FjaGVbYV0uY2xvbmVOb2RlKCk6Zi50ZXN0KGEpP2c9KGQuY2FjaGVbYV09ZC5jcmVhdGVFbGVtKGEpKS5jbG9uZU5vZGUoKTpnPWQuY3JlYXRlRWxlbShhKSxnLmNhbkhhdmVDaGlsZHJlbiYmIWUudGVzdChhKSYmIWcudGFnVXJuP2QuZnJhZy5hcHBlbmRDaGlsZChnKTpnfWZ1bmN0aW9uIHAoYSxjKXthfHwoYT1iKTtpZihrKXJldHVybiBhLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtjPWN8fG4oYSk7dmFyIGQ9Yy5mcmFnLmNsb25lTm9kZSgpLGU9MCxmPW0oKSxnPWYubGVuZ3RoO2Zvcig7ZTxnO2UrKylkLmNyZWF0ZUVsZW1lbnQoZltlXSk7cmV0dXJuIGR9ZnVuY3Rpb24gcShhLGIpe2IuY2FjaGV8fChiLmNhY2hlPXt9LGIuY3JlYXRlRWxlbT1hLmNyZWF0ZUVsZW1lbnQsYi5jcmVhdGVGcmFnPWEuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCxiLmZyYWc9Yi5jcmVhdGVGcmFnKCkpLGEuY3JlYXRlRWxlbWVudD1mdW5jdGlvbihjKXtyZXR1cm4gcy5zaGl2TWV0aG9kcz9vKGMsYSxiKTpiLmNyZWF0ZUVsZW0oYyl9LGEuY3JlYXRlRG9jdW1lbnRGcmFnbWVudD1GdW5jdGlvbigiaCxmIiwicmV0dXJuIGZ1bmN0aW9uKCl7dmFyIG49Zi5jbG9uZU5vZGUoKSxjPW4uY3JlYXRlRWxlbWVudDtoLnNoaXZNZXRob2RzJiYoIittKCkuam9pbigpLnJlcGxhY2UoL1tcd1wtXSsvZyxmdW5jdGlvbihhKXtyZXR1cm4gYi5jcmVhdGVFbGVtKGEpLGIuZnJhZy5jcmVhdGVFbGVtZW50KGEpLCdjKCInK2ErJyIpJ30pKyIpO3JldHVybiBufSIpKHMsYi5mcmFnKX1mdW5jdGlvbiByKGEpe2F8fChhPWIpO3ZhciBjPW4oYSk7cmV0dXJuIHMuc2hpdkNTUyYmIWcmJiFjLmhhc0NTUyYmKGMuaGFzQ1NTPSEhbChhLCJhcnRpY2xlLGFzaWRlLGRpYWxvZyxmaWdjYXB0aW9uLGZpZ3VyZSxmb290ZXIsaGVhZGVyLGhncm91cCxtYWluLG5hdixzZWN0aW9ue2Rpc3BsYXk6YmxvY2t9bWFya3tiYWNrZ3JvdW5kOiNGRjA7Y29sb3I6IzAwMH10ZW1wbGF0ZXtkaXNwbGF5Om5vbmV9IikpLGt8fHEoYSxjKSxhfXZhciBjPSIzLjcuMCIsZD1hLmh0bWw1fHx7fSxlPS9ePHxeKD86YnV0dG9ufG1hcHxzZWxlY3R8dGV4dGFyZWF8b2JqZWN0fGlmcmFtZXxvcHRpb258b3B0Z3JvdXApJC9pLGY9L14oPzphfGJ8Y29kZXxkaXZ8ZmllbGRzZXR8aDF8aDJ8aDN8aDR8aDV8aDZ8aXxsYWJlbHxsaXxvbHxwfHF8c3BhbnxzdHJvbmd8c3R5bGV8dGFibGV8dGJvZHl8dGR8dGh8dHJ8dWwpJC9pLGcsaD0iX2h0bWw1c2hpdiIsaT0wLGo9e30sazsoZnVuY3Rpb24oKXt0cnl7dmFyIGE9Yi5jcmVhdGVFbGVtZW50KCJhIik7YS5pbm5lckhUTUw9Ijx4eXo+PC94eXo+IixnPSJoaWRkZW4iaW4gYSxrPWEuY2hpbGROb2Rlcy5sZW5ndGg9PTF8fGZ1bmN0aW9uKCl7Yi5jcmVhdGVFbGVtZW50KCJhIik7dmFyIGE9Yi5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7cmV0dXJuIHR5cGVvZiBhLmNsb25lTm9kZT09InVuZGVmaW5lZCJ8fHR5cGVvZiBhLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQ9PSJ1bmRlZmluZWQifHx0eXBlb2YgYS5jcmVhdGVFbGVtZW50PT0idW5kZWZpbmVkIn0oKX1jYXRjaChjKXtnPSEwLGs9ITB9fSkoKTt2YXIgcz17ZWxlbWVudHM6ZC5lbGVtZW50c3x8ImFiYnIgYXJ0aWNsZSBhc2lkZSBhdWRpbyBiZGkgY2FudmFzIGRhdGEgZGF0YWxpc3QgZGV0YWlscyBkaWFsb2cgZmlnY2FwdGlvbiBmaWd1cmUgZm9vdGVyIGhlYWRlciBoZ3JvdXAgbWFpbiBtYXJrIG1ldGVyIG5hdiBvdXRwdXQgcHJvZ3Jlc3Mgc2VjdGlvbiBzdW1tYXJ5IHRlbXBsYXRlIHRpbWUgdmlkZW8iLHZlcnNpb246YyxzaGl2Q1NTOmQuc2hpdkNTUyE9PSExLHN1cHBvcnRzVW5rbm93bkVsZW1lbnRzOmssc2hpdk1ldGhvZHM6ZC5zaGl2TWV0aG9kcyE9PSExLHR5cGU6ImRlZmF1bHQiLHNoaXZEb2N1bWVudDpyLGNyZWF0ZUVsZW1lbnQ6byxjcmVhdGVEb2N1bWVudEZyYWdtZW50OnB9O2EuaHRtbDU9cyxyKGIpfSh0aGlzLGIpLGUuX3ZlcnNpb249ZCxlLl9wcmVmaXhlcz1uLGUuX2RvbVByZWZpeGVzPXEsZS5fY3Nzb21QcmVmaXhlcz1wLGUuaGFzRXZlbnQ9eSxlLnRlc3RQcm9wPWZ1bmN0aW9uKGEpe3JldHVybiBGKFthXSl9LGUudGVzdEFsbFByb3BzPUgsZS50ZXN0U3R5bGVzPXgsZy5jbGFzc05hbWU9Zy5jbGFzc05hbWUucmVwbGFjZSgvKF58XHMpbm8tanMoXHN8JCkvLCIkMSQyIikrKGY/IiBqcyAiK3Uuam9pbigiICIpOiIiKSxlfSh0aGlzLHRoaXMuZG9jdW1lbnQpLGZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBkKGEpe3JldHVybiJbb2JqZWN0IEZ1bmN0aW9uXSI9PW8uY2FsbChhKX1mdW5jdGlvbiBlKGEpe3JldHVybiJzdHJpbmciPT10eXBlb2YgYX1mdW5jdGlvbiBmKCl7fWZ1bmN0aW9uIGcoYSl7cmV0dXJuIWF8fCJsb2FkZWQiPT1hfHwiY29tcGxldGUiPT1hfHwidW5pbml0aWFsaXplZCI9PWF9ZnVuY3Rpb24gaCgpe3ZhciBhPXAuc2hpZnQoKTtxPTEsYT9hLnQ/bShmdW5jdGlvbigpeygiYyI9PWEudD9CLmluamVjdENzczpCLmluamVjdEpzKShhLnMsMCxhLmEsYS54LGEuZSwxKX0sMCk6KGEoKSxoKCkpOnE9MH1mdW5jdGlvbiBpKGEsYyxkLGUsZixpLGope2Z1bmN0aW9uIGsoYil7aWYoIW8mJmcobC5yZWFkeVN0YXRlKSYmKHUucj1vPTEsIXEmJmgoKSxsLm9ubG9hZD1sLm9ucmVhZHlzdGF0ZWNoYW5nZT1udWxsLGIpKXsiaW1nIiE9YSYmbShmdW5jdGlvbigpe3QucmVtb3ZlQ2hpbGQobCl9LDUwKTtmb3IodmFyIGQgaW4geVtjXSl5W2NdLmhhc093blByb3BlcnR5KGQpJiZ5W2NdW2RdLm9ubG9hZCgpfX12YXIgaj1qfHxCLmVycm9yVGltZW91dCxsPWIuY3JlYXRlRWxlbWVudChhKSxvPTAscj0wLHU9e3Q6ZCxzOmMsZTpmLGE6aSx4Omp9OzE9PT15W2NdJiYocj0xLHlbY109W10pLCJvYmplY3QiPT1hP2wuZGF0YT1jOihsLnNyYz1jLGwudHlwZT1hKSxsLndpZHRoPWwuaGVpZ2h0PSIwIixsLm9uZXJyb3I9bC5vbmxvYWQ9bC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXtrLmNhbGwodGhpcyxyKX0scC5zcGxpY2UoZSwwLHUpLCJpbWciIT1hJiYocnx8Mj09PXlbY10/KHQuaW5zZXJ0QmVmb3JlKGwscz9udWxsOm4pLG0oayxqKSk6eVtjXS5wdXNoKGwpKX1mdW5jdGlvbiBqKGEsYixjLGQsZil7cmV0dXJuIHE9MCxiPWJ8fCJqIixlKGEpP2koImMiPT1iP3Y6dSxhLGIsdGhpcy5pKyssYyxkLGYpOihwLnNwbGljZSh0aGlzLmkrKywwLGEpLDE9PXAubGVuZ3RoJiZoKCkpLHRoaXN9ZnVuY3Rpb24gaygpe3ZhciBhPUI7cmV0dXJuIGEubG9hZGVyPXtsb2FkOmosaTowfSxhfXZhciBsPWIuZG9jdW1lbnRFbGVtZW50LG09YS5zZXRUaW1lb3V0LG49Yi5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IilbMF0sbz17fS50b1N0cmluZyxwPVtdLHE9MCxyPSJNb3pBcHBlYXJhbmNlImluIGwuc3R5bGUscz1yJiYhIWIuY3JlYXRlUmFuZ2UoKS5jb21wYXJlTm9kZSx0PXM/bDpuLnBhcmVudE5vZGUsbD1hLm9wZXJhJiYiW29iamVjdCBPcGVyYV0iPT1vLmNhbGwoYS5vcGVyYSksbD0hIWIuYXR0YWNoRXZlbnQmJiFsLHU9cj8ib2JqZWN0IjpsPyJzY3JpcHQiOiJpbWciLHY9bD8ic2NyaXB0Ijp1LHc9QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oYSl7cmV0dXJuIltvYmplY3QgQXJyYXldIj09by5jYWxsKGEpfSx4PVtdLHk9e30sej17dGltZW91dDpmdW5jdGlvbihhLGIpe3JldHVybiBiLmxlbmd0aCYmKGEudGltZW91dD1iWzBdKSxhfX0sQSxCO0I9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihhKXt2YXIgYT1hLnNwbGl0KCIhIiksYj14Lmxlbmd0aCxjPWEucG9wKCksZD1hLmxlbmd0aCxjPXt1cmw6YyxvcmlnVXJsOmMscHJlZml4ZXM6YX0sZSxmLGc7Zm9yKGY9MDtmPGQ7ZisrKWc9YVtmXS5zcGxpdCgiPSIpLChlPXpbZy5zaGlmdCgpXSkmJihjPWUoYyxnKSk7Zm9yKGY9MDtmPGI7ZisrKWM9eFtmXShjKTtyZXR1cm4gY31mdW5jdGlvbiBnKGEsZSxmLGcsaCl7dmFyIGk9YihhKSxqPWkuYXV0b0NhbGxiYWNrO2kudXJsLnNwbGl0KCIuIikucG9wKCkuc3BsaXQoIj8iKS5zaGlmdCgpLGkuYnlwYXNzfHwoZSYmKGU9ZChlKT9lOmVbYV18fGVbZ118fGVbYS5zcGxpdCgiLyIpLnBvcCgpLnNwbGl0KCI/IilbMF1dKSxpLmluc3RlYWQ/aS5pbnN0ZWFkKGEsZSxmLGcsaCk6KHlbaS51cmxdP2kubm9leGVjPSEwOnlbaS51cmxdPTEsZi5sb2FkKGkudXJsLGkuZm9yY2VDU1N8fCFpLmZvcmNlSlMmJiJjc3MiPT1pLnVybC5zcGxpdCgiLiIpLnBvcCgpLnNwbGl0KCI/Iikuc2hpZnQoKT8iYyI6YyxpLm5vZXhlYyxpLmF0dHJzLGkudGltZW91dCksKGQoZSl8fGQoaikpJiZmLmxvYWQoZnVuY3Rpb24oKXtrKCksZSYmZShpLm9yaWdVcmwsaCxnKSxqJiZqKGkub3JpZ1VybCxoLGcpLHlbaS51cmxdPTJ9KSkpfWZ1bmN0aW9uIGgoYSxiKXtmdW5jdGlvbiBjKGEsYyl7aWYoYSl7aWYoZShhKSljfHwoaj1mdW5jdGlvbigpe3ZhciBhPVtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtrLmFwcGx5KHRoaXMsYSksbCgpfSksZyhhLGosYiwwLGgpO2Vsc2UgaWYoT2JqZWN0KGEpPT09YSlmb3IobiBpbiBtPWZ1bmN0aW9uKCl7dmFyIGI9MCxjO2ZvcihjIGluIGEpYS5oYXNPd25Qcm9wZXJ0eShjKSYmYisrO3JldHVybiBifSgpLGEpYS5oYXNPd25Qcm9wZXJ0eShuKSYmKCFjJiYhLS1tJiYoZChqKT9qPWZ1bmN0aW9uKCl7dmFyIGE9W10uc2xpY2UuY2FsbChhcmd1bWVudHMpO2suYXBwbHkodGhpcyxhKSxsKCl9Ompbbl09ZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGI9W10uc2xpY2UuY2FsbChhcmd1bWVudHMpO2EmJmEuYXBwbHkodGhpcyxiKSxsKCl9fShrW25dKSksZyhhW25dLGosYixuLGgpKX1lbHNlIWMmJmwoKX12YXIgaD0hIWEudGVzdCxpPWEubG9hZHx8YS5ib3RoLGo9YS5jYWxsYmFja3x8ZixrPWosbD1hLmNvbXBsZXRlfHxmLG0sbjtjKGg/YS55ZXA6YS5ub3BlLCEhaSksaSYmYyhpKX12YXIgaSxqLGw9dGhpcy55ZXBub3BlLmxvYWRlcjtpZihlKGEpKWcoYSwwLGwsMCk7ZWxzZSBpZih3KGEpKWZvcihpPTA7aTxhLmxlbmd0aDtpKyspaj1hW2ldLGUoaik/ZyhqLDAsbCwwKTp3KGopP0Ioaik6T2JqZWN0KGopPT09aiYmaChqLGwpO2Vsc2UgT2JqZWN0KGEpPT09YSYmaChhLGwpfSxCLmFkZFByZWZpeD1mdW5jdGlvbihhLGIpe3pbYV09Yn0sQi5hZGRGaWx0ZXI9ZnVuY3Rpb24oYSl7eC5wdXNoKGEpfSxCLmVycm9yVGltZW91dD0xZTQsbnVsbD09Yi5yZWFkeVN0YXRlJiZiLmFkZEV2ZW50TGlzdGVuZXImJihiLnJlYWR5U3RhdGU9ImxvYWRpbmciLGIuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsQT1mdW5jdGlvbigpe2IucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsQSwwKSxiLnJlYWR5U3RhdGU9ImNvbXBsZXRlIn0sMCkpLGEueWVwbm9wZT1rKCksYS55ZXBub3BlLmV4ZWN1dGVTdGFjaz1oLGEueWVwbm9wZS5pbmplY3RKcz1mdW5jdGlvbihhLGMsZCxlLGksail7dmFyIGs9Yi5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKSxsLG8sZT1lfHxCLmVycm9yVGltZW91dDtrLnNyYz1hO2ZvcihvIGluIGQpay5zZXRBdHRyaWJ1dGUobyxkW29dKTtjPWo/aDpjfHxmLGsub25yZWFkeXN0YXRlY2hhbmdlPWsub25sb2FkPWZ1bmN0aW9uKCl7IWwmJmcoay5yZWFkeVN0YXRlKSYmKGw9MSxjKCksay5vbmxvYWQ9ay5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCl9LG0oZnVuY3Rpb24oKXtsfHwobD0xLGMoMSkpfSxlKSxpP2sub25sb2FkKCk6bi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShrLG4pfSxhLnllcG5vcGUuaW5qZWN0Q3NzPWZ1bmN0aW9uKGEsYyxkLGUsZyxpKXt2YXIgZT1iLmNyZWF0ZUVsZW1lbnQoImxpbmsiKSxqLGM9aT9oOmN8fGY7ZS5ocmVmPWEsZS5yZWw9InN0eWxlc2hlZXQiLGUudHlwZT0idGV4dC9jc3MiO2ZvcihqIGluIGQpZS5zZXRBdHRyaWJ1dGUoaixkW2pdKTtnfHwobi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLG4pLG0oYywwKSl9fSh0aGlzLGRvY3VtZW50KSxNb2Rlcm5penIubG9hZD1mdW5jdGlvbigpe3llcG5vcGUuYXBwbHkod2luZG93LFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApKX07Cn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5eyhmdW5jdGlvbigpe3ZhciBnPWZ1bmN0aW9uKGUsaCxmLGcpew0KdGhpcy5nZXQ9ZnVuY3Rpb24oYSl7Zm9yKHZhciBhPWErIj0iLGM9ZG9jdW1lbnQuY29va2llLnNwbGl0KCI7IiksYj0wLGU9Yy5sZW5ndGg7YjxlO2IrKyl7Zm9yKHZhciBkPWNbYl07IiAiPT1kLmNoYXJBdCgwKTspZD1kLnN1YnN0cmluZygxLGQubGVuZ3RoKTtpZigwPT1kLmluZGV4T2YoYSkpcmV0dXJuIGQuc3Vic3RyaW5nKGEubGVuZ3RoLGQubGVuZ3RoKX1yZXR1cm4gbnVsbH07DQp0aGlzLnNldD1mdW5jdGlvbihhLGMpe3ZhciBiPSIiLGI9bmV3IERhdGU7Yi5zZXRUaW1lKGIuZ2V0VGltZSgpKzYwNDhFNSk7Yj0iOyBleHBpcmVzPSIrYi50b0dNVFN0cmluZygpO2RvY3VtZW50LmNvb2tpZT1hKyI9IitjK2IrIjsgcGF0aD0vOyAifTsNCnRoaXMuY2hlY2s9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmdldChmKTtpZihhKWE9YS5zcGxpdCgiOiIpO2Vsc2UgaWYoMTAwIT1lKSJ2Ij09aCYmKGU9TWF0aC5yYW5kb20oKT49ZS8xMDA/MDoxMDApLGE9W2gsZSwwXSx0aGlzLnNldChmLGEuam9pbigiOiIpKTtlbHNlIHJldHVybiEwO3ZhciBjPWFbMV07aWYoMTAwPT1jKXJldHVybiEwO3N3aXRjaChhWzBdKXtjYXNlICJ2IjpyZXR1cm4hMTtjYXNlICJyIjpyZXR1cm4gYz1hWzJdJU1hdGguZmxvb3IoMTAwL2MpLGFbMl0rKyx0aGlzLnNldChmLGEuam9pbigiOiIpKSwhY31yZXR1cm4hMH07DQp0aGlzLmdvPWZ1bmN0aW9uKCl7aWYodGhpcy5jaGVjaygpKXt2YXIgYT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTthLnR5cGU9InRleHQvamF2YXNjcmlwdCI7YS5zcmM9ZysgIiZ0PSIgKyAobmV3IERhdGUoKSkuZ2V0VGltZSgpO2RvY3VtZW50LmJvZHkmJmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSl9fTsNCnRoaXMuc3RhcnQ9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3dpbmRvdy5hZGRFdmVudExpc3RlbmVyP3dpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIixmdW5jdGlvbigpe2EuZ28oKX0sITEpOndpbmRvdy5hdHRhY2hFdmVudCYmd2luZG93LmF0dGFjaEV2ZW50KCJvbmxvYWQiLGZ1bmN0aW9uKCl7YS5nbygpfSl9fTsNCnRyeXsobmV3IGcoMTAwLCJyIiwiUVNJX1NfWk5fMFBYUk1oT0JibG5jQUFkIiwiLy96bl8wcHhybWhvYmJsbmNhYWQtaHBzdXBwb3J0LnNpdGVpbnRlcmNlcHQucXVhbHRyaWNzLmNvbS9XUlNpdGVJbnRlcmNlcHRFbmdpbmUvP1FfWklEPVpOXzBQWFJNaE9CYmxuY0FBZCZRX0xPQz0iK2VuY29kZVVSSUNvbXBvbmVudCh3aW5kb3cubG9jYXRpb24uaHJlZikpKS5zdGFydCgpfWNhdGNoKGkpe319KSgpOw0KDQoKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7DQovKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tZ2V0IGNsaWVudCBPUyBzdGFydCAtLS0tLS0tLS0tLS0tLSovDQoJdmFyIGhwcHBzQ2xpZW50T1M7DQoNCglnZXRDbGllbnRPUyA9IGZ1bmN0aW9uKCl7DQoJdmFyIGlzX2lPUzEgPSBuYXZpZ2F0b3IucGxhdGZvcm0ubWF0Y2goLyhpUGhvbmV8aVBvZHxpUGFkKS9pKT90cnVlOmZhbHNlOw0KCXZhciBpc19hbmRyb2lkMSA9IG5hdmlnYXRvci5wbGF0Zm9ybS5tYXRjaCgvYW5kcm9pZC9pKT90cnVlOmZhbHNlOw0KCXZhciBpc19NYWMxID0gbmF2aWdhdG9yLnBsYXRmb3JtLnRvVXBwZXJDYXNlKCkuaW5kZXhPZignTUFDJyk+PTA7DQoNCglpZihpc19pT1MxIHx8IGlzX01hYzEpe2hwcHBzQ2xpZW50T1MgPSAiQXBwbGUiO30NCgllbHNlIGlmKGlzX2FuZHJvaWQxKXtocHBwc0NsaWVudE9TPSdBbmRyb2lkJzt9DQoJZWxzZXtocHBwc0NsaWVudE9TPSdXaW5kb3dzJzt9DQoJLy9hbGVydChocHBwc0NsaWVudE9TKTsNCglpZigkKCcjaHBwcHNjbGllbnRPU0lkQ2FsbCcpKSB7DQoJCSQoJyNocHBwc2NsaWVudE9TSWRDYWxsJykudmFsKGhwcHBzQ2xpZW50T1MpOw0KCQl9DQoJCWlmKCQoJyNocHBwc2NsaWVudE9TSWRDaGF0JykpIHsNCgkJCSQoJyNocHBwc2NsaWVudE9TSWRDaGF0JykudmFsKGhwcHBzQ2xpZW50T1MpOw0KCQkJfQ0KCQlpZigkKCcjaHBwcHNjbGllbnRPU0lkRW1haWwnKSkgew0KCQkJJCgnI2hwcHBzY2xpZW50T1NJZEVtYWlsJykudmFsKGhwcHBzQ2xpZW50T1MpOw0KCQkJfQ0KCX0NCglnZXRDbGllbnRPUygpOw0KCS8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1nZXQgY2xpZW50IE9TIGVuZCAtLS0tLS0tLS0tLS0tLSovDQoNCiQoIGRvY3VtZW50ICkucmVhZHkoZnVuY3Rpb24oKSB7DQoNCgkvKiBDb21tZW50aW5nIHRoaXMgcG9ydGlvbiB0byBtYWtlIFNXRCBhdmFpbGFibGUgaW4gbW9iaWxlIC0gNjM0Nw0KCS8vSGlkZSBzb2Z0d2FyZSAmIERyaXZlcnMgU2VjdGlvbg0KCXZhciB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQ7DQogICAgdmFyIGlzV2luZG93cyA9IHVhLmluZGV4T2YoIldpbmRvd3MgTlQiKT4tMTsNCg0KICAgIGlmKCFpc1dpbmRvd3MpIHsNCiAgICAJdmFyIGlzTWFjT1MgPSB1YS5pbmRleE9mKCJNYWMiKT4tMTsNCiAgICAJdmFyIGlzaVBhZCA9IHVhLmluZGV4T2YoImlQYWQiKT4tMTsNCiAgICAJdmFyIGlzaVBob25lID0gdWEuaW5kZXhPZigiaVBob25lIik+LTE7DQogICAgCWlmKGlzTWFjT1Mpew0KCSAgICAJaWYoaXNpUGFkIHx8IGlzaVBob25lKXsNCgkgICAgCQlqUXVlcnkoIiNzbmRTZWN0aW9uIikuaGlkZSgpOw0KCSAgICAJCWpRdWVyeSgiI25hdlNvZnR3YXJlc0FuZERyaXZlcnMiKS5wYXJlbnQoImxpIikuaGlkZSgpOw0KCSAgICAJfQ0KICAgIAl9DQogICAgCWVsc2V7DQogICAgCQlqUXVlcnkoIiNzbmRTZWN0aW9uIikuaGlkZSgpOw0KICAgIAkJalF1ZXJ5KCIjbmF2U29mdHdhcmVzQW5kRHJpdmVycyIpLnBhcmVudCgibGkiKS5oaWRlKCk7DQogICAgCX0NCgl9Ki8NCg0KICAgIC8vT1IgdGV4dCBmcm9tIGR5bmFjYWNoZSBmb3Igc3VwcG9ydCBob21lIGFuZCBTV0QgcGFnZSBsYXlvdXQNCiAgICB2YXIgb3JDYWNoZXZhbHVlID0gJCgnI29yQ2FjaGVsYmwnKS5odG1sKCk7DQogICAgJCgnI3NuZFNlY3Rpb24nKS5maW5kKCcuY29ubmVjdG9yJykuaHRtbChvckNhY2hldmFsdWUpOw0KDQoJLy9DaGFuZ2luZyB0aGUgVVJMIGZvciBSVEwgaW1hZ2Ugb2YgY29uc3VtZXIgY29tbXVuaXRpZXMuDQoNCglpZigkKCJodG1sIikuYXR0cigiZGlyIikgPT0gInJ0bCIgJiYgKCQoIi5kdkNvbW11bml0aWVzV3JhcHBlciIpLmxlbmd0aCA+IDApICl7DQoJCSQoIiNkdk9ubGluZUNvbW11bml0aWVzQ29uc3VtZXJTdXBwb3J0SWNvbiIpLmF0dHIoInNyYyIsIi9zdGF0aWMvaHAtcG9ydGFsLXRoZW1lLXN0YXRpYy90aGVtZXMvUG9ydGFsOC4wL2hwL2ltYWdlcy9pY29uLWNvbnN1bWVyLWZvcnVtUlRMLnBuZyIpOw0KCX0NCg0KCSQoIi5oZWxwT3V0ZXJXcmFwcGVyIikuYXBwZW5kVG8oImJvZHkiKTsgLy8gdG8gbW92ZSBhbGwgdGhlIHRvb2x0aXAgY29udGVudHMgb24gcGFnZSB0byBib2R5DQoNCgl2YXIgbmF2QWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7DQoNCglpZihuYXZBZ2VudC5zZWFyY2goJ21zaWUnKSAhPSAtMSB8fCAhIW5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL1RyaWRlbnQuKnJ2XDoxMVwuLykpew0KCQkkKCdib2R5JykuYWRkQ2xhc3MoJ2llJyk7DQoJfQ0KCWlmKG5hdkFnZW50LnNlYXJjaCgnbXNpZSA4LjAnKSAhPSAtMSl7DQoJCSQoJ2JvZHknKS5hZGRDbGFzcygnaWU4Jyk7DQoJfQ0KCWVsc2UgaWYobmF2QWdlbnQuc2VhcmNoKCdtc2llIDkuMCcpICE9IC0xKXsNCgkJJCgnYm9keScpLmFkZENsYXNzKCdpZTknKTsNCgl9DQoJZWxzZSBpZihuYXZBZ2VudC5zZWFyY2goJ21zaWUgMTAuMCcpICE9IC0xKXsNCgkJJCgnYm9keScpLmFkZENsYXNzKCdpZTEwJyk7DQoJfQ0KCWVsc2UgaWYoISFuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9UcmlkZW50Lipydlw6MTFcLi8pKXsNCgkJJCgnYm9keScpLmFkZENsYXNzKCdpZTExJyk7DQoJfQ0KCWVsc2UgaWYobmF2QWdlbnQuc2VhcmNoKCdlZGdlLycpICE9IC0xKXsNCgkJJCgnYm9keScpLmFkZENsYXNzKCdpZS1lZGdlJyk7DQoJfQ0KCWVsc2UgaWYobmF2QWdlbnQuc2VhcmNoKCdNYWMgT1MnKSAhPSAtMSAmJiBuYXZBZ2VudC5zZWFyY2goJ01hY2ludG9zaCcpICE9IC0xKXsNCgkJJCgnYm9keScpLmFkZENsYXNzKCdtYWMnKTsNCgl9DQoNCgkkKCdib2R5JykuYWRkQ2xhc3MoJCgnI3BhZ2VJZGVudGlmaWVyJykudmFsKCkudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC8gLywgJy0nKSk7DQoNCmlmKGdldENDTEMoImNjIikhPSJpZSIpeyAvKkFkZGluZyB0aGlzIGFzIHdlIGRvbid0IGtub3cgd2h5IGNjIGlzIGJlaW5nIGFkZGVkIHRvIHRoZSBib2R5LiBJZiB5b3Uga25vdywgcGxlYXNlIHJlbW92ZSB0aGlzIGJpdCBhbmQgdXNlIHRoZSBjYyBmcm9tIHVybCBkaXJlY3RseSovDQoJJCgnYm9keScpLmFkZENsYXNzKGdldENDTEMoImNjIikpOw0KfQ0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqIFJlbW92aW5nIHRhYiBpbmRleCBmb3IgaGVhZGVyLCBmb290ZXIgYW5kIG1vdmluZyBQU0YgdG8gYm90dG9tLiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoJc2V0VGltZW91dChmdW5jdGlvbigpew0KCQkkKCcjZm9vdGVyIFt0YWJpbmRleF0nKS5yZW1vdmVBdHRyKCd0YWJpbmRleCcpOw0KCQkkKCcjZm9vdGVyIFt0YWJpbmRleF0nKS5yZW1vdmVBdHRyKCd0YWJpbmRleCcpOw0KCQkvLyQoJyNwc2YnKS5pbnNlcnRBZnRlcignI2xhZHlidWcnKTsNCgl9LCAzMDAwKTsNCgkvKioqKioqKioqKioqKioqKioqKioqKiBFbmQgb2YgUmVtb3ZpbmcgdGFiIGluZGV4IGZvciBoZWFkZXIsIGZvb3RlciBhbmQgbW92aW5nIFBTRiB0byBib3R0b20uICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KCWdob3N0VGV4dEltcGwoKTsNCglnZXRIcFN0eWxlRHJvcGRvd24oKTsNCg0KCXZhciBjYyA9IGdldENDTEMoImNjIik7DQoJdmFyIHNlcmlhbE5vID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCJzZXJpYWxudW1iZXIiKTsNCg0KCWlmKCFzZXJpYWxObyA9PSAnJyl7DQoNCgkkKCdbdmFsUmVxPSJzZXJpYWxudW1iZXIiXScpLnZhbChzZXJpYWxObyk7DQoJJCgnW3ZhbFJlcT0ic2VyaWFsbnVtYmVyIl0nKS5yZW1vdmVDbGFzcygncGxhY2Vob2xkZXJUZXh0Jyk7DQoNCgkvLyBzYW1wbGUgdXJsIHBhcmFtOiA/cHJvZHVjdD0zOTY0MDY1JmxjPWVuJmNjPXVzJmRsYz1lbiZ0YXNrPQ0KCX0NCg0KCS8vdXNlZCBpbiBwcm9kdWN0LWNvbnRhY3Qtb3B0aW9ucyB0byBnZXQgY2xpZW50IERhdGUvVGltZSBPZmZzZXQNCglkYXRlT2JqID0gbmV3IERhdGUoKTsNCgkkKCcjZW50aXRsZW1lbnRHYXRld2F5Q2xpZW50RHRUaW1lJykudmFsKGRhdGVPYmouZ2V0Q2xpZW50RGF0ZVRpbWUoKSk7DQoJJCgnI2VudGl0bGVtZW50R2F0ZXdheUdNVE9mZnNldCcpLnZhbChnZXRHTVRPZmZzZXQoKSk7DQoNCiAgLyotLS1jbG9zZSBkaXNwdXRlIGJhci0tLS0tKi8NCiAgJCgnLmRpc3B1dGVCYXIgLmNyb3NzJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXsNCgkgICQodGhpcykucGFyZW50cygnLmRpc3B1dGVCYXInKS5oaWRlKCk7DQogIH0pOw0KICAvKi0tLWNsb3NlIGRpc3B1dGUgYmFyLS0tLS0qLw0KICAJLy9yZW1vdmVQRmluZGVyRXJyb3IoKTsNCiAgCS8qIGNhbGwgdGhlIGNhbm9uaWNhbCBmdW5jdGlvbiovDQogIAlzZXRDYW5vbmljYWxVcmwoKTsNCiAgCQ0KICAJLyogY2FsbCB0aGUgc2V0QWx0ZXJuYXRlVXJsKCkgZnVuY3Rpb24qLw0KICAJc2V0QWx0ZXJuYXRlVXJsKCk7DQoNCgkvL1JlbW92ZSBiYWNrZHJvcCBvbiBjbG9zZSBvZiBtb2RhbA0KCSQoJy5tb2RhbCcpLm9uKCdoaWRkZW4uYnMubW9kYWwgW2RhdGEtZGlzbWlzcz0ibW9kYWwiXScsIGZ1bmN0aW9uIChldmVudCkgew0KCQkkKCcubW9kYWwtYmFja2Ryb3AnKS5yZW1vdmUoKTsNCgl9KTsNCg0KDQoJLy9BZGRpbmcgc3RhdGljIGZpbGVkIHRvIG1vZGFsIGZvciBiYWNrZHJvcA0KCSQoJ1tkYXRhLXRvZ2dsZT0ibW9kYWwiXScpLmF0dHIoJ2RhdGEtYmFja2Ryb3AnLCdzdGF0aWMnKTsNCg0KDQoJLy8gSnF1ZXJ5IG1vZHVsZSBmb3IgdG9vbHRpcCBkaXNwbGF5DQoJLy8gSG93IGRvZXMgaXQgd29yayA/IC0gVGhpcyBtb2R1bGUgd2lsbCBhZGQgaHRtbCB0byBhbiBleGlzdGluZyBtb2RhbCBwYXJlbnQuIFRoZSBtb2RhbCBjb250ZW50IHNob3VsZA0KCS8vIEJlIGdlbmVyYXRlZCBieSB0aGUgdXNlciBhbmQgdGhlbiBzZW50IGludG8gdGhpcyBmdW5jdGlvbiBmb3IgY29tcGlsYXRpb24gLiBPbmNlIGNvbXBpbGVkLCB0aGUgY29udGVudHMNCgkvLyB3aWxsIGJlIGFkZCB0byB0aGUgdGVtcGxhdGUgc2VsZWN0b3Igd2hpY2ggaXMgc2VudCBhcyBhIHBhcmFtLg0KCS8vIERlcGVuZGVuY3kgLSBIYW5kbGVCYXJzLmpzDQoJLy8gQHBhcmFtcyAtIG9wdGlvbnMgLSBPYmplY3Qgd2hpY2ggaGFzIHRoZSBmb2xsb3dpbmcNCgkvLyAgICAgICAgICAgZGF0YSAtIFRvb2x0aXAgZGF0YQ0KCS8vIAkJCSB0ZW1wbGF0ZVNlbGVjdG9yIC0gdG9vbHRpcCBoYW5kbGViYXJzIHRlbXBsYXRlIHNlbGVjdG9yIDogZWc6ICN0b29sdGlwLXRlbXBsYXRlDQoNCgkkLmZuLmV4dGVuZCh7DQoJICAgIHJlbmRlclRvb2x0aXA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCg0KCSAgICAgIHZhciBzb3VyY2UgPSAkKG9wdGlvbnMudGVtcGxhdGVTZWxlY3RvcikuaHRtbCgpOw0KCQkgIHZhciB0ZW1wbGF0ZSA9IEhhbmRsZWJhcnMuY29tcGlsZShzb3VyY2UpOw0KDQoJICAgICAgJCh0aGlzKS5odG1sKHRlbXBsYXRlKG9wdGlvbnMuZGF0YSkpOw0KDQoJICAgICAgcmV0dXJuIHRoaXM7DQoNCgkgICAgfQ0KCX0pOw0KDQoNCgl2YXIgbW9kYWxXcmFwcGVyQXJyYXkgPSBbJyNwcm9kdWN0LXNlcmlhbC1udW1iZXItbW9kYWwnLCcjc2VyaWFsLW51bWJlci1tb2RhbCcsIiN0b29sdGlwLW1vZGFsIl07DQoNCglmb3IodmFyIGk9MCA7IGkgPCBtb2RhbFdyYXBwZXJBcnJheS5sZW5ndGg7ICsraSl7DQoJCWlmKCQobW9kYWxXcmFwcGVyQXJyYXlbaV0pLmxlbmd0aCA+PSAxKXsNCgkJCWdldFRvb2xUaXBEYXRhKFttb2RhbFdyYXBwZXJBcnJheVtpXV0sICIjdG9vbHRpcC10ZW1wbGF0ZSIsICIvaHAtcHBzLXNlcnZpY2VzL2NvbnRlbnQvdG9vbHRpcGRvYyIpOw0KCQl9DQoJfQ0KCQ0KfSk7IC8vRW5kIG9mIGRvY3VtZW50IHJlYWR5DQovKi0tLS0tLS0tLS0tLS0tLS0tLS1lbnRpdGxlbWVudENDLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KZnVuY3Rpb24gZ2V0U2VsZWN0ZWRWYWx1ZShpZCkgew0KICAgIHJldHVybiAkKCIjIiArIGlkKS5maW5kKCJhIHNwYW4udmFsdWUiKS5odG1sKCk7DQp9DQovKi0tLS0tLS0tLS0tLS0tLS0tLS1lbmQgb2YgZW50aXRsZW1lbnRDQy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCWZ1bmN0aW9uIGdob3N0VGV4dEltcGwoKXsNCgkJaGFuZGxlR2hvc3RTY3JpcHQoalF1ZXJ5KCJpbnB1dFt0eXBlPSd0ZXh0J10ucGxhY2Vob2xkZXJUZXh0IikpOw0KCQloYW5kbGVHaG9zdFNjcmlwdChqUXVlcnkoJ3RleHRhcmVhLnBsYWNlaG9sZGVyVGV4dCcpKTsNCiAgICB9DQoNCglmdW5jdGlvbiBoYW5kbGVHaG9zdFNjcmlwdChlbCl7DQoJCWVsLmVhY2goZnVuY3Rpb24oKXsNCgkJCXZhciBwbGFjZWhvbGRlclRleHQgPSBqUXVlcnkodGhpcykuYXR0cigiZ2hvc3RUZXh0Iik7DQoJCQlpZihqUXVlcnkodGhpcykudmFsKCk9PScnKQ0KCQkJeyAgICAgICAgICAgICAgICAgICAgICAgICAgLypkZXNrdG9wU2VhcmNoIGNsYXNzIHdhcyBhZGRlZCB0byB1bmlxdWVseSBpZGVudGlmeSB0aGUgc2VhcmNoIHRleHRib3ggZm9yIENSIDExOTUgZml4Ki8NCgkJCQlpZighalF1ZXJ5KHRoaXMpLmhhc0NsYXNzKCJkZXNrdG9wU2VhcmNoIikpeyAgDQoJCQkJCSBqUXVlcnkodGhpcykudmFsKHBsYWNlaG9sZGVyVGV4dCk7DQoJCQkJCSBqUXVlcnkodGhpcykuYWRkQ2xhc3MoInBsYWNlaG9sZGVyVGV4dCIpOw0KCQkJCX0JCQ0KCQkJfQ0KCQkJZWxzZSBpZigoalF1ZXJ5KHRoaXMpLnZhbCgpICE9JycpICYmIChqUXVlcnkodGhpcykudmFsKCkgIT0gcGxhY2Vob2xkZXJUZXh0KSAmJiBwbGFjZWhvbGRlclRleHQhPSB1bmRlZmluZWQgKQ0KCQkJew0KCQkJCWpRdWVyeSh0aGlzKS5yZW1vdmVDbGFzcygicGxhY2Vob2xkZXJUZXh0Iik7DQoJCQl9DQoJCQlqUXVlcnkodGhpcykuZm9jdXMoZnVuY3Rpb24oKXsJIA0KCQkJCQ0KCQkJCWlmKChqUXVlcnkodGhpcykudmFsKCk9PXBsYWNlaG9sZGVyVGV4dCkmJihqUXVlcnkodGhpcykuaGFzQ2xhc3MoInBsYWNlaG9sZGVyVGV4dCIpKSkNCgkJCQkJew0KCQkJCQkJalF1ZXJ5KHRoaXMpLnZhbCgiIik7DQoJCQkJCQlqUXVlcnkodGhpcykucmVtb3ZlQ2xhc3MoInBsYWNlaG9sZGVyVGV4dCIpOw0KCQkJCQl9DQoJCQkJdmFyIGF0dHJWYWwgPSBqUXVlcnkodGhpcykuZXhpc3RzKCdwbGFjZWhvbGRlcicpOw0KCQkJCWlmKGF0dHJWYWwpew0KCQkJCQkgDQoJCQkJCSBqUXVlcnkodGhpcykucmVtb3ZlQXR0cigicGxhY2Vob2xkZXIiKTsgIC8qZml4IGFzIHBhcnQgb2YgQ1IgMTE5NSovDQoJCQkJCSBqUXVlcnkodGhpcykucmVtb3ZlQ2xhc3MoInBsYWNlaG9sZGVyVGV4dCIpOw0KCQkJCQkgDQoJCQkJIH0NCgkJCX0pOw0KDQoJCQlqUXVlcnkodGhpcykub24oImRyYWdlbnRlciIgLCBmdW5jdGlvbihldmVudCl7DQoJCQkJaWYoalF1ZXJ5KHRoaXMpLnZhbCgpID09IHBsYWNlaG9sZGVyVGV4dCl7DQoJCQkJalF1ZXJ5KHRoaXMpLnZhbCgiIik7DQoJCQkJalF1ZXJ5KHRoaXMpLnJlbW92ZUNsYXNzKCJwbGFjZWhvbGRlclRleHQiKTsNCgkJCQl9DQoJCQl9KTsNCgkJCWpRdWVyeSh0aGlzKS5ibHVyKGZ1bmN0aW9uKCl7DQoJCQkJaWYoalF1ZXJ5KHRoaXMpLnZhbCgpPT0iIikNCgkJCQkJew0KCQkJCQkJalF1ZXJ5KHRoaXMpLnZhbChwbGFjZWhvbGRlclRleHQpOw0KCQkJCQkJalF1ZXJ5KHRoaXMpLmFkZENsYXNzKCJwbGFjZWhvbGRlclRleHQiKTsNCgkJCQkJfQ0KCQkJfSk7DQoNCgkJCXZhciBlbFRleHRCb3ggPSAkKHRoaXMpOw0KCQkJalF1ZXJ5KGRvY3VtZW50KS5vbigiZHJhZ2VuZCIgLCBmdW5jdGlvbihldmVudCl7DQoNCgkJCQlpZihqUXVlcnkoZWxUZXh0Qm94KS52YWwoKT09IiIpDQoJCQkJCXsNCgkJCQkJCWpRdWVyeShlbFRleHRCb3gpLnZhbChwbGFjZWhvbGRlclRleHQpOw0KCQkJCQkJalF1ZXJ5KGVsVGV4dEJveCkuYWRkQ2xhc3MoInBsYWNlaG9sZGVyVGV4dCIpOw0KCQkJCQl9DQoJCQl9KTsNCg0KCQkJalF1ZXJ5KHRoaXMpLm9uKCJkcmFnbGVhdmUiICwgZnVuY3Rpb24oZXZlbnQpew0KDQoJCQlpZiAoISFuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkubWF0Y2goL21zaWUgOC4wLykpIHsgLy8gSUU4IGdpdmVzIHZlcnNpb240DQoJCQkJaWYoalF1ZXJ5KHRoaXMpLnZhbCgpPT0iIikNCgkJCQkJew0KCQkJCQkJalF1ZXJ5KHRoaXMpLnZhbChwbGFjZWhvbGRlclRleHQpOw0KCQkJCQkJalF1ZXJ5KHRoaXMpLmFkZENsYXNzKCJwbGFjZWhvbGRlclRleHQiKTsNCgkJCQkJfQ0KCQkJCQl9DQoJCQl9KTsNCgkJfSk7DQoJfQ0KDQpmdW5jdGlvbiBnZXRQYXJhbWV0ZXJCeU5hbWUobmFtZSkgew0KIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoKG5ldyBSZWdFeHAoJ1s/fCZdJyArIG5hbWUgKyAnPScgKyAnKFteJjtdKz8pKCZ8I3w7fCQpJykuZXhlYyhsb2NhdGlvbi5zZWFyY2gpfHxbLCIiXSlbMV0ucmVwbGFjZSgvXCsvZywgJyUyMCcpKXx8bnVsbDsNCg0KfQ0KDQoJRGF0ZS5wcm90b3R5cGUuZ2V0Q2xpZW50RGF0ZVRpbWUgPSBmdW5jdGlvbigpIHsNCgkJdmFyIHl5eXkgPSB0aGlzLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKTsNCgkJdmFyIG1tID0gKHRoaXMuZ2V0TW9udGgoKSArIDEpLnRvU3RyaW5nKCk7IC8vIGdldE1vbnRoKCkgaXMgemVyby1iYXNlZA0KCQl2YXIgZGQgPSB0aGlzLmdldERhdGUoKS50b1N0cmluZygpOw0KCQl2YXIgaCA9IHRoaXMuZ2V0SG91cnMoKS50b1N0cmluZygpOw0KCQl2YXIgbSA9IHRoaXMuZ2V0TWludXRlcygpLnRvU3RyaW5nKCk7DQoJCXZhciBzID0gdGhpcy5nZXRTZWNvbmRzKCkudG9TdHJpbmcoKTsNCgkJcmV0dXJuIHl5eXkgKyAiLSIgKyAobW1bMV0gPyBtbSA6ICIwIiArIG1tWzBdKSArICItIg0KCQkJCSsgKGRkWzFdID8gZGQgOiAiMCIgKyBkZFswXSkgKyAiVCIgKyAoKGggPiA5KSA/IGggOiAiMCIgKyBoKQ0KCQkJCSsgIi0iICsgKChtID4gOSkgPyBtIDogIjAiICsgbSk7IC8vIHBhZGRpbmcNCgl9Ow0KDQoJZnVuY3Rpb24gcGFkKG51bWJlciwgbGVuZ3RoKSB7DQoJCXZhciBzdHIgPSAiIiArIG51bWJlcg0KCQl3aGlsZSAoc3RyLmxlbmd0aCA8IGxlbmd0aCkgew0KCQkJc3RyID0gJzAnICsgc3RyDQoJCX0NCgkJcmV0dXJuIHN0cg0KCX0NCg0KCWZ1bmN0aW9uIGdldEdNVE9mZnNldCgpIHsNCgkJdmFyIG9mZnNldCA9IG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKQ0KCQlvZmZzZXQgPSAoKG9mZnNldCA8IDAgPyAnKycgOiAnLScpICsgLy8gTm90ZSB0aGUgcmV2ZXJzZWQgc2lnbiENCgkJcGFkKHBhcnNlSW50KE1hdGguYWJzKG9mZnNldCAvIDYwKSksIDIpICsgcGFkKE1hdGguYWJzKG9mZnNldCAlIDYwKSwgMikpOw0KCQlyZXR1cm4gb2Zmc2V0Ow0KCX0NCg0KCS8qZnVuY3Rpb24gZ2V0Q0NMQyhuYW1lKSB7DQoJCXZhciBnZXRRdWVyeVN0cmluZyA9IGdldFBhcmFtZXRlckJ5TmFtZShuYW1lKTsNCgkJdmFyIHJldHVybnZhbCA9ICIiOw0KCQl2YXIgdXJsID0gZG9jdW1lbnQubG9jYXRpb24uaHJlZjsNCg0KCQlpZihnZXRRdWVyeVN0cmluZyE9IG51bGwpew0KCQkJcmV0dXJudmFsID0gZ2V0UXVlcnlTdHJpbmc7DQoJCX0NCgkJZWxzZXsNCgkJCWlmKHVybC5sZW5ndGggPiAwICYmIHVybC5zcGxpdCgnY29tLycpWzFdICYmIHVybC5zcGxpdCgnY29tLycpWzFdLnNwbGl0KCcvJylbMF0pew0KCQkJCWlmKCQudHJpbShuYW1lKS50b0xvd2VyQ2FzZSgpID09ICJjYyIpew0KCQkJCQlyZXR1cm52YWwgPSB1cmwuc3BsaXQoJ2NvbS8nKVsxXS5zcGxpdCgnLycpWzBdLnNwbGl0KCctJylbMF07DQoJCQkJfQ0KCQkJCWVsc2V7DQoJCQkJCXJldHVybnZhbCA9IHVybC5zcGxpdCgnY29tLycpWzFdLnNwbGl0KCcvJylbMF0uc3BsaXQoJy0nKVsxXS5zcGxpdCgnPycpWzBdOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQlyZXR1cm4gcmV0dXJudmFsOw0KCX0qLw0KDQoJLy9BZGRpbmcgbmV3IG1ldGhvZCB0byBmaXQgaW50byBodHRwOi8vbG9jYWxob3N0L2NjLWxjDQoJZnVuY3Rpb24gZ2V0Q0NMQyhuYW1lKXsNCgkJLy8gcmV0dXJuIGdldFBhcmFtZXRlckJ5TmFtZShuYW1lKSE9IG51bGwgPyBnZXRQYXJhbWV0ZXJCeU5hbWUobmFtZSkgOg0KCQkvLyAkLnRyaW0obmFtZSkudG9Mb3dlckNhc2UoKSA9PSAiY2MiID8NCgkJLy8gZG9jdW1lbnQubG9jYXRpb24uaHJlZi5zcGxpdCgnLy8nKVsxXS5zcGxpdCgnLycpWzFdLnNwbGl0KCcjJylbMF0uc3BsaXQoJz8nKVswXS5zcGxpdCgnJicpWzBdLnNwbGl0KCctJylbMF0gOg0KCQkvLyBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLnNwbGl0KCcvLycpWzFdLnNwbGl0KCcvJylbMV0uc3BsaXQoJyMnKVswXS5zcGxpdCgnPycpWzBdLnNwbGl0KCcmJylbMF0uc3BsaXQoJy0nKVsxXTsNCg0KCQlyZXR1cm4gJC50cmltKG5hbWUpLnRvTG93ZXJDYXNlKCkgPT0gImNjIiA/DQoJCXdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgiLyIpWzFdLnNwbGl0KCItIilbMF0gOg0KCQl3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoIi8iKVsxXS5zcGxpdCgiLSIpWzFdOw0KCX0NCg0KIC8qSW50ZXJzdGl0aWFsIHNlYXJjaCAtIHN1Ym1pdCBidXR0b24gZW5hYmxlIC8gZGlzYWJsZSBmdW5jdGlvbmFsaXR5ICAtIEhpbWFuc2h1Ki8NCg0KDQppbnRlcnN0aXRpYWxEcm9wZG93blNldENoZWNrID0gZnVuY3Rpb24oY29udGFpbmVyLCBlbGVtZW50KXsNCgkvKg0KCQlTdGF0ZXMNCgkJMS4gbm90IHN0YXJ0ZWQNCgkJMi4gaW4gcHJvZ3Jlc3MNCgkJMy4gY29tcGxldGVkDQoJKi8NCg0KCXZhciBlbmFibGVkQm9vbERyb3Bkb3duID0gMTsNCgkvLyAxLiBjaGVjayBkcm9wZG93biB2YWx1ZXMgc2V0DQoJdmFyIHBCdWlsZGVyU2VsZWN0ID0gJCgnIycrIGNvbnRhaW5lcisgJyBzZWxlY3QnKTsNCglsYXN0RHJvcGRvd25JbmRleCA9IHBCdWlsZGVyU2VsZWN0Lmxlbmd0aC0xOw0KDQoJcEJ1aWxkZXJMYXN0U2VsZWN0ID0gJChwQnVpbGRlclNlbGVjdFtsYXN0RHJvcGRvd25JbmRleF0pOw0KDQoJaWYocEJ1aWxkZXJMYXN0U2VsZWN0LnZhbCgpICE9IiIgJiYgcEJ1aWxkZXJMYXN0U2VsZWN0LnZhbCgpICE9bnVsbCAmJiBwQnVpbGRlckxhc3RTZWxlY3QudmFsKCkgIT0ibnVsbCIpew0KCQkvL2VuYWJsZSBidXR0b24gYXMgbGFzdCBvcHRpb24gaXMgc2VsZWN0ZWQNCgkJZW5hYmxlZEJvb2xEcm9wZG93biA9IDM7DQoJCSQoIi4iK2VsZW1lbnQrIiAubmFycm93TWVzc2FnZSIpLmhpZGUoKTsNCgl9ZWxzZXsNCgkJLy9sYXN0IG9wdGlvbiBpcyBub3Qgc2VsZWN0ZWQgaGFuZGxlIHRoZSBlcnJvciBtZXNzYWdlDQoJCQlpZihsYXN0RHJvcGRvd25JbmRleCA+IDApew0KCQkJCS8vbW9yZSB0aGFuIG9uZSBkcm9wZG93biB3aXRoIGxhc3QgdmFsdWUgbm90IHNlbGVjdGVkDQoJCQkJZW5hYmxlZEJvb2xEcm9wZG93bj0yOw0KCQkJCSQoIi4iK2VsZW1lbnQrIiAubmFycm93TWVzc2FnZSIpLnNob3coKTsNCgkJCX1lbHNlew0KCQkJCS8vZmlyc3QgZHJvcGRvd24gd2l0aCBubyB2YWx1ZSBzZWxlY3RlZA0KCQkJCSQoIi4iK2VsZW1lbnQrIiAubmFycm93TWVzc2FnZSIpLmhpZGUoKTsNCg0KCQkJfQ0KDQoNCg0KCX0NCg0KCXJldHVybiBlbmFibGVkQm9vbERyb3Bkb3duDQoNCn0NCg0KaXNJbnRlcnN0aXRpYWxTdWJtaXRFbmFibGVkID0gIGZ1bmN0aW9uKGVsZW1lbnQpew0KCS8vZGlzYWJsZSBCdXR0b24gYnkgZGVmYXVsdA0KCXZhciBlbmFibGVkQm9vbDEgPSAxOw0KCXZhciBlbmFibGVkQm9vbDI9IDE7DQoJdmFyIGVuYWJsZWRCb29sMyA9IDE7DQoNCgkvKgkxLnByb2R1Y3QgRHJvcGRvd24qLw0KCWVuYWJsZWRCb29sMSA9IGludGVyc3RpdGlhbERyb3Bkb3duU2V0Q2hlY2soJ3Byb2R1Y3RCdWlsZGVyRHJvcGRvd25zJywgJ25hcnJvd1Byb2R1Y3QnKTsNCg0KDQoJLyoJMi5PUyBEcm9wZG93biovDQoJZW5hYmxlZEJvb2wyID0gaW50ZXJzdGl0aWFsRHJvcGRvd25TZXRDaGVjaygncHJvZHVjdEJ1aWxkZXJEcm9wZG93bnMzJywgJ25hcnJvd09TJyk7DQoNCglpbnRlcnN0aXRpYWxLZXl3b3JkcyA9ICQoJyNpbnRlcnN0aXRpYWxLZXl3b3JkcycpDQoJaWYoaW50ZXJzdGl0aWFsS2V5d29yZHMubGVuZ3RoPjApew0KCQlpZihpbnRlcnN0aXRpYWxLZXl3b3Jkcy52YWwoKSE9IiIgJiYgaW50ZXJzdGl0aWFsS2V5d29yZHMhPW51bGwJICYmIGludGVyc3RpdGlhbEtleXdvcmRzIT0ibnVsbCIpew0KCQkJZW5hYmxlZEJvb2wzID0gMzsNCgkJfQ0KCX0NCg0KDQoJaWYoZW5hYmxlZEJvb2wxID09IDIgfHwgZW5hYmxlZEJvb2wyID09IDIpDQoJew0KCQkvL2FueSBvbmUgc3RlcCBpbiBwcm9ncmVzcw0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCWVsc2UgaWYoZW5hYmxlZEJvb2wxPT0zIHx8IGVuYWJsZWRCb29sMj09MyB8fCBlbmFibGVkQm9vbDM9PTMpew0KCQkvL2FueSBvbmUgaXMgY29tcGxldGVkDQoJCXJldHVybiB0cnVlDQoJfQ0KCWVsc2V7DQoJCS8vbm9uZSBzdGFydGVkDQoJCXJldHVybiBmYWxzZQ0KDQoJfQ0KDQp9DQoNCiAgZnVuY3Rpb24gaW50ZXJzdGl0aWFsU3VibWl0VmFsaWRhdG9yKGVsZW1lbnQpIHsNCg0KICAgICAgICAgICAgaWYgKGlzSW50ZXJzdGl0aWFsU3VibWl0RW5hYmxlZChlbGVtZW50KSkgew0KICAgICAgICAgICAgICAgICQoIiNidG5JbnRlcnN0aXRpYWxTdWJtaXQiKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOw0KICAgICAgICAgICAgICAgICQoIi4iK2VsZW1lbnQrIiAubmFycm93TWVzc2FnZSIpLmhpZGUoKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJCgiI2J0bkludGVyc3RpdGlhbFN1Ym1pdCIpLmF0dHIoImRpc2FibGVkIiwgImRpc2FibGVkIik7DQogICAgICAgICAgICB9DQogICAgfQ0KDQoNCg0KDQoNCg0KCS8qIEludGVyc3RpdGlhbCBzZWFyY2ggLSBzdWJtaXQgYnV0dG9uIGVuYWJsZSAvIGRpc2FibGUgZnVuY3Rpb25hbGl0eQ0KCWZ1bmN0aW9uIGlzSW50ZXJzdGl0aWFsU3VibWl0RW5hYmxlZChlbGVtZW50KSB7DQogICAgICAgIHZhciBlbmFibGVkQm9vbCA9IHRydWU7DQogICAgICAgIHZhciBub09mRG9wZG93bnMgPSAkKCIjcmVmaW5lLXJlc3VsdHMtbW9kYWwgc2VsZWN0W2lkXj1wcm9kdWN0QnVpbGRlckRyb3Bkb3duXSIpLmxlbmd0aDsNCiAgICAgICAgaWYgKG5vT2ZEb3Bkb3ducyA+IDIpIHsNCiAgICAgICAgICAgICQoIiNyZWZpbmUtcmVzdWx0cy1tb2RhbCBzZWxlY3RbaWRePXByb2R1Y3RCdWlsZGVyRHJvcGRvd25dIikuZWFjaChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBpZiAoISgkKHRoaXMpLmF0dHIoImlkIikgaW4gb2JqZWN0Q29udmVydGVyKFsncHJvZHVjdEJ1aWxkZXJEcm9wZG93bjAnLCdwcm9kdWN0QnVpbGRlckRyb3Bkb3duczAnLCdwcm9kdWN0QnVpbGRlckRyb3Bkb3duMycsJ3Byb2R1Y3RCdWlsZGVyRHJvcGRvd25zMyddKSkgJiAoKCQodGhpcykudmFsKCkgPT0gJycpfHwoJCh0aGlzKS52YWwoKSA9PSBudWxsKSkpIHsNCiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZEJvb2wgPSBmYWxzZTsNCg0KICAgICAgICAgICAgICAgICAgICBpZigkKHRoaXMpLnBhcmVudHMoJy4nK2VsZW1lbnQpLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICQoIi4iK2VsZW1lbnQrIiAubmFycm93TWVzc2FnZSIpLnNob3coKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgJCgiLiIrZWxlbWVudCsiIC5uYXJyb3dNZXNzYWdlIikuaGlkZSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICB9DQogICAgICAgIGVsc2V7DQogICAgICAgICAgICBpZiAoJCgiI2ludGVyc3RpdGlhbEtleXdvcmRzIikudmFsKCkgPT0gJycpIHsNCiAgICAgICAgICAgICAgICBlbmFibGVkQm9vbCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICByZXR1cm4gZW5hYmxlZEJvb2w7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb2JqZWN0Q29udmVydGVyKGFycmF5KSB7DQogICAgICAgIHZhciBvYmplY3QgPSB7fTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgb2JqZWN0W2FycmF5W2ldXSA9ICcnOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBvYmplY3Q7DQogICAgfQ0KDQoNCg0KICAgIGZ1bmN0aW9uIGludGVyc3RpdGlhbFN1Ym1pdFZhbGlkYXRvcihlbGVtZW50KSB7DQoNCiAgICAgICAgICAgIGlmIChpc0ludGVyc3RpdGlhbFN1Ym1pdEVuYWJsZWQoZWxlbWVudCkpIHsNCiAgICAgICAgICAgICAgICAkKCIjYnRuSW50ZXJzdGl0aWFsU3VibWl0IikucmVtb3ZlQXR0cigiZGlzYWJsZWQiKTsNCiAgICAgICAgICAgICAgICAkKCIuIitlbGVtZW50KyIgLm5hcnJvd01lc3NhZ2UiKS5oaWRlKCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICQoIiNidG5JbnRlcnN0aXRpYWxTdWJtaXQiKS5hdHRyKCJkaXNhYmxlZCIsICJkaXNhYmxlZCIpOw0KICAgICAgICAgICAgfQ0KICAgIH0NCiAgICAvKiBJbnRlcnN0aXRpYWwgc2VhcmNoIC0gc3VibWl0IGJ1dHRvbiBlbmFibGUgLyBkaXNhYmxlIGZ1bmN0aW9uYWxpdHkgIC0gRU5EDQoNCgkvKiBSZW1vdmUgZXJyb3IgbWVzc2FnZSBmb3IgcEZpbmRlciBvbiBjbGljaw0KCSAqIEZ1bmN0aW9uIGNvbW1lbnRlZCBhcyB0aGUgZXJyb3IgbWVzc2FnZSBpcyByZW1vdmVkIGZyb20gYWxsIHZpZXdzLiBKdXN0IHVuY29tbWVudCB0byBnZXQgaGUgZnVuY3Rpb24gYmFjayBhZ2Fpbi4NCglmdW5jdGlvbiByZW1vdmVQRmluZGVyRXJyb3IoKXsNCgkJJChkb2N1bWVudCkub24oJ2NsaWNrJywnLnBGaW5kZXJNMldyYXBwZXIgLmVycm9yTWVzc2FnZSwucEZpbmRlclZpZXcyIC5lcnJvck1lc3NhZ2UsLnBGaW5kZXJWaWV3MyAuZXJyb3JNZXNzYWdlJywgZnVuY3Rpb24oZXZlbnQpIHsNCg0KCSAgICAgICAgY2xlYXJFcnJvck1lc3NhZ2UoJCgiI3Byb2R1Y3ROYW1lIikpOw0KCSAgICAgICAgJCgiI3Byb2R1Y3ROYW1lIikucGFyZW50KCkuZmluZCgnLmVycm9yTWVzc2FnZScpLnJlbW92ZSgpOw0KCSAgICAgICAgJCgiI3Byb2R1Y3ROYW1lIikuZm9jdXMoKTsNCgkgICAgfSk7DQoJfQ0KCSovDQovKiBTZXQgY2Fub25pY2FsIFVSTCBmdW5jdGlvbiovDQoNCglmdW5jdGlvbiBzZXRDYW5vbmljYWxVcmwoKSB7DQoJCXZhciB3aW5kTG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb24uaHJlZjsNCgkJdmFyIHNwbGl0VmFsdWUgPSB3aW5kTG9jYXRpb24uc3BsaXQoJz8nKTsNCgkJY29uc29sZS5sb2coJ3dpbmRMb2NhdGlvbi4uLi4nK3dpbmRMb2NhdGlvbik7DQoJCWNvbnNvbGUubG9nKCdzcGxpdFZhbHVlLi4uLicrc3BsaXRWYWx1ZSk7DQoJCSQoJ2xpbmtbcmVsPWNhbm9uaWNhbF0nKS5hdHRyKCdocmVmJyxzcGxpdFZhbHVlWzBdKTsNCgkJLy9jb25zb2xlLmxvZygndXJsIGNobmFnZWQuLi4uLicpOw0KCX0NCgkNCgkvKiBTZXQgYWx0ZXJuYXRlIFVSTCBzZXRBbHRlcm5hdGVVcmwoKSBmdW5jdGlvbiovDQoJZnVuY3Rpb24gc2V0QWx0ZXJuYXRlVXJsKCkgew0KCQl2YXIgd2luZExvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWY7DQoJCWlmKHdpbmRMb2NhdGlvbi5pbmRleE9mKCIvZG9jdW1lbnQvaXNoXyIpICE9PSAtMSAmJiB3aW5kTG9jYXRpb24uaW5kZXhPZigiL3Byb2R1Y3QiKSE9PSAtMSl7DQoJCQkkKCdsaW5rW3JlbD1hbHRlcm5hdGVdJykuZWFjaChmdW5jdGlvbigpIHsNCgkJCQl2YXIgU2VsZWN0ZWRVcmwgPSAkKHRoaXMpLmF0dHIoImhyZWYiKTsNCgkJCQlpZihTZWxlY3RlZFVybC5pbmRleE9mKCIvZG9jdW1lbnQvaXNoXyIpICE9PSAtMSl7DQoJCQkJCXZhciBzcGxpdFZhbHVlID0gInByb2R1Y3QiK3dpbmRMb2NhdGlvbi5zcGxpdCgiL3Byb2R1Y3QiKVsxXS5zcGxpdCgiZG9jdW1lbnQiKVswXSsiZG9jdW1lbnQiOw0KCQkJCQl2YXIgVXBkYXRlZFVybCA9ICQodGhpcykuYXR0cigiaHJlZiIpLnJlcGxhY2UoImRvY3VtZW50IixzcGxpdFZhbHVlKTsNCgkJCQkJJCh0aGlzKS5hdHRyKCdocmVmJyxVcGRhdGVkVXJsKTsNCgkJCX0NCgkJfSk7DQoJfQ0KfQ0KDQpmdW5jdGlvbiBjaGVja0ZvckV2ZW50QmluZChlbGVtZW50X2lkLGV2ZW50X3RvX2NoZWNrKXsNCgl2YXIgcmVzdWx0ID0gZmFsc2U7DQoJdmFyIGV2ZW50X2hhbmRsZXJzID0gJC5fZGF0YSggJChlbGVtZW50X2lkKVswXSwgJ2V2ZW50cycgKTsNCg0KCSQuZWFjaChldmVudF9oYW5kbGVycywgZnVuY3Rpb24oa2V5LCBkYXRhKXsNCgkJaWYoa2V5PT1ldmVudHNfdG9fY2hlY2spew0KCQkJcmVzdWx0ID0gdHJ1ZTsNCgkJfQ0KCX0pOw0KCXJldHVybihyZXN1bHQpOw0KfQ0KDQoNCi8vRnVuY3Rpb24gdG8gY2hlY2sgaWYgYSBwcm9wZXJ0eSBleGlzdHMNCi8vRXhhbXBsZTogJCgnI3NlYXJjaC1pbnB1dCcpLmV4aXN0cygnZ2hvc3R0ZXh0Jyk7DQpqUXVlcnkuZm4uZXhpc3RzPWZ1bmN0aW9uKGF0dHJpYnV0ZVZhcil7DQoJdmFyIGF0dHIgPSAkKHRoaXMpLmF0dHIoYXR0cmlidXRlVmFyKTsNCglyZXR1cm4gdHlwZW9mIGF0dHIgIT09IHR5cGVvZiB1bmRlZmluZWQgJiYgYXR0ciAhPT0gZmFsc2U7DQp9DQoNCi8vTmV3IHByb3BlcnR5IHRvIGdldCBhY3R1YWwgdmFsdWUgZXhjbHVkaW5nIGdob3N0IHRleHQgd2l0aCB0cmltKCkNCmpRdWVyeS5mbi5hY3R1YWxWYWw9ZnVuY3Rpb24oKSB7DQogICAgaWYodGhpc1swXSkgew0KICAgICAgICB2YXIgZWw9JCh0aGlzWzBdKTsNCiAgICAgICAgdmFyIGdob3N0VGV4dFVzZWQgPSBlbC5leGlzdHMoJ2dob3N0dGV4dCcpOw0KICAgICAgICBpZihnaG9zdFRleHRVc2VkICYmIGVsLnZhbCgpID09IGVsLmF0dHIoJ2dob3N0VGV4dCcpKSB7DQogICAgICAgICAgICByZXR1cm4gJyc7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gJC50cmltKGVsLnZhbCgpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdW5kZWZpbmVkOw0KfTsNCg0KLy9OZXcgcHJvcGVydHkgdG8gZ2V0IGFjdHVhbCB2YWx1ZSBleGNsdWRpbmcgZ2hvc3QgdGV4dCB3aXRob3V0IHRyaW0oKTsNCmpRdWVyeS5mbi50cnVlVmFsPWZ1bmN0aW9uKCkgew0KICAgIGlmKHRoaXNbMF0pIHsNCiAgICAgICAgdmFyIGVsZT0kKHRoaXNbMF0pOw0KICAgICAgICB2YXIgZ2hvc3RUZXh0VXNlZCA9IGVsZS5leGlzdHMoJ2dob3N0dGV4dCcpOw0KICAgICAgICBpZihnaG9zdFRleHRVc2VkICYmIGVsZS52YWwoKSA9PSBlbGUuYXR0cignZ2hvc3RUZXh0JykpIHsNCiAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBlbGUudmFsKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHVuZGVmaW5lZDsNCn07DQovKkZ1bmN0aW9uIHRvIHN0b3AgdGhlIHN1Ym1pdCBhY3Rpb24gb2YgdGhlIGZvcm0gYW5kIGNoZWNrIGZvciBYU1MgRXJyb3IqLw0KZnVuY3Rpb24gdHJpZ2dlclhTU0NoZWNrKGZvcm1JZCxidXR0b25JZCxwb3N0RXhlY3V0ZUZ1bmN0aW9uTmFtZSl7DQoJJCgnIycrZm9ybUlkKS5vbignc3VibWl0JywgZnVuY3Rpb24oZXZlbnQpew0KDQoJaWYoY2hlY2tGb3JYc3NFcnJvcigpKXsNCgkJZXZlbnQucHJldmVudERlZmF1bHQoKTsNCgkJZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7DQoJCSQoJyNtZGxTcGlubmVyJykubW9kYWwoJ2hpZGUnKTsNCgkJJCgiLndhcnJhbnR5LWVycm9yIikuc2hvdygpOw0KCQkkKCdbZGF0YS1zZWN1cml0eUNoZWNrPSJ0cnVlIl1bcmVhZG9ubHkhPSJyZWFkb25seSJdW3R5cGUhPSJoaWRkZW4iXScpLnZhbCgiIik7Ly9yZW1vdmUgdGhlIHZhbHVlcyBmcm9tIGFsbCBpbnB1dCB0aGF0IGFyZSBub3QgcmVhZCBvbmx5DQoJCSQoIi5lcnJvck1lc3NhZ2UiKS5oaWRlKCk7DQoJCSQoIiMiK2J1dHRvbklkKS5wcm9wKCJkaXNhYmxlZCIsdHJ1ZSk7DQoJCWlmKHR5cGVvZiBwb3N0RXhlY3V0ZUZ1bmN0aW9uTmFtZSAhPT0ndW5kZWZpbmVkJyApew0KCQkJcG9zdEV4ZWN1dGVGdW5jdGlvbk5hbWUoKTsNCgkJfQ0KDQoJfQ0KfSk7DQp9DQpmdW5jdGlvbiBjaGVja0Zvclhzc0Vycm9yKCkgew0KdmFyIGhhc0Vycm9ycyA9IGZhbHNlOw0KdmFyIHJlZ0V4ID0gKC8oPHw+fHNjcmlwdHxmdW5jdGlvbnxkb2N1bWVudFwufFwuYWxlcnR8YWxlcnRcKHxcJFwufFwkXCh8anF1ZXJ5fGpRdWVyeXx3aW5kb3dcLnxcLm9wZW58d2luZG93c1wufG9ubG9hZHxjb29raWUpL2kpOw0KJCgkKCdbZGF0YS1zZWN1cml0eUNoZWNrPSJ0cnVlIl0nKSkuZWFjaChmdW5jdGlvbihlKSB7DQoJaWYgKHJlZ0V4LnRlc3QoJCh0aGlzKS52YWwoKSkgKXsNCgkJaGFzRXJyb3JzID10cnVlOw0KCX0NCn0pOw0KcmV0dXJuIGhhc0Vycm9yczsNCn0NCg0KLy8gR2V0IFVybCBRdWVyeSBTdHJpbmcNCg0KdmFyIFF1ZXJ5U3RyaW5nID0gZnVuY3Rpb24gKCkgew0KICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGFub255bW91cywgaXMgZXhlY3V0ZWQgaW1tZWRpYXRlbHkgYW5kDQogIC8vIHRoZSByZXR1cm4gdmFsdWUgaXMgYXNzaWduZWQgdG8gUXVlcnlTdHJpbmchDQogIHZhciBxdWVyeV9zdHJpbmcgPSB7fTsNCiAgdmFyIHF1ZXJ5ID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7DQogIHZhciB2YXJzID0gcXVlcnkuc3BsaXQoIiYiKTsNCiAgZm9yICh2YXIgaT0wO2k8dmFycy5sZW5ndGg7aSsrKSB7DQogICAgdmFyIHBhaXIgPSB2YXJzW2ldLnNwbGl0KCI9Iik7DQogICAgICAgIC8vIElmIGZpcnN0IGVudHJ5IHdpdGggdGhpcyBuYW1lDQogICAgaWYgKHR5cGVvZiBxdWVyeV9zdHJpbmdbcGFpclswXV0gPT09ICJ1bmRlZmluZWQiKSB7DQogICAgICBxdWVyeV9zdHJpbmdbcGFpclswXV0gPSBkZWNvZGVVUklDb21wb25lbnQocGFpclsxXSk7DQogICAgICAgIC8vIElmIHNlY29uZCBlbnRyeSB3aXRoIHRoaXMgbmFtZQ0KICAgIH0gZWxzZSBpZiAodHlwZW9mIHF1ZXJ5X3N0cmluZ1twYWlyWzBdXSA9PT0gInN0cmluZyIpIHsNCiAgICAgIHZhciBhcnIgPSBbIHF1ZXJ5X3N0cmluZ1twYWlyWzBdXSxkZWNvZGVVUklDb21wb25lbnQocGFpclsxXSkgXTsNCiAgICAgIHF1ZXJ5X3N0cmluZ1twYWlyWzBdXSA9IGFycjsNCiAgICAgICAgLy8gSWYgdGhpcmQgb3IgbGF0ZXIgZW50cnkgd2l0aCB0aGlzIG5hbWUNCiAgICB9IGVsc2Ugew0KICAgICAgcXVlcnlfc3RyaW5nW3BhaXJbMF1dLnB1c2goZGVjb2RlVVJJQ29tcG9uZW50KHBhaXJbMV0pKTsNCiAgICB9DQogIH0NCiAgcmV0dXJuIHF1ZXJ5X3N0cmluZzsNCn07DQoNCg0KLy8gRnVuY3Rpb24gdG8gdHJpZ2dlciBhbiBhamF4IGNhbGwgdG8gZ2V0IHRvb2x0aXAgZGF0YSAsIHdoaWNoIGludGVybmFsbHkgcGFzc2VzIGl0IHRvIHRoZQ0KLy8gdG9vbHRpcCBwbHVnaW4NCi8vIEBwYXJhbXMgLSB0YXJnZXRFbGVtZW50cyAtIEFycmF5IG9mIHRhcmdldCBlbGVtZW50IHNlbGVjdG9ycyB3aGVyZSB0aGUgVG9vbHRpcCBjb250ZW50IHdpbGwgYmUgcGxhY2VkDQovLyAgICAgICAgIC0gdGVtcGxhdGVTZWxlY3RvciAtIGlkKHN0cmluZykgb2YgdGhlIHRlbXBsYXRlIHdoaWNoIHdpbGwgYmUgZmlsbGVkIHVwIHdpdGggZGF0YSBvbmNlIHJldHJpZXZlZA0KLy8JCSAgIC0gZW5kUG9pbnRVcmwgLSB1cmwgdG8gZ2V0IHRoZSB0b29sdGlwIGRhdGEgZnJvbQ0KDQpmdW5jdGlvbiBnZXRUb29sVGlwRGF0YSh0YXJnZXRFbGVtZW50cywgdGVtcGxhdGVTZWxlY3RvciwgZW5kUG9pbnRVcmwgKXsNCg0KCXZhciBnZXRRdWVyeVN0cmluZyA9IFF1ZXJ5U3RyaW5nKCk7DQoNCgkvLyBHZXQgY2MgYW5kIGxjIC0gY291bnRyeSBhbmQgbGFuZ3VhZ2UNCg0KCXZhciBkYXRhSlNPTiA9IHsNCgkJImNjIiA6IGdldENDTEMoImNjIiksDQoJCSJsYyIgOiBnZXRDQ0xDKCJsYyIpDQoJfTsNCg0KCS8vIElmIGRpc3BsYXlLZXkgZXhpc3RzLCBzZW5kIHRoYXQgYWxvbmcgd2l0aCB0aGUgY2FsbA0KDQoJaWYoZ2V0UXVlcnlTdHJpbmcuZGlzcGxheUtleSAhPT0gdW5kZWZpbmVkKXsNCgkJZGF0YUpTT04uZGlzcGxheUtleSA9IGdldFF1ZXJ5U3RyaW5nLmRpc3BsYXlLZXk7DQoJfQ0KDQoJLy8gUmV0cmlldmUgdG9vbHRpcCBkYXRhDQoNCgkkLmFqYXgoew0KICAgICAgCXR5cGU6ICdHRVQnLA0KICAgICAgCXVybCA6IGVuZFBvaW50VXJsLA0KICAgICAgCWRhdGFUeXBlOidqc29uJywNCiAgICAgIAljb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL3RleHQnLA0KICAgICAgCWRhdGEgOiBkYXRhSlNPTiwNCg0KCSAgICBzdWNjZXNzIDogZnVuY3Rpb24oZGF0YSkgew0KDQoJICAgIAlkYXRhLnByaXZhY3lQb2xpY3lVcmwgPSBwcml2YWN5VXJsOw0KDQoJICAgIAl2YXIgdG9vbHRpcERhdGEgPSB7DQoJICAgIAkJImRhdGEiIDogZGF0YSwNCgkgICAgCQkidGVtcGxhdGVTZWxlY3RvciIgOiB0ZW1wbGF0ZVNlbGVjdG9yDQoJICAgIAl9DQoNCgkgICAgCS8vIEB0b2RvOiBQb3J0IHRvIEFycmF5LmZvckVhY2ggaWYgRVM1IG9ubHkgYnJvd3NlcnMgb3IgdXNpbmcgYSBzaGltIC4NCg0KCSAgICAJZm9yIChpID0gMDsgaSA8IHRhcmdldEVsZW1lbnRzLmxlbmd0aDsgKytpKSB7DQoJCQkgICAgJCh0YXJnZXRFbGVtZW50c1tpXSkucmVuZGVyVG9vbHRpcCggdG9vbHRpcERhdGEgKTsNCgkJCSAgICBpZih0YXJnZXRFbGVtZW50c1tpXSA9PSAiI3Byb2R1Y3Qtc2VyaWFsLW51bWJlci1tb2RhbCIpew0KCQkJICAgIAkkKCIjcHJvZHVjdC1zZXJpYWwtbnVtYmVyLW1vZGFsIC5tb2RhbC1oZWFkZXIgLm1vZGFsLXRpdGxlIikuY2hpbGRyZW4oImgzLndoZXJlX2lzX3Byb2R1Y3RfbnVtYmVyX2hlYWRlciIpLmF0dHIoImlkIiwicHJvZHVjdC1zZXJpYWwtbnVtYmVyLW1vZGFsLW1haW4taGVhZGluZyIpOw0KCQkJICAgIH0NCgkJCSAgICBlbHNlew0KCQkJICAgIAkkKCIjc2VyaWFsLW51bWJlci1tb2RhbCAubW9kYWwtaGVhZGVyIC5tb2RhbC10aXRsZSIpLmNoaWxkcmVuKCJoMy53aGVyZV9pc19wcm9kdWN0X251bWJlcl9oZWFkZXIiKS5hdHRyKCJpZCIsInNlcmlhbC1udW1iZXItbW9kYWwtbWFpbi1oZWFkaW5nIik7DQoJCQkgICAgfQ0KCQkJfQ0KDQoJICAgIH0sDQoJICAgIGVycm9yIDogZnVuY3Rpb24oZSkgew0KDQoJICAgIAkvLyBAdG9kbyA6IGNoZWNrIGZvciBhbnkgZXJyb3IgaGFuZGxpbmcgc2NlbmFyaW9zIFsgZGlzcGxheSBlcnJvciBtZXNzYWdlIGV0YyBdDQoJICAgICAgICBjb25zb2xlLmxvZygnRVJST1I6ICcsIGUpOw0KCSAgICAgICAgY29uc29sZS5sb2coeGhyLnN0YXR1cyk7DQoJICAgIH0NCiAgICB9KTsNCg0KDQp9DQoNCg0KZnVuY3Rpb24gaXNNb2JpbGVEZXZpY2UoKXsNCiAgICB2YXIgbW9iaWxlRGV2aWNlcyA9IFsiQW5kcm9pZCIsICJpUGFkIiwgImlQaG9uZSJdOw0KICAgIHZhciBjdXJyZW50RGV2aWNlID0gaXNNb2JpbGUuYW55KCk7DQogICAgY3VycmVudERldmljZSA9IGN1cnJlbnREZXZpY2UgPT0gbnVsbCA/ICIiIDogY3VycmVudERldmljZVswXTsNCiAgICByZXR1cm4gJC5pbkFycmF5KGN1cnJlbnREZXZpY2UsIG1vYmlsZURldmljZXMpICE9IC0xOw0KfQ0KDQovKlRoaXMgZnVuY3Rpb24gaXMgdG8gYnVpbGQgdXJscyBmb3IgZG9jSURzLiBUYWtlcyBwYXJhbWV0ZXJzOiBlbmdsaXNoRG9jSWQgLSBFbmdsaXNoIGRvY3VtZW50IElEOw0KYW5jaG9yVGFnRWxlbWVudCAtIEFuY2hvciB0YWcgd2hlcmUgaHJlZiBuZWVkcyB0byBiZSBwb3B1bGF0ZWQ7DQpjb25jZW50cmFBamF4VXJsIC0gVVJMIGZvciBhamF4IHRvIHJldHJpZXZlIGxvY2FsZSBzcGVjaWZpYyBkb2NJRCAqLw0KICAgIGZ1bmN0aW9uIGJ1aWxkQW5vbnltb3VzQ29uY2VudHJhVXJsIChlbmdsaXNoRG9jSWQsIGFuY2hvclRhZ0VsZW1lbnQsIGNvbmNlbnRyYUFqYXhVcmwpIHsNCgkJIHZhciBjdXJyZW50Q0MgPSBnZXRDQ0xDKCdjYycpOw0KCQkgdmFyIGN1cnJlbnRMQyA9IGdldENDTEMoJ2xjJyk7DQoJCSB2YXIgZG9jdW1lbnRVcmwgPSAiLyIrY3VycmVudENDKyItIitjdXJyZW50TEMrIi9kb2N1bWVudC8iOw0KDQoJCSBpZihjdXJyZW50Q0MgPT0gJ3VzJyAmJiBjdXJyZW50TEMgPT0gJ2VuJyl7DQoJCSAgYW5jaG9yVGFnRWxlbWVudC5hdHRyKCdocmVmJywgZG9jdW1lbnRVcmwrZW5nbGlzaERvY0lkKTsNCgkJIH0NCgkJIGVsc2UNCgkJIHsNCgkJICB2YXIgZGF0YU9iaiA9IHsNCgkJICAgJ2NjJzogY3VycmVudENDLA0KCQkgICAnbGMnOiBjdXJyZW50TEMsDQoJCSAgICdkb2N1bWVudElkJzogZW5nbGlzaERvY0lkDQoJCSAgfTsNCg0KCQkgICQuYWpheCh7DQoJCSAgIGRhdGE6IGRhdGFPYmosDQoJCSAgICAgICAgIHVybDogY29uY2VudHJhQWpheFVybCwNCgkJICAgICAgICAgdHlwZTogJ1BPU1QnLA0KCQkgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKXsNCgkJICAgICAgICAgIGlmKGRhdGEgPT0gIiIpDQoJCSAgICAgICAgICAgZGF0YSA9IGVuZ2xpc2hEb2NJZDsNCgkJICAgICAgICAgIGFuY2hvclRhZ0VsZW1lbnQuYXR0cignaHJlZicsIGRvY3VtZW50VXJsK2RhdGEpOw0KCQkgICAgICAgICB9LA0KCQkgICAgICAgICBlcnJvcjogZnVuY3Rpb24oeGhyLCBhamF4T3B0aW9ucywgdGhyb3duRXJyb3Ipew0KCQkgICAgICAgICAgY29uc29sZS5sb2coJ1Vua25vd24gZXJyb3IgdGhyb3duJyk7DQoJCSAgICAgICAgICBhbmNob3JUYWdFbGVtZW50LmF0dHIoJ2hyZWYnLCBkb2N1bWVudFVybCtlbmdsaXNoRG9jSWQpOw0KCQkgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KCQkgICAgICAgICB9DQoJCSAgICAgfSk7DQoJCSB9DQp9DQoNCmZ1bmN0aW9uIGNvbnZlcnRJbWFnZVRvU3ZnKCl7DQogICAgalF1ZXJ5KCdpbWcuY29udGFjdE9wdGlvbnNJbWcnKS5lYWNoKGZ1bmN0aW9uKCl7DQoJICAgIHZhciAkaW1nID0galF1ZXJ5KHRoaXMpOw0KCSAgICB2YXIgaW1nSUQgPSAkaW1nLmF0dHIoJ2lkJyk7DQoJICAgIHZhciBpbWdDbGFzcyA9ICRpbWcuYXR0cignY2xhc3MnKTsNCgkgICAgdmFyIGltZ1VSTCA9ICRpbWcuYXR0cignc3JjJyk7DQoNCgkgICAgalF1ZXJ5LmdldChpbWdVUkwsIGZ1bmN0aW9uKGRhdGEpIHsNCgkgICAgICAgIC8vIEdldCB0aGUgU1ZHIHRhZywgaWdub3JlIHRoZSByZXN0DQoJICAgICAgICB2YXIgJHN2ZyA9IGpRdWVyeShkYXRhKS5maW5kKCdzdmcnKTsNCg0KCSAgICAgICAgLy8gQWRkIHJlcGxhY2VkIGltYWdlJ3MgSUQgdG8gdGhlIG5ldyBTVkcNCgkgICAgICAgIGlmKHR5cGVvZiBpbWdJRCAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkgICAgICAgICAgICAkc3ZnID0gJHN2Zy5hdHRyKCdpZCcsIGltZ0lEKTsNCgkgICAgICAgIH0NCgkgICAgICAgIC8vIEFkZCByZXBsYWNlZCBpbWFnZSdzIGNsYXNzZXMgdG8gdGhlIG5ldyBTVkcNCgkgICAgICAgIGlmKHR5cGVvZiBpbWdDbGFzcyAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkgICAgICAgICAgICAkc3ZnID0gJHN2Zy5hdHRyKCdjbGFzcycsIGltZ0NsYXNzKycgcmVwbGFjZWQtc3ZnJyk7DQoJICAgICAgICB9DQoNCgkgICAgICAgIC8vIFJlbW92ZSBhbnkgaW52YWxpZCBYTUwgdGFncyBhcyBwZXIgaHR0cDovL3ZhbGlkYXRvci53My5vcmcNCgkgICAgICAgICRzdmcgPSAkc3ZnLnJlbW92ZUF0dHIoJ3htbG5zOmEnKTsNCg0KCSAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHZpZXdwb3J0IGlzIHNldCwgaWYgdGhlIHZpZXdwb3J0IGlzIG5vdCBzZXQgdGhlIFNWRyB3b250J3Qgc2NhbGUuDQoJICAgICAgICBpZighJHN2Zy5hdHRyKCd2aWV3Qm94JykgJiYgJHN2Zy5hdHRyKCdoZWlnaHQnKSAmJiAkc3ZnLmF0dHIoJ3dpZHRoJykpIHsNCgkgICAgICAgICAgICAkc3ZnLmF0dHIoJ3ZpZXdCb3gnLCAnMCAwICcgKyAkc3ZnLmF0dHIoJ2hlaWdodCcpICsgJyAnICsgJHN2Zy5hdHRyKCd3aWR0aCcpKQ0KCSAgICAgICAgfQ0KDQoJICAgICAgICAvLyBSZXBsYWNlIGltYWdlIHdpdGggbmV3IFNWRw0KCSAgICAgICAgJGltZy5yZXBsYWNlV2l0aCgkc3ZnKTsNCg0KCSAgICB9LCAneG1sJyk7DQoNCgl9KTsNCn0NCg0KZnVuY3Rpb24gaGFuZGxlTW9kYWxUcmlnZ2VyRm9jdXMoKXsNCgkkKCcubW9kYWwnKS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKCkgew0KCSAgIHZhciB0cmlnZ2VyaW5nRWwgPSAkKHRoaXMpLmF0dHIoJ2lkJyk7DQoJICAgaWYoJCgnW2RhdGEtdGFyZ2V0PSIjJyt0cmlnZ2VyaW5nRWwrJyJdJykubGVuZ3RoID4gMCApew0KCSAgIAkJJCgnW2RhdGEtdGFyZ2V0PSIjJyt0cmlnZ2VyaW5nRWwrJyJdJykuZm9jdXMoKTsNCgkgICB9DQoJfSk7DQp9DQoNCi8qKg0KICogVGhpcyBtZXRob2Qgd2lsbCByZXR1cm4gdHJ1ZSBpZiB1c2VyIGlzDQogKiBvbiBhIG1vYmlsZSBPUw0KICoNCiAqIEByZXR1cm5zIG1vYmlsZURldmljZSAtIHRydWUgZm9yIG1vYmlsZSBPUw0KICovDQpmdW5jdGlvbiBpc01vYmlsZU9TKCl7DQoNCgl2YXIgbW9iaWxlRGV2aWNlID0gZmFsc2U7DQoJICB2YXIgdWEgPSBuYXZpZ2F0b3IudXNlckFnZW50Ow0KCSAgdmFyIGlzV2luZG93cyA9IHVhLmluZGV4T2YoIldpbmRvd3MgTlQiKSA+IC0xOw0KDQoJICBpZiAoIWlzV2luZG93cykgew0KCSAgICB2YXIgaXNNYWNPUyA9IHVhLmluZGV4T2YoIk1hYyIpID4gLTE7DQoJICAgIHZhciBpc2lQYWQgPSB1YS5pbmRleE9mKCJpUGFkIikgPiAtMTsNCgkgICAgdmFyIGlzaVBob25lID0gdWEuaW5kZXhPZigiaVBob25lIikgPiAtMTsNCgkgICAgdmFyIGlzQW5kcm9pZCA9IHVhLmluZGV4T2YoIkFuZHJvaWQiKT4tMTsNCgkgICAgaWYgKGlzTWFjT1MpIHsNCgkgICAgICBpZiAoaXNpUGFkIHx8IGlzaVBob25lKSB7DQoJICAgICAgICBtb2JpbGVEZXZpY2UgPSB0cnVlOw0KCSAgICAgIH0NCgkgICAgfSBlbHNlIGlmKGlzQW5kcm9pZCl7DQoJICAgICAgbW9iaWxlRGV2aWNlID0gdHJ1ZTsNCgkgICAgfSBlbHNlIHsNCgkgICAgICBtb2JpbGVEZXZpY2UgPSBmYWxzZTsNCgkgICAgfQ0KCSAgfSBlbHNlIHsNCgkgICAgbW9iaWxlRGV2aWNlID0gZmFsc2U7DQoJICB9DQoNCgkgIHJldHVybiBtb2JpbGVEZXZpY2U7DQp9DQoNCi8vRnVuY3Rpb24gdG8gY29udmVydCBsYyBmb3IgcmVxdWlyZWQgbG9jYWxlcw0KZnVuY3Rpb24gbG9jYWxlQ29udmVyc2lvbihjYywgbGMpew0KCWlmIChjYyA9PSAiYmciICYmIGxjID09ICJiZyIpew0KCQlsYyA9ICJlbiI7DQoJCXJldHVybiBsYzsNCgl9DQoJZWxzZSBpZiAoY2MgPT0gImVlIiAmJiBsYyA9PSAiZXQiKXsNCgkJbGMgPSAiZW4iOw0KCQlyZXR1cm4gbGM7DQoJfQ0KCWVsc2UgaWYgKGNjID09ICJsdCIgJiYgbGMgPT0gImx0Iil7DQoJCWxjID0gImx0IjsNCgkJcmV0dXJuIGxjOw0KCX0NCgllbHNlIGlmIChjYyA9PSAibHYiICYmIGxjID09ICJsdiIpew0KCQlsYyA9ICJsdiI7DQoJCXJldHVybiBsYzsNCgl9DQoJZWxzZSBpZiAoY2MgPT0gInJvIiAmJiBsYyA9PSAicm8iKXsNCgkJbGMgPSAiZW4iOw0KCQlyZXR1cm4gbGM7DQoJfQ0KCWVsc2UgaWYgKGNjID09ICJycyIgJiYgbGMgPT0gInJzIil7DQoJCWxjID0gImVuIjsNCgkJcmV0dXJuIGxjOw0KCX0NCgllbHNlIGlmIChjYyA9PSAic2kiICYmIGxjID09ICJzbCIpew0KCQlsYyA9ICJlbiI7DQoJCXJldHVybiBsYzsNCgl9DQoJZWxzZSBpZiAoY2MgPT0gInNrIiAmJiBsYyA9PSAic2siKXsNCgkJbGMgPSAiZW4iOw0KCQlyZXR1cm4gbGM7DQoJfQ0KCWVsc2UgaWYgKGNjID09ICJjbiIgJiYgbGMgPT0gInpoIil7DQoJCWxjID0gInpoLWhhbnMiOw0KCQlyZXR1cm4gbGM7DQoJfQ0KCWVsc2UgaWYgKGNjID09ICJoayIgJiYgbGMgPT0gInpoIil7DQoJCWxjID0gInpoLWhhbnQiOw0KCQlyZXR1cm4gbGM7DQoJfQ0KCWVsc2UgaWYgKGNjID09ICJ0dyIgJiYgbGMgPT0gInpoIil7DQoJCWxjID0gInpoLWhhbnQiOw0KCQlyZXR1cm4gbGM7DQoJfQ0KCWVsc2V7DQoJCXJldHVybiBsYzsNCgl9DQoNCn0NCg0KLy82OTg3OiBTZXQgc2Vzc2lvbiBzdG9yYWdlIGZvciBzZWFyY2ggcmVkaXJlY3Rpb24NCmZ1bmN0aW9uIHNldFNlc3Npb25TdG9yYWdlRm9yU2VhcmNoKHF1ZXJ5KXsNCglzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdTZWFyY2hRdWVyeScscXVlcnkpOw0KfQ0KLyogNjg5NzogR2V0IHNlc3Npb25TdG9yYWdlLlNlYXJjaFF1ZXJ5IA0KU2Vzc2lvbiBzdG9yYWdlIFNlYXJjaCBxdWVyeSB3aWxsIGJlIHByZXNlbnQgb25seSBmb3IgcmVkaXJlY3QqLw0KZnVuY3Rpb24gZ2V0U2Vzc2lvblN0b3JhZ2VGb3JTZWFyY2goKXsNCgl2YXIgcXVlcnkgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCJTZWFyY2hRdWVyeSIpOw0KCXZhciBwYWdlSWRlbnRpZmllciA9ICQoIiNwYWdlSWRlbnRpZmllciIpLnZhbCgpOw0KCWlmIChwYWdlSWRlbnRpZmllciAhPSAiU2VhcmNoUmVzdWx0Iil7DQoJCWlmKHF1ZXJ5ICE9ICIiICYmIHF1ZXJ5ICE9IG51bGwgJiYgcXVlcnkgIT0gdW5kZWZpbmVkKXsNCgkJCWdsb2JhbERhdGFMYXllci5TZWFyY2guc2V0VmFsdWUoJ1F1ZXJ5JywgcXVlcnkpOw0KCQkJZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5zZXRWYWx1ZSgnUmVkaXJlY3QnLCB0cnVlKTsNCgkJCXNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ1NlYXJjaFF1ZXJ5Jyk7DQoJCX0NCgkJZWxzZXsNCgkJCWdsb2JhbERhdGFMYXllci5TZWFyY2guc2V0VmFsdWUoJ1F1ZXJ5JywnJyk7DQoJCQlnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLnNldFZhbHVlKCdSZWRpcmVjdCcsIGZhbHNlKTsNCgkJfQ0KCX0NCn0NCg0KLyoqDQogKiBUaGlzIGZ1bmN0aW9uIHdpbGwgc2F2ZSB0aGUgc2VyaWFsIG51bWJlciBpbiBsb2NhbA0KICogc2Vzc2lvbiBhbmQgdGhpcyB3aWxsIGFsc28gcmV0dXJuIHRoZSBwb3NpdGlvbg0KICogb2YgdGhlIHNlcmlhbCBudW1iZXIgaW4gY2FzZSBzYW1lIG1vZGVsIG51bWJlcg0KICogaGFzIG11bHRpcGxlIHNlcmlhbCBudW1iZXIgaW4gYSBnaXZlbiBzZXNzaW9uDQogKiANCiAqIEBwYXJhbSBzZXJpYWxOdW1iZXIgLSB0byBiZSBzYXZlZCBpbiBsb2NhbCBzZXNzaW9uDQogKiBAcGFyYW0gbW9kZWxOdW1iZXIgLSB0aGUga2V5IGZvciBsb2NhbCBzZXNzaW9uDQogKiBAcmV0dXJucyBzZXF1ZW5jZSAtIHRoZSBwb3NpdGlvbiBvZiBTTg0KICogDQogKiBAYXV0aG9yIGFya2FzaW5oYQ0KICovDQpmdW5jdGlvbiBzYXZlU2VyaWFsTnVtYmVySW5Vc2VyU2Vzc2lvbihtb2RlbE51bWJlciwgc2VyaWFsTnVtYmVyLCBjYWxsYmFjayl7DQoJDQoJLy8gc2tpcCB0aGUgcGFydCBhZnRlciAjIGUuZy4gQ0FHMjNBI0hISg0KCWlmKG1vZGVsTnVtYmVyICYmIG1vZGVsTnVtYmVyLmluZGV4T2YoIiMiKSA+IC0xKXsNCgkJDQoJCW1vZGVsTnVtYmVyID0gbW9kZWxOdW1iZXIuc3BsaXQoIiMiKVswXTsNCgl9DQoJLy8gR2V0IGRhdGEgZnJvbSBzdG9yYWdlDQoJdmFyIGRhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiU04iK21vZGVsTnVtYmVyKTsNCgl2YXIgc2VxdWVuY2UgPSAwOw0KCQ0KCS8qIA0KCSAqIERhdGEgaXMgdW5kZWZpbmVkDQoJICovDQoJaWYoZGF0YSl7DQoJCQ0KCQkvLyBTdHJpbmcgdG8gT2JqZWN0IA0KCQlkYXRhID0gJC5wYXJzZUpTT04oZGF0YSk7DQoJCQ0KCQkvKiANCgkJICogV2UgYWxyZWFkeSBoYXZlIGEgZGlmZmVyZW50IHNlcmlhbCBudW1iZXINCgkJICogZm9yIHRoaXMgbW9kZWwgbnVtYmVyIGluIHNlc3Npb24gDQoJCSAqLw0KCQlpZihkYXRhLnNlcmlhbE51bWJlckxpc3QuaW5kZXhPZihzZXJpYWxOdW1iZXIpID09IC0xICl7DQoJCQ0KCQkJLy8gQWRkIHNlcmlhbCBudW1iZXIgdG8gdGhlIGxpc3QNCgkJCWRhdGEuc2VyaWFsTnVtYmVyTGlzdC5wdXNoKHNlcmlhbE51bWJlcik7DQoJCQlzZXF1ZW5jZSA9IChkYXRhLnNlcmlhbE51bWJlckxpc3QubGVuZ3RoLTEpOw0KCQkNCgkJLyogDQoJCSAqIFNlcmlhbCBudW1iZXIgZXhpc3RzDQoJCSAqLwkNCgkJfWVsc2UgaWYoZGF0YSAmJiBkYXRhLnNlcmlhbE51bWJlckxpc3QuaW5kZXhPZihzZXJpYWxOdW1iZXIpID4gLTEpew0KCQkJDQoJCQlzZXF1ZW5jZSA9IGRhdGEuc2VyaWFsTnVtYmVyTGlzdC5pbmRleE9mKHNlcmlhbE51bWJlcik7IA0KCQl9DQoJLyogDQoJICogRnJlc2ggRW50cnkNCgkgKi8JDQoJfWVsc2V7CQ0KCQkNCgkJZGF0YSA9IHt9Ow0KCQlkYXRhLnNlcmlhbE51bWJlckxpc3QgPSBbXTsNCgkJZGF0YS5zZXJpYWxOdW1iZXJMaXN0LnB1c2goc2VyaWFsTnVtYmVyKTsNCgl9DQoJDQoJLy8gc2F2ZSBuZXcgb3IgbW9kaWZpZWQgZW50cnkNCglsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiU04iK21vZGVsTnVtYmVyLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7DQoJDQoJY2FsbGJhY2soc2VxdWVuY2UpOw0KCQ0KCXJldHVybiBzZXF1ZW5jZTsNCn0NCg0KDQovKioNCiAqIFRoaXMgZnVuY3Rpb24gd2lsbCBwaWNrIHVwIG1vZGVsbnVtYmVyDQogKiBhbmQgc2VxdWVuY2UgZnJvbSBVUkwgYW5kIHJldHVybiANCiAqIHNlcmlhbCBudW1iZXIgZnJvbSB1c2VyIGxvY2FsIHNlc3Npb24NCiAqIA0KICogQHJldHVybnMgc2VyaWFsTnVtYmVyDQogKi8NCmZ1bmN0aW9uIGdldFNlcmlhbE51bWJlckZyb21Vc2VyU2Vzc2lvbihtb2RlbE51bWJlciwgc2VxdWVuY2Upew0KCQ0KCS8vIGlmIG5vdCBwcm92aWRlZCBpbiBwYXJhbSwgcGljayBmcm9tIHF1ZXJ5IHN0cmluZw0KCWlmKCFtb2RlbE51bWJlcil7DQoJCQ0KCQkvLyBtb2RlbCBudW1iZXIgZnJvbSBVUkwNCgkJbW9kZWxOdW1iZXIgPSBnZXRRdWVyeVBhcmFtZXRlcigic2t1Iik7DQoJCQ0KCQkvLyBzZXF1ZW5jZSwgaWYgYXZhaWxhYmxlLCBmcm9tIFVSTA0KCQlzZXF1ZW5jZSA9IGdldFF1ZXJ5UGFyYW1ldGVyKCJzZXEiKTsNCgl9CQkNCgkNCgkvLyBkZWZhdWx0IHNlcSBpcyAwDQoJaWYoIXNlcXVlbmNlKXsNCgkNCgkJc2VxdWVuY2UgPSAwOw0KCX0NCgkNCgl2YXIgZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJTTiIrbW9kZWxOdW1iZXIpOw0KCQ0KCWlmKGRhdGEgJiYgc2VxdWVuY2UgPiAtMSl7DQoJCQ0KCQkvLyBzdHJpbmcgdG8gb2JqZWN0DQoJCWRhdGEgPSAkLnBhcnNlSlNPTihkYXRhKTsNCgkJDQoJCXJldHVybiBkYXRhLnNlcmlhbE51bWJlckxpc3Rbc2VxdWVuY2VdOw0KCX0NCn0NCg0KLyoqDQogKiBAcGFyYW0ga2V5DQogKiBAcmV0dXJucyBxdWVyeXBhcmFtDQogKi8NCmZ1bmN0aW9uIGdldFF1ZXJ5UGFyYW1ldGVyKGtleSkgew0KCQ0KICAgIGtleSA9IGtleS5yZXBsYWNlKC9bKis/XiQuXFtcXXt9KCl8XFxcL10vZywgIlxcJCYiKTsgLy8gZXNjYXBlIFJlZ0V4IG1ldGEgY2hhcnMNCiAgICB2YXIgbWF0Y2ggPSBsb2NhdGlvbi5zZWFyY2gubWF0Y2gobmV3IFJlZ0V4cCgiWz8mXSIra2V5KyI9KFteJl0rKSgmfCQpIikpOw0KICAgIHJldHVybiBtYXRjaCAmJiBkZWNvZGVVUklDb21wb25lbnQobWF0Y2hbMV0ucmVwbGFjZSgvXCsvZywgIiAiKSk7DQp9DQoNCg0KZnVuY3Rpb24gYnJvd3NlckNoZWNrKCkgew0KCXZhciB1YSA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50Ow0KICAgIHZhciBtc2llID0gdWEuaW5kZXhPZigiTVNJRSAiKTsNCgkJdmFyIG1zaWVFZGdlID0gdWEuaW5kZXhPZigiRWRnZSIpOw0KDQoJCS8vIGZvciBJRQ0KCQlpZiAobXNpZSA+IDAgfHwgISFuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9UcmlkZW50Lipydlw6MTFcLi8pKSB7DQoJCQlyZXR1cm4gImllIjsNCgkJfSBlbHNlIGlmKG1zaWVFZGdlPi0xKSB7DQoJCQkvLyBmb3IgZWdkZQ0KCQkJcmV0dXJuICJlZGdlIjsNCgkJfWVsc2Ugew0KCQkJcmV0dXJuICJvdGhlciI7DQoJCX0NCn0NCg0KLyoqDQogKiBDcmVhdGUgSHViIE5hdmlnYXRpb24gVVJMIGFuZA0KICogdXBkYXRlIGNvbnRhY3Qgc3VwcG9ydCBsaW5rDQogKi8NCmZ1bmN0aW9uIHVwZGF0ZUNvbnRhY3RTdXBwb3J0VVJMKGh1Yk5hdmlnYXRpb25VUkwsIHByb2R1Y3RJZCl7DQoJDQoJdmFyIGNjID0gZ2V0Q0NMQygiY2MiKTsNCgl2YXIgbGMgPSBnZXRDQ0xDKCJsYyIpOw0KCQ0KCXZhciBjb250YWN0VXJsID0gaHViTmF2aWdhdGlvblVSTCArICAiP2hfcHJvZHVjdD0iICsgcHJvZHVjdElkICsgIiZoX2NjPSIgKyBjYyArIiZoX2xhbmc9IiArIGxjICsgIiZoX3BhZ2V0eXBlPXMtMDE3IjsNCgkNCgkkKCIjc2VjLW5hdi1jb250YWN0LXN1cHBvcnQiKS5hdHRyKCJocmVmIiwgY29udGFjdFVybCk7DQp9Cn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ey8qLS0tLS0tLS0tLS0tLS0tLS0tDQoNCglDdXN0b20gRHJvcGRvd24gV2lkZ2V0IGJ5IEhpbWFuc2h1IEhpcmFuYW5kYW5pDQoJT3JpZ2luYWwgQ29kZSByZXZhbXBlZCBvbiA5LzExLzE0DQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQovKi0tLS0tLS0tLS0tLS0tLS0tLS0tDQoJRnVuY3Rpb25hbGl0eSBvdmVydmlldzoNCg0KCUhUTUwgcmVxdWlyZWQ6IA0KDQoJPHNlbGVjdCBpZD0iY3VzdG9tRHJvcGRvd25JRCIgY2xhc3M9ImhwU3R5bGVEcm9wZG93biI+DQoJCTxvcHRpb24gdmFsdWU9InZhbDEiPiBWYWx1ZSAxPC9vcHRpb24+DQoJCTxvcHRpb24gdmFsdWU9InZhbDIiPiBWYWx1ZSAyPC9vcHRpb24+DQoJPC9zZWxlY3Q+DQoNCglvdXRwdXQ6DQoNCgk8ZGl2IGlkPSJjdXN0b21Ecm9wZG93bklEX2RkIiBjbGFzcz0iY3VzdG9tRHJvcGRvd25Cb3giPg0KCQk8ZGl2IGlkPSJjdXN0b21Ecm9wZG93bklEX2RkX2hlYWRlckJveCIgY2xhc3M9InRyaWdnZXIiPg0KCQkJPGEgaHJlZj0iamF2YXNjcmlwdDo7IiBpZD0iY3VzdG9tRHJvcGRvd25JRF9kZF9oZWFkZXJMaW5rIiAvPiANCgkJCQk8c3BhbiBpZD0iY3VzdG9tRHJvcGRvd25JRF9kZF9oZWFkZXJWYWx1ZSI+PC9zcGFuPg0KCQkJCTxzcGFuIGlkPSJjdXN0b21Ecm9wZG93bklEX2RkX2hlYWRlckFycm93Ij48L3NwYW4+DQoJCQk8L2E+DQoJCTwvZGl2Pg0KCQk8dWw+DQoJCQk8bGk+IFZhbHVlIDENCgkJCTxzcGFuIGNsYXNzPSJoaWRlIHZhbHVlIj52YWwxPC9zcGFuPg0KCQkJPC9saT4NCgkJDQoJCQ0KCQkJPGxpPiBWYWx1ZSAyDQoJCQk8c3BhbiBjbGFzcz0iaGlkZSB2YWx1ZSI+dmFsMjwvc3Bhbj4NCgkJCTwvbGk+DQoJCQkuDQoJCQkuDQoJCQkuDQoJCQkuDQoNCgkJCTxsaT4NCg0KCQkJPC9saT4NCgkJPC91bD4NCg0KDQoJPC9kaXY+DQoNCi0tLS0tLS0tLS0tLS0tKi8NCg0KCS8vY29udmVydCBldmVyeSBzZWxlY3QgZWxlbWVudCB3aXRoIGNsYXNzIGFzIGhwU3R5bGVEcm9wZG93biB0byBhIGN1c3RvbSBsb29rDQovKg0KCVN0ZXBzIHRvIGZvbGxvdw0KCTEuIENoZWNrIGlmIHRoZSBlbGVtZW50IGhhcyBiZWVuIGN1c3RvbWl6ZWQgYWxyZWFkeSAgLS0+IGNoZWNrRm9yQ3VzdG9tRHJvcGRvd24oKQ0KCTIuIEhpZGUgdGhlIHNlbGVjdCB0YWcgYmFzZWQgb24gSUQgLS0+IGhpZGVTZWxlY3RCeUlkKCkNCgkzLiBjcmVhdGUgQ3VzdG9tRHJvcGRvd24gU3RydWN0dXJlIC0tPiBjcmVhdGVDdXN0b21Ecm9wZG93blN0cnVjdHVyZSgpDQoJNC4gUG9wdWxhdGUgSGVhZGVyIGJveA0KCTUuIFBvcHVsYXRlIExpc3QNCgkJRm9yIGVhY2ggbGlzdCBpdGVtDQoJCTUuMSBBcHBlbmQgVmFsdWUNCgkJNS4yIEFwcGVuZCBjdXN0b20gYXR0cmlidXRlcyBhcyBzcGFucw0KCTYuIEFkZCBjbGljayBoYW5kbGVyIGZvciBsaXN0IGl0ZW1zDQoJNy4gQWRkIHR5cGVhaGVhZCBzZWFyY2ggbGlzdGVuZXINCgkJNy4xIGFkZCA1MDBtcyBsaXN0ZW5lciBmb3IgdHlwZWFoZWFkDQoJCTcuMiBvbiBjaGFuZ2luZyB0aGUgZWxlbWVudCBjaGFuZ2UgaGVhZGVyIHZhbHVlKi8NCg0KDQpnZXRIcFN0eWxlRHJvcGRvd24gID0gZnVuY3Rpb24oKXsNCgkvL3RoaXMgd2lsbCBhY3QgYXMgdGhlIGluaXQgZnVuY3Rpb24NCgkNCgkkKCdzZWxlY3QuaHBTdHlsZURyb3Bkb3duJykuZWFjaChmdW5jdGlvbigpew0KDQoJCS8vZ2V0IHNsZWN0IHRhZyBpZA0KCQl2YXIgYWN0dWFsRWxJZCAgPSAkKHRoaXMpLmF0dHIoJ2lkJyk7DQoNCgkJDQoNCgkJaWYoY2hlY2tGb3JDdXN0b21Ecm9wZG93bihhY3R1YWxFbElkKSl7DQoJCQkJaGlkZVNlbGVjdEJ5SWQoYWN0dWFsRWxJZCk7DQoJCQkJY3JlYXRlQ3VzdG9tRHJvcGRvd25TdHJ1Y3R1cmUoYWN0dWFsRWxJZCk7DQoJCQkJYXR0YWNoQ2xpY2tIYW5kbGVyKGFjdHVhbEVsSWQpOw0KCQkJCWF0dGFjaEtleWJvYXJkTGlzdGVuZXJzKGFjdHVhbEVsSWQpOw0KCQkJCWF0dGFjaENoYW5nZUxpc3RlbmVyKGFjdHVhbEVsSWQpOw0KCQl9DQoNCg0KDQp9KTsNCg0KDQoNCg0KDQoNCn0NCg0KDQoNCmNoZWNrRm9yQ3VzdG9tRHJvcGRvd24gPSBmdW5jdGlvbihlbElkKXsNCgkvLyBlbElkID0gSWQgb2YgdGhlIHNlbGVjdCB0YWcNCgkvL2NoZWNrIGlmIGVsZW1lbnQgd2l0aCBpZCA9IDxlbElkPl9kZCBleGlzdHMNCglpZigkKCcjJytlbElkKydfZGQnKS5sZW5ndGg8MSl7DQoJCS8vZWxlbWVudCBkb2VzbnQgZXhpc3QsIHJldHVybiB0cnVlIHRvIGNyZWF0ZSBlbGVtZW50DQoJCXJldHVybiB0cnVlOw0KCX0NCgllbHNlew0KCQkvL2VsZW1lbnQgZXhpc3RzLCByZXR1cm4gZmFsc2UgdG8gbm90IHJlY3JlYXRlIGVsZW1lbnQNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCg0KfTsNCg0KaGlkZVNlbGVjdEJ5SWQgPSBmdW5jdGlvbihlbElkKXsNCg0KCWlmKCEgJCgnIycrZWxJZCkuaGFzQ2xhc3MoJ2hpZGUnKSl7DQoJCSQoJyMnK2VsSWQpLmFkZENsYXNzKCdoaWRlJykNCgl9DQoNCn07DQoNCg0KDQoNCg0KY3JlYXRlQ3VzdG9tRHJvcGRvd25TdHJ1Y3R1cmUgPSBmdW5jdGlvbihhY3R1YWxFbElkKXsNCg0KCXZhciBEcm9wZG93bkNvbnRhaW5lcklkID0gYWN0dWFsRWxJZCsnX2RkJzsNCgl2YXIgRHJvcGRvd25Db250YWluZXIgPSAkKCc8ZGl2IGlkPSInKyBEcm9wZG93bkNvbnRhaW5lcklkICsnIiBjbGFzcz0iZHJvcGRvd24gZHJvcGRvd25Db250YWluZXIgaHBTdHlsZURyb3Bkb3duIj48L2Rpdj4nKTsNCg0KCXZhciBEcm9wZG93blRyaWdnZXJBbmNob3JJZCA9IGFjdHVhbEVsSWQrJ19kZF9oZWFkZXJMaW5rJzsNCgl2YXIgRHJvcGRvd25UYWJJbmRleCA9ICQoJyMnK2FjdHVhbEVsSWQpLmF0dHIoJ3RhYmluZGV4Jyk7DQoJdmFyIGFyaWFMYWJlbCA9JCgnIycrYWN0dWFsRWxJZCkuYXR0cignYXJpYS1sYWJlbGxlZGJ5Jyk7IA0KCXZhciBEcm9wZG93blRyaWdnZXJWYWx1ZUlkID0gYWN0dWFsRWxJZCsnX2RkX2hlYWRlclZhbHVlJzsNCglpZihhcmlhTGFiZWw9PW51bGwgfHwgYXJpYUxhYmVsPT11bmRlZmluZWQpew0KCQlhcmlhTGFiZWwgPSBEcm9wZG93blRyaWdnZXJWYWx1ZUlkOw0KCX0NCgllbHNlew0KCQlhcmlhTGFiZWwgPSBhcmlhTGFiZWwgKyAiICIrIERyb3Bkb3duVHJpZ2dlclZhbHVlSWQ7DQoJfQ0KCWlmKHR5cGVvZiBEcm9wZG93blRhYkluZGV4ID09ICJ1bmRlZmluZWQiIHx8IERyb3Bkb3duVGFiSW5kZXggPT0gIiIgKXsNCgkJdmFyIERyb3Bkb3duVHJpZ2dlckFuY2hvciA9ICQoJzxhIGlkPSInKyBEcm9wZG93blRyaWdnZXJBbmNob3JJZCArJyIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIiBocmVmPSJqYXZhc2NyaXB0OjsiIGNsYXNzPSJkcm9wZG93bkhlYWRlckxpbmsiIGFyaWEtZXhwYW5kZWQ9ImZhbHNlIiBhcmlhLWRlc2NyaWJlZGJ5PSInKyBhcmlhTGFiZWwgKyciPjwvYT4nKTsNCgl9DQoJZWxzZXsNCgkJdmFyIERyb3Bkb3duVHJpZ2dlckFuY2hvciA9ICQoJzxhIGlkPSInKyBEcm9wZG93blRyaWdnZXJBbmNob3JJZCArJyIgdGFiaW5kZXg9IicrRHJvcGRvd25UYWJJbmRleCsnIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iIGhyZWY9ImphdmFzY3JpcHQ6OyIgY2xhc3M9ImRyb3Bkb3duSGVhZGVyTGluayIgYXJpYS1leHBhbmRlZD0iZmFsc2UiIGFyaWEtZGVzY3JpYmVkYnk9IicrIGFyaWFMYWJlbCArJyI+PC9hPicpOw0KCX0NCgkNCg0KDQoJDQoJdmFyIERyb3Bkb3duVHJpZ2dlclZhbHVlID0gJCgnPHNwYW4gaWQ9IicrIERyb3Bkb3duVHJpZ2dlclZhbHVlSWQgKyciIGNsYXNzPSJkcm9wZG93bkhlYWRlclZhbHVlIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9zcGFuPicpOw0KDQoNCgkkKERyb3Bkb3duVHJpZ2dlckFuY2hvcikuYXBwZW5kKERyb3Bkb3duVHJpZ2dlclZhbHVlKTsNCgkNCgkkKERyb3Bkb3duQ29udGFpbmVyKS5hcHBlbmQoRHJvcGRvd25UcmlnZ2VyQW5jaG9yKTsNCg0KDQoJdmFyIERyb3Bkb3duTGlzdElkID0gYWN0dWFsRWxJZCsnX2RkX2xpc3QnOw0KCXZhciBEcm9wZG93bkxpc3QgPSAkKCc8dWwgaWQ9IicrIERyb3Bkb3duTGlzdElkICsnIiByb2xlPSJtZW51IiBjbGFzcz0iZHJvcGRvd24tbWVudSIgY2xhc3M9ImRyb3Bkb3duTGlzdCI+PC91bD4nKTsNCg0KCSQoRHJvcGRvd25Db250YWluZXIpLmFwcGVuZChEcm9wZG93bkxpc3QpOwkNCg0KCS8vaW5zZXJ0IHRoZSBjdXN0b20gY29udGFpbmVyIGFmdGVyIHRoZSBzZWxlY3QgdGFnDQoJRHJvcGRvd25Db250YWluZXIuaW5zZXJ0QWZ0ZXIoJCgnIycrYWN0dWFsRWxJZCkpOw0KDQoJLy9wb3B1bGF0ZSB0aGUgbGlzdCBpdGVtcw0KCXBvcHVsYXRlRHJvcGRvd25MaXN0KGFjdHVhbEVsSWQsIERyb3Bkb3duTGlzdElkKTsNCg0KCS8vUG9wdWxhdGUgdGhlIERyb3Bkb3duIEhlYWRlciBWYWx1ZQ0KCXZhbHVlUmVxID0gJCgnIycrYWN0dWFsRWxJZCkuYXR0cigndmFsdWVyZXEnKQ0KCWlmKHZhbHVlUmVxIT1udWxsICYmIHZhbHVlUmVxIT0iIiApew0KCQl2YXIgdmFsT2J0YWluZWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUodmFsdWVSZXEpP2dldFBhcmFtZXRlckJ5TmFtZSh2YWx1ZVJlcSk6Z2V0Q0NMQyh2YWx1ZVJlcSk7DQoJCWlmKHZhbE9idGFpbmVkICE9IG51bGwgJiYgdmFsT2J0YWluZWQgIT0gJycpew0KCQkJdmFsT2J0YWluZWQgPSB2YWxPYnRhaW5lZC50b0xvd2VyQ2FzZSgpOw0KCQkJLypjaGVjayBpZiBsYW5ndWFnZSBkcm9wZG93biBhbmQgY3VzdG9taXplIGZvciBjbi16aCBoay16aCBvciB0dy16aCAqLw0KCQkJaWYoJCh0aGlzKS5hdHRyKCd2YWx1ZXJlcScpPT0ibGMiKQ0KCQkJewkNCgkJCQlpZiggZ2V0Q0NMQygiY2MiKSA9PSAiY24iICAmJiB2YWxPYnRhaW5lZCA9PSAiemgiKXsNCgkJCQkJdmFsT2J0YWluZWQgPSAiemgtaGFucyI7CSAgLy8gZm9yIGNoaW5hIHJldHVybiBjaGluZXNlIHNpbXBsaWZpZWQNCgkJCQl9DQoJCQkJZWxzZSBpZigoZ2V0Q0NMQygiY2MiKSA9PSAidHciIHx8IGdldENDTEMoImNjIikgPT0gImhrIikgJiYgdmFsT2J0YWluZWQgPT0gInpoIil7DQoJCQkJCXZhbE9idGFpbmVkID0gInpoLWhhbnQiOwkgLy8gZm9yIHRhaXdhbiBhbmQgaG9uZ2tvbmcgcmV0dXJuIGNoaW5lc2UgdHJhZGl0aW9uYWwNCgkJCQl9DQoJCQl9DQoJCX0NCgkJcG9wdWxhdGVEcm9wZG93bkhlYWRlcihhY3R1YWxFbElkLCB2YWxPYnRhaW5lZCkNCgl9DQoJZWxzZQ0KCQlwb3B1bGF0ZURyb3Bkb3duSGVhZGVyKGFjdHVhbEVsSWQsICIiKQ0KDQoNCg0KDQoNCn07DQoNCnBvcHVsYXRlRHJvcGRvd25IZWFkZXIgPSBmdW5jdGlvbihlbElkLCB2YWwpew0KDQoNCg0KCS8vc2V0IHRoZSBkcm9wZG93biBIZWFkZXIgVmFsdWUgdG8gdGhlIGZpcnN0IGVsZW0NCgkJdmFyIGZpcnN0VmFsID0gJCgkKCcjJytlbElkKS5jaGlsZHJlbignb3B0aW9uJylbMF0pLmh0bWwoKTsNCgkJJCgnIycrZWxJZCsnX2RkX2hlYWRlclZhbHVlJykuZW1wdHkoKS5hcHBlbmQoZmlyc3RWYWwpOw0KCQkkKCcjJytlbElkKydfZGRfaGVhZGVyVmFsdWUnKS5hZGRDbGFzcygnZGVmYXVsdCcpOw0KCQkvL3NldCB0aGUgaGlkZGVuIGRyb3Bkb3duIHZhbHVlDQoJCSQoJyMnK2VsSWQpLnZhbCgwKQ0KDQoNCgkNCg0KCWlmKHZhbCE9IiIgKXsNCgkJCXZhciBlbGVtID0gIiI7DQoJCSAkKCcjJytlbElkKydfZGRfbGlzdCBsaS5lbGVtIGEgc3Bhbi52YWx1ZScpLmVhY2goZnVuY3Rpb24oKXsNCgkJCQlpZigkKHRoaXMpLmh0bWwoKT09dmFsKXsNCgkJCQkJCS8vc2V0IHRoZSBkcm9wZG93biBIZWFkZXIgVmFsdWUgdG8gdGhlIGZvdW5kIGVsZW0NCgkJCQkJCSBlbGVtID0gJCh0aGlzKS5wYXJlbnRzKCdhJykuaHRtbCgpDQoJCQkJCQkgJCgnIycrZWxJZCsnX2RkX2hlYWRlclZhbHVlJykuZW1wdHkoKS5hcHBlbmQoZWxlbSk7DQoJCQkJCQkgLy9zZXQgdGhlIGhpZGRlbiBkcm9wZG93biB2YWx1ZQ0KCQkJCQkJICQoJyMnK2VsSWQpLnZhbCh2YWwpOw0KCQkJCX0gDQoNCgkJIH0pDQoNCg0KCQkNCgkJDQoJfQ0KDQoNCg0KfTsNCg0KcG9wdWxhdGVEcm9wZG93bkxpc3QgPSBmdW5jdGlvbihlbElkLCBsaXN0SWQpew0KDQoJJCgnIycrZWxJZCkuY2hpbGRyZW4oJ29wdGlvbicpLmVhY2goZnVuY3Rpb24oKXsNCg0KCQl2YXIgbGlzdEl0ZW0gPSAkKCc8bGkgY2xhc3M9ImVsZW0iIHJvbGU9Im1lbnVpdGVtIj48L2xpPicpOw0KCQl2YXIgbGlzdEl0ZW1BbmNob3IgPSAkKCc8YSBocmVmPSJqYXZhc2NyaXB0OjsiID48L2E+Jyk7DQoNCgkJdmFyIHNwYW5WYWx1ZSA9ICQoJzxzcGFuIGNsYXNzPSJoaWRlIHZhbHVlIj48L3NwYW4+Jyk7DQoJCXZhciBzcGFuSW1nVXJsID0gJCgnPHNwYW4gY2xhc3M9ImhpZGUgaW1ndXJsIj48L3NwYW4+Jyk7DQoJCXZhciBzcGFuU2VvTGFiZWwgPSAkKCc8c3BhbiBjbGFzcz0iaGlkZSBzZW9MYWJlbCI+PC9zcGFuPicpOw0KCQl2YXIgc3BhblJlZGlyZWN0VXJsID0gJCgnPHNwYW4gY2xhc3M9ImhpZGUgcmVkaXJlY3RVcmwiPjwvc3Bhbj4nKTsNCgkJdmFyIHNwYW5DbGF6elR5cGUgPSAkKCc8c3BhbiBjbGFzcz0iaGlkZSBjbGF6elR5cGUiPjwvc3Bhbj4nKTsNCg0KDQoJCXZhciBsaXN0RGF0YSA9ICQodGhpcykuaHRtbCgpOw0KCQl2YXIgZGF0YVZhbHVlID0gJCh0aGlzKS5hdHRyKCd2YWx1ZScpOw0KDQoNCgkJJChsaXN0SXRlbUFuY2hvcikuYXBwZW5kKGxpc3REYXRhKTsNCg0KDQoJCQkkKHNwYW5WYWx1ZSkuYXBwZW5kKCQodGhpcykuYXR0cigidmFsdWUiKSk7DQoJCQlsaXN0SXRlbUFuY2hvci5hcHBlbmQoc3BhblZhbHVlKTsNCg0KCQlpZigkKHRoaXMpLmF0dHIoImltYWdldXJsIikpew0KCQkJJChzcGFuSW1nVXJsKS5hcHBlbmQoJCh0aGlzKS5hdHRyKCJpbWFnZXVybCIpKTsNCgkJCWxpc3RJdGVtQW5jaG9yLmFwcGVuZChzcGFuSW1nVXJsKTsNCgkJfQ0KCQkNCgkJaWYoJCh0aGlzKS5hdHRyKCJzZW8tbGFiZWwiKSl7DQoJCQkJCQ0KCQkJJChzcGFuU2VvTGFiZWwpLmFwcGVuZCgkKHRoaXMpLmF0dHIoInNlby1sYWJlbCIpKTsNCgkJCWxpc3RJdGVtQW5jaG9yLmFwcGVuZChzcGFuU2VvTGFiZWwpOw0KDQoJCQl9DQoJCQ0KCQlpZigkKHRoaXMpLmF0dHIoInJlZGlyZWN0VXJsIikpew0KCQkJDQoJCQkkKHNwYW5SZWRpcmVjdFVybCkuYXBwZW5kKCQodGhpcykuYXR0cigicmVkaXJlY3RVcmwiKSk7DQoJCQlsaXN0SXRlbUFuY2hvci5hcHBlbmQoc3BhblJlZGlyZWN0VXJsKTsNCgkJCQ0KCQkJfQ0KCQkNCgkJaWYoJCh0aGlzKS5hdHRyKCJjbGF6elR5cGUiKSl7DQoJCQkkKHNwYW5DbGF6elR5cGUpLmFwcGVuZCgkKHRoaXMpLmF0dHIoImNsYXp6VHlwZSIpKTsNCgkJCWxpc3RJdGVtQW5jaG9yLmFwcGVuZChzcGFuQ2xhenpUeXBlKTsNCgkJCX0NCg0KDQoJCSQobGlzdEl0ZW0pLmFwcGVuZChsaXN0SXRlbUFuY2hvcik7DQoJCSQoJyMnK2xpc3RJZCkuYXBwZW5kKGxpc3RJdGVtKTsNCg0KCX0pOw0KCQ0KDQp9Ow0KDQphdHRhY2hDbGlja0hhbmRsZXIgPSBmdW5jdGlvbihlbElkKXsNCg0KCSQoJyMnK2VsSWQrJ19kZF9saXN0IGxpJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXsNCg0KCQkvL3NldCB2YWx1ZSBpbiB0aGUgaGlkZGVuIHNlbGVjdCB0YWcNCgkJLy9wb3B1bGF0ZSBoZWFkZXIgdmFsdWUNCgkJc2VsVmFsdWUgPSAkKHRoaXMpLmNoaWxkcmVuKCdhJykuY2hpbGRyZW4oJ3NwYW4udmFsdWUnKS5odG1sKCk7DQoJCSQoJyMnK2VsSWQpLnZhbChzZWxWYWx1ZSk7DQoNCgkJcG9wdWxhdGVEcm9wZG93bkhlYWRlcihlbElkLCBzZWxWYWx1ZSk7DQoJCSQoJyMnK2VsSWQpLnRyaWdnZXIoJ2NoYW5nZScpOw0KDQoJCS8vc2V0IGZvY3VzIHRvIHRoZSBtYWluIGFuY2hvciB0YWcNCgkJJCgnIycrZWxJZCsnX2RkX2hlYWRlckxpbmsnKS5mb2N1cygpDQoNCgl9KTsNCg0KDQoNCg0KfTsNCg0KYXR0YWNoS2V5Ym9hcmRMaXN0ZW5lcnMgPSBmdW5jdGlvbihlbElkKXsNCg0KDQoJCS8va2V5ZG93biBldmV0cyBmb3IgZXNjL2Jja3NwL3RhYg0KCQkJJCgnIycrZWxJZCsnX2RkJykub24oJ2tleWRvd24nLCBmdW5jdGlvbihlKSB7DQoJCQkNCgkJCWlmKGUua2V5Q29kZSA9PSA4IHx8IGUua2V5Q29kZSA9PSA5IHx8IGUua2V5Q29kZSA9PSAyNyApew0KCQkJLy9pZiB0aGUgdXNlciBoaXRzIGJhY2tzcGFjZSwgZXNjLCBvciB0YWIgaXQgc2hvdWxkIGNsb3NlIHRoZSBkcm9wZG93bg0KCQkJCWlmKCQodGhpcykuaGFzQ2xhc3MoJ29wZW4nKSl7DQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7Ly90byBwcmV2ZW50IHBvcHVwcyBmcm9tIGNsb3NpbmcNCgkJCQkkKHRoaXMpLnJlbW92ZUNsYXNzKCdvcGVuJyk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQl9KTsNCg0KDQoJCS8va2V5cHJlc3MgZXZlbnRzIGZvciB0eXBlYWhlYWQNCgkJCSQoJyMnK2VsSWQrJ19kZCcpLm9uKCdrZXlwcmVzcycsIGZ1bmN0aW9uKGUpIHsNCgkJCWlmKGUua2V5Q29kZSAhPSAzNyB8fCBlLmtleUNvZGUgIT0gMzggfHwgZS5rZXlDb2RlICE9IDM5IHx8IGUua2V5Q29kZSAhPSA0MCl7DQoJCQkNCgkJCQlrZXkgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGUuY2hhckNvZGUgIT0gbnVsbCA/IGUuY2hhckNvZGUgOiBlLmtleUNvZGUpOw0KCQkJCWNvbnNvbGUubG9nKGtleSArICItcHJlc3NlZCBLZXkiKQ0KCQkJCWNsZWFyVGltZW91dCh0aW1lT3V0UmVzZXRMZXR0ZXJzKTsNCgkJCQl0aW1lT3V0UmVzZXRMZXR0ZXJzID0gc2V0VGltZW91dChmdW5jdGlvbigpew0KCQkJCQlsZXR0ZXJQcmVzc2VkID0gW107DQoJCQkJfSw1MDApOw0KCQkJCWxldHRlclByZXNzZWQucHVzaChrZXkpOw0KCQkJCWNvbnNvbGUubG9nKGxldHRlclByZXNzZWQpOw0KCQkJCWNvbnNvbGUubG9nKGxldHRlclByZXNzZWQuam9pbignJykpOw0KCQkJCWNvbnNvbGUubG9nKCdiZWZvcmUgLSAnK3R5cGVBaGVhZFRleHQrJywgJyt0eXBlQWhlYWRDb3VudGVyKTsNCgkJCQlpZihnZXRUeXBlZCgpID09IGxldHRlclByZXNzZWQuam9pbignJykpew0KCQkJCQlzZXRUeXBlZChsZXR0ZXJQcmVzc2VkLmpvaW4oJycpKTsNCgkJCQkJc2V0Q291bnRlcihnZXRDb3VudGVyKCkrMSk7DQoJCQkJfQ0KCQkJCWVsc2V7DQoJCQkJCXNldENvdW50ZXIoMSk7DQoJCQkJCXNldFR5cGVkKGxldHRlclByZXNzZWQuam9pbignJykpOw0KCQkJCX0NCgkJCQljb25zb2xlLmxvZygnYWZ0ZXIgLSAnK3R5cGVBaGVhZFRleHQrJywgJyt0eXBlQWhlYWRDb3VudGVyKTsNCgkJCQl0eXBlYWhlYWQobGV0dGVyUHJlc3NlZC5qb2luKCcnKSwgdGhpcyk7DQoJCQkJfQ0KCQkJfSk7CQ0KDQoNCg0KCQkJCS8vVG8gaGFuZGxlIHR5cGVhaGVkIGZvciBtb3JlIHRoYW4gb25jZQ0KCQkJJCgnIycrZWxJZCsnX2RkJykub24oJ2JsdXInLCBmdW5jdGlvbihlKSB7DQoJCQkJc2V0Q291bnRlcigxKTsNCgkJCQlzZXRUeXBlZCgnJyk7DQoJCQl9KTsNCgkJCQ0KCQkJJCgnIycrZWxJZCsnX2RkIHVsID4gbGknKS5vbignbW91c2VvdmVyJywgZnVuY3Rpb24oZSkgew0KCQkJCXNldFR5cGVBaGVhZCh0aGlzKTsNCgkJCX0pOw0KDQoNCn07DQoNCg0KdHlwZWFoZWFkID0gZnVuY3Rpb24od2hhdCwgZWxlbSl7DQoJdmFyIGVscyA9ICQoJyMnKyQoZWxlbSkuYXR0cignaWQnKSsnIC5lbGVtJykuZmlsdGVyKGZ1bmN0aW9uKGluZGV4KSB7DQogIAkJcmV0dXJuICQodGhpcykuY2hpbGRyZW4oJ2EnKS5odG1sKCkudG9Mb3dlckNhc2UoKS5zZWFyY2god2hhdCkgPT0gMDsNCgl9KTsNCgljb25zb2xlLmxvZyh0eXBlQWhlYWRDb3VudGVyKTsNCgl2YXIgaW5kZXggPSAodHlwZUFoZWFkQ291bnRlciAtIDEpICUgZWxzLmxlbmd0aDsNCglpZihlbHMgJiYgZWxzLmxlbmd0aCA+IDAgJiYgZWxzW2luZGV4XSAmJiBlbHNbaW5kZXhdLmNoaWxkTm9kZXNbMF0pew0KCQllbHNbaW5kZXhdLmNoaWxkTm9kZXNbMF0uZm9jdXMoKTsNCgl9DQp9DQoNCnNldFR5cGVBaGVhZCA9IGZ1bmN0aW9uKGVsKXsNCgl2YXIgaG92ZXJlZEVsID0gJChlbCk7DQoJdmFyIGhvdmVyZWRDaGFyID0gaG92ZXJlZEVsLmNoaWxkcmVuKCdhJykuaHRtbCgpLnRvTG93ZXJDYXNlKCkuc3BsaXQoJzwnKVswXVswXTsNCglzZXRUeXBlZChob3ZlcmVkQ2hhcik7DQoJc2V0Q291bnRlcigwKTsNCgkvKiB2YXIgaSA9IDE7ICAgLy9UT0RPOiByZXZpc2l0IGZvciBtb3VzZSBob3ZlciBsb2dpYw0KCXZhciBlbHMgPSBob3ZlcmVkRWwucGFyZW50KCkuY2hpbGRyZW4oJy5lbGVtJykuZmlsdGVyKGZ1bmN0aW9uKGluZGV4KSB7DQogIAkJcmV0dXJuICQodGhpcykuY2hpbGRyZW4oJ2EnKS5odG1sKCkudG9Mb3dlckNhc2UoKS5zZWFyY2goaG92ZXJlZENoYXIpID09IDA7DQoJfSk7DQoJDQoJd2hpbGUoaSA8IGVscy5sZW5ndGgpew0KCQljb25zb2xlLmxvZyhob3ZlcmVkRWwrJyA9PSAnK2Vscyk7DQoJCWlmKGhvdmVyZWRFbCA9PSBlbHNbaS0xXSl7DQoJCQlzZXRDb3VudGVyKGkpOw0KCQkJY29uc29sZS5sb2coaG92ZXJlZENoYXIrJywgJytpKTsNCgkJfQ0KCQlpKz0xOw0KCX0gKi8JDQp9DQoNCnZhciBsZXR0ZXJQcmVzc2VkID0gW107DQp2YXIgdGltZU91dFJlc2V0TGV0dGVycyA9IG51bGw7DQp2YXIgdHlwZUFoZWFkQ291bnRlciA9IDE7DQp2YXIgdHlwZUFoZWFkVGV4dCA9ICcnOw0KDQpmdW5jdGlvbiBzZXRDb3VudGVyKHZhbCkNCnsNCiAgICB0eXBlQWhlYWRDb3VudGVyID0gdmFsOw0KfQ0KDQpmdW5jdGlvbiBnZXRDb3VudGVyKCkNCnsNCiAgICByZXR1cm4gdHlwZUFoZWFkQ291bnRlcjsNCn0NCmZ1bmN0aW9uIHNldFR5cGVkKHZhbCkNCnsNCiAgICB0eXBlQWhlYWRUZXh0ID0gdmFsOw0KfQ0KDQpmdW5jdGlvbiBnZXRUeXBlZCgpDQp7DQogICAgcmV0dXJuIHR5cGVBaGVhZFRleHQ7DQp9DQoNCg0KZ2V0U2VsZWN0ZWREYXRhID0gZnVuY3Rpb24ob3B0LGVsSUQpew0KDQoJdmFyIGVsZW0gPSAkKCcjJytlbElEKydfZGRfaGVhZGVyVmFsdWUnKTsNCg0KCWlmKG9wdD09J3ZhbHVlJyl7DQoJCXJldHVybiAkKGVsZW0pLmNoaWxkcmVuKCdzcGFuLnZhbHVlJykuaHRtbCgpOw0KCX0NCg0KCWlmKG9wdD09J2ltZ3VybCcpew0KCQlyZXR1cm4gJChlbGVtKS5jaGlsZHJlbignc3Bhbi5pbWd1cmwnKS5odG1sKCk7DQoJfQ0KDQoNCglpZihvcHQ9PSdzZW9MYWJlbCcpew0KCQlyZXR1cm4gJChlbGVtKS5jaGlsZHJlbignc3Bhbi5zZW9MYWJlbCcpLmh0bWwoKTsNCgl9DQoJDQoJaWYob3B0PT0ncmVkaXJlY3RVcmwnKXsNCgkJcmV0dXJuICQoZWxlbSkuY2hpbGRyZW4oJ3NwYW4ucmVkaXJlY3RVcmwnKS5odG1sKCk7DQoJfQ0KDQoJaWYob3B0PT0nY2xhenpUeXBlJyl7DQoJCXJldHVybiAkKGVsZW0pLmNoaWxkcmVuKCdzcGFuLmNsYXp6VHlwZScpLmh0bWwoKTsNCgl9DQoNCg0KDQoNCg0KfQ0KDQphdHRhY2hDaGFuZ2VMaXN0ZW5lciA9IGZ1bmN0aW9uKGVsSWQpew0KCSQoJyMnK2VsSWQpLm9uKCdjaGFuZ2UnLGZ1bmN0aW9uKCl7DQoNCgkJdmFyIGN1cnJlbnRWYWx1ZSA9ICQodGhpcykudmFsKCk7DQoJCXBvcHVsYXRlRHJvcGRvd25IZWFkZXIoZWxJZCwgY3VycmVudFZhbHVlKTsNCg0KCX0pDQoNCn0KfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7LyotLS0tLS0tLS0tLS0tLS0tLS0KCglDdXN0b20gRHJvcGRvd24gV2lkZ2V0IGJ5IFByYWJqZWV0IFBhaHdhCglPcmlnaW5hbCBDb2RlIHJldmFtcGVkIG9uIDA3LzA1LzE4CgotLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwovKi0tLS0tLS0tLS0tLS0tLS0tLS0tCglGdW5jdGlvbmFsaXR5IG92ZXJ2aWV3OgoKCUhUTUwgcmVxdWlyZWQ6IAoKCTxzZWxlY3QgaWQ9ImN1c3RvbURyb3Bkb3duSUQiIGNsYXNzPSJocFN0eWxlRHJvcGRvd25MaWdodCI+CgkJPG9wdGlvbiB2YWx1ZT0idmFsMSI+IFZhbHVlIDE8L29wdGlvbj4KCQk8b3B0aW9uIHZhbHVlPSJ2YWwyIj4gVmFsdWUgMjwvb3B0aW9uPgoJPC9zZWxlY3Q+CgoJb3V0cHV0OgoKCTxkaXYgaWQ9ImN1c3RvbURyb3Bkb3duSURfZGQiIGNsYXNzPSJjdXN0b21Ecm9wZG93bkJveCI+CgkJPGRpdiBpZD0iY3VzdG9tRHJvcGRvd25JRF9kZF9oZWFkZXJCb3giIGNsYXNzPSJ0cmlnZ2VyIj4KCQkJPGEgaHJlZj0iamF2YXNjcmlwdDo7IiBpZD0iY3VzdG9tRHJvcGRvd25JRF9kZF9oZWFkZXJMaW5rIiAvPiAKCQkJCTxzcGFuIGlkPSJjdXN0b21Ecm9wZG93bklEX2RkX2hlYWRlclZhbHVlIj48L3NwYW4+CgkJCQk8c3BhbiBpZD0iY3VzdG9tRHJvcGRvd25JRF9kZF9oZWFkZXJBcnJvdyI+PC9zcGFuPgoJCQk8L2E+CgkJPC9kaXY+CgkJPHVsPgoJCQk8bGk+IFZhbHVlIDEKCQkJPHNwYW4gY2xhc3M9ImhpZGUgdmFsdWUiPnZhbDE8L3NwYW4+CgkJCTwvbGk+CgkJCgkJCgkJCTxsaT4gVmFsdWUgMgoJCQk8c3BhbiBjbGFzcz0iaGlkZSB2YWx1ZSI+dmFsMjwvc3Bhbj4KCQkJPC9saT4KCQkJLgoJCQkuCgkJCS4KCQkJLgoKCQkJPGxpPgoKCQkJPC9saT4KCQk8L3VsPgoKCgk8L2Rpdj4KCi0tLS0tLS0tLS0tLS0tKi8KCgkvL2NvbnZlcnQgZXZlcnkgc2VsZWN0IGVsZW1lbnQgd2l0aCBjbGFzcyBhcyBocFN0eWxlRHJvcGRvd25MaWdodCB0byBhIGN1c3RvbSBsb29rCi8qCglTdGVwcyB0byBmb2xsb3cKCTEuIENoZWNrIGlmIHRoZSBlbGVtZW50IGhhcyBiZWVuIGN1c3RvbWl6ZWQgYWxyZWFkeSAgLS0+IGNoZWNrRm9yQ3VzdG9tRHJvcGRvd25MaWdodCgpCgkyLiBIaWRlIHRoZSBzZWxlY3QgdGFnIGJhc2VkIG9uIElEIC0tPiBoaWRlU2VsZWN0QnlJZExpZ2h0KCkKCTMuIGNyZWF0ZSBDdXN0b21Ecm9wZG93biBTdHJ1Y3R1cmUgLS0+IGNyZWF0ZUN1c3RvbURyb3Bkb3duU3RydWN0dXJlKCkKCTQuIFBvcHVsYXRlIEhlYWRlciBib3gKCTUuIFBvcHVsYXRlIExpc3QKCQlGb3IgZWFjaCBsaXN0IGl0ZW0KCQk1LjEgQXBwZW5kIFZhbHVlCgkJNS4yIEFwcGVuZCBjdXN0b20gYXR0cmlidXRlcyBhcyBzcGFucwoJNi4gQWRkIGNsaWNrIGhhbmRsZXIgZm9yIGxpc3QgaXRlbXMKCTcuIEFkZCB0eXBlYWhlYWQgc2VhcmNoIGxpc3RlbmVyCgkJNy4xIGFkZCA1MDBtcyBsaXN0ZW5lciBmb3IgdHlwZWFoZWFkCgkJNy4yIG9uIGNoYW5naW5nIHRoZSBlbGVtZW50IGNoYW5nZSBoZWFkZXIgdmFsdWUqLwoKCmdldEhwU3R5bGVMaWdodERyb3Bkb3duICA9IGZ1bmN0aW9uKCl7CgkvL3RoaXMgd2lsbCBhY3QgYXMgdGhlIGluaXQgZnVuY3Rpb24KCQoJJCgnc2VsZWN0LmhwU3R5bGVEcm9wZG93bkxpZ2h0JykuZWFjaChmdW5jdGlvbigpewoKCQkvL2dldCBzbGVjdCB0YWcgaWQKCQl2YXIgYWN0dWFsRWxJZCAgPSAkKHRoaXMpLmF0dHIoJ2lkJyk7CgoJCQoKCQlpZihjaGVja0ZvckN1c3RvbURyb3Bkb3duTGlnaHQoYWN0dWFsRWxJZCkpewoJCQkJaGlkZVNlbGVjdEJ5SWRMaWdodChhY3R1YWxFbElkKTsKCQkJCWNyZWF0ZUN1c3RvbURyb3Bkb3duTGlnaHRTdHJ1Y3R1cmUoYWN0dWFsRWxJZCk7CgkJCQlhdHRhY2hDbGlja0hhbmRsZXJMaWdodChhY3R1YWxFbElkKTsKCQkJCWF0dGFjaEtleWJvYXJkTGlzdGVuZXJzTGlnaHQoYWN0dWFsRWxJZCk7CgkJCQlhdHRhY2hDaGFuZ2VMaXN0ZW5lckxpZ2h0KGFjdHVhbEVsSWQpOwoJCX0KCgoKfSk7CgoKCgoKCn0KCgoKY2hlY2tGb3JDdXN0b21Ecm9wZG93bkxpZ2h0ID0gZnVuY3Rpb24oZWxJZCl7CgkvLyBlbElkID0gSWQgb2YgdGhlIHNlbGVjdCB0YWcKCS8vY2hlY2sgaWYgZWxlbWVudCB3aXRoIGlkID0gPGVsSWQ+X2RkIGV4aXN0cwoJaWYoJCgnIycrZWxJZCsnX2RkX2xpZ2h0JykubGVuZ3RoPDEpewoJCS8vZWxlbWVudCBkb2VzbnQgZXhpc3QsIHJldHVybiB0cnVlIHRvIGNyZWF0ZSBlbGVtZW50CgkJcmV0dXJuIHRydWU7Cgl9CgllbHNlewoJCS8vZWxlbWVudCBleGlzdHMsIHJldHVybiBmYWxzZSB0byBub3QgcmVjcmVhdGUgZWxlbWVudAoJCXJldHVybiBmYWxzZTsKCX0KCn07CgpoaWRlU2VsZWN0QnlJZExpZ2h0ID0gZnVuY3Rpb24oZWxJZCl7CgoJaWYoISAkKCcjJytlbElkKS5oYXNDbGFzcygnaGlkZScpKXsKCQkkKCcjJytlbElkKS5hZGRDbGFzcygnaGlkZScpCgl9Cgp9OwoKCgoKCmNyZWF0ZUN1c3RvbURyb3Bkb3duTGlnaHRTdHJ1Y3R1cmUgPSBmdW5jdGlvbihhY3R1YWxFbElkKXsKCgl2YXIgRHJvcGRvd25Db250YWluZXJJZCA9IGFjdHVhbEVsSWQrJ19kZF9saWdodCc7Cgl2YXIgRHJvcGRvd25Db250YWluZXIgPSAkKCc8ZGl2IGlkPSInKyBEcm9wZG93bkNvbnRhaW5lcklkICsnIiBjbGFzcz0iZHJvcGRvd24gZHJvcGRvd25MaWdodENvbnRhaW5lciBocFN0eWxlRHJvcGRvd25MaWdodCI+PC9kaXY+Jyk7CgoJdmFyIERyb3Bkb3duVHJpZ2dlckFuY2hvcklkID0gYWN0dWFsRWxJZCsnX2RkX2hlYWRlckxpbmsnOwoJdmFyIERyb3Bkb3duVGFiSW5kZXggPSAkKCcjJythY3R1YWxFbElkKS5hdHRyKCd0YWJpbmRleCcpOwoJdmFyIGFyaWFMYWJlbCA9JCgnIycrYWN0dWFsRWxJZCkuYXR0cignYXJpYS1sYWJlbGxlZGJ5Jyk7IAoJdmFyIERyb3Bkb3duVHJpZ2dlclZhbHVlSWQgPSBhY3R1YWxFbElkKydfZGRfaGVhZGVyVmFsdWUnOwoJaWYoYXJpYUxhYmVsPT1udWxsIHx8IGFyaWFMYWJlbD09dW5kZWZpbmVkKXsKCQlhcmlhTGFiZWwgPSBEcm9wZG93blRyaWdnZXJWYWx1ZUlkOwoJfQoJZWxzZXsKCQlhcmlhTGFiZWwgPSBhcmlhTGFiZWwgKyAiICIrIERyb3Bkb3duVHJpZ2dlclZhbHVlSWQ7Cgl9CglpZih0eXBlb2YgRHJvcGRvd25UYWJJbmRleCA9PSAidW5kZWZpbmVkIiB8fCBEcm9wZG93blRhYkluZGV4ID09ICIiICl7CgkJdmFyIERyb3Bkb3duVHJpZ2dlckFuY2hvciA9ICQoJzxhIGlkPSInKyBEcm9wZG93blRyaWdnZXJBbmNob3JJZCArJyIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIiBocmVmPSJqYXZhc2NyaXB0OjsiIGNsYXNzPSJkcm9wZG93bkhlYWRlckxpbmsiIGFyaWEtZXhwYW5kZWQ9ImZhbHNlIiBhcmlhLWRlc2NyaWJlZGJ5PSInKyBhcmlhTGFiZWwgKyciPjwvYT4nKTsKCX0KCWVsc2V7CgkJdmFyIERyb3Bkb3duVHJpZ2dlckFuY2hvciA9ICQoJzxhIGlkPSInKyBEcm9wZG93blRyaWdnZXJBbmNob3JJZCArJyIgdGFiaW5kZXg9IicrRHJvcGRvd25UYWJJbmRleCsnIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iIGhyZWY9ImphdmFzY3JpcHQ6OyIgY2xhc3M9ImRyb3Bkb3duSGVhZGVyTGluayIgYXJpYS1leHBhbmRlZD0iZmFsc2UiIGFyaWEtZGVzY3JpYmVkYnk9IicrIGFyaWFMYWJlbCArJyI+PC9hPicpOwoJfQoJCgoKCQoJdmFyIERyb3Bkb3duVHJpZ2dlclZhbHVlID0gJCgnPHNwYW4gaWQ9IicrIERyb3Bkb3duVHJpZ2dlclZhbHVlSWQgKyciIGNsYXNzPSJkcm9wZG93bkhlYWRlclZhbHVlIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9zcGFuPicpOwoKCgkkKERyb3Bkb3duVHJpZ2dlckFuY2hvcikuYXBwZW5kKERyb3Bkb3duVHJpZ2dlclZhbHVlKTsKCQoJJChEcm9wZG93bkNvbnRhaW5lcikuYXBwZW5kKERyb3Bkb3duVHJpZ2dlckFuY2hvcik7CgoKCXZhciBEcm9wZG93bkxpc3RJZCA9IGFjdHVhbEVsSWQrJ19kZF9saXN0JzsKCXZhciBEcm9wZG93bkxpc3QgPSAkKCc8dWwgaWQ9IicrIERyb3Bkb3duTGlzdElkICsnIiByb2xlPSJtZW51IiBjbGFzcz0iZHJvcGRvd24tbWVudS1saWdodCBkcm9wZG93bkxpc3QiPjwvdWw+Jyk7CgoJJChEcm9wZG93bkNvbnRhaW5lcikuYXBwZW5kKERyb3Bkb3duTGlzdCk7CQoKCS8vaW5zZXJ0IHRoZSBjdXN0b20gY29udGFpbmVyIGFmdGVyIHRoZSBzZWxlY3QgdGFnCglEcm9wZG93bkNvbnRhaW5lci5pbnNlcnRBZnRlcigkKCcjJythY3R1YWxFbElkKSk7CgoJLy9wb3B1bGF0ZSB0aGUgbGlzdCBpdGVtcwoJcG9wdWxhdGVEcm9wZG93bkxpc3RMaWdodChhY3R1YWxFbElkLCBEcm9wZG93bkxpc3RJZCk7CgoJLy9Qb3B1bGF0ZSB0aGUgRHJvcGRvd24gSGVhZGVyIFZhbHVlCgl2YWx1ZVJlcSA9ICQoJyMnK2FjdHVhbEVsSWQpLmF0dHIoJ3ZhbHVlcmVxJykKCWlmKHZhbHVlUmVxIT1udWxsICYmIHZhbHVlUmVxIT0iIiApewoJCXZhciB2YWxPYnRhaW5lZCA9IGdldFBhcmFtZXRlckJ5TmFtZSh2YWx1ZVJlcSk/Z2V0UGFyYW1ldGVyQnlOYW1lKHZhbHVlUmVxKTpnZXRDQ0xDKHZhbHVlUmVxKTsKCQlpZih2YWxPYnRhaW5lZCAhPSBudWxsICYmIHZhbE9idGFpbmVkICE9ICcnKXsKCQkJdmFsT2J0YWluZWQgPSB2YWxPYnRhaW5lZC50b0xvd2VyQ2FzZSgpOwoJCQkvKmNoZWNrIGlmIGxhbmd1YWdlIGRyb3Bkb3duIGFuZCBjdXN0b21pemUgZm9yIGNuLXpoIGhrLXpoIG9yIHR3LXpoICovCgkJCWlmKCQodGhpcykuYXR0cigndmFsdWVyZXEnKT09ImxjIikKCQkJewkKCQkJCWlmKCBnZXRDQ0xDKCJjYyIpID09ICJjbiIgICYmIHZhbE9idGFpbmVkID09ICJ6aCIpewoJCQkJCXZhbE9idGFpbmVkID0gInpoLWhhbnMiOwkgIC8vIGZvciBjaGluYSByZXR1cm4gY2hpbmVzZSBzaW1wbGlmaWVkCgkJCQl9CgkJCQllbHNlIGlmKChnZXRDQ0xDKCJjYyIpID09ICJ0dyIgfHwgZ2V0Q0NMQygiY2MiKSA9PSAiaGsiKSAmJiB2YWxPYnRhaW5lZCA9PSAiemgiKXsKCQkJCQl2YWxPYnRhaW5lZCA9ICJ6aC1oYW50IjsJIC8vIGZvciB0YWl3YW4gYW5kIGhvbmdrb25nIHJldHVybiBjaGluZXNlIHRyYWRpdGlvbmFsCgkJCQl9CgkJCX0KCQl9CgkJcG9wdWxhdGVEcm9wZG93bkhlYWRlckxpZ2h0KGFjdHVhbEVsSWQsIHZhbE9idGFpbmVkKQoJfQoJZWxzZQoJCXBvcHVsYXRlRHJvcGRvd25IZWFkZXJMaWdodChhY3R1YWxFbElkLCAiIikKCgoKCgp9OwoKcG9wdWxhdGVEcm9wZG93bkhlYWRlckxpZ2h0ID0gZnVuY3Rpb24oZWxJZCwgdmFsKXsKCgoKCS8vc2V0IHRoZSBkcm9wZG93biBIZWFkZXIgVmFsdWUgdG8gdGhlIGZpcnN0IGVsZW0KCQl2YXIgZmlyc3RWYWwgPSAkKCQoJyMnK2VsSWQpLmNoaWxkcmVuKCdvcHRpb24nKVswXSkuaHRtbCgpOwoJCSQoJyMnK2VsSWQrJ19kZF9oZWFkZXJWYWx1ZScpLmVtcHR5KCkuYXBwZW5kKGZpcnN0VmFsKTsKCQkkKCcjJytlbElkKydfZGRfaGVhZGVyVmFsdWUnKS5hZGRDbGFzcygnZGVmYXVsdCcpOwoJCS8vc2V0IHRoZSBoaWRkZW4gZHJvcGRvd24gdmFsdWUKCQkkKCcjJytlbElkKS52YWwoMCkKCgoJCgoJaWYodmFsIT0iIiApewoJCQl2YXIgZWxlbSA9ICIiOwoJCSAkKCcjJytlbElkKydfZGRfbGlzdCBsaS5lbGVtIGEgc3Bhbi52YWx1ZScpLmVhY2goZnVuY3Rpb24oKXsKCQkJCWlmKCQodGhpcykudGV4dCgpPT12YWwpewoJCQkJCQkvL3NldCB0aGUgZHJvcGRvd24gSGVhZGVyIFZhbHVlIHRvIHRoZSBmb3VuZCBlbGVtCgkJCQkJCSBlbGVtID0gJCh0aGlzKS5wYXJlbnRzKCdhJykuaHRtbCgpCgkJCQkJCSAkKCcjJytlbElkKydfZGRfaGVhZGVyVmFsdWUnKS5lbXB0eSgpLmFwcGVuZChlbGVtKTsKCQkJCQkJIC8vc2V0IHRoZSBoaWRkZW4gZHJvcGRvd24gdmFsdWUKCQkJCQkJICQoJyMnK2VsSWQpLnZhbCh2YWwpOwoJCQkJfSAKCgkJIH0pCgoKCQkKCQkKCX0KCgoKfTsKCnBvcHVsYXRlRHJvcGRvd25MaXN0TGlnaHQgPSBmdW5jdGlvbihlbElkLCBsaXN0SWQpewoKCSQoJyMnK2VsSWQpLmNoaWxkcmVuKCdvcHRpb24nKS5lYWNoKGZ1bmN0aW9uKCl7CgoJCXZhciBsaXN0SXRlbSA9ICQoJzxsaSBjbGFzcz0iZWxlbSIgcm9sZT0ibWVudWl0ZW0iPjwvbGk+Jyk7CgkJdmFyIGxpc3RJdGVtQW5jaG9yID0gJCgnPGEgaHJlZj0iamF2YXNjcmlwdDo7IiA+PC9hPicpOwoKCQl2YXIgc3BhblZhbHVlID0gJCgnPHNwYW4gY2xhc3M9ImhpZGUgdmFsdWUiPjwvc3Bhbj4nKTsKCQl2YXIgc3BhbkltZ1VybCA9ICQoJzxzcGFuIGNsYXNzPSJoaWRlIGltZ3VybCI+PC9zcGFuPicpOwoJCXZhciBzcGFuU2VvTGFiZWwgPSAkKCc8c3BhbiBjbGFzcz0iaGlkZSBzZW9MYWJlbCI+PC9zcGFuPicpOwoJCXZhciBzcGFuUmVkaXJlY3RVcmwgPSAkKCc8c3BhbiBjbGFzcz0iaGlkZSByZWRpcmVjdFVybCI+PC9zcGFuPicpOwoJCXZhciBzcGFuQ2xhenpUeXBlID0gJCgnPHNwYW4gY2xhc3M9ImhpZGUgY2xhenpUeXBlIj48L3NwYW4+Jyk7CgoKCQl2YXIgbGlzdERhdGEgPSAkKHRoaXMpLmh0bWwoKTsKCQl2YXIgZGF0YVZhbHVlID0gJCh0aGlzKS5hdHRyKCd2YWx1ZScpOwoKCgkJJChsaXN0SXRlbUFuY2hvcikuYXBwZW5kKGxpc3REYXRhKTsKCgoJCQkkKHNwYW5WYWx1ZSkuYXBwZW5kKCQodGhpcykuYXR0cigidmFsdWUiKSk7CgkJCWxpc3RJdGVtQW5jaG9yLmFwcGVuZChzcGFuVmFsdWUpOwoKCQlpZigkKHRoaXMpLmF0dHIoImltYWdldXJsIikpewoJCQkkKHNwYW5JbWdVcmwpLmFwcGVuZCgkKHRoaXMpLmF0dHIoImltYWdldXJsIikpOwoJCQlsaXN0SXRlbUFuY2hvci5hcHBlbmQoc3BhbkltZ1VybCk7CgkJfQoJCQoJCWlmKCQodGhpcykuYXR0cigic2VvLWxhYmVsIikpewoJCQkJCQoJCQkkKHNwYW5TZW9MYWJlbCkuYXBwZW5kKCQodGhpcykuYXR0cigic2VvLWxhYmVsIikpOwoJCQlsaXN0SXRlbUFuY2hvci5hcHBlbmQoc3BhblNlb0xhYmVsKTsKCgkJCX0KCQkKCQlpZigkKHRoaXMpLmF0dHIoInJlZGlyZWN0VXJsIikpewoJCQkKCQkJJChzcGFuUmVkaXJlY3RVcmwpLmFwcGVuZCgkKHRoaXMpLmF0dHIoInJlZGlyZWN0VXJsIikpOwoJCQlsaXN0SXRlbUFuY2hvci5hcHBlbmQoc3BhblJlZGlyZWN0VXJsKTsKCQkJCgkJCX0KCQkKCQlpZigkKHRoaXMpLmF0dHIoImNsYXp6VHlwZSIpKXsKCQkJJChzcGFuQ2xhenpUeXBlKS5hcHBlbmQoJCh0aGlzKS5hdHRyKCJjbGF6elR5cGUiKSk7CgkJCWxpc3RJdGVtQW5jaG9yLmFwcGVuZChzcGFuQ2xhenpUeXBlKTsKCQkJfQoKCgkJJChsaXN0SXRlbSkuYXBwZW5kKGxpc3RJdGVtQW5jaG9yKTsKCQkkKCcjJytsaXN0SWQpLmFwcGVuZChsaXN0SXRlbSk7CgoJfSk7CgkKCn07CgphdHRhY2hDbGlja0hhbmRsZXJMaWdodCA9IGZ1bmN0aW9uKGVsSWQpewoKCSQoJyMnK2VsSWQrJ19kZF9saXN0IGxpJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXsKCgkJLy9zZXQgdmFsdWUgaW4gdGhlIGhpZGRlbiBzZWxlY3QgdGFnCgkJLy9wb3B1bGF0ZSBoZWFkZXIgdmFsdWUKCQkvLyBzZWxWYWx1ZSA9ICQodGhpcykuY2hpbGRyZW4oJ2EnKS5jaGlsZHJlbignc3Bhbi52YWx1ZScpLmh0bWwoKTsKCQlzZWxWYWx1ZSA9ICQodGhpcykuY2hpbGRyZW4oJ2EnKS5jaGlsZHJlbignc3Bhbi52YWx1ZScpLnRleHQoKTsKCQkkKCcjJytlbElkKS52YWwoc2VsVmFsdWUpOwoKCQlwb3B1bGF0ZURyb3Bkb3duSGVhZGVyTGlnaHQoZWxJZCwgc2VsVmFsdWUpOwoJCSQoJyMnK2VsSWQpLnRyaWdnZXIoJ2NoYW5nZScpOwoKCQkvL3NldCBmb2N1cyB0byB0aGUgbWFpbiBhbmNob3IgdGFnCgkJJCgnIycrZWxJZCsnX2RkX2hlYWRlckxpbmsnKS5mb2N1cygpCgoJfSk7CgoKCgp9OwoKYXR0YWNoS2V5Ym9hcmRMaXN0ZW5lcnNMaWdodCA9IGZ1bmN0aW9uKGVsSWQpewoKCgkJLy9rZXlkb3duIGV2ZXRzIGZvciBlc2MvYmNrc3AvdGFiCgkJCSQoJyMnK2VsSWQrJ19kZF9saWdodCcpLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZSkgewoJCQkKCQkJaWYoZS5rZXlDb2RlID09IDggfHwgZS5rZXlDb2RlID09IDkgfHwgZS5rZXlDb2RlID09IDI3ICl7CgkJCS8vaWYgdGhlIHVzZXIgaGl0cyBiYWNrc3BhY2UsIGVzYywgb3IgdGFiIGl0IHNob3VsZCBjbG9zZSB0aGUgZHJvcGRvd24KCQkJCWlmKCQodGhpcykuaGFzQ2xhc3MoJ29wZW4nKSl7CgkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQllLnN0b3BQcm9wYWdhdGlvbigpOy8vdG8gcHJldmVudCBwb3B1cHMgZnJvbSBjbG9zaW5nCgkJCQkkKHRoaXMpLnJlbW92ZUNsYXNzKCdvcGVuJyk7CgkJCQl9CgkJCX0KCgkJCX0pOwoKCgkJLy9rZXlwcmVzcyBldmVudHMgZm9yIHR5cGVhaGVhZAoJCQkkKCcjJytlbElkKydfZGRfbGlnaHQnKS5vbigna2V5cHJlc3MnLCBmdW5jdGlvbihlKSB7CgkJCWlmKGUua2V5Q29kZSAhPSAzNyB8fCBlLmtleUNvZGUgIT0gMzggfHwgZS5rZXlDb2RlICE9IDM5IHx8IGUua2V5Q29kZSAhPSA0MCl7CgkJCQoJCQkJa2V5ID0gU3RyaW5nLmZyb21DaGFyQ29kZShlLmNoYXJDb2RlICE9IG51bGwgPyBlLmNoYXJDb2RlIDogZS5rZXlDb2RlKTsKCQkJCWNvbnNvbGUubG9nKGtleSArICItcHJlc3NlZCBLZXkiKQoJCQkJY2xlYXJUaW1lb3V0KHRpbWVPdXRSZXNldExldHRlcnNMaWdodCk7CgkJCQl0aW1lT3V0UmVzZXRMZXR0ZXJzTGlnaHQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CgkJCQkJbGV0dGVyUHJlc3NlZExpZ2h0ID0gW107CgkJCQl9LDUwMCk7CgkJCQlsZXR0ZXJQcmVzc2VkTGlnaHQucHVzaChrZXkpOwoJCQkJY29uc29sZS5sb2cobGV0dGVyUHJlc3NlZExpZ2h0KTsKCQkJCWNvbnNvbGUubG9nKGxldHRlclByZXNzZWRMaWdodC5qb2luKCcnKSk7CgkJCQljb25zb2xlLmxvZygnYmVmb3JlIC0gJyt0eXBlQWhlYWRUZXh0TGlnaHQrJywgJyt0eXBlQWhlYWRDb3VudGVyTGlnaHQpOwoJCQkJaWYoZ2V0VHlwZWRMaWdodCgpID09IGxldHRlclByZXNzZWRMaWdodC5qb2luKCcnKSl7CgkJCQkJc2V0VHlwZWRMaWdodChsZXR0ZXJQcmVzc2VkTGlnaHQuam9pbignJykpOwoJCQkJCXNldENvdW50ZXJMaWdodChnZXRDb3VudGVyTGlnaHQoKSsxKTsKCQkJCX0KCQkJCWVsc2V7CgkJCQkJc2V0Q291bnRlckxpZ2h0KDEpOwoJCQkJCXNldFR5cGVkTGlnaHQobGV0dGVyUHJlc3NlZExpZ2h0LmpvaW4oJycpKTsKCQkJCX0KCQkJCWNvbnNvbGUubG9nKCdhZnRlciAtICcrdHlwZUFoZWFkVGV4dExpZ2h0KycsICcrdHlwZUFoZWFkQ291bnRlckxpZ2h0KTsKCQkJCXR5cGVhaGVhZExpZ2h0KGxldHRlclByZXNzZWRMaWdodC5qb2luKCcnKSwgdGhpcyk7CgkJCQl9CgkJCX0pOwkKCgoKCQkJCS8vVG8gaGFuZGxlIHR5cGVhaGVkIGZvciBtb3JlIHRoYW4gb25jZQoJCQkkKCcjJytlbElkKydfZGRfbGlnaHQnKS5vbignYmx1cicsIGZ1bmN0aW9uKGUpIHsKCQkJCXNldENvdW50ZXJMaWdodCgxKTsKCQkJCXNldFR5cGVkTGlnaHQoJycpOwoJCQl9KTsKCQkJCgkJCSQoJyMnK2VsSWQrJ19kZF9saWdodCB1bCA+IGxpJykub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uKGUpIHsKCQkJCXNldFR5cGVBaGVhZExpZ2h0KHRoaXMpOwoJCQl9KTsKCgp9OwoKCnR5cGVhaGVhZExpZ2h0ID0gZnVuY3Rpb24od2hhdCwgZWxlbSl7Cgl2YXIgZWxzID0gJCgnIycrJChlbGVtKS5hdHRyKCdpZCcpKycgLmVsZW0nKS5maWx0ZXIoZnVuY3Rpb24oaW5kZXgpIHsKICAJCXJldHVybiAkKHRoaXMpLmNoaWxkcmVuKCdhJykuaHRtbCgpLnRvTG93ZXJDYXNlKCkuc2VhcmNoKHdoYXQpID09IDA7Cgl9KTsKCWNvbnNvbGUubG9nKHR5cGVBaGVhZENvdW50ZXJMaWdodCk7Cgl2YXIgaW5kZXggPSAodHlwZUFoZWFkQ291bnRlckxpZ2h0IC0gMSkgJSBlbHMubGVuZ3RoOwoJaWYoZWxzICYmIGVscy5sZW5ndGggPiAwICYmIGVsc1tpbmRleF0gJiYgZWxzW2luZGV4XS5jaGlsZE5vZGVzWzBdKXsKCQllbHNbaW5kZXhdLmNoaWxkTm9kZXNbMF0uZm9jdXMoKTsKCX0KfQoKc2V0VHlwZUFoZWFkTGlnaHQgPSBmdW5jdGlvbihlbCl7Cgl2YXIgaG92ZXJlZEVsID0gJChlbCk7Cgl2YXIgaG92ZXJlZENoYXIgPSBob3ZlcmVkRWwuY2hpbGRyZW4oJ2EnKS5odG1sKCkudG9Mb3dlckNhc2UoKS5zcGxpdCgnPCcpWzBdWzBdOwoJc2V0VHlwZWRMaWdodChob3ZlcmVkQ2hhcik7CglzZXRDb3VudGVyTGlnaHQoMCk7CgkvKiB2YXIgaSA9IDE7ICAgLy9UT0RPOiByZXZpc2l0IGZvciBtb3VzZSBob3ZlciBsb2dpYwoJdmFyIGVscyA9IGhvdmVyZWRFbC5wYXJlbnQoKS5jaGlsZHJlbignLmVsZW0nKS5maWx0ZXIoZnVuY3Rpb24oaW5kZXgpIHsKICAJCXJldHVybiAkKHRoaXMpLmNoaWxkcmVuKCdhJykuaHRtbCgpLnRvTG93ZXJDYXNlKCkuc2VhcmNoKGhvdmVyZWRDaGFyKSA9PSAwOwoJfSk7CgkKCXdoaWxlKGkgPCBlbHMubGVuZ3RoKXsKCQljb25zb2xlLmxvZyhob3ZlcmVkRWwrJyA9PSAnK2Vscyk7CgkJaWYoaG92ZXJlZEVsID09IGVsc1tpLTFdKXsKCQkJc2V0Q291bnRlckxpZ2h0KGkpOwoJCQljb25zb2xlLmxvZyhob3ZlcmVkQ2hhcisnLCAnK2kpOwoJCX0KCQlpKz0xOwoJfSAqLwkKfQoKdmFyIGxldHRlclByZXNzZWRMaWdodCA9IFtdOwp2YXIgdGltZU91dFJlc2V0TGV0dGVyc0xpZ2h0ID0gbnVsbDsKdmFyIHR5cGVBaGVhZENvdW50ZXJMaWdodCA9IDE7CnZhciB0eXBlQWhlYWRUZXh0TGlnaHQgPSAnJzsKCmZ1bmN0aW9uIHNldENvdW50ZXJMaWdodCh2YWwpCnsKICAgIHR5cGVBaGVhZENvdW50ZXJMaWdodCA9IHZhbDsKfQoKZnVuY3Rpb24gZ2V0Q291bnRlckxpZ2h0KCkKewogICAgcmV0dXJuIHR5cGVBaGVhZENvdW50ZXJMaWdodDsKfQpmdW5jdGlvbiBzZXRUeXBlZExpZ2h0KHZhbCkKewogICAgdHlwZUFoZWFkVGV4dExpZ2h0ID0gdmFsOwp9CgpmdW5jdGlvbiBnZXRUeXBlZExpZ2h0KCkKewogICAgcmV0dXJuIHR5cGVBaGVhZFRleHRMaWdodDsKfQoKCmdldFNlbGVjdGVkRGF0YUxpZ2h0ID0gZnVuY3Rpb24ob3B0LGVsSUQpewoKCXZhciBlbGVtID0gJCgnIycrZWxJRCsnX2RkX2hlYWRlclZhbHVlJyk7CgoJaWYob3B0PT0ndmFsdWUnKXsKCQlyZXR1cm4gJChlbGVtKS5jaGlsZHJlbignc3Bhbi52YWx1ZScpLmh0bWwoKTsKCX0KCglpZihvcHQ9PSdpbWd1cmwnKXsKCQlyZXR1cm4gJChlbGVtKS5jaGlsZHJlbignc3Bhbi5pbWd1cmwnKS5odG1sKCk7Cgl9CgoKCWlmKG9wdD09J3Nlb0xhYmVsJyl7CgkJcmV0dXJuICQoZWxlbSkuY2hpbGRyZW4oJ3NwYW4uc2VvTGFiZWwnKS5odG1sKCk7Cgl9CgkKCWlmKG9wdD09J3JlZGlyZWN0VXJsJyl7CgkJcmV0dXJuICQoZWxlbSkuY2hpbGRyZW4oJ3NwYW4ucmVkaXJlY3RVcmwnKS5odG1sKCk7Cgl9CgoJaWYob3B0PT0nY2xhenpUeXBlJyl7CgkJcmV0dXJuICQoZWxlbSkuY2hpbGRyZW4oJ3NwYW4uY2xhenpUeXBlJykuaHRtbCgpOwoJfQoKCgoKCn0KCmF0dGFjaENoYW5nZUxpc3RlbmVyTGlnaHQgPSBmdW5jdGlvbihlbElkKXsKCSQoJyMnK2VsSWQpLm9uKCdjaGFuZ2UnLGZ1bmN0aW9uKCl7CgoJCXZhciBjdXJyZW50VmFsdWUgPSAkKHRoaXMpLnZhbCgpOwoJCWlmKGN1cnJlbnRWYWx1ZSA9PT0gbnVsbCl7CgkJCWN1cnJlbnRWYWx1ZSA9ICIiOwoJCX0KCQlwb3B1bGF0ZURyb3Bkb3duSGVhZGVyTGlnaHQoZWxJZCwgY3VycmVudFZhbHVlKTsKCQlpZihjdXJyZW50VmFsdWUgPT0gMCB8fCBjdXJyZW50VmFsdWUgPT0gIjAiIHx8IGN1cnJlbnRWYWx1ZSA9PSAiIiB8fCBjdXJyZW50VmFsdWUubGVuZ3RoID09IDAgfHwgY3VycmVudFZhbHVlLnRvTG93ZXJDYXNlKCkgPT0gInNlbGVjdCIpewoJCQkkKCIjIitlbElkKyJfZGRfbGlnaHQiKS5yZW1vdmVDbGFzcygidmFsU2VsZWN0ZWQiKTsKCQl9CgkJZWxzZXsKCQkJJCgiIyIrZWxJZCsiX2RkX2xpZ2h0IikuYWRkQ2xhc3MoInZhbFNlbGVjdGVkIik7CgkJfQoKCX0pOwp9Cgp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvL0RvY3VtZW50IENyZWF0ZWQgb24gMjUvRmViLzIwMTQNCi8vT3JpZ2luYWwgQXV0aG9yIDogVmFydW4gVmluYXlhaw0KLy9Eb2N1bWVudCByZXBsYWNlZCBieSA6IEFzaHdpbmkgU2hhbmthciBIUy4NCi8vQXNod2luaTogVGhpcyBpcyB0byBoYW5kbGUgdGhlIG1hc2tpbmcsIGZpbHRlcnMgYW5kIHRoZSBlcnJvciBtZXNzYWdlcyBnbG9iYWxseS4gV2UgY2FuIGp1c3QgaW5jbHVkZSB0aGUgSlMgYW5kIHN0YXJ0IHVzaW5nIGl0IHdpdGggRE9NIGVsZW1lbnRzLg0KLy9FZzogPGlucHV0IHR5cGU9InRleHQiIHZhbHVlPSIiIGNsYXNzPSJpbnB1dFBGaW5kZXIgcGxhY2Vob2xkZXJUZXh0IG51bGxWYWxpZGF0ZVRleHQiIGdob3N0VGV4dD0iRW50ZXIgcHJvZHVjdCBuYW1lIG9yIG51bWJlciIgRmlsdGVyPSJBbHBoYU51bWVyaWMiIFJlcXVpcmVkVmFsaWRhdGlvbj0idHJ1ZSIgZXJyb3JNZXNzYWdlPSJQbGVhc2UgZW50ZXIgYSB2YWxpZCBzZXJpYWwgbnVtYmVyIiBNaW4tQ2hhcj0iMTAiIE1heC1DaGFyPSIyMCIgLz4NCg0KJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7DQoJSGFuZGxlVmFsaWRhdGlvbk9uTG9hZCgpOw0KfSk7DQoNCi8vQ3JlYXRlIGZpbHRlcnMgYW5kIFZhbGlkYXRpb24gbG9naWMgb24gbG9hZCAtIEFzaHdpbmkNCi8qKg0KICoNCiAqLw0KSGFuZGxlVmFsaWRhdGlvbk9uTG9hZCA9IGZ1bmN0aW9uKCl7DQoNCg0KCS8qKg0KCSAqIEdlbmVyaWMgbWV0aG9kIHRvIHBlcmZvcm0gcmVndWxhcg0KCSAqIGV4cHJlc3Npb24gYmFzZWQgdmFsaWRhdGlvbiBhbmQgdGFrZQ0KCSAqIGFwcHJvcHJpYXRlIGFjdGlvbg0KCSAqDQoJICogQGF1dGhvciBhcmthc2luaGENCgkgKi8NCg0KCS8qICJwYWdlTmFtZSIgaXMgcGFzc2VkIGFzIGNvbnZlcnNpb24gZnJvbSBjb252ZXJzaW9uIHBhZ2UsIHNvIGFzIHRvIGNoZWNrIHRoZSBpbnB1dCBmaWVsZCBiZWluZyBub3QgZW1wdHkNCgkgKiBiZWZvcmUgcGVyZm9ybWluZyB2YWxpZGF0aW9uLg0KCSAqLw0KCWZ1bmN0aW9uIHBlcmZvcm1WYWxpZGF0aW9uT25FbGVtZW50KGV2ZW50LCByZWd1bGFyRXhwcmVzc2lvbiwgcGFnZU5hbWUpew0KCQl2YXIgZWxlbUlkID0gZXZlbnQudGFyZ2V0LmlkOw0KCQl2YXIgbmV3RWxlbSA9ICQoJyMnK2VsZW1JZCk7DQoJCS8vIENoYW5nZWQgZnJvbSB0aGlzIHZhbHVlIHJlZiB0byBuZXdFbGVtVmFsdWUgYXMgcGFydCBvZiB1cyA2OTMxDQoJCXZhciBuZXdFbGVtVmFsID0gbmV3RWxlbS52YWwoKTsNCiAgICAgICAgaWYoIG5ld0VsZW1WYWwgPT09ICIiIHx8IG5ld0VsZW1WYWwgPT09IHVuZGVmaW5lZCB8fCBuZXdFbGVtVmFsID09PSBudWxsKXsNCiAgICAgICAgICAgLy9pZ25vcmUgdmFsaWRhdGlvbg0KICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfSBlbHNlew0KICAgICAgICAgICAJCW1hdGNoUmVndWxhckV4cHJlc3Npb24obmV3RWxlbSwgcmVndWxhckV4cHJlc3Npb24pOw0KCQkJCS8qIERlZmVjdCAzNTcwIEFkZGVkIGF0dHJpYnV0ZSBSZWNvbW1lbmRlZFZhbGlkYXRpb24gaWYgU2VyaWFsIE51bWJlciBpbnB1dCBpcyByZWNvbW1lbmRlZCBhbmQgY2FsbGluZyBlcnJvcmhhbmRsZXIqLw0KICAgICAgICAgCQlpZiggbmV3RWxlbVZhbCA9PT0gIiIgJiYgIW5ld0VsZW0uYXR0cignUmVxdWlyZWRWYWxpZGF0aW9uJykgKXsNCgkJICAgICAgICAJbmV3RWxlbS5hdHRyKCdSZWNvbW1lbmRlZFZhbGlkYXRpb24nLCd0cnVlJyk7DQoJCSAgICAgICAgIAllcnJvckhhbmRsZXIobmV3RWxlbSk7DQoJCSAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2V7DQogICAgICAgICAgICAgICAgICAgIG5ld0VsZW0uYXR0cignUmVjb21tZW5kZWRWYWxpZGF0aW9uJywnZmFsc2UnKTsNCiAgICAgICAgICAgICAgICAgICAgLyogQWRkZWQgZm9yIG1pbiBsZW5ndGggdmFsaWRhdGlvbiAqLw0KICAgICAgICAgICAgICAgICAgICBpZiggbmV3RWxlbVZhbC5sZW5ndGggPCBuZXdFbGVtLmF0dHIoIm1pbi1jaGFyIikgKXsNCiAgICAgICAgICAgICAgICAgICAgCWVycm9ySGFuZGxlcihuZXdFbGVtKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICB9DQoJCQkJLyogRGVmZWN0IDM1NzAgZW5kICovDQogICAgICAgIH0NCgkJaWYobmV3RWxlbS5hdHRyKCdSZXF1aXJlZFZhbGlkYXRpb24nKSA9PSAndHJ1ZScpDQoJCQllcnJvckhhbmRsZXIobmV3RWxlbSk7DQoJfQ0KDQoJLy8gdmFsaWRhdGlvbiBmb3IgUHJvZHVjdCBOdW1iZXINCgkkKCdpbnB1dFtGaWx0ZXI9IlByb2R1Y3ROdW1iZXJWYWxpZGF0aW9uIl0nKS5vbignYmx1cicsIGZ1bmN0aW9uKGV2ZW50KXsNCg0KCQkvLyBwcm9kdWN0TnVtYmVyVmFsaWRhdGlvblJlZ2V4IGlzIGdsb2JhbCB2YXJpYWJsZQ0KCQlwZXJmb3JtVmFsaWRhdGlvbk9uRWxlbWVudChldmVudCwgcHJvZHVjdE51bWJlclZhbGlkYXRpb25SZWdleCk7DQoNCgl9KTsNCg0KCS8vIHZhbGlkYXRpb24gb2YgSFAgcHJvZHVjdCBudW1iZXINCgkkKCdpbnB1dFtGaWx0ZXI9IkhQUHJvZHVjdE51bWJlclZhbGlkYXRpb24iXScpLm9uKCdibHVyJywgZnVuY3Rpb24oZXZlbnQpew0KDQoJCS8vIGhwUHJvZHVjdE51bWJlclZhbGlkYXRpb25SZWdleCBpcyBnbG9iYWwgdmFyaWFibGUNCgkJcGVyZm9ybVZhbGlkYXRpb25PbkVsZW1lbnQoZXZlbnQsIGhwUHJvZHVjdE51bWJlclZhbGlkYXRpb25SZWdleCwgImNvbnZlcnNpb24iKTsNCg0KCX0pOw0KDQoJLy8gdmFsaWRhdGlvbiBvZiBTYW1zdW5nIHByb2R1Y3QgbnVtYmVyDQoJJCgnaW5wdXRbRmlsdGVyPSJTYW1zdW5nUHJvZHVjdE51bWJlclZhbGlkYXRpb24iXScpLm9uKCdibHVyJywgZnVuY3Rpb24oZXZlbnQpew0KDQoJCS8vIHNhbXN1bmdQcm9kdWN0TnVtYmVyVmFsaWRhdGlvblJlZ2V4IGlzIGdsb2JhbCB2YXJpYWJsZQ0KCQlwZXJmb3JtVmFsaWRhdGlvbk9uRWxlbWVudChldmVudCwgc2Ftc3VuZ1Byb2R1Y3ROdW1iZXJWYWxpZGF0aW9uUmVnZXgsICJjb252ZXJzaW9uIik7DQoNCgl9KTsNCg0KCS8vIHZhbGlkYXRpb24gb2YgU2Ftc3VuZyBzZXJpYWwgbnVtYmVyDQoJJCgnaW5wdXRbRmlsdGVyPSJTYW1zdW5nU2VyaWFsTnVtYmVyVmFsaWRhdGlvbiJdJykub24oJ2JsdXInLCBmdW5jdGlvbihldmVudCl7DQoNCgkJLy8gc2Ftc3VuZ1NlcmlhbE51bWJlclZhbGlkYXRpb25SZWdleCBpcyBnbG9iYWwgdmFyaWFibGUNCgkJcGVyZm9ybVZhbGlkYXRpb25PbkVsZW1lbnQoZXZlbnQsIHNhbXN1bmdTZXJpYWxOdW1iZXJWYWxpZGF0aW9uUmVnZXgsICJjb252ZXJzaW9uIik7DQoNCgl9KTsNCg0KCS8vIHZhbGlkYXRpb24gb2YgSFAgc2VyaWFsIG51bWJlcg0KCSQoJ2lucHV0W0ZpbHRlcj0iSFBTZXJpYWxOdW1iZXJWYWxpZGF0aW9uIl0nKS5vbignYmx1cicsIGZ1bmN0aW9uKGV2ZW50KXsNCg0KCQkvLyBocFNlcmlhbE51bWJlclZhbGlkYXRpb25SZWdleCBpcyBnbG9iYWwgdmFyaWFibGUNCgkJcGVyZm9ybVZhbGlkYXRpb25PbkVsZW1lbnQoZXZlbnQsIGhwU2VyaWFsTnVtYmVyVmFsaWRhdGlvblJlZ2V4LCAiY29udmVyc2lvbiIpOw0KDQoJfSk7DQoNCgkvLyB2YWxpZGF0aW9uIGZvciBTZXJpYWwgTnVtYmVyDQoJJCgnaW5wdXRbRmlsdGVyPSJTZXJpYWxOdW1iZXJWYWxpZGF0aW9uIl0nKS5vbignYmx1cicsIGZ1bmN0aW9uKGV2ZW50KXsNCg0KCQkvLyBzZXJpYWxOdW1iZXJWYWxpZGF0aW9uUmVnZXggaXMgZ2xvYmFsIHZhcmlhYmxlDQoJCXBlcmZvcm1WYWxpZGF0aW9uT25FbGVtZW50KGV2ZW50LCBzZXJpYWxOdW1iZXJWYWxpZGF0aW9uUmVnZXgpOw0KDQoJfSk7DQoNCgkkKCdpbnB1dFtGaWx0ZXI9IkFscGhhTnVtZXJpYyJdJykub24oJ2JsdXInLCBmdW5jdGlvbihldmVudCl7DQoJCXZhciBlbGVtSWQgPSBldmVudC50YXJnZXQuaWQ7DQoJCXZhciBuZXdFbGVtID0gJCgnIycrZWxlbUlkKTsNCiAgICAgICAgaWYoICQodGhpcykudmFsKCkgPT09ICIiIHx8ICQodGhpcykudmFsKCkgPT09IHVuZGVmaW5lZCB8fCAkKHRoaXMpLnZhbCgpID09PSBudWxsKXsNCiAgICAgICAgICAgLy9pZ25vcmUgdmFsaWRhdGlvbg0KICAgICAgICB9DQogICAgICAgIGVsc2V7DQogICAgICAgICAgIAkJc3BlY2lhbENoYXJIYW5kbGVyKG5ld0VsZW0pOw0KCQkJCS8qIERlZmVjdCAzNTcwIEFkZGVkIGF0dHJpYnV0ZSBSZWNvbW1lbmRlZFZhbGlkYXRpb24gaWYgU2VyaWFsIE51bWJlciBpbnB1dCBpcyByZWNvbW1lbmRlZCBhbmQgY2FsbGluZyBlcnJvcmhhbmRsZXIqLw0KICAgICAgICAgCQlpZiggJCh0aGlzKS52YWwoKSA9PT0gIiIgJiYgISQodGhpcykuYXR0cignUmVxdWlyZWRWYWxpZGF0aW9uJykgKXsNCgkJICAgICAgICAJJCh0aGlzKS5hdHRyKCdSZWNvbW1lbmRlZFZhbGlkYXRpb24nLCd0cnVlJyk7DQoJCSAgICAgICAgIAllcnJvckhhbmRsZXIodGhpcyk7DQoJCSAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2V7DQogICAgICAgICAgICAgICAgICAgICQodGhpcykuYXR0cignUmVjb21tZW5kZWRWYWxpZGF0aW9uJywnZmFsc2UnKTsNCiAgICAgICAgICAgICAgICAgICAgLyogQWRkZWQgZm9yIG1pbiBsZW5ndGggdmFsaWRhdGlvbiAqLw0KICAgICAgICAgICAgICAgICAgICBpZiggJCh0aGlzKS52YWwoKS5sZW5ndGggPCAkKHRoaXMpLmF0dHIoIm1pbi1jaGFyIikgKXsNCiAgICAgICAgICAgICAgICAgICAgCWVycm9ySGFuZGxlcih0aGlzKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICB9DQoJCQkJLyogRGVmZWN0IDM1NzAgZW5kICovDQogICAgICAgIH0NCgkJaWYoJCh0aGlzKS5hdHRyKCdSZXF1aXJlZFZhbGlkYXRpb24nKSA9PSAndHJ1ZScpDQoJCQllcnJvckhhbmRsZXIodGhpcyk7DQoJfSk7DQoJLyokKCdpbnB1dFtGaWx0ZXI9IkFscGhhTnVtZXJpYyJdJykub24oJ2tleWRvd24nLCBmdW5jdGlvbihldmVudCl7DQoJCWlmKGV2ZW50LmtleUNvZGUgPT0gMTMpew0KCQkJdmFyIGVsZW1JZCA9IGV2ZW50LnRhcmdldC5pZDsNCgkJCXZhciBuZXdFbGVtID0gJCgnIycrZWxlbUlkKTsNCgkJCXNwZWNpYWxDaGFySGFuZGxlcihuZXdFbGVtKTsNCgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCX0NCgl9KTsqLw0KCSQoJ2lucHV0W0ZpbHRlcj0iTnVtZXJpYyJdJykub24oJ2JsdXInLCBmdW5jdGlvbihldmVudCl7DQoJCWV2ZW50LnRhcmdldC52YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZS5yZXBsYWNlKC9bXjAtOV18XHMrfFxyP1xufFxyL2dtaSwgIiIpOw0KCQlpZigkKHRoaXMpLmF0dHIoJ1JlcXVpcmVkVmFsaWRhdGlvbicpID09ICd0cnVlJykNCgkJCWVycm9ySGFuZGxlcih0aGlzKTsNCgl9KTsNCgkkKCdpbnB1dFtGaWx0ZXI9IkFscGhhIl0nKS5vbignYmx1cicsIGZ1bmN0aW9uKGV2ZW50KXsNCgkJZXZlbnQudGFyZ2V0LnZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlLnJlcGxhY2UoL1teYS16XXxccyt8XHI/XG58XHIvZ21pLCAiIik7DQoJCWlmKCQodGhpcykuYXR0cignUmVxdWlyZWRWYWxpZGF0aW9uJykgPT0gJ3RydWUnKQ0KCQkJZXJyb3JIYW5kbGVyKHRoaXMpOw0KCX0pOw0KDQoJJCgnaW5wdXRbRmlsdGVyPSJFbWFpbCJdJykuZWFjaChmdW5jdGlvbigpew0KCQljcmVhdGVFbWFpbEZpbHRlcih0aGlzLGdldE1heENoYXIodGhpcykpOw0KCX0pOw0KDQoJLy9BZGRpbmcgYSBuZXcgY29kZSBibG9jayBmb3IgUGhvbmUgTnVtYmVyIHwgUjE5MC03Nw0KCSQoJ2lucHV0W0ZpbHRlcj0iUGhOdW1iZXIiXScpLm9uKCdibHVyJywgZnVuY3Rpb24oZXZlbnQpIHsNCgkJLy8gY3JlYXRlUGhvbmVGaWx0ZXIodGhpcyxnZXRNYXhDaGFyKHRoaXMpKTsNCgkJaWYgKCQodGhpcykuYXR0cignUmVxdWlyZWRWYWxpZGF0aW9uJykgPT0gJ3RydWUnKQ0KCQkJZXJyb3JIYW5kbGVyKHRoaXMpOw0KCX0pOw0KCSQoJ2lucHV0W0ZpbHRlcj0iQWx0TWFpbCJdJykub24oJ2JsdXInLCBmdW5jdGlvbihldmVudCkgew0KCQkvLyBjcmVhdGVQaG9uZUZpbHRlcih0aGlzLGdldE1heENoYXIodGhpcykpOw0KCQkJZXJyb3JIYW5kbGVyKHRoaXMpOw0KCX0pOw0KCSQoJ2lucHV0W0ZpbHRlcj0iUGhvbmUiXScpLm9uKCdibHVyJywgZnVuY3Rpb24oZXZlbnQpIHsNCgkJLy8gY3JlYXRlUGhvbmVGaWx0ZXIodGhpcyxnZXRNYXhDaGFyKHRoaXMpKTsNCgkJCWVycm9ySGFuZGxlcih0aGlzKTsNCgl9KTsNCgkkKCdmb3JtJykub24oJ3N1Ym1pdCcsZnVuY3Rpb24oZXZlbnQpew0KCQlpZigkKHRoaXMpLmZpbmQoJy5lcnJvck1lc3NhZ2UnKS5hdHRyKCdjbGFzcycpID09ICdlcnJvck1lc3NhZ2UnKXsgIC8vRGlydHkgZml4IGZvciBJRTguIE5lZWQgdG8gcmV2aXNpdCBpbiAyLjENCgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCX0NCgl9KTsNCg0KCWNyZWF0ZU1heENoYXJIYW5kbGVyKCdpbnB1dFtNYXgtQ2hhcl0nKTsNCgljcmVhdGVFcnJvckhhbmRsZXIoJCgnaW5wdXRbUmVxdWlyZWRWYWxpZGF0aW9uPSJ0cnVlIl0nKSk7DQoJY3JlYXRlRXJyb3JIYW5kbGVyKCQoJ3NlbGVjdFtSZXF1aXJlZFZhbGlkYXRpb249InRydWUiXScpLHRydWUpOw0KCWNyZWF0ZUVycm9ySGFuZGxlcigkKCd0ZXh0YXJlYVtSZXF1aXJlZFZhbGlkYXRpb249InRydWUiXScpKTsNCg0KCS8vVGhpcyBpcyBmb3IgbWF0Y2hpbmcgZWxlbWVudHMgbGlrZSBjb25maXJtIGVtYWlsIGFuZCBlbWFpbC4gLSBBc2h3aW5pDQoJJCgnW21hdGNoXScpLmVhY2goZnVuY3Rpb24oKXsNCgkJdmFyIG1hdGNoaW5nRWwgPSAkKHRoaXMpOw0KCQl2YXIgbWF0Y2hJZCA9ICQodGhpcykuYXR0cignbWF0Y2gnKTsNCgkJdmFyIGhvc3RFbCA9ICQoJyMnKyBtYXRjaElkKTsNCg0KCQlob3N0RWwuYXR0cignY29tcGFyZUVsJywgbWF0Y2hpbmdFbC5hdHRyKCdpZCcpKTsNCg0KCQlob3N0RWwub24oJ2JsdXIga2V5dXAnLGZ1bmN0aW9uKGV2ZW50KXsNCgkJCWlmKG1hdGNoaW5nRWwudmFsKCkudG9Mb3dlckNhc2UoKSA9PSAkKHRoaXMpLnZhbCgpLnRvTG93ZXJDYXNlKCkpew0KCQkJCWlmKG1hdGNoaW5nRWwuaGFzQ2xhc3MoJ2Vycm9yRWxlbWVudCcpKXsNCgkJCQljbGVhckVycm9yTWVzc2FnZShtYXRjaGluZ0VsKTsNCgkJCQl9DQoJCQl9DQoJCX0pOw0KCQltYXRjaGluZ0VsLm9uKCdibHVyIGtleXVwJyxmdW5jdGlvbihldmVudCl7DQoJCQlpZigkKHRoaXMpLnZhbCgpLnRvTG93ZXJDYXNlKCkgPT0gaG9zdEVsLnZhbCgpLnRvTG93ZXJDYXNlKCkpew0KCQkJCWlmKG1hdGNoaW5nRWwuaGFzQ2xhc3MoJ2Vycm9yRWxlbWVudCcpKXsNCgkJCQljbGVhckVycm9yTWVzc2FnZSh0aGlzKTsNCgkJCQl9DQoJCQl9DQoJCX0pOw0KDQoJCWlmKG1hdGNoaW5nRWwuYXR0cignbWlzTWF0Y2hFcnJvcicpID09IHVuZGVmaW5lZCl7DQoJCQltYXRjaGluZ0VsLmF0dHIoJ21pc01hdGNoRXJyb3InLCBtYXRjaGluZ0VsLmF0dHIoJ2Vycm9yTWVzc2FnZScpKTsNCgkJfQ0KCX0pOw0KDQoJLy9UaGlzIHdpbGwgY3JlYXRlIGVuYWJsaW5nIGFuZCBkaXNhYmxpbmcgbG9naWMgZm9yIGJ1dHRvbnMuIExpa2UgZW1haWwgZm9ybSBzdWJtaXQgYnV0dG9uLiAgLSBBc2h3aW5pDQoJLy9Vbmxlc3MgYWxsIHRoZSBkZXBlbmRpbmcgZWxlbWVudHMgYXJlIGZpbGxlZCwgVGhlIEJ1dHRvbiB3aWxsIGJlIGRpc2FibGVkLg0KCSQoJ1thY3RpdmVEZXBlbmRlbmN5XScpLmVhY2goZnVuY3Rpb24oKXsNCgkJdmFyIGVuYWJsaW5nRWwgPSAkKHRoaXMpOw0KCQl2YXIgZGVwZW5kZWN5RWxlbWVudHMgPSBuZXcgQXJyYXkoKTsNCgkJZW5hYmxpbmdFbC5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJykuYXR0cignYXJpYS1kaXNhYmxlZCcsJ3RydWUnKTsvLy5yZW1vdmVDbGFzcygic3RhbmRhcmRCdG4iKS5hZGRDbGFzcygiZGlzYWJsZWRCdG4iKTsNCgkJZGVwZW5kZWN5RWxlbWVudHMgPSBlbmFibGluZ0VsLmF0dHIoJ2FjdGl2ZURlcGVuZGVuY3knKTsNCgkJZGVwZW5kZWN5RWxlbWVudHMgPSAkLnRyaW0oZGVwZW5kZWN5RWxlbWVudHMpLnNwbGl0KCcsJyk7DQoJCWNoZWNrRm9yRW5hYmxpbmcoZGVwZW5kZWN5RWxlbWVudHMsZW5hYmxpbmdFbCk7IC8qIFRoaXMgd2lsbCBjaGVjayBpZiB0aGUgc3VibWl0IHNob3VsZCBiZSBhY3R1YWxseSBkaXNhYmxlZCAvIG5vdCBhbmQgdGhlbiBkaXNhYmxlIHRoZSBidXR0b24gLyBub3QgKi8NCgkJJC5lYWNoKGRlcGVuZGVjeUVsZW1lbnRzLGZ1bmN0aW9uKGluZGV4LCB2YWx1ZSl7DQoJCQl2YWx1ZSA9ICQudHJpbSh2YWx1ZSk7DQoJCQlpZighKHZhbHVlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigicmFkaW8iKSA+PSAwKSl7DQoJCQkJdmFyIGVsZW0gPSAkKCcjJyt2YWx1ZSk7DQoJCQkJaWYoZWxlbS5oYXNDbGFzcygiaHBTdHlsZURyb3Bkb3duTGlnaHQiKSl7DQoJCQkJCXZhciB0ZW1wID0gJyMnK3ZhbHVlKydfZGRfbGlnaHQgdWwgbGknOw0KCQkJCX0NCgkJCQllbHNlew0KCQkJCQl2YXIgdGVtcCA9ICcjJyt2YWx1ZSsnX2RkIHVsIGxpJzsNCgkJCQl9DQoJCQl9DQoJCQllbHNlew0KCQkJCWlmKCQoIiMiK3ZhbHVlKS5sZW5ndGggPiAwKXsNCgkJCQkJaWYoJCgiIyIrdmFsdWUpLmlzKCJJTlBVVCIpKXsNCgkJCQkJCXZhciBlbGVtID0gJCgnIycrdmFsdWUpOw0KCQkJCQl9DQoJCQkJCWVsc2V7DQoJCQkJCQl2YXIgZWxlbSA9ICQoJy4nK3ZhbHVlKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCQllbHNlew0KCQkJCQl2YXIgZWxlbSA9ICQoJy4nK3ZhbHVlKTsNCgkJCQl9DQoJCQl9DQoJCQkvLyBlbHNlIGlmKCh2YWx1ZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoInJhZGlvIikgPj0gMCkpew0KCQkJLy8gdmFyIGVsZW0gPSAkKCcuJyt2YWx1ZSk7DQoJCQkvLyB9DQoJCQlpZihlbGVtLnByb3AoJ3RhZ05hbWUnKSAhPSB1bmRlZmluZWQpew0KCQkJCWlmKCAoZWxlbS5wcm9wKCJ0YWdOYW1lIikudG9Mb3dlckNhc2UoKSA9PSAiaW5wdXQiICYmIChlbGVtLmF0dHIoJ3R5cGUnKS50b0xvd2VyQ2FzZSgpID09ICJ0ZXh0IiB8fCBlbGVtLmF0dHIoJ3R5cGUnKS50b0xvd2VyQ2FzZSgpID09ICJoaWRkZW4iIHx8IGVsZW0uYXR0cigidHlwZSIpLnRvTG93ZXJDYXNlKCkgPT0gInRlbCIgfHwgZWxlbS5hdHRyKCJ0eXBlIikudG9Mb3dlckNhc2UoKSA9PSAiZW1haWwiKSkgfHwgZWxlbS5wcm9wKCJ0YWdOYW1lIikudG9Mb3dlckNhc2UoKSA9PSAidGV4dGFyZWEiKXsNCgkJCQkJZWxlbS5vbigna2V5ZG93biBrZXl1cCcsZnVuY3Rpb24oKXsNCgkJCQkJCWNoZWNrRm9yRW5hYmxpbmcoZGVwZW5kZWN5RWxlbWVudHMsZW5hYmxpbmdFbCk7DQoJCQkJCX0pOw0KCQkJCQllbGVtLm9uKCdjaGFuZ2UnLGZ1bmN0aW9uKGV2ZW50KXsNCgkJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkge2NoZWNrRm9yRW5hYmxpbmcoZGVwZW5kZWN5RWxlbWVudHMsZW5hYmxpbmdFbCl9LCAxKTsNCgkJCQkJfSk7DQoJCQkJCWVsZW0ub24oJ3Bhc3RlJyxmdW5jdGlvbihldmVudCl7DQoJCQkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtjaGVja0ZvckVuYWJsaW5nKGRlcGVuZGVjeUVsZW1lbnRzLGVuYWJsaW5nRWwpfSwgMSk7DQoJCQkJCX0pOw0KCQkJCQllbGVtLm9uKCdpbnB1dCcsZnVuY3Rpb24oZXZlbnQpew0KCQkJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7Y2hlY2tGb3JFbmFibGluZyhkZXBlbmRlY3lFbGVtZW50cyxlbmFibGluZ0VsKX0sIDEpOw0KCQkJCQl9KTsNCgkJCQkJalF1ZXJ5KGRvY3VtZW50KS5vbigiZHJhZ2VuZCIgLCBmdW5jdGlvbihldmVudCl7DQoJCQkJCQljaGVja0ZvckVuYWJsaW5nKGRlcGVuZGVjeUVsZW1lbnRzLGVuYWJsaW5nRWwpOw0KCQkJCQl9KTsNCgkJCQl9DQoJCQkJZWxzZSBpZihlbGVtLnByb3AoInRhZ05hbWUiKS50b0xvd2VyQ2FzZSgpID09ICJzZWxlY3QiKXsNCgkJCQkJJCh0ZW1wKS5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkJCQkkKHRoaXMpLm9uKCdjbGljaycsZnVuY3Rpb24oZXZlbnQpew0KCQkJCQkJCWNoZWNrRm9yRW5hYmxpbmcoZGVwZW5kZWN5RWxlbWVudHMsZW5hYmxpbmdFbCk7DQoJCQkJCQl9KTsNCgkJCQkJfSk7DQoJCQkJfQ0KCQkJCWVsc2UgaWYoZWxlbS5wcm9wKCJ0YWdOYW1lIikudG9Mb3dlckNhc2UoKSA9PSAiaW5wdXQiICYmIGVsZW0uYXR0cigndHlwZScpLnRvTG93ZXJDYXNlKCkgPT0gInJhZGlvIil7DQoJCQkJCXZhciBlbE5hbWUgPSBlbGVtLmF0dHIoJ25hbWUnKTsNCgkJCQkJJCgnaW5wdXRbbmFtZT0iJytlbE5hbWUrJyJdJykub24oJ2lmQ2hhbmdlZCcsIGZ1bmN0aW9uKGV2ZW50KXsNCgkJCQkJCWNoZWNrRm9yRW5hYmxpbmcoZGVwZW5kZWN5RWxlbWVudHMsZW5hYmxpbmdFbCk7DQoJCQkJCX0pOw0KCQkJCX0NCgkJCQllbHNlIGlmKGVsZW0ucHJvcCgidGFnTmFtZSIpLnRvTG93ZXJDYXNlKCkgPT0gImlucHV0IiAmJiBlbGVtLmF0dHIoJ3R5cGUnKS50b0xvd2VyQ2FzZSgpID09ICJjaGVja2JveCIpew0KCQkJCQkkKCdpbnB1dFtuYW1lPSInK2VsTmFtZSsnIl0nKS5vbignaWZDaGFuZ2VkJywgZnVuY3Rpb24oZXZlbnQpew0KCQkJCQkJY2hlY2tGb3JFbmFibGluZyhkZXBlbmRlY3lFbGVtZW50cyxlbmFibGluZ0VsKTsNCgkJCQkJfSk7DQoJCQkJfQ0KCQkJfQ0KCQl9KTsNCgkJJCh0aGlzKS5vbignY2xpY2snLGZ1bmN0aW9uKGV2ZW50KXsNCgkJCSQuZWFjaChkZXBlbmRlY3lFbGVtZW50cyxmdW5jdGlvbihrZXksdmFsdWUpew0KCQkJCXZhbHVlID0gJC50cmltKHZhbHVlKTsNCgkJCQl2YXIgZWxlbSA9ICcjJyt2YWx1ZTsNCgkJCQllcnJvckhhbmRsZXIoZWxlbSk7DQoJCQkJaWYoJChlbGVtKS5oYXNDbGFzcygnZXJyb3JFbGVtZW50Jykpew0KCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCX0NCgkJCX0pOw0KCQl9KTsNCg0KCQkkKHRoaXMpLm9uKCdrZXlkb3duJyxmdW5jdGlvbigpew0KCQkJdmFyIGV2ZW50S2V5Q29kZSA9IGV2ZW50LmtleUNvZGUgPyBldmVudC5rZXlDb2RlIDogZXZlbnQud2hpY2g7DQoJCQlpZihldmVudEtleUNvZGUgPT0gMTMpew0KCQkJCSQuZWFjaChkZXBlbmRlY3lFbGVtZW50cyxmdW5jdGlvbihrZXksdmFsdWUpew0KCQkJCQl2YWx1ZSA9ICQudHJpbSh2YWx1ZSk7DQoJCQkJCXZhciBlbGVtID0gJyMnK3ZhbHVlOw0KCQkJCQllcnJvckhhbmRsZXIoZWxlbSk7DQoJCQkJCWlmKCQoZWxlbSkuaGFzQ2xhc3MoJ2Vycm9yRWxlbWVudCcpKXsNCgkJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQkJCX0NCgkJCQl9KTsNCgkJCX0NCgkJfSk7DQoJfSk7DQoNCg0KDQoJLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tY2xlYXIgZXhjZXNzIGRhdGEgb24gYmx1ciBiYXNlZCBvbiBtYXgtY2hhciAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCgkkKCdpbnB1dFttYXgtY2hhcl0nKS5vbignYmx1cicsZnVuY3Rpb24oKXsNCgkJaWYoICQodGhpcykudmFsKCkubGVuZ3RoID4gJCh0aGlzKS5hdHRyKCdtYXgtY2hhcicpICYmICQodGhpcykudmFsKCkgIT0gJCh0aGlzKS5hdHRyKCdnaG9zdHRleHQnKSApDQoJCXsNCgkJCSQodGhpcykudmFsKCQodGhpcykudmFsKCkuc3Vic3RyaW5nKCAwICwgJCh0aGlzKS5hdHRyKCdtYXgtY2hhcicpICkgKQ0KCQl9DQoJfSk7DQoNCgkvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLw0KLy9HZXRzIG9yIHNldHMgdGhlIG1heCBjaGFyIC0gQXNod2luaQ0KZnVuY3Rpb24gZ2V0TWF4Q2hhcihlbCl7DQoJcmV0dXJuICQoZWwpLmF0dHIoJ01heC1DaGFyJykgPyAkKGVsKS5hdHRyKCdNYXgtQ2hhcicpIDogMjk7DQp9DQoNCmZ1bmN0aW9uIHNwZWNpYWxDaGFySGFuZGxlcihlbGVtKXsNCgl2YXIgc3BlY2lhbFJlZ0V4ID0gbmV3IFJlZ0V4cCgvW15hLXowLTldfFxzK3xccj9cbnxcci9nbWkpOw0KCXZhciB0ZW1wPWVsZW07DQoJaWYoZWxlbS52YWwoKS5tYXRjaChzcGVjaWFsUmVnRXgpKSB7DQoJCWVsZW0udmFsKCIiKTsNCgl9DQp9DQoNCi8vTG9naWMgdG8gY3JlYXRlIGVycm9yIG1lc3NhZ2UgLSBBc2h3aW5pDQovL2F0dHIgLSBlcnJvclBvc2l0aW9uID0gImJyIiwgd2lsbCBzaG93IHRoZSBlcnJvciBtZXNzZ2FlIGJlbG93LiBFbHNlLCBlcnJvciBtZXNzYWdlIHdpbGwgYmUgc2hvd24gYWJvdmUgdGhlIGVycm9yIGVsZW1lbnQuDQpjcmVhdGVFcnJvck1lc3NhZ2UgPSBmdW5jdGlvbihlbCwgbXNnKSB7DQoJaWYgKCQoZWwpLnByb3AoJ3RhZ05hbWUnKS50b0xvd2VyQ2FzZSgpID09ICJzZWxlY3QiKSB7DQoJCWlmICgkKGVsKS5hdHRyKCdlcnJvclBvc2l0aW9uJykgIT0gdW5kZWZpbmVkKSB7DQoJCQlpZiAoJChlbCkuaGFzQ2xhc3MoImhwU3R5bGVEcm9wZG93bkxpZ2h0IikpIHsNCgkJCQkkKCcjJyArICQoZWwpLmF0dHIoJ2lkJykgKyAnX2RkX2xpZ2h0JykuYXR0cignZXJyb3JQb3NpdGlvbicsICQoZWwpLmF0dHIoJ2Vycm9yUG9zaXRpb24nKSk7DQoJCQl9IGVsc2Ugew0KCQkJCSQoJyMnICsgJChlbCkuYXR0cignaWQnKSArICdfZGQnKS5hdHRyKCdlcnJvclBvc2l0aW9uJywgJChlbCkuYXR0cignZXJyb3JQb3NpdGlvbicpKTsNCgkJCX0NCgkJfQ0KCQlpZiAoJChlbCkuaGFzQ2xhc3MoImhwU3R5bGVEcm9wZG93bkxpZ2h0IikpIHsNCgkJCWVsID0gJCgnIycgKyAkKGVsKS5hdHRyKCdpZCcpICsgJ19kZF9saWdodCcpOw0KCQl9IGVsc2Ugew0KCQkJZWwgPSAkKCcjJyArICQoZWwpLmF0dHIoJ2lkJykgKyAnX2RkJyk7DQoJCX0NCgl9DQoJaWYgKCEkKGVsKS5oYXNDbGFzcygnZXJyb3JFbGVtZW50JykpIHsNCgkJLy9IaWRlIHRoZSBoZWxwIHRleHQgbGFiZWwNCgkJJChlbCkuc2libGluZ3MoJy5oZWxwbGFiZWx0ZXh0JykuaGlkZSgpOw0KDQoJCW1zZyA9IG1zZyA/IG1zZyA6ICdFcnJvciBPY2N1cmVkJzsNCgkJdmFyIGVycm9yUG9zaXRpb24gPSAkKGVsKS5hdHRyKCdlcnJvclBvc2l0aW9uJyk7DQoJCXZhciBlcnJvckNvbnRhaW5lciA9ICQoZWwpLmF0dHIoJ2Vycm9yQ29udGFpbmVyJyk7DQoJCWlmIChlcnJvclBvc2l0aW9uICYmIGVycm9yUG9zaXRpb24gPT0gJ2JyJykgew0KCQkJaWYgKGVycm9yQ29udGFpbmVyKSB7DQoJCQkJJCgnPHNwYW4gY2xhc3M9ImVycm9yTWVzc2FnZSI+JyArICc8c3BhbiBjbGFzcz0iZXJyb3JJY29uIj48L3NwYW4+JyArIG1zZyArICc8L3NwYW4+JykuYXBwZW5kVG8oIi4iICsgZXJyb3JDb250YWluZXIpOw0KCQkJfSBlbHNlIHsNCgkJCQkkKCc8ZGl2IGNsYXNzPSJlcnJvck1lc3NhZ2UiIHJvbGU9ImFsZXJ0Ij4nICsgJzxzcGFuIGNsYXNzPSJlcnJvckljb24iPjwvc3Bhbj4nICsgbXNnICsgJzwvZGl2PicpLmluc2VydEFmdGVyKGVsKTsNCgkJCX0NCgkJfSBlbHNlIHsNCgkJCXZhciB0b3BPZmZzZXQgPSAkKGVsKS5wb3NpdGlvbigpLnRvcCAtIDE4Ow0KCQkJJCgnPGRpdiBjbGFzcz0iZXJyb3JNZXNzYWdlIiBzdHlsZT0idG9wOicgKyB0b3BPZmZzZXQgKyAncHgiPicgKyAnPHNwYW4gY2xhc3M9ImVycm9ySWNvbiI+PC9zcGFuPicgKyBtc2cgKyAnPC9kaXY+JykuaW5zZXJ0QmVmb3JlKGVsKTsNCgkJfQ0KCQkkKGVsKS5hZGRDbGFzcygnZXJyb3JFbGVtZW50Jyk7DQoJCSQoZWwpLmF0dHIoJ2FyaWEtaW52YWxpZCcsICd0cnVlJyk7DQoJfQ0KfQ0KDQovL0xvZ2ljIHRvIGNsZWFyIHRoZSBlcnJvciBtZXNzYWdlLiAtIEFzaHdpbmkNCmNsZWFyRXJyb3JNZXNzYWdlID0gZnVuY3Rpb24oZWwpIHsNCglpZiAoJChlbCkucHJvcCgndGFnTmFtZScpLnRvTG93ZXJDYXNlKCkgPT0gInNlbGVjdCIpIHsNCgkJaWYgKCQoZWwpLmhhc0NsYXNzKCJocFN0eWxlRHJvcGRvd25MaWdodCIpKSB7DQoJCQllbCA9ICQoJyMnICsgJChlbCkuYXR0cignaWQnKSArICdfZGRfbGlnaHQnKTsNCgkJfSBlbHNlIHsNCgkJCWVsID0gJCgnIycgKyAkKGVsKS5hdHRyKCdpZCcpICsgJ19kZCcpOw0KCQl9DQoJfQ0KCWlmICgkKGVsKS5oYXNDbGFzcygnZXJyb3JFbGVtZW50JykgJiYgJChlbCkuYXR0cignZXJyb3JQb3NpdGlvbicpICE9IHVuZGVmaW5lZCAmJiAkKGVsKS5hdHRyKCdlcnJvclBvc2l0aW9uJykgPT0gJ2JyJykgew0KCQlpZiAoJChlbCkubmV4dCgpLmhhc0NsYXNzKCdlcnJvck1lc3NhZ2UnKSkNCgkJCSQoZWwpLm5leHQoKS5yZW1vdmUoKTsNCgkJZWxzZSBpZiAoJChlbCkucHJldigpLmhhc0NsYXNzKCdlcnJvck1lc3NhZ2UnKSkNCgkJCSQoZWwpLnByZXYoKS5yZW1vdmUoKTsNCgkJJChlbCkucmVtb3ZlQ2xhc3MoJ2Vycm9yRWxlbWVudCcpOw0KCQkkKGVsKS5yZW1vdmVBdHRyKCdhcmlhLWludmFsaWQnKTsNCg0KCQkvL1Nob3cgdGhlIGhlbHAgdGV4dCBsYWJlbA0KCQkkKGVsKS5zaWJsaW5ncygnLmhlbHBsYWJlbHRleHQnKS5zaG93KCk7DQoJfSBlbHNlIGlmICgkKGVsKS5oYXNDbGFzcygnZXJyb3JFbGVtZW50JykpIHsNCgkJaWYgKCQoZWwpLm5leHQoKS5oYXNDbGFzcygnZXJyb3JNZXNzYWdlJykpDQoJCQkkKGVsKS5uZXh0KCkucmVtb3ZlKCk7DQoJCWVsc2UgaWYgKCQoZWwpLnByZXYoKS5oYXNDbGFzcygnZXJyb3JNZXNzYWdlJykpDQoJCQkkKGVsKS5wcmV2KCkucmVtb3ZlKCk7DQoJCSQoZWwpLnJlbW92ZUNsYXNzKCdlcnJvckVsZW1lbnQnKTsNCgkJJChlbCkucmVtb3ZlQXR0cignYXJpYS1pbnZhbGlkJyk7DQoNCgkJLy9TaG93IHRoZSBoZWxwIHRleHQgbGFiZWwNCgkJJChlbCkuc2libGluZ3MoJy5oZWxwbGFiZWx0ZXh0Jykuc2hvdygpOw0KCX0NCgl2YXIgZXJyb3JDb250YWluZXIgPSAkKGVsKS5hdHRyKCdlcnJvckNvbnRhaW5lcicpOw0KCWlmIChlcnJvckNvbnRhaW5lcikgew0KCQkkKCIuIiArIGVycm9yQ29udGFpbmVyKS5maW5kKCIuZXJyb3JNZXNzYWdlIikucmVtb3ZlKCk7DQoJCSQoZWwpLnJlbW92ZUNsYXNzKCdlcnJvckVsZW1lbnQnKTsNCgkJJChlbCkucmVtb3ZlQXR0cignYXJpYS1pbnZhbGlkJyk7DQoJfQ0KfQ0KDQpqUXVlcnkoIiNwcm9kdWN0TmFtZSIpLm9uKCAia2V5dXAiLCBmdW5jdGlvbihlKSB7DQogICAgdmFyIGtleSA9IGUua2V5Q29kZSB8fCBlLndoaWNoOw0KICAgIHZhciBsZXR0ZXJzQ291bnQgPSBqUXVlcnkoIiNwcm9kdWN0TmFtZSIpLnZhbCgpOw0KICAgIHZhciBlbHMgPSAkKCIjcHJvZHVjdE5hbWUiKTsNCiAgICBpZihrZXkgPT0gMTMpew0KICAgIGlmIChsZXR0ZXJzQ291bnQgPT0gJycpew0KDQogICAgdmFyIG1zZyA9ICQoZWxzKS5hdHRyKCdlcnJvck1lc3NhZ2UnKSA/ICQoZWxzKS5hdHRyKCdlcnJvck1lc3NhZ2UnKSA6ICJNYW5kYXRvcnkgRmllbGQiOw0KCSAgICBpZighJChlbHMpLmhhc0NsYXNzKCdlcnJvckVsZW1lbnQnKSl7DQoJICAgICAgICAgICAgICAgICAgICBjcmVhdGVFcnJvck1lc3NhZ2UoZWxzLG1zZyk7DQoJICAgICAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlew0KICAgIAljbGVhckVycm9yTWVzc2FnZShlbHMpOw0KICAgIAl9DQp9DQplbHNlew0KY2xlYXJFcnJvck1lc3NhZ2UoZWxzKTsNCn0NCn0pOw0KfQ0KDQovL1RoaXMgc2VjdGlvbiBtYWtlcyBzdXJlIHRoZSB0ZXh0L3RleHQgYXJlYSB3aWxsIG5vdCBhY2NlcHQgbW9yZSB0aGFuIHNwZWNpZmllZCBtYXggY2hhci4gLSBBc2h3aW5pDQovL0hhbmRsZWQgZm9yIHR5cGUsIGRyYWctZHJvcCBhbmQgY29weS1wYXN0ZS4NCmZ1bmN0aW9uIGNyZWF0ZU1heENoYXJIYW5kbGVyKGVsZUlkKXsNCglpZighJChlbGVJZCkuYXR0cignRmlsdGVyJykgfHwgJChlbGVJZCkuYXR0cignTWF4LUNoYXInKSl7DQoJCSQoZWxlSWQpLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZXZlbnQpIHsNCgkJCXZhciBldmVudEtleUNvZGUgPSBldmVudC5rZXlDb2RlIHx8IGUud2hpY2g7DQoJCQlpZigoZXZlbnQudGFyZ2V0LnZhbHVlLmxlbmd0aCA+ICQodGhpcykuYXR0cignTWF4LUNoYXInKSkgJiYgZXZlbnRLZXlDb2RlIT0gOCAmJiBldmVudEtleUNvZGUhPSAxMjcpew0KCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQl9DQoNCgkJCX0pLmJpbmQoe3Bhc3RlOiBmdW5jdGlvbihldmVudCl7DQoJCQkvL2V2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQkvLyQodGhpcykudmFsKCQodGhpcykudmFsKCkrZXZlbnQub3JpZ2luYWxFdmVudC5jbGlwYm9hcmREYXRhLmdldERhdGEoJ1RleHQnKSk7DQoJCQkJaWYoJCh0aGlzKS5hdHRyKCdNYXgtQ2hhcicpICYmIGV2ZW50LnRhcmdldC52YWx1ZS5sZW5ndGggPiAkKHRoaXMpLmF0dHIoJ01heC1DaGFyJykpDQoJCQkJew0KCQkJCQkkKHRoaXMpLnZhbCgkKHRoaXMpLnZhbCgpLnN1YnN0cmluZygwLCQodGhpcykuYXR0cignTWF4LUNoYXInKSkpOw0KCQkJCX0NCgkJCX19KTsNCgl9DQp9DQoNCi8vQ3JlYXRpb24gb2YgTnVtZXJpYyBGaWx0ZXIgLSBBc2h3aW5pDQpmdW5jdGlvbiBjcmVhdGVOdW1lcmljRmlsdGVyKGVsZUlkLCB0eHRMZW5ndGgpew0KCSQoZWxlSWQpLm9uKCdrZXlkb3duIGtleXVwJywgZnVuY3Rpb24oZXZlbnQpIHsNCgkJLy9DaGVjayBpZiBpdCBzcGVjaWFsIGtleSBsaWtlIHRhYiwgbnVtYmVybG9jayBldGMuDQoJCWlmKGV2ZW50LmNoYXJDb2RlID09IDApDQoJCQlyZXR1cm47DQoNCgkJLy9DaGVjayBmb3IgZmlsdGVyIGVsZW1lbnQNCgkJaWYoIS9eWzAtOV0rJC9pLnRlc3QoU3RyaW5nLmZyb21DaGFyQ29kZShldmVudC53aGljaCkpKXsNCgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQkvL0lmIHZhbHVlIGlzIGV4Y2VlZGluZyBtYXgtbGVuZ3RoIGF0dHJpYnV0ZSwgdHJpbSBpdA0KCQlpZigkKHRoaXMpLnZhbCgpLmxlbmd0aCA+IHR4dExlbmd0aCAmJiAkKHRoaXMpLnZhbCgpICE9ICQodGhpcykuYXR0cignZ2hvc3R0ZXh0JykpDQoJCXsNCgkJCSQodGhpcykudmFsKCQodGhpcykudmFsKCkuc3Vic3RyaW5nKDAsdHh0TGVuZ3RoKSkNCgkJfQ0KCQl9KS5iaW5kKHtwYXN0ZTogZnVuY3Rpb24oZXZlbnQpew0KCQkJZXZlbnQudGFyZ2V0LnZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlLnJlcGxhY2UoL1teMC05XXxccyt8XHI/XG58XHIvZ21pLCAiIik7DQoNCgkJCS8vSWYgdmFsdWUgaXMgZXhjZWVkaW5nIG1heC1sZW5ndGggYXR0cmlidXRlLCB0cmltIGl0DQoJCQlpZihldmVudC50YXJnZXQudmFsdWUubGVuZ3RoID4gdHh0TGVuZ3RoKQ0KCQkJew0KCQkJCSQodGhpcykudmFsKCQodGhpcykudmFsKCkuc3Vic3RyaW5nKDAsIHR4dExlbmd0aCkpOw0KCQkJfQ0KCQl9DQoJfSk7DQp9DQoNCi8vQ3JlYXRpb24gb2YgQWxwaGFiZXRpYyBmaWx0ZXIgLSBBc2h3aW5pDQpmdW5jdGlvbiBjcmVhdGVBbHBoYWJldGljRmlsdGVyKGVsZUlkLCB0eHRMZW5ndGgpew0KCSQoZWxlSWQpLm9uKCdrZXlkb3duIGtleXVwJyxmdW5jdGlvbihldmVudCkgew0KCQkvL0NoZWNrIGlmIGl0IHNwZWNpYWwga2V5IGxpa2UgdGFiLCBudW1iZXJsb2NrIGV0Yy4NCgkJaWYoZXZlbnQuY2hhckNvZGUgPT0gMCkNCgkJCXJldHVybjsNCg0KCQkvL0NoZWNrIGZvciBmaWx0ZXIgZWxlbWVudA0KCQlpZighL15bQS1aXSskL2kudGVzdChTdHJpbmcuZnJvbUNoYXJDb2RlKGV2ZW50LndoaWNoKSkpew0KCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCS8vSWYgdmFsdWUgaXMgZXhjZWVkaW5nIG1heC1sZW5ndGggYXR0cmlidXRlLCB0cmltIGl0DQoJCWlmKCQodGhpcykudmFsKCkubGVuZ3RoID4gdHh0TGVuZ3RoICYmICQodGhpcykudmFsKCkgIT0gJCh0aGlzKS5hdHRyKCdnaG9zdHRleHQnKSkNCgkJew0KCQkJJCh0aGlzKS52YWwoJCh0aGlzKS52YWwoKS5zdWJzdHJpbmcoMCx0eHRMZW5ndGgpKQ0KCQl9DQoJfSkuYmluZCh7cGFzdGU6IGZ1bmN0aW9uKGV2ZW50KXsNCgkJCWV2ZW50LnRhcmdldC52YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZS5yZXBsYWNlKC9bXmEtel18XHMrfFxyP1xufFxyL2dtaSwgIiIpOw0KDQoJCQkvL0lmIHZhbHVlIGlzIGV4Y2VlZGluZyBtYXgtbGVuZ3RoIGF0dHJpYnV0ZSwgdHJpbSBpdA0KCQkJaWYoZXZlbnQudGFyZ2V0LnZhbHVlLmxlbmd0aCA+IHR4dExlbmd0aCkNCgkJCXsNCgkJCQkkKHRoaXMpLnZhbCgkKHRoaXMpLnZhbCgpLnN1YnN0cmluZygwLCB0eHRMZW5ndGgpKTsNCgkJCX0NCgkJfQ0KCX0pOw0KfQ0KDQovL0NyZWF0aW9uIG9mIEFscGhhbnVtZXJpYyBmaWx0ZXIgLSBBc2h3aW5pDQpmdW5jdGlvbiBjcmVhdGVBbHBoYU51bWVyaWNGaWx0ZXIoZWxlSWQsIHR4dExlbmd0aCl7DQoJJChlbGVJZCkub24oJ2tleWRvd24ga2V5dXAnLGZ1bmN0aW9uKGV2ZW50KSB7DQoJCS8vQ2hlY2sgaWYgaXQgc3BlY2lhbCBrZXkgbGlrZSB0YWIsIG51bWJlcmxvY2sgZXRjLg0KCQlpZihldmVudC5jaGFyQ29kZSA9PSAwKQ0KCQkJcmV0dXJuOw0KDQoJCS8vQ2hlY2sgZm9yIGZpbHRlciBlbGVtZW50DQoJCWlmKCEvXltBLVowLTldKyQvaS50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoZXZlbnQud2hpY2gpKSl7DQoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJLy9JZiB2YWx1ZSBpcyBleGNlZWRpbmcgbWF4LWxlbmd0aCBhdHRyaWJ1dGUsIHRyaW0gaXQNCgkJaWYoJCh0aGlzKS52YWwoKS5sZW5ndGggPiB0eHRMZW5ndGggJiYgJCh0aGlzKS52YWwoKSAhPSAkKHRoaXMpLmF0dHIoJ2dob3N0dGV4dCcpKXsNCgkJCSQodGhpcykudmFsKCQodGhpcykudmFsKCkuc3Vic3RyaW5nKDAsdHh0TGVuZ3RoKSkNCgkJfQ0KCX0pLmJpbmQoe3Bhc3RlOiBmdW5jdGlvbihldmVudCl7DQoJCQlldmVudC50YXJnZXQudmFsdWUgPSBldmVudC50YXJnZXQudmFsdWUucmVwbGFjZSgvW15hLXowLTldfFxzK3xccj9cbnxcci9nbWksICIiKTsNCg0KCQkJLy9JZiB2YWx1ZSBpcyBleGNlZWRpbmcgbWF4LWxlbmd0aCBhdHRyaWJ1dGUsIHRyaW0gaXQNCgkJCWlmKGV2ZW50LnRhcmdldC52YWx1ZS5sZW5ndGggPiB0eHRMZW5ndGgpDQoJCQl7DQoJCQkJJCh0aGlzKS52YWwoJCh0aGlzKS52YWwoKS5zdWJzdHJpbmcoMCwgdHh0TGVuZ3RoKSk7DQoJCQl9DQoJCX0NCgl9KTsNCn0NCg0KLy8gY3JlYXRpbmcgcGhvbmUgZmlsdGVyDQpmdW5jdGlvbiBjcmVhdGVQaG9uZUZpbHRlcihlbGVJZCwgdHh0TGVuZ3RoKXsNCg0KDQoJdmFyIHBob25lUmVnID0gL15cKz9cZHswLDMwfSQvDQoJJChlbGVJZCkub24oJ2JsdXInLGZ1bmN0aW9uKGV2ZW50KSB7DQoJCWlmKCQodGhpcykudmFsKCkubGVuZ3RoID49IDEgJiYgIXBob25lUmVnLnRlc3QoJCh0aGlzKS52YWwoKSkgJiYgJCh0aGlzKS52YWwoKSAhPSAkKHRoaXMpLmF0dHIoJ2dob3N0VGV4dCcpKXsNCgkJCWNvbnNvbGUubG9nKCdlcnJvcicpDQoJCQl2YXIgbXNnID0gZ2V0RXJyb3JNZXNzYWdlKCQoZWxlSWQpKTsNCgkJCWNyZWF0ZUVycm9yTWVzc2FnZShlbGVJZCwgbXNnKTsNCgkJCQ0KCQkJLy8gZXJyb3JIYW5kbGVyKHRoaXMpOw0KCQl9IGVsc2Ugew0KCQkJY2xlYXJFcnJvck1lc3NhZ2UoZWxzKTsNCgkJfQ0KCQlpZihldmVudC50YXJnZXQudmFsdWUubGVuZ3RoID4gdHh0TGVuZ3RoICYmICQodGhpcykudmFsKCkgIT0gJCh0aGlzKS5hdHRyKCdnaG9zdHRleHQnKSkNCgkJCXsNCgkJCQkkKHRoaXMpLnZhbCgkKHRoaXMpLnZhbCgpLnN1YnN0cmluZygwLCB0eHRMZW5ndGgpKTsNCgkJCX0NCgkvKn0pLmJpbmQoe3Bhc3RlOiBmdW5jdGlvbihldmVudCl7DQoJCQlpZihldmVudC50YXJnZXQudmFsdWUubGVuZ3RoID4gdHh0TGVuZ3RoKQ0KCQkJew0KCQkJCSQodGhpcykudmFsKCQodGhpcykudmFsKCkuc3Vic3RyaW5nKDAsIHR4dExlbmd0aCkpOw0KCQkJfQ0KCQl9Ki8NCgl9KTsNCn0NCg0KLy9DcmVhdGlvbiBvZiBFbWFpbCBmaWx0ZXIgLSBBc2h3aW5pDQpmdW5jdGlvbiBjcmVhdGVFbWFpbEZpbHRlcihlbGVJZCwgdHh0TGVuZ3RoKXsNCg0KCXZhciBlbWFpbFJlZyA9IC9bXFNdK0BbXFNdK1wuW2EtekEtWl17Miw0fS8NCgl2YXIgbWluQ2hhciA9ICQodGhpcykuYXR0cignbWluLWNoYXInKSB8fCAxOw0KCSQoZWxlSWQpLm9uKCdibHVyJyxmdW5jdGlvbihldmVudCkgew0KDQoJCWlmKCQodGhpcykudmFsKCkubGVuZ3RoID49bWluQ2hhciAmJiAhZW1haWxSZWcudGVzdCgkLnRyaW0oJCh0aGlzKS52YWwoKSkpICYmICQodGhpcykudmFsKCkgIT0gJCh0aGlzKS5hdHRyKCdnaG9zdFRleHQnKSl7DQoJCQllcnJvckhhbmRsZXIodGhpcyk7DQoJCX0NCgkJaWYoZXZlbnQudGFyZ2V0LnZhbHVlLmxlbmd0aCA+IHR4dExlbmd0aCAmJiAkKHRoaXMpLnZhbCgpICE9ICQodGhpcykuYXR0cignZ2hvc3R0ZXh0JykpDQoJCQl7DQoJCQkJJCh0aGlzKS52YWwoJCh0aGlzKS52YWwoKS5zdWJzdHJpbmcoMCwgdHh0TGVuZ3RoKSk7DQoJCQl9DQoJLyp9KS5iaW5kKHtwYXN0ZTogZnVuY3Rpb24oZXZlbnQpew0KCQkJaWYoZXZlbnQudGFyZ2V0LnZhbHVlLmxlbmd0aCA+IHR4dExlbmd0aCkNCgkJCXsNCgkJCQkkKHRoaXMpLnZhbCgkKHRoaXMpLnZhbCgpLnN1YnN0cmluZygwLCB0eHRMZW5ndGgpKTsNCgkJCX0NCgkJfSovDQoJfSk7DQp9DQoNCi8vQ2hlY2sgZm9yIHZhbGlkIGVtYWlsIElEIHBhdHRlcm4gLSBBc2h3aW5pDQpmdW5jdGlvbiBpc1ZhbGlkRW1haWxBZGRyZXNzKGVtYWlsQWRkcmVzcykgew0KICAgIHZhciBwYXR0ZXJuID0gbmV3ICBSZWdFeHAoL14oKChbYS16XXxcZHxbISNcJCUmJ1wqXCtcLVwvPVw/XF5fYHtcfH1+XXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkrKFwuKFthLXpdfFxkfFshI1wkJSYnXCpcK1wtXC89XD9cXl9ge1x8fX5dfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSspKil8KChceDIyKSgoKChceDIwfFx4MDkpKihceDBkXHgwYSkpPyhceDIwfFx4MDkpKyk/KChbXHgwMS1ceDA4XHgwYlx4MGNceDBlLVx4MWZceDdmXXxceDIxfFtceDIzLVx4NWJdfFtceDVkLVx4N2VdfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoXFwoW1x4MDEtXHgwOVx4MGJceDBjXHgwZC1ceDdmXXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkpKSkqKCgoXHgyMHxceDA5KSooXHgwZFx4MGEpKT8oXHgyMHxceDA5KSspPyhceDIyKSkpQCgoKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKShbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkqKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSkpXC4pKygoW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pfCgoW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKFthLXpdfFxkfC18XC58X3x+fFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSooW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKSlcLj8kL2kpOw0KICAgIHJldHVybiBwYXR0ZXJuLnRlc3QoZW1haWxBZGRyZXNzKTsNCn0NCg0KLy9DcmVhdGlvbiBvZiBlcnJvciBoYW5kbGVyIC0gQXNod2luaQ0KZnVuY3Rpb24gY3JlYXRlRXJyb3JIYW5kbGVyKGVscyxzZWxlY3RFbCl7DQoNCiAgICBlbHMuZWFjaChmdW5jdGlvbihrZXksdmFsKXsNCiAgICAgICAgaWYoc2VsZWN0RWwpew0KICAgICAgICB2YXIgc2VsZWN0QW5jaG9ySWQgPSAkKHRoaXMpLmF0dHIoImlkIikgKyAiX2RkX2hlYWRlckxpbmsiOw0KDQogICAgICAgIGlmKCEoJCh0aGlzKS5hdHRyKCdFcnJvckV4Y2VwdGlvbkV2ZW50JykgJiYgJCh0aGlzKS5hdHRyKCdFcnJvckV4Y2VwdGlvbkV2ZW50JykudG9Mb3dlckNhc2UoKS5pbmRleE9mKCJibHVyIikgPj0gMCkpew0KICAgICAgICAgICAgICAgICAgICAgICAgJCgiIyIrc2VsZWN0QW5jaG9ySWQpLmJsdXIoZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0RWxJZCA9ICQodGhpcykuYXR0cigiaWQiKS5zcGxpdCgiXyIpWzBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2ZUVsID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdEVsZW1lbnQgPSAkKCIjIitzZWxlY3RFbElkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2VsZWN0RWxlbWVudC5oYXNDbGFzcygiaHBTdHlsZURyb3Bkb3duTGlnaHQiKSl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAlpZighJChhY3RpdmVFbCkucGFyZW50cygiIyIrc2VsZWN0RWxJZCsiX2RkX2xpZ2h0IikubGVuZ3RoID4gMCl7DQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JIYW5kbGVyKHNlbGVjdEVsZW1lbnQpOw0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAlpZighJChhY3RpdmVFbCkucGFyZW50cygiIyIrc2VsZWN0RWxJZCsiX2RkIikubGVuZ3RoID4gMCl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAJZXJyb3JIYW5kbGVyKHNlbGVjdEVsZW1lbnQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwxMDApOw0KDQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICAkKCIjIitzZWxlY3RBbmNob3JJZCkub24oJ2ZvY3VzJyxmdW5jdGlvbigpew0KICAgICAgICAgICAgdmFyIHNlbGVjdEVsZW1lbnQgPSAkKCIjIiskKHRoaXMpLmF0dHIoImlkIikuc3BsaXQoIl8iKVswXSk7DQogICAgICAgICAgICAgICAgICAgICAgICBjbGVhckVycm9yTWVzc2FnZShzZWxlY3RFbGVtZW50KTsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGVsc2V7DQogICAgICAgIGlmKCEoJCh0aGlzKS5hdHRyKCdFcnJvckV4Y2VwdGlvbkV2ZW50JykgJiYgJCh0aGlzKS5hdHRyKCdFcnJvckV4Y2VwdGlvbkV2ZW50JykudG9Mb3dlckNhc2UoKS5pbmRleE9mKCJibHVyIikgPj0gMCkpew0KICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5ibHVyKGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JIYW5kbGVyKHRoaXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgJCh0aGlzKS5vbignZm9jdXMnLGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgICAgICAgICBjbGVhckVycm9yTWVzc2FnZSh0aGlzKTsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIC8vRG9udCBBdHRhY2ggdGhlIGJsdXIgZXZlbnQgZm9yIHRoZSBlbGVtZW50cyBsaWtlIHBmaW5kZXINCg0KICAgIH0pOw0KfQ0KDQovL0dldCBlcnJvciBtZXNzYWdlIGZvciBlbWFpbC4NCmZ1bmN0aW9uIGdldEVtYWlsRXJyb3JNZXNzYWdlKGVtYWlsRWwpew0KCXZhciBlcnJvck1lc3NhZ2UgPSBlbWFpbEVsLmF0dHIoJ2Vycm9yTWVzc2FnZScpOw0KDQoJaWYoaXNWYWxpZEVtYWlsQWRkcmVzcyhlbWFpbEVsLnZhbCgpKSl7DQoNCgkJaWYoZW1haWxFbC5hdHRyKCdtYXRjaCcpICE9IHVuZGVmaW5lZCl7DQoJCQl2YXIgbWF0Y2hpbmdFbCA9IGVtYWlsRWw7DQoJCQl2YXIgbWF0Y2hJZCA9IG1hdGNoaW5nRWwuYXR0cignbWF0Y2gnKTsNCgkJCXZhciBob3N0RWwgPSAkKCcjJysgbWF0Y2hJZCk7DQoNCgkJCXZhciBtaXNNYXRjaEVycm9yID0gbWF0Y2hpbmdFbC5hdHRyKCdtaXNNYXRjaEVycm9yJyk7DQoNCgkJCWlmKG1hdGNoaW5nRWwudmFsKCkubGVuZ3RoID4gMCAmJiBtYXRjaGluZ0VsLnZhbCgpLnRvTG93ZXJDYXNlKCkgIT0gaG9zdEVsLnZhbCgpLnRvTG93ZXJDYXNlKCkpew0KCQkJCWVycm9yTWVzc2FnZSA9IG1pc01hdGNoRXJyb3I7DQoJCQkJY2xlYXJFcnJvck1lc3NhZ2UobWF0Y2hpbmdFbCk7DQoJCQkJY3JlYXRlRXJyb3JNZXNzYWdlKG1hdGNoaW5nRWwsbWlzTWF0Y2hFcnJvcik7DQoJCQkJaWYoaG9zdEVsLnZhbCgpLmxlbmd0aCA8IDEpew0KCQkJCQljbGVhckVycm9yTWVzc2FnZShob3N0RWwpOw0KCQkJCQljcmVhdGVFcnJvck1lc3NhZ2UoaG9zdEVsLCBob3N0RWwuYXR0cignZXJyb3JNZXNzYWdlJykpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQllbHNlIGlmKGVtYWlsRWwuYXR0cignY29tcGFyZUVsJykgIT0gdW5kZWZpbmVkKXsNCgkJCXZhciBob3N0RWwgPSBlbWFpbEVsOw0KCQkJdmFyIGNvcGFyZUVsID0gJCgnIycraG9zdEVsLmF0dHIoJ2NvbXBhcmVFbCcpKTsNCgkJCWlmKGhvc3RFbC52YWwoKS5sZW5ndGggPiAwICYmIGNvcGFyZUVsLnZhbCgpLnRvTG93ZXJDYXNlKCkgIT0gaG9zdEVsLnZhbCgpLnRvTG93ZXJDYXNlKCkpew0KCQkJCWVycm9yTWVzc2FnZSA9IGNvcGFyZUVsLmF0dHIoJ21pc01hdGNoRXJyb3InKTsNCgkJCX0NCgkJfQ0KCX0NCglyZXR1cm4gZXJyb3JNZXNzYWdlOw0KfQ0KDQovL0dldCBlcnJvciBtZXNzYWdlIGJhc2VkIG9uIGVsZW1lbnQgdHlwZQ0KZnVuY3Rpb24gZ2V0RXJyb3JNZXNzYWdlKGVycm9yRWwpew0KCXZhciBlcnJvck1lc3NhZ2UgPSAiTWFuZGF0b3J5IEZpZWxkIjsNCglpZihlcnJvckVsLmF0dHIoJ2ZpbHRlcicpICE9IHVuZGVmaW5lZCAmJiBlcnJvckVsLmF0dHIoJ2ZpbHRlcicpLnRvTG93ZXJDYXNlKCkgPT0gJ2VtYWlsJyl7DQoJCWVycm9yTWVzc2FnZSA9IGdldEVtYWlsRXJyb3JNZXNzYWdlKGVycm9yRWwpOw0KCX0NCgllbHNlIGlmKGVycm9yRWwuYXR0cignZXJyb3JNZXNzYWdlJykgIT0gdW5kZWZpbmVkKQ0KCQllcnJvck1lc3NhZ2UgPSBlcnJvckVsLmF0dHIoJ2Vycm9yTWVzc2FnZScpOw0KDQoJcmV0dXJuIGVycm9yTWVzc2FnZTsNCn0NCg0KLy9UaGlzIGNoZWNrcyBmb3IgcG9zc2libGUgZXJyb3JzIGluIHRoZSBlcnJvciBhbmQgY3JlYXRlcyBlcnJvciBtZXNzYWdlIGJhc2VkIG9uIGVsZW1lbnQgdHlwZS4gLSBBc2h3aW5pDQpmdW5jdGlvbiBlcnJvckhhbmRsZXIoZWxzKSB7DQoJLy9GdW5jdGlvbiB0byBjaGVjayBpZiBhIHByb3BlcnR5IGV4aXN0c0xvY2FsDQoJLy9FeGFtcGxlOiAkKCcjc2VhcmNoLWlucHV0JykuZXhpc3RzTG9jYWwoJ2dob3N0dGV4dCcpOw0KCWpRdWVyeS5mbi5leGlzdHNMb2NhbCA9IGZ1bmN0aW9uKGF0dHJpYnV0ZVZhcikgew0KCQl2YXIgYXR0ciA9ICQodGhpcykuYXR0cihhdHRyaWJ1dGVWYXIpOw0KCQlyZXR1cm4gdHlwZW9mIGF0dHIgIT09IHR5cGVvZiB1bmRlZmluZWQgJiYgYXR0ciAhPT0gZmFsc2U7DQoJfQ0KDQoJLy9OZXcgcHJvcGVydHkgdG8gZ2V0IGFjdHVhbCB2YWx1ZSBleGNsdWRpbmcgZ2hvc3QgdGV4dCB3aXRoIHRyaW0oKQ0KCWpRdWVyeS5mbi5hY3R1YWxWYWxMb2NhbCA9IGZ1bmN0aW9uKCkgew0KCQlpZiAodGhpc1swXSkgew0KCQkJdmFyIGVsID0gJCh0aGlzWzBdKTsNCgkJCXZhciBnaG9zdFRleHRVc2VkID0gZWwuZXhpc3RzTG9jYWwoJ2dob3N0dGV4dCcpOw0KCQkJaWYgKGdob3N0VGV4dFVzZWQgJiYgZWwudmFsKCkgPT0gZWwuYXR0cignZ2hvc3RUZXh0JykpIHsNCgkJCQlyZXR1cm4gJyc7DQoJCQl9IGVsc2Ugew0KCQkJCXJldHVybiAkLnRyaW0oZWwudmFsKCkpOw0KCQkJfQ0KCQl9DQoJCXJldHVybiB1bmRlZmluZWQ7DQoJfTsNCg0KCS8vTmV3IHByb3BlcnR5IHRvIGdldCBhY3R1YWwgdmFsdWUgZXhjbHVkaW5nIGdob3N0IHRleHQgd2l0aG91dCB0cmltKCk7DQoJalF1ZXJ5LmZuLnRydWVWYWxMb2NhbCA9IGZ1bmN0aW9uKCkgew0KCQlpZiAodGhpc1swXSkgew0KCQkJdmFyIGVsZSA9ICQodGhpc1swXSk7DQoJCQl2YXIgZ2hvc3RUZXh0VXNlZCA9IGVsZS5leGlzdHNMb2NhbCgnZ2hvc3R0ZXh0Jyk7DQoJCQlpZiAoZ2hvc3RUZXh0VXNlZCAmJiBlbGUudmFsKCkgPT0gZWxlLmF0dHIoJ2dob3N0VGV4dCcpKSB7DQoJCQkJcmV0dXJuICcnOw0KCQkJfSBlbHNlIHsNCgkJCQlyZXR1cm4gZWxlLnZhbCgpOw0KCQkJfQ0KCQl9DQoJCXJldHVybiB1bmRlZmluZWQ7DQoJfTsNCglpZiAoJChlbHMpLmxlbmd0aCA+IDApIHsNCgkJdmFyIG1pbkNoYXIgPSAkKGVscykuYXR0cignTWluLUNoYXInKTsNCgkJdmFyIG1pbkNoYXJGbGFnID0gbWluQ2hhciA/ICQoZWxzKS5hY3R1YWxWYWxMb2NhbCgpLmxlbmd0aCA+IDAgJiYgJChlbHMpLmFjdHVhbFZhbExvY2FsKCkubGVuZ3RoIDwgbWluQ2hhciA6IGZhbHNlOw0KCQl2YXIgZW1haWxGbGFnID0gJChlbHMpLmF0dHIoJ0ZpbHRlcicpID09ICdFbWFpbCcgJiYgJC50cmltKCQoZWxzKS52YWwoKSkubGVuZ3RoID4gMCA/ICFpc1ZhbGlkRW1haWxBZGRyZXNzKCQudHJpbSgkKGVscykudmFsKCkpKSA6IGZhbHNlOw0KCQl2YXIgZW1haWxNYXRjaCA9ICQoZWxzKS5hdHRyKCdNYXRjaCcpICYmICQudHJpbSgkKGVscykudmFsKCkpLmxlbmd0aCA+IDAgPyAhKCQoZWxzKS52YWwoKS50b0xvd2VyQ2FzZSgpID09ICQoJyMnICsgJChlbHMpLmF0dHIoJ01hdGNoJykpLnZhbCgpLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7DQoJCWlmICgkKGVscykuYXR0cignY29tcGFyZUVsJykgIT0gdW5kZWZpbmVkKQ0KCQkJZW1haWxNYXRjaCA9ICQudHJpbSgkKGVscykudmFsKCkpLmxlbmd0aCA+IDAgPyAhKCQoZWxzKS52YWwoKS50b0xvd2VyQ2FzZSgpID09ICQoJyMnICsgJChlbHMpLmF0dHIoJ2NvbXBhcmVFbCcpKS52YWwoKS50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlOw0KCQl2YXIgaXNWYWxpZERhdGEgPSB0cnVlOw0KCQkvKiBEZWZlY3QgMzU3MCBpZiBSZXF1aXJlZFZhbGlkYXRpb24gaXMgZmFsc2UgYW5kIGFjdHVhbFZhbExvY2FsKCkgaXMgZW1wdHkgdGhlbiBjaGVja2luZyBSZWNvbW1lbmRlZCBWYWxpZGF0aW9uIGF0dHJpYnV0ZSAqLw0KCQl2YXIgaXNFbXB0eURhdGE7DQoJCWlmIChtaW5DaGFyICYmICQoZWxzKVswXS5nZXRBdHRyaWJ1dGUoImlkIikgIT0gIndGb3JtU2VyaWFsTnVtYmVyIiAmJiAkKGVscylbMF0uZ2V0QXR0cmlidXRlKCJpZCIpICE9ICJ3Rm9ybVByb2R1Y3ROdW0iKSB7CQkJCS8vY29uZGl0aW9uIHRvIGNoZWNrIGlmIHRoZSBlbWFpbCBmaWVsZCBpcyBlbXB0eSBvciBub3QgYmFzZWQgb24gbWluIGNoYXIgVVMgMTk0LTcwDQoJCSAgIGlzRW1wdHlEYXRhID0gZmFsc2U7CQkJCQkJCQkJCQkJCQkJCS8vYWRkZWQgYW5kIGNvbmRpdGlvbiB0byBmaXggdGhlIHZhbGlkYXRpb24gaXNzdWUgZm9yIHNlcmlhbCBudW1iZXIgZmllbGQgaW4gY2hlY2t3YXJyYW50eS4NCgkJfSBlbHNlIHsNCgkJICAgICBpc0VtcHR5RGF0YSA9ICggJChlbHMpLmF0dHIoJ1JlcXVpcmVkVmFsaWRhdGlvbicpID09ICJ0cnVlIiAmJiAkLnRyaW0oJChlbHMpLmFjdHVhbFZhbExvY2FsKCkpID09ICcnICkgfHwgKCAkKGVscykuYXR0cignUmVjb21tZW5kZWRWYWxpZGF0aW9uJykgPT0gInRydWUiICk7DQoJCX0JCQ0KCQkvKiBEZWZlY3QgMzU3MCAqLw0KDQoJCS8vU3BlY2lhbCBjaGVjayBmb3IgcGggbm8gfCBSZS11c2luZyB0aGUgaXNWYWxpZERhdGEgdmFyaWFibGUgZGVmaW5lZCBiZWZvcmUNCgkJLy9UaGlzIGdvZXMgaW5zaWRlIGVycm9ySGFuZGxlcg0KCQlpZiAoaXNWYWxpZERhdGEgJiYgJChlbHMpLmF0dHIoJ0ZpbHRlcicpID09PSAnUGhOdW1iZXInKSB7DQoJCQkJaXNWYWxpZERhdGEgPSAvXlwrP1swLTldKyQvLnRlc3QoJChlbHMpLnZhbCgpKQ0KCQkJDQoJCX0NCgkJaWYgKGlzVmFsaWREYXRhICYmICQoZWxzKS5hdHRyKCdGaWx0ZXInKSA9PT0gJ1Bob25lJykgew0KCQkJaWYoJChlbHMpLnZhbCgpKSB7DQoJCQkJaXNWYWxpZERhdGEgPSAvXlwrP1swLTldKyQvLnRlc3QoJChlbHMpLnZhbCgpKTsNCgkJCX0JDQoJCX0NCgkJaWYgKGlzVmFsaWREYXRhICYmICQoZWxzKS5hdHRyKCdGaWx0ZXInKSA9PT0gJ0FsdE1haWwnKSB7DQoJCQlpZigkKGVscykudmFsKCkpIHsNCgkJCQlpc1ZhbGlkRGF0YSA9IC9bXFNdK0BbXFNdK1wuW2EtekEtWl17Miw0fS8udGVzdCgkKGVscykudmFsKCkpOw0KCQkJfQkNCgkJfQ0KDQoNCgkJaWYgKCQoZWxzKS5hdHRyKCdnaG9zdFRleHQnKSAmJiAoJChlbHMpLnZhbCgpID09ICQoZWxzKS5hdHRyKCdnaG9zdFRleHQnKSkgfHwgJChlbHMpLmF0dHIoJ2RlZmF1bHRUZXh0JykgJiYgKCQoZWxzKS52YWwoKSA9PSAkKGVscykuYXR0cignZGVmYXVsdFRleHQnKSkgfHwgaXNFbXB0eURhdGEgfHwgbWluQ2hhckZsYWcgfHwgZW1haWxGbGFnIHx8IGVtYWlsTWF0Y2ggfHwgIWlzVmFsaWREYXRhKSB7DQoNCgkJCXZhciBtc2cgPSBnZXRFcnJvck1lc3NhZ2UoJChlbHMpKTsNCg0KCQkJaWYgKCQoZWxzKS5wcm9wKCJ0YWdOYW1lIikudG9Mb3dlckNhc2UoKSA9PSAic2VsZWN0Iikgew0KCQkJCS8vZWxzPSAkKGVscykuYXR0cigiaWQiKSsiX2RkIjsNCgkJCX0NCg0KCQkJaWYgKCEkKGVscykuaGFzQ2xhc3MoJ2Vycm9yRWxlbWVudCcpKSB7DQoJCQkJLy9EaWZmZXJlbnQgZXJyb3IgbWVzc2FnaW5nIGZvciBlbWFpbC4NCgkJCQl2YXIgaXNFbWFpbEZpZWxkID0gJChlbHMpLmF0dHIoJ2ZpbHRlcicpICE9IHVuZGVmaW5lZCAmJiAkKGVscykuYXR0cignZmlsdGVyJykudG9Mb3dlckNhc2UoKSA9PSAnZW1haWwnOw0KCQkJCXZhciBpc01hdGNoaW5nSG9zdCA9ICQoZWxzKS5hdHRyKCdjb21wYXJlRWwnKSAhPSB1bmRlZmluZWQgJiYgJChlbHMpLnZhbCgpLmxlbmd0aCA+IDA7DQoJCQkJdmFyIGlzVmFsaWRFbWFpbEZvcm1hdCA9IGlzVmFsaWRFbWFpbEFkZHJlc3MoJChlbHMpLnZhbCgpKTsNCgkJCQlpZiAoaXNFbWFpbEZpZWxkICYmIGlzTWF0Y2hpbmdIb3N0ICYmIGlzVmFsaWRFbWFpbEZvcm1hdCkgew0KCQkJCQl2YXIgZW1haWxFcnJvckVsZW1lbnQgPSAkKCcjJyArICQoZWxzKS5hdHRyKCdjb21wYXJlRWwnKSk7DQoJCQkJCWNyZWF0ZUVycm9yTWVzc2FnZShlbWFpbEVycm9yRWxlbWVudCwgbXNnKTsNCgkJCQl9IGVsc2UNCgkJCQkJY3JlYXRlRXJyb3JNZXNzYWdlKGVscywgbXNnKTsNCgkJCX0NCgkJfSBlbHNlIHsNCgkJCWNsZWFyRXJyb3JNZXNzYWdlKGVscyk7DQoJCX0NCgl9DQp9DQoNCi8vQ2hlY2sgaWYgdGhlIGRhdGEgaXMgdmFsaWQgYWdhaW5zdCBzcGVjaWZpZWQgdHlwZSBvZiBlbGVtZW50LiAtIEFzaHdpbmkNCmZ1bmN0aW9uIGNoZWNrRm9yVmFsaWREYXRhKGVscywgZmlsdGVyVHlwZSkgew0KCXZhciByZXR1cm5WYWx1ZSA9IHRydWU7DQoJdmFyIHZhbHVlVG9DaGVjayA9ICQoZWxzKS52YWwoKTsNCglpZiAoJChlbHMpLmF0dHIoJ2dob3N0VGV4dCcpICYmICh2YWx1ZVRvQ2hlY2sgPT0gJChlbHMpLmF0dHIoJ2dob3N0VGV4dCcpKSkgew0KCQlyZXR1cm5WYWx1ZSA9IGZhbHNlOw0KCX0gZWxzZSBpZiAoZmlsdGVyVHlwZSA9PSAnQWxwaGEnKSB7DQoJCXJldHVyblZhbHVlID0gL15bYS16QS1aXS8udGVzdCh2YWx1ZVRvQ2hlY2spOw0KCX0gZWxzZSBpZiAoZmlsdGVyVHlwZSA9PSAnTnVtZXJpYycpIHsNCgkJcmV0dXJuVmFsdWUgPSAhaXNOYU4odmFsdWVUb0NoZWNrKTsNCgl9IGVsc2UgaWYgKGZpbHRlclR5cGUgPT0gJ0FscGhhTnVtZXJpYycpIHsNCgkJcmV0dXJuVmFsdWUgPSAvXlthLXpBLVowLTldLy50ZXN0KHZhbHVlVG9DaGVjayk7DQoJfSBlbHNlIGlmIChmaWx0ZXJUeXBlID09ICdQaE51bWJlcicpIHsNCgkJLy9BZGRlZCBhIG5ldyBjb25kaXRpb24gZm9yIHRoZSBQaG9uZSBOdW1iZXIgZmllbGQ6LSBQaE51bWJlcg0KCQlyZXR1cm5WYWx1ZSA9IC9eXCs/WzAtOV0rJC8udGVzdCh2YWx1ZVRvQ2hlY2spOw0KCX0gIGVsc2UgaWYgKGZpbHRlclR5cGUgPT0gJ1Bob25lJykgew0KCQkvL0FkZGVkIGEgbmV3IGNvbmRpdGlvbiBmb3IgdGhlIFBob25lIE51bWJlciBmaWVsZDotIFBoTnVtYmVyDQoJCXJldHVyblZhbHVlID0gL15cKz9bMC05XSskLy50ZXN0KHZhbHVlVG9DaGVjayk7DQoJfSAgZWxzZSBpZiAoZmlsdGVyVHlwZSA9PSAnQWx0TWFpbCcpIHsNCgkJLy9BZGRlZCBhIG5ldyBjb25kaXRpb24gZm9yIHRoZSBQaG9uZSBOdW1iZXIgZmllbGQ6LSBQaE51bWJlcg0KCQlyZXR1cm5WYWx1ZSA9IC9bXFNdK0BbXFNdK1wuW2EtekEtWl17Miw0fS8udGVzdCh2YWx1ZVRvQ2hlY2spOw0KCX0NCglyZXR1cm4gcmV0dXJuVmFsdWU7DQp9DQoNCmZ1bmN0aW9uIHNwZWNpYWxDaGFyQ2hlY2tGbihlbGVtKXsNCglpZihlbGVtLnZhbCgpLm1hdGNoKC9bXmEtejAtOV18XHMrfFxyP1xufFxyL2dtaSkpew0KCQlyZXR1cm4gdHJ1ZTsNCgl9DQoJZWxzZXsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCn0NCg0KLy9FbmFibGluZyBhbmQgRGlzYWJsaW5nIG9mIGRlcGVuZGVuY3kgZWxlbWVudHMgLSBBc2h3aW5pDQpmdW5jdGlvbiBjaGVja0ZvckVuYWJsaW5nKGRlcGVuZGVjeUVsZW1lbnRzLGVuYWJsaW5nRWwpew0KCXZhciBkaXNhYmxlRmxhZyA9IGZhbHNlOw0KCSQuZWFjaChkZXBlbmRlY3lFbGVtZW50cyxmdW5jdGlvbihrZXksdmFsdWUpew0KCQl2YWx1ZSA9ICQudHJpbSh2YWx1ZSk7DQoJCWlmKCEodmFsdWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCJyYWRpbyIpID49IDApKXsNCgkJCXZhciBlbGVtID0gJCgnIycrdmFsdWUpOw0KCQkJaWYoZWxlbS5oYXNDbGFzcygiaHBTdHlsZURyb3Bkb3duTGlnaHQiKSl7DQoJCQkJdmFyIHRlbXAgPSAnIycrdmFsdWUrJ19kZF9saWdodCB1bCBsaSc7DQoJCQl9DQoJCQllbHNlew0KCQkJCXZhciB0ZW1wID0gJyMnK3ZhbHVlKydfZGQgdWwgbGknOw0KCQkJfQ0KCQl9DQoJCWVsc2V7DQoJCQlpZigkKCIjIit2YWx1ZSkubGVuZ3RoID4gMCl7DQoJCQkJaWYoJCgiIyIrdmFsdWUpLmlzKCJJTlBVVCIpKXsNCgkJCQkJdmFyIGVsZW0gPSAkKCcjJyt2YWx1ZSk7DQoJCQkJfQ0KCQkJCWVsc2V7DQoJCQkJCXZhciBlbGVtID0gJCgnLicrdmFsdWUpOw0KCQkJCX0NCgkJCX0NCgkJCWVsc2V7DQoJCQkJdmFyIGVsZW0gPSAkKCcuJyt2YWx1ZSk7DQoJCQl9DQoJCX0NCgkJaWYoZWxlbS5hdHRyKCdSZXF1aXJlZFZhbGlkYXRpb24nKSAhPT0gInRydWUiKXsNCgkJCWlmKGVsZW0ucHJvcCgidGFnTmFtZSIpICE9IHVuZGVmaW5lZCAmJiAoKGVsZW0ucHJvcCgidGFnTmFtZSIpLnRvTG93ZXJDYXNlKCkgPT0gImlucHV0IiAmJiAoZWxlbS5hdHRyKCd0eXBlJykudG9Mb3dlckNhc2UoKSA9PSAidGV4dCIgfHwgZWxlbS5hdHRyKCd0eXBlJykudG9Mb3dlckNhc2UoKSA9PSAiaGlkZGVuIiB8fCBlbGVtLmF0dHIoInR5cGUiKS50b0xvd2VyQ2FzZSgpID09ICJ0ZWwiIHx8IGVsZW0uYXR0cigidHlwZSIpLnRvTG93ZXJDYXNlKCkgPT0gImVtYWlsIikpIHx8IGVsZW0ucHJvcCgidGFnTmFtZSIpLnRvTG93ZXJDYXNlKCkgPT0gInRleHRhcmVhIikpew0KCQkJCWlmKGVsZW0uYXR0cignbWluLWNoYXInKSAmJiBlbGVtLmFjdHVhbFZhbCgpLmxlbmd0aCA+IDApew0KCQkJCQlkaXNhYmxlRmxhZyA9IGVsZW0uYWN0dWFsVmFsKCkubGVuZ3RoIDwgZWxlbS5hdHRyKCdtaW4tY2hhcicpOw0KCQkJCX1lbHNlIGlmKGVsZW0uYXR0cignbWluLWNoYXInKSAmJiBlbGVtLmFjdHVhbFZhbCgpLmxlbmd0aCA9PSAwKXsJCS8vZml4IGZvciB2YWxpZGF0aW9uIGZvciB2MiBjYXB0Y2hhLiBBZGRlZCB0aGUgZWxzZSBwYXJ0IHRvIGRpc2FibGUgdGhlIHN1Ym1pdCBidXR0b24gdW5sZXNzIHRoZSBjYXB0Y2hhIGNoZWNrYm94IGlzIG5vdCBjaGVja2VkLiBEaWQgbm90IGhhcmRjb2RlIHRoZSBmbGFnIHRvIHRydWUgYXMgaXQgaXMgbm90IGhhcmRjb2RlZCBhbnl3aGVyZS4NCgkJCQkJZGlzYWJsZUZsYWcgPSBlbGVtLmFjdHVhbFZhbCgpLmxlbmd0aCA8IGVsZW0uYXR0cignbWluLWNoYXInKTsNCgkJCQl9DQoJCQl9DQoJCX0NCgkJZWxzZSBpZihlbGVtLnByb3AoInRhZ05hbWUiKSAhPSB1bmRlZmluZWQpew0KCQkJaWYoKGVsZW0ucHJvcCgidGFnTmFtZSIpLnRvTG93ZXJDYXNlKCkgPT0gImlucHV0IiAmJiAoZWxlbS5hdHRyKCd0eXBlJykudG9Mb3dlckNhc2UoKSA9PSAidGV4dCIgfHwgZWxlbS5hdHRyKCJ0eXBlIikudG9Mb3dlckNhc2UoKSA9PSAidGVsIiB8fCBlbGVtLmF0dHIoInR5cGUiKS50b0xvd2VyQ2FzZSgpID09ICJlbWFpbCIpKSB8fCBlbGVtLnByb3AoInRhZ05hbWUiKS50b0xvd2VyQ2FzZSgpID09ICJ0ZXh0YXJlYSIpew0KCQkJCXZhciBjaGFyTGVuZ3RoQ2hlY2sgPSBlbGVtLmF0dHIoJ01pbi1DaGFyJykgPyBlbGVtLmF0dHIoJ01pbi1DaGFyJykgOiAxOw0KCQkJCWRpc2FibGVGbGFnID0gZGlzYWJsZUZsYWcgfHwgZWxlbS5hdHRyKCdnaG9zdFRleHQnKSAmJiAoZWxlbS52YWwoKSA9PSBlbGVtLmF0dHIoJ2dob3N0VGV4dCcpKSB8fCAkLnRyaW0oZWxlbS52YWwoKSkubGVuZ3RoIDwgY2hhckxlbmd0aENoZWNrOw0KCQkJCWlmKGVsZW0uYXR0cignbWF0Y2gnKSl7DQoJCQkJCWRpc2FibGVGbGFnID0gZGlzYWJsZUZsYWcgfHwgJCgnIycrZWxlbS5hdHRyKCdtYXRjaCcpKS52YWwoKS50b0xvd2VyQ2FzZSgpICE9IGVsZW0udmFsKCkudG9Mb3dlckNhc2UoKTsNCgkJCQl9DQoNCgkJCQkvL0lmIHRoZXJlIGlzIGEgcmVnRXhwIGNoZWNrIHJlcXVpcmVkLCB3ZSBuZWVkIHRvIHBhc3MgdGhlIHJlZ0V4IHRvIHRoZSBkYXRhIHZhcmlhYmxlICJkYXRhLXJlZ0V4cENoZWNrIg0KCQkJCS8vVGhlIHN1Ym1pdCBidXR0b24gd2lsbCBiZSBlbmFibGVkIG9ubHkgaWYgdGhlIHJlZ0V4IHBhc3NlZA0KCQkJCXZhciByZWdFeHBDaGVjayA9IGVsZW0uYXR0cignZGF0YS1yZWdFeHBDaGVjaycpIHx8ICcnOw0KCQkJCWlmKHJlZ0V4cENoZWNrLmxlbmd0aCA+IDApew0KCQkJCQlyZWdFeHBDaGVjayA9IHJlZ0V4cENoZWNrLnJlcGxhY2UoL1wvL2csJycpOyAvL1JlbW92ZSBhbGwgIi8iDQoJCQkJCXJlZ0V4cENoZWNrID0gbmV3IFJlZ0V4cChyZWdFeHBDaGVjayk7IC8vVGhpcyBpcyB0aGUgcmVnRXhwIHRoYXQgd2lsbCBiZSB1c2VkIHRvIHRlc3QgdGhlIHZhbGlkaXR5IG9mIHRoZSBzdHJpbmcNCgkJCQkJZGlzYWJsZUZsYWcgPSBkaXNhYmxlRmxhZyB8fCAhcmVnRXhwQ2hlY2sudGVzdChlbGVtLnZhbCgpKTsNCgkJCQl9DQoJCQl9DQoJCQllbHNlIGlmKGVsZW0ucHJvcCgidGFnTmFtZSIpLnRvTG93ZXJDYXNlKCkgPT0gInNlbGVjdCIpew0KCQkJCWRpc2FibGVGbGFnID0gZGlzYWJsZUZsYWcgfHwgJCgiIyIrZWxlbS5hdHRyKCdpZCcpKyJfZGRfaGVhZGVyVmFsdWUiKS5odG1sKCkuc3BsaXQoJzwnKVswXSA9PSBlbGVtLmNoaWxkcmVuKCdvcHRpb24nKS5maXJzdCgpLmh0bWwoKTsNCgkJCX0NCgkJCWVsc2UgaWYgKChlbGVtLnByb3AoInRhZ05hbWUiKS50b0xvd2VyQ2FzZSgpID09ICJpbnB1dCIgJiYgZWxlbS5hdHRyKCd0eXBlJykudG9Mb3dlckNhc2UoKSA9PSAicmFkaW8iKSl7DQoJCQkJZGlzYWJsZUZsYWcgPSBkaXNhYmxlRmxhZyB8fCAhZWxlbS5pcygnOmNoZWNrZWQnKTsNCgkJCX0NCgkJCWVsc2UgaWYgKChlbGVtLnByb3AoInRhZ05hbWUiKS50b0xvd2VyQ2FzZSgpID09ICJpbnB1dCIgJiYgZWxlbS5hdHRyKCd0eXBlJykudG9Mb3dlckNhc2UoKSA9PSAiY2hlY2tib3giKSl7DQoJCQkJZGlzYWJsZUZsYWcgPSBkaXNhYmxlRmxhZyB8fCAhZWxlbS5pcygiOmNoZWNrZWQiKTsNCgkJCX0NCgkJfQ0KCX0pOw0KCWlmKGRpc2FibGVGbGFnKXsNCgkJZW5hYmxpbmdFbC5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJykuYXR0cignYXJpYS1kaXNhYmxlZCcsJ3RydWUnKTsNCgkJLy9lbmFibGluZ0VsLnJlbW92ZUNsYXNzKCJzdGFuZGFyZEJ0biIpLmFkZENsYXNzKCJkaXNhYmxlZEJ0biIpOw0KCX0NCgllbHNlew0KCQllbmFibGluZ0VsLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJykucmVtb3ZlQXR0cignYXJpYS1kaXNhYmxlZCcpOw0KCQkvL2VuYWJsaW5nRWwucmVtb3ZlQ2xhc3MoImRpc2FibGVkQnRuIikuYWRkQ2xhc3MoInN0YW5kYXJkQnRuIik7DQoJfQ0KfQ0KDQpmdW5jdGlvbiBudWxsVmFsaWRhdGlvbigpew0KCSQoImlucHV0W3R5cGU9J3RleHQnXS5udWxsVmFsaWRhdGVUZXh0IikuZWFjaChmdW5jdGlvbigpeyAvL3RoZSB0ZXh0IGJveCB0aGF0IG5lZWRzIHRoaXMgZnVuY3Rpb25hbGl0eSBvZiBkaXNwbGF5aW5nIGVycm9yIG1lc3NhZ2Ugb24gbnVsbCBzdWJtaXNzaW9uIG11c3QgaGF2ZSB0aGUgY2xhc3MgIm51bGxWYWxpZGF0ZVRleHQiDQogCQkJdmFyIHZhbGlkYXRpb25UZXh0Qm94ID0gJCh0aGlzKTsNCgkJCXZhciB2YWxpZGF0aW9uVGV4dEJ1dHRvbiA9ICQodGhpcykucGFyZW50cygiLmVycm9yV3JhcHBlciIpLmZpbmQoIi5udWxsVmFsaWRhdGVCdG4iKTsNCgkJCXZhciBnaG9zdFRleHQ9JCh2YWxpZGF0aW9uVGV4dEJveCkuYXR0cigiZ2hvc3RUZXh0Iik7DQoJCQkkKHZhbGlkYXRpb25UZXh0Qm94KS5vbiggImtleXVwIGtleWRvd24iLCBmdW5jdGlvbihlKSB7IC8vdGhpcyBpcyBmb3IgdmFsaWRhdGluZyBudWxsIHZhbHVlIHN1Ym1pdCBvbiBwcmVzc2luZyBlbnRlciBvbiB0aGUgaW5wdXQgYm94Lg0KCQkJCXZhciBrZXkgPSBlLmtleUNvZGUgfHwgZS53aGljaDsNCgkJCQlpZihrZXkgPT0gMTMpew0KCQkJCQkJaWYoJC50cmltKGpRdWVyeSh2YWxpZGF0aW9uVGV4dEJveCkudmFsKCkpID09ICcnIHx8IGpRdWVyeSh2YWxpZGF0aW9uVGV4dEJveCkudmFsKCkgPT0gZ2hvc3RUZXh0KXsNCgkJCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQkJCSQodmFsaWRhdGlvblRleHRCb3gpLnBhcmVudHMoIi5lcnJvcldyYXBwZXIiKS5maW5kKCIuZXJyb3JDb250YWluZXIiKS5jc3Moew0KCQkJCQkJCWRpc3BsYXk6ICdub25lJw0KCQkJCQkJfSk7DQoJCQkJCQkkKHZhbGlkYXRpb25UZXh0Qm94KS5wYXJlbnRzKCIuZXJyb3JXcmFwcGVyIikuZmluZCgiLmVycm9yQ29udGFpbmVyIikuY3NzKHsNCgkJCQkJCQlkaXNwbGF5OiAnYmxvY2snDQoJCQkJCQl9KTsNCgkJCQkJCSQodmFsaWRhdGlvblRleHRCb3gpLmFkZENsYXNzKCJlcnJvcmVkIik7DQoJCQkJCQl9DQoJCQkJCQllbHNlew0KCQkJCQkJCSQodmFsaWRhdGlvblRleHRCb3gpLnBhcmVudHMoIi5lcnJvcldyYXBwZXIiKS5maW5kKCIuZXJyb3JDb250YWluZXIiKS5jc3Moew0KCQkJCQkJCWRpc3BsYXk6ICdub25lJw0KCQkJCQkJCX0pOw0KCQkJCQkJCSQodmFsaWRhdGlvblRleHRCb3gpLnJlbW92ZUNsYXNzKCJlcnJvcmVkIik7DQoJCQkJCQl9DQoJCQkJfQ0KCQkJCWVsc2V7IC8vdGhpcyBpcyB0byBtYWtlIHRoZSBzdWJtaXQgYnV0dG9uIGFjdGl2ZSBpZiBpdCBpcyBkaXNhYmxlZCBhbmQgdG8gcmVtb3ZlIHRoZSBlcnJvciBtZXNzYWdlDQoJCQkJCQkvL1JlbW92aW5nIHRoZSBlcnJvciBtZXNzYWdlDQoJCQkJCQkkKHZhbGlkYXRpb25UZXh0Qm94KS5wYXJlbnRzKCIuZXJyb3JXcmFwcGVyIikuZmluZCgiLmVycm9yQ29udGFpbmVyIikuY3NzKHsNCgkJCQkJCQkJZGlzcGxheTogJ25vbmUnDQoJCQkJCQl9KTsNCgkJCQkJCSQodmFsaWRhdGlvblRleHRCb3gpLnJlbW92ZUNsYXNzKCJlcnJvcmVkIik7DQoNCgkJCQkJLy9tYWtlIHRoZSBzdWJtaXQgYnV0dG9uIGFjdGl2ZQ0KCQkJCQlpZighKCQudHJpbShqUXVlcnkodmFsaWRhdGlvblRleHRCb3gpLnZhbCgpKSA9PSAnJykpew0KCQkJCQkJaWYoISgkKHZhbGlkYXRpb25UZXh0QnV0dG9uKS5hdHRyKCJkaXNhYmxlZCIpID09ICJ1bmRlZmluZWQiICkpew0KCQkJCQkJCSQodmFsaWRhdGlvblRleHRCdXR0b24pLnJlbW92ZUF0dHIoImRpc2FibGVkIik7DQoJCQkJCQkJLy8kKHZhbGlkYXRpb25UZXh0QnV0dG9uKS5yZW1vdmVDbGFzcygiZGlzYWJsZWRCdG4iKS5hZGRDbGFzcygic3RhbmRhcmRCdG4iKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQllbHNlew0KCQkJCQkJCSQodmFsaWRhdGlvblRleHRCdXR0b24pLmF0dHIoImRpc2FibGVkIiwiZGlzYWJsZWQiKTsNCgkJCQkJCQkvLyQodmFsaWRhdGlvblRleHRCdXR0b24pLnJlbW92ZUNsYXNzKCJzdGFuZGFyZEJ0biIpLmFkZENsYXNzKCJkaXNhYmxlZEJ0biIpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfSk7DQoNCgkJCSQodmFsaWRhdGlvblRleHRCdXR0b24pLm9uKCAiY2xpY2siLCBmdW5jdGlvbihlKSB7IC8vdGhpcyBpcyBmb3IgdmFsaWRhdGluZyBudWxsIHZhbHVlIHN1Ym1pdCBvbiBwcmVzc2luZyBlbnRlciBvbiB0aGUgaW5wdXQgYm94Lg0KCQkJCXZhciBnaG9zdFRleHQ9JCh2YWxpZGF0aW9uVGV4dEJveCkuYXR0cigiZ2hvc3RUZXh0Iik7DQoJCQkJaWYoJC50cmltKGpRdWVyeSh2YWxpZGF0aW9uVGV4dEJveCkudmFsKCkpID09ICcnIHx8IGpRdWVyeSh2YWxpZGF0aW9uVGV4dEJveCkudmFsKCkgPT0gZ2hvc3RUZXh0KXsNCgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCQkkKHZhbGlkYXRpb25UZXh0Qm94KS5wYXJlbnRzKCIuZXJyb3JXcmFwcGVyIikuZmluZCgiLmVycm9yQ29udGFpbmVyIikuY3NzKHsNCgkJCQkJCWRpc3BsYXk6ICdub25lJw0KCQkJCQl9KTsNCgkJCQkJJCh2YWxpZGF0aW9uVGV4dEJveCkucGFyZW50cygiLmVycm9yV3JhcHBlciIpLmZpbmQoIi5lcnJvckNvbnRhaW5lciIpLmNzcyh7DQoJCQkJCQlkaXNwbGF5OiAnYmxvY2snDQoJCQkJCX0pOw0KCQkJCQkkKHZhbGlkYXRpb25UZXh0Qm94KS5hZGRDbGFzcygiZXJyb3JlZCIpOw0KCQkJCX0NCgkJCQllbHNlew0KCQkJCQkkKHZhbGlkYXRpb25UZXh0Qm94KS5wYXJlbnRzKCIuZXJyb3JXcmFwcGVyIikuZmluZCgiLmVycm9yQ29udGFpbmVyIikuY3NzKHsNCgkJCQkJCWRpc3BsYXk6ICdub25lJw0KCQkJCQl9KTsNCgkJCQkJJCh2YWxpZGF0aW9uVGV4dEJveCkucmVtb3ZlQ2xhc3MoImVycm9yZWQiKTsNCgkJCQl9DQoJCQl9KTsNCgkJCX0pOw0KfQ0KDQogZnVuY3Rpb24gdmFsaWRhdGVOdWxsRm9ybVN1Ym1pdChzdWJtaXRFbElkKXsNCgl2YXIgZGlzYWJsZWRTdGF0ZSA9ICQoIiMiK3N1Ym1pdEVsSWQpLmF0dHIoImRpc2FibGVkIik7DQoJaWYgKGRpc2FibGVkU3RhdGUgPT0gImRpc2FibGVkIil7DQoJCXJldHVybiBmYWxzZTsNCgl9DQoJZWxzZXsNCgkJcmV0dXJuIHRydWU7DQoJfQ0KfQ0KDQpmdW5jdGlvbiByZWZyZXNoRGVwZW5kZW5jeShkZXBlbmRlbnRFbCwgaW50ZXJtZWRpYXRlRnVudGlvbiwgaWRPckNsYXNzKXsNCgkvL0NsZWFyIGV2ZW50IGhhbmRsZXJzIGZyb20gYWxsIGRlcGVuZGVuY3kgZWxlbWVudHMNCgl2YXIgZXZlbnRFbGVtZW50czsNCglpZihpZE9yQ2xhc3MhPXVuZGVmaW5lZCAmJiBpZE9yQ2xhc3MudG9Mb3dlckNhc2UoKSA9PSAiY2xhc3MiKSB7DQoJCWV2ZW50RWxlbWVudHMgPSAkKCcuJytkZXBlbmRlbnRFbCkuYXR0cignYWN0aXZlZGVwZW5kZW5jeScpLnNwbGl0KC8sL2cpOw0KCX0gZWxzZSB7DQoJCWV2ZW50RWxlbWVudHMgPSAkKCcjJytkZXBlbmRlbnRFbCkuYXR0cignYWN0aXZlZGVwZW5kZW5jeScpLnNwbGl0KC8sL2cpOw0KCX0NCgkkLmVhY2goZXZlbnRFbGVtZW50cywgZnVuY3Rpb24oaW5kZXgsdmFsKXsNCgkJdmFsID0gJyMnKyQudHJpbSh2YWwpOw0KCQkkKHZhbCkub2ZmKCdrZXlkb3duIGtleXVwIGNoYW5nZSBwYXN0ZSBkcmFnZW5kIGNsaWNrJyk7DQoJfSk7DQoNCgkvL0NhbGwgdGhlIGludGVybWVkaWF0ZSBmdW5jdGlvbg0KCWludGVybWVkaWF0ZUZ1bnRpb24oKTsNCg0KCS8vUmUtaW5pdGlhdGUgdGhlIHZhbGlkYXRpb24uDQoJSGFuZGxlVmFsaWRhdGlvbk9uTG9hZCgpOw0KfQ0KDQovLyB2YWxpZGF0ZSB0aGUgc2VyaWFsIG51bWJlciBpcyBmb3IgU2Ftc3VuZy9IUCBQcm9kdWN0DQpmdW5jdGlvbiB2YWxpZGF0ZVNhbXN1bmdTTihTTlZhbHVlKSB7DQoJdmFyIFNObGVuZ3RoID0gU05WYWx1ZS5sZW5ndGg7DQoJaWYoU05sZW5ndGggPj0gc2Ftc3VuZ1NlcmlhbE51bWJlck1pbkxlbmd0aCAmJiBTTmxlbmd0aCA8PSBzYW1zdW5nUHJvZHVjdE51bWJlck1heExlbmd0aCkgew0KCQkvLyBjaGVjayBmb3IgU2Ftc3VuZyBTZXJpYWwgTnVtYmVyDQoJCXJldHVybiBjYWxsRXZhbHVhdGlvblNlcnZpY2UoKTsNCgl9DQoJcmV0dXJuIGZhbHNlOw0KfQ0KDQpmdW5jdGlvbiBjYWxsRXZhbHVhdGlvblNlcnZpY2UoKSB7DQoJY29uc29sZS5sb2coIkl0IGlzIGEgU2Ftc3VuZyBQcm9kdWN0LiBDYWxsaW5nIEV2YWx1YXRpb24gU2VydmljZSIpOw0KCXJldHVybiB0cnVlOw0KfQ0KDQoNCi8qDQogKiBUaGlzIG1ldGhvZCB3aWxsIGNvbXBhcmUgZWxlbWVudCdzIHZhbHVlDQogKiB3aXRoIHByb3ZpZGVkIHJlZ3VsYXIgZXhwcmVzc2lvbg0KICogYW5kIGNsZWFyIGl0IGlmIHRoZXJlIGlzIGEgbWF0Y2ggYW5kDQogKiBhbHNvIHJldHVybnMgdHJ1ZSBvciBmYWxzZSBmb3IgdGhlIG1hdGNoDQogKg0KICogQGF1dGhvciBhcmthc2luaGENCiAqLw0KZnVuY3Rpb24gbWF0Y2hSZWd1bGFyRXhwcmVzc2lvbihlbGVtZW50LCByZWd1bGFyRXhwcmVzc2lvbikgew0KDQoJLy8gbWF0Y2ggdGhlIHByb3ZpZGVkIHJlZ2V4DQoJaWYoIWVsZW1lbnQudmFsKCkubWF0Y2gocmVndWxhckV4cHJlc3Npb24pKSB7DQoNCgkJLy8gY2xlYXIgdGhlIGlucHV0IGZpZWxkDQoJCWVsZW1lbnQudmFsKCIiKTsNCg0KCQkvLyBtYXRjaCBub3QgZm91bmQNCgkJcmV0dXJuIGZhbHNlOw0KCX1lbHNlIHsNCg0KCQkvLyBtYXRjaCBmb3VuZA0KCQlyZXR1cm4gdHJ1ZTsNCgl9DQp9DQoKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7LyohIGpRdWVyeSBVSSAtIHYxLjEwLjQgLSAyMDE0LTAxLTE3CiogaHR0cDovL2pxdWVyeXVpLmNvbQoqIEluY2x1ZGVzOiBqcXVlcnkudWkuY29yZS5qcywganF1ZXJ5LnVpLndpZGdldC5qcywganF1ZXJ5LnVpLm1vdXNlLmpzLCBqcXVlcnkudWkuZHJhZ2dhYmxlLmpzLCBqcXVlcnkudWkuZHJvcHBhYmxlLmpzLCBqcXVlcnkudWkucmVzaXphYmxlLmpzLCBqcXVlcnkudWkuc2VsZWN0YWJsZS5qcywganF1ZXJ5LnVpLnNvcnRhYmxlLmpzLCBqcXVlcnkudWkuZWZmZWN0LmpzLCBqcXVlcnkudWkuYWNjb3JkaW9uLmpzLCBqcXVlcnkudWkuYXV0b2NvbXBsZXRlLmpzLCBqcXVlcnkudWkuYnV0dG9uLmpzLCBqcXVlcnkudWkuZGF0ZXBpY2tlci5qcywganF1ZXJ5LnVpLmRpYWxvZy5qcywganF1ZXJ5LnVpLmVmZmVjdC1ibGluZC5qcywganF1ZXJ5LnVpLmVmZmVjdC1ib3VuY2UuanMsIGpxdWVyeS51aS5lZmZlY3QtY2xpcC5qcywganF1ZXJ5LnVpLmVmZmVjdC1kcm9wLmpzLCBqcXVlcnkudWkuZWZmZWN0LWV4cGxvZGUuanMsIGpxdWVyeS51aS5lZmZlY3QtZmFkZS5qcywganF1ZXJ5LnVpLmVmZmVjdC1mb2xkLmpzLCBqcXVlcnkudWkuZWZmZWN0LWhpZ2hsaWdodC5qcywganF1ZXJ5LnVpLmVmZmVjdC1wdWxzYXRlLmpzLCBqcXVlcnkudWkuZWZmZWN0LXNjYWxlLmpzLCBqcXVlcnkudWkuZWZmZWN0LXNoYWtlLmpzLCBqcXVlcnkudWkuZWZmZWN0LXNsaWRlLmpzLCBqcXVlcnkudWkuZWZmZWN0LXRyYW5zZmVyLmpzLCBqcXVlcnkudWkubWVudS5qcywganF1ZXJ5LnVpLnBvc2l0aW9uLmpzLCBqcXVlcnkudWkucHJvZ3Jlc3NiYXIuanMsIGpxdWVyeS51aS5zbGlkZXIuanMsIGpxdWVyeS51aS5zcGlubmVyLmpzLCBqcXVlcnkudWkudGFicy5qcywganF1ZXJ5LnVpLnRvb2x0aXAuanMKKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzOyBMaWNlbnNlZCBNSVQgKi8KKGZ1bmN0aW9uKCAkLCB1bmRlZmluZWQgKSB7Cgp2YXIgdXVpZCA9IDAsCglydW5pcXVlSWQgPSAvXnVpLWlkLVxkKyQvOwoKLy8gJC51aSBtaWdodCBleGlzdCBmcm9tIGNvbXBvbmVudHMgd2l0aCBubyBkZXBlbmRlbmNpZXMsIGUuZy4sICQudWkucG9zaXRpb24KJC51aSA9ICQudWkgfHwge307CgokLmV4dGVuZCggJC51aSwgewoJdmVyc2lvbjogIjEuMTAuNCIsCgoJa2V5Q29kZTogewoJCUJBQ0tTUEFDRTogOCwKCQlDT01NQTogMTg4LAoJCURFTEVURTogNDYsCgkJRE9XTjogNDAsCgkJRU5EOiAzNSwKCQlFTlRFUjogMTMsCgkJRVNDQVBFOiAyNywKCQlIT01FOiAzNiwKCQlMRUZUOiAzNywKCQlOVU1QQURfQUREOiAxMDcsCgkJTlVNUEFEX0RFQ0lNQUw6IDExMCwKCQlOVU1QQURfRElWSURFOiAxMTEsCgkJTlVNUEFEX0VOVEVSOiAxMDgsCgkJTlVNUEFEX01VTFRJUExZOiAxMDYsCgkJTlVNUEFEX1NVQlRSQUNUOiAxMDksCgkJUEFHRV9ET1dOOiAzNCwKCQlQQUdFX1VQOiAzMywKCQlQRVJJT0Q6IDE5MCwKCQlSSUdIVDogMzksCgkJU1BBQ0U6IDMyLAoJCVRBQjogOSwKCQlVUDogMzgKCX0KfSk7CgovLyBwbHVnaW5zCiQuZm4uZXh0ZW5kKHsKCWZvY3VzOiAoZnVuY3Rpb24oIG9yaWcgKSB7CgkJcmV0dXJuIGZ1bmN0aW9uKCBkZWxheSwgZm4gKSB7CgkJCXJldHVybiB0eXBlb2YgZGVsYXkgPT09ICJudW1iZXIiID8KCQkJCXRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCQl2YXIgZWxlbSA9IHRoaXM7CgkJCQkJc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQkJCQkJJCggZWxlbSApLmZvY3VzKCk7CgkJCQkJCWlmICggZm4gKSB7CgkJCQkJCQlmbi5jYWxsKCBlbGVtICk7CgkJCQkJCX0KCQkJCQl9LCBkZWxheSApOwoJCQkJfSkgOgoJCQkJb3JpZy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJfTsKCX0pKCAkLmZuLmZvY3VzICksCgoJc2Nyb2xsUGFyZW50OiBmdW5jdGlvbigpIHsKCQl2YXIgc2Nyb2xsUGFyZW50OwoJCWlmICgoJC51aS5pZSAmJiAoLyhzdGF0aWN8cmVsYXRpdmUpLykudGVzdCh0aGlzLmNzcygicG9zaXRpb24iKSkpIHx8ICgvYWJzb2x1dGUvKS50ZXN0KHRoaXMuY3NzKCJwb3NpdGlvbiIpKSkgewoJCQlzY3JvbGxQYXJlbnQgPSB0aGlzLnBhcmVudHMoKS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gKC8ocmVsYXRpdmV8YWJzb2x1dGV8Zml4ZWQpLykudGVzdCgkLmNzcyh0aGlzLCJwb3NpdGlvbiIpKSAmJiAoLyhhdXRvfHNjcm9sbCkvKS50ZXN0KCQuY3NzKHRoaXMsIm92ZXJmbG93IikrJC5jc3ModGhpcywib3ZlcmZsb3cteSIpKyQuY3NzKHRoaXMsIm92ZXJmbG93LXgiKSk7CgkJCX0pLmVxKDApOwoJCX0gZWxzZSB7CgkJCXNjcm9sbFBhcmVudCA9IHRoaXMucGFyZW50cygpLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJCXJldHVybiAoLyhhdXRvfHNjcm9sbCkvKS50ZXN0KCQuY3NzKHRoaXMsIm92ZXJmbG93IikrJC5jc3ModGhpcywib3ZlcmZsb3cteSIpKyQuY3NzKHRoaXMsIm92ZXJmbG93LXgiKSk7CgkJCX0pLmVxKDApOwoJCX0KCgkJcmV0dXJuICgvZml4ZWQvKS50ZXN0KHRoaXMuY3NzKCJwb3NpdGlvbiIpKSB8fCAhc2Nyb2xsUGFyZW50Lmxlbmd0aCA/ICQoZG9jdW1lbnQpIDogc2Nyb2xsUGFyZW50OwoJfSwKCgl6SW5kZXg6IGZ1bmN0aW9uKCB6SW5kZXggKSB7CgkJaWYgKCB6SW5kZXggIT09IHVuZGVmaW5lZCApIHsKCQkJcmV0dXJuIHRoaXMuY3NzKCAiekluZGV4IiwgekluZGV4ICk7CgkJfQoKCQlpZiAoIHRoaXMubGVuZ3RoICkgewoJCQl2YXIgZWxlbSA9ICQoIHRoaXNbIDAgXSApLCBwb3NpdGlvbiwgdmFsdWU7CgkJCXdoaWxlICggZWxlbS5sZW5ndGggJiYgZWxlbVsgMCBdICE9PSBkb2N1bWVudCApIHsKCQkJCS8vIElnbm9yZSB6LWluZGV4IGlmIHBvc2l0aW9uIGlzIHNldCB0byBhIHZhbHVlIHdoZXJlIHotaW5kZXggaXMgaWdub3JlZCBieSB0aGUgYnJvd3NlcgoJCQkJLy8gVGhpcyBtYWtlcyBiZWhhdmlvciBvZiB0aGlzIGZ1bmN0aW9uIGNvbnNpc3RlbnQgYWNyb3NzIGJyb3dzZXJzCgkJCQkvLyBXZWJLaXQgYWx3YXlzIHJldHVybnMgYXV0byBpZiB0aGUgZWxlbWVudCBpcyBwb3NpdGlvbmVkCgkJCQlwb3NpdGlvbiA9IGVsZW0uY3NzKCAicG9zaXRpb24iICk7CgkJCQlpZiAoIHBvc2l0aW9uID09PSAiYWJzb2x1dGUiIHx8IHBvc2l0aW9uID09PSAicmVsYXRpdmUiIHx8IHBvc2l0aW9uID09PSAiZml4ZWQiICkgewoJCQkJCS8vIElFIHJldHVybnMgMCB3aGVuIHpJbmRleCBpcyBub3Qgc3BlY2lmaWVkCgkJCQkJLy8gb3RoZXIgYnJvd3NlcnMgcmV0dXJuIGEgc3RyaW5nCgkJCQkJLy8gd2UgaWdub3JlIHRoZSBjYXNlIG9mIG5lc3RlZCBlbGVtZW50cyB3aXRoIGFuIGV4cGxpY2l0IHZhbHVlIG9mIDAKCQkJCQkvLyA8ZGl2IHN0eWxlPSJ6LWluZGV4OiAtMTA7Ij48ZGl2IHN0eWxlPSJ6LWluZGV4OiAwOyI+PC9kaXY+PC9kaXY+CgkJCQkJdmFsdWUgPSBwYXJzZUludCggZWxlbS5jc3MoICJ6SW5kZXgiICksIDEwICk7CgkJCQkJaWYgKCAhaXNOYU4oIHZhbHVlICkgJiYgdmFsdWUgIT09IDAgKSB7CgkJCQkJCXJldHVybiB2YWx1ZTsKCQkJCQl9CgkJCQl9CgkJCQllbGVtID0gZWxlbS5wYXJlbnQoKTsKCQkJfQoJCX0KCgkJcmV0dXJuIDA7Cgl9LAoKCXVuaXF1ZUlkOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoICF0aGlzLmlkICkgewoJCQkJdGhpcy5pZCA9ICJ1aS1pZC0iICsgKCsrdXVpZCk7CgkJCX0KCQl9KTsKCX0sCgoJcmVtb3ZlVW5pcXVlSWQ6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWlmICggcnVuaXF1ZUlkLnRlc3QoIHRoaXMuaWQgKSApIHsKCQkJCSQoIHRoaXMgKS5yZW1vdmVBdHRyKCAiaWQiICk7CgkJCX0KCQl9KTsKCX0KfSk7CgovLyBzZWxlY3RvcnMKZnVuY3Rpb24gZm9jdXNhYmxlKCBlbGVtZW50LCBpc1RhYkluZGV4Tm90TmFOICkgewoJdmFyIG1hcCwgbWFwTmFtZSwgaW1nLAoJCW5vZGVOYW1lID0gZWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJaWYgKCAiYXJlYSIgPT09IG5vZGVOYW1lICkgewoJCW1hcCA9IGVsZW1lbnQucGFyZW50Tm9kZTsKCQltYXBOYW1lID0gbWFwLm5hbWU7CgkJaWYgKCAhZWxlbWVudC5ocmVmIHx8ICFtYXBOYW1lIHx8IG1hcC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAibWFwIiApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCQlpbWcgPSAkKCAiaW1nW3VzZW1hcD0jIiArIG1hcE5hbWUgKyAiXSIgKVswXTsKCQlyZXR1cm4gISFpbWcgJiYgdmlzaWJsZSggaW1nICk7Cgl9CglyZXR1cm4gKCAvaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbnxvYmplY3QvLnRlc3QoIG5vZGVOYW1lICkgPwoJCSFlbGVtZW50LmRpc2FibGVkIDoKCQkiYSIgPT09IG5vZGVOYW1lID8KCQkJZWxlbWVudC5ocmVmIHx8IGlzVGFiSW5kZXhOb3ROYU4gOgoJCQlpc1RhYkluZGV4Tm90TmFOKSAmJgoJCS8vIHRoZSBlbGVtZW50IGFuZCBhbGwgb2YgaXRzIGFuY2VzdG9ycyBtdXN0IGJlIHZpc2libGUKCQl2aXNpYmxlKCBlbGVtZW50ICk7Cn0KCmZ1bmN0aW9uIHZpc2libGUoIGVsZW1lbnQgKSB7CglyZXR1cm4gJC5leHByLmZpbHRlcnMudmlzaWJsZSggZWxlbWVudCApICYmCgkJISQoIGVsZW1lbnQgKS5wYXJlbnRzKCkuYWRkQmFjaygpLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJcmV0dXJuICQuY3NzKCB0aGlzLCAidmlzaWJpbGl0eSIgKSA9PT0gImhpZGRlbiI7CgkJfSkubGVuZ3RoOwp9CgokLmV4dGVuZCggJC5leHByWyAiOiIgXSwgewoJZGF0YTogJC5leHByLmNyZWF0ZVBzZXVkbyA/CgkJJC5leHByLmNyZWF0ZVBzZXVkbyhmdW5jdGlvbiggZGF0YU5hbWUgKSB7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiAhISQuZGF0YSggZWxlbSwgZGF0YU5hbWUgKTsKCQkJfTsKCQl9KSA6CgkJLy8gc3VwcG9ydDogalF1ZXJ5IDwxLjgKCQlmdW5jdGlvbiggZWxlbSwgaSwgbWF0Y2ggKSB7CgkJCXJldHVybiAhISQuZGF0YSggZWxlbSwgbWF0Y2hbIDMgXSApOwoJCX0sCgoJZm9jdXNhYmxlOiBmdW5jdGlvbiggZWxlbWVudCApIHsKCQlyZXR1cm4gZm9jdXNhYmxlKCBlbGVtZW50LCAhaXNOYU4oICQuYXR0ciggZWxlbWVudCwgInRhYmluZGV4IiApICkgKTsKCX0sCgoJdGFiYmFibGU6IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCXZhciB0YWJJbmRleCA9ICQuYXR0ciggZWxlbWVudCwgInRhYmluZGV4IiApLAoJCQlpc1RhYkluZGV4TmFOID0gaXNOYU4oIHRhYkluZGV4ICk7CgkJcmV0dXJuICggaXNUYWJJbmRleE5hTiB8fCB0YWJJbmRleCA+PSAwICkgJiYgZm9jdXNhYmxlKCBlbGVtZW50LCAhaXNUYWJJbmRleE5hTiApOwoJfQp9KTsKCi8vIHN1cHBvcnQ6IGpRdWVyeSA8MS44CmlmICggISQoICI8YT4iICkub3V0ZXJXaWR0aCggMSApLmpxdWVyeSApIHsKCSQuZWFjaCggWyAiV2lkdGgiLCAiSGVpZ2h0IiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCQl2YXIgc2lkZSA9IG5hbWUgPT09ICJXaWR0aCIgPyBbICJMZWZ0IiwgIlJpZ2h0IiBdIDogWyAiVG9wIiwgIkJvdHRvbSIgXSwKCQkJdHlwZSA9IG5hbWUudG9Mb3dlckNhc2UoKSwKCQkJb3JpZyA9IHsKCQkJCWlubmVyV2lkdGg6ICQuZm4uaW5uZXJXaWR0aCwKCQkJCWlubmVySGVpZ2h0OiAkLmZuLmlubmVySGVpZ2h0LAoJCQkJb3V0ZXJXaWR0aDogJC5mbi5vdXRlcldpZHRoLAoJCQkJb3V0ZXJIZWlnaHQ6ICQuZm4ub3V0ZXJIZWlnaHQKCQkJfTsKCgkJZnVuY3Rpb24gcmVkdWNlKCBlbGVtLCBzaXplLCBib3JkZXIsIG1hcmdpbiApIHsKCQkJJC5lYWNoKCBzaWRlLCBmdW5jdGlvbigpIHsKCQkJCXNpemUgLT0gcGFyc2VGbG9hdCggJC5jc3MoIGVsZW0sICJwYWRkaW5nIiArIHRoaXMgKSApIHx8IDA7CgkJCQlpZiAoIGJvcmRlciApIHsKCQkJCQlzaXplIC09IHBhcnNlRmxvYXQoICQuY3NzKCBlbGVtLCAiYm9yZGVyIiArIHRoaXMgKyAiV2lkdGgiICkgKSB8fCAwOwoJCQkJfQoJCQkJaWYgKCBtYXJnaW4gKSB7CgkJCQkJc2l6ZSAtPSBwYXJzZUZsb2F0KCAkLmNzcyggZWxlbSwgIm1hcmdpbiIgKyB0aGlzICkgKSB8fCAwOwoJCQkJfQoJCQl9KTsKCQkJcmV0dXJuIHNpemU7CgkJfQoKCQkkLmZuWyAiaW5uZXIiICsgbmFtZSBdID0gZnVuY3Rpb24oIHNpemUgKSB7CgkJCWlmICggc2l6ZSA9PT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIG9yaWdbICJpbm5lciIgKyBuYW1lIF0uY2FsbCggdGhpcyApOwoJCQl9CgoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJJCggdGhpcyApLmNzcyggdHlwZSwgcmVkdWNlKCB0aGlzLCBzaXplICkgKyAicHgiICk7CgkJCX0pOwoJCX07CgoJCSQuZm5bICJvdXRlciIgKyBuYW1lXSA9IGZ1bmN0aW9uKCBzaXplLCBtYXJnaW4gKSB7CgkJCWlmICggdHlwZW9mIHNpemUgIT09ICJudW1iZXIiICkgewoJCQkJcmV0dXJuIG9yaWdbICJvdXRlciIgKyBuYW1lIF0uY2FsbCggdGhpcywgc2l6ZSApOwoJCQl9CgoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJJCggdGhpcykuY3NzKCB0eXBlLCByZWR1Y2UoIHRoaXMsIHNpemUsIHRydWUsIG1hcmdpbiApICsgInB4IiApOwoJCQl9KTsKCQl9OwoJfSk7Cn0KCi8vIHN1cHBvcnQ6IGpRdWVyeSA8MS44CmlmICggISQuZm4uYWRkQmFjayApIHsKCSQuZm4uYWRkQmFjayA9IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5hZGQoIHNlbGVjdG9yID09IG51bGwgPwoJCQl0aGlzLnByZXZPYmplY3QgOiB0aGlzLnByZXZPYmplY3QuZmlsdGVyKCBzZWxlY3RvciApCgkJKTsKCX07Cn0KCi8vIHN1cHBvcnQ6IGpRdWVyeSAxLjYuMSwgMS42LjIgKGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0Lzk0MTMpCmlmICggJCggIjxhPiIgKS5kYXRhKCAiYS1iIiwgImEiICkucmVtb3ZlRGF0YSggImEtYiIgKS5kYXRhKCAiYS1iIiApICkgewoJJC5mbi5yZW1vdmVEYXRhID0gKGZ1bmN0aW9uKCByZW1vdmVEYXRhICkgewoJCXJldHVybiBmdW5jdGlvbigga2V5ICkgewoJCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCQlyZXR1cm4gcmVtb3ZlRGF0YS5jYWxsKCB0aGlzLCAkLmNhbWVsQ2FzZSgga2V5ICkgKTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiByZW1vdmVEYXRhLmNhbGwoIHRoaXMgKTsKCQkJfQoJCX07Cgl9KSggJC5mbi5yZW1vdmVEYXRhICk7Cn0KCgoKCgovLyBkZXByZWNhdGVkCiQudWkuaWUgPSAhIS9tc2llIFtcdy5dKy8uZXhlYyggbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpICk7CgokLnN1cHBvcnQuc2VsZWN0c3RhcnQgPSAib25zZWxlY3RzdGFydCIgaW4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKTsKJC5mbi5leHRlbmQoewoJZGlzYWJsZVNlbGVjdGlvbjogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuYmluZCggKCAkLnN1cHBvcnQuc2VsZWN0c3RhcnQgPyAic2VsZWN0c3RhcnQiIDogIm1vdXNlZG93biIgKSArCgkJCSIudWktZGlzYWJsZVNlbGVjdGlvbiIsIGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCX0pOwoJfSwKCgllbmFibGVTZWxlY3Rpb246IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnVuYmluZCggIi51aS1kaXNhYmxlU2VsZWN0aW9uIiApOwoJfQp9KTsKCiQuZXh0ZW5kKCAkLnVpLCB7CgkvLyAkLnVpLnBsdWdpbiBpcyBkZXByZWNhdGVkLiBVc2UgJC53aWRnZXQoKSBleHRlbnNpb25zIGluc3RlYWQuCglwbHVnaW46IHsKCQlhZGQ6IGZ1bmN0aW9uKCBtb2R1bGUsIG9wdGlvbiwgc2V0ICkgewoJCQl2YXIgaSwKCQkJCXByb3RvID0gJC51aVsgbW9kdWxlIF0ucHJvdG90eXBlOwoJCQlmb3IgKCBpIGluIHNldCApIHsKCQkJCXByb3RvLnBsdWdpbnNbIGkgXSA9IHByb3RvLnBsdWdpbnNbIGkgXSB8fCBbXTsKCQkJCXByb3RvLnBsdWdpbnNbIGkgXS5wdXNoKCBbIG9wdGlvbiwgc2V0WyBpIF0gXSApOwoJCQl9CgkJfSwKCQljYWxsOiBmdW5jdGlvbiggaW5zdGFuY2UsIG5hbWUsIGFyZ3MgKSB7CgkJCXZhciBpLAoJCQkJc2V0ID0gaW5zdGFuY2UucGx1Z2luc1sgbmFtZSBdOwoJCQlpZiAoICFzZXQgfHwgIWluc3RhbmNlLmVsZW1lbnRbIDAgXS5wYXJlbnROb2RlIHx8IGluc3RhbmNlLmVsZW1lbnRbIDAgXS5wYXJlbnROb2RlLm5vZGVUeXBlID09PSAxMSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJZm9yICggaSA9IDA7IGkgPCBzZXQubGVuZ3RoOyBpKysgKSB7CgkJCQlpZiAoIGluc3RhbmNlLm9wdGlvbnNbIHNldFsgaSBdWyAwIF0gXSApIHsKCQkJCQlzZXRbIGkgXVsgMSBdLmFwcGx5KCBpbnN0YW5jZS5lbGVtZW50LCBhcmdzICk7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCS8vIG9ubHkgdXNlZCBieSByZXNpemFibGUKCWhhc1Njcm9sbDogZnVuY3Rpb24oIGVsLCBhICkgewoKCQkvL0lmIG92ZXJmbG93IGlzIGhpZGRlbiwgdGhlIGVsZW1lbnQgbWlnaHQgaGF2ZSBleHRyYSBjb250ZW50LCBidXQgdGhlIHVzZXIgd2FudHMgdG8gaGlkZSBpdAoJCWlmICggJCggZWwgKS5jc3MoICJvdmVyZmxvdyIgKSA9PT0gImhpZGRlbiIpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJdmFyIHNjcm9sbCA9ICggYSAmJiBhID09PSAibGVmdCIgKSA/ICJzY3JvbGxMZWZ0IiA6ICJzY3JvbGxUb3AiLAoJCQloYXMgPSBmYWxzZTsKCgkJaWYgKCBlbFsgc2Nyb2xsIF0gPiAwICkgewoJCQlyZXR1cm4gdHJ1ZTsKCQl9CgoJCS8vIFRPRE86IGRldGVybWluZSB3aGljaCBjYXNlcyBhY3R1YWxseSBjYXVzZSB0aGlzIHRvIGhhcHBlbgoJCS8vIGlmIHRoZSBlbGVtZW50IGRvZXNuJ3QgaGF2ZSB0aGUgc2Nyb2xsIHNldCwgc2VlIGlmIGl0J3MgcG9zc2libGUgdG8KCQkvLyBzZXQgdGhlIHNjcm9sbAoJCWVsWyBzY3JvbGwgXSA9IDE7CgkJaGFzID0gKCBlbFsgc2Nyb2xsIF0gPiAwICk7CgkJZWxbIHNjcm9sbCBdID0gMDsKCQlyZXR1cm4gaGFzOwoJfQp9KTsKCn0pKCBqUXVlcnkgKTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKdmFyIHV1aWQgPSAwLAoJc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UsCglfY2xlYW5EYXRhID0gJC5jbGVhbkRhdGE7CiQuY2xlYW5EYXRhID0gZnVuY3Rpb24oIGVsZW1zICkgewoJZm9yICggdmFyIGkgPSAwLCBlbGVtOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgkJdHJ5IHsKCQkJJCggZWxlbSApLnRyaWdnZXJIYW5kbGVyKCAicmVtb3ZlIiApOwoJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzgyMzUKCQl9IGNhdGNoKCBlICkge30KCX0KCV9jbGVhbkRhdGEoIGVsZW1zICk7Cn07CgokLndpZGdldCA9IGZ1bmN0aW9uKCBuYW1lLCBiYXNlLCBwcm90b3R5cGUgKSB7Cgl2YXIgZnVsbE5hbWUsIGV4aXN0aW5nQ29uc3RydWN0b3IsIGNvbnN0cnVjdG9yLCBiYXNlUHJvdG90eXBlLAoJCS8vIHByb3hpZWRQcm90b3R5cGUgYWxsb3dzIHRoZSBwcm92aWRlZCBwcm90b3R5cGUgdG8gcmVtYWluIHVubW9kaWZpZWQKCQkvLyBzbyB0aGF0IGl0IGNhbiBiZSB1c2VkIGFzIGEgbWl4aW4gZm9yIG11bHRpcGxlIHdpZGdldHMgKCM4ODc2KQoJCXByb3hpZWRQcm90b3R5cGUgPSB7fSwKCQluYW1lc3BhY2UgPSBuYW1lLnNwbGl0KCAiLiIgKVsgMCBdOwoKCW5hbWUgPSBuYW1lLnNwbGl0KCAiLiIgKVsgMSBdOwoJZnVsbE5hbWUgPSBuYW1lc3BhY2UgKyAiLSIgKyBuYW1lOwoKCWlmICggIXByb3RvdHlwZSApIHsKCQlwcm90b3R5cGUgPSBiYXNlOwoJCWJhc2UgPSAkLldpZGdldDsKCX0KCgkvLyBjcmVhdGUgc2VsZWN0b3IgZm9yIHBsdWdpbgoJJC5leHByWyAiOiIgXVsgZnVsbE5hbWUudG9Mb3dlckNhc2UoKSBdID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuICEhJC5kYXRhKCBlbGVtLCBmdWxsTmFtZSApOwoJfTsKCgkkWyBuYW1lc3BhY2UgXSA9ICRbIG5hbWVzcGFjZSBdIHx8IHt9OwoJZXhpc3RpbmdDb25zdHJ1Y3RvciA9ICRbIG5hbWVzcGFjZSBdWyBuYW1lIF07Cgljb25zdHJ1Y3RvciA9ICRbIG5hbWVzcGFjZSBdWyBuYW1lIF0gPSBmdW5jdGlvbiggb3B0aW9ucywgZWxlbWVudCApIHsKCQkvLyBhbGxvdyBpbnN0YW50aWF0aW9uIHdpdGhvdXQgIm5ldyIga2V5d29yZAoJCWlmICggIXRoaXMuX2NyZWF0ZVdpZGdldCApIHsKCQkJcmV0dXJuIG5ldyBjb25zdHJ1Y3Rvciggb3B0aW9ucywgZWxlbWVudCApOwoJCX0KCgkJLy8gYWxsb3cgaW5zdGFudGlhdGlvbiB3aXRob3V0IGluaXRpYWxpemluZyBmb3Igc2ltcGxlIGluaGVyaXRhbmNlCgkJLy8gbXVzdCB1c2UgIm5ldyIga2V5d29yZCAodGhlIGNvZGUgYWJvdmUgYWx3YXlzIHBhc3NlcyBhcmdzKQoJCWlmICggYXJndW1lbnRzLmxlbmd0aCApIHsKCQkJdGhpcy5fY3JlYXRlV2lkZ2V0KCBvcHRpb25zLCBlbGVtZW50ICk7CgkJfQoJfTsKCS8vIGV4dGVuZCB3aXRoIHRoZSBleGlzdGluZyBjb25zdHJ1Y3RvciB0byBjYXJyeSBvdmVyIGFueSBzdGF0aWMgcHJvcGVydGllcwoJJC5leHRlbmQoIGNvbnN0cnVjdG9yLCBleGlzdGluZ0NvbnN0cnVjdG9yLCB7CgkJdmVyc2lvbjogcHJvdG90eXBlLnZlcnNpb24sCgkJLy8gY29weSB0aGUgb2JqZWN0IHVzZWQgdG8gY3JlYXRlIHRoZSBwcm90b3R5cGUgaW4gY2FzZSB3ZSBuZWVkIHRvCgkJLy8gcmVkZWZpbmUgdGhlIHdpZGdldCBsYXRlcgoJCV9wcm90bzogJC5leHRlbmQoIHt9LCBwcm90b3R5cGUgKSwKCQkvLyB0cmFjayB3aWRnZXRzIHRoYXQgaW5oZXJpdCBmcm9tIHRoaXMgd2lkZ2V0IGluIGNhc2UgdGhpcyB3aWRnZXQgaXMKCQkvLyByZWRlZmluZWQgYWZ0ZXIgYSB3aWRnZXQgaW5oZXJpdHMgZnJvbSBpdAoJCV9jaGlsZENvbnN0cnVjdG9yczogW10KCX0pOwoKCWJhc2VQcm90b3R5cGUgPSBuZXcgYmFzZSgpOwoJLy8gd2UgbmVlZCB0byBtYWtlIHRoZSBvcHRpb25zIGhhc2ggYSBwcm9wZXJ0eSBkaXJlY3RseSBvbiB0aGUgbmV3IGluc3RhbmNlCgkvLyBvdGhlcndpc2Ugd2UnbGwgbW9kaWZ5IHRoZSBvcHRpb25zIGhhc2ggb24gdGhlIHByb3RvdHlwZSB0aGF0IHdlJ3JlCgkvLyBpbmhlcml0aW5nIGZyb20KCWJhc2VQcm90b3R5cGUub3B0aW9ucyA9ICQud2lkZ2V0LmV4dGVuZCgge30sIGJhc2VQcm90b3R5cGUub3B0aW9ucyApOwoJJC5lYWNoKCBwcm90b3R5cGUsIGZ1bmN0aW9uKCBwcm9wLCB2YWx1ZSApIHsKCQlpZiAoICEkLmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXByb3hpZWRQcm90b3R5cGVbIHByb3AgXSA9IHZhbHVlOwoJCQlyZXR1cm47CgkJfQoJCXByb3hpZWRQcm90b3R5cGVbIHByb3AgXSA9IChmdW5jdGlvbigpIHsKCQkJdmFyIF9zdXBlciA9IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBiYXNlLnByb3RvdHlwZVsgcHJvcCBdLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJCX0sCgkJCQlfc3VwZXJBcHBseSA9IGZ1bmN0aW9uKCBhcmdzICkgewoJCQkJCXJldHVybiBiYXNlLnByb3RvdHlwZVsgcHJvcCBdLmFwcGx5KCB0aGlzLCBhcmdzICk7CgkJCQl9OwoJCQlyZXR1cm4gZnVuY3Rpb24oKSB7CgkJCQl2YXIgX19zdXBlciA9IHRoaXMuX3N1cGVyLAoJCQkJCV9fc3VwZXJBcHBseSA9IHRoaXMuX3N1cGVyQXBwbHksCgkJCQkJcmV0dXJuVmFsdWU7CgoJCQkJdGhpcy5fc3VwZXIgPSBfc3VwZXI7CgkJCQl0aGlzLl9zdXBlckFwcGx5ID0gX3N1cGVyQXBwbHk7CgoJCQkJcmV0dXJuVmFsdWUgPSB2YWx1ZS5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgoJCQkJdGhpcy5fc3VwZXIgPSBfX3N1cGVyOwoJCQkJdGhpcy5fc3VwZXJBcHBseSA9IF9fc3VwZXJBcHBseTsKCgkJCQlyZXR1cm4gcmV0dXJuVmFsdWU7CgkJCX07CgkJfSkoKTsKCX0pOwoJY29uc3RydWN0b3IucHJvdG90eXBlID0gJC53aWRnZXQuZXh0ZW5kKCBiYXNlUHJvdG90eXBlLCB7CgkJLy8gVE9ETzogcmVtb3ZlIHN1cHBvcnQgZm9yIHdpZGdldEV2ZW50UHJlZml4CgkJLy8gYWx3YXlzIHVzZSB0aGUgbmFtZSArIGEgY29sb24gYXMgdGhlIHByZWZpeCwgZS5nLiwgZHJhZ2dhYmxlOnN0YXJ0CgkJLy8gZG9uJ3QgcHJlZml4IGZvciB3aWRnZXRzIHRoYXQgYXJlbid0IERPTS1iYXNlZAoJCXdpZGdldEV2ZW50UHJlZml4OiBleGlzdGluZ0NvbnN0cnVjdG9yID8gKGJhc2VQcm90b3R5cGUud2lkZ2V0RXZlbnRQcmVmaXggfHwgbmFtZSkgOiBuYW1lCgl9LCBwcm94aWVkUHJvdG90eXBlLCB7CgkJY29uc3RydWN0b3I6IGNvbnN0cnVjdG9yLAoJCW5hbWVzcGFjZTogbmFtZXNwYWNlLAoJCXdpZGdldE5hbWU6IG5hbWUsCgkJd2lkZ2V0RnVsbE5hbWU6IGZ1bGxOYW1lCgl9KTsKCgkvLyBJZiB0aGlzIHdpZGdldCBpcyBiZWluZyByZWRlZmluZWQgdGhlbiB3ZSBuZWVkIHRvIGZpbmQgYWxsIHdpZGdldHMgdGhhdAoJLy8gYXJlIGluaGVyaXRpbmcgZnJvbSBpdCBhbmQgcmVkZWZpbmUgYWxsIG9mIHRoZW0gc28gdGhhdCB0aGV5IGluaGVyaXQgZnJvbQoJLy8gdGhlIG5ldyB2ZXJzaW9uIG9mIHRoaXMgd2lkZ2V0LiBXZSdyZSBlc3NlbnRpYWxseSB0cnlpbmcgdG8gcmVwbGFjZSBvbmUKCS8vIGxldmVsIGluIHRoZSBwcm90b3R5cGUgY2hhaW4uCglpZiAoIGV4aXN0aW5nQ29uc3RydWN0b3IgKSB7CgkJJC5lYWNoKCBleGlzdGluZ0NvbnN0cnVjdG9yLl9jaGlsZENvbnN0cnVjdG9ycywgZnVuY3Rpb24oIGksIGNoaWxkICkgewoJCQl2YXIgY2hpbGRQcm90b3R5cGUgPSBjaGlsZC5wcm90b3R5cGU7CgoJCQkvLyByZWRlZmluZSB0aGUgY2hpbGQgd2lkZ2V0IHVzaW5nIHRoZSBzYW1lIHByb3RvdHlwZSB0aGF0IHdhcwoJCQkvLyBvcmlnaW5hbGx5IHVzZWQsIGJ1dCBpbmhlcml0IGZyb20gdGhlIG5ldyB2ZXJzaW9uIG9mIHRoZSBiYXNlCgkJCSQud2lkZ2V0KCBjaGlsZFByb3RvdHlwZS5uYW1lc3BhY2UgKyAiLiIgKyBjaGlsZFByb3RvdHlwZS53aWRnZXROYW1lLCBjb25zdHJ1Y3RvciwgY2hpbGQuX3Byb3RvICk7CgkJfSk7CgkJLy8gcmVtb3ZlIHRoZSBsaXN0IG9mIGV4aXN0aW5nIGNoaWxkIGNvbnN0cnVjdG9ycyBmcm9tIHRoZSBvbGQgY29uc3RydWN0b3IKCQkvLyBzbyB0aGUgb2xkIGNoaWxkIGNvbnN0cnVjdG9ycyBjYW4gYmUgZ2FyYmFnZSBjb2xsZWN0ZWQKCQlkZWxldGUgZXhpc3RpbmdDb25zdHJ1Y3Rvci5fY2hpbGRDb25zdHJ1Y3RvcnM7Cgl9IGVsc2UgewoJCWJhc2UuX2NoaWxkQ29uc3RydWN0b3JzLnB1c2goIGNvbnN0cnVjdG9yICk7Cgl9CgoJJC53aWRnZXQuYnJpZGdlKCBuYW1lLCBjb25zdHJ1Y3RvciApOwp9OwoKJC53aWRnZXQuZXh0ZW5kID0gZnVuY3Rpb24oIHRhcmdldCApIHsKCXZhciBpbnB1dCA9IHNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMSApLAoJCWlucHV0SW5kZXggPSAwLAoJCWlucHV0TGVuZ3RoID0gaW5wdXQubGVuZ3RoLAoJCWtleSwKCQl2YWx1ZTsKCWZvciAoIDsgaW5wdXRJbmRleCA8IGlucHV0TGVuZ3RoOyBpbnB1dEluZGV4KysgKSB7CgkJZm9yICgga2V5IGluIGlucHV0WyBpbnB1dEluZGV4IF0gKSB7CgkJCXZhbHVlID0gaW5wdXRbIGlucHV0SW5kZXggXVsga2V5IF07CgkJCWlmICggaW5wdXRbIGlucHV0SW5kZXggXS5oYXNPd25Qcm9wZXJ0eSgga2V5ICkgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCQkJCS8vIENsb25lIG9iamVjdHMKCQkJCWlmICggJC5pc1BsYWluT2JqZWN0KCB2YWx1ZSApICkgewoJCQkJCXRhcmdldFsga2V5IF0gPSAkLmlzUGxhaW5PYmplY3QoIHRhcmdldFsga2V5IF0gKSA/CgkJCQkJCSQud2lkZ2V0LmV4dGVuZCgge30sIHRhcmdldFsga2V5IF0sIHZhbHVlICkgOgoJCQkJCQkvLyBEb24ndCBleHRlbmQgc3RyaW5ncywgYXJyYXlzLCBldGMuIHdpdGggb2JqZWN0cwoJCQkJCQkkLndpZGdldC5leHRlbmQoIHt9LCB2YWx1ZSApOwoJCQkJLy8gQ29weSBldmVyeXRoaW5nIGVsc2UgYnkgcmVmZXJlbmNlCgkJCQl9IGVsc2UgewoJCQkJCXRhcmdldFsga2V5IF0gPSB2YWx1ZTsKCQkJCX0KCQkJfQoJCX0KCX0KCXJldHVybiB0YXJnZXQ7Cn07CgokLndpZGdldC5icmlkZ2UgPSBmdW5jdGlvbiggbmFtZSwgb2JqZWN0ICkgewoJdmFyIGZ1bGxOYW1lID0gb2JqZWN0LnByb3RvdHlwZS53aWRnZXRGdWxsTmFtZSB8fCBuYW1lOwoJJC5mblsgbmFtZSBdID0gZnVuY3Rpb24oIG9wdGlvbnMgKSB7CgkJdmFyIGlzTWV0aG9kQ2FsbCA9IHR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIiwKCQkJYXJncyA9IHNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMSApLAoJCQlyZXR1cm5WYWx1ZSA9IHRoaXM7CgoJCS8vIGFsbG93IG11bHRpcGxlIGhhc2hlcyB0byBiZSBwYXNzZWQgb24gaW5pdAoJCW9wdGlvbnMgPSAhaXNNZXRob2RDYWxsICYmIGFyZ3MubGVuZ3RoID8KCQkJJC53aWRnZXQuZXh0ZW5kLmFwcGx5KCBudWxsLCBbIG9wdGlvbnMgXS5jb25jYXQoYXJncykgKSA6CgkJCW9wdGlvbnM7CgoJCWlmICggaXNNZXRob2RDYWxsICkgewoJCQl0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQl2YXIgbWV0aG9kVmFsdWUsCgkJCQkJaW5zdGFuY2UgPSAkLmRhdGEoIHRoaXMsIGZ1bGxOYW1lICk7CgkJCQlpZiAoICFpbnN0YW5jZSApIHsKCQkJCQlyZXR1cm4gJC5lcnJvciggImNhbm5vdCBjYWxsIG1ldGhvZHMgb24gIiArIG5hbWUgKyAiIHByaW9yIHRvIGluaXRpYWxpemF0aW9uOyAiICsKCQkJCQkJImF0dGVtcHRlZCB0byBjYWxsIG1ldGhvZCAnIiArIG9wdGlvbnMgKyAiJyIgKTsKCQkJCX0KCQkJCWlmICggISQuaXNGdW5jdGlvbiggaW5zdGFuY2Vbb3B0aW9uc10gKSB8fCBvcHRpb25zLmNoYXJBdCggMCApID09PSAiXyIgKSB7CgkJCQkJcmV0dXJuICQuZXJyb3IoICJubyBzdWNoIG1ldGhvZCAnIiArIG9wdGlvbnMgKyAiJyBmb3IgIiArIG5hbWUgKyAiIHdpZGdldCBpbnN0YW5jZSIgKTsKCQkJCX0KCQkJCW1ldGhvZFZhbHVlID0gaW5zdGFuY2VbIG9wdGlvbnMgXS5hcHBseSggaW5zdGFuY2UsIGFyZ3MgKTsKCQkJCWlmICggbWV0aG9kVmFsdWUgIT09IGluc3RhbmNlICYmIG1ldGhvZFZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJcmV0dXJuVmFsdWUgPSBtZXRob2RWYWx1ZSAmJiBtZXRob2RWYWx1ZS5qcXVlcnkgPwoJCQkJCQlyZXR1cm5WYWx1ZS5wdXNoU3RhY2soIG1ldGhvZFZhbHVlLmdldCgpICkgOgoJCQkJCQltZXRob2RWYWx1ZTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0pOwoJCX0gZWxzZSB7CgkJCXRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCXZhciBpbnN0YW5jZSA9ICQuZGF0YSggdGhpcywgZnVsbE5hbWUgKTsKCQkJCWlmICggaW5zdGFuY2UgKSB7CgkJCQkJaW5zdGFuY2Uub3B0aW9uKCBvcHRpb25zIHx8IHt9ICkuX2luaXQoKTsKCQkJCX0gZWxzZSB7CgkJCQkJJC5kYXRhKCB0aGlzLCBmdWxsTmFtZSwgbmV3IG9iamVjdCggb3B0aW9ucywgdGhpcyApICk7CgkJCQl9CgkJCX0pOwoJCX0KCgkJcmV0dXJuIHJldHVyblZhbHVlOwoJfTsKfTsKCiQuV2lkZ2V0ID0gZnVuY3Rpb24oIC8qIG9wdGlvbnMsIGVsZW1lbnQgKi8gKSB7fTsKJC5XaWRnZXQuX2NoaWxkQ29uc3RydWN0b3JzID0gW107CgokLldpZGdldC5wcm90b3R5cGUgPSB7Cgl3aWRnZXROYW1lOiAid2lkZ2V0IiwKCXdpZGdldEV2ZW50UHJlZml4OiAiIiwKCWRlZmF1bHRFbGVtZW50OiAiPGRpdj4iLAoJb3B0aW9uczogewoJCWRpc2FibGVkOiBmYWxzZSwKCgkJLy8gY2FsbGJhY2tzCgkJY3JlYXRlOiBudWxsCgl9LAoJX2NyZWF0ZVdpZGdldDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW1lbnQgKSB7CgkJZWxlbWVudCA9ICQoIGVsZW1lbnQgfHwgdGhpcy5kZWZhdWx0RWxlbWVudCB8fCB0aGlzIClbIDAgXTsKCQl0aGlzLmVsZW1lbnQgPSAkKCBlbGVtZW50ICk7CgkJdGhpcy51dWlkID0gdXVpZCsrOwoJCXRoaXMuZXZlbnROYW1lc3BhY2UgPSAiLiIgKyB0aGlzLndpZGdldE5hbWUgKyB0aGlzLnV1aWQ7CgkJdGhpcy5vcHRpb25zID0gJC53aWRnZXQuZXh0ZW5kKCB7fSwKCQkJdGhpcy5vcHRpb25zLAoJCQl0aGlzLl9nZXRDcmVhdGVPcHRpb25zKCksCgkJCW9wdGlvbnMgKTsKCgkJdGhpcy5iaW5kaW5ncyA9ICQoKTsKCQl0aGlzLmhvdmVyYWJsZSA9ICQoKTsKCQl0aGlzLmZvY3VzYWJsZSA9ICQoKTsKCgkJaWYgKCBlbGVtZW50ICE9PSB0aGlzICkgewoJCQkkLmRhdGEoIGVsZW1lbnQsIHRoaXMud2lkZ2V0RnVsbE5hbWUsIHRoaXMgKTsKCQkJdGhpcy5fb24oIHRydWUsIHRoaXMuZWxlbWVudCwgewoJCQkJcmVtb3ZlOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJaWYgKCBldmVudC50YXJnZXQgPT09IGVsZW1lbnQgKSB7CgkJCQkJCXRoaXMuZGVzdHJveSgpOwoJCQkJCX0KCQkJCX0KCQkJfSk7CgkJCXRoaXMuZG9jdW1lbnQgPSAkKCBlbGVtZW50LnN0eWxlID8KCQkJCS8vIGVsZW1lbnQgd2l0aGluIHRoZSBkb2N1bWVudAoJCQkJZWxlbWVudC5vd25lckRvY3VtZW50IDoKCQkJCS8vIGVsZW1lbnQgaXMgd2luZG93IG9yIGRvY3VtZW50CgkJCQllbGVtZW50LmRvY3VtZW50IHx8IGVsZW1lbnQgKTsKCQkJdGhpcy53aW5kb3cgPSAkKCB0aGlzLmRvY3VtZW50WzBdLmRlZmF1bHRWaWV3IHx8IHRoaXMuZG9jdW1lbnRbMF0ucGFyZW50V2luZG93ICk7CgkJfQoKCQl0aGlzLl9jcmVhdGUoKTsKCQl0aGlzLl90cmlnZ2VyKCAiY3JlYXRlIiwgbnVsbCwgdGhpcy5fZ2V0Q3JlYXRlRXZlbnREYXRhKCkgKTsKCQl0aGlzLl9pbml0KCk7Cgl9LAoJX2dldENyZWF0ZU9wdGlvbnM6ICQubm9vcCwKCV9nZXRDcmVhdGVFdmVudERhdGE6ICQubm9vcCwKCV9jcmVhdGU6ICQubm9vcCwKCV9pbml0OiAkLm5vb3AsCgoJZGVzdHJveTogZnVuY3Rpb24oKSB7CgkJdGhpcy5fZGVzdHJveSgpOwoJCS8vIHdlIGNhbiBwcm9iYWJseSByZW1vdmUgdGhlIHVuYmluZCBjYWxscyBpbiAyLjAKCQkvLyBhbGwgZXZlbnQgYmluZGluZ3Mgc2hvdWxkIGdvIHRocm91Z2ggdGhpcy5fb24oKQoJCXRoaXMuZWxlbWVudAoJCQkudW5iaW5kKCB0aGlzLmV2ZW50TmFtZXNwYWNlICkKCQkJLy8gMS45IEJDIGZvciAjNzgxMAoJCQkvLyBUT0RPIHJlbW92ZSBkdWFsIHN0b3JhZ2UKCQkJLnJlbW92ZURhdGEoIHRoaXMud2lkZ2V0TmFtZSApCgkJCS5yZW1vdmVEYXRhKCB0aGlzLndpZGdldEZ1bGxOYW1lICkKCQkJLy8gc3VwcG9ydDoganF1ZXJ5IDwxLjYuMwoJCQkvLyBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC85NDEzCgkJCS5yZW1vdmVEYXRhKCAkLmNhbWVsQ2FzZSggdGhpcy53aWRnZXRGdWxsTmFtZSApICk7CgkJdGhpcy53aWRnZXQoKQoJCQkudW5iaW5kKCB0aGlzLmV2ZW50TmFtZXNwYWNlICkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLWRpc2FibGVkIiApCgkJCS5yZW1vdmVDbGFzcygKCQkJCXRoaXMud2lkZ2V0RnVsbE5hbWUgKyAiLWRpc2FibGVkICIgKwoJCQkJInVpLXN0YXRlLWRpc2FibGVkIiApOwoKCQkvLyBjbGVhbiB1cCBldmVudHMgYW5kIHN0YXRlcwoJCXRoaXMuYmluZGluZ3MudW5iaW5kKCB0aGlzLmV2ZW50TmFtZXNwYWNlICk7CgkJdGhpcy5ob3ZlcmFibGUucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1ob3ZlciIgKTsKCQl0aGlzLmZvY3VzYWJsZS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWZvY3VzIiApOwoJfSwKCV9kZXN0cm95OiAkLm5vb3AsCgoJd2lkZ2V0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5lbGVtZW50OwoJfSwKCglvcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCXZhciBvcHRpb25zID0ga2V5LAoJCQlwYXJ0cywKCQkJY3VyT3B0aW9uLAoJCQlpOwoKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT09IDAgKSB7CgkJCS8vIGRvbid0IHJldHVybiBhIHJlZmVyZW5jZSB0byB0aGUgaW50ZXJuYWwgaGFzaAoJCQlyZXR1cm4gJC53aWRnZXQuZXh0ZW5kKCB7fSwgdGhpcy5vcHRpb25zICk7CgkJfQoKCQlpZiAoIHR5cGVvZiBrZXkgPT09ICJzdHJpbmciICkgewoJCQkvLyBoYW5kbGUgbmVzdGVkIGtleXMsIGUuZy4sICJmb28uYmFyIiA9PiB7IGZvbzogeyBiYXI6IF9fXyB9IH0KCQkJb3B0aW9ucyA9IHt9OwoJCQlwYXJ0cyA9IGtleS5zcGxpdCggIi4iICk7CgkJCWtleSA9IHBhcnRzLnNoaWZ0KCk7CgkJCWlmICggcGFydHMubGVuZ3RoICkgewoJCQkJY3VyT3B0aW9uID0gb3B0aW9uc1sga2V5IF0gPSAkLndpZGdldC5leHRlbmQoIHt9LCB0aGlzLm9wdGlvbnNbIGtleSBdICk7CgkJCQlmb3IgKCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aCAtIDE7IGkrKyApIHsKCQkJCQljdXJPcHRpb25bIHBhcnRzWyBpIF0gXSA9IGN1ck9wdGlvblsgcGFydHNbIGkgXSBdIHx8IHt9OwoJCQkJCWN1ck9wdGlvbiA9IGN1ck9wdGlvblsgcGFydHNbIGkgXSBdOwoJCQkJfQoJCQkJa2V5ID0gcGFydHMucG9wKCk7CgkJCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgKSB7CgkJCQkJcmV0dXJuIGN1ck9wdGlvblsga2V5IF0gPT09IHVuZGVmaW5lZCA/IG51bGwgOiBjdXJPcHRpb25bIGtleSBdOwoJCQkJfQoJCQkJY3VyT3B0aW9uWyBrZXkgXSA9IHZhbHVlOwoJCQl9IGVsc2UgewoJCQkJaWYgKCBhcmd1bWVudHMubGVuZ3RoID09PSAxICkgewoJCQkJCXJldHVybiB0aGlzLm9wdGlvbnNbIGtleSBdID09PSB1bmRlZmluZWQgPyBudWxsIDogdGhpcy5vcHRpb25zWyBrZXkgXTsKCQkJCX0KCQkJCW9wdGlvbnNbIGtleSBdID0gdmFsdWU7CgkJCX0KCQl9CgoJCXRoaXMuX3NldE9wdGlvbnMoIG9wdGlvbnMgKTsKCgkJcmV0dXJuIHRoaXM7Cgl9LAoJX3NldE9wdGlvbnM6IGZ1bmN0aW9uKCBvcHRpb25zICkgewoJCXZhciBrZXk7CgoJCWZvciAoIGtleSBpbiBvcHRpb25zICkgewoJCQl0aGlzLl9zZXRPcHRpb24oIGtleSwgb3B0aW9uc1sga2V5IF0gKTsKCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCV9zZXRPcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCXRoaXMub3B0aW9uc1sga2V5IF0gPSB2YWx1ZTsKCgkJaWYgKCBrZXkgPT09ICJkaXNhYmxlZCIgKSB7CgkJCXRoaXMud2lkZ2V0KCkKCQkJCS50b2dnbGVDbGFzcyggdGhpcy53aWRnZXRGdWxsTmFtZSArICItZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWQiLCAhIXZhbHVlICkKCQkJCS5hdHRyKCAiYXJpYS1kaXNhYmxlZCIsIHZhbHVlICk7CgkJCXRoaXMuaG92ZXJhYmxlLnJlbW92ZUNsYXNzKCAidWktc3RhdGUtaG92ZXIiICk7CgkJCXRoaXMuZm9jdXNhYmxlLnJlbW92ZUNsYXNzKCAidWktc3RhdGUtZm9jdXMiICk7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJZW5hYmxlOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5fc2V0T3B0aW9uKCAiZGlzYWJsZWQiLCBmYWxzZSApOwoJfSwKCWRpc2FibGU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLl9zZXRPcHRpb24oICJkaXNhYmxlZCIsIHRydWUgKTsKCX0sCgoJX29uOiBmdW5jdGlvbiggc3VwcHJlc3NEaXNhYmxlZENoZWNrLCBlbGVtZW50LCBoYW5kbGVycyApIHsKCQl2YXIgZGVsZWdhdGVFbGVtZW50LAoJCQlpbnN0YW5jZSA9IHRoaXM7CgoJCS8vIG5vIHN1cHByZXNzRGlzYWJsZWRDaGVjayBmbGFnLCBzaHVmZmxlIGFyZ3VtZW50cwoJCWlmICggdHlwZW9mIHN1cHByZXNzRGlzYWJsZWRDaGVjayAhPT0gImJvb2xlYW4iICkgewoJCQloYW5kbGVycyA9IGVsZW1lbnQ7CgkJCWVsZW1lbnQgPSBzdXBwcmVzc0Rpc2FibGVkQ2hlY2s7CgkJCXN1cHByZXNzRGlzYWJsZWRDaGVjayA9IGZhbHNlOwoJCX0KCgkJLy8gbm8gZWxlbWVudCBhcmd1bWVudCwgc2h1ZmZsZSBhbmQgdXNlIHRoaXMuZWxlbWVudAoJCWlmICggIWhhbmRsZXJzICkgewoJCQloYW5kbGVycyA9IGVsZW1lbnQ7CgkJCWVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7CgkJCWRlbGVnYXRlRWxlbWVudCA9IHRoaXMud2lkZ2V0KCk7CgkJfSBlbHNlIHsKCQkJLy8gYWNjZXB0IHNlbGVjdG9ycywgRE9NIGVsZW1lbnRzCgkJCWVsZW1lbnQgPSBkZWxlZ2F0ZUVsZW1lbnQgPSAkKCBlbGVtZW50ICk7CgkJCXRoaXMuYmluZGluZ3MgPSB0aGlzLmJpbmRpbmdzLmFkZCggZWxlbWVudCApOwoJCX0KCgkJJC5lYWNoKCBoYW5kbGVycywgZnVuY3Rpb24oIGV2ZW50LCBoYW5kbGVyICkgewoJCQlmdW5jdGlvbiBoYW5kbGVyUHJveHkoKSB7CgkJCQkvLyBhbGxvdyB3aWRnZXRzIHRvIGN1c3RvbWl6ZSB0aGUgZGlzYWJsZWQgaGFuZGxpbmcKCQkJCS8vIC0gZGlzYWJsZWQgYXMgYW4gYXJyYXkgaW5zdGVhZCBvZiBib29sZWFuCgkJCQkvLyAtIGRpc2FibGVkIGNsYXNzIGFzIG1ldGhvZCBmb3IgZGlzYWJsaW5nIGluZGl2aWR1YWwgcGFydHMKCQkJCWlmICggIXN1cHByZXNzRGlzYWJsZWRDaGVjayAmJgoJCQkJCQkoIGluc3RhbmNlLm9wdGlvbnMuZGlzYWJsZWQgPT09IHRydWUgfHwKCQkJCQkJCSQoIHRoaXMgKS5oYXNDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiApICkgKSB7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJcmV0dXJuICggdHlwZW9mIGhhbmRsZXIgPT09ICJzdHJpbmciID8gaW5zdGFuY2VbIGhhbmRsZXIgXSA6IGhhbmRsZXIgKQoJCQkJCS5hcHBseSggaW5zdGFuY2UsIGFyZ3VtZW50cyApOwoJCQl9CgoJCQkvLyBjb3B5IHRoZSBndWlkIHNvIGRpcmVjdCB1bmJpbmRpbmcgd29ya3MKCQkJaWYgKCB0eXBlb2YgaGFuZGxlciAhPT0gInN0cmluZyIgKSB7CgkJCQloYW5kbGVyUHJveHkuZ3VpZCA9IGhhbmRsZXIuZ3VpZCA9CgkJCQkJaGFuZGxlci5ndWlkIHx8IGhhbmRsZXJQcm94eS5ndWlkIHx8ICQuZ3VpZCsrOwoJCQl9CgoJCQl2YXIgbWF0Y2ggPSBldmVudC5tYXRjaCggL14oXHcrKVxzKiguKikkLyApLAoJCQkJZXZlbnROYW1lID0gbWF0Y2hbMV0gKyBpbnN0YW5jZS5ldmVudE5hbWVzcGFjZSwKCQkJCXNlbGVjdG9yID0gbWF0Y2hbMl07CgkJCWlmICggc2VsZWN0b3IgKSB7CgkJCQlkZWxlZ2F0ZUVsZW1lbnQuZGVsZWdhdGUoIHNlbGVjdG9yLCBldmVudE5hbWUsIGhhbmRsZXJQcm94eSApOwoJCQl9IGVsc2UgewoJCQkJZWxlbWVudC5iaW5kKCBldmVudE5hbWUsIGhhbmRsZXJQcm94eSApOwoJCQl9CgkJfSk7Cgl9LAoKCV9vZmY6IGZ1bmN0aW9uKCBlbGVtZW50LCBldmVudE5hbWUgKSB7CgkJZXZlbnROYW1lID0gKGV2ZW50TmFtZSB8fCAiIikuc3BsaXQoICIgIiApLmpvaW4oIHRoaXMuZXZlbnROYW1lc3BhY2UgKyAiICIgKSArIHRoaXMuZXZlbnROYW1lc3BhY2U7CgkJZWxlbWVudC51bmJpbmQoIGV2ZW50TmFtZSApLnVuZGVsZWdhdGUoIGV2ZW50TmFtZSApOwoJfSwKCglfZGVsYXk6IGZ1bmN0aW9uKCBoYW5kbGVyLCBkZWxheSApIHsKCQlmdW5jdGlvbiBoYW5kbGVyUHJveHkoKSB7CgkJCXJldHVybiAoIHR5cGVvZiBoYW5kbGVyID09PSAic3RyaW5nIiA/IGluc3RhbmNlWyBoYW5kbGVyIF0gOiBoYW5kbGVyICkKCQkJCS5hcHBseSggaW5zdGFuY2UsIGFyZ3VtZW50cyApOwoJCX0KCQl2YXIgaW5zdGFuY2UgPSB0aGlzOwoJCXJldHVybiBzZXRUaW1lb3V0KCBoYW5kbGVyUHJveHksIGRlbGF5IHx8IDAgKTsKCX0sCgoJX2hvdmVyYWJsZTogZnVuY3Rpb24oIGVsZW1lbnQgKSB7CgkJdGhpcy5ob3ZlcmFibGUgPSB0aGlzLmhvdmVyYWJsZS5hZGQoIGVsZW1lbnQgKTsKCQl0aGlzLl9vbiggZWxlbWVudCwgewoJCQltb3VzZWVudGVyOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkkKCBldmVudC5jdXJyZW50VGFyZ2V0ICkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1ob3ZlciIgKTsKCQkJfSwKCQkJbW91c2VsZWF2ZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJJCggZXZlbnQuY3VycmVudFRhcmdldCApLnJlbW92ZUNsYXNzKCAidWktc3RhdGUtaG92ZXIiICk7CgkJCX0KCQl9KTsKCX0sCgoJX2ZvY3VzYWJsZTogZnVuY3Rpb24oIGVsZW1lbnQgKSB7CgkJdGhpcy5mb2N1c2FibGUgPSB0aGlzLmZvY3VzYWJsZS5hZGQoIGVsZW1lbnQgKTsKCQl0aGlzLl9vbiggZWxlbWVudCwgewoJCQlmb2N1c2luOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkkKCBldmVudC5jdXJyZW50VGFyZ2V0ICkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1mb2N1cyIgKTsKCQkJfSwKCQkJZm9jdXNvdXQ6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCSQoIGV2ZW50LmN1cnJlbnRUYXJnZXQgKS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWZvY3VzIiApOwoJCQl9CgkJfSk7Cgl9LAoKCV90cmlnZ2VyOiBmdW5jdGlvbiggdHlwZSwgZXZlbnQsIGRhdGEgKSB7CgkJdmFyIHByb3AsIG9yaWcsCgkJCWNhbGxiYWNrID0gdGhpcy5vcHRpb25zWyB0eXBlIF07CgoJCWRhdGEgPSBkYXRhIHx8IHt9OwoJCWV2ZW50ID0gJC5FdmVudCggZXZlbnQgKTsKCQlldmVudC50eXBlID0gKCB0eXBlID09PSB0aGlzLndpZGdldEV2ZW50UHJlZml4ID8KCQkJdHlwZSA6CgkJCXRoaXMud2lkZ2V0RXZlbnRQcmVmaXggKyB0eXBlICkudG9Mb3dlckNhc2UoKTsKCQkvLyB0aGUgb3JpZ2luYWwgZXZlbnQgbWF5IGNvbWUgZnJvbSBhbnkgZWxlbWVudAoJCS8vIHNvIHdlIG5lZWQgdG8gcmVzZXQgdGhlIHRhcmdldCBvbiB0aGUgbmV3IGV2ZW50CgkJZXZlbnQudGFyZ2V0ID0gdGhpcy5lbGVtZW50WyAwIF07CgoJCS8vIGNvcHkgb3JpZ2luYWwgZXZlbnQgcHJvcGVydGllcyBvdmVyIHRvIHRoZSBuZXcgZXZlbnQKCQlvcmlnID0gZXZlbnQub3JpZ2luYWxFdmVudDsKCQlpZiAoIG9yaWcgKSB7CgkJCWZvciAoIHByb3AgaW4gb3JpZyApIHsKCQkJCWlmICggISggcHJvcCBpbiBldmVudCApICkgewoJCQkJCWV2ZW50WyBwcm9wIF0gPSBvcmlnWyBwcm9wIF07CgkJCQl9CgkJCX0KCQl9CgoJCXRoaXMuZWxlbWVudC50cmlnZ2VyKCBldmVudCwgZGF0YSApOwoJCXJldHVybiAhKCAkLmlzRnVuY3Rpb24oIGNhbGxiYWNrICkgJiYKCQkJY2FsbGJhY2suYXBwbHkoIHRoaXMuZWxlbWVudFswXSwgWyBldmVudCBdLmNvbmNhdCggZGF0YSApICkgPT09IGZhbHNlIHx8CgkJCWV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpICk7Cgl9Cn07CgokLmVhY2goIHsgc2hvdzogImZhZGVJbiIsIGhpZGU6ICJmYWRlT3V0IiB9LCBmdW5jdGlvbiggbWV0aG9kLCBkZWZhdWx0RWZmZWN0ICkgewoJJC5XaWRnZXQucHJvdG90eXBlWyAiXyIgKyBtZXRob2QgXSA9IGZ1bmN0aW9uKCBlbGVtZW50LCBvcHRpb25zLCBjYWxsYmFjayApIHsKCQlpZiAoIHR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIiApIHsKCQkJb3B0aW9ucyA9IHsgZWZmZWN0OiBvcHRpb25zIH07CgkJfQoJCXZhciBoYXNPcHRpb25zLAoJCQllZmZlY3ROYW1lID0gIW9wdGlvbnMgPwoJCQkJbWV0aG9kIDoKCQkJCW9wdGlvbnMgPT09IHRydWUgfHwgdHlwZW9mIG9wdGlvbnMgPT09ICJudW1iZXIiID8KCQkJCQlkZWZhdWx0RWZmZWN0IDoKCQkJCQlvcHRpb25zLmVmZmVjdCB8fCBkZWZhdWx0RWZmZWN0OwoJCW9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoJCWlmICggdHlwZW9mIG9wdGlvbnMgPT09ICJudW1iZXIiICkgewoJCQlvcHRpb25zID0geyBkdXJhdGlvbjogb3B0aW9ucyB9OwoJCX0KCQloYXNPcHRpb25zID0gISQuaXNFbXB0eU9iamVjdCggb3B0aW9ucyApOwoJCW9wdGlvbnMuY29tcGxldGUgPSBjYWxsYmFjazsKCQlpZiAoIG9wdGlvbnMuZGVsYXkgKSB7CgkJCWVsZW1lbnQuZGVsYXkoIG9wdGlvbnMuZGVsYXkgKTsKCQl9CgkJaWYgKCBoYXNPcHRpb25zICYmICQuZWZmZWN0cyAmJiAkLmVmZmVjdHMuZWZmZWN0WyBlZmZlY3ROYW1lIF0gKSB7CgkJCWVsZW1lbnRbIG1ldGhvZCBdKCBvcHRpb25zICk7CgkJfSBlbHNlIGlmICggZWZmZWN0TmFtZSAhPT0gbWV0aG9kICYmIGVsZW1lbnRbIGVmZmVjdE5hbWUgXSApIHsKCQkJZWxlbWVudFsgZWZmZWN0TmFtZSBdKCBvcHRpb25zLmR1cmF0aW9uLCBvcHRpb25zLmVhc2luZywgY2FsbGJhY2sgKTsKCQl9IGVsc2UgewoJCQllbGVtZW50LnF1ZXVlKGZ1bmN0aW9uKCBuZXh0ICkgewoJCQkJJCggdGhpcyApWyBtZXRob2QgXSgpOwoJCQkJaWYgKCBjYWxsYmFjayApIHsKCQkJCQljYWxsYmFjay5jYWxsKCBlbGVtZW50WyAwIF0gKTsKCQkJCX0KCQkJCW5leHQoKTsKCQkJfSk7CgkJfQoJfTsKfSk7Cgp9KSggalF1ZXJ5ICk7CgooZnVuY3Rpb24oICQsIHVuZGVmaW5lZCApIHsKCnZhciBtb3VzZUhhbmRsZWQgPSBmYWxzZTsKJCggZG9jdW1lbnQgKS5tb3VzZXVwKCBmdW5jdGlvbigpIHsKCW1vdXNlSGFuZGxlZCA9IGZhbHNlOwp9KTsKCiQud2lkZ2V0KCJ1aS5tb3VzZSIsIHsKCXZlcnNpb246ICIxLjEwLjQiLAoJb3B0aW9uczogewoJCWNhbmNlbDogImlucHV0LHRleHRhcmVhLGJ1dHRvbixzZWxlY3Qsb3B0aW9uIiwKCQlkaXN0YW5jZTogMSwKCQlkZWxheTogMAoJfSwKCV9tb3VzZUluaXQ6IGZ1bmN0aW9uKCkgewoJCXZhciB0aGF0ID0gdGhpczsKCgkJdGhpcy5lbGVtZW50CgkJCS5iaW5kKCJtb3VzZWRvd24uIit0aGlzLndpZGdldE5hbWUsIGZ1bmN0aW9uKGV2ZW50KSB7CgkJCQlyZXR1cm4gdGhhdC5fbW91c2VEb3duKGV2ZW50KTsKCQkJfSkKCQkJLmJpbmQoImNsaWNrLiIrdGhpcy53aWRnZXROYW1lLCBmdW5jdGlvbihldmVudCkgewoJCQkJaWYgKHRydWUgPT09ICQuZGF0YShldmVudC50YXJnZXQsIHRoYXQud2lkZ2V0TmFtZSArICIucHJldmVudENsaWNrRXZlbnQiKSkgewoJCQkJCSQucmVtb3ZlRGF0YShldmVudC50YXJnZXQsIHRoYXQud2lkZ2V0TmFtZSArICIucHJldmVudENsaWNrRXZlbnQiKTsKCQkJCQlldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0pOwoKCQl0aGlzLnN0YXJ0ZWQgPSBmYWxzZTsKCX0sCgoJLy8gVE9ETzogbWFrZSBzdXJlIGRlc3Ryb3lpbmcgb25lIGluc3RhbmNlIG9mIG1vdXNlIGRvZXNuJ3QgbWVzcyB3aXRoCgkvLyBvdGhlciBpbnN0YW5jZXMgb2YgbW91c2UKCV9tb3VzZURlc3Ryb3k6IGZ1bmN0aW9uKCkgewoJCXRoaXMuZWxlbWVudC51bmJpbmQoIi4iK3RoaXMud2lkZ2V0TmFtZSk7CgkJaWYgKCB0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSApIHsKCQkJJChkb2N1bWVudCkKCQkJCS51bmJpbmQoIm1vdXNlbW92ZS4iK3RoaXMud2lkZ2V0TmFtZSwgdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpCgkJCQkudW5iaW5kKCJtb3VzZXVwLiIrdGhpcy53aWRnZXROYW1lLCB0aGlzLl9tb3VzZVVwRGVsZWdhdGUpOwoJCX0KCX0sCgoJX21vdXNlRG93bjogZnVuY3Rpb24oZXZlbnQpIHsKCQkvLyBkb24ndCBsZXQgbW9yZSB0aGFuIG9uZSB3aWRnZXQgaGFuZGxlIG1vdXNlU3RhcnQKCQlpZiggbW91c2VIYW5kbGVkICkgeyByZXR1cm47IH0KCgkJLy8gd2UgbWF5IGhhdmUgbWlzc2VkIG1vdXNldXAgKG91dCBvZiB3aW5kb3cpCgkJKHRoaXMuX21vdXNlU3RhcnRlZCAmJiB0aGlzLl9tb3VzZVVwKGV2ZW50KSk7CgoJCXRoaXMuX21vdXNlRG93bkV2ZW50ID0gZXZlbnQ7CgoJCXZhciB0aGF0ID0gdGhpcywKCQkJYnRuSXNMZWZ0ID0gKGV2ZW50LndoaWNoID09PSAxKSwKCQkJLy8gZXZlbnQudGFyZ2V0Lm5vZGVOYW1lIHdvcmtzIGFyb3VuZCBhIGJ1ZyBpbiBJRSA4IHdpdGgKCQkJLy8gZGlzYWJsZWQgaW5wdXRzICgjNzYyMCkKCQkJZWxJc0NhbmNlbCA9ICh0eXBlb2YgdGhpcy5vcHRpb25zLmNhbmNlbCA9PT0gInN0cmluZyIgJiYgZXZlbnQudGFyZ2V0Lm5vZGVOYW1lID8gJChldmVudC50YXJnZXQpLmNsb3Nlc3QodGhpcy5vcHRpb25zLmNhbmNlbCkubGVuZ3RoIDogZmFsc2UpOwoJCWlmICghYnRuSXNMZWZ0IHx8IGVsSXNDYW5jZWwgfHwgIXRoaXMuX21vdXNlQ2FwdHVyZShldmVudCkpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoKCQl0aGlzLm1vdXNlRGVsYXlNZXQgPSAhdGhpcy5vcHRpb25zLmRlbGF5OwoJCWlmICghdGhpcy5tb3VzZURlbGF5TWV0KSB7CgkJCXRoaXMuX21vdXNlRGVsYXlUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQl0aGF0Lm1vdXNlRGVsYXlNZXQgPSB0cnVlOwoJCQl9LCB0aGlzLm9wdGlvbnMuZGVsYXkpOwoJCX0KCgkJaWYgKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoZXZlbnQpICYmIHRoaXMuX21vdXNlRGVsYXlNZXQoZXZlbnQpKSB7CgkJCXRoaXMuX21vdXNlU3RhcnRlZCA9ICh0aGlzLl9tb3VzZVN0YXJ0KGV2ZW50KSAhPT0gZmFsc2UpOwoJCQlpZiAoIXRoaXMuX21vdXNlU3RhcnRlZCkgewoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJfQoKCQkvLyBDbGljayBldmVudCBtYXkgbmV2ZXIgaGF2ZSBmaXJlZCAoR2Vja28gJiBPcGVyYSkKCQlpZiAodHJ1ZSA9PT0gJC5kYXRhKGV2ZW50LnRhcmdldCwgdGhpcy53aWRnZXROYW1lICsgIi5wcmV2ZW50Q2xpY2tFdmVudCIpKSB7CgkJCSQucmVtb3ZlRGF0YShldmVudC50YXJnZXQsIHRoaXMud2lkZ2V0TmFtZSArICIucHJldmVudENsaWNrRXZlbnQiKTsKCQl9CgoJCS8vIHRoZXNlIGRlbGVnYXRlcyBhcmUgcmVxdWlyZWQgdG8ga2VlcCBjb250ZXh0CgkJdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUgPSBmdW5jdGlvbihldmVudCkgewoJCQlyZXR1cm4gdGhhdC5fbW91c2VNb3ZlKGV2ZW50KTsKCQl9OwoJCXRoaXMuX21vdXNlVXBEZWxlZ2F0ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7CgkJCXJldHVybiB0aGF0Ll9tb3VzZVVwKGV2ZW50KTsKCQl9OwoJCSQoZG9jdW1lbnQpCgkJCS5iaW5kKCJtb3VzZW1vdmUuIit0aGlzLndpZGdldE5hbWUsIHRoaXMuX21vdXNlTW92ZURlbGVnYXRlKQoJCQkuYmluZCgibW91c2V1cC4iK3RoaXMud2lkZ2V0TmFtZSwgdGhpcy5fbW91c2VVcERlbGVnYXRlKTsKCgkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCgkJbW91c2VIYW5kbGVkID0gdHJ1ZTsKCQlyZXR1cm4gdHJ1ZTsKCX0sCgoJX21vdXNlTW92ZTogZnVuY3Rpb24oZXZlbnQpIHsKCQkvLyBJRSBtb3VzZXVwIGNoZWNrIC0gbW91c2V1cCBoYXBwZW5lZCB3aGVuIG1vdXNlIHdhcyBvdXQgb2Ygd2luZG93CgkJaWYgKCQudWkuaWUgJiYgKCAhZG9jdW1lbnQuZG9jdW1lbnRNb2RlIHx8IGRvY3VtZW50LmRvY3VtZW50TW9kZSA8IDkgKSAmJiAhZXZlbnQuYnV0dG9uKSB7CgkJCXJldHVybiB0aGlzLl9tb3VzZVVwKGV2ZW50KTsKCQl9CgoJCWlmICh0aGlzLl9tb3VzZVN0YXJ0ZWQpIHsKCQkJdGhpcy5fbW91c2VEcmFnKGV2ZW50KTsKCQkJcmV0dXJuIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJfQoKCQlpZiAodGhpcy5fbW91c2VEaXN0YW5jZU1ldChldmVudCkgJiYgdGhpcy5fbW91c2VEZWxheU1ldChldmVudCkpIHsKCQkJdGhpcy5fbW91c2VTdGFydGVkID0KCQkJCSh0aGlzLl9tb3VzZVN0YXJ0KHRoaXMuX21vdXNlRG93bkV2ZW50LCBldmVudCkgIT09IGZhbHNlKTsKCQkJKHRoaXMuX21vdXNlU3RhcnRlZCA/IHRoaXMuX21vdXNlRHJhZyhldmVudCkgOiB0aGlzLl9tb3VzZVVwKGV2ZW50KSk7CgkJfQoKCQlyZXR1cm4gIXRoaXMuX21vdXNlU3RhcnRlZDsKCX0sCgoJX21vdXNlVXA6IGZ1bmN0aW9uKGV2ZW50KSB7CgkJJChkb2N1bWVudCkKCQkJLnVuYmluZCgibW91c2Vtb3ZlLiIrdGhpcy53aWRnZXROYW1lLCB0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSkKCQkJLnVuYmluZCgibW91c2V1cC4iK3RoaXMud2lkZ2V0TmFtZSwgdGhpcy5fbW91c2VVcERlbGVnYXRlKTsKCgkJaWYgKHRoaXMuX21vdXNlU3RhcnRlZCkgewoJCQl0aGlzLl9tb3VzZVN0YXJ0ZWQgPSBmYWxzZTsKCgkJCWlmIChldmVudC50YXJnZXQgPT09IHRoaXMuX21vdXNlRG93bkV2ZW50LnRhcmdldCkgewoJCQkJJC5kYXRhKGV2ZW50LnRhcmdldCwgdGhpcy53aWRnZXROYW1lICsgIi5wcmV2ZW50Q2xpY2tFdmVudCIsIHRydWUpOwoJCQl9CgoJCQl0aGlzLl9tb3VzZVN0b3AoZXZlbnQpOwoJCX0KCgkJcmV0dXJuIGZhbHNlOwoJfSwKCglfbW91c2VEaXN0YW5jZU1ldDogZnVuY3Rpb24oZXZlbnQpIHsKCQlyZXR1cm4gKE1hdGgubWF4KAoJCQkJTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVggLSBldmVudC5wYWdlWCksCgkJCQlNYXRoLmFicyh0aGlzLl9tb3VzZURvd25FdmVudC5wYWdlWSAtIGV2ZW50LnBhZ2VZKQoJCQkpID49IHRoaXMub3B0aW9ucy5kaXN0YW5jZQoJCSk7Cgl9LAoKCV9tb3VzZURlbGF5TWV0OiBmdW5jdGlvbigvKiBldmVudCAqLykgewoJCXJldHVybiB0aGlzLm1vdXNlRGVsYXlNZXQ7Cgl9LAoKCS8vIFRoZXNlIGFyZSBwbGFjZWhvbGRlciBtZXRob2RzLCB0byBiZSBvdmVycmlkZW4gYnkgZXh0ZW5kaW5nIHBsdWdpbgoJX21vdXNlU3RhcnQ6IGZ1bmN0aW9uKC8qIGV2ZW50ICovKSB7fSwKCV9tb3VzZURyYWc6IGZ1bmN0aW9uKC8qIGV2ZW50ICovKSB7fSwKCV9tb3VzZVN0b3A6IGZ1bmN0aW9uKC8qIGV2ZW50ICovKSB7fSwKCV9tb3VzZUNhcHR1cmU6IGZ1bmN0aW9uKC8qIGV2ZW50ICovKSB7IHJldHVybiB0cnVlOyB9Cn0pOwoKfSkoalF1ZXJ5KTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKJC53aWRnZXQoInVpLmRyYWdnYWJsZSIsICQudWkubW91c2UsIHsKCXZlcnNpb246ICIxLjEwLjQiLAoJd2lkZ2V0RXZlbnRQcmVmaXg6ICJkcmFnIiwKCW9wdGlvbnM6IHsKCQlhZGRDbGFzc2VzOiB0cnVlLAoJCWFwcGVuZFRvOiAicGFyZW50IiwKCQlheGlzOiBmYWxzZSwKCQljb25uZWN0VG9Tb3J0YWJsZTogZmFsc2UsCgkJY29udGFpbm1lbnQ6IGZhbHNlLAoJCWN1cnNvcjogImF1dG8iLAoJCWN1cnNvckF0OiBmYWxzZSwKCQlncmlkOiBmYWxzZSwKCQloYW5kbGU6IGZhbHNlLAoJCWhlbHBlcjogIm9yaWdpbmFsIiwKCQlpZnJhbWVGaXg6IGZhbHNlLAoJCW9wYWNpdHk6IGZhbHNlLAoJCXJlZnJlc2hQb3NpdGlvbnM6IGZhbHNlLAoJCXJldmVydDogZmFsc2UsCgkJcmV2ZXJ0RHVyYXRpb246IDUwMCwKCQlzY29wZTogImRlZmF1bHQiLAoJCXNjcm9sbDogdHJ1ZSwKCQlzY3JvbGxTZW5zaXRpdml0eTogMjAsCgkJc2Nyb2xsU3BlZWQ6IDIwLAoJCXNuYXA6IGZhbHNlLAoJCXNuYXBNb2RlOiAiYm90aCIsCgkJc25hcFRvbGVyYW5jZTogMjAsCgkJc3RhY2s6IGZhbHNlLAoJCXpJbmRleDogZmFsc2UsCgoJCS8vIGNhbGxiYWNrcwoJCWRyYWc6IG51bGwsCgkJc3RhcnQ6IG51bGwsCgkJc3RvcDogbnVsbAoJfSwKCV9jcmVhdGU6IGZ1bmN0aW9uKCkgewoKCQlpZiAodGhpcy5vcHRpb25zLmhlbHBlciA9PT0gIm9yaWdpbmFsIiAmJiAhKC9eKD86cnxhfGYpLykudGVzdCh0aGlzLmVsZW1lbnQuY3NzKCJwb3NpdGlvbiIpKSkgewoJCQl0aGlzLmVsZW1lbnRbMF0uc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwoJCX0KCQlpZiAodGhpcy5vcHRpb25zLmFkZENsYXNzZXMpewoJCQl0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLWRyYWdnYWJsZSIpOwoJCX0KCQlpZiAodGhpcy5vcHRpb25zLmRpc2FibGVkKXsKCQkJdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1kcmFnZ2FibGUtZGlzYWJsZWQiKTsKCQl9CgoJCXRoaXMuX21vdXNlSW5pdCgpOwoKCX0sCgoJX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewoJCXRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyggInVpLWRyYWdnYWJsZSB1aS1kcmFnZ2FibGUtZHJhZ2dpbmcgdWktZHJhZ2dhYmxlLWRpc2FibGVkIiApOwoJCXRoaXMuX21vdXNlRGVzdHJveSgpOwoJfSwKCglfbW91c2VDYXB0dXJlOiBmdW5jdGlvbihldmVudCkgewoKCQl2YXIgbyA9IHRoaXMub3B0aW9uczsKCgkJLy8gYW1vbmcgb3RoZXJzLCBwcmV2ZW50IGEgZHJhZyBvbiBhIHJlc2l6YWJsZS1oYW5kbGUKCQlpZiAodGhpcy5oZWxwZXIgfHwgby5kaXNhYmxlZCB8fCAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdCgiLnVpLXJlc2l6YWJsZS1oYW5kbGUiKS5sZW5ndGggPiAwKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCS8vUXVpdCBpZiB3ZSdyZSBub3Qgb24gYSB2YWxpZCBoYW5kbGUKCQl0aGlzLmhhbmRsZSA9IHRoaXMuX2dldEhhbmRsZShldmVudCk7CgkJaWYgKCF0aGlzLmhhbmRsZSkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkkKG8uaWZyYW1lRml4ID09PSB0cnVlID8gImlmcmFtZSIgOiBvLmlmcmFtZUZpeCkuZWFjaChmdW5jdGlvbigpIHsKCQkJJCgiPGRpdiBjbGFzcz0ndWktZHJhZ2dhYmxlLWlmcmFtZUZpeCcgc3R5bGU9J2JhY2tncm91bmQ6ICNmZmY7Jz48L2Rpdj4iKQoJCQkuY3NzKHsKCQkJCXdpZHRoOiB0aGlzLm9mZnNldFdpZHRoKyJweCIsIGhlaWdodDogdGhpcy5vZmZzZXRIZWlnaHQrInB4IiwKCQkJCXBvc2l0aW9uOiAiYWJzb2x1dGUiLCBvcGFjaXR5OiAiMC4wMDEiLCB6SW5kZXg6IDEwMDAKCQkJfSkKCQkJLmNzcygkKHRoaXMpLm9mZnNldCgpKQoJCQkuYXBwZW5kVG8oImJvZHkiKTsKCQl9KTsKCgkJcmV0dXJuIHRydWU7CgoJfSwKCglfbW91c2VTdGFydDogZnVuY3Rpb24oZXZlbnQpIHsKCgkJdmFyIG8gPSB0aGlzLm9wdGlvbnM7CgoJCS8vQ3JlYXRlIGFuZCBhcHBlbmQgdGhlIHZpc2libGUgaGVscGVyCgkJdGhpcy5oZWxwZXIgPSB0aGlzLl9jcmVhdGVIZWxwZXIoZXZlbnQpOwoKCQl0aGlzLmhlbHBlci5hZGRDbGFzcygidWktZHJhZ2dhYmxlLWRyYWdnaW5nIik7CgoJCS8vQ2FjaGUgdGhlIGhlbHBlciBzaXplCgkJdGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpOwoKCQkvL0lmIGRkbWFuYWdlciBpcyB1c2VkIGZvciBkcm9wcGFibGVzLCBzZXQgdGhlIGdsb2JhbCBkcmFnZ2FibGUKCQlpZigkLnVpLmRkbWFuYWdlcikgewoJCQkkLnVpLmRkbWFuYWdlci5jdXJyZW50ID0gdGhpczsKCQl9CgoJCS8qCgkJICogLSBQb3NpdGlvbiBnZW5lcmF0aW9uIC0KCQkgKiBUaGlzIGJsb2NrIGdlbmVyYXRlcyBldmVyeXRoaW5nIHBvc2l0aW9uIHJlbGF0ZWQgLSBpdCdzIHRoZSBjb3JlIG9mIGRyYWdnYWJsZXMuCgkJICovCgoJCS8vQ2FjaGUgdGhlIG1hcmdpbnMgb2YgdGhlIG9yaWdpbmFsIGVsZW1lbnQKCQl0aGlzLl9jYWNoZU1hcmdpbnMoKTsKCgkJLy9TdG9yZSB0aGUgaGVscGVyJ3MgY3NzIHBvc2l0aW9uCgkJdGhpcy5jc3NQb3NpdGlvbiA9IHRoaXMuaGVscGVyLmNzcyggInBvc2l0aW9uIiApOwoJCXRoaXMuc2Nyb2xsUGFyZW50ID0gdGhpcy5oZWxwZXIuc2Nyb2xsUGFyZW50KCk7CgkJdGhpcy5vZmZzZXRQYXJlbnQgPSB0aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKTsKCQl0aGlzLm9mZnNldFBhcmVudENzc1Bvc2l0aW9uID0gdGhpcy5vZmZzZXRQYXJlbnQuY3NzKCAicG9zaXRpb24iICk7CgoJCS8vVGhlIGVsZW1lbnQncyBhYnNvbHV0ZSBwb3NpdGlvbiBvbiB0aGUgcGFnZSBtaW51cyBtYXJnaW5zCgkJdGhpcy5vZmZzZXQgPSB0aGlzLnBvc2l0aW9uQWJzID0gdGhpcy5lbGVtZW50Lm9mZnNldCgpOwoJCXRoaXMub2Zmc2V0ID0gewoJCQl0b3A6IHRoaXMub2Zmc2V0LnRvcCAtIHRoaXMubWFyZ2lucy50b3AsCgkJCWxlZnQ6IHRoaXMub2Zmc2V0LmxlZnQgLSB0aGlzLm1hcmdpbnMubGVmdAoJCX07CgoJCS8vUmVzZXQgc2Nyb2xsIGNhY2hlCgkJdGhpcy5vZmZzZXQuc2Nyb2xsID0gZmFsc2U7CgoJCSQuZXh0ZW5kKHRoaXMub2Zmc2V0LCB7CgkJCWNsaWNrOiB7IC8vV2hlcmUgdGhlIGNsaWNrIGhhcHBlbmVkLCByZWxhdGl2ZSB0byB0aGUgZWxlbWVudAoJCQkJbGVmdDogZXZlbnQucGFnZVggLSB0aGlzLm9mZnNldC5sZWZ0LAoJCQkJdG9wOiBldmVudC5wYWdlWSAtIHRoaXMub2Zmc2V0LnRvcAoJCQl9LAoJCQlwYXJlbnQ6IHRoaXMuX2dldFBhcmVudE9mZnNldCgpLAoJCQlyZWxhdGl2ZTogdGhpcy5fZ2V0UmVsYXRpdmVPZmZzZXQoKSAvL1RoaXMgaXMgYSByZWxhdGl2ZSB0byBhYnNvbHV0ZSBwb3NpdGlvbiBtaW51cyB0aGUgYWN0dWFsIHBvc2l0aW9uIGNhbGN1bGF0aW9uIC0gb25seSB1c2VkIGZvciByZWxhdGl2ZSBwb3NpdGlvbmVkIGhlbHBlcgoJCX0pOwoKCQkvL0dlbmVyYXRlIHRoZSBvcmlnaW5hbCBwb3NpdGlvbgoJCXRoaXMub3JpZ2luYWxQb3NpdGlvbiA9IHRoaXMucG9zaXRpb24gPSB0aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKGV2ZW50KTsKCQl0aGlzLm9yaWdpbmFsUGFnZVggPSBldmVudC5wYWdlWDsKCQl0aGlzLm9yaWdpbmFsUGFnZVkgPSBldmVudC5wYWdlWTsKCgkJLy9BZGp1c3QgdGhlIG1vdXNlIG9mZnNldCByZWxhdGl2ZSB0byB0aGUgaGVscGVyIGlmICJjdXJzb3JBdCIgaXMgc3VwcGxpZWQKCQkoby5jdXJzb3JBdCAmJiB0aGlzLl9hZGp1c3RPZmZzZXRGcm9tSGVscGVyKG8uY3Vyc29yQXQpKTsKCgkJLy9TZXQgYSBjb250YWlubWVudCBpZiBnaXZlbiBpbiB0aGUgb3B0aW9ucwoJCXRoaXMuX3NldENvbnRhaW5tZW50KCk7CgoJCS8vVHJpZ2dlciBldmVudCArIGNhbGxiYWNrcwoJCWlmKHRoaXMuX3RyaWdnZXIoInN0YXJ0IiwgZXZlbnQpID09PSBmYWxzZSkgewoJCQl0aGlzLl9jbGVhcigpOwoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkvL1JlY2FjaGUgdGhlIGhlbHBlciBzaXplCgkJdGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpOwoKCQkvL1ByZXBhcmUgdGhlIGRyb3BwYWJsZSBvZmZzZXRzCgkJaWYgKCQudWkuZGRtYW5hZ2VyICYmICFvLmRyb3BCZWhhdmlvdXIpIHsKCQkJJC51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHModGhpcywgZXZlbnQpOwoJCX0KCgoJCXRoaXMuX21vdXNlRHJhZyhldmVudCwgdHJ1ZSk7IC8vRXhlY3V0ZSB0aGUgZHJhZyBvbmNlIC0gdGhpcyBjYXVzZXMgdGhlIGhlbHBlciBub3QgdG8gYmUgdmlzaWJsZSBiZWZvcmUgZ2V0dGluZyBpdHMgY29ycmVjdCBwb3NpdGlvbgoKCQkvL0lmIHRoZSBkZG1hbmFnZXIgaXMgdXNlZCBmb3IgZHJvcHBhYmxlcywgaW5mb3JtIHRoZSBtYW5hZ2VyIHRoYXQgZHJhZ2dpbmcgaGFzIHN0YXJ0ZWQgKHNlZSAjNTAwMykKCQlpZiAoICQudWkuZGRtYW5hZ2VyICkgewoJCQkkLnVpLmRkbWFuYWdlci5kcmFnU3RhcnQodGhpcywgZXZlbnQpOwoJCX0KCgkJcmV0dXJuIHRydWU7Cgl9LAoKCV9tb3VzZURyYWc6IGZ1bmN0aW9uKGV2ZW50LCBub1Byb3BhZ2F0aW9uKSB7CgkJLy8gcmVzZXQgYW55IG5lY2Vzc2FyeSBjYWNoZWQgcHJvcGVydGllcyAoc2VlICM1MDA5KQoJCWlmICggdGhpcy5vZmZzZXRQYXJlbnRDc3NQb3NpdGlvbiA9PT0gImZpeGVkIiApIHsKCQkJdGhpcy5vZmZzZXQucGFyZW50ID0gdGhpcy5fZ2V0UGFyZW50T2Zmc2V0KCk7CgkJfQoKCQkvL0NvbXB1dGUgdGhlIGhlbHBlcnMgcG9zaXRpb24KCQl0aGlzLnBvc2l0aW9uID0gdGhpcy5fZ2VuZXJhdGVQb3NpdGlvbihldmVudCk7CgkJdGhpcy5wb3NpdGlvbkFicyA9IHRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKCJhYnNvbHV0ZSIpOwoKCQkvL0NhbGwgcGx1Z2lucyBhbmQgY2FsbGJhY2tzIGFuZCB1c2UgdGhlIHJlc3VsdGluZyBwb3NpdGlvbiBpZiBzb21ldGhpbmcgaXMgcmV0dXJuZWQKCQlpZiAoIW5vUHJvcGFnYXRpb24pIHsKCQkJdmFyIHVpID0gdGhpcy5fdWlIYXNoKCk7CgkJCWlmKHRoaXMuX3RyaWdnZXIoImRyYWciLCBldmVudCwgdWkpID09PSBmYWxzZSkgewoJCQkJdGhpcy5fbW91c2VVcCh7fSk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJdGhpcy5wb3NpdGlvbiA9IHVpLnBvc2l0aW9uOwoJCX0KCgkJaWYoIXRoaXMub3B0aW9ucy5heGlzIHx8IHRoaXMub3B0aW9ucy5heGlzICE9PSAieSIpIHsKCQkJdGhpcy5oZWxwZXJbMF0uc3R5bGUubGVmdCA9IHRoaXMucG9zaXRpb24ubGVmdCsicHgiOwoJCX0KCQlpZighdGhpcy5vcHRpb25zLmF4aXMgfHwgdGhpcy5vcHRpb25zLmF4aXMgIT09ICJ4IikgewoJCQl0aGlzLmhlbHBlclswXS5zdHlsZS50b3AgPSB0aGlzLnBvc2l0aW9uLnRvcCsicHgiOwoJCX0KCQlpZigkLnVpLmRkbWFuYWdlcikgewoJCQkkLnVpLmRkbWFuYWdlci5kcmFnKHRoaXMsIGV2ZW50KTsKCQl9CgoJCXJldHVybiBmYWxzZTsKCX0sCgoJX21vdXNlU3RvcDogZnVuY3Rpb24oZXZlbnQpIHsKCgkJLy9JZiB3ZSBhcmUgdXNpbmcgZHJvcHBhYmxlcywgaW5mb3JtIHRoZSBtYW5hZ2VyIGFib3V0IHRoZSBkcm9wCgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlkcm9wcGVkID0gZmFsc2U7CgkJaWYgKCQudWkuZGRtYW5hZ2VyICYmICF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91cikgewoJCQlkcm9wcGVkID0gJC51aS5kZG1hbmFnZXIuZHJvcCh0aGlzLCBldmVudCk7CgkJfQoKCQkvL2lmIGEgZHJvcCBjb21lcyBmcm9tIG91dHNpZGUgKGEgc29ydGFibGUpCgkJaWYodGhpcy5kcm9wcGVkKSB7CgkJCWRyb3BwZWQgPSB0aGlzLmRyb3BwZWQ7CgkJCXRoaXMuZHJvcHBlZCA9IGZhbHNlOwoJCX0KCgkJLy9pZiB0aGUgb3JpZ2luYWwgZWxlbWVudCBpcyBubyBsb25nZXIgaW4gdGhlIERPTSBkb24ndCBib3RoZXIgdG8gY29udGludWUgKHNlZSAjODI2OSkKCQlpZiAoIHRoaXMub3B0aW9ucy5oZWxwZXIgPT09ICJvcmlnaW5hbCIgJiYgISQuY29udGFpbnMoIHRoaXMuZWxlbWVudFsgMCBdLm93bmVyRG9jdW1lbnQsIHRoaXMuZWxlbWVudFsgMCBdICkgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWlmKCh0aGlzLm9wdGlvbnMucmV2ZXJ0ID09PSAiaW52YWxpZCIgJiYgIWRyb3BwZWQpIHx8ICh0aGlzLm9wdGlvbnMucmV2ZXJ0ID09PSAidmFsaWQiICYmIGRyb3BwZWQpIHx8IHRoaXMub3B0aW9ucy5yZXZlcnQgPT09IHRydWUgfHwgKCQuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMucmV2ZXJ0KSAmJiB0aGlzLm9wdGlvbnMucmV2ZXJ0LmNhbGwodGhpcy5lbGVtZW50LCBkcm9wcGVkKSkpIHsKCQkJJCh0aGlzLmhlbHBlcikuYW5pbWF0ZSh0aGlzLm9yaWdpbmFsUG9zaXRpb24sIHBhcnNlSW50KHRoaXMub3B0aW9ucy5yZXZlcnREdXJhdGlvbiwgMTApLCBmdW5jdGlvbigpIHsKCQkJCWlmKHRoYXQuX3RyaWdnZXIoInN0b3AiLCBldmVudCkgIT09IGZhbHNlKSB7CgkJCQkJdGhhdC5fY2xlYXIoKTsKCQkJCX0KCQkJfSk7CgkJfSBlbHNlIHsKCQkJaWYodGhpcy5fdHJpZ2dlcigic3RvcCIsIGV2ZW50KSAhPT0gZmFsc2UpIHsKCQkJCXRoaXMuX2NsZWFyKCk7CgkJCX0KCQl9CgoJCXJldHVybiBmYWxzZTsKCX0sCgoJX21vdXNlVXA6IGZ1bmN0aW9uKGV2ZW50KSB7CgkJLy9SZW1vdmUgZnJhbWUgaGVscGVycwoJCSQoImRpdi51aS1kcmFnZ2FibGUtaWZyYW1lRml4IikuZWFjaChmdW5jdGlvbigpIHsKCQkJdGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMpOwoJCX0pOwoKCQkvL0lmIHRoZSBkZG1hbmFnZXIgaXMgdXNlZCBmb3IgZHJvcHBhYmxlcywgaW5mb3JtIHRoZSBtYW5hZ2VyIHRoYXQgZHJhZ2dpbmcgaGFzIHN0b3BwZWQgKHNlZSAjNTAwMykKCQlpZiggJC51aS5kZG1hbmFnZXIgKSB7CgkJCSQudWkuZGRtYW5hZ2VyLmRyYWdTdG9wKHRoaXMsIGV2ZW50KTsKCQl9CgoJCXJldHVybiAkLnVpLm1vdXNlLnByb3RvdHlwZS5fbW91c2VVcC5jYWxsKHRoaXMsIGV2ZW50KTsKCX0sCgoJY2FuY2VsOiBmdW5jdGlvbigpIHsKCgkJaWYodGhpcy5oZWxwZXIuaXMoIi51aS1kcmFnZ2FibGUtZHJhZ2dpbmciKSkgewoJCQl0aGlzLl9tb3VzZVVwKHt9KTsKCQl9IGVsc2UgewoJCQl0aGlzLl9jbGVhcigpOwoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfSwKCglfZ2V0SGFuZGxlOiBmdW5jdGlvbihldmVudCkgewoJCXJldHVybiB0aGlzLm9wdGlvbnMuaGFuZGxlID8KCQkJISEkKCBldmVudC50YXJnZXQgKS5jbG9zZXN0KCB0aGlzLmVsZW1lbnQuZmluZCggdGhpcy5vcHRpb25zLmhhbmRsZSApICkubGVuZ3RoIDoKCQkJdHJ1ZTsKCX0sCgoJX2NyZWF0ZUhlbHBlcjogZnVuY3Rpb24oZXZlbnQpIHsKCgkJdmFyIG8gPSB0aGlzLm9wdGlvbnMsCgkJCWhlbHBlciA9ICQuaXNGdW5jdGlvbihvLmhlbHBlcikgPyAkKG8uaGVscGVyLmFwcGx5KHRoaXMuZWxlbWVudFswXSwgW2V2ZW50XSkpIDogKG8uaGVscGVyID09PSAiY2xvbmUiID8gdGhpcy5lbGVtZW50LmNsb25lKCkucmVtb3ZlQXR0cigiaWQiKSA6IHRoaXMuZWxlbWVudCk7CgoJCWlmKCFoZWxwZXIucGFyZW50cygiYm9keSIpLmxlbmd0aCkgewoJCQloZWxwZXIuYXBwZW5kVG8oKG8uYXBwZW5kVG8gPT09ICJwYXJlbnQiID8gdGhpcy5lbGVtZW50WzBdLnBhcmVudE5vZGUgOiBvLmFwcGVuZFRvKSk7CgkJfQoKCQlpZihoZWxwZXJbMF0gIT09IHRoaXMuZWxlbWVudFswXSAmJiAhKC8oZml4ZWR8YWJzb2x1dGUpLykudGVzdChoZWxwZXIuY3NzKCJwb3NpdGlvbiIpKSkgewoJCQloZWxwZXIuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpOwoJCX0KCgkJcmV0dXJuIGhlbHBlcjsKCgl9LAoKCV9hZGp1c3RPZmZzZXRGcm9tSGVscGVyOiBmdW5jdGlvbihvYmopIHsKCQlpZiAodHlwZW9mIG9iaiA9PT0gInN0cmluZyIpIHsKCQkJb2JqID0gb2JqLnNwbGl0KCIgIik7CgkJfQoJCWlmICgkLmlzQXJyYXkob2JqKSkgewoJCQlvYmogPSB7bGVmdDogK29ialswXSwgdG9wOiArb2JqWzFdIHx8IDB9OwoJCX0KCQlpZiAoImxlZnQiIGluIG9iaikgewoJCQl0aGlzLm9mZnNldC5jbGljay5sZWZ0ID0gb2JqLmxlZnQgKyB0aGlzLm1hcmdpbnMubGVmdDsKCQl9CgkJaWYgKCJyaWdodCIgaW4gb2JqKSB7CgkJCXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPSB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC0gb2JqLnJpZ2h0ICsgdGhpcy5tYXJnaW5zLmxlZnQ7CgkJfQoJCWlmICgidG9wIiBpbiBvYmopIHsKCQkJdGhpcy5vZmZzZXQuY2xpY2sudG9wID0gb2JqLnRvcCArIHRoaXMubWFyZ2lucy50b3A7CgkJfQoJCWlmICgiYm90dG9tIiBpbiBvYmopIHsKCQkJdGhpcy5vZmZzZXQuY2xpY2sudG9wID0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQgLSBvYmouYm90dG9tICsgdGhpcy5tYXJnaW5zLnRvcDsKCQl9Cgl9LAoKCV9nZXRQYXJlbnRPZmZzZXQ6IGZ1bmN0aW9uKCkgewoKCQkvL0dldCB0aGUgb2Zmc2V0UGFyZW50IGFuZCBjYWNoZSBpdHMgcG9zaXRpb24KCQl2YXIgcG8gPSB0aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKTsKCgkJLy8gVGhpcyBpcyBhIHNwZWNpYWwgY2FzZSB3aGVyZSB3ZSBuZWVkIHRvIG1vZGlmeSBhIG9mZnNldCBjYWxjdWxhdGVkIG9uIHN0YXJ0LCBzaW5jZSB0aGUgZm9sbG93aW5nIGhhcHBlbmVkOgoJCS8vIDEuIFRoZSBwb3NpdGlvbiBvZiB0aGUgaGVscGVyIGlzIGFic29sdXRlLCBzbyBpdCdzIHBvc2l0aW9uIGlzIGNhbGN1bGF0ZWQgYmFzZWQgb24gdGhlIG5leHQgcG9zaXRpb25lZCBwYXJlbnQKCQkvLyAyLiBUaGUgYWN0dWFsIG9mZnNldCBwYXJlbnQgaXMgYSBjaGlsZCBvZiB0aGUgc2Nyb2xsIHBhcmVudCwgYW5kIHRoZSBzY3JvbGwgcGFyZW50IGlzbid0IHRoZSBkb2N1bWVudCwgd2hpY2ggbWVhbnMgdGhhdAoJCS8vICAgIHRoZSBzY3JvbGwgaXMgaW5jbHVkZWQgaW4gdGhlIGluaXRpYWwgY2FsY3VsYXRpb24gb2YgdGhlIG9mZnNldCBvZiB0aGUgcGFyZW50LCBhbmQgbmV2ZXIgcmVjYWxjdWxhdGVkIHVwb24gZHJhZwoJCWlmKHRoaXMuY3NzUG9zaXRpb24gPT09ICJhYnNvbHV0ZSIgJiYgdGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IGRvY3VtZW50ICYmICQuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sIHRoaXMub2Zmc2V0UGFyZW50WzBdKSkgewoJCQlwby5sZWZ0ICs9IHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTsKCQkJcG8udG9wICs9IHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpOwoJCX0KCgkJLy9UaGlzIG5lZWRzIHRvIGJlIGFjdHVhbGx5IGRvbmUgZm9yIGFsbCBicm93c2Vycywgc2luY2UgcGFnZVgvcGFnZVkgaW5jbHVkZXMgdGhpcyBpbmZvcm1hdGlvbgoJCS8vVWdseSBJRSBmaXgKCQlpZigodGhpcy5vZmZzZXRQYXJlbnRbMF0gPT09IGRvY3VtZW50LmJvZHkpIHx8CgkJCSh0aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lICYmIHRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gImh0bWwiICYmICQudWkuaWUpKSB7CgkJCXBvID0geyB0b3A6IDAsIGxlZnQ6IDAgfTsKCQl9CgoJCXJldHVybiB7CgkJCXRvcDogcG8udG9wICsgKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcygiYm9yZGVyVG9wV2lkdGgiKSwxMCkgfHwgMCksCgkJCWxlZnQ6IHBvLmxlZnQgKyAocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwxMCkgfHwgMCkKCQl9OwoKCX0sCgoJX2dldFJlbGF0aXZlT2Zmc2V0OiBmdW5jdGlvbigpIHsKCgkJaWYodGhpcy5jc3NQb3NpdGlvbiA9PT0gInJlbGF0aXZlIikgewoJCQl2YXIgcCA9IHRoaXMuZWxlbWVudC5wb3NpdGlvbigpOwoJCQlyZXR1cm4gewoJCQkJdG9wOiBwLnRvcCAtIChwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoInRvcCIpLDEwKSB8fCAwKSArIHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpLAoJCQkJbGVmdDogcC5sZWZ0IC0gKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcygibGVmdCIpLDEwKSB8fCAwKSArIHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKQoJCQl9OwoJCX0gZWxzZSB7CgkJCXJldHVybiB7IHRvcDogMCwgbGVmdDogMCB9OwoJCX0KCgl9LAoKCV9jYWNoZU1hcmdpbnM6IGZ1bmN0aW9uKCkgewoJCXRoaXMubWFyZ2lucyA9IHsKCQkJbGVmdDogKHBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpbkxlZnQiKSwxMCkgfHwgMCksCgkJCXRvcDogKHBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpblRvcCIpLDEwKSB8fCAwKSwKCQkJcmlnaHQ6IChwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKCJtYXJnaW5SaWdodCIpLDEwKSB8fCAwKSwKCQkJYm90dG9tOiAocGFyc2VJbnQodGhpcy5lbGVtZW50LmNzcygibWFyZ2luQm90dG9tIiksMTApIHx8IDApCgkJfTsKCX0sCgoJX2NhY2hlSGVscGVyUHJvcG9ydGlvbnM6IGZ1bmN0aW9uKCkgewoJCXRoaXMuaGVscGVyUHJvcG9ydGlvbnMgPSB7CgkJCXdpZHRoOiB0aGlzLmhlbHBlci5vdXRlcldpZHRoKCksCgkJCWhlaWdodDogdGhpcy5oZWxwZXIub3V0ZXJIZWlnaHQoKQoJCX07Cgl9LAoKCV9zZXRDb250YWlubWVudDogZnVuY3Rpb24oKSB7CgoJCXZhciBvdmVyLCBjLCBjZSwKCQkJbyA9IHRoaXMub3B0aW9uczsKCgkJaWYgKCAhby5jb250YWlubWVudCApIHsKCQkJdGhpcy5jb250YWlubWVudCA9IG51bGw7CgkJCXJldHVybjsKCQl9CgoJCWlmICggby5jb250YWlubWVudCA9PT0gIndpbmRvdyIgKSB7CgkJCXRoaXMuY29udGFpbm1lbnQgPSBbCgkJCQkkKCB3aW5kb3cgKS5zY3JvbGxMZWZ0KCkgLSB0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0IC0gdGhpcy5vZmZzZXQucGFyZW50LmxlZnQsCgkJCQkkKCB3aW5kb3cgKS5zY3JvbGxUb3AoKSAtIHRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcCAtIHRoaXMub2Zmc2V0LnBhcmVudC50b3AsCgkJCQkkKCB3aW5kb3cgKS5zY3JvbGxMZWZ0KCkgKyAkKCB3aW5kb3cgKS53aWR0aCgpIC0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCAtIHRoaXMubWFyZ2lucy5sZWZ0LAoJCQkJJCggd2luZG93ICkuc2Nyb2xsVG9wKCkgKyAoICQoIHdpbmRvdyApLmhlaWdodCgpIHx8IGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZS5zY3JvbGxIZWlnaHQgKSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gdGhpcy5tYXJnaW5zLnRvcAoJCQldOwoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIG8uY29udGFpbm1lbnQgPT09ICJkb2N1bWVudCIpIHsKCQkJdGhpcy5jb250YWlubWVudCA9IFsKCQkJCTAsCgkJCQkwLAoJCQkJJCggZG9jdW1lbnQgKS53aWR0aCgpIC0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCAtIHRoaXMubWFyZ2lucy5sZWZ0LAoJCQkJKCAkKCBkb2N1bWVudCApLmhlaWdodCgpIHx8IGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZS5zY3JvbGxIZWlnaHQgKSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gdGhpcy5tYXJnaW5zLnRvcAoJCQldOwoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIG8uY29udGFpbm1lbnQuY29uc3RydWN0b3IgPT09IEFycmF5ICkgewoJCQl0aGlzLmNvbnRhaW5tZW50ID0gby5jb250YWlubWVudDsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKCBvLmNvbnRhaW5tZW50ID09PSAicGFyZW50IiApIHsKCQkJby5jb250YWlubWVudCA9IHRoaXMuaGVscGVyWyAwIF0ucGFyZW50Tm9kZTsKCQl9CgoJCWMgPSAkKCBvLmNvbnRhaW5tZW50ICk7CgkJY2UgPSBjWyAwIF07CgoJCWlmKCAhY2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCW92ZXIgPSBjLmNzcyggIm92ZXJmbG93IiApICE9PSAiaGlkZGVuIjsKCgkJdGhpcy5jb250YWlubWVudCA9IFsKCQkJKCBwYXJzZUludCggYy5jc3MoICJib3JkZXJMZWZ0V2lkdGgiICksIDEwICkgfHwgMCApICsgKCBwYXJzZUludCggYy5jc3MoICJwYWRkaW5nTGVmdCIgKSwgMTAgKSB8fCAwICksCgkJCSggcGFyc2VJbnQoIGMuY3NzKCAiYm9yZGVyVG9wV2lkdGgiICksIDEwICkgfHwgMCApICsgKCBwYXJzZUludCggYy5jc3MoICJwYWRkaW5nVG9wIiApLCAxMCApIHx8IDAgKSAsCgkJCSggb3ZlciA/IE1hdGgubWF4KCBjZS5zY3JvbGxXaWR0aCwgY2Uub2Zmc2V0V2lkdGggKSA6IGNlLm9mZnNldFdpZHRoICkgLSAoIHBhcnNlSW50KCBjLmNzcyggImJvcmRlclJpZ2h0V2lkdGgiICksIDEwICkgfHwgMCApIC0gKCBwYXJzZUludCggYy5jc3MoICJwYWRkaW5nUmlnaHQiICksIDEwICkgfHwgMCApIC0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCAtIHRoaXMubWFyZ2lucy5sZWZ0IC0gdGhpcy5tYXJnaW5zLnJpZ2h0LAoJCQkoIG92ZXIgPyBNYXRoLm1heCggY2Uuc2Nyb2xsSGVpZ2h0LCBjZS5vZmZzZXRIZWlnaHQgKSA6IGNlLm9mZnNldEhlaWdodCApIC0gKCBwYXJzZUludCggYy5jc3MoICJib3JkZXJCb3R0b21XaWR0aCIgKSwgMTAgKSB8fCAwICkgLSAoIHBhcnNlSW50KCBjLmNzcyggInBhZGRpbmdCb3R0b20iICksIDEwICkgfHwgMCApIC0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQgLSB0aGlzLm1hcmdpbnMudG9wICAtIHRoaXMubWFyZ2lucy5ib3R0b20KCQldOwoJCXRoaXMucmVsYXRpdmVfY29udGFpbmVyID0gYzsKCX0sCgoJX2NvbnZlcnRQb3NpdGlvblRvOiBmdW5jdGlvbihkLCBwb3MpIHsKCgkJaWYoIXBvcykgewoJCQlwb3MgPSB0aGlzLnBvc2l0aW9uOwoJCX0KCgkJdmFyIG1vZCA9IGQgPT09ICJhYnNvbHV0ZSIgPyAxIDogLTEsCgkJCXNjcm9sbCA9IHRoaXMuY3NzUG9zaXRpb24gPT09ICJhYnNvbHV0ZSIgJiYgISggdGhpcy5zY3JvbGxQYXJlbnRbIDAgXSAhPT0gZG9jdW1lbnQgJiYgJC5jb250YWlucyggdGhpcy5zY3JvbGxQYXJlbnRbIDAgXSwgdGhpcy5vZmZzZXRQYXJlbnRbIDAgXSApICkgPyB0aGlzLm9mZnNldFBhcmVudCA6IHRoaXMuc2Nyb2xsUGFyZW50OwoKCQkvL0NhY2hlIHRoZSBzY3JvbGwKCQlpZiAoIXRoaXMub2Zmc2V0LnNjcm9sbCkgewoJCQl0aGlzLm9mZnNldC5zY3JvbGwgPSB7dG9wIDogc2Nyb2xsLnNjcm9sbFRvcCgpLCBsZWZ0IDogc2Nyb2xsLnNjcm9sbExlZnQoKX07CgkJfQoKCQlyZXR1cm4gewoJCQl0b3A6ICgKCQkJCXBvcy50b3AJKwkJCQkJCQkJCQkJCQkJCQkvLyBUaGUgYWJzb2x1dGUgbW91c2UgcG9zaXRpb24KCQkJCXRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcCAqIG1vZCArCQkJCQkJCQkJCS8vIE9ubHkgZm9yIHJlbGF0aXZlIHBvc2l0aW9uZWQgbm9kZXM6IFJlbGF0aXZlIG9mZnNldCBmcm9tIGVsZW1lbnQgdG8gb2Zmc2V0IHBhcmVudAoJCQkJdGhpcy5vZmZzZXQucGFyZW50LnRvcCAqIG1vZCAtCQkJCQkJCQkJCS8vIFRoZSBvZmZzZXRQYXJlbnQncyBvZmZzZXQgd2l0aG91dCBib3JkZXJzIChvZmZzZXQgKyBib3JkZXIpCgkJCQkoICggdGhpcy5jc3NQb3NpdGlvbiA9PT0gImZpeGVkIiA/IC10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSA6IHRoaXMub2Zmc2V0LnNjcm9sbC50b3AgKSAqIG1vZCApCgkJCSksCgkJCWxlZnQ6ICgKCQkJCXBvcy5sZWZ0ICsJCQkJCQkJCQkJCQkJCQkJLy8gVGhlIGFic29sdXRlIG1vdXNlIHBvc2l0aW9uCgkJCQl0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0ICogbW9kICsJCQkJCQkJCQkJLy8gT25seSBmb3IgcmVsYXRpdmUgcG9zaXRpb25lZCBub2RlczogUmVsYXRpdmUgb2Zmc2V0IGZyb20gZWxlbWVudCB0byBvZmZzZXQgcGFyZW50CgkJCQl0aGlzLm9mZnNldC5wYXJlbnQubGVmdCAqIG1vZAktCQkJCQkJCQkJCS8vIFRoZSBvZmZzZXRQYXJlbnQncyBvZmZzZXQgd2l0aG91dCBib3JkZXJzIChvZmZzZXQgKyBib3JkZXIpCgkJCQkoICggdGhpcy5jc3NQb3NpdGlvbiA9PT0gImZpeGVkIiA/IC10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCkgOiB0aGlzLm9mZnNldC5zY3JvbGwubGVmdCApICogbW9kICkKCQkJKQoJCX07CgoJfSwKCglfZ2VuZXJhdGVQb3NpdGlvbjogZnVuY3Rpb24oZXZlbnQpIHsKCgkJdmFyIGNvbnRhaW5tZW50LCBjbywgdG9wLCBsZWZ0LAoJCQlvID0gdGhpcy5vcHRpb25zLAoJCQlzY3JvbGwgPSB0aGlzLmNzc1Bvc2l0aW9uID09PSAiYWJzb2x1dGUiICYmICEoIHRoaXMuc2Nyb2xsUGFyZW50WyAwIF0gIT09IGRvY3VtZW50ICYmICQuY29udGFpbnMoIHRoaXMuc2Nyb2xsUGFyZW50WyAwIF0sIHRoaXMub2Zmc2V0UGFyZW50WyAwIF0gKSApID8gdGhpcy5vZmZzZXRQYXJlbnQgOiB0aGlzLnNjcm9sbFBhcmVudCwKCQkJcGFnZVggPSBldmVudC5wYWdlWCwKCQkJcGFnZVkgPSBldmVudC5wYWdlWTsKCgkJLy9DYWNoZSB0aGUgc2Nyb2xsCgkJaWYgKCF0aGlzLm9mZnNldC5zY3JvbGwpIHsKCQkJdGhpcy5vZmZzZXQuc2Nyb2xsID0ge3RvcCA6IHNjcm9sbC5zY3JvbGxUb3AoKSwgbGVmdCA6IHNjcm9sbC5zY3JvbGxMZWZ0KCl9OwoJCX0KCgkJLyoKCQkgKiAtIFBvc2l0aW9uIGNvbnN0cmFpbmluZyAtCgkJICogQ29uc3RyYWluIHRoZSBwb3NpdGlvbiB0byBhIG1peCBvZiBncmlkLCBjb250YWlubWVudC4KCQkgKi8KCgkJLy8gSWYgd2UgYXJlIG5vdCBkcmFnZ2luZyB5ZXQsIHdlIHdvbid0IGNoZWNrIGZvciBvcHRpb25zCgkJaWYgKCB0aGlzLm9yaWdpbmFsUG9zaXRpb24gKSB7CgkJCWlmICggdGhpcy5jb250YWlubWVudCApIHsKCQkJCWlmICggdGhpcy5yZWxhdGl2ZV9jb250YWluZXIgKXsKCQkJCQljbyA9IHRoaXMucmVsYXRpdmVfY29udGFpbmVyLm9mZnNldCgpOwoJCQkJCWNvbnRhaW5tZW50ID0gWwoJCQkJCQl0aGlzLmNvbnRhaW5tZW50WyAwIF0gKyBjby5sZWZ0LAoJCQkJCQl0aGlzLmNvbnRhaW5tZW50WyAxIF0gKyBjby50b3AsCgkJCQkJCXRoaXMuY29udGFpbm1lbnRbIDIgXSArIGNvLmxlZnQsCgkJCQkJCXRoaXMuY29udGFpbm1lbnRbIDMgXSArIGNvLnRvcAoJCQkJCV07CgkJCQl9CgkJCQllbHNlIHsKCQkJCQljb250YWlubWVudCA9IHRoaXMuY29udGFpbm1lbnQ7CgkJCQl9CgoJCQkJaWYoZXZlbnQucGFnZVggLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0IDwgY29udGFpbm1lbnRbMF0pIHsKCQkJCQlwYWdlWCA9IGNvbnRhaW5tZW50WzBdICsgdGhpcy5vZmZzZXQuY2xpY2subGVmdDsKCQkJCX0KCQkJCWlmKGV2ZW50LnBhZ2VZIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wIDwgY29udGFpbm1lbnRbMV0pIHsKCQkJCQlwYWdlWSA9IGNvbnRhaW5tZW50WzFdICsgdGhpcy5vZmZzZXQuY2xpY2sudG9wOwoJCQkJfQoJCQkJaWYoZXZlbnQucGFnZVggLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID4gY29udGFpbm1lbnRbMl0pIHsKCQkJCQlwYWdlWCA9IGNvbnRhaW5tZW50WzJdICsgdGhpcy5vZmZzZXQuY2xpY2subGVmdDsKCQkJCX0KCQkJCWlmKGV2ZW50LnBhZ2VZIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wID4gY29udGFpbm1lbnRbM10pIHsKCQkJCQlwYWdlWSA9IGNvbnRhaW5tZW50WzNdICsgdGhpcy5vZmZzZXQuY2xpY2sudG9wOwoJCQkJfQoJCQl9CgoJCQlpZihvLmdyaWQpIHsKCQkJCS8vQ2hlY2sgZm9yIGdyaWQgZWxlbWVudHMgc2V0IHRvIDAgdG8gcHJldmVudCBkaXZpZGUgYnkgMCBlcnJvciBjYXVzaW5nIGludmFsaWQgYXJndW1lbnQgZXJyb3JzIGluIElFIChzZWUgdGlja2V0ICM2OTUwKQoJCQkJdG9wID0gby5ncmlkWzFdID8gdGhpcy5vcmlnaW5hbFBhZ2VZICsgTWF0aC5yb3VuZCgocGFnZVkgLSB0aGlzLm9yaWdpbmFsUGFnZVkpIC8gby5ncmlkWzFdKSAqIG8uZ3JpZFsxXSA6IHRoaXMub3JpZ2luYWxQYWdlWTsKCQkJCXBhZ2VZID0gY29udGFpbm1lbnQgPyAoKHRvcCAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+PSBjb250YWlubWVudFsxXSB8fCB0b3AgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPiBjb250YWlubWVudFszXSkgPyB0b3AgOiAoKHRvcCAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+PSBjb250YWlubWVudFsxXSkgPyB0b3AgLSBvLmdyaWRbMV0gOiB0b3AgKyBvLmdyaWRbMV0pKSA6IHRvcDsKCgkJCQlsZWZ0ID0gby5ncmlkWzBdID8gdGhpcy5vcmlnaW5hbFBhZ2VYICsgTWF0aC5yb3VuZCgocGFnZVggLSB0aGlzLm9yaWdpbmFsUGFnZVgpIC8gby5ncmlkWzBdKSAqIG8uZ3JpZFswXSA6IHRoaXMub3JpZ2luYWxQYWdlWDsKCQkJCXBhZ2VYID0gY29udGFpbm1lbnQgPyAoKGxlZnQgLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID49IGNvbnRhaW5tZW50WzBdIHx8IGxlZnQgLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID4gY29udGFpbm1lbnRbMl0pID8gbGVmdCA6ICgobGVmdCAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPj0gY29udGFpbm1lbnRbMF0pID8gbGVmdCAtIG8uZ3JpZFswXSA6IGxlZnQgKyBvLmdyaWRbMF0pKSA6IGxlZnQ7CgkJCX0KCgkJfQoKCQlyZXR1cm4gewoJCQl0b3A6ICgKCQkJCXBhZ2VZIC0JCQkJCQkJCQkJCQkJCQkJCS8vIFRoZSBhYnNvbHV0ZSBtb3VzZSBwb3NpdGlvbgoJCQkJdGhpcy5vZmZzZXQuY2xpY2sudG9wCS0JCQkJCQkJCQkJCQkvLyBDbGljayBvZmZzZXQgKHJlbGF0aXZlIHRvIHRoZSBlbGVtZW50KQoJCQkJdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wIC0JCQkJCQkJCQkJCQkvLyBPbmx5IGZvciByZWxhdGl2ZSBwb3NpdGlvbmVkIG5vZGVzOiBSZWxhdGl2ZSBvZmZzZXQgZnJvbSBlbGVtZW50IHRvIG9mZnNldCBwYXJlbnQKCQkJCXRoaXMub2Zmc2V0LnBhcmVudC50b3AgKwkJCQkJCQkJCQkJCS8vIFRoZSBvZmZzZXRQYXJlbnQncyBvZmZzZXQgd2l0aG91dCBib3JkZXJzIChvZmZzZXQgKyBib3JkZXIpCgkJCQkoIHRoaXMuY3NzUG9zaXRpb24gPT09ICJmaXhlZCIgPyAtdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCkgOiB0aGlzLm9mZnNldC5zY3JvbGwudG9wICkKCQkJKSwKCQkJbGVmdDogKAoJCQkJcGFnZVggLQkJCQkJCQkJCQkJCQkJCQkJLy8gVGhlIGFic29sdXRlIG1vdXNlIHBvc2l0aW9uCgkJCQl0aGlzLm9mZnNldC5jbGljay5sZWZ0IC0JCQkJCQkJCQkJCQkvLyBDbGljayBvZmZzZXQgKHJlbGF0aXZlIHRvIHRoZSBlbGVtZW50KQoJCQkJdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdCAtCQkJCQkJCQkJCQkJLy8gT25seSBmb3IgcmVsYXRpdmUgcG9zaXRpb25lZCBub2RlczogUmVsYXRpdmUgb2Zmc2V0IGZyb20gZWxlbWVudCB0byBvZmZzZXQgcGFyZW50CgkJCQl0aGlzLm9mZnNldC5wYXJlbnQubGVmdCArCQkJCQkJCQkJCQkJLy8gVGhlIG9mZnNldFBhcmVudCdzIG9mZnNldCB3aXRob3V0IGJvcmRlcnMgKG9mZnNldCArIGJvcmRlcikKCQkJCSggdGhpcy5jc3NQb3NpdGlvbiA9PT0gImZpeGVkIiA/IC10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCkgOiB0aGlzLm9mZnNldC5zY3JvbGwubGVmdCApCgkJCSkKCQl9OwoKCX0sCgoJX2NsZWFyOiBmdW5jdGlvbigpIHsKCQl0aGlzLmhlbHBlci5yZW1vdmVDbGFzcygidWktZHJhZ2dhYmxlLWRyYWdnaW5nIik7CgkJaWYodGhpcy5oZWxwZXJbMF0gIT09IHRoaXMuZWxlbWVudFswXSAmJiAhdGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsKSB7CgkJCXRoaXMuaGVscGVyLnJlbW92ZSgpOwoJCX0KCQl0aGlzLmhlbHBlciA9IG51bGw7CgkJdGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsID0gZmFsc2U7Cgl9LAoKCS8vIEZyb20gbm93IG9uIGJ1bGsgc3R1ZmYgLSBtYWlubHkgaGVscGVycwoKCV90cmlnZ2VyOiBmdW5jdGlvbih0eXBlLCBldmVudCwgdWkpIHsKCQl1aSA9IHVpIHx8IHRoaXMuX3VpSGFzaCgpOwoJCSQudWkucGx1Z2luLmNhbGwodGhpcywgdHlwZSwgW2V2ZW50LCB1aV0pOwoJCS8vVGhlIGFic29sdXRlIHBvc2l0aW9uIGhhcyB0byBiZSByZWNhbGN1bGF0ZWQgYWZ0ZXIgcGx1Z2lucwoJCWlmKHR5cGUgPT09ICJkcmFnIikgewoJCQl0aGlzLnBvc2l0aW9uQWJzID0gdGhpcy5fY29udmVydFBvc2l0aW9uVG8oImFic29sdXRlIik7CgkJfQoJCXJldHVybiAkLldpZGdldC5wcm90b3R5cGUuX3RyaWdnZXIuY2FsbCh0aGlzLCB0eXBlLCBldmVudCwgdWkpOwoJfSwKCglwbHVnaW5zOiB7fSwKCglfdWlIYXNoOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gewoJCQloZWxwZXI6IHRoaXMuaGVscGVyLAoJCQlwb3NpdGlvbjogdGhpcy5wb3NpdGlvbiwKCQkJb3JpZ2luYWxQb3NpdGlvbjogdGhpcy5vcmlnaW5hbFBvc2l0aW9uLAoJCQlvZmZzZXQ6IHRoaXMucG9zaXRpb25BYnMKCQl9OwoJfQoKfSk7CgokLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsICJjb25uZWN0VG9Tb3J0YWJsZSIsIHsKCXN0YXJ0OiBmdW5jdGlvbihldmVudCwgdWkpIHsKCgkJdmFyIGluc3QgPSAkKHRoaXMpLmRhdGEoInVpLWRyYWdnYWJsZSIpLCBvID0gaW5zdC5vcHRpb25zLAoJCQl1aVNvcnRhYmxlID0gJC5leHRlbmQoe30sIHVpLCB7IGl0ZW06IGluc3QuZWxlbWVudCB9KTsKCQlpbnN0LnNvcnRhYmxlcyA9IFtdOwoJCSQoby5jb25uZWN0VG9Tb3J0YWJsZSkuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIHNvcnRhYmxlID0gJC5kYXRhKHRoaXMsICJ1aS1zb3J0YWJsZSIpOwoJCQlpZiAoc29ydGFibGUgJiYgIXNvcnRhYmxlLm9wdGlvbnMuZGlzYWJsZWQpIHsKCQkJCWluc3Quc29ydGFibGVzLnB1c2goewoJCQkJCWluc3RhbmNlOiBzb3J0YWJsZSwKCQkJCQlzaG91bGRSZXZlcnQ6IHNvcnRhYmxlLm9wdGlvbnMucmV2ZXJ0CgkJCQl9KTsKCQkJCXNvcnRhYmxlLnJlZnJlc2hQb3NpdGlvbnMoKTsJLy8gQ2FsbCB0aGUgc29ydGFibGUncyByZWZyZXNoUG9zaXRpb25zIGF0IGRyYWcgc3RhcnQgdG8gcmVmcmVzaCB0aGUgY29udGFpbmVyQ2FjaGUgc2luY2UgdGhlIHNvcnRhYmxlIGNvbnRhaW5lciBjYWNoZSBpcyB1c2VkIGluIGRyYWcgYW5kIG5lZWRzIHRvIGJlIHVwIHRvIGRhdGUgKHRoaXMgd2lsbCBlbnN1cmUgaXQncyBpbml0aWFsaXNlZCBhcyB3ZWxsIGFzIGJlaW5nIGtlcHQgaW4gc3RlcCB3aXRoIGFueSBjaGFuZ2VzIHRoYXQgbWlnaHQgaGF2ZSBoYXBwZW5lZCBvbiB0aGUgcGFnZSkuCgkJCQlzb3J0YWJsZS5fdHJpZ2dlcigiYWN0aXZhdGUiLCBldmVudCwgdWlTb3J0YWJsZSk7CgkJCX0KCQl9KTsKCgl9LAoJc3RvcDogZnVuY3Rpb24oZXZlbnQsIHVpKSB7CgoJCS8vSWYgd2UgYXJlIHN0aWxsIG92ZXIgdGhlIHNvcnRhYmxlLCB3ZSBmYWtlIHRoZSBzdG9wIGV2ZW50IG9mIHRoZSBzb3J0YWJsZSwgYnV0IGFsc28gcmVtb3ZlIGhlbHBlcgoJCXZhciBpbnN0ID0gJCh0aGlzKS5kYXRhKCJ1aS1kcmFnZ2FibGUiKSwKCQkJdWlTb3J0YWJsZSA9ICQuZXh0ZW5kKHt9LCB1aSwgeyBpdGVtOiBpbnN0LmVsZW1lbnQgfSk7CgoJCSQuZWFjaChpbnN0LnNvcnRhYmxlcywgZnVuY3Rpb24oKSB7CgkJCWlmKHRoaXMuaW5zdGFuY2UuaXNPdmVyKSB7CgoJCQkJdGhpcy5pbnN0YW5jZS5pc092ZXIgPSAwOwoKCQkJCWluc3QuY2FuY2VsSGVscGVyUmVtb3ZhbCA9IHRydWU7IC8vRG9uJ3QgcmVtb3ZlIHRoZSBoZWxwZXIgaW4gdGhlIGRyYWdnYWJsZSBpbnN0YW5jZQoJCQkJdGhpcy5pbnN0YW5jZS5jYW5jZWxIZWxwZXJSZW1vdmFsID0gZmFsc2U7IC8vUmVtb3ZlIGl0IGluIHRoZSBzb3J0YWJsZSBpbnN0YW5jZSAoc28gc29ydGFibGUgcGx1Z2lucyBsaWtlIHJldmVydCBzdGlsbCB3b3JrKQoKCQkJCS8vVGhlIHNvcnRhYmxlIHJldmVydCBpcyBzdXBwb3J0ZWQsIGFuZCB3ZSBoYXZlIHRvIHNldCBhIHRlbXBvcmFyeSBkcm9wcGVkIHZhcmlhYmxlIG9uIHRoZSBkcmFnZ2FibGUgdG8gc3VwcG9ydCByZXZlcnQ6ICJ2YWxpZC9pbnZhbGlkIgoJCQkJaWYodGhpcy5zaG91bGRSZXZlcnQpIHsKCQkJCQl0aGlzLmluc3RhbmNlLm9wdGlvbnMucmV2ZXJ0ID0gdGhpcy5zaG91bGRSZXZlcnQ7CgkJCQl9CgoJCQkJLy9UcmlnZ2VyIHRoZSBzdG9wIG9mIHRoZSBzb3J0YWJsZQoJCQkJdGhpcy5pbnN0YW5jZS5fbW91c2VTdG9wKGV2ZW50KTsKCgkJCQl0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyID0gdGhpcy5pbnN0YW5jZS5vcHRpb25zLl9oZWxwZXI7CgoJCQkJLy9JZiB0aGUgaGVscGVyIGhhcyBiZWVuIHRoZSBvcmlnaW5hbCBpdGVtLCByZXN0b3JlIHByb3BlcnRpZXMgaW4gdGhlIHNvcnRhYmxlCgkJCQlpZihpbnN0Lm9wdGlvbnMuaGVscGVyID09PSAib3JpZ2luYWwiKSB7CgkJCQkJdGhpcy5pbnN0YW5jZS5jdXJyZW50SXRlbS5jc3MoeyB0b3A6ICJhdXRvIiwgbGVmdDogImF1dG8iIH0pOwoJCQkJfQoKCQkJfSBlbHNlIHsKCQkJCXRoaXMuaW5zdGFuY2UuY2FuY2VsSGVscGVyUmVtb3ZhbCA9IGZhbHNlOyAvL1JlbW92ZSB0aGUgaGVscGVyIGluIHRoZSBzb3J0YWJsZSBpbnN0YW5jZQoJCQkJdGhpcy5pbnN0YW5jZS5fdHJpZ2dlcigiZGVhY3RpdmF0ZSIsIGV2ZW50LCB1aVNvcnRhYmxlKTsKCQkJfQoKCQl9KTsKCgl9LAoJZHJhZzogZnVuY3Rpb24oZXZlbnQsIHVpKSB7CgoJCXZhciBpbnN0ID0gJCh0aGlzKS5kYXRhKCJ1aS1kcmFnZ2FibGUiKSwgdGhhdCA9IHRoaXM7CgoJCSQuZWFjaChpbnN0LnNvcnRhYmxlcywgZnVuY3Rpb24oKSB7CgoJCQl2YXIgaW5uZXJtb3N0SW50ZXJzZWN0aW5nID0gZmFsc2UsCgkJCQl0aGlzU29ydGFibGUgPSB0aGlzOwoKCQkJLy9Db3B5IG92ZXIgc29tZSB2YXJpYWJsZXMgdG8gYWxsb3cgY2FsbGluZyB0aGUgc29ydGFibGUncyBuYXRpdmUgX2ludGVyc2VjdHNXaXRoCgkJCXRoaXMuaW5zdGFuY2UucG9zaXRpb25BYnMgPSBpbnN0LnBvc2l0aW9uQWJzOwoJCQl0aGlzLmluc3RhbmNlLmhlbHBlclByb3BvcnRpb25zID0gaW5zdC5oZWxwZXJQcm9wb3J0aW9uczsKCQkJdGhpcy5pbnN0YW5jZS5vZmZzZXQuY2xpY2sgPSBpbnN0Lm9mZnNldC5jbGljazsKCgkJCWlmKHRoaXMuaW5zdGFuY2UuX2ludGVyc2VjdHNXaXRoKHRoaXMuaW5zdGFuY2UuY29udGFpbmVyQ2FjaGUpKSB7CgkJCQlpbm5lcm1vc3RJbnRlcnNlY3RpbmcgPSB0cnVlOwoJCQkJJC5lYWNoKGluc3Quc29ydGFibGVzLCBmdW5jdGlvbiAoKSB7CgkJCQkJdGhpcy5pbnN0YW5jZS5wb3NpdGlvbkFicyA9IGluc3QucG9zaXRpb25BYnM7CgkJCQkJdGhpcy5pbnN0YW5jZS5oZWxwZXJQcm9wb3J0aW9ucyA9IGluc3QuaGVscGVyUHJvcG9ydGlvbnM7CgkJCQkJdGhpcy5pbnN0YW5jZS5vZmZzZXQuY2xpY2sgPSBpbnN0Lm9mZnNldC5jbGljazsKCQkJCQlpZiAodGhpcyAhPT0gdGhpc1NvcnRhYmxlICYmCgkJCQkJCXRoaXMuaW5zdGFuY2UuX2ludGVyc2VjdHNXaXRoKHRoaXMuaW5zdGFuY2UuY29udGFpbmVyQ2FjaGUpICYmCgkJCQkJCSQuY29udGFpbnModGhpc1NvcnRhYmxlLmluc3RhbmNlLmVsZW1lbnRbMF0sIHRoaXMuaW5zdGFuY2UuZWxlbWVudFswXSkKCQkJCQkpIHsKCQkJCQkJaW5uZXJtb3N0SW50ZXJzZWN0aW5nID0gZmFsc2U7CgkJCQkJfQoJCQkJCXJldHVybiBpbm5lcm1vc3RJbnRlcnNlY3Rpbmc7CgkJCQl9KTsKCQkJfQoKCgkJCWlmKGlubmVybW9zdEludGVyc2VjdGluZykgewoJCQkJLy9JZiBpdCBpbnRlcnNlY3RzLCB3ZSB1c2UgYSBsaXR0bGUgaXNPdmVyIHZhcmlhYmxlIGFuZCBzZXQgaXQgb25jZSwgc28gb3VyIG1vdmUtaW4gc3R1ZmYgZ2V0cyBmaXJlZCBvbmx5IG9uY2UKCQkJCWlmKCF0aGlzLmluc3RhbmNlLmlzT3ZlcikgewoKCQkJCQl0aGlzLmluc3RhbmNlLmlzT3ZlciA9IDE7CgkJCQkJLy9Ob3cgd2UgZmFrZSB0aGUgc3RhcnQgb2YgZHJhZ2dpbmcgZm9yIHRoZSBzb3J0YWJsZSBpbnN0YW5jZSwKCQkJCQkvL2J5IGNsb25pbmcgdGhlIGxpc3QgZ3JvdXAgaXRlbSwgYXBwZW5kaW5nIGl0IHRvIHRoZSBzb3J0YWJsZSBhbmQgdXNpbmcgaXQgYXMgaW5zdC5jdXJyZW50SXRlbQoJCQkJCS8vV2UgY2FuIHRoZW4gZmlyZSB0aGUgc3RhcnQgZXZlbnQgb2YgdGhlIHNvcnRhYmxlIHdpdGggb3VyIHBhc3NlZCBicm93c2VyIGV2ZW50LCBhbmQgb3VyIG93biBoZWxwZXIgKHNvIGl0IGRvZXNuJ3QgY3JlYXRlIGEgbmV3IG9uZSkKCQkJCQl0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtID0gJCh0aGF0KS5jbG9uZSgpLnJlbW92ZUF0dHIoImlkIikuYXBwZW5kVG8odGhpcy5pbnN0YW5jZS5lbGVtZW50KS5kYXRhKCJ1aS1zb3J0YWJsZS1pdGVtIiwgdHJ1ZSk7CgkJCQkJdGhpcy5pbnN0YW5jZS5vcHRpb25zLl9oZWxwZXIgPSB0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyOyAvL1N0b3JlIGhlbHBlciBvcHRpb24gdG8gbGF0ZXIgcmVzdG9yZSBpdAoJCQkJCXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5oZWxwZXIgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHVpLmhlbHBlclswXTsgfTsKCgkJCQkJZXZlbnQudGFyZ2V0ID0gdGhpcy5pbnN0YW5jZS5jdXJyZW50SXRlbVswXTsKCQkJCQl0aGlzLmluc3RhbmNlLl9tb3VzZUNhcHR1cmUoZXZlbnQsIHRydWUpOwoJCQkJCXRoaXMuaW5zdGFuY2UuX21vdXNlU3RhcnQoZXZlbnQsIHRydWUsIHRydWUpOwoKCQkJCQkvL0JlY2F1c2UgdGhlIGJyb3dzZXIgZXZlbnQgaXMgd2F5IG9mZiB0aGUgbmV3IGFwcGVuZGVkIHBvcnRsZXQsIHdlIG1vZGlmeSBhIGNvdXBsZSBvZiB2YXJpYWJsZXMgdG8gcmVmbGVjdCB0aGUgY2hhbmdlcwoJCQkJCXRoaXMuaW5zdGFuY2Uub2Zmc2V0LmNsaWNrLnRvcCA9IGluc3Qub2Zmc2V0LmNsaWNrLnRvcDsKCQkJCQl0aGlzLmluc3RhbmNlLm9mZnNldC5jbGljay5sZWZ0ID0gaW5zdC5vZmZzZXQuY2xpY2subGVmdDsKCQkJCQl0aGlzLmluc3RhbmNlLm9mZnNldC5wYXJlbnQubGVmdCAtPSBpbnN0Lm9mZnNldC5wYXJlbnQubGVmdCAtIHRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC5sZWZ0OwoJCQkJCXRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC50b3AgLT0gaW5zdC5vZmZzZXQucGFyZW50LnRvcCAtIHRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC50b3A7CgoJCQkJCWluc3QuX3RyaWdnZXIoInRvU29ydGFibGUiLCBldmVudCk7CgkJCQkJaW5zdC5kcm9wcGVkID0gdGhpcy5pbnN0YW5jZS5lbGVtZW50OyAvL2RyYWdnYWJsZSByZXZlcnQgbmVlZHMgdGhhdAoJCQkJCS8vaGFjayBzbyByZWNlaXZlL3VwZGF0ZSBjYWxsYmFja3Mgd29yayAobW9zdGx5KQoJCQkJCWluc3QuY3VycmVudEl0ZW0gPSBpbnN0LmVsZW1lbnQ7CgkJCQkJdGhpcy5pbnN0YW5jZS5mcm9tT3V0c2lkZSA9IGluc3Q7CgoJCQkJfQoKCQkJCS8vUHJvdmlkZWQgd2UgZGlkIGFsbCB0aGUgcHJldmlvdXMgc3RlcHMsIHdlIGNhbiBmaXJlIHRoZSBkcmFnIGV2ZW50IG9mIHRoZSBzb3J0YWJsZSBvbiBldmVyeSBkcmFnZ2FibGUgZHJhZywgd2hlbiBpdCBpbnRlcnNlY3RzIHdpdGggdGhlIHNvcnRhYmxlCgkJCQlpZih0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtKSB7CgkJCQkJdGhpcy5pbnN0YW5jZS5fbW91c2VEcmFnKGV2ZW50KTsKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJLy9JZiBpdCBkb2Vzbid0IGludGVyc2VjdCB3aXRoIHRoZSBzb3J0YWJsZSwgYW5kIGl0IGludGVyc2VjdGVkIGJlZm9yZSwKCQkJCS8vd2UgZmFrZSB0aGUgZHJhZyBzdG9wIG9mIHRoZSBzb3J0YWJsZSwgYnV0IG1ha2Ugc3VyZSBpdCBkb2Vzbid0IHJlbW92ZSB0aGUgaGVscGVyIGJ5IHVzaW5nIGNhbmNlbEhlbHBlclJlbW92YWwKCQkJCWlmKHRoaXMuaW5zdGFuY2UuaXNPdmVyKSB7CgoJCQkJCXRoaXMuaW5zdGFuY2UuaXNPdmVyID0gMDsKCQkJCQl0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWwgPSB0cnVlOwoKCQkJCQkvL1ByZXZlbnQgcmV2ZXJ0aW5nIG9uIHRoaXMgZm9yY2VkIHN0b3AKCQkJCQl0aGlzLmluc3RhbmNlLm9wdGlvbnMucmV2ZXJ0ID0gZmFsc2U7CgoJCQkJCS8vIFRoZSBvdXQgZXZlbnQgbmVlZHMgdG8gYmUgdHJpZ2dlcmVkIGluZGVwZW5kZW50bHkKCQkJCQl0aGlzLmluc3RhbmNlLl90cmlnZ2VyKCJvdXQiLCBldmVudCwgdGhpcy5pbnN0YW5jZS5fdWlIYXNoKHRoaXMuaW5zdGFuY2UpKTsKCgkJCQkJdGhpcy5pbnN0YW5jZS5fbW91c2VTdG9wKGV2ZW50LCB0cnVlKTsKCQkJCQl0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyID0gdGhpcy5pbnN0YW5jZS5vcHRpb25zLl9oZWxwZXI7CgoJCQkJCS8vTm93IHdlIHJlbW92ZSBvdXIgY3VycmVudEl0ZW0sIHRoZSBsaXN0IGdyb3VwIGNsb25lIGFnYWluLCBhbmQgdGhlIHBsYWNlaG9sZGVyLCBhbmQgYW5pbWF0ZSB0aGUgaGVscGVyIGJhY2sgdG8gaXQncyBvcmlnaW5hbCBzaXplCgkJCQkJdGhpcy5pbnN0YW5jZS5jdXJyZW50SXRlbS5yZW1vdmUoKTsKCQkJCQlpZih0aGlzLmluc3RhbmNlLnBsYWNlaG9sZGVyKSB7CgkJCQkJCXRoaXMuaW5zdGFuY2UucGxhY2Vob2xkZXIucmVtb3ZlKCk7CgkJCQkJfQoKCQkJCQlpbnN0Ll90cmlnZ2VyKCJmcm9tU29ydGFibGUiLCBldmVudCk7CgkJCQkJaW5zdC5kcm9wcGVkID0gZmFsc2U7IC8vZHJhZ2dhYmxlIHJldmVydCBuZWVkcyB0aGF0CgkJCQl9CgoJCQl9CgoJCX0pOwoKCX0KfSk7CgokLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsICJjdXJzb3IiLCB7CglzdGFydDogZnVuY3Rpb24oKSB7CgkJdmFyIHQgPSAkKCJib2R5IiksIG8gPSAkKHRoaXMpLmRhdGEoInVpLWRyYWdnYWJsZSIpLm9wdGlvbnM7CgkJaWYgKHQuY3NzKCJjdXJzb3IiKSkgewoJCQlvLl9jdXJzb3IgPSB0LmNzcygiY3Vyc29yIik7CgkJfQoJCXQuY3NzKCJjdXJzb3IiLCBvLmN1cnNvcik7Cgl9LAoJc3RvcDogZnVuY3Rpb24oKSB7CgkJdmFyIG8gPSAkKHRoaXMpLmRhdGEoInVpLWRyYWdnYWJsZSIpLm9wdGlvbnM7CgkJaWYgKG8uX2N1cnNvcikgewoJCQkkKCJib2R5IikuY3NzKCJjdXJzb3IiLCBvLl9jdXJzb3IpOwoJCX0KCX0KfSk7CgokLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsICJvcGFjaXR5IiwgewoJc3RhcnQ6IGZ1bmN0aW9uKGV2ZW50LCB1aSkgewoJCXZhciB0ID0gJCh1aS5oZWxwZXIpLCBvID0gJCh0aGlzKS5kYXRhKCJ1aS1kcmFnZ2FibGUiKS5vcHRpb25zOwoJCWlmKHQuY3NzKCJvcGFjaXR5IikpIHsKCQkJby5fb3BhY2l0eSA9IHQuY3NzKCJvcGFjaXR5Iik7CgkJfQoJCXQuY3NzKCJvcGFjaXR5Iiwgby5vcGFjaXR5KTsKCX0sCglzdG9wOiBmdW5jdGlvbihldmVudCwgdWkpIHsKCQl2YXIgbyA9ICQodGhpcykuZGF0YSgidWktZHJhZ2dhYmxlIikub3B0aW9uczsKCQlpZihvLl9vcGFjaXR5KSB7CgkJCSQodWkuaGVscGVyKS5jc3MoIm9wYWNpdHkiLCBvLl9vcGFjaXR5KTsKCQl9Cgl9Cn0pOwoKJC51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCAic2Nyb2xsIiwgewoJc3RhcnQ6IGZ1bmN0aW9uKCkgewoJCXZhciBpID0gJCh0aGlzKS5kYXRhKCJ1aS1kcmFnZ2FibGUiKTsKCQlpZihpLnNjcm9sbFBhcmVudFswXSAhPT0gZG9jdW1lbnQgJiYgaS5zY3JvbGxQYXJlbnRbMF0udGFnTmFtZSAhPT0gIkhUTUwiKSB7CgkJCWkub3ZlcmZsb3dPZmZzZXQgPSBpLnNjcm9sbFBhcmVudC5vZmZzZXQoKTsKCQl9Cgl9LAoJZHJhZzogZnVuY3Rpb24oIGV2ZW50ICkgewoKCQl2YXIgaSA9ICQodGhpcykuZGF0YSgidWktZHJhZ2dhYmxlIiksIG8gPSBpLm9wdGlvbnMsIHNjcm9sbGVkID0gZmFsc2U7CgoJCWlmKGkuc2Nyb2xsUGFyZW50WzBdICE9PSBkb2N1bWVudCAmJiBpLnNjcm9sbFBhcmVudFswXS50YWdOYW1lICE9PSAiSFRNTCIpIHsKCgkJCWlmKCFvLmF4aXMgfHwgby5heGlzICE9PSAieCIpIHsKCQkJCWlmKChpLm92ZXJmbG93T2Zmc2V0LnRvcCArIGkuc2Nyb2xsUGFyZW50WzBdLm9mZnNldEhlaWdodCkgLSBldmVudC5wYWdlWSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlpLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AgPSBzY3JvbGxlZCA9IGkuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCArIG8uc2Nyb2xsU3BlZWQ7CgkJCQl9IGVsc2UgaWYoZXZlbnQucGFnZVkgLSBpLm92ZXJmbG93T2Zmc2V0LnRvcCA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlpLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AgPSBzY3JvbGxlZCA9IGkuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCAtIG8uc2Nyb2xsU3BlZWQ7CgkJCQl9CgkJCX0KCgkJCWlmKCFvLmF4aXMgfHwgby5heGlzICE9PSAieSIpIHsKCQkJCWlmKChpLm92ZXJmbG93T2Zmc2V0LmxlZnQgKyBpLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aCkgLSBldmVudC5wYWdlWCA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlpLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0ID0gc2Nyb2xsZWQgPSBpLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0ICsgby5zY3JvbGxTcGVlZDsKCQkJCX0gZWxzZSBpZihldmVudC5wYWdlWCAtIGkub3ZlcmZsb3dPZmZzZXQubGVmdCA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlpLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0ID0gc2Nyb2xsZWQgPSBpLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0IC0gby5zY3JvbGxTcGVlZDsKCQkJCX0KCQkJfQoKCQl9IGVsc2UgewoKCQkJaWYoIW8uYXhpcyB8fCBvLmF4aXMgIT09ICJ4IikgewoJCQkJaWYoZXZlbnQucGFnZVkgLSAkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSAtIG8uc2Nyb2xsU3BlZWQpOwoJCQkJfSBlbHNlIGlmKCQod2luZG93KS5oZWlnaHQoKSAtIChldmVudC5wYWdlWSAtICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpKSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSArIG8uc2Nyb2xsU3BlZWQpOwoJCQkJfQoJCQl9CgoJCQlpZighby5heGlzIHx8IG8uYXhpcyAhPT0gInkiKSB7CgkJCQlpZihldmVudC5wYWdlWCAtICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpIC0gby5zY3JvbGxTcGVlZCk7CgkJCQl9IGVsc2UgaWYoJCh3aW5kb3cpLndpZHRoKCkgLSAoZXZlbnQucGFnZVggLSAkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkpIDwgby5zY3JvbGxTZW5zaXRpdml0eSkgewoJCQkJCXNjcm9sbGVkID0gJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkgKyBvLnNjcm9sbFNwZWVkKTsKCQkJCX0KCQkJfQoKCQl9CgoJCWlmKHNjcm9sbGVkICE9PSBmYWxzZSAmJiAkLnVpLmRkbWFuYWdlciAmJiAhby5kcm9wQmVoYXZpb3VyKSB7CgkJCSQudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKGksIGV2ZW50KTsKCQl9CgoJfQp9KTsKCiQudWkucGx1Z2luLmFkZCgiZHJhZ2dhYmxlIiwgInNuYXAiLCB7CglzdGFydDogZnVuY3Rpb24oKSB7CgoJCXZhciBpID0gJCh0aGlzKS5kYXRhKCJ1aS1kcmFnZ2FibGUiKSwKCQkJbyA9IGkub3B0aW9uczsKCgkJaS5zbmFwRWxlbWVudHMgPSBbXTsKCgkJJChvLnNuYXAuY29uc3RydWN0b3IgIT09IFN0cmluZyA/ICggby5zbmFwLml0ZW1zIHx8ICI6ZGF0YSh1aS1kcmFnZ2FibGUpIiApIDogby5zbmFwKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgJHQgPSAkKHRoaXMpLAoJCQkJJG8gPSAkdC5vZmZzZXQoKTsKCQkJaWYodGhpcyAhPT0gaS5lbGVtZW50WzBdKSB7CgkJCQlpLnNuYXBFbGVtZW50cy5wdXNoKHsKCQkJCQlpdGVtOiB0aGlzLAoJCQkJCXdpZHRoOiAkdC5vdXRlcldpZHRoKCksIGhlaWdodDogJHQub3V0ZXJIZWlnaHQoKSwKCQkJCQl0b3A6ICRvLnRvcCwgbGVmdDogJG8ubGVmdAoJCQkJfSk7CgkJCX0KCQl9KTsKCgl9LAoJZHJhZzogZnVuY3Rpb24oZXZlbnQsIHVpKSB7CgoJCXZhciB0cywgYnMsIGxzLCBycywgbCwgciwgdCwgYiwgaSwgZmlyc3QsCgkJCWluc3QgPSAkKHRoaXMpLmRhdGEoInVpLWRyYWdnYWJsZSIpLAoJCQlvID0gaW5zdC5vcHRpb25zLAoJCQlkID0gby5zbmFwVG9sZXJhbmNlLAoJCQl4MSA9IHVpLm9mZnNldC5sZWZ0LCB4MiA9IHgxICsgaW5zdC5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCwKCQkJeTEgPSB1aS5vZmZzZXQudG9wLCB5MiA9IHkxICsgaW5zdC5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQ7CgoJCWZvciAoaSA9IGluc3Quc25hcEVsZW1lbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKXsKCgkJCWwgPSBpbnN0LnNuYXBFbGVtZW50c1tpXS5sZWZ0OwoJCQlyID0gbCArIGluc3Quc25hcEVsZW1lbnRzW2ldLndpZHRoOwoJCQl0ID0gaW5zdC5zbmFwRWxlbWVudHNbaV0udG9wOwoJCQliID0gdCArIGluc3Quc25hcEVsZW1lbnRzW2ldLmhlaWdodDsKCgkJCWlmICggeDIgPCBsIC0gZCB8fCB4MSA+IHIgKyBkIHx8IHkyIDwgdCAtIGQgfHwgeTEgPiBiICsgZCB8fCAhJC5jb250YWlucyggaW5zdC5zbmFwRWxlbWVudHNbIGkgXS5pdGVtLm93bmVyRG9jdW1lbnQsIGluc3Quc25hcEVsZW1lbnRzWyBpIF0uaXRlbSApICkgewoJCQkJaWYoaW5zdC5zbmFwRWxlbWVudHNbaV0uc25hcHBpbmcpIHsKCQkJCQkoaW5zdC5vcHRpb25zLnNuYXAucmVsZWFzZSAmJiBpbnN0Lm9wdGlvbnMuc25hcC5yZWxlYXNlLmNhbGwoaW5zdC5lbGVtZW50LCBldmVudCwgJC5leHRlbmQoaW5zdC5fdWlIYXNoKCksIHsgc25hcEl0ZW06IGluc3Quc25hcEVsZW1lbnRzW2ldLml0ZW0gfSkpKTsKCQkJCX0KCQkJCWluc3Quc25hcEVsZW1lbnRzW2ldLnNuYXBwaW5nID0gZmFsc2U7CgkJCQljb250aW51ZTsKCQkJfQoKCQkJaWYoby5zbmFwTW9kZSAhPT0gImlubmVyIikgewoJCQkJdHMgPSBNYXRoLmFicyh0IC0geTIpIDw9IGQ7CgkJCQlicyA9IE1hdGguYWJzKGIgLSB5MSkgPD0gZDsKCQkJCWxzID0gTWF0aC5hYnMobCAtIHgyKSA8PSBkOwoJCQkJcnMgPSBNYXRoLmFicyhyIC0geDEpIDw9IGQ7CgkJCQlpZih0cykgewoJCQkJCXVpLnBvc2l0aW9uLnRvcCA9IGluc3QuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIsIHsgdG9wOiB0IC0gaW5zdC5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsIGxlZnQ6IDAgfSkudG9wIC0gaW5zdC5tYXJnaW5zLnRvcDsKCQkJCX0KCQkJCWlmKGJzKSB7CgkJCQkJdWkucG9zaXRpb24udG9wID0gaW5zdC5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgeyB0b3A6IGIsIGxlZnQ6IDAgfSkudG9wIC0gaW5zdC5tYXJnaW5zLnRvcDsKCQkJCX0KCQkJCWlmKGxzKSB7CgkJCQkJdWkucG9zaXRpb24ubGVmdCA9IGluc3QuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIsIHsgdG9wOiAwLCBsZWZ0OiBsIC0gaW5zdC5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCB9KS5sZWZ0IC0gaW5zdC5tYXJnaW5zLmxlZnQ7CgkJCQl9CgkJCQlpZihycykgewoJCQkJCXVpLnBvc2l0aW9uLmxlZnQgPSBpbnN0Ll9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLCB7IHRvcDogMCwgbGVmdDogciB9KS5sZWZ0IC0gaW5zdC5tYXJnaW5zLmxlZnQ7CgkJCQl9CgkJCX0KCgkJCWZpcnN0ID0gKHRzIHx8IGJzIHx8IGxzIHx8IHJzKTsKCgkJCWlmKG8uc25hcE1vZGUgIT09ICJvdXRlciIpIHsKCQkJCXRzID0gTWF0aC5hYnModCAtIHkxKSA8PSBkOwoJCQkJYnMgPSBNYXRoLmFicyhiIC0geTIpIDw9IGQ7CgkJCQlscyA9IE1hdGguYWJzKGwgLSB4MSkgPD0gZDsKCQkJCXJzID0gTWF0aC5hYnMociAtIHgyKSA8PSBkOwoJCQkJaWYodHMpIHsKCQkJCQl1aS5wb3NpdGlvbi50b3AgPSBpbnN0Ll9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLCB7IHRvcDogdCwgbGVmdDogMCB9KS50b3AgLSBpbnN0Lm1hcmdpbnMudG9wOwoJCQkJfQoJCQkJaWYoYnMpIHsKCQkJCQl1aS5wb3NpdGlvbi50b3AgPSBpbnN0Ll9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLCB7IHRvcDogYiAtIGluc3QuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LCBsZWZ0OiAwIH0pLnRvcCAtIGluc3QubWFyZ2lucy50b3A7CgkJCQl9CgkJCQlpZihscykgewoJCQkJCXVpLnBvc2l0aW9uLmxlZnQgPSBpbnN0Ll9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLCB7IHRvcDogMCwgbGVmdDogbCB9KS5sZWZ0IC0gaW5zdC5tYXJnaW5zLmxlZnQ7CgkJCQl9CgkJCQlpZihycykgewoJCQkJCXVpLnBvc2l0aW9uLmxlZnQgPSBpbnN0Ll9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLCB7IHRvcDogMCwgbGVmdDogciAtIGluc3QuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggfSkubGVmdCAtIGluc3QubWFyZ2lucy5sZWZ0OwoJCQkJfQoJCQl9CgoJCQlpZighaW5zdC5zbmFwRWxlbWVudHNbaV0uc25hcHBpbmcgJiYgKHRzIHx8IGJzIHx8IGxzIHx8IHJzIHx8IGZpcnN0KSkgewoJCQkJKGluc3Qub3B0aW9ucy5zbmFwLnNuYXAgJiYgaW5zdC5vcHRpb25zLnNuYXAuc25hcC5jYWxsKGluc3QuZWxlbWVudCwgZXZlbnQsICQuZXh0ZW5kKGluc3QuX3VpSGFzaCgpLCB7IHNuYXBJdGVtOiBpbnN0LnNuYXBFbGVtZW50c1tpXS5pdGVtIH0pKSk7CgkJCX0KCQkJaW5zdC5zbmFwRWxlbWVudHNbaV0uc25hcHBpbmcgPSAodHMgfHwgYnMgfHwgbHMgfHwgcnMgfHwgZmlyc3QpOwoKCQl9CgoJfQp9KTsKCiQudWkucGx1Z2luLmFkZCgiZHJhZ2dhYmxlIiwgInN0YWNrIiwgewoJc3RhcnQ6IGZ1bmN0aW9uKCkgewoJCXZhciBtaW4sCgkJCW8gPSB0aGlzLmRhdGEoInVpLWRyYWdnYWJsZSIpLm9wdGlvbnMsCgkJCWdyb3VwID0gJC5tYWtlQXJyYXkoJChvLnN0YWNrKSkuc29ydChmdW5jdGlvbihhLGIpIHsKCQkJCXJldHVybiAocGFyc2VJbnQoJChhKS5jc3MoInpJbmRleCIpLDEwKSB8fCAwKSAtIChwYXJzZUludCgkKGIpLmNzcygiekluZGV4IiksMTApIHx8IDApOwoJCQl9KTsKCgkJaWYgKCFncm91cC5sZW5ndGgpIHsgcmV0dXJuOyB9CgoJCW1pbiA9IHBhcnNlSW50KCQoZ3JvdXBbMF0pLmNzcygiekluZGV4IiksIDEwKSB8fCAwOwoJCSQoZ3JvdXApLmVhY2goZnVuY3Rpb24oaSkgewoJCQkkKHRoaXMpLmNzcygiekluZGV4IiwgbWluICsgaSk7CgkJfSk7CgkJdGhpcy5jc3MoInpJbmRleCIsIChtaW4gKyBncm91cC5sZW5ndGgpKTsKCX0KfSk7CgokLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsICJ6SW5kZXgiLCB7CglzdGFydDogZnVuY3Rpb24oZXZlbnQsIHVpKSB7CgkJdmFyIHQgPSAkKHVpLmhlbHBlciksIG8gPSAkKHRoaXMpLmRhdGEoInVpLWRyYWdnYWJsZSIpLm9wdGlvbnM7CgkJaWYodC5jc3MoInpJbmRleCIpKSB7CgkJCW8uX3pJbmRleCA9IHQuY3NzKCJ6SW5kZXgiKTsKCQl9CgkJdC5jc3MoInpJbmRleCIsIG8uekluZGV4KTsKCX0sCglzdG9wOiBmdW5jdGlvbihldmVudCwgdWkpIHsKCQl2YXIgbyA9ICQodGhpcykuZGF0YSgidWktZHJhZ2dhYmxlIikub3B0aW9uczsKCQlpZihvLl96SW5kZXgpIHsKCQkJJCh1aS5oZWxwZXIpLmNzcygiekluZGV4Iiwgby5fekluZGV4KTsKCQl9Cgl9Cn0pOwoKfSkoalF1ZXJ5KTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKZnVuY3Rpb24gaXNPdmVyQXhpcyggeCwgcmVmZXJlbmNlLCBzaXplICkgewoJcmV0dXJuICggeCA+IHJlZmVyZW5jZSApICYmICggeCA8ICggcmVmZXJlbmNlICsgc2l6ZSApICk7Cn0KCiQud2lkZ2V0KCJ1aS5kcm9wcGFibGUiLCB7Cgl2ZXJzaW9uOiAiMS4xMC40IiwKCXdpZGdldEV2ZW50UHJlZml4OiAiZHJvcCIsCglvcHRpb25zOiB7CgkJYWNjZXB0OiAiKiIsCgkJYWN0aXZlQ2xhc3M6IGZhbHNlLAoJCWFkZENsYXNzZXM6IHRydWUsCgkJZ3JlZWR5OiBmYWxzZSwKCQlob3ZlckNsYXNzOiBmYWxzZSwKCQlzY29wZTogImRlZmF1bHQiLAoJCXRvbGVyYW5jZTogImludGVyc2VjdCIsCgoJCS8vIGNhbGxiYWNrcwoJCWFjdGl2YXRlOiBudWxsLAoJCWRlYWN0aXZhdGU6IG51bGwsCgkJZHJvcDogbnVsbCwKCQlvdXQ6IG51bGwsCgkJb3ZlcjogbnVsbAoJfSwKCV9jcmVhdGU6IGZ1bmN0aW9uKCkgewoKCQl2YXIgcHJvcG9ydGlvbnMsCgkJCW8gPSB0aGlzLm9wdGlvbnMsCgkJCWFjY2VwdCA9IG8uYWNjZXB0OwoKCQl0aGlzLmlzb3ZlciA9IGZhbHNlOwoJCXRoaXMuaXNvdXQgPSB0cnVlOwoKCQl0aGlzLmFjY2VwdCA9ICQuaXNGdW5jdGlvbihhY2NlcHQpID8gYWNjZXB0IDogZnVuY3Rpb24oZCkgewoJCQlyZXR1cm4gZC5pcyhhY2NlcHQpOwoJCX07CgoJCXRoaXMucHJvcG9ydGlvbnMgPSBmdW5jdGlvbiggLyogdmFsdWVUb1dyaXRlICovICkgewoJCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCQkvLyBTdG9yZSB0aGUgZHJvcHBhYmxlJ3MgcHJvcG9ydGlvbnMKCQkJCXByb3BvcnRpb25zID0gYXJndW1lbnRzWyAwIF07CgkJCX0gZWxzZSB7CgkJCQkvLyBSZXRyaWV2ZSBvciBkZXJpdmUgdGhlIGRyb3BwYWJsZSdzIHByb3BvcnRpb25zCgkJCQlyZXR1cm4gcHJvcG9ydGlvbnMgPwoJCQkJCXByb3BvcnRpb25zIDoKCQkJCQlwcm9wb3J0aW9ucyA9IHsKCQkJCQkJd2lkdGg6IHRoaXMuZWxlbWVudFsgMCBdLm9mZnNldFdpZHRoLAoJCQkJCQloZWlnaHQ6IHRoaXMuZWxlbWVudFsgMCBdLm9mZnNldEhlaWdodAoJCQkJCX07CgkJCX0KCQl9OwoKCQkvLyBBZGQgdGhlIHJlZmVyZW5jZSBhbmQgcG9zaXRpb25zIHRvIHRoZSBtYW5hZ2VyCgkJJC51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1tvLnNjb3BlXSA9ICQudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbby5zY29wZV0gfHwgW107CgkJJC51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1tvLnNjb3BlXS5wdXNoKHRoaXMpOwoKCQkoby5hZGRDbGFzc2VzICYmIHRoaXMuZWxlbWVudC5hZGRDbGFzcygidWktZHJvcHBhYmxlIikpOwoKCX0sCgoJX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewoJCXZhciBpID0gMCwKCQkJZHJvcCA9ICQudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbdGhpcy5vcHRpb25zLnNjb3BlXTsKCgkJZm9yICggOyBpIDwgZHJvcC5sZW5ndGg7IGkrKyApIHsKCQkJaWYgKCBkcm9wW2ldID09PSB0aGlzICkgewoJCQkJZHJvcC5zcGxpY2UoaSwgMSk7CgkJCX0KCQl9CgoJCXRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktZHJvcHBhYmxlIHVpLWRyb3BwYWJsZS1kaXNhYmxlZCIpOwoJfSwKCglfc2V0T3B0aW9uOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CgoJCWlmKGtleSA9PT0gImFjY2VwdCIpIHsKCQkJdGhpcy5hY2NlcHQgPSAkLmlzRnVuY3Rpb24odmFsdWUpID8gdmFsdWUgOiBmdW5jdGlvbihkKSB7CgkJCQlyZXR1cm4gZC5pcyh2YWx1ZSk7CgkJCX07CgkJfQoJCSQuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cgl9LAoKCV9hY3RpdmF0ZTogZnVuY3Rpb24oZXZlbnQpIHsKCQl2YXIgZHJhZ2dhYmxlID0gJC51aS5kZG1hbmFnZXIuY3VycmVudDsKCQlpZih0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MpIHsKCQkJdGhpcy5lbGVtZW50LmFkZENsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyk7CgkJfQoJCWlmKGRyYWdnYWJsZSl7CgkJCXRoaXMuX3RyaWdnZXIoImFjdGl2YXRlIiwgZXZlbnQsIHRoaXMudWkoZHJhZ2dhYmxlKSk7CgkJfQoJfSwKCglfZGVhY3RpdmF0ZTogZnVuY3Rpb24oZXZlbnQpIHsKCQl2YXIgZHJhZ2dhYmxlID0gJC51aS5kZG1hbmFnZXIuY3VycmVudDsKCQlpZih0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MpIHsKCQkJdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyk7CgkJfQoJCWlmKGRyYWdnYWJsZSl7CgkJCXRoaXMuX3RyaWdnZXIoImRlYWN0aXZhdGUiLCBldmVudCwgdGhpcy51aShkcmFnZ2FibGUpKTsKCQl9Cgl9LAoKCV9vdmVyOiBmdW5jdGlvbihldmVudCkgewoKCQl2YXIgZHJhZ2dhYmxlID0gJC51aS5kZG1hbmFnZXIuY3VycmVudDsKCgkJLy8gQmFpbCBpZiBkcmFnZ2FibGUgYW5kIGRyb3BwYWJsZSBhcmUgc2FtZSBlbGVtZW50CgkJaWYgKCFkcmFnZ2FibGUgfHwgKGRyYWdnYWJsZS5jdXJyZW50SXRlbSB8fCBkcmFnZ2FibGUuZWxlbWVudClbMF0gPT09IHRoaXMuZWxlbWVudFswXSkgewoJCQlyZXR1cm47CgkJfQoKCQlpZiAodGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sKGRyYWdnYWJsZS5jdXJyZW50SXRlbSB8fCBkcmFnZ2FibGUuZWxlbWVudCkpKSB7CgkJCWlmKHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzKSB7CgkJCQl0aGlzLmVsZW1lbnQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpOwoJCQl9CgkJCXRoaXMuX3RyaWdnZXIoIm92ZXIiLCBldmVudCwgdGhpcy51aShkcmFnZ2FibGUpKTsKCQl9CgoJfSwKCglfb3V0OiBmdW5jdGlvbihldmVudCkgewoKCQl2YXIgZHJhZ2dhYmxlID0gJC51aS5kZG1hbmFnZXIuY3VycmVudDsKCgkJLy8gQmFpbCBpZiBkcmFnZ2FibGUgYW5kIGRyb3BwYWJsZSBhcmUgc2FtZSBlbGVtZW50CgkJaWYgKCFkcmFnZ2FibGUgfHwgKGRyYWdnYWJsZS5jdXJyZW50SXRlbSB8fCBkcmFnZ2FibGUuZWxlbWVudClbMF0gPT09IHRoaXMuZWxlbWVudFswXSkgewoJCQlyZXR1cm47CgkJfQoKCQlpZiAodGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sKGRyYWdnYWJsZS5jdXJyZW50SXRlbSB8fCBkcmFnZ2FibGUuZWxlbWVudCkpKSB7CgkJCWlmKHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzKSB7CgkJCQl0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpOwoJCQl9CgkJCXRoaXMuX3RyaWdnZXIoIm91dCIsIGV2ZW50LCB0aGlzLnVpKGRyYWdnYWJsZSkpOwoJCX0KCgl9LAoKCV9kcm9wOiBmdW5jdGlvbihldmVudCxjdXN0b20pIHsKCgkJdmFyIGRyYWdnYWJsZSA9IGN1c3RvbSB8fCAkLnVpLmRkbWFuYWdlci5jdXJyZW50LAoJCQljaGlsZHJlbkludGVyc2VjdGlvbiA9IGZhbHNlOwoKCQkvLyBCYWlsIGlmIGRyYWdnYWJsZSBhbmQgZHJvcHBhYmxlIGFyZSBzYW1lIGVsZW1lbnQKCQlpZiAoIWRyYWdnYWJsZSB8fCAoZHJhZ2dhYmxlLmN1cnJlbnRJdGVtIHx8IGRyYWdnYWJsZS5lbGVtZW50KVswXSA9PT0gdGhpcy5lbGVtZW50WzBdKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXRoaXMuZWxlbWVudC5maW5kKCI6ZGF0YSh1aS1kcm9wcGFibGUpIikubm90KCIudWktZHJhZ2dhYmxlLWRyYWdnaW5nIikuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIGluc3QgPSAkLmRhdGEodGhpcywgInVpLWRyb3BwYWJsZSIpOwoJCQlpZigKCQkJCWluc3Qub3B0aW9ucy5ncmVlZHkgJiYKCQkJCSFpbnN0Lm9wdGlvbnMuZGlzYWJsZWQgJiYKCQkJCWluc3Qub3B0aW9ucy5zY29wZSA9PT0gZHJhZ2dhYmxlLm9wdGlvbnMuc2NvcGUgJiYKCQkJCWluc3QuYWNjZXB0LmNhbGwoaW5zdC5lbGVtZW50WzBdLCAoZHJhZ2dhYmxlLmN1cnJlbnRJdGVtIHx8IGRyYWdnYWJsZS5lbGVtZW50KSkgJiYKCQkJCSQudWkuaW50ZXJzZWN0KGRyYWdnYWJsZSwgJC5leHRlbmQoaW5zdCwgeyBvZmZzZXQ6IGluc3QuZWxlbWVudC5vZmZzZXQoKSB9KSwgaW5zdC5vcHRpb25zLnRvbGVyYW5jZSkKCQkJKSB7IGNoaWxkcmVuSW50ZXJzZWN0aW9uID0gdHJ1ZTsgcmV0dXJuIGZhbHNlOyB9CgkJfSk7CgkJaWYoY2hpbGRyZW5JbnRlcnNlY3Rpb24pIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJaWYodGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sKGRyYWdnYWJsZS5jdXJyZW50SXRlbSB8fCBkcmFnZ2FibGUuZWxlbWVudCkpKSB7CgkJCWlmKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcykgewoJCQkJdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyk7CgkJCX0KCQkJaWYodGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpIHsKCQkJCXRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyk7CgkJCX0KCQkJdGhpcy5fdHJpZ2dlcigiZHJvcCIsIGV2ZW50LCB0aGlzLnVpKGRyYWdnYWJsZSkpOwoJCQlyZXR1cm4gdGhpcy5lbGVtZW50OwoJCX0KCgkJcmV0dXJuIGZhbHNlOwoKCX0sCgoJdWk6IGZ1bmN0aW9uKGMpIHsKCQlyZXR1cm4gewoJCQlkcmFnZ2FibGU6IChjLmN1cnJlbnRJdGVtIHx8IGMuZWxlbWVudCksCgkJCWhlbHBlcjogYy5oZWxwZXIsCgkJCXBvc2l0aW9uOiBjLnBvc2l0aW9uLAoJCQlvZmZzZXQ6IGMucG9zaXRpb25BYnMKCQl9OwoJfQoKfSk7CgokLnVpLmludGVyc2VjdCA9IGZ1bmN0aW9uKGRyYWdnYWJsZSwgZHJvcHBhYmxlLCB0b2xlcmFuY2VNb2RlKSB7CgoJaWYgKCFkcm9wcGFibGUub2Zmc2V0KSB7CgkJcmV0dXJuIGZhbHNlOwoJfQoKCXZhciBkcmFnZ2FibGVMZWZ0LCBkcmFnZ2FibGVUb3AsCgkJeDEgPSAoZHJhZ2dhYmxlLnBvc2l0aW9uQWJzIHx8IGRyYWdnYWJsZS5wb3NpdGlvbi5hYnNvbHV0ZSkubGVmdCwKCQl5MSA9IChkcmFnZ2FibGUucG9zaXRpb25BYnMgfHwgZHJhZ2dhYmxlLnBvc2l0aW9uLmFic29sdXRlKS50b3AsCgkJeDIgPSB4MSArIGRyYWdnYWJsZS5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCwKCQl5MiA9IHkxICsgZHJhZ2dhYmxlLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCwKCQlsID0gZHJvcHBhYmxlLm9mZnNldC5sZWZ0LAoJCXQgPSBkcm9wcGFibGUub2Zmc2V0LnRvcCwKCQlyID0gbCArIGRyb3BwYWJsZS5wcm9wb3J0aW9ucygpLndpZHRoLAoJCWIgPSB0ICsgZHJvcHBhYmxlLnByb3BvcnRpb25zKCkuaGVpZ2h0OwoKCXN3aXRjaCAodG9sZXJhbmNlTW9kZSkgewoJCWNhc2UgImZpdCI6CgkJCXJldHVybiAobCA8PSB4MSAmJiB4MiA8PSByICYmIHQgPD0geTEgJiYgeTIgPD0gYik7CgkJY2FzZSAiaW50ZXJzZWN0IjoKCQkJcmV0dXJuIChsIDwgeDEgKyAoZHJhZ2dhYmxlLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC8gMikgJiYgLy8gUmlnaHQgSGFsZgoJCQkJeDIgLSAoZHJhZ2dhYmxlLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC8gMikgPCByICYmIC8vIExlZnQgSGFsZgoJCQkJdCA8IHkxICsgKGRyYWdnYWJsZS5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQgLyAyKSAmJiAvLyBCb3R0b20gSGFsZgoJCQkJeTIgLSAoZHJhZ2dhYmxlLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAvIDIpIDwgYiApOyAvLyBUb3AgSGFsZgoJCWNhc2UgInBvaW50ZXIiOgoJCQlkcmFnZ2FibGVMZWZ0ID0gKChkcmFnZ2FibGUucG9zaXRpb25BYnMgfHwgZHJhZ2dhYmxlLnBvc2l0aW9uLmFic29sdXRlKS5sZWZ0ICsgKGRyYWdnYWJsZS5jbGlja09mZnNldCB8fCBkcmFnZ2FibGUub2Zmc2V0LmNsaWNrKS5sZWZ0KTsKCQkJZHJhZ2dhYmxlVG9wID0gKChkcmFnZ2FibGUucG9zaXRpb25BYnMgfHwgZHJhZ2dhYmxlLnBvc2l0aW9uLmFic29sdXRlKS50b3AgKyAoZHJhZ2dhYmxlLmNsaWNrT2Zmc2V0IHx8IGRyYWdnYWJsZS5vZmZzZXQuY2xpY2spLnRvcCk7CgkJCXJldHVybiBpc092ZXJBeGlzKCBkcmFnZ2FibGVUb3AsIHQsIGRyb3BwYWJsZS5wcm9wb3J0aW9ucygpLmhlaWdodCApICYmIGlzT3ZlckF4aXMoIGRyYWdnYWJsZUxlZnQsIGwsIGRyb3BwYWJsZS5wcm9wb3J0aW9ucygpLndpZHRoICk7CgkJY2FzZSAidG91Y2giOgoJCQlyZXR1cm4gKAoJCQkJKHkxID49IHQgJiYgeTEgPD0gYikgfHwJLy8gVG9wIGVkZ2UgdG91Y2hpbmcKCQkJCSh5MiA+PSB0ICYmIHkyIDw9IGIpIHx8CS8vIEJvdHRvbSBlZGdlIHRvdWNoaW5nCgkJCQkoeTEgPCB0ICYmIHkyID4gYikJCS8vIFN1cnJvdW5kZWQgdmVydGljYWxseQoJCQkpICYmICgKCQkJCSh4MSA+PSBsICYmIHgxIDw9IHIpIHx8CS8vIExlZnQgZWRnZSB0b3VjaGluZwoJCQkJKHgyID49IGwgJiYgeDIgPD0gcikgfHwJLy8gUmlnaHQgZWRnZSB0b3VjaGluZwoJCQkJKHgxIDwgbCAmJiB4MiA+IHIpCQkvLyBTdXJyb3VuZGVkIGhvcml6b250YWxseQoJCQkpOwoJCWRlZmF1bHQ6CgkJCXJldHVybiBmYWxzZTsKCQl9Cgp9OwoKLyoKCVRoaXMgbWFuYWdlciB0cmFja3Mgb2Zmc2V0cyBvZiBkcmFnZ2FibGVzIGFuZCBkcm9wcGFibGVzCiovCiQudWkuZGRtYW5hZ2VyID0gewoJY3VycmVudDogbnVsbCwKCWRyb3BwYWJsZXM6IHsgImRlZmF1bHQiOiBbXSB9LAoJcHJlcGFyZU9mZnNldHM6IGZ1bmN0aW9uKHQsIGV2ZW50KSB7CgoJCXZhciBpLCBqLAoJCQltID0gJC51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1t0Lm9wdGlvbnMuc2NvcGVdIHx8IFtdLAoJCQl0eXBlID0gZXZlbnQgPyBldmVudC50eXBlIDogbnVsbCwgLy8gd29ya2Fyb3VuZCBmb3IgIzIzMTcKCQkJbGlzdCA9ICh0LmN1cnJlbnRJdGVtIHx8IHQuZWxlbWVudCkuZmluZCgiOmRhdGEodWktZHJvcHBhYmxlKSIpLmFkZEJhY2soKTsKCgkJZHJvcHBhYmxlc0xvb3A6IGZvciAoaSA9IDA7IGkgPCBtLmxlbmd0aDsgaSsrKSB7CgoJCQkvL05vIGRpc2FibGVkIGFuZCBub24tYWNjZXB0ZWQKCQkJaWYobVtpXS5vcHRpb25zLmRpc2FibGVkIHx8ICh0ICYmICFtW2ldLmFjY2VwdC5jYWxsKG1baV0uZWxlbWVudFswXSwodC5jdXJyZW50SXRlbSB8fCB0LmVsZW1lbnQpKSkpIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQkvLyBGaWx0ZXIgb3V0IGVsZW1lbnRzIGluIHRoZSBjdXJyZW50IGRyYWdnZWQgaXRlbQoJCQlmb3IgKGo9MDsgaiA8IGxpc3QubGVuZ3RoOyBqKyspIHsKCQkJCWlmKGxpc3Rbal0gPT09IG1baV0uZWxlbWVudFswXSkgewoJCQkJCW1baV0ucHJvcG9ydGlvbnMoKS5oZWlnaHQgPSAwOwoJCQkJCWNvbnRpbnVlIGRyb3BwYWJsZXNMb29wOwoJCQkJfQoJCQl9CgoJCQltW2ldLnZpc2libGUgPSBtW2ldLmVsZW1lbnQuY3NzKCJkaXNwbGF5IikgIT09ICJub25lIjsKCQkJaWYoIW1baV0udmlzaWJsZSkgewoJCQkJY29udGludWU7CgkJCX0KCgkJCS8vQWN0aXZhdGUgdGhlIGRyb3BwYWJsZSBpZiB1c2VkIGRpcmVjdGx5IGZyb20gZHJhZ2dhYmxlcwoJCQlpZih0eXBlID09PSAibW91c2Vkb3duIikgewoJCQkJbVtpXS5fYWN0aXZhdGUuY2FsbChtW2ldLCBldmVudCk7CgkJCX0KCgkJCW1bIGkgXS5vZmZzZXQgPSBtWyBpIF0uZWxlbWVudC5vZmZzZXQoKTsKCQkJbVsgaSBdLnByb3BvcnRpb25zKHsgd2lkdGg6IG1bIGkgXS5lbGVtZW50WyAwIF0ub2Zmc2V0V2lkdGgsIGhlaWdodDogbVsgaSBdLmVsZW1lbnRbIDAgXS5vZmZzZXRIZWlnaHQgfSk7CgoJCX0KCgl9LAoJZHJvcDogZnVuY3Rpb24oZHJhZ2dhYmxlLCBldmVudCkgewoKCQl2YXIgZHJvcHBlZCA9IGZhbHNlOwoJCS8vIENyZWF0ZSBhIGNvcHkgb2YgdGhlIGRyb3BwYWJsZXMgaW4gY2FzZSB0aGUgbGlzdCBjaGFuZ2VzIGR1cmluZyB0aGUgZHJvcCAoIzkxMTYpCgkJJC5lYWNoKCgkLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2RyYWdnYWJsZS5vcHRpb25zLnNjb3BlXSB8fCBbXSkuc2xpY2UoKSwgZnVuY3Rpb24oKSB7CgoJCQlpZighdGhpcy5vcHRpb25zKSB7CgkJCQlyZXR1cm47CgkJCX0KCQkJaWYgKCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgdGhpcy52aXNpYmxlICYmICQudWkuaW50ZXJzZWN0KGRyYWdnYWJsZSwgdGhpcywgdGhpcy5vcHRpb25zLnRvbGVyYW5jZSkpIHsKCQkJCWRyb3BwZWQgPSB0aGlzLl9kcm9wLmNhbGwodGhpcywgZXZlbnQpIHx8IGRyb3BwZWQ7CgkJCX0KCgkJCWlmICghdGhpcy5vcHRpb25zLmRpc2FibGVkICYmIHRoaXMudmlzaWJsZSAmJiB0aGlzLmFjY2VwdC5jYWxsKHRoaXMuZWxlbWVudFswXSwoZHJhZ2dhYmxlLmN1cnJlbnRJdGVtIHx8IGRyYWdnYWJsZS5lbGVtZW50KSkpIHsKCQkJCXRoaXMuaXNvdXQgPSB0cnVlOwoJCQkJdGhpcy5pc292ZXIgPSBmYWxzZTsKCQkJCXRoaXMuX2RlYWN0aXZhdGUuY2FsbCh0aGlzLCBldmVudCk7CgkJCX0KCgkJfSk7CgkJcmV0dXJuIGRyb3BwZWQ7CgoJfSwKCWRyYWdTdGFydDogZnVuY3Rpb24oIGRyYWdnYWJsZSwgZXZlbnQgKSB7CgkJLy9MaXN0ZW4gZm9yIHNjcm9sbGluZyBzbyB0aGF0IGlmIHRoZSBkcmFnZ2luZyBjYXVzZXMgc2Nyb2xsaW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgZHJvcHBhYmxlcyBjYW4gYmUgcmVjYWxjdWxhdGVkIChzZWUgIzUwMDMpCgkJZHJhZ2dhYmxlLmVsZW1lbnQucGFyZW50c1VudGlsKCAiYm9keSIgKS5iaW5kKCAic2Nyb2xsLmRyb3BwYWJsZSIsIGZ1bmN0aW9uKCkgewoJCQlpZiggIWRyYWdnYWJsZS5vcHRpb25zLnJlZnJlc2hQb3NpdGlvbnMgKSB7CgkJCQkkLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyggZHJhZ2dhYmxlLCBldmVudCApOwoJCQl9CgkJfSk7Cgl9LAoJZHJhZzogZnVuY3Rpb24oZHJhZ2dhYmxlLCBldmVudCkgewoKCQkvL0lmIHlvdSBoYXZlIGEgaGlnaGx5IGR5bmFtaWMgcGFnZSwgeW91IG1pZ2h0IHRyeSB0aGlzIG9wdGlvbi4gSXQgcmVuZGVycyBwb3NpdGlvbnMgZXZlcnkgdGltZSB5b3UgbW92ZSB0aGUgbW91c2UuCgkJaWYoZHJhZ2dhYmxlLm9wdGlvbnMucmVmcmVzaFBvc2l0aW9ucykgewoJCQkkLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyhkcmFnZ2FibGUsIGV2ZW50KTsKCQl9CgoJCS8vUnVuIHRocm91Z2ggYWxsIGRyb3BwYWJsZXMgYW5kIGNoZWNrIHRoZWlyIHBvc2l0aW9ucyBiYXNlZCBvbiBzcGVjaWZpYyB0b2xlcmFuY2Ugb3B0aW9ucwoJCSQuZWFjaCgkLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2RyYWdnYWJsZS5vcHRpb25zLnNjb3BlXSB8fCBbXSwgZnVuY3Rpb24oKSB7CgoJCQlpZih0aGlzLm9wdGlvbnMuZGlzYWJsZWQgfHwgdGhpcy5ncmVlZHlDaGlsZCB8fCAhdGhpcy52aXNpYmxlKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCXZhciBwYXJlbnRJbnN0YW5jZSwgc2NvcGUsIHBhcmVudCwKCQkJCWludGVyc2VjdHMgPSAkLnVpLmludGVyc2VjdChkcmFnZ2FibGUsIHRoaXMsIHRoaXMub3B0aW9ucy50b2xlcmFuY2UpLAoJCQkJYyA9ICFpbnRlcnNlY3RzICYmIHRoaXMuaXNvdmVyID8gImlzb3V0IiA6IChpbnRlcnNlY3RzICYmICF0aGlzLmlzb3ZlciA/ICJpc292ZXIiIDogbnVsbCk7CgkJCWlmKCFjKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmICh0aGlzLm9wdGlvbnMuZ3JlZWR5KSB7CgkJCQkvLyBmaW5kIGRyb3BwYWJsZSBwYXJlbnRzIHdpdGggc2FtZSBzY29wZQoJCQkJc2NvcGUgPSB0aGlzLm9wdGlvbnMuc2NvcGU7CgkJCQlwYXJlbnQgPSB0aGlzLmVsZW1lbnQucGFyZW50cygiOmRhdGEodWktZHJvcHBhYmxlKSIpLmZpbHRlcihmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuICQuZGF0YSh0aGlzLCAidWktZHJvcHBhYmxlIikub3B0aW9ucy5zY29wZSA9PT0gc2NvcGU7CgkJCQl9KTsKCgkJCQlpZiAocGFyZW50Lmxlbmd0aCkgewoJCQkJCXBhcmVudEluc3RhbmNlID0gJC5kYXRhKHBhcmVudFswXSwgInVpLWRyb3BwYWJsZSIpOwoJCQkJCXBhcmVudEluc3RhbmNlLmdyZWVkeUNoaWxkID0gKGMgPT09ICJpc292ZXIiKTsKCQkJCX0KCQkJfQoKCQkJLy8gd2UganVzdCBtb3ZlZCBpbnRvIGEgZ3JlZWR5IGNoaWxkCgkJCWlmIChwYXJlbnRJbnN0YW5jZSAmJiBjID09PSAiaXNvdmVyIikgewoJCQkJcGFyZW50SW5zdGFuY2UuaXNvdmVyID0gZmFsc2U7CgkJCQlwYXJlbnRJbnN0YW5jZS5pc291dCA9IHRydWU7CgkJCQlwYXJlbnRJbnN0YW5jZS5fb3V0LmNhbGwocGFyZW50SW5zdGFuY2UsIGV2ZW50KTsKCQkJfQoKCQkJdGhpc1tjXSA9IHRydWU7CgkJCXRoaXNbYyA9PT0gImlzb3V0IiA/ICJpc292ZXIiIDogImlzb3V0Il0gPSBmYWxzZTsKCQkJdGhpc1tjID09PSAiaXNvdmVyIiA/ICJfb3ZlciIgOiAiX291dCJdLmNhbGwodGhpcywgZXZlbnQpOwoKCQkJLy8gd2UganVzdCBtb3ZlZCBvdXQgb2YgYSBncmVlZHkgY2hpbGQKCQkJaWYgKHBhcmVudEluc3RhbmNlICYmIGMgPT09ICJpc291dCIpIHsKCQkJCXBhcmVudEluc3RhbmNlLmlzb3V0ID0gZmFsc2U7CgkJCQlwYXJlbnRJbnN0YW5jZS5pc292ZXIgPSB0cnVlOwoJCQkJcGFyZW50SW5zdGFuY2UuX292ZXIuY2FsbChwYXJlbnRJbnN0YW5jZSwgZXZlbnQpOwoJCQl9CgkJfSk7CgoJfSwKCWRyYWdTdG9wOiBmdW5jdGlvbiggZHJhZ2dhYmxlLCBldmVudCApIHsKCQlkcmFnZ2FibGUuZWxlbWVudC5wYXJlbnRzVW50aWwoICJib2R5IiApLnVuYmluZCggInNjcm9sbC5kcm9wcGFibGUiICk7CgkJLy9DYWxsIHByZXBhcmVPZmZzZXRzIG9uZSBmaW5hbCB0aW1lIHNpbmNlIElFIGRvZXMgbm90IGZpcmUgcmV0dXJuIHNjcm9sbCBldmVudHMgd2hlbiBvdmVyZmxvdyB3YXMgY2F1c2VkIGJ5IGRyYWcgKHNlZSAjNTAwMykKCQlpZiggIWRyYWdnYWJsZS5vcHRpb25zLnJlZnJlc2hQb3NpdGlvbnMgKSB7CgkJCSQudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKCBkcmFnZ2FibGUsIGV2ZW50ICk7CgkJfQoJfQp9OwoKfSkoalF1ZXJ5KTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKZnVuY3Rpb24gbnVtKHYpIHsKCXJldHVybiBwYXJzZUludCh2LCAxMCkgfHwgMDsKfQoKZnVuY3Rpb24gaXNOdW1iZXIodmFsdWUpIHsKCXJldHVybiAhaXNOYU4ocGFyc2VJbnQodmFsdWUsIDEwKSk7Cn0KCiQud2lkZ2V0KCJ1aS5yZXNpemFibGUiLCAkLnVpLm1vdXNlLCB7Cgl2ZXJzaW9uOiAiMS4xMC40IiwKCXdpZGdldEV2ZW50UHJlZml4OiAicmVzaXplIiwKCW9wdGlvbnM6IHsKCQlhbHNvUmVzaXplOiBmYWxzZSwKCQlhbmltYXRlOiBmYWxzZSwKCQlhbmltYXRlRHVyYXRpb246ICJzbG93IiwKCQlhbmltYXRlRWFzaW5nOiAic3dpbmciLAoJCWFzcGVjdFJhdGlvOiBmYWxzZSwKCQlhdXRvSGlkZTogZmFsc2UsCgkJY29udGFpbm1lbnQ6IGZhbHNlLAoJCWdob3N0OiBmYWxzZSwKCQlncmlkOiBmYWxzZSwKCQloYW5kbGVzOiAiZSxzLHNlIiwKCQloZWxwZXI6IGZhbHNlLAoJCW1heEhlaWdodDogbnVsbCwKCQltYXhXaWR0aDogbnVsbCwKCQltaW5IZWlnaHQ6IDEwLAoJCW1pbldpZHRoOiAxMCwKCQkvLyBTZWUgIzc5NjAKCQl6SW5kZXg6IDkwLAoKCQkvLyBjYWxsYmFja3MKCQlyZXNpemU6IG51bGwsCgkJc3RhcnQ6IG51bGwsCgkJc3RvcDogbnVsbAoJfSwKCV9jcmVhdGU6IGZ1bmN0aW9uKCkgewoKCQl2YXIgbiwgaSwgaGFuZGxlLCBheGlzLCBobmFtZSwKCQkJdGhhdCA9IHRoaXMsCgkJCW8gPSB0aGlzLm9wdGlvbnM7CgkJdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1yZXNpemFibGUiKTsKCgkJJC5leHRlbmQodGhpcywgewoJCQlfYXNwZWN0UmF0aW86ICEhKG8uYXNwZWN0UmF0aW8pLAoJCQlhc3BlY3RSYXRpbzogby5hc3BlY3RSYXRpbywKCQkJb3JpZ2luYWxFbGVtZW50OiB0aGlzLmVsZW1lbnQsCgkJCV9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzOiBbXSwKCQkJX2hlbHBlcjogby5oZWxwZXIgfHwgby5naG9zdCB8fCBvLmFuaW1hdGUgPyBvLmhlbHBlciB8fCAidWktcmVzaXphYmxlLWhlbHBlciIgOiBudWxsCgkJfSk7CgoJCS8vV3JhcCB0aGUgZWxlbWVudCBpZiBpdCBjYW5ub3QgaG9sZCBjaGlsZCBub2RlcwoJCWlmKHRoaXMuZWxlbWVudFswXS5ub2RlTmFtZS5tYXRjaCgvY2FudmFzfHRleHRhcmVhfGlucHV0fHNlbGVjdHxidXR0b258aW1nL2kpKSB7CgoJCQkvL0NyZWF0ZSBhIHdyYXBwZXIgZWxlbWVudCBhbmQgc2V0IHRoZSB3cmFwcGVyIHRvIHRoZSBuZXcgY3VycmVudCBpbnRlcm5hbCBlbGVtZW50CgkJCXRoaXMuZWxlbWVudC53cmFwKAoJCQkJJCgiPGRpdiBjbGFzcz0ndWktd3JhcHBlcicgc3R5bGU9J292ZXJmbG93OiBoaWRkZW47Jz48L2Rpdj4iKS5jc3MoewoJCQkJCXBvc2l0aW9uOiB0aGlzLmVsZW1lbnQuY3NzKCJwb3NpdGlvbiIpLAoJCQkJCXdpZHRoOiB0aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpLAoJCQkJCWhlaWdodDogdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCksCgkJCQkJdG9wOiB0aGlzLmVsZW1lbnQuY3NzKCJ0b3AiKSwKCQkJCQlsZWZ0OiB0aGlzLmVsZW1lbnQuY3NzKCJsZWZ0IikKCQkJCX0pCgkJCSk7CgoJCQkvL092ZXJ3cml0ZSB0aGUgb3JpZ2luYWwgdGhpcy5lbGVtZW50CgkJCXRoaXMuZWxlbWVudCA9IHRoaXMuZWxlbWVudC5wYXJlbnQoKS5kYXRhKAoJCQkJInVpLXJlc2l6YWJsZSIsIHRoaXMuZWxlbWVudC5kYXRhKCJ1aS1yZXNpemFibGUiKQoJCQkpOwoKCQkJdGhpcy5lbGVtZW50SXNXcmFwcGVyID0gdHJ1ZTsKCgkJCS8vTW92ZSBtYXJnaW5zIHRvIHRoZSB3cmFwcGVyCgkJCXRoaXMuZWxlbWVudC5jc3MoeyBtYXJnaW5MZWZ0OiB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoIm1hcmdpbkxlZnQiKSwgbWFyZ2luVG9wOiB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoIm1hcmdpblRvcCIpLCBtYXJnaW5SaWdodDogdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJtYXJnaW5SaWdodCIpLCBtYXJnaW5Cb3R0b206IHRoaXMub3JpZ2luYWxFbGVtZW50LmNzcygibWFyZ2luQm90dG9tIikgfSk7CgkJCXRoaXMub3JpZ2luYWxFbGVtZW50LmNzcyh7IG1hcmdpbkxlZnQ6IDAsIG1hcmdpblRvcDogMCwgbWFyZ2luUmlnaHQ6IDAsIG1hcmdpbkJvdHRvbTogMH0pOwoKCQkJLy9QcmV2ZW50IFNhZmFyaSB0ZXh0YXJlYSByZXNpemUKCQkJdGhpcy5vcmlnaW5hbFJlc2l6ZVN0eWxlID0gdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJyZXNpemUiKTsKCQkJdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJyZXNpemUiLCAibm9uZSIpOwoKCQkJLy9QdXNoIHRoZSBhY3R1YWwgZWxlbWVudCB0byBvdXIgcHJvcG9ydGlvbmFsbHlSZXNpemUgaW50ZXJuYWwgYXJyYXkKCQkJdGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cy5wdXNoKHRoaXMub3JpZ2luYWxFbGVtZW50LmNzcyh7IHBvc2l0aW9uOiAic3RhdGljIiwgem9vbTogMSwgZGlzcGxheTogImJsb2NrIiB9KSk7CgoJCQkvLyBhdm9pZCBJRSBqdW1wIChoYXJkIHNldCB0aGUgbWFyZ2luKQoJCQl0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoeyBtYXJnaW46IHRoaXMub3JpZ2luYWxFbGVtZW50LmNzcygibWFyZ2luIikgfSk7CgoJCQkvLyBmaXggaGFuZGxlcnMgb2Zmc2V0CgkJCXRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCk7CgoJCX0KCgkJdGhpcy5oYW5kbGVzID0gby5oYW5kbGVzIHx8ICghJCgiLnVpLXJlc2l6YWJsZS1oYW5kbGUiLCB0aGlzLmVsZW1lbnQpLmxlbmd0aCA/ICJlLHMsc2UiIDogeyBuOiAiLnVpLXJlc2l6YWJsZS1uIiwgZTogIi51aS1yZXNpemFibGUtZSIsIHM6ICIudWktcmVzaXphYmxlLXMiLCB3OiAiLnVpLXJlc2l6YWJsZS13Iiwgc2U6ICIudWktcmVzaXphYmxlLXNlIiwgc3c6ICIudWktcmVzaXphYmxlLXN3IiwgbmU6ICIudWktcmVzaXphYmxlLW5lIiwgbnc6ICIudWktcmVzaXphYmxlLW53IiB9KTsKCQlpZih0aGlzLmhhbmRsZXMuY29uc3RydWN0b3IgPT09IFN0cmluZykgewoKCQkJaWYgKCB0aGlzLmhhbmRsZXMgPT09ICJhbGwiKSB7CgkJCQl0aGlzLmhhbmRsZXMgPSAibixlLHMsdyxzZSxzdyxuZSxudyI7CgkJCX0KCgkJCW4gPSB0aGlzLmhhbmRsZXMuc3BsaXQoIiwiKTsKCQkJdGhpcy5oYW5kbGVzID0ge307CgoJCQlmb3IoaSA9IDA7IGkgPCBuLmxlbmd0aDsgaSsrKSB7CgoJCQkJaGFuZGxlID0gJC50cmltKG5baV0pOwoJCQkJaG5hbWUgPSAidWktcmVzaXphYmxlLSIraGFuZGxlOwoJCQkJYXhpcyA9ICQoIjxkaXYgY2xhc3M9J3VpLXJlc2l6YWJsZS1oYW5kbGUgIiArIGhuYW1lICsgIic+PC9kaXY+Iik7CgoJCQkJLy8gQXBwbHkgekluZGV4IHRvIGFsbCBoYW5kbGVzIC0gc2VlICM3OTYwCgkJCQlheGlzLmNzcyh7IHpJbmRleDogby56SW5kZXggfSk7CgoJCQkJLy9UT0RPIDogV2hhdCdzIGdvaW5nIG9uIGhlcmU/CgkJCQlpZiAoInNlIiA9PT0gaGFuZGxlKSB7CgkJCQkJYXhpcy5hZGRDbGFzcygidWktaWNvbiB1aS1pY29uLWdyaXBzbWFsbC1kaWFnb25hbC1zZSIpOwoJCQkJfQoKCQkJCS8vSW5zZXJ0IGludG8gaW50ZXJuYWwgaGFuZGxlcyBvYmplY3QgYW5kIGFwcGVuZCB0byBlbGVtZW50CgkJCQl0aGlzLmhhbmRsZXNbaGFuZGxlXSA9ICIudWktcmVzaXphYmxlLSIraGFuZGxlOwoJCQkJdGhpcy5lbGVtZW50LmFwcGVuZChheGlzKTsKCQkJfQoKCQl9CgoJCXRoaXMuX3JlbmRlckF4aXMgPSBmdW5jdGlvbih0YXJnZXQpIHsKCgkJCXZhciBpLCBheGlzLCBwYWRQb3MsIHBhZFdyYXBwZXI7CgoJCQl0YXJnZXQgPSB0YXJnZXQgfHwgdGhpcy5lbGVtZW50OwoKCQkJZm9yKGkgaW4gdGhpcy5oYW5kbGVzKSB7CgoJCQkJaWYodGhpcy5oYW5kbGVzW2ldLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHsKCQkJCQl0aGlzLmhhbmRsZXNbaV0gPSAkKHRoaXMuaGFuZGxlc1tpXSwgdGhpcy5lbGVtZW50KS5zaG93KCk7CgkJCQl9CgoJCQkJLy9BcHBseSBwYWQgdG8gd3JhcHBlciBlbGVtZW50LCBuZWVkZWQgdG8gZml4IGF4aXMgcG9zaXRpb24gKHRleHRhcmVhLCBpbnB1dHMsIHNjcm9sbHMpCgkJCQlpZiAodGhpcy5lbGVtZW50SXNXcmFwcGVyICYmIHRoaXMub3JpZ2luYWxFbGVtZW50WzBdLm5vZGVOYW1lLm1hdGNoKC90ZXh0YXJlYXxpbnB1dHxzZWxlY3R8YnV0dG9uL2kpKSB7CgoJCQkJCWF4aXMgPSAkKHRoaXMuaGFuZGxlc1tpXSwgdGhpcy5lbGVtZW50KTsKCgkJCQkJLy9DaGVja2luZyB0aGUgY29ycmVjdCBwYWQgYW5kIGJvcmRlcgoJCQkJCXBhZFdyYXBwZXIgPSAvc3d8bmV8bnd8c2V8bnxzLy50ZXN0KGkpID8gYXhpcy5vdXRlckhlaWdodCgpIDogYXhpcy5vdXRlcldpZHRoKCk7CgoJCQkJCS8vVGhlIHBhZGRpbmcgdHlwZSBpIGhhdmUgdG8gYXBwbHkuLi4KCQkJCQlwYWRQb3MgPSBbICJwYWRkaW5nIiwKCQkJCQkJL25lfG53fG4vLnRlc3QoaSkgPyAiVG9wIiA6CgkJCQkJCS9zZXxzd3xzLy50ZXN0KGkpID8gIkJvdHRvbSIgOgoJCQkJCQkvXmUkLy50ZXN0KGkpID8gIlJpZ2h0IiA6ICJMZWZ0IiBdLmpvaW4oIiIpOwoKCQkJCQl0YXJnZXQuY3NzKHBhZFBvcywgcGFkV3JhcHBlcik7CgoJCQkJCXRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCk7CgoJCQkJfQoKCQkJCS8vVE9ETzogV2hhdCdzIHRoYXQgZ29vZCBmb3I/IFRoZXJlJ3Mgbm90IGFueXRoaW5nIHRvIGJlIGV4ZWN1dGVkIGxlZnQKCQkJCWlmKCEkKHRoaXMuaGFuZGxlc1tpXSkubGVuZ3RoKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgkJCX0KCQl9OwoKCQkvL1RPRE86IG1ha2UgcmVuZGVyQXhpcyBhIHByb3RvdHlwZSBmdW5jdGlvbgoJCXRoaXMuX3JlbmRlckF4aXModGhpcy5lbGVtZW50KTsKCgkJdGhpcy5faGFuZGxlcyA9ICQoIi51aS1yZXNpemFibGUtaGFuZGxlIiwgdGhpcy5lbGVtZW50KQoJCQkuZGlzYWJsZVNlbGVjdGlvbigpOwoKCQkvL01hdGNoaW5nIGF4aXMgbmFtZQoJCXRoaXMuX2hhbmRsZXMubW91c2VvdmVyKGZ1bmN0aW9uKCkgewoJCQlpZiAoIXRoYXQucmVzaXppbmcpIHsKCQkJCWlmICh0aGlzLmNsYXNzTmFtZSkgewoJCQkJCWF4aXMgPSB0aGlzLmNsYXNzTmFtZS5tYXRjaCgvdWktcmVzaXphYmxlLShzZXxzd3xuZXxud3xufGV8c3x3KS9pKTsKCQkJCX0KCQkJCS8vQXhpcywgZGVmYXVsdCA9IHNlCgkJCQl0aGF0LmF4aXMgPSBheGlzICYmIGF4aXNbMV0gPyBheGlzWzFdIDogInNlIjsKCQkJfQoJCX0pOwoKCQkvL0lmIHdlIHdhbnQgdG8gYXV0byBoaWRlIHRoZSBlbGVtZW50cwoJCWlmIChvLmF1dG9IaWRlKSB7CgkJCXRoaXMuX2hhbmRsZXMuaGlkZSgpOwoJCQkkKHRoaXMuZWxlbWVudCkKCQkJCS5hZGRDbGFzcygidWktcmVzaXphYmxlLWF1dG9oaWRlIikKCQkJCS5tb3VzZWVudGVyKGZ1bmN0aW9uKCkgewoJCQkJCWlmIChvLmRpc2FibGVkKSB7CgkJCQkJCXJldHVybjsKCQkJCQl9CgkJCQkJJCh0aGlzKS5yZW1vdmVDbGFzcygidWktcmVzaXphYmxlLWF1dG9oaWRlIik7CgkJCQkJdGhhdC5faGFuZGxlcy5zaG93KCk7CgkJCQl9KQoJCQkJLm1vdXNlbGVhdmUoZnVuY3Rpb24oKXsKCQkJCQlpZiAoby5kaXNhYmxlZCkgewoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJCWlmICghdGhhdC5yZXNpemluZykgewoJCQkJCQkkKHRoaXMpLmFkZENsYXNzKCJ1aS1yZXNpemFibGUtYXV0b2hpZGUiKTsKCQkJCQkJdGhhdC5faGFuZGxlcy5oaWRlKCk7CgkJCQkJfQoJCQkJfSk7CgkJfQoKCQkvL0luaXRpYWxpemUgdGhlIG1vdXNlIGludGVyYWN0aW9uCgkJdGhpcy5fbW91c2VJbml0KCk7CgoJfSwKCglfZGVzdHJveTogZnVuY3Rpb24oKSB7CgoJCXRoaXMuX21vdXNlRGVzdHJveSgpOwoKCQl2YXIgd3JhcHBlciwKCQkJX2Rlc3Ryb3kgPSBmdW5jdGlvbihleHApIHsKCQkJCSQoZXhwKS5yZW1vdmVDbGFzcygidWktcmVzaXphYmxlIHVpLXJlc2l6YWJsZS1kaXNhYmxlZCB1aS1yZXNpemFibGUtcmVzaXppbmciKQoJCQkJCS5yZW1vdmVEYXRhKCJyZXNpemFibGUiKS5yZW1vdmVEYXRhKCJ1aS1yZXNpemFibGUiKS51bmJpbmQoIi5yZXNpemFibGUiKS5maW5kKCIudWktcmVzaXphYmxlLWhhbmRsZSIpLnJlbW92ZSgpOwoJCQl9OwoKCQkvL1RPRE86IFVud3JhcCBhdCBzYW1lIERPTSBwb3NpdGlvbgoJCWlmICh0aGlzLmVsZW1lbnRJc1dyYXBwZXIpIHsKCQkJX2Rlc3Ryb3kodGhpcy5lbGVtZW50KTsKCQkJd3JhcHBlciA9IHRoaXMuZWxlbWVudDsKCQkJdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKHsKCQkJCXBvc2l0aW9uOiB3cmFwcGVyLmNzcygicG9zaXRpb24iKSwKCQkJCXdpZHRoOiB3cmFwcGVyLm91dGVyV2lkdGgoKSwKCQkJCWhlaWdodDogd3JhcHBlci5vdXRlckhlaWdodCgpLAoJCQkJdG9wOiB3cmFwcGVyLmNzcygidG9wIiksCgkJCQlsZWZ0OiB3cmFwcGVyLmNzcygibGVmdCIpCgkJCX0pLmluc2VydEFmdGVyKCB3cmFwcGVyICk7CgkJCXdyYXBwZXIucmVtb3ZlKCk7CgkJfQoKCQl0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoInJlc2l6ZSIsIHRoaXMub3JpZ2luYWxSZXNpemVTdHlsZSk7CgkJX2Rlc3Ryb3kodGhpcy5vcmlnaW5hbEVsZW1lbnQpOwoKCQlyZXR1cm4gdGhpczsKCX0sCgoJX21vdXNlQ2FwdHVyZTogZnVuY3Rpb24oZXZlbnQpIHsKCQl2YXIgaSwgaGFuZGxlLAoJCQljYXB0dXJlID0gZmFsc2U7CgoJCWZvciAoaSBpbiB0aGlzLmhhbmRsZXMpIHsKCQkJaGFuZGxlID0gJCh0aGlzLmhhbmRsZXNbaV0pWzBdOwoJCQlpZiAoaGFuZGxlID09PSBldmVudC50YXJnZXQgfHwgJC5jb250YWlucyhoYW5kbGUsIGV2ZW50LnRhcmdldCkpIHsKCQkJCWNhcHR1cmUgPSB0cnVlOwoJCQl9CgkJfQoKCQlyZXR1cm4gIXRoaXMub3B0aW9ucy5kaXNhYmxlZCAmJiBjYXB0dXJlOwoJfSwKCglfbW91c2VTdGFydDogZnVuY3Rpb24oZXZlbnQpIHsKCgkJdmFyIGN1cmxlZnQsIGN1cnRvcCwgY3Vyc29yLAoJCQlvID0gdGhpcy5vcHRpb25zLAoJCQlpbmlQb3MgPSB0aGlzLmVsZW1lbnQucG9zaXRpb24oKSwKCQkJZWwgPSB0aGlzLmVsZW1lbnQ7CgoJCXRoaXMucmVzaXppbmcgPSB0cnVlOwoKCQkvLyBidWdmaXggZm9yIGh0dHA6Ly9kZXYuanF1ZXJ5LmNvbS90aWNrZXQvMTc0OQoJCWlmICggKC9hYnNvbHV0ZS8pLnRlc3QoIGVsLmNzcygicG9zaXRpb24iKSApICkgewoJCQllbC5jc3MoeyBwb3NpdGlvbjogImFic29sdXRlIiwgdG9wOiBlbC5jc3MoInRvcCIpLCBsZWZ0OiBlbC5jc3MoImxlZnQiKSB9KTsKCQl9IGVsc2UgaWYgKGVsLmlzKCIudWktZHJhZ2dhYmxlIikpIHsKCQkJZWwuY3NzKHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIHRvcDogaW5pUG9zLnRvcCwgbGVmdDogaW5pUG9zLmxlZnQgfSk7CgkJfQoKCQl0aGlzLl9yZW5kZXJQcm94eSgpOwoKCQljdXJsZWZ0ID0gbnVtKHRoaXMuaGVscGVyLmNzcygibGVmdCIpKTsKCQljdXJ0b3AgPSBudW0odGhpcy5oZWxwZXIuY3NzKCJ0b3AiKSk7CgoJCWlmIChvLmNvbnRhaW5tZW50KSB7CgkJCWN1cmxlZnQgKz0gJChvLmNvbnRhaW5tZW50KS5zY3JvbGxMZWZ0KCkgfHwgMDsKCQkJY3VydG9wICs9ICQoby5jb250YWlubWVudCkuc2Nyb2xsVG9wKCkgfHwgMDsKCQl9CgoJCS8vU3RvcmUgbmVlZGVkIHZhcmlhYmxlcwoJCXRoaXMub2Zmc2V0ID0gdGhpcy5oZWxwZXIub2Zmc2V0KCk7CgkJdGhpcy5wb3NpdGlvbiA9IHsgbGVmdDogY3VybGVmdCwgdG9wOiBjdXJ0b3AgfTsKCQl0aGlzLnNpemUgPSB0aGlzLl9oZWxwZXIgPyB7IHdpZHRoOiB0aGlzLmhlbHBlci53aWR0aCgpLCBoZWlnaHQ6IHRoaXMuaGVscGVyLmhlaWdodCgpIH0gOiB7IHdpZHRoOiBlbC53aWR0aCgpLCBoZWlnaHQ6IGVsLmhlaWdodCgpIH07CgkJdGhpcy5vcmlnaW5hbFNpemUgPSB0aGlzLl9oZWxwZXIgPyB7IHdpZHRoOiBlbC5vdXRlcldpZHRoKCksIGhlaWdodDogZWwub3V0ZXJIZWlnaHQoKSB9IDogeyB3aWR0aDogZWwud2lkdGgoKSwgaGVpZ2h0OiBlbC5oZWlnaHQoKSB9OwoJCXRoaXMub3JpZ2luYWxQb3NpdGlvbiA9IHsgbGVmdDogY3VybGVmdCwgdG9wOiBjdXJ0b3AgfTsKCQl0aGlzLnNpemVEaWZmID0geyB3aWR0aDogZWwub3V0ZXJXaWR0aCgpIC0gZWwud2lkdGgoKSwgaGVpZ2h0OiBlbC5vdXRlckhlaWdodCgpIC0gZWwuaGVpZ2h0KCkgfTsKCQl0aGlzLm9yaWdpbmFsTW91c2VQb3NpdGlvbiA9IHsgbGVmdDogZXZlbnQucGFnZVgsIHRvcDogZXZlbnQucGFnZVkgfTsKCgkJLy9Bc3BlY3QgUmF0aW8KCQl0aGlzLmFzcGVjdFJhdGlvID0gKHR5cGVvZiBvLmFzcGVjdFJhdGlvID09PSAibnVtYmVyIikgPyBvLmFzcGVjdFJhdGlvIDogKCh0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aCAvIHRoaXMub3JpZ2luYWxTaXplLmhlaWdodCkgfHwgMSk7CgoJCWN1cnNvciA9ICQoIi51aS1yZXNpemFibGUtIiArIHRoaXMuYXhpcykuY3NzKCJjdXJzb3IiKTsKCQkkKCJib2R5IikuY3NzKCJjdXJzb3IiLCBjdXJzb3IgPT09ICJhdXRvIiA/IHRoaXMuYXhpcyArICItcmVzaXplIiA6IGN1cnNvcik7CgoJCWVsLmFkZENsYXNzKCJ1aS1yZXNpemFibGUtcmVzaXppbmciKTsKCQl0aGlzLl9wcm9wYWdhdGUoInN0YXJ0IiwgZXZlbnQpOwoJCXJldHVybiB0cnVlOwoJfSwKCglfbW91c2VEcmFnOiBmdW5jdGlvbihldmVudCkgewoKCQkvL0luY3JlYXNlIHBlcmZvcm1hbmNlLCBhdm9pZCByZWdleAoJCXZhciBkYXRhLAoJCQllbCA9IHRoaXMuaGVscGVyLCBwcm9wcyA9IHt9LAoJCQlzbXAgPSB0aGlzLm9yaWdpbmFsTW91c2VQb3NpdGlvbiwKCQkJYSA9IHRoaXMuYXhpcywKCQkJcHJldlRvcCA9IHRoaXMucG9zaXRpb24udG9wLAoJCQlwcmV2TGVmdCA9IHRoaXMucG9zaXRpb24ubGVmdCwKCQkJcHJldldpZHRoID0gdGhpcy5zaXplLndpZHRoLAoJCQlwcmV2SGVpZ2h0ID0gdGhpcy5zaXplLmhlaWdodCwKCQkJZHggPSAoZXZlbnQucGFnZVgtc21wLmxlZnQpfHwwLAoJCQlkeSA9IChldmVudC5wYWdlWS1zbXAudG9wKXx8MCwKCQkJdHJpZ2dlciA9IHRoaXMuX2NoYW5nZVthXTsKCgkJaWYgKCF0cmlnZ2VyKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCS8vIENhbGN1bGF0ZSB0aGUgYXR0cnMgdGhhdCB3aWxsIGJlIGNoYW5nZQoJCWRhdGEgPSB0cmlnZ2VyLmFwcGx5KHRoaXMsIFtldmVudCwgZHgsIGR5XSk7CgoJCS8vIFB1dCB0aGlzIGluIHRoZSBtb3VzZURyYWcgaGFuZGxlciBzaW5jZSB0aGUgdXNlciBjYW4gc3RhcnQgcHJlc3Npbmcgc2hpZnQgd2hpbGUgcmVzaXppbmcKCQl0aGlzLl91cGRhdGVWaXJ0dWFsQm91bmRhcmllcyhldmVudC5zaGlmdEtleSk7CgkJaWYgKHRoaXMuX2FzcGVjdFJhdGlvIHx8IGV2ZW50LnNoaWZ0S2V5KSB7CgkJCWRhdGEgPSB0aGlzLl91cGRhdGVSYXRpbyhkYXRhLCBldmVudCk7CgkJfQoKCQlkYXRhID0gdGhpcy5fcmVzcGVjdFNpemUoZGF0YSwgZXZlbnQpOwoKCQl0aGlzLl91cGRhdGVDYWNoZShkYXRhKTsKCgkJLy8gcGx1Z2lucyBjYWxsYmFja3MgbmVlZCB0byBiZSBjYWxsZWQgZmlyc3QKCQl0aGlzLl9wcm9wYWdhdGUoInJlc2l6ZSIsIGV2ZW50KTsKCgkJaWYgKHRoaXMucG9zaXRpb24udG9wICE9PSBwcmV2VG9wKSB7CgkJCXByb3BzLnRvcCA9IHRoaXMucG9zaXRpb24udG9wICsgInB4IjsKCQl9CgkJaWYgKHRoaXMucG9zaXRpb24ubGVmdCAhPT0gcHJldkxlZnQpIHsKCQkJcHJvcHMubGVmdCA9IHRoaXMucG9zaXRpb24ubGVmdCArICJweCI7CgkJfQoJCWlmICh0aGlzLnNpemUud2lkdGggIT09IHByZXZXaWR0aCkgewoJCQlwcm9wcy53aWR0aCA9IHRoaXMuc2l6ZS53aWR0aCArICJweCI7CgkJfQoJCWlmICh0aGlzLnNpemUuaGVpZ2h0ICE9PSBwcmV2SGVpZ2h0KSB7CgkJCXByb3BzLmhlaWdodCA9IHRoaXMuc2l6ZS5oZWlnaHQgKyAicHgiOwoJCX0KCQllbC5jc3MocHJvcHMpOwoKCQlpZiAoIXRoaXMuX2hlbHBlciAmJiB0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLmxlbmd0aCkgewoJCQl0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpOwoJCX0KCgkJLy8gQ2FsbCB0aGUgdXNlciBjYWxsYmFjayBpZiB0aGUgZWxlbWVudCB3YXMgcmVzaXplZAoJCWlmICggISAkLmlzRW1wdHlPYmplY3QocHJvcHMpICkgewoJCQl0aGlzLl90cmlnZ2VyKCJyZXNpemUiLCBldmVudCwgdGhpcy51aSgpKTsKCQl9CgoJCXJldHVybiBmYWxzZTsKCX0sCgoJX21vdXNlU3RvcDogZnVuY3Rpb24oZXZlbnQpIHsKCgkJdGhpcy5yZXNpemluZyA9IGZhbHNlOwoJCXZhciBwciwgaXN0YSwgc29mZnNldGgsIHNvZmZzZXR3LCBzLCBsZWZ0LCB0b3AsCgkJCW8gPSB0aGlzLm9wdGlvbnMsIHRoYXQgPSB0aGlzOwoKCQlpZih0aGlzLl9oZWxwZXIpIHsKCgkJCXByID0gdGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50czsKCQkJaXN0YSA9IHByLmxlbmd0aCAmJiAoL3RleHRhcmVhL2kpLnRlc3QocHJbMF0ubm9kZU5hbWUpOwoJCQlzb2Zmc2V0aCA9IGlzdGEgJiYgJC51aS5oYXNTY3JvbGwocHJbMF0sICJsZWZ0IikgLyogVE9ETyAtIGp1bXAgaGVpZ2h0ICovID8gMCA6IHRoYXQuc2l6ZURpZmYuaGVpZ2h0OwoJCQlzb2Zmc2V0dyA9IGlzdGEgPyAwIDogdGhhdC5zaXplRGlmZi53aWR0aDsKCgkJCXMgPSB7IHdpZHRoOiAodGhhdC5oZWxwZXIud2lkdGgoKSAgLSBzb2Zmc2V0dyksIGhlaWdodDogKHRoYXQuaGVscGVyLmhlaWdodCgpIC0gc29mZnNldGgpIH07CgkJCWxlZnQgPSAocGFyc2VJbnQodGhhdC5lbGVtZW50LmNzcygibGVmdCIpLCAxMCkgKyAodGhhdC5wb3NpdGlvbi5sZWZ0IC0gdGhhdC5vcmlnaW5hbFBvc2l0aW9uLmxlZnQpKSB8fCBudWxsOwoJCQl0b3AgPSAocGFyc2VJbnQodGhhdC5lbGVtZW50LmNzcygidG9wIiksIDEwKSArICh0aGF0LnBvc2l0aW9uLnRvcCAtIHRoYXQub3JpZ2luYWxQb3NpdGlvbi50b3ApKSB8fCBudWxsOwoKCQkJaWYgKCFvLmFuaW1hdGUpIHsKCQkJCXRoaXMuZWxlbWVudC5jc3MoJC5leHRlbmQocywgeyB0b3A6IHRvcCwgbGVmdDogbGVmdCB9KSk7CgkJCX0KCgkJCXRoYXQuaGVscGVyLmhlaWdodCh0aGF0LnNpemUuaGVpZ2h0KTsKCQkJdGhhdC5oZWxwZXIud2lkdGgodGhhdC5zaXplLndpZHRoKTsKCgkJCWlmICh0aGlzLl9oZWxwZXIgJiYgIW8uYW5pbWF0ZSkgewoJCQkJdGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemUoKTsKCQkJfQoJCX0KCgkJJCgiYm9keSIpLmNzcygiY3Vyc29yIiwgImF1dG8iKTsKCgkJdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1yZXNpemFibGUtcmVzaXppbmciKTsKCgkJdGhpcy5fcHJvcGFnYXRlKCJzdG9wIiwgZXZlbnQpOwoKCQlpZiAodGhpcy5faGVscGVyKSB7CgkJCXRoaXMuaGVscGVyLnJlbW92ZSgpOwoJCX0KCgkJcmV0dXJuIGZhbHNlOwoKCX0sCgoJX3VwZGF0ZVZpcnR1YWxCb3VuZGFyaWVzOiBmdW5jdGlvbihmb3JjZUFzcGVjdFJhdGlvKSB7CgkJdmFyIHBNaW5XaWR0aCwgcE1heFdpZHRoLCBwTWluSGVpZ2h0LCBwTWF4SGVpZ2h0LCBiLAoJCQlvID0gdGhpcy5vcHRpb25zOwoKCQliID0gewoJCQltaW5XaWR0aDogaXNOdW1iZXIoby5taW5XaWR0aCkgPyBvLm1pbldpZHRoIDogMCwKCQkJbWF4V2lkdGg6IGlzTnVtYmVyKG8ubWF4V2lkdGgpID8gby5tYXhXaWR0aCA6IEluZmluaXR5LAoJCQltaW5IZWlnaHQ6IGlzTnVtYmVyKG8ubWluSGVpZ2h0KSA/IG8ubWluSGVpZ2h0IDogMCwKCQkJbWF4SGVpZ2h0OiBpc051bWJlcihvLm1heEhlaWdodCkgPyBvLm1heEhlaWdodCA6IEluZmluaXR5CgkJfTsKCgkJaWYodGhpcy5fYXNwZWN0UmF0aW8gfHwgZm9yY2VBc3BlY3RSYXRpbykgewoJCQkvLyBXZSB3YW50IHRvIGNyZWF0ZSBhbiBlbmNsb3NpbmcgYm94IHdob3NlIGFzcGVjdCByYXRpb24gaXMgdGhlIHJlcXVlc3RlZCBvbmUKCQkJLy8gRmlyc3QsIGNvbXB1dGUgdGhlICJwcm9qZWN0ZWQiIHNpemUgZm9yIGVhY2ggZGltZW5zaW9uIGJhc2VkIG9uIHRoZSBhc3BlY3QgcmF0aW8gYW5kIG90aGVyIGRpbWVuc2lvbgoJCQlwTWluV2lkdGggPSBiLm1pbkhlaWdodCAqIHRoaXMuYXNwZWN0UmF0aW87CgkJCXBNaW5IZWlnaHQgPSBiLm1pbldpZHRoIC8gdGhpcy5hc3BlY3RSYXRpbzsKCQkJcE1heFdpZHRoID0gYi5tYXhIZWlnaHQgKiB0aGlzLmFzcGVjdFJhdGlvOwoJCQlwTWF4SGVpZ2h0ID0gYi5tYXhXaWR0aCAvIHRoaXMuYXNwZWN0UmF0aW87CgoJCQlpZihwTWluV2lkdGggPiBiLm1pbldpZHRoKSB7CgkJCQliLm1pbldpZHRoID0gcE1pbldpZHRoOwoJCQl9CgkJCWlmKHBNaW5IZWlnaHQgPiBiLm1pbkhlaWdodCkgewoJCQkJYi5taW5IZWlnaHQgPSBwTWluSGVpZ2h0OwoJCQl9CgkJCWlmKHBNYXhXaWR0aCA8IGIubWF4V2lkdGgpIHsKCQkJCWIubWF4V2lkdGggPSBwTWF4V2lkdGg7CgkJCX0KCQkJaWYocE1heEhlaWdodCA8IGIubWF4SGVpZ2h0KSB7CgkJCQliLm1heEhlaWdodCA9IHBNYXhIZWlnaHQ7CgkJCX0KCQl9CgkJdGhpcy5fdkJvdW5kYXJpZXMgPSBiOwoJfSwKCglfdXBkYXRlQ2FjaGU6IGZ1bmN0aW9uKGRhdGEpIHsKCQl0aGlzLm9mZnNldCA9IHRoaXMuaGVscGVyLm9mZnNldCgpOwoJCWlmIChpc051bWJlcihkYXRhLmxlZnQpKSB7CgkJCXRoaXMucG9zaXRpb24ubGVmdCA9IGRhdGEubGVmdDsKCQl9CgkJaWYgKGlzTnVtYmVyKGRhdGEudG9wKSkgewoJCQl0aGlzLnBvc2l0aW9uLnRvcCA9IGRhdGEudG9wOwoJCX0KCQlpZiAoaXNOdW1iZXIoZGF0YS5oZWlnaHQpKSB7CgkJCXRoaXMuc2l6ZS5oZWlnaHQgPSBkYXRhLmhlaWdodDsKCQl9CgkJaWYgKGlzTnVtYmVyKGRhdGEud2lkdGgpKSB7CgkJCXRoaXMuc2l6ZS53aWR0aCA9IGRhdGEud2lkdGg7CgkJfQoJfSwKCglfdXBkYXRlUmF0aW86IGZ1bmN0aW9uKCBkYXRhICkgewoKCQl2YXIgY3BvcyA9IHRoaXMucG9zaXRpb24sCgkJCWNzaXplID0gdGhpcy5zaXplLAoJCQlhID0gdGhpcy5heGlzOwoKCQlpZiAoaXNOdW1iZXIoZGF0YS5oZWlnaHQpKSB7CgkJCWRhdGEud2lkdGggPSAoZGF0YS5oZWlnaHQgKiB0aGlzLmFzcGVjdFJhdGlvKTsKCQl9IGVsc2UgaWYgKGlzTnVtYmVyKGRhdGEud2lkdGgpKSB7CgkJCWRhdGEuaGVpZ2h0ID0gKGRhdGEud2lkdGggLyB0aGlzLmFzcGVjdFJhdGlvKTsKCQl9CgoJCWlmIChhID09PSAic3ciKSB7CgkJCWRhdGEubGVmdCA9IGNwb3MubGVmdCArIChjc2l6ZS53aWR0aCAtIGRhdGEud2lkdGgpOwoJCQlkYXRhLnRvcCA9IG51bGw7CgkJfQoJCWlmIChhID09PSAibnciKSB7CgkJCWRhdGEudG9wID0gY3Bvcy50b3AgKyAoY3NpemUuaGVpZ2h0IC0gZGF0YS5oZWlnaHQpOwoJCQlkYXRhLmxlZnQgPSBjcG9zLmxlZnQgKyAoY3NpemUud2lkdGggLSBkYXRhLndpZHRoKTsKCQl9CgoJCXJldHVybiBkYXRhOwoJfSwKCglfcmVzcGVjdFNpemU6IGZ1bmN0aW9uKCBkYXRhICkgewoKCQl2YXIgbyA9IHRoaXMuX3ZCb3VuZGFyaWVzLAoJCQlhID0gdGhpcy5heGlzLAoJCQlpc21heHcgPSBpc051bWJlcihkYXRhLndpZHRoKSAmJiBvLm1heFdpZHRoICYmIChvLm1heFdpZHRoIDwgZGF0YS53aWR0aCksIGlzbWF4aCA9IGlzTnVtYmVyKGRhdGEuaGVpZ2h0KSAmJiBvLm1heEhlaWdodCAmJiAoby5tYXhIZWlnaHQgPCBkYXRhLmhlaWdodCksCgkJCWlzbWludyA9IGlzTnVtYmVyKGRhdGEud2lkdGgpICYmIG8ubWluV2lkdGggJiYgKG8ubWluV2lkdGggPiBkYXRhLndpZHRoKSwgaXNtaW5oID0gaXNOdW1iZXIoZGF0YS5oZWlnaHQpICYmIG8ubWluSGVpZ2h0ICYmIChvLm1pbkhlaWdodCA+IGRhdGEuaGVpZ2h0KSwKCQkJZHcgPSB0aGlzLm9yaWdpbmFsUG9zaXRpb24ubGVmdCArIHRoaXMub3JpZ2luYWxTaXplLndpZHRoLAoJCQlkaCA9IHRoaXMucG9zaXRpb24udG9wICsgdGhpcy5zaXplLmhlaWdodCwKCQkJY3cgPSAvc3d8bnd8dy8udGVzdChhKSwgY2ggPSAvbnd8bmV8bi8udGVzdChhKTsKCQlpZiAoaXNtaW53KSB7CgkJCWRhdGEud2lkdGggPSBvLm1pbldpZHRoOwoJCX0KCQlpZiAoaXNtaW5oKSB7CgkJCWRhdGEuaGVpZ2h0ID0gby5taW5IZWlnaHQ7CgkJfQoJCWlmIChpc21heHcpIHsKCQkJZGF0YS53aWR0aCA9IG8ubWF4V2lkdGg7CgkJfQoJCWlmIChpc21heGgpIHsKCQkJZGF0YS5oZWlnaHQgPSBvLm1heEhlaWdodDsKCQl9CgoJCWlmIChpc21pbncgJiYgY3cpIHsKCQkJZGF0YS5sZWZ0ID0gZHcgLSBvLm1pbldpZHRoOwoJCX0KCQlpZiAoaXNtYXh3ICYmIGN3KSB7CgkJCWRhdGEubGVmdCA9IGR3IC0gby5tYXhXaWR0aDsKCQl9CgkJaWYgKGlzbWluaCAmJiBjaCkgewoJCQlkYXRhLnRvcCA9IGRoIC0gby5taW5IZWlnaHQ7CgkJfQoJCWlmIChpc21heGggJiYgY2gpIHsKCQkJZGF0YS50b3AgPSBkaCAtIG8ubWF4SGVpZ2h0OwoJCX0KCgkJLy8gZml4aW5nIGp1bXAgZXJyb3Igb24gdG9wL2xlZnQgLSBidWcgIzIzMzAKCQlpZiAoIWRhdGEud2lkdGggJiYgIWRhdGEuaGVpZ2h0ICYmICFkYXRhLmxlZnQgJiYgZGF0YS50b3ApIHsKCQkJZGF0YS50b3AgPSBudWxsOwoJCX0gZWxzZSBpZiAoIWRhdGEud2lkdGggJiYgIWRhdGEuaGVpZ2h0ICYmICFkYXRhLnRvcCAmJiBkYXRhLmxlZnQpIHsKCQkJZGF0YS5sZWZ0ID0gbnVsbDsKCQl9CgoJCXJldHVybiBkYXRhOwoJfSwKCglfcHJvcG9ydGlvbmFsbHlSZXNpemU6IGZ1bmN0aW9uKCkgewoKCQlpZiAoIXRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoKSB7CgkJCXJldHVybjsKCQl9CgoJCXZhciBpLCBqLCBib3JkZXJzLCBwYWRkaW5ncywgcHJlbCwKCQkJZWxlbWVudCA9IHRoaXMuaGVscGVyIHx8IHRoaXMuZWxlbWVudDsKCgkJZm9yICggaT0wOyBpIDwgdGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cy5sZW5ndGg7IGkrKykgewoKCQkJcHJlbCA9IHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHNbaV07CgoJCQlpZiAoIXRoaXMuYm9yZGVyRGlmKSB7CgkJCQl0aGlzLmJvcmRlckRpZiA9IFtdOwoJCQkJYm9yZGVycyA9IFtwcmVsLmNzcygiYm9yZGVyVG9wV2lkdGgiKSwgcHJlbC5jc3MoImJvcmRlclJpZ2h0V2lkdGgiKSwgcHJlbC5jc3MoImJvcmRlckJvdHRvbVdpZHRoIiksIHByZWwuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKV07CgkJCQlwYWRkaW5ncyA9IFtwcmVsLmNzcygicGFkZGluZ1RvcCIpLCBwcmVsLmNzcygicGFkZGluZ1JpZ2h0IiksIHByZWwuY3NzKCJwYWRkaW5nQm90dG9tIiksIHByZWwuY3NzKCJwYWRkaW5nTGVmdCIpXTsKCgkJCQlmb3IgKCBqID0gMDsgaiA8IGJvcmRlcnMubGVuZ3RoOyBqKysgKSB7CgkJCQkJdGhpcy5ib3JkZXJEaWZbIGogXSA9ICggcGFyc2VJbnQoIGJvcmRlcnNbIGogXSwgMTAgKSB8fCAwICkgKyAoIHBhcnNlSW50KCBwYWRkaW5nc1sgaiBdLCAxMCApIHx8IDAgKTsKCQkJCX0KCQkJfQoKCQkJcHJlbC5jc3MoewoJCQkJaGVpZ2h0OiAoZWxlbWVudC5oZWlnaHQoKSAtIHRoaXMuYm9yZGVyRGlmWzBdIC0gdGhpcy5ib3JkZXJEaWZbMl0pIHx8IDAsCgkJCQl3aWR0aDogKGVsZW1lbnQud2lkdGgoKSAtIHRoaXMuYm9yZGVyRGlmWzFdIC0gdGhpcy5ib3JkZXJEaWZbM10pIHx8IDAKCQkJfSk7CgoJCX0KCgl9LAoKCV9yZW5kZXJQcm94eTogZnVuY3Rpb24oKSB7CgoJCXZhciBlbCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9uczsKCQl0aGlzLmVsZW1lbnRPZmZzZXQgPSBlbC5vZmZzZXQoKTsKCgkJaWYodGhpcy5faGVscGVyKSB7CgoJCQl0aGlzLmhlbHBlciA9IHRoaXMuaGVscGVyIHx8ICQoIjxkaXYgc3R5bGU9J292ZXJmbG93OmhpZGRlbjsnPjwvZGl2PiIpOwoKCQkJdGhpcy5oZWxwZXIuYWRkQ2xhc3ModGhpcy5faGVscGVyKS5jc3MoewoJCQkJd2lkdGg6IHRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCkgLSAxLAoJCQkJaGVpZ2h0OiB0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSAtIDEsCgkJCQlwb3NpdGlvbjogImFic29sdXRlIiwKCQkJCWxlZnQ6IHRoaXMuZWxlbWVudE9mZnNldC5sZWZ0ICsicHgiLAoJCQkJdG9wOiB0aGlzLmVsZW1lbnRPZmZzZXQudG9wICsicHgiLAoJCQkJekluZGV4OiArK28uekluZGV4IC8vVE9ETzogRG9uJ3QgbW9kaWZ5IG9wdGlvbgoJCQl9KTsKCgkJCXRoaXMuaGVscGVyCgkJCQkuYXBwZW5kVG8oImJvZHkiKQoJCQkJLmRpc2FibGVTZWxlY3Rpb24oKTsKCgkJfSBlbHNlIHsKCQkJdGhpcy5oZWxwZXIgPSB0aGlzLmVsZW1lbnQ7CgkJfQoKCX0sCgoJX2NoYW5nZTogewoJCWU6IGZ1bmN0aW9uKGV2ZW50LCBkeCkgewoJCQlyZXR1cm4geyB3aWR0aDogdGhpcy5vcmlnaW5hbFNpemUud2lkdGggKyBkeCB9OwoJCX0sCgkJdzogZnVuY3Rpb24oZXZlbnQsIGR4KSB7CgkJCXZhciBjcyA9IHRoaXMub3JpZ2luYWxTaXplLCBzcCA9IHRoaXMub3JpZ2luYWxQb3NpdGlvbjsKCQkJcmV0dXJuIHsgbGVmdDogc3AubGVmdCArIGR4LCB3aWR0aDogY3Mud2lkdGggLSBkeCB9OwoJCX0sCgkJbjogZnVuY3Rpb24oZXZlbnQsIGR4LCBkeSkgewoJCQl2YXIgY3MgPSB0aGlzLm9yaWdpbmFsU2l6ZSwgc3AgPSB0aGlzLm9yaWdpbmFsUG9zaXRpb247CgkJCXJldHVybiB7IHRvcDogc3AudG9wICsgZHksIGhlaWdodDogY3MuaGVpZ2h0IC0gZHkgfTsKCQl9LAoJCXM6IGZ1bmN0aW9uKGV2ZW50LCBkeCwgZHkpIHsKCQkJcmV0dXJuIHsgaGVpZ2h0OiB0aGlzLm9yaWdpbmFsU2l6ZS5oZWlnaHQgKyBkeSB9OwoJCX0sCgkJc2U6IGZ1bmN0aW9uKGV2ZW50LCBkeCwgZHkpIHsKCQkJcmV0dXJuICQuZXh0ZW5kKHRoaXMuX2NoYW5nZS5zLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMuX2NoYW5nZS5lLmFwcGx5KHRoaXMsIFtldmVudCwgZHgsIGR5XSkpOwoJCX0sCgkJc3c6IGZ1bmN0aW9uKGV2ZW50LCBkeCwgZHkpIHsKCQkJcmV0dXJuICQuZXh0ZW5kKHRoaXMuX2NoYW5nZS5zLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMuX2NoYW5nZS53LmFwcGx5KHRoaXMsIFtldmVudCwgZHgsIGR5XSkpOwoJCX0sCgkJbmU6IGZ1bmN0aW9uKGV2ZW50LCBkeCwgZHkpIHsKCQkJcmV0dXJuICQuZXh0ZW5kKHRoaXMuX2NoYW5nZS5uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMuX2NoYW5nZS5lLmFwcGx5KHRoaXMsIFtldmVudCwgZHgsIGR5XSkpOwoJCX0sCgkJbnc6IGZ1bmN0aW9uKGV2ZW50LCBkeCwgZHkpIHsKCQkJcmV0dXJuICQuZXh0ZW5kKHRoaXMuX2NoYW5nZS5uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMuX2NoYW5nZS53LmFwcGx5KHRoaXMsIFtldmVudCwgZHgsIGR5XSkpOwoJCX0KCX0sCgoJX3Byb3BhZ2F0ZTogZnVuY3Rpb24obiwgZXZlbnQpIHsKCQkkLnVpLnBsdWdpbi5jYWxsKHRoaXMsIG4sIFtldmVudCwgdGhpcy51aSgpXSk7CgkJKG4gIT09ICJyZXNpemUiICYmIHRoaXMuX3RyaWdnZXIobiwgZXZlbnQsIHRoaXMudWkoKSkpOwoJfSwKCglwbHVnaW5zOiB7fSwKCgl1aTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHsKCQkJb3JpZ2luYWxFbGVtZW50OiB0aGlzLm9yaWdpbmFsRWxlbWVudCwKCQkJZWxlbWVudDogdGhpcy5lbGVtZW50LAoJCQloZWxwZXI6IHRoaXMuaGVscGVyLAoJCQlwb3NpdGlvbjogdGhpcy5wb3NpdGlvbiwKCQkJc2l6ZTogdGhpcy5zaXplLAoJCQlvcmlnaW5hbFNpemU6IHRoaXMub3JpZ2luYWxTaXplLAoJCQlvcmlnaW5hbFBvc2l0aW9uOiB0aGlzLm9yaWdpbmFsUG9zaXRpb24KCQl9OwoJfQoKfSk7CgovKgogKiBSZXNpemFibGUgRXh0ZW5zaW9ucwogKi8KCiQudWkucGx1Z2luLmFkZCgicmVzaXphYmxlIiwgImFuaW1hdGUiLCB7CgoJc3RvcDogZnVuY3Rpb24oIGV2ZW50ICkgewoJCXZhciB0aGF0ID0gJCh0aGlzKS5kYXRhKCJ1aS1yZXNpemFibGUiKSwKCQkJbyA9IHRoYXQub3B0aW9ucywKCQkJcHIgPSB0aGF0Ll9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLAoJCQlpc3RhID0gcHIubGVuZ3RoICYmICgvdGV4dGFyZWEvaSkudGVzdChwclswXS5ub2RlTmFtZSksCgkJCXNvZmZzZXRoID0gaXN0YSAmJiAkLnVpLmhhc1Njcm9sbChwclswXSwgImxlZnQiKSAvKiBUT0RPIC0ganVtcCBoZWlnaHQgKi8gPyAwIDogdGhhdC5zaXplRGlmZi5oZWlnaHQsCgkJCXNvZmZzZXR3ID0gaXN0YSA/IDAgOiB0aGF0LnNpemVEaWZmLndpZHRoLAoJCQlzdHlsZSA9IHsgd2lkdGg6ICh0aGF0LnNpemUud2lkdGggLSBzb2Zmc2V0dyksIGhlaWdodDogKHRoYXQuc2l6ZS5oZWlnaHQgLSBzb2Zmc2V0aCkgfSwKCQkJbGVmdCA9IChwYXJzZUludCh0aGF0LmVsZW1lbnQuY3NzKCJsZWZ0IiksIDEwKSArICh0aGF0LnBvc2l0aW9uLmxlZnQgLSB0aGF0Lm9yaWdpbmFsUG9zaXRpb24ubGVmdCkpIHx8IG51bGwsCgkJCXRvcCA9IChwYXJzZUludCh0aGF0LmVsZW1lbnQuY3NzKCJ0b3AiKSwgMTApICsgKHRoYXQucG9zaXRpb24udG9wIC0gdGhhdC5vcmlnaW5hbFBvc2l0aW9uLnRvcCkpIHx8IG51bGw7CgoJCXRoYXQuZWxlbWVudC5hbmltYXRlKAoJCQkkLmV4dGVuZChzdHlsZSwgdG9wICYmIGxlZnQgPyB7IHRvcDogdG9wLCBsZWZ0OiBsZWZ0IH0gOiB7fSksIHsKCQkJCWR1cmF0aW9uOiBvLmFuaW1hdGVEdXJhdGlvbiwKCQkJCWVhc2luZzogby5hbmltYXRlRWFzaW5nLAoJCQkJc3RlcDogZnVuY3Rpb24oKSB7CgoJCQkJCXZhciBkYXRhID0gewoJCQkJCQl3aWR0aDogcGFyc2VJbnQodGhhdC5lbGVtZW50LmNzcygid2lkdGgiKSwgMTApLAoJCQkJCQloZWlnaHQ6IHBhcnNlSW50KHRoYXQuZWxlbWVudC5jc3MoImhlaWdodCIpLCAxMCksCgkJCQkJCXRvcDogcGFyc2VJbnQodGhhdC5lbGVtZW50LmNzcygidG9wIiksIDEwKSwKCQkJCQkJbGVmdDogcGFyc2VJbnQodGhhdC5lbGVtZW50LmNzcygibGVmdCIpLCAxMCkKCQkJCQl9OwoKCQkJCQlpZiAocHIgJiYgcHIubGVuZ3RoKSB7CgkJCQkJCSQocHJbMF0pLmNzcyh7IHdpZHRoOiBkYXRhLndpZHRoLCBoZWlnaHQ6IGRhdGEuaGVpZ2h0IH0pOwoJCQkJCX0KCgkJCQkJLy8gcHJvcGFnYXRpbmcgcmVzaXplLCBhbmQgdXBkYXRpbmcgdmFsdWVzIGZvciBlYWNoIGFuaW1hdGlvbiBzdGVwCgkJCQkJdGhhdC5fdXBkYXRlQ2FjaGUoZGF0YSk7CgkJCQkJdGhhdC5fcHJvcGFnYXRlKCJyZXNpemUiLCBldmVudCk7CgoJCQkJfQoJCQl9CgkJKTsKCX0KCn0pOwoKJC51aS5wbHVnaW4uYWRkKCJyZXNpemFibGUiLCAiY29udGFpbm1lbnQiLCB7CgoJc3RhcnQ6IGZ1bmN0aW9uKCkgewoJCXZhciBlbGVtZW50LCBwLCBjbywgY2gsIGN3LCB3aWR0aCwgaGVpZ2h0LAoJCQl0aGF0ID0gJCh0aGlzKS5kYXRhKCJ1aS1yZXNpemFibGUiKSwKCQkJbyA9IHRoYXQub3B0aW9ucywKCQkJZWwgPSB0aGF0LmVsZW1lbnQsCgkJCW9jID0gby5jb250YWlubWVudCwKCQkJY2UgPSAob2MgaW5zdGFuY2VvZiAkKSA/IG9jLmdldCgwKSA6ICgvcGFyZW50Ly50ZXN0KG9jKSkgPyBlbC5wYXJlbnQoKS5nZXQoMCkgOiBvYzsKCgkJaWYgKCFjZSkgewoJCQlyZXR1cm47CgkJfQoKCQl0aGF0LmNvbnRhaW5lckVsZW1lbnQgPSAkKGNlKTsKCgkJaWYgKC9kb2N1bWVudC8udGVzdChvYykgfHwgb2MgPT09IGRvY3VtZW50KSB7CgkJCXRoYXQuY29udGFpbmVyT2Zmc2V0ID0geyBsZWZ0OiAwLCB0b3A6IDAgfTsKCQkJdGhhdC5jb250YWluZXJQb3NpdGlvbiA9IHsgbGVmdDogMCwgdG9wOiAwIH07CgoJCQl0aGF0LnBhcmVudERhdGEgPSB7CgkJCQllbGVtZW50OiAkKGRvY3VtZW50KSwgbGVmdDogMCwgdG9wOiAwLAoJCQkJd2lkdGg6ICQoZG9jdW1lbnQpLndpZHRoKCksIGhlaWdodDogJChkb2N1bWVudCkuaGVpZ2h0KCkgfHwgZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodAoJCQl9OwoJCX0KCgkJLy8gaSdtIGEgbm9kZSwgc28gY29tcHV0ZSB0b3AsIGxlZnQsIHJpZ2h0LCBib3R0b20KCQllbHNlIHsKCQkJZWxlbWVudCA9ICQoY2UpOwoJCQlwID0gW107CgkJCSQoWyAiVG9wIiwgIlJpZ2h0IiwgIkxlZnQiLCAiQm90dG9tIiBdKS5lYWNoKGZ1bmN0aW9uKGksIG5hbWUpIHsgcFtpXSA9IG51bShlbGVtZW50LmNzcygicGFkZGluZyIgKyBuYW1lKSk7IH0pOwoKCQkJdGhhdC5jb250YWluZXJPZmZzZXQgPSBlbGVtZW50Lm9mZnNldCgpOwoJCQl0aGF0LmNvbnRhaW5lclBvc2l0aW9uID0gZWxlbWVudC5wb3NpdGlvbigpOwoJCQl0aGF0LmNvbnRhaW5lclNpemUgPSB7IGhlaWdodDogKGVsZW1lbnQuaW5uZXJIZWlnaHQoKSAtIHBbM10pLCB3aWR0aDogKGVsZW1lbnQuaW5uZXJXaWR0aCgpIC0gcFsxXSkgfTsKCgkJCWNvID0gdGhhdC5jb250YWluZXJPZmZzZXQ7CgkJCWNoID0gdGhhdC5jb250YWluZXJTaXplLmhlaWdodDsKCQkJY3cgPSB0aGF0LmNvbnRhaW5lclNpemUud2lkdGg7CgkJCXdpZHRoID0gKCQudWkuaGFzU2Nyb2xsKGNlLCAibGVmdCIpID8gY2Uuc2Nyb2xsV2lkdGggOiBjdyApOwoJCQloZWlnaHQgPSAoJC51aS5oYXNTY3JvbGwoY2UpID8gY2Uuc2Nyb2xsSGVpZ2h0IDogY2gpOwoKCQkJdGhhdC5wYXJlbnREYXRhID0gewoJCQkJZWxlbWVudDogY2UsIGxlZnQ6IGNvLmxlZnQsIHRvcDogY28udG9wLCB3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0CgkJCX07CgkJfQoJfSwKCglyZXNpemU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgd29zZXQsIGhvc2V0LCBpc1BhcmVudCwgaXNPZmZzZXRSZWxhdGl2ZSwKCQkJdGhhdCA9ICQodGhpcykuZGF0YSgidWktcmVzaXphYmxlIiksCgkJCW8gPSB0aGF0Lm9wdGlvbnMsCgkJCWNvID0gdGhhdC5jb250YWluZXJPZmZzZXQsIGNwID0gdGhhdC5wb3NpdGlvbiwKCQkJcFJhdGlvID0gdGhhdC5fYXNwZWN0UmF0aW8gfHwgZXZlbnQuc2hpZnRLZXksCgkJCWNvcCA9IHsgdG9wOjAsIGxlZnQ6MCB9LCBjZSA9IHRoYXQuY29udGFpbmVyRWxlbWVudDsKCgkJaWYgKGNlWzBdICE9PSBkb2N1bWVudCAmJiAoL3N0YXRpYy8pLnRlc3QoY2UuY3NzKCJwb3NpdGlvbiIpKSkgewoJCQljb3AgPSBjbzsKCQl9CgoJCWlmIChjcC5sZWZ0IDwgKHRoYXQuX2hlbHBlciA/IGNvLmxlZnQgOiAwKSkgewoJCQl0aGF0LnNpemUud2lkdGggPSB0aGF0LnNpemUud2lkdGggKyAodGhhdC5faGVscGVyID8gKHRoYXQucG9zaXRpb24ubGVmdCAtIGNvLmxlZnQpIDogKHRoYXQucG9zaXRpb24ubGVmdCAtIGNvcC5sZWZ0KSk7CgkJCWlmIChwUmF0aW8pIHsKCQkJCXRoYXQuc2l6ZS5oZWlnaHQgPSB0aGF0LnNpemUud2lkdGggLyB0aGF0LmFzcGVjdFJhdGlvOwoJCQl9CgkJCXRoYXQucG9zaXRpb24ubGVmdCA9IG8uaGVscGVyID8gY28ubGVmdCA6IDA7CgkJfQoKCQlpZiAoY3AudG9wIDwgKHRoYXQuX2hlbHBlciA/IGNvLnRvcCA6IDApKSB7CgkJCXRoYXQuc2l6ZS5oZWlnaHQgPSB0aGF0LnNpemUuaGVpZ2h0ICsgKHRoYXQuX2hlbHBlciA/ICh0aGF0LnBvc2l0aW9uLnRvcCAtIGNvLnRvcCkgOiB0aGF0LnBvc2l0aW9uLnRvcCk7CgkJCWlmIChwUmF0aW8pIHsKCQkJCXRoYXQuc2l6ZS53aWR0aCA9IHRoYXQuc2l6ZS5oZWlnaHQgKiB0aGF0LmFzcGVjdFJhdGlvOwoJCQl9CgkJCXRoYXQucG9zaXRpb24udG9wID0gdGhhdC5faGVscGVyID8gY28udG9wIDogMDsKCQl9CgoJCXRoYXQub2Zmc2V0LmxlZnQgPSB0aGF0LnBhcmVudERhdGEubGVmdCt0aGF0LnBvc2l0aW9uLmxlZnQ7CgkJdGhhdC5vZmZzZXQudG9wID0gdGhhdC5wYXJlbnREYXRhLnRvcCt0aGF0LnBvc2l0aW9uLnRvcDsKCgkJd29zZXQgPSBNYXRoLmFicyggKHRoYXQuX2hlbHBlciA/IHRoYXQub2Zmc2V0LmxlZnQgLSBjb3AubGVmdCA6ICh0aGF0Lm9mZnNldC5sZWZ0IC0gY29wLmxlZnQpKSArIHRoYXQuc2l6ZURpZmYud2lkdGggKTsKCQlob3NldCA9IE1hdGguYWJzKCAodGhhdC5faGVscGVyID8gdGhhdC5vZmZzZXQudG9wIC0gY29wLnRvcCA6ICh0aGF0Lm9mZnNldC50b3AgLSBjby50b3ApKSArIHRoYXQuc2l6ZURpZmYuaGVpZ2h0ICk7CgoJCWlzUGFyZW50ID0gdGhhdC5jb250YWluZXJFbGVtZW50LmdldCgwKSA9PT0gdGhhdC5lbGVtZW50LnBhcmVudCgpLmdldCgwKTsKCQlpc09mZnNldFJlbGF0aXZlID0gL3JlbGF0aXZlfGFic29sdXRlLy50ZXN0KHRoYXQuY29udGFpbmVyRWxlbWVudC5jc3MoInBvc2l0aW9uIikpOwoKCQlpZiAoIGlzUGFyZW50ICYmIGlzT2Zmc2V0UmVsYXRpdmUgKSB7CgkJCXdvc2V0IC09IE1hdGguYWJzKCB0aGF0LnBhcmVudERhdGEubGVmdCApOwoJCX0KCgkJaWYgKHdvc2V0ICsgdGhhdC5zaXplLndpZHRoID49IHRoYXQucGFyZW50RGF0YS53aWR0aCkgewoJCQl0aGF0LnNpemUud2lkdGggPSB0aGF0LnBhcmVudERhdGEud2lkdGggLSB3b3NldDsKCQkJaWYgKHBSYXRpbykgewoJCQkJdGhhdC5zaXplLmhlaWdodCA9IHRoYXQuc2l6ZS53aWR0aCAvIHRoYXQuYXNwZWN0UmF0aW87CgkJCX0KCQl9CgoJCWlmIChob3NldCArIHRoYXQuc2l6ZS5oZWlnaHQgPj0gdGhhdC5wYXJlbnREYXRhLmhlaWdodCkgewoJCQl0aGF0LnNpemUuaGVpZ2h0ID0gdGhhdC5wYXJlbnREYXRhLmhlaWdodCAtIGhvc2V0OwoJCQlpZiAocFJhdGlvKSB7CgkJCQl0aGF0LnNpemUud2lkdGggPSB0aGF0LnNpemUuaGVpZ2h0ICogdGhhdC5hc3BlY3RSYXRpbzsKCQkJfQoJCX0KCX0sCgoJc3RvcDogZnVuY3Rpb24oKXsKCQl2YXIgdGhhdCA9ICQodGhpcykuZGF0YSgidWktcmVzaXphYmxlIiksCgkJCW8gPSB0aGF0Lm9wdGlvbnMsCgkJCWNvID0gdGhhdC5jb250YWluZXJPZmZzZXQsCgkJCWNvcCA9IHRoYXQuY29udGFpbmVyUG9zaXRpb24sCgkJCWNlID0gdGhhdC5jb250YWluZXJFbGVtZW50LAoJCQloZWxwZXIgPSAkKHRoYXQuaGVscGVyKSwKCQkJaG8gPSBoZWxwZXIub2Zmc2V0KCksCgkJCXcgPSBoZWxwZXIub3V0ZXJXaWR0aCgpIC0gdGhhdC5zaXplRGlmZi53aWR0aCwKCQkJaCA9IGhlbHBlci5vdXRlckhlaWdodCgpIC0gdGhhdC5zaXplRGlmZi5oZWlnaHQ7CgoJCWlmICh0aGF0Ll9oZWxwZXIgJiYgIW8uYW5pbWF0ZSAmJiAoL3JlbGF0aXZlLykudGVzdChjZS5jc3MoInBvc2l0aW9uIikpKSB7CgkJCSQodGhpcykuY3NzKHsgbGVmdDogaG8ubGVmdCAtIGNvcC5sZWZ0IC0gY28ubGVmdCwgd2lkdGg6IHcsIGhlaWdodDogaCB9KTsKCQl9CgoJCWlmICh0aGF0Ll9oZWxwZXIgJiYgIW8uYW5pbWF0ZSAmJiAoL3N0YXRpYy8pLnRlc3QoY2UuY3NzKCJwb3NpdGlvbiIpKSkgewoJCQkkKHRoaXMpLmNzcyh7IGxlZnQ6IGhvLmxlZnQgLSBjb3AubGVmdCAtIGNvLmxlZnQsIHdpZHRoOiB3LCBoZWlnaHQ6IGggfSk7CgkJfQoKCX0KfSk7CgokLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsICJhbHNvUmVzaXplIiwgewoKCXN0YXJ0OiBmdW5jdGlvbiAoKSB7CgkJdmFyIHRoYXQgPSAkKHRoaXMpLmRhdGEoInVpLXJlc2l6YWJsZSIpLAoJCQlvID0gdGhhdC5vcHRpb25zLAoJCQlfc3RvcmUgPSBmdW5jdGlvbiAoZXhwKSB7CgkJCQkkKGV4cCkuZWFjaChmdW5jdGlvbigpIHsKCQkJCQl2YXIgZWwgPSAkKHRoaXMpOwoJCQkJCWVsLmRhdGEoInVpLXJlc2l6YWJsZS1hbHNvcmVzaXplIiwgewoJCQkJCQl3aWR0aDogcGFyc2VJbnQoZWwud2lkdGgoKSwgMTApLCBoZWlnaHQ6IHBhcnNlSW50KGVsLmhlaWdodCgpLCAxMCksCgkJCQkJCWxlZnQ6IHBhcnNlSW50KGVsLmNzcygibGVmdCIpLCAxMCksIHRvcDogcGFyc2VJbnQoZWwuY3NzKCJ0b3AiKSwgMTApCgkJCQkJfSk7CgkJCQl9KTsKCQkJfTsKCgkJaWYgKHR5cGVvZihvLmFsc29SZXNpemUpID09PSAib2JqZWN0IiAmJiAhby5hbHNvUmVzaXplLnBhcmVudE5vZGUpIHsKCQkJaWYgKG8uYWxzb1Jlc2l6ZS5sZW5ndGgpIHsgby5hbHNvUmVzaXplID0gby5hbHNvUmVzaXplWzBdOyBfc3RvcmUoby5hbHNvUmVzaXplKTsgfQoJCQllbHNlIHsgJC5lYWNoKG8uYWxzb1Jlc2l6ZSwgZnVuY3Rpb24gKGV4cCkgeyBfc3RvcmUoZXhwKTsgfSk7IH0KCQl9ZWxzZXsKCQkJX3N0b3JlKG8uYWxzb1Jlc2l6ZSk7CgkJfQoJfSwKCglyZXNpemU6IGZ1bmN0aW9uIChldmVudCwgdWkpIHsKCQl2YXIgdGhhdCA9ICQodGhpcykuZGF0YSgidWktcmVzaXphYmxlIiksCgkJCW8gPSB0aGF0Lm9wdGlvbnMsCgkJCW9zID0gdGhhdC5vcmlnaW5hbFNpemUsCgkJCW9wID0gdGhhdC5vcmlnaW5hbFBvc2l0aW9uLAoJCQlkZWx0YSA9IHsKCQkJCWhlaWdodDogKHRoYXQuc2l6ZS5oZWlnaHQgLSBvcy5oZWlnaHQpIHx8IDAsIHdpZHRoOiAodGhhdC5zaXplLndpZHRoIC0gb3Mud2lkdGgpIHx8IDAsCgkJCQl0b3A6ICh0aGF0LnBvc2l0aW9uLnRvcCAtIG9wLnRvcCkgfHwgMCwgbGVmdDogKHRoYXQucG9zaXRpb24ubGVmdCAtIG9wLmxlZnQpIHx8IDAKCQkJfSwKCgkJCV9hbHNvUmVzaXplID0gZnVuY3Rpb24gKGV4cCwgYykgewoJCQkJJChleHApLmVhY2goZnVuY3Rpb24oKSB7CgkJCQkJdmFyIGVsID0gJCh0aGlzKSwgc3RhcnQgPSAkKHRoaXMpLmRhdGEoInVpLXJlc2l6YWJsZS1hbHNvcmVzaXplIiksIHN0eWxlID0ge30sCgkJCQkJCWNzcyA9IGMgJiYgYy5sZW5ndGggPyBjIDogZWwucGFyZW50cyh1aS5vcmlnaW5hbEVsZW1lbnRbMF0pLmxlbmd0aCA/IFsid2lkdGgiLCAiaGVpZ2h0Il0gOiBbIndpZHRoIiwgImhlaWdodCIsICJ0b3AiLCAibGVmdCJdOwoKCQkJCQkkLmVhY2goY3NzLCBmdW5jdGlvbiAoaSwgcHJvcCkgewoJCQkJCQl2YXIgc3VtID0gKHN0YXJ0W3Byb3BdfHwwKSArIChkZWx0YVtwcm9wXXx8MCk7CgkJCQkJCWlmIChzdW0gJiYgc3VtID49IDApIHsKCQkJCQkJCXN0eWxlW3Byb3BdID0gc3VtIHx8IG51bGw7CgkJCQkJCX0KCQkJCQl9KTsKCgkJCQkJZWwuY3NzKHN0eWxlKTsKCQkJCX0pOwoJCQl9OwoKCQlpZiAodHlwZW9mKG8uYWxzb1Jlc2l6ZSkgPT09ICJvYmplY3QiICYmICFvLmFsc29SZXNpemUubm9kZVR5cGUpIHsKCQkJJC5lYWNoKG8uYWxzb1Jlc2l6ZSwgZnVuY3Rpb24gKGV4cCwgYykgeyBfYWxzb1Jlc2l6ZShleHAsIGMpOyB9KTsKCQl9ZWxzZXsKCQkJX2Fsc29SZXNpemUoby5hbHNvUmVzaXplKTsKCQl9Cgl9LAoKCXN0b3A6IGZ1bmN0aW9uICgpIHsKCQkkKHRoaXMpLnJlbW92ZURhdGEoInJlc2l6YWJsZS1hbHNvcmVzaXplIik7Cgl9Cn0pOwoKJC51aS5wbHVnaW4uYWRkKCJyZXNpemFibGUiLCAiZ2hvc3QiLCB7CgoJc3RhcnQ6IGZ1bmN0aW9uKCkgewoKCQl2YXIgdGhhdCA9ICQodGhpcykuZGF0YSgidWktcmVzaXphYmxlIiksIG8gPSB0aGF0Lm9wdGlvbnMsIGNzID0gdGhhdC5zaXplOwoKCQl0aGF0Lmdob3N0ID0gdGhhdC5vcmlnaW5hbEVsZW1lbnQuY2xvbmUoKTsKCQl0aGF0Lmdob3N0CgkJCS5jc3MoeyBvcGFjaXR5OiAwLjI1LCBkaXNwbGF5OiAiYmxvY2siLCBwb3NpdGlvbjogInJlbGF0aXZlIiwgaGVpZ2h0OiBjcy5oZWlnaHQsIHdpZHRoOiBjcy53aWR0aCwgbWFyZ2luOiAwLCBsZWZ0OiAwLCB0b3A6IDAgfSkKCQkJLmFkZENsYXNzKCJ1aS1yZXNpemFibGUtZ2hvc3QiKQoJCQkuYWRkQ2xhc3ModHlwZW9mIG8uZ2hvc3QgPT09ICJzdHJpbmciID8gby5naG9zdCA6ICIiKTsKCgkJdGhhdC5naG9zdC5hcHBlbmRUbyh0aGF0LmhlbHBlcik7CgoJfSwKCglyZXNpemU6IGZ1bmN0aW9uKCl7CgkJdmFyIHRoYXQgPSAkKHRoaXMpLmRhdGEoInVpLXJlc2l6YWJsZSIpOwoJCWlmICh0aGF0Lmdob3N0KSB7CgkJCXRoYXQuZ2hvc3QuY3NzKHsgcG9zaXRpb246ICJyZWxhdGl2ZSIsIGhlaWdodDogdGhhdC5zaXplLmhlaWdodCwgd2lkdGg6IHRoYXQuc2l6ZS53aWR0aCB9KTsKCQl9Cgl9LAoKCXN0b3A6IGZ1bmN0aW9uKCkgewoJCXZhciB0aGF0ID0gJCh0aGlzKS5kYXRhKCJ1aS1yZXNpemFibGUiKTsKCQlpZiAodGhhdC5naG9zdCAmJiB0aGF0LmhlbHBlcikgewoJCQl0aGF0LmhlbHBlci5nZXQoMCkucmVtb3ZlQ2hpbGQodGhhdC5naG9zdC5nZXQoMCkpOwoJCX0KCX0KCn0pOwoKJC51aS5wbHVnaW4uYWRkKCJyZXNpemFibGUiLCAiZ3JpZCIsIHsKCglyZXNpemU6IGZ1bmN0aW9uKCkgewoJCXZhciB0aGF0ID0gJCh0aGlzKS5kYXRhKCJ1aS1yZXNpemFibGUiKSwKCQkJbyA9IHRoYXQub3B0aW9ucywKCQkJY3MgPSB0aGF0LnNpemUsCgkJCW9zID0gdGhhdC5vcmlnaW5hbFNpemUsCgkJCW9wID0gdGhhdC5vcmlnaW5hbFBvc2l0aW9uLAoJCQlhID0gdGhhdC5heGlzLAoJCQlncmlkID0gdHlwZW9mIG8uZ3JpZCA9PT0gIm51bWJlciIgPyBbby5ncmlkLCBvLmdyaWRdIDogby5ncmlkLAoJCQlncmlkWCA9IChncmlkWzBdfHwxKSwKCQkJZ3JpZFkgPSAoZ3JpZFsxXXx8MSksCgkJCW94ID0gTWF0aC5yb3VuZCgoY3Mud2lkdGggLSBvcy53aWR0aCkgLyBncmlkWCkgKiBncmlkWCwKCQkJb3kgPSBNYXRoLnJvdW5kKChjcy5oZWlnaHQgLSBvcy5oZWlnaHQpIC8gZ3JpZFkpICogZ3JpZFksCgkJCW5ld1dpZHRoID0gb3Mud2lkdGggKyBveCwKCQkJbmV3SGVpZ2h0ID0gb3MuaGVpZ2h0ICsgb3ksCgkJCWlzTWF4V2lkdGggPSBvLm1heFdpZHRoICYmIChvLm1heFdpZHRoIDwgbmV3V2lkdGgpLAoJCQlpc01heEhlaWdodCA9IG8ubWF4SGVpZ2h0ICYmIChvLm1heEhlaWdodCA8IG5ld0hlaWdodCksCgkJCWlzTWluV2lkdGggPSBvLm1pbldpZHRoICYmIChvLm1pbldpZHRoID4gbmV3V2lkdGgpLAoJCQlpc01pbkhlaWdodCA9IG8ubWluSGVpZ2h0ICYmIChvLm1pbkhlaWdodCA+IG5ld0hlaWdodCk7CgoJCW8uZ3JpZCA9IGdyaWQ7CgoJCWlmIChpc01pbldpZHRoKSB7CgkJCW5ld1dpZHRoID0gbmV3V2lkdGggKyBncmlkWDsKCQl9CgkJaWYgKGlzTWluSGVpZ2h0KSB7CgkJCW5ld0hlaWdodCA9IG5ld0hlaWdodCArIGdyaWRZOwoJCX0KCQlpZiAoaXNNYXhXaWR0aCkgewoJCQluZXdXaWR0aCA9IG5ld1dpZHRoIC0gZ3JpZFg7CgkJfQoJCWlmIChpc01heEhlaWdodCkgewoJCQluZXdIZWlnaHQgPSBuZXdIZWlnaHQgLSBncmlkWTsKCQl9CgoJCWlmICgvXihzZXxzfGUpJC8udGVzdChhKSkgewoJCQl0aGF0LnNpemUud2lkdGggPSBuZXdXaWR0aDsKCQkJdGhhdC5zaXplLmhlaWdodCA9IG5ld0hlaWdodDsKCQl9IGVsc2UgaWYgKC9eKG5lKSQvLnRlc3QoYSkpIHsKCQkJdGhhdC5zaXplLndpZHRoID0gbmV3V2lkdGg7CgkJCXRoYXQuc2l6ZS5oZWlnaHQgPSBuZXdIZWlnaHQ7CgkJCXRoYXQucG9zaXRpb24udG9wID0gb3AudG9wIC0gb3k7CgkJfSBlbHNlIGlmICgvXihzdykkLy50ZXN0KGEpKSB7CgkJCXRoYXQuc2l6ZS53aWR0aCA9IG5ld1dpZHRoOwoJCQl0aGF0LnNpemUuaGVpZ2h0ID0gbmV3SGVpZ2h0OwoJCQl0aGF0LnBvc2l0aW9uLmxlZnQgPSBvcC5sZWZ0IC0gb3g7CgkJfSBlbHNlIHsKCQkJaWYgKCBuZXdIZWlnaHQgLSBncmlkWSA+IDAgKSB7CgkJCQl0aGF0LnNpemUuaGVpZ2h0ID0gbmV3SGVpZ2h0OwoJCQkJdGhhdC5wb3NpdGlvbi50b3AgPSBvcC50b3AgLSBveTsKCQkJfSBlbHNlIHsKCQkJCXRoYXQuc2l6ZS5oZWlnaHQgPSBncmlkWTsKCQkJCXRoYXQucG9zaXRpb24udG9wID0gb3AudG9wICsgb3MuaGVpZ2h0IC0gZ3JpZFk7CgkJCX0KCQkJaWYgKCBuZXdXaWR0aCAtIGdyaWRYID4gMCApIHsKCQkJCXRoYXQuc2l6ZS53aWR0aCA9IG5ld1dpZHRoOwoJCQkJdGhhdC5wb3NpdGlvbi5sZWZ0ID0gb3AubGVmdCAtIG94OwoJCQl9IGVsc2UgewoJCQkJdGhhdC5zaXplLndpZHRoID0gZ3JpZFg7CgkJCQl0aGF0LnBvc2l0aW9uLmxlZnQgPSBvcC5sZWZ0ICsgb3Mud2lkdGggLSBncmlkWDsKCQkJfQoJCX0KCX0KCn0pOwoKfSkoalF1ZXJ5KTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKJC53aWRnZXQoInVpLnNlbGVjdGFibGUiLCAkLnVpLm1vdXNlLCB7Cgl2ZXJzaW9uOiAiMS4xMC40IiwKCW9wdGlvbnM6IHsKCQlhcHBlbmRUbzogImJvZHkiLAoJCWF1dG9SZWZyZXNoOiB0cnVlLAoJCWRpc3RhbmNlOiAwLAoJCWZpbHRlcjogIioiLAoJCXRvbGVyYW5jZTogInRvdWNoIiwKCgkJLy8gY2FsbGJhY2tzCgkJc2VsZWN0ZWQ6IG51bGwsCgkJc2VsZWN0aW5nOiBudWxsLAoJCXN0YXJ0OiBudWxsLAoJCXN0b3A6IG51bGwsCgkJdW5zZWxlY3RlZDogbnVsbCwKCQl1bnNlbGVjdGluZzogbnVsbAoJfSwKCV9jcmVhdGU6IGZ1bmN0aW9uKCkgewoJCXZhciBzZWxlY3RlZXMsCgkJCXRoYXQgPSB0aGlzOwoKCQl0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLXNlbGVjdGFibGUiKTsKCgkJdGhpcy5kcmFnZ2VkID0gZmFsc2U7CgoJCS8vIGNhY2hlIHNlbGVjdGVlIGNoaWxkcmVuIGJhc2VkIG9uIGZpbHRlcgoJCXRoaXMucmVmcmVzaCA9IGZ1bmN0aW9uKCkgewoJCQlzZWxlY3RlZXMgPSAkKHRoYXQub3B0aW9ucy5maWx0ZXIsIHRoYXQuZWxlbWVudFswXSk7CgkJCXNlbGVjdGVlcy5hZGRDbGFzcygidWktc2VsZWN0ZWUiKTsKCQkJc2VsZWN0ZWVzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQl2YXIgJHRoaXMgPSAkKHRoaXMpLAoJCQkJCXBvcyA9ICR0aGlzLm9mZnNldCgpOwoJCQkJJC5kYXRhKHRoaXMsICJzZWxlY3RhYmxlLWl0ZW0iLCB7CgkJCQkJZWxlbWVudDogdGhpcywKCQkJCQkkZWxlbWVudDogJHRoaXMsCgkJCQkJbGVmdDogcG9zLmxlZnQsCgkJCQkJdG9wOiBwb3MudG9wLAoJCQkJCXJpZ2h0OiBwb3MubGVmdCArICR0aGlzLm91dGVyV2lkdGgoKSwKCQkJCQlib3R0b206IHBvcy50b3AgKyAkdGhpcy5vdXRlckhlaWdodCgpLAoJCQkJCXN0YXJ0c2VsZWN0ZWQ6IGZhbHNlLAoJCQkJCXNlbGVjdGVkOiAkdGhpcy5oYXNDbGFzcygidWktc2VsZWN0ZWQiKSwKCQkJCQlzZWxlY3Rpbmc6ICR0aGlzLmhhc0NsYXNzKCJ1aS1zZWxlY3RpbmciKSwKCQkJCQl1bnNlbGVjdGluZzogJHRoaXMuaGFzQ2xhc3MoInVpLXVuc2VsZWN0aW5nIikKCQkJCX0pOwoJCQl9KTsKCQl9OwoJCXRoaXMucmVmcmVzaCgpOwoKCQl0aGlzLnNlbGVjdGVlcyA9IHNlbGVjdGVlcy5hZGRDbGFzcygidWktc2VsZWN0ZWUiKTsKCgkJdGhpcy5fbW91c2VJbml0KCk7CgoJCXRoaXMuaGVscGVyID0gJCgiPGRpdiBjbGFzcz0ndWktc2VsZWN0YWJsZS1oZWxwZXInPjwvZGl2PiIpOwoJfSwKCglfZGVzdHJveTogZnVuY3Rpb24oKSB7CgkJdGhpcy5zZWxlY3RlZXMKCQkJLnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RlZSIpCgkJCS5yZW1vdmVEYXRhKCJzZWxlY3RhYmxlLWl0ZW0iKTsKCQl0aGlzLmVsZW1lbnQKCQkJLnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RhYmxlIHVpLXNlbGVjdGFibGUtZGlzYWJsZWQiKTsKCQl0aGlzLl9tb3VzZURlc3Ryb3koKTsKCX0sCgoJX21vdXNlU3RhcnQ6IGZ1bmN0aW9uKGV2ZW50KSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlvcHRpb25zID0gdGhpcy5vcHRpb25zOwoKCQl0aGlzLm9wb3MgPSBbZXZlbnQucGFnZVgsIGV2ZW50LnBhZ2VZXTsKCgkJaWYgKHRoaXMub3B0aW9ucy5kaXNhYmxlZCkgewoJCQlyZXR1cm47CgkJfQoKCQl0aGlzLnNlbGVjdGVlcyA9ICQob3B0aW9ucy5maWx0ZXIsIHRoaXMuZWxlbWVudFswXSk7CgoJCXRoaXMuX3RyaWdnZXIoInN0YXJ0IiwgZXZlbnQpOwoKCQkkKG9wdGlvbnMuYXBwZW5kVG8pLmFwcGVuZCh0aGlzLmhlbHBlcik7CgkJLy8gcG9zaXRpb24gaGVscGVyIChsYXNzbykKCQl0aGlzLmhlbHBlci5jc3MoewoJCQkibGVmdCI6IGV2ZW50LnBhZ2VYLAoJCQkidG9wIjogZXZlbnQucGFnZVksCgkJCSJ3aWR0aCI6IDAsCgkJCSJoZWlnaHQiOiAwCgkJfSk7CgoJCWlmIChvcHRpb25zLmF1dG9SZWZyZXNoKSB7CgkJCXRoaXMucmVmcmVzaCgpOwoJCX0KCgkJdGhpcy5zZWxlY3RlZXMuZmlsdGVyKCIudWktc2VsZWN0ZWQiKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgc2VsZWN0ZWUgPSAkLmRhdGEodGhpcywgInNlbGVjdGFibGUtaXRlbSIpOwoJCQlzZWxlY3RlZS5zdGFydHNlbGVjdGVkID0gdHJ1ZTsKCQkJaWYgKCFldmVudC5tZXRhS2V5ICYmICFldmVudC5jdHJsS2V5KSB7CgkJCQlzZWxlY3RlZS4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0ZWQiKTsKCQkJCXNlbGVjdGVlLnNlbGVjdGVkID0gZmFsc2U7CgkJCQlzZWxlY3RlZS4kZWxlbWVudC5hZGRDbGFzcygidWktdW5zZWxlY3RpbmciKTsKCQkJCXNlbGVjdGVlLnVuc2VsZWN0aW5nID0gdHJ1ZTsKCQkJCS8vIHNlbGVjdGFibGUgVU5TRUxFQ1RJTkcgY2FsbGJhY2sKCQkJCXRoYXQuX3RyaWdnZXIoInVuc2VsZWN0aW5nIiwgZXZlbnQsIHsKCQkJCQl1bnNlbGVjdGluZzogc2VsZWN0ZWUuZWxlbWVudAoJCQkJfSk7CgkJCX0KCQl9KTsKCgkJJChldmVudC50YXJnZXQpLnBhcmVudHMoKS5hZGRCYWNrKCkuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIGRvU2VsZWN0LAoJCQkJc2VsZWN0ZWUgPSAkLmRhdGEodGhpcywgInNlbGVjdGFibGUtaXRlbSIpOwoJCQlpZiAoc2VsZWN0ZWUpIHsKCQkJCWRvU2VsZWN0ID0gKCFldmVudC5tZXRhS2V5ICYmICFldmVudC5jdHJsS2V5KSB8fCAhc2VsZWN0ZWUuJGVsZW1lbnQuaGFzQ2xhc3MoInVpLXNlbGVjdGVkIik7CgkJCQlzZWxlY3RlZS4kZWxlbWVudAoJCQkJCS5yZW1vdmVDbGFzcyhkb1NlbGVjdCA/ICJ1aS11bnNlbGVjdGluZyIgOiAidWktc2VsZWN0ZWQiKQoJCQkJCS5hZGRDbGFzcyhkb1NlbGVjdCA/ICJ1aS1zZWxlY3RpbmciIDogInVpLXVuc2VsZWN0aW5nIik7CgkJCQlzZWxlY3RlZS51bnNlbGVjdGluZyA9ICFkb1NlbGVjdDsKCQkJCXNlbGVjdGVlLnNlbGVjdGluZyA9IGRvU2VsZWN0OwoJCQkJc2VsZWN0ZWUuc2VsZWN0ZWQgPSBkb1NlbGVjdDsKCQkJCS8vIHNlbGVjdGFibGUgKFVOKVNFTEVDVElORyBjYWxsYmFjawoJCQkJaWYgKGRvU2VsZWN0KSB7CgkJCQkJdGhhdC5fdHJpZ2dlcigic2VsZWN0aW5nIiwgZXZlbnQsIHsKCQkJCQkJc2VsZWN0aW5nOiBzZWxlY3RlZS5lbGVtZW50CgkJCQkJfSk7CgkJCQl9IGVsc2UgewoJCQkJCXRoYXQuX3RyaWdnZXIoInVuc2VsZWN0aW5nIiwgZXZlbnQsIHsKCQkJCQkJdW5zZWxlY3Rpbmc6IHNlbGVjdGVlLmVsZW1lbnQKCQkJCQl9KTsKCQkJCX0KCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCX0pOwoKCX0sCgoJX21vdXNlRHJhZzogZnVuY3Rpb24oZXZlbnQpIHsKCgkJdGhpcy5kcmFnZ2VkID0gdHJ1ZTsKCgkJaWYgKHRoaXMub3B0aW9ucy5kaXNhYmxlZCkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgdG1wLAoJCQl0aGF0ID0gdGhpcywKCQkJb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKCQkJeDEgPSB0aGlzLm9wb3NbMF0sCgkJCXkxID0gdGhpcy5vcG9zWzFdLAoJCQl4MiA9IGV2ZW50LnBhZ2VYLAoJCQl5MiA9IGV2ZW50LnBhZ2VZOwoKCQlpZiAoeDEgPiB4MikgeyB0bXAgPSB4MjsgeDIgPSB4MTsgeDEgPSB0bXA7IH0KCQlpZiAoeTEgPiB5MikgeyB0bXAgPSB5MjsgeTIgPSB5MTsgeTEgPSB0bXA7IH0KCQl0aGlzLmhlbHBlci5jc3Moe2xlZnQ6IHgxLCB0b3A6IHkxLCB3aWR0aDogeDIteDEsIGhlaWdodDogeTIteTF9KTsKCgkJdGhpcy5zZWxlY3RlZXMuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIHNlbGVjdGVlID0gJC5kYXRhKHRoaXMsICJzZWxlY3RhYmxlLWl0ZW0iKSwKCQkJCWhpdCA9IGZhbHNlOwoKCQkJLy9wcmV2ZW50IGhlbHBlciBmcm9tIGJlaW5nIHNlbGVjdGVkIGlmIGFwcGVuZFRvOiBzZWxlY3RhYmxlCgkJCWlmICghc2VsZWN0ZWUgfHwgc2VsZWN0ZWUuZWxlbWVudCA9PT0gdGhhdC5lbGVtZW50WzBdKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmIChvcHRpb25zLnRvbGVyYW5jZSA9PT0gInRvdWNoIikgewoJCQkJaGl0ID0gKCAhKHNlbGVjdGVlLmxlZnQgPiB4MiB8fCBzZWxlY3RlZS5yaWdodCA8IHgxIHx8IHNlbGVjdGVlLnRvcCA+IHkyIHx8IHNlbGVjdGVlLmJvdHRvbSA8IHkxKSApOwoJCQl9IGVsc2UgaWYgKG9wdGlvbnMudG9sZXJhbmNlID09PSAiZml0IikgewoJCQkJaGl0ID0gKHNlbGVjdGVlLmxlZnQgPiB4MSAmJiBzZWxlY3RlZS5yaWdodCA8IHgyICYmIHNlbGVjdGVlLnRvcCA+IHkxICYmIHNlbGVjdGVlLmJvdHRvbSA8IHkyKTsKCQkJfQoKCQkJaWYgKGhpdCkgewoJCQkJLy8gU0VMRUNUCgkJCQlpZiAoc2VsZWN0ZWUuc2VsZWN0ZWQpIHsKCQkJCQlzZWxlY3RlZS4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0ZWQiKTsKCQkJCQlzZWxlY3RlZS5zZWxlY3RlZCA9IGZhbHNlOwoJCQkJfQoJCQkJaWYgKHNlbGVjdGVlLnVuc2VsZWN0aW5nKSB7CgkJCQkJc2VsZWN0ZWUuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXVuc2VsZWN0aW5nIik7CgkJCQkJc2VsZWN0ZWUudW5zZWxlY3RpbmcgPSBmYWxzZTsKCQkJCX0KCQkJCWlmICghc2VsZWN0ZWUuc2VsZWN0aW5nKSB7CgkJCQkJc2VsZWN0ZWUuJGVsZW1lbnQuYWRkQ2xhc3MoInVpLXNlbGVjdGluZyIpOwoJCQkJCXNlbGVjdGVlLnNlbGVjdGluZyA9IHRydWU7CgkJCQkJLy8gc2VsZWN0YWJsZSBTRUxFQ1RJTkcgY2FsbGJhY2sKCQkJCQl0aGF0Ll90cmlnZ2VyKCJzZWxlY3RpbmciLCBldmVudCwgewoJCQkJCQlzZWxlY3Rpbmc6IHNlbGVjdGVlLmVsZW1lbnQKCQkJCQl9KTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCS8vIFVOU0VMRUNUCgkJCQlpZiAoc2VsZWN0ZWUuc2VsZWN0aW5nKSB7CgkJCQkJaWYgKChldmVudC5tZXRhS2V5IHx8IGV2ZW50LmN0cmxLZXkpICYmIHNlbGVjdGVlLnN0YXJ0c2VsZWN0ZWQpIHsKCQkJCQkJc2VsZWN0ZWUuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGluZyIpOwoJCQkJCQlzZWxlY3RlZS5zZWxlY3RpbmcgPSBmYWxzZTsKCQkJCQkJc2VsZWN0ZWUuJGVsZW1lbnQuYWRkQ2xhc3MoInVpLXNlbGVjdGVkIik7CgkJCQkJCXNlbGVjdGVlLnNlbGVjdGVkID0gdHJ1ZTsKCQkJCQl9IGVsc2UgewoJCQkJCQlzZWxlY3RlZS4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0aW5nIik7CgkJCQkJCXNlbGVjdGVlLnNlbGVjdGluZyA9IGZhbHNlOwoJCQkJCQlpZiAoc2VsZWN0ZWUuc3RhcnRzZWxlY3RlZCkgewoJCQkJCQkJc2VsZWN0ZWUuJGVsZW1lbnQuYWRkQ2xhc3MoInVpLXVuc2VsZWN0aW5nIik7CgkJCQkJCQlzZWxlY3RlZS51bnNlbGVjdGluZyA9IHRydWU7CgkJCQkJCX0KCQkJCQkJLy8gc2VsZWN0YWJsZSBVTlNFTEVDVElORyBjYWxsYmFjawoJCQkJCQl0aGF0Ll90cmlnZ2VyKCJ1bnNlbGVjdGluZyIsIGV2ZW50LCB7CgkJCQkJCQl1bnNlbGVjdGluZzogc2VsZWN0ZWUuZWxlbWVudAoJCQkJCQl9KTsKCQkJCQl9CgkJCQl9CgkJCQlpZiAoc2VsZWN0ZWUuc2VsZWN0ZWQpIHsKCQkJCQlpZiAoIWV2ZW50Lm1ldGFLZXkgJiYgIWV2ZW50LmN0cmxLZXkgJiYgIXNlbGVjdGVlLnN0YXJ0c2VsZWN0ZWQpIHsKCQkJCQkJc2VsZWN0ZWUuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGVkIik7CgkJCQkJCXNlbGVjdGVlLnNlbGVjdGVkID0gZmFsc2U7CgoJCQkJCQlzZWxlY3RlZS4kZWxlbWVudC5hZGRDbGFzcygidWktdW5zZWxlY3RpbmciKTsKCQkJCQkJc2VsZWN0ZWUudW5zZWxlY3RpbmcgPSB0cnVlOwoJCQkJCQkvLyBzZWxlY3RhYmxlIFVOU0VMRUNUSU5HIGNhbGxiYWNrCgkJCQkJCXRoYXQuX3RyaWdnZXIoInVuc2VsZWN0aW5nIiwgZXZlbnQsIHsKCQkJCQkJCXVuc2VsZWN0aW5nOiBzZWxlY3RlZS5lbGVtZW50CgkJCQkJCX0pOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0pOwoKCQlyZXR1cm4gZmFsc2U7Cgl9LAoKCV9tb3VzZVN0b3A6IGZ1bmN0aW9uKGV2ZW50KSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoKCQl0aGlzLmRyYWdnZWQgPSBmYWxzZTsKCgkJJCgiLnVpLXVuc2VsZWN0aW5nIiwgdGhpcy5lbGVtZW50WzBdKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgc2VsZWN0ZWUgPSAkLmRhdGEodGhpcywgInNlbGVjdGFibGUtaXRlbSIpOwoJCQlzZWxlY3RlZS4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktdW5zZWxlY3RpbmciKTsKCQkJc2VsZWN0ZWUudW5zZWxlY3RpbmcgPSBmYWxzZTsKCQkJc2VsZWN0ZWUuc3RhcnRzZWxlY3RlZCA9IGZhbHNlOwoJCQl0aGF0Ll90cmlnZ2VyKCJ1bnNlbGVjdGVkIiwgZXZlbnQsIHsKCQkJCXVuc2VsZWN0ZWQ6IHNlbGVjdGVlLmVsZW1lbnQKCQkJfSk7CgkJfSk7CgkJJCgiLnVpLXNlbGVjdGluZyIsIHRoaXMuZWxlbWVudFswXSkuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIHNlbGVjdGVlID0gJC5kYXRhKHRoaXMsICJzZWxlY3RhYmxlLWl0ZW0iKTsKCQkJc2VsZWN0ZWUuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGluZyIpLmFkZENsYXNzKCJ1aS1zZWxlY3RlZCIpOwoJCQlzZWxlY3RlZS5zZWxlY3RpbmcgPSBmYWxzZTsKCQkJc2VsZWN0ZWUuc2VsZWN0ZWQgPSB0cnVlOwoJCQlzZWxlY3RlZS5zdGFydHNlbGVjdGVkID0gdHJ1ZTsKCQkJdGhhdC5fdHJpZ2dlcigic2VsZWN0ZWQiLCBldmVudCwgewoJCQkJc2VsZWN0ZWQ6IHNlbGVjdGVlLmVsZW1lbnQKCQkJfSk7CgkJfSk7CgkJdGhpcy5fdHJpZ2dlcigic3RvcCIsIGV2ZW50KTsKCgkJdGhpcy5oZWxwZXIucmVtb3ZlKCk7CgoJCXJldHVybiBmYWxzZTsKCX0KCn0pOwoKfSkoalF1ZXJ5KTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKZnVuY3Rpb24gaXNPdmVyQXhpcyggeCwgcmVmZXJlbmNlLCBzaXplICkgewoJcmV0dXJuICggeCA+IHJlZmVyZW5jZSApICYmICggeCA8ICggcmVmZXJlbmNlICsgc2l6ZSApICk7Cn0KCmZ1bmN0aW9uIGlzRmxvYXRpbmcoaXRlbSkgewoJcmV0dXJuICgvbGVmdHxyaWdodC8pLnRlc3QoaXRlbS5jc3MoImZsb2F0IikpIHx8ICgvaW5saW5lfHRhYmxlLWNlbGwvKS50ZXN0KGl0ZW0uY3NzKCJkaXNwbGF5IikpOwp9CgokLndpZGdldCgidWkuc29ydGFibGUiLCAkLnVpLm1vdXNlLCB7Cgl2ZXJzaW9uOiAiMS4xMC40IiwKCXdpZGdldEV2ZW50UHJlZml4OiAic29ydCIsCglyZWFkeTogZmFsc2UsCglvcHRpb25zOiB7CgkJYXBwZW5kVG86ICJwYXJlbnQiLAoJCWF4aXM6IGZhbHNlLAoJCWNvbm5lY3RXaXRoOiBmYWxzZSwKCQljb250YWlubWVudDogZmFsc2UsCgkJY3Vyc29yOiAiYXV0byIsCgkJY3Vyc29yQXQ6IGZhbHNlLAoJCWRyb3BPbkVtcHR5OiB0cnVlLAoJCWZvcmNlUGxhY2Vob2xkZXJTaXplOiBmYWxzZSwKCQlmb3JjZUhlbHBlclNpemU6IGZhbHNlLAoJCWdyaWQ6IGZhbHNlLAoJCWhhbmRsZTogZmFsc2UsCgkJaGVscGVyOiAib3JpZ2luYWwiLAoJCWl0ZW1zOiAiPiAqIiwKCQlvcGFjaXR5OiBmYWxzZSwKCQlwbGFjZWhvbGRlcjogZmFsc2UsCgkJcmV2ZXJ0OiBmYWxzZSwKCQlzY3JvbGw6IHRydWUsCgkJc2Nyb2xsU2Vuc2l0aXZpdHk6IDIwLAoJCXNjcm9sbFNwZWVkOiAyMCwKCQlzY29wZTogImRlZmF1bHQiLAoJCXRvbGVyYW5jZTogImludGVyc2VjdCIsCgkJekluZGV4OiAxMDAwLAoKCQkvLyBjYWxsYmFja3MKCQlhY3RpdmF0ZTogbnVsbCwKCQliZWZvcmVTdG9wOiBudWxsLAoJCWNoYW5nZTogbnVsbCwKCQlkZWFjdGl2YXRlOiBudWxsLAoJCW91dDogbnVsbCwKCQlvdmVyOiBudWxsLAoJCXJlY2VpdmU6IG51bGwsCgkJcmVtb3ZlOiBudWxsLAoJCXNvcnQ6IG51bGwsCgkJc3RhcnQ6IG51bGwsCgkJc3RvcDogbnVsbCwKCQl1cGRhdGU6IG51bGwKCX0sCglfY3JlYXRlOiBmdW5jdGlvbigpIHsKCgkJdmFyIG8gPSB0aGlzLm9wdGlvbnM7CgkJdGhpcy5jb250YWluZXJDYWNoZSA9IHt9OwoJCXRoaXMuZWxlbWVudC5hZGRDbGFzcygidWktc29ydGFibGUiKTsKCgkJLy9HZXQgdGhlIGl0ZW1zCgkJdGhpcy5yZWZyZXNoKCk7CgoJCS8vTGV0J3MgZGV0ZXJtaW5lIGlmIHRoZSBpdGVtcyBhcmUgYmVpbmcgZGlzcGxheWVkIGhvcml6b250YWxseQoJCXRoaXMuZmxvYXRpbmcgPSB0aGlzLml0ZW1zLmxlbmd0aCA/IG8uYXhpcyA9PT0gIngiIHx8IGlzRmxvYXRpbmcodGhpcy5pdGVtc1swXS5pdGVtKSA6IGZhbHNlOwoKCQkvL0xldCdzIGRldGVybWluZSB0aGUgcGFyZW50J3Mgb2Zmc2V0CgkJdGhpcy5vZmZzZXQgPSB0aGlzLmVsZW1lbnQub2Zmc2V0KCk7CgoJCS8vSW5pdGlhbGl6ZSBtb3VzZSBldmVudHMgZm9yIGludGVyYWN0aW9uCgkJdGhpcy5fbW91c2VJbml0KCk7CgoJCS8vV2UncmUgcmVhZHkgdG8gZ28KCQl0aGlzLnJlYWR5ID0gdHJ1ZTsKCgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQl0aGlzLmVsZW1lbnQKCQkJLnJlbW92ZUNsYXNzKCJ1aS1zb3J0YWJsZSB1aS1zb3J0YWJsZS1kaXNhYmxlZCIpOwoJCXRoaXMuX21vdXNlRGVzdHJveSgpOwoKCQlmb3IgKCB2YXIgaSA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0gKSB7CgkJCXRoaXMuaXRlbXNbaV0uaXRlbS5yZW1vdmVEYXRhKHRoaXMud2lkZ2V0TmFtZSArICItaXRlbSIpOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCV9zZXRPcHRpb246IGZ1bmN0aW9uKGtleSwgdmFsdWUpewoJCWlmICgga2V5ID09PSAiZGlzYWJsZWQiICkgewoJCQl0aGlzLm9wdGlvbnNbIGtleSBdID0gdmFsdWU7CgoJCQl0aGlzLndpZGdldCgpLnRvZ2dsZUNsYXNzKCAidWktc29ydGFibGUtZGlzYWJsZWQiLCAhIXZhbHVlICk7CgkJfSBlbHNlIHsKCQkJLy8gRG9uJ3QgY2FsbCB3aWRnZXQgYmFzZSBfc2V0T3B0aW9uIGZvciBkaXNhYmxlIGFzIGl0IGFkZHMgdWktc3RhdGUtZGlzYWJsZWQgY2xhc3MKCQkJJC5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQl9Cgl9LAoKCV9tb3VzZUNhcHR1cmU6IGZ1bmN0aW9uKGV2ZW50LCBvdmVycmlkZUhhbmRsZSkgewoJCXZhciBjdXJyZW50SXRlbSA9IG51bGwsCgkJCXZhbGlkSGFuZGxlID0gZmFsc2UsCgkJCXRoYXQgPSB0aGlzOwoKCQlpZiAodGhpcy5yZXZlcnRpbmcpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJaWYodGhpcy5vcHRpb25zLmRpc2FibGVkIHx8IHRoaXMub3B0aW9ucy50eXBlID09PSAic3RhdGljIikgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkvL1dlIGhhdmUgdG8gcmVmcmVzaCB0aGUgaXRlbXMgZGF0YSBvbmNlIGZpcnN0CgkJdGhpcy5fcmVmcmVzaEl0ZW1zKGV2ZW50KTsKCgkJLy9GaW5kIG91dCBpZiB0aGUgY2xpY2tlZCBub2RlIChvciBvbmUgb2YgaXRzIHBhcmVudHMpIGlzIGEgYWN0dWFsIGl0ZW0gaW4gdGhpcy5pdGVtcwoJCSQoZXZlbnQudGFyZ2V0KS5wYXJlbnRzKCkuZWFjaChmdW5jdGlvbigpIHsKCQkJaWYoJC5kYXRhKHRoaXMsIHRoYXQud2lkZ2V0TmFtZSArICItaXRlbSIpID09PSB0aGF0KSB7CgkJCQljdXJyZW50SXRlbSA9ICQodGhpcyk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9KTsKCQlpZigkLmRhdGEoZXZlbnQudGFyZ2V0LCB0aGF0LndpZGdldE5hbWUgKyAiLWl0ZW0iKSA9PT0gdGhhdCkgewoJCQljdXJyZW50SXRlbSA9ICQoZXZlbnQudGFyZ2V0KTsKCQl9CgoJCWlmKCFjdXJyZW50SXRlbSkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCWlmKHRoaXMub3B0aW9ucy5oYW5kbGUgJiYgIW92ZXJyaWRlSGFuZGxlKSB7CgkJCSQodGhpcy5vcHRpb25zLmhhbmRsZSwgY3VycmVudEl0ZW0pLmZpbmQoIioiKS5hZGRCYWNrKCkuZWFjaChmdW5jdGlvbigpIHsKCQkJCWlmKHRoaXMgPT09IGV2ZW50LnRhcmdldCkgewoJCQkJCXZhbGlkSGFuZGxlID0gdHJ1ZTsKCQkJCX0KCQkJfSk7CgkJCWlmKCF2YWxpZEhhbmRsZSkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfQoKCQl0aGlzLmN1cnJlbnRJdGVtID0gY3VycmVudEl0ZW07CgkJdGhpcy5fcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXMoKTsKCQlyZXR1cm4gdHJ1ZTsKCgl9LAoKCV9tb3VzZVN0YXJ0OiBmdW5jdGlvbihldmVudCwgb3ZlcnJpZGVIYW5kbGUsIG5vQWN0aXZhdGlvbikgewoKCQl2YXIgaSwgYm9keSwKCQkJbyA9IHRoaXMub3B0aW9uczsKCgkJdGhpcy5jdXJyZW50Q29udGFpbmVyID0gdGhpczsKCgkJLy9XZSBvbmx5IG5lZWQgdG8gY2FsbCByZWZyZXNoUG9zaXRpb25zLCBiZWNhdXNlIHRoZSByZWZyZXNoSXRlbXMgY2FsbCBoYXMgYmVlbiBtb3ZlZCB0byBtb3VzZUNhcHR1cmUKCQl0aGlzLnJlZnJlc2hQb3NpdGlvbnMoKTsKCgkJLy9DcmVhdGUgYW5kIGFwcGVuZCB0aGUgdmlzaWJsZSBoZWxwZXIKCQl0aGlzLmhlbHBlciA9IHRoaXMuX2NyZWF0ZUhlbHBlcihldmVudCk7CgoJCS8vQ2FjaGUgdGhlIGhlbHBlciBzaXplCgkJdGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpOwoKCQkvKgoJCSAqIC0gUG9zaXRpb24gZ2VuZXJhdGlvbiAtCgkJICogVGhpcyBibG9jayBnZW5lcmF0ZXMgZXZlcnl0aGluZyBwb3NpdGlvbiByZWxhdGVkIC0gaXQncyB0aGUgY29yZSBvZiBkcmFnZ2FibGVzLgoJCSAqLwoKCQkvL0NhY2hlIHRoZSBtYXJnaW5zIG9mIHRoZSBvcmlnaW5hbCBlbGVtZW50CgkJdGhpcy5fY2FjaGVNYXJnaW5zKCk7CgoJCS8vR2V0IHRoZSBuZXh0IHNjcm9sbGluZyBwYXJlbnQKCQl0aGlzLnNjcm9sbFBhcmVudCA9IHRoaXMuaGVscGVyLnNjcm9sbFBhcmVudCgpOwoKCQkvL1RoZSBlbGVtZW50J3MgYWJzb2x1dGUgcG9zaXRpb24gb24gdGhlIHBhZ2UgbWludXMgbWFyZ2lucwoJCXRoaXMub2Zmc2V0ID0gdGhpcy5jdXJyZW50SXRlbS5vZmZzZXQoKTsKCQl0aGlzLm9mZnNldCA9IHsKCQkJdG9wOiB0aGlzLm9mZnNldC50b3AgLSB0aGlzLm1hcmdpbnMudG9wLAoJCQlsZWZ0OiB0aGlzLm9mZnNldC5sZWZ0IC0gdGhpcy5tYXJnaW5zLmxlZnQKCQl9OwoKCQkkLmV4dGVuZCh0aGlzLm9mZnNldCwgewoJCQljbGljazogeyAvL1doZXJlIHRoZSBjbGljayBoYXBwZW5lZCwgcmVsYXRpdmUgdG8gdGhlIGVsZW1lbnQKCQkJCWxlZnQ6IGV2ZW50LnBhZ2VYIC0gdGhpcy5vZmZzZXQubGVmdCwKCQkJCXRvcDogZXZlbnQucGFnZVkgLSB0aGlzLm9mZnNldC50b3AKCQkJfSwKCQkJcGFyZW50OiB0aGlzLl9nZXRQYXJlbnRPZmZzZXQoKSwKCQkJcmVsYXRpdmU6IHRoaXMuX2dldFJlbGF0aXZlT2Zmc2V0KCkgLy9UaGlzIGlzIGEgcmVsYXRpdmUgdG8gYWJzb2x1dGUgcG9zaXRpb24gbWludXMgdGhlIGFjdHVhbCBwb3NpdGlvbiBjYWxjdWxhdGlvbiAtIG9ubHkgdXNlZCBmb3IgcmVsYXRpdmUgcG9zaXRpb25lZCBoZWxwZXIKCQl9KTsKCgkJLy8gT25seSBhZnRlciB3ZSBnb3QgdGhlIG9mZnNldCwgd2UgY2FuIGNoYW5nZSB0aGUgaGVscGVyJ3MgcG9zaXRpb24gdG8gYWJzb2x1dGUKCQkvLyBUT0RPOiBTdGlsbCBuZWVkIHRvIGZpZ3VyZSBvdXQgYSB3YXkgdG8gbWFrZSByZWxhdGl2ZSBzb3J0aW5nIHBvc3NpYmxlCgkJdGhpcy5oZWxwZXIuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpOwoJCXRoaXMuY3NzUG9zaXRpb24gPSB0aGlzLmhlbHBlci5jc3MoInBvc2l0aW9uIik7CgoJCS8vR2VuZXJhdGUgdGhlIG9yaWdpbmFsIHBvc2l0aW9uCgkJdGhpcy5vcmlnaW5hbFBvc2l0aW9uID0gdGhpcy5fZ2VuZXJhdGVQb3NpdGlvbihldmVudCk7CgkJdGhpcy5vcmlnaW5hbFBhZ2VYID0gZXZlbnQucGFnZVg7CgkJdGhpcy5vcmlnaW5hbFBhZ2VZID0gZXZlbnQucGFnZVk7CgoJCS8vQWRqdXN0IHRoZSBtb3VzZSBvZmZzZXQgcmVsYXRpdmUgdG8gdGhlIGhlbHBlciBpZiAiY3Vyc29yQXQiIGlzIHN1cHBsaWVkCgkJKG8uY3Vyc29yQXQgJiYgdGhpcy5fYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcihvLmN1cnNvckF0KSk7CgoJCS8vQ2FjaGUgdGhlIGZvcm1lciBET00gcG9zaXRpb24KCQl0aGlzLmRvbVBvc2l0aW9uID0geyBwcmV2OiB0aGlzLmN1cnJlbnRJdGVtLnByZXYoKVswXSwgcGFyZW50OiB0aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpWzBdIH07CgoJCS8vSWYgdGhlIGhlbHBlciBpcyBub3QgdGhlIG9yaWdpbmFsLCBoaWRlIHRoZSBvcmlnaW5hbCBzbyBpdCdzIG5vdCBwbGF5aW5nIGFueSByb2xlIGR1cmluZyB0aGUgZHJhZywgd29uJ3QgY2F1c2UgYW55dGhpbmcgYmFkIHRoaXMgd2F5CgkJaWYodGhpcy5oZWxwZXJbMF0gIT09IHRoaXMuY3VycmVudEl0ZW1bMF0pIHsKCQkJdGhpcy5jdXJyZW50SXRlbS5oaWRlKCk7CgkJfQoKCQkvL0NyZWF0ZSB0aGUgcGxhY2Vob2xkZXIKCQl0aGlzLl9jcmVhdGVQbGFjZWhvbGRlcigpOwoKCQkvL1NldCBhIGNvbnRhaW5tZW50IGlmIGdpdmVuIGluIHRoZSBvcHRpb25zCgkJaWYoby5jb250YWlubWVudCkgewoJCQl0aGlzLl9zZXRDb250YWlubWVudCgpOwoJCX0KCgkJaWYoIG8uY3Vyc29yICYmIG8uY3Vyc29yICE9PSAiYXV0byIgKSB7IC8vIGN1cnNvciBvcHRpb24KCQkJYm9keSA9IHRoaXMuZG9jdW1lbnQuZmluZCggImJvZHkiICk7CgoJCQkvLyBzdXBwb3J0OiBJRQoJCQl0aGlzLnN0b3JlZEN1cnNvciA9IGJvZHkuY3NzKCAiY3Vyc29yIiApOwoJCQlib2R5LmNzcyggImN1cnNvciIsIG8uY3Vyc29yICk7CgoJCQl0aGlzLnN0b3JlZFN0eWxlc2hlZXQgPSAkKCAiPHN0eWxlPip7IGN1cnNvcjogIitvLmN1cnNvcisiICFpbXBvcnRhbnQ7IH08L3N0eWxlPiIgKS5hcHBlbmRUbyggYm9keSApOwoJCX0KCgkJaWYoby5vcGFjaXR5KSB7IC8vIG9wYWNpdHkgb3B0aW9uCgkJCWlmICh0aGlzLmhlbHBlci5jc3MoIm9wYWNpdHkiKSkgewoJCQkJdGhpcy5fc3RvcmVkT3BhY2l0eSA9IHRoaXMuaGVscGVyLmNzcygib3BhY2l0eSIpOwoJCQl9CgkJCXRoaXMuaGVscGVyLmNzcygib3BhY2l0eSIsIG8ub3BhY2l0eSk7CgkJfQoKCQlpZihvLnpJbmRleCkgeyAvLyB6SW5kZXggb3B0aW9uCgkJCWlmICh0aGlzLmhlbHBlci5jc3MoInpJbmRleCIpKSB7CgkJCQl0aGlzLl9zdG9yZWRaSW5kZXggPSB0aGlzLmhlbHBlci5jc3MoInpJbmRleCIpOwoJCQl9CgkJCXRoaXMuaGVscGVyLmNzcygiekluZGV4Iiwgby56SW5kZXgpOwoJCX0KCgkJLy9QcmVwYXJlIHNjcm9sbGluZwoJCWlmKHRoaXMuc2Nyb2xsUGFyZW50WzBdICE9PSBkb2N1bWVudCAmJiB0aGlzLnNjcm9sbFBhcmVudFswXS50YWdOYW1lICE9PSAiSFRNTCIpIHsKCQkJdGhpcy5vdmVyZmxvd09mZnNldCA9IHRoaXMuc2Nyb2xsUGFyZW50Lm9mZnNldCgpOwoJCX0KCgkJLy9DYWxsIGNhbGxiYWNrcwoJCXRoaXMuX3RyaWdnZXIoInN0YXJ0IiwgZXZlbnQsIHRoaXMuX3VpSGFzaCgpKTsKCgkJLy9SZWNhY2hlIHRoZSBoZWxwZXIgc2l6ZQoJCWlmKCF0aGlzLl9wcmVzZXJ2ZUhlbHBlclByb3BvcnRpb25zKSB7CgkJCXRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKTsKCQl9CgoKCQkvL1Bvc3QgImFjdGl2YXRlIiBldmVudHMgdG8gcG9zc2libGUgY29udGFpbmVycwoJCWlmKCAhbm9BY3RpdmF0aW9uICkgewoJCQlmb3IgKCBpID0gdGhpcy5jb250YWluZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tICkgewoJCQkJdGhpcy5jb250YWluZXJzWyBpIF0uX3RyaWdnZXIoICJhY3RpdmF0ZSIsIGV2ZW50LCB0aGlzLl91aUhhc2goIHRoaXMgKSApOwoJCQl9CgkJfQoKCQkvL1ByZXBhcmUgcG9zc2libGUgZHJvcHBhYmxlcwoJCWlmKCQudWkuZGRtYW5hZ2VyKSB7CgkJCSQudWkuZGRtYW5hZ2VyLmN1cnJlbnQgPSB0aGlzOwoJCX0KCgkJaWYgKCQudWkuZGRtYW5hZ2VyICYmICFvLmRyb3BCZWhhdmlvdXIpIHsKCQkJJC51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHModGhpcywgZXZlbnQpOwoJCX0KCgkJdGhpcy5kcmFnZ2luZyA9IHRydWU7CgoJCXRoaXMuaGVscGVyLmFkZENsYXNzKCJ1aS1zb3J0YWJsZS1oZWxwZXIiKTsKCQl0aGlzLl9tb3VzZURyYWcoZXZlbnQpOyAvL0V4ZWN1dGUgdGhlIGRyYWcgb25jZSAtIHRoaXMgY2F1c2VzIHRoZSBoZWxwZXIgbm90IHRvIGJlIHZpc2libGUgYmVmb3JlIGdldHRpbmcgaXRzIGNvcnJlY3QgcG9zaXRpb24KCQlyZXR1cm4gdHJ1ZTsKCgl9LAoKCV9tb3VzZURyYWc6IGZ1bmN0aW9uKGV2ZW50KSB7CgkJdmFyIGksIGl0ZW0sIGl0ZW1FbGVtZW50LCBpbnRlcnNlY3Rpb24sCgkJCW8gPSB0aGlzLm9wdGlvbnMsCgkJCXNjcm9sbGVkID0gZmFsc2U7CgoJCS8vQ29tcHV0ZSB0aGUgaGVscGVycyBwb3NpdGlvbgoJCXRoaXMucG9zaXRpb24gPSB0aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKGV2ZW50KTsKCQl0aGlzLnBvc2l0aW9uQWJzID0gdGhpcy5fY29udmVydFBvc2l0aW9uVG8oImFic29sdXRlIik7CgoJCWlmICghdGhpcy5sYXN0UG9zaXRpb25BYnMpIHsKCQkJdGhpcy5sYXN0UG9zaXRpb25BYnMgPSB0aGlzLnBvc2l0aW9uQWJzOwoJCX0KCgkJLy9EbyBzY3JvbGxpbmcKCQlpZih0aGlzLm9wdGlvbnMuc2Nyb2xsKSB7CgkJCWlmKHRoaXMuc2Nyb2xsUGFyZW50WzBdICE9PSBkb2N1bWVudCAmJiB0aGlzLnNjcm9sbFBhcmVudFswXS50YWdOYW1lICE9PSAiSFRNTCIpIHsKCgkJCQlpZigodGhpcy5vdmVyZmxvd09mZnNldC50b3AgKyB0aGlzLnNjcm9sbFBhcmVudFswXS5vZmZzZXRIZWlnaHQpIC0gZXZlbnQucGFnZVkgPCBvLnNjcm9sbFNlbnNpdGl2aXR5KSB7CgkJCQkJdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wID0gc2Nyb2xsZWQgPSB0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AgKyBvLnNjcm9sbFNwZWVkOwoJCQkJfSBlbHNlIGlmKGV2ZW50LnBhZ2VZIC0gdGhpcy5vdmVyZmxvd09mZnNldC50b3AgPCBvLnNjcm9sbFNlbnNpdGl2aXR5KSB7CgkJCQkJdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wID0gc2Nyb2xsZWQgPSB0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AgLSBvLnNjcm9sbFNwZWVkOwoJCQkJfQoKCQkJCWlmKCh0aGlzLm92ZXJmbG93T2Zmc2V0LmxlZnQgKyB0aGlzLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aCkgLSBldmVudC5wYWdlWCA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQl0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0ID0gc2Nyb2xsZWQgPSB0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0ICsgby5zY3JvbGxTcGVlZDsKCQkJCX0gZWxzZSBpZihldmVudC5wYWdlWCAtIHRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdCA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQl0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0ID0gc2Nyb2xsZWQgPSB0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0IC0gby5zY3JvbGxTcGVlZDsKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJaWYoZXZlbnQucGFnZVkgLSAkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSAtIG8uc2Nyb2xsU3BlZWQpOwoJCQkJfSBlbHNlIGlmKCQod2luZG93KS5oZWlnaHQoKSAtIChldmVudC5wYWdlWSAtICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpKSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSArIG8uc2Nyb2xsU3BlZWQpOwoJCQkJfQoKCQkJCWlmKGV2ZW50LnBhZ2VYIC0gJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpIDwgby5zY3JvbGxTZW5zaXRpdml0eSkgewoJCQkJCXNjcm9sbGVkID0gJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkgLSBvLnNjcm9sbFNwZWVkKTsKCQkJCX0gZWxzZSBpZigkKHdpbmRvdykud2lkdGgoKSAtIChldmVudC5wYWdlWCAtICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSkgPCBvLnNjcm9sbFNlbnNpdGl2aXR5KSB7CgkJCQkJc2Nyb2xsZWQgPSAkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSArIG8uc2Nyb2xsU3BlZWQpOwoJCQkJfQoKCQkJfQoKCQkJaWYoc2Nyb2xsZWQgIT09IGZhbHNlICYmICQudWkuZGRtYW5hZ2VyICYmICFvLmRyb3BCZWhhdmlvdXIpIHsKCQkJCSQudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsIGV2ZW50KTsKCQkJfQoJCX0KCgkJLy9SZWdlbmVyYXRlIHRoZSBhYnNvbHV0ZSBwb3NpdGlvbiB1c2VkIGZvciBwb3NpdGlvbiBjaGVja3MKCQl0aGlzLnBvc2l0aW9uQWJzID0gdGhpcy5fY29udmVydFBvc2l0aW9uVG8oImFic29sdXRlIik7CgoJCS8vU2V0IHRoZSBoZWxwZXIgcG9zaXRpb24KCQlpZighdGhpcy5vcHRpb25zLmF4aXMgfHwgdGhpcy5vcHRpb25zLmF4aXMgIT09ICJ5IikgewoJCQl0aGlzLmhlbHBlclswXS5zdHlsZS5sZWZ0ID0gdGhpcy5wb3NpdGlvbi5sZWZ0KyJweCI7CgkJfQoJCWlmKCF0aGlzLm9wdGlvbnMuYXhpcyB8fCB0aGlzLm9wdGlvbnMuYXhpcyAhPT0gIngiKSB7CgkJCXRoaXMuaGVscGVyWzBdLnN0eWxlLnRvcCA9IHRoaXMucG9zaXRpb24udG9wKyJweCI7CgkJfQoKCQkvL1JlYXJyYW5nZQoJCWZvciAoaSA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKCgkJCS8vQ2FjaGUgdmFyaWFibGVzIGFuZCBpbnRlcnNlY3Rpb24sIGNvbnRpbnVlIGlmIG5vIGludGVyc2VjdGlvbgoJCQlpdGVtID0gdGhpcy5pdGVtc1tpXTsKCQkJaXRlbUVsZW1lbnQgPSBpdGVtLml0ZW1bMF07CgkJCWludGVyc2VjdGlvbiA9IHRoaXMuX2ludGVyc2VjdHNXaXRoUG9pbnRlcihpdGVtKTsKCQkJaWYgKCFpbnRlcnNlY3Rpb24pIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQkvLyBPbmx5IHB1dCB0aGUgcGxhY2Vob2xkZXIgaW5zaWRlIHRoZSBjdXJyZW50IENvbnRhaW5lciwgc2tpcCBhbGwKCQkJLy8gaXRlbXMgZnJvbSBvdGhlciBjb250YWluZXJzLiBUaGlzIHdvcmtzIGJlY2F1c2Ugd2hlbiBtb3ZpbmcKCQkJLy8gYW4gaXRlbSBmcm9tIG9uZSBjb250YWluZXIgdG8gYW5vdGhlciB0aGUKCQkJLy8gY3VycmVudENvbnRhaW5lciBpcyBzd2l0Y2hlZCBiZWZvcmUgdGhlIHBsYWNlaG9sZGVyIGlzIG1vdmVkLgoJCQkvLwoJCQkvLyBXaXRob3V0IHRoaXMsIG1vdmluZyBpdGVtcyBpbiAic3ViLXNvcnRhYmxlcyIgY2FuIGNhdXNlCgkJCS8vIHRoZSBwbGFjZWhvbGRlciB0byBqaXR0ZXIgYmVldHdlZW4gdGhlIG91dGVyIGFuZCBpbm5lciBjb250YWluZXIuCgkJCWlmIChpdGVtLmluc3RhbmNlICE9PSB0aGlzLmN1cnJlbnRDb250YWluZXIpIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQkvLyBjYW5ub3QgaW50ZXJzZWN0IHdpdGggaXRzZWxmCgkJCS8vIG5vIHVzZWxlc3MgYWN0aW9ucyB0aGF0IGhhdmUgYmVlbiBkb25lIGJlZm9yZQoJCQkvLyBubyBhY3Rpb24gaWYgdGhlIGl0ZW0gbW92ZWQgaXMgdGhlIHBhcmVudCBvZiB0aGUgaXRlbSBjaGVja2VkCgkJCWlmIChpdGVtRWxlbWVudCAhPT0gdGhpcy5jdXJyZW50SXRlbVswXSAmJgoJCQkJdGhpcy5wbGFjZWhvbGRlcltpbnRlcnNlY3Rpb24gPT09IDEgPyAibmV4dCIgOiAicHJldiJdKClbMF0gIT09IGl0ZW1FbGVtZW50ICYmCgkJCQkhJC5jb250YWlucyh0aGlzLnBsYWNlaG9sZGVyWzBdLCBpdGVtRWxlbWVudCkgJiYKCQkJCSh0aGlzLm9wdGlvbnMudHlwZSA9PT0gInNlbWktZHluYW1pYyIgPyAhJC5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0sIGl0ZW1FbGVtZW50KSA6IHRydWUpCgkJCSkgewoKCQkJCXRoaXMuZGlyZWN0aW9uID0gaW50ZXJzZWN0aW9uID09PSAxID8gImRvd24iIDogInVwIjsKCgkJCQlpZiAodGhpcy5vcHRpb25zLnRvbGVyYW5jZSA9PT0gInBvaW50ZXIiIHx8IHRoaXMuX2ludGVyc2VjdHNXaXRoU2lkZXMoaXRlbSkpIHsKCQkJCQl0aGlzLl9yZWFycmFuZ2UoZXZlbnQsIGl0ZW0pOwoJCQkJfSBlbHNlIHsKCQkJCQlicmVhazsKCQkJCX0KCgkJCQl0aGlzLl90cmlnZ2VyKCJjaGFuZ2UiLCBldmVudCwgdGhpcy5fdWlIYXNoKCkpOwoJCQkJYnJlYWs7CgkJCX0KCQl9CgoJCS8vUG9zdCBldmVudHMgdG8gY29udGFpbmVycwoJCXRoaXMuX2NvbnRhY3RDb250YWluZXJzKGV2ZW50KTsKCgkJLy9JbnRlcmNvbm5lY3Qgd2l0aCBkcm9wcGFibGVzCgkJaWYoJC51aS5kZG1hbmFnZXIpIHsKCQkJJC51aS5kZG1hbmFnZXIuZHJhZyh0aGlzLCBldmVudCk7CgkJfQoKCQkvL0NhbGwgY2FsbGJhY2tzCgkJdGhpcy5fdHJpZ2dlcigic29ydCIsIGV2ZW50LCB0aGlzLl91aUhhc2goKSk7CgoJCXRoaXMubGFzdFBvc2l0aW9uQWJzID0gdGhpcy5wb3NpdGlvbkFiczsKCQlyZXR1cm4gZmFsc2U7CgoJfSwKCglfbW91c2VTdG9wOiBmdW5jdGlvbihldmVudCwgbm9Qcm9wYWdhdGlvbikgewoKCQlpZighZXZlbnQpIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy9JZiB3ZSBhcmUgdXNpbmcgZHJvcHBhYmxlcywgaW5mb3JtIHRoZSBtYW5hZ2VyIGFib3V0IHRoZSBkcm9wCgkJaWYgKCQudWkuZGRtYW5hZ2VyICYmICF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91cikgewoJCQkkLnVpLmRkbWFuYWdlci5kcm9wKHRoaXMsIGV2ZW50KTsKCQl9CgoJCWlmKHRoaXMub3B0aW9ucy5yZXZlcnQpIHsKCQkJdmFyIHRoYXQgPSB0aGlzLAoJCQkJY3VyID0gdGhpcy5wbGFjZWhvbGRlci5vZmZzZXQoKSwKCQkJCWF4aXMgPSB0aGlzLm9wdGlvbnMuYXhpcywKCQkJCWFuaW1hdGlvbiA9IHt9OwoKCQkJaWYgKCAhYXhpcyB8fCBheGlzID09PSAieCIgKSB7CgkJCQlhbmltYXRpb24ubGVmdCA9IGN1ci5sZWZ0IC0gdGhpcy5vZmZzZXQucGFyZW50LmxlZnQgLSB0aGlzLm1hcmdpbnMubGVmdCArICh0aGlzLm9mZnNldFBhcmVudFswXSA9PT0gZG9jdW1lbnQuYm9keSA/IDAgOiB0aGlzLm9mZnNldFBhcmVudFswXS5zY3JvbGxMZWZ0KTsKCQkJfQoJCQlpZiAoICFheGlzIHx8IGF4aXMgPT09ICJ5IiApIHsKCQkJCWFuaW1hdGlvbi50b3AgPSBjdXIudG9wIC0gdGhpcy5vZmZzZXQucGFyZW50LnRvcCAtIHRoaXMubWFyZ2lucy50b3AgKyAodGhpcy5vZmZzZXRQYXJlbnRbMF0gPT09IGRvY3VtZW50LmJvZHkgPyAwIDogdGhpcy5vZmZzZXRQYXJlbnRbMF0uc2Nyb2xsVG9wKTsKCQkJfQoJCQl0aGlzLnJldmVydGluZyA9IHRydWU7CgkJCSQodGhpcy5oZWxwZXIpLmFuaW1hdGUoIGFuaW1hdGlvbiwgcGFyc2VJbnQodGhpcy5vcHRpb25zLnJldmVydCwgMTApIHx8IDUwMCwgZnVuY3Rpb24oKSB7CgkJCQl0aGF0Ll9jbGVhcihldmVudCk7CgkJCX0pOwoJCX0gZWxzZSB7CgkJCXRoaXMuX2NsZWFyKGV2ZW50LCBub1Byb3BhZ2F0aW9uKTsKCQl9CgoJCXJldHVybiBmYWxzZTsKCgl9LAoKCWNhbmNlbDogZnVuY3Rpb24oKSB7CgoJCWlmKHRoaXMuZHJhZ2dpbmcpIHsKCgkJCXRoaXMuX21vdXNlVXAoeyB0YXJnZXQ6IG51bGwgfSk7CgoJCQlpZih0aGlzLm9wdGlvbnMuaGVscGVyID09PSAib3JpZ2luYWwiKSB7CgkJCQl0aGlzLmN1cnJlbnRJdGVtLmNzcyh0aGlzLl9zdG9yZWRDU1MpLnJlbW92ZUNsYXNzKCJ1aS1zb3J0YWJsZS1oZWxwZXIiKTsKCQkJfSBlbHNlIHsKCQkJCXRoaXMuY3VycmVudEl0ZW0uc2hvdygpOwoJCQl9CgoJCQkvL1Bvc3QgZGVhY3RpdmF0aW5nIGV2ZW50cyB0byBjb250YWluZXJzCgkJCWZvciAodmFyIGkgPSB0aGlzLmNvbnRhaW5lcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pewoJCQkJdGhpcy5jb250YWluZXJzW2ldLl90cmlnZ2VyKCJkZWFjdGl2YXRlIiwgbnVsbCwgdGhpcy5fdWlIYXNoKHRoaXMpKTsKCQkJCWlmKHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5vdmVyKSB7CgkJCQkJdGhpcy5jb250YWluZXJzW2ldLl90cmlnZ2VyKCJvdXQiLCBudWxsLCB0aGlzLl91aUhhc2godGhpcykpOwoJCQkJCXRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5vdmVyID0gMDsKCQkJCX0KCQkJfQoKCQl9CgoJCWlmICh0aGlzLnBsYWNlaG9sZGVyKSB7CgkJCS8vJCh0aGlzLnBsYWNlaG9sZGVyWzBdKS5yZW1vdmUoKTsgd291bGQgaGF2ZSBiZWVuIHRoZSBqUXVlcnkgd2F5IC0gdW5mb3J0dW5hdGVseSwgaXQgdW5iaW5kcyBBTEwgZXZlbnRzIGZyb20gdGhlIG9yaWdpbmFsIG5vZGUhCgkJCWlmKHRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZSkgewoJCQkJdGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pOwoJCQl9CgkJCWlmKHRoaXMub3B0aW9ucy5oZWxwZXIgIT09ICJvcmlnaW5hbCIgJiYgdGhpcy5oZWxwZXIgJiYgdGhpcy5oZWxwZXJbMF0ucGFyZW50Tm9kZSkgewoJCQkJdGhpcy5oZWxwZXIucmVtb3ZlKCk7CgkJCX0KCgkJCSQuZXh0ZW5kKHRoaXMsIHsKCQkJCWhlbHBlcjogbnVsbCwKCQkJCWRyYWdnaW5nOiBmYWxzZSwKCQkJCXJldmVydGluZzogZmFsc2UsCgkJCQlfbm9GaW5hbFNvcnQ6IG51bGwKCQkJfSk7CgoJCQlpZih0aGlzLmRvbVBvc2l0aW9uLnByZXYpIHsKCQkJCSQodGhpcy5kb21Qb3NpdGlvbi5wcmV2KS5hZnRlcih0aGlzLmN1cnJlbnRJdGVtKTsKCQkJfSBlbHNlIHsKCQkJCSQodGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQpLnByZXBlbmQodGhpcy5jdXJyZW50SXRlbSk7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoKCX0sCgoJc2VyaWFsaXplOiBmdW5jdGlvbihvKSB7CgoJCXZhciBpdGVtcyA9IHRoaXMuX2dldEl0ZW1zQXNqUXVlcnkobyAmJiBvLmNvbm5lY3RlZCksCgkJCXN0ciA9IFtdOwoJCW8gPSBvIHx8IHt9OwoKCQkkKGl0ZW1zKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgcmVzID0gKCQoby5pdGVtIHx8IHRoaXMpLmF0dHIoby5hdHRyaWJ1dGUgfHwgImlkIikgfHwgIiIpLm1hdGNoKG8uZXhwcmVzc2lvbiB8fCAoLyguKylbXC09X10oLispLykpOwoJCQlpZiAocmVzKSB7CgkJCQlzdHIucHVzaCgoby5rZXkgfHwgcmVzWzFdKyJbXSIpKyI9Iisoby5rZXkgJiYgby5leHByZXNzaW9uID8gcmVzWzFdIDogcmVzWzJdKSk7CgkJCX0KCQl9KTsKCgkJaWYoIXN0ci5sZW5ndGggJiYgby5rZXkpIHsKCQkJc3RyLnB1c2goby5rZXkgKyAiPSIpOwoJCX0KCgkJcmV0dXJuIHN0ci5qb2luKCImIik7CgoJfSwKCgl0b0FycmF5OiBmdW5jdGlvbihvKSB7CgoJCXZhciBpdGVtcyA9IHRoaXMuX2dldEl0ZW1zQXNqUXVlcnkobyAmJiBvLmNvbm5lY3RlZCksCgkJCXJldCA9IFtdOwoKCQlvID0gbyB8fCB7fTsKCgkJaXRlbXMuZWFjaChmdW5jdGlvbigpIHsgcmV0LnB1c2goJChvLml0ZW0gfHwgdGhpcykuYXR0cihvLmF0dHJpYnV0ZSB8fCAiaWQiKSB8fCAiIik7IH0pOwoJCXJldHVybiByZXQ7CgoJfSwKCgkvKiBCZSBjYXJlZnVsIHdpdGggdGhlIGZvbGxvd2luZyBjb3JlIGZ1bmN0aW9ucyAqLwoJX2ludGVyc2VjdHNXaXRoOiBmdW5jdGlvbihpdGVtKSB7CgoJCXZhciB4MSA9IHRoaXMucG9zaXRpb25BYnMubGVmdCwKCQkJeDIgPSB4MSArIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgsCgkJCXkxID0gdGhpcy5wb3NpdGlvbkFicy50b3AsCgkJCXkyID0geTEgKyB0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCwKCQkJbCA9IGl0ZW0ubGVmdCwKCQkJciA9IGwgKyBpdGVtLndpZHRoLAoJCQl0ID0gaXRlbS50b3AsCgkJCWIgPSB0ICsgaXRlbS5oZWlnaHQsCgkJCWR5Q2xpY2sgPSB0aGlzLm9mZnNldC5jbGljay50b3AsCgkJCWR4Q2xpY2sgPSB0aGlzLm9mZnNldC5jbGljay5sZWZ0LAoJCQlpc092ZXJFbGVtZW50SGVpZ2h0ID0gKCB0aGlzLm9wdGlvbnMuYXhpcyA9PT0gIngiICkgfHwgKCAoIHkxICsgZHlDbGljayApID4gdCAmJiAoIHkxICsgZHlDbGljayApIDwgYiApLAoJCQlpc092ZXJFbGVtZW50V2lkdGggPSAoIHRoaXMub3B0aW9ucy5heGlzID09PSAieSIgKSB8fCAoICggeDEgKyBkeENsaWNrICkgPiBsICYmICggeDEgKyBkeENsaWNrICkgPCByICksCgkJCWlzT3ZlckVsZW1lbnQgPSBpc092ZXJFbGVtZW50SGVpZ2h0ICYmIGlzT3ZlckVsZW1lbnRXaWR0aDsKCgkJaWYgKCB0aGlzLm9wdGlvbnMudG9sZXJhbmNlID09PSAicG9pbnRlciIgfHwKCQkJdGhpcy5vcHRpb25zLmZvcmNlUG9pbnRlckZvckNvbnRhaW5lcnMgfHwKCQkJKHRoaXMub3B0aW9ucy50b2xlcmFuY2UgIT09ICJwb2ludGVyIiAmJiB0aGlzLmhlbHBlclByb3BvcnRpb25zW3RoaXMuZmxvYXRpbmcgPyAid2lkdGgiIDogImhlaWdodCJdID4gaXRlbVt0aGlzLmZsb2F0aW5nID8gIndpZHRoIiA6ICJoZWlnaHQiXSkKCQkpIHsKCQkJcmV0dXJuIGlzT3ZlckVsZW1lbnQ7CgkJfSBlbHNlIHsKCgkJCXJldHVybiAobCA8IHgxICsgKHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLyAyKSAmJiAvLyBSaWdodCBIYWxmCgkJCQl4MiAtICh0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC8gMikgPCByICYmIC8vIExlZnQgSGFsZgoJCQkJdCA8IHkxICsgKHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC8gMikgJiYgLy8gQm90dG9tIEhhbGYKCQkJCXkyIC0gKHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC8gMikgPCBiICk7IC8vIFRvcCBIYWxmCgoJCX0KCX0sCgoJX2ludGVyc2VjdHNXaXRoUG9pbnRlcjogZnVuY3Rpb24oaXRlbSkgewoKCQl2YXIgaXNPdmVyRWxlbWVudEhlaWdodCA9ICh0aGlzLm9wdGlvbnMuYXhpcyA9PT0gIngiKSB8fCBpc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMudG9wICsgdGhpcy5vZmZzZXQuY2xpY2sudG9wLCBpdGVtLnRvcCwgaXRlbS5oZWlnaHQpLAoJCQlpc092ZXJFbGVtZW50V2lkdGggPSAodGhpcy5vcHRpb25zLmF4aXMgPT09ICJ5IikgfHwgaXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLmxlZnQgKyB0aGlzLm9mZnNldC5jbGljay5sZWZ0LCBpdGVtLmxlZnQsIGl0ZW0ud2lkdGgpLAoJCQlpc092ZXJFbGVtZW50ID0gaXNPdmVyRWxlbWVudEhlaWdodCAmJiBpc092ZXJFbGVtZW50V2lkdGgsCgkJCXZlcnRpY2FsRGlyZWN0aW9uID0gdGhpcy5fZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uKCksCgkJCWhvcml6b250YWxEaXJlY3Rpb24gPSB0aGlzLl9nZXREcmFnSG9yaXpvbnRhbERpcmVjdGlvbigpOwoKCQlpZiAoIWlzT3ZlckVsZW1lbnQpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJcmV0dXJuIHRoaXMuZmxvYXRpbmcgPwoJCQkoICgoaG9yaXpvbnRhbERpcmVjdGlvbiAmJiBob3Jpem9udGFsRGlyZWN0aW9uID09PSAicmlnaHQiKSB8fCB2ZXJ0aWNhbERpcmVjdGlvbiA9PT0gImRvd24iKSA/IDIgOiAxICkKCQkJOiAoIHZlcnRpY2FsRGlyZWN0aW9uICYmICh2ZXJ0aWNhbERpcmVjdGlvbiA9PT0gImRvd24iID8gMiA6IDEpICk7CgoJfSwKCglfaW50ZXJzZWN0c1dpdGhTaWRlczogZnVuY3Rpb24oaXRlbSkgewoKCQl2YXIgaXNPdmVyQm90dG9tSGFsZiA9IGlzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy50b3AgKyB0aGlzLm9mZnNldC5jbGljay50b3AsIGl0ZW0udG9wICsgKGl0ZW0uaGVpZ2h0LzIpLCBpdGVtLmhlaWdodCksCgkJCWlzT3ZlclJpZ2h0SGFsZiA9IGlzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy5sZWZ0ICsgdGhpcy5vZmZzZXQuY2xpY2subGVmdCwgaXRlbS5sZWZ0ICsgKGl0ZW0ud2lkdGgvMiksIGl0ZW0ud2lkdGgpLAoJCQl2ZXJ0aWNhbERpcmVjdGlvbiA9IHRoaXMuX2dldERyYWdWZXJ0aWNhbERpcmVjdGlvbigpLAoJCQlob3Jpem9udGFsRGlyZWN0aW9uID0gdGhpcy5fZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb24oKTsKCgkJaWYgKHRoaXMuZmxvYXRpbmcgJiYgaG9yaXpvbnRhbERpcmVjdGlvbikgewoJCQlyZXR1cm4gKChob3Jpem9udGFsRGlyZWN0aW9uID09PSAicmlnaHQiICYmIGlzT3ZlclJpZ2h0SGFsZikgfHwgKGhvcml6b250YWxEaXJlY3Rpb24gPT09ICJsZWZ0IiAmJiAhaXNPdmVyUmlnaHRIYWxmKSk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHZlcnRpY2FsRGlyZWN0aW9uICYmICgodmVydGljYWxEaXJlY3Rpb24gPT09ICJkb3duIiAmJiBpc092ZXJCb3R0b21IYWxmKSB8fCAodmVydGljYWxEaXJlY3Rpb24gPT09ICJ1cCIgJiYgIWlzT3ZlckJvdHRvbUhhbGYpKTsKCQl9CgoJfSwKCglfZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZGVsdGEgPSB0aGlzLnBvc2l0aW9uQWJzLnRvcCAtIHRoaXMubGFzdFBvc2l0aW9uQWJzLnRvcDsKCQlyZXR1cm4gZGVsdGEgIT09IDAgJiYgKGRlbHRhID4gMCA/ICJkb3duIiA6ICJ1cCIpOwoJfSwKCglfZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb246IGZ1bmN0aW9uKCkgewoJCXZhciBkZWx0YSA9IHRoaXMucG9zaXRpb25BYnMubGVmdCAtIHRoaXMubGFzdFBvc2l0aW9uQWJzLmxlZnQ7CgkJcmV0dXJuIGRlbHRhICE9PSAwICYmIChkZWx0YSA+IDAgPyAicmlnaHQiIDogImxlZnQiKTsKCX0sCgoJcmVmcmVzaDogZnVuY3Rpb24oZXZlbnQpIHsKCQl0aGlzLl9yZWZyZXNoSXRlbXMoZXZlbnQpOwoJCXRoaXMucmVmcmVzaFBvc2l0aW9ucygpOwoJCXJldHVybiB0aGlzOwoJfSwKCglfY29ubmVjdFdpdGg6IGZ1bmN0aW9uKCkgewoJCXZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zOwoJCXJldHVybiBvcHRpb25zLmNvbm5lY3RXaXRoLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgPyBbb3B0aW9ucy5jb25uZWN0V2l0aF0gOiBvcHRpb25zLmNvbm5lY3RXaXRoOwoJfSwKCglfZ2V0SXRlbXNBc2pRdWVyeTogZnVuY3Rpb24oY29ubmVjdGVkKSB7CgoJCXZhciBpLCBqLCBjdXIsIGluc3QsCgkJCWl0ZW1zID0gW10sCgkJCXF1ZXJpZXMgPSBbXSwKCQkJY29ubmVjdFdpdGggPSB0aGlzLl9jb25uZWN0V2l0aCgpOwoKCQlpZihjb25uZWN0V2l0aCAmJiBjb25uZWN0ZWQpIHsKCQkJZm9yIChpID0gY29ubmVjdFdpdGgubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pewoJCQkJY3VyID0gJChjb25uZWN0V2l0aFtpXSk7CgkJCQlmb3IgKCBqID0gY3VyLmxlbmd0aCAtIDE7IGogPj0gMDsgai0tKXsKCQkJCQlpbnN0ID0gJC5kYXRhKGN1cltqXSwgdGhpcy53aWRnZXRGdWxsTmFtZSk7CgkJCQkJaWYoaW5zdCAmJiBpbnN0ICE9PSB0aGlzICYmICFpbnN0Lm9wdGlvbnMuZGlzYWJsZWQpIHsKCQkJCQkJcXVlcmllcy5wdXNoKFskLmlzRnVuY3Rpb24oaW5zdC5vcHRpb25zLml0ZW1zKSA/IGluc3Qub3B0aW9ucy5pdGVtcy5jYWxsKGluc3QuZWxlbWVudCkgOiAkKGluc3Qub3B0aW9ucy5pdGVtcywgaW5zdC5lbGVtZW50KS5ub3QoIi51aS1zb3J0YWJsZS1oZWxwZXIiKS5ub3QoIi51aS1zb3J0YWJsZS1wbGFjZWhvbGRlciIpLCBpbnN0XSk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlxdWVyaWVzLnB1c2goWyQuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMuaXRlbXMpID8gdGhpcy5vcHRpb25zLml0ZW1zLmNhbGwodGhpcy5lbGVtZW50LCBudWxsLCB7IG9wdGlvbnM6IHRoaXMub3B0aW9ucywgaXRlbTogdGhpcy5jdXJyZW50SXRlbSB9KSA6ICQodGhpcy5vcHRpb25zLml0ZW1zLCB0aGlzLmVsZW1lbnQpLm5vdCgiLnVpLXNvcnRhYmxlLWhlbHBlciIpLm5vdCgiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyIiksIHRoaXNdKTsKCgkJZnVuY3Rpb24gYWRkSXRlbXMoKSB7CgkJCWl0ZW1zLnB1c2goIHRoaXMgKTsKCQl9CgkJZm9yIChpID0gcXVlcmllcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSl7CgkJCXF1ZXJpZXNbaV1bMF0uZWFjaCggYWRkSXRlbXMgKTsKCQl9CgoJCXJldHVybiAkKGl0ZW1zKTsKCgl9LAoKCV9yZW1vdmVDdXJyZW50c0Zyb21JdGVtczogZnVuY3Rpb24oKSB7CgoJCXZhciBsaXN0ID0gdGhpcy5jdXJyZW50SXRlbS5maW5kKCI6ZGF0YSgiICsgdGhpcy53aWRnZXROYW1lICsgIi1pdGVtKSIpOwoKCQl0aGlzLml0ZW1zID0gJC5ncmVwKHRoaXMuaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CgkJCWZvciAodmFyIGo9MDsgaiA8IGxpc3QubGVuZ3RoOyBqKyspIHsKCQkJCWlmKGxpc3Rbal0gPT09IGl0ZW0uaXRlbVswXSkgewoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gdHJ1ZTsKCQl9KTsKCgl9LAoKCV9yZWZyZXNoSXRlbXM6IGZ1bmN0aW9uKGV2ZW50KSB7CgoJCXRoaXMuaXRlbXMgPSBbXTsKCQl0aGlzLmNvbnRhaW5lcnMgPSBbdGhpc107CgoJCXZhciBpLCBqLCBjdXIsIGluc3QsIHRhcmdldERhdGEsIF9xdWVyaWVzLCBpdGVtLCBxdWVyaWVzTGVuZ3RoLAoJCQlpdGVtcyA9IHRoaXMuaXRlbXMsCgkJCXF1ZXJpZXMgPSBbWyQuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMuaXRlbXMpID8gdGhpcy5vcHRpb25zLml0ZW1zLmNhbGwodGhpcy5lbGVtZW50WzBdLCBldmVudCwgeyBpdGVtOiB0aGlzLmN1cnJlbnRJdGVtIH0pIDogJCh0aGlzLm9wdGlvbnMuaXRlbXMsIHRoaXMuZWxlbWVudCksIHRoaXNdXSwKCQkJY29ubmVjdFdpdGggPSB0aGlzLl9jb25uZWN0V2l0aCgpOwoKCQlpZihjb25uZWN0V2l0aCAmJiB0aGlzLnJlYWR5KSB7IC8vU2hvdWxkbid0IGJlIHJ1biB0aGUgZmlyc3QgdGltZSB0aHJvdWdoIGR1ZSB0byBtYXNzaXZlIHNsb3ctZG93bgoJCQlmb3IgKGkgPSBjb25uZWN0V2l0aC5sZW5ndGggLSAxOyBpID49IDA7IGktLSl7CgkJCQljdXIgPSAkKGNvbm5lY3RXaXRoW2ldKTsKCQkJCWZvciAoaiA9IGN1ci5sZW5ndGggLSAxOyBqID49IDA7IGotLSl7CgkJCQkJaW5zdCA9ICQuZGF0YShjdXJbal0sIHRoaXMud2lkZ2V0RnVsbE5hbWUpOwoJCQkJCWlmKGluc3QgJiYgaW5zdCAhPT0gdGhpcyAmJiAhaW5zdC5vcHRpb25zLmRpc2FibGVkKSB7CgkJCQkJCXF1ZXJpZXMucHVzaChbJC5pc0Z1bmN0aW9uKGluc3Qub3B0aW9ucy5pdGVtcykgPyBpbnN0Lm9wdGlvbnMuaXRlbXMuY2FsbChpbnN0LmVsZW1lbnRbMF0sIGV2ZW50LCB7IGl0ZW06IHRoaXMuY3VycmVudEl0ZW0gfSkgOiAkKGluc3Qub3B0aW9ucy5pdGVtcywgaW5zdC5lbGVtZW50KSwgaW5zdF0pOwoJCQkJCQl0aGlzLmNvbnRhaW5lcnMucHVzaChpbnN0KTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCWZvciAoaSA9IHF1ZXJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKCQkJdGFyZ2V0RGF0YSA9IHF1ZXJpZXNbaV1bMV07CgkJCV9xdWVyaWVzID0gcXVlcmllc1tpXVswXTsKCgkJCWZvciAoaj0wLCBxdWVyaWVzTGVuZ3RoID0gX3F1ZXJpZXMubGVuZ3RoOyBqIDwgcXVlcmllc0xlbmd0aDsgaisrKSB7CgkJCQlpdGVtID0gJChfcXVlcmllc1tqXSk7CgoJCQkJaXRlbS5kYXRhKHRoaXMud2lkZ2V0TmFtZSArICItaXRlbSIsIHRhcmdldERhdGEpOyAvLyBEYXRhIGZvciB0YXJnZXQgY2hlY2tpbmcgKG1vdXNlIG1hbmFnZXIpCgoJCQkJaXRlbXMucHVzaCh7CgkJCQkJaXRlbTogaXRlbSwKCQkJCQlpbnN0YW5jZTogdGFyZ2V0RGF0YSwKCQkJCQl3aWR0aDogMCwgaGVpZ2h0OiAwLAoJCQkJCWxlZnQ6IDAsIHRvcDogMAoJCQkJfSk7CgkJCX0KCQl9CgoJfSwKCglyZWZyZXNoUG9zaXRpb25zOiBmdW5jdGlvbihmYXN0KSB7CgoJCS8vVGhpcyBoYXMgdG8gYmUgcmVkb25lIGJlY2F1c2UgZHVlIHRvIHRoZSBpdGVtIGJlaW5nIG1vdmVkIG91dC9pbnRvIHRoZSBvZmZzZXRQYXJlbnQsIHRoZSBvZmZzZXRQYXJlbnQncyBwb3NpdGlvbiB3aWxsIGNoYW5nZQoJCWlmKHRoaXMub2Zmc2V0UGFyZW50ICYmIHRoaXMuaGVscGVyKSB7CgkJCXRoaXMub2Zmc2V0LnBhcmVudCA9IHRoaXMuX2dldFBhcmVudE9mZnNldCgpOwoJCX0KCgkJdmFyIGksIGl0ZW0sIHQsIHA7CgoJCWZvciAoaSA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pewoJCQlpdGVtID0gdGhpcy5pdGVtc1tpXTsKCgkJCS8vV2UgaWdub3JlIGNhbGN1bGF0aW5nIHBvc2l0aW9ucyBvZiBhbGwgY29ubmVjdGVkIGNvbnRhaW5lcnMgd2hlbiB3ZSdyZSBub3Qgb3ZlciB0aGVtCgkJCWlmKGl0ZW0uaW5zdGFuY2UgIT09IHRoaXMuY3VycmVudENvbnRhaW5lciAmJiB0aGlzLmN1cnJlbnRDb250YWluZXIgJiYgaXRlbS5pdGVtWzBdICE9PSB0aGlzLmN1cnJlbnRJdGVtWzBdKSB7CgkJCQljb250aW51ZTsKCQkJfQoKCQkJdCA9IHRoaXMub3B0aW9ucy50b2xlcmFuY2VFbGVtZW50ID8gJCh0aGlzLm9wdGlvbnMudG9sZXJhbmNlRWxlbWVudCwgaXRlbS5pdGVtKSA6IGl0ZW0uaXRlbTsKCgkJCWlmICghZmFzdCkgewoJCQkJaXRlbS53aWR0aCA9IHQub3V0ZXJXaWR0aCgpOwoJCQkJaXRlbS5oZWlnaHQgPSB0Lm91dGVySGVpZ2h0KCk7CgkJCX0KCgkJCXAgPSB0Lm9mZnNldCgpOwoJCQlpdGVtLmxlZnQgPSBwLmxlZnQ7CgkJCWl0ZW0udG9wID0gcC50b3A7CgkJfQoKCQlpZih0aGlzLm9wdGlvbnMuY3VzdG9tICYmIHRoaXMub3B0aW9ucy5jdXN0b20ucmVmcmVzaENvbnRhaW5lcnMpIHsKCQkJdGhpcy5vcHRpb25zLmN1c3RvbS5yZWZyZXNoQ29udGFpbmVycy5jYWxsKHRoaXMpOwoJCX0gZWxzZSB7CgkJCWZvciAoaSA9IHRoaXMuY29udGFpbmVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSl7CgkJCQlwID0gdGhpcy5jb250YWluZXJzW2ldLmVsZW1lbnQub2Zmc2V0KCk7CgkJCQl0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUubGVmdCA9IHAubGVmdDsKCQkJCXRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS50b3AgPSBwLnRvcDsKCQkJCXRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS53aWR0aAk9IHRoaXMuY29udGFpbmVyc1tpXS5lbGVtZW50Lm91dGVyV2lkdGgoKTsKCQkJCXRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5oZWlnaHQgPSB0aGlzLmNvbnRhaW5lcnNbaV0uZWxlbWVudC5vdXRlckhlaWdodCgpOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJX2NyZWF0ZVBsYWNlaG9sZGVyOiBmdW5jdGlvbih0aGF0KSB7CgkJdGhhdCA9IHRoYXQgfHwgdGhpczsKCQl2YXIgY2xhc3NOYW1lLAoJCQlvID0gdGhhdC5vcHRpb25zOwoKCQlpZighby5wbGFjZWhvbGRlciB8fCBvLnBsYWNlaG9sZGVyLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHsKCQkJY2xhc3NOYW1lID0gby5wbGFjZWhvbGRlcjsKCQkJby5wbGFjZWhvbGRlciA9IHsKCQkJCWVsZW1lbnQ6IGZ1bmN0aW9uKCkgewoKCQkJCQl2YXIgbm9kZU5hbWUgPSB0aGF0LmN1cnJlbnRJdGVtWzBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksCgkJCQkJCWVsZW1lbnQgPSAkKCAiPCIgKyBub2RlTmFtZSArICI+IiwgdGhhdC5kb2N1bWVudFswXSApCgkJCQkJCQkuYWRkQ2xhc3MoY2xhc3NOYW1lIHx8IHRoYXQuY3VycmVudEl0ZW1bMF0uY2xhc3NOYW1lKyIgdWktc29ydGFibGUtcGxhY2Vob2xkZXIiKQoJCQkJCQkJLnJlbW92ZUNsYXNzKCJ1aS1zb3J0YWJsZS1oZWxwZXIiKTsKCgkJCQkJaWYgKCBub2RlTmFtZSA9PT0gInRyIiApIHsKCQkJCQkJdGhhdC5jdXJyZW50SXRlbS5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24oKSB7CgkJCQkJCQkkKCAiPHRkPiYjMTYwOzwvdGQ+IiwgdGhhdC5kb2N1bWVudFswXSApCgkJCQkJCQkJLmF0dHIoICJjb2xzcGFuIiwgJCggdGhpcyApLmF0dHIoICJjb2xzcGFuIiApIHx8IDEgKQoJCQkJCQkJCS5hcHBlbmRUbyggZWxlbWVudCApOwoJCQkJCQl9KTsKCQkJCQl9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gImltZyIgKSB7CgkJCQkJCWVsZW1lbnQuYXR0ciggInNyYyIsIHRoYXQuY3VycmVudEl0ZW0uYXR0ciggInNyYyIgKSApOwoJCQkJCX0KCgkJCQkJaWYgKCAhY2xhc3NOYW1lICkgewoJCQkJCQllbGVtZW50LmNzcyggInZpc2liaWxpdHkiLCAiaGlkZGVuIiApOwoJCQkJCX0KCgkJCQkJcmV0dXJuIGVsZW1lbnQ7CgkJCQl9LAoJCQkJdXBkYXRlOiBmdW5jdGlvbihjb250YWluZXIsIHApIHsKCgkJCQkJLy8gMS4gSWYgYSBjbGFzc05hbWUgaXMgc2V0IGFzICdwbGFjZWhvbGRlciBvcHRpb24sIHdlIGRvbid0IGZvcmNlIHNpemVzIC0gdGhlIGNsYXNzIGlzIHJlc3BvbnNpYmxlIGZvciB0aGF0CgkJCQkJLy8gMi4gVGhlIG9wdGlvbiAnZm9yY2VQbGFjZWhvbGRlclNpemUgY2FuIGJlIGVuYWJsZWQgdG8gZm9yY2UgaXQgZXZlbiBpZiBhIGNsYXNzIG5hbWUgaXMgc3BlY2lmaWVkCgkJCQkJaWYoY2xhc3NOYW1lICYmICFvLmZvcmNlUGxhY2Vob2xkZXJTaXplKSB7CgkJCQkJCXJldHVybjsKCQkJCQl9CgoJCQkJCS8vSWYgdGhlIGVsZW1lbnQgZG9lc24ndCBoYXZlIGEgYWN0dWFsIGhlaWdodCBieSBpdHNlbGYgKHdpdGhvdXQgc3R5bGVzIGNvbWluZyBmcm9tIGEgc3R5bGVzaGVldCksIGl0IHJlY2VpdmVzIHRoZSBpbmxpbmUgaGVpZ2h0IGZyb20gdGhlIGRyYWdnZWQgaXRlbQoJCQkJCWlmKCFwLmhlaWdodCgpKSB7IHAuaGVpZ2h0KHRoYXQuY3VycmVudEl0ZW0uaW5uZXJIZWlnaHQoKSAtIHBhcnNlSW50KHRoYXQuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nVG9wIil8fDAsIDEwKSAtIHBhcnNlSW50KHRoYXQuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nQm90dG9tIil8fDAsIDEwKSk7IH0KCQkJCQlpZighcC53aWR0aCgpKSB7IHAud2lkdGgodGhhdC5jdXJyZW50SXRlbS5pbm5lcldpZHRoKCkgLSBwYXJzZUludCh0aGF0LmN1cnJlbnRJdGVtLmNzcygicGFkZGluZ0xlZnQiKXx8MCwgMTApIC0gcGFyc2VJbnQodGhhdC5jdXJyZW50SXRlbS5jc3MoInBhZGRpbmdSaWdodCIpfHwwLCAxMCkpOyB9CgkJCQl9CgkJCX07CgkJfQoKCQkvL0NyZWF0ZSB0aGUgcGxhY2Vob2xkZXIKCQl0aGF0LnBsYWNlaG9sZGVyID0gJChvLnBsYWNlaG9sZGVyLmVsZW1lbnQuY2FsbCh0aGF0LmVsZW1lbnQsIHRoYXQuY3VycmVudEl0ZW0pKTsKCgkJLy9BcHBlbmQgaXQgYWZ0ZXIgdGhlIGFjdHVhbCBjdXJyZW50IGl0ZW0KCQl0aGF0LmN1cnJlbnRJdGVtLmFmdGVyKHRoYXQucGxhY2Vob2xkZXIpOwoKCQkvL1VwZGF0ZSB0aGUgc2l6ZSBvZiB0aGUgcGxhY2Vob2xkZXIgKFRPRE86IExvZ2ljIHRvIGZ1enp5LCBzZWUgbGluZSAzMTYvMzE3KQoJCW8ucGxhY2Vob2xkZXIudXBkYXRlKHRoYXQsIHRoYXQucGxhY2Vob2xkZXIpOwoKCX0sCgoJX2NvbnRhY3RDb250YWluZXJzOiBmdW5jdGlvbihldmVudCkgewoJCXZhciBpLCBqLCBkaXN0LCBpdGVtV2l0aExlYXN0RGlzdGFuY2UsIHBvc1Byb3BlcnR5LCBzaXplUHJvcGVydHksIGJhc2UsIGN1ciwgbmVhckJvdHRvbSwgZmxvYXRpbmcsCgkJCWlubmVybW9zdENvbnRhaW5lciA9IG51bGwsCgkJCWlubmVybW9zdEluZGV4ID0gbnVsbDsKCgkJLy8gZ2V0IGlubmVybW9zdCBjb250YWluZXIgdGhhdCBpbnRlcnNlY3RzIHdpdGggaXRlbQoJCWZvciAoaSA9IHRoaXMuY29udGFpbmVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewoKCQkJLy8gbmV2ZXIgY29uc2lkZXIgYSBjb250YWluZXIgdGhhdCdzIGxvY2F0ZWQgd2l0aGluIHRoZSBpdGVtIGl0c2VsZgoJCQlpZigkLmNvbnRhaW5zKHRoaXMuY3VycmVudEl0ZW1bMF0sIHRoaXMuY29udGFpbmVyc1tpXS5lbGVtZW50WzBdKSkgewoJCQkJY29udGludWU7CgkJCX0KCgkJCWlmKHRoaXMuX2ludGVyc2VjdHNXaXRoKHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZSkpIHsKCgkJCQkvLyBpZiB3ZSd2ZSBhbHJlYWR5IGZvdW5kIGEgY29udGFpbmVyIGFuZCBpdCdzIG1vcmUgImlubmVyIiB0aGFuIHRoaXMsIHRoZW4gY29udGludWUKCQkJCWlmKGlubmVybW9zdENvbnRhaW5lciAmJiAkLmNvbnRhaW5zKHRoaXMuY29udGFpbmVyc1tpXS5lbGVtZW50WzBdLCBpbm5lcm1vc3RDb250YWluZXIuZWxlbWVudFswXSkpIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCgkJCQlpbm5lcm1vc3RDb250YWluZXIgPSB0aGlzLmNvbnRhaW5lcnNbaV07CgkJCQlpbm5lcm1vc3RJbmRleCA9IGk7CgoJCQl9IGVsc2UgewoJCQkJLy8gY29udGFpbmVyIGRvZXNuJ3QgaW50ZXJzZWN0LiB0cmlnZ2VyICJvdXQiIGV2ZW50IGlmIG5lY2Vzc2FyeQoJCQkJaWYodGhpcy5jb250YWluZXJzW2ldLmNvbnRhaW5lckNhY2hlLm92ZXIpIHsKCQkJCQl0aGlzLmNvbnRhaW5lcnNbaV0uX3RyaWdnZXIoIm91dCIsIGV2ZW50LCB0aGlzLl91aUhhc2godGhpcykpOwoJCQkJCXRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5vdmVyID0gMDsKCQkJCX0KCQkJfQoKCQl9CgoJCS8vIGlmIG5vIGludGVyc2VjdGluZyBjb250YWluZXJzIGZvdW5kLCByZXR1cm4KCQlpZighaW5uZXJtb3N0Q29udGFpbmVyKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIG1vdmUgdGhlIGl0ZW0gaW50byB0aGUgY29udGFpbmVyIGlmIGl0J3Mgbm90IHRoZXJlIGFscmVhZHkKCQlpZih0aGlzLmNvbnRhaW5lcnMubGVuZ3RoID09PSAxKSB7CgkJCWlmICghdGhpcy5jb250YWluZXJzW2lubmVybW9zdEluZGV4XS5jb250YWluZXJDYWNoZS5vdmVyKSB7CgkJCQl0aGlzLmNvbnRhaW5lcnNbaW5uZXJtb3N0SW5kZXhdLl90cmlnZ2VyKCJvdmVyIiwgZXZlbnQsIHRoaXMuX3VpSGFzaCh0aGlzKSk7CgkJCQl0aGlzLmNvbnRhaW5lcnNbaW5uZXJtb3N0SW5kZXhdLmNvbnRhaW5lckNhY2hlLm92ZXIgPSAxOwoJCQl9CgkJfSBlbHNlIHsKCgkJCS8vV2hlbiBlbnRlcmluZyBhIG5ldyBjb250YWluZXIsIHdlIHdpbGwgZmluZCB0aGUgaXRlbSB3aXRoIHRoZSBsZWFzdCBkaXN0YW5jZSBhbmQgYXBwZW5kIG91ciBpdGVtIG5lYXIgaXQKCQkJZGlzdCA9IDEwMDAwOwoJCQlpdGVtV2l0aExlYXN0RGlzdGFuY2UgPSBudWxsOwoJCQlmbG9hdGluZyA9IGlubmVybW9zdENvbnRhaW5lci5mbG9hdGluZyB8fCBpc0Zsb2F0aW5nKHRoaXMuY3VycmVudEl0ZW0pOwoJCQlwb3NQcm9wZXJ0eSA9IGZsb2F0aW5nID8gImxlZnQiIDogInRvcCI7CgkJCXNpemVQcm9wZXJ0eSA9IGZsb2F0aW5nID8gIndpZHRoIiA6ICJoZWlnaHQiOwoJCQliYXNlID0gdGhpcy5wb3NpdGlvbkFic1twb3NQcm9wZXJ0eV0gKyB0aGlzLm9mZnNldC5jbGlja1twb3NQcm9wZXJ0eV07CgkJCWZvciAoaiA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIHsKCQkJCWlmKCEkLmNvbnRhaW5zKHRoaXMuY29udGFpbmVyc1tpbm5lcm1vc3RJbmRleF0uZWxlbWVudFswXSwgdGhpcy5pdGVtc1tqXS5pdGVtWzBdKSkgewoJCQkJCWNvbnRpbnVlOwoJCQkJfQoJCQkJaWYodGhpcy5pdGVtc1tqXS5pdGVtWzBdID09PSB0aGlzLmN1cnJlbnRJdGVtWzBdKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgkJCQlpZiAoZmxvYXRpbmcgJiYgIWlzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy50b3AgKyB0aGlzLm9mZnNldC5jbGljay50b3AsIHRoaXMuaXRlbXNbal0udG9wLCB0aGlzLml0ZW1zW2pdLmhlaWdodCkpIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCQkJCWN1ciA9IHRoaXMuaXRlbXNbal0uaXRlbS5vZmZzZXQoKVtwb3NQcm9wZXJ0eV07CgkJCQluZWFyQm90dG9tID0gZmFsc2U7CgkJCQlpZihNYXRoLmFicyhjdXIgLSBiYXNlKSA+IE1hdGguYWJzKGN1ciArIHRoaXMuaXRlbXNbal1bc2l6ZVByb3BlcnR5XSAtIGJhc2UpKXsKCQkJCQluZWFyQm90dG9tID0gdHJ1ZTsKCQkJCQljdXIgKz0gdGhpcy5pdGVtc1tqXVtzaXplUHJvcGVydHldOwoJCQkJfQoKCQkJCWlmKE1hdGguYWJzKGN1ciAtIGJhc2UpIDwgZGlzdCkgewoJCQkJCWRpc3QgPSBNYXRoLmFicyhjdXIgLSBiYXNlKTsgaXRlbVdpdGhMZWFzdERpc3RhbmNlID0gdGhpcy5pdGVtc1tqXTsKCQkJCQl0aGlzLmRpcmVjdGlvbiA9IG5lYXJCb3R0b20gPyAidXAiOiAiZG93biI7CgkJCQl9CgkJCX0KCgkJCS8vQ2hlY2sgaWYgZHJvcE9uRW1wdHkgaXMgZW5hYmxlZAoJCQlpZighaXRlbVdpdGhMZWFzdERpc3RhbmNlICYmICF0aGlzLm9wdGlvbnMuZHJvcE9uRW1wdHkpIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJaWYodGhpcy5jdXJyZW50Q29udGFpbmVyID09PSB0aGlzLmNvbnRhaW5lcnNbaW5uZXJtb3N0SW5kZXhdKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWl0ZW1XaXRoTGVhc3REaXN0YW5jZSA/IHRoaXMuX3JlYXJyYW5nZShldmVudCwgaXRlbVdpdGhMZWFzdERpc3RhbmNlLCBudWxsLCB0cnVlKSA6IHRoaXMuX3JlYXJyYW5nZShldmVudCwgbnVsbCwgdGhpcy5jb250YWluZXJzW2lubmVybW9zdEluZGV4XS5lbGVtZW50LCB0cnVlKTsKCQkJdGhpcy5fdHJpZ2dlcigiY2hhbmdlIiwgZXZlbnQsIHRoaXMuX3VpSGFzaCgpKTsKCQkJdGhpcy5jb250YWluZXJzW2lubmVybW9zdEluZGV4XS5fdHJpZ2dlcigiY2hhbmdlIiwgZXZlbnQsIHRoaXMuX3VpSGFzaCh0aGlzKSk7CgkJCXRoaXMuY3VycmVudENvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyc1tpbm5lcm1vc3RJbmRleF07CgoJCQkvL1VwZGF0ZSB0aGUgcGxhY2Vob2xkZXIKCQkJdGhpcy5vcHRpb25zLnBsYWNlaG9sZGVyLnVwZGF0ZSh0aGlzLmN1cnJlbnRDb250YWluZXIsIHRoaXMucGxhY2Vob2xkZXIpOwoKCQkJdGhpcy5jb250YWluZXJzW2lubmVybW9zdEluZGV4XS5fdHJpZ2dlcigib3ZlciIsIGV2ZW50LCB0aGlzLl91aUhhc2godGhpcykpOwoJCQl0aGlzLmNvbnRhaW5lcnNbaW5uZXJtb3N0SW5kZXhdLmNvbnRhaW5lckNhY2hlLm92ZXIgPSAxOwoJCX0KCgoJfSwKCglfY3JlYXRlSGVscGVyOiBmdW5jdGlvbihldmVudCkgewoKCQl2YXIgbyA9IHRoaXMub3B0aW9ucywKCQkJaGVscGVyID0gJC5pc0Z1bmN0aW9uKG8uaGVscGVyKSA/ICQoby5oZWxwZXIuYXBwbHkodGhpcy5lbGVtZW50WzBdLCBbZXZlbnQsIHRoaXMuY3VycmVudEl0ZW1dKSkgOiAoby5oZWxwZXIgPT09ICJjbG9uZSIgPyB0aGlzLmN1cnJlbnRJdGVtLmNsb25lKCkgOiB0aGlzLmN1cnJlbnRJdGVtKTsKCgkJLy9BZGQgdGhlIGhlbHBlciB0byB0aGUgRE9NIGlmIHRoYXQgZGlkbid0IGhhcHBlbiBhbHJlYWR5CgkJaWYoIWhlbHBlci5wYXJlbnRzKCJib2R5IikubGVuZ3RoKSB7CgkJCSQoby5hcHBlbmRUbyAhPT0gInBhcmVudCIgPyBvLmFwcGVuZFRvIDogdGhpcy5jdXJyZW50SXRlbVswXS5wYXJlbnROb2RlKVswXS5hcHBlbmRDaGlsZChoZWxwZXJbMF0pOwoJCX0KCgkJaWYoaGVscGVyWzBdID09PSB0aGlzLmN1cnJlbnRJdGVtWzBdKSB7CgkJCXRoaXMuX3N0b3JlZENTUyA9IHsgd2lkdGg6IHRoaXMuY3VycmVudEl0ZW1bMF0uc3R5bGUud2lkdGgsIGhlaWdodDogdGhpcy5jdXJyZW50SXRlbVswXS5zdHlsZS5oZWlnaHQsIHBvc2l0aW9uOiB0aGlzLmN1cnJlbnRJdGVtLmNzcygicG9zaXRpb24iKSwgdG9wOiB0aGlzLmN1cnJlbnRJdGVtLmNzcygidG9wIiksIGxlZnQ6IHRoaXMuY3VycmVudEl0ZW0uY3NzKCJsZWZ0IikgfTsKCQl9CgoJCWlmKCFoZWxwZXJbMF0uc3R5bGUud2lkdGggfHwgby5mb3JjZUhlbHBlclNpemUpIHsKCQkJaGVscGVyLndpZHRoKHRoaXMuY3VycmVudEl0ZW0ud2lkdGgoKSk7CgkJfQoJCWlmKCFoZWxwZXJbMF0uc3R5bGUuaGVpZ2h0IHx8IG8uZm9yY2VIZWxwZXJTaXplKSB7CgkJCWhlbHBlci5oZWlnaHQodGhpcy5jdXJyZW50SXRlbS5oZWlnaHQoKSk7CgkJfQoKCQlyZXR1cm4gaGVscGVyOwoKCX0sCgoJX2FkanVzdE9mZnNldEZyb21IZWxwZXI6IGZ1bmN0aW9uKG9iaikgewoJCWlmICh0eXBlb2Ygb2JqID09PSAic3RyaW5nIikgewoJCQlvYmogPSBvYmouc3BsaXQoIiAiKTsKCQl9CgkJaWYgKCQuaXNBcnJheShvYmopKSB7CgkJCW9iaiA9IHtsZWZ0OiArb2JqWzBdLCB0b3A6ICtvYmpbMV0gfHwgMH07CgkJfQoJCWlmICgibGVmdCIgaW4gb2JqKSB7CgkJCXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPSBvYmoubGVmdCArIHRoaXMubWFyZ2lucy5sZWZ0OwoJCX0KCQlpZiAoInJpZ2h0IiBpbiBvYmopIHsKCQkJdGhpcy5vZmZzZXQuY2xpY2subGVmdCA9IHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLSBvYmoucmlnaHQgKyB0aGlzLm1hcmdpbnMubGVmdDsKCQl9CgkJaWYgKCJ0b3AiIGluIG9iaikgewoJCQl0aGlzLm9mZnNldC5jbGljay50b3AgPSBvYmoudG9wICsgdGhpcy5tYXJnaW5zLnRvcDsKCQl9CgkJaWYgKCJib3R0b20iIGluIG9iaikgewoJCQl0aGlzLm9mZnNldC5jbGljay50b3AgPSB0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAtIG9iai5ib3R0b20gKyB0aGlzLm1hcmdpbnMudG9wOwoJCX0KCX0sCgoJX2dldFBhcmVudE9mZnNldDogZnVuY3Rpb24oKSB7CgoKCQkvL0dldCB0aGUgb2Zmc2V0UGFyZW50IGFuZCBjYWNoZSBpdHMgcG9zaXRpb24KCQl0aGlzLm9mZnNldFBhcmVudCA9IHRoaXMuaGVscGVyLm9mZnNldFBhcmVudCgpOwoJCXZhciBwbyA9IHRoaXMub2Zmc2V0UGFyZW50Lm9mZnNldCgpOwoKCQkvLyBUaGlzIGlzIGEgc3BlY2lhbCBjYXNlIHdoZXJlIHdlIG5lZWQgdG8gbW9kaWZ5IGEgb2Zmc2V0IGNhbGN1bGF0ZWQgb24gc3RhcnQsIHNpbmNlIHRoZSBmb2xsb3dpbmcgaGFwcGVuZWQ6CgkJLy8gMS4gVGhlIHBvc2l0aW9uIG9mIHRoZSBoZWxwZXIgaXMgYWJzb2x1dGUsIHNvIGl0J3MgcG9zaXRpb24gaXMgY2FsY3VsYXRlZCBiYXNlZCBvbiB0aGUgbmV4dCBwb3NpdGlvbmVkIHBhcmVudAoJCS8vIDIuIFRoZSBhY3R1YWwgb2Zmc2V0IHBhcmVudCBpcyBhIGNoaWxkIG9mIHRoZSBzY3JvbGwgcGFyZW50LCBhbmQgdGhlIHNjcm9sbCBwYXJlbnQgaXNuJ3QgdGhlIGRvY3VtZW50LCB3aGljaCBtZWFucyB0aGF0CgkJLy8gICAgdGhlIHNjcm9sbCBpcyBpbmNsdWRlZCBpbiB0aGUgaW5pdGlhbCBjYWxjdWxhdGlvbiBvZiB0aGUgb2Zmc2V0IG9mIHRoZSBwYXJlbnQsIGFuZCBuZXZlciByZWNhbGN1bGF0ZWQgdXBvbiBkcmFnCgkJaWYodGhpcy5jc3NQb3NpdGlvbiA9PT0gImFic29sdXRlIiAmJiB0aGlzLnNjcm9sbFBhcmVudFswXSAhPT0gZG9jdW1lbnQgJiYgJC5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSwgdGhpcy5vZmZzZXRQYXJlbnRbMF0pKSB7CgkJCXBvLmxlZnQgKz0gdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOwoJCQlwby50b3AgKz0gdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCk7CgkJfQoKCQkvLyBUaGlzIG5lZWRzIHRvIGJlIGFjdHVhbGx5IGRvbmUgZm9yIGFsbCBicm93c2Vycywgc2luY2UgcGFnZVgvcGFnZVkgaW5jbHVkZXMgdGhpcyBpbmZvcm1hdGlvbgoJCS8vIHdpdGggYW4gdWdseSBJRSBmaXgKCQlpZiggdGhpcy5vZmZzZXRQYXJlbnRbMF0gPT09IGRvY3VtZW50LmJvZHkgfHwgKHRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUgJiYgdGhpcy5vZmZzZXRQYXJlbnRbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaHRtbCIgJiYgJC51aS5pZSkpIHsKCQkJcG8gPSB7IHRvcDogMCwgbGVmdDogMCB9OwoJCX0KCgkJcmV0dXJuIHsKCQkJdG9wOiBwby50b3AgKyAocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKCJib3JkZXJUb3BXaWR0aCIpLDEwKSB8fCAwKSwKCQkJbGVmdDogcG8ubGVmdCArIChwYXJzZUludCh0aGlzLm9mZnNldFBhcmVudC5jc3MoImJvcmRlckxlZnRXaWR0aCIpLDEwKSB8fCAwKQoJCX07CgoJfSwKCglfZ2V0UmVsYXRpdmVPZmZzZXQ6IGZ1bmN0aW9uKCkgewoKCQlpZih0aGlzLmNzc1Bvc2l0aW9uID09PSAicmVsYXRpdmUiKSB7CgkJCXZhciBwID0gdGhpcy5jdXJyZW50SXRlbS5wb3NpdGlvbigpOwoJCQlyZXR1cm4gewoJCQkJdG9wOiBwLnRvcCAtIChwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoInRvcCIpLDEwKSB8fCAwKSArIHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpLAoJCQkJbGVmdDogcC5sZWZ0IC0gKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcygibGVmdCIpLDEwKSB8fCAwKSArIHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKQoJCQl9OwoJCX0gZWxzZSB7CgkJCXJldHVybiB7IHRvcDogMCwgbGVmdDogMCB9OwoJCX0KCgl9LAoKCV9jYWNoZU1hcmdpbnM6IGZ1bmN0aW9uKCkgewoJCXRoaXMubWFyZ2lucyA9IHsKCQkJbGVmdDogKHBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKCJtYXJnaW5MZWZ0IiksMTApIHx8IDApLAoJCQl0b3A6IChwYXJzZUludCh0aGlzLmN1cnJlbnRJdGVtLmNzcygibWFyZ2luVG9wIiksMTApIHx8IDApCgkJfTsKCX0sCgoJX2NhY2hlSGVscGVyUHJvcG9ydGlvbnM6IGZ1bmN0aW9uKCkgewoJCXRoaXMuaGVscGVyUHJvcG9ydGlvbnMgPSB7CgkJCXdpZHRoOiB0aGlzLmhlbHBlci5vdXRlcldpZHRoKCksCgkJCWhlaWdodDogdGhpcy5oZWxwZXIub3V0ZXJIZWlnaHQoKQoJCX07Cgl9LAoKCV9zZXRDb250YWlubWVudDogZnVuY3Rpb24oKSB7CgoJCXZhciBjZSwgY28sIG92ZXIsCgkJCW8gPSB0aGlzLm9wdGlvbnM7CgkJaWYoby5jb250YWlubWVudCA9PT0gInBhcmVudCIpIHsKCQkJby5jb250YWlubWVudCA9IHRoaXMuaGVscGVyWzBdLnBhcmVudE5vZGU7CgkJfQoJCWlmKG8uY29udGFpbm1lbnQgPT09ICJkb2N1bWVudCIgfHwgby5jb250YWlubWVudCA9PT0gIndpbmRvdyIpIHsKCQkJdGhpcy5jb250YWlubWVudCA9IFsKCQkJCTAgLSB0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0IC0gdGhpcy5vZmZzZXQucGFyZW50LmxlZnQsCgkJCQkwIC0gdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wIC0gdGhpcy5vZmZzZXQucGFyZW50LnRvcCwKCQkJCSQoby5jb250YWlubWVudCA9PT0gImRvY3VtZW50IiA/IGRvY3VtZW50IDogd2luZG93KS53aWR0aCgpIC0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCAtIHRoaXMubWFyZ2lucy5sZWZ0LAoJCQkJKCQoby5jb250YWlubWVudCA9PT0gImRvY3VtZW50IiA/IGRvY3VtZW50IDogd2luZG93KS5oZWlnaHQoKSB8fCBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gdGhpcy5tYXJnaW5zLnRvcAoJCQldOwoJCX0KCgkJaWYoISgvXihkb2N1bWVudHx3aW5kb3d8cGFyZW50KSQvKS50ZXN0KG8uY29udGFpbm1lbnQpKSB7CgkJCWNlID0gJChvLmNvbnRhaW5tZW50KVswXTsKCQkJY28gPSAkKG8uY29udGFpbm1lbnQpLm9mZnNldCgpOwoJCQlvdmVyID0gKCQoY2UpLmNzcygib3ZlcmZsb3ciKSAhPT0gImhpZGRlbiIpOwoKCQkJdGhpcy5jb250YWlubWVudCA9IFsKCQkJCWNvLmxlZnQgKyAocGFyc2VJbnQoJChjZSkuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwxMCkgfHwgMCkgKyAocGFyc2VJbnQoJChjZSkuY3NzKCJwYWRkaW5nTGVmdCIpLDEwKSB8fCAwKSAtIHRoaXMubWFyZ2lucy5sZWZ0LAoJCQkJY28udG9wICsgKHBhcnNlSW50KCQoY2UpLmNzcygiYm9yZGVyVG9wV2lkdGgiKSwxMCkgfHwgMCkgKyAocGFyc2VJbnQoJChjZSkuY3NzKCJwYWRkaW5nVG9wIiksMTApIHx8IDApIC0gdGhpcy5tYXJnaW5zLnRvcCwKCQkJCWNvLmxlZnQrKG92ZXIgPyBNYXRoLm1heChjZS5zY3JvbGxXaWR0aCxjZS5vZmZzZXRXaWR0aCkgOiBjZS5vZmZzZXRXaWR0aCkgLSAocGFyc2VJbnQoJChjZSkuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwxMCkgfHwgMCkgLSAocGFyc2VJbnQoJChjZSkuY3NzKCJwYWRkaW5nUmlnaHQiKSwxMCkgfHwgMCkgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC0gdGhpcy5tYXJnaW5zLmxlZnQsCgkJCQljby50b3ArKG92ZXIgPyBNYXRoLm1heChjZS5zY3JvbGxIZWlnaHQsY2Uub2Zmc2V0SGVpZ2h0KSA6IGNlLm9mZnNldEhlaWdodCkgLSAocGFyc2VJbnQoJChjZSkuY3NzKCJib3JkZXJUb3BXaWR0aCIpLDEwKSB8fCAwKSAtIChwYXJzZUludCgkKGNlKS5jc3MoInBhZGRpbmdCb3R0b20iKSwxMCkgfHwgMCkgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAtIHRoaXMubWFyZ2lucy50b3AKCQkJXTsKCQl9CgoJfSwKCglfY29udmVydFBvc2l0aW9uVG86IGZ1bmN0aW9uKGQsIHBvcykgewoKCQlpZighcG9zKSB7CgkJCXBvcyA9IHRoaXMucG9zaXRpb247CgkJfQoJCXZhciBtb2QgPSBkID09PSAiYWJzb2x1dGUiID8gMSA6IC0xLAoJCQlzY3JvbGwgPSB0aGlzLmNzc1Bvc2l0aW9uID09PSAiYWJzb2x1dGUiICYmICEodGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IGRvY3VtZW50ICYmICQuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sIHRoaXMub2Zmc2V0UGFyZW50WzBdKSkgPyB0aGlzLm9mZnNldFBhcmVudCA6IHRoaXMuc2Nyb2xsUGFyZW50LAoJCQlzY3JvbGxJc1Jvb3ROb2RlID0gKC8oaHRtbHxib2R5KS9pKS50ZXN0KHNjcm9sbFswXS50YWdOYW1lKTsKCgkJcmV0dXJuIHsKCQkJdG9wOiAoCgkJCQlwb3MudG9wCSsJCQkJCQkJCQkJCQkJCQkJLy8gVGhlIGFic29sdXRlIG1vdXNlIHBvc2l0aW9uCgkJCQl0aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AgKiBtb2QgKwkJCQkJCQkJCQkvLyBPbmx5IGZvciByZWxhdGl2ZSBwb3NpdGlvbmVkIG5vZGVzOiBSZWxhdGl2ZSBvZmZzZXQgZnJvbSBlbGVtZW50IHRvIG9mZnNldCBwYXJlbnQKCQkJCXRoaXMub2Zmc2V0LnBhcmVudC50b3AgKiBtb2QgLQkJCQkJCQkJCQkJLy8gVGhlIG9mZnNldFBhcmVudCdzIG9mZnNldCB3aXRob3V0IGJvcmRlcnMgKG9mZnNldCArIGJvcmRlcikKCQkJCSggKCB0aGlzLmNzc1Bvc2l0aW9uID09PSAiZml4ZWQiID8gLXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpIDogKCBzY3JvbGxJc1Jvb3ROb2RlID8gMCA6IHNjcm9sbC5zY3JvbGxUb3AoKSApICkgKiBtb2QpCgkJCSksCgkJCWxlZnQ6ICgKCQkJCXBvcy5sZWZ0ICsJCQkJCQkJCQkJCQkJCQkJLy8gVGhlIGFic29sdXRlIG1vdXNlIHBvc2l0aW9uCgkJCQl0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0ICogbW9kICsJCQkJCQkJCQkJLy8gT25seSBmb3IgcmVsYXRpdmUgcG9zaXRpb25lZCBub2RlczogUmVsYXRpdmUgb2Zmc2V0IGZyb20gZWxlbWVudCB0byBvZmZzZXQgcGFyZW50CgkJCQl0aGlzLm9mZnNldC5wYXJlbnQubGVmdCAqIG1vZAktCQkJCQkJCQkJCS8vIFRoZSBvZmZzZXRQYXJlbnQncyBvZmZzZXQgd2l0aG91dCBib3JkZXJzIChvZmZzZXQgKyBib3JkZXIpCgkJCQkoICggdGhpcy5jc3NQb3NpdGlvbiA9PT0gImZpeGVkIiA/IC10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCkgOiBzY3JvbGxJc1Jvb3ROb2RlID8gMCA6IHNjcm9sbC5zY3JvbGxMZWZ0KCkgKSAqIG1vZCkKCQkJKQoJCX07CgoJfSwKCglfZ2VuZXJhdGVQb3NpdGlvbjogZnVuY3Rpb24oZXZlbnQpIHsKCgkJdmFyIHRvcCwgbGVmdCwKCQkJbyA9IHRoaXMub3B0aW9ucywKCQkJcGFnZVggPSBldmVudC5wYWdlWCwKCQkJcGFnZVkgPSBldmVudC5wYWdlWSwKCQkJc2Nyb2xsID0gdGhpcy5jc3NQb3NpdGlvbiA9PT0gImFic29sdXRlIiAmJiAhKHRoaXMuc2Nyb2xsUGFyZW50WzBdICE9PSBkb2N1bWVudCAmJiAkLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLCB0aGlzLm9mZnNldFBhcmVudFswXSkpID8gdGhpcy5vZmZzZXRQYXJlbnQgOiB0aGlzLnNjcm9sbFBhcmVudCwgc2Nyb2xsSXNSb290Tm9kZSA9ICgvKGh0bWx8Ym9keSkvaSkudGVzdChzY3JvbGxbMF0udGFnTmFtZSk7CgoJCS8vIFRoaXMgaXMgYW5vdGhlciB2ZXJ5IHdlaXJkIHNwZWNpYWwgY2FzZSB0aGF0IG9ubHkgaGFwcGVucyBmb3IgcmVsYXRpdmUgZWxlbWVudHM6CgkJLy8gMS4gSWYgdGhlIGNzcyBwb3NpdGlvbiBpcyByZWxhdGl2ZQoJCS8vIDIuIGFuZCB0aGUgc2Nyb2xsIHBhcmVudCBpcyB0aGUgZG9jdW1lbnQgb3Igc2ltaWxhciB0byB0aGUgb2Zmc2V0IHBhcmVudAoJCS8vIHdlIGhhdmUgdG8gcmVmcmVzaCB0aGUgcmVsYXRpdmUgb2Zmc2V0IGR1cmluZyB0aGUgc2Nyb2xsIHNvIHRoZXJlIGFyZSBubyBqdW1wcwoJCWlmKHRoaXMuY3NzUG9zaXRpb24gPT09ICJyZWxhdGl2ZSIgJiYgISh0aGlzLnNjcm9sbFBhcmVudFswXSAhPT0gZG9jdW1lbnQgJiYgdGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IHRoaXMub2Zmc2V0UGFyZW50WzBdKSkgewoJCQl0aGlzLm9mZnNldC5yZWxhdGl2ZSA9IHRoaXMuX2dldFJlbGF0aXZlT2Zmc2V0KCk7CgkJfQoKCQkvKgoJCSAqIC0gUG9zaXRpb24gY29uc3RyYWluaW5nIC0KCQkgKiBDb25zdHJhaW4gdGhlIHBvc2l0aW9uIHRvIGEgbWl4IG9mIGdyaWQsIGNvbnRhaW5tZW50LgoJCSAqLwoKCQlpZih0aGlzLm9yaWdpbmFsUG9zaXRpb24pIHsgLy9JZiB3ZSBhcmUgbm90IGRyYWdnaW5nIHlldCwgd2Ugd29uJ3QgY2hlY2sgZm9yIG9wdGlvbnMKCgkJCWlmKHRoaXMuY29udGFpbm1lbnQpIHsKCQkJCWlmKGV2ZW50LnBhZ2VYIC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA8IHRoaXMuY29udGFpbm1lbnRbMF0pIHsKCQkJCQlwYWdlWCA9IHRoaXMuY29udGFpbm1lbnRbMF0gKyB0aGlzLm9mZnNldC5jbGljay5sZWZ0OwoJCQkJfQoJCQkJaWYoZXZlbnQucGFnZVkgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPCB0aGlzLmNvbnRhaW5tZW50WzFdKSB7CgkJCQkJcGFnZVkgPSB0aGlzLmNvbnRhaW5tZW50WzFdICsgdGhpcy5vZmZzZXQuY2xpY2sudG9wOwoJCQkJfQoJCQkJaWYoZXZlbnQucGFnZVggLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID4gdGhpcy5jb250YWlubWVudFsyXSkgewoJCQkJCXBhZ2VYID0gdGhpcy5jb250YWlubWVudFsyXSArIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ7CgkJCQl9CgkJCQlpZihldmVudC5wYWdlWSAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+IHRoaXMuY29udGFpbm1lbnRbM10pIHsKCQkJCQlwYWdlWSA9IHRoaXMuY29udGFpbm1lbnRbM10gKyB0aGlzLm9mZnNldC5jbGljay50b3A7CgkJCQl9CgkJCX0KCgkJCWlmKG8uZ3JpZCkgewoJCQkJdG9wID0gdGhpcy5vcmlnaW5hbFBhZ2VZICsgTWF0aC5yb3VuZCgocGFnZVkgLSB0aGlzLm9yaWdpbmFsUGFnZVkpIC8gby5ncmlkWzFdKSAqIG8uZ3JpZFsxXTsKCQkJCXBhZ2VZID0gdGhpcy5jb250YWlubWVudCA/ICggKHRvcCAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+PSB0aGlzLmNvbnRhaW5tZW50WzFdICYmIHRvcCAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA8PSB0aGlzLmNvbnRhaW5tZW50WzNdKSA/IHRvcCA6ICgodG9wIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wID49IHRoaXMuY29udGFpbm1lbnRbMV0pID8gdG9wIC0gby5ncmlkWzFdIDogdG9wICsgby5ncmlkWzFdKSkgOiB0b3A7CgoJCQkJbGVmdCA9IHRoaXMub3JpZ2luYWxQYWdlWCArIE1hdGgucm91bmQoKHBhZ2VYIC0gdGhpcy5vcmlnaW5hbFBhZ2VYKSAvIG8uZ3JpZFswXSkgKiBvLmdyaWRbMF07CgkJCQlwYWdlWCA9IHRoaXMuY29udGFpbm1lbnQgPyAoIChsZWZ0IC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA+PSB0aGlzLmNvbnRhaW5tZW50WzBdICYmIGxlZnQgLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0IDw9IHRoaXMuY29udGFpbm1lbnRbMl0pID8gbGVmdCA6ICgobGVmdCAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPj0gdGhpcy5jb250YWlubWVudFswXSkgPyBsZWZ0IC0gby5ncmlkWzBdIDogbGVmdCArIG8uZ3JpZFswXSkpIDogbGVmdDsKCQkJfQoKCQl9CgoJCXJldHVybiB7CgkJCXRvcDogKAoJCQkJcGFnZVkgLQkJCQkJCQkJCQkJCQkJCQkvLyBUaGUgYWJzb2x1dGUgbW91c2UgcG9zaXRpb24KCQkJCXRoaXMub2Zmc2V0LmNsaWNrLnRvcCAtCQkJCQkJCQkJCQkJCS8vIENsaWNrIG9mZnNldCAocmVsYXRpdmUgdG8gdGhlIGVsZW1lbnQpCgkJCQl0aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AJLQkJCQkJCQkJCQkJLy8gT25seSBmb3IgcmVsYXRpdmUgcG9zaXRpb25lZCBub2RlczogUmVsYXRpdmUgb2Zmc2V0IGZyb20gZWxlbWVudCB0byBvZmZzZXQgcGFyZW50CgkJCQl0aGlzLm9mZnNldC5wYXJlbnQudG9wICsJCQkJCQkJCQkJCQkvLyBUaGUgb2Zmc2V0UGFyZW50J3Mgb2Zmc2V0IHdpdGhvdXQgYm9yZGVycyAob2Zmc2V0ICsgYm9yZGVyKQoJCQkJKCAoIHRoaXMuY3NzUG9zaXRpb24gPT09ICJmaXhlZCIgPyAtdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCkgOiAoIHNjcm9sbElzUm9vdE5vZGUgPyAwIDogc2Nyb2xsLnNjcm9sbFRvcCgpICkgKSkKCQkJKSwKCQkJbGVmdDogKAoJCQkJcGFnZVggLQkJCQkJCQkJCQkJCQkJCQkvLyBUaGUgYWJzb2x1dGUgbW91c2UgcG9zaXRpb24KCQkJCXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgLQkJCQkJCQkJCQkJCS8vIENsaWNrIG9mZnNldCAocmVsYXRpdmUgdG8gdGhlIGVsZW1lbnQpCgkJCQl0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0CS0JCQkJCQkJCQkJCS8vIE9ubHkgZm9yIHJlbGF0aXZlIHBvc2l0aW9uZWQgbm9kZXM6IFJlbGF0aXZlIG9mZnNldCBmcm9tIGVsZW1lbnQgdG8gb2Zmc2V0IHBhcmVudAoJCQkJdGhpcy5vZmZzZXQucGFyZW50LmxlZnQgKwkJCQkJCQkJCQkJCS8vIFRoZSBvZmZzZXRQYXJlbnQncyBvZmZzZXQgd2l0aG91dCBib3JkZXJzIChvZmZzZXQgKyBib3JkZXIpCgkJCQkoICggdGhpcy5jc3NQb3NpdGlvbiA9PT0gImZpeGVkIiA/IC10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCkgOiBzY3JvbGxJc1Jvb3ROb2RlID8gMCA6IHNjcm9sbC5zY3JvbGxMZWZ0KCkgKSkKCQkJKQoJCX07CgoJfSwKCglfcmVhcnJhbmdlOiBmdW5jdGlvbihldmVudCwgaSwgYSwgaGFyZFJlZnJlc2gpIHsKCgkJYSA/IGFbMF0uYXBwZW5kQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSkgOiBpLml0ZW1bMF0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5wbGFjZWhvbGRlclswXSwgKHRoaXMuZGlyZWN0aW9uID09PSAiZG93biIgPyBpLml0ZW1bMF0gOiBpLml0ZW1bMF0ubmV4dFNpYmxpbmcpKTsKCgkJLy9WYXJpb3VzIHRoaW5ncyBkb25lIGhlcmUgdG8gaW1wcm92ZSB0aGUgcGVyZm9ybWFuY2U6CgkJLy8gMS4gd2UgY3JlYXRlIGEgc2V0VGltZW91dCwgdGhhdCBjYWxscyByZWZyZXNoUG9zaXRpb25zCgkJLy8gMi4gb24gdGhlIGluc3RhbmNlLCB3ZSBoYXZlIGEgY291bnRlciB2YXJpYWJsZSwgdGhhdCBnZXQncyBoaWdoZXIgYWZ0ZXIgZXZlcnkgYXBwZW5kCgkJLy8gMy4gb24gdGhlIGxvY2FsIHNjb3BlLCB3ZSBjb3B5IHRoZSBjb3VudGVyIHZhcmlhYmxlLCBhbmQgY2hlY2sgaW4gdGhlIHRpbWVvdXQsIGlmIGl0J3Mgc3RpbGwgdGhlIHNhbWUKCQkvLyA0LiB0aGlzIGxldHMgb25seSB0aGUgbGFzdCBhZGRpdGlvbiB0byB0aGUgdGltZW91dCBzdGFjayB0aHJvdWdoCgkJdGhpcy5jb3VudGVyID0gdGhpcy5jb3VudGVyID8gKyt0aGlzLmNvdW50ZXIgOiAxOwoJCXZhciBjb3VudGVyID0gdGhpcy5jb3VudGVyOwoKCQl0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJaWYoY291bnRlciA9PT0gdGhpcy5jb3VudGVyKSB7CgkJCQl0aGlzLnJlZnJlc2hQb3NpdGlvbnMoIWhhcmRSZWZyZXNoKTsgLy9QcmVjb21wdXRlIGFmdGVyIGVhY2ggRE9NIGluc2VydGlvbiwgTk9UIG9uIG1vdXNlbW92ZQoJCQl9CgkJfSk7CgoJfSwKCglfY2xlYXI6IGZ1bmN0aW9uKGV2ZW50LCBub1Byb3BhZ2F0aW9uKSB7CgoJCXRoaXMucmV2ZXJ0aW5nID0gZmFsc2U7CgkJLy8gV2UgZGVsYXkgYWxsIGV2ZW50cyB0aGF0IGhhdmUgdG8gYmUgdHJpZ2dlcmVkIHRvIGFmdGVyIHRoZSBwb2ludCB3aGVyZSB0aGUgcGxhY2Vob2xkZXIgaGFzIGJlZW4gcmVtb3ZlZCBhbmQKCQkvLyBldmVyeXRoaW5nIGVsc2Ugbm9ybWFsaXplZCBhZ2FpbgoJCXZhciBpLAoJCQlkZWxheWVkVHJpZ2dlcnMgPSBbXTsKCgkJLy8gV2UgZmlyc3QgaGF2ZSB0byB1cGRhdGUgdGhlIGRvbSBwb3NpdGlvbiBvZiB0aGUgYWN0dWFsIGN1cnJlbnRJdGVtCgkJLy8gTm90ZTogZG9uJ3QgZG8gaXQgaWYgdGhlIGN1cnJlbnQgaXRlbSBpcyBhbHJlYWR5IHJlbW92ZWQgKGJ5IGEgdXNlciksIG9yIGl0IGdldHMgcmVhcHBlbmRlZCAoc2VlICM0MDg4KQoJCWlmKCF0aGlzLl9ub0ZpbmFsU29ydCAmJiB0aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpLmxlbmd0aCkgewoJCQl0aGlzLnBsYWNlaG9sZGVyLmJlZm9yZSh0aGlzLmN1cnJlbnRJdGVtKTsKCQl9CgkJdGhpcy5fbm9GaW5hbFNvcnQgPSBudWxsOwoKCQlpZih0aGlzLmhlbHBlclswXSA9PT0gdGhpcy5jdXJyZW50SXRlbVswXSkgewoJCQlmb3IoaSBpbiB0aGlzLl9zdG9yZWRDU1MpIHsKCQkJCWlmKHRoaXMuX3N0b3JlZENTU1tpXSA9PT0gImF1dG8iIHx8IHRoaXMuX3N0b3JlZENTU1tpXSA9PT0gInN0YXRpYyIpIHsKCQkJCQl0aGlzLl9zdG9yZWRDU1NbaV0gPSAiIjsKCQkJCX0KCQkJfQoJCQl0aGlzLmN1cnJlbnRJdGVtLmNzcyh0aGlzLl9zdG9yZWRDU1MpLnJlbW92ZUNsYXNzKCJ1aS1zb3J0YWJsZS1oZWxwZXIiKTsKCQl9IGVsc2UgewoJCQl0aGlzLmN1cnJlbnRJdGVtLnNob3coKTsKCQl9CgoJCWlmKHRoaXMuZnJvbU91dHNpZGUgJiYgIW5vUHJvcGFnYXRpb24pIHsKCQkJZGVsYXllZFRyaWdnZXJzLnB1c2goZnVuY3Rpb24oZXZlbnQpIHsgdGhpcy5fdHJpZ2dlcigicmVjZWl2ZSIsIGV2ZW50LCB0aGlzLl91aUhhc2godGhpcy5mcm9tT3V0c2lkZSkpOyB9KTsKCQl9CgkJaWYoKHRoaXMuZnJvbU91dHNpZGUgfHwgdGhpcy5kb21Qb3NpdGlvbi5wcmV2ICE9PSB0aGlzLmN1cnJlbnRJdGVtLnByZXYoKS5ub3QoIi51aS1zb3J0YWJsZS1oZWxwZXIiKVswXSB8fCB0aGlzLmRvbVBvc2l0aW9uLnBhcmVudCAhPT0gdGhpcy5jdXJyZW50SXRlbS5wYXJlbnQoKVswXSkgJiYgIW5vUHJvcGFnYXRpb24pIHsKCQkJZGVsYXllZFRyaWdnZXJzLnB1c2goZnVuY3Rpb24oZXZlbnQpIHsgdGhpcy5fdHJpZ2dlcigidXBkYXRlIiwgZXZlbnQsIHRoaXMuX3VpSGFzaCgpKTsgfSk7IC8vVHJpZ2dlciB1cGRhdGUgY2FsbGJhY2sgaWYgdGhlIERPTSBwb3NpdGlvbiBoYXMgY2hhbmdlZAoJCX0KCgkJLy8gQ2hlY2sgaWYgdGhlIGl0ZW1zIENvbnRhaW5lciBoYXMgQ2hhbmdlZCBhbmQgdHJpZ2dlciBhcHByb3ByaWF0ZQoJCS8vIGV2ZW50cy4KCQlpZiAodGhpcyAhPT0gdGhpcy5jdXJyZW50Q29udGFpbmVyKSB7CgkJCWlmKCFub1Byb3BhZ2F0aW9uKSB7CgkJCQlkZWxheWVkVHJpZ2dlcnMucHVzaChmdW5jdGlvbihldmVudCkgeyB0aGlzLl90cmlnZ2VyKCJyZW1vdmUiLCBldmVudCwgdGhpcy5fdWlIYXNoKCkpOyB9KTsKCQkJCWRlbGF5ZWRUcmlnZ2Vycy5wdXNoKChmdW5jdGlvbihjKSB7IHJldHVybiBmdW5jdGlvbihldmVudCkgeyBjLl90cmlnZ2VyKCJyZWNlaXZlIiwgZXZlbnQsIHRoaXMuX3VpSGFzaCh0aGlzKSk7IH07ICB9KS5jYWxsKHRoaXMsIHRoaXMuY3VycmVudENvbnRhaW5lcikpOwoJCQkJZGVsYXllZFRyaWdnZXJzLnB1c2goKGZ1bmN0aW9uKGMpIHsgcmV0dXJuIGZ1bmN0aW9uKGV2ZW50KSB7IGMuX3RyaWdnZXIoInVwZGF0ZSIsIGV2ZW50LCB0aGlzLl91aUhhc2godGhpcykpOyAgfTsgfSkuY2FsbCh0aGlzLCB0aGlzLmN1cnJlbnRDb250YWluZXIpKTsKCQkJfQoJCX0KCgoJCS8vUG9zdCBldmVudHMgdG8gY29udGFpbmVycwoJCWZ1bmN0aW9uIGRlbGF5RXZlbnQoIHR5cGUsIGluc3RhbmNlLCBjb250YWluZXIgKSB7CgkJCXJldHVybiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQljb250YWluZXIuX3RyaWdnZXIoIHR5cGUsIGV2ZW50LCBpbnN0YW5jZS5fdWlIYXNoKCBpbnN0YW5jZSApICk7CgkJCX07CgkJfQoJCWZvciAoaSA9IHRoaXMuY29udGFpbmVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSl7CgkJCWlmICghbm9Qcm9wYWdhdGlvbikgewoJCQkJZGVsYXllZFRyaWdnZXJzLnB1c2goIGRlbGF5RXZlbnQoICJkZWFjdGl2YXRlIiwgdGhpcywgdGhpcy5jb250YWluZXJzWyBpIF0gKSApOwoJCQl9CgkJCWlmKHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5vdmVyKSB7CgkJCQlkZWxheWVkVHJpZ2dlcnMucHVzaCggZGVsYXlFdmVudCggIm91dCIsIHRoaXMsIHRoaXMuY29udGFpbmVyc1sgaSBdICkgKTsKCQkJCXRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5vdmVyID0gMDsKCQkJfQoJCX0KCgkJLy9EbyB3aGF0IHdhcyBvcmlnaW5hbGx5IGluIHBsdWdpbnMKCQlpZiAoIHRoaXMuc3RvcmVkQ3Vyc29yICkgewoJCQl0aGlzLmRvY3VtZW50LmZpbmQoICJib2R5IiApLmNzcyggImN1cnNvciIsIHRoaXMuc3RvcmVkQ3Vyc29yICk7CgkJCXRoaXMuc3RvcmVkU3R5bGVzaGVldC5yZW1vdmUoKTsKCQl9CgkJaWYodGhpcy5fc3RvcmVkT3BhY2l0eSkgewoJCQl0aGlzLmhlbHBlci5jc3MoIm9wYWNpdHkiLCB0aGlzLl9zdG9yZWRPcGFjaXR5KTsKCQl9CgkJaWYodGhpcy5fc3RvcmVkWkluZGV4KSB7CgkJCXRoaXMuaGVscGVyLmNzcygiekluZGV4IiwgdGhpcy5fc3RvcmVkWkluZGV4ID09PSAiYXV0byIgPyAiIiA6IHRoaXMuX3N0b3JlZFpJbmRleCk7CgkJfQoKCQl0aGlzLmRyYWdnaW5nID0gZmFsc2U7CgkJaWYodGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsKSB7CgkJCWlmKCFub1Byb3BhZ2F0aW9uKSB7CgkJCQl0aGlzLl90cmlnZ2VyKCJiZWZvcmVTdG9wIiwgZXZlbnQsIHRoaXMuX3VpSGFzaCgpKTsKCQkJCWZvciAoaT0wOyBpIDwgZGVsYXllZFRyaWdnZXJzLmxlbmd0aDsgaSsrKSB7CgkJCQkJZGVsYXllZFRyaWdnZXJzW2ldLmNhbGwodGhpcywgZXZlbnQpOwoJCQkJfSAvL1RyaWdnZXIgYWxsIGRlbGF5ZWQgZXZlbnRzCgkJCQl0aGlzLl90cmlnZ2VyKCJzdG9wIiwgZXZlbnQsIHRoaXMuX3VpSGFzaCgpKTsKCQkJfQoKCQkJdGhpcy5mcm9tT3V0c2lkZSA9IGZhbHNlOwoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQlpZighbm9Qcm9wYWdhdGlvbikgewoJCQl0aGlzLl90cmlnZ2VyKCJiZWZvcmVTdG9wIiwgZXZlbnQsIHRoaXMuX3VpSGFzaCgpKTsKCQl9CgoJCS8vJCh0aGlzLnBsYWNlaG9sZGVyWzBdKS5yZW1vdmUoKTsgd291bGQgaGF2ZSBiZWVuIHRoZSBqUXVlcnkgd2F5IC0gdW5mb3J0dW5hdGVseSwgaXQgdW5iaW5kcyBBTEwgZXZlbnRzIGZyb20gdGhlIG9yaWdpbmFsIG5vZGUhCgkJdGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pOwoKCQlpZih0aGlzLmhlbHBlclswXSAhPT0gdGhpcy5jdXJyZW50SXRlbVswXSkgewoJCQl0aGlzLmhlbHBlci5yZW1vdmUoKTsKCQl9CgkJdGhpcy5oZWxwZXIgPSBudWxsOwoKCQlpZighbm9Qcm9wYWdhdGlvbikgewoJCQlmb3IgKGk9MDsgaSA8IGRlbGF5ZWRUcmlnZ2Vycy5sZW5ndGg7IGkrKykgewoJCQkJZGVsYXllZFRyaWdnZXJzW2ldLmNhbGwodGhpcywgZXZlbnQpOwoJCQl9IC8vVHJpZ2dlciBhbGwgZGVsYXllZCBldmVudHMKCQkJdGhpcy5fdHJpZ2dlcigic3RvcCIsIGV2ZW50LCB0aGlzLl91aUhhc2goKSk7CgkJfQoKCQl0aGlzLmZyb21PdXRzaWRlID0gZmFsc2U7CgkJcmV0dXJuIHRydWU7CgoJfSwKCglfdHJpZ2dlcjogZnVuY3Rpb24oKSB7CgkJaWYgKCQuV2lkZ2V0LnByb3RvdHlwZS5fdHJpZ2dlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpID09PSBmYWxzZSkgewoJCQl0aGlzLmNhbmNlbCgpOwoJCX0KCX0sCgoJX3VpSGFzaDogZnVuY3Rpb24oX2luc3QpIHsKCQl2YXIgaW5zdCA9IF9pbnN0IHx8IHRoaXM7CgkJcmV0dXJuIHsKCQkJaGVscGVyOiBpbnN0LmhlbHBlciwKCQkJcGxhY2Vob2xkZXI6IGluc3QucGxhY2Vob2xkZXIgfHwgJChbXSksCgkJCXBvc2l0aW9uOiBpbnN0LnBvc2l0aW9uLAoJCQlvcmlnaW5hbFBvc2l0aW9uOiBpbnN0Lm9yaWdpbmFsUG9zaXRpb24sCgkJCW9mZnNldDogaW5zdC5wb3NpdGlvbkFicywKCQkJaXRlbTogaW5zdC5jdXJyZW50SXRlbSwKCQkJc2VuZGVyOiBfaW5zdCA/IF9pbnN0LmVsZW1lbnQgOiBudWxsCgkJfTsKCX0KCn0pOwoKfSkoalF1ZXJ5KTsKCihmdW5jdGlvbigkLCB1bmRlZmluZWQpIHsKCnZhciBkYXRhU3BhY2UgPSAidWktZWZmZWN0cy0iOwoKJC5lZmZlY3RzID0gewoJZWZmZWN0OiB7fQp9OwoKLyohCiAqIGpRdWVyeSBDb2xvciBBbmltYXRpb25zIHYyLjEuMgogKiBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS1jb2xvcgogKgogKiBDb3B5cmlnaHQgMjAxMyBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBEYXRlOiBXZWQgSmFuIDE2IDA4OjQ3OjA5IDIwMTMgLTA2MDAKICovCihmdW5jdGlvbiggalF1ZXJ5LCB1bmRlZmluZWQgKSB7CgoJdmFyIHN0ZXBIb29rcyA9ICJiYWNrZ3JvdW5kQ29sb3IgYm9yZGVyQm90dG9tQ29sb3IgYm9yZGVyTGVmdENvbG9yIGJvcmRlclJpZ2h0Q29sb3IgYm9yZGVyVG9wQ29sb3IgY29sb3IgY29sdW1uUnVsZUNvbG9yIG91dGxpbmVDb2xvciB0ZXh0RGVjb3JhdGlvbkNvbG9yIHRleHRFbXBoYXNpc0NvbG9yIiwKCgkvLyBwbHVzZXF1YWxzIHRlc3QgZm9yICs9IDEwMCAtPSAxMDAKCXJwbHVzZXF1YWxzID0gL14oW1wtK10pPVxzKihcZCtcLj9cZCopLywKCS8vIGEgc2V0IG9mIFJFJ3MgdGhhdCBjYW4gbWF0Y2ggc3RyaW5ncyBhbmQgZ2VuZXJhdGUgY29sb3IgdHVwbGVzLgoJc3RyaW5nUGFyc2VycyA9IFt7CgkJCXJlOiAvcmdiYT9cKFxzKihcZHsxLDN9KVxzKixccyooXGR7MSwzfSlccyosXHMqKFxkezEsM30pXHMqKD86LFxzKihcZD8oPzpcLlxkKyk/KVxzKik/XCkvLAoJCQlwYXJzZTogZnVuY3Rpb24oIGV4ZWNSZXN1bHQgKSB7CgkJCQlyZXR1cm4gWwoJCQkJCWV4ZWNSZXN1bHRbIDEgXSwKCQkJCQlleGVjUmVzdWx0WyAyIF0sCgkJCQkJZXhlY1Jlc3VsdFsgMyBdLAoJCQkJCWV4ZWNSZXN1bHRbIDQgXQoJCQkJXTsKCQkJfQoJCX0sIHsKCQkJcmU6IC9yZ2JhP1woXHMqKFxkKyg/OlwuXGQrKT8pXCVccyosXHMqKFxkKyg/OlwuXGQrKT8pXCVccyosXHMqKFxkKyg/OlwuXGQrKT8pXCVccyooPzosXHMqKFxkPyg/OlwuXGQrKT8pXHMqKT9cKS8sCgkJCXBhcnNlOiBmdW5jdGlvbiggZXhlY1Jlc3VsdCApIHsKCQkJCXJldHVybiBbCgkJCQkJZXhlY1Jlc3VsdFsgMSBdICogMi41NSwKCQkJCQlleGVjUmVzdWx0WyAyIF0gKiAyLjU1LAoJCQkJCWV4ZWNSZXN1bHRbIDMgXSAqIDIuNTUsCgkJCQkJZXhlY1Jlc3VsdFsgNCBdCgkJCQldOwoJCQl9CgkJfSwgewoJCQkvLyB0aGlzIHJlZ2V4IGlnbm9yZXMgQS1GIGJlY2F1c2UgaXQncyBjb21wYXJlZCBhZ2FpbnN0IGFuIGFscmVhZHkgbG93ZXJjYXNlZCBzdHJpbmcKCQkJcmU6IC8jKFthLWYwLTldezJ9KShbYS1mMC05XXsyfSkoW2EtZjAtOV17Mn0pLywKCQkJcGFyc2U6IGZ1bmN0aW9uKCBleGVjUmVzdWx0ICkgewoJCQkJcmV0dXJuIFsKCQkJCQlwYXJzZUludCggZXhlY1Jlc3VsdFsgMSBdLCAxNiApLAoJCQkJCXBhcnNlSW50KCBleGVjUmVzdWx0WyAyIF0sIDE2ICksCgkJCQkJcGFyc2VJbnQoIGV4ZWNSZXN1bHRbIDMgXSwgMTYgKQoJCQkJXTsKCQkJfQoJCX0sIHsKCQkJLy8gdGhpcyByZWdleCBpZ25vcmVzIEEtRiBiZWNhdXNlIGl0J3MgY29tcGFyZWQgYWdhaW5zdCBhbiBhbHJlYWR5IGxvd2VyY2FzZWQgc3RyaW5nCgkJCXJlOiAvIyhbYS1mMC05XSkoW2EtZjAtOV0pKFthLWYwLTldKS8sCgkJCXBhcnNlOiBmdW5jdGlvbiggZXhlY1Jlc3VsdCApIHsKCQkJCXJldHVybiBbCgkJCQkJcGFyc2VJbnQoIGV4ZWNSZXN1bHRbIDEgXSArIGV4ZWNSZXN1bHRbIDEgXSwgMTYgKSwKCQkJCQlwYXJzZUludCggZXhlY1Jlc3VsdFsgMiBdICsgZXhlY1Jlc3VsdFsgMiBdLCAxNiApLAoJCQkJCXBhcnNlSW50KCBleGVjUmVzdWx0WyAzIF0gKyBleGVjUmVzdWx0WyAzIF0sIDE2ICkKCQkJCV07CgkJCX0KCQl9LCB7CgkJCXJlOiAvaHNsYT9cKFxzKihcZCsoPzpcLlxkKyk/KVxzKixccyooXGQrKD86XC5cZCspPylcJVxzKixccyooXGQrKD86XC5cZCspPylcJVxzKig/OixccyooXGQ/KD86XC5cZCspPylccyopP1wpLywKCQkJc3BhY2U6ICJoc2xhIiwKCQkJcGFyc2U6IGZ1bmN0aW9uKCBleGVjUmVzdWx0ICkgewoJCQkJcmV0dXJuIFsKCQkJCQlleGVjUmVzdWx0WyAxIF0sCgkJCQkJZXhlY1Jlc3VsdFsgMiBdIC8gMTAwLAoJCQkJCWV4ZWNSZXN1bHRbIDMgXSAvIDEwMCwKCQkJCQlleGVjUmVzdWx0WyA0IF0KCQkJCV07CgkJCX0KCQl9XSwKCgkvLyBqUXVlcnkuQ29sb3IoICkKCWNvbG9yID0galF1ZXJ5LkNvbG9yID0gZnVuY3Rpb24oIGNvbG9yLCBncmVlbiwgYmx1ZSwgYWxwaGEgKSB7CgkJcmV0dXJuIG5ldyBqUXVlcnkuQ29sb3IuZm4ucGFyc2UoIGNvbG9yLCBncmVlbiwgYmx1ZSwgYWxwaGEgKTsKCX0sCglzcGFjZXMgPSB7CgkJcmdiYTogewoJCQlwcm9wczogewoJCQkJcmVkOiB7CgkJCQkJaWR4OiAwLAoJCQkJCXR5cGU6ICJieXRlIgoJCQkJfSwKCQkJCWdyZWVuOiB7CgkJCQkJaWR4OiAxLAoJCQkJCXR5cGU6ICJieXRlIgoJCQkJfSwKCQkJCWJsdWU6IHsKCQkJCQlpZHg6IDIsCgkJCQkJdHlwZTogImJ5dGUiCgkJCQl9CgkJCX0KCQl9LAoKCQloc2xhOiB7CgkJCXByb3BzOiB7CgkJCQlodWU6IHsKCQkJCQlpZHg6IDAsCgkJCQkJdHlwZTogImRlZ3JlZXMiCgkJCQl9LAoJCQkJc2F0dXJhdGlvbjogewoJCQkJCWlkeDogMSwKCQkJCQl0eXBlOiAicGVyY2VudCIKCQkJCX0sCgkJCQlsaWdodG5lc3M6IHsKCQkJCQlpZHg6IDIsCgkJCQkJdHlwZTogInBlcmNlbnQiCgkJCQl9CgkJCX0KCQl9Cgl9LAoJcHJvcFR5cGVzID0gewoJCSJieXRlIjogewoJCQlmbG9vcjogdHJ1ZSwKCQkJbWF4OiAyNTUKCQl9LAoJCSJwZXJjZW50IjogewoJCQltYXg6IDEKCQl9LAoJCSJkZWdyZWVzIjogewoJCQltb2Q6IDM2MCwKCQkJZmxvb3I6IHRydWUKCQl9Cgl9LAoJc3VwcG9ydCA9IGNvbG9yLnN1cHBvcnQgPSB7fSwKCgkvLyBlbGVtZW50IGZvciBzdXBwb3J0IHRlc3RzCglzdXBwb3J0RWxlbSA9IGpRdWVyeSggIjxwPiIgKVsgMCBdLAoKCS8vIGNvbG9ycyA9IGpRdWVyeS5Db2xvci5uYW1lcwoJY29sb3JzLAoKCS8vIGxvY2FsIGFsaWFzZXMgb2YgZnVuY3Rpb25zIGNhbGxlZCBvZnRlbgoJZWFjaCA9IGpRdWVyeS5lYWNoOwoKLy8gZGV0ZXJtaW5lIHJnYmEgc3VwcG9ydCBpbW1lZGlhdGVseQpzdXBwb3J0RWxlbS5zdHlsZS5jc3NUZXh0ID0gImJhY2tncm91bmQtY29sb3I6cmdiYSgxLDEsMSwuNSkiOwpzdXBwb3J0LnJnYmEgPSBzdXBwb3J0RWxlbS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IuaW5kZXhPZiggInJnYmEiICkgPiAtMTsKCi8vIGRlZmluZSBjYWNoZSBuYW1lIGFuZCBhbHBoYSBwcm9wZXJ0aWVzCi8vIGZvciByZ2JhIGFuZCBoc2xhIHNwYWNlcwplYWNoKCBzcGFjZXMsIGZ1bmN0aW9uKCBzcGFjZU5hbWUsIHNwYWNlICkgewoJc3BhY2UuY2FjaGUgPSAiXyIgKyBzcGFjZU5hbWU7CglzcGFjZS5wcm9wcy5hbHBoYSA9IHsKCQlpZHg6IDMsCgkJdHlwZTogInBlcmNlbnQiLAoJCWRlZjogMQoJfTsKfSk7CgpmdW5jdGlvbiBjbGFtcCggdmFsdWUsIHByb3AsIGFsbG93RW1wdHkgKSB7Cgl2YXIgdHlwZSA9IHByb3BUeXBlc1sgcHJvcC50eXBlIF0gfHwge307CgoJaWYgKCB2YWx1ZSA9PSBudWxsICkgewoJCXJldHVybiAoYWxsb3dFbXB0eSB8fCAhcHJvcC5kZWYpID8gbnVsbCA6IHByb3AuZGVmOwoJfQoKCS8vIH5+IGlzIGFuIHNob3J0IHdheSBvZiBkb2luZyBmbG9vciBmb3IgcG9zaXRpdmUgbnVtYmVycwoJdmFsdWUgPSB0eXBlLmZsb29yID8gfn52YWx1ZSA6IHBhcnNlRmxvYXQoIHZhbHVlICk7CgoJLy8gSUUgd2lsbCBwYXNzIGluIGVtcHR5IHN0cmluZ3MgYXMgdmFsdWUgZm9yIGFscGhhLAoJLy8gd2hpY2ggd2lsbCBoaXQgdGhpcyBjYXNlCglpZiAoIGlzTmFOKCB2YWx1ZSApICkgewoJCXJldHVybiBwcm9wLmRlZjsKCX0KCglpZiAoIHR5cGUubW9kICkgewoJCS8vIHdlIGFkZCBtb2QgYmVmb3JlIG1vZGRpbmcgdG8gbWFrZSBzdXJlIHRoYXQgbmVnYXRpdmVzIHZhbHVlcwoJCS8vIGdldCBjb252ZXJ0ZWQgcHJvcGVybHk6IC0xMCAtPiAzNTAKCQlyZXR1cm4gKHZhbHVlICsgdHlwZS5tb2QpICUgdHlwZS5tb2Q7Cgl9CgoJLy8gZm9yIG5vdyBhbGwgcHJvcGVydHkgdHlwZXMgd2l0aG91dCBtb2QgaGF2ZSBtaW4gYW5kIG1heAoJcmV0dXJuIDAgPiB2YWx1ZSA/IDAgOiB0eXBlLm1heCA8IHZhbHVlID8gdHlwZS5tYXggOiB2YWx1ZTsKfQoKZnVuY3Rpb24gc3RyaW5nUGFyc2UoIHN0cmluZyApIHsKCXZhciBpbnN0ID0gY29sb3IoKSwKCQlyZ2JhID0gaW5zdC5fcmdiYSA9IFtdOwoKCXN0cmluZyA9IHN0cmluZy50b0xvd2VyQ2FzZSgpOwoKCWVhY2goIHN0cmluZ1BhcnNlcnMsIGZ1bmN0aW9uKCBpLCBwYXJzZXIgKSB7CgkJdmFyIHBhcnNlZCwKCQkJbWF0Y2ggPSBwYXJzZXIucmUuZXhlYyggc3RyaW5nICksCgkJCXZhbHVlcyA9IG1hdGNoICYmIHBhcnNlci5wYXJzZSggbWF0Y2ggKSwKCQkJc3BhY2VOYW1lID0gcGFyc2VyLnNwYWNlIHx8ICJyZ2JhIjsKCgkJaWYgKCB2YWx1ZXMgKSB7CgkJCXBhcnNlZCA9IGluc3RbIHNwYWNlTmFtZSBdKCB2YWx1ZXMgKTsKCgkJCS8vIGlmIHRoaXMgd2FzIGFuIHJnYmEgcGFyc2UgdGhlIGFzc2lnbm1lbnQgbWlnaHQgaGFwcGVuIHR3aWNlCgkJCS8vIG9oIHdlbGwuLi4uCgkJCWluc3RbIHNwYWNlc1sgc3BhY2VOYW1lIF0uY2FjaGUgXSA9IHBhcnNlZFsgc3BhY2VzWyBzcGFjZU5hbWUgXS5jYWNoZSBdOwoJCQlyZ2JhID0gaW5zdC5fcmdiYSA9IHBhcnNlZC5fcmdiYTsKCgkJCS8vIGV4aXQgZWFjaCggc3RyaW5nUGFyc2VycyApIGhlcmUgYmVjYXVzZSB3ZSBtYXRjaGVkCgkJCXJldHVybiBmYWxzZTsKCQl9Cgl9KTsKCgkvLyBGb3VuZCBhIHN0cmluZ1BhcnNlciB0aGF0IGhhbmRsZWQgaXQKCWlmICggcmdiYS5sZW5ndGggKSB7CgoJCS8vIGlmIHRoaXMgY2FtZSBmcm9tIGEgcGFyc2VkIHN0cmluZywgZm9yY2UgInRyYW5zcGFyZW50IiB3aGVuIGFscGhhIGlzIDAKCQkvLyBjaHJvbWUsIChhbmQgbWF5YmUgb3RoZXJzKSByZXR1cm4gInRyYW5zcGFyZW50IiBhcyByZ2JhKDAsMCwwLDApCgkJaWYgKCByZ2JhLmpvaW4oKSA9PT0gIjAsMCwwLDAiICkgewoJCQlqUXVlcnkuZXh0ZW5kKCByZ2JhLCBjb2xvcnMudHJhbnNwYXJlbnQgKTsKCQl9CgkJcmV0dXJuIGluc3Q7Cgl9CgoJLy8gbmFtZWQgY29sb3JzCglyZXR1cm4gY29sb3JzWyBzdHJpbmcgXTsKfQoKY29sb3IuZm4gPSBqUXVlcnkuZXh0ZW5kKCBjb2xvci5wcm90b3R5cGUsIHsKCXBhcnNlOiBmdW5jdGlvbiggcmVkLCBncmVlbiwgYmx1ZSwgYWxwaGEgKSB7CgkJaWYgKCByZWQgPT09IHVuZGVmaW5lZCApIHsKCQkJdGhpcy5fcmdiYSA9IFsgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCBdOwoJCQlyZXR1cm4gdGhpczsKCQl9CgkJaWYgKCByZWQuanF1ZXJ5IHx8IHJlZC5ub2RlVHlwZSApIHsKCQkJcmVkID0galF1ZXJ5KCByZWQgKS5jc3MoIGdyZWVuICk7CgkJCWdyZWVuID0gdW5kZWZpbmVkOwoJCX0KCgkJdmFyIGluc3QgPSB0aGlzLAoJCQl0eXBlID0galF1ZXJ5LnR5cGUoIHJlZCApLAoJCQlyZ2JhID0gdGhpcy5fcmdiYSA9IFtdOwoKCQkvLyBtb3JlIHRoYW4gMSBhcmd1bWVudCBzcGVjaWZpZWQgLSBhc3N1bWUgKCByZWQsIGdyZWVuLCBibHVlLCBhbHBoYSApCgkJaWYgKCBncmVlbiAhPT0gdW5kZWZpbmVkICkgewoJCQlyZWQgPSBbIHJlZCwgZ3JlZW4sIGJsdWUsIGFscGhhIF07CgkJCXR5cGUgPSAiYXJyYXkiOwoJCX0KCgkJaWYgKCB0eXBlID09PSAic3RyaW5nIiApIHsKCQkJcmV0dXJuIHRoaXMucGFyc2UoIHN0cmluZ1BhcnNlKCByZWQgKSB8fCBjb2xvcnMuX2RlZmF1bHQgKTsKCQl9CgoJCWlmICggdHlwZSA9PT0gImFycmF5IiApIHsKCQkJZWFjaCggc3BhY2VzLnJnYmEucHJvcHMsIGZ1bmN0aW9uKCBrZXksIHByb3AgKSB7CgkJCQlyZ2JhWyBwcm9wLmlkeCBdID0gY2xhbXAoIHJlZFsgcHJvcC5pZHggXSwgcHJvcCApOwoJCQl9KTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQlpZiAoIHR5cGUgPT09ICJvYmplY3QiICkgewoJCQlpZiAoIHJlZCBpbnN0YW5jZW9mIGNvbG9yICkgewoJCQkJZWFjaCggc3BhY2VzLCBmdW5jdGlvbiggc3BhY2VOYW1lLCBzcGFjZSApIHsKCQkJCQlpZiAoIHJlZFsgc3BhY2UuY2FjaGUgXSApIHsKCQkJCQkJaW5zdFsgc3BhY2UuY2FjaGUgXSA9IHJlZFsgc3BhY2UuY2FjaGUgXS5zbGljZSgpOwoJCQkJCX0KCQkJCX0pOwoJCQl9IGVsc2UgewoJCQkJZWFjaCggc3BhY2VzLCBmdW5jdGlvbiggc3BhY2VOYW1lLCBzcGFjZSApIHsKCQkJCQl2YXIgY2FjaGUgPSBzcGFjZS5jYWNoZTsKCQkJCQllYWNoKCBzcGFjZS5wcm9wcywgZnVuY3Rpb24oIGtleSwgcHJvcCApIHsKCgkJCQkJCS8vIGlmIHRoZSBjYWNoZSBkb2Vzbid0IGV4aXN0LCBhbmQgd2Uga25vdyBob3cgdG8gY29udmVydAoJCQkJCQlpZiAoICFpbnN0WyBjYWNoZSBdICYmIHNwYWNlLnRvICkgewoKCQkJCQkJCS8vIGlmIHRoZSB2YWx1ZSB3YXMgbnVsbCwgd2UgZG9uJ3QgbmVlZCB0byBjb3B5IGl0CgkJCQkJCQkvLyBpZiB0aGUga2V5IHdhcyBhbHBoYSwgd2UgZG9uJ3QgbmVlZCB0byBjb3B5IGl0IGVpdGhlcgoJCQkJCQkJaWYgKCBrZXkgPT09ICJhbHBoYSIgfHwgcmVkWyBrZXkgXSA9PSBudWxsICkgewoJCQkJCQkJCXJldHVybjsKCQkJCQkJCX0KCQkJCQkJCWluc3RbIGNhY2hlIF0gPSBzcGFjZS50byggaW5zdC5fcmdiYSApOwoJCQkJCQl9CgoJCQkJCQkvLyB0aGlzIGlzIHRoZSBvbmx5IGNhc2Ugd2hlcmUgd2UgYWxsb3cgbnVsbHMgZm9yIEFMTCBwcm9wZXJ0aWVzLgoJCQkJCQkvLyBjYWxsIGNsYW1wIHdpdGggYWx3YXlzQWxsb3dFbXB0eQoJCQkJCQlpbnN0WyBjYWNoZSBdWyBwcm9wLmlkeCBdID0gY2xhbXAoIHJlZFsga2V5IF0sIHByb3AsIHRydWUgKTsKCQkJCQl9KTsKCgkJCQkJLy8gZXZlcnl0aGluZyBkZWZpbmVkIGJ1dCBhbHBoYT8KCQkJCQlpZiAoIGluc3RbIGNhY2hlIF0gJiYgalF1ZXJ5LmluQXJyYXkoIG51bGwsIGluc3RbIGNhY2hlIF0uc2xpY2UoIDAsIDMgKSApIDwgMCApIHsKCQkJCQkJLy8gdXNlIHRoZSBkZWZhdWx0IG9mIDEKCQkJCQkJaW5zdFsgY2FjaGUgXVsgMyBdID0gMTsKCQkJCQkJaWYgKCBzcGFjZS5mcm9tICkgewoJCQkJCQkJaW5zdC5fcmdiYSA9IHNwYWNlLmZyb20oIGluc3RbIGNhY2hlIF0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0pOwoJCQl9CgkJCXJldHVybiB0aGlzOwoJCX0KCX0sCglpczogZnVuY3Rpb24oIGNvbXBhcmUgKSB7CgkJdmFyIGlzID0gY29sb3IoIGNvbXBhcmUgKSwKCQkJc2FtZSA9IHRydWUsCgkJCWluc3QgPSB0aGlzOwoKCQllYWNoKCBzcGFjZXMsIGZ1bmN0aW9uKCBfLCBzcGFjZSApIHsKCQkJdmFyIGxvY2FsQ2FjaGUsCgkJCQlpc0NhY2hlID0gaXNbIHNwYWNlLmNhY2hlIF07CgkJCWlmIChpc0NhY2hlKSB7CgkJCQlsb2NhbENhY2hlID0gaW5zdFsgc3BhY2UuY2FjaGUgXSB8fCBzcGFjZS50byAmJiBzcGFjZS50byggaW5zdC5fcmdiYSApIHx8IFtdOwoJCQkJZWFjaCggc3BhY2UucHJvcHMsIGZ1bmN0aW9uKCBfLCBwcm9wICkgewoJCQkJCWlmICggaXNDYWNoZVsgcHJvcC5pZHggXSAhPSBudWxsICkgewoJCQkJCQlzYW1lID0gKCBpc0NhY2hlWyBwcm9wLmlkeCBdID09PSBsb2NhbENhY2hlWyBwcm9wLmlkeCBdICk7CgkJCQkJCXJldHVybiBzYW1lOwoJCQkJCX0KCQkJCX0pOwoJCQl9CgkJCXJldHVybiBzYW1lOwoJCX0pOwoJCXJldHVybiBzYW1lOwoJfSwKCV9zcGFjZTogZnVuY3Rpb24oKSB7CgkJdmFyIHVzZWQgPSBbXSwKCQkJaW5zdCA9IHRoaXM7CgkJZWFjaCggc3BhY2VzLCBmdW5jdGlvbiggc3BhY2VOYW1lLCBzcGFjZSApIHsKCQkJaWYgKCBpbnN0WyBzcGFjZS5jYWNoZSBdICkgewoJCQkJdXNlZC5wdXNoKCBzcGFjZU5hbWUgKTsKCQkJfQoJCX0pOwoJCXJldHVybiB1c2VkLnBvcCgpOwoJfSwKCXRyYW5zaXRpb246IGZ1bmN0aW9uKCBvdGhlciwgZGlzdGFuY2UgKSB7CgkJdmFyIGVuZCA9IGNvbG9yKCBvdGhlciApLAoJCQlzcGFjZU5hbWUgPSBlbmQuX3NwYWNlKCksCgkJCXNwYWNlID0gc3BhY2VzWyBzcGFjZU5hbWUgXSwKCQkJc3RhcnRDb2xvciA9IHRoaXMuYWxwaGEoKSA9PT0gMCA/IGNvbG9yKCAidHJhbnNwYXJlbnQiICkgOiB0aGlzLAoJCQlzdGFydCA9IHN0YXJ0Q29sb3JbIHNwYWNlLmNhY2hlIF0gfHwgc3BhY2UudG8oIHN0YXJ0Q29sb3IuX3JnYmEgKSwKCQkJcmVzdWx0ID0gc3RhcnQuc2xpY2UoKTsKCgkJZW5kID0gZW5kWyBzcGFjZS5jYWNoZSBdOwoJCWVhY2goIHNwYWNlLnByb3BzLCBmdW5jdGlvbigga2V5LCBwcm9wICkgewoJCQl2YXIgaW5kZXggPSBwcm9wLmlkeCwKCQkJCXN0YXJ0VmFsdWUgPSBzdGFydFsgaW5kZXggXSwKCQkJCWVuZFZhbHVlID0gZW5kWyBpbmRleCBdLAoJCQkJdHlwZSA9IHByb3BUeXBlc1sgcHJvcC50eXBlIF0gfHwge307CgoJCQkvLyBpZiBudWxsLCBkb24ndCBvdmVycmlkZSBzdGFydCB2YWx1ZQoJCQlpZiAoIGVuZFZhbHVlID09PSBudWxsICkgewoJCQkJcmV0dXJuOwoJCQl9CgkJCS8vIGlmIG51bGwgLSB1c2UgZW5kCgkJCWlmICggc3RhcnRWYWx1ZSA9PT0gbnVsbCApIHsKCQkJCXJlc3VsdFsgaW5kZXggXSA9IGVuZFZhbHVlOwoJCQl9IGVsc2UgewoJCQkJaWYgKCB0eXBlLm1vZCApIHsKCQkJCQlpZiAoIGVuZFZhbHVlIC0gc3RhcnRWYWx1ZSA+IHR5cGUubW9kIC8gMiApIHsKCQkJCQkJc3RhcnRWYWx1ZSArPSB0eXBlLm1vZDsKCQkJCQl9IGVsc2UgaWYgKCBzdGFydFZhbHVlIC0gZW5kVmFsdWUgPiB0eXBlLm1vZCAvIDIgKSB7CgkJCQkJCXN0YXJ0VmFsdWUgLT0gdHlwZS5tb2Q7CgkJCQkJfQoJCQkJfQoJCQkJcmVzdWx0WyBpbmRleCBdID0gY2xhbXAoICggZW5kVmFsdWUgLSBzdGFydFZhbHVlICkgKiBkaXN0YW5jZSArIHN0YXJ0VmFsdWUsIHByb3AgKTsKCQkJfQoJCX0pOwoJCXJldHVybiB0aGlzWyBzcGFjZU5hbWUgXSggcmVzdWx0ICk7Cgl9LAoJYmxlbmQ6IGZ1bmN0aW9uKCBvcGFxdWUgKSB7CgkJLy8gaWYgd2UgYXJlIGFscmVhZHkgb3BhcXVlIC0gcmV0dXJuIG91cnNlbGYKCQlpZiAoIHRoaXMuX3JnYmFbIDMgXSA9PT0gMSApIHsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQl2YXIgcmdiID0gdGhpcy5fcmdiYS5zbGljZSgpLAoJCQlhID0gcmdiLnBvcCgpLAoJCQlibGVuZCA9IGNvbG9yKCBvcGFxdWUgKS5fcmdiYTsKCgkJcmV0dXJuIGNvbG9yKCBqUXVlcnkubWFwKCByZ2IsIGZ1bmN0aW9uKCB2LCBpICkgewoJCQlyZXR1cm4gKCAxIC0gYSApICogYmxlbmRbIGkgXSArIGEgKiB2OwoJCX0pKTsKCX0sCgl0b1JnYmFTdHJpbmc6IGZ1bmN0aW9uKCkgewoJCXZhciBwcmVmaXggPSAicmdiYSgiLAoJCQlyZ2JhID0galF1ZXJ5Lm1hcCggdGhpcy5fcmdiYSwgZnVuY3Rpb24oIHYsIGkgKSB7CgkJCQlyZXR1cm4gdiA9PSBudWxsID8gKCBpID4gMiA/IDEgOiAwICkgOiB2OwoJCQl9KTsKCgkJaWYgKCByZ2JhWyAzIF0gPT09IDEgKSB7CgkJCXJnYmEucG9wKCk7CgkJCXByZWZpeCA9ICJyZ2IoIjsKCQl9CgoJCXJldHVybiBwcmVmaXggKyByZ2JhLmpvaW4oKSArICIpIjsKCX0sCgl0b0hzbGFTdHJpbmc6IGZ1bmN0aW9uKCkgewoJCXZhciBwcmVmaXggPSAiaHNsYSgiLAoJCQloc2xhID0galF1ZXJ5Lm1hcCggdGhpcy5oc2xhKCksIGZ1bmN0aW9uKCB2LCBpICkgewoJCQkJaWYgKCB2ID09IG51bGwgKSB7CgkJCQkJdiA9IGkgPiAyID8gMSA6IDA7CgkJCQl9CgoJCQkJLy8gY2F0Y2ggMSBhbmQgMgoJCQkJaWYgKCBpICYmIGkgPCAzICkgewoJCQkJCXYgPSBNYXRoLnJvdW5kKCB2ICogMTAwICkgKyAiJSI7CgkJCQl9CgkJCQlyZXR1cm4gdjsKCQkJfSk7CgoJCWlmICggaHNsYVsgMyBdID09PSAxICkgewoJCQloc2xhLnBvcCgpOwoJCQlwcmVmaXggPSAiaHNsKCI7CgkJfQoJCXJldHVybiBwcmVmaXggKyBoc2xhLmpvaW4oKSArICIpIjsKCX0sCgl0b0hleFN0cmluZzogZnVuY3Rpb24oIGluY2x1ZGVBbHBoYSApIHsKCQl2YXIgcmdiYSA9IHRoaXMuX3JnYmEuc2xpY2UoKSwKCQkJYWxwaGEgPSByZ2JhLnBvcCgpOwoKCQlpZiAoIGluY2x1ZGVBbHBoYSApIHsKCQkJcmdiYS5wdXNoKCB+figgYWxwaGEgKiAyNTUgKSApOwoJCX0KCgkJcmV0dXJuICIjIiArIGpRdWVyeS5tYXAoIHJnYmEsIGZ1bmN0aW9uKCB2ICkgewoKCQkJLy8gZGVmYXVsdCB0byAwIHdoZW4gbnVsbHMgZXhpc3QKCQkJdiA9ICggdiB8fCAwICkudG9TdHJpbmcoIDE2ICk7CgkJCXJldHVybiB2Lmxlbmd0aCA9PT0gMSA/ICIwIiArIHYgOiB2OwoJCX0pLmpvaW4oIiIpOwoJfSwKCXRvU3RyaW5nOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5fcmdiYVsgMyBdID09PSAwID8gInRyYW5zcGFyZW50IiA6IHRoaXMudG9SZ2JhU3RyaW5nKCk7Cgl9Cn0pOwpjb2xvci5mbi5wYXJzZS5wcm90b3R5cGUgPSBjb2xvci5mbjsKCi8vIGhzbGEgY29udmVyc2lvbnMgYWRhcHRlZCBmcm9tOgovLyBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL21hYXNoYWFjay9zb3VyY2UvYnJvd3NlL3BhY2thZ2VzL2dyYXBoaWNzL3RydW5rL3NyYy9ncmFwaGljcy9jb2xvcnMvSFVFMlJHQi5hcz9yPTUwMjEKCmZ1bmN0aW9uIGh1ZTJyZ2IoIHAsIHEsIGggKSB7CgloID0gKCBoICsgMSApICUgMTsKCWlmICggaCAqIDYgPCAxICkgewoJCXJldHVybiBwICsgKHEgLSBwKSAqIGggKiA2OwoJfQoJaWYgKCBoICogMiA8IDEpIHsKCQlyZXR1cm4gcTsKCX0KCWlmICggaCAqIDMgPCAyICkgewoJCXJldHVybiBwICsgKHEgLSBwKSAqICgoMi8zKSAtIGgpICogNjsKCX0KCXJldHVybiBwOwp9CgpzcGFjZXMuaHNsYS50byA9IGZ1bmN0aW9uICggcmdiYSApIHsKCWlmICggcmdiYVsgMCBdID09IG51bGwgfHwgcmdiYVsgMSBdID09IG51bGwgfHwgcmdiYVsgMiBdID09IG51bGwgKSB7CgkJcmV0dXJuIFsgbnVsbCwgbnVsbCwgbnVsbCwgcmdiYVsgMyBdIF07Cgl9Cgl2YXIgciA9IHJnYmFbIDAgXSAvIDI1NSwKCQlnID0gcmdiYVsgMSBdIC8gMjU1LAoJCWIgPSByZ2JhWyAyIF0gLyAyNTUsCgkJYSA9IHJnYmFbIDMgXSwKCQltYXggPSBNYXRoLm1heCggciwgZywgYiApLAoJCW1pbiA9IE1hdGgubWluKCByLCBnLCBiICksCgkJZGlmZiA9IG1heCAtIG1pbiwKCQlhZGQgPSBtYXggKyBtaW4sCgkJbCA9IGFkZCAqIDAuNSwKCQloLCBzOwoKCWlmICggbWluID09PSBtYXggKSB7CgkJaCA9IDA7Cgl9IGVsc2UgaWYgKCByID09PSBtYXggKSB7CgkJaCA9ICggNjAgKiAoIGcgLSBiICkgLyBkaWZmICkgKyAzNjA7Cgl9IGVsc2UgaWYgKCBnID09PSBtYXggKSB7CgkJaCA9ICggNjAgKiAoIGIgLSByICkgLyBkaWZmICkgKyAxMjA7Cgl9IGVsc2UgewoJCWggPSAoIDYwICogKCByIC0gZyApIC8gZGlmZiApICsgMjQwOwoJfQoKCS8vIGNocm9tYSAoZGlmZikgPT0gMCBtZWFucyBncmV5c2NhbGUgd2hpY2gsIGJ5IGRlZmluaXRpb24sIHNhdHVyYXRpb24gPSAwJQoJLy8gb3RoZXJ3aXNlLCBzYXR1cmF0aW9uIGlzIGJhc2VkIG9uIHRoZSByYXRpbyBvZiBjaHJvbWEgKGRpZmYpIHRvIGxpZ2h0bmVzcyAoYWRkKQoJaWYgKCBkaWZmID09PSAwICkgewoJCXMgPSAwOwoJfSBlbHNlIGlmICggbCA8PSAwLjUgKSB7CgkJcyA9IGRpZmYgLyBhZGQ7Cgl9IGVsc2UgewoJCXMgPSBkaWZmIC8gKCAyIC0gYWRkICk7Cgl9CglyZXR1cm4gWyBNYXRoLnJvdW5kKGgpICUgMzYwLCBzLCBsLCBhID09IG51bGwgPyAxIDogYSBdOwp9OwoKc3BhY2VzLmhzbGEuZnJvbSA9IGZ1bmN0aW9uICggaHNsYSApIHsKCWlmICggaHNsYVsgMCBdID09IG51bGwgfHwgaHNsYVsgMSBdID09IG51bGwgfHwgaHNsYVsgMiBdID09IG51bGwgKSB7CgkJcmV0dXJuIFsgbnVsbCwgbnVsbCwgbnVsbCwgaHNsYVsgMyBdIF07Cgl9Cgl2YXIgaCA9IGhzbGFbIDAgXSAvIDM2MCwKCQlzID0gaHNsYVsgMSBdLAoJCWwgPSBoc2xhWyAyIF0sCgkJYSA9IGhzbGFbIDMgXSwKCQlxID0gbCA8PSAwLjUgPyBsICogKCAxICsgcyApIDogbCArIHMgLSBsICogcywKCQlwID0gMiAqIGwgLSBxOwoKCXJldHVybiBbCgkJTWF0aC5yb3VuZCggaHVlMnJnYiggcCwgcSwgaCArICggMSAvIDMgKSApICogMjU1ICksCgkJTWF0aC5yb3VuZCggaHVlMnJnYiggcCwgcSwgaCApICogMjU1ICksCgkJTWF0aC5yb3VuZCggaHVlMnJnYiggcCwgcSwgaCAtICggMSAvIDMgKSApICogMjU1ICksCgkJYQoJXTsKfTsKCgplYWNoKCBzcGFjZXMsIGZ1bmN0aW9uKCBzcGFjZU5hbWUsIHNwYWNlICkgewoJdmFyIHByb3BzID0gc3BhY2UucHJvcHMsCgkJY2FjaGUgPSBzcGFjZS5jYWNoZSwKCQl0byA9IHNwYWNlLnRvLAoJCWZyb20gPSBzcGFjZS5mcm9tOwoKCS8vIG1ha2VzIHJnYmEoKSBhbmQgaHNsYSgpCgljb2xvci5mblsgc3BhY2VOYW1lIF0gPSBmdW5jdGlvbiggdmFsdWUgKSB7CgoJCS8vIGdlbmVyYXRlIGEgY2FjaGUgZm9yIHRoaXMgc3BhY2UgaWYgaXQgZG9lc24ndCBleGlzdAoJCWlmICggdG8gJiYgIXRoaXNbIGNhY2hlIF0gKSB7CgkJCXRoaXNbIGNhY2hlIF0gPSB0byggdGhpcy5fcmdiYSApOwoJCX0KCQlpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgKSB7CgkJCXJldHVybiB0aGlzWyBjYWNoZSBdLnNsaWNlKCk7CgkJfQoKCQl2YXIgcmV0LAoJCQl0eXBlID0galF1ZXJ5LnR5cGUoIHZhbHVlICksCgkJCWFyciA9ICggdHlwZSA9PT0gImFycmF5IiB8fCB0eXBlID09PSAib2JqZWN0IiApID8gdmFsdWUgOiBhcmd1bWVudHMsCgkJCWxvY2FsID0gdGhpc1sgY2FjaGUgXS5zbGljZSgpOwoKCQllYWNoKCBwcm9wcywgZnVuY3Rpb24oIGtleSwgcHJvcCApIHsKCQkJdmFyIHZhbCA9IGFyclsgdHlwZSA9PT0gIm9iamVjdCIgPyBrZXkgOiBwcm9wLmlkeCBdOwoJCQlpZiAoIHZhbCA9PSBudWxsICkgewoJCQkJdmFsID0gbG9jYWxbIHByb3AuaWR4IF07CgkJCX0KCQkJbG9jYWxbIHByb3AuaWR4IF0gPSBjbGFtcCggdmFsLCBwcm9wICk7CgkJfSk7CgoJCWlmICggZnJvbSApIHsKCQkJcmV0ID0gY29sb3IoIGZyb20oIGxvY2FsICkgKTsKCQkJcmV0WyBjYWNoZSBdID0gbG9jYWw7CgkJCXJldHVybiByZXQ7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIGNvbG9yKCBsb2NhbCApOwoJCX0KCX07CgoJLy8gbWFrZXMgcmVkKCkgZ3JlZW4oKSBibHVlKCkgYWxwaGEoKSBodWUoKSBzYXR1cmF0aW9uKCkgbGlnaHRuZXNzKCkKCWVhY2goIHByb3BzLCBmdW5jdGlvbigga2V5LCBwcm9wICkgewoJCS8vIGFscGhhIGlzIGluY2x1ZGVkIGluIG1vcmUgdGhhbiBvbmUgc3BhY2UKCQlpZiAoIGNvbG9yLmZuWyBrZXkgXSApIHsKCQkJcmV0dXJuOwoJCX0KCQljb2xvci5mblsga2V5IF0gPSBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXZhciB2dHlwZSA9IGpRdWVyeS50eXBlKCB2YWx1ZSApLAoJCQkJZm4gPSAoIGtleSA9PT0gImFscGhhIiA/ICggdGhpcy5faHNsYSA/ICJoc2xhIiA6ICJyZ2JhIiApIDogc3BhY2VOYW1lICksCgkJCQlsb2NhbCA9IHRoaXNbIGZuIF0oKSwKCQkJCWN1ciA9IGxvY2FsWyBwcm9wLmlkeCBdLAoJCQkJbWF0Y2g7CgoJCQlpZiAoIHZ0eXBlID09PSAidW5kZWZpbmVkIiApIHsKCQkJCXJldHVybiBjdXI7CgkJCX0KCgkJCWlmICggdnR5cGUgPT09ICJmdW5jdGlvbiIgKSB7CgkJCQl2YWx1ZSA9IHZhbHVlLmNhbGwoIHRoaXMsIGN1ciApOwoJCQkJdnR5cGUgPSBqUXVlcnkudHlwZSggdmFsdWUgKTsKCQkJfQoJCQlpZiAoIHZhbHVlID09IG51bGwgJiYgcHJvcC5lbXB0eSApIHsKCQkJCXJldHVybiB0aGlzOwoJCQl9CgkJCWlmICggdnR5cGUgPT09ICJzdHJpbmciICkgewoJCQkJbWF0Y2ggPSBycGx1c2VxdWFscy5leGVjKCB2YWx1ZSApOwoJCQkJaWYgKCBtYXRjaCApIHsKCQkJCQl2YWx1ZSA9IGN1ciArIHBhcnNlRmxvYXQoIG1hdGNoWyAyIF0gKSAqICggbWF0Y2hbIDEgXSA9PT0gIisiID8gMSA6IC0xICk7CgkJCQl9CgkJCX0KCQkJbG9jYWxbIHByb3AuaWR4IF0gPSB2YWx1ZTsKCQkJcmV0dXJuIHRoaXNbIGZuIF0oIGxvY2FsICk7CgkJfTsKCX0pOwp9KTsKCi8vIGFkZCBjc3NIb29rIGFuZCAuZnguc3RlcCBmdW5jdGlvbiBmb3IgZWFjaCBuYW1lZCBob29rLgovLyBhY2NlcHQgYSBzcGFjZSBzZXBhcmF0ZWQgc3RyaW5nIG9mIHByb3BlcnRpZXMKY29sb3IuaG9vayA9IGZ1bmN0aW9uKCBob29rICkgewoJdmFyIGhvb2tzID0gaG9vay5zcGxpdCggIiAiICk7CgllYWNoKCBob29rcywgZnVuY3Rpb24oIGksIGhvb2sgKSB7CgkJalF1ZXJ5LmNzc0hvb2tzWyBob29rIF0gPSB7CgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQkJdmFyIHBhcnNlZCwgY3VyRWxlbSwKCQkJCQliYWNrZ3JvdW5kQ29sb3IgPSAiIjsKCgkJCQlpZiAoIHZhbHVlICE9PSAidHJhbnNwYXJlbnQiICYmICggalF1ZXJ5LnR5cGUoIHZhbHVlICkgIT09ICJzdHJpbmciIHx8ICggcGFyc2VkID0gc3RyaW5nUGFyc2UoIHZhbHVlICkgKSApICkgewoJCQkJCXZhbHVlID0gY29sb3IoIHBhcnNlZCB8fCB2YWx1ZSApOwoJCQkJCWlmICggIXN1cHBvcnQucmdiYSAmJiB2YWx1ZS5fcmdiYVsgMyBdICE9PSAxICkgewoJCQkJCQljdXJFbGVtID0gaG9vayA9PT0gImJhY2tncm91bmRDb2xvciIgPyBlbGVtLnBhcmVudE5vZGUgOiBlbGVtOwoJCQkJCQl3aGlsZSAoCgkJCQkJCQkoYmFja2dyb3VuZENvbG9yID09PSAiIiB8fCBiYWNrZ3JvdW5kQ29sb3IgPT09ICJ0cmFuc3BhcmVudCIpICYmCgkJCQkJCQljdXJFbGVtICYmIGN1ckVsZW0uc3R5bGUKCQkJCQkJKSB7CgkJCQkJCQl0cnkgewoJCQkJCQkJCWJhY2tncm91bmRDb2xvciA9IGpRdWVyeS5jc3MoIGN1ckVsZW0sICJiYWNrZ3JvdW5kQ29sb3IiICk7CgkJCQkJCQkJY3VyRWxlbSA9IGN1ckVsZW0ucGFyZW50Tm9kZTsKCQkJCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCQkJfQoJCQkJCQl9CgoJCQkJCQl2YWx1ZSA9IHZhbHVlLmJsZW5kKCBiYWNrZ3JvdW5kQ29sb3IgJiYgYmFja2dyb3VuZENvbG9yICE9PSAidHJhbnNwYXJlbnQiID8KCQkJCQkJCWJhY2tncm91bmRDb2xvciA6CgkJCQkJCQkiX2RlZmF1bHQiICk7CgkJCQkJfQoKCQkJCQl2YWx1ZSA9IHZhbHVlLnRvUmdiYVN0cmluZygpOwoJCQkJfQoJCQkJdHJ5IHsKCQkJCQllbGVtLnN0eWxlWyBob29rIF0gPSB2YWx1ZTsKCQkJCX0gY2F0Y2goIGUgKSB7CgkJCQkJLy8gd3JhcHBlZCB0byBwcmV2ZW50IElFIGZyb20gdGhyb3dpbmcgZXJyb3JzIG9uICJpbnZhbGlkIiB2YWx1ZXMgbGlrZSAnYXV0bycgb3IgJ2luaGVyaXQnCgkJCQl9CgkJCX0KCQl9OwoJCWpRdWVyeS5meC5zdGVwWyBob29rIF0gPSBmdW5jdGlvbiggZnggKSB7CgkJCWlmICggIWZ4LmNvbG9ySW5pdCApIHsKCQkJCWZ4LnN0YXJ0ID0gY29sb3IoIGZ4LmVsZW0sIGhvb2sgKTsKCQkJCWZ4LmVuZCA9IGNvbG9yKCBmeC5lbmQgKTsKCQkJCWZ4LmNvbG9ySW5pdCA9IHRydWU7CgkJCX0KCQkJalF1ZXJ5LmNzc0hvb2tzWyBob29rIF0uc2V0KCBmeC5lbGVtLCBmeC5zdGFydC50cmFuc2l0aW9uKCBmeC5lbmQsIGZ4LnBvcyApICk7CgkJfTsKCX0pOwoKfTsKCmNvbG9yLmhvb2soIHN0ZXBIb29rcyApOwoKalF1ZXJ5LmNzc0hvb2tzLmJvcmRlckNvbG9yID0gewoJZXhwYW5kOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdmFyIGV4cGFuZGVkID0ge307CgoJCWVhY2goIFsgIlRvcCIsICJSaWdodCIsICJCb3R0b20iLCAiTGVmdCIgXSwgZnVuY3Rpb24oIGksIHBhcnQgKSB7CgkJCWV4cGFuZGVkWyAiYm9yZGVyIiArIHBhcnQgKyAiQ29sb3IiIF0gPSB2YWx1ZTsKCQl9KTsKCQlyZXR1cm4gZXhwYW5kZWQ7Cgl9Cn07CgovLyBCYXNpYyBjb2xvciBuYW1lcyBvbmx5LgovLyBVc2FnZSBvZiBhbnkgb2YgdGhlIG90aGVyIGNvbG9yIG5hbWVzIHJlcXVpcmVzIGFkZGluZyB5b3Vyc2VsZiBvciBpbmNsdWRpbmcKLy8ganF1ZXJ5LmNvbG9yLnN2Zy1uYW1lcy5qcy4KY29sb3JzID0galF1ZXJ5LkNvbG9yLm5hbWVzID0gewoJLy8gNC4xLiBCYXNpYyBjb2xvciBrZXl3b3JkcwoJYXF1YTogIiMwMGZmZmYiLAoJYmxhY2s6ICIjMDAwMDAwIiwKCWJsdWU6ICIjMDAwMGZmIiwKCWZ1Y2hzaWE6ICIjZmYwMGZmIiwKCWdyYXk6ICIjODA4MDgwIiwKCWdyZWVuOiAiIzAwODAwMCIsCglsaW1lOiAiIzAwZmYwMCIsCgltYXJvb246ICIjODAwMDAwIiwKCW5hdnk6ICIjMDAwMDgwIiwKCW9saXZlOiAiIzgwODAwMCIsCglwdXJwbGU6ICIjODAwMDgwIiwKCXJlZDogIiNmZjAwMDAiLAoJc2lsdmVyOiAiI2MwYzBjMCIsCgl0ZWFsOiAiIzAwODA4MCIsCgl3aGl0ZTogIiNmZmZmZmYiLAoJeWVsbG93OiAiI2ZmZmYwMCIsCgoJLy8gNC4yLjMuICJ0cmFuc3BhcmVudCIgY29sb3Iga2V5d29yZAoJdHJhbnNwYXJlbnQ6IFsgbnVsbCwgbnVsbCwgbnVsbCwgMCBdLAoKCV9kZWZhdWx0OiAiI2ZmZmZmZiIKfTsKCn0pKCBqUXVlcnkgKTsKCgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIENMQVNTIEFOSU1BVElPTlMgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwooZnVuY3Rpb24oKSB7Cgp2YXIgY2xhc3NBbmltYXRpb25BY3Rpb25zID0gWyAiYWRkIiwgInJlbW92ZSIsICJ0b2dnbGUiIF0sCglzaG9ydGhhbmRTdHlsZXMgPSB7CgkJYm9yZGVyOiAxLAoJCWJvcmRlckJvdHRvbTogMSwKCQlib3JkZXJDb2xvcjogMSwKCQlib3JkZXJMZWZ0OiAxLAoJCWJvcmRlclJpZ2h0OiAxLAoJCWJvcmRlclRvcDogMSwKCQlib3JkZXJXaWR0aDogMSwKCQltYXJnaW46IDEsCgkJcGFkZGluZzogMQoJfTsKCiQuZWFjaChbICJib3JkZXJMZWZ0U3R5bGUiLCAiYm9yZGVyUmlnaHRTdHlsZSIsICJib3JkZXJCb3R0b21TdHlsZSIsICJib3JkZXJUb3BTdHlsZSIgXSwgZnVuY3Rpb24oIF8sIHByb3AgKSB7CgkkLmZ4LnN0ZXBbIHByb3AgXSA9IGZ1bmN0aW9uKCBmeCApIHsKCQlpZiAoIGZ4LmVuZCAhPT0gIm5vbmUiICYmICFmeC5zZXRBdHRyIHx8IGZ4LnBvcyA9PT0gMSAmJiAhZnguc2V0QXR0ciApIHsKCQkJalF1ZXJ5LnN0eWxlKCBmeC5lbGVtLCBwcm9wLCBmeC5lbmQgKTsKCQkJZnguc2V0QXR0ciA9IHRydWU7CgkJfQoJfTsKfSk7CgpmdW5jdGlvbiBnZXRFbGVtZW50U3R5bGVzKCBlbGVtICkgewoJdmFyIGtleSwgbGVuLAoJCXN0eWxlID0gZWxlbS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3ID8KCQkJZWxlbS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoIGVsZW0sIG51bGwgKSA6CgkJCWVsZW0uY3VycmVudFN0eWxlLAoJCXN0eWxlcyA9IHt9OwoKCWlmICggc3R5bGUgJiYgc3R5bGUubGVuZ3RoICYmIHN0eWxlWyAwIF0gJiYgc3R5bGVbIHN0eWxlWyAwIF0gXSApIHsKCQlsZW4gPSBzdHlsZS5sZW5ndGg7CgkJd2hpbGUgKCBsZW4tLSApIHsKCQkJa2V5ID0gc3R5bGVbIGxlbiBdOwoJCQlpZiAoIHR5cGVvZiBzdHlsZVsga2V5IF0gPT09ICJzdHJpbmciICkgewoJCQkJc3R5bGVzWyAkLmNhbWVsQ2FzZSgga2V5ICkgXSA9IHN0eWxlWyBrZXkgXTsKCQkJfQoJCX0KCS8vIHN1cHBvcnQ6IE9wZXJhLCBJRSA8OQoJfSBlbHNlIHsKCQlmb3IgKCBrZXkgaW4gc3R5bGUgKSB7CgkJCWlmICggdHlwZW9mIHN0eWxlWyBrZXkgXSA9PT0gInN0cmluZyIgKSB7CgkJCQlzdHlsZXNbIGtleSBdID0gc3R5bGVbIGtleSBdOwoJCQl9CgkJfQoJfQoKCXJldHVybiBzdHlsZXM7Cn0KCgpmdW5jdGlvbiBzdHlsZURpZmZlcmVuY2UoIG9sZFN0eWxlLCBuZXdTdHlsZSApIHsKCXZhciBkaWZmID0ge30sCgkJbmFtZSwgdmFsdWU7CgoJZm9yICggbmFtZSBpbiBuZXdTdHlsZSApIHsKCQl2YWx1ZSA9IG5ld1N0eWxlWyBuYW1lIF07CgkJaWYgKCBvbGRTdHlsZVsgbmFtZSBdICE9PSB2YWx1ZSApIHsKCQkJaWYgKCAhc2hvcnRoYW5kU3R5bGVzWyBuYW1lIF0gKSB7CgkJCQlpZiAoICQuZnguc3RlcFsgbmFtZSBdIHx8ICFpc05hTiggcGFyc2VGbG9hdCggdmFsdWUgKSApICkgewoJCQkJCWRpZmZbIG5hbWUgXSA9IHZhbHVlOwoJCQkJfQoJCQl9CgkJfQoJfQoKCXJldHVybiBkaWZmOwp9CgovLyBzdXBwb3J0OiBqUXVlcnkgPDEuOAppZiAoICEkLmZuLmFkZEJhY2sgKSB7CgkkLmZuLmFkZEJhY2sgPSBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMuYWRkKCBzZWxlY3RvciA9PSBudWxsID8KCQkJdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlciggc2VsZWN0b3IgKQoJCSk7Cgl9Owp9CgokLmVmZmVjdHMuYW5pbWF0ZUNsYXNzID0gZnVuY3Rpb24oIHZhbHVlLCBkdXJhdGlvbiwgZWFzaW5nLCBjYWxsYmFjayApIHsKCXZhciBvID0gJC5zcGVlZCggZHVyYXRpb24sIGVhc2luZywgY2FsbGJhY2sgKTsKCglyZXR1cm4gdGhpcy5xdWV1ZSggZnVuY3Rpb24oKSB7CgkJdmFyIGFuaW1hdGVkID0gJCggdGhpcyApLAoJCQliYXNlQ2xhc3MgPSBhbmltYXRlZC5hdHRyKCAiY2xhc3MiICkgfHwgIiIsCgkJCWFwcGx5Q2xhc3NDaGFuZ2UsCgkJCWFsbEFuaW1hdGlvbnMgPSBvLmNoaWxkcmVuID8gYW5pbWF0ZWQuZmluZCggIioiICkuYWRkQmFjaygpIDogYW5pbWF0ZWQ7CgoJCS8vIG1hcCB0aGUgYW5pbWF0ZWQgb2JqZWN0cyB0byBzdG9yZSB0aGUgb3JpZ2luYWwgc3R5bGVzLgoJCWFsbEFuaW1hdGlvbnMgPSBhbGxBbmltYXRpb25zLm1hcChmdW5jdGlvbigpIHsKCQkJdmFyIGVsID0gJCggdGhpcyApOwoJCQlyZXR1cm4gewoJCQkJZWw6IGVsLAoJCQkJc3RhcnQ6IGdldEVsZW1lbnRTdHlsZXMoIHRoaXMgKQoJCQl9OwoJCX0pOwoKCQkvLyBhcHBseSBjbGFzcyBjaGFuZ2UKCQlhcHBseUNsYXNzQ2hhbmdlID0gZnVuY3Rpb24oKSB7CgkJCSQuZWFjaCggY2xhc3NBbmltYXRpb25BY3Rpb25zLCBmdW5jdGlvbihpLCBhY3Rpb24pIHsKCQkJCWlmICggdmFsdWVbIGFjdGlvbiBdICkgewoJCQkJCWFuaW1hdGVkWyBhY3Rpb24gKyAiQ2xhc3MiIF0oIHZhbHVlWyBhY3Rpb24gXSApOwoJCQkJfQoJCQl9KTsKCQl9OwoJCWFwcGx5Q2xhc3NDaGFuZ2UoKTsKCgkJLy8gbWFwIGFsbCBhbmltYXRlZCBvYmplY3RzIGFnYWluIC0gY2FsY3VsYXRlIG5ldyBzdHlsZXMgYW5kIGRpZmYKCQlhbGxBbmltYXRpb25zID0gYWxsQW5pbWF0aW9ucy5tYXAoZnVuY3Rpb24oKSB7CgkJCXRoaXMuZW5kID0gZ2V0RWxlbWVudFN0eWxlcyggdGhpcy5lbFsgMCBdICk7CgkJCXRoaXMuZGlmZiA9IHN0eWxlRGlmZmVyZW5jZSggdGhpcy5zdGFydCwgdGhpcy5lbmQgKTsKCQkJcmV0dXJuIHRoaXM7CgkJfSk7CgoJCS8vIGFwcGx5IG9yaWdpbmFsIGNsYXNzCgkJYW5pbWF0ZWQuYXR0ciggImNsYXNzIiwgYmFzZUNsYXNzICk7CgoJCS8vIG1hcCBhbGwgYW5pbWF0ZWQgb2JqZWN0cyBhZ2FpbiAtIHRoaXMgdGltZSBjb2xsZWN0aW5nIGEgcHJvbWlzZQoJCWFsbEFuaW1hdGlvbnMgPSBhbGxBbmltYXRpb25zLm1hcChmdW5jdGlvbigpIHsKCQkJdmFyIHN0eWxlSW5mbyA9IHRoaXMsCgkJCQlkZmQgPSAkLkRlZmVycmVkKCksCgkJCQlvcHRzID0gJC5leHRlbmQoe30sIG8sIHsKCQkJCQlxdWV1ZTogZmFsc2UsCgkJCQkJY29tcGxldGU6IGZ1bmN0aW9uKCkgewoJCQkJCQlkZmQucmVzb2x2ZSggc3R5bGVJbmZvICk7CgkJCQkJfQoJCQkJfSk7CgoJCQl0aGlzLmVsLmFuaW1hdGUoIHRoaXMuZGlmZiwgb3B0cyApOwoJCQlyZXR1cm4gZGZkLnByb21pc2UoKTsKCQl9KTsKCgkJLy8gb25jZSBhbGwgYW5pbWF0aW9ucyBoYXZlIGNvbXBsZXRlZDoKCQkkLndoZW4uYXBwbHkoICQsIGFsbEFuaW1hdGlvbnMuZ2V0KCkgKS5kb25lKGZ1bmN0aW9uKCkgewoKCQkJLy8gc2V0IHRoZSBmaW5hbCBjbGFzcwoJCQlhcHBseUNsYXNzQ2hhbmdlKCk7CgoJCQkvLyBmb3IgZWFjaCBhbmltYXRlZCBlbGVtZW50LAoJCQkvLyBjbGVhciBhbGwgY3NzIHByb3BlcnRpZXMgdGhhdCB3ZXJlIGFuaW1hdGVkCgkJCSQuZWFjaCggYXJndW1lbnRzLCBmdW5jdGlvbigpIHsKCQkJCXZhciBlbCA9IHRoaXMuZWw7CgkJCQkkLmVhY2goIHRoaXMuZGlmZiwgZnVuY3Rpb24oa2V5KSB7CgkJCQkJZWwuY3NzKCBrZXksICIiICk7CgkJCQl9KTsKCQkJfSk7CgoJCQkvLyB0aGlzIGlzIGd1YXJudGVlZCB0byBiZSB0aGVyZSBpZiB5b3UgdXNlIGpRdWVyeS5zcGVlZCgpCgkJCS8vIGl0IGFsc28gaGFuZGxlcyBkZXF1ZXVpbmcgdGhlIG5leHQgYW5pbS4uLgoJCQlvLmNvbXBsZXRlLmNhbGwoIGFuaW1hdGVkWyAwIF0gKTsKCQl9KTsKCX0pOwp9OwoKJC5mbi5leHRlbmQoewoJYWRkQ2xhc3M6IChmdW5jdGlvbiggb3JpZyApIHsKCQlyZXR1cm4gZnVuY3Rpb24oIGNsYXNzTmFtZXMsIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgewoJCQlyZXR1cm4gc3BlZWQgPwoJCQkJJC5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKCB0aGlzLAoJCQkJCXsgYWRkOiBjbGFzc05hbWVzIH0sIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgOgoJCQkJb3JpZy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJfTsKCX0pKCAkLmZuLmFkZENsYXNzICksCgoJcmVtb3ZlQ2xhc3M6IChmdW5jdGlvbiggb3JpZyApIHsKCQlyZXR1cm4gZnVuY3Rpb24oIGNsYXNzTmFtZXMsIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgewoJCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+IDEgPwoJCQkJJC5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKCB0aGlzLAoJCQkJCXsgcmVtb3ZlOiBjbGFzc05hbWVzIH0sIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgOgoJCQkJb3JpZy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJfTsKCX0pKCAkLmZuLnJlbW92ZUNsYXNzICksCgoJdG9nZ2xlQ2xhc3M6IChmdW5jdGlvbiggb3JpZyApIHsKCQlyZXR1cm4gZnVuY3Rpb24oIGNsYXNzTmFtZXMsIGZvcmNlLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQkJaWYgKCB0eXBlb2YgZm9yY2UgPT09ICJib29sZWFuIiB8fCBmb3JjZSA9PT0gdW5kZWZpbmVkICkgewoJCQkJaWYgKCAhc3BlZWQgKSB7CgkJCQkJLy8gd2l0aG91dCBzcGVlZCBwYXJhbWV0ZXIKCQkJCQlyZXR1cm4gb3JpZy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAkLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwoIHRoaXMsCgkJCQkJCShmb3JjZSA/IHsgYWRkOiBjbGFzc05hbWVzIH0gOiB7IHJlbW92ZTogY2xhc3NOYW1lcyB9KSwKCQkJCQkJc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCS8vIHdpdGhvdXQgZm9yY2UgcGFyYW1ldGVyCgkJCQlyZXR1cm4gJC5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKCB0aGlzLAoJCQkJCXsgdG9nZ2xlOiBjbGFzc05hbWVzIH0sIGZvcmNlLCBzcGVlZCwgZWFzaW5nICk7CgkJCX0KCQl9OwoJfSkoICQuZm4udG9nZ2xlQ2xhc3MgKSwKCglzd2l0Y2hDbGFzczogZnVuY3Rpb24oIHJlbW92ZSwgYWRkLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjaykgewoJCXJldHVybiAkLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwoIHRoaXMsIHsKCQkJYWRkOiBhZGQsCgkJCXJlbW92ZTogcmVtb3ZlCgkJfSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX0KfSk7Cgp9KSgpOwoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIEVGRkVDVFMgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCihmdW5jdGlvbigpIHsKCiQuZXh0ZW5kKCAkLmVmZmVjdHMsIHsKCXZlcnNpb246ICIxLjEwLjQiLAoKCS8vIFNhdmVzIGEgc2V0IG9mIHByb3BlcnRpZXMgaW4gYSBkYXRhIHN0b3JhZ2UKCXNhdmU6IGZ1bmN0aW9uKCBlbGVtZW50LCBzZXQgKSB7CgkJZm9yKCB2YXIgaT0wOyBpIDwgc2V0Lmxlbmd0aDsgaSsrICkgewoJCQlpZiAoIHNldFsgaSBdICE9PSBudWxsICkgewoJCQkJZWxlbWVudC5kYXRhKCBkYXRhU3BhY2UgKyBzZXRbIGkgXSwgZWxlbWVudFsgMCBdLnN0eWxlWyBzZXRbIGkgXSBdICk7CgkJCX0KCQl9Cgl9LAoKCS8vIFJlc3RvcmVzIGEgc2V0IG9mIHByZXZpb3VzbHkgc2F2ZWQgcHJvcGVydGllcyBmcm9tIGEgZGF0YSBzdG9yYWdlCglyZXN0b3JlOiBmdW5jdGlvbiggZWxlbWVudCwgc2V0ICkgewoJCXZhciB2YWwsIGk7CgkJZm9yKCBpPTA7IGkgPCBzZXQubGVuZ3RoOyBpKysgKSB7CgkJCWlmICggc2V0WyBpIF0gIT09IG51bGwgKSB7CgkJCQl2YWwgPSBlbGVtZW50LmRhdGEoIGRhdGFTcGFjZSArIHNldFsgaSBdICk7CgkJCQkvLyBzdXBwb3J0OiBqUXVlcnkgMS42LjIKCQkJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0Lzk5MTcKCQkJCS8vIGpRdWVyeSAxLjYuMiBpbmNvcnJlY3RseSByZXR1cm5zIHVuZGVmaW5lZCBmb3IgYW55IGZhbHN5IHZhbHVlLgoJCQkJLy8gV2UgY2FuJ3QgZGlmZmVyZW50aWF0ZSBiZXR3ZWVuICIiIGFuZCAwIGhlcmUsIHNvIHdlIGp1c3QgYXNzdW1lCgkJCQkvLyBlbXB0eSBzdHJpbmcgc2luY2UgaXQncyBsaWtlbHkgdG8gYmUgYSBtb3JlIGNvbW1vbiB2YWx1ZS4uLgoJCQkJaWYgKCB2YWwgPT09IHVuZGVmaW5lZCApIHsKCQkJCQl2YWwgPSAiIjsKCQkJCX0KCQkJCWVsZW1lbnQuY3NzKCBzZXRbIGkgXSwgdmFsICk7CgkJCX0KCQl9Cgl9LAoKCXNldE1vZGU6IGZ1bmN0aW9uKCBlbCwgbW9kZSApIHsKCQlpZiAobW9kZSA9PT0gInRvZ2dsZSIpIHsKCQkJbW9kZSA9IGVsLmlzKCAiOmhpZGRlbiIgKSA/ICJzaG93IiA6ICJoaWRlIjsKCQl9CgkJcmV0dXJuIG1vZGU7Cgl9LAoKCS8vIFRyYW5zbGF0ZXMgYSBbdG9wLGxlZnRdIGFycmF5IGludG8gYSBiYXNlbGluZSB2YWx1ZQoJLy8gdGhpcyBzaG91bGQgYmUgYSBsaXR0bGUgbW9yZSBmbGV4aWJsZSBpbiB0aGUgZnV0dXJlIHRvIGhhbmRsZSBhIHN0cmluZyAmIGhhc2gKCWdldEJhc2VsaW5lOiBmdW5jdGlvbiggb3JpZ2luLCBvcmlnaW5hbCApIHsKCQl2YXIgeSwgeDsKCQlzd2l0Y2ggKCBvcmlnaW5bIDAgXSApIHsKCQkJY2FzZSAidG9wIjogeSA9IDA7IGJyZWFrOwoJCQljYXNlICJtaWRkbGUiOiB5ID0gMC41OyBicmVhazsKCQkJY2FzZSAiYm90dG9tIjogeSA9IDE7IGJyZWFrOwoJCQlkZWZhdWx0OiB5ID0gb3JpZ2luWyAwIF0gLyBvcmlnaW5hbC5oZWlnaHQ7CgkJfQoJCXN3aXRjaCAoIG9yaWdpblsgMSBdICkgewoJCQljYXNlICJsZWZ0IjogeCA9IDA7IGJyZWFrOwoJCQljYXNlICJjZW50ZXIiOiB4ID0gMC41OyBicmVhazsKCQkJY2FzZSAicmlnaHQiOiB4ID0gMTsgYnJlYWs7CgkJCWRlZmF1bHQ6IHggPSBvcmlnaW5bIDEgXSAvIG9yaWdpbmFsLndpZHRoOwoJCX0KCQlyZXR1cm4gewoJCQl4OiB4LAoJCQl5OiB5CgkJfTsKCX0sCgoJLy8gV3JhcHMgdGhlIGVsZW1lbnQgYXJvdW5kIGEgd3JhcHBlciB0aGF0IGNvcGllcyBwb3NpdGlvbiBwcm9wZXJ0aWVzCgljcmVhdGVXcmFwcGVyOiBmdW5jdGlvbiggZWxlbWVudCApIHsKCgkJLy8gaWYgdGhlIGVsZW1lbnQgaXMgYWxyZWFkeSB3cmFwcGVkLCByZXR1cm4gaXQKCQlpZiAoIGVsZW1lbnQucGFyZW50KCkuaXMoICIudWktZWZmZWN0cy13cmFwcGVyIiApKSB7CgkJCXJldHVybiBlbGVtZW50LnBhcmVudCgpOwoJCX0KCgkJLy8gd3JhcCB0aGUgZWxlbWVudAoJCXZhciBwcm9wcyA9IHsKCQkJCXdpZHRoOiBlbGVtZW50Lm91dGVyV2lkdGgodHJ1ZSksCgkJCQloZWlnaHQ6IGVsZW1lbnQub3V0ZXJIZWlnaHQodHJ1ZSksCgkJCQkiZmxvYXQiOiBlbGVtZW50LmNzcyggImZsb2F0IiApCgkJCX0sCgkJCXdyYXBwZXIgPSAkKCAiPGRpdj48L2Rpdj4iICkKCQkJCS5hZGRDbGFzcyggInVpLWVmZmVjdHMtd3JhcHBlciIgKQoJCQkJLmNzcyh7CgkJCQkJZm9udFNpemU6ICIxMDAlIiwKCQkJCQliYWNrZ3JvdW5kOiAidHJhbnNwYXJlbnQiLAoJCQkJCWJvcmRlcjogIm5vbmUiLAoJCQkJCW1hcmdpbjogMCwKCQkJCQlwYWRkaW5nOiAwCgkJCQl9KSwKCQkJLy8gU3RvcmUgdGhlIHNpemUgaW4gY2FzZSB3aWR0aC9oZWlnaHQgYXJlIGRlZmluZWQgaW4gJSAtIEZpeGVzICM1MjQ1CgkJCXNpemUgPSB7CgkJCQl3aWR0aDogZWxlbWVudC53aWR0aCgpLAoJCQkJaGVpZ2h0OiBlbGVtZW50LmhlaWdodCgpCgkJCX0sCgkJCWFjdGl2ZSA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7CgoJCS8vIHN1cHBvcnQ6IEZpcmVmb3gKCQkvLyBGaXJlZm94IGluY29ycmVjdGx5IGV4cG9zZXMgYW5vbnltb3VzIGNvbnRlbnQKCQkvLyBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD01NjE2NjQKCQl0cnkgewoJCQlhY3RpdmUuaWQ7CgkJfSBjYXRjaCggZSApIHsKCQkJYWN0aXZlID0gZG9jdW1lbnQuYm9keTsKCQl9CgoJCWVsZW1lbnQud3JhcCggd3JhcHBlciApOwoKCQkvLyBGaXhlcyAjNzU5NSAtIEVsZW1lbnRzIGxvc2UgZm9jdXMgd2hlbiB3cmFwcGVkLgoJCWlmICggZWxlbWVudFsgMCBdID09PSBhY3RpdmUgfHwgJC5jb250YWlucyggZWxlbWVudFsgMCBdLCBhY3RpdmUgKSApIHsKCQkJJCggYWN0aXZlICkuZm9jdXMoKTsKCQl9CgoJCXdyYXBwZXIgPSBlbGVtZW50LnBhcmVudCgpOyAvL0hvdGZpeCBmb3IgalF1ZXJ5IDEuNCBzaW5jZSBzb21lIGNoYW5nZSBpbiB3cmFwKCkgc2VlbXMgdG8gYWN0dWFsbHkgbG9zZSB0aGUgcmVmZXJlbmNlIHRvIHRoZSB3cmFwcGVkIGVsZW1lbnQKCgkJLy8gdHJhbnNmZXIgcG9zaXRpb25pbmcgcHJvcGVydGllcyB0byB0aGUgd3JhcHBlcgoJCWlmICggZWxlbWVudC5jc3MoICJwb3NpdGlvbiIgKSA9PT0gInN0YXRpYyIgKSB7CgkJCXdyYXBwZXIuY3NzKHsgcG9zaXRpb246ICJyZWxhdGl2ZSIgfSk7CgkJCWVsZW1lbnQuY3NzKHsgcG9zaXRpb246ICJyZWxhdGl2ZSIgfSk7CgkJfSBlbHNlIHsKCQkJJC5leHRlbmQoIHByb3BzLCB7CgkJCQlwb3NpdGlvbjogZWxlbWVudC5jc3MoICJwb3NpdGlvbiIgKSwKCQkJCXpJbmRleDogZWxlbWVudC5jc3MoICJ6LWluZGV4IiApCgkJCX0pOwoJCQkkLmVhY2goWyAidG9wIiwgImxlZnQiLCAiYm90dG9tIiwgInJpZ2h0IiBdLCBmdW5jdGlvbihpLCBwb3MpIHsKCQkJCXByb3BzWyBwb3MgXSA9IGVsZW1lbnQuY3NzKCBwb3MgKTsKCQkJCWlmICggaXNOYU4oIHBhcnNlSW50KCBwcm9wc1sgcG9zIF0sIDEwICkgKSApIHsKCQkJCQlwcm9wc1sgcG9zIF0gPSAiYXV0byI7CgkJCQl9CgkJCX0pOwoJCQllbGVtZW50LmNzcyh7CgkJCQlwb3NpdGlvbjogInJlbGF0aXZlIiwKCQkJCXRvcDogMCwKCQkJCWxlZnQ6IDAsCgkJCQlyaWdodDogImF1dG8iLAoJCQkJYm90dG9tOiAiYXV0byIKCQkJfSk7CgkJfQoJCWVsZW1lbnQuY3NzKHNpemUpOwoKCQlyZXR1cm4gd3JhcHBlci5jc3MoIHByb3BzICkuc2hvdygpOwoJfSwKCglyZW1vdmVXcmFwcGVyOiBmdW5jdGlvbiggZWxlbWVudCApIHsKCQl2YXIgYWN0aXZlID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKCgkJaWYgKCBlbGVtZW50LnBhcmVudCgpLmlzKCAiLnVpLWVmZmVjdHMtd3JhcHBlciIgKSApIHsKCQkJZWxlbWVudC5wYXJlbnQoKS5yZXBsYWNlV2l0aCggZWxlbWVudCApOwoKCQkJLy8gRml4ZXMgIzc1OTUgLSBFbGVtZW50cyBsb3NlIGZvY3VzIHdoZW4gd3JhcHBlZC4KCQkJaWYgKCBlbGVtZW50WyAwIF0gPT09IGFjdGl2ZSB8fCAkLmNvbnRhaW5zKCBlbGVtZW50WyAwIF0sIGFjdGl2ZSApICkgewoJCQkJJCggYWN0aXZlICkuZm9jdXMoKTsKCQkJfQoJCX0KCgoJCXJldHVybiBlbGVtZW50OwoJfSwKCglzZXRUcmFuc2l0aW9uOiBmdW5jdGlvbiggZWxlbWVudCwgbGlzdCwgZmFjdG9yLCB2YWx1ZSApIHsKCQl2YWx1ZSA9IHZhbHVlIHx8IHt9OwoJCSQuZWFjaCggbGlzdCwgZnVuY3Rpb24oIGksIHggKSB7CgkJCXZhciB1bml0ID0gZWxlbWVudC5jc3NVbml0KCB4ICk7CgkJCWlmICggdW5pdFsgMCBdID4gMCApIHsKCQkJCXZhbHVlWyB4IF0gPSB1bml0WyAwIF0gKiBmYWN0b3IgKyB1bml0WyAxIF07CgkJCX0KCQl9KTsKCQlyZXR1cm4gdmFsdWU7Cgl9Cn0pOwoKLy8gcmV0dXJuIGFuIGVmZmVjdCBvcHRpb25zIG9iamVjdCBmb3IgdGhlIGdpdmVuIHBhcmFtZXRlcnM6CmZ1bmN0aW9uIF9ub3JtYWxpemVBcmd1bWVudHMoIGVmZmVjdCwgb3B0aW9ucywgc3BlZWQsIGNhbGxiYWNrICkgewoKCS8vIGFsbG93IHBhc3NpbmcgYWxsIG9wdGlvbnMgYXMgdGhlIGZpcnN0IHBhcmFtZXRlcgoJaWYgKCAkLmlzUGxhaW5PYmplY3QoIGVmZmVjdCApICkgewoJCW9wdGlvbnMgPSBlZmZlY3Q7CgkJZWZmZWN0ID0gZWZmZWN0LmVmZmVjdDsKCX0KCgkvLyBjb252ZXJ0IHRvIGFuIG9iamVjdAoJZWZmZWN0ID0geyBlZmZlY3Q6IGVmZmVjdCB9OwoKCS8vIGNhdGNoIChlZmZlY3QsIG51bGwsIC4uLikKCWlmICggb3B0aW9ucyA9PSBudWxsICkgewoJCW9wdGlvbnMgPSB7fTsKCX0KCgkvLyBjYXRjaCAoZWZmZWN0LCBjYWxsYmFjaykKCWlmICggJC5pc0Z1bmN0aW9uKCBvcHRpb25zICkgKSB7CgkJY2FsbGJhY2sgPSBvcHRpb25zOwoJCXNwZWVkID0gbnVsbDsKCQlvcHRpb25zID0ge307Cgl9CgoJLy8gY2F0Y2ggKGVmZmVjdCwgc3BlZWQsID8pCglpZiAoIHR5cGVvZiBvcHRpb25zID09PSAibnVtYmVyIiB8fCAkLmZ4LnNwZWVkc1sgb3B0aW9ucyBdICkgewoJCWNhbGxiYWNrID0gc3BlZWQ7CgkJc3BlZWQgPSBvcHRpb25zOwoJCW9wdGlvbnMgPSB7fTsKCX0KCgkvLyBjYXRjaCAoZWZmZWN0LCBvcHRpb25zLCBjYWxsYmFjaykKCWlmICggJC5pc0Z1bmN0aW9uKCBzcGVlZCApICkgewoJCWNhbGxiYWNrID0gc3BlZWQ7CgkJc3BlZWQgPSBudWxsOwoJfQoKCS8vIGFkZCBvcHRpb25zIHRvIGVmZmVjdAoJaWYgKCBvcHRpb25zICkgewoJCSQuZXh0ZW5kKCBlZmZlY3QsIG9wdGlvbnMgKTsKCX0KCglzcGVlZCA9IHNwZWVkIHx8IG9wdGlvbnMuZHVyYXRpb247CgllZmZlY3QuZHVyYXRpb24gPSAkLmZ4Lm9mZiA/IDAgOgoJCXR5cGVvZiBzcGVlZCA9PT0gIm51bWJlciIgPyBzcGVlZCA6CgkJc3BlZWQgaW4gJC5meC5zcGVlZHMgPyAkLmZ4LnNwZWVkc1sgc3BlZWQgXSA6CgkJJC5meC5zcGVlZHMuX2RlZmF1bHQ7CgoJZWZmZWN0LmNvbXBsZXRlID0gY2FsbGJhY2sgfHwgb3B0aW9ucy5jb21wbGV0ZTsKCglyZXR1cm4gZWZmZWN0Owp9CgpmdW5jdGlvbiBzdGFuZGFyZEFuaW1hdGlvbk9wdGlvbiggb3B0aW9uICkgewoJLy8gVmFsaWQgc3RhbmRhcmQgc3BlZWRzIChub3RoaW5nLCBudW1iZXIsIG5hbWVkIHNwZWVkKQoJaWYgKCAhb3B0aW9uIHx8IHR5cGVvZiBvcHRpb24gPT09ICJudW1iZXIiIHx8ICQuZnguc3BlZWRzWyBvcHRpb24gXSApIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvLyBJbnZhbGlkIHN0cmluZ3MgLSB0cmVhdCBhcyAibm9ybWFsIiBzcGVlZAoJaWYgKCB0eXBlb2Ygb3B0aW9uID09PSAic3RyaW5nIiAmJiAhJC5lZmZlY3RzLmVmZmVjdFsgb3B0aW9uIF0gKSB7CgkJcmV0dXJuIHRydWU7Cgl9CgoJLy8gQ29tcGxldGUgY2FsbGJhY2sKCWlmICggJC5pc0Z1bmN0aW9uKCBvcHRpb24gKSApIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvLyBPcHRpb25zIGhhc2ggKGJ1dCBub3QgbmFtaW5nIGFuIGVmZmVjdCkKCWlmICggdHlwZW9mIG9wdGlvbiA9PT0gIm9iamVjdCIgJiYgIW9wdGlvbi5lZmZlY3QgKSB7CgkJcmV0dXJuIHRydWU7Cgl9CgoJLy8gRGlkbid0IG1hdGNoIGFueSBzdGFuZGFyZCBBUEkKCXJldHVybiBmYWxzZTsKfQoKJC5mbi5leHRlbmQoewoJZWZmZWN0OiBmdW5jdGlvbiggLyogZWZmZWN0LCBvcHRpb25zLCBzcGVlZCwgY2FsbGJhY2sgKi8gKSB7CgkJdmFyIGFyZ3MgPSBfbm9ybWFsaXplQXJndW1lbnRzLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKSwKCQkJbW9kZSA9IGFyZ3MubW9kZSwKCQkJcXVldWUgPSBhcmdzLnF1ZXVlLAoJCQllZmZlY3RNZXRob2QgPSAkLmVmZmVjdHMuZWZmZWN0WyBhcmdzLmVmZmVjdCBdOwoKCQlpZiAoICQuZngub2ZmIHx8ICFlZmZlY3RNZXRob2QgKSB7CgkJCS8vIGRlbGVnYXRlIHRvIHRoZSBvcmlnaW5hbCBtZXRob2QgKGUuZy4sIC5zaG93KCkpIGlmIHBvc3NpYmxlCgkJCWlmICggbW9kZSApIHsKCQkJCXJldHVybiB0aGlzWyBtb2RlIF0oIGFyZ3MuZHVyYXRpb24sIGFyZ3MuY29tcGxldGUgKTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCkgewoJCQkJCWlmICggYXJncy5jb21wbGV0ZSApIHsKCQkJCQkJYXJncy5jb21wbGV0ZS5jYWxsKCB0aGlzICk7CgkJCQkJfQoJCQkJfSk7CgkJCX0KCQl9CgoJCWZ1bmN0aW9uIHJ1biggbmV4dCApIHsKCQkJdmFyIGVsZW0gPSAkKCB0aGlzICksCgkJCQljb21wbGV0ZSA9IGFyZ3MuY29tcGxldGUsCgkJCQltb2RlID0gYXJncy5tb2RlOwoKCQkJZnVuY3Rpb24gZG9uZSgpIHsKCQkJCWlmICggJC5pc0Z1bmN0aW9uKCBjb21wbGV0ZSApICkgewoJCQkJCWNvbXBsZXRlLmNhbGwoIGVsZW1bMF0gKTsKCQkJCX0KCQkJCWlmICggJC5pc0Z1bmN0aW9uKCBuZXh0ICkgKSB7CgkJCQkJbmV4dCgpOwoJCQkJfQoJCQl9CgoJCQkvLyBJZiB0aGUgZWxlbWVudCBhbHJlYWR5IGhhcyB0aGUgY29ycmVjdCBmaW5hbCBzdGF0ZSwgZGVsZWdhdGUgdG8KCQkJLy8gdGhlIGNvcmUgbWV0aG9kcyBzbyB0aGUgaW50ZXJuYWwgdHJhY2tpbmcgb2YgIm9sZGRpc3BsYXkiIHdvcmtzLgoJCQlpZiAoIGVsZW0uaXMoICI6aGlkZGVuIiApID8gbW9kZSA9PT0gImhpZGUiIDogbW9kZSA9PT0gInNob3ciICkgewoJCQkJZWxlbVsgbW9kZSBdKCk7CgkJCQlkb25lKCk7CgkJCX0gZWxzZSB7CgkJCQllZmZlY3RNZXRob2QuY2FsbCggZWxlbVswXSwgYXJncywgZG9uZSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gcXVldWUgPT09IGZhbHNlID8gdGhpcy5lYWNoKCBydW4gKSA6IHRoaXMucXVldWUoIHF1ZXVlIHx8ICJmeCIsIHJ1biApOwoJfSwKCglzaG93OiAoZnVuY3Rpb24oIG9yaWcgKSB7CgkJcmV0dXJuIGZ1bmN0aW9uKCBvcHRpb24gKSB7CgkJCWlmICggc3RhbmRhcmRBbmltYXRpb25PcHRpb24oIG9wdGlvbiApICkgewoJCQkJcmV0dXJuIG9yaWcuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQl9IGVsc2UgewoJCQkJdmFyIGFyZ3MgPSBfbm9ybWFsaXplQXJndW1lbnRzLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJCWFyZ3MubW9kZSA9ICJzaG93IjsKCQkJCXJldHVybiB0aGlzLmVmZmVjdC5jYWxsKCB0aGlzLCBhcmdzICk7CgkJCX0KCQl9OwoJfSkoICQuZm4uc2hvdyApLAoKCWhpZGU6IChmdW5jdGlvbiggb3JpZyApIHsKCQlyZXR1cm4gZnVuY3Rpb24oIG9wdGlvbiApIHsKCQkJaWYgKCBzdGFuZGFyZEFuaW1hdGlvbk9wdGlvbiggb3B0aW9uICkgKSB7CgkJCQlyZXR1cm4gb3JpZy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCX0gZWxzZSB7CgkJCQl2YXIgYXJncyA9IF9ub3JtYWxpemVBcmd1bWVudHMuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQkJYXJncy5tb2RlID0gImhpZGUiOwoJCQkJcmV0dXJuIHRoaXMuZWZmZWN0LmNhbGwoIHRoaXMsIGFyZ3MgKTsKCQkJfQoJCX07Cgl9KSggJC5mbi5oaWRlICksCgoJdG9nZ2xlOiAoZnVuY3Rpb24oIG9yaWcgKSB7CgkJcmV0dXJuIGZ1bmN0aW9uKCBvcHRpb24gKSB7CgkJCWlmICggc3RhbmRhcmRBbmltYXRpb25PcHRpb24oIG9wdGlvbiApIHx8IHR5cGVvZiBvcHRpb24gPT09ICJib29sZWFuIiApIHsKCQkJCXJldHVybiBvcmlnLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJfSBlbHNlIHsKCQkJCXZhciBhcmdzID0gX25vcm1hbGl6ZUFyZ3VtZW50cy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQlhcmdzLm1vZGUgPSAidG9nZ2xlIjsKCQkJCXJldHVybiB0aGlzLmVmZmVjdC5jYWxsKCB0aGlzLCBhcmdzICk7CgkJCX0KCQl9OwoJfSkoICQuZm4udG9nZ2xlICksCgoJLy8gaGVscGVyIGZ1bmN0aW9ucwoJY3NzVW5pdDogZnVuY3Rpb24oa2V5KSB7CgkJdmFyIHN0eWxlID0gdGhpcy5jc3MoIGtleSApLAoJCQl2YWwgPSBbXTsKCgkJJC5lYWNoKCBbICJlbSIsICJweCIsICIlIiwgInB0IiBdLCBmdW5jdGlvbiggaSwgdW5pdCApIHsKCQkJaWYgKCBzdHlsZS5pbmRleE9mKCB1bml0ICkgPiAwICkgewoJCQkJdmFsID0gWyBwYXJzZUZsb2F0KCBzdHlsZSApLCB1bml0IF07CgkJCX0KCQl9KTsKCQlyZXR1cm4gdmFsOwoJfQp9KTsKCn0pKCk7CgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogRUFTSU5HICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKKGZ1bmN0aW9uKCkgewoKLy8gYmFzZWQgb24gZWFzaW5nIGVxdWF0aW9ucyBmcm9tIFJvYmVydCBQZW5uZXIgKGh0dHA6Ly93d3cucm9iZXJ0cGVubmVyLmNvbS9lYXNpbmcpCgp2YXIgYmFzZUVhc2luZ3MgPSB7fTsKCiQuZWFjaCggWyAiUXVhZCIsICJDdWJpYyIsICJRdWFydCIsICJRdWludCIsICJFeHBvIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCWJhc2VFYXNpbmdzWyBuYW1lIF0gPSBmdW5jdGlvbiggcCApIHsKCQlyZXR1cm4gTWF0aC5wb3coIHAsIGkgKyAyICk7Cgl9Owp9KTsKCiQuZXh0ZW5kKCBiYXNlRWFzaW5ncywgewoJU2luZTogZnVuY3Rpb24gKCBwICkgewoJCXJldHVybiAxIC0gTWF0aC5jb3MoIHAgKiBNYXRoLlBJIC8gMiApOwoJfSwKCUNpcmM6IGZ1bmN0aW9uICggcCApIHsKCQlyZXR1cm4gMSAtIE1hdGguc3FydCggMSAtIHAgKiBwICk7Cgl9LAoJRWxhc3RpYzogZnVuY3Rpb24oIHAgKSB7CgkJcmV0dXJuIHAgPT09IDAgfHwgcCA9PT0gMSA/IHAgOgoJCQktTWF0aC5wb3coIDIsIDggKiAocCAtIDEpICkgKiBNYXRoLnNpbiggKCAocCAtIDEpICogODAgLSA3LjUgKSAqIE1hdGguUEkgLyAxNSApOwoJfSwKCUJhY2s6IGZ1bmN0aW9uKCBwICkgewoJCXJldHVybiBwICogcCAqICggMyAqIHAgLSAyICk7Cgl9LAoJQm91bmNlOiBmdW5jdGlvbiAoIHAgKSB7CgkJdmFyIHBvdzIsCgkJCWJvdW5jZSA9IDQ7CgoJCXdoaWxlICggcCA8ICggKCBwb3cyID0gTWF0aC5wb3coIDIsIC0tYm91bmNlICkgKSAtIDEgKSAvIDExICkge30KCQlyZXR1cm4gMSAvIE1hdGgucG93KCA0LCAzIC0gYm91bmNlICkgLSA3LjU2MjUgKiBNYXRoLnBvdyggKCBwb3cyICogMyAtIDIgKSAvIDIyIC0gcCwgMiApOwoJfQp9KTsKCiQuZWFjaCggYmFzZUVhc2luZ3MsIGZ1bmN0aW9uKCBuYW1lLCBlYXNlSW4gKSB7CgkkLmVhc2luZ1sgImVhc2VJbiIgKyBuYW1lIF0gPSBlYXNlSW47CgkkLmVhc2luZ1sgImVhc2VPdXQiICsgbmFtZSBdID0gZnVuY3Rpb24oIHAgKSB7CgkJcmV0dXJuIDEgLSBlYXNlSW4oIDEgLSBwICk7Cgl9OwoJJC5lYXNpbmdbICJlYXNlSW5PdXQiICsgbmFtZSBdID0gZnVuY3Rpb24oIHAgKSB7CgkJcmV0dXJuIHAgPCAwLjUgPwoJCQllYXNlSW4oIHAgKiAyICkgLyAyIDoKCQkJMSAtIGVhc2VJbiggcCAqIC0yICsgMiApIC8gMjsKCX07Cn0pOwoKfSkoKTsKCn0pKGpRdWVyeSk7CgooZnVuY3Rpb24oICQsIHVuZGVmaW5lZCApIHsKCnZhciB1aWQgPSAwLAoJaGlkZVByb3BzID0ge30sCglzaG93UHJvcHMgPSB7fTsKCmhpZGVQcm9wcy5oZWlnaHQgPSBoaWRlUHJvcHMucGFkZGluZ1RvcCA9IGhpZGVQcm9wcy5wYWRkaW5nQm90dG9tID0KCWhpZGVQcm9wcy5ib3JkZXJUb3BXaWR0aCA9IGhpZGVQcm9wcy5ib3JkZXJCb3R0b21XaWR0aCA9ICJoaWRlIjsKc2hvd1Byb3BzLmhlaWdodCA9IHNob3dQcm9wcy5wYWRkaW5nVG9wID0gc2hvd1Byb3BzLnBhZGRpbmdCb3R0b20gPQoJc2hvd1Byb3BzLmJvcmRlclRvcFdpZHRoID0gc2hvd1Byb3BzLmJvcmRlckJvdHRvbVdpZHRoID0gInNob3ciOwoKJC53aWRnZXQoICJ1aS5hY2NvcmRpb24iLCB7Cgl2ZXJzaW9uOiAiMS4xMC40IiwKCW9wdGlvbnM6IHsKCQlhY3RpdmU6IDAsCgkJYW5pbWF0ZToge30sCgkJY29sbGFwc2libGU6IGZhbHNlLAoJCWV2ZW50OiAiY2xpY2siLAoJCWhlYWRlcjogIj4gbGkgPiA6Zmlyc3QtY2hpbGQsPiA6bm90KGxpKTpldmVuIiwKCQloZWlnaHRTdHlsZTogImF1dG8iLAoJCWljb25zOiB7CgkJCWFjdGl2ZUhlYWRlcjogInVpLWljb24tdHJpYW5nbGUtMS1zIiwKCQkJaGVhZGVyOiAidWktaWNvbi10cmlhbmdsZS0xLWUiCgkJfSwKCgkJLy8gY2FsbGJhY2tzCgkJYWN0aXZhdGU6IG51bGwsCgkJYmVmb3JlQWN0aXZhdGU6IG51bGwKCX0sCgoJX2NyZWF0ZTogZnVuY3Rpb24oKSB7CgkJdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgkJdGhpcy5wcmV2U2hvdyA9IHRoaXMucHJldkhpZGUgPSAkKCk7CgkJdGhpcy5lbGVtZW50LmFkZENsYXNzKCAidWktYWNjb3JkaW9uIHVpLXdpZGdldCB1aS1oZWxwZXItcmVzZXQiICkKCQkJLy8gQVJJQQoJCQkuYXR0ciggInJvbGUiLCAidGFibGlzdCIgKTsKCgkJLy8gZG9uJ3QgYWxsb3cgY29sbGFwc2libGU6IGZhbHNlIGFuZCBhY3RpdmU6IGZhbHNlIC8gbnVsbAoJCWlmICggIW9wdGlvbnMuY29sbGFwc2libGUgJiYgKG9wdGlvbnMuYWN0aXZlID09PSBmYWxzZSB8fCBvcHRpb25zLmFjdGl2ZSA9PSBudWxsKSApIHsKCQkJb3B0aW9ucy5hY3RpdmUgPSAwOwoJCX0KCgkJdGhpcy5fcHJvY2Vzc1BhbmVscygpOwoJCS8vIGhhbmRsZSBuZWdhdGl2ZSB2YWx1ZXMKCQlpZiAoIG9wdGlvbnMuYWN0aXZlIDwgMCApIHsKCQkJb3B0aW9ucy5hY3RpdmUgKz0gdGhpcy5oZWFkZXJzLmxlbmd0aDsKCQl9CgkJdGhpcy5fcmVmcmVzaCgpOwoJfSwKCglfZ2V0Q3JlYXRlRXZlbnREYXRhOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gewoJCQloZWFkZXI6IHRoaXMuYWN0aXZlLAoJCQlwYW5lbDogIXRoaXMuYWN0aXZlLmxlbmd0aCA/ICQoKSA6IHRoaXMuYWN0aXZlLm5leHQoKSwKCQkJY29udGVudDogIXRoaXMuYWN0aXZlLmxlbmd0aCA/ICQoKSA6IHRoaXMuYWN0aXZlLm5leHQoKQoJCX07Cgl9LAoKCV9jcmVhdGVJY29uczogZnVuY3Rpb24oKSB7CgkJdmFyIGljb25zID0gdGhpcy5vcHRpb25zLmljb25zOwoJCWlmICggaWNvbnMgKSB7CgkJCSQoICI8c3Bhbj4iICkKCQkJCS5hZGRDbGFzcyggInVpLWFjY29yZGlvbi1oZWFkZXItaWNvbiB1aS1pY29uICIgKyBpY29ucy5oZWFkZXIgKQoJCQkJLnByZXBlbmRUbyggdGhpcy5oZWFkZXJzICk7CgkJCXRoaXMuYWN0aXZlLmNoaWxkcmVuKCAiLnVpLWFjY29yZGlvbi1oZWFkZXItaWNvbiIgKQoJCQkJLnJlbW92ZUNsYXNzKCBpY29ucy5oZWFkZXIgKQoJCQkJLmFkZENsYXNzKCBpY29ucy5hY3RpdmVIZWFkZXIgKTsKCQkJdGhpcy5oZWFkZXJzLmFkZENsYXNzKCAidWktYWNjb3JkaW9uLWljb25zIiApOwoJCX0KCX0sCgoJX2Rlc3Ryb3lJY29uczogZnVuY3Rpb24oKSB7CgkJdGhpcy5oZWFkZXJzCgkJCS5yZW1vdmVDbGFzcyggInVpLWFjY29yZGlvbi1pY29ucyIgKQoJCQkuY2hpbGRyZW4oICIudWktYWNjb3JkaW9uLWhlYWRlci1pY29uIiApCgkJCQkucmVtb3ZlKCk7Cgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQl2YXIgY29udGVudHM7CgoJCS8vIGNsZWFuIHVwIG1haW4gZWxlbWVudAoJCXRoaXMuZWxlbWVudAoJCQkucmVtb3ZlQ2xhc3MoICJ1aS1hY2NvcmRpb24gdWktd2lkZ2V0IHVpLWhlbHBlci1yZXNldCIgKQoJCQkucmVtb3ZlQXR0ciggInJvbGUiICk7CgoJCS8vIGNsZWFuIHVwIGhlYWRlcnMKCQl0aGlzLmhlYWRlcnMKCQkJLnJlbW92ZUNsYXNzKCAidWktYWNjb3JkaW9uLWhlYWRlciB1aS1hY2NvcmRpb24taGVhZGVyLWFjdGl2ZSB1aS1oZWxwZXItcmVzZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsIHVpLXN0YXRlLWFjdGl2ZSB1aS1zdGF0ZS1kaXNhYmxlZCB1aS1jb3JuZXItdG9wIiApCgkJCS5yZW1vdmVBdHRyKCAicm9sZSIgKQoJCQkucmVtb3ZlQXR0ciggImFyaWEtZXhwYW5kZWQiICkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLXNlbGVjdGVkIiApCgkJCS5yZW1vdmVBdHRyKCAiYXJpYS1jb250cm9scyIgKQoJCQkucmVtb3ZlQXR0ciggInRhYkluZGV4IiApCgkJCS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJaWYgKCAvXnVpLWFjY29yZGlvbi8udGVzdCggdGhpcy5pZCApICkgewoJCQkJCXRoaXMucmVtb3ZlQXR0cmlidXRlKCAiaWQiICk7CgkJCQl9CgkJCX0pOwoJCXRoaXMuX2Rlc3Ryb3lJY29ucygpOwoKCQkvLyBjbGVhbiB1cCBjb250ZW50IHBhbmVscwoJCWNvbnRlbnRzID0gdGhpcy5oZWFkZXJzLm5leHQoKQoJCQkuY3NzKCAiZGlzcGxheSIsICIiICkKCQkJLnJlbW92ZUF0dHIoICJyb2xlIiApCgkJCS5yZW1vdmVBdHRyKCAiYXJpYS1oaWRkZW4iICkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLWxhYmVsbGVkYnkiICkKCQkJLnJlbW92ZUNsYXNzKCAidWktaGVscGVyLXJlc2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20gdWktYWNjb3JkaW9uLWNvbnRlbnQgdWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlIHVpLXN0YXRlLWRpc2FibGVkIiApCgkJCS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJaWYgKCAvXnVpLWFjY29yZGlvbi8udGVzdCggdGhpcy5pZCApICkgewoJCQkJCXRoaXMucmVtb3ZlQXR0cmlidXRlKCAiaWQiICk7CgkJCQl9CgkJCX0pOwoJCWlmICggdGhpcy5vcHRpb25zLmhlaWdodFN0eWxlICE9PSAiY29udGVudCIgKSB7CgkJCWNvbnRlbnRzLmNzcyggImhlaWdodCIsICIiICk7CgkJfQoJfSwKCglfc2V0T3B0aW9uOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQlpZiAoIGtleSA9PT0gImFjdGl2ZSIgKSB7CgkJCS8vIF9hY3RpdmF0ZSgpIHdpbGwgaGFuZGxlIGludmFsaWQgdmFsdWVzIGFuZCB1cGRhdGUgdGhpcy5vcHRpb25zCgkJCXRoaXMuX2FjdGl2YXRlKCB2YWx1ZSApOwoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIGtleSA9PT0gImV2ZW50IiApIHsKCQkJaWYgKCB0aGlzLm9wdGlvbnMuZXZlbnQgKSB7CgkJCQl0aGlzLl9vZmYoIHRoaXMuaGVhZGVycywgdGhpcy5vcHRpb25zLmV2ZW50ICk7CgkJCX0KCQkJdGhpcy5fc2V0dXBFdmVudHMoIHZhbHVlICk7CgkJfQoKCQl0aGlzLl9zdXBlcigga2V5LCB2YWx1ZSApOwoKCQkvLyBzZXR0aW5nIGNvbGxhcHNpYmxlOiBmYWxzZSB3aGlsZSBjb2xsYXBzZWQ7IG9wZW4gZmlyc3QgcGFuZWwKCQlpZiAoIGtleSA9PT0gImNvbGxhcHNpYmxlIiAmJiAhdmFsdWUgJiYgdGhpcy5vcHRpb25zLmFjdGl2ZSA9PT0gZmFsc2UgKSB7CgkJCXRoaXMuX2FjdGl2YXRlKCAwICk7CgkJfQoKCQlpZiAoIGtleSA9PT0gImljb25zIiApIHsKCQkJdGhpcy5fZGVzdHJveUljb25zKCk7CgkJCWlmICggdmFsdWUgKSB7CgkJCQl0aGlzLl9jcmVhdGVJY29ucygpOwoJCQl9CgkJfQoKCQkvLyAjNTMzMiAtIG9wYWNpdHkgZG9lc24ndCBjYXNjYWRlIHRvIHBvc2l0aW9uZWQgZWxlbWVudHMgaW4gSUUKCQkvLyBzbyB3ZSBuZWVkIHRvIGFkZCB0aGUgZGlzYWJsZWQgY2xhc3MgdG8gdGhlIGhlYWRlcnMgYW5kIHBhbmVscwoJCWlmICgga2V5ID09PSAiZGlzYWJsZWQiICkgewoJCQl0aGlzLmhlYWRlcnMuYWRkKCB0aGlzLmhlYWRlcnMubmV4dCgpICkKCQkJCS50b2dnbGVDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiwgISF2YWx1ZSApOwoJCX0KCX0sCgoJX2tleWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQlpZiAoIGV2ZW50LmFsdEtleSB8fCBldmVudC5jdHJsS2V5ICkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIga2V5Q29kZSA9ICQudWkua2V5Q29kZSwKCQkJbGVuZ3RoID0gdGhpcy5oZWFkZXJzLmxlbmd0aCwKCQkJY3VycmVudEluZGV4ID0gdGhpcy5oZWFkZXJzLmluZGV4KCBldmVudC50YXJnZXQgKSwKCQkJdG9Gb2N1cyA9IGZhbHNlOwoKCQlzd2l0Y2ggKCBldmVudC5rZXlDb2RlICkgewoJCQljYXNlIGtleUNvZGUuUklHSFQ6CgkJCWNhc2Uga2V5Q29kZS5ET1dOOgoJCQkJdG9Gb2N1cyA9IHRoaXMuaGVhZGVyc1sgKCBjdXJyZW50SW5kZXggKyAxICkgJSBsZW5ndGggXTsKCQkJCWJyZWFrOwoJCQljYXNlIGtleUNvZGUuTEVGVDoKCQkJY2FzZSBrZXlDb2RlLlVQOgoJCQkJdG9Gb2N1cyA9IHRoaXMuaGVhZGVyc1sgKCBjdXJyZW50SW5kZXggLSAxICsgbGVuZ3RoICkgJSBsZW5ndGggXTsKCQkJCWJyZWFrOwoJCQljYXNlIGtleUNvZGUuU1BBQ0U6CgkJCWNhc2Uga2V5Q29kZS5FTlRFUjoKCQkJCXRoaXMuX2V2ZW50SGFuZGxlciggZXZlbnQgKTsKCQkJCWJyZWFrOwoJCQljYXNlIGtleUNvZGUuSE9NRToKCQkJCXRvRm9jdXMgPSB0aGlzLmhlYWRlcnNbIDAgXTsKCQkJCWJyZWFrOwoJCQljYXNlIGtleUNvZGUuRU5EOgoJCQkJdG9Gb2N1cyA9IHRoaXMuaGVhZGVyc1sgbGVuZ3RoIC0gMSBdOwoJCQkJYnJlYWs7CgkJfQoKCQlpZiAoIHRvRm9jdXMgKSB7CgkJCSQoIGV2ZW50LnRhcmdldCApLmF0dHIoICJ0YWJJbmRleCIsIC0xICk7CgkJCSQoIHRvRm9jdXMgKS5hdHRyKCAidGFiSW5kZXgiLCAwICk7CgkJCXRvRm9jdXMuZm9jdXMoKTsKCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQl9Cgl9LAoKCV9wYW5lbEtleURvd24gOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCBldmVudC5rZXlDb2RlID09PSAkLnVpLmtleUNvZGUuVVAgJiYgZXZlbnQuY3RybEtleSApIHsKCQkJJCggZXZlbnQuY3VycmVudFRhcmdldCApLnByZXYoKS5mb2N1cygpOwoJCX0KCX0sCgoJcmVmcmVzaDogZnVuY3Rpb24oKSB7CgkJdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgkJdGhpcy5fcHJvY2Vzc1BhbmVscygpOwoKCQkvLyB3YXMgY29sbGFwc2VkIG9yIG5vIHBhbmVsCgkJaWYgKCAoIG9wdGlvbnMuYWN0aXZlID09PSBmYWxzZSAmJiBvcHRpb25zLmNvbGxhcHNpYmxlID09PSB0cnVlICkgfHwgIXRoaXMuaGVhZGVycy5sZW5ndGggKSB7CgkJCW9wdGlvbnMuYWN0aXZlID0gZmFsc2U7CgkJCXRoaXMuYWN0aXZlID0gJCgpOwoJCS8vIGFjdGl2ZSBmYWxzZSBvbmx5IHdoZW4gY29sbGFwc2libGUgaXMgdHJ1ZQoJCX0gZWxzZSBpZiAoIG9wdGlvbnMuYWN0aXZlID09PSBmYWxzZSApIHsKCQkJdGhpcy5fYWN0aXZhdGUoIDAgKTsKCQkvLyB3YXMgYWN0aXZlLCBidXQgYWN0aXZlIHBhbmVsIGlzIGdvbmUKCQl9IGVsc2UgaWYgKCB0aGlzLmFjdGl2ZS5sZW5ndGggJiYgISQuY29udGFpbnMoIHRoaXMuZWxlbWVudFsgMCBdLCB0aGlzLmFjdGl2ZVsgMCBdICkgKSB7CgkJCS8vIGFsbCByZW1haW5pbmcgcGFuZWwgYXJlIGRpc2FibGVkCgkJCWlmICggdGhpcy5oZWFkZXJzLmxlbmd0aCA9PT0gdGhpcy5oZWFkZXJzLmZpbmQoIi51aS1zdGF0ZS1kaXNhYmxlZCIpLmxlbmd0aCApIHsKCQkJCW9wdGlvbnMuYWN0aXZlID0gZmFsc2U7CgkJCQl0aGlzLmFjdGl2ZSA9ICQoKTsKCQkJLy8gYWN0aXZhdGUgcHJldmlvdXMgcGFuZWwKCQkJfSBlbHNlIHsKCQkJCXRoaXMuX2FjdGl2YXRlKCBNYXRoLm1heCggMCwgb3B0aW9ucy5hY3RpdmUgLSAxICkgKTsKCQkJfQoJCS8vIHdhcyBhY3RpdmUsIGFjdGl2ZSBwYW5lbCBzdGlsbCBleGlzdHMKCQl9IGVsc2UgewoJCQkvLyBtYWtlIHN1cmUgYWN0aXZlIGluZGV4IGlzIGNvcnJlY3QKCQkJb3B0aW9ucy5hY3RpdmUgPSB0aGlzLmhlYWRlcnMuaW5kZXgoIHRoaXMuYWN0aXZlICk7CgkJfQoKCQl0aGlzLl9kZXN0cm95SWNvbnMoKTsKCgkJdGhpcy5fcmVmcmVzaCgpOwoJfSwKCglfcHJvY2Vzc1BhbmVsczogZnVuY3Rpb24oKSB7CgkJdGhpcy5oZWFkZXJzID0gdGhpcy5lbGVtZW50LmZpbmQoIHRoaXMub3B0aW9ucy5oZWFkZXIgKQoJCQkuYWRkQ2xhc3MoICJ1aS1hY2NvcmRpb24taGVhZGVyIHVpLWhlbHBlci1yZXNldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwiICk7CgoJCXRoaXMuaGVhZGVycy5uZXh0KCkKCQkJLmFkZENsYXNzKCAidWktYWNjb3JkaW9uLWNvbnRlbnQgdWktaGVscGVyLXJlc2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20iICkKCQkJLmZpbHRlcigiOm5vdCgudWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlKSIpCgkJCS5oaWRlKCk7Cgl9LAoKCV9yZWZyZXNoOiBmdW5jdGlvbigpIHsKCQl2YXIgbWF4SGVpZ2h0LAoJCQlvcHRpb25zID0gdGhpcy5vcHRpb25zLAoJCQloZWlnaHRTdHlsZSA9IG9wdGlvbnMuaGVpZ2h0U3R5bGUsCgkJCXBhcmVudCA9IHRoaXMuZWxlbWVudC5wYXJlbnQoKSwKCQkJYWNjb3JkaW9uSWQgPSB0aGlzLmFjY29yZGlvbklkID0gInVpLWFjY29yZGlvbi0iICsKCQkJCSh0aGlzLmVsZW1lbnQuYXR0ciggImlkIiApIHx8ICsrdWlkKTsKCgkJdGhpcy5hY3RpdmUgPSB0aGlzLl9maW5kQWN0aXZlKCBvcHRpb25zLmFjdGl2ZSApCgkJCS5hZGRDbGFzcyggInVpLWFjY29yZGlvbi1oZWFkZXItYWN0aXZlIHVpLXN0YXRlLWFjdGl2ZSB1aS1jb3JuZXItdG9wIiApCgkJCS5yZW1vdmVDbGFzcyggInVpLWNvcm5lci1hbGwiICk7CgkJdGhpcy5hY3RpdmUubmV4dCgpCgkJCS5hZGRDbGFzcyggInVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZSIgKQoJCQkuc2hvdygpOwoKCQl0aGlzLmhlYWRlcnMKCQkJLmF0dHIoICJyb2xlIiwgInRhYiIgKQoJCQkuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJCXZhciBoZWFkZXIgPSAkKCB0aGlzICksCgkJCQkJaGVhZGVySWQgPSBoZWFkZXIuYXR0ciggImlkIiApLAoJCQkJCXBhbmVsID0gaGVhZGVyLm5leHQoKSwKCQkJCQlwYW5lbElkID0gcGFuZWwuYXR0ciggImlkIiApOwoJCQkJaWYgKCAhaGVhZGVySWQgKSB7CgkJCQkJaGVhZGVySWQgPSBhY2NvcmRpb25JZCArICItaGVhZGVyLSIgKyBpOwoJCQkJCWhlYWRlci5hdHRyKCAiaWQiLCBoZWFkZXJJZCApOwoJCQkJfQoJCQkJaWYgKCAhcGFuZWxJZCApIHsKCQkJCQlwYW5lbElkID0gYWNjb3JkaW9uSWQgKyAiLXBhbmVsLSIgKyBpOwoJCQkJCXBhbmVsLmF0dHIoICJpZCIsIHBhbmVsSWQgKTsKCQkJCX0KCQkJCWhlYWRlci5hdHRyKCAiYXJpYS1jb250cm9scyIsIHBhbmVsSWQgKTsKCQkJCXBhbmVsLmF0dHIoICJhcmlhLWxhYmVsbGVkYnkiLCBoZWFkZXJJZCApOwoJCQl9KQoJCQkubmV4dCgpCgkJCQkuYXR0ciggInJvbGUiLCAidGFicGFuZWwiICk7CgoJCXRoaXMuaGVhZGVycwoJCQkubm90KCB0aGlzLmFjdGl2ZSApCgkJCS5hdHRyKHsKCQkJCSJhcmlhLXNlbGVjdGVkIjogImZhbHNlIiwKCQkJCSJhcmlhLWV4cGFuZGVkIjogImZhbHNlIiwKCQkJCXRhYkluZGV4OiAtMQoJCQl9KQoJCQkubmV4dCgpCgkJCQkuYXR0cih7CgkJCQkJImFyaWEtaGlkZGVuIjogInRydWUiCgkJCQl9KQoJCQkJLmhpZGUoKTsKCgkJLy8gbWFrZSBzdXJlIGF0IGxlYXN0IG9uZSBoZWFkZXIgaXMgaW4gdGhlIHRhYiBvcmRlcgoJCWlmICggIXRoaXMuYWN0aXZlLmxlbmd0aCApIHsKCQkJdGhpcy5oZWFkZXJzLmVxKCAwICkuYXR0ciggInRhYkluZGV4IiwgMCApOwoJCX0gZWxzZSB7CgkJCXRoaXMuYWN0aXZlLmF0dHIoewoJCQkJImFyaWEtc2VsZWN0ZWQiOiAidHJ1ZSIsCgkJCQkiYXJpYS1leHBhbmRlZCI6ICJ0cnVlIiwKCQkJCXRhYkluZGV4OiAwCgkJCX0pCgkJCS5uZXh0KCkKCQkJCS5hdHRyKHsKCQkJCQkiYXJpYS1oaWRkZW4iOiAiZmFsc2UiCgkJCQl9KTsKCQl9CgoJCXRoaXMuX2NyZWF0ZUljb25zKCk7CgoJCXRoaXMuX3NldHVwRXZlbnRzKCBvcHRpb25zLmV2ZW50ICk7CgoJCWlmICggaGVpZ2h0U3R5bGUgPT09ICJmaWxsIiApIHsKCQkJbWF4SGVpZ2h0ID0gcGFyZW50LmhlaWdodCgpOwoJCQl0aGlzLmVsZW1lbnQuc2libGluZ3MoICI6dmlzaWJsZSIgKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJdmFyIGVsZW0gPSAkKCB0aGlzICksCgkJCQkJcG9zaXRpb24gPSBlbGVtLmNzcyggInBvc2l0aW9uIiApOwoKCQkJCWlmICggcG9zaXRpb24gPT09ICJhYnNvbHV0ZSIgfHwgcG9zaXRpb24gPT09ICJmaXhlZCIgKSB7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJbWF4SGVpZ2h0IC09IGVsZW0ub3V0ZXJIZWlnaHQoIHRydWUgKTsKCQkJfSk7CgoJCQl0aGlzLmhlYWRlcnMuZWFjaChmdW5jdGlvbigpIHsKCQkJCW1heEhlaWdodCAtPSAkKCB0aGlzICkub3V0ZXJIZWlnaHQoIHRydWUgKTsKCQkJfSk7CgoJCQl0aGlzLmhlYWRlcnMubmV4dCgpCgkJCQkuZWFjaChmdW5jdGlvbigpIHsKCQkJCQkkKCB0aGlzICkuaGVpZ2h0KCBNYXRoLm1heCggMCwgbWF4SGVpZ2h0IC0KCQkJCQkJJCggdGhpcyApLmlubmVySGVpZ2h0KCkgKyAkKCB0aGlzICkuaGVpZ2h0KCkgKSApOwoJCQkJfSkKCQkJCS5jc3MoICJvdmVyZmxvdyIsICJhdXRvIiApOwoJCX0gZWxzZSBpZiAoIGhlaWdodFN0eWxlID09PSAiYXV0byIgKSB7CgkJCW1heEhlaWdodCA9IDA7CgkJCXRoaXMuaGVhZGVycy5uZXh0KCkKCQkJCS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJCW1heEhlaWdodCA9IE1hdGgubWF4KCBtYXhIZWlnaHQsICQoIHRoaXMgKS5jc3MoICJoZWlnaHQiLCAiIiApLmhlaWdodCgpICk7CgkJCQl9KQoJCQkJLmhlaWdodCggbWF4SGVpZ2h0ICk7CgkJfQoJfSwKCglfYWN0aXZhdGU6IGZ1bmN0aW9uKCBpbmRleCApIHsKCQl2YXIgYWN0aXZlID0gdGhpcy5fZmluZEFjdGl2ZSggaW5kZXggKVsgMCBdOwoKCQkvLyB0cnlpbmcgdG8gYWN0aXZhdGUgdGhlIGFscmVhZHkgYWN0aXZlIHBhbmVsCgkJaWYgKCBhY3RpdmUgPT09IHRoaXMuYWN0aXZlWyAwIF0gKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIHRyeWluZyB0byBjb2xsYXBzZSwgc2ltdWxhdGUgYSBjbGljayBvbiB0aGUgY3VycmVudGx5IGFjdGl2ZSBoZWFkZXIKCQlhY3RpdmUgPSBhY3RpdmUgfHwgdGhpcy5hY3RpdmVbIDAgXTsKCgkJdGhpcy5fZXZlbnRIYW5kbGVyKHsKCQkJdGFyZ2V0OiBhY3RpdmUsCgkJCWN1cnJlbnRUYXJnZXQ6IGFjdGl2ZSwKCQkJcHJldmVudERlZmF1bHQ6ICQubm9vcAoJCX0pOwoJfSwKCglfZmluZEFjdGl2ZTogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiB0eXBlb2Ygc2VsZWN0b3IgPT09ICJudW1iZXIiID8gdGhpcy5oZWFkZXJzLmVxKCBzZWxlY3RvciApIDogJCgpOwoJfSwKCglfc2V0dXBFdmVudHM6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgZXZlbnRzID0gewoJCQlrZXlkb3duOiAiX2tleWRvd24iCgkJfTsKCQlpZiAoIGV2ZW50ICkgewoJCQkkLmVhY2goIGV2ZW50LnNwbGl0KCIgIiksIGZ1bmN0aW9uKCBpbmRleCwgZXZlbnROYW1lICkgewoJCQkJZXZlbnRzWyBldmVudE5hbWUgXSA9ICJfZXZlbnRIYW5kbGVyIjsKCQkJfSk7CgkJfQoKCQl0aGlzLl9vZmYoIHRoaXMuaGVhZGVycy5hZGQoIHRoaXMuaGVhZGVycy5uZXh0KCkgKSApOwoJCXRoaXMuX29uKCB0aGlzLmhlYWRlcnMsIGV2ZW50cyApOwoJCXRoaXMuX29uKCB0aGlzLmhlYWRlcnMubmV4dCgpLCB7IGtleWRvd246ICJfcGFuZWxLZXlEb3duIiB9KTsKCQl0aGlzLl9ob3ZlcmFibGUoIHRoaXMuaGVhZGVycyApOwoJCXRoaXMuX2ZvY3VzYWJsZSggdGhpcy5oZWFkZXJzICk7Cgl9LAoKCV9ldmVudEhhbmRsZXI6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKCQkJYWN0aXZlID0gdGhpcy5hY3RpdmUsCgkJCWNsaWNrZWQgPSAkKCBldmVudC5jdXJyZW50VGFyZ2V0ICksCgkJCWNsaWNrZWRJc0FjdGl2ZSA9IGNsaWNrZWRbIDAgXSA9PT0gYWN0aXZlWyAwIF0sCgkJCWNvbGxhcHNpbmcgPSBjbGlja2VkSXNBY3RpdmUgJiYgb3B0aW9ucy5jb2xsYXBzaWJsZSwKCQkJdG9TaG93ID0gY29sbGFwc2luZyA/ICQoKSA6IGNsaWNrZWQubmV4dCgpLAoJCQl0b0hpZGUgPSBhY3RpdmUubmV4dCgpLAoJCQlldmVudERhdGEgPSB7CgkJCQlvbGRIZWFkZXI6IGFjdGl2ZSwKCQkJCW9sZFBhbmVsOiB0b0hpZGUsCgkJCQluZXdIZWFkZXI6IGNvbGxhcHNpbmcgPyAkKCkgOiBjbGlja2VkLAoJCQkJbmV3UGFuZWw6IHRvU2hvdwoJCQl9OwoKCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKCQlpZiAoCgkJCQkvLyBjbGljayBvbiBhY3RpdmUgaGVhZGVyLCBidXQgbm90IGNvbGxhcHNpYmxlCgkJCQkoIGNsaWNrZWRJc0FjdGl2ZSAmJiAhb3B0aW9ucy5jb2xsYXBzaWJsZSApIHx8CgkJCQkvLyBhbGxvdyBjYW5jZWxpbmcgYWN0aXZhdGlvbgoJCQkJKCB0aGlzLl90cmlnZ2VyKCAiYmVmb3JlQWN0aXZhdGUiLCBldmVudCwgZXZlbnREYXRhICkgPT09IGZhbHNlICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCW9wdGlvbnMuYWN0aXZlID0gY29sbGFwc2luZyA/IGZhbHNlIDogdGhpcy5oZWFkZXJzLmluZGV4KCBjbGlja2VkICk7CgoJCS8vIHdoZW4gdGhlIGNhbGwgdG8gLl90b2dnbGUoKSBjb21lcyBhZnRlciB0aGUgY2xhc3MgY2hhbmdlcwoJCS8vIGl0IGNhdXNlcyBhIHZlcnkgb2RkIGJ1ZyBpbiBJRSA4IChzZWUgIzY3MjApCgkJdGhpcy5hY3RpdmUgPSBjbGlja2VkSXNBY3RpdmUgPyAkKCkgOiBjbGlja2VkOwoJCXRoaXMuX3RvZ2dsZSggZXZlbnREYXRhICk7CgoJCS8vIHN3aXRjaCBjbGFzc2VzCgkJLy8gY29ybmVyIGNsYXNzZXMgb24gdGhlIHByZXZpb3VzbHkgYWN0aXZlIGhlYWRlciBzdGF5IGFmdGVyIHRoZSBhbmltYXRpb24KCQlhY3RpdmUucmVtb3ZlQ2xhc3MoICJ1aS1hY2NvcmRpb24taGVhZGVyLWFjdGl2ZSB1aS1zdGF0ZS1hY3RpdmUiICk7CgkJaWYgKCBvcHRpb25zLmljb25zICkgewoJCQlhY3RpdmUuY2hpbGRyZW4oICIudWktYWNjb3JkaW9uLWhlYWRlci1pY29uIiApCgkJCQkucmVtb3ZlQ2xhc3MoIG9wdGlvbnMuaWNvbnMuYWN0aXZlSGVhZGVyICkKCQkJCS5hZGRDbGFzcyggb3B0aW9ucy5pY29ucy5oZWFkZXIgKTsKCQl9CgoJCWlmICggIWNsaWNrZWRJc0FjdGl2ZSApIHsKCQkJY2xpY2tlZAoJCQkJLnJlbW92ZUNsYXNzKCAidWktY29ybmVyLWFsbCIgKQoJCQkJLmFkZENsYXNzKCAidWktYWNjb3JkaW9uLWhlYWRlci1hY3RpdmUgdWktc3RhdGUtYWN0aXZlIHVpLWNvcm5lci10b3AiICk7CgkJCWlmICggb3B0aW9ucy5pY29ucyApIHsKCQkJCWNsaWNrZWQuY2hpbGRyZW4oICIudWktYWNjb3JkaW9uLWhlYWRlci1pY29uIiApCgkJCQkJLnJlbW92ZUNsYXNzKCBvcHRpb25zLmljb25zLmhlYWRlciApCgkJCQkJLmFkZENsYXNzKCBvcHRpb25zLmljb25zLmFjdGl2ZUhlYWRlciApOwoJCQl9CgoJCQljbGlja2VkCgkJCQkubmV4dCgpCgkJCQkuYWRkQ2xhc3MoICJ1aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmUiICk7CgkJfQoJfSwKCglfdG9nZ2xlOiBmdW5jdGlvbiggZGF0YSApIHsKCQl2YXIgdG9TaG93ID0gZGF0YS5uZXdQYW5lbCwKCQkJdG9IaWRlID0gdGhpcy5wcmV2U2hvdy5sZW5ndGggPyB0aGlzLnByZXZTaG93IDogZGF0YS5vbGRQYW5lbDsKCgkJLy8gaGFuZGxlIGFjdGl2YXRpbmcgYSBwYW5lbCBkdXJpbmcgdGhlIGFuaW1hdGlvbiBmb3IgYW5vdGhlciBhY3RpdmF0aW9uCgkJdGhpcy5wcmV2U2hvdy5hZGQoIHRoaXMucHJldkhpZGUgKS5zdG9wKCB0cnVlLCB0cnVlICk7CgkJdGhpcy5wcmV2U2hvdyA9IHRvU2hvdzsKCQl0aGlzLnByZXZIaWRlID0gdG9IaWRlOwoKCQlpZiAoIHRoaXMub3B0aW9ucy5hbmltYXRlICkgewoJCQl0aGlzLl9hbmltYXRlKCB0b1Nob3csIHRvSGlkZSwgZGF0YSApOwoJCX0gZWxzZSB7CgkJCXRvSGlkZS5oaWRlKCk7CgkJCXRvU2hvdy5zaG93KCk7CgkJCXRoaXMuX3RvZ2dsZUNvbXBsZXRlKCBkYXRhICk7CgkJfQoKCQl0b0hpZGUuYXR0cih7CgkJCSJhcmlhLWhpZGRlbiI6ICJ0cnVlIgoJCX0pOwoJCXRvSGlkZS5wcmV2KCkuYXR0ciggImFyaWEtc2VsZWN0ZWQiLCAiZmFsc2UiICk7CgkJLy8gaWYgd2UncmUgc3dpdGNoaW5nIHBhbmVscywgcmVtb3ZlIHRoZSBvbGQgaGVhZGVyIGZyb20gdGhlIHRhYiBvcmRlcgoJCS8vIGlmIHdlJ3JlIG9wZW5pbmcgZnJvbSBjb2xsYXBzZWQgc3RhdGUsIHJlbW92ZSB0aGUgcHJldmlvdXMgaGVhZGVyIGZyb20gdGhlIHRhYiBvcmRlcgoJCS8vIGlmIHdlJ3JlIGNvbGxhcHNpbmcsIHRoZW4ga2VlcCB0aGUgY29sbGFwc2luZyBoZWFkZXIgaW4gdGhlIHRhYiBvcmRlcgoJCWlmICggdG9TaG93Lmxlbmd0aCAmJiB0b0hpZGUubGVuZ3RoICkgewoJCQl0b0hpZGUucHJldigpLmF0dHIoewoJCQkJInRhYkluZGV4IjogLTEsCgkJCQkiYXJpYS1leHBhbmRlZCI6ICJmYWxzZSIKCQkJfSk7CgkJfSBlbHNlIGlmICggdG9TaG93Lmxlbmd0aCApIHsKCQkJdGhpcy5oZWFkZXJzLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJCXJldHVybiAkKCB0aGlzICkuYXR0ciggInRhYkluZGV4IiApID09PSAwOwoJCQl9KQoJCQkuYXR0ciggInRhYkluZGV4IiwgLTEgKTsKCQl9CgoJCXRvU2hvdwoJCQkuYXR0ciggImFyaWEtaGlkZGVuIiwgImZhbHNlIiApCgkJCS5wcmV2KCkKCQkJCS5hdHRyKHsKCQkJCQkiYXJpYS1zZWxlY3RlZCI6ICJ0cnVlIiwKCQkJCQl0YWJJbmRleDogMCwKCQkJCQkiYXJpYS1leHBhbmRlZCI6ICJ0cnVlIgoJCQkJfSk7Cgl9LAoKCV9hbmltYXRlOiBmdW5jdGlvbiggdG9TaG93LCB0b0hpZGUsIGRhdGEgKSB7CgkJdmFyIHRvdGFsLCBlYXNpbmcsIGR1cmF0aW9uLAoJCQl0aGF0ID0gdGhpcywKCQkJYWRqdXN0ID0gMCwKCQkJZG93biA9IHRvU2hvdy5sZW5ndGggJiYKCQkJCSggIXRvSGlkZS5sZW5ndGggfHwgKCB0b1Nob3cuaW5kZXgoKSA8IHRvSGlkZS5pbmRleCgpICkgKSwKCQkJYW5pbWF0ZSA9IHRoaXMub3B0aW9ucy5hbmltYXRlIHx8IHt9LAoJCQlvcHRpb25zID0gZG93biAmJiBhbmltYXRlLmRvd24gfHwgYW5pbWF0ZSwKCQkJY29tcGxldGUgPSBmdW5jdGlvbigpIHsKCQkJCXRoYXQuX3RvZ2dsZUNvbXBsZXRlKCBkYXRhICk7CgkJCX07CgoJCWlmICggdHlwZW9mIG9wdGlvbnMgPT09ICJudW1iZXIiICkgewoJCQlkdXJhdGlvbiA9IG9wdGlvbnM7CgkJfQoJCWlmICggdHlwZW9mIG9wdGlvbnMgPT09ICJzdHJpbmciICkgewoJCQllYXNpbmcgPSBvcHRpb25zOwoJCX0KCQkvLyBmYWxsIGJhY2sgZnJvbSBvcHRpb25zIHRvIGFuaW1hdGlvbiBpbiBjYXNlIG9mIHBhcnRpYWwgZG93biBzZXR0aW5ncwoJCWVhc2luZyA9IGVhc2luZyB8fCBvcHRpb25zLmVhc2luZyB8fCBhbmltYXRlLmVhc2luZzsKCQlkdXJhdGlvbiA9IGR1cmF0aW9uIHx8IG9wdGlvbnMuZHVyYXRpb24gfHwgYW5pbWF0ZS5kdXJhdGlvbjsKCgkJaWYgKCAhdG9IaWRlLmxlbmd0aCApIHsKCQkJcmV0dXJuIHRvU2hvdy5hbmltYXRlKCBzaG93UHJvcHMsIGR1cmF0aW9uLCBlYXNpbmcsIGNvbXBsZXRlICk7CgkJfQoJCWlmICggIXRvU2hvdy5sZW5ndGggKSB7CgkJCXJldHVybiB0b0hpZGUuYW5pbWF0ZSggaGlkZVByb3BzLCBkdXJhdGlvbiwgZWFzaW5nLCBjb21wbGV0ZSApOwoJCX0KCgkJdG90YWwgPSB0b1Nob3cuc2hvdygpLm91dGVySGVpZ2h0KCk7CgkJdG9IaWRlLmFuaW1hdGUoIGhpZGVQcm9wcywgewoJCQlkdXJhdGlvbjogZHVyYXRpb24sCgkJCWVhc2luZzogZWFzaW5nLAoJCQlzdGVwOiBmdW5jdGlvbiggbm93LCBmeCApIHsKCQkJCWZ4Lm5vdyA9IE1hdGgucm91bmQoIG5vdyApOwoJCQl9CgkJfSk7CgkJdG9TaG93CgkJCS5oaWRlKCkKCQkJLmFuaW1hdGUoIHNob3dQcm9wcywgewoJCQkJZHVyYXRpb246IGR1cmF0aW9uLAoJCQkJZWFzaW5nOiBlYXNpbmcsCgkJCQljb21wbGV0ZTogY29tcGxldGUsCgkJCQlzdGVwOiBmdW5jdGlvbiggbm93LCBmeCApIHsKCQkJCQlmeC5ub3cgPSBNYXRoLnJvdW5kKCBub3cgKTsKCQkJCQlpZiAoIGZ4LnByb3AgIT09ICJoZWlnaHQiICkgewoJCQkJCQlhZGp1c3QgKz0gZngubm93OwoJCQkJCX0gZWxzZSBpZiAoIHRoYXQub3B0aW9ucy5oZWlnaHRTdHlsZSAhPT0gImNvbnRlbnQiICkgewoJCQkJCQlmeC5ub3cgPSBNYXRoLnJvdW5kKCB0b3RhbCAtIHRvSGlkZS5vdXRlckhlaWdodCgpIC0gYWRqdXN0ICk7CgkJCQkJCWFkanVzdCA9IDA7CgkJCQkJfQoJCQkJfQoJCQl9KTsKCX0sCgoJX3RvZ2dsZUNvbXBsZXRlOiBmdW5jdGlvbiggZGF0YSApIHsKCQl2YXIgdG9IaWRlID0gZGF0YS5vbGRQYW5lbDsKCgkJdG9IaWRlCgkJCS5yZW1vdmVDbGFzcyggInVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZSIgKQoJCQkucHJldigpCgkJCQkucmVtb3ZlQ2xhc3MoICJ1aS1jb3JuZXItdG9wIiApCgkJCQkuYWRkQ2xhc3MoICJ1aS1jb3JuZXItYWxsIiApOwoKCQkvLyBXb3JrIGFyb3VuZCBmb3IgcmVuZGVyaW5nIGJ1ZyBpbiBJRSAoIzU0MjEpCgkJaWYgKCB0b0hpZGUubGVuZ3RoICkgewoJCQl0b0hpZGUucGFyZW50KClbMF0uY2xhc3NOYW1lID0gdG9IaWRlLnBhcmVudCgpWzBdLmNsYXNzTmFtZTsKCQl9CgkJdGhpcy5fdHJpZ2dlciggImFjdGl2YXRlIiwgbnVsbCwgZGF0YSApOwoJfQp9KTsKCn0pKCBqUXVlcnkgKTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKJC53aWRnZXQoICJ1aS5hdXRvY29tcGxldGUiLCB7Cgl2ZXJzaW9uOiAiMS4xMC40IiwKCWRlZmF1bHRFbGVtZW50OiAiPGlucHV0PiIsCglvcHRpb25zOiB7CgkJYXBwZW5kVG86IG51bGwsCgkJYXV0b0ZvY3VzOiBmYWxzZSwKCQlkZWxheTogMzAwLAoJCW1pbkxlbmd0aDogMSwKCQlwb3NpdGlvbjogewoJCQlteTogImxlZnQgdG9wIiwKCQkJYXQ6ICJsZWZ0IGJvdHRvbSIsCgkJCWNvbGxpc2lvbjogIm5vbmUiCgkJfSwKCQlzb3VyY2U6IG51bGwsCgoJCS8vIGNhbGxiYWNrcwoJCWNoYW5nZTogbnVsbCwKCQljbG9zZTogbnVsbCwKCQlmb2N1czogbnVsbCwKCQlvcGVuOiBudWxsLAoJCXJlc3BvbnNlOiBudWxsLAoJCXNlYXJjaDogbnVsbCwKCQlzZWxlY3Q6IG51bGwKCX0sCgoJcmVxdWVzdEluZGV4OiAwLAoJcGVuZGluZzogMCwKCglfY3JlYXRlOiBmdW5jdGlvbigpIHsKCQkvLyBTb21lIGJyb3dzZXJzIG9ubHkgcmVwZWF0IGtleWRvd24gZXZlbnRzLCBub3Qga2V5cHJlc3MgZXZlbnRzLAoJCS8vIHNvIHdlIHVzZSB0aGUgc3VwcHJlc3NLZXlQcmVzcyBmbGFnIHRvIGRldGVybWluZSBpZiB3ZSd2ZSBhbHJlYWR5CgkJLy8gaGFuZGxlZCB0aGUga2V5ZG93biBldmVudC4gIzcyNjkKCQkvLyBVbmZvcnR1bmF0ZWx5IHRoZSBjb2RlIGZvciAmIGluIGtleXByZXNzIGlzIHRoZSBzYW1lIGFzIHRoZSB1cCBhcnJvdywKCQkvLyBzbyB3ZSB1c2UgdGhlIHN1cHByZXNzS2V5UHJlc3NSZXBlYXQgZmxhZyB0byBhdm9pZCBoYW5kbGluZyBrZXlwcmVzcwoJCS8vIGV2ZW50cyB3aGVuIHdlIGtub3cgdGhlIGtleWRvd24gZXZlbnQgd2FzIHVzZWQgdG8gbW9kaWZ5IHRoZQoJCS8vIHNlYXJjaCB0ZXJtLiAjNzc5OQoJCXZhciBzdXBwcmVzc0tleVByZXNzLCBzdXBwcmVzc0tleVByZXNzUmVwZWF0LCBzdXBwcmVzc0lucHV0LAoJCQlub2RlTmFtZSA9IHRoaXMuZWxlbWVudFswXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLAoJCQlpc1RleHRhcmVhID0gbm9kZU5hbWUgPT09ICJ0ZXh0YXJlYSIsCgkJCWlzSW5wdXQgPSBub2RlTmFtZSA9PT0gImlucHV0IjsKCgkJdGhpcy5pc011bHRpTGluZSA9CgkJCS8vIFRleHRhcmVhcyBhcmUgYWx3YXlzIG11bHRpLWxpbmUKCQkJaXNUZXh0YXJlYSA/IHRydWUgOgoJCQkvLyBJbnB1dHMgYXJlIGFsd2F5cyBzaW5nbGUtbGluZSwgZXZlbiBpZiBpbnNpZGUgYSBjb250ZW50RWRpdGFibGUgZWxlbWVudAoJCQkvLyBJRSBhbHNvIHRyZWF0cyBpbnB1dHMgYXMgY29udGVudEVkaXRhYmxlCgkJCWlzSW5wdXQgPyBmYWxzZSA6CgkJCS8vIEFsbCBvdGhlciBlbGVtZW50IHR5cGVzIGFyZSBkZXRlcm1pbmVkIGJ5IHdoZXRoZXIgb3Igbm90IHRoZXkncmUgY29udGVudEVkaXRhYmxlCgkJCXRoaXMuZWxlbWVudC5wcm9wKCAiaXNDb250ZW50RWRpdGFibGUiICk7CgoJCXRoaXMudmFsdWVNZXRob2QgPSB0aGlzLmVsZW1lbnRbIGlzVGV4dGFyZWEgfHwgaXNJbnB1dCA/ICJ2YWwiIDogInRleHQiIF07CgkJdGhpcy5pc05ld01lbnUgPSB0cnVlOwoKCQl0aGlzLmVsZW1lbnQKCQkJLmFkZENsYXNzKCAidWktYXV0b2NvbXBsZXRlLWlucHV0IiApCgkJCS5hdHRyKCAiYXV0b2NvbXBsZXRlIiwgIm9mZiIgKTsKCgkJdGhpcy5fb24oIHRoaXMuZWxlbWVudCwgewoJCQlrZXlkb3duOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlpZiAoIHRoaXMuZWxlbWVudC5wcm9wKCAicmVhZE9ubHkiICkgKSB7CgkJCQkJc3VwcHJlc3NLZXlQcmVzcyA9IHRydWU7CgkJCQkJc3VwcHJlc3NJbnB1dCA9IHRydWU7CgkJCQkJc3VwcHJlc3NLZXlQcmVzc1JlcGVhdCA9IHRydWU7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCXN1cHByZXNzS2V5UHJlc3MgPSBmYWxzZTsKCQkJCXN1cHByZXNzSW5wdXQgPSBmYWxzZTsKCQkJCXN1cHByZXNzS2V5UHJlc3NSZXBlYXQgPSBmYWxzZTsKCQkJCXZhciBrZXlDb2RlID0gJC51aS5rZXlDb2RlOwoJCQkJc3dpdGNoKCBldmVudC5rZXlDb2RlICkgewoJCQkJY2FzZSBrZXlDb2RlLlBBR0VfVVA6CgkJCQkJc3VwcHJlc3NLZXlQcmVzcyA9IHRydWU7CgkJCQkJdGhpcy5fbW92ZSggInByZXZpb3VzUGFnZSIsIGV2ZW50ICk7CgkJCQkJYnJlYWs7CgkJCQljYXNlIGtleUNvZGUuUEFHRV9ET1dOOgoJCQkJCXN1cHByZXNzS2V5UHJlc3MgPSB0cnVlOwoJCQkJCXRoaXMuX21vdmUoICJuZXh0UGFnZSIsIGV2ZW50ICk7CgkJCQkJYnJlYWs7CgkJCQljYXNlIGtleUNvZGUuVVA6CgkJCQkJc3VwcHJlc3NLZXlQcmVzcyA9IHRydWU7CgkJCQkJdGhpcy5fa2V5RXZlbnQoICJwcmV2aW91cyIsIGV2ZW50ICk7CgkJCQkJYnJlYWs7CgkJCQljYXNlIGtleUNvZGUuRE9XTjoKCQkJCQlzdXBwcmVzc0tleVByZXNzID0gdHJ1ZTsKCQkJCQl0aGlzLl9rZXlFdmVudCggIm5leHQiLCBldmVudCApOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSBrZXlDb2RlLkVOVEVSOgoJCQkJY2FzZSBrZXlDb2RlLk5VTVBBRF9FTlRFUjoKCQkJCQkvLyB3aGVuIG1lbnUgaXMgb3BlbiBhbmQgaGFzIGZvY3VzCgkJCQkJaWYgKCB0aGlzLm1lbnUuYWN0aXZlICkgewoJCQkJCQkvLyAjNjA1NSAtIE9wZXJhIHN0aWxsIGFsbG93cyB0aGUga2V5cHJlc3MgdG8gb2NjdXIKCQkJCQkJLy8gd2hpY2ggY2F1c2VzIGZvcm1zIHRvIHN1Ym1pdAoJCQkJCQlzdXBwcmVzc0tleVByZXNzID0gdHJ1ZTsKCQkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQkJdGhpcy5tZW51LnNlbGVjdCggZXZlbnQgKTsKCQkJCQl9CgkJCQkJYnJlYWs7CgkJCQljYXNlIGtleUNvZGUuVEFCOgoJCQkJCWlmICggdGhpcy5tZW51LmFjdGl2ZSApIHsKCQkJCQkJdGhpcy5tZW51LnNlbGVjdCggZXZlbnQgKTsKCQkJCQl9CgkJCQkJYnJlYWs7CgkJCQljYXNlIGtleUNvZGUuRVNDQVBFOgoJCQkJCWlmICggdGhpcy5tZW51LmVsZW1lbnQuaXMoICI6dmlzaWJsZSIgKSApIHsKCQkJCQkJdGhpcy5fdmFsdWUoIHRoaXMudGVybSApOwoJCQkJCQl0aGlzLmNsb3NlKCBldmVudCApOwoJCQkJCQkvLyBEaWZmZXJlbnQgYnJvd3NlcnMgaGF2ZSBkaWZmZXJlbnQgZGVmYXVsdCBiZWhhdmlvciBmb3IgZXNjYXBlCgkJCQkJCS8vIFNpbmdsZSBwcmVzcyBjYW4gbWVhbiB1bmRvIG9yIGNsZWFyCgkJCQkJCS8vIERvdWJsZSBwcmVzcyBpbiBJRSBtZWFucyBjbGVhciB0aGUgd2hvbGUgZm9ybQoJCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCX0KCQkJCQlicmVhazsKCQkJCWRlZmF1bHQ6CgkJCQkJc3VwcHJlc3NLZXlQcmVzc1JlcGVhdCA9IHRydWU7CgkJCQkJLy8gc2VhcmNoIHRpbWVvdXQgc2hvdWxkIGJlIHRyaWdnZXJlZCBiZWZvcmUgdGhlIGlucHV0IHZhbHVlIGlzIGNoYW5nZWQKCQkJCQl0aGlzLl9zZWFyY2hUaW1lb3V0KCBldmVudCApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9LAoJCQlrZXlwcmVzczogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJaWYgKCBzdXBwcmVzc0tleVByZXNzICkgewoJCQkJCXN1cHByZXNzS2V5UHJlc3MgPSBmYWxzZTsKCQkJCQlpZiAoICF0aGlzLmlzTXVsdGlMaW5lIHx8IHRoaXMubWVudS5lbGVtZW50LmlzKCAiOnZpc2libGUiICkgKSB7CgkJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCQkJfQoJCQkJCXJldHVybjsKCQkJCX0KCQkJCWlmICggc3VwcHJlc3NLZXlQcmVzc1JlcGVhdCApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJLy8gcmVwbGljYXRlIHNvbWUga2V5IGhhbmRsZXJzIHRvIGFsbG93IHRoZW0gdG8gcmVwZWF0IGluIEZpcmVmb3ggYW5kIE9wZXJhCgkJCQl2YXIga2V5Q29kZSA9ICQudWkua2V5Q29kZTsKCQkJCXN3aXRjaCggZXZlbnQua2V5Q29kZSApIHsKCQkJCWNhc2Uga2V5Q29kZS5QQUdFX1VQOgoJCQkJCXRoaXMuX21vdmUoICJwcmV2aW91c1BhZ2UiLCBldmVudCApOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSBrZXlDb2RlLlBBR0VfRE9XTjoKCQkJCQl0aGlzLl9tb3ZlKCAibmV4dFBhZ2UiLCBldmVudCApOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSBrZXlDb2RlLlVQOgoJCQkJCXRoaXMuX2tleUV2ZW50KCAicHJldmlvdXMiLCBldmVudCApOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSBrZXlDb2RlLkRPV046CgkJCQkJdGhpcy5fa2V5RXZlbnQoICJuZXh0IiwgZXZlbnQgKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfSwKCQkJaW5wdXQ6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCWlmICggc3VwcHJlc3NJbnB1dCApIHsKCQkJCQlzdXBwcmVzc0lucHV0ID0gZmFsc2U7CgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQl0aGlzLl9zZWFyY2hUaW1lb3V0KCBldmVudCApOwoJCQl9LAoJCQlmb2N1czogZnVuY3Rpb24oKSB7CgkJCQl0aGlzLnNlbGVjdGVkSXRlbSA9IG51bGw7CgkJCQl0aGlzLnByZXZpb3VzID0gdGhpcy5fdmFsdWUoKTsKCQkJfSwKCQkJYmx1cjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJaWYgKCB0aGlzLmNhbmNlbEJsdXIgKSB7CgkJCQkJZGVsZXRlIHRoaXMuY2FuY2VsQmx1cjsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJY2xlYXJUaW1lb3V0KCB0aGlzLnNlYXJjaGluZyApOwoJCQkJdGhpcy5jbG9zZSggZXZlbnQgKTsKCQkJCXRoaXMuX2NoYW5nZSggZXZlbnQgKTsKCQkJfQoJCX0pOwoKCQl0aGlzLl9pbml0U291cmNlKCk7CgkJdGhpcy5tZW51ID0gJCggIjx1bD4iICkKCQkJLmFkZENsYXNzKCAidWktYXV0b2NvbXBsZXRlIHVpLWZyb250IiApCgkJCS5hcHBlbmRUbyggdGhpcy5fYXBwZW5kVG8oKSApCgkJCS5tZW51KHsKCQkJCS8vIGRpc2FibGUgQVJJQSBzdXBwb3J0LCB0aGUgbGl2ZSByZWdpb24gdGFrZXMgY2FyZSBvZiB0aGF0CgkJCQlyb2xlOiBudWxsCgkJCX0pCgkJCS5oaWRlKCkKCQkJLmRhdGEoICJ1aS1tZW51IiApOwoKCQl0aGlzLl9vbiggdGhpcy5tZW51LmVsZW1lbnQsIHsKCQkJbW91c2Vkb3duOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkvLyBwcmV2ZW50IG1vdmluZyBmb2N1cyBvdXQgb2YgdGhlIHRleHQgZmllbGQKCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgoJCQkJLy8gSUUgZG9lc24ndCBwcmV2ZW50IG1vdmluZyBmb2N1cyBldmVuIHdpdGggZXZlbnQucHJldmVudERlZmF1bHQoKQoJCQkJLy8gc28gd2Ugc2V0IGEgZmxhZyB0byBrbm93IHdoZW4gd2Ugc2hvdWxkIGlnbm9yZSB0aGUgYmx1ciBldmVudAoJCQkJdGhpcy5jYW5jZWxCbHVyID0gdHJ1ZTsKCQkJCXRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQkJCWRlbGV0ZSB0aGlzLmNhbmNlbEJsdXI7CgkJCQl9KTsKCgkJCQkvLyBjbGlja2luZyBvbiB0aGUgc2Nyb2xsYmFyIGNhdXNlcyBmb2N1cyB0byBzaGlmdCB0byB0aGUgYm9keQoJCQkJLy8gYnV0IHdlIGNhbid0IGRldGVjdCBhIG1vdXNldXAgb3IgYSBjbGljayBpbW1lZGlhdGVseSBhZnRlcndhcmQKCQkJCS8vIHNvIHdlIGhhdmUgdG8gdHJhY2sgdGhlIG5leHQgbW91c2Vkb3duIGFuZCBjbG9zZSB0aGUgbWVudSBpZgoJCQkJLy8gdGhlIHVzZXIgY2xpY2tzIHNvbWV3aGVyZSBvdXRzaWRlIG9mIHRoZSBhdXRvY29tcGxldGUKCQkJCXZhciBtZW51RWxlbWVudCA9IHRoaXMubWVudS5lbGVtZW50WyAwIF07CgkJCQlpZiAoICEkKCBldmVudC50YXJnZXQgKS5jbG9zZXN0KCAiLnVpLW1lbnUtaXRlbSIgKS5sZW5ndGggKSB7CgkJCQkJdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CgkJCQkJCXZhciB0aGF0ID0gdGhpczsKCQkJCQkJdGhpcy5kb2N1bWVudC5vbmUoICJtb3VzZWRvd24iLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCQlpZiAoIGV2ZW50LnRhcmdldCAhPT0gdGhhdC5lbGVtZW50WyAwIF0gJiYKCQkJCQkJCQkJZXZlbnQudGFyZ2V0ICE9PSBtZW51RWxlbWVudCAmJgoJCQkJCQkJCQkhJC5jb250YWlucyggbWVudUVsZW1lbnQsIGV2ZW50LnRhcmdldCApICkgewoJCQkJCQkJCXRoYXQuY2xvc2UoKTsKCQkJCQkJCX0KCQkJCQkJfSk7CgkJCQkJfSk7CgkJCQl9CgkJCX0sCgkJCW1lbnVmb2N1czogZnVuY3Rpb24oIGV2ZW50LCB1aSApIHsKCQkJCS8vIHN1cHBvcnQ6IEZpcmVmb3gKCQkJCS8vIFByZXZlbnQgYWNjaWRlbnRhbCBhY3RpdmF0aW9uIG9mIG1lbnUgaXRlbXMgaW4gRmlyZWZveCAoIzcwMjQgIzkxMTgpCgkJCQlpZiAoIHRoaXMuaXNOZXdNZW51ICkgewoJCQkJCXRoaXMuaXNOZXdNZW51ID0gZmFsc2U7CgkJCQkJaWYgKCBldmVudC5vcmlnaW5hbEV2ZW50ICYmIC9ebW91c2UvLnRlc3QoIGV2ZW50Lm9yaWdpbmFsRXZlbnQudHlwZSApICkgewoJCQkJCQl0aGlzLm1lbnUuYmx1cigpOwoKCQkJCQkJdGhpcy5kb2N1bWVudC5vbmUoICJtb3VzZW1vdmUiLCBmdW5jdGlvbigpIHsKCQkJCQkJCSQoIGV2ZW50LnRhcmdldCApLnRyaWdnZXIoIGV2ZW50Lm9yaWdpbmFsRXZlbnQgKTsKCQkJCQkJfSk7CgoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJfQoKCQkJCXZhciBpdGVtID0gdWkuaXRlbS5kYXRhKCAidWktYXV0b2NvbXBsZXRlLWl0ZW0iICk7CgkJCQlpZiAoIGZhbHNlICE9PSB0aGlzLl90cmlnZ2VyKCAiZm9jdXMiLCBldmVudCwgeyBpdGVtOiBpdGVtIH0gKSApIHsKCQkJCQkvLyB1c2UgdmFsdWUgdG8gbWF0Y2ggd2hhdCB3aWxsIGVuZCB1cCBpbiB0aGUgaW5wdXQsIGlmIGl0IHdhcyBhIGtleSBldmVudAoJCQkJCWlmICggZXZlbnQub3JpZ2luYWxFdmVudCAmJiAvXmtleS8udGVzdCggZXZlbnQub3JpZ2luYWxFdmVudC50eXBlICkgKSB7CgkJCQkJCXRoaXMuX3ZhbHVlKCBpdGVtLnZhbHVlICk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQkvLyBOb3JtYWxseSB0aGUgaW5wdXQgaXMgcG9wdWxhdGVkIHdpdGggdGhlIGl0ZW0ncyB2YWx1ZSBhcyB0aGUKCQkJCQkvLyBtZW51IGlzIG5hdmlnYXRlZCwgY2F1c2luZyBzY3JlZW4gcmVhZGVycyB0byBub3RpY2UgYSBjaGFuZ2UgYW5kCgkJCQkJLy8gYW5ub3VuY2UgdGhlIGl0ZW0uIFNpbmNlIHRoZSBmb2N1cyBldmVudCB3YXMgY2FuY2VsZWQsIHRoaXMgZG9lc24ndAoJCQkJCS8vIGhhcHBlbiwgc28gd2UgdXBkYXRlIHRoZSBsaXZlIHJlZ2lvbiBzbyB0aGF0IHNjcmVlbiByZWFkZXJzIGNhbgoJCQkJCS8vIHN0aWxsIG5vdGljZSB0aGUgY2hhbmdlIGFuZCBhbm5vdW5jZSBpdC4KCQkJCQl0aGlzLmxpdmVSZWdpb24udGV4dCggaXRlbS52YWx1ZSApOwoJCQkJfQoJCQl9LAoJCQltZW51c2VsZWN0OiBmdW5jdGlvbiggZXZlbnQsIHVpICkgewoJCQkJdmFyIGl0ZW0gPSB1aS5pdGVtLmRhdGEoICJ1aS1hdXRvY29tcGxldGUtaXRlbSIgKSwKCQkJCQlwcmV2aW91cyA9IHRoaXMucHJldmlvdXM7CgoJCQkJLy8gb25seSB0cmlnZ2VyIHdoZW4gZm9jdXMgd2FzIGxvc3QgKGNsaWNrIG9uIG1lbnUpCgkJCQlpZiAoIHRoaXMuZWxlbWVudFswXSAhPT0gdGhpcy5kb2N1bWVudFswXS5hY3RpdmVFbGVtZW50ICkgewoJCQkJCXRoaXMuZWxlbWVudC5mb2N1cygpOwoJCQkJCXRoaXMucHJldmlvdXMgPSBwcmV2aW91czsKCQkJCQkvLyAjNjEwOSAtIElFIHRyaWdnZXJzIHR3byBmb2N1cyBldmVudHMgYW5kIHRoZSBzZWNvbmQKCQkJCQkvLyBpcyBhc3luY2hyb25vdXMsIHNvIHdlIG5lZWQgdG8gcmVzZXQgdGhlIHByZXZpb3VzCgkJCQkJLy8gdGVybSBzeW5jaHJvbm91c2x5IGFuZCBhc3luY2hyb25vdXNseSA6LSgKCQkJCQl0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJCQkJdGhpcy5wcmV2aW91cyA9IHByZXZpb3VzOwoJCQkJCQl0aGlzLnNlbGVjdGVkSXRlbSA9IGl0ZW07CgkJCQkJfSk7CgkJCQl9CgoJCQkJaWYgKCBmYWxzZSAhPT0gdGhpcy5fdHJpZ2dlciggInNlbGVjdCIsIGV2ZW50LCB7IGl0ZW06IGl0ZW0gfSApICkgewoJCQkJCXRoaXMuX3ZhbHVlKCBpdGVtLnZhbHVlICk7CgkJCQl9CgkJCQkvLyByZXNldCB0aGUgdGVybSBhZnRlciB0aGUgc2VsZWN0IGV2ZW50CgkJCQkvLyB0aGlzIGFsbG93cyBjdXN0b20gc2VsZWN0IGhhbmRsaW5nIHRvIHdvcmsgcHJvcGVybHkKCQkJCXRoaXMudGVybSA9IHRoaXMuX3ZhbHVlKCk7CgoJCQkJdGhpcy5jbG9zZSggZXZlbnQgKTsKCQkJCXRoaXMuc2VsZWN0ZWRJdGVtID0gaXRlbTsKCQkJfQoJCX0pOwoKCQl0aGlzLmxpdmVSZWdpb24gPSAkKCAiPHNwYW4+IiwgewoJCQkJcm9sZTogInN0YXR1cyIsCgkJCQkiYXJpYS1saXZlIjogInBvbGl0ZSIKCQkJfSkKCQkJLmFkZENsYXNzKCAidWktaGVscGVyLWhpZGRlbi1hY2Nlc3NpYmxlIiApCgkJCS5pbnNlcnRCZWZvcmUoIHRoaXMuZWxlbWVudCApOwoKCQkvLyB0dXJuaW5nIG9mZiBhdXRvY29tcGxldGUgcHJldmVudHMgdGhlIGJyb3dzZXIgZnJvbSByZW1lbWJlcmluZyB0aGUKCQkvLyB2YWx1ZSB3aGVuIG5hdmlnYXRpbmcgdGhyb3VnaCBoaXN0b3J5LCBzbyB3ZSByZS1lbmFibGUgYXV0b2NvbXBsZXRlCgkJLy8gaWYgdGhlIHBhZ2UgaXMgdW5sb2FkZWQgYmVmb3JlIHRoZSB3aWRnZXQgaXMgZGVzdHJveWVkLiAjNzc5MAoJCXRoaXMuX29uKCB0aGlzLndpbmRvdywgewoJCQliZWZvcmV1bmxvYWQ6IGZ1bmN0aW9uKCkgewoJCQkJdGhpcy5lbGVtZW50LnJlbW92ZUF0dHIoICJhdXRvY29tcGxldGUiICk7CgkJCX0KCQl9KTsKCX0sCgoJX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewoJCWNsZWFyVGltZW91dCggdGhpcy5zZWFyY2hpbmcgKTsKCQl0aGlzLmVsZW1lbnQKCQkJLnJlbW92ZUNsYXNzKCAidWktYXV0b2NvbXBsZXRlLWlucHV0IiApCgkJCS5yZW1vdmVBdHRyKCAiYXV0b2NvbXBsZXRlIiApOwoJCXRoaXMubWVudS5lbGVtZW50LnJlbW92ZSgpOwoJCXRoaXMubGl2ZVJlZ2lvbi5yZW1vdmUoKTsKCX0sCgoJX3NldE9wdGlvbjogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJdGhpcy5fc3VwZXIoIGtleSwgdmFsdWUgKTsKCQlpZiAoIGtleSA9PT0gInNvdXJjZSIgKSB7CgkJCXRoaXMuX2luaXRTb3VyY2UoKTsKCQl9CgkJaWYgKCBrZXkgPT09ICJhcHBlbmRUbyIgKSB7CgkJCXRoaXMubWVudS5lbGVtZW50LmFwcGVuZFRvKCB0aGlzLl9hcHBlbmRUbygpICk7CgkJfQoJCWlmICgga2V5ID09PSAiZGlzYWJsZWQiICYmIHZhbHVlICYmIHRoaXMueGhyICkgewoJCQl0aGlzLnhoci5hYm9ydCgpOwoJCX0KCX0sCgoJX2FwcGVuZFRvOiBmdW5jdGlvbigpIHsKCQl2YXIgZWxlbWVudCA9IHRoaXMub3B0aW9ucy5hcHBlbmRUbzsKCgkJaWYgKCBlbGVtZW50ICkgewoJCQllbGVtZW50ID0gZWxlbWVudC5qcXVlcnkgfHwgZWxlbWVudC5ub2RlVHlwZSA/CgkJCQkkKCBlbGVtZW50ICkgOgoJCQkJdGhpcy5kb2N1bWVudC5maW5kKCBlbGVtZW50ICkuZXEoIDAgKTsKCQl9CgoJCWlmICggIWVsZW1lbnQgKSB7CgkJCWVsZW1lbnQgPSB0aGlzLmVsZW1lbnQuY2xvc2VzdCggIi51aS1mcm9udCIgKTsKCQl9CgoJCWlmICggIWVsZW1lbnQubGVuZ3RoICkgewoJCQllbGVtZW50ID0gdGhpcy5kb2N1bWVudFswXS5ib2R5OwoJCX0KCgkJcmV0dXJuIGVsZW1lbnQ7Cgl9LAoKCV9pbml0U291cmNlOiBmdW5jdGlvbigpIHsKCQl2YXIgYXJyYXksIHVybCwKCQkJdGhhdCA9IHRoaXM7CgkJaWYgKCAkLmlzQXJyYXkodGhpcy5vcHRpb25zLnNvdXJjZSkgKSB7CgkJCWFycmF5ID0gdGhpcy5vcHRpb25zLnNvdXJjZTsKCQkJdGhpcy5zb3VyY2UgPSBmdW5jdGlvbiggcmVxdWVzdCwgcmVzcG9uc2UgKSB7CgkJCQlyZXNwb25zZSggJC51aS5hdXRvY29tcGxldGUuZmlsdGVyKCBhcnJheSwgcmVxdWVzdC50ZXJtICkgKTsKCQkJfTsKCQl9IGVsc2UgaWYgKCB0eXBlb2YgdGhpcy5vcHRpb25zLnNvdXJjZSA9PT0gInN0cmluZyIgKSB7CgkJCXVybCA9IHRoaXMub3B0aW9ucy5zb3VyY2U7CgkJCXRoaXMuc291cmNlID0gZnVuY3Rpb24oIHJlcXVlc3QsIHJlc3BvbnNlICkgewoJCQkJaWYgKCB0aGF0LnhociApIHsKCQkJCQl0aGF0Lnhoci5hYm9ydCgpOwoJCQkJfQoJCQkJdGhhdC54aHIgPSAkLmFqYXgoewoJCQkJCXVybDogdXJsLAoJCQkJCWRhdGE6IHJlcXVlc3QsCgkJCQkJZGF0YVR5cGU6ICJqc29uIiwKCQkJCQlzdWNjZXNzOiBmdW5jdGlvbiggZGF0YSApIHsKCQkJCQkJcmVzcG9uc2UoIGRhdGEgKTsKCQkJCQl9LAoJCQkJCWVycm9yOiBmdW5jdGlvbigpIHsKCQkJCQkJcmVzcG9uc2UoIFtdICk7CgkJCQkJfQoJCQkJfSk7CgkJCX07CgkJfSBlbHNlIHsKCQkJdGhpcy5zb3VyY2UgPSB0aGlzLm9wdGlvbnMuc291cmNlOwoJCX0KCX0sCgoJX3NlYXJjaFRpbWVvdXQ6IGZ1bmN0aW9uKCBldmVudCApIHsKCQljbGVhclRpbWVvdXQoIHRoaXMuc2VhcmNoaW5nICk7CgkJdGhpcy5zZWFyY2hpbmcgPSB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJLy8gb25seSBzZWFyY2ggaWYgdGhlIHZhbHVlIGhhcyBjaGFuZ2VkCgkJCWlmICggdGhpcy50ZXJtICE9PSB0aGlzLl92YWx1ZSgpICkgewoJCQkJdGhpcy5zZWxlY3RlZEl0ZW0gPSBudWxsOwoJCQkJdGhpcy5zZWFyY2goIG51bGwsIGV2ZW50ICk7CgkJCX0KCQl9LCB0aGlzLm9wdGlvbnMuZGVsYXkgKTsKCX0sCgoJc2VhcmNoOiBmdW5jdGlvbiggdmFsdWUsIGV2ZW50ICkgewoJCXZhbHVlID0gdmFsdWUgIT0gbnVsbCA/IHZhbHVlIDogdGhpcy5fdmFsdWUoKTsKCgkJLy8gYWx3YXlzIHNhdmUgdGhlIGFjdHVhbCB2YWx1ZSwgbm90IHRoZSBvbmUgcGFzc2VkIGFzIGFuIGFyZ3VtZW50CgkJdGhpcy50ZXJtID0gdGhpcy5fdmFsdWUoKTsKCgkJaWYgKCB2YWx1ZS5sZW5ndGggPCB0aGlzLm9wdGlvbnMubWluTGVuZ3RoICkgewoJCQlyZXR1cm4gdGhpcy5jbG9zZSggZXZlbnQgKTsKCQl9CgoJCWlmICggdGhpcy5fdHJpZ2dlciggInNlYXJjaCIsIGV2ZW50ICkgPT09IGZhbHNlICkgewoJCQlyZXR1cm47CgkJfQoKCQlyZXR1cm4gdGhpcy5fc2VhcmNoKCB2YWx1ZSApOwoJfSwKCglfc2VhcmNoOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdGhpcy5wZW5kaW5nKys7CgkJdGhpcy5lbGVtZW50LmFkZENsYXNzKCAidWktYXV0b2NvbXBsZXRlLWxvYWRpbmciICk7CgkJdGhpcy5jYW5jZWxTZWFyY2ggPSBmYWxzZTsKCgkJdGhpcy5zb3VyY2UoIHsgdGVybTogdmFsdWUgfSwgdGhpcy5fcmVzcG9uc2UoKSApOwoJfSwKCglfcmVzcG9uc2U6IGZ1bmN0aW9uKCkgewoJCXZhciBpbmRleCA9ICsrdGhpcy5yZXF1ZXN0SW5kZXg7CgoJCXJldHVybiAkLnByb3h5KGZ1bmN0aW9uKCBjb250ZW50ICkgewoJCQlpZiAoIGluZGV4ID09PSB0aGlzLnJlcXVlc3RJbmRleCApIHsKCQkJCXRoaXMuX19yZXNwb25zZSggY29udGVudCApOwoJCQl9CgoJCQl0aGlzLnBlbmRpbmctLTsKCQkJaWYgKCAhdGhpcy5wZW5kaW5nICkgewoJCQkJdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCAidWktYXV0b2NvbXBsZXRlLWxvYWRpbmciICk7CgkJCX0KCQl9LCB0aGlzICk7Cgl9LAoKCV9fcmVzcG9uc2U6IGZ1bmN0aW9uKCBjb250ZW50ICkgewoJCWlmICggY29udGVudCApIHsKCQkJY29udGVudCA9IHRoaXMuX25vcm1hbGl6ZSggY29udGVudCApOwoJCX0KCQl0aGlzLl90cmlnZ2VyKCAicmVzcG9uc2UiLCBudWxsLCB7IGNvbnRlbnQ6IGNvbnRlbnQgfSApOwoJCWlmICggIXRoaXMub3B0aW9ucy5kaXNhYmxlZCAmJiBjb250ZW50ICYmIGNvbnRlbnQubGVuZ3RoICYmICF0aGlzLmNhbmNlbFNlYXJjaCApIHsKCQkJdGhpcy5fc3VnZ2VzdCggY29udGVudCApOwoJCQl0aGlzLl90cmlnZ2VyKCAib3BlbiIgKTsKCQl9IGVsc2UgewoJCQkvLyB1c2UgLl9jbG9zZSgpIGluc3RlYWQgb2YgLmNsb3NlKCkgc28gd2UgZG9uJ3QgY2FuY2VsIGZ1dHVyZSBzZWFyY2hlcwoJCQl0aGlzLl9jbG9zZSgpOwoJCX0KCX0sCgoJY2xvc2U6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl0aGlzLmNhbmNlbFNlYXJjaCA9IHRydWU7CgkJdGhpcy5fY2xvc2UoIGV2ZW50ICk7Cgl9LAoKCV9jbG9zZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCWlmICggdGhpcy5tZW51LmVsZW1lbnQuaXMoICI6dmlzaWJsZSIgKSApIHsKCQkJdGhpcy5tZW51LmVsZW1lbnQuaGlkZSgpOwoJCQl0aGlzLm1lbnUuYmx1cigpOwoJCQl0aGlzLmlzTmV3TWVudSA9IHRydWU7CgkJCXRoaXMuX3RyaWdnZXIoICJjbG9zZSIsIGV2ZW50ICk7CgkJfQoJfSwKCglfY2hhbmdlOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCB0aGlzLnByZXZpb3VzICE9PSB0aGlzLl92YWx1ZSgpICkgewoJCQl0aGlzLl90cmlnZ2VyKCAiY2hhbmdlIiwgZXZlbnQsIHsgaXRlbTogdGhpcy5zZWxlY3RlZEl0ZW0gfSApOwoJCX0KCX0sCgoJX25vcm1hbGl6ZTogZnVuY3Rpb24oIGl0ZW1zICkgewoJCS8vIGFzc3VtZSBhbGwgaXRlbXMgaGF2ZSB0aGUgcmlnaHQgZm9ybWF0IHdoZW4gdGhlIGZpcnN0IGl0ZW0gaXMgY29tcGxldGUKCQlpZiAoIGl0ZW1zLmxlbmd0aCAmJiBpdGVtc1swXS5sYWJlbCAmJiBpdGVtc1swXS52YWx1ZSApIHsKCQkJcmV0dXJuIGl0ZW1zOwoJCX0KCQlyZXR1cm4gJC5tYXAoIGl0ZW1zLCBmdW5jdGlvbiggaXRlbSApIHsKCQkJaWYgKCB0eXBlb2YgaXRlbSA9PT0gInN0cmluZyIgKSB7CgkJCQlyZXR1cm4gewoJCQkJCWxhYmVsOiBpdGVtLAoJCQkJCXZhbHVlOiBpdGVtCgkJCQl9OwoJCQl9CgkJCXJldHVybiAkLmV4dGVuZCh7CgkJCQlsYWJlbDogaXRlbS5sYWJlbCB8fCBpdGVtLnZhbHVlLAoJCQkJdmFsdWU6IGl0ZW0udmFsdWUgfHwgaXRlbS5sYWJlbAoJCQl9LCBpdGVtICk7CgkJfSk7Cgl9LAoKCV9zdWdnZXN0OiBmdW5jdGlvbiggaXRlbXMgKSB7CgkJdmFyIHVsID0gdGhpcy5tZW51LmVsZW1lbnQuZW1wdHkoKTsKCQl0aGlzLl9yZW5kZXJNZW51KCB1bCwgaXRlbXMgKTsKCQl0aGlzLmlzTmV3TWVudSA9IHRydWU7CgkJdGhpcy5tZW51LnJlZnJlc2goKTsKCgkJLy8gc2l6ZSBhbmQgcG9zaXRpb24gbWVudQoJCXVsLnNob3coKTsKCQl0aGlzLl9yZXNpemVNZW51KCk7CgkJdWwucG9zaXRpb24oICQuZXh0ZW5kKHsKCQkJb2Y6IHRoaXMuZWxlbWVudAoJCX0sIHRoaXMub3B0aW9ucy5wb3NpdGlvbiApKTsKCgkJaWYgKCB0aGlzLm9wdGlvbnMuYXV0b0ZvY3VzICkgewoJCQl0aGlzLm1lbnUubmV4dCgpOwoJCX0KCX0sCgoJX3Jlc2l6ZU1lbnU6IGZ1bmN0aW9uKCkgewoJCXZhciB1bCA9IHRoaXMubWVudS5lbGVtZW50OwoJCXVsLm91dGVyV2lkdGgoIE1hdGgubWF4KAoJCQkvLyBGaXJlZm94IHdyYXBzIGxvbmcgdGV4dCAocG9zc2libHkgYSByb3VuZGluZyBidWcpCgkJCS8vIHNvIHdlIGFkZCAxcHggdG8gYXZvaWQgdGhlIHdyYXBwaW5nICgjNzUxMykKCQkJdWwud2lkdGgoICIiICkub3V0ZXJXaWR0aCgpICsgMSwKCQkJdGhpcy5lbGVtZW50Lm91dGVyV2lkdGgoKQoJCSkgKTsKCX0sCgoJX3JlbmRlck1lbnU6IGZ1bmN0aW9uKCB1bCwgaXRlbXMgKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoJCSQuZWFjaCggaXRlbXMsIGZ1bmN0aW9uKCBpbmRleCwgaXRlbSApIHsKCQkJdGhhdC5fcmVuZGVySXRlbURhdGEoIHVsLCBpdGVtICk7CgkJfSk7Cgl9LAoKCV9yZW5kZXJJdGVtRGF0YTogZnVuY3Rpb24oIHVsLCBpdGVtICkgewoJCXJldHVybiB0aGlzLl9yZW5kZXJJdGVtKCB1bCwgaXRlbSApLmRhdGEoICJ1aS1hdXRvY29tcGxldGUtaXRlbSIsIGl0ZW0gKTsKCX0sCgoJX3JlbmRlckl0ZW06IGZ1bmN0aW9uKCB1bCwgaXRlbSApIHsKCQlyZXR1cm4gJCggIjxsaT4iICkKCQkJLmFwcGVuZCggJCggIjxhPiIgKS50ZXh0KCBpdGVtLmxhYmVsICkgKQoJCQkuYXBwZW5kVG8oIHVsICk7Cgl9LAoKCV9tb3ZlOiBmdW5jdGlvbiggZGlyZWN0aW9uLCBldmVudCApIHsKCQlpZiAoICF0aGlzLm1lbnUuZWxlbWVudC5pcyggIjp2aXNpYmxlIiApICkgewoJCQl0aGlzLnNlYXJjaCggbnVsbCwgZXZlbnQgKTsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoIHRoaXMubWVudS5pc0ZpcnN0SXRlbSgpICYmIC9ecHJldmlvdXMvLnRlc3QoIGRpcmVjdGlvbiApIHx8CgkJCQl0aGlzLm1lbnUuaXNMYXN0SXRlbSgpICYmIC9ebmV4dC8udGVzdCggZGlyZWN0aW9uICkgKSB7CgkJCXRoaXMuX3ZhbHVlKCB0aGlzLnRlcm0gKTsKCQkJdGhpcy5tZW51LmJsdXIoKTsKCQkJcmV0dXJuOwoJCX0KCQl0aGlzLm1lbnVbIGRpcmVjdGlvbiBdKCBldmVudCApOwoJfSwKCgl3aWRnZXQ6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLm1lbnUuZWxlbWVudDsKCX0sCgoJX3ZhbHVlOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy52YWx1ZU1ldGhvZC5hcHBseSggdGhpcy5lbGVtZW50LCBhcmd1bWVudHMgKTsKCX0sCgoJX2tleUV2ZW50OiBmdW5jdGlvbigga2V5RXZlbnQsIGV2ZW50ICkgewoJCWlmICggIXRoaXMuaXNNdWx0aUxpbmUgfHwgdGhpcy5tZW51LmVsZW1lbnQuaXMoICI6dmlzaWJsZSIgKSApIHsKCQkJdGhpcy5fbW92ZSgga2V5RXZlbnQsIGV2ZW50ICk7CgoJCQkvLyBwcmV2ZW50cyBtb3ZpbmcgY3Vyc29yIHRvIGJlZ2lubmluZy9lbmQgb2YgdGhlIHRleHQgZmllbGQgaW4gc29tZSBicm93c2VycwoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCX0KCX0KfSk7CgokLmV4dGVuZCggJC51aS5hdXRvY29tcGxldGUsIHsKCWVzY2FwZVJlZ2V4OiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJcmV0dXJuIHZhbHVlLnJlcGxhY2UoL1tcLVxbXF17fSgpKis/LixcXFxeJHwjXHNdL2csICJcXCQmIik7Cgl9LAoJZmlsdGVyOiBmdW5jdGlvbihhcnJheSwgdGVybSkgewoJCXZhciBtYXRjaGVyID0gbmV3IFJlZ0V4cCggJC51aS5hdXRvY29tcGxldGUuZXNjYXBlUmVnZXgodGVybSksICJpIiApOwoJCXJldHVybiAkLmdyZXAoIGFycmF5LCBmdW5jdGlvbih2YWx1ZSkgewoJCQlyZXR1cm4gbWF0Y2hlci50ZXN0KCB2YWx1ZS5sYWJlbCB8fCB2YWx1ZS52YWx1ZSB8fCB2YWx1ZSApOwoJCX0pOwoJfQp9KTsKCgovLyBsaXZlIHJlZ2lvbiBleHRlbnNpb24sIGFkZGluZyBhIGBtZXNzYWdlc2Agb3B0aW9uCi8vIE5PVEU6IFRoaXMgaXMgYW4gZXhwZXJpbWVudGFsIEFQSS4gV2UgYXJlIHN0aWxsIGludmVzdGlnYXRpbmcKLy8gYSBmdWxsIHNvbHV0aW9uIGZvciBzdHJpbmcgbWFuaXB1bGF0aW9uIGFuZCBpbnRlcm5hdGlvbmFsaXphdGlvbi4KJC53aWRnZXQoICJ1aS5hdXRvY29tcGxldGUiLCAkLnVpLmF1dG9jb21wbGV0ZSwgewoJb3B0aW9uczogewoJCW1lc3NhZ2VzOiB7CgkJCW5vUmVzdWx0czogIk5vIHNlYXJjaCByZXN1bHRzLiIsCgkJCXJlc3VsdHM6IGZ1bmN0aW9uKCBhbW91bnQgKSB7CgkJCQlyZXR1cm4gYW1vdW50ICsgKCBhbW91bnQgPiAxID8gIiByZXN1bHRzIGFyZSIgOiAiIHJlc3VsdCBpcyIgKSArCgkJCQkJIiBhdmFpbGFibGUsIHVzZSB1cCBhbmQgZG93biBhcnJvdyBrZXlzIHRvIG5hdmlnYXRlLiI7CgkJCX0KCQl9Cgl9LAoKCV9fcmVzcG9uc2U6IGZ1bmN0aW9uKCBjb250ZW50ICkgewoJCXZhciBtZXNzYWdlOwoJCXRoaXMuX3N1cGVyQXBwbHkoIGFyZ3VtZW50cyApOwoJCWlmICggdGhpcy5vcHRpb25zLmRpc2FibGVkIHx8IHRoaXMuY2FuY2VsU2VhcmNoICkgewoJCQlyZXR1cm47CgkJfQoJCWlmICggY29udGVudCAmJiBjb250ZW50Lmxlbmd0aCApIHsKCQkJbWVzc2FnZSA9IHRoaXMub3B0aW9ucy5tZXNzYWdlcy5yZXN1bHRzKCBjb250ZW50Lmxlbmd0aCApOwoJCX0gZWxzZSB7CgkJCW1lc3NhZ2UgPSB0aGlzLm9wdGlvbnMubWVzc2FnZXMubm9SZXN1bHRzOwoJCX0KCQl0aGlzLmxpdmVSZWdpb24udGV4dCggbWVzc2FnZSApOwoJfQp9KTsKCn0oIGpRdWVyeSApKTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKdmFyIGxhc3RBY3RpdmUsCgliYXNlQ2xhc3NlcyA9ICJ1aS1idXR0b24gdWktd2lkZ2V0IHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbCIsCgl0eXBlQ2xhc3NlcyA9ICJ1aS1idXR0b24taWNvbnMtb25seSB1aS1idXR0b24taWNvbi1vbmx5IHVpLWJ1dHRvbi10ZXh0LWljb25zIHVpLWJ1dHRvbi10ZXh0LWljb24tcHJpbWFyeSB1aS1idXR0b24tdGV4dC1pY29uLXNlY29uZGFyeSB1aS1idXR0b24tdGV4dC1vbmx5IiwKCWZvcm1SZXNldEhhbmRsZXIgPSBmdW5jdGlvbigpIHsKCQl2YXIgZm9ybSA9ICQoIHRoaXMgKTsKCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewoJCQlmb3JtLmZpbmQoICI6dWktYnV0dG9uIiApLmJ1dHRvbiggInJlZnJlc2giICk7CgkJfSwgMSApOwoJfSwKCXJhZGlvR3JvdXAgPSBmdW5jdGlvbiggcmFkaW8gKSB7CgkJdmFyIG5hbWUgPSByYWRpby5uYW1lLAoJCQlmb3JtID0gcmFkaW8uZm9ybSwKCQkJcmFkaW9zID0gJCggW10gKTsKCQlpZiAoIG5hbWUgKSB7CgkJCW5hbWUgPSBuYW1lLnJlcGxhY2UoIC8nL2csICJcXCciICk7CgkJCWlmICggZm9ybSApIHsKCQkJCXJhZGlvcyA9ICQoIGZvcm0gKS5maW5kKCAiW25hbWU9JyIgKyBuYW1lICsgIiddIiApOwoJCQl9IGVsc2UgewoJCQkJcmFkaW9zID0gJCggIltuYW1lPSciICsgbmFtZSArICInXSIsIHJhZGlvLm93bmVyRG9jdW1lbnQgKQoJCQkJCS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCQkJCXJldHVybiAhdGhpcy5mb3JtOwoJCQkJCX0pOwoJCQl9CgkJfQoJCXJldHVybiByYWRpb3M7Cgl9OwoKJC53aWRnZXQoICJ1aS5idXR0b24iLCB7Cgl2ZXJzaW9uOiAiMS4xMC40IiwKCWRlZmF1bHRFbGVtZW50OiAiPGJ1dHRvbj4iLAoJb3B0aW9uczogewoJCWRpc2FibGVkOiBudWxsLAoJCXRleHQ6IHRydWUsCgkJbGFiZWw6IG51bGwsCgkJaWNvbnM6IHsKCQkJcHJpbWFyeTogbnVsbCwKCQkJc2Vjb25kYXJ5OiBudWxsCgkJfQoJfSwKCV9jcmVhdGU6IGZ1bmN0aW9uKCkgewoJCXRoaXMuZWxlbWVudC5jbG9zZXN0KCAiZm9ybSIgKQoJCQkudW5iaW5kKCAicmVzZXQiICsgdGhpcy5ldmVudE5hbWVzcGFjZSApCgkJCS5iaW5kKCAicmVzZXQiICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZm9ybVJlc2V0SGFuZGxlciApOwoKCQlpZiAoIHR5cGVvZiB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgIT09ICJib29sZWFuIiApIHsKCQkJdGhpcy5vcHRpb25zLmRpc2FibGVkID0gISF0aGlzLmVsZW1lbnQucHJvcCggImRpc2FibGVkIiApOwoJCX0gZWxzZSB7CgkJCXRoaXMuZWxlbWVudC5wcm9wKCAiZGlzYWJsZWQiLCB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgKTsKCQl9CgoJCXRoaXMuX2RldGVybWluZUJ1dHRvblR5cGUoKTsKCQl0aGlzLmhhc1RpdGxlID0gISF0aGlzLmJ1dHRvbkVsZW1lbnQuYXR0ciggInRpdGxlIiApOwoKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCW9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCgkJCXRvZ2dsZUJ1dHRvbiA9IHRoaXMudHlwZSA9PT0gImNoZWNrYm94IiB8fCB0aGlzLnR5cGUgPT09ICJyYWRpbyIsCgkJCWFjdGl2ZUNsYXNzID0gIXRvZ2dsZUJ1dHRvbiA/ICJ1aS1zdGF0ZS1hY3RpdmUiIDogIiI7CgoJCWlmICggb3B0aW9ucy5sYWJlbCA9PT0gbnVsbCApIHsKCQkJb3B0aW9ucy5sYWJlbCA9ICh0aGlzLnR5cGUgPT09ICJpbnB1dCIgPyB0aGlzLmJ1dHRvbkVsZW1lbnQudmFsKCkgOiB0aGlzLmJ1dHRvbkVsZW1lbnQuaHRtbCgpKTsKCQl9CgoJCXRoaXMuX2hvdmVyYWJsZSggdGhpcy5idXR0b25FbGVtZW50ICk7CgoJCXRoaXMuYnV0dG9uRWxlbWVudAoJCQkuYWRkQ2xhc3MoIGJhc2VDbGFzc2VzICkKCQkJLmF0dHIoICJyb2xlIiwgImJ1dHRvbiIgKQoJCQkuYmluZCggIm1vdXNlZW50ZXIiICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24oKSB7CgkJCQlpZiAoIG9wdGlvbnMuZGlzYWJsZWQgKSB7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJaWYgKCB0aGlzID09PSBsYXN0QWN0aXZlICkgewoJCQkJCSQoIHRoaXMgKS5hZGRDbGFzcyggInVpLXN0YXRlLWFjdGl2ZSIgKTsKCQkJCX0KCQkJfSkKCQkJLmJpbmQoICJtb3VzZWxlYXZlIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBvcHRpb25zLmRpc2FibGVkICkgewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCSQoIHRoaXMgKS5yZW1vdmVDbGFzcyggYWN0aXZlQ2xhc3MgKTsKCQkJfSkKCQkJLmJpbmQoICJjbGljayIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlpZiAoIG9wdGlvbnMuZGlzYWJsZWQgKSB7CgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQlldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCQkJCX0KCQkJfSk7CgoJCS8vIENhbid0IHVzZSBfZm9jdXNhYmxlKCkgYmVjYXVzZSB0aGUgZWxlbWVudCB0aGF0IHJlY2VpdmVzIGZvY3VzCgkJLy8gYW5kIHRoZSBlbGVtZW50IHRoYXQgZ2V0cyB0aGUgdWktc3RhdGUtZm9jdXMgY2xhc3MgYXJlIGRpZmZlcmVudAoJCXRoaXMuX29uKHsKCQkJZm9jdXM6IGZ1bmN0aW9uKCkgewoJCQkJdGhpcy5idXR0b25FbGVtZW50LmFkZENsYXNzKCAidWktc3RhdGUtZm9jdXMiICk7CgkJCX0sCgkJCWJsdXI6IGZ1bmN0aW9uKCkgewoJCQkJdGhpcy5idXR0b25FbGVtZW50LnJlbW92ZUNsYXNzKCAidWktc3RhdGUtZm9jdXMiICk7CgkJCX0KCQl9KTsKCgkJaWYgKCB0b2dnbGVCdXR0b24gKSB7CgkJCXRoaXMuZWxlbWVudC5iaW5kKCAiY2hhbmdlIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKCkgewoJCQkJdGhhdC5yZWZyZXNoKCk7CgkJCX0pOwoJCX0KCgkJaWYgKCB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgKSB7CgkJCXRoaXMuYnV0dG9uRWxlbWVudC5iaW5kKCAiY2xpY2siICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24oKSB7CgkJCQlpZiAoIG9wdGlvbnMuZGlzYWJsZWQgKSB7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9KTsKCQl9IGVsc2UgaWYgKCB0aGlzLnR5cGUgPT09ICJyYWRpbyIgKSB7CgkJCXRoaXMuYnV0dG9uRWxlbWVudC5iaW5kKCAiY2xpY2siICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24oKSB7CgkJCQlpZiAoIG9wdGlvbnMuZGlzYWJsZWQgKSB7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQkJJCggdGhpcyApLmFkZENsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApOwoJCQkJdGhhdC5idXR0b25FbGVtZW50LmF0dHIoICJhcmlhLXByZXNzZWQiLCAidHJ1ZSIgKTsKCgkJCQl2YXIgcmFkaW8gPSB0aGF0LmVsZW1lbnRbIDAgXTsKCQkJCXJhZGlvR3JvdXAoIHJhZGlvICkKCQkJCQkubm90KCByYWRpbyApCgkJCQkJLm1hcChmdW5jdGlvbigpIHsKCQkJCQkJcmV0dXJuICQoIHRoaXMgKS5idXR0b24oICJ3aWRnZXQiIClbIDAgXTsKCQkJCQl9KQoJCQkJCS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWFjdGl2ZSIgKQoJCQkJCS5hdHRyKCAiYXJpYS1wcmVzc2VkIiwgImZhbHNlIiApOwoJCQl9KTsKCQl9IGVsc2UgewoJCQl0aGlzLmJ1dHRvbkVsZW1lbnQKCQkJCS5iaW5kKCAibW91c2Vkb3duIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKCkgewoJCQkJCWlmICggb3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCQkkKCB0aGlzICkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICk7CgkJCQkJbGFzdEFjdGl2ZSA9IHRoaXM7CgkJCQkJdGhhdC5kb2N1bWVudC5vbmUoICJtb3VzZXVwIiwgZnVuY3Rpb24oKSB7CgkJCQkJCWxhc3RBY3RpdmUgPSBudWxsOwoJCQkJCX0pOwoJCQkJfSkKCQkJCS5iaW5kKCAibW91c2V1cCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbigpIHsKCQkJCQlpZiAoIG9wdGlvbnMuZGlzYWJsZWQgKSB7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgkJCQkJJCggdGhpcyApLnJlbW92ZUNsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApOwoJCQkJfSkKCQkJCS5iaW5kKCAia2V5ZG93biIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbihldmVudCkgewoJCQkJCWlmICggb3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCQlpZiAoIGV2ZW50LmtleUNvZGUgPT09ICQudWkua2V5Q29kZS5TUEFDRSB8fCBldmVudC5rZXlDb2RlID09PSAkLnVpLmtleUNvZGUuRU5URVIgKSB7CgkJCQkJCSQoIHRoaXMgKS5hZGRDbGFzcyggInVpLXN0YXRlLWFjdGl2ZSIgKTsKCQkJCQl9CgkJCQl9KQoJCQkJLy8gc2VlICM4NTU5LCB3ZSBiaW5kIHRvIGJsdXIgaGVyZSBpbiBjYXNlIHRoZSBidXR0b24gZWxlbWVudCBsb3NlcwoJCQkJLy8gZm9jdXMgYmV0d2VlbiBrZXlkb3duIGFuZCBrZXl1cCwgaXQgd291bGQgYmUgbGVmdCBpbiBhbiAiYWN0aXZlIiBzdGF0ZQoJCQkJLmJpbmQoICJrZXl1cCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlICsgIiBibHVyIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKCkgewoJCQkJCSQoIHRoaXMgKS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWFjdGl2ZSIgKTsKCQkJCX0pOwoKCQkJaWYgKCB0aGlzLmJ1dHRvbkVsZW1lbnQuaXMoImEiKSApIHsKCQkJCXRoaXMuYnV0dG9uRWxlbWVudC5rZXl1cChmdW5jdGlvbihldmVudCkgewoJCQkJCWlmICggZXZlbnQua2V5Q29kZSA9PT0gJC51aS5rZXlDb2RlLlNQQUNFICkgewoJCQkJCQkvLyBUT0RPIHBhc3MgdGhyb3VnaCBvcmlnaW5hbCBldmVudCBjb3JyZWN0bHkgKGp1c3QgYXMgMm5kIGFyZ3VtZW50IGRvZXNuJ3Qgd29yaykKCQkJCQkJJCggdGhpcyApLmNsaWNrKCk7CgkJCQkJfQoJCQkJfSk7CgkJCX0KCQl9CgoJCS8vIFRPRE86IHB1bGwgb3V0ICQuV2lkZ2V0J3MgaGFuZGxpbmcgZm9yIHRoZSBkaXNhYmxlZCBvcHRpb24gaW50bwoJCS8vICQuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uRGlzYWJsZWQgc28gaXQncyBlYXN5IHRvIHByb3h5IGFuZCBjYW4KCQkvLyBiZSBvdmVycmlkZGVuIGJ5IGluZGl2aWR1YWwgcGx1Z2lucwoJCXRoaXMuX3NldE9wdGlvbiggImRpc2FibGVkIiwgb3B0aW9ucy5kaXNhYmxlZCApOwoJCXRoaXMuX3Jlc2V0QnV0dG9uKCk7Cgl9LAoKCV9kZXRlcm1pbmVCdXR0b25UeXBlOiBmdW5jdGlvbigpIHsKCQl2YXIgYW5jZXN0b3IsIGxhYmVsU2VsZWN0b3IsIGNoZWNrZWQ7CgoJCWlmICggdGhpcy5lbGVtZW50LmlzKCJbdHlwZT1jaGVja2JveF0iKSApIHsKCQkJdGhpcy50eXBlID0gImNoZWNrYm94IjsKCQl9IGVsc2UgaWYgKCB0aGlzLmVsZW1lbnQuaXMoIlt0eXBlPXJhZGlvXSIpICkgewoJCQl0aGlzLnR5cGUgPSAicmFkaW8iOwoJCX0gZWxzZSBpZiAoIHRoaXMuZWxlbWVudC5pcygiaW5wdXQiKSApIHsKCQkJdGhpcy50eXBlID0gImlucHV0IjsKCQl9IGVsc2UgewoJCQl0aGlzLnR5cGUgPSAiYnV0dG9uIjsKCQl9CgoJCWlmICggdGhpcy50eXBlID09PSAiY2hlY2tib3giIHx8IHRoaXMudHlwZSA9PT0gInJhZGlvIiApIHsKCQkJLy8gd2UgZG9uJ3Qgc2VhcmNoIGFnYWluc3QgdGhlIGRvY3VtZW50IGluIGNhc2UgdGhlIGVsZW1lbnQKCQkJLy8gaXMgZGlzY29ubmVjdGVkIGZyb20gdGhlIERPTQoJCQlhbmNlc3RvciA9IHRoaXMuZWxlbWVudC5wYXJlbnRzKCkubGFzdCgpOwoJCQlsYWJlbFNlbGVjdG9yID0gImxhYmVsW2Zvcj0nIiArIHRoaXMuZWxlbWVudC5hdHRyKCJpZCIpICsgIiddIjsKCQkJdGhpcy5idXR0b25FbGVtZW50ID0gYW5jZXN0b3IuZmluZCggbGFiZWxTZWxlY3RvciApOwoJCQlpZiAoICF0aGlzLmJ1dHRvbkVsZW1lbnQubGVuZ3RoICkgewoJCQkJYW5jZXN0b3IgPSBhbmNlc3Rvci5sZW5ndGggPyBhbmNlc3Rvci5zaWJsaW5ncygpIDogdGhpcy5lbGVtZW50LnNpYmxpbmdzKCk7CgkJCQl0aGlzLmJ1dHRvbkVsZW1lbnQgPSBhbmNlc3Rvci5maWx0ZXIoIGxhYmVsU2VsZWN0b3IgKTsKCQkJCWlmICggIXRoaXMuYnV0dG9uRWxlbWVudC5sZW5ndGggKSB7CgkJCQkJdGhpcy5idXR0b25FbGVtZW50ID0gYW5jZXN0b3IuZmluZCggbGFiZWxTZWxlY3RvciApOwoJCQkJfQoJCQl9CgkJCXRoaXMuZWxlbWVudC5hZGRDbGFzcyggInVpLWhlbHBlci1oaWRkZW4tYWNjZXNzaWJsZSIgKTsKCgkJCWNoZWNrZWQgPSB0aGlzLmVsZW1lbnQuaXMoICI6Y2hlY2tlZCIgKTsKCQkJaWYgKCBjaGVja2VkICkgewoJCQkJdGhpcy5idXR0b25FbGVtZW50LmFkZENsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApOwoJCQl9CgkJCXRoaXMuYnV0dG9uRWxlbWVudC5wcm9wKCAiYXJpYS1wcmVzc2VkIiwgY2hlY2tlZCApOwoJCX0gZWxzZSB7CgkJCXRoaXMuYnV0dG9uRWxlbWVudCA9IHRoaXMuZWxlbWVudDsKCQl9Cgl9LAoKCXdpZGdldDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuYnV0dG9uRWxlbWVudDsKCX0sCgoJX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewoJCXRoaXMuZWxlbWVudAoJCQkucmVtb3ZlQ2xhc3MoICJ1aS1oZWxwZXItaGlkZGVuLWFjY2Vzc2libGUiICk7CgkJdGhpcy5idXR0b25FbGVtZW50CgkJCS5yZW1vdmVDbGFzcyggYmFzZUNsYXNzZXMgKyAiIHVpLXN0YXRlLWFjdGl2ZSAiICsgdHlwZUNsYXNzZXMgKQoJCQkucmVtb3ZlQXR0ciggInJvbGUiICkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLXByZXNzZWQiICkKCQkJLmh0bWwoIHRoaXMuYnV0dG9uRWxlbWVudC5maW5kKCIudWktYnV0dG9uLXRleHQiKS5odG1sKCkgKTsKCgkJaWYgKCAhdGhpcy5oYXNUaXRsZSApIHsKCQkJdGhpcy5idXR0b25FbGVtZW50LnJlbW92ZUF0dHIoICJ0aXRsZSIgKTsKCQl9Cgl9LAoKCV9zZXRPcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCXRoaXMuX3N1cGVyKCBrZXksIHZhbHVlICk7CgkJaWYgKCBrZXkgPT09ICJkaXNhYmxlZCIgKSB7CgkJCXRoaXMuZWxlbWVudC5wcm9wKCAiZGlzYWJsZWQiLCAhIXZhbHVlICk7CgkJCWlmICggdmFsdWUgKSB7CgkJCQl0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1mb2N1cyIgKTsKCQkJfQoJCQlyZXR1cm47CgkJfQoJCXRoaXMuX3Jlc2V0QnV0dG9uKCk7Cgl9LAoKCXJlZnJlc2g6IGZ1bmN0aW9uKCkgewoJCS8vU2VlICM4MjM3ICYgIzg4MjgKCQl2YXIgaXNEaXNhYmxlZCA9IHRoaXMuZWxlbWVudC5pcyggImlucHV0LCBidXR0b24iICkgPyB0aGlzLmVsZW1lbnQuaXMoICI6ZGlzYWJsZWQiICkgOiB0aGlzLmVsZW1lbnQuaGFzQ2xhc3MoICJ1aS1idXR0b24tZGlzYWJsZWQiICk7CgoJCWlmICggaXNEaXNhYmxlZCAhPT0gdGhpcy5vcHRpb25zLmRpc2FibGVkICkgewoJCQl0aGlzLl9zZXRPcHRpb24oICJkaXNhYmxlZCIsIGlzRGlzYWJsZWQgKTsKCQl9CgkJaWYgKCB0aGlzLnR5cGUgPT09ICJyYWRpbyIgKSB7CgkJCXJhZGlvR3JvdXAoIHRoaXMuZWxlbWVudFswXSApLmVhY2goZnVuY3Rpb24oKSB7CgkJCQlpZiAoICQoIHRoaXMgKS5pcyggIjpjaGVja2VkIiApICkgewoJCQkJCSQoIHRoaXMgKS5idXR0b24oICJ3aWRnZXQiICkKCQkJCQkJLmFkZENsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApCgkJCQkJCS5hdHRyKCAiYXJpYS1wcmVzc2VkIiwgInRydWUiICk7CgkJCQl9IGVsc2UgewoJCQkJCSQoIHRoaXMgKS5idXR0b24oICJ3aWRnZXQiICkKCQkJCQkJLnJlbW92ZUNsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApCgkJCQkJCS5hdHRyKCAiYXJpYS1wcmVzc2VkIiwgImZhbHNlIiApOwoJCQkJfQoJCQl9KTsKCQl9IGVsc2UgaWYgKCB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgKSB7CgkJCWlmICggdGhpcy5lbGVtZW50LmlzKCAiOmNoZWNrZWQiICkgKSB7CgkJCQl0aGlzLmJ1dHRvbkVsZW1lbnQKCQkJCQkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICkKCQkJCQkuYXR0ciggImFyaWEtcHJlc3NlZCIsICJ0cnVlIiApOwoJCQl9IGVsc2UgewoJCQkJdGhpcy5idXR0b25FbGVtZW50CgkJCQkJLnJlbW92ZUNsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApCgkJCQkJLmF0dHIoICJhcmlhLXByZXNzZWQiLCAiZmFsc2UiICk7CgkJCX0KCQl9Cgl9LAoKCV9yZXNldEJ1dHRvbjogZnVuY3Rpb24oKSB7CgkJaWYgKCB0aGlzLnR5cGUgPT09ICJpbnB1dCIgKSB7CgkJCWlmICggdGhpcy5vcHRpb25zLmxhYmVsICkgewoJCQkJdGhpcy5lbGVtZW50LnZhbCggdGhpcy5vcHRpb25zLmxhYmVsICk7CgkJCX0KCQkJcmV0dXJuOwoJCX0KCQl2YXIgYnV0dG9uRWxlbWVudCA9IHRoaXMuYnV0dG9uRWxlbWVudC5yZW1vdmVDbGFzcyggdHlwZUNsYXNzZXMgKSwKCQkJYnV0dG9uVGV4dCA9ICQoICI8c3Bhbj48L3NwYW4+IiwgdGhpcy5kb2N1bWVudFswXSApCgkJCQkuYWRkQ2xhc3MoICJ1aS1idXR0b24tdGV4dCIgKQoJCQkJLmh0bWwoIHRoaXMub3B0aW9ucy5sYWJlbCApCgkJCQkuYXBwZW5kVG8oIGJ1dHRvbkVsZW1lbnQuZW1wdHkoKSApCgkJCQkudGV4dCgpLAoJCQlpY29ucyA9IHRoaXMub3B0aW9ucy5pY29ucywKCQkJbXVsdGlwbGVJY29ucyA9IGljb25zLnByaW1hcnkgJiYgaWNvbnMuc2Vjb25kYXJ5LAoJCQlidXR0b25DbGFzc2VzID0gW107CgoJCWlmICggaWNvbnMucHJpbWFyeSB8fCBpY29ucy5zZWNvbmRhcnkgKSB7CgkJCWlmICggdGhpcy5vcHRpb25zLnRleHQgKSB7CgkJCQlidXR0b25DbGFzc2VzLnB1c2goICJ1aS1idXR0b24tdGV4dC1pY29uIiArICggbXVsdGlwbGVJY29ucyA/ICJzIiA6ICggaWNvbnMucHJpbWFyeSA/ICItcHJpbWFyeSIgOiAiLXNlY29uZGFyeSIgKSApICk7CgkJCX0KCgkJCWlmICggaWNvbnMucHJpbWFyeSApIHsKCQkJCWJ1dHRvbkVsZW1lbnQucHJlcGVuZCggIjxzcGFuIGNsYXNzPSd1aS1idXR0b24taWNvbi1wcmltYXJ5IHVpLWljb24gIiArIGljb25zLnByaW1hcnkgKyAiJz48L3NwYW4+IiApOwoJCQl9CgoJCQlpZiAoIGljb25zLnNlY29uZGFyeSApIHsKCQkJCWJ1dHRvbkVsZW1lbnQuYXBwZW5kKCAiPHNwYW4gY2xhc3M9J3VpLWJ1dHRvbi1pY29uLXNlY29uZGFyeSB1aS1pY29uICIgKyBpY29ucy5zZWNvbmRhcnkgKyAiJz48L3NwYW4+IiApOwoJCQl9CgoJCQlpZiAoICF0aGlzLm9wdGlvbnMudGV4dCApIHsKCQkJCWJ1dHRvbkNsYXNzZXMucHVzaCggbXVsdGlwbGVJY29ucyA/ICJ1aS1idXR0b24taWNvbnMtb25seSIgOiAidWktYnV0dG9uLWljb24tb25seSIgKTsKCgkJCQlpZiAoICF0aGlzLmhhc1RpdGxlICkgewoJCQkJCWJ1dHRvbkVsZW1lbnQuYXR0ciggInRpdGxlIiwgJC50cmltKCBidXR0b25UZXh0ICkgKTsKCQkJCX0KCQkJfQoJCX0gZWxzZSB7CgkJCWJ1dHRvbkNsYXNzZXMucHVzaCggInVpLWJ1dHRvbi10ZXh0LW9ubHkiICk7CgkJfQoJCWJ1dHRvbkVsZW1lbnQuYWRkQ2xhc3MoIGJ1dHRvbkNsYXNzZXMuam9pbiggIiAiICkgKTsKCX0KfSk7CgokLndpZGdldCggInVpLmJ1dHRvbnNldCIsIHsKCXZlcnNpb246ICIxLjEwLjQiLAoJb3B0aW9uczogewoJCWl0ZW1zOiAiYnV0dG9uLCBpbnB1dFt0eXBlPWJ1dHRvbl0sIGlucHV0W3R5cGU9c3VibWl0XSwgaW5wdXRbdHlwZT1yZXNldF0sIGlucHV0W3R5cGU9Y2hlY2tib3hdLCBpbnB1dFt0eXBlPXJhZGlvXSwgYSwgOmRhdGEodWktYnV0dG9uKSIKCX0sCgoJX2NyZWF0ZTogZnVuY3Rpb24oKSB7CgkJdGhpcy5lbGVtZW50LmFkZENsYXNzKCAidWktYnV0dG9uc2V0IiApOwoJfSwKCglfaW5pdDogZnVuY3Rpb24oKSB7CgkJdGhpcy5yZWZyZXNoKCk7Cgl9LAoKCV9zZXRPcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCWlmICgga2V5ID09PSAiZGlzYWJsZWQiICkgewoJCQl0aGlzLmJ1dHRvbnMuYnV0dG9uKCAib3B0aW9uIiwga2V5LCB2YWx1ZSApOwoJCX0KCgkJdGhpcy5fc3VwZXIoIGtleSwgdmFsdWUgKTsKCX0sCgoJcmVmcmVzaDogZnVuY3Rpb24oKSB7CgkJdmFyIHJ0bCA9IHRoaXMuZWxlbWVudC5jc3MoICJkaXJlY3Rpb24iICkgPT09ICJydGwiOwoKCQl0aGlzLmJ1dHRvbnMgPSB0aGlzLmVsZW1lbnQuZmluZCggdGhpcy5vcHRpb25zLml0ZW1zICkKCQkJLmZpbHRlciggIjp1aS1idXR0b24iICkKCQkJCS5idXR0b24oICJyZWZyZXNoIiApCgkJCS5lbmQoKQoJCQkubm90KCAiOnVpLWJ1dHRvbiIgKQoJCQkJLmJ1dHRvbigpCgkJCS5lbmQoKQoJCQkubWFwKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICQoIHRoaXMgKS5idXR0b24oICJ3aWRnZXQiIClbIDAgXTsKCQkJfSkKCQkJCS5yZW1vdmVDbGFzcyggInVpLWNvcm5lci1hbGwgdWktY29ybmVyLWxlZnQgdWktY29ybmVyLXJpZ2h0IiApCgkJCQkuZmlsdGVyKCAiOmZpcnN0IiApCgkJCQkJLmFkZENsYXNzKCBydGwgPyAidWktY29ybmVyLXJpZ2h0IiA6ICJ1aS1jb3JuZXItbGVmdCIgKQoJCQkJLmVuZCgpCgkJCQkuZmlsdGVyKCAiOmxhc3QiICkKCQkJCQkuYWRkQ2xhc3MoIHJ0bCA/ICJ1aS1jb3JuZXItbGVmdCIgOiAidWktY29ybmVyLXJpZ2h0IiApCgkJCQkuZW5kKCkKCQkJLmVuZCgpOwoJfSwKCglfZGVzdHJveTogZnVuY3Rpb24oKSB7CgkJdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCAidWktYnV0dG9uc2V0IiApOwoJCXRoaXMuYnV0dG9ucwoJCQkubWFwKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICQoIHRoaXMgKS5idXR0b24oICJ3aWRnZXQiIClbIDAgXTsKCQkJfSkKCQkJCS5yZW1vdmVDbGFzcyggInVpLWNvcm5lci1sZWZ0IHVpLWNvcm5lci1yaWdodCIgKQoJCQkuZW5kKCkKCQkJLmJ1dHRvbiggImRlc3Ryb3kiICk7Cgl9Cn0pOwoKfSggalF1ZXJ5ICkgKTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKJC5leHRlbmQoJC51aSwgeyBkYXRlcGlja2VyOiB7IHZlcnNpb246ICIxLjEwLjQiIH0gfSk7Cgp2YXIgUFJPUF9OQU1FID0gImRhdGVwaWNrZXIiLAoJaW5zdEFjdGl2ZTsKCi8qIERhdGUgcGlja2VyIG1hbmFnZXIuCiAgIFVzZSB0aGUgc2luZ2xldG9uIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MsICQuZGF0ZXBpY2tlciwgdG8gaW50ZXJhY3Qgd2l0aCB0aGUgZGF0ZSBwaWNrZXIuCiAgIFNldHRpbmdzIGZvciAoZ3JvdXBzIG9mKSBkYXRlIHBpY2tlcnMgYXJlIG1haW50YWluZWQgaW4gYW4gaW5zdGFuY2Ugb2JqZWN0LAogICBhbGxvd2luZyBtdWx0aXBsZSBkaWZmZXJlbnQgc2V0dGluZ3Mgb24gdGhlIHNhbWUgcGFnZS4gKi8KCmZ1bmN0aW9uIERhdGVwaWNrZXIoKSB7Cgl0aGlzLl9jdXJJbnN0ID0gbnVsbDsgLy8gVGhlIGN1cnJlbnQgaW5zdGFuY2UgaW4gdXNlCgl0aGlzLl9rZXlFdmVudCA9IGZhbHNlOyAvLyBJZiB0aGUgbGFzdCBldmVudCB3YXMgYSBrZXkgZXZlbnQKCXRoaXMuX2Rpc2FibGVkSW5wdXRzID0gW107IC8vIExpc3Qgb2YgZGF0ZSBwaWNrZXIgaW5wdXRzIHRoYXQgaGF2ZSBiZWVuIGRpc2FibGVkCgl0aGlzLl9kYXRlcGlja2VyU2hvd2luZyA9IGZhbHNlOyAvLyBUcnVlIGlmIHRoZSBwb3B1cCBwaWNrZXIgaXMgc2hvd2luZyAsIGZhbHNlIGlmIG5vdAoJdGhpcy5faW5EaWFsb2cgPSBmYWxzZTsgLy8gVHJ1ZSBpZiBzaG93aW5nIHdpdGhpbiBhICJkaWFsb2ciLCBmYWxzZSBpZiBub3QKCXRoaXMuX21haW5EaXZJZCA9ICJ1aS1kYXRlcGlja2VyLWRpdiI7IC8vIFRoZSBJRCBvZiB0aGUgbWFpbiBkYXRlcGlja2VyIGRpdmlzaW9uCgl0aGlzLl9pbmxpbmVDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLWlubGluZSI7IC8vIFRoZSBuYW1lIG9mIHRoZSBpbmxpbmUgbWFya2VyIGNsYXNzCgl0aGlzLl9hcHBlbmRDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLWFwcGVuZCI7IC8vIFRoZSBuYW1lIG9mIHRoZSBhcHBlbmQgbWFya2VyIGNsYXNzCgl0aGlzLl90cmlnZ2VyQ2xhc3MgPSAidWktZGF0ZXBpY2tlci10cmlnZ2VyIjsgLy8gVGhlIG5hbWUgb2YgdGhlIHRyaWdnZXIgbWFya2VyIGNsYXNzCgl0aGlzLl9kaWFsb2dDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLWRpYWxvZyI7IC8vIFRoZSBuYW1lIG9mIHRoZSBkaWFsb2cgbWFya2VyIGNsYXNzCgl0aGlzLl9kaXNhYmxlQ2xhc3MgPSAidWktZGF0ZXBpY2tlci1kaXNhYmxlZCI7IC8vIFRoZSBuYW1lIG9mIHRoZSBkaXNhYmxlZCBjb3ZlcmluZyBtYXJrZXIgY2xhc3MKCXRoaXMuX3Vuc2VsZWN0YWJsZUNsYXNzID0gInVpLWRhdGVwaWNrZXItdW5zZWxlY3RhYmxlIjsgLy8gVGhlIG5hbWUgb2YgdGhlIHVuc2VsZWN0YWJsZSBjZWxsIG1hcmtlciBjbGFzcwoJdGhpcy5fY3VycmVudENsYXNzID0gInVpLWRhdGVwaWNrZXItY3VycmVudC1kYXkiOyAvLyBUaGUgbmFtZSBvZiB0aGUgY3VycmVudCBkYXkgbWFya2VyIGNsYXNzCgl0aGlzLl9kYXlPdmVyQ2xhc3MgPSAidWktZGF0ZXBpY2tlci1kYXlzLWNlbGwtb3ZlciI7IC8vIFRoZSBuYW1lIG9mIHRoZSBkYXkgaG92ZXIgbWFya2VyIGNsYXNzCgl0aGlzLnJlZ2lvbmFsID0gW107IC8vIEF2YWlsYWJsZSByZWdpb25hbCBzZXR0aW5ncywgaW5kZXhlZCBieSBsYW5ndWFnZSBjb2RlCgl0aGlzLnJlZ2lvbmFsWyIiXSA9IHsgLy8gRGVmYXVsdCByZWdpb25hbCBzZXR0aW5ncwoJCWNsb3NlVGV4dDogIkRvbmUiLCAvLyBEaXNwbGF5IHRleHQgZm9yIGNsb3NlIGxpbmsKCQlwcmV2VGV4dDogIlByZXYiLCAvLyBEaXNwbGF5IHRleHQgZm9yIHByZXZpb3VzIG1vbnRoIGxpbmsKCQluZXh0VGV4dDogIk5leHQiLCAvLyBEaXNwbGF5IHRleHQgZm9yIG5leHQgbW9udGggbGluawoJCWN1cnJlbnRUZXh0OiAiVG9kYXkiLCAvLyBEaXNwbGF5IHRleHQgZm9yIGN1cnJlbnQgbW9udGggbGluawoJCW1vbnRoTmFtZXM6IFsiSmFudWFyeSIsIkZlYnJ1YXJ5IiwiTWFyY2giLCJBcHJpbCIsIk1heSIsIkp1bmUiLAoJCQkiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sIC8vIE5hbWVzIG9mIG1vbnRocyBmb3IgZHJvcC1kb3duIGFuZCBmb3JtYXR0aW5nCgkJbW9udGhOYW1lc1Nob3J0OiBbIkphbiIsICJGZWIiLCAiTWFyIiwgIkFwciIsICJNYXkiLCAiSnVuIiwgIkp1bCIsICJBdWciLCAiU2VwIiwgIk9jdCIsICJOb3YiLCAiRGVjIl0sIC8vIEZvciBmb3JtYXR0aW5nCgkJZGF5TmFtZXM6IFsiU3VuZGF5IiwgIk1vbmRheSIsICJUdWVzZGF5IiwgIldlZG5lc2RheSIsICJUaHVyc2RheSIsICJGcmlkYXkiLCAiU2F0dXJkYXkiXSwgLy8gRm9yIGZvcm1hdHRpbmcKCQlkYXlOYW1lc1Nob3J0OiBbIlN1biIsICJNb24iLCAiVHVlIiwgIldlZCIsICJUaHUiLCAiRnJpIiwgIlNhdCJdLCAvLyBGb3IgZm9ybWF0dGluZwoJCWRheU5hbWVzTWluOiBbIlN1IiwiTW8iLCJUdSIsIldlIiwiVGgiLCJGciIsIlNhIl0sIC8vIENvbHVtbiBoZWFkaW5ncyBmb3IgZGF5cyBzdGFydGluZyBhdCBTdW5kYXkKCQl3ZWVrSGVhZGVyOiAiV2siLCAvLyBDb2x1bW4gaGVhZGVyIGZvciB3ZWVrIG9mIHRoZSB5ZWFyCgkJZGF0ZUZvcm1hdDogIm1tL2RkL3l5IiwgLy8gU2VlIGZvcm1hdCBvcHRpb25zIG9uIHBhcnNlRGF0ZQoJCWZpcnN0RGF5OiAwLCAvLyBUaGUgZmlyc3QgZGF5IG9mIHRoZSB3ZWVrLCBTdW4gPSAwLCBNb24gPSAxLCAuLi4KCQlpc1JUTDogZmFsc2UsIC8vIFRydWUgaWYgcmlnaHQtdG8tbGVmdCBsYW5ndWFnZSwgZmFsc2UgaWYgbGVmdC10by1yaWdodAoJCXNob3dNb250aEFmdGVyWWVhcjogZmFsc2UsIC8vIFRydWUgaWYgdGhlIHllYXIgc2VsZWN0IHByZWNlZGVzIG1vbnRoLCBmYWxzZSBmb3IgbW9udGggdGhlbiB5ZWFyCgkJeWVhclN1ZmZpeDogIiIgLy8gQWRkaXRpb25hbCB0ZXh0IHRvIGFwcGVuZCB0byB0aGUgeWVhciBpbiB0aGUgbW9udGggaGVhZGVycwoJfTsKCXRoaXMuX2RlZmF1bHRzID0geyAvLyBHbG9iYWwgZGVmYXVsdHMgZm9yIGFsbCB0aGUgZGF0ZSBwaWNrZXIgaW5zdGFuY2VzCgkJc2hvd09uOiAiZm9jdXMiLCAvLyAiZm9jdXMiIGZvciBwb3B1cCBvbiBmb2N1cywKCQkJLy8gImJ1dHRvbiIgZm9yIHRyaWdnZXIgYnV0dG9uLCBvciAiYm90aCIgZm9yIGVpdGhlcgoJCXNob3dBbmltOiAiZmFkZUluIiwgLy8gTmFtZSBvZiBqUXVlcnkgYW5pbWF0aW9uIGZvciBwb3B1cAoJCXNob3dPcHRpb25zOiB7fSwgLy8gT3B0aW9ucyBmb3IgZW5oYW5jZWQgYW5pbWF0aW9ucwoJCWRlZmF1bHREYXRlOiBudWxsLCAvLyBVc2VkIHdoZW4gZmllbGQgaXMgYmxhbms6IGFjdHVhbCBkYXRlLAoJCQkvLyArLy1udW1iZXIgZm9yIG9mZnNldCBmcm9tIHRvZGF5LCBudWxsIGZvciB0b2RheQoJCWFwcGVuZFRleHQ6ICIiLCAvLyBEaXNwbGF5IHRleHQgZm9sbG93aW5nIHRoZSBpbnB1dCBib3gsIGUuZy4gc2hvd2luZyB0aGUgZm9ybWF0CgkJYnV0dG9uVGV4dDogIi4uLiIsIC8vIFRleHQgZm9yIHRyaWdnZXIgYnV0dG9uCgkJYnV0dG9uSW1hZ2U6ICIiLCAvLyBVUkwgZm9yIHRyaWdnZXIgYnV0dG9uIGltYWdlCgkJYnV0dG9uSW1hZ2VPbmx5OiBmYWxzZSwgLy8gVHJ1ZSBpZiB0aGUgaW1hZ2UgYXBwZWFycyBhbG9uZSwgZmFsc2UgaWYgaXQgYXBwZWFycyBvbiBhIGJ1dHRvbgoJCWhpZGVJZk5vUHJldk5leHQ6IGZhbHNlLCAvLyBUcnVlIHRvIGhpZGUgbmV4dC9wcmV2aW91cyBtb250aCBsaW5rcwoJCQkvLyBpZiBub3QgYXBwbGljYWJsZSwgZmFsc2UgdG8ganVzdCBkaXNhYmxlIHRoZW0KCQluYXZpZ2F0aW9uQXNEYXRlRm9ybWF0OiBmYWxzZSwgLy8gVHJ1ZSBpZiBkYXRlIGZvcm1hdHRpbmcgYXBwbGllZCB0byBwcmV2L3RvZGF5L25leHQgbGlua3MKCQlnb3RvQ3VycmVudDogZmFsc2UsIC8vIFRydWUgaWYgdG9kYXkgbGluayBnb2VzIGJhY2sgdG8gY3VycmVudCBzZWxlY3Rpb24gaW5zdGVhZAoJCWNoYW5nZU1vbnRoOiBmYWxzZSwgLy8gVHJ1ZSBpZiBtb250aCBjYW4gYmUgc2VsZWN0ZWQgZGlyZWN0bHksIGZhbHNlIGlmIG9ubHkgcHJldi9uZXh0CgkJY2hhbmdlWWVhcjogZmFsc2UsIC8vIFRydWUgaWYgeWVhciBjYW4gYmUgc2VsZWN0ZWQgZGlyZWN0bHksIGZhbHNlIGlmIG9ubHkgcHJldi9uZXh0CgkJeWVhclJhbmdlOiAiYy0xMDpjKzEwIiwgLy8gUmFuZ2Ugb2YgeWVhcnMgdG8gZGlzcGxheSBpbiBkcm9wLWRvd24sCgkJCS8vIGVpdGhlciByZWxhdGl2ZSB0byB0b2RheSdzIHllYXIgKC1ubjorbm4pLCByZWxhdGl2ZSB0byBjdXJyZW50bHkgZGlzcGxheWVkIHllYXIKCQkJLy8gKGMtbm46YytubiksIGFic29sdXRlIChubm5uOm5ubm4pLCBvciBhIGNvbWJpbmF0aW9uIG9mIHRoZSBhYm92ZSAobm5ubjotbikKCQlzaG93T3RoZXJNb250aHM6IGZhbHNlLCAvLyBUcnVlIHRvIHNob3cgZGF0ZXMgaW4gb3RoZXIgbW9udGhzLCBmYWxzZSB0byBsZWF2ZSBibGFuawoJCXNlbGVjdE90aGVyTW9udGhzOiBmYWxzZSwgLy8gVHJ1ZSB0byBhbGxvdyBzZWxlY3Rpb24gb2YgZGF0ZXMgaW4gb3RoZXIgbW9udGhzLCBmYWxzZSBmb3IgdW5zZWxlY3RhYmxlCgkJc2hvd1dlZWs6IGZhbHNlLCAvLyBUcnVlIHRvIHNob3cgd2VlayBvZiB0aGUgeWVhciwgZmFsc2UgdG8gbm90IHNob3cgaXQKCQljYWxjdWxhdGVXZWVrOiB0aGlzLmlzbzg2MDFXZWVrLCAvLyBIb3cgdG8gY2FsY3VsYXRlIHRoZSB3ZWVrIG9mIHRoZSB5ZWFyLAoJCQkvLyB0YWtlcyBhIERhdGUgYW5kIHJldHVybnMgdGhlIG51bWJlciBvZiB0aGUgd2VlayBmb3IgaXQKCQlzaG9ydFllYXJDdXRvZmY6ICIrMTAiLCAvLyBTaG9ydCB5ZWFyIHZhbHVlcyA8IHRoaXMgYXJlIGluIHRoZSBjdXJyZW50IGNlbnR1cnksCgkJCS8vID4gdGhpcyBhcmUgaW4gdGhlIHByZXZpb3VzIGNlbnR1cnksCgkJCS8vIHN0cmluZyB2YWx1ZSBzdGFydGluZyB3aXRoICIrIiBmb3IgY3VycmVudCB5ZWFyICsgdmFsdWUKCQltaW5EYXRlOiBudWxsLCAvLyBUaGUgZWFybGllc3Qgc2VsZWN0YWJsZSBkYXRlLCBvciBudWxsIGZvciBubyBsaW1pdAoJCW1heERhdGU6IG51bGwsIC8vIFRoZSBsYXRlc3Qgc2VsZWN0YWJsZSBkYXRlLCBvciBudWxsIGZvciBubyBsaW1pdAoJCWR1cmF0aW9uOiAiZmFzdCIsIC8vIER1cmF0aW9uIG9mIGRpc3BsYXkvY2xvc3VyZQoJCWJlZm9yZVNob3dEYXk6IG51bGwsIC8vIEZ1bmN0aW9uIHRoYXQgdGFrZXMgYSBkYXRlIGFuZCByZXR1cm5zIGFuIGFycmF5IHdpdGgKCQkJLy8gWzBdID0gdHJ1ZSBpZiBzZWxlY3RhYmxlLCBmYWxzZSBpZiBub3QsIFsxXSA9IGN1c3RvbSBDU1MgY2xhc3MgbmFtZShzKSBvciAiIiwKCQkJLy8gWzJdID0gY2VsbCB0aXRsZSAob3B0aW9uYWwpLCBlLmcuICQuZGF0ZXBpY2tlci5ub1dlZWtlbmRzCgkJYmVmb3JlU2hvdzogbnVsbCwgLy8gRnVuY3Rpb24gdGhhdCB0YWtlcyBhbiBpbnB1dCBmaWVsZCBhbmQKCQkJLy8gcmV0dXJucyBhIHNldCBvZiBjdXN0b20gc2V0dGluZ3MgZm9yIHRoZSBkYXRlIHBpY2tlcgoJCW9uU2VsZWN0OiBudWxsLCAvLyBEZWZpbmUgYSBjYWxsYmFjayBmdW5jdGlvbiB3aGVuIGEgZGF0ZSBpcyBzZWxlY3RlZAoJCW9uQ2hhbmdlTW9udGhZZWFyOiBudWxsLCAvLyBEZWZpbmUgYSBjYWxsYmFjayBmdW5jdGlvbiB3aGVuIHRoZSBtb250aCBvciB5ZWFyIGlzIGNoYW5nZWQKCQlvbkNsb3NlOiBudWxsLCAvLyBEZWZpbmUgYSBjYWxsYmFjayBmdW5jdGlvbiB3aGVuIHRoZSBkYXRlcGlja2VyIGlzIGNsb3NlZAoJCW51bWJlck9mTW9udGhzOiAxLCAvLyBOdW1iZXIgb2YgbW9udGhzIHRvIHNob3cgYXQgYSB0aW1lCgkJc2hvd0N1cnJlbnRBdFBvczogMCwgLy8gVGhlIHBvc2l0aW9uIGluIG11bHRpcGUgbW9udGhzIGF0IHdoaWNoIHRvIHNob3cgdGhlIGN1cnJlbnQgbW9udGggKHN0YXJ0aW5nIGF0IDApCgkJc3RlcE1vbnRoczogMSwgLy8gTnVtYmVyIG9mIG1vbnRocyB0byBzdGVwIGJhY2svZm9yd2FyZAoJCXN0ZXBCaWdNb250aHM6IDEyLCAvLyBOdW1iZXIgb2YgbW9udGhzIHRvIHN0ZXAgYmFjay9mb3J3YXJkIGZvciB0aGUgYmlnIGxpbmtzCgkJYWx0RmllbGQ6ICIiLCAvLyBTZWxlY3RvciBmb3IgYW4gYWx0ZXJuYXRlIGZpZWxkIHRvIHN0b3JlIHNlbGVjdGVkIGRhdGVzIGludG8KCQlhbHRGb3JtYXQ6ICIiLCAvLyBUaGUgZGF0ZSBmb3JtYXQgdG8gdXNlIGZvciB0aGUgYWx0ZXJuYXRlIGZpZWxkCgkJY29uc3RyYWluSW5wdXQ6IHRydWUsIC8vIFRoZSBpbnB1dCBpcyBjb25zdHJhaW5lZCBieSB0aGUgY3VycmVudCBkYXRlIGZvcm1hdAoJCXNob3dCdXR0b25QYW5lbDogZmFsc2UsIC8vIFRydWUgdG8gc2hvdyBidXR0b24gcGFuZWwsIGZhbHNlIHRvIG5vdCBzaG93IGl0CgkJYXV0b1NpemU6IGZhbHNlLCAvLyBUcnVlIHRvIHNpemUgdGhlIGlucHV0IGZvciB0aGUgZGF0ZSBmb3JtYXQsIGZhbHNlIHRvIGxlYXZlIGFzIGlzCgkJZGlzYWJsZWQ6IGZhbHNlIC8vIFRoZSBpbml0aWFsIGRpc2FibGVkIHN0YXRlCgl9OwoJJC5leHRlbmQodGhpcy5fZGVmYXVsdHMsIHRoaXMucmVnaW9uYWxbIiJdKTsKCXRoaXMuZHBEaXYgPSBiaW5kSG92ZXIoJCgiPGRpdiBpZD0nIiArIHRoaXMuX21haW5EaXZJZCArICInIGNsYXNzPSd1aS1kYXRlcGlja2VyIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1oZWxwZXItY2xlYXJmaXggdWktY29ybmVyLWFsbCc+PC9kaXY+IikpOwp9CgokLmV4dGVuZChEYXRlcGlja2VyLnByb3RvdHlwZSwgewoJLyogQ2xhc3MgbmFtZSBhZGRlZCB0byBlbGVtZW50cyB0byBpbmRpY2F0ZSBhbHJlYWR5IGNvbmZpZ3VyZWQgd2l0aCBhIGRhdGUgcGlja2VyLiAqLwoJbWFya2VyQ2xhc3NOYW1lOiAiaGFzRGF0ZXBpY2tlciIsCgoJLy9LZWVwIHRyYWNrIG9mIHRoZSBtYXhpbXVtIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCAoc2VlICM3MDQzKQoJbWF4Um93czogNCwKCgkvLyBUT0RPIHJlbmFtZSB0byAid2lkZ2V0IiB3aGVuIHN3aXRjaGluZyB0byB3aWRnZXQgZmFjdG9yeQoJX3dpZGdldERhdGVwaWNrZXI6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmRwRGl2OwoJfSwKCgkvKiBPdmVycmlkZSB0aGUgZGVmYXVsdCBzZXR0aW5ncyBmb3IgYWxsIGluc3RhbmNlcyBvZiB0aGUgZGF0ZSBwaWNrZXIuCgkgKiBAcGFyYW0gIHNldHRpbmdzICBvYmplY3QgLSB0aGUgbmV3IHNldHRpbmdzIHRvIHVzZSBhcyBkZWZhdWx0cyAoYW5vbnltb3VzIG9iamVjdCkKCSAqIEByZXR1cm4gdGhlIG1hbmFnZXIgb2JqZWN0CgkgKi8KCXNldERlZmF1bHRzOiBmdW5jdGlvbihzZXR0aW5ncykgewoJCWV4dGVuZFJlbW92ZSh0aGlzLl9kZWZhdWx0cywgc2V0dGluZ3MgfHwge30pOwoJCXJldHVybiB0aGlzOwoJfSwKCgkvKiBBdHRhY2ggdGhlIGRhdGUgcGlja2VyIHRvIGEgalF1ZXJ5IHNlbGVjdGlvbi4KCSAqIEBwYXJhbSAgdGFyZ2V0CWVsZW1lbnQgLSB0aGUgdGFyZ2V0IGlucHV0IGZpZWxkIG9yIGRpdmlzaW9uIG9yIHNwYW4KCSAqIEBwYXJhbSAgc2V0dGluZ3MgIG9iamVjdCAtIHRoZSBuZXcgc2V0dGluZ3MgdG8gdXNlIGZvciB0aGlzIGRhdGUgcGlja2VyIGluc3RhbmNlIChhbm9ueW1vdXMpCgkgKi8KCV9hdHRhY2hEYXRlcGlja2VyOiBmdW5jdGlvbih0YXJnZXQsIHNldHRpbmdzKSB7CgkJdmFyIG5vZGVOYW1lLCBpbmxpbmUsIGluc3Q7CgkJbm9kZU5hbWUgPSB0YXJnZXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQlpbmxpbmUgPSAobm9kZU5hbWUgPT09ICJkaXYiIHx8IG5vZGVOYW1lID09PSAic3BhbiIpOwoJCWlmICghdGFyZ2V0LmlkKSB7CgkJCXRoaXMudXVpZCArPSAxOwoJCQl0YXJnZXQuaWQgPSAiZHAiICsgdGhpcy51dWlkOwoJCX0KCQlpbnN0ID0gdGhpcy5fbmV3SW5zdCgkKHRhcmdldCksIGlubGluZSk7CgkJaW5zdC5zZXR0aW5ncyA9ICQuZXh0ZW5kKHt9LCBzZXR0aW5ncyB8fCB7fSk7CgkJaWYgKG5vZGVOYW1lID09PSAiaW5wdXQiKSB7CgkJCXRoaXMuX2Nvbm5lY3REYXRlcGlja2VyKHRhcmdldCwgaW5zdCk7CgkJfSBlbHNlIGlmIChpbmxpbmUpIHsKCQkJdGhpcy5faW5saW5lRGF0ZXBpY2tlcih0YXJnZXQsIGluc3QpOwoJCX0KCX0sCgoJLyogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9iamVjdC4gKi8KCV9uZXdJbnN0OiBmdW5jdGlvbih0YXJnZXQsIGlubGluZSkgewoJCXZhciBpZCA9IHRhcmdldFswXS5pZC5yZXBsYWNlKC8oW15BLVphLXowLTlfXC1dKS9nLCAiXFxcXCQxIik7IC8vIGVzY2FwZSBqUXVlcnkgbWV0YSBjaGFycwoJCXJldHVybiB7aWQ6IGlkLCBpbnB1dDogdGFyZ2V0LCAvLyBhc3NvY2lhdGVkIHRhcmdldAoJCQlzZWxlY3RlZERheTogMCwgc2VsZWN0ZWRNb250aDogMCwgc2VsZWN0ZWRZZWFyOiAwLCAvLyBjdXJyZW50IHNlbGVjdGlvbgoJCQlkcmF3TW9udGg6IDAsIGRyYXdZZWFyOiAwLCAvLyBtb250aCBiZWluZyBkcmF3bgoJCQlpbmxpbmU6IGlubGluZSwgLy8gaXMgZGF0ZXBpY2tlciBpbmxpbmUgb3Igbm90CgkJCWRwRGl2OiAoIWlubGluZSA/IHRoaXMuZHBEaXYgOiAvLyBwcmVzZW50YXRpb24gZGl2CgkJCWJpbmRIb3ZlcigkKCI8ZGl2IGNsYXNzPSciICsgdGhpcy5faW5saW5lQ2xhc3MgKyAiIHVpLWRhdGVwaWNrZXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWhlbHBlci1jbGVhcmZpeCB1aS1jb3JuZXItYWxsJz48L2Rpdj4iKSkpfTsKCX0sCgoJLyogQXR0YWNoIHRoZSBkYXRlIHBpY2tlciB0byBhbiBpbnB1dCBmaWVsZC4gKi8KCV9jb25uZWN0RGF0ZXBpY2tlcjogZnVuY3Rpb24odGFyZ2V0LCBpbnN0KSB7CgkJdmFyIGlucHV0ID0gJCh0YXJnZXQpOwoJCWluc3QuYXBwZW5kID0gJChbXSk7CgkJaW5zdC50cmlnZ2VyID0gJChbXSk7CgkJaWYgKGlucHV0Lmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSkgewoJCQlyZXR1cm47CgkJfQoJCXRoaXMuX2F0dGFjaG1lbnRzKGlucHV0LCBpbnN0KTsKCQlpbnB1dC5hZGRDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkua2V5ZG93bih0aGlzLl9kb0tleURvd24pLgoJCQlrZXlwcmVzcyh0aGlzLl9kb0tleVByZXNzKS5rZXl1cCh0aGlzLl9kb0tleVVwKTsKCQl0aGlzLl9hdXRvU2l6ZShpbnN0KTsKCQkkLmRhdGEodGFyZ2V0LCBQUk9QX05BTUUsIGluc3QpOwoJCS8vSWYgZGlzYWJsZWQgb3B0aW9uIGlzIHRydWUsIGRpc2FibGUgdGhlIGRhdGVwaWNrZXIgb25jZSBpdCBoYXMgYmVlbiBhdHRhY2hlZCB0byB0aGUgaW5wdXQgKHNlZSB0aWNrZXQgIzU2NjUpCgkJaWYoIGluc3Quc2V0dGluZ3MuZGlzYWJsZWQgKSB7CgkJCXRoaXMuX2Rpc2FibGVEYXRlcGlja2VyKCB0YXJnZXQgKTsKCQl9Cgl9LAoKCS8qIE1ha2UgYXR0YWNobWVudHMgYmFzZWQgb24gc2V0dGluZ3MuICovCglfYXR0YWNobWVudHM6IGZ1bmN0aW9uKGlucHV0LCBpbnN0KSB7CgkJdmFyIHNob3dPbiwgYnV0dG9uVGV4dCwgYnV0dG9uSW1hZ2UsCgkJCWFwcGVuZFRleHQgPSB0aGlzLl9nZXQoaW5zdCwgImFwcGVuZFRleHQiKSwKCQkJaXNSVEwgPSB0aGlzLl9nZXQoaW5zdCwgImlzUlRMIik7CgoJCWlmIChpbnN0LmFwcGVuZCkgewoJCQlpbnN0LmFwcGVuZC5yZW1vdmUoKTsKCQl9CgkJaWYgKGFwcGVuZFRleHQpIHsKCQkJaW5zdC5hcHBlbmQgPSAkKCI8c3BhbiBjbGFzcz0nIiArIHRoaXMuX2FwcGVuZENsYXNzICsgIic+IiArIGFwcGVuZFRleHQgKyAiPC9zcGFuPiIpOwoJCQlpbnB1dFtpc1JUTCA/ICJiZWZvcmUiIDogImFmdGVyIl0oaW5zdC5hcHBlbmQpOwoJCX0KCgkJaW5wdXQudW5iaW5kKCJmb2N1cyIsIHRoaXMuX3Nob3dEYXRlcGlja2VyKTsKCgkJaWYgKGluc3QudHJpZ2dlcikgewoJCQlpbnN0LnRyaWdnZXIucmVtb3ZlKCk7CgkJfQoKCQlzaG93T24gPSB0aGlzLl9nZXQoaW5zdCwgInNob3dPbiIpOwoJCWlmIChzaG93T24gPT09ICJmb2N1cyIgfHwgc2hvd09uID09PSAiYm90aCIpIHsgLy8gcG9wLXVwIGRhdGUgcGlja2VyIHdoZW4gaW4gdGhlIG1hcmtlZCBmaWVsZAoJCQlpbnB1dC5mb2N1cyh0aGlzLl9zaG93RGF0ZXBpY2tlcik7CgkJfQoJCWlmIChzaG93T24gPT09ICJidXR0b24iIHx8IHNob3dPbiA9PT0gImJvdGgiKSB7IC8vIHBvcC11cCBkYXRlIHBpY2tlciB3aGVuIGJ1dHRvbiBjbGlja2VkCgkJCWJ1dHRvblRleHQgPSB0aGlzLl9nZXQoaW5zdCwgImJ1dHRvblRleHQiKTsKCQkJYnV0dG9uSW1hZ2UgPSB0aGlzLl9nZXQoaW5zdCwgImJ1dHRvbkltYWdlIik7CgkJCWluc3QudHJpZ2dlciA9ICQodGhpcy5fZ2V0KGluc3QsICJidXR0b25JbWFnZU9ubHkiKSA/CgkJCQkkKCI8aW1nLz4iKS5hZGRDbGFzcyh0aGlzLl90cmlnZ2VyQ2xhc3MpLgoJCQkJCWF0dHIoeyBzcmM6IGJ1dHRvbkltYWdlLCBhbHQ6IGJ1dHRvblRleHQsIHRpdGxlOiBidXR0b25UZXh0IH0pIDoKCQkJCSQoIjxidXR0b24gdHlwZT0nYnV0dG9uJz48L2J1dHRvbj4iKS5hZGRDbGFzcyh0aGlzLl90cmlnZ2VyQ2xhc3MpLgoJCQkJCWh0bWwoIWJ1dHRvbkltYWdlID8gYnV0dG9uVGV4dCA6ICQoIjxpbWcvPiIpLmF0dHIoCgkJCQkJeyBzcmM6YnV0dG9uSW1hZ2UsIGFsdDpidXR0b25UZXh0LCB0aXRsZTpidXR0b25UZXh0IH0pKSk7CgkJCWlucHV0W2lzUlRMID8gImJlZm9yZSIgOiAiYWZ0ZXIiXShpbnN0LnRyaWdnZXIpOwoJCQlpbnN0LnRyaWdnZXIuY2xpY2soZnVuY3Rpb24oKSB7CgkJCQlpZiAoJC5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyAmJiAkLmRhdGVwaWNrZXIuX2xhc3RJbnB1dCA9PT0gaW5wdXRbMF0pIHsKCQkJCQkkLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7CgkJCQl9IGVsc2UgaWYgKCQuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcgJiYgJC5kYXRlcGlja2VyLl9sYXN0SW5wdXQgIT09IGlucHV0WzBdKSB7CgkJCQkJJC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpOwoJCQkJCSQuZGF0ZXBpY2tlci5fc2hvd0RhdGVwaWNrZXIoaW5wdXRbMF0pOwoJCQkJfSBlbHNlIHsKCQkJCQkkLmRhdGVwaWNrZXIuX3Nob3dEYXRlcGlja2VyKGlucHV0WzBdKTsKCQkJCX0KCQkJCXJldHVybiBmYWxzZTsKCQkJfSk7CgkJfQoJfSwKCgkvKiBBcHBseSB0aGUgbWF4aW11bSBsZW5ndGggZm9yIHRoZSBkYXRlIGZvcm1hdC4gKi8KCV9hdXRvU2l6ZTogZnVuY3Rpb24oaW5zdCkgewoJCWlmICh0aGlzLl9nZXQoaW5zdCwgImF1dG9TaXplIikgJiYgIWluc3QuaW5saW5lKSB7CgkJCXZhciBmaW5kTWF4LCBtYXgsIG1heEksIGksCgkJCQlkYXRlID0gbmV3IERhdGUoMjAwOSwgMTIgLSAxLCAyMCksIC8vIEVuc3VyZSBkb3VibGUgZGlnaXRzCgkJCQlkYXRlRm9ybWF0ID0gdGhpcy5fZ2V0KGluc3QsICJkYXRlRm9ybWF0Iik7CgoJCQlpZiAoZGF0ZUZvcm1hdC5tYXRjaCgvW0RNXS8pKSB7CgkJCQlmaW5kTWF4ID0gZnVuY3Rpb24obmFtZXMpIHsKCQkJCQltYXggPSAwOwoJCQkJCW1heEkgPSAwOwoJCQkJCWZvciAoaSA9IDA7IGkgPCBuYW1lcy5sZW5ndGg7IGkrKykgewoJCQkJCQlpZiAobmFtZXNbaV0ubGVuZ3RoID4gbWF4KSB7CgkJCQkJCQltYXggPSBuYW1lc1tpXS5sZW5ndGg7CgkJCQkJCQltYXhJID0gaTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlyZXR1cm4gbWF4STsKCQkJCX07CgkJCQlkYXRlLnNldE1vbnRoKGZpbmRNYXgodGhpcy5fZ2V0KGluc3QsIChkYXRlRm9ybWF0Lm1hdGNoKC9NTS8pID8KCQkJCQkibW9udGhOYW1lcyIgOiAibW9udGhOYW1lc1Nob3J0IikpKSk7CgkJCQlkYXRlLnNldERhdGUoZmluZE1heCh0aGlzLl9nZXQoaW5zdCwgKGRhdGVGb3JtYXQubWF0Y2goL0RELykgPwoJCQkJCSJkYXlOYW1lcyIgOiAiZGF5TmFtZXNTaG9ydCIpKSkgKyAyMCAtIGRhdGUuZ2V0RGF5KCkpOwoJCQl9CgkJCWluc3QuaW5wdXQuYXR0cigic2l6ZSIsIHRoaXMuX2Zvcm1hdERhdGUoaW5zdCwgZGF0ZSkubGVuZ3RoKTsKCQl9Cgl9LAoKCS8qIEF0dGFjaCBhbiBpbmxpbmUgZGF0ZSBwaWNrZXIgdG8gYSBkaXYuICovCglfaW5saW5lRGF0ZXBpY2tlcjogZnVuY3Rpb24odGFyZ2V0LCBpbnN0KSB7CgkJdmFyIGRpdlNwYW4gPSAkKHRhcmdldCk7CgkJaWYgKGRpdlNwYW4uaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpKSB7CgkJCXJldHVybjsKCQl9CgkJZGl2U3Bhbi5hZGRDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkuYXBwZW5kKGluc3QuZHBEaXYpOwoJCSQuZGF0YSh0YXJnZXQsIFBST1BfTkFNRSwgaW5zdCk7CgkJdGhpcy5fc2V0RGF0ZShpbnN0LCB0aGlzLl9nZXREZWZhdWx0RGF0ZShpbnN0KSwgdHJ1ZSk7CgkJdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihpbnN0KTsKCQl0aGlzLl91cGRhdGVBbHRlcm5hdGUoaW5zdCk7CgkJLy9JZiBkaXNhYmxlZCBvcHRpb24gaXMgdHJ1ZSwgZGlzYWJsZSB0aGUgZGF0ZXBpY2tlciBiZWZvcmUgc2hvd2luZyBpdCAoc2VlIHRpY2tldCAjNTY2NSkKCQlpZiggaW5zdC5zZXR0aW5ncy5kaXNhYmxlZCApIHsKCQkJdGhpcy5fZGlzYWJsZURhdGVwaWNrZXIoIHRhcmdldCApOwoJCX0KCQkvLyBTZXQgZGlzcGxheTpibG9jayBpbiBwbGFjZSBvZiBpbnN0LmRwRGl2LnNob3coKSB3aGljaCB3b24ndCB3b3JrIG9uIGRpc2Nvbm5lY3RlZCBlbGVtZW50cwoJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeXVpLmNvbS90aWNrZXQvNzU1MiAtIEEgRGF0ZXBpY2tlciBjcmVhdGVkIG9uIGEgZGV0YWNoZWQgZGl2IGhhcyB6ZXJvIGhlaWdodAoJCWluc3QuZHBEaXYuY3NzKCAiZGlzcGxheSIsICJibG9jayIgKTsKCX0sCgoJLyogUG9wLXVwIHRoZSBkYXRlIHBpY2tlciBpbiBhICJkaWFsb2ciIGJveC4KCSAqIEBwYXJhbSAgaW5wdXQgZWxlbWVudCAtIGlnbm9yZWQKCSAqIEBwYXJhbSAgZGF0ZQlzdHJpbmcgb3IgRGF0ZSAtIHRoZSBpbml0aWFsIGRhdGUgdG8gZGlzcGxheQoJICogQHBhcmFtICBvblNlbGVjdCAgZnVuY3Rpb24gLSB0aGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIGEgZGF0ZSBpcyBzZWxlY3RlZAoJICogQHBhcmFtICBzZXR0aW5ncyAgb2JqZWN0IC0gdXBkYXRlIHRoZSBkaWFsb2cgZGF0ZSBwaWNrZXIgaW5zdGFuY2UncyBzZXR0aW5ncyAoYW5vbnltb3VzIG9iamVjdCkKCSAqIEBwYXJhbSAgcG9zIGludFsyXSAtIGNvb3JkaW5hdGVzIGZvciB0aGUgZGlhbG9nJ3MgcG9zaXRpb24gd2l0aGluIHRoZSBzY3JlZW4gb3IKCSAqCQkJCQlldmVudCAtIHdpdGggeC95IGNvb3JkaW5hdGVzIG9yCgkgKgkJCQkJbGVhdmUgZW1wdHkgZm9yIGRlZmF1bHQgKHNjcmVlbiBjZW50cmUpCgkgKiBAcmV0dXJuIHRoZSBtYW5hZ2VyIG9iamVjdAoJICovCglfZGlhbG9nRGF0ZXBpY2tlcjogZnVuY3Rpb24oaW5wdXQsIGRhdGUsIG9uU2VsZWN0LCBzZXR0aW5ncywgcG9zKSB7CgkJdmFyIGlkLCBicm93c2VyV2lkdGgsIGJyb3dzZXJIZWlnaHQsIHNjcm9sbFgsIHNjcm9sbFksCgkJCWluc3QgPSB0aGlzLl9kaWFsb2dJbnN0OyAvLyBpbnRlcm5hbCBpbnN0YW5jZQoKCQlpZiAoIWluc3QpIHsKCQkJdGhpcy51dWlkICs9IDE7CgkJCWlkID0gImRwIiArIHRoaXMudXVpZDsKCQkJdGhpcy5fZGlhbG9nSW5wdXQgPSAkKCI8aW5wdXQgdHlwZT0ndGV4dCcgaWQ9JyIgKyBpZCArCgkJCQkiJyBzdHlsZT0ncG9zaXRpb246IGFic29sdXRlOyB0b3A6IC0xMDBweDsgd2lkdGg6IDBweDsnLz4iKTsKCQkJdGhpcy5fZGlhbG9nSW5wdXQua2V5ZG93bih0aGlzLl9kb0tleURvd24pOwoJCQkkKCJib2R5IikuYXBwZW5kKHRoaXMuX2RpYWxvZ0lucHV0KTsKCQkJaW5zdCA9IHRoaXMuX2RpYWxvZ0luc3QgPSB0aGlzLl9uZXdJbnN0KHRoaXMuX2RpYWxvZ0lucHV0LCBmYWxzZSk7CgkJCWluc3Quc2V0dGluZ3MgPSB7fTsKCQkJJC5kYXRhKHRoaXMuX2RpYWxvZ0lucHV0WzBdLCBQUk9QX05BTUUsIGluc3QpOwoJCX0KCQlleHRlbmRSZW1vdmUoaW5zdC5zZXR0aW5ncywgc2V0dGluZ3MgfHwge30pOwoJCWRhdGUgPSAoZGF0ZSAmJiBkYXRlLmNvbnN0cnVjdG9yID09PSBEYXRlID8gdGhpcy5fZm9ybWF0RGF0ZShpbnN0LCBkYXRlKSA6IGRhdGUpOwoJCXRoaXMuX2RpYWxvZ0lucHV0LnZhbChkYXRlKTsKCgkJdGhpcy5fcG9zID0gKHBvcyA/IChwb3MubGVuZ3RoID8gcG9zIDogW3Bvcy5wYWdlWCwgcG9zLnBhZ2VZXSkgOiBudWxsKTsKCQlpZiAoIXRoaXMuX3BvcykgewoJCQlicm93c2VyV2lkdGggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7CgkJCWJyb3dzZXJIZWlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0OwoJCQlzY3JvbGxYID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0OwoJCQlzY3JvbGxZID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDsKCQkJdGhpcy5fcG9zID0gLy8gc2hvdWxkIHVzZSBhY3R1YWwgd2lkdGgvaGVpZ2h0IGJlbG93CgkJCQlbKGJyb3dzZXJXaWR0aCAvIDIpIC0gMTAwICsgc2Nyb2xsWCwgKGJyb3dzZXJIZWlnaHQgLyAyKSAtIDE1MCArIHNjcm9sbFldOwoJCX0KCgkJLy8gbW92ZSBpbnB1dCBvbiBzY3JlZW4gZm9yIGZvY3VzLCBidXQgaGlkZGVuIGJlaGluZCBkaWFsb2cKCQl0aGlzLl9kaWFsb2dJbnB1dC5jc3MoImxlZnQiLCAodGhpcy5fcG9zWzBdICsgMjApICsgInB4IikuY3NzKCJ0b3AiLCB0aGlzLl9wb3NbMV0gKyAicHgiKTsKCQlpbnN0LnNldHRpbmdzLm9uU2VsZWN0ID0gb25TZWxlY3Q7CgkJdGhpcy5faW5EaWFsb2cgPSB0cnVlOwoJCXRoaXMuZHBEaXYuYWRkQ2xhc3ModGhpcy5fZGlhbG9nQ2xhc3MpOwoJCXRoaXMuX3Nob3dEYXRlcGlja2VyKHRoaXMuX2RpYWxvZ0lucHV0WzBdKTsKCQlpZiAoJC5ibG9ja1VJKSB7CgkJCSQuYmxvY2tVSSh0aGlzLmRwRGl2KTsKCQl9CgkJJC5kYXRhKHRoaXMuX2RpYWxvZ0lucHV0WzBdLCBQUk9QX05BTUUsIGluc3QpOwoJCXJldHVybiB0aGlzOwoJfSwKCgkvKiBEZXRhY2ggYSBkYXRlcGlja2VyIGZyb20gaXRzIGNvbnRyb2wuCgkgKiBAcGFyYW0gIHRhcmdldAllbGVtZW50IC0gdGhlIHRhcmdldCBpbnB1dCBmaWVsZCBvciBkaXZpc2lvbiBvciBzcGFuCgkgKi8KCV9kZXN0cm95RGF0ZXBpY2tlcjogZnVuY3Rpb24odGFyZ2V0KSB7CgkJdmFyIG5vZGVOYW1lLAoJCQkkdGFyZ2V0ID0gJCh0YXJnZXQpLAoJCQlpbnN0ID0gJC5kYXRhKHRhcmdldCwgUFJPUF9OQU1FKTsKCgkJaWYgKCEkdGFyZ2V0Lmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSkgewoJCQlyZXR1cm47CgkJfQoKCQlub2RlTmFtZSA9IHRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCSQucmVtb3ZlRGF0YSh0YXJnZXQsIFBST1BfTkFNRSk7CgkJaWYgKG5vZGVOYW1lID09PSAiaW5wdXQiKSB7CgkJCWluc3QuYXBwZW5kLnJlbW92ZSgpOwoJCQlpbnN0LnRyaWdnZXIucmVtb3ZlKCk7CgkJCSR0YXJnZXQucmVtb3ZlQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpLgoJCQkJdW5iaW5kKCJmb2N1cyIsIHRoaXMuX3Nob3dEYXRlcGlja2VyKS4KCQkJCXVuYmluZCgia2V5ZG93biIsIHRoaXMuX2RvS2V5RG93bikuCgkJCQl1bmJpbmQoImtleXByZXNzIiwgdGhpcy5fZG9LZXlQcmVzcykuCgkJCQl1bmJpbmQoImtleXVwIiwgdGhpcy5fZG9LZXlVcCk7CgkJfSBlbHNlIGlmIChub2RlTmFtZSA9PT0gImRpdiIgfHwgbm9kZU5hbWUgPT09ICJzcGFuIikgewoJCQkkdGFyZ2V0LnJlbW92ZUNsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS5lbXB0eSgpOwoJCX0KCX0sCgoJLyogRW5hYmxlIHRoZSBkYXRlIHBpY2tlciB0byBhIGpRdWVyeSBzZWxlY3Rpb24uCgkgKiBAcGFyYW0gIHRhcmdldAllbGVtZW50IC0gdGhlIHRhcmdldCBpbnB1dCBmaWVsZCBvciBkaXZpc2lvbiBvciBzcGFuCgkgKi8KCV9lbmFibGVEYXRlcGlja2VyOiBmdW5jdGlvbih0YXJnZXQpIHsKCQl2YXIgbm9kZU5hbWUsIGlubGluZSwKCQkJJHRhcmdldCA9ICQodGFyZ2V0KSwKCQkJaW5zdCA9ICQuZGF0YSh0YXJnZXQsIFBST1BfTkFNRSk7CgoJCWlmICghJHRhcmdldC5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpIHsKCQkJcmV0dXJuOwoJCX0KCgkJbm9kZU5hbWUgPSB0YXJnZXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQlpZiAobm9kZU5hbWUgPT09ICJpbnB1dCIpIHsKCQkJdGFyZ2V0LmRpc2FibGVkID0gZmFsc2U7CgkJCWluc3QudHJpZ2dlci5maWx0ZXIoImJ1dHRvbiIpLgoJCQkJZWFjaChmdW5jdGlvbigpIHsgdGhpcy5kaXNhYmxlZCA9IGZhbHNlOyB9KS5lbmQoKS4KCQkJCWZpbHRlcigiaW1nIikuY3NzKHtvcGFjaXR5OiAiMS4wIiwgY3Vyc29yOiAiIn0pOwoJCX0gZWxzZSBpZiAobm9kZU5hbWUgPT09ICJkaXYiIHx8IG5vZGVOYW1lID09PSAic3BhbiIpIHsKCQkJaW5saW5lID0gJHRhcmdldC5jaGlsZHJlbigiLiIgKyB0aGlzLl9pbmxpbmVDbGFzcyk7CgkJCWlubGluZS5jaGlsZHJlbigpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1kaXNhYmxlZCIpOwoJCQlpbmxpbmUuZmluZCgic2VsZWN0LnVpLWRhdGVwaWNrZXItbW9udGgsIHNlbGVjdC51aS1kYXRlcGlja2VyLXllYXIiKS4KCQkJCXByb3AoImRpc2FibGVkIiwgZmFsc2UpOwoJCX0KCQl0aGlzLl9kaXNhYmxlZElucHV0cyA9ICQubWFwKHRoaXMuX2Rpc2FibGVkSW5wdXRzLAoJCQlmdW5jdGlvbih2YWx1ZSkgeyByZXR1cm4gKHZhbHVlID09PSB0YXJnZXQgPyBudWxsIDogdmFsdWUpOyB9KTsgLy8gZGVsZXRlIGVudHJ5Cgl9LAoKCS8qIERpc2FibGUgdGhlIGRhdGUgcGlja2VyIHRvIGEgalF1ZXJ5IHNlbGVjdGlvbi4KCSAqIEBwYXJhbSAgdGFyZ2V0CWVsZW1lbnQgLSB0aGUgdGFyZ2V0IGlucHV0IGZpZWxkIG9yIGRpdmlzaW9uIG9yIHNwYW4KCSAqLwoJX2Rpc2FibGVEYXRlcGlja2VyOiBmdW5jdGlvbih0YXJnZXQpIHsKCQl2YXIgbm9kZU5hbWUsIGlubGluZSwKCQkJJHRhcmdldCA9ICQodGFyZ2V0KSwKCQkJaW5zdCA9ICQuZGF0YSh0YXJnZXQsIFBST1BfTkFNRSk7CgoJCWlmICghJHRhcmdldC5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpIHsKCQkJcmV0dXJuOwoJCX0KCgkJbm9kZU5hbWUgPSB0YXJnZXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQlpZiAobm9kZU5hbWUgPT09ICJpbnB1dCIpIHsKCQkJdGFyZ2V0LmRpc2FibGVkID0gdHJ1ZTsKCQkJaW5zdC50cmlnZ2VyLmZpbHRlcigiYnV0dG9uIikuCgkJCQllYWNoKGZ1bmN0aW9uKCkgeyB0aGlzLmRpc2FibGVkID0gdHJ1ZTsgfSkuZW5kKCkuCgkJCQlmaWx0ZXIoImltZyIpLmNzcyh7b3BhY2l0eTogIjAuNSIsIGN1cnNvcjogImRlZmF1bHQifSk7CgkJfSBlbHNlIGlmIChub2RlTmFtZSA9PT0gImRpdiIgfHwgbm9kZU5hbWUgPT09ICJzcGFuIikgewoJCQlpbmxpbmUgPSAkdGFyZ2V0LmNoaWxkcmVuKCIuIiArIHRoaXMuX2lubGluZUNsYXNzKTsKCQkJaW5saW5lLmNoaWxkcmVuKCkuYWRkQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIik7CgkJCWlubGluZS5maW5kKCJzZWxlY3QudWktZGF0ZXBpY2tlci1tb250aCwgc2VsZWN0LnVpLWRhdGVwaWNrZXIteWVhciIpLgoJCQkJcHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKCQl9CgkJdGhpcy5fZGlzYWJsZWRJbnB1dHMgPSAkLm1hcCh0aGlzLl9kaXNhYmxlZElucHV0cywKCQkJZnVuY3Rpb24odmFsdWUpIHsgcmV0dXJuICh2YWx1ZSA9PT0gdGFyZ2V0ID8gbnVsbCA6IHZhbHVlKTsgfSk7IC8vIGRlbGV0ZSBlbnRyeQoJCXRoaXMuX2Rpc2FibGVkSW5wdXRzW3RoaXMuX2Rpc2FibGVkSW5wdXRzLmxlbmd0aF0gPSB0YXJnZXQ7Cgl9LAoKCS8qIElzIHRoZSBmaXJzdCBmaWVsZCBpbiBhIGpRdWVyeSBjb2xsZWN0aW9uIGRpc2FibGVkIGFzIGEgZGF0ZXBpY2tlcj8KCSAqIEBwYXJhbSAgdGFyZ2V0CWVsZW1lbnQgLSB0aGUgdGFyZ2V0IGlucHV0IGZpZWxkIG9yIGRpdmlzaW9uIG9yIHNwYW4KCSAqIEByZXR1cm4gYm9vbGVhbiAtIHRydWUgaWYgZGlzYWJsZWQsIGZhbHNlIGlmIGVuYWJsZWQKCSAqLwoJX2lzRGlzYWJsZWREYXRlcGlja2VyOiBmdW5jdGlvbih0YXJnZXQpIHsKCQlpZiAoIXRhcmdldCkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fZGlzYWJsZWRJbnB1dHMubGVuZ3RoOyBpKyspIHsKCQkJaWYgKHRoaXMuX2Rpc2FibGVkSW5wdXRzW2ldID09PSB0YXJnZXQpIHsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJfQoJCXJldHVybiBmYWxzZTsKCX0sCgoJLyogUmV0cmlldmUgdGhlIGluc3RhbmNlIGRhdGEgZm9yIHRoZSB0YXJnZXQgY29udHJvbC4KCSAqIEBwYXJhbSAgdGFyZ2V0ICBlbGVtZW50IC0gdGhlIHRhcmdldCBpbnB1dCBmaWVsZCBvciBkaXZpc2lvbiBvciBzcGFuCgkgKiBAcmV0dXJuICBvYmplY3QgLSB0aGUgYXNzb2NpYXRlZCBpbnN0YW5jZSBkYXRhCgkgKiBAdGhyb3dzICBlcnJvciBpZiBhIGpRdWVyeSBwcm9ibGVtIGdldHRpbmcgZGF0YQoJICovCglfZ2V0SW5zdDogZnVuY3Rpb24odGFyZ2V0KSB7CgkJdHJ5IHsKCQkJcmV0dXJuICQuZGF0YSh0YXJnZXQsIFBST1BfTkFNRSk7CgkJfQoJCWNhdGNoIChlcnIpIHsKCQkJdGhyb3cgIk1pc3NpbmcgaW5zdGFuY2UgZGF0YSBmb3IgdGhpcyBkYXRlcGlja2VyIjsKCQl9Cgl9LAoKCS8qIFVwZGF0ZSBvciByZXRyaWV2ZSB0aGUgc2V0dGluZ3MgZm9yIGEgZGF0ZSBwaWNrZXIgYXR0YWNoZWQgdG8gYW4gaW5wdXQgZmllbGQgb3IgZGl2aXNpb24uCgkgKiBAcGFyYW0gIHRhcmdldCAgZWxlbWVudCAtIHRoZSB0YXJnZXQgaW5wdXQgZmllbGQgb3IgZGl2aXNpb24gb3Igc3BhbgoJICogQHBhcmFtICBuYW1lCW9iamVjdCAtIHRoZSBuZXcgc2V0dGluZ3MgdG8gdXBkYXRlIG9yCgkgKgkJCQlzdHJpbmcgLSB0aGUgbmFtZSBvZiB0aGUgc2V0dGluZyB0byBjaGFuZ2Ugb3IgcmV0cmlldmUsCgkgKgkJCQl3aGVuIHJldHJpZXZpbmcgYWxzbyAiYWxsIiBmb3IgYWxsIGluc3RhbmNlIHNldHRpbmdzIG9yCgkgKgkJCQkiZGVmYXVsdHMiIGZvciBhbGwgZ2xvYmFsIGRlZmF1bHRzCgkgKiBAcGFyYW0gIHZhbHVlICAgYW55IC0gdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIHNldHRpbmcKCSAqCQkJCShvbWl0IGlmIGFib3ZlIGlzIGFuIG9iamVjdCBvciB0byByZXRyaWV2ZSBhIHZhbHVlKQoJICovCglfb3B0aW9uRGF0ZXBpY2tlcjogZnVuY3Rpb24odGFyZ2V0LCBuYW1lLCB2YWx1ZSkgewoJCXZhciBzZXR0aW5ncywgZGF0ZSwgbWluRGF0ZSwgbWF4RGF0ZSwKCQkJaW5zdCA9IHRoaXMuX2dldEluc3QodGFyZ2V0KTsKCgkJaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgdHlwZW9mIG5hbWUgPT09ICJzdHJpbmciKSB7CgkJCXJldHVybiAobmFtZSA9PT0gImRlZmF1bHRzIiA/ICQuZXh0ZW5kKHt9LCAkLmRhdGVwaWNrZXIuX2RlZmF1bHRzKSA6CgkJCQkoaW5zdCA/IChuYW1lID09PSAiYWxsIiA/ICQuZXh0ZW5kKHt9LCBpbnN0LnNldHRpbmdzKSA6CgkJCQl0aGlzLl9nZXQoaW5zdCwgbmFtZSkpIDogbnVsbCkpOwoJCX0KCgkJc2V0dGluZ3MgPSBuYW1lIHx8IHt9OwoJCWlmICh0eXBlb2YgbmFtZSA9PT0gInN0cmluZyIpIHsKCQkJc2V0dGluZ3MgPSB7fTsKCQkJc2V0dGluZ3NbbmFtZV0gPSB2YWx1ZTsKCQl9CgoJCWlmIChpbnN0KSB7CgkJCWlmICh0aGlzLl9jdXJJbnN0ID09PSBpbnN0KSB7CgkJCQl0aGlzLl9oaWRlRGF0ZXBpY2tlcigpOwoJCQl9CgoJCQlkYXRlID0gdGhpcy5fZ2V0RGF0ZURhdGVwaWNrZXIodGFyZ2V0LCB0cnVlKTsKCQkJbWluRGF0ZSA9IHRoaXMuX2dldE1pbk1heERhdGUoaW5zdCwgIm1pbiIpOwoJCQltYXhEYXRlID0gdGhpcy5fZ2V0TWluTWF4RGF0ZShpbnN0LCAibWF4Iik7CgkJCWV4dGVuZFJlbW92ZShpbnN0LnNldHRpbmdzLCBzZXR0aW5ncyk7CgkJCS8vIHJlZm9ybWF0IHRoZSBvbGQgbWluRGF0ZS9tYXhEYXRlIHZhbHVlcyBpZiBkYXRlRm9ybWF0IGNoYW5nZXMgYW5kIGEgbmV3IG1pbkRhdGUvbWF4RGF0ZSBpc24ndCBwcm92aWRlZAoJCQlpZiAobWluRGF0ZSAhPT0gbnVsbCAmJiBzZXR0aW5ncy5kYXRlRm9ybWF0ICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MubWluRGF0ZSA9PT0gdW5kZWZpbmVkKSB7CgkJCQlpbnN0LnNldHRpbmdzLm1pbkRhdGUgPSB0aGlzLl9mb3JtYXREYXRlKGluc3QsIG1pbkRhdGUpOwoJCQl9CgkJCWlmIChtYXhEYXRlICE9PSBudWxsICYmIHNldHRpbmdzLmRhdGVGb3JtYXQgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5tYXhEYXRlID09PSB1bmRlZmluZWQpIHsKCQkJCWluc3Quc2V0dGluZ3MubWF4RGF0ZSA9IHRoaXMuX2Zvcm1hdERhdGUoaW5zdCwgbWF4RGF0ZSk7CgkJCX0KCQkJaWYgKCAiZGlzYWJsZWQiIGluIHNldHRpbmdzICkgewoJCQkJaWYgKCBzZXR0aW5ncy5kaXNhYmxlZCApIHsKCQkJCQl0aGlzLl9kaXNhYmxlRGF0ZXBpY2tlcih0YXJnZXQpOwoJCQkJfSBlbHNlIHsKCQkJCQl0aGlzLl9lbmFibGVEYXRlcGlja2VyKHRhcmdldCk7CgkJCQl9CgkJCX0KCQkJdGhpcy5fYXR0YWNobWVudHMoJCh0YXJnZXQpLCBpbnN0KTsKCQkJdGhpcy5fYXV0b1NpemUoaW5zdCk7CgkJCXRoaXMuX3NldERhdGUoaW5zdCwgZGF0ZSk7CgkJCXRoaXMuX3VwZGF0ZUFsdGVybmF0ZShpbnN0KTsKCQkJdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihpbnN0KTsKCQl9Cgl9LAoKCS8vIGNoYW5nZSBtZXRob2QgZGVwcmVjYXRlZAoJX2NoYW5nZURhdGVwaWNrZXI6IGZ1bmN0aW9uKHRhcmdldCwgbmFtZSwgdmFsdWUpIHsKCQl0aGlzLl9vcHRpb25EYXRlcGlja2VyKHRhcmdldCwgbmFtZSwgdmFsdWUpOwoJfSwKCgkvKiBSZWRyYXcgdGhlIGRhdGUgcGlja2VyIGF0dGFjaGVkIHRvIGFuIGlucHV0IGZpZWxkIG9yIGRpdmlzaW9uLgoJICogQHBhcmFtICB0YXJnZXQgIGVsZW1lbnQgLSB0aGUgdGFyZ2V0IGlucHV0IGZpZWxkIG9yIGRpdmlzaW9uIG9yIHNwYW4KCSAqLwoJX3JlZnJlc2hEYXRlcGlja2VyOiBmdW5jdGlvbih0YXJnZXQpIHsKCQl2YXIgaW5zdCA9IHRoaXMuX2dldEluc3QodGFyZ2V0KTsKCQlpZiAoaW5zdCkgewoJCQl0aGlzLl91cGRhdGVEYXRlcGlja2VyKGluc3QpOwoJCX0KCX0sCgoJLyogU2V0IHRoZSBkYXRlcyBmb3IgYSBqUXVlcnkgc2VsZWN0aW9uLgoJICogQHBhcmFtICB0YXJnZXQgZWxlbWVudCAtIHRoZSB0YXJnZXQgaW5wdXQgZmllbGQgb3IgZGl2aXNpb24gb3Igc3BhbgoJICogQHBhcmFtICBkYXRlCURhdGUgLSB0aGUgbmV3IGRhdGUKCSAqLwoJX3NldERhdGVEYXRlcGlja2VyOiBmdW5jdGlvbih0YXJnZXQsIGRhdGUpIHsKCQl2YXIgaW5zdCA9IHRoaXMuX2dldEluc3QodGFyZ2V0KTsKCQlpZiAoaW5zdCkgewoJCQl0aGlzLl9zZXREYXRlKGluc3QsIGRhdGUpOwoJCQl0aGlzLl91cGRhdGVEYXRlcGlja2VyKGluc3QpOwoJCQl0aGlzLl91cGRhdGVBbHRlcm5hdGUoaW5zdCk7CgkJfQoJfSwKCgkvKiBHZXQgdGhlIGRhdGUocykgZm9yIHRoZSBmaXJzdCBlbnRyeSBpbiBhIGpRdWVyeSBzZWxlY3Rpb24uCgkgKiBAcGFyYW0gIHRhcmdldCBlbGVtZW50IC0gdGhlIHRhcmdldCBpbnB1dCBmaWVsZCBvciBkaXZpc2lvbiBvciBzcGFuCgkgKiBAcGFyYW0gIG5vRGVmYXVsdCBib29sZWFuIC0gdHJ1ZSBpZiBubyBkZWZhdWx0IGRhdGUgaXMgdG8gYmUgdXNlZAoJICogQHJldHVybiBEYXRlIC0gdGhlIGN1cnJlbnQgZGF0ZQoJICovCglfZ2V0RGF0ZURhdGVwaWNrZXI6IGZ1bmN0aW9uKHRhcmdldCwgbm9EZWZhdWx0KSB7CgkJdmFyIGluc3QgPSB0aGlzLl9nZXRJbnN0KHRhcmdldCk7CgkJaWYgKGluc3QgJiYgIWluc3QuaW5saW5lKSB7CgkJCXRoaXMuX3NldERhdGVGcm9tRmllbGQoaW5zdCwgbm9EZWZhdWx0KTsKCQl9CgkJcmV0dXJuIChpbnN0ID8gdGhpcy5fZ2V0RGF0ZShpbnN0KSA6IG51bGwpOwoJfSwKCgkvKiBIYW5kbGUga2V5c3Ryb2tlcy4gKi8KCV9kb0tleURvd246IGZ1bmN0aW9uKGV2ZW50KSB7CgkJdmFyIG9uU2VsZWN0LCBkYXRlU3RyLCBzZWwsCgkJCWluc3QgPSAkLmRhdGVwaWNrZXIuX2dldEluc3QoZXZlbnQudGFyZ2V0KSwKCQkJaGFuZGxlZCA9IHRydWUsCgkJCWlzUlRMID0gaW5zdC5kcERpdi5pcygiLnVpLWRhdGVwaWNrZXItcnRsIik7CgoJCWluc3QuX2tleUV2ZW50ID0gdHJ1ZTsKCQlpZiAoJC5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZykgewoJCQlzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHsKCQkJCWNhc2UgOTogJC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpOwoJCQkJCQloYW5kbGVkID0gZmFsc2U7CgkJCQkJCWJyZWFrOyAvLyBoaWRlIG9uIHRhYiBvdXQKCQkJCWNhc2UgMTM6IHNlbCA9ICQoInRkLiIgKyAkLmRhdGVwaWNrZXIuX2RheU92ZXJDbGFzcyArICI6bm90KC4iICsKCQkJCQkJCQkJJC5kYXRlcGlja2VyLl9jdXJyZW50Q2xhc3MgKyAiKSIsIGluc3QuZHBEaXYpOwoJCQkJCQlpZiAoc2VsWzBdKSB7CgkJCQkJCQkkLmRhdGVwaWNrZXIuX3NlbGVjdERheShldmVudC50YXJnZXQsIGluc3Quc2VsZWN0ZWRNb250aCwgaW5zdC5zZWxlY3RlZFllYXIsIHNlbFswXSk7CgkJCQkJCX0KCgkJCQkJCW9uU2VsZWN0ID0gJC5kYXRlcGlja2VyLl9nZXQoaW5zdCwgIm9uU2VsZWN0Iik7CgkJCQkJCWlmIChvblNlbGVjdCkgewoJCQkJCQkJZGF0ZVN0ciA9ICQuZGF0ZXBpY2tlci5fZm9ybWF0RGF0ZShpbnN0KTsKCgkJCQkJCQkvLyB0cmlnZ2VyIGN1c3RvbSBjYWxsYmFjawoJCQkJCQkJb25TZWxlY3QuYXBwbHkoKGluc3QuaW5wdXQgPyBpbnN0LmlucHV0WzBdIDogbnVsbCksIFtkYXRlU3RyLCBpbnN0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7CgkJCQkJCX0KCgkJCQkJCXJldHVybiBmYWxzZTsgLy8gZG9uJ3Qgc3VibWl0IHRoZSBmb3JtCgkJCQljYXNlIDI3OiAkLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7CgkJCQkJCWJyZWFrOyAvLyBoaWRlIG9uIGVzY2FwZQoJCQkJY2FzZSAzMzogJC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGV2ZW50LnRhcmdldCwgKGV2ZW50LmN0cmxLZXkgPwoJCQkJCQkJLSQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJzdGVwQmlnTW9udGhzIikgOgoJCQkJCQkJLSQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJzdGVwTW9udGhzIikpLCAiTSIpOwoJCQkJCQlicmVhazsgLy8gcHJldmlvdXMgbW9udGgveWVhciBvbiBwYWdlIHVwLysgY3RybAoJCQkJY2FzZSAzNDogJC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGV2ZW50LnRhcmdldCwgKGV2ZW50LmN0cmxLZXkgPwoJCQkJCQkJKyQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJzdGVwQmlnTW9udGhzIikgOgoJCQkJCQkJKyQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJzdGVwTW9udGhzIikpLCAiTSIpOwoJCQkJCQlicmVhazsgLy8gbmV4dCBtb250aC95ZWFyIG9uIHBhZ2UgZG93bi8rIGN0cmwKCQkJCWNhc2UgMzU6IGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkpIHsKCQkJCQkJCSQuZGF0ZXBpY2tlci5fY2xlYXJEYXRlKGV2ZW50LnRhcmdldCk7CgkJCQkJCX0KCQkJCQkJaGFuZGxlZCA9IGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleTsKCQkJCQkJYnJlYWs7IC8vIGNsZWFyIG9uIGN0cmwgb3IgY29tbWFuZCArZW5kCgkJCQljYXNlIDM2OiBpZiAoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSB7CgkJCQkJCQkkLmRhdGVwaWNrZXIuX2dvdG9Ub2RheShldmVudC50YXJnZXQpOwoJCQkJCQl9CgkJCQkJCWhhbmRsZWQgPSBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXk7CgkJCQkJCWJyZWFrOyAvLyBjdXJyZW50IG9uIGN0cmwgb3IgY29tbWFuZCAraG9tZQoJCQkJY2FzZSAzNzogaWYgKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSkgewoJCQkJCQkJJC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGV2ZW50LnRhcmdldCwgKGlzUlRMID8gKzEgOiAtMSksICJEIik7CgkJCQkJCX0KCQkJCQkJaGFuZGxlZCA9IGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleTsKCQkJCQkJLy8gLTEgZGF5IG9uIGN0cmwgb3IgY29tbWFuZCArbGVmdAoJCQkJCQlpZiAoZXZlbnQub3JpZ2luYWxFdmVudC5hbHRLZXkpIHsKCQkJCQkJCSQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShldmVudC50YXJnZXQsIChldmVudC5jdHJsS2V5ID8KCQkJCQkJCQktJC5kYXRlcGlja2VyLl9nZXQoaW5zdCwgInN0ZXBCaWdNb250aHMiKSA6CgkJCQkJCQkJLSQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJzdGVwTW9udGhzIikpLCAiTSIpOwoJCQkJCQl9CgkJCQkJCS8vIG5leHQgbW9udGgveWVhciBvbiBhbHQgK2xlZnQgb24gTWFjCgkJCQkJCWJyZWFrOwoJCQkJY2FzZSAzODogaWYgKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSkgewoJCQkJCQkJJC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGV2ZW50LnRhcmdldCwgLTcsICJEIik7CgkJCQkJCX0KCQkJCQkJaGFuZGxlZCA9IGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleTsKCQkJCQkJYnJlYWs7IC8vIC0xIHdlZWsgb24gY3RybCBvciBjb21tYW5kICt1cAoJCQkJY2FzZSAzOTogaWYgKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSkgewoJCQkJCQkJJC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGV2ZW50LnRhcmdldCwgKGlzUlRMID8gLTEgOiArMSksICJEIik7CgkJCQkJCX0KCQkJCQkJaGFuZGxlZCA9IGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleTsKCQkJCQkJLy8gKzEgZGF5IG9uIGN0cmwgb3IgY29tbWFuZCArcmlnaHQKCQkJCQkJaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQuYWx0S2V5KSB7CgkJCQkJCQkkLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoZXZlbnQudGFyZ2V0LCAoZXZlbnQuY3RybEtleSA/CgkJCQkJCQkJKyQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJzdGVwQmlnTW9udGhzIikgOgoJCQkJCQkJCSskLmRhdGVwaWNrZXIuX2dldChpbnN0LCAic3RlcE1vbnRocyIpKSwgIk0iKTsKCQkJCQkJfQoJCQkJCQkvLyBuZXh0IG1vbnRoL3llYXIgb24gYWx0ICtyaWdodAoJCQkJCQlicmVhazsKCQkJCWNhc2UgNDA6IGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkpIHsKCQkJCQkJCSQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShldmVudC50YXJnZXQsICs3LCAiRCIpOwoJCQkJCQl9CgkJCQkJCWhhbmRsZWQgPSBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXk7CgkJCQkJCWJyZWFrOyAvLyArMSB3ZWVrIG9uIGN0cmwgb3IgY29tbWFuZCArZG93bgoJCQkJZGVmYXVsdDogaGFuZGxlZCA9IGZhbHNlOwoJCQl9CgkJfSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09PSAzNiAmJiBldmVudC5jdHJsS2V5KSB7IC8vIGRpc3BsYXkgdGhlIGRhdGUgcGlja2VyIG9uIGN0cmwraG9tZQoJCQkkLmRhdGVwaWNrZXIuX3Nob3dEYXRlcGlja2VyKHRoaXMpOwoJCX0gZWxzZSB7CgkJCWhhbmRsZWQgPSBmYWxzZTsKCQl9CgoJCWlmIChoYW5kbGVkKSB7CgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCWV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoJCX0KCX0sCgoJLyogRmlsdGVyIGVudGVyZWQgY2hhcmFjdGVycyAtIGJhc2VkIG9uIGRhdGUgZm9ybWF0LiAqLwoJX2RvS2V5UHJlc3M6IGZ1bmN0aW9uKGV2ZW50KSB7CgkJdmFyIGNoYXJzLCBjaHIsCgkJCWluc3QgPSAkLmRhdGVwaWNrZXIuX2dldEluc3QoZXZlbnQudGFyZ2V0KTsKCgkJaWYgKCQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJjb25zdHJhaW5JbnB1dCIpKSB7CgkJCWNoYXJzID0gJC5kYXRlcGlja2VyLl9wb3NzaWJsZUNoYXJzKCQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJkYXRlRm9ybWF0IikpOwoJCQljaHIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGV2ZW50LmNoYXJDb2RlID09IG51bGwgPyBldmVudC5rZXlDb2RlIDogZXZlbnQuY2hhckNvZGUpOwoJCQlyZXR1cm4gZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5IHx8IChjaHIgPCAiICIgfHwgIWNoYXJzIHx8IGNoYXJzLmluZGV4T2YoY2hyKSA+IC0xKTsKCQl9Cgl9LAoKCS8qIFN5bmNocm9uaXNlIG1hbnVhbCBlbnRyeSBhbmQgZmllbGQvYWx0ZXJuYXRlIGZpZWxkLiAqLwoJX2RvS2V5VXA6IGZ1bmN0aW9uKGV2ZW50KSB7CgkJdmFyIGRhdGUsCgkJCWluc3QgPSAkLmRhdGVwaWNrZXIuX2dldEluc3QoZXZlbnQudGFyZ2V0KTsKCgkJaWYgKGluc3QuaW5wdXQudmFsKCkgIT09IGluc3QubGFzdFZhbCkgewoJCQl0cnkgewoJCQkJZGF0ZSA9ICQuZGF0ZXBpY2tlci5wYXJzZURhdGUoJC5kYXRlcGlja2VyLl9nZXQoaW5zdCwgImRhdGVGb3JtYXQiKSwKCQkJCQkoaW5zdC5pbnB1dCA/IGluc3QuaW5wdXQudmFsKCkgOiBudWxsKSwKCQkJCQkkLmRhdGVwaWNrZXIuX2dldEZvcm1hdENvbmZpZyhpbnN0KSk7CgoJCQkJaWYgKGRhdGUpIHsgLy8gb25seSBpZiB2YWxpZAoJCQkJCSQuZGF0ZXBpY2tlci5fc2V0RGF0ZUZyb21GaWVsZChpbnN0KTsKCQkJCQkkLmRhdGVwaWNrZXIuX3VwZGF0ZUFsdGVybmF0ZShpbnN0KTsKCQkJCQkkLmRhdGVwaWNrZXIuX3VwZGF0ZURhdGVwaWNrZXIoaW5zdCk7CgkJCQl9CgkJCX0KCQkJY2F0Y2ggKGVycikgewoJCQl9CgkJfQoJCXJldHVybiB0cnVlOwoJfSwKCgkvKiBQb3AtdXAgdGhlIGRhdGUgcGlja2VyIGZvciBhIGdpdmVuIGlucHV0IGZpZWxkLgoJICogSWYgZmFsc2UgcmV0dXJuZWQgZnJvbSBiZWZvcmVTaG93IGV2ZW50IGhhbmRsZXIgZG8gbm90IHNob3cuCgkgKiBAcGFyYW0gIGlucHV0ICBlbGVtZW50IC0gdGhlIGlucHV0IGZpZWxkIGF0dGFjaGVkIHRvIHRoZSBkYXRlIHBpY2tlciBvcgoJICoJCQkJCWV2ZW50IC0gaWYgdHJpZ2dlcmVkIGJ5IGZvY3VzCgkgKi8KCV9zaG93RGF0ZXBpY2tlcjogZnVuY3Rpb24oaW5wdXQpIHsKCQlpbnB1dCA9IGlucHV0LnRhcmdldCB8fCBpbnB1dDsKCQlpZiAoaW5wdXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPT0gImlucHV0IikgeyAvLyBmaW5kIGZyb20gYnV0dG9uL2ltYWdlIHRyaWdnZXIKCQkJaW5wdXQgPSAkKCJpbnB1dCIsIGlucHV0LnBhcmVudE5vZGUpWzBdOwoJCX0KCgkJaWYgKCQuZGF0ZXBpY2tlci5faXNEaXNhYmxlZERhdGVwaWNrZXIoaW5wdXQpIHx8ICQuZGF0ZXBpY2tlci5fbGFzdElucHV0ID09PSBpbnB1dCkgeyAvLyBhbHJlYWR5IGhlcmUKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIGluc3QsIGJlZm9yZVNob3csIGJlZm9yZVNob3dTZXR0aW5ncywgaXNGaXhlZCwKCQkJb2Zmc2V0LCBzaG93QW5pbSwgZHVyYXRpb247CgoJCWluc3QgPSAkLmRhdGVwaWNrZXIuX2dldEluc3QoaW5wdXQpOwoJCWlmICgkLmRhdGVwaWNrZXIuX2N1ckluc3QgJiYgJC5kYXRlcGlja2VyLl9jdXJJbnN0ICE9PSBpbnN0KSB7CgkJCSQuZGF0ZXBpY2tlci5fY3VySW5zdC5kcERpdi5zdG9wKHRydWUsIHRydWUpOwoJCQlpZiAoIGluc3QgJiYgJC5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyApIHsKCQkJCSQuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoICQuZGF0ZXBpY2tlci5fY3VySW5zdC5pbnB1dFswXSApOwoJCQl9CgkJfQoKCQliZWZvcmVTaG93ID0gJC5kYXRlcGlja2VyLl9nZXQoaW5zdCwgImJlZm9yZVNob3ciKTsKCQliZWZvcmVTaG93U2V0dGluZ3MgPSBiZWZvcmVTaG93ID8gYmVmb3JlU2hvdy5hcHBseShpbnB1dCwgW2lucHV0LCBpbnN0XSkgOiB7fTsKCQlpZihiZWZvcmVTaG93U2V0dGluZ3MgPT09IGZhbHNlKXsKCQkJcmV0dXJuOwoJCX0KCQlleHRlbmRSZW1vdmUoaW5zdC5zZXR0aW5ncywgYmVmb3JlU2hvd1NldHRpbmdzKTsKCgkJaW5zdC5sYXN0VmFsID0gbnVsbDsKCQkkLmRhdGVwaWNrZXIuX2xhc3RJbnB1dCA9IGlucHV0OwoJCSQuZGF0ZXBpY2tlci5fc2V0RGF0ZUZyb21GaWVsZChpbnN0KTsKCgkJaWYgKCQuZGF0ZXBpY2tlci5faW5EaWFsb2cpIHsgLy8gaGlkZSBjdXJzb3IKCQkJaW5wdXQudmFsdWUgPSAiIjsKCQl9CgkJaWYgKCEkLmRhdGVwaWNrZXIuX3BvcykgeyAvLyBwb3NpdGlvbiBiZWxvdyBpbnB1dAoJCQkkLmRhdGVwaWNrZXIuX3BvcyA9ICQuZGF0ZXBpY2tlci5fZmluZFBvcyhpbnB1dCk7CgkJCSQuZGF0ZXBpY2tlci5fcG9zWzFdICs9IGlucHV0Lm9mZnNldEhlaWdodDsgLy8gYWRkIHRoZSBoZWlnaHQKCQl9CgoJCWlzRml4ZWQgPSBmYWxzZTsKCQkkKGlucHV0KS5wYXJlbnRzKCkuZWFjaChmdW5jdGlvbigpIHsKCQkJaXNGaXhlZCB8PSAkKHRoaXMpLmNzcygicG9zaXRpb24iKSA9PT0gImZpeGVkIjsKCQkJcmV0dXJuICFpc0ZpeGVkOwoJCX0pOwoKCQlvZmZzZXQgPSB7bGVmdDogJC5kYXRlcGlja2VyLl9wb3NbMF0sIHRvcDogJC5kYXRlcGlja2VyLl9wb3NbMV19OwoJCSQuZGF0ZXBpY2tlci5fcG9zID0gbnVsbDsKCQkvL3RvIGF2b2lkIGZsYXNoZXMgb24gRmlyZWZveAoJCWluc3QuZHBEaXYuZW1wdHkoKTsKCQkvLyBkZXRlcm1pbmUgc2l6aW5nIG9mZnNjcmVlbgoJCWluc3QuZHBEaXYuY3NzKHtwb3NpdGlvbjogImFic29sdXRlIiwgZGlzcGxheTogImJsb2NrIiwgdG9wOiAiLTEwMDBweCJ9KTsKCQkkLmRhdGVwaWNrZXIuX3VwZGF0ZURhdGVwaWNrZXIoaW5zdCk7CgkJLy8gZml4IHdpZHRoIGZvciBkeW5hbWljIG51bWJlciBvZiBkYXRlIHBpY2tlcnMKCQkvLyBhbmQgYWRqdXN0IHBvc2l0aW9uIGJlZm9yZSBzaG93aW5nCgkJb2Zmc2V0ID0gJC5kYXRlcGlja2VyLl9jaGVja09mZnNldChpbnN0LCBvZmZzZXQsIGlzRml4ZWQpOwoJCWluc3QuZHBEaXYuY3NzKHtwb3NpdGlvbjogKCQuZGF0ZXBpY2tlci5faW5EaWFsb2cgJiYgJC5ibG9ja1VJID8KCQkJInN0YXRpYyIgOiAoaXNGaXhlZCA/ICJmaXhlZCIgOiAiYWJzb2x1dGUiKSksIGRpc3BsYXk6ICJub25lIiwKCQkJbGVmdDogb2Zmc2V0LmxlZnQgKyAicHgiLCB0b3A6IG9mZnNldC50b3AgKyAicHgifSk7CgoJCWlmICghaW5zdC5pbmxpbmUpIHsKCQkJc2hvd0FuaW0gPSAkLmRhdGVwaWNrZXIuX2dldChpbnN0LCAic2hvd0FuaW0iKTsKCQkJZHVyYXRpb24gPSAkLmRhdGVwaWNrZXIuX2dldChpbnN0LCAiZHVyYXRpb24iKTsKCQkJaW5zdC5kcERpdi56SW5kZXgoJChpbnB1dCkuekluZGV4KCkrMSk7CgkJCSQuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcgPSB0cnVlOwoKCQkJaWYgKCAkLmVmZmVjdHMgJiYgJC5lZmZlY3RzLmVmZmVjdFsgc2hvd0FuaW0gXSApIHsKCQkJCWluc3QuZHBEaXYuc2hvdyhzaG93QW5pbSwgJC5kYXRlcGlja2VyLl9nZXQoaW5zdCwgInNob3dPcHRpb25zIiksIGR1cmF0aW9uKTsKCQkJfSBlbHNlIHsKCQkJCWluc3QuZHBEaXZbc2hvd0FuaW0gfHwgInNob3ciXShzaG93QW5pbSA/IGR1cmF0aW9uIDogbnVsbCk7CgkJCX0KCgkJCWlmICggJC5kYXRlcGlja2VyLl9zaG91bGRGb2N1c0lucHV0KCBpbnN0ICkgKSB7CgkJCQlpbnN0LmlucHV0LmZvY3VzKCk7CgkJCX0KCgkJCSQuZGF0ZXBpY2tlci5fY3VySW5zdCA9IGluc3Q7CgkJfQoJfSwKCgkvKiBHZW5lcmF0ZSB0aGUgZGF0ZSBwaWNrZXIgY29udGVudC4gKi8KCV91cGRhdGVEYXRlcGlja2VyOiBmdW5jdGlvbihpbnN0KSB7CgkJdGhpcy5tYXhSb3dzID0gNDsgLy9SZXNldCB0aGUgbWF4IG51bWJlciBvZiByb3dzIGJlaW5nIGRpc3BsYXllZCAoc2VlICM3MDQzKQoJCWluc3RBY3RpdmUgPSBpbnN0OyAvLyBmb3IgZGVsZWdhdGUgaG92ZXIgZXZlbnRzCgkJaW5zdC5kcERpdi5lbXB0eSgpLmFwcGVuZCh0aGlzLl9nZW5lcmF0ZUhUTUwoaW5zdCkpOwoJCXRoaXMuX2F0dGFjaEhhbmRsZXJzKGluc3QpOwoJCWluc3QuZHBEaXYuZmluZCgiLiIgKyB0aGlzLl9kYXlPdmVyQ2xhc3MgKyAiIGEiKS5tb3VzZW92ZXIoKTsKCgkJdmFyIG9yaWd5ZWFyc2h0bWwsCgkJCW51bU1vbnRocyA9IHRoaXMuX2dldE51bWJlck9mTW9udGhzKGluc3QpLAoJCQljb2xzID0gbnVtTW9udGhzWzFdLAoJCQl3aWR0aCA9IDE3OwoKCQlpbnN0LmRwRGl2LnJlbW92ZUNsYXNzKCJ1aS1kYXRlcGlja2VyLW11bHRpLTIgdWktZGF0ZXBpY2tlci1tdWx0aS0zIHVpLWRhdGVwaWNrZXItbXVsdGktNCIpLndpZHRoKCIiKTsKCQlpZiAoY29scyA+IDEpIHsKCQkJaW5zdC5kcERpdi5hZGRDbGFzcygidWktZGF0ZXBpY2tlci1tdWx0aS0iICsgY29scykuY3NzKCJ3aWR0aCIsICh3aWR0aCAqIGNvbHMpICsgImVtIik7CgkJfQoJCWluc3QuZHBEaXZbKG51bU1vbnRoc1swXSAhPT0gMSB8fCBudW1Nb250aHNbMV0gIT09IDEgPyAiYWRkIiA6ICJyZW1vdmUiKSArCgkJCSJDbGFzcyJdKCJ1aS1kYXRlcGlja2VyLW11bHRpIik7CgkJaW5zdC5kcERpdlsodGhpcy5fZ2V0KGluc3QsICJpc1JUTCIpID8gImFkZCIgOiAicmVtb3ZlIikgKwoJCQkiQ2xhc3MiXSgidWktZGF0ZXBpY2tlci1ydGwiKTsKCgkJaWYgKGluc3QgPT09ICQuZGF0ZXBpY2tlci5fY3VySW5zdCAmJiAkLmRhdGVwaWNrZXIuX2RhdGVwaWNrZXJTaG93aW5nICYmICQuZGF0ZXBpY2tlci5fc2hvdWxkRm9jdXNJbnB1dCggaW5zdCApICkgewoJCQlpbnN0LmlucHV0LmZvY3VzKCk7CgkJfQoKCQkvLyBkZWZmZXJlZCByZW5kZXIgb2YgdGhlIHllYXJzIHNlbGVjdCAodG8gYXZvaWQgZmxhc2hlcyBvbiBGaXJlZm94KQoJCWlmKCBpbnN0LnllYXJzaHRtbCApewoJCQlvcmlneWVhcnNodG1sID0gaW5zdC55ZWFyc2h0bWw7CgkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKXsKCQkJCS8vYXNzdXJlIHRoYXQgaW5zdC55ZWFyc2h0bWwgZGlkbid0IGNoYW5nZS4KCQkJCWlmKCBvcmlneWVhcnNodG1sID09PSBpbnN0LnllYXJzaHRtbCAmJiBpbnN0LnllYXJzaHRtbCApewoJCQkJCWluc3QuZHBEaXYuZmluZCgic2VsZWN0LnVpLWRhdGVwaWNrZXIteWVhcjpmaXJzdCIpLnJlcGxhY2VXaXRoKGluc3QueWVhcnNodG1sKTsKCQkJCX0KCQkJCW9yaWd5ZWFyc2h0bWwgPSBpbnN0LnllYXJzaHRtbCA9IG51bGw7CgkJCX0sIDApOwoJCX0KCX0sCgoJLy8gIzY2OTQgLSBkb24ndCBmb2N1cyB0aGUgaW5wdXQgaWYgaXQncyBhbHJlYWR5IGZvY3VzZWQKCS8vIHRoaXMgYnJlYWtzIHRoZSBjaGFuZ2UgZXZlbnQgaW4gSUUKCS8vIFN1cHBvcnQ6IElFIGFuZCBqUXVlcnkgPDEuOQoJX3Nob3VsZEZvY3VzSW5wdXQ6IGZ1bmN0aW9uKCBpbnN0ICkgewoJCXJldHVybiBpbnN0LmlucHV0ICYmIGluc3QuaW5wdXQuaXMoICI6dmlzaWJsZSIgKSAmJiAhaW5zdC5pbnB1dC5pcyggIjpkaXNhYmxlZCIgKSAmJiAhaW5zdC5pbnB1dC5pcyggIjpmb2N1cyIgKTsKCX0sCgoJLyogQ2hlY2sgcG9zaXRpb25pbmcgdG8gcmVtYWluIG9uIHNjcmVlbi4gKi8KCV9jaGVja09mZnNldDogZnVuY3Rpb24oaW5zdCwgb2Zmc2V0LCBpc0ZpeGVkKSB7CgkJdmFyIGRwV2lkdGggPSBpbnN0LmRwRGl2Lm91dGVyV2lkdGgoKSwKCQkJZHBIZWlnaHQgPSBpbnN0LmRwRGl2Lm91dGVySGVpZ2h0KCksCgkJCWlucHV0V2lkdGggPSBpbnN0LmlucHV0ID8gaW5zdC5pbnB1dC5vdXRlcldpZHRoKCkgOiAwLAoJCQlpbnB1dEhlaWdodCA9IGluc3QuaW5wdXQgPyBpbnN0LmlucHV0Lm91dGVySGVpZ2h0KCkgOiAwLAoJCQl2aWV3V2lkdGggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggKyAoaXNGaXhlZCA/IDAgOiAkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkpLAoJCQl2aWV3SGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCArIChpc0ZpeGVkID8gMCA6ICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpKTsKCgkJb2Zmc2V0LmxlZnQgLT0gKHRoaXMuX2dldChpbnN0LCAiaXNSVEwiKSA/IChkcFdpZHRoIC0gaW5wdXRXaWR0aCkgOiAwKTsKCQlvZmZzZXQubGVmdCAtPSAoaXNGaXhlZCAmJiBvZmZzZXQubGVmdCA9PT0gaW5zdC5pbnB1dC5vZmZzZXQoKS5sZWZ0KSA/ICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSA6IDA7CgkJb2Zmc2V0LnRvcCAtPSAoaXNGaXhlZCAmJiBvZmZzZXQudG9wID09PSAoaW5zdC5pbnB1dC5vZmZzZXQoKS50b3AgKyBpbnB1dEhlaWdodCkpID8gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCkgOiAwOwoKCQkvLyBub3cgY2hlY2sgaWYgZGF0ZXBpY2tlciBpcyBzaG93aW5nIG91dHNpZGUgd2luZG93IHZpZXdwb3J0IC0gbW92ZSB0byBhIGJldHRlciBwbGFjZSBpZiBzby4KCQlvZmZzZXQubGVmdCAtPSBNYXRoLm1pbihvZmZzZXQubGVmdCwgKG9mZnNldC5sZWZ0ICsgZHBXaWR0aCA+IHZpZXdXaWR0aCAmJiB2aWV3V2lkdGggPiBkcFdpZHRoKSA/CgkJCU1hdGguYWJzKG9mZnNldC5sZWZ0ICsgZHBXaWR0aCAtIHZpZXdXaWR0aCkgOiAwKTsKCQlvZmZzZXQudG9wIC09IE1hdGgubWluKG9mZnNldC50b3AsIChvZmZzZXQudG9wICsgZHBIZWlnaHQgPiB2aWV3SGVpZ2h0ICYmIHZpZXdIZWlnaHQgPiBkcEhlaWdodCkgPwoJCQlNYXRoLmFicyhkcEhlaWdodCArIGlucHV0SGVpZ2h0KSA6IDApOwoKCQlyZXR1cm4gb2Zmc2V0OwoJfSwKCgkvKiBGaW5kIGFuIG9iamVjdCdzIHBvc2l0aW9uIG9uIHRoZSBzY3JlZW4uICovCglfZmluZFBvczogZnVuY3Rpb24ob2JqKSB7CgkJdmFyIHBvc2l0aW9uLAoJCQlpbnN0ID0gdGhpcy5fZ2V0SW5zdChvYmopLAoJCQlpc1JUTCA9IHRoaXMuX2dldChpbnN0LCAiaXNSVEwiKTsKCgkJd2hpbGUgKG9iaiAmJiAob2JqLnR5cGUgPT09ICJoaWRkZW4iIHx8IG9iai5ub2RlVHlwZSAhPT0gMSB8fCAkLmV4cHIuZmlsdGVycy5oaWRkZW4ob2JqKSkpIHsKCQkJb2JqID0gb2JqW2lzUlRMID8gInByZXZpb3VzU2libGluZyIgOiAibmV4dFNpYmxpbmciXTsKCQl9CgoJCXBvc2l0aW9uID0gJChvYmopLm9mZnNldCgpOwoJCXJldHVybiBbcG9zaXRpb24ubGVmdCwgcG9zaXRpb24udG9wXTsKCX0sCgoJLyogSGlkZSB0aGUgZGF0ZSBwaWNrZXIgZnJvbSB2aWV3LgoJICogQHBhcmFtICBpbnB1dCAgZWxlbWVudCAtIHRoZSBpbnB1dCBmaWVsZCBhdHRhY2hlZCB0byB0aGUgZGF0ZSBwaWNrZXIKCSAqLwoJX2hpZGVEYXRlcGlja2VyOiBmdW5jdGlvbihpbnB1dCkgewoJCXZhciBzaG93QW5pbSwgZHVyYXRpb24sIHBvc3RQcm9jZXNzLCBvbkNsb3NlLAoJCQlpbnN0ID0gdGhpcy5fY3VySW5zdDsKCgkJaWYgKCFpbnN0IHx8IChpbnB1dCAmJiBpbnN0ICE9PSAkLmRhdGEoaW5wdXQsIFBST1BfTkFNRSkpKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICh0aGlzLl9kYXRlcGlja2VyU2hvd2luZykgewoJCQlzaG93QW5pbSA9IHRoaXMuX2dldChpbnN0LCAic2hvd0FuaW0iKTsKCQkJZHVyYXRpb24gPSB0aGlzLl9nZXQoaW5zdCwgImR1cmF0aW9uIik7CgkJCXBvc3RQcm9jZXNzID0gZnVuY3Rpb24oKSB7CgkJCQkkLmRhdGVwaWNrZXIuX3RpZHlEaWFsb2coaW5zdCk7CgkJCX07CgoJCQkvLyBERVBSRUNBVEVEOiBhZnRlciBCQyBmb3IgMS44LnggJC5lZmZlY3RzWyBzaG93QW5pbSBdIGlzIG5vdCBuZWVkZWQKCQkJaWYgKCAkLmVmZmVjdHMgJiYgKCAkLmVmZmVjdHMuZWZmZWN0WyBzaG93QW5pbSBdIHx8ICQuZWZmZWN0c1sgc2hvd0FuaW0gXSApICkgewoJCQkJaW5zdC5kcERpdi5oaWRlKHNob3dBbmltLCAkLmRhdGVwaWNrZXIuX2dldChpbnN0LCAic2hvd09wdGlvbnMiKSwgZHVyYXRpb24sIHBvc3RQcm9jZXNzKTsKCQkJfSBlbHNlIHsKCQkJCWluc3QuZHBEaXZbKHNob3dBbmltID09PSAic2xpZGVEb3duIiA/ICJzbGlkZVVwIiA6CgkJCQkJKHNob3dBbmltID09PSAiZmFkZUluIiA/ICJmYWRlT3V0IiA6ICJoaWRlIikpXSgoc2hvd0FuaW0gPyBkdXJhdGlvbiA6IG51bGwpLCBwb3N0UHJvY2Vzcyk7CgkJCX0KCgkJCWlmICghc2hvd0FuaW0pIHsKCQkJCXBvc3RQcm9jZXNzKCk7CgkJCX0KCQkJdGhpcy5fZGF0ZXBpY2tlclNob3dpbmcgPSBmYWxzZTsKCgkJCW9uQ2xvc2UgPSB0aGlzLl9nZXQoaW5zdCwgIm9uQ2xvc2UiKTsKCQkJaWYgKG9uQ2xvc2UpIHsKCQkJCW9uQ2xvc2UuYXBwbHkoKGluc3QuaW5wdXQgPyBpbnN0LmlucHV0WzBdIDogbnVsbCksIFsoaW5zdC5pbnB1dCA/IGluc3QuaW5wdXQudmFsKCkgOiAiIiksIGluc3RdKTsKCQkJfQoKCQkJdGhpcy5fbGFzdElucHV0ID0gbnVsbDsKCQkJaWYgKHRoaXMuX2luRGlhbG9nKSB7CgkJCQl0aGlzLl9kaWFsb2dJbnB1dC5jc3MoeyBwb3NpdGlvbjogImFic29sdXRlIiwgbGVmdDogIjAiLCB0b3A6ICItMTAwcHgiIH0pOwoJCQkJaWYgKCQuYmxvY2tVSSkgewoJCQkJCSQudW5ibG9ja1VJKCk7CgkJCQkJJCgiYm9keSIpLmFwcGVuZCh0aGlzLmRwRGl2KTsKCQkJCX0KCQkJfQoJCQl0aGlzLl9pbkRpYWxvZyA9IGZhbHNlOwoJCX0KCX0sCgoJLyogVGlkeSB1cCBhZnRlciBhIGRpYWxvZyBkaXNwbGF5LiAqLwoJX3RpZHlEaWFsb2c6IGZ1bmN0aW9uKGluc3QpIHsKCQlpbnN0LmRwRGl2LnJlbW92ZUNsYXNzKHRoaXMuX2RpYWxvZ0NsYXNzKS51bmJpbmQoIi51aS1kYXRlcGlja2VyLWNhbGVuZGFyIik7Cgl9LAoKCS8qIENsb3NlIGRhdGUgcGlja2VyIGlmIGNsaWNrZWQgZWxzZXdoZXJlLiAqLwoJX2NoZWNrRXh0ZXJuYWxDbGljazogZnVuY3Rpb24oZXZlbnQpIHsKCQlpZiAoISQuZGF0ZXBpY2tlci5fY3VySW5zdCkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgJHRhcmdldCA9ICQoZXZlbnQudGFyZ2V0KSwKCQkJaW5zdCA9ICQuZGF0ZXBpY2tlci5fZ2V0SW5zdCgkdGFyZ2V0WzBdKTsKCgkJaWYgKCAoICggJHRhcmdldFswXS5pZCAhPT0gJC5kYXRlcGlja2VyLl9tYWluRGl2SWQgJiYKCQkJCSR0YXJnZXQucGFyZW50cygiIyIgKyAkLmRhdGVwaWNrZXIuX21haW5EaXZJZCkubGVuZ3RoID09PSAwICYmCgkJCQkhJHRhcmdldC5oYXNDbGFzcygkLmRhdGVwaWNrZXIubWFya2VyQ2xhc3NOYW1lKSAmJgoJCQkJISR0YXJnZXQuY2xvc2VzdCgiLiIgKyAkLmRhdGVwaWNrZXIuX3RyaWdnZXJDbGFzcykubGVuZ3RoICYmCgkJCQkkLmRhdGVwaWNrZXIuX2RhdGVwaWNrZXJTaG93aW5nICYmICEoJC5kYXRlcGlja2VyLl9pbkRpYWxvZyAmJiAkLmJsb2NrVUkpICkgKSB8fAoJCQkoICR0YXJnZXQuaGFzQ2xhc3MoJC5kYXRlcGlja2VyLm1hcmtlckNsYXNzTmFtZSkgJiYgJC5kYXRlcGlja2VyLl9jdXJJbnN0ICE9PSBpbnN0ICkgKSB7CgkJCQkkLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7CgkJfQoJfSwKCgkvKiBBZGp1c3Qgb25lIG9mIHRoZSBkYXRlIHN1Yi1maWVsZHMuICovCglfYWRqdXN0RGF0ZTogZnVuY3Rpb24oaWQsIG9mZnNldCwgcGVyaW9kKSB7CgkJdmFyIHRhcmdldCA9ICQoaWQpLAoJCQlpbnN0ID0gdGhpcy5fZ2V0SW5zdCh0YXJnZXRbMF0pOwoKCQlpZiAodGhpcy5faXNEaXNhYmxlZERhdGVwaWNrZXIodGFyZ2V0WzBdKSkgewoJCQlyZXR1cm47CgkJfQoJCXRoaXMuX2FkanVzdEluc3REYXRlKGluc3QsIG9mZnNldCArCgkJCShwZXJpb2QgPT09ICJNIiA/IHRoaXMuX2dldChpbnN0LCAic2hvd0N1cnJlbnRBdFBvcyIpIDogMCksIC8vIHVuZG8gcG9zaXRpb25pbmcKCQkJcGVyaW9kKTsKCQl0aGlzLl91cGRhdGVEYXRlcGlja2VyKGluc3QpOwoJfSwKCgkvKiBBY3Rpb24gZm9yIGN1cnJlbnQgbGluay4gKi8KCV9nb3RvVG9kYXk6IGZ1bmN0aW9uKGlkKSB7CgkJdmFyIGRhdGUsCgkJCXRhcmdldCA9ICQoaWQpLAoJCQlpbnN0ID0gdGhpcy5fZ2V0SW5zdCh0YXJnZXRbMF0pOwoKCQlpZiAodGhpcy5fZ2V0KGluc3QsICJnb3RvQ3VycmVudCIpICYmIGluc3QuY3VycmVudERheSkgewoJCQlpbnN0LnNlbGVjdGVkRGF5ID0gaW5zdC5jdXJyZW50RGF5OwoJCQlpbnN0LmRyYXdNb250aCA9IGluc3Quc2VsZWN0ZWRNb250aCA9IGluc3QuY3VycmVudE1vbnRoOwoJCQlpbnN0LmRyYXdZZWFyID0gaW5zdC5zZWxlY3RlZFllYXIgPSBpbnN0LmN1cnJlbnRZZWFyOwoJCX0gZWxzZSB7CgkJCWRhdGUgPSBuZXcgRGF0ZSgpOwoJCQlpbnN0LnNlbGVjdGVkRGF5ID0gZGF0ZS5nZXREYXRlKCk7CgkJCWluc3QuZHJhd01vbnRoID0gaW5zdC5zZWxlY3RlZE1vbnRoID0gZGF0ZS5nZXRNb250aCgpOwoJCQlpbnN0LmRyYXdZZWFyID0gaW5zdC5zZWxlY3RlZFllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7CgkJfQoJCXRoaXMuX25vdGlmeUNoYW5nZShpbnN0KTsKCQl0aGlzLl9hZGp1c3REYXRlKHRhcmdldCk7Cgl9LAoKCS8qIEFjdGlvbiBmb3Igc2VsZWN0aW5nIGEgbmV3IG1vbnRoL3llYXIuICovCglfc2VsZWN0TW9udGhZZWFyOiBmdW5jdGlvbihpZCwgc2VsZWN0LCBwZXJpb2QpIHsKCQl2YXIgdGFyZ2V0ID0gJChpZCksCgkJCWluc3QgPSB0aGlzLl9nZXRJbnN0KHRhcmdldFswXSk7CgoJCWluc3RbInNlbGVjdGVkIiArIChwZXJpb2QgPT09ICJNIiA/ICJNb250aCIgOiAiWWVhciIpXSA9CgkJaW5zdFsiZHJhdyIgKyAocGVyaW9kID09PSAiTSIgPyAiTW9udGgiIDogIlllYXIiKV0gPQoJCQlwYXJzZUludChzZWxlY3Qub3B0aW9uc1tzZWxlY3Quc2VsZWN0ZWRJbmRleF0udmFsdWUsMTApOwoKCQl0aGlzLl9ub3RpZnlDaGFuZ2UoaW5zdCk7CgkJdGhpcy5fYWRqdXN0RGF0ZSh0YXJnZXQpOwoJfSwKCgkvKiBBY3Rpb24gZm9yIHNlbGVjdGluZyBhIGRheS4gKi8KCV9zZWxlY3REYXk6IGZ1bmN0aW9uKGlkLCBtb250aCwgeWVhciwgdGQpIHsKCQl2YXIgaW5zdCwKCQkJdGFyZ2V0ID0gJChpZCk7CgoJCWlmICgkKHRkKS5oYXNDbGFzcyh0aGlzLl91bnNlbGVjdGFibGVDbGFzcykgfHwgdGhpcy5faXNEaXNhYmxlZERhdGVwaWNrZXIodGFyZ2V0WzBdKSkgewoJCQlyZXR1cm47CgkJfQoKCQlpbnN0ID0gdGhpcy5fZ2V0SW5zdCh0YXJnZXRbMF0pOwoJCWluc3Quc2VsZWN0ZWREYXkgPSBpbnN0LmN1cnJlbnREYXkgPSAkKCJhIiwgdGQpLmh0bWwoKTsKCQlpbnN0LnNlbGVjdGVkTW9udGggPSBpbnN0LmN1cnJlbnRNb250aCA9IG1vbnRoOwoJCWluc3Quc2VsZWN0ZWRZZWFyID0gaW5zdC5jdXJyZW50WWVhciA9IHllYXI7CgkJdGhpcy5fc2VsZWN0RGF0ZShpZCwgdGhpcy5fZm9ybWF0RGF0ZShpbnN0LAoJCQlpbnN0LmN1cnJlbnREYXksIGluc3QuY3VycmVudE1vbnRoLCBpbnN0LmN1cnJlbnRZZWFyKSk7Cgl9LAoKCS8qIEVyYXNlIHRoZSBpbnB1dCBmaWVsZCBhbmQgaGlkZSB0aGUgZGF0ZSBwaWNrZXIuICovCglfY2xlYXJEYXRlOiBmdW5jdGlvbihpZCkgewoJCXZhciB0YXJnZXQgPSAkKGlkKTsKCQl0aGlzLl9zZWxlY3REYXRlKHRhcmdldCwgIiIpOwoJfSwKCgkvKiBVcGRhdGUgdGhlIGlucHV0IGZpZWxkIHdpdGggdGhlIHNlbGVjdGVkIGRhdGUuICovCglfc2VsZWN0RGF0ZTogZnVuY3Rpb24oaWQsIGRhdGVTdHIpIHsKCQl2YXIgb25TZWxlY3QsCgkJCXRhcmdldCA9ICQoaWQpLAoJCQlpbnN0ID0gdGhpcy5fZ2V0SW5zdCh0YXJnZXRbMF0pOwoKCQlkYXRlU3RyID0gKGRhdGVTdHIgIT0gbnVsbCA/IGRhdGVTdHIgOiB0aGlzLl9mb3JtYXREYXRlKGluc3QpKTsKCQlpZiAoaW5zdC5pbnB1dCkgewoJCQlpbnN0LmlucHV0LnZhbChkYXRlU3RyKTsKCQl9CgkJdGhpcy5fdXBkYXRlQWx0ZXJuYXRlKGluc3QpOwoKCQlvblNlbGVjdCA9IHRoaXMuX2dldChpbnN0LCAib25TZWxlY3QiKTsKCQlpZiAob25TZWxlY3QpIHsKCQkJb25TZWxlY3QuYXBwbHkoKGluc3QuaW5wdXQgPyBpbnN0LmlucHV0WzBdIDogbnVsbCksIFtkYXRlU3RyLCBpbnN0XSk7ICAvLyB0cmlnZ2VyIGN1c3RvbSBjYWxsYmFjawoJCX0gZWxzZSBpZiAoaW5zdC5pbnB1dCkgewoJCQlpbnN0LmlucHV0LnRyaWdnZXIoImNoYW5nZSIpOyAvLyBmaXJlIHRoZSBjaGFuZ2UgZXZlbnQKCQl9CgoJCWlmIChpbnN0LmlubGluZSl7CgkJCXRoaXMuX3VwZGF0ZURhdGVwaWNrZXIoaW5zdCk7CgkJfSBlbHNlIHsKCQkJdGhpcy5faGlkZURhdGVwaWNrZXIoKTsKCQkJdGhpcy5fbGFzdElucHV0ID0gaW5zdC5pbnB1dFswXTsKCQkJaWYgKHR5cGVvZihpbnN0LmlucHV0WzBdKSAhPT0gIm9iamVjdCIpIHsKCQkJCWluc3QuaW5wdXQuZm9jdXMoKTsgLy8gcmVzdG9yZSBmb2N1cwoJCQl9CgkJCXRoaXMuX2xhc3RJbnB1dCA9IG51bGw7CgkJfQoJfSwKCgkvKiBVcGRhdGUgYW55IGFsdGVybmF0ZSBmaWVsZCB0byBzeW5jaHJvbmlzZSB3aXRoIHRoZSBtYWluIGZpZWxkLiAqLwoJX3VwZGF0ZUFsdGVybmF0ZTogZnVuY3Rpb24oaW5zdCkgewoJCXZhciBhbHRGb3JtYXQsIGRhdGUsIGRhdGVTdHIsCgkJCWFsdEZpZWxkID0gdGhpcy5fZ2V0KGluc3QsICJhbHRGaWVsZCIpOwoKCQlpZiAoYWx0RmllbGQpIHsgLy8gdXBkYXRlIGFsdGVybmF0ZSBmaWVsZCB0b28KCQkJYWx0Rm9ybWF0ID0gdGhpcy5fZ2V0KGluc3QsICJhbHRGb3JtYXQiKSB8fCB0aGlzLl9nZXQoaW5zdCwgImRhdGVGb3JtYXQiKTsKCQkJZGF0ZSA9IHRoaXMuX2dldERhdGUoaW5zdCk7CgkJCWRhdGVTdHIgPSB0aGlzLmZvcm1hdERhdGUoYWx0Rm9ybWF0LCBkYXRlLCB0aGlzLl9nZXRGb3JtYXRDb25maWcoaW5zdCkpOwoJCQkkKGFsdEZpZWxkKS5lYWNoKGZ1bmN0aW9uKCkgeyAkKHRoaXMpLnZhbChkYXRlU3RyKTsgfSk7CgkJfQoJfSwKCgkvKiBTZXQgYXMgYmVmb3JlU2hvd0RheSBmdW5jdGlvbiB0byBwcmV2ZW50IHNlbGVjdGlvbiBvZiB3ZWVrZW5kcy4KCSAqIEBwYXJhbSAgZGF0ZSAgRGF0ZSAtIHRoZSBkYXRlIHRvIGN1c3RvbWlzZQoJICogQHJldHVybiBbYm9vbGVhbiwgc3RyaW5nXSAtIGlzIHRoaXMgZGF0ZSBzZWxlY3RhYmxlPywgd2hhdCBpcyBpdHMgQ1NTIGNsYXNzPwoJICovCglub1dlZWtlbmRzOiBmdW5jdGlvbihkYXRlKSB7CgkJdmFyIGRheSA9IGRhdGUuZ2V0RGF5KCk7CgkJcmV0dXJuIFsoZGF5ID4gMCAmJiBkYXkgPCA2KSwgIiJdOwoJfSwKCgkvKiBTZXQgYXMgY2FsY3VsYXRlV2VlayB0byBkZXRlcm1pbmUgdGhlIHdlZWsgb2YgdGhlIHllYXIgYmFzZWQgb24gdGhlIElTTyA4NjAxIGRlZmluaXRpb24uCgkgKiBAcGFyYW0gIGRhdGUgIERhdGUgLSB0aGUgZGF0ZSB0byBnZXQgdGhlIHdlZWsgZm9yCgkgKiBAcmV0dXJuICBudW1iZXIgLSB0aGUgbnVtYmVyIG9mIHRoZSB3ZWVrIHdpdGhpbiB0aGUgeWVhciB0aGF0IGNvbnRhaW5zIHRoaXMgZGF0ZQoJICovCglpc284NjAxV2VlazogZnVuY3Rpb24oZGF0ZSkgewoJCXZhciB0aW1lLAoJCQljaGVja0RhdGUgPSBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSk7CgoJCS8vIEZpbmQgVGh1cnNkYXkgb2YgdGhpcyB3ZWVrIHN0YXJ0aW5nIG9uIE1vbmRheQoJCWNoZWNrRGF0ZS5zZXREYXRlKGNoZWNrRGF0ZS5nZXREYXRlKCkgKyA0IC0gKGNoZWNrRGF0ZS5nZXREYXkoKSB8fCA3KSk7CgoJCXRpbWUgPSBjaGVja0RhdGUuZ2V0VGltZSgpOwoJCWNoZWNrRGF0ZS5zZXRNb250aCgwKTsgLy8gQ29tcGFyZSB3aXRoIEphbiAxCgkJY2hlY2tEYXRlLnNldERhdGUoMSk7CgkJcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yb3VuZCgodGltZSAtIGNoZWNrRGF0ZSkgLyA4NjQwMDAwMCkgLyA3KSArIDE7Cgl9LAoKCS8qIFBhcnNlIGEgc3RyaW5nIHZhbHVlIGludG8gYSBkYXRlIG9iamVjdC4KCSAqIFNlZSBmb3JtYXREYXRlIGJlbG93IGZvciB0aGUgcG9zc2libGUgZm9ybWF0cy4KCSAqCgkgKiBAcGFyYW0gIGZvcm1hdCBzdHJpbmcgLSB0aGUgZXhwZWN0ZWQgZm9ybWF0IG9mIHRoZSBkYXRlCgkgKiBAcGFyYW0gIHZhbHVlIHN0cmluZyAtIHRoZSBkYXRlIGluIHRoZSBhYm92ZSBmb3JtYXQKCSAqIEBwYXJhbSAgc2V0dGluZ3MgT2JqZWN0IC0gYXR0cmlidXRlcyBpbmNsdWRlOgoJICoJCQkJCXNob3J0WWVhckN1dG9mZiAgbnVtYmVyIC0gdGhlIGN1dG9mZiB5ZWFyIGZvciBkZXRlcm1pbmluZyB0aGUgY2VudHVyeSAob3B0aW9uYWwpCgkgKgkJCQkJZGF5TmFtZXNTaG9ydAlzdHJpbmdbN10gLSBhYmJyZXZpYXRlZCBuYW1lcyBvZiB0aGUgZGF5cyBmcm9tIFN1bmRheSAob3B0aW9uYWwpCgkgKgkJCQkJZGF5TmFtZXMJCXN0cmluZ1s3XSAtIG5hbWVzIG9mIHRoZSBkYXlzIGZyb20gU3VuZGF5IChvcHRpb25hbCkKCSAqCQkJCQltb250aE5hbWVzU2hvcnQgc3RyaW5nWzEyXSAtIGFiYnJldmlhdGVkIG5hbWVzIG9mIHRoZSBtb250aHMgKG9wdGlvbmFsKQoJICoJCQkJCW1vbnRoTmFtZXMJCXN0cmluZ1sxMl0gLSBuYW1lcyBvZiB0aGUgbW9udGhzIChvcHRpb25hbCkKCSAqIEByZXR1cm4gIERhdGUgLSB0aGUgZXh0cmFjdGVkIGRhdGUgdmFsdWUgb3IgbnVsbCBpZiB2YWx1ZSBpcyBibGFuawoJICovCglwYXJzZURhdGU6IGZ1bmN0aW9uIChmb3JtYXQsIHZhbHVlLCBzZXR0aW5ncykgewoJCWlmIChmb3JtYXQgPT0gbnVsbCB8fCB2YWx1ZSA9PSBudWxsKSB7CgkJCXRocm93ICJJbnZhbGlkIGFyZ3VtZW50cyI7CgkJfQoKCQl2YWx1ZSA9ICh0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiID8gdmFsdWUudG9TdHJpbmcoKSA6IHZhbHVlICsgIiIpOwoJCWlmICh2YWx1ZSA9PT0gIiIpIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQl2YXIgaUZvcm1hdCwgZGltLCBleHRyYSwKCQkJaVZhbHVlID0gMCwKCQkJc2hvcnRZZWFyQ3V0b2ZmVGVtcCA9IChzZXR0aW5ncyA/IHNldHRpbmdzLnNob3J0WWVhckN1dG9mZiA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLnNob3J0WWVhckN1dG9mZiwKCQkJc2hvcnRZZWFyQ3V0b2ZmID0gKHR5cGVvZiBzaG9ydFllYXJDdXRvZmZUZW1wICE9PSAic3RyaW5nIiA/IHNob3J0WWVhckN1dG9mZlRlbXAgOgoJCQkJbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpICUgMTAwICsgcGFyc2VJbnQoc2hvcnRZZWFyQ3V0b2ZmVGVtcCwgMTApKSwKCQkJZGF5TmFtZXNTaG9ydCA9IChzZXR0aW5ncyA/IHNldHRpbmdzLmRheU5hbWVzU2hvcnQgOiBudWxsKSB8fCB0aGlzLl9kZWZhdWx0cy5kYXlOYW1lc1Nob3J0LAoJCQlkYXlOYW1lcyA9IChzZXR0aW5ncyA/IHNldHRpbmdzLmRheU5hbWVzIDogbnVsbCkgfHwgdGhpcy5fZGVmYXVsdHMuZGF5TmFtZXMsCgkJCW1vbnRoTmFtZXNTaG9ydCA9IChzZXR0aW5ncyA/IHNldHRpbmdzLm1vbnRoTmFtZXNTaG9ydCA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLm1vbnRoTmFtZXNTaG9ydCwKCQkJbW9udGhOYW1lcyA9IChzZXR0aW5ncyA/IHNldHRpbmdzLm1vbnRoTmFtZXMgOiBudWxsKSB8fCB0aGlzLl9kZWZhdWx0cy5tb250aE5hbWVzLAoJCQl5ZWFyID0gLTEsCgkJCW1vbnRoID0gLTEsCgkJCWRheSA9IC0xLAoJCQlkb3kgPSAtMSwKCQkJbGl0ZXJhbCA9IGZhbHNlLAoJCQlkYXRlLAoJCQkvLyBDaGVjayB3aGV0aGVyIGEgZm9ybWF0IGNoYXJhY3RlciBpcyBkb3VibGVkCgkJCWxvb2tBaGVhZCA9IGZ1bmN0aW9uKG1hdGNoKSB7CgkJCQl2YXIgbWF0Y2hlcyA9IChpRm9ybWF0ICsgMSA8IGZvcm1hdC5sZW5ndGggJiYgZm9ybWF0LmNoYXJBdChpRm9ybWF0ICsgMSkgPT09IG1hdGNoKTsKCQkJCWlmIChtYXRjaGVzKSB7CgkJCQkJaUZvcm1hdCsrOwoJCQkJfQoJCQkJcmV0dXJuIG1hdGNoZXM7CgkJCX0sCgkJCS8vIEV4dHJhY3QgYSBudW1iZXIgZnJvbSB0aGUgc3RyaW5nIHZhbHVlCgkJCWdldE51bWJlciA9IGZ1bmN0aW9uKG1hdGNoKSB7CgkJCQl2YXIgaXNEb3VibGVkID0gbG9va0FoZWFkKG1hdGNoKSwKCQkJCQlzaXplID0gKG1hdGNoID09PSAiQCIgPyAxNCA6IChtYXRjaCA9PT0gIiEiID8gMjAgOgoJCQkJCShtYXRjaCA9PT0gInkiICYmIGlzRG91YmxlZCA/IDQgOiAobWF0Y2ggPT09ICJvIiA/IDMgOiAyKSkpKSwKCQkJCQlkaWdpdHMgPSBuZXcgUmVnRXhwKCJeXFxkezEsIiArIHNpemUgKyAifSIpLAoJCQkJCW51bSA9IHZhbHVlLnN1YnN0cmluZyhpVmFsdWUpLm1hdGNoKGRpZ2l0cyk7CgkJCQlpZiAoIW51bSkgewoJCQkJCXRocm93ICJNaXNzaW5nIG51bWJlciBhdCBwb3NpdGlvbiAiICsgaVZhbHVlOwoJCQkJfQoJCQkJaVZhbHVlICs9IG51bVswXS5sZW5ndGg7CgkJCQlyZXR1cm4gcGFyc2VJbnQobnVtWzBdLCAxMCk7CgkJCX0sCgkJCS8vIEV4dHJhY3QgYSBuYW1lIGZyb20gdGhlIHN0cmluZyB2YWx1ZSBhbmQgY29udmVydCB0byBhbiBpbmRleAoJCQlnZXROYW1lID0gZnVuY3Rpb24obWF0Y2gsIHNob3J0TmFtZXMsIGxvbmdOYW1lcykgewoJCQkJdmFyIGluZGV4ID0gLTEsCgkJCQkJbmFtZXMgPSAkLm1hcChsb29rQWhlYWQobWF0Y2gpID8gbG9uZ05hbWVzIDogc2hvcnROYW1lcywgZnVuY3Rpb24gKHYsIGspIHsKCQkJCQkJcmV0dXJuIFsgW2ssIHZdIF07CgkJCQkJfSkuc29ydChmdW5jdGlvbiAoYSwgYikgewoJCQkJCQlyZXR1cm4gLShhWzFdLmxlbmd0aCAtIGJbMV0ubGVuZ3RoKTsKCQkJCQl9KTsKCgkJCQkkLmVhY2gobmFtZXMsIGZ1bmN0aW9uIChpLCBwYWlyKSB7CgkJCQkJdmFyIG5hbWUgPSBwYWlyWzFdOwoJCQkJCWlmICh2YWx1ZS5zdWJzdHIoaVZhbHVlLCBuYW1lLmxlbmd0aCkudG9Mb3dlckNhc2UoKSA9PT0gbmFtZS50b0xvd2VyQ2FzZSgpKSB7CgkJCQkJCWluZGV4ID0gcGFpclswXTsKCQkJCQkJaVZhbHVlICs9IG5hbWUubGVuZ3RoOwoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfSk7CgkJCQlpZiAoaW5kZXggIT09IC0xKSB7CgkJCQkJcmV0dXJuIGluZGV4ICsgMTsKCQkJCX0gZWxzZSB7CgkJCQkJdGhyb3cgIlVua25vd24gbmFtZSBhdCBwb3NpdGlvbiAiICsgaVZhbHVlOwoJCQkJfQoJCQl9LAoJCQkvLyBDb25maXJtIHRoYXQgYSBsaXRlcmFsIGNoYXJhY3RlciBtYXRjaGVzIHRoZSBzdHJpbmcgdmFsdWUKCQkJY2hlY2tMaXRlcmFsID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAodmFsdWUuY2hhckF0KGlWYWx1ZSkgIT09IGZvcm1hdC5jaGFyQXQoaUZvcm1hdCkpIHsKCQkJCQl0aHJvdyAiVW5leHBlY3RlZCBsaXRlcmFsIGF0IHBvc2l0aW9uICIgKyBpVmFsdWU7CgkJCQl9CgkJCQlpVmFsdWUrKzsKCQkJfTsKCgkJZm9yIChpRm9ybWF0ID0gMDsgaUZvcm1hdCA8IGZvcm1hdC5sZW5ndGg7IGlGb3JtYXQrKykgewoJCQlpZiAobGl0ZXJhbCkgewoJCQkJaWYgKGZvcm1hdC5jaGFyQXQoaUZvcm1hdCkgPT09ICInIiAmJiAhbG9va0FoZWFkKCInIikpIHsKCQkJCQlsaXRlcmFsID0gZmFsc2U7CgkJCQl9IGVsc2UgewoJCQkJCWNoZWNrTGl0ZXJhbCgpOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJc3dpdGNoIChmb3JtYXQuY2hhckF0KGlGb3JtYXQpKSB7CgkJCQkJY2FzZSAiZCI6CgkJCQkJCWRheSA9IGdldE51bWJlcigiZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEIjoKCQkJCQkJZ2V0TmFtZSgiRCIsIGRheU5hbWVzU2hvcnQsIGRheU5hbWVzKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAibyI6CgkJCQkJCWRveSA9IGdldE51bWJlcigibyIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJtIjoKCQkJCQkJbW9udGggPSBnZXROdW1iZXIoIm0iKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiTSI6CgkJCQkJCW1vbnRoID0gZ2V0TmFtZSgiTSIsIG1vbnRoTmFtZXNTaG9ydCwgbW9udGhOYW1lcyk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInkiOgoJCQkJCQl5ZWFyID0gZ2V0TnVtYmVyKCJ5Iik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkAiOgoJCQkJCQlkYXRlID0gbmV3IERhdGUoZ2V0TnVtYmVyKCJAIikpOwoJCQkJCQl5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOwoJCQkJCQltb250aCA9IGRhdGUuZ2V0TW9udGgoKSArIDE7CgkJCQkJCWRheSA9IGRhdGUuZ2V0RGF0ZSgpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICIhIjoKCQkJCQkJZGF0ZSA9IG5ldyBEYXRlKChnZXROdW1iZXIoIiEiKSAtIHRoaXMuX3RpY2tzVG8xOTcwKSAvIDEwMDAwKTsKCQkJCQkJeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCQkJCQkJbW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAxOwoJCQkJCQlkYXkgPSBkYXRlLmdldERhdGUoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiJyI6CgkJCQkJCWlmIChsb29rQWhlYWQoIiciKSl7CgkJCQkJCQljaGVja0xpdGVyYWwoKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCWxpdGVyYWwgPSB0cnVlOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWNoZWNrTGl0ZXJhbCgpOwoJCQkJfQoJCQl9CgkJfQoKCQlpZiAoaVZhbHVlIDwgdmFsdWUubGVuZ3RoKXsKCQkJZXh0cmEgPSB2YWx1ZS5zdWJzdHIoaVZhbHVlKTsKCQkJaWYgKCEvXlxzKy8udGVzdChleHRyYSkpIHsKCQkJCXRocm93ICJFeHRyYS91bnBhcnNlZCBjaGFyYWN0ZXJzIGZvdW5kIGluIGRhdGU6ICIgKyBleHRyYTsKCQkJfQoJCX0KCgkJaWYgKHllYXIgPT09IC0xKSB7CgkJCXllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7CgkJfSBlbHNlIGlmICh5ZWFyIDwgMTAwKSB7CgkJCXllYXIgKz0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpIC0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpICUgMTAwICsKCQkJCSh5ZWFyIDw9IHNob3J0WWVhckN1dG9mZiA/IDAgOiAtMTAwKTsKCQl9CgoJCWlmIChkb3kgPiAtMSkgewoJCQltb250aCA9IDE7CgkJCWRheSA9IGRveTsKCQkJZG8gewoJCQkJZGltID0gdGhpcy5fZ2V0RGF5c0luTW9udGgoeWVhciwgbW9udGggLSAxKTsKCQkJCWlmIChkYXkgPD0gZGltKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQltb250aCsrOwoJCQkJZGF5IC09IGRpbTsKCQkJfSB3aGlsZSAodHJ1ZSk7CgkJfQoKCQlkYXRlID0gdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXkpKTsKCQlpZiAoZGF0ZS5nZXRGdWxsWWVhcigpICE9PSB5ZWFyIHx8IGRhdGUuZ2V0TW9udGgoKSArIDEgIT09IG1vbnRoIHx8IGRhdGUuZ2V0RGF0ZSgpICE9PSBkYXkpIHsKCQkJdGhyb3cgIkludmFsaWQgZGF0ZSI7IC8vIEUuZy4gMzEvMDIvMDAKCQl9CgkJcmV0dXJuIGRhdGU7Cgl9LAoKCS8qIFN0YW5kYXJkIGRhdGUgZm9ybWF0cy4gKi8KCUFUT006ICJ5eS1tbS1kZCIsIC8vIFJGQyAzMzM5IChJU08gODYwMSkKCUNPT0tJRTogIkQsIGRkIE0geXkiLAoJSVNPXzg2MDE6ICJ5eS1tbS1kZCIsCglSRkNfODIyOiAiRCwgZCBNIHkiLAoJUkZDXzg1MDogIkRELCBkZC1NLXkiLAoJUkZDXzEwMzY6ICJELCBkIE0geSIsCglSRkNfMTEyMzogIkQsIGQgTSB5eSIsCglSRkNfMjgyMjogIkQsIGQgTSB5eSIsCglSU1M6ICJELCBkIE0geSIsIC8vIFJGQyA4MjIKCVRJQ0tTOiAiISIsCglUSU1FU1RBTVA6ICJAIiwKCVczQzogInl5LW1tLWRkIiwgLy8gSVNPIDg2MDEKCglfdGlja3NUbzE5NzA6ICgoKDE5NzAgLSAxKSAqIDM2NSArIE1hdGguZmxvb3IoMTk3MCAvIDQpIC0gTWF0aC5mbG9vcigxOTcwIC8gMTAwKSArCgkJTWF0aC5mbG9vcigxOTcwIC8gNDAwKSkgKiAyNCAqIDYwICogNjAgKiAxMDAwMDAwMCksCgoJLyogRm9ybWF0IGEgZGF0ZSBvYmplY3QgaW50byBhIHN0cmluZyB2YWx1ZS4KCSAqIFRoZSBmb3JtYXQgY2FuIGJlIGNvbWJpbmF0aW9ucyBvZiB0aGUgZm9sbG93aW5nOgoJICogZCAgLSBkYXkgb2YgbW9udGggKG5vIGxlYWRpbmcgemVybykKCSAqIGRkIC0gZGF5IG9mIG1vbnRoICh0d28gZGlnaXQpCgkgKiBvICAtIGRheSBvZiB5ZWFyIChubyBsZWFkaW5nIHplcm9zKQoJICogb28gLSBkYXkgb2YgeWVhciAodGhyZWUgZGlnaXQpCgkgKiBEICAtIGRheSBuYW1lIHNob3J0CgkgKiBERCAtIGRheSBuYW1lIGxvbmcKCSAqIG0gIC0gbW9udGggb2YgeWVhciAobm8gbGVhZGluZyB6ZXJvKQoJICogbW0gLSBtb250aCBvZiB5ZWFyICh0d28gZGlnaXQpCgkgKiBNICAtIG1vbnRoIG5hbWUgc2hvcnQKCSAqIE1NIC0gbW9udGggbmFtZSBsb25nCgkgKiB5ICAtIHllYXIgKHR3byBkaWdpdCkKCSAqIHl5IC0geWVhciAoZm91ciBkaWdpdCkKCSAqIEAgLSBVbml4IHRpbWVzdGFtcCAobXMgc2luY2UgMDEvMDEvMTk3MCkKCSAqICEgLSBXaW5kb3dzIHRpY2tzICgxMDBucyBzaW5jZSAwMS8wMS8wMDAxKQoJICogIi4uLiIgLSBsaXRlcmFsIHRleHQKCSAqICcnIC0gc2luZ2xlIHF1b3RlCgkgKgoJICogQHBhcmFtICBmb3JtYXQgc3RyaW5nIC0gdGhlIGRlc2lyZWQgZm9ybWF0IG9mIHRoZSBkYXRlCgkgKiBAcGFyYW0gIGRhdGUgRGF0ZSAtIHRoZSBkYXRlIHZhbHVlIHRvIGZvcm1hdAoJICogQHBhcmFtICBzZXR0aW5ncyBPYmplY3QgLSBhdHRyaWJ1dGVzIGluY2x1ZGU6CgkgKgkJCQkJZGF5TmFtZXNTaG9ydAlzdHJpbmdbN10gLSBhYmJyZXZpYXRlZCBuYW1lcyBvZiB0aGUgZGF5cyBmcm9tIFN1bmRheSAob3B0aW9uYWwpCgkgKgkJCQkJZGF5TmFtZXMJCXN0cmluZ1s3XSAtIG5hbWVzIG9mIHRoZSBkYXlzIGZyb20gU3VuZGF5IChvcHRpb25hbCkKCSAqCQkJCQltb250aE5hbWVzU2hvcnQgc3RyaW5nWzEyXSAtIGFiYnJldmlhdGVkIG5hbWVzIG9mIHRoZSBtb250aHMgKG9wdGlvbmFsKQoJICoJCQkJCW1vbnRoTmFtZXMJCXN0cmluZ1sxMl0gLSBuYW1lcyBvZiB0aGUgbW9udGhzIChvcHRpb25hbCkKCSAqIEByZXR1cm4gIHN0cmluZyAtIHRoZSBkYXRlIGluIHRoZSBhYm92ZSBmb3JtYXQKCSAqLwoJZm9ybWF0RGF0ZTogZnVuY3Rpb24gKGZvcm1hdCwgZGF0ZSwgc2V0dGluZ3MpIHsKCQlpZiAoIWRhdGUpIHsKCQkJcmV0dXJuICIiOwoJCX0KCgkJdmFyIGlGb3JtYXQsCgkJCWRheU5hbWVzU2hvcnQgPSAoc2V0dGluZ3MgPyBzZXR0aW5ncy5kYXlOYW1lc1Nob3J0IDogbnVsbCkgfHwgdGhpcy5fZGVmYXVsdHMuZGF5TmFtZXNTaG9ydCwKCQkJZGF5TmFtZXMgPSAoc2V0dGluZ3MgPyBzZXR0aW5ncy5kYXlOYW1lcyA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLmRheU5hbWVzLAoJCQltb250aE5hbWVzU2hvcnQgPSAoc2V0dGluZ3MgPyBzZXR0aW5ncy5tb250aE5hbWVzU2hvcnQgOiBudWxsKSB8fCB0aGlzLl9kZWZhdWx0cy5tb250aE5hbWVzU2hvcnQsCgkJCW1vbnRoTmFtZXMgPSAoc2V0dGluZ3MgPyBzZXR0aW5ncy5tb250aE5hbWVzIDogbnVsbCkgfHwgdGhpcy5fZGVmYXVsdHMubW9udGhOYW1lcywKCQkJLy8gQ2hlY2sgd2hldGhlciBhIGZvcm1hdCBjaGFyYWN0ZXIgaXMgZG91YmxlZAoJCQlsb29rQWhlYWQgPSBmdW5jdGlvbihtYXRjaCkgewoJCQkJdmFyIG1hdGNoZXMgPSAoaUZvcm1hdCArIDEgPCBmb3JtYXQubGVuZ3RoICYmIGZvcm1hdC5jaGFyQXQoaUZvcm1hdCArIDEpID09PSBtYXRjaCk7CgkJCQlpZiAobWF0Y2hlcykgewoJCQkJCWlGb3JtYXQrKzsKCQkJCX0KCQkJCXJldHVybiBtYXRjaGVzOwoJCQl9LAoJCQkvLyBGb3JtYXQgYSBudW1iZXIsIHdpdGggbGVhZGluZyB6ZXJvIGlmIG5lY2Vzc2FyeQoJCQlmb3JtYXROdW1iZXIgPSBmdW5jdGlvbihtYXRjaCwgdmFsdWUsIGxlbikgewoJCQkJdmFyIG51bSA9ICIiICsgdmFsdWU7CgkJCQlpZiAobG9va0FoZWFkKG1hdGNoKSkgewoJCQkJCXdoaWxlIChudW0ubGVuZ3RoIDwgbGVuKSB7CgkJCQkJCW51bSA9ICIwIiArIG51bTsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gbnVtOwoJCQl9LAoJCQkvLyBGb3JtYXQgYSBuYW1lLCBzaG9ydCBvciBsb25nIGFzIHJlcXVlc3RlZAoJCQlmb3JtYXROYW1lID0gZnVuY3Rpb24obWF0Y2gsIHZhbHVlLCBzaG9ydE5hbWVzLCBsb25nTmFtZXMpIHsKCQkJCXJldHVybiAobG9va0FoZWFkKG1hdGNoKSA/IGxvbmdOYW1lc1t2YWx1ZV0gOiBzaG9ydE5hbWVzW3ZhbHVlXSk7CgkJCX0sCgkJCW91dHB1dCA9ICIiLAoJCQlsaXRlcmFsID0gZmFsc2U7CgoJCWlmIChkYXRlKSB7CgkJCWZvciAoaUZvcm1hdCA9IDA7IGlGb3JtYXQgPCBmb3JtYXQubGVuZ3RoOyBpRm9ybWF0KyspIHsKCQkJCWlmIChsaXRlcmFsKSB7CgkJCQkJaWYgKGZvcm1hdC5jaGFyQXQoaUZvcm1hdCkgPT09ICInIiAmJiAhbG9va0FoZWFkKCInIikpIHsKCQkJCQkJbGl0ZXJhbCA9IGZhbHNlOwoJCQkJCX0gZWxzZSB7CgkJCQkJCW91dHB1dCArPSBmb3JtYXQuY2hhckF0KGlGb3JtYXQpOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJc3dpdGNoIChmb3JtYXQuY2hhckF0KGlGb3JtYXQpKSB7CgkJCQkJCWNhc2UgImQiOgoJCQkJCQkJb3V0cHV0ICs9IGZvcm1hdE51bWJlcigiZCIsIGRhdGUuZ2V0RGF0ZSgpLCAyKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICJEIjoKCQkJCQkJCW91dHB1dCArPSBmb3JtYXROYW1lKCJEIiwgZGF0ZS5nZXREYXkoKSwgZGF5TmFtZXNTaG9ydCwgZGF5TmFtZXMpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgIm8iOgoJCQkJCQkJb3V0cHV0ICs9IGZvcm1hdE51bWJlcigibyIsCgkJCQkJCQkJTWF0aC5yb3VuZCgobmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCksIGRhdGUuZ2V0RGF0ZSgpKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIDAsIDApLmdldFRpbWUoKSkgLyA4NjQwMDAwMCksIDMpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgIm0iOgoJCQkJCQkJb3V0cHV0ICs9IGZvcm1hdE51bWJlcigibSIsIGRhdGUuZ2V0TW9udGgoKSArIDEsIDIpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgIk0iOgoJCQkJCQkJb3V0cHV0ICs9IGZvcm1hdE5hbWUoIk0iLCBkYXRlLmdldE1vbnRoKCksIG1vbnRoTmFtZXNTaG9ydCwgbW9udGhOYW1lcyk7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAieSI6CgkJCQkJCQlvdXRwdXQgKz0gKGxvb2tBaGVhZCgieSIpID8gZGF0ZS5nZXRGdWxsWWVhcigpIDoKCQkJCQkJCQkoZGF0ZS5nZXRZZWFyKCkgJSAxMDAgPCAxMCA/ICIwIiA6ICIiKSArIGRhdGUuZ2V0WWVhcigpICUgMTAwKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICJAIjoKCQkJCQkJCW91dHB1dCArPSBkYXRlLmdldFRpbWUoKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICIhIjoKCQkJCQkJCW91dHB1dCArPSBkYXRlLmdldFRpbWUoKSAqIDEwMDAwICsgdGhpcy5fdGlja3NUbzE5NzA7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAiJyI6CgkJCQkJCQlpZiAobG9va0FoZWFkKCInIikpIHsKCQkJCQkJCQlvdXRwdXQgKz0gIiciOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlsaXRlcmFsID0gdHJ1ZTsKCQkJCQkJCX0KCQkJCQkJCWJyZWFrOwoJCQkJCQlkZWZhdWx0OgoJCQkJCQkJb3V0cHV0ICs9IGZvcm1hdC5jaGFyQXQoaUZvcm1hdCk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBvdXRwdXQ7Cgl9LAoKCS8qIEV4dHJhY3QgYWxsIHBvc3NpYmxlIGNoYXJhY3RlcnMgZnJvbSB0aGUgZGF0ZSBmb3JtYXQuICovCglfcG9zc2libGVDaGFyczogZnVuY3Rpb24gKGZvcm1hdCkgewoJCXZhciBpRm9ybWF0LAoJCQljaGFycyA9ICIiLAoJCQlsaXRlcmFsID0gZmFsc2UsCgkJCS8vIENoZWNrIHdoZXRoZXIgYSBmb3JtYXQgY2hhcmFjdGVyIGlzIGRvdWJsZWQKCQkJbG9va0FoZWFkID0gZnVuY3Rpb24obWF0Y2gpIHsKCQkJCXZhciBtYXRjaGVzID0gKGlGb3JtYXQgKyAxIDwgZm9ybWF0Lmxlbmd0aCAmJiBmb3JtYXQuY2hhckF0KGlGb3JtYXQgKyAxKSA9PT0gbWF0Y2gpOwoJCQkJaWYgKG1hdGNoZXMpIHsKCQkJCQlpRm9ybWF0Kys7CgkJCQl9CgkJCQlyZXR1cm4gbWF0Y2hlczsKCQkJfTsKCgkJZm9yIChpRm9ybWF0ID0gMDsgaUZvcm1hdCA8IGZvcm1hdC5sZW5ndGg7IGlGb3JtYXQrKykgewoJCQlpZiAobGl0ZXJhbCkgewoJCQkJaWYgKGZvcm1hdC5jaGFyQXQoaUZvcm1hdCkgPT09ICInIiAmJiAhbG9va0FoZWFkKCInIikpIHsKCQkJCQlsaXRlcmFsID0gZmFsc2U7CgkJCQl9IGVsc2UgewoJCQkJCWNoYXJzICs9IGZvcm1hdC5jaGFyQXQoaUZvcm1hdCk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlzd2l0Y2ggKGZvcm1hdC5jaGFyQXQoaUZvcm1hdCkpIHsKCQkJCQljYXNlICJkIjogY2FzZSAibSI6IGNhc2UgInkiOiBjYXNlICJAIjoKCQkJCQkJY2hhcnMgKz0gIjAxMjM0NTY3ODkiOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEIjogY2FzZSAiTSI6CgkJCQkJCXJldHVybiBudWxsOyAvLyBBY2NlcHQgYW55dGhpbmcKCQkJCQljYXNlICInIjoKCQkJCQkJaWYgKGxvb2tBaGVhZCgiJyIpKSB7CgkJCQkJCQljaGFycyArPSAiJyI7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlsaXRlcmFsID0gdHJ1ZTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQljaGFycyArPSBmb3JtYXQuY2hhckF0KGlGb3JtYXQpOwoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBjaGFyczsKCX0sCgoJLyogR2V0IGEgc2V0dGluZyB2YWx1ZSwgZGVmYXVsdGluZyBpZiBuZWNlc3NhcnkuICovCglfZ2V0OiBmdW5jdGlvbihpbnN0LCBuYW1lKSB7CgkJcmV0dXJuIGluc3Quc2V0dGluZ3NbbmFtZV0gIT09IHVuZGVmaW5lZCA/CgkJCWluc3Quc2V0dGluZ3NbbmFtZV0gOiB0aGlzLl9kZWZhdWx0c1tuYW1lXTsKCX0sCgoJLyogUGFyc2UgZXhpc3RpbmcgZGF0ZSBhbmQgaW5pdGlhbGlzZSBkYXRlIHBpY2tlci4gKi8KCV9zZXREYXRlRnJvbUZpZWxkOiBmdW5jdGlvbihpbnN0LCBub0RlZmF1bHQpIHsKCQlpZiAoaW5zdC5pbnB1dC52YWwoKSA9PT0gaW5zdC5sYXN0VmFsKSB7CgkJCXJldHVybjsKCQl9CgoJCXZhciBkYXRlRm9ybWF0ID0gdGhpcy5fZ2V0KGluc3QsICJkYXRlRm9ybWF0IiksCgkJCWRhdGVzID0gaW5zdC5sYXN0VmFsID0gaW5zdC5pbnB1dCA/IGluc3QuaW5wdXQudmFsKCkgOiBudWxsLAoJCQlkZWZhdWx0RGF0ZSA9IHRoaXMuX2dldERlZmF1bHREYXRlKGluc3QpLAoJCQlkYXRlID0gZGVmYXVsdERhdGUsCgkJCXNldHRpbmdzID0gdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGluc3QpOwoKCQl0cnkgewoJCQlkYXRlID0gdGhpcy5wYXJzZURhdGUoZGF0ZUZvcm1hdCwgZGF0ZXMsIHNldHRpbmdzKSB8fCBkZWZhdWx0RGF0ZTsKCQl9IGNhdGNoIChldmVudCkgewoJCQlkYXRlcyA9IChub0RlZmF1bHQgPyAiIiA6IGRhdGVzKTsKCQl9CgkJaW5zdC5zZWxlY3RlZERheSA9IGRhdGUuZ2V0RGF0ZSgpOwoJCWluc3QuZHJhd01vbnRoID0gaW5zdC5zZWxlY3RlZE1vbnRoID0gZGF0ZS5nZXRNb250aCgpOwoJCWluc3QuZHJhd1llYXIgPSBpbnN0LnNlbGVjdGVkWWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCQlpbnN0LmN1cnJlbnREYXkgPSAoZGF0ZXMgPyBkYXRlLmdldERhdGUoKSA6IDApOwoJCWluc3QuY3VycmVudE1vbnRoID0gKGRhdGVzID8gZGF0ZS5nZXRNb250aCgpIDogMCk7CgkJaW5zdC5jdXJyZW50WWVhciA9IChkYXRlcyA/IGRhdGUuZ2V0RnVsbFllYXIoKSA6IDApOwoJCXRoaXMuX2FkanVzdEluc3REYXRlKGluc3QpOwoJfSwKCgkvKiBSZXRyaWV2ZSB0aGUgZGVmYXVsdCBkYXRlIHNob3duIG9uIG9wZW5pbmcuICovCglfZ2V0RGVmYXVsdERhdGU6IGZ1bmN0aW9uKGluc3QpIHsKCQlyZXR1cm4gdGhpcy5fcmVzdHJpY3RNaW5NYXgoaW5zdCwKCQkJdGhpcy5fZGV0ZXJtaW5lRGF0ZShpbnN0LCB0aGlzLl9nZXQoaW5zdCwgImRlZmF1bHREYXRlIiksIG5ldyBEYXRlKCkpKTsKCX0sCgoJLyogQSBkYXRlIG1heSBiZSBzcGVjaWZpZWQgYXMgYW4gZXhhY3QgdmFsdWUgb3IgYSByZWxhdGl2ZSBvbmUuICovCglfZGV0ZXJtaW5lRGF0ZTogZnVuY3Rpb24oaW5zdCwgZGF0ZSwgZGVmYXVsdERhdGUpIHsKCQl2YXIgb2Zmc2V0TnVtZXJpYyA9IGZ1bmN0aW9uKG9mZnNldCkgewoJCQkJdmFyIGRhdGUgPSBuZXcgRGF0ZSgpOwoJCQkJZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpICsgb2Zmc2V0KTsKCQkJCXJldHVybiBkYXRlOwoJCQl9LAoJCQlvZmZzZXRTdHJpbmcgPSBmdW5jdGlvbihvZmZzZXQpIHsKCQkJCXRyeSB7CgkJCQkJcmV0dXJuICQuZGF0ZXBpY2tlci5wYXJzZURhdGUoJC5kYXRlcGlja2VyLl9nZXQoaW5zdCwgImRhdGVGb3JtYXQiKSwKCQkJCQkJb2Zmc2V0LCAkLmRhdGVwaWNrZXIuX2dldEZvcm1hdENvbmZpZyhpbnN0KSk7CgkJCQl9CgkJCQljYXRjaCAoZSkgewoJCQkJCS8vIElnbm9yZQoJCQkJfQoKCQkJCXZhciBkYXRlID0gKG9mZnNldC50b0xvd2VyQ2FzZSgpLm1hdGNoKC9eYy8pID8KCQkJCQkkLmRhdGVwaWNrZXIuX2dldERhdGUoaW5zdCkgOiBudWxsKSB8fCBuZXcgRGF0ZSgpLAoJCQkJCXllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCksCgkJCQkJbW9udGggPSBkYXRlLmdldE1vbnRoKCksCgkJCQkJZGF5ID0gZGF0ZS5nZXREYXRlKCksCgkJCQkJcGF0dGVybiA9IC8oWytcLV0/WzAtOV0rKVxzKihkfER8d3xXfG18TXx5fFkpPy9nLAoJCQkJCW1hdGNoZXMgPSBwYXR0ZXJuLmV4ZWMob2Zmc2V0KTsKCgkJCQl3aGlsZSAobWF0Y2hlcykgewoJCQkJCXN3aXRjaCAobWF0Y2hlc1syXSB8fCAiZCIpIHsKCQkJCQkJY2FzZSAiZCIgOiBjYXNlICJEIiA6CgkJCQkJCQlkYXkgKz0gcGFyc2VJbnQobWF0Y2hlc1sxXSwxMCk7IGJyZWFrOwoJCQkJCQljYXNlICJ3IiA6IGNhc2UgIlciIDoKCQkJCQkJCWRheSArPSBwYXJzZUludChtYXRjaGVzWzFdLDEwKSAqIDc7IGJyZWFrOwoJCQkJCQljYXNlICJtIiA6IGNhc2UgIk0iIDoKCQkJCQkJCW1vbnRoICs9IHBhcnNlSW50KG1hdGNoZXNbMV0sMTApOwoJCQkJCQkJZGF5ID0gTWF0aC5taW4oZGF5LCAkLmRhdGVwaWNrZXIuX2dldERheXNJbk1vbnRoKHllYXIsIG1vbnRoKSk7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAieSI6IGNhc2UgIlkiIDoKCQkJCQkJCXllYXIgKz0gcGFyc2VJbnQobWF0Y2hlc1sxXSwxMCk7CgkJCQkJCQlkYXkgPSBNYXRoLm1pbihkYXksICQuZGF0ZXBpY2tlci5fZ2V0RGF5c0luTW9udGgoeWVhciwgbW9udGgpKTsKCQkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQltYXRjaGVzID0gcGF0dGVybi5leGVjKG9mZnNldCk7CgkJCQl9CgkJCQlyZXR1cm4gbmV3IERhdGUoeWVhciwgbW9udGgsIGRheSk7CgkJCX0sCgkJCW5ld0RhdGUgPSAoZGF0ZSA9PSBudWxsIHx8IGRhdGUgPT09ICIiID8gZGVmYXVsdERhdGUgOiAodHlwZW9mIGRhdGUgPT09ICJzdHJpbmciID8gb2Zmc2V0U3RyaW5nKGRhdGUpIDoKCQkJCSh0eXBlb2YgZGF0ZSA9PT0gIm51bWJlciIgPyAoaXNOYU4oZGF0ZSkgPyBkZWZhdWx0RGF0ZSA6IG9mZnNldE51bWVyaWMoZGF0ZSkpIDogbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpKSkpOwoKCQluZXdEYXRlID0gKG5ld0RhdGUgJiYgbmV3RGF0ZS50b1N0cmluZygpID09PSAiSW52YWxpZCBEYXRlIiA/IGRlZmF1bHREYXRlIDogbmV3RGF0ZSk7CgkJaWYgKG5ld0RhdGUpIHsKCQkJbmV3RGF0ZS5zZXRIb3VycygwKTsKCQkJbmV3RGF0ZS5zZXRNaW51dGVzKDApOwoJCQluZXdEYXRlLnNldFNlY29uZHMoMCk7CgkJCW5ld0RhdGUuc2V0TWlsbGlzZWNvbmRzKDApOwoJCX0KCQlyZXR1cm4gdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3RGF0ZSk7Cgl9LAoKCS8qIEhhbmRsZSBzd2l0Y2ggdG8vZnJvbSBkYXlsaWdodCBzYXZpbmcuCgkgKiBIb3VycyBtYXkgYmUgbm9uLXplcm8gb24gZGF5bGlnaHQgc2F2aW5nIGN1dC1vdmVyOgoJICogPiAxMiB3aGVuIG1pZG5pZ2h0IGNoYW5nZW92ZXIsIGJ1dCB0aGVuIGNhbm5vdCBnZW5lcmF0ZQoJICogbWlkbmlnaHQgZGF0ZXRpbWUsIHNvIGp1bXAgdG8gMUFNLCBvdGhlcndpc2UgcmVzZXQuCgkgKiBAcGFyYW0gIGRhdGUgIChEYXRlKSB0aGUgZGF0ZSB0byBjaGVjawoJICogQHJldHVybiAgKERhdGUpIHRoZSBjb3JyZWN0ZWQgZGF0ZQoJICovCglfZGF5bGlnaHRTYXZpbmdBZGp1c3Q6IGZ1bmN0aW9uKGRhdGUpIHsKCQlpZiAoIWRhdGUpIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoJCWRhdGUuc2V0SG91cnMoZGF0ZS5nZXRIb3VycygpID4gMTIgPyBkYXRlLmdldEhvdXJzKCkgKyAyIDogMCk7CgkJcmV0dXJuIGRhdGU7Cgl9LAoKCS8qIFNldCB0aGUgZGF0ZShzKSBkaXJlY3RseS4gKi8KCV9zZXREYXRlOiBmdW5jdGlvbihpbnN0LCBkYXRlLCBub0NoYW5nZSkgewoJCXZhciBjbGVhciA9ICFkYXRlLAoJCQlvcmlnTW9udGggPSBpbnN0LnNlbGVjdGVkTW9udGgsCgkJCW9yaWdZZWFyID0gaW5zdC5zZWxlY3RlZFllYXIsCgkJCW5ld0RhdGUgPSB0aGlzLl9yZXN0cmljdE1pbk1heChpbnN0LCB0aGlzLl9kZXRlcm1pbmVEYXRlKGluc3QsIGRhdGUsIG5ldyBEYXRlKCkpKTsKCgkJaW5zdC5zZWxlY3RlZERheSA9IGluc3QuY3VycmVudERheSA9IG5ld0RhdGUuZ2V0RGF0ZSgpOwoJCWluc3QuZHJhd01vbnRoID0gaW5zdC5zZWxlY3RlZE1vbnRoID0gaW5zdC5jdXJyZW50TW9udGggPSBuZXdEYXRlLmdldE1vbnRoKCk7CgkJaW5zdC5kcmF3WWVhciA9IGluc3Quc2VsZWN0ZWRZZWFyID0gaW5zdC5jdXJyZW50WWVhciA9IG5ld0RhdGUuZ2V0RnVsbFllYXIoKTsKCQlpZiAoKG9yaWdNb250aCAhPT0gaW5zdC5zZWxlY3RlZE1vbnRoIHx8IG9yaWdZZWFyICE9PSBpbnN0LnNlbGVjdGVkWWVhcikgJiYgIW5vQ2hhbmdlKSB7CgkJCXRoaXMuX25vdGlmeUNoYW5nZShpbnN0KTsKCQl9CgkJdGhpcy5fYWRqdXN0SW5zdERhdGUoaW5zdCk7CgkJaWYgKGluc3QuaW5wdXQpIHsKCQkJaW5zdC5pbnB1dC52YWwoY2xlYXIgPyAiIiA6IHRoaXMuX2Zvcm1hdERhdGUoaW5zdCkpOwoJCX0KCX0sCgoJLyogUmV0cmlldmUgdGhlIGRhdGUocykgZGlyZWN0bHkuICovCglfZ2V0RGF0ZTogZnVuY3Rpb24oaW5zdCkgewoJCXZhciBzdGFydERhdGUgPSAoIWluc3QuY3VycmVudFllYXIgfHwgKGluc3QuaW5wdXQgJiYgaW5zdC5pbnB1dC52YWwoKSA9PT0gIiIpID8gbnVsbCA6CgkJCXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKAoJCQlpbnN0LmN1cnJlbnRZZWFyLCBpbnN0LmN1cnJlbnRNb250aCwgaW5zdC5jdXJyZW50RGF5KSkpOwoJCQlyZXR1cm4gc3RhcnREYXRlOwoJfSwKCgkvKiBBdHRhY2ggdGhlIG9ueHh4IGhhbmRsZXJzLiAgVGhlc2UgYXJlIGRlY2xhcmVkIHN0YXRpY2FsbHkgc28KCSAqIHRoZXkgd29yayB3aXRoIHN0YXRpYyBjb2RlIHRyYW5zZm9ybWVycyBsaWtlIENhamEuCgkgKi8KCV9hdHRhY2hIYW5kbGVyczogZnVuY3Rpb24oaW5zdCkgewoJCXZhciBzdGVwTW9udGhzID0gdGhpcy5fZ2V0KGluc3QsICJzdGVwTW9udGhzIiksCgkJCWlkID0gIiMiICsgaW5zdC5pZC5yZXBsYWNlKCAvXFxcXC9nLCAiXFwiICk7CgkJaW5zdC5kcERpdi5maW5kKCJbZGF0YS1oYW5kbGVyXSIpLm1hcChmdW5jdGlvbiAoKSB7CgkJCXZhciBoYW5kbGVyID0gewoJCQkJcHJldjogZnVuY3Rpb24gKCkgewoJCQkJCSQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShpZCwgLXN0ZXBNb250aHMsICJNIik7CgkJCQl9LAoJCQkJbmV4dDogZnVuY3Rpb24gKCkgewoJCQkJCSQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShpZCwgK3N0ZXBNb250aHMsICJNIik7CgkJCQl9LAoJCQkJaGlkZTogZnVuY3Rpb24gKCkgewoJCQkJCSQuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKTsKCQkJCX0sCgkJCQl0b2RheTogZnVuY3Rpb24gKCkgewoJCQkJCSQuZGF0ZXBpY2tlci5fZ290b1RvZGF5KGlkKTsKCQkJCX0sCgkJCQlzZWxlY3REYXk6IGZ1bmN0aW9uICgpIHsKCQkJCQkkLmRhdGVwaWNrZXIuX3NlbGVjdERheShpZCwgK3RoaXMuZ2V0QXR0cmlidXRlKCJkYXRhLW1vbnRoIiksICt0aGlzLmdldEF0dHJpYnV0ZSgiZGF0YS15ZWFyIiksIHRoaXMpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0sCgkJCQlzZWxlY3RNb250aDogZnVuY3Rpb24gKCkgewoJCQkJCSQuZGF0ZXBpY2tlci5fc2VsZWN0TW9udGhZZWFyKGlkLCB0aGlzLCAiTSIpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0sCgkJCQlzZWxlY3RZZWFyOiBmdW5jdGlvbiAoKSB7CgkJCQkJJC5kYXRlcGlja2VyLl9zZWxlY3RNb250aFllYXIoaWQsIHRoaXMsICJZIik7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9OwoJCQkkKHRoaXMpLmJpbmQodGhpcy5nZXRBdHRyaWJ1dGUoImRhdGEtZXZlbnQiKSwgaGFuZGxlclt0aGlzLmdldEF0dHJpYnV0ZSgiZGF0YS1oYW5kbGVyIildKTsKCQl9KTsKCX0sCgoJLyogR2VuZXJhdGUgdGhlIEhUTUwgZm9yIHRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBkYXRlIHBpY2tlci4gKi8KCV9nZW5lcmF0ZUhUTUw6IGZ1bmN0aW9uKGluc3QpIHsKCQl2YXIgbWF4RHJhdywgcHJldlRleHQsIHByZXYsIG5leHRUZXh0LCBuZXh0LCBjdXJyZW50VGV4dCwgZ290b0RhdGUsCgkJCWNvbnRyb2xzLCBidXR0b25QYW5lbCwgZmlyc3REYXksIHNob3dXZWVrLCBkYXlOYW1lcywgZGF5TmFtZXNNaW4sCgkJCW1vbnRoTmFtZXMsIG1vbnRoTmFtZXNTaG9ydCwgYmVmb3JlU2hvd0RheSwgc2hvd090aGVyTW9udGhzLAoJCQlzZWxlY3RPdGhlck1vbnRocywgZGVmYXVsdERhdGUsIGh0bWwsIGRvdywgcm93LCBncm91cCwgY29sLCBzZWxlY3RlZERhdGUsCgkJCWNvcm5lckNsYXNzLCBjYWxlbmRlciwgdGhlYWQsIGRheSwgZGF5c0luTW9udGgsIGxlYWREYXlzLCBjdXJSb3dzLCBudW1Sb3dzLAoJCQlwcmludERhdGUsIGRSb3csIHRib2R5LCBkYXlTZXR0aW5ncywgb3RoZXJNb250aCwgdW5zZWxlY3RhYmxlLAoJCQl0ZW1wRGF0ZSA9IG5ldyBEYXRlKCksCgkJCXRvZGF5ID0gdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QoCgkJCQluZXcgRGF0ZSh0ZW1wRGF0ZS5nZXRGdWxsWWVhcigpLCB0ZW1wRGF0ZS5nZXRNb250aCgpLCB0ZW1wRGF0ZS5nZXREYXRlKCkpKSwgLy8gY2xlYXIgdGltZQoJCQlpc1JUTCA9IHRoaXMuX2dldChpbnN0LCAiaXNSVEwiKSwKCQkJc2hvd0J1dHRvblBhbmVsID0gdGhpcy5fZ2V0KGluc3QsICJzaG93QnV0dG9uUGFuZWwiKSwKCQkJaGlkZUlmTm9QcmV2TmV4dCA9IHRoaXMuX2dldChpbnN0LCAiaGlkZUlmTm9QcmV2TmV4dCIpLAoJCQluYXZpZ2F0aW9uQXNEYXRlRm9ybWF0ID0gdGhpcy5fZ2V0KGluc3QsICJuYXZpZ2F0aW9uQXNEYXRlRm9ybWF0IiksCgkJCW51bU1vbnRocyA9IHRoaXMuX2dldE51bWJlck9mTW9udGhzKGluc3QpLAoJCQlzaG93Q3VycmVudEF0UG9zID0gdGhpcy5fZ2V0KGluc3QsICJzaG93Q3VycmVudEF0UG9zIiksCgkJCXN0ZXBNb250aHMgPSB0aGlzLl9nZXQoaW5zdCwgInN0ZXBNb250aHMiKSwKCQkJaXNNdWx0aU1vbnRoID0gKG51bU1vbnRoc1swXSAhPT0gMSB8fCBudW1Nb250aHNbMV0gIT09IDEpLAoJCQljdXJyZW50RGF0ZSA9IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KCghaW5zdC5jdXJyZW50RGF5ID8gbmV3IERhdGUoOTk5OSwgOSwgOSkgOgoJCQkJbmV3IERhdGUoaW5zdC5jdXJyZW50WWVhciwgaW5zdC5jdXJyZW50TW9udGgsIGluc3QuY3VycmVudERheSkpKSwKCQkJbWluRGF0ZSA9IHRoaXMuX2dldE1pbk1heERhdGUoaW5zdCwgIm1pbiIpLAoJCQltYXhEYXRlID0gdGhpcy5fZ2V0TWluTWF4RGF0ZShpbnN0LCAibWF4IiksCgkJCWRyYXdNb250aCA9IGluc3QuZHJhd01vbnRoIC0gc2hvd0N1cnJlbnRBdFBvcywKCQkJZHJhd1llYXIgPSBpbnN0LmRyYXdZZWFyOwoKCQlpZiAoZHJhd01vbnRoIDwgMCkgewoJCQlkcmF3TW9udGggKz0gMTI7CgkJCWRyYXdZZWFyLS07CgkJfQoJCWlmIChtYXhEYXRlKSB7CgkJCW1heERyYXcgPSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShtYXhEYXRlLmdldEZ1bGxZZWFyKCksCgkJCQltYXhEYXRlLmdldE1vbnRoKCkgLSAobnVtTW9udGhzWzBdICogbnVtTW9udGhzWzFdKSArIDEsIG1heERhdGUuZ2V0RGF0ZSgpKSk7CgkJCW1heERyYXcgPSAobWluRGF0ZSAmJiBtYXhEcmF3IDwgbWluRGF0ZSA/IG1pbkRhdGUgOiBtYXhEcmF3KTsKCQkJd2hpbGUgKHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGRyYXdZZWFyLCBkcmF3TW9udGgsIDEpKSA+IG1heERyYXcpIHsKCQkJCWRyYXdNb250aC0tOwoJCQkJaWYgKGRyYXdNb250aCA8IDApIHsKCQkJCQlkcmF3TW9udGggPSAxMTsKCQkJCQlkcmF3WWVhci0tOwoJCQkJfQoJCQl9CgkJfQoJCWluc3QuZHJhd01vbnRoID0gZHJhd01vbnRoOwoJCWluc3QuZHJhd1llYXIgPSBkcmF3WWVhcjsKCgkJcHJldlRleHQgPSB0aGlzLl9nZXQoaW5zdCwgInByZXZUZXh0Iik7CgkJcHJldlRleHQgPSAoIW5hdmlnYXRpb25Bc0RhdGVGb3JtYXQgPyBwcmV2VGV4dCA6IHRoaXMuZm9ybWF0RGF0ZShwcmV2VGV4dCwKCQkJdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoZHJhd1llYXIsIGRyYXdNb250aCAtIHN0ZXBNb250aHMsIDEpKSwKCQkJdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGluc3QpKSk7CgoJCXByZXYgPSAodGhpcy5fY2FuQWRqdXN0TW9udGgoaW5zdCwgLTEsIGRyYXdZZWFyLCBkcmF3TW9udGgpID8KCQkJIjxhIGNsYXNzPSd1aS1kYXRlcGlja2VyLXByZXYgdWktY29ybmVyLWFsbCcgZGF0YS1oYW5kbGVyPSdwcmV2JyBkYXRhLWV2ZW50PSdjbGljayciICsKCQkJIiB0aXRsZT0nIiArIHByZXZUZXh0ICsgIic+PHNwYW4gY2xhc3M9J3VpLWljb24gdWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtIiArICggaXNSVEwgPyAiZSIgOiAidyIpICsgIic+IiArIHByZXZUZXh0ICsgIjwvc3Bhbj48L2E+IiA6CgkJCShoaWRlSWZOb1ByZXZOZXh0ID8gIiIgOiAiPGEgY2xhc3M9J3VpLWRhdGVwaWNrZXItcHJldiB1aS1jb3JuZXItYWxsIHVpLXN0YXRlLWRpc2FibGVkJyB0aXRsZT0nIisgcHJldlRleHQgKyInPjxzcGFuIGNsYXNzPSd1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLSIgKyAoIGlzUlRMID8gImUiIDogInciKSArICInPiIgKyBwcmV2VGV4dCArICI8L3NwYW4+PC9hPiIpKTsKCgkJbmV4dFRleHQgPSB0aGlzLl9nZXQoaW5zdCwgIm5leHRUZXh0Iik7CgkJbmV4dFRleHQgPSAoIW5hdmlnYXRpb25Bc0RhdGVGb3JtYXQgPyBuZXh0VGV4dCA6IHRoaXMuZm9ybWF0RGF0ZShuZXh0VGV4dCwKCQkJdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoZHJhd1llYXIsIGRyYXdNb250aCArIHN0ZXBNb250aHMsIDEpKSwKCQkJdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGluc3QpKSk7CgoJCW5leHQgPSAodGhpcy5fY2FuQWRqdXN0TW9udGgoaW5zdCwgKzEsIGRyYXdZZWFyLCBkcmF3TW9udGgpID8KCQkJIjxhIGNsYXNzPSd1aS1kYXRlcGlja2VyLW5leHQgdWktY29ybmVyLWFsbCcgZGF0YS1oYW5kbGVyPSduZXh0JyBkYXRhLWV2ZW50PSdjbGljayciICsKCQkJIiB0aXRsZT0nIiArIG5leHRUZXh0ICsgIic+PHNwYW4gY2xhc3M9J3VpLWljb24gdWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtIiArICggaXNSVEwgPyAidyIgOiAiZSIpICsgIic+IiArIG5leHRUZXh0ICsgIjwvc3Bhbj48L2E+IiA6CgkJCShoaWRlSWZOb1ByZXZOZXh0ID8gIiIgOiAiPGEgY2xhc3M9J3VpLWRhdGVwaWNrZXItbmV4dCB1aS1jb3JuZXItYWxsIHVpLXN0YXRlLWRpc2FibGVkJyB0aXRsZT0nIisgbmV4dFRleHQgKyAiJz48c3BhbiBjbGFzcz0ndWktaWNvbiB1aS1pY29uLWNpcmNsZS10cmlhbmdsZS0iICsgKCBpc1JUTCA/ICJ3IiA6ICJlIikgKyAiJz4iICsgbmV4dFRleHQgKyAiPC9zcGFuPjwvYT4iKSk7CgoJCWN1cnJlbnRUZXh0ID0gdGhpcy5fZ2V0KGluc3QsICJjdXJyZW50VGV4dCIpOwoJCWdvdG9EYXRlID0gKHRoaXMuX2dldChpbnN0LCAiZ290b0N1cnJlbnQiKSAmJiBpbnN0LmN1cnJlbnREYXkgPyBjdXJyZW50RGF0ZSA6IHRvZGF5KTsKCQljdXJyZW50VGV4dCA9ICghbmF2aWdhdGlvbkFzRGF0ZUZvcm1hdCA/IGN1cnJlbnRUZXh0IDoKCQkJdGhpcy5mb3JtYXREYXRlKGN1cnJlbnRUZXh0LCBnb3RvRGF0ZSwgdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGluc3QpKSk7CgoJCWNvbnRyb2xzID0gKCFpbnN0LmlubGluZSA/ICI8YnV0dG9uIHR5cGU9J2J1dHRvbicgY2xhc3M9J3VpLWRhdGVwaWNrZXItY2xvc2UgdWktc3RhdGUtZGVmYXVsdCB1aS1wcmlvcml0eS1wcmltYXJ5IHVpLWNvcm5lci1hbGwnIGRhdGEtaGFuZGxlcj0naGlkZScgZGF0YS1ldmVudD0nY2xpY2snPiIgKwoJCQl0aGlzLl9nZXQoaW5zdCwgImNsb3NlVGV4dCIpICsgIjwvYnV0dG9uPiIgOiAiIik7CgoJCWJ1dHRvblBhbmVsID0gKHNob3dCdXR0b25QYW5lbCkgPyAiPGRpdiBjbGFzcz0ndWktZGF0ZXBpY2tlci1idXR0b25wYW5lIHVpLXdpZGdldC1jb250ZW50Jz4iICsgKGlzUlRMID8gY29udHJvbHMgOiAiIikgKwoJCQkodGhpcy5faXNJblJhbmdlKGluc3QsIGdvdG9EYXRlKSA/ICI8YnV0dG9uIHR5cGU9J2J1dHRvbicgY2xhc3M9J3VpLWRhdGVwaWNrZXItY3VycmVudCB1aS1zdGF0ZS1kZWZhdWx0IHVpLXByaW9yaXR5LXNlY29uZGFyeSB1aS1jb3JuZXItYWxsJyBkYXRhLWhhbmRsZXI9J3RvZGF5JyBkYXRhLWV2ZW50PSdjbGljayciICsKCQkJIj4iICsgY3VycmVudFRleHQgKyAiPC9idXR0b24+IiA6ICIiKSArIChpc1JUTCA/ICIiIDogY29udHJvbHMpICsgIjwvZGl2PiIgOiAiIjsKCgkJZmlyc3REYXkgPSBwYXJzZUludCh0aGlzLl9nZXQoaW5zdCwgImZpcnN0RGF5IiksMTApOwoJCWZpcnN0RGF5ID0gKGlzTmFOKGZpcnN0RGF5KSA/IDAgOiBmaXJzdERheSk7CgoJCXNob3dXZWVrID0gdGhpcy5fZ2V0KGluc3QsICJzaG93V2VlayIpOwoJCWRheU5hbWVzID0gdGhpcy5fZ2V0KGluc3QsICJkYXlOYW1lcyIpOwoJCWRheU5hbWVzTWluID0gdGhpcy5fZ2V0KGluc3QsICJkYXlOYW1lc01pbiIpOwoJCW1vbnRoTmFtZXMgPSB0aGlzLl9nZXQoaW5zdCwgIm1vbnRoTmFtZXMiKTsKCQltb250aE5hbWVzU2hvcnQgPSB0aGlzLl9nZXQoaW5zdCwgIm1vbnRoTmFtZXNTaG9ydCIpOwoJCWJlZm9yZVNob3dEYXkgPSB0aGlzLl9nZXQoaW5zdCwgImJlZm9yZVNob3dEYXkiKTsKCQlzaG93T3RoZXJNb250aHMgPSB0aGlzLl9nZXQoaW5zdCwgInNob3dPdGhlck1vbnRocyIpOwoJCXNlbGVjdE90aGVyTW9udGhzID0gdGhpcy5fZ2V0KGluc3QsICJzZWxlY3RPdGhlck1vbnRocyIpOwoJCWRlZmF1bHREYXRlID0gdGhpcy5fZ2V0RGVmYXVsdERhdGUoaW5zdCk7CgkJaHRtbCA9ICIiOwoJCWRvdzsKCQlmb3IgKHJvdyA9IDA7IHJvdyA8IG51bU1vbnRoc1swXTsgcm93KyspIHsKCQkJZ3JvdXAgPSAiIjsKCQkJdGhpcy5tYXhSb3dzID0gNDsKCQkJZm9yIChjb2wgPSAwOyBjb2wgPCBudW1Nb250aHNbMV07IGNvbCsrKSB7CgkJCQlzZWxlY3RlZERhdGUgPSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShkcmF3WWVhciwgZHJhd01vbnRoLCBpbnN0LnNlbGVjdGVkRGF5KSk7CgkJCQljb3JuZXJDbGFzcyA9ICIgdWktY29ybmVyLWFsbCI7CgkJCQljYWxlbmRlciA9ICIiOwoJCQkJaWYgKGlzTXVsdGlNb250aCkgewoJCQkJCWNhbGVuZGVyICs9ICI8ZGl2IGNsYXNzPSd1aS1kYXRlcGlja2VyLWdyb3VwIjsKCQkJCQlpZiAobnVtTW9udGhzWzFdID4gMSkgewoJCQkJCQlzd2l0Y2ggKGNvbCkgewoJCQkJCQkJY2FzZSAwOiBjYWxlbmRlciArPSAiIHVpLWRhdGVwaWNrZXItZ3JvdXAtZmlyc3QiOwoJCQkJCQkJCWNvcm5lckNsYXNzID0gIiB1aS1jb3JuZXItIiArIChpc1JUTCA/ICJyaWdodCIgOiAibGVmdCIpOyBicmVhazsKCQkJCQkJCWNhc2UgbnVtTW9udGhzWzFdLTE6IGNhbGVuZGVyICs9ICIgdWktZGF0ZXBpY2tlci1ncm91cC1sYXN0IjsKCQkJCQkJCQljb3JuZXJDbGFzcyA9ICIgdWktY29ybmVyLSIgKyAoaXNSVEwgPyAibGVmdCIgOiAicmlnaHQiKTsgYnJlYWs7CgkJCQkJCQlkZWZhdWx0OiBjYWxlbmRlciArPSAiIHVpLWRhdGVwaWNrZXItZ3JvdXAtbWlkZGxlIjsgY29ybmVyQ2xhc3MgPSAiIjsgYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQkJY2FsZW5kZXIgKz0gIic+IjsKCQkJCX0KCQkJCWNhbGVuZGVyICs9ICI8ZGl2IGNsYXNzPSd1aS1kYXRlcGlja2VyLWhlYWRlciB1aS13aWRnZXQtaGVhZGVyIHVpLWhlbHBlci1jbGVhcmZpeCIgKyBjb3JuZXJDbGFzcyArICInPiIgKwoJCQkJCSgvYWxsfGxlZnQvLnRlc3QoY29ybmVyQ2xhc3MpICYmIHJvdyA9PT0gMCA/IChpc1JUTCA/IG5leHQgOiBwcmV2KSA6ICIiKSArCgkJCQkJKC9hbGx8cmlnaHQvLnRlc3QoY29ybmVyQ2xhc3MpICYmIHJvdyA9PT0gMCA/IChpc1JUTCA/IHByZXYgOiBuZXh0KSA6ICIiKSArCgkJCQkJdGhpcy5fZ2VuZXJhdGVNb250aFllYXJIZWFkZXIoaW5zdCwgZHJhd01vbnRoLCBkcmF3WWVhciwgbWluRGF0ZSwgbWF4RGF0ZSwKCQkJCQlyb3cgPiAwIHx8IGNvbCA+IDAsIG1vbnRoTmFtZXMsIG1vbnRoTmFtZXNTaG9ydCkgKyAvLyBkcmF3IG1vbnRoIGhlYWRlcnMKCQkJCQkiPC9kaXY+PHRhYmxlIGNsYXNzPSd1aS1kYXRlcGlja2VyLWNhbGVuZGFyJz48dGhlYWQ+IiArCgkJCQkJIjx0cj4iOwoJCQkJdGhlYWQgPSAoc2hvd1dlZWsgPyAiPHRoIGNsYXNzPSd1aS1kYXRlcGlja2VyLXdlZWstY29sJz4iICsgdGhpcy5fZ2V0KGluc3QsICJ3ZWVrSGVhZGVyIikgKyAiPC90aD4iIDogIiIpOwoJCQkJZm9yIChkb3cgPSAwOyBkb3cgPCA3OyBkb3crKykgeyAvLyBkYXlzIG9mIHRoZSB3ZWVrCgkJCQkJZGF5ID0gKGRvdyArIGZpcnN0RGF5KSAlIDc7CgkJCQkJdGhlYWQgKz0gIjx0aCIgKyAoKGRvdyArIGZpcnN0RGF5ICsgNikgJSA3ID49IDUgPyAiIGNsYXNzPSd1aS1kYXRlcGlja2VyLXdlZWstZW5kJyIgOiAiIikgKyAiPiIgKwoJCQkJCQkiPHNwYW4gdGl0bGU9JyIgKyBkYXlOYW1lc1tkYXldICsgIic+IiArIGRheU5hbWVzTWluW2RheV0gKyAiPC9zcGFuPjwvdGg+IjsKCQkJCX0KCQkJCWNhbGVuZGVyICs9IHRoZWFkICsgIjwvdHI+PC90aGVhZD48dGJvZHk+IjsKCQkJCWRheXNJbk1vbnRoID0gdGhpcy5fZ2V0RGF5c0luTW9udGgoZHJhd1llYXIsIGRyYXdNb250aCk7CgkJCQlpZiAoZHJhd1llYXIgPT09IGluc3Quc2VsZWN0ZWRZZWFyICYmIGRyYXdNb250aCA9PT0gaW5zdC5zZWxlY3RlZE1vbnRoKSB7CgkJCQkJaW5zdC5zZWxlY3RlZERheSA9IE1hdGgubWluKGluc3Quc2VsZWN0ZWREYXksIGRheXNJbk1vbnRoKTsKCQkJCX0KCQkJCWxlYWREYXlzID0gKHRoaXMuX2dldEZpcnN0RGF5T2ZNb250aChkcmF3WWVhciwgZHJhd01vbnRoKSAtIGZpcnN0RGF5ICsgNykgJSA3OwoJCQkJY3VyUm93cyA9IE1hdGguY2VpbCgobGVhZERheXMgKyBkYXlzSW5Nb250aCkgLyA3KTsgLy8gY2FsY3VsYXRlIHRoZSBudW1iZXIgb2Ygcm93cyB0byBnZW5lcmF0ZQoJCQkJbnVtUm93cyA9IChpc011bHRpTW9udGggPyB0aGlzLm1heFJvd3MgPiBjdXJSb3dzID8gdGhpcy5tYXhSb3dzIDogY3VyUm93cyA6IGN1clJvd3MpOyAvL0lmIG11bHRpcGxlIG1vbnRocywgdXNlIHRoZSBoaWdoZXIgbnVtYmVyIG9mIHJvd3MgKHNlZSAjNzA0MykKCQkJCXRoaXMubWF4Um93cyA9IG51bVJvd3M7CgkJCQlwcmludERhdGUgPSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShkcmF3WWVhciwgZHJhd01vbnRoLCAxIC0gbGVhZERheXMpKTsKCQkJCWZvciAoZFJvdyA9IDA7IGRSb3cgPCBudW1Sb3dzOyBkUm93KyspIHsgLy8gY3JlYXRlIGRhdGUgcGlja2VyIHJvd3MKCQkJCQljYWxlbmRlciArPSAiPHRyPiI7CgkJCQkJdGJvZHkgPSAoIXNob3dXZWVrID8gIiIgOiAiPHRkIGNsYXNzPSd1aS1kYXRlcGlja2VyLXdlZWstY29sJz4iICsKCQkJCQkJdGhpcy5fZ2V0KGluc3QsICJjYWxjdWxhdGVXZWVrIikocHJpbnREYXRlKSArICI8L3RkPiIpOwoJCQkJCWZvciAoZG93ID0gMDsgZG93IDwgNzsgZG93KyspIHsgLy8gY3JlYXRlIGRhdGUgcGlja2VyIGRheXMKCQkJCQkJZGF5U2V0dGluZ3MgPSAoYmVmb3JlU2hvd0RheSA/CgkJCQkJCQliZWZvcmVTaG93RGF5LmFwcGx5KChpbnN0LmlucHV0ID8gaW5zdC5pbnB1dFswXSA6IG51bGwpLCBbcHJpbnREYXRlXSkgOiBbdHJ1ZSwgIiJdKTsKCQkJCQkJb3RoZXJNb250aCA9IChwcmludERhdGUuZ2V0TW9udGgoKSAhPT0gZHJhd01vbnRoKTsKCQkJCQkJdW5zZWxlY3RhYmxlID0gKG90aGVyTW9udGggJiYgIXNlbGVjdE90aGVyTW9udGhzKSB8fCAhZGF5U2V0dGluZ3NbMF0gfHwKCQkJCQkJCShtaW5EYXRlICYmIHByaW50RGF0ZSA8IG1pbkRhdGUpIHx8IChtYXhEYXRlICYmIHByaW50RGF0ZSA+IG1heERhdGUpOwoJCQkJCQl0Ym9keSArPSAiPHRkIGNsYXNzPSciICsKCQkJCQkJCSgoZG93ICsgZmlyc3REYXkgKyA2KSAlIDcgPj0gNSA/ICIgdWktZGF0ZXBpY2tlci13ZWVrLWVuZCIgOiAiIikgKyAvLyBoaWdobGlnaHQgd2Vla2VuZHMKCQkJCQkJCShvdGhlck1vbnRoID8gIiB1aS1kYXRlcGlja2VyLW90aGVyLW1vbnRoIiA6ICIiKSArIC8vIGhpZ2hsaWdodCBkYXlzIGZyb20gb3RoZXIgbW9udGhzCgkJCQkJCQkoKHByaW50RGF0ZS5nZXRUaW1lKCkgPT09IHNlbGVjdGVkRGF0ZS5nZXRUaW1lKCkgJiYgZHJhd01vbnRoID09PSBpbnN0LnNlbGVjdGVkTW9udGggJiYgaW5zdC5fa2V5RXZlbnQpIHx8IC8vIHVzZXIgcHJlc3NlZCBrZXkKCQkJCQkJCShkZWZhdWx0RGF0ZS5nZXRUaW1lKCkgPT09IHByaW50RGF0ZS5nZXRUaW1lKCkgJiYgZGVmYXVsdERhdGUuZ2V0VGltZSgpID09PSBzZWxlY3RlZERhdGUuZ2V0VGltZSgpKSA/CgkJCQkJCQkvLyBvciBkZWZhdWx0RGF0ZSBpcyBjdXJyZW50IHByaW50ZWREYXRlIGFuZCBkZWZhdWx0RGF0ZSBpcyBzZWxlY3RlZERhdGUKCQkJCQkJCSIgIiArIHRoaXMuX2RheU92ZXJDbGFzcyA6ICIiKSArIC8vIGhpZ2hsaWdodCBzZWxlY3RlZCBkYXkKCQkJCQkJCSh1bnNlbGVjdGFibGUgPyAiICIgKyB0aGlzLl91bnNlbGVjdGFibGVDbGFzcyArICIgdWktc3RhdGUtZGlzYWJsZWQiOiAiIikgKyAgLy8gaGlnaGxpZ2h0IHVuc2VsZWN0YWJsZSBkYXlzCgkJCQkJCQkob3RoZXJNb250aCAmJiAhc2hvd090aGVyTW9udGhzID8gIiIgOiAiICIgKyBkYXlTZXR0aW5nc1sxXSArIC8vIGhpZ2hsaWdodCBjdXN0b20gZGF0ZXMKCQkJCQkJCShwcmludERhdGUuZ2V0VGltZSgpID09PSBjdXJyZW50RGF0ZS5nZXRUaW1lKCkgPyAiICIgKyB0aGlzLl9jdXJyZW50Q2xhc3MgOiAiIikgKyAvLyBoaWdobGlnaHQgc2VsZWN0ZWQgZGF5CgkJCQkJCQkocHJpbnREYXRlLmdldFRpbWUoKSA9PT0gdG9kYXkuZ2V0VGltZSgpID8gIiB1aS1kYXRlcGlja2VyLXRvZGF5IiA6ICIiKSkgKyAiJyIgKyAvLyBoaWdobGlnaHQgdG9kYXkgKGlmIGRpZmZlcmVudCkKCQkJCQkJCSgoIW90aGVyTW9udGggfHwgc2hvd090aGVyTW9udGhzKSAmJiBkYXlTZXR0aW5nc1syXSA/ICIgdGl0bGU9JyIgKyBkYXlTZXR0aW5nc1syXS5yZXBsYWNlKC8nL2csICImIzM5OyIpICsgIiciIDogIiIpICsgLy8gY2VsbCB0aXRsZQoJCQkJCQkJKHVuc2VsZWN0YWJsZSA/ICIiIDogIiBkYXRhLWhhbmRsZXI9J3NlbGVjdERheScgZGF0YS1ldmVudD0nY2xpY2snIGRhdGEtbW9udGg9JyIgKyBwcmludERhdGUuZ2V0TW9udGgoKSArICInIGRhdGEteWVhcj0nIiArIHByaW50RGF0ZS5nZXRGdWxsWWVhcigpICsgIiciKSArICI+IiArIC8vIGFjdGlvbnMKCQkJCQkJCShvdGhlck1vbnRoICYmICFzaG93T3RoZXJNb250aHMgPyAiJiN4YTA7IiA6IC8vIGRpc3BsYXkgZm9yIG90aGVyIG1vbnRocwoJCQkJCQkJKHVuc2VsZWN0YWJsZSA/ICI8c3BhbiBjbGFzcz0ndWktc3RhdGUtZGVmYXVsdCc+IiArIHByaW50RGF0ZS5nZXREYXRlKCkgKyAiPC9zcGFuPiIgOiAiPGEgY2xhc3M9J3VpLXN0YXRlLWRlZmF1bHQiICsKCQkJCQkJCShwcmludERhdGUuZ2V0VGltZSgpID09PSB0b2RheS5nZXRUaW1lKCkgPyAiIHVpLXN0YXRlLWhpZ2hsaWdodCIgOiAiIikgKwoJCQkJCQkJKHByaW50RGF0ZS5nZXRUaW1lKCkgPT09IGN1cnJlbnREYXRlLmdldFRpbWUoKSA/ICIgdWktc3RhdGUtYWN0aXZlIiA6ICIiKSArIC8vIGhpZ2hsaWdodCBzZWxlY3RlZCBkYXkKCQkJCQkJCShvdGhlck1vbnRoID8gIiB1aS1wcmlvcml0eS1zZWNvbmRhcnkiIDogIiIpICsgLy8gZGlzdGluZ3Vpc2ggZGF0ZXMgZnJvbSBvdGhlciBtb250aHMKCQkJCQkJCSInIGhyZWY9JyMnPiIgKyBwcmludERhdGUuZ2V0RGF0ZSgpICsgIjwvYT4iKSkgKyAiPC90ZD4iOyAvLyBkaXNwbGF5IHNlbGVjdGFibGUgZGF0ZQoJCQkJCQlwcmludERhdGUuc2V0RGF0ZShwcmludERhdGUuZ2V0RGF0ZSgpICsgMSk7CgkJCQkJCXByaW50RGF0ZSA9IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KHByaW50RGF0ZSk7CgkJCQkJfQoJCQkJCWNhbGVuZGVyICs9IHRib2R5ICsgIjwvdHI+IjsKCQkJCX0KCQkJCWRyYXdNb250aCsrOwoJCQkJaWYgKGRyYXdNb250aCA+IDExKSB7CgkJCQkJZHJhd01vbnRoID0gMDsKCQkJCQlkcmF3WWVhcisrOwoJCQkJfQoJCQkJY2FsZW5kZXIgKz0gIjwvdGJvZHk+PC90YWJsZT4iICsgKGlzTXVsdGlNb250aCA/ICI8L2Rpdj4iICsKCQkJCQkJCSgobnVtTW9udGhzWzBdID4gMCAmJiBjb2wgPT09IG51bU1vbnRoc1sxXS0xKSA/ICI8ZGl2IGNsYXNzPSd1aS1kYXRlcGlja2VyLXJvdy1icmVhayc+PC9kaXY+IiA6ICIiKSA6ICIiKTsKCQkJCWdyb3VwICs9IGNhbGVuZGVyOwoJCQl9CgkJCWh0bWwgKz0gZ3JvdXA7CgkJfQoJCWh0bWwgKz0gYnV0dG9uUGFuZWw7CgkJaW5zdC5fa2V5RXZlbnQgPSBmYWxzZTsKCQlyZXR1cm4gaHRtbDsKCX0sCgoJLyogR2VuZXJhdGUgdGhlIG1vbnRoIGFuZCB5ZWFyIGhlYWRlci4gKi8KCV9nZW5lcmF0ZU1vbnRoWWVhckhlYWRlcjogZnVuY3Rpb24oaW5zdCwgZHJhd01vbnRoLCBkcmF3WWVhciwgbWluRGF0ZSwgbWF4RGF0ZSwKCQkJc2Vjb25kYXJ5LCBtb250aE5hbWVzLCBtb250aE5hbWVzU2hvcnQpIHsKCgkJdmFyIGluTWluWWVhciwgaW5NYXhZZWFyLCBtb250aCwgeWVhcnMsIHRoaXNZZWFyLCBkZXRlcm1pbmVZZWFyLCB5ZWFyLCBlbmRZZWFyLAoJCQljaGFuZ2VNb250aCA9IHRoaXMuX2dldChpbnN0LCAiY2hhbmdlTW9udGgiKSwKCQkJY2hhbmdlWWVhciA9IHRoaXMuX2dldChpbnN0LCAiY2hhbmdlWWVhciIpLAoJCQlzaG93TW9udGhBZnRlclllYXIgPSB0aGlzLl9nZXQoaW5zdCwgInNob3dNb250aEFmdGVyWWVhciIpLAoJCQlodG1sID0gIjxkaXYgY2xhc3M9J3VpLWRhdGVwaWNrZXItdGl0bGUnPiIsCgkJCW1vbnRoSHRtbCA9ICIiOwoKCQkvLyBtb250aCBzZWxlY3Rpb24KCQlpZiAoc2Vjb25kYXJ5IHx8ICFjaGFuZ2VNb250aCkgewoJCQltb250aEh0bWwgKz0gIjxzcGFuIGNsYXNzPSd1aS1kYXRlcGlja2VyLW1vbnRoJz4iICsgbW9udGhOYW1lc1tkcmF3TW9udGhdICsgIjwvc3Bhbj4iOwoJCX0gZWxzZSB7CgkJCWluTWluWWVhciA9IChtaW5EYXRlICYmIG1pbkRhdGUuZ2V0RnVsbFllYXIoKSA9PT0gZHJhd1llYXIpOwoJCQlpbk1heFllYXIgPSAobWF4RGF0ZSAmJiBtYXhEYXRlLmdldEZ1bGxZZWFyKCkgPT09IGRyYXdZZWFyKTsKCQkJbW9udGhIdG1sICs9ICI8c2VsZWN0IGNsYXNzPSd1aS1kYXRlcGlja2VyLW1vbnRoJyBkYXRhLWhhbmRsZXI9J3NlbGVjdE1vbnRoJyBkYXRhLWV2ZW50PSdjaGFuZ2UnPiI7CgkJCWZvciAoIG1vbnRoID0gMDsgbW9udGggPCAxMjsgbW9udGgrKykgewoJCQkJaWYgKCghaW5NaW5ZZWFyIHx8IG1vbnRoID49IG1pbkRhdGUuZ2V0TW9udGgoKSkgJiYgKCFpbk1heFllYXIgfHwgbW9udGggPD0gbWF4RGF0ZS5nZXRNb250aCgpKSkgewoJCQkJCW1vbnRoSHRtbCArPSAiPG9wdGlvbiB2YWx1ZT0nIiArIG1vbnRoICsgIiciICsKCQkJCQkJKG1vbnRoID09PSBkcmF3TW9udGggPyAiIHNlbGVjdGVkPSdzZWxlY3RlZCciIDogIiIpICsKCQkJCQkJIj4iICsgbW9udGhOYW1lc1Nob3J0W21vbnRoXSArICI8L29wdGlvbj4iOwoJCQkJfQoJCQl9CgkJCW1vbnRoSHRtbCArPSAiPC9zZWxlY3Q+IjsKCQl9CgoJCWlmICghc2hvd01vbnRoQWZ0ZXJZZWFyKSB7CgkJCWh0bWwgKz0gbW9udGhIdG1sICsgKHNlY29uZGFyeSB8fCAhKGNoYW5nZU1vbnRoICYmIGNoYW5nZVllYXIpID8gIiYjeGEwOyIgOiAiIik7CgkJfQoKCQkvLyB5ZWFyIHNlbGVjdGlvbgoJCWlmICggIWluc3QueWVhcnNodG1sICkgewoJCQlpbnN0LnllYXJzaHRtbCA9ICIiOwoJCQlpZiAoc2Vjb25kYXJ5IHx8ICFjaGFuZ2VZZWFyKSB7CgkJCQlodG1sICs9ICI8c3BhbiBjbGFzcz0ndWktZGF0ZXBpY2tlci15ZWFyJz4iICsgZHJhd1llYXIgKyAiPC9zcGFuPiI7CgkJCX0gZWxzZSB7CgkJCQkvLyBkZXRlcm1pbmUgcmFuZ2Ugb2YgeWVhcnMgdG8gZGlzcGxheQoJCQkJeWVhcnMgPSB0aGlzLl9nZXQoaW5zdCwgInllYXJSYW5nZSIpLnNwbGl0KCI6Iik7CgkJCQl0aGlzWWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTsKCQkJCWRldGVybWluZVllYXIgPSBmdW5jdGlvbih2YWx1ZSkgewoJCQkJCXZhciB5ZWFyID0gKHZhbHVlLm1hdGNoKC9jWytcLV0uKi8pID8gZHJhd1llYXIgKyBwYXJzZUludCh2YWx1ZS5zdWJzdHJpbmcoMSksIDEwKSA6CgkJCQkJCSh2YWx1ZS5tYXRjaCgvWytcLV0uKi8pID8gdGhpc1llYXIgKyBwYXJzZUludCh2YWx1ZSwgMTApIDoKCQkJCQkJcGFyc2VJbnQodmFsdWUsIDEwKSkpOwoJCQkJCXJldHVybiAoaXNOYU4oeWVhcikgPyB0aGlzWWVhciA6IHllYXIpOwoJCQkJfTsKCQkJCXllYXIgPSBkZXRlcm1pbmVZZWFyKHllYXJzWzBdKTsKCQkJCWVuZFllYXIgPSBNYXRoLm1heCh5ZWFyLCBkZXRlcm1pbmVZZWFyKHllYXJzWzFdIHx8ICIiKSk7CgkJCQl5ZWFyID0gKG1pbkRhdGUgPyBNYXRoLm1heCh5ZWFyLCBtaW5EYXRlLmdldEZ1bGxZZWFyKCkpIDogeWVhcik7CgkJCQllbmRZZWFyID0gKG1heERhdGUgPyBNYXRoLm1pbihlbmRZZWFyLCBtYXhEYXRlLmdldEZ1bGxZZWFyKCkpIDogZW5kWWVhcik7CgkJCQlpbnN0LnllYXJzaHRtbCArPSAiPHNlbGVjdCBjbGFzcz0ndWktZGF0ZXBpY2tlci15ZWFyJyBkYXRhLWhhbmRsZXI9J3NlbGVjdFllYXInIGRhdGEtZXZlbnQ9J2NoYW5nZSc+IjsKCQkJCWZvciAoOyB5ZWFyIDw9IGVuZFllYXI7IHllYXIrKykgewoJCQkJCWluc3QueWVhcnNodG1sICs9ICI8b3B0aW9uIHZhbHVlPSciICsgeWVhciArICInIiArCgkJCQkJCSh5ZWFyID09PSBkcmF3WWVhciA/ICIgc2VsZWN0ZWQ9J3NlbGVjdGVkJyIgOiAiIikgKwoJCQkJCQkiPiIgKyB5ZWFyICsgIjwvb3B0aW9uPiI7CgkJCQl9CgkJCQlpbnN0LnllYXJzaHRtbCArPSAiPC9zZWxlY3Q+IjsKCgkJCQlodG1sICs9IGluc3QueWVhcnNodG1sOwoJCQkJaW5zdC55ZWFyc2h0bWwgPSBudWxsOwoJCQl9CgkJfQoKCQlodG1sICs9IHRoaXMuX2dldChpbnN0LCAieWVhclN1ZmZpeCIpOwoJCWlmIChzaG93TW9udGhBZnRlclllYXIpIHsKCQkJaHRtbCArPSAoc2Vjb25kYXJ5IHx8ICEoY2hhbmdlTW9udGggJiYgY2hhbmdlWWVhcikgPyAiJiN4YTA7IiA6ICIiKSArIG1vbnRoSHRtbDsKCQl9CgkJaHRtbCArPSAiPC9kaXY+IjsgLy8gQ2xvc2UgZGF0ZXBpY2tlcl9oZWFkZXIKCQlyZXR1cm4gaHRtbDsKCX0sCgoJLyogQWRqdXN0IG9uZSBvZiB0aGUgZGF0ZSBzdWItZmllbGRzLiAqLwoJX2FkanVzdEluc3REYXRlOiBmdW5jdGlvbihpbnN0LCBvZmZzZXQsIHBlcmlvZCkgewoJCXZhciB5ZWFyID0gaW5zdC5kcmF3WWVhciArIChwZXJpb2QgPT09ICJZIiA/IG9mZnNldCA6IDApLAoJCQltb250aCA9IGluc3QuZHJhd01vbnRoICsgKHBlcmlvZCA9PT0gIk0iID8gb2Zmc2V0IDogMCksCgkJCWRheSA9IE1hdGgubWluKGluc3Quc2VsZWN0ZWREYXksIHRoaXMuX2dldERheXNJbk1vbnRoKHllYXIsIG1vbnRoKSkgKyAocGVyaW9kID09PSAiRCIgPyBvZmZzZXQgOiAwKSwKCQkJZGF0ZSA9IHRoaXMuX3Jlc3RyaWN0TWluTWF4KGluc3QsIHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKHllYXIsIG1vbnRoLCBkYXkpKSk7CgoJCWluc3Quc2VsZWN0ZWREYXkgPSBkYXRlLmdldERhdGUoKTsKCQlpbnN0LmRyYXdNb250aCA9IGluc3Quc2VsZWN0ZWRNb250aCA9IGRhdGUuZ2V0TW9udGgoKTsKCQlpbnN0LmRyYXdZZWFyID0gaW5zdC5zZWxlY3RlZFllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7CgkJaWYgKHBlcmlvZCA9PT0gIk0iIHx8IHBlcmlvZCA9PT0gIlkiKSB7CgkJCXRoaXMuX25vdGlmeUNoYW5nZShpbnN0KTsKCQl9Cgl9LAoKCS8qIEVuc3VyZSBhIGRhdGUgaXMgd2l0aGluIGFueSBtaW4vbWF4IGJvdW5kcy4gKi8KCV9yZXN0cmljdE1pbk1heDogZnVuY3Rpb24oaW5zdCwgZGF0ZSkgewoJCXZhciBtaW5EYXRlID0gdGhpcy5fZ2V0TWluTWF4RGF0ZShpbnN0LCAibWluIiksCgkJCW1heERhdGUgPSB0aGlzLl9nZXRNaW5NYXhEYXRlKGluc3QsICJtYXgiKSwKCQkJbmV3RGF0ZSA9IChtaW5EYXRlICYmIGRhdGUgPCBtaW5EYXRlID8gbWluRGF0ZSA6IGRhdGUpOwoJCXJldHVybiAobWF4RGF0ZSAmJiBuZXdEYXRlID4gbWF4RGF0ZSA/IG1heERhdGUgOiBuZXdEYXRlKTsKCX0sCgoJLyogTm90aWZ5IGNoYW5nZSBvZiBtb250aC95ZWFyLiAqLwoJX25vdGlmeUNoYW5nZTogZnVuY3Rpb24oaW5zdCkgewoJCXZhciBvbkNoYW5nZSA9IHRoaXMuX2dldChpbnN0LCAib25DaGFuZ2VNb250aFllYXIiKTsKCQlpZiAob25DaGFuZ2UpIHsKCQkJb25DaGFuZ2UuYXBwbHkoKGluc3QuaW5wdXQgPyBpbnN0LmlucHV0WzBdIDogbnVsbCksCgkJCQlbaW5zdC5zZWxlY3RlZFllYXIsIGluc3Quc2VsZWN0ZWRNb250aCArIDEsIGluc3RdKTsKCQl9Cgl9LAoKCS8qIERldGVybWluZSB0aGUgbnVtYmVyIG9mIG1vbnRocyB0byBzaG93LiAqLwoJX2dldE51bWJlck9mTW9udGhzOiBmdW5jdGlvbihpbnN0KSB7CgkJdmFyIG51bU1vbnRocyA9IHRoaXMuX2dldChpbnN0LCAibnVtYmVyT2ZNb250aHMiKTsKCQlyZXR1cm4gKG51bU1vbnRocyA9PSBudWxsID8gWzEsIDFdIDogKHR5cGVvZiBudW1Nb250aHMgPT09ICJudW1iZXIiID8gWzEsIG51bU1vbnRoc10gOiBudW1Nb250aHMpKTsKCX0sCgoJLyogRGV0ZXJtaW5lIHRoZSBjdXJyZW50IG1heGltdW0gZGF0ZSAtIGVuc3VyZSBubyB0aW1lIGNvbXBvbmVudHMgYXJlIHNldC4gKi8KCV9nZXRNaW5NYXhEYXRlOiBmdW5jdGlvbihpbnN0LCBtaW5NYXgpIHsKCQlyZXR1cm4gdGhpcy5fZGV0ZXJtaW5lRGF0ZShpbnN0LCB0aGlzLl9nZXQoaW5zdCwgbWluTWF4ICsgIkRhdGUiKSwgbnVsbCk7Cgl9LAoKCS8qIEZpbmQgdGhlIG51bWJlciBvZiBkYXlzIGluIGEgZ2l2ZW4gbW9udGguICovCglfZ2V0RGF5c0luTW9udGg6IGZ1bmN0aW9uKHllYXIsIG1vbnRoKSB7CgkJcmV0dXJuIDMyIC0gdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoeWVhciwgbW9udGgsIDMyKSkuZ2V0RGF0ZSgpOwoJfSwKCgkvKiBGaW5kIHRoZSBkYXkgb2YgdGhlIHdlZWsgb2YgdGhlIGZpcnN0IG9mIGEgbW9udGguICovCglfZ2V0Rmlyc3REYXlPZk1vbnRoOiBmdW5jdGlvbih5ZWFyLCBtb250aCkgewoJCXJldHVybiBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgMSkuZ2V0RGF5KCk7Cgl9LAoKCS8qIERldGVybWluZXMgaWYgd2Ugc2hvdWxkIGFsbG93IGEgIm5leHQvcHJldiIgbW9udGggZGlzcGxheSBjaGFuZ2UuICovCglfY2FuQWRqdXN0TW9udGg6IGZ1bmN0aW9uKGluc3QsIG9mZnNldCwgY3VyWWVhciwgY3VyTW9udGgpIHsKCQl2YXIgbnVtTW9udGhzID0gdGhpcy5fZ2V0TnVtYmVyT2ZNb250aHMoaW5zdCksCgkJCWRhdGUgPSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShjdXJZZWFyLAoJCQljdXJNb250aCArIChvZmZzZXQgPCAwID8gb2Zmc2V0IDogbnVtTW9udGhzWzBdICogbnVtTW9udGhzWzFdKSwgMSkpOwoKCQlpZiAob2Zmc2V0IDwgMCkgewoJCQlkYXRlLnNldERhdGUodGhpcy5fZ2V0RGF5c0luTW9udGgoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCkpKTsKCQl9CgkJcmV0dXJuIHRoaXMuX2lzSW5SYW5nZShpbnN0LCBkYXRlKTsKCX0sCgoJLyogSXMgdGhlIGdpdmVuIGRhdGUgaW4gdGhlIGFjY2VwdGVkIHJhbmdlPyAqLwoJX2lzSW5SYW5nZTogZnVuY3Rpb24oaW5zdCwgZGF0ZSkgewoJCXZhciB5ZWFyU3BsaXQsIGN1cnJlbnRZZWFyLAoJCQltaW5EYXRlID0gdGhpcy5fZ2V0TWluTWF4RGF0ZShpbnN0LCAibWluIiksCgkJCW1heERhdGUgPSB0aGlzLl9nZXRNaW5NYXhEYXRlKGluc3QsICJtYXgiKSwKCQkJbWluWWVhciA9IG51bGwsCgkJCW1heFllYXIgPSBudWxsLAoJCQl5ZWFycyA9IHRoaXMuX2dldChpbnN0LCAieWVhclJhbmdlIik7CgkJCWlmICh5ZWFycyl7CgkJCQl5ZWFyU3BsaXQgPSB5ZWFycy5zcGxpdCgiOiIpOwoJCQkJY3VycmVudFllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7CgkJCQltaW5ZZWFyID0gcGFyc2VJbnQoeWVhclNwbGl0WzBdLCAxMCk7CgkJCQltYXhZZWFyID0gcGFyc2VJbnQoeWVhclNwbGl0WzFdLCAxMCk7CgkJCQlpZiAoIHllYXJTcGxpdFswXS5tYXRjaCgvWytcLV0uKi8pICkgewoJCQkJCW1pblllYXIgKz0gY3VycmVudFllYXI7CgkJCQl9CgkJCQlpZiAoIHllYXJTcGxpdFsxXS5tYXRjaCgvWytcLV0uKi8pICkgewoJCQkJCW1heFllYXIgKz0gY3VycmVudFllYXI7CgkJCQl9CgkJCX0KCgkJcmV0dXJuICgoIW1pbkRhdGUgfHwgZGF0ZS5nZXRUaW1lKCkgPj0gbWluRGF0ZS5nZXRUaW1lKCkpICYmCgkJCSghbWF4RGF0ZSB8fCBkYXRlLmdldFRpbWUoKSA8PSBtYXhEYXRlLmdldFRpbWUoKSkgJiYKCQkJKCFtaW5ZZWFyIHx8IGRhdGUuZ2V0RnVsbFllYXIoKSA+PSBtaW5ZZWFyKSAmJgoJCQkoIW1heFllYXIgfHwgZGF0ZS5nZXRGdWxsWWVhcigpIDw9IG1heFllYXIpKTsKCX0sCgoJLyogUHJvdmlkZSB0aGUgY29uZmlndXJhdGlvbiBzZXR0aW5ncyBmb3IgZm9ybWF0dGluZy9wYXJzaW5nLiAqLwoJX2dldEZvcm1hdENvbmZpZzogZnVuY3Rpb24oaW5zdCkgewoJCXZhciBzaG9ydFllYXJDdXRvZmYgPSB0aGlzLl9nZXQoaW5zdCwgInNob3J0WWVhckN1dG9mZiIpOwoJCXNob3J0WWVhckN1dG9mZiA9ICh0eXBlb2Ygc2hvcnRZZWFyQ3V0b2ZmICE9PSAic3RyaW5nIiA/IHNob3J0WWVhckN1dG9mZiA6CgkJCW5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSAlIDEwMCArIHBhcnNlSW50KHNob3J0WWVhckN1dG9mZiwgMTApKTsKCQlyZXR1cm4ge3Nob3J0WWVhckN1dG9mZjogc2hvcnRZZWFyQ3V0b2ZmLAoJCQlkYXlOYW1lc1Nob3J0OiB0aGlzLl9nZXQoaW5zdCwgImRheU5hbWVzU2hvcnQiKSwgZGF5TmFtZXM6IHRoaXMuX2dldChpbnN0LCAiZGF5TmFtZXMiKSwKCQkJbW9udGhOYW1lc1Nob3J0OiB0aGlzLl9nZXQoaW5zdCwgIm1vbnRoTmFtZXNTaG9ydCIpLCBtb250aE5hbWVzOiB0aGlzLl9nZXQoaW5zdCwgIm1vbnRoTmFtZXMiKX07Cgl9LAoKCS8qIEZvcm1hdCB0aGUgZ2l2ZW4gZGF0ZSBmb3IgZGlzcGxheS4gKi8KCV9mb3JtYXREYXRlOiBmdW5jdGlvbihpbnN0LCBkYXksIG1vbnRoLCB5ZWFyKSB7CgkJaWYgKCFkYXkpIHsKCQkJaW5zdC5jdXJyZW50RGF5ID0gaW5zdC5zZWxlY3RlZERheTsKCQkJaW5zdC5jdXJyZW50TW9udGggPSBpbnN0LnNlbGVjdGVkTW9udGg7CgkJCWluc3QuY3VycmVudFllYXIgPSBpbnN0LnNlbGVjdGVkWWVhcjsKCQl9CgkJdmFyIGRhdGUgPSAoZGF5ID8gKHR5cGVvZiBkYXkgPT09ICJvYmplY3QiID8gZGF5IDoKCQkJdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoeWVhciwgbW9udGgsIGRheSkpKSA6CgkJCXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGluc3QuY3VycmVudFllYXIsIGluc3QuY3VycmVudE1vbnRoLCBpbnN0LmN1cnJlbnREYXkpKSk7CgkJcmV0dXJuIHRoaXMuZm9ybWF0RGF0ZSh0aGlzLl9nZXQoaW5zdCwgImRhdGVGb3JtYXQiKSwgZGF0ZSwgdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGluc3QpKTsKCX0KfSk7CgovKgogKiBCaW5kIGhvdmVyIGV2ZW50cyBmb3IgZGF0ZXBpY2tlciBlbGVtZW50cy4KICogRG9uZSB2aWEgZGVsZWdhdGUgc28gdGhlIGJpbmRpbmcgb25seSBvY2N1cnMgb25jZSBpbiB0aGUgbGlmZXRpbWUgb2YgdGhlIHBhcmVudCBkaXYuCiAqIEdsb2JhbCBpbnN0QWN0aXZlLCBzZXQgYnkgX3VwZGF0ZURhdGVwaWNrZXIgYWxsb3dzIHRoZSBoYW5kbGVycyB0byBmaW5kIHRoZWlyIHdheSBiYWNrIHRvIHRoZSBhY3RpdmUgcGlja2VyLgogKi8KZnVuY3Rpb24gYmluZEhvdmVyKGRwRGl2KSB7Cgl2YXIgc2VsZWN0b3IgPSAiYnV0dG9uLCAudWktZGF0ZXBpY2tlci1wcmV2LCAudWktZGF0ZXBpY2tlci1uZXh0LCAudWktZGF0ZXBpY2tlci1jYWxlbmRhciB0ZCBhIjsKCXJldHVybiBkcERpdi5kZWxlZ2F0ZShzZWxlY3RvciwgIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CgkJCSQodGhpcykucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWhvdmVyIik7CgkJCWlmICh0aGlzLmNsYXNzTmFtZS5pbmRleE9mKCJ1aS1kYXRlcGlja2VyLXByZXYiKSAhPT0gLTEpIHsKCQkJCSQodGhpcykucmVtb3ZlQ2xhc3MoInVpLWRhdGVwaWNrZXItcHJldi1ob3ZlciIpOwoJCQl9CgkJCWlmICh0aGlzLmNsYXNzTmFtZS5pbmRleE9mKCJ1aS1kYXRlcGlja2VyLW5leHQiKSAhPT0gLTEpIHsKCQkJCSQodGhpcykucmVtb3ZlQ2xhc3MoInVpLWRhdGVwaWNrZXItbmV4dC1ob3ZlciIpOwoJCQl9CgkJfSkKCQkuZGVsZWdhdGUoc2VsZWN0b3IsICJtb3VzZW92ZXIiLCBmdW5jdGlvbigpewoJCQlpZiAoISQuZGF0ZXBpY2tlci5faXNEaXNhYmxlZERhdGVwaWNrZXIoIGluc3RBY3RpdmUuaW5saW5lID8gZHBEaXYucGFyZW50KClbMF0gOiBpbnN0QWN0aXZlLmlucHV0WzBdKSkgewoJCQkJJCh0aGlzKS5wYXJlbnRzKCIudWktZGF0ZXBpY2tlci1jYWxlbmRhciIpLmZpbmQoImEiKS5yZW1vdmVDbGFzcygidWktc3RhdGUtaG92ZXIiKTsKCQkJCSQodGhpcykuYWRkQ2xhc3MoInVpLXN0YXRlLWhvdmVyIik7CgkJCQlpZiAodGhpcy5jbGFzc05hbWUuaW5kZXhPZigidWktZGF0ZXBpY2tlci1wcmV2IikgIT09IC0xKSB7CgkJCQkJJCh0aGlzKS5hZGRDbGFzcygidWktZGF0ZXBpY2tlci1wcmV2LWhvdmVyIik7CgkJCQl9CgkJCQlpZiAodGhpcy5jbGFzc05hbWUuaW5kZXhPZigidWktZGF0ZXBpY2tlci1uZXh0IikgIT09IC0xKSB7CgkJCQkJJCh0aGlzKS5hZGRDbGFzcygidWktZGF0ZXBpY2tlci1uZXh0LWhvdmVyIik7CgkJCQl9CgkJCX0KCQl9KTsKfQoKLyogalF1ZXJ5IGV4dGVuZCBub3cgaWdub3JlcyBudWxscyEgKi8KZnVuY3Rpb24gZXh0ZW5kUmVtb3ZlKHRhcmdldCwgcHJvcHMpIHsKCSQuZXh0ZW5kKHRhcmdldCwgcHJvcHMpOwoJZm9yICh2YXIgbmFtZSBpbiBwcm9wcykgewoJCWlmIChwcm9wc1tuYW1lXSA9PSBudWxsKSB7CgkJCXRhcmdldFtuYW1lXSA9IHByb3BzW25hbWVdOwoJCX0KCX0KCXJldHVybiB0YXJnZXQ7Cn0KCi8qIEludm9rZSB0aGUgZGF0ZXBpY2tlciBmdW5jdGlvbmFsaXR5LgogICBAcGFyYW0gIG9wdGlvbnMgIHN0cmluZyAtIGEgY29tbWFuZCwgb3B0aW9uYWxseSBmb2xsb3dlZCBieSBhZGRpdGlvbmFsIHBhcmFtZXRlcnMgb3IKCQkJCQlPYmplY3QgLSBzZXR0aW5ncyBmb3IgYXR0YWNoaW5nIG5ldyBkYXRlcGlja2VyIGZ1bmN0aW9uYWxpdHkKICAgQHJldHVybiAgalF1ZXJ5IG9iamVjdCAqLwokLmZuLmRhdGVwaWNrZXIgPSBmdW5jdGlvbihvcHRpb25zKXsKCgkvKiBWZXJpZnkgYW4gZW1wdHkgY29sbGVjdGlvbiB3YXNuJ3QgcGFzc2VkIC0gRml4ZXMgIzY5NzYgKi8KCWlmICggIXRoaXMubGVuZ3RoICkgewoJCXJldHVybiB0aGlzOwoJfQoKCS8qIEluaXRpYWxpc2UgdGhlIGRhdGUgcGlja2VyLiAqLwoJaWYgKCEkLmRhdGVwaWNrZXIuaW5pdGlhbGl6ZWQpIHsKCQkkKGRvY3VtZW50KS5tb3VzZWRvd24oJC5kYXRlcGlja2VyLl9jaGVja0V4dGVybmFsQ2xpY2spOwoJCSQuZGF0ZXBpY2tlci5pbml0aWFsaXplZCA9IHRydWU7Cgl9CgoJLyogQXBwZW5kIGRhdGVwaWNrZXIgbWFpbiBjb250YWluZXIgdG8gYm9keSBpZiBub3QgZXhpc3QuICovCglpZiAoJCgiIyIrJC5kYXRlcGlja2VyLl9tYWluRGl2SWQpLmxlbmd0aCA9PT0gMCkgewoJCSQoImJvZHkiKS5hcHBlbmQoJC5kYXRlcGlja2VyLmRwRGl2KTsKCX0KCgl2YXIgb3RoZXJBcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKCWlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gInN0cmluZyIgJiYgKG9wdGlvbnMgPT09ICJpc0Rpc2FibGVkIiB8fCBvcHRpb25zID09PSAiZ2V0RGF0ZSIgfHwgb3B0aW9ucyA9PT0gIndpZGdldCIpKSB7CgkJcmV0dXJuICQuZGF0ZXBpY2tlclsiXyIgKyBvcHRpb25zICsgIkRhdGVwaWNrZXIiXS4KCQkJYXBwbHkoJC5kYXRlcGlja2VyLCBbdGhpc1swXV0uY29uY2F0KG90aGVyQXJncykpOwoJfQoJaWYgKG9wdGlvbnMgPT09ICJvcHRpb24iICYmIGFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgdHlwZW9mIGFyZ3VtZW50c1sxXSA9PT0gInN0cmluZyIpIHsKCQlyZXR1cm4gJC5kYXRlcGlja2VyWyJfIiArIG9wdGlvbnMgKyAiRGF0ZXBpY2tlciJdLgoJCQlhcHBseSgkLmRhdGVwaWNrZXIsIFt0aGlzWzBdXS5jb25jYXQob3RoZXJBcmdzKSk7Cgl9CglyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCXR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIiA/CgkJCSQuZGF0ZXBpY2tlclsiXyIgKyBvcHRpb25zICsgIkRhdGVwaWNrZXIiXS4KCQkJCWFwcGx5KCQuZGF0ZXBpY2tlciwgW3RoaXNdLmNvbmNhdChvdGhlckFyZ3MpKSA6CgkJCSQuZGF0ZXBpY2tlci5fYXR0YWNoRGF0ZXBpY2tlcih0aGlzLCBvcHRpb25zKTsKCX0pOwp9OwoKJC5kYXRlcGlja2VyID0gbmV3IERhdGVwaWNrZXIoKTsgLy8gc2luZ2xldG9uIGluc3RhbmNlCiQuZGF0ZXBpY2tlci5pbml0aWFsaXplZCA9IGZhbHNlOwokLmRhdGVwaWNrZXIudXVpZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwokLmRhdGVwaWNrZXIudmVyc2lvbiA9ICIxLjEwLjQiOwoKfSkoalF1ZXJ5KTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKdmFyIHNpemVSZWxhdGVkT3B0aW9ucyA9IHsKCQlidXR0b25zOiB0cnVlLAoJCWhlaWdodDogdHJ1ZSwKCQltYXhIZWlnaHQ6IHRydWUsCgkJbWF4V2lkdGg6IHRydWUsCgkJbWluSGVpZ2h0OiB0cnVlLAoJCW1pbldpZHRoOiB0cnVlLAoJCXdpZHRoOiB0cnVlCgl9LAoJcmVzaXphYmxlUmVsYXRlZE9wdGlvbnMgPSB7CgkJbWF4SGVpZ2h0OiB0cnVlLAoJCW1heFdpZHRoOiB0cnVlLAoJCW1pbkhlaWdodDogdHJ1ZSwKCQltaW5XaWR0aDogdHJ1ZQoJfTsKCiQud2lkZ2V0KCAidWkuZGlhbG9nIiwgewoJdmVyc2lvbjogIjEuMTAuNCIsCglvcHRpb25zOiB7CgkJYXBwZW5kVG86ICJib2R5IiwKCQlhdXRvT3BlbjogdHJ1ZSwKCQlidXR0b25zOiBbXSwKCQljbG9zZU9uRXNjYXBlOiB0cnVlLAoJCWNsb3NlVGV4dDogImNsb3NlIiwKCQlkaWFsb2dDbGFzczogIiIsCgkJZHJhZ2dhYmxlOiB0cnVlLAoJCWhpZGU6IG51bGwsCgkJaGVpZ2h0OiAiYXV0byIsCgkJbWF4SGVpZ2h0OiBudWxsLAoJCW1heFdpZHRoOiBudWxsLAoJCW1pbkhlaWdodDogMTUwLAoJCW1pbldpZHRoOiAxNTAsCgkJbW9kYWw6IGZhbHNlLAoJCXBvc2l0aW9uOiB7CgkJCW15OiAiY2VudGVyIiwKCQkJYXQ6ICJjZW50ZXIiLAoJCQlvZjogd2luZG93LAoJCQljb2xsaXNpb246ICJmaXQiLAoJCQkvLyBFbnN1cmUgdGhlIHRpdGxlYmFyIGlzIGFsd2F5cyB2aXNpYmxlCgkJCXVzaW5nOiBmdW5jdGlvbiggcG9zICkgewoJCQkJdmFyIHRvcE9mZnNldCA9ICQoIHRoaXMgKS5jc3MoIHBvcyApLm9mZnNldCgpLnRvcDsKCQkJCWlmICggdG9wT2Zmc2V0IDwgMCApIHsKCQkJCQkkKCB0aGlzICkuY3NzKCAidG9wIiwgcG9zLnRvcCAtIHRvcE9mZnNldCApOwoJCQkJfQoJCQl9CgkJfSwKCQlyZXNpemFibGU6IHRydWUsCgkJc2hvdzogbnVsbCwKCQl0aXRsZTogbnVsbCwKCQl3aWR0aDogMzAwLAoKCQkvLyBjYWxsYmFja3MKCQliZWZvcmVDbG9zZTogbnVsbCwKCQljbG9zZTogbnVsbCwKCQlkcmFnOiBudWxsLAoJCWRyYWdTdGFydDogbnVsbCwKCQlkcmFnU3RvcDogbnVsbCwKCQlmb2N1czogbnVsbCwKCQlvcGVuOiBudWxsLAoJCXJlc2l6ZTogbnVsbCwKCQlyZXNpemVTdGFydDogbnVsbCwKCQlyZXNpemVTdG9wOiBudWxsCgl9LAoKCV9jcmVhdGU6IGZ1bmN0aW9uKCkgewoJCXRoaXMub3JpZ2luYWxDc3MgPSB7CgkJCWRpc3BsYXk6IHRoaXMuZWxlbWVudFswXS5zdHlsZS5kaXNwbGF5LAoJCQl3aWR0aDogdGhpcy5lbGVtZW50WzBdLnN0eWxlLndpZHRoLAoJCQltaW5IZWlnaHQ6IHRoaXMuZWxlbWVudFswXS5zdHlsZS5taW5IZWlnaHQsCgkJCW1heEhlaWdodDogdGhpcy5lbGVtZW50WzBdLnN0eWxlLm1heEhlaWdodCwKCQkJaGVpZ2h0OiB0aGlzLmVsZW1lbnRbMF0uc3R5bGUuaGVpZ2h0CgkJfTsKCQl0aGlzLm9yaWdpbmFsUG9zaXRpb24gPSB7CgkJCXBhcmVudDogdGhpcy5lbGVtZW50LnBhcmVudCgpLAoJCQlpbmRleDogdGhpcy5lbGVtZW50LnBhcmVudCgpLmNoaWxkcmVuKCkuaW5kZXgoIHRoaXMuZWxlbWVudCApCgkJfTsKCQl0aGlzLm9yaWdpbmFsVGl0bGUgPSB0aGlzLmVsZW1lbnQuYXR0cigidGl0bGUiKTsKCQl0aGlzLm9wdGlvbnMudGl0bGUgPSB0aGlzLm9wdGlvbnMudGl0bGUgfHwgdGhpcy5vcmlnaW5hbFRpdGxlOwoKCQl0aGlzLl9jcmVhdGVXcmFwcGVyKCk7CgoJCXRoaXMuZWxlbWVudAoJCQkuc2hvdygpCgkJCS5yZW1vdmVBdHRyKCJ0aXRsZSIpCgkJCS5hZGRDbGFzcygidWktZGlhbG9nLWNvbnRlbnQgdWktd2lkZ2V0LWNvbnRlbnQiKQoJCQkuYXBwZW5kVG8oIHRoaXMudWlEaWFsb2cgKTsKCgkJdGhpcy5fY3JlYXRlVGl0bGViYXIoKTsKCQl0aGlzLl9jcmVhdGVCdXR0b25QYW5lKCk7CgoJCWlmICggdGhpcy5vcHRpb25zLmRyYWdnYWJsZSAmJiAkLmZuLmRyYWdnYWJsZSApIHsKCQkJdGhpcy5fbWFrZURyYWdnYWJsZSgpOwoJCX0KCQlpZiAoIHRoaXMub3B0aW9ucy5yZXNpemFibGUgJiYgJC5mbi5yZXNpemFibGUgKSB7CgkJCXRoaXMuX21ha2VSZXNpemFibGUoKTsKCQl9CgoJCXRoaXMuX2lzT3BlbiA9IGZhbHNlOwoJfSwKCglfaW5pdDogZnVuY3Rpb24oKSB7CgkJaWYgKCB0aGlzLm9wdGlvbnMuYXV0b09wZW4gKSB7CgkJCXRoaXMub3BlbigpOwoJCX0KCX0sCgoJX2FwcGVuZFRvOiBmdW5jdGlvbigpIHsKCQl2YXIgZWxlbWVudCA9IHRoaXMub3B0aW9ucy5hcHBlbmRUbzsKCQlpZiAoIGVsZW1lbnQgJiYgKGVsZW1lbnQuanF1ZXJ5IHx8IGVsZW1lbnQubm9kZVR5cGUpICkgewoJCQlyZXR1cm4gJCggZWxlbWVudCApOwoJCX0KCQlyZXR1cm4gdGhpcy5kb2N1bWVudC5maW5kKCBlbGVtZW50IHx8ICJib2R5IiApLmVxKCAwICk7Cgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQl2YXIgbmV4dCwKCQkJb3JpZ2luYWxQb3NpdGlvbiA9IHRoaXMub3JpZ2luYWxQb3NpdGlvbjsKCgkJdGhpcy5fZGVzdHJveU92ZXJsYXkoKTsKCgkJdGhpcy5lbGVtZW50CgkJCS5yZW1vdmVVbmlxdWVJZCgpCgkJCS5yZW1vdmVDbGFzcygidWktZGlhbG9nLWNvbnRlbnQgdWktd2lkZ2V0LWNvbnRlbnQiKQoJCQkuY3NzKCB0aGlzLm9yaWdpbmFsQ3NzICkKCQkJLy8gV2l0aG91dCBkZXRhY2hpbmcgZmlyc3QsIHRoZSBmb2xsb3dpbmcgYmVjb21lcyByZWFsbHkgc2xvdwoJCQkuZGV0YWNoKCk7CgoJCXRoaXMudWlEaWFsb2cuc3RvcCggdHJ1ZSwgdHJ1ZSApLnJlbW92ZSgpOwoKCQlpZiAoIHRoaXMub3JpZ2luYWxUaXRsZSApIHsKCQkJdGhpcy5lbGVtZW50LmF0dHIoICJ0aXRsZSIsIHRoaXMub3JpZ2luYWxUaXRsZSApOwoJCX0KCgkJbmV4dCA9IG9yaWdpbmFsUG9zaXRpb24ucGFyZW50LmNoaWxkcmVuKCkuZXEoIG9yaWdpbmFsUG9zaXRpb24uaW5kZXggKTsKCQkvLyBEb24ndCB0cnkgdG8gcGxhY2UgdGhlIGRpYWxvZyBuZXh0IHRvIGl0c2VsZiAoIzg2MTMpCgkJaWYgKCBuZXh0Lmxlbmd0aCAmJiBuZXh0WzBdICE9PSB0aGlzLmVsZW1lbnRbMF0gKSB7CgkJCW5leHQuYmVmb3JlKCB0aGlzLmVsZW1lbnQgKTsKCQl9IGVsc2UgewoJCQlvcmlnaW5hbFBvc2l0aW9uLnBhcmVudC5hcHBlbmQoIHRoaXMuZWxlbWVudCApOwoJCX0KCX0sCgoJd2lkZ2V0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy51aURpYWxvZzsKCX0sCgoJZGlzYWJsZTogJC5ub29wLAoJZW5hYmxlOiAkLm5vb3AsCgoJY2xvc2U6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgYWN0aXZlRWxlbWVudCwKCQkJdGhhdCA9IHRoaXM7CgoJCWlmICggIXRoaXMuX2lzT3BlbiB8fCB0aGlzLl90cmlnZ2VyKCAiYmVmb3JlQ2xvc2UiLCBldmVudCApID09PSBmYWxzZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5faXNPcGVuID0gZmFsc2U7CgkJdGhpcy5fZGVzdHJveU92ZXJsYXkoKTsKCgkJaWYgKCAhdGhpcy5vcGVuZXIuZmlsdGVyKCI6Zm9jdXNhYmxlIikuZm9jdXMoKS5sZW5ndGggKSB7CgoJCQkvLyBzdXBwb3J0OiBJRTkKCQkJLy8gSUU5IHRocm93cyBhbiAiVW5zcGVjaWZpZWQgZXJyb3IiIGFjY2Vzc2luZyBkb2N1bWVudC5hY3RpdmVFbGVtZW50IGZyb20gYW4gPGlmcmFtZT4KCQkJdHJ5IHsKCQkJCWFjdGl2ZUVsZW1lbnQgPSB0aGlzLmRvY3VtZW50WyAwIF0uYWN0aXZlRWxlbWVudDsKCgkJCQkvLyBTdXBwb3J0OiBJRTksIElFMTAKCQkJCS8vIElmIHRoZSA8Ym9keT4gaXMgYmx1cnJlZCwgSUUgd2lsbCBzd2l0Y2ggd2luZG93cywgc2VlICM0NTIwCgkJCQlpZiAoIGFjdGl2ZUVsZW1lbnQgJiYgYWN0aXZlRWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAiYm9keSIgKSB7CgoJCQkJCS8vIEhpZGluZyBhIGZvY3VzZWQgZWxlbWVudCBkb2Vzbid0IHRyaWdnZXIgYmx1ciBpbiBXZWJLaXQKCQkJCQkvLyBzbyBpbiBjYXNlIHdlIGhhdmUgbm90aGluZyB0byBmb2N1cyBvbiwgZXhwbGljaXRseSBibHVyIHRoZSBhY3RpdmUgZWxlbWVudAoJCQkJCS8vIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD00NzE4MgoJCQkJCSQoIGFjdGl2ZUVsZW1lbnQgKS5ibHVyKCk7CgkJCQl9CgkJCX0gY2F0Y2ggKCBlcnJvciApIHt9CgkJfQoKCQl0aGlzLl9oaWRlKCB0aGlzLnVpRGlhbG9nLCB0aGlzLm9wdGlvbnMuaGlkZSwgZnVuY3Rpb24oKSB7CgkJCXRoYXQuX3RyaWdnZXIoICJjbG9zZSIsIGV2ZW50ICk7CgkJfSk7Cgl9LAoKCWlzT3BlbjogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuX2lzT3BlbjsKCX0sCgoJbW92ZVRvVG9wOiBmdW5jdGlvbigpIHsKCQl0aGlzLl9tb3ZlVG9Ub3AoKTsKCX0sCgoJX21vdmVUb1RvcDogZnVuY3Rpb24oIGV2ZW50LCBzaWxlbnQgKSB7CgkJdmFyIG1vdmVkID0gISF0aGlzLnVpRGlhbG9nLm5leHRBbGwoIjp2aXNpYmxlIikuaW5zZXJ0QmVmb3JlKCB0aGlzLnVpRGlhbG9nICkubGVuZ3RoOwoJCWlmICggbW92ZWQgJiYgIXNpbGVudCApIHsKCQkJdGhpcy5fdHJpZ2dlciggImZvY3VzIiwgZXZlbnQgKTsKCQl9CgkJcmV0dXJuIG1vdmVkOwoJfSwKCglvcGVuOiBmdW5jdGlvbigpIHsKCQl2YXIgdGhhdCA9IHRoaXM7CgkJaWYgKCB0aGlzLl9pc09wZW4gKSB7CgkJCWlmICggdGhpcy5fbW92ZVRvVG9wKCkgKSB7CgkJCQl0aGlzLl9mb2N1c1RhYmJhYmxlKCk7CgkJCX0KCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5faXNPcGVuID0gdHJ1ZTsKCQl0aGlzLm9wZW5lciA9ICQoIHRoaXMuZG9jdW1lbnRbMF0uYWN0aXZlRWxlbWVudCApOwoKCQl0aGlzLl9zaXplKCk7CgkJdGhpcy5fcG9zaXRpb24oKTsKCQl0aGlzLl9jcmVhdGVPdmVybGF5KCk7CgkJdGhpcy5fbW92ZVRvVG9wKCBudWxsLCB0cnVlICk7CgkJdGhpcy5fc2hvdyggdGhpcy51aURpYWxvZywgdGhpcy5vcHRpb25zLnNob3csIGZ1bmN0aW9uKCkgewoJCQl0aGF0Ll9mb2N1c1RhYmJhYmxlKCk7CgkJCXRoYXQuX3RyaWdnZXIoImZvY3VzIik7CgkJfSk7CgoJCXRoaXMuX3RyaWdnZXIoIm9wZW4iKTsKCX0sCgoJX2ZvY3VzVGFiYmFibGU6IGZ1bmN0aW9uKCkgewoJCS8vIFNldCBmb2N1cyB0byB0aGUgZmlyc3QgbWF0Y2g6CgkJLy8gMS4gRmlyc3QgZWxlbWVudCBpbnNpZGUgdGhlIGRpYWxvZyBtYXRjaGluZyBbYXV0b2ZvY3VzXQoJCS8vIDIuIFRhYmJhYmxlIGVsZW1lbnQgaW5zaWRlIHRoZSBjb250ZW50IGVsZW1lbnQKCQkvLyAzLiBUYWJiYWJsZSBlbGVtZW50IGluc2lkZSB0aGUgYnV0dG9ucGFuZQoJCS8vIDQuIFRoZSBjbG9zZSBidXR0b24KCQkvLyA1LiBUaGUgZGlhbG9nIGl0c2VsZgoJCXZhciBoYXNGb2N1cyA9IHRoaXMuZWxlbWVudC5maW5kKCJbYXV0b2ZvY3VzXSIpOwoJCWlmICggIWhhc0ZvY3VzLmxlbmd0aCApIHsKCQkJaGFzRm9jdXMgPSB0aGlzLmVsZW1lbnQuZmluZCgiOnRhYmJhYmxlIik7CgkJfQoJCWlmICggIWhhc0ZvY3VzLmxlbmd0aCApIHsKCQkJaGFzRm9jdXMgPSB0aGlzLnVpRGlhbG9nQnV0dG9uUGFuZS5maW5kKCI6dGFiYmFibGUiKTsKCQl9CgkJaWYgKCAhaGFzRm9jdXMubGVuZ3RoICkgewoJCQloYXNGb2N1cyA9IHRoaXMudWlEaWFsb2dUaXRsZWJhckNsb3NlLmZpbHRlcigiOnRhYmJhYmxlIik7CgkJfQoJCWlmICggIWhhc0ZvY3VzLmxlbmd0aCApIHsKCQkJaGFzRm9jdXMgPSB0aGlzLnVpRGlhbG9nOwoJCX0KCQloYXNGb2N1cy5lcSggMCApLmZvY3VzKCk7Cgl9LAoKCV9rZWVwRm9jdXM6IGZ1bmN0aW9uKCBldmVudCApIHsKCQlmdW5jdGlvbiBjaGVja0ZvY3VzKCkgewoJCQl2YXIgYWN0aXZlRWxlbWVudCA9IHRoaXMuZG9jdW1lbnRbMF0uYWN0aXZlRWxlbWVudCwKCQkJCWlzQWN0aXZlID0gdGhpcy51aURpYWxvZ1swXSA9PT0gYWN0aXZlRWxlbWVudCB8fAoJCQkJCSQuY29udGFpbnMoIHRoaXMudWlEaWFsb2dbMF0sIGFjdGl2ZUVsZW1lbnQgKTsKCQkJaWYgKCAhaXNBY3RpdmUgKSB7CgkJCQl0aGlzLl9mb2N1c1RhYmJhYmxlKCk7CgkJCX0KCQl9CgkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQljaGVja0ZvY3VzLmNhbGwoIHRoaXMgKTsKCQkvLyBzdXBwb3J0OiBJRQoJCS8vIElFIDw9IDggZG9lc24ndCBwcmV2ZW50IG1vdmluZyBmb2N1cyBldmVuIHdpdGggZXZlbnQucHJldmVudERlZmF1bHQoKQoJCS8vIHNvIHdlIGNoZWNrIGFnYWluIGxhdGVyCgkJdGhpcy5fZGVsYXkoIGNoZWNrRm9jdXMgKTsKCX0sCgoJX2NyZWF0ZVdyYXBwZXI6IGZ1bmN0aW9uKCkgewoJCXRoaXMudWlEaWFsb2cgPSAkKCI8ZGl2PiIpCgkJCS5hZGRDbGFzcyggInVpLWRpYWxvZyB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCB1aS1mcm9udCAiICsKCQkJCXRoaXMub3B0aW9ucy5kaWFsb2dDbGFzcyApCgkJCS5oaWRlKCkKCQkJLmF0dHIoewoJCQkJLy8gU2V0dGluZyB0YWJJbmRleCBtYWtlcyB0aGUgZGl2IGZvY3VzYWJsZQoJCQkJdGFiSW5kZXg6IC0xLAoJCQkJcm9sZTogImRpYWxvZyIKCQkJfSkKCQkJLmFwcGVuZFRvKCB0aGlzLl9hcHBlbmRUbygpICk7CgoJCXRoaXMuX29uKCB0aGlzLnVpRGlhbG9nLCB7CgkJCWtleWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCWlmICggdGhpcy5vcHRpb25zLmNsb3NlT25Fc2NhcGUgJiYgIWV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpICYmIGV2ZW50LmtleUNvZGUgJiYKCQkJCQkJZXZlbnQua2V5Q29kZSA9PT0gJC51aS5rZXlDb2RlLkVTQ0FQRSApIHsKCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCXRoaXMuY2xvc2UoIGV2ZW50ICk7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCS8vIHByZXZlbnQgdGFiYmluZyBvdXQgb2YgZGlhbG9ncwoJCQkJaWYgKCBldmVudC5rZXlDb2RlICE9PSAkLnVpLmtleUNvZGUuVEFCICkgewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCXZhciB0YWJiYWJsZXMgPSB0aGlzLnVpRGlhbG9nLmZpbmQoIjp0YWJiYWJsZSIpLAoJCQkJCWZpcnN0ID0gdGFiYmFibGVzLmZpbHRlcigiOmZpcnN0IiksCgkJCQkJbGFzdCAgPSB0YWJiYWJsZXMuZmlsdGVyKCI6bGFzdCIpOwoKCQkJCWlmICggKCBldmVudC50YXJnZXQgPT09IGxhc3RbMF0gfHwgZXZlbnQudGFyZ2V0ID09PSB0aGlzLnVpRGlhbG9nWzBdICkgJiYgIWV2ZW50LnNoaWZ0S2V5ICkgewoJCQkJCWZpcnN0LmZvY3VzKCAxICk7CgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCX0gZWxzZSBpZiAoICggZXZlbnQudGFyZ2V0ID09PSBmaXJzdFswXSB8fCBldmVudC50YXJnZXQgPT09IHRoaXMudWlEaWFsb2dbMF0gKSAmJiBldmVudC5zaGlmdEtleSApIHsKCQkJCQlsYXN0LmZvY3VzKCAxICk7CgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCX0KCQkJfSwKCQkJbW91c2Vkb3duOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlpZiAoIHRoaXMuX21vdmVUb1RvcCggZXZlbnQgKSApIHsKCQkJCQl0aGlzLl9mb2N1c1RhYmJhYmxlKCk7CgkJCQl9CgkJCX0KCQl9KTsKCgkJLy8gV2UgYXNzdW1lIHRoYXQgYW55IGV4aXN0aW5nIGFyaWEtZGVzY3JpYmVkYnkgYXR0cmlidXRlIG1lYW5zCgkJLy8gdGhhdCB0aGUgZGlhbG9nIGNvbnRlbnQgaXMgbWFya2VkIHVwIHByb3Blcmx5CgkJLy8gb3RoZXJ3aXNlIHdlIGJydXRlIGZvcmNlIHRoZSBjb250ZW50IGFzIHRoZSBkZXNjcmlwdGlvbgoJCWlmICggIXRoaXMuZWxlbWVudC5maW5kKCJbYXJpYS1kZXNjcmliZWRieV0iKS5sZW5ndGggKSB7CgkJCXRoaXMudWlEaWFsb2cuYXR0cih7CgkJCQkiYXJpYS1kZXNjcmliZWRieSI6IHRoaXMuZWxlbWVudC51bmlxdWVJZCgpLmF0dHIoImlkIikKCQkJfSk7CgkJfQoJfSwKCglfY3JlYXRlVGl0bGViYXI6IGZ1bmN0aW9uKCkgewoJCXZhciB1aURpYWxvZ1RpdGxlOwoKCQl0aGlzLnVpRGlhbG9nVGl0bGViYXIgPSAkKCI8ZGl2PiIpCgkJCS5hZGRDbGFzcygidWktZGlhbG9nLXRpdGxlYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWFsbCB1aS1oZWxwZXItY2xlYXJmaXgiKQoJCQkucHJlcGVuZFRvKCB0aGlzLnVpRGlhbG9nICk7CgkJdGhpcy5fb24oIHRoaXMudWlEaWFsb2dUaXRsZWJhciwgewoJCQltb3VzZWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCS8vIERvbid0IHByZXZlbnQgY2xpY2sgb24gY2xvc2UgYnV0dG9uICgjODgzOCkKCQkJCS8vIEZvY3VzaW5nIGEgZGlhbG9nIHRoYXQgaXMgcGFydGlhbGx5IHNjcm9sbGVkIG91dCBvZiB2aWV3CgkJCQkvLyBjYXVzZXMgdGhlIGJyb3dzZXIgdG8gc2Nyb2xsIGl0IGludG8gdmlldywgcHJldmVudGluZyB0aGUgY2xpY2sgZXZlbnQKCQkJCWlmICggISQoIGV2ZW50LnRhcmdldCApLmNsb3Nlc3QoIi51aS1kaWFsb2ctdGl0bGViYXItY2xvc2UiKSApIHsKCQkJCQkvLyBEaWFsb2cgaXNuJ3QgZ2V0dGluZyBmb2N1cyB3aGVuIGRyYWdnaW5nICgjODA2MykKCQkJCQl0aGlzLnVpRGlhbG9nLmZvY3VzKCk7CgkJCQl9CgkJCX0KCQl9KTsKCgkJLy8gc3VwcG9ydDogSUUKCQkvLyBVc2UgdHlwZT0iYnV0dG9uIiB0byBwcmV2ZW50IGVudGVyIGtleXByZXNzZXMgaW4gdGV4dGJveGVzIGZyb20gY2xvc2luZyB0aGUKCQkvLyBkaWFsb2cgaW4gSUUgKCM5MzEyKQoJCXRoaXMudWlEaWFsb2dUaXRsZWJhckNsb3NlID0gJCggIjxidXR0b24gdHlwZT0nYnV0dG9uJz48L2J1dHRvbj4iICkKCQkJLmJ1dHRvbih7CgkJCQlsYWJlbDogdGhpcy5vcHRpb25zLmNsb3NlVGV4dCwKCQkJCWljb25zOiB7CgkJCQkJcHJpbWFyeTogInVpLWljb24tY2xvc2V0aGljayIKCQkJCX0sCgkJCQl0ZXh0OiBmYWxzZQoJCQl9KQoJCQkuYWRkQ2xhc3MoInVpLWRpYWxvZy10aXRsZWJhci1jbG9zZSIpCgkJCS5hcHBlbmRUbyggdGhpcy51aURpYWxvZ1RpdGxlYmFyICk7CgkJdGhpcy5fb24oIHRoaXMudWlEaWFsb2dUaXRsZWJhckNsb3NlLCB7CgkJCWNsaWNrOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJdGhpcy5jbG9zZSggZXZlbnQgKTsKCQkJfQoJCX0pOwoKCQl1aURpYWxvZ1RpdGxlID0gJCgiPHNwYW4+IikKCQkJLnVuaXF1ZUlkKCkKCQkJLmFkZENsYXNzKCJ1aS1kaWFsb2ctdGl0bGUiKQoJCQkucHJlcGVuZFRvKCB0aGlzLnVpRGlhbG9nVGl0bGViYXIgKTsKCQl0aGlzLl90aXRsZSggdWlEaWFsb2dUaXRsZSApOwoKCQl0aGlzLnVpRGlhbG9nLmF0dHIoewoJCQkiYXJpYS1sYWJlbGxlZGJ5IjogdWlEaWFsb2dUaXRsZS5hdHRyKCJpZCIpCgkJfSk7Cgl9LAoKCV90aXRsZTogZnVuY3Rpb24oIHRpdGxlICkgewoJCWlmICggIXRoaXMub3B0aW9ucy50aXRsZSApIHsKCQkJdGl0bGUuaHRtbCgiJiMxNjA7Iik7CgkJfQoJCXRpdGxlLnRleHQoIHRoaXMub3B0aW9ucy50aXRsZSApOwoJfSwKCglfY3JlYXRlQnV0dG9uUGFuZTogZnVuY3Rpb24oKSB7CgkJdGhpcy51aURpYWxvZ0J1dHRvblBhbmUgPSAkKCI8ZGl2PiIpCgkJCS5hZGRDbGFzcygidWktZGlhbG9nLWJ1dHRvbnBhbmUgdWktd2lkZ2V0LWNvbnRlbnQgdWktaGVscGVyLWNsZWFyZml4Iik7CgoJCXRoaXMudWlCdXR0b25TZXQgPSAkKCI8ZGl2PiIpCgkJCS5hZGRDbGFzcygidWktZGlhbG9nLWJ1dHRvbnNldCIpCgkJCS5hcHBlbmRUbyggdGhpcy51aURpYWxvZ0J1dHRvblBhbmUgKTsKCgkJdGhpcy5fY3JlYXRlQnV0dG9ucygpOwoJfSwKCglfY3JlYXRlQnV0dG9uczogZnVuY3Rpb24oKSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlidXR0b25zID0gdGhpcy5vcHRpb25zLmJ1dHRvbnM7CgoJCS8vIGlmIHdlIGFscmVhZHkgaGF2ZSBhIGJ1dHRvbiBwYW5lLCByZW1vdmUgaXQKCQl0aGlzLnVpRGlhbG9nQnV0dG9uUGFuZS5yZW1vdmUoKTsKCQl0aGlzLnVpQnV0dG9uU2V0LmVtcHR5KCk7CgoJCWlmICggJC5pc0VtcHR5T2JqZWN0KCBidXR0b25zICkgfHwgKCQuaXNBcnJheSggYnV0dG9ucyApICYmICFidXR0b25zLmxlbmd0aCkgKSB7CgkJCXRoaXMudWlEaWFsb2cucmVtb3ZlQ2xhc3MoInVpLWRpYWxvZy1idXR0b25zIik7CgkJCXJldHVybjsKCQl9CgoJCSQuZWFjaCggYnV0dG9ucywgZnVuY3Rpb24oIG5hbWUsIHByb3BzICkgewoJCQl2YXIgY2xpY2ssIGJ1dHRvbk9wdGlvbnM7CgkJCXByb3BzID0gJC5pc0Z1bmN0aW9uKCBwcm9wcyApID8KCQkJCXsgY2xpY2s6IHByb3BzLCB0ZXh0OiBuYW1lIH0gOgoJCQkJcHJvcHM7CgkJCS8vIERlZmF1bHQgdG8gYSBub24tc3VibWl0dGluZyBidXR0b24KCQkJcHJvcHMgPSAkLmV4dGVuZCggeyB0eXBlOiAiYnV0dG9uIiB9LCBwcm9wcyApOwoJCQkvLyBDaGFuZ2UgdGhlIGNvbnRleHQgZm9yIHRoZSBjbGljayBjYWxsYmFjayB0byBiZSB0aGUgbWFpbiBlbGVtZW50CgkJCWNsaWNrID0gcHJvcHMuY2xpY2s7CgkJCXByb3BzLmNsaWNrID0gZnVuY3Rpb24oKSB7CgkJCQljbGljay5hcHBseSggdGhhdC5lbGVtZW50WzBdLCBhcmd1bWVudHMgKTsKCQkJfTsKCQkJYnV0dG9uT3B0aW9ucyA9IHsKCQkJCWljb25zOiBwcm9wcy5pY29ucywKCQkJCXRleHQ6IHByb3BzLnNob3dUZXh0CgkJCX07CgkJCWRlbGV0ZSBwcm9wcy5pY29uczsKCQkJZGVsZXRlIHByb3BzLnNob3dUZXh0OwoJCQkkKCAiPGJ1dHRvbj48L2J1dHRvbj4iLCBwcm9wcyApCgkJCQkuYnV0dG9uKCBidXR0b25PcHRpb25zICkKCQkJCS5hcHBlbmRUbyggdGhhdC51aUJ1dHRvblNldCApOwoJCX0pOwoJCXRoaXMudWlEaWFsb2cuYWRkQ2xhc3MoInVpLWRpYWxvZy1idXR0b25zIik7CgkJdGhpcy51aURpYWxvZ0J1dHRvblBhbmUuYXBwZW5kVG8oIHRoaXMudWlEaWFsb2cgKTsKCX0sCgoJX21ha2VEcmFnZ2FibGU6IGZ1bmN0aW9uKCkgewoJCXZhciB0aGF0ID0gdGhpcywKCQkJb3B0aW9ucyA9IHRoaXMub3B0aW9uczsKCgkJZnVuY3Rpb24gZmlsdGVyZWRVaSggdWkgKSB7CgkJCXJldHVybiB7CgkJCQlwb3NpdGlvbjogdWkucG9zaXRpb24sCgkJCQlvZmZzZXQ6IHVpLm9mZnNldAoJCQl9OwoJCX0KCgkJdGhpcy51aURpYWxvZy5kcmFnZ2FibGUoewoJCQljYW5jZWw6ICIudWktZGlhbG9nLWNvbnRlbnQsIC51aS1kaWFsb2ctdGl0bGViYXItY2xvc2UiLAoJCQloYW5kbGU6ICIudWktZGlhbG9nLXRpdGxlYmFyIiwKCQkJY29udGFpbm1lbnQ6ICJkb2N1bWVudCIsCgkJCXN0YXJ0OiBmdW5jdGlvbiggZXZlbnQsIHVpICkgewoJCQkJJCggdGhpcyApLmFkZENsYXNzKCJ1aS1kaWFsb2ctZHJhZ2dpbmciKTsKCQkJCXRoYXQuX2Jsb2NrRnJhbWVzKCk7CgkJCQl0aGF0Ll90cmlnZ2VyKCAiZHJhZ1N0YXJ0IiwgZXZlbnQsIGZpbHRlcmVkVWkoIHVpICkgKTsKCQkJfSwKCQkJZHJhZzogZnVuY3Rpb24oIGV2ZW50LCB1aSApIHsKCQkJCXRoYXQuX3RyaWdnZXIoICJkcmFnIiwgZXZlbnQsIGZpbHRlcmVkVWkoIHVpICkgKTsKCQkJfSwKCQkJc3RvcDogZnVuY3Rpb24oIGV2ZW50LCB1aSApIHsKCQkJCW9wdGlvbnMucG9zaXRpb24gPSBbCgkJCQkJdWkucG9zaXRpb24ubGVmdCAtIHRoYXQuZG9jdW1lbnQuc2Nyb2xsTGVmdCgpLAoJCQkJCXVpLnBvc2l0aW9uLnRvcCAtIHRoYXQuZG9jdW1lbnQuc2Nyb2xsVG9wKCkKCQkJCV07CgkJCQkkKCB0aGlzICkucmVtb3ZlQ2xhc3MoInVpLWRpYWxvZy1kcmFnZ2luZyIpOwoJCQkJdGhhdC5fdW5ibG9ja0ZyYW1lcygpOwoJCQkJdGhhdC5fdHJpZ2dlciggImRyYWdTdG9wIiwgZXZlbnQsIGZpbHRlcmVkVWkoIHVpICkgKTsKCQkJfQoJCX0pOwoJfSwKCglfbWFrZVJlc2l6YWJsZTogZnVuY3Rpb24oKSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlvcHRpb25zID0gdGhpcy5vcHRpb25zLAoJCQloYW5kbGVzID0gb3B0aW9ucy5yZXNpemFibGUsCgkJCS8vIC51aS1yZXNpemFibGUgaGFzIHBvc2l0aW9uOiByZWxhdGl2ZSBkZWZpbmVkIGluIHRoZSBzdHlsZXNoZWV0CgkJCS8vIGJ1dCBkaWFsb2dzIGhhdmUgdG8gdXNlIGFic29sdXRlIG9yIGZpeGVkIHBvc2l0aW9uaW5nCgkJCXBvc2l0aW9uID0gdGhpcy51aURpYWxvZy5jc3MoInBvc2l0aW9uIiksCgkJCXJlc2l6ZUhhbmRsZXMgPSB0eXBlb2YgaGFuZGxlcyA9PT0gInN0cmluZyIgPwoJCQkJaGFuZGxlcwk6CgkJCQkibixlLHMsdyxzZSxzdyxuZSxudyI7CgoJCWZ1bmN0aW9uIGZpbHRlcmVkVWkoIHVpICkgewoJCQlyZXR1cm4gewoJCQkJb3JpZ2luYWxQb3NpdGlvbjogdWkub3JpZ2luYWxQb3NpdGlvbiwKCQkJCW9yaWdpbmFsU2l6ZTogdWkub3JpZ2luYWxTaXplLAoJCQkJcG9zaXRpb246IHVpLnBvc2l0aW9uLAoJCQkJc2l6ZTogdWkuc2l6ZQoJCQl9OwoJCX0KCgkJdGhpcy51aURpYWxvZy5yZXNpemFibGUoewoJCQljYW5jZWw6ICIudWktZGlhbG9nLWNvbnRlbnQiLAoJCQljb250YWlubWVudDogImRvY3VtZW50IiwKCQkJYWxzb1Jlc2l6ZTogdGhpcy5lbGVtZW50LAoJCQltYXhXaWR0aDogb3B0aW9ucy5tYXhXaWR0aCwKCQkJbWF4SGVpZ2h0OiBvcHRpb25zLm1heEhlaWdodCwKCQkJbWluV2lkdGg6IG9wdGlvbnMubWluV2lkdGgsCgkJCW1pbkhlaWdodDogdGhpcy5fbWluSGVpZ2h0KCksCgkJCWhhbmRsZXM6IHJlc2l6ZUhhbmRsZXMsCgkJCXN0YXJ0OiBmdW5jdGlvbiggZXZlbnQsIHVpICkgewoJCQkJJCggdGhpcyApLmFkZENsYXNzKCJ1aS1kaWFsb2ctcmVzaXppbmciKTsKCQkJCXRoYXQuX2Jsb2NrRnJhbWVzKCk7CgkJCQl0aGF0Ll90cmlnZ2VyKCAicmVzaXplU3RhcnQiLCBldmVudCwgZmlsdGVyZWRVaSggdWkgKSApOwoJCQl9LAoJCQlyZXNpemU6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7CgkJCQl0aGF0Ll90cmlnZ2VyKCAicmVzaXplIiwgZXZlbnQsIGZpbHRlcmVkVWkoIHVpICkgKTsKCQkJfSwKCQkJc3RvcDogZnVuY3Rpb24oIGV2ZW50LCB1aSApIHsKCQkJCW9wdGlvbnMuaGVpZ2h0ID0gJCggdGhpcyApLmhlaWdodCgpOwoJCQkJb3B0aW9ucy53aWR0aCA9ICQoIHRoaXMgKS53aWR0aCgpOwoJCQkJJCggdGhpcyApLnJlbW92ZUNsYXNzKCJ1aS1kaWFsb2ctcmVzaXppbmciKTsKCQkJCXRoYXQuX3VuYmxvY2tGcmFtZXMoKTsKCQkJCXRoYXQuX3RyaWdnZXIoICJyZXNpemVTdG9wIiwgZXZlbnQsIGZpbHRlcmVkVWkoIHVpICkgKTsKCQkJfQoJCX0pCgkJLmNzcyggInBvc2l0aW9uIiwgcG9zaXRpb24gKTsKCX0sCgoJX21pbkhlaWdodDogZnVuY3Rpb24oKSB7CgkJdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgoJCXJldHVybiBvcHRpb25zLmhlaWdodCA9PT0gImF1dG8iID8KCQkJb3B0aW9ucy5taW5IZWlnaHQgOgoJCQlNYXRoLm1pbiggb3B0aW9ucy5taW5IZWlnaHQsIG9wdGlvbnMuaGVpZ2h0ICk7Cgl9LAoKCV9wb3NpdGlvbjogZnVuY3Rpb24oKSB7CgkJLy8gTmVlZCB0byBzaG93IHRoZSBkaWFsb2cgdG8gZ2V0IHRoZSBhY3R1YWwgb2Zmc2V0IGluIHRoZSBwb3NpdGlvbiBwbHVnaW4KCQl2YXIgaXNWaXNpYmxlID0gdGhpcy51aURpYWxvZy5pcygiOnZpc2libGUiKTsKCQlpZiAoICFpc1Zpc2libGUgKSB7CgkJCXRoaXMudWlEaWFsb2cuc2hvdygpOwoJCX0KCQl0aGlzLnVpRGlhbG9nLnBvc2l0aW9uKCB0aGlzLm9wdGlvbnMucG9zaXRpb24gKTsKCQlpZiAoICFpc1Zpc2libGUgKSB7CgkJCXRoaXMudWlEaWFsb2cuaGlkZSgpOwoJCX0KCX0sCgoJX3NldE9wdGlvbnM6IGZ1bmN0aW9uKCBvcHRpb25zICkgewoJCXZhciB0aGF0ID0gdGhpcywKCQkJcmVzaXplID0gZmFsc2UsCgkJCXJlc2l6YWJsZU9wdGlvbnMgPSB7fTsKCgkJJC5lYWNoKCBvcHRpb25zLCBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQkJdGhhdC5fc2V0T3B0aW9uKCBrZXksIHZhbHVlICk7CgoJCQlpZiAoIGtleSBpbiBzaXplUmVsYXRlZE9wdGlvbnMgKSB7CgkJCQlyZXNpemUgPSB0cnVlOwoJCQl9CgkJCWlmICgga2V5IGluIHJlc2l6YWJsZVJlbGF0ZWRPcHRpb25zICkgewoJCQkJcmVzaXphYmxlT3B0aW9uc1sga2V5IF0gPSB2YWx1ZTsKCQkJfQoJCX0pOwoKCQlpZiAoIHJlc2l6ZSApIHsKCQkJdGhpcy5fc2l6ZSgpOwoJCQl0aGlzLl9wb3NpdGlvbigpOwoJCX0KCQlpZiAoIHRoaXMudWlEaWFsb2cuaXMoIjpkYXRhKHVpLXJlc2l6YWJsZSkiKSApIHsKCQkJdGhpcy51aURpYWxvZy5yZXNpemFibGUoICJvcHRpb24iLCByZXNpemFibGVPcHRpb25zICk7CgkJfQoJfSwKCglfc2V0T3B0aW9uOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQl2YXIgaXNEcmFnZ2FibGUsIGlzUmVzaXphYmxlLAoJCQl1aURpYWxvZyA9IHRoaXMudWlEaWFsb2c7CgoJCWlmICgga2V5ID09PSAiZGlhbG9nQ2xhc3MiICkgewoJCQl1aURpYWxvZwoJCQkJLnJlbW92ZUNsYXNzKCB0aGlzLm9wdGlvbnMuZGlhbG9nQ2xhc3MgKQoJCQkJLmFkZENsYXNzKCB2YWx1ZSApOwoJCX0KCgkJaWYgKCBrZXkgPT09ICJkaXNhYmxlZCIgKSB7CgkJCXJldHVybjsKCQl9CgoJCXRoaXMuX3N1cGVyKCBrZXksIHZhbHVlICk7CgoJCWlmICgga2V5ID09PSAiYXBwZW5kVG8iICkgewoJCQl0aGlzLnVpRGlhbG9nLmFwcGVuZFRvKCB0aGlzLl9hcHBlbmRUbygpICk7CgkJfQoKCQlpZiAoIGtleSA9PT0gImJ1dHRvbnMiICkgewoJCQl0aGlzLl9jcmVhdGVCdXR0b25zKCk7CgkJfQoKCQlpZiAoIGtleSA9PT0gImNsb3NlVGV4dCIgKSB7CgkJCXRoaXMudWlEaWFsb2dUaXRsZWJhckNsb3NlLmJ1dHRvbih7CgkJCQkvLyBFbnN1cmUgdGhhdCB3ZSBhbHdheXMgcGFzcyBhIHN0cmluZwoJCQkJbGFiZWw6ICIiICsgdmFsdWUKCQkJfSk7CgkJfQoKCQlpZiAoIGtleSA9PT0gImRyYWdnYWJsZSIgKSB7CgkJCWlzRHJhZ2dhYmxlID0gdWlEaWFsb2cuaXMoIjpkYXRhKHVpLWRyYWdnYWJsZSkiKTsKCQkJaWYgKCBpc0RyYWdnYWJsZSAmJiAhdmFsdWUgKSB7CgkJCQl1aURpYWxvZy5kcmFnZ2FibGUoImRlc3Ryb3kiKTsKCQkJfQoKCQkJaWYgKCAhaXNEcmFnZ2FibGUgJiYgdmFsdWUgKSB7CgkJCQl0aGlzLl9tYWtlRHJhZ2dhYmxlKCk7CgkJCX0KCQl9CgoJCWlmICgga2V5ID09PSAicG9zaXRpb24iICkgewoJCQl0aGlzLl9wb3NpdGlvbigpOwoJCX0KCgkJaWYgKCBrZXkgPT09ICJyZXNpemFibGUiICkgewoJCQkvLyBjdXJyZW50bHkgcmVzaXphYmxlLCBiZWNvbWluZyBub24tcmVzaXphYmxlCgkJCWlzUmVzaXphYmxlID0gdWlEaWFsb2cuaXMoIjpkYXRhKHVpLXJlc2l6YWJsZSkiKTsKCQkJaWYgKCBpc1Jlc2l6YWJsZSAmJiAhdmFsdWUgKSB7CgkJCQl1aURpYWxvZy5yZXNpemFibGUoImRlc3Ryb3kiKTsKCQkJfQoKCQkJLy8gY3VycmVudGx5IHJlc2l6YWJsZSwgY2hhbmdpbmcgaGFuZGxlcwoJCQlpZiAoIGlzUmVzaXphYmxlICYmIHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgKSB7CgkJCQl1aURpYWxvZy5yZXNpemFibGUoICJvcHRpb24iLCAiaGFuZGxlcyIsIHZhbHVlICk7CgkJCX0KCgkJCS8vIGN1cnJlbnRseSBub24tcmVzaXphYmxlLCBiZWNvbWluZyByZXNpemFibGUKCQkJaWYgKCAhaXNSZXNpemFibGUgJiYgdmFsdWUgIT09IGZhbHNlICkgewoJCQkJdGhpcy5fbWFrZVJlc2l6YWJsZSgpOwoJCQl9CgkJfQoKCQlpZiAoIGtleSA9PT0gInRpdGxlIiApIHsKCQkJdGhpcy5fdGl0bGUoIHRoaXMudWlEaWFsb2dUaXRsZWJhci5maW5kKCIudWktZGlhbG9nLXRpdGxlIikgKTsKCQl9Cgl9LAoKCV9zaXplOiBmdW5jdGlvbigpIHsKCQkvLyBJZiB0aGUgdXNlciBoYXMgcmVzaXplZCB0aGUgZGlhbG9nLCB0aGUgLnVpLWRpYWxvZyBhbmQgLnVpLWRpYWxvZy1jb250ZW50CgkJLy8gZGl2cyB3aWxsIGJvdGggaGF2ZSB3aWR0aCBhbmQgaGVpZ2h0IHNldCwgc28gd2UgbmVlZCB0byByZXNldCB0aGVtCgkJdmFyIG5vbkNvbnRlbnRIZWlnaHQsIG1pbkNvbnRlbnRIZWlnaHQsIG1heENvbnRlbnRIZWlnaHQsCgkJCW9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgoJCS8vIFJlc2V0IGNvbnRlbnQgc2l6aW5nCgkJdGhpcy5lbGVtZW50LnNob3coKS5jc3MoewoJCQl3aWR0aDogImF1dG8iLAoJCQltaW5IZWlnaHQ6IDAsCgkJCW1heEhlaWdodDogIm5vbmUiLAoJCQloZWlnaHQ6IDAKCQl9KTsKCgkJaWYgKCBvcHRpb25zLm1pbldpZHRoID4gb3B0aW9ucy53aWR0aCApIHsKCQkJb3B0aW9ucy53aWR0aCA9IG9wdGlvbnMubWluV2lkdGg7CgkJfQoKCQkvLyByZXNldCB3cmFwcGVyIHNpemluZwoJCS8vIGRldGVybWluZSB0aGUgaGVpZ2h0IG9mIGFsbCB0aGUgbm9uLWNvbnRlbnQgZWxlbWVudHMKCQlub25Db250ZW50SGVpZ2h0ID0gdGhpcy51aURpYWxvZy5jc3MoewoJCQkJaGVpZ2h0OiAiYXV0byIsCgkJCQl3aWR0aDogb3B0aW9ucy53aWR0aAoJCQl9KQoJCQkub3V0ZXJIZWlnaHQoKTsKCQltaW5Db250ZW50SGVpZ2h0ID0gTWF0aC5tYXgoIDAsIG9wdGlvbnMubWluSGVpZ2h0IC0gbm9uQ29udGVudEhlaWdodCApOwoJCW1heENvbnRlbnRIZWlnaHQgPSB0eXBlb2Ygb3B0aW9ucy5tYXhIZWlnaHQgPT09ICJudW1iZXIiID8KCQkJTWF0aC5tYXgoIDAsIG9wdGlvbnMubWF4SGVpZ2h0IC0gbm9uQ29udGVudEhlaWdodCApIDoKCQkJIm5vbmUiOwoKCQlpZiAoIG9wdGlvbnMuaGVpZ2h0ID09PSAiYXV0byIgKSB7CgkJCXRoaXMuZWxlbWVudC5jc3MoewoJCQkJbWluSGVpZ2h0OiBtaW5Db250ZW50SGVpZ2h0LAoJCQkJbWF4SGVpZ2h0OiBtYXhDb250ZW50SGVpZ2h0LAoJCQkJaGVpZ2h0OiAiYXV0byIKCQkJfSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5lbGVtZW50LmhlaWdodCggTWF0aC5tYXgoIDAsIG9wdGlvbnMuaGVpZ2h0IC0gbm9uQ29udGVudEhlaWdodCApICk7CgkJfQoKCQlpZiAodGhpcy51aURpYWxvZy5pcygiOmRhdGEodWktcmVzaXphYmxlKSIpICkgewoJCQl0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZSggIm9wdGlvbiIsICJtaW5IZWlnaHQiLCB0aGlzLl9taW5IZWlnaHQoKSApOwoJCX0KCX0sCgoJX2Jsb2NrRnJhbWVzOiBmdW5jdGlvbigpIHsKCQl0aGlzLmlmcmFtZUJsb2NrcyA9IHRoaXMuZG9jdW1lbnQuZmluZCggImlmcmFtZSIgKS5tYXAoZnVuY3Rpb24oKSB7CgkJCXZhciBpZnJhbWUgPSAkKCB0aGlzICk7CgoJCQlyZXR1cm4gJCggIjxkaXY+IiApCgkJCQkuY3NzKHsKCQkJCQlwb3NpdGlvbjogImFic29sdXRlIiwKCQkJCQl3aWR0aDogaWZyYW1lLm91dGVyV2lkdGgoKSwKCQkJCQloZWlnaHQ6IGlmcmFtZS5vdXRlckhlaWdodCgpCgkJCQl9KQoJCQkJLmFwcGVuZFRvKCBpZnJhbWUucGFyZW50KCkgKQoJCQkJLm9mZnNldCggaWZyYW1lLm9mZnNldCgpIClbMF07CgkJfSk7Cgl9LAoKCV91bmJsb2NrRnJhbWVzOiBmdW5jdGlvbigpIHsKCQlpZiAoIHRoaXMuaWZyYW1lQmxvY2tzICkgewoJCQl0aGlzLmlmcmFtZUJsb2Nrcy5yZW1vdmUoKTsKCQkJZGVsZXRlIHRoaXMuaWZyYW1lQmxvY2tzOwoJCX0KCX0sCgoJX2FsbG93SW50ZXJhY3Rpb246IGZ1bmN0aW9uKCBldmVudCApIHsKCQlpZiAoICQoIGV2ZW50LnRhcmdldCApLmNsb3Nlc3QoIi51aS1kaWFsb2ciKS5sZW5ndGggKSB7CgkJCXJldHVybiB0cnVlOwoJCX0KCgkJLy8gVE9ETzogUmVtb3ZlIGhhY2sgd2hlbiBkYXRlcGlja2VyIGltcGxlbWVudHMKCQkvLyB0aGUgLnVpLWZyb250IGxvZ2ljICgjODk4OSkKCQlyZXR1cm4gISEkKCBldmVudC50YXJnZXQgKS5jbG9zZXN0KCIudWktZGF0ZXBpY2tlciIpLmxlbmd0aDsKCX0sCgoJX2NyZWF0ZU92ZXJsYXk6IGZ1bmN0aW9uKCkgewoJCWlmICggIXRoaXMub3B0aW9ucy5tb2RhbCApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIHRoYXQgPSB0aGlzLAoJCQl3aWRnZXRGdWxsTmFtZSA9IHRoaXMud2lkZ2V0RnVsbE5hbWU7CgkJaWYgKCAhJC51aS5kaWFsb2cub3ZlcmxheUluc3RhbmNlcyApIHsKCQkJLy8gUHJldmVudCB1c2Ugb2YgYW5jaG9ycyBhbmQgaW5wdXRzLgoJCQkvLyBXZSB1c2UgYSBkZWxheSBpbiBjYXNlIHRoZSBvdmVybGF5IGlzIGNyZWF0ZWQgZnJvbSBhbgoJCQkvLyBldmVudCB0aGF0IHdlJ3JlIGdvaW5nIHRvIGJlIGNhbmNlbGxpbmcuICgjMjgwNCkKCQkJdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CgkJCQkvLyBIYW5kbGUgLmRpYWxvZygpLmRpYWxvZygiY2xvc2UiKSAoIzQwNjUpCgkJCQlpZiAoICQudWkuZGlhbG9nLm92ZXJsYXlJbnN0YW5jZXMgKSB7CgkJCQkJdGhpcy5kb2N1bWVudC5iaW5kKCAiZm9jdXNpbi5kaWFsb2ciLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCWlmICggIXRoYXQuX2FsbG93SW50ZXJhY3Rpb24oIGV2ZW50ICkgKSB7CgkJCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCQkJJCgiLnVpLWRpYWxvZzp2aXNpYmxlOmxhc3QgLnVpLWRpYWxvZy1jb250ZW50IikKCQkJCQkJCQkuZGF0YSggd2lkZ2V0RnVsbE5hbWUgKS5fZm9jdXNUYWJiYWJsZSgpOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQl9CgkJCX0pOwoJCX0KCgkJdGhpcy5vdmVybGF5ID0gJCgiPGRpdj4iKQoJCQkuYWRkQ2xhc3MoInVpLXdpZGdldC1vdmVybGF5IHVpLWZyb250IikKCQkJLmFwcGVuZFRvKCB0aGlzLl9hcHBlbmRUbygpICk7CgkJdGhpcy5fb24oIHRoaXMub3ZlcmxheSwgewoJCQltb3VzZWRvd246ICJfa2VlcEZvY3VzIgoJCX0pOwoJCSQudWkuZGlhbG9nLm92ZXJsYXlJbnN0YW5jZXMrKzsKCX0sCgoJX2Rlc3Ryb3lPdmVybGF5OiBmdW5jdGlvbigpIHsKCQlpZiAoICF0aGlzLm9wdGlvbnMubW9kYWwgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggdGhpcy5vdmVybGF5ICkgewoJCQkkLnVpLmRpYWxvZy5vdmVybGF5SW5zdGFuY2VzLS07CgoJCQlpZiAoICEkLnVpLmRpYWxvZy5vdmVybGF5SW5zdGFuY2VzICkgewoJCQkJdGhpcy5kb2N1bWVudC51bmJpbmQoICJmb2N1c2luLmRpYWxvZyIgKTsKCQkJfQoJCQl0aGlzLm92ZXJsYXkucmVtb3ZlKCk7CgkJCXRoaXMub3ZlcmxheSA9IG51bGw7CgkJfQoJfQp9KTsKCiQudWkuZGlhbG9nLm92ZXJsYXlJbnN0YW5jZXMgPSAwOwoKLy8gREVQUkVDQVRFRAppZiAoICQudWlCYWNrQ29tcGF0ICE9PSBmYWxzZSApIHsKCS8vIHBvc2l0aW9uIG9wdGlvbiB3aXRoIGFycmF5IG5vdGF0aW9uCgkvLyBqdXN0IG92ZXJyaWRlIHdpdGggb2xkIGltcGxlbWVudGF0aW9uCgkkLndpZGdldCggInVpLmRpYWxvZyIsICQudWkuZGlhbG9nLCB7CgkJX3Bvc2l0aW9uOiBmdW5jdGlvbigpIHsKCQkJdmFyIHBvc2l0aW9uID0gdGhpcy5vcHRpb25zLnBvc2l0aW9uLAoJCQkJbXlBdCA9IFtdLAoJCQkJb2Zmc2V0ID0gWyAwLCAwIF0sCgkJCQlpc1Zpc2libGU7CgoJCQlpZiAoIHBvc2l0aW9uICkgewoJCQkJaWYgKCB0eXBlb2YgcG9zaXRpb24gPT09ICJzdHJpbmciIHx8ICh0eXBlb2YgcG9zaXRpb24gPT09ICJvYmplY3QiICYmICIwIiBpbiBwb3NpdGlvbiApICkgewoJCQkJCW15QXQgPSBwb3NpdGlvbi5zcGxpdCA/IHBvc2l0aW9uLnNwbGl0KCIgIikgOiBbIHBvc2l0aW9uWzBdLCBwb3NpdGlvblsxXSBdOwoJCQkJCWlmICggbXlBdC5sZW5ndGggPT09IDEgKSB7CgkJCQkJCW15QXRbMV0gPSBteUF0WzBdOwoJCQkJCX0KCgkJCQkJJC5lYWNoKCBbICJsZWZ0IiwgInRvcCIgXSwgZnVuY3Rpb24oIGksIG9mZnNldFBvc2l0aW9uICkgewoJCQkJCQlpZiAoICtteUF0WyBpIF0gPT09IG15QXRbIGkgXSApIHsKCQkJCQkJCW9mZnNldFsgaSBdID0gbXlBdFsgaSBdOwoJCQkJCQkJbXlBdFsgaSBdID0gb2Zmc2V0UG9zaXRpb247CgkJCQkJCX0KCQkJCQl9KTsKCgkJCQkJcG9zaXRpb24gPSB7CgkJCQkJCW15OiBteUF0WzBdICsgKG9mZnNldFswXSA8IDAgPyBvZmZzZXRbMF0gOiAiKyIgKyBvZmZzZXRbMF0pICsgIiAiICsKCQkJCQkJCW15QXRbMV0gKyAob2Zmc2V0WzFdIDwgMCA/IG9mZnNldFsxXSA6ICIrIiArIG9mZnNldFsxXSksCgkJCQkJCWF0OiBteUF0LmpvaW4oIiAiKQoJCQkJCX07CgkJCQl9CgoJCQkJcG9zaXRpb24gPSAkLmV4dGVuZCgge30sICQudWkuZGlhbG9nLnByb3RvdHlwZS5vcHRpb25zLnBvc2l0aW9uLCBwb3NpdGlvbiApOwoJCQl9IGVsc2UgewoJCQkJcG9zaXRpb24gPSAkLnVpLmRpYWxvZy5wcm90b3R5cGUub3B0aW9ucy5wb3NpdGlvbjsKCQkJfQoKCQkJLy8gbmVlZCB0byBzaG93IHRoZSBkaWFsb2cgdG8gZ2V0IHRoZSBhY3R1YWwgb2Zmc2V0IGluIHRoZSBwb3NpdGlvbiBwbHVnaW4KCQkJaXNWaXNpYmxlID0gdGhpcy51aURpYWxvZy5pcygiOnZpc2libGUiKTsKCQkJaWYgKCAhaXNWaXNpYmxlICkgewoJCQkJdGhpcy51aURpYWxvZy5zaG93KCk7CgkJCX0KCQkJdGhpcy51aURpYWxvZy5wb3NpdGlvbiggcG9zaXRpb24gKTsKCQkJaWYgKCAhaXNWaXNpYmxlICkgewoJCQkJdGhpcy51aURpYWxvZy5oaWRlKCk7CgkJCX0KCQl9Cgl9KTsKfQoKfSggalF1ZXJ5ICkgKTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKdmFyIHJ2ZXJ0aWNhbCA9IC91cHxkb3dufHZlcnRpY2FsLywKCXJwb3NpdGl2ZW1vdGlvbiA9IC91cHxsZWZ0fHZlcnRpY2FsfGhvcml6b250YWwvOwoKJC5lZmZlY3RzLmVmZmVjdC5ibGluZCA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoJLy8gQ3JlYXRlIGVsZW1lbnQKCXZhciBlbCA9ICQoIHRoaXMgKSwKCQlwcm9wcyA9IFsgInBvc2l0aW9uIiwgInRvcCIsICJib3R0b20iLCAibGVmdCIsICJyaWdodCIsICJoZWlnaHQiLCAid2lkdGgiIF0sCgkJbW9kZSA9ICQuZWZmZWN0cy5zZXRNb2RlKCBlbCwgby5tb2RlIHx8ICJoaWRlIiApLAoJCWRpcmVjdGlvbiA9IG8uZGlyZWN0aW9uIHx8ICJ1cCIsCgkJdmVydGljYWwgPSBydmVydGljYWwudGVzdCggZGlyZWN0aW9uICksCgkJcmVmID0gdmVydGljYWwgPyAiaGVpZ2h0IiA6ICJ3aWR0aCIsCgkJcmVmMiA9IHZlcnRpY2FsID8gInRvcCIgOiAibGVmdCIsCgkJbW90aW9uID0gcnBvc2l0aXZlbW90aW9uLnRlc3QoIGRpcmVjdGlvbiApLAoJCWFuaW1hdGlvbiA9IHt9LAoJCXNob3cgPSBtb2RlID09PSAic2hvdyIsCgkJd3JhcHBlciwgZGlzdGFuY2UsIG1hcmdpbjsKCgkvLyBpZiBhbHJlYWR5IHdyYXBwZWQsIHRoZSB3cmFwcGVyJ3MgcHJvcGVydGllcyBhcmUgbXkgcHJvcGVydHkuICM2MjQ1CglpZiAoIGVsLnBhcmVudCgpLmlzKCAiLnVpLWVmZmVjdHMtd3JhcHBlciIgKSApIHsKCQkkLmVmZmVjdHMuc2F2ZSggZWwucGFyZW50KCksIHByb3BzICk7Cgl9IGVsc2UgewoJCSQuZWZmZWN0cy5zYXZlKCBlbCwgcHJvcHMgKTsKCX0KCWVsLnNob3coKTsKCXdyYXBwZXIgPSAkLmVmZmVjdHMuY3JlYXRlV3JhcHBlciggZWwgKS5jc3MoewoJCW92ZXJmbG93OiAiaGlkZGVuIgoJfSk7CgoJZGlzdGFuY2UgPSB3cmFwcGVyWyByZWYgXSgpOwoJbWFyZ2luID0gcGFyc2VGbG9hdCggd3JhcHBlci5jc3MoIHJlZjIgKSApIHx8IDA7CgoJYW5pbWF0aW9uWyByZWYgXSA9IHNob3cgPyBkaXN0YW5jZSA6IDA7CglpZiAoICFtb3Rpb24gKSB7CgkJZWwKCQkJLmNzcyggdmVydGljYWwgPyAiYm90dG9tIiA6ICJyaWdodCIsIDAgKQoJCQkuY3NzKCB2ZXJ0aWNhbCA/ICJ0b3AiIDogImxlZnQiLCAiYXV0byIgKQoJCQkuY3NzKHsgcG9zaXRpb246ICJhYnNvbHV0ZSIgfSk7CgoJCWFuaW1hdGlvblsgcmVmMiBdID0gc2hvdyA/IG1hcmdpbiA6IGRpc3RhbmNlICsgbWFyZ2luOwoJfQoKCS8vIHN0YXJ0IGF0IDAgaWYgd2UgYXJlIHNob3dpbmcKCWlmICggc2hvdyApIHsKCQl3cmFwcGVyLmNzcyggcmVmLCAwICk7CgkJaWYgKCAhIG1vdGlvbiApIHsKCQkJd3JhcHBlci5jc3MoIHJlZjIsIG1hcmdpbiArIGRpc3RhbmNlICk7CgkJfQoJfQoKCS8vIEFuaW1hdGUKCXdyYXBwZXIuYW5pbWF0ZSggYW5pbWF0aW9uLCB7CgkJZHVyYXRpb246IG8uZHVyYXRpb24sCgkJZWFzaW5nOiBvLmVhc2luZywKCQlxdWV1ZTogZmFsc2UsCgkJY29tcGxldGU6IGZ1bmN0aW9uKCkgewoJCQlpZiAoIG1vZGUgPT09ICJoaWRlIiApIHsKCQkJCWVsLmhpZGUoKTsKCQkJfQoJCQkkLmVmZmVjdHMucmVzdG9yZSggZWwsIHByb3BzICk7CgkJCSQuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKCBlbCApOwoJCQlkb25lKCk7CgkJfQoJfSk7Cgp9OwoKfSkoalF1ZXJ5KTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKJC5lZmZlY3RzLmVmZmVjdC5ib3VuY2UgPSBmdW5jdGlvbiggbywgZG9uZSApIHsKCXZhciBlbCA9ICQoIHRoaXMgKSwKCQlwcm9wcyA9IFsgInBvc2l0aW9uIiwgInRvcCIsICJib3R0b20iLCAibGVmdCIsICJyaWdodCIsICJoZWlnaHQiLCAid2lkdGgiIF0sCgoJCS8vIGRlZmF1bHRzOgoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWwsIG8ubW9kZSB8fCAiZWZmZWN0IiApLAoJCWhpZGUgPSBtb2RlID09PSAiaGlkZSIsCgkJc2hvdyA9IG1vZGUgPT09ICJzaG93IiwKCQlkaXJlY3Rpb24gPSBvLmRpcmVjdGlvbiB8fCAidXAiLAoJCWRpc3RhbmNlID0gby5kaXN0YW5jZSwKCQl0aW1lcyA9IG8udGltZXMgfHwgNSwKCgkJLy8gbnVtYmVyIG9mIGludGVybmFsIGFuaW1hdGlvbnMKCQlhbmltcyA9IHRpbWVzICogMiArICggc2hvdyB8fCBoaWRlID8gMSA6IDAgKSwKCQlzcGVlZCA9IG8uZHVyYXRpb24gLyBhbmltcywKCQllYXNpbmcgPSBvLmVhc2luZywKCgkJLy8gdXRpbGl0eToKCQlyZWYgPSAoIGRpcmVjdGlvbiA9PT0gInVwIiB8fCBkaXJlY3Rpb24gPT09ICJkb3duIiApID8gInRvcCIgOiAibGVmdCIsCgkJbW90aW9uID0gKCBkaXJlY3Rpb24gPT09ICJ1cCIgfHwgZGlyZWN0aW9uID09PSAibGVmdCIgKSwKCQlpLAoJCXVwQW5pbSwKCQlkb3duQW5pbSwKCgkJLy8gd2Ugd2lsbCBuZWVkIHRvIHJlLWFzc2VtYmxlIHRoZSBxdWV1ZSB0byBzdGFjayBvdXIgYW5pbWF0aW9ucyBpbiBwbGFjZQoJCXF1ZXVlID0gZWwucXVldWUoKSwKCQlxdWV1ZWxlbiA9IHF1ZXVlLmxlbmd0aDsKCgkvLyBBdm9pZCB0b3VjaGluZyBvcGFjaXR5IHRvIHByZXZlbnQgY2xlYXJUeXBlIGFuZCBQTkcgaXNzdWVzIGluIElFCglpZiAoIHNob3cgfHwgaGlkZSApIHsKCQlwcm9wcy5wdXNoKCAib3BhY2l0eSIgKTsKCX0KCgkkLmVmZmVjdHMuc2F2ZSggZWwsIHByb3BzICk7CgllbC5zaG93KCk7CgkkLmVmZmVjdHMuY3JlYXRlV3JhcHBlciggZWwgKTsgLy8gQ3JlYXRlIFdyYXBwZXIKCgkvLyBkZWZhdWx0IGRpc3RhbmNlIGZvciB0aGUgQklHR0VTVCBib3VuY2UgaXMgdGhlIG91dGVyIERpc3RhbmNlIC8gMwoJaWYgKCAhZGlzdGFuY2UgKSB7CgkJZGlzdGFuY2UgPSBlbFsgcmVmID09PSAidG9wIiA/ICJvdXRlckhlaWdodCIgOiAib3V0ZXJXaWR0aCIgXSgpIC8gMzsKCX0KCglpZiAoIHNob3cgKSB7CgkJZG93bkFuaW0gPSB7IG9wYWNpdHk6IDEgfTsKCQlkb3duQW5pbVsgcmVmIF0gPSAwOwoKCQkvLyBpZiB3ZSBhcmUgc2hvd2luZywgZm9yY2Ugb3BhY2l0eSAwIGFuZCBzZXQgdGhlIGluaXRpYWwgcG9zaXRpb24KCQkvLyB0aGVuIGRvIHRoZSAiZmlyc3QiIGFuaW1hdGlvbgoJCWVsLmNzcyggIm9wYWNpdHkiLCAwICkKCQkJLmNzcyggcmVmLCBtb3Rpb24gPyAtZGlzdGFuY2UgKiAyIDogZGlzdGFuY2UgKiAyICkKCQkJLmFuaW1hdGUoIGRvd25BbmltLCBzcGVlZCwgZWFzaW5nICk7Cgl9CgoJLy8gc3RhcnQgYXQgdGhlIHNtYWxsZXN0IGRpc3RhbmNlIGlmIHdlIGFyZSBoaWRpbmcKCWlmICggaGlkZSApIHsKCQlkaXN0YW5jZSA9IGRpc3RhbmNlIC8gTWF0aC5wb3coIDIsIHRpbWVzIC0gMSApOwoJfQoKCWRvd25BbmltID0ge307Cglkb3duQW5pbVsgcmVmIF0gPSAwOwoJLy8gQm91bmNlcyB1cC9kb3duL2xlZnQvcmlnaHQgdGhlbiBiYWNrIHRvIDAgLS0gdGltZXMgKiAyIGFuaW1hdGlvbnMgaGFwcGVuIGhlcmUKCWZvciAoIGkgPSAwOyBpIDwgdGltZXM7IGkrKyApIHsKCQl1cEFuaW0gPSB7fTsKCQl1cEFuaW1bIHJlZiBdID0gKCBtb3Rpb24gPyAiLT0iIDogIis9IiApICsgZGlzdGFuY2U7CgoJCWVsLmFuaW1hdGUoIHVwQW5pbSwgc3BlZWQsIGVhc2luZyApCgkJCS5hbmltYXRlKCBkb3duQW5pbSwgc3BlZWQsIGVhc2luZyApOwoKCQlkaXN0YW5jZSA9IGhpZGUgPyBkaXN0YW5jZSAqIDIgOiBkaXN0YW5jZSAvIDI7Cgl9CgoJLy8gTGFzdCBCb3VuY2Ugd2hlbiBIaWRpbmcKCWlmICggaGlkZSApIHsKCQl1cEFuaW0gPSB7IG9wYWNpdHk6IDAgfTsKCQl1cEFuaW1bIHJlZiBdID0gKCBtb3Rpb24gPyAiLT0iIDogIis9IiApICsgZGlzdGFuY2U7CgoJCWVsLmFuaW1hdGUoIHVwQW5pbSwgc3BlZWQsIGVhc2luZyApOwoJfQoKCWVsLnF1ZXVlKGZ1bmN0aW9uKCkgewoJCWlmICggaGlkZSApIHsKCQkJZWwuaGlkZSgpOwoJCX0KCQkkLmVmZmVjdHMucmVzdG9yZSggZWwsIHByb3BzICk7CgkJJC5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoIGVsICk7CgkJZG9uZSgpOwoJfSk7CgoJLy8gaW5qZWN0IGFsbCB0aGUgYW5pbWF0aW9ucyB3ZSBqdXN0IHF1ZXVlZCB0byBiZSBmaXJzdCBpbiBsaW5lIChhZnRlciAiaW5wcm9ncmVzcyIpCglpZiAoIHF1ZXVlbGVuID4gMSkgewoJCXF1ZXVlLnNwbGljZS5hcHBseSggcXVldWUsCgkJCVsgMSwgMCBdLmNvbmNhdCggcXVldWUuc3BsaWNlKCBxdWV1ZWxlbiwgYW5pbXMgKyAxICkgKSApOwoJfQoJZWwuZGVxdWV1ZSgpOwoKfTsKCn0pKGpRdWVyeSk7CgooZnVuY3Rpb24oICQsIHVuZGVmaW5lZCApIHsKCiQuZWZmZWN0cy5lZmZlY3QuY2xpcCA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoJLy8gQ3JlYXRlIGVsZW1lbnQKCXZhciBlbCA9ICQoIHRoaXMgKSwKCQlwcm9wcyA9IFsgInBvc2l0aW9uIiwgInRvcCIsICJib3R0b20iLCAibGVmdCIsICJyaWdodCIsICJoZWlnaHQiLCAid2lkdGgiIF0sCgkJbW9kZSA9ICQuZWZmZWN0cy5zZXRNb2RlKCBlbCwgby5tb2RlIHx8ICJoaWRlIiApLAoJCXNob3cgPSBtb2RlID09PSAic2hvdyIsCgkJZGlyZWN0aW9uID0gby5kaXJlY3Rpb24gfHwgInZlcnRpY2FsIiwKCQl2ZXJ0ID0gZGlyZWN0aW9uID09PSAidmVydGljYWwiLAoJCXNpemUgPSB2ZXJ0ID8gImhlaWdodCIgOiAid2lkdGgiLAoJCXBvc2l0aW9uID0gdmVydCA/ICJ0b3AiIDogImxlZnQiLAoJCWFuaW1hdGlvbiA9IHt9LAoJCXdyYXBwZXIsIGFuaW1hdGUsIGRpc3RhbmNlOwoKCS8vIFNhdmUgJiBTaG93CgkkLmVmZmVjdHMuc2F2ZSggZWwsIHByb3BzICk7CgllbC5zaG93KCk7CgoJLy8gQ3JlYXRlIFdyYXBwZXIKCXdyYXBwZXIgPSAkLmVmZmVjdHMuY3JlYXRlV3JhcHBlciggZWwgKS5jc3MoewoJCW92ZXJmbG93OiAiaGlkZGVuIgoJfSk7CglhbmltYXRlID0gKCBlbFswXS50YWdOYW1lID09PSAiSU1HIiApID8gd3JhcHBlciA6IGVsOwoJZGlzdGFuY2UgPSBhbmltYXRlWyBzaXplIF0oKTsKCgkvLyBTaGlmdAoJaWYgKCBzaG93ICkgewoJCWFuaW1hdGUuY3NzKCBzaXplLCAwICk7CgkJYW5pbWF0ZS5jc3MoIHBvc2l0aW9uLCBkaXN0YW5jZSAvIDIgKTsKCX0KCgkvLyBDcmVhdGUgQW5pbWF0aW9uIE9iamVjdDoKCWFuaW1hdGlvblsgc2l6ZSBdID0gc2hvdyA/IGRpc3RhbmNlIDogMDsKCWFuaW1hdGlvblsgcG9zaXRpb24gXSA9IHNob3cgPyAwIDogZGlzdGFuY2UgLyAyOwoKCS8vIEFuaW1hdGUKCWFuaW1hdGUuYW5pbWF0ZSggYW5pbWF0aW9uLCB7CgkJcXVldWU6IGZhbHNlLAoJCWR1cmF0aW9uOiBvLmR1cmF0aW9uLAoJCWVhc2luZzogby5lYXNpbmcsCgkJY29tcGxldGU6IGZ1bmN0aW9uKCkgewoJCQlpZiAoICFzaG93ICkgewoJCQkJZWwuaGlkZSgpOwoJCQl9CgkJCSQuZWZmZWN0cy5yZXN0b3JlKCBlbCwgcHJvcHMgKTsKCQkJJC5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoIGVsICk7CgkJCWRvbmUoKTsKCQl9Cgl9KTsKCn07Cgp9KShqUXVlcnkpOwoKKGZ1bmN0aW9uKCAkLCB1bmRlZmluZWQgKSB7CgokLmVmZmVjdHMuZWZmZWN0LmRyb3AgPSBmdW5jdGlvbiggbywgZG9uZSApIHsKCgl2YXIgZWwgPSAkKCB0aGlzICksCgkJcHJvcHMgPSBbICJwb3NpdGlvbiIsICJ0b3AiLCAiYm90dG9tIiwgImxlZnQiLCAicmlnaHQiLCAib3BhY2l0eSIsICJoZWlnaHQiLCAid2lkdGgiIF0sCgkJbW9kZSA9ICQuZWZmZWN0cy5zZXRNb2RlKCBlbCwgby5tb2RlIHx8ICJoaWRlIiApLAoJCXNob3cgPSBtb2RlID09PSAic2hvdyIsCgkJZGlyZWN0aW9uID0gby5kaXJlY3Rpb24gfHwgImxlZnQiLAoJCXJlZiA9ICggZGlyZWN0aW9uID09PSAidXAiIHx8IGRpcmVjdGlvbiA9PT0gImRvd24iICkgPyAidG9wIiA6ICJsZWZ0IiwKCQltb3Rpb24gPSAoIGRpcmVjdGlvbiA9PT0gInVwIiB8fCBkaXJlY3Rpb24gPT09ICJsZWZ0IiApID8gInBvcyIgOiAibmVnIiwKCQlhbmltYXRpb24gPSB7CgkJCW9wYWNpdHk6IHNob3cgPyAxIDogMAoJCX0sCgkJZGlzdGFuY2U7CgoJLy8gQWRqdXN0CgkkLmVmZmVjdHMuc2F2ZSggZWwsIHByb3BzICk7CgllbC5zaG93KCk7CgkkLmVmZmVjdHMuY3JlYXRlV3JhcHBlciggZWwgKTsKCglkaXN0YW5jZSA9IG8uZGlzdGFuY2UgfHwgZWxbIHJlZiA9PT0gInRvcCIgPyAib3V0ZXJIZWlnaHQiOiAib3V0ZXJXaWR0aCIgXSggdHJ1ZSApIC8gMjsKCglpZiAoIHNob3cgKSB7CgkJZWwKCQkJLmNzcyggIm9wYWNpdHkiLCAwICkKCQkJLmNzcyggcmVmLCBtb3Rpb24gPT09ICJwb3MiID8gLWRpc3RhbmNlIDogZGlzdGFuY2UgKTsKCX0KCgkvLyBBbmltYXRpb24KCWFuaW1hdGlvblsgcmVmIF0gPSAoIHNob3cgPwoJCSggbW90aW9uID09PSAicG9zIiA/ICIrPSIgOiAiLT0iICkgOgoJCSggbW90aW9uID09PSAicG9zIiA/ICItPSIgOiAiKz0iICkgKSArCgkJZGlzdGFuY2U7CgoJLy8gQW5pbWF0ZQoJZWwuYW5pbWF0ZSggYW5pbWF0aW9uLCB7CgkJcXVldWU6IGZhbHNlLAoJCWR1cmF0aW9uOiBvLmR1cmF0aW9uLAoJCWVhc2luZzogby5lYXNpbmcsCgkJY29tcGxldGU6IGZ1bmN0aW9uKCkgewoJCQlpZiAoIG1vZGUgPT09ICJoaWRlIiApIHsKCQkJCWVsLmhpZGUoKTsKCQkJfQoJCQkkLmVmZmVjdHMucmVzdG9yZSggZWwsIHByb3BzICk7CgkJCSQuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKCBlbCApOwoJCQlkb25lKCk7CgkJfQoJfSk7Cn07Cgp9KShqUXVlcnkpOwoKKGZ1bmN0aW9uKCAkLCB1bmRlZmluZWQgKSB7CgokLmVmZmVjdHMuZWZmZWN0LmV4cGxvZGUgPSBmdW5jdGlvbiggbywgZG9uZSApIHsKCgl2YXIgcm93cyA9IG8ucGllY2VzID8gTWF0aC5yb3VuZCggTWF0aC5zcXJ0KCBvLnBpZWNlcyApICkgOiAzLAoJCWNlbGxzID0gcm93cywKCQllbCA9ICQoIHRoaXMgKSwKCQltb2RlID0gJC5lZmZlY3RzLnNldE1vZGUoIGVsLCBvLm1vZGUgfHwgImhpZGUiICksCgkJc2hvdyA9IG1vZGUgPT09ICJzaG93IiwKCgkJLy8gc2hvdyBhbmQgdGhlbiB2aXNpYmlsaXR5OmhpZGRlbiB0aGUgZWxlbWVudCBiZWZvcmUgY2FsY3VsYXRpbmcgb2Zmc2V0CgkJb2Zmc2V0ID0gZWwuc2hvdygpLmNzcyggInZpc2liaWxpdHkiLCAiaGlkZGVuIiApLm9mZnNldCgpLAoKCQkvLyB3aWR0aCBhbmQgaGVpZ2h0IG9mIGEgcGllY2UKCQl3aWR0aCA9IE1hdGguY2VpbCggZWwub3V0ZXJXaWR0aCgpIC8gY2VsbHMgKSwKCQloZWlnaHQgPSBNYXRoLmNlaWwoIGVsLm91dGVySGVpZ2h0KCkgLyByb3dzICksCgkJcGllY2VzID0gW10sCgoJCS8vIGxvb3AKCQlpLCBqLCBsZWZ0LCB0b3AsIG14LCBteTsKCgkvLyBjaGlsZHJlbiBhbmltYXRlIGNvbXBsZXRlOgoJZnVuY3Rpb24gY2hpbGRDb21wbGV0ZSgpIHsKCQlwaWVjZXMucHVzaCggdGhpcyApOwoJCWlmICggcGllY2VzLmxlbmd0aCA9PT0gcm93cyAqIGNlbGxzICkgewoJCQlhbmltQ29tcGxldGUoKTsKCQl9Cgl9CgoJLy8gY2xvbmUgdGhlIGVsZW1lbnQgZm9yIGVhY2ggcm93IGFuZCBjZWxsLgoJZm9yKCBpID0gMDsgaSA8IHJvd3MgOyBpKysgKSB7IC8vID09PT4KCQl0b3AgPSBvZmZzZXQudG9wICsgaSAqIGhlaWdodDsKCQlteSA9IGkgLSAoIHJvd3MgLSAxICkgLyAyIDsKCgkJZm9yKCBqID0gMDsgaiA8IGNlbGxzIDsgaisrICkgeyAvLyB8fHwKCQkJbGVmdCA9IG9mZnNldC5sZWZ0ICsgaiAqIHdpZHRoOwoJCQlteCA9IGogLSAoIGNlbGxzIC0gMSApIC8gMiA7CgoJCQkvLyBDcmVhdGUgYSBjbG9uZSBvZiB0aGUgbm93IGhpZGRlbiBtYWluIGVsZW1lbnQgdGhhdCB3aWxsIGJlIGFic29sdXRlIHBvc2l0aW9uZWQKCQkJLy8gd2l0aGluIGEgd3JhcHBlciBkaXYgb2ZmIHRoZSAtbGVmdCBhbmQgLXRvcCBlcXVhbCB0byBzaXplIG9mIG91ciBwaWVjZXMKCQkJZWwKCQkJCS5jbG9uZSgpCgkJCQkuYXBwZW5kVG8oICJib2R5IiApCgkJCQkud3JhcCggIjxkaXY+PC9kaXY+IiApCgkJCQkuY3NzKHsKCQkJCQlwb3NpdGlvbjogImFic29sdXRlIiwKCQkJCQl2aXNpYmlsaXR5OiAidmlzaWJsZSIsCgkJCQkJbGVmdDogLWogKiB3aWR0aCwKCQkJCQl0b3A6IC1pICogaGVpZ2h0CgkJCQl9KQoKCQkJLy8gc2VsZWN0IHRoZSB3cmFwcGVyIC0gbWFrZSBpdCBvdmVyZmxvdzogaGlkZGVuIGFuZCBhYnNvbHV0ZSBwb3NpdGlvbmVkIGJhc2VkIG9uCgkJCS8vIHdoZXJlIHRoZSBvcmlnaW5hbCB3YXMgbG9jYXRlZCArbGVmdCBhbmQgK3RvcCBlcXVhbCB0byB0aGUgc2l6ZSBvZiBwaWVjZXMKCQkJCS5wYXJlbnQoKQoJCQkJLmFkZENsYXNzKCAidWktZWZmZWN0cy1leHBsb2RlIiApCgkJCQkuY3NzKHsKCQkJCQlwb3NpdGlvbjogImFic29sdXRlIiwKCQkJCQlvdmVyZmxvdzogImhpZGRlbiIsCgkJCQkJd2lkdGg6IHdpZHRoLAoJCQkJCWhlaWdodDogaGVpZ2h0LAoJCQkJCWxlZnQ6IGxlZnQgKyAoIHNob3cgPyBteCAqIHdpZHRoIDogMCApLAoJCQkJCXRvcDogdG9wICsgKCBzaG93ID8gbXkgKiBoZWlnaHQgOiAwICksCgkJCQkJb3BhY2l0eTogc2hvdyA/IDAgOiAxCgkJCQl9KS5hbmltYXRlKHsKCQkJCQlsZWZ0OiBsZWZ0ICsgKCBzaG93ID8gMCA6IG14ICogd2lkdGggKSwKCQkJCQl0b3A6IHRvcCArICggc2hvdyA/IDAgOiBteSAqIGhlaWdodCApLAoJCQkJCW9wYWNpdHk6IHNob3cgPyAxIDogMAoJCQkJfSwgby5kdXJhdGlvbiB8fCA1MDAsIG8uZWFzaW5nLCBjaGlsZENvbXBsZXRlICk7CgkJfQoJfQoKCWZ1bmN0aW9uIGFuaW1Db21wbGV0ZSgpIHsKCQllbC5jc3MoewoJCQl2aXNpYmlsaXR5OiAidmlzaWJsZSIKCQl9KTsKCQkkKCBwaWVjZXMgKS5yZW1vdmUoKTsKCQlpZiAoICFzaG93ICkgewoJCQllbC5oaWRlKCk7CgkJfQoJCWRvbmUoKTsKCX0KfTsKCn0pKGpRdWVyeSk7CgooZnVuY3Rpb24oICQsIHVuZGVmaW5lZCApIHsKCiQuZWZmZWN0cy5lZmZlY3QuZmFkZSA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoJdmFyIGVsID0gJCggdGhpcyApLAoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWwsIG8ubW9kZSB8fCAidG9nZ2xlIiApOwoKCWVsLmFuaW1hdGUoewoJCW9wYWNpdHk6IG1vZGUKCX0sIHsKCQlxdWV1ZTogZmFsc2UsCgkJZHVyYXRpb246IG8uZHVyYXRpb24sCgkJZWFzaW5nOiBvLmVhc2luZywKCQljb21wbGV0ZTogZG9uZQoJfSk7Cn07Cgp9KSggalF1ZXJ5ICk7CgooZnVuY3Rpb24oICQsIHVuZGVmaW5lZCApIHsKCiQuZWZmZWN0cy5lZmZlY3QuZm9sZCA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoKCS8vIENyZWF0ZSBlbGVtZW50Cgl2YXIgZWwgPSAkKCB0aGlzICksCgkJcHJvcHMgPSBbICJwb3NpdGlvbiIsICJ0b3AiLCAiYm90dG9tIiwgImxlZnQiLCAicmlnaHQiLCAiaGVpZ2h0IiwgIndpZHRoIiBdLAoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWwsIG8ubW9kZSB8fCAiaGlkZSIgKSwKCQlzaG93ID0gbW9kZSA9PT0gInNob3ciLAoJCWhpZGUgPSBtb2RlID09PSAiaGlkZSIsCgkJc2l6ZSA9IG8uc2l6ZSB8fCAxNSwKCQlwZXJjZW50ID0gLyhbMC05XSspJS8uZXhlYyggc2l6ZSApLAoJCWhvcml6Rmlyc3QgPSAhIW8uaG9yaXpGaXJzdCwKCQl3aWR0aEZpcnN0ID0gc2hvdyAhPT0gaG9yaXpGaXJzdCwKCQlyZWYgPSB3aWR0aEZpcnN0ID8gWyAid2lkdGgiLCAiaGVpZ2h0IiBdIDogWyAiaGVpZ2h0IiwgIndpZHRoIiBdLAoJCWR1cmF0aW9uID0gby5kdXJhdGlvbiAvIDIsCgkJd3JhcHBlciwgZGlzdGFuY2UsCgkJYW5pbWF0aW9uMSA9IHt9LAoJCWFuaW1hdGlvbjIgPSB7fTsKCgkkLmVmZmVjdHMuc2F2ZSggZWwsIHByb3BzICk7CgllbC5zaG93KCk7CgoJLy8gQ3JlYXRlIFdyYXBwZXIKCXdyYXBwZXIgPSAkLmVmZmVjdHMuY3JlYXRlV3JhcHBlciggZWwgKS5jc3MoewoJCW92ZXJmbG93OiAiaGlkZGVuIgoJfSk7CglkaXN0YW5jZSA9IHdpZHRoRmlyc3QgPwoJCVsgd3JhcHBlci53aWR0aCgpLCB3cmFwcGVyLmhlaWdodCgpIF0gOgoJCVsgd3JhcHBlci5oZWlnaHQoKSwgd3JhcHBlci53aWR0aCgpIF07CgoJaWYgKCBwZXJjZW50ICkgewoJCXNpemUgPSBwYXJzZUludCggcGVyY2VudFsgMSBdLCAxMCApIC8gMTAwICogZGlzdGFuY2VbIGhpZGUgPyAwIDogMSBdOwoJfQoJaWYgKCBzaG93ICkgewoJCXdyYXBwZXIuY3NzKCBob3JpekZpcnN0ID8gewoJCQloZWlnaHQ6IDAsCgkJCXdpZHRoOiBzaXplCgkJfSA6IHsKCQkJaGVpZ2h0OiBzaXplLAoJCQl3aWR0aDogMAoJCX0pOwoJfQoKCS8vIEFuaW1hdGlvbgoJYW5pbWF0aW9uMVsgcmVmWyAwIF0gXSA9IHNob3cgPyBkaXN0YW5jZVsgMCBdIDogc2l6ZTsKCWFuaW1hdGlvbjJbIHJlZlsgMSBdIF0gPSBzaG93ID8gZGlzdGFuY2VbIDEgXSA6IDA7CgoJLy8gQW5pbWF0ZQoJd3JhcHBlcgoJCS5hbmltYXRlKCBhbmltYXRpb24xLCBkdXJhdGlvbiwgby5lYXNpbmcgKQoJCS5hbmltYXRlKCBhbmltYXRpb24yLCBkdXJhdGlvbiwgby5lYXNpbmcsIGZ1bmN0aW9uKCkgewoJCQlpZiAoIGhpZGUgKSB7CgkJCQllbC5oaWRlKCk7CgkJCX0KCQkJJC5lZmZlY3RzLnJlc3RvcmUoIGVsLCBwcm9wcyApOwoJCQkkLmVmZmVjdHMucmVtb3ZlV3JhcHBlciggZWwgKTsKCQkJZG9uZSgpOwoJCX0pOwoKfTsKCn0pKGpRdWVyeSk7CgooZnVuY3Rpb24oICQsIHVuZGVmaW5lZCApIHsKCiQuZWZmZWN0cy5lZmZlY3QuaGlnaGxpZ2h0ID0gZnVuY3Rpb24oIG8sIGRvbmUgKSB7Cgl2YXIgZWxlbSA9ICQoIHRoaXMgKSwKCQlwcm9wcyA9IFsgImJhY2tncm91bmRJbWFnZSIsICJiYWNrZ3JvdW5kQ29sb3IiLCAib3BhY2l0eSIgXSwKCQltb2RlID0gJC5lZmZlY3RzLnNldE1vZGUoIGVsZW0sIG8ubW9kZSB8fCAic2hvdyIgKSwKCQlhbmltYXRpb24gPSB7CgkJCWJhY2tncm91bmRDb2xvcjogZWxlbS5jc3MoICJiYWNrZ3JvdW5kQ29sb3IiICkKCQl9OwoKCWlmIChtb2RlID09PSAiaGlkZSIpIHsKCQlhbmltYXRpb24ub3BhY2l0eSA9IDA7Cgl9CgoJJC5lZmZlY3RzLnNhdmUoIGVsZW0sIHByb3BzICk7CgoJZWxlbQoJCS5zaG93KCkKCQkuY3NzKHsKCQkJYmFja2dyb3VuZEltYWdlOiAibm9uZSIsCgkJCWJhY2tncm91bmRDb2xvcjogby5jb2xvciB8fCAiI2ZmZmY5OSIKCQl9KQoJCS5hbmltYXRlKCBhbmltYXRpb24sIHsKCQkJcXVldWU6IGZhbHNlLAoJCQlkdXJhdGlvbjogby5kdXJhdGlvbiwKCQkJZWFzaW5nOiBvLmVhc2luZywKCQkJY29tcGxldGU6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBtb2RlID09PSAiaGlkZSIgKSB7CgkJCQkJZWxlbS5oaWRlKCk7CgkJCQl9CgkJCQkkLmVmZmVjdHMucmVzdG9yZSggZWxlbSwgcHJvcHMgKTsKCQkJCWRvbmUoKTsKCQkJfQoJCX0pOwp9OwoKfSkoalF1ZXJ5KTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKJC5lZmZlY3RzLmVmZmVjdC5wdWxzYXRlID0gZnVuY3Rpb24oIG8sIGRvbmUgKSB7Cgl2YXIgZWxlbSA9ICQoIHRoaXMgKSwKCQltb2RlID0gJC5lZmZlY3RzLnNldE1vZGUoIGVsZW0sIG8ubW9kZSB8fCAic2hvdyIgKSwKCQlzaG93ID0gbW9kZSA9PT0gInNob3ciLAoJCWhpZGUgPSBtb2RlID09PSAiaGlkZSIsCgkJc2hvd2hpZGUgPSAoIHNob3cgfHwgbW9kZSA9PT0gImhpZGUiICksCgoJCS8vIHNob3dpbmcgb3IgaGlkaW5nIGxlYXZlcyBvZiB0aGUgImxhc3QiIGFuaW1hdGlvbgoJCWFuaW1zID0gKCAoIG8udGltZXMgfHwgNSApICogMiApICsgKCBzaG93aGlkZSA/IDEgOiAwICksCgkJZHVyYXRpb24gPSBvLmR1cmF0aW9uIC8gYW5pbXMsCgkJYW5pbWF0ZVRvID0gMCwKCQlxdWV1ZSA9IGVsZW0ucXVldWUoKSwKCQlxdWV1ZWxlbiA9IHF1ZXVlLmxlbmd0aCwKCQlpOwoKCWlmICggc2hvdyB8fCAhZWxlbS5pcygiOnZpc2libGUiKSkgewoJCWVsZW0uY3NzKCAib3BhY2l0eSIsIDAgKS5zaG93KCk7CgkJYW5pbWF0ZVRvID0gMTsKCX0KCgkvLyBhbmltcyAtIDEgb3BhY2l0eSAidG9nZ2xlcyIKCWZvciAoIGkgPSAxOyBpIDwgYW5pbXM7IGkrKyApIHsKCQllbGVtLmFuaW1hdGUoewoJCQlvcGFjaXR5OiBhbmltYXRlVG8KCQl9LCBkdXJhdGlvbiwgby5lYXNpbmcgKTsKCQlhbmltYXRlVG8gPSAxIC0gYW5pbWF0ZVRvOwoJfQoKCWVsZW0uYW5pbWF0ZSh7CgkJb3BhY2l0eTogYW5pbWF0ZVRvCgl9LCBkdXJhdGlvbiwgby5lYXNpbmcpOwoKCWVsZW0ucXVldWUoZnVuY3Rpb24oKSB7CgkJaWYgKCBoaWRlICkgewoJCQllbGVtLmhpZGUoKTsKCQl9CgkJZG9uZSgpOwoJfSk7CgoJLy8gV2UganVzdCBxdWV1ZWQgdXAgImFuaW1zIiBhbmltYXRpb25zLCB3ZSBuZWVkIHRvIHB1dCB0aGVtIG5leHQgaW4gdGhlIHF1ZXVlCglpZiAoIHF1ZXVlbGVuID4gMSApIHsKCQlxdWV1ZS5zcGxpY2UuYXBwbHkoIHF1ZXVlLAoJCQlbIDEsIDAgXS5jb25jYXQoIHF1ZXVlLnNwbGljZSggcXVldWVsZW4sIGFuaW1zICsgMSApICkgKTsKCX0KCWVsZW0uZGVxdWV1ZSgpOwp9OwoKfSkoalF1ZXJ5KTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKJC5lZmZlY3RzLmVmZmVjdC5wdWZmID0gZnVuY3Rpb24oIG8sIGRvbmUgKSB7Cgl2YXIgZWxlbSA9ICQoIHRoaXMgKSwKCQltb2RlID0gJC5lZmZlY3RzLnNldE1vZGUoIGVsZW0sIG8ubW9kZSB8fCAiaGlkZSIgKSwKCQloaWRlID0gbW9kZSA9PT0gImhpZGUiLAoJCXBlcmNlbnQgPSBwYXJzZUludCggby5wZXJjZW50LCAxMCApIHx8IDE1MCwKCQlmYWN0b3IgPSBwZXJjZW50IC8gMTAwLAoJCW9yaWdpbmFsID0gewoJCQloZWlnaHQ6IGVsZW0uaGVpZ2h0KCksCgkJCXdpZHRoOiBlbGVtLndpZHRoKCksCgkJCW91dGVySGVpZ2h0OiBlbGVtLm91dGVySGVpZ2h0KCksCgkJCW91dGVyV2lkdGg6IGVsZW0ub3V0ZXJXaWR0aCgpCgkJfTsKCgkkLmV4dGVuZCggbywgewoJCWVmZmVjdDogInNjYWxlIiwKCQlxdWV1ZTogZmFsc2UsCgkJZmFkZTogdHJ1ZSwKCQltb2RlOiBtb2RlLAoJCWNvbXBsZXRlOiBkb25lLAoJCXBlcmNlbnQ6IGhpZGUgPyBwZXJjZW50IDogMTAwLAoJCWZyb206IGhpZGUgPwoJCQlvcmlnaW5hbCA6CgkJCXsKCQkJCWhlaWdodDogb3JpZ2luYWwuaGVpZ2h0ICogZmFjdG9yLAoJCQkJd2lkdGg6IG9yaWdpbmFsLndpZHRoICogZmFjdG9yLAoJCQkJb3V0ZXJIZWlnaHQ6IG9yaWdpbmFsLm91dGVySGVpZ2h0ICogZmFjdG9yLAoJCQkJb3V0ZXJXaWR0aDogb3JpZ2luYWwub3V0ZXJXaWR0aCAqIGZhY3RvcgoJCQl9Cgl9KTsKCgllbGVtLmVmZmVjdCggbyApOwp9OwoKJC5lZmZlY3RzLmVmZmVjdC5zY2FsZSA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoKCS8vIENyZWF0ZSBlbGVtZW50Cgl2YXIgZWwgPSAkKCB0aGlzICksCgkJb3B0aW9ucyA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgbyApLAoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWwsIG8ubW9kZSB8fCAiZWZmZWN0IiApLAoJCXBlcmNlbnQgPSBwYXJzZUludCggby5wZXJjZW50LCAxMCApIHx8CgkJCSggcGFyc2VJbnQoIG8ucGVyY2VudCwgMTAgKSA9PT0gMCA/IDAgOiAoIG1vZGUgPT09ICJoaWRlIiA/IDAgOiAxMDAgKSApLAoJCWRpcmVjdGlvbiA9IG8uZGlyZWN0aW9uIHx8ICJib3RoIiwKCQlvcmlnaW4gPSBvLm9yaWdpbiwKCQlvcmlnaW5hbCA9IHsKCQkJaGVpZ2h0OiBlbC5oZWlnaHQoKSwKCQkJd2lkdGg6IGVsLndpZHRoKCksCgkJCW91dGVySGVpZ2h0OiBlbC5vdXRlckhlaWdodCgpLAoJCQlvdXRlcldpZHRoOiBlbC5vdXRlcldpZHRoKCkKCQl9LAoJCWZhY3RvciA9IHsKCQkJeTogZGlyZWN0aW9uICE9PSAiaG9yaXpvbnRhbCIgPyAocGVyY2VudCAvIDEwMCkgOiAxLAoJCQl4OiBkaXJlY3Rpb24gIT09ICJ2ZXJ0aWNhbCIgPyAocGVyY2VudCAvIDEwMCkgOiAxCgkJfTsKCgkvLyBXZSBhcmUgZ29pbmcgdG8gcGFzcyB0aGlzIGVmZmVjdCB0byB0aGUgc2l6ZSBlZmZlY3Q6CglvcHRpb25zLmVmZmVjdCA9ICJzaXplIjsKCW9wdGlvbnMucXVldWUgPSBmYWxzZTsKCW9wdGlvbnMuY29tcGxldGUgPSBkb25lOwoKCS8vIFNldCBkZWZhdWx0IG9yaWdpbiBhbmQgcmVzdG9yZSBmb3Igc2hvdy9oaWRlCglpZiAoIG1vZGUgIT09ICJlZmZlY3QiICkgewoJCW9wdGlvbnMub3JpZ2luID0gb3JpZ2luIHx8IFsibWlkZGxlIiwiY2VudGVyIl07CgkJb3B0aW9ucy5yZXN0b3JlID0gdHJ1ZTsKCX0KCglvcHRpb25zLmZyb20gPSBvLmZyb20gfHwgKCBtb2RlID09PSAic2hvdyIgPyB7CgkJaGVpZ2h0OiAwLAoJCXdpZHRoOiAwLAoJCW91dGVySGVpZ2h0OiAwLAoJCW91dGVyV2lkdGg6IDAKCX0gOiBvcmlnaW5hbCApOwoJb3B0aW9ucy50byA9IHsKCQloZWlnaHQ6IG9yaWdpbmFsLmhlaWdodCAqIGZhY3Rvci55LAoJCXdpZHRoOiBvcmlnaW5hbC53aWR0aCAqIGZhY3Rvci54LAoJCW91dGVySGVpZ2h0OiBvcmlnaW5hbC5vdXRlckhlaWdodCAqIGZhY3Rvci55LAoJCW91dGVyV2lkdGg6IG9yaWdpbmFsLm91dGVyV2lkdGggKiBmYWN0b3IueAoJfTsKCgkvLyBGYWRlIG9wdGlvbiB0byBzdXBwb3J0IHB1ZmYKCWlmICggb3B0aW9ucy5mYWRlICkgewoJCWlmICggbW9kZSA9PT0gInNob3ciICkgewoJCQlvcHRpb25zLmZyb20ub3BhY2l0eSA9IDA7CgkJCW9wdGlvbnMudG8ub3BhY2l0eSA9IDE7CgkJfQoJCWlmICggbW9kZSA9PT0gImhpZGUiICkgewoJCQlvcHRpb25zLmZyb20ub3BhY2l0eSA9IDE7CgkJCW9wdGlvbnMudG8ub3BhY2l0eSA9IDA7CgkJfQoJfQoKCS8vIEFuaW1hdGUKCWVsLmVmZmVjdCggb3B0aW9ucyApOwoKfTsKCiQuZWZmZWN0cy5lZmZlY3Quc2l6ZSA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoKCS8vIENyZWF0ZSBlbGVtZW50Cgl2YXIgb3JpZ2luYWwsIGJhc2VsaW5lLCBmYWN0b3IsCgkJZWwgPSAkKCB0aGlzICksCgkJcHJvcHMwID0gWyAicG9zaXRpb24iLCAidG9wIiwgImJvdHRvbSIsICJsZWZ0IiwgInJpZ2h0IiwgIndpZHRoIiwgImhlaWdodCIsICJvdmVyZmxvdyIsICJvcGFjaXR5IiBdLAoKCQkvLyBBbHdheXMgcmVzdG9yZQoJCXByb3BzMSA9IFsgInBvc2l0aW9uIiwgInRvcCIsICJib3R0b20iLCAibGVmdCIsICJyaWdodCIsICJvdmVyZmxvdyIsICJvcGFjaXR5IiBdLAoKCQkvLyBDb3B5IGZvciBjaGlsZHJlbgoJCXByb3BzMiA9IFsgIndpZHRoIiwgImhlaWdodCIsICJvdmVyZmxvdyIgXSwKCQljUHJvcHMgPSBbICJmb250U2l6ZSIgXSwKCQl2UHJvcHMgPSBbICJib3JkZXJUb3BXaWR0aCIsICJib3JkZXJCb3R0b21XaWR0aCIsICJwYWRkaW5nVG9wIiwgInBhZGRpbmdCb3R0b20iIF0sCgkJaFByb3BzID0gWyAiYm9yZGVyTGVmdFdpZHRoIiwgImJvcmRlclJpZ2h0V2lkdGgiLCAicGFkZGluZ0xlZnQiLCAicGFkZGluZ1JpZ2h0IiBdLAoKCQkvLyBTZXQgb3B0aW9ucwoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWwsIG8ubW9kZSB8fCAiZWZmZWN0IiApLAoJCXJlc3RvcmUgPSBvLnJlc3RvcmUgfHwgbW9kZSAhPT0gImVmZmVjdCIsCgkJc2NhbGUgPSBvLnNjYWxlIHx8ICJib3RoIiwKCQlvcmlnaW4gPSBvLm9yaWdpbiB8fCBbICJtaWRkbGUiLCAiY2VudGVyIiBdLAoJCXBvc2l0aW9uID0gZWwuY3NzKCAicG9zaXRpb24iICksCgkJcHJvcHMgPSByZXN0b3JlID8gcHJvcHMwIDogcHJvcHMxLAoJCXplcm8gPSB7CgkJCWhlaWdodDogMCwKCQkJd2lkdGg6IDAsCgkJCW91dGVySGVpZ2h0OiAwLAoJCQlvdXRlcldpZHRoOiAwCgkJfTsKCglpZiAoIG1vZGUgPT09ICJzaG93IiApIHsKCQllbC5zaG93KCk7Cgl9CglvcmlnaW5hbCA9IHsKCQloZWlnaHQ6IGVsLmhlaWdodCgpLAoJCXdpZHRoOiBlbC53aWR0aCgpLAoJCW91dGVySGVpZ2h0OiBlbC5vdXRlckhlaWdodCgpLAoJCW91dGVyV2lkdGg6IGVsLm91dGVyV2lkdGgoKQoJfTsKCglpZiAoIG8ubW9kZSA9PT0gInRvZ2dsZSIgJiYgbW9kZSA9PT0gInNob3ciICkgewoJCWVsLmZyb20gPSBvLnRvIHx8IHplcm87CgkJZWwudG8gPSBvLmZyb20gfHwgb3JpZ2luYWw7Cgl9IGVsc2UgewoJCWVsLmZyb20gPSBvLmZyb20gfHwgKCBtb2RlID09PSAic2hvdyIgPyB6ZXJvIDogb3JpZ2luYWwgKTsKCQllbC50byA9IG8udG8gfHwgKCBtb2RlID09PSAiaGlkZSIgPyB6ZXJvIDogb3JpZ2luYWwgKTsKCX0KCgkvLyBTZXQgc2NhbGluZyBmYWN0b3IKCWZhY3RvciA9IHsKCQlmcm9tOiB7CgkJCXk6IGVsLmZyb20uaGVpZ2h0IC8gb3JpZ2luYWwuaGVpZ2h0LAoJCQl4OiBlbC5mcm9tLndpZHRoIC8gb3JpZ2luYWwud2lkdGgKCQl9LAoJCXRvOiB7CgkJCXk6IGVsLnRvLmhlaWdodCAvIG9yaWdpbmFsLmhlaWdodCwKCQkJeDogZWwudG8ud2lkdGggLyBvcmlnaW5hbC53aWR0aAoJCX0KCX07CgoJLy8gU2NhbGUgdGhlIGNzcyBib3gKCWlmICggc2NhbGUgPT09ICJib3giIHx8IHNjYWxlID09PSAiYm90aCIgKSB7CgoJCS8vIFZlcnRpY2FsIHByb3BzIHNjYWxpbmcKCQlpZiAoIGZhY3Rvci5mcm9tLnkgIT09IGZhY3Rvci50by55ICkgewoJCQlwcm9wcyA9IHByb3BzLmNvbmNhdCggdlByb3BzICk7CgkJCWVsLmZyb20gPSAkLmVmZmVjdHMuc2V0VHJhbnNpdGlvbiggZWwsIHZQcm9wcywgZmFjdG9yLmZyb20ueSwgZWwuZnJvbSApOwoJCQllbC50byA9ICQuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKCBlbCwgdlByb3BzLCBmYWN0b3IudG8ueSwgZWwudG8gKTsKCQl9CgoJCS8vIEhvcml6b250YWwgcHJvcHMgc2NhbGluZwoJCWlmICggZmFjdG9yLmZyb20ueCAhPT0gZmFjdG9yLnRvLnggKSB7CgkJCXByb3BzID0gcHJvcHMuY29uY2F0KCBoUHJvcHMgKTsKCQkJZWwuZnJvbSA9ICQuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKCBlbCwgaFByb3BzLCBmYWN0b3IuZnJvbS54LCBlbC5mcm9tICk7CgkJCWVsLnRvID0gJC5lZmZlY3RzLnNldFRyYW5zaXRpb24oIGVsLCBoUHJvcHMsIGZhY3Rvci50by54LCBlbC50byApOwoJCX0KCX0KCgkvLyBTY2FsZSB0aGUgY29udGVudAoJaWYgKCBzY2FsZSA9PT0gImNvbnRlbnQiIHx8IHNjYWxlID09PSAiYm90aCIgKSB7CgoJCS8vIFZlcnRpY2FsIHByb3BzIHNjYWxpbmcKCQlpZiAoIGZhY3Rvci5mcm9tLnkgIT09IGZhY3Rvci50by55ICkgewoJCQlwcm9wcyA9IHByb3BzLmNvbmNhdCggY1Byb3BzICkuY29uY2F0KCBwcm9wczIgKTsKCQkJZWwuZnJvbSA9ICQuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKCBlbCwgY1Byb3BzLCBmYWN0b3IuZnJvbS55LCBlbC5mcm9tICk7CgkJCWVsLnRvID0gJC5lZmZlY3RzLnNldFRyYW5zaXRpb24oIGVsLCBjUHJvcHMsIGZhY3Rvci50by55LCBlbC50byApOwoJCX0KCX0KCgkkLmVmZmVjdHMuc2F2ZSggZWwsIHByb3BzICk7CgllbC5zaG93KCk7CgkkLmVmZmVjdHMuY3JlYXRlV3JhcHBlciggZWwgKTsKCWVsLmNzcyggIm92ZXJmbG93IiwgImhpZGRlbiIgKS5jc3MoIGVsLmZyb20gKTsKCgkvLyBBZGp1c3QKCWlmIChvcmlnaW4pIHsgLy8gQ2FsY3VsYXRlIGJhc2VsaW5lIHNoaWZ0cwoJCWJhc2VsaW5lID0gJC5lZmZlY3RzLmdldEJhc2VsaW5lKCBvcmlnaW4sIG9yaWdpbmFsICk7CgkJZWwuZnJvbS50b3AgPSAoIG9yaWdpbmFsLm91dGVySGVpZ2h0IC0gZWwub3V0ZXJIZWlnaHQoKSApICogYmFzZWxpbmUueTsKCQllbC5mcm9tLmxlZnQgPSAoIG9yaWdpbmFsLm91dGVyV2lkdGggLSBlbC5vdXRlcldpZHRoKCkgKSAqIGJhc2VsaW5lLng7CgkJZWwudG8udG9wID0gKCBvcmlnaW5hbC5vdXRlckhlaWdodCAtIGVsLnRvLm91dGVySGVpZ2h0ICkgKiBiYXNlbGluZS55OwoJCWVsLnRvLmxlZnQgPSAoIG9yaWdpbmFsLm91dGVyV2lkdGggLSBlbC50by5vdXRlcldpZHRoICkgKiBiYXNlbGluZS54OwoJfQoJZWwuY3NzKCBlbC5mcm9tICk7IC8vIHNldCB0b3AgJiBsZWZ0CgoJLy8gQW5pbWF0ZQoJaWYgKCBzY2FsZSA9PT0gImNvbnRlbnQiIHx8IHNjYWxlID09PSAiYm90aCIgKSB7IC8vIFNjYWxlIHRoZSBjaGlsZHJlbgoKCQkvLyBBZGQgbWFyZ2lucy9mb250LXNpemUKCQl2UHJvcHMgPSB2UHJvcHMuY29uY2F0KFsgIm1hcmdpblRvcCIsICJtYXJnaW5Cb3R0b20iIF0pLmNvbmNhdChjUHJvcHMpOwoJCWhQcm9wcyA9IGhQcm9wcy5jb25jYXQoWyAibWFyZ2luTGVmdCIsICJtYXJnaW5SaWdodCIgXSk7CgkJcHJvcHMyID0gcHJvcHMwLmNvbmNhdCh2UHJvcHMpLmNvbmNhdChoUHJvcHMpOwoKCQllbC5maW5kKCAiKlt3aWR0aF0iICkuZWFjaCggZnVuY3Rpb24oKXsKCQkJdmFyIGNoaWxkID0gJCggdGhpcyApLAoJCQkJY19vcmlnaW5hbCA9IHsKCQkJCQloZWlnaHQ6IGNoaWxkLmhlaWdodCgpLAoJCQkJCXdpZHRoOiBjaGlsZC53aWR0aCgpLAoJCQkJCW91dGVySGVpZ2h0OiBjaGlsZC5vdXRlckhlaWdodCgpLAoJCQkJCW91dGVyV2lkdGg6IGNoaWxkLm91dGVyV2lkdGgoKQoJCQkJfTsKCQkJaWYgKHJlc3RvcmUpIHsKCQkJCSQuZWZmZWN0cy5zYXZlKGNoaWxkLCBwcm9wczIpOwoJCQl9CgoJCQljaGlsZC5mcm9tID0gewoJCQkJaGVpZ2h0OiBjX29yaWdpbmFsLmhlaWdodCAqIGZhY3Rvci5mcm9tLnksCgkJCQl3aWR0aDogY19vcmlnaW5hbC53aWR0aCAqIGZhY3Rvci5mcm9tLngsCgkJCQlvdXRlckhlaWdodDogY19vcmlnaW5hbC5vdXRlckhlaWdodCAqIGZhY3Rvci5mcm9tLnksCgkJCQlvdXRlcldpZHRoOiBjX29yaWdpbmFsLm91dGVyV2lkdGggKiBmYWN0b3IuZnJvbS54CgkJCX07CgkJCWNoaWxkLnRvID0gewoJCQkJaGVpZ2h0OiBjX29yaWdpbmFsLmhlaWdodCAqIGZhY3Rvci50by55LAoJCQkJd2lkdGg6IGNfb3JpZ2luYWwud2lkdGggKiBmYWN0b3IudG8ueCwKCQkJCW91dGVySGVpZ2h0OiBjX29yaWdpbmFsLmhlaWdodCAqIGZhY3Rvci50by55LAoJCQkJb3V0ZXJXaWR0aDogY19vcmlnaW5hbC53aWR0aCAqIGZhY3Rvci50by54CgkJCX07CgoJCQkvLyBWZXJ0aWNhbCBwcm9wcyBzY2FsaW5nCgkJCWlmICggZmFjdG9yLmZyb20ueSAhPT0gZmFjdG9yLnRvLnkgKSB7CgkJCQljaGlsZC5mcm9tID0gJC5lZmZlY3RzLnNldFRyYW5zaXRpb24oIGNoaWxkLCB2UHJvcHMsIGZhY3Rvci5mcm9tLnksIGNoaWxkLmZyb20gKTsKCQkJCWNoaWxkLnRvID0gJC5lZmZlY3RzLnNldFRyYW5zaXRpb24oIGNoaWxkLCB2UHJvcHMsIGZhY3Rvci50by55LCBjaGlsZC50byApOwoJCQl9CgoJCQkvLyBIb3Jpem9udGFsIHByb3BzIHNjYWxpbmcKCQkJaWYgKCBmYWN0b3IuZnJvbS54ICE9PSBmYWN0b3IudG8ueCApIHsKCQkJCWNoaWxkLmZyb20gPSAkLmVmZmVjdHMuc2V0VHJhbnNpdGlvbiggY2hpbGQsIGhQcm9wcywgZmFjdG9yLmZyb20ueCwgY2hpbGQuZnJvbSApOwoJCQkJY2hpbGQudG8gPSAkLmVmZmVjdHMuc2V0VHJhbnNpdGlvbiggY2hpbGQsIGhQcm9wcywgZmFjdG9yLnRvLngsIGNoaWxkLnRvICk7CgkJCX0KCgkJCS8vIEFuaW1hdGUgY2hpbGRyZW4KCQkJY2hpbGQuY3NzKCBjaGlsZC5mcm9tICk7CgkJCWNoaWxkLmFuaW1hdGUoIGNoaWxkLnRvLCBvLmR1cmF0aW9uLCBvLmVhc2luZywgZnVuY3Rpb24oKSB7CgoJCQkJLy8gUmVzdG9yZSBjaGlsZHJlbgoJCQkJaWYgKCByZXN0b3JlICkgewoJCQkJCSQuZWZmZWN0cy5yZXN0b3JlKCBjaGlsZCwgcHJvcHMyICk7CgkJCQl9CgkJCX0pOwoJCX0pOwoJfQoKCS8vIEFuaW1hdGUKCWVsLmFuaW1hdGUoIGVsLnRvLCB7CgkJcXVldWU6IGZhbHNlLAoJCWR1cmF0aW9uOiBvLmR1cmF0aW9uLAoJCWVhc2luZzogby5lYXNpbmcsCgkJY29tcGxldGU6IGZ1bmN0aW9uKCkgewoJCQlpZiAoIGVsLnRvLm9wYWNpdHkgPT09IDAgKSB7CgkJCQllbC5jc3MoICJvcGFjaXR5IiwgZWwuZnJvbS5vcGFjaXR5ICk7CgkJCX0KCQkJaWYoIG1vZGUgPT09ICJoaWRlIiApIHsKCQkJCWVsLmhpZGUoKTsKCQkJfQoJCQkkLmVmZmVjdHMucmVzdG9yZSggZWwsIHByb3BzICk7CgkJCWlmICggIXJlc3RvcmUgKSB7CgoJCQkJLy8gd2UgbmVlZCB0byBjYWxjdWxhdGUgb3VyIG5ldyBwb3NpdGlvbmluZyBiYXNlZCBvbiB0aGUgc2NhbGluZwoJCQkJaWYgKCBwb3NpdGlvbiA9PT0gInN0YXRpYyIgKSB7CgkJCQkJZWwuY3NzKHsKCQkJCQkJcG9zaXRpb246ICJyZWxhdGl2ZSIsCgkJCQkJCXRvcDogZWwudG8udG9wLAoJCQkJCQlsZWZ0OiBlbC50by5sZWZ0CgkJCQkJfSk7CgkJCQl9IGVsc2UgewoJCQkJCSQuZWFjaChbICJ0b3AiLCAibGVmdCIgXSwgZnVuY3Rpb24oIGlkeCwgcG9zICkgewoJCQkJCQllbC5jc3MoIHBvcywgZnVuY3Rpb24oIF8sIHN0ciApIHsKCQkJCQkJCXZhciB2YWwgPSBwYXJzZUludCggc3RyLCAxMCApLAoJCQkJCQkJCXRvUmVmID0gaWR4ID8gZWwudG8ubGVmdCA6IGVsLnRvLnRvcDsKCgkJCQkJCQkvLyBpZiBvcmlnaW5hbCB3YXMgImF1dG8iLCByZWNhbGN1bGF0ZSB0aGUgbmV3IHZhbHVlIGZyb20gd3JhcHBlcgoJCQkJCQkJaWYgKCBzdHIgPT09ICJhdXRvIiApIHsKCQkJCQkJCQlyZXR1cm4gdG9SZWYgKyAicHgiOwoJCQkJCQkJfQoKCQkJCQkJCXJldHVybiB2YWwgKyB0b1JlZiArICJweCI7CgkJCQkJCX0pOwoJCQkJCX0pOwoJCQkJfQoJCQl9CgoJCQkkLmVmZmVjdHMucmVtb3ZlV3JhcHBlciggZWwgKTsKCQkJZG9uZSgpOwoJCX0KCX0pOwoKfTsKCn0pKGpRdWVyeSk7CgooZnVuY3Rpb24oICQsIHVuZGVmaW5lZCApIHsKCiQuZWZmZWN0cy5lZmZlY3Quc2hha2UgPSBmdW5jdGlvbiggbywgZG9uZSApIHsKCgl2YXIgZWwgPSAkKCB0aGlzICksCgkJcHJvcHMgPSBbICJwb3NpdGlvbiIsICJ0b3AiLCAiYm90dG9tIiwgImxlZnQiLCAicmlnaHQiLCAiaGVpZ2h0IiwgIndpZHRoIiBdLAoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWwsIG8ubW9kZSB8fCAiZWZmZWN0IiApLAoJCWRpcmVjdGlvbiA9IG8uZGlyZWN0aW9uIHx8ICJsZWZ0IiwKCQlkaXN0YW5jZSA9IG8uZGlzdGFuY2UgfHwgMjAsCgkJdGltZXMgPSBvLnRpbWVzIHx8IDMsCgkJYW5pbXMgPSB0aW1lcyAqIDIgKyAxLAoJCXNwZWVkID0gTWF0aC5yb3VuZChvLmR1cmF0aW9uL2FuaW1zKSwKCQlyZWYgPSAoZGlyZWN0aW9uID09PSAidXAiIHx8IGRpcmVjdGlvbiA9PT0gImRvd24iKSA/ICJ0b3AiIDogImxlZnQiLAoJCXBvc2l0aXZlTW90aW9uID0gKGRpcmVjdGlvbiA9PT0gInVwIiB8fCBkaXJlY3Rpb24gPT09ICJsZWZ0IiksCgkJYW5pbWF0aW9uID0ge30sCgkJYW5pbWF0aW9uMSA9IHt9LAoJCWFuaW1hdGlvbjIgPSB7fSwKCQlpLAoKCQkvLyB3ZSB3aWxsIG5lZWQgdG8gcmUtYXNzZW1ibGUgdGhlIHF1ZXVlIHRvIHN0YWNrIG91ciBhbmltYXRpb25zIGluIHBsYWNlCgkJcXVldWUgPSBlbC5xdWV1ZSgpLAoJCXF1ZXVlbGVuID0gcXVldWUubGVuZ3RoOwoKCSQuZWZmZWN0cy5zYXZlKCBlbCwgcHJvcHMgKTsKCWVsLnNob3coKTsKCSQuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKCBlbCApOwoKCS8vIEFuaW1hdGlvbgoJYW5pbWF0aW9uWyByZWYgXSA9ICggcG9zaXRpdmVNb3Rpb24gPyAiLT0iIDogIis9IiApICsgZGlzdGFuY2U7CglhbmltYXRpb24xWyByZWYgXSA9ICggcG9zaXRpdmVNb3Rpb24gPyAiKz0iIDogIi09IiApICsgZGlzdGFuY2UgKiAyOwoJYW5pbWF0aW9uMlsgcmVmIF0gPSAoIHBvc2l0aXZlTW90aW9uID8gIi09IiA6ICIrPSIgKSArIGRpc3RhbmNlICogMjsKCgkvLyBBbmltYXRlCgllbC5hbmltYXRlKCBhbmltYXRpb24sIHNwZWVkLCBvLmVhc2luZyApOwoKCS8vIFNoYWtlcwoJZm9yICggaSA9IDE7IGkgPCB0aW1lczsgaSsrICkgewoJCWVsLmFuaW1hdGUoIGFuaW1hdGlvbjEsIHNwZWVkLCBvLmVhc2luZyApLmFuaW1hdGUoIGFuaW1hdGlvbjIsIHNwZWVkLCBvLmVhc2luZyApOwoJfQoJZWwKCQkuYW5pbWF0ZSggYW5pbWF0aW9uMSwgc3BlZWQsIG8uZWFzaW5nICkKCQkuYW5pbWF0ZSggYW5pbWF0aW9uLCBzcGVlZCAvIDIsIG8uZWFzaW5nICkKCQkucXVldWUoZnVuY3Rpb24oKSB7CgkJCWlmICggbW9kZSA9PT0gImhpZGUiICkgewoJCQkJZWwuaGlkZSgpOwoJCQl9CgkJCSQuZWZmZWN0cy5yZXN0b3JlKCBlbCwgcHJvcHMgKTsKCQkJJC5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoIGVsICk7CgkJCWRvbmUoKTsKCQl9KTsKCgkvLyBpbmplY3QgYWxsIHRoZSBhbmltYXRpb25zIHdlIGp1c3QgcXVldWVkIHRvIGJlIGZpcnN0IGluIGxpbmUgKGFmdGVyICJpbnByb2dyZXNzIikKCWlmICggcXVldWVsZW4gPiAxKSB7CgkJcXVldWUuc3BsaWNlLmFwcGx5KCBxdWV1ZSwKCQkJWyAxLCAwIF0uY29uY2F0KCBxdWV1ZS5zcGxpY2UoIHF1ZXVlbGVuLCBhbmltcyArIDEgKSApICk7Cgl9CgllbC5kZXF1ZXVlKCk7Cgp9OwoKfSkoalF1ZXJ5KTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKJC5lZmZlY3RzLmVmZmVjdC5zbGlkZSA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoKCS8vIENyZWF0ZSBlbGVtZW50Cgl2YXIgZWwgPSAkKCB0aGlzICksCgkJcHJvcHMgPSBbICJwb3NpdGlvbiIsICJ0b3AiLCAiYm90dG9tIiwgImxlZnQiLCAicmlnaHQiLCAid2lkdGgiLCAiaGVpZ2h0IiBdLAoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWwsIG8ubW9kZSB8fCAic2hvdyIgKSwKCQlzaG93ID0gbW9kZSA9PT0gInNob3ciLAoJCWRpcmVjdGlvbiA9IG8uZGlyZWN0aW9uIHx8ICJsZWZ0IiwKCQlyZWYgPSAoZGlyZWN0aW9uID09PSAidXAiIHx8IGRpcmVjdGlvbiA9PT0gImRvd24iKSA/ICJ0b3AiIDogImxlZnQiLAoJCXBvc2l0aXZlTW90aW9uID0gKGRpcmVjdGlvbiA9PT0gInVwIiB8fCBkaXJlY3Rpb24gPT09ICJsZWZ0IiksCgkJZGlzdGFuY2UsCgkJYW5pbWF0aW9uID0ge307CgoJLy8gQWRqdXN0CgkkLmVmZmVjdHMuc2F2ZSggZWwsIHByb3BzICk7CgllbC5zaG93KCk7CglkaXN0YW5jZSA9IG8uZGlzdGFuY2UgfHwgZWxbIHJlZiA9PT0gInRvcCIgPyAib3V0ZXJIZWlnaHQiIDogIm91dGVyV2lkdGgiIF0oIHRydWUgKTsKCgkkLmVmZmVjdHMuY3JlYXRlV3JhcHBlciggZWwgKS5jc3MoewoJCW92ZXJmbG93OiAiaGlkZGVuIgoJfSk7CgoJaWYgKCBzaG93ICkgewoJCWVsLmNzcyggcmVmLCBwb3NpdGl2ZU1vdGlvbiA/IChpc05hTihkaXN0YW5jZSkgPyAiLSIgKyBkaXN0YW5jZSA6IC1kaXN0YW5jZSkgOiBkaXN0YW5jZSApOwoJfQoKCS8vIEFuaW1hdGlvbgoJYW5pbWF0aW9uWyByZWYgXSA9ICggc2hvdyA/CgkJKCBwb3NpdGl2ZU1vdGlvbiA/ICIrPSIgOiAiLT0iKSA6CgkJKCBwb3NpdGl2ZU1vdGlvbiA/ICItPSIgOiAiKz0iKSkgKwoJCWRpc3RhbmNlOwoKCS8vIEFuaW1hdGUKCWVsLmFuaW1hdGUoIGFuaW1hdGlvbiwgewoJCXF1ZXVlOiBmYWxzZSwKCQlkdXJhdGlvbjogby5kdXJhdGlvbiwKCQllYXNpbmc6IG8uZWFzaW5nLAoJCWNvbXBsZXRlOiBmdW5jdGlvbigpIHsKCQkJaWYgKCBtb2RlID09PSAiaGlkZSIgKSB7CgkJCQllbC5oaWRlKCk7CgkJCX0KCQkJJC5lZmZlY3RzLnJlc3RvcmUoIGVsLCBwcm9wcyApOwoJCQkkLmVmZmVjdHMucmVtb3ZlV3JhcHBlciggZWwgKTsKCQkJZG9uZSgpOwoJCX0KCX0pOwp9OwoKfSkoalF1ZXJ5KTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKJC5lZmZlY3RzLmVmZmVjdC50cmFuc2ZlciA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoJdmFyIGVsZW0gPSAkKCB0aGlzICksCgkJdGFyZ2V0ID0gJCggby50byApLAoJCXRhcmdldEZpeGVkID0gdGFyZ2V0LmNzcyggInBvc2l0aW9uIiApID09PSAiZml4ZWQiLAoJCWJvZHkgPSAkKCJib2R5IiksCgkJZml4VG9wID0gdGFyZ2V0Rml4ZWQgPyBib2R5LnNjcm9sbFRvcCgpIDogMCwKCQlmaXhMZWZ0ID0gdGFyZ2V0Rml4ZWQgPyBib2R5LnNjcm9sbExlZnQoKSA6IDAsCgkJZW5kUG9zaXRpb24gPSB0YXJnZXQub2Zmc2V0KCksCgkJYW5pbWF0aW9uID0gewoJCQl0b3A6IGVuZFBvc2l0aW9uLnRvcCAtIGZpeFRvcCAsCgkJCWxlZnQ6IGVuZFBvc2l0aW9uLmxlZnQgLSBmaXhMZWZ0ICwKCQkJaGVpZ2h0OiB0YXJnZXQuaW5uZXJIZWlnaHQoKSwKCQkJd2lkdGg6IHRhcmdldC5pbm5lcldpZHRoKCkKCQl9LAoJCXN0YXJ0UG9zaXRpb24gPSBlbGVtLm9mZnNldCgpLAoJCXRyYW5zZmVyID0gJCggIjxkaXYgY2xhc3M9J3VpLWVmZmVjdHMtdHJhbnNmZXInPjwvZGl2PiIgKQoJCQkuYXBwZW5kVG8oIGRvY3VtZW50LmJvZHkgKQoJCQkuYWRkQ2xhc3MoIG8uY2xhc3NOYW1lICkKCQkJLmNzcyh7CgkJCQl0b3A6IHN0YXJ0UG9zaXRpb24udG9wIC0gZml4VG9wICwKCQkJCWxlZnQ6IHN0YXJ0UG9zaXRpb24ubGVmdCAtIGZpeExlZnQgLAoJCQkJaGVpZ2h0OiBlbGVtLmlubmVySGVpZ2h0KCksCgkJCQl3aWR0aDogZWxlbS5pbm5lcldpZHRoKCksCgkJCQlwb3NpdGlvbjogdGFyZ2V0Rml4ZWQgPyAiZml4ZWQiIDogImFic29sdXRlIgoJCQl9KQoJCQkuYW5pbWF0ZSggYW5pbWF0aW9uLCBvLmR1cmF0aW9uLCBvLmVhc2luZywgZnVuY3Rpb24oKSB7CgkJCQl0cmFuc2Zlci5yZW1vdmUoKTsKCQkJCWRvbmUoKTsKCQkJfSk7Cn07Cgp9KShqUXVlcnkpOwoKKGZ1bmN0aW9uKCAkLCB1bmRlZmluZWQgKSB7CgokLndpZGdldCggInVpLm1lbnUiLCB7Cgl2ZXJzaW9uOiAiMS4xMC40IiwKCWRlZmF1bHRFbGVtZW50OiAiPHVsPiIsCglkZWxheTogMzAwLAoJb3B0aW9uczogewoJCWljb25zOiB7CgkJCXN1Ym1lbnU6ICJ1aS1pY29uLWNhcmF0LTEtZSIKCQl9LAoJCW1lbnVzOiAidWwiLAoJCXBvc2l0aW9uOiB7CgkJCW15OiAibGVmdCB0b3AiLAoJCQlhdDogInJpZ2h0IHRvcCIKCQl9LAoJCXJvbGU6ICJtZW51IiwKCgkJLy8gY2FsbGJhY2tzCgkJYmx1cjogbnVsbCwKCQlmb2N1czogbnVsbCwKCQlzZWxlY3Q6IG51bGwKCX0sCgoJX2NyZWF0ZTogZnVuY3Rpb24oKSB7CgkJdGhpcy5hY3RpdmVNZW51ID0gdGhpcy5lbGVtZW50OwoJCS8vIGZsYWcgdXNlZCB0byBwcmV2ZW50IGZpcmluZyBvZiB0aGUgY2xpY2sgaGFuZGxlcgoJCS8vIGFzIHRoZSBldmVudCBidWJibGVzIHVwIHRocm91Z2ggbmVzdGVkIG1lbnVzCgkJdGhpcy5tb3VzZUhhbmRsZWQgPSBmYWxzZTsKCQl0aGlzLmVsZW1lbnQKCQkJLnVuaXF1ZUlkKCkKCQkJLmFkZENsYXNzKCAidWktbWVudSB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCIgKQoJCQkudG9nZ2xlQ2xhc3MoICJ1aS1tZW51LWljb25zIiwgISF0aGlzLmVsZW1lbnQuZmluZCggIi51aS1pY29uIiApLmxlbmd0aCApCgkJCS5hdHRyKHsKCQkJCXJvbGU6IHRoaXMub3B0aW9ucy5yb2xlLAoJCQkJdGFiSW5kZXg6IDAKCQkJfSkKCQkJLy8gbmVlZCB0byBjYXRjaCBhbGwgY2xpY2tzIG9uIGRpc2FibGVkIG1lbnUKCQkJLy8gbm90IHBvc3NpYmxlIHRocm91Z2ggX29uCgkJCS5iaW5kKCAiY2xpY2siICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgJC5wcm94eShmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlpZiAoIHRoaXMub3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJfQoJCQl9LCB0aGlzICkpOwoKCQlpZiAoIHRoaXMub3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJdGhpcy5lbGVtZW50CgkJCQkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1kaXNhYmxlZCIgKQoJCQkJLmF0dHIoICJhcmlhLWRpc2FibGVkIiwgInRydWUiICk7CgkJfQoKCQl0aGlzLl9vbih7CgkJCS8vIFByZXZlbnQgZm9jdXMgZnJvbSBzdGlja2luZyB0byBsaW5rcyBpbnNpZGUgbWVudSBhZnRlciBjbGlja2luZwoJCQkvLyB0aGVtIChmb2N1cyBzaG91bGQgYWx3YXlzIHN0YXkgb24gVUwgZHVyaW5nIG5hdmlnYXRpb24pLgoJCQkibW91c2Vkb3duIC51aS1tZW51LWl0ZW0gPiBhIjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJfSwKCQkJImNsaWNrIC51aS1zdGF0ZS1kaXNhYmxlZCA+IGEiOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQl9LAoJCQkiY2xpY2sgLnVpLW1lbnUtaXRlbTpoYXMoYSkiOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQl2YXIgdGFyZ2V0ID0gJCggZXZlbnQudGFyZ2V0ICkuY2xvc2VzdCggIi51aS1tZW51LWl0ZW0iICk7CgkJCQlpZiAoICF0aGlzLm1vdXNlSGFuZGxlZCAmJiB0YXJnZXQubm90KCAiLnVpLXN0YXRlLWRpc2FibGVkIiApLmxlbmd0aCApIHsKCQkJCQl0aGlzLnNlbGVjdCggZXZlbnQgKTsKCgkJCQkJLy8gT25seSBzZXQgdGhlIG1vdXNlSGFuZGxlZCBmbGFnIGlmIHRoZSBldmVudCB3aWxsIGJ1YmJsZSwgc2VlICM5NDY5LgoJCQkJCWlmICggIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgkJCQkJCXRoaXMubW91c2VIYW5kbGVkID0gdHJ1ZTsKCQkJCQl9CgoJCQkJCS8vIE9wZW4gc3VibWVudSBvbiBjbGljawoJCQkJCWlmICggdGFyZ2V0LmhhcyggIi51aS1tZW51IiApLmxlbmd0aCApIHsKCQkJCQkJdGhpcy5leHBhbmQoIGV2ZW50ICk7CgkJCQkJfSBlbHNlIGlmICggIXRoaXMuZWxlbWVudC5pcyggIjpmb2N1cyIgKSAmJiAkKCB0aGlzLmRvY3VtZW50WyAwIF0uYWN0aXZlRWxlbWVudCApLmNsb3Nlc3QoICIudWktbWVudSIgKS5sZW5ndGggKSB7CgoJCQkJCQkvLyBSZWRpcmVjdCBmb2N1cyB0byB0aGUgbWVudQoJCQkJCQl0aGlzLmVsZW1lbnQudHJpZ2dlciggImZvY3VzIiwgWyB0cnVlIF0gKTsKCgkJCQkJCS8vIElmIHRoZSBhY3RpdmUgaXRlbSBpcyBvbiB0aGUgdG9wIGxldmVsLCBsZXQgaXQgc3RheSBhY3RpdmUuCgkJCQkJCS8vIE90aGVyd2lzZSwgYmx1ciB0aGUgYWN0aXZlIGl0ZW0gc2luY2UgaXQgaXMgbm8gbG9uZ2VyIHZpc2libGUuCgkJCQkJCWlmICggdGhpcy5hY3RpdmUgJiYgdGhpcy5hY3RpdmUucGFyZW50cyggIi51aS1tZW51IiApLmxlbmd0aCA9PT0gMSApIHsKCQkJCQkJCWNsZWFyVGltZW91dCggdGhpcy50aW1lciApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9LAoJCQkibW91c2VlbnRlciAudWktbWVudS1pdGVtIjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJdmFyIHRhcmdldCA9ICQoIGV2ZW50LmN1cnJlbnRUYXJnZXQgKTsKCQkJCS8vIFJlbW92ZSB1aS1zdGF0ZS1hY3RpdmUgY2xhc3MgZnJvbSBzaWJsaW5ncyBvZiB0aGUgbmV3bHkgZm9jdXNlZCBtZW51IGl0ZW0KCQkJCS8vIHRvIGF2b2lkIGEganVtcCBjYXVzZWQgYnkgYWRqYWNlbnQgZWxlbWVudHMgYm90aCBoYXZpbmcgYSBjbGFzcyB3aXRoIGEgYm9yZGVyCgkJCQl0YXJnZXQuc2libGluZ3MoKS5jaGlsZHJlbiggIi51aS1zdGF0ZS1hY3RpdmUiICkucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICk7CgkJCQl0aGlzLmZvY3VzKCBldmVudCwgdGFyZ2V0ICk7CgkJCX0sCgkJCW1vdXNlbGVhdmU6ICJjb2xsYXBzZUFsbCIsCgkJCSJtb3VzZWxlYXZlIC51aS1tZW51IjogImNvbGxhcHNlQWxsIiwKCQkJZm9jdXM6IGZ1bmN0aW9uKCBldmVudCwga2VlcEFjdGl2ZUl0ZW0gKSB7CgkJCQkvLyBJZiB0aGVyZSdzIGFscmVhZHkgYW4gYWN0aXZlIGl0ZW0sIGtlZXAgaXQgYWN0aXZlCgkJCQkvLyBJZiBub3QsIGFjdGl2YXRlIHRoZSBmaXJzdCBpdGVtCgkJCQl2YXIgaXRlbSA9IHRoaXMuYWN0aXZlIHx8IHRoaXMuZWxlbWVudC5jaGlsZHJlbiggIi51aS1tZW51LWl0ZW0iICkuZXEoIDAgKTsKCgkJCQlpZiAoICFrZWVwQWN0aXZlSXRlbSApIHsKCQkJCQl0aGlzLmZvY3VzKCBldmVudCwgaXRlbSApOwoJCQkJfQoJCQl9LAoJCQlibHVyOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQl0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJCQlpZiAoICEkLmNvbnRhaW5zKCB0aGlzLmVsZW1lbnRbMF0sIHRoaXMuZG9jdW1lbnRbMF0uYWN0aXZlRWxlbWVudCApICkgewoJCQkJCQl0aGlzLmNvbGxhcHNlQWxsKCBldmVudCApOwoJCQkJCX0KCQkJCX0pOwoJCQl9LAoJCQlrZXlkb3duOiAiX2tleWRvd24iCgkJfSk7CgoJCXRoaXMucmVmcmVzaCgpOwoKCQkvLyBDbGlja3Mgb3V0c2lkZSBvZiBhIG1lbnUgY29sbGFwc2UgYW55IG9wZW4gbWVudXMKCQl0aGlzLl9vbiggdGhpcy5kb2N1bWVudCwgewoJCQljbGljazogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJaWYgKCAhJCggZXZlbnQudGFyZ2V0ICkuY2xvc2VzdCggIi51aS1tZW51IiApLmxlbmd0aCApIHsKCQkJCQl0aGlzLmNvbGxhcHNlQWxsKCBldmVudCApOwoJCQkJfQoKCQkJCS8vIFJlc2V0IHRoZSBtb3VzZUhhbmRsZWQgZmxhZwoJCQkJdGhpcy5tb3VzZUhhbmRsZWQgPSBmYWxzZTsKCQkJfQoJCX0pOwoJfSwKCglfZGVzdHJveTogZnVuY3Rpb24oKSB7CgkJLy8gRGVzdHJveSAoc3ViKW1lbnVzCgkJdGhpcy5lbGVtZW50CgkJCS5yZW1vdmVBdHRyKCAiYXJpYS1hY3RpdmVkZXNjZW5kYW50IiApCgkJCS5maW5kKCAiLnVpLW1lbnUiICkuYWRkQmFjaygpCgkJCQkucmVtb3ZlQ2xhc3MoICJ1aS1tZW51IHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIHVpLW1lbnUtaWNvbnMiICkKCQkJCS5yZW1vdmVBdHRyKCAicm9sZSIgKQoJCQkJLnJlbW92ZUF0dHIoICJ0YWJJbmRleCIgKQoJCQkJLnJlbW92ZUF0dHIoICJhcmlhLWxhYmVsbGVkYnkiICkKCQkJCS5yZW1vdmVBdHRyKCAiYXJpYS1leHBhbmRlZCIgKQoJCQkJLnJlbW92ZUF0dHIoICJhcmlhLWhpZGRlbiIgKQoJCQkJLnJlbW92ZUF0dHIoICJhcmlhLWRpc2FibGVkIiApCgkJCQkucmVtb3ZlVW5pcXVlSWQoKQoJCQkJLnNob3coKTsKCgkJLy8gRGVzdHJveSBtZW51IGl0ZW1zCgkJdGhpcy5lbGVtZW50LmZpbmQoICIudWktbWVudS1pdGVtIiApCgkJCS5yZW1vdmVDbGFzcyggInVpLW1lbnUtaXRlbSIgKQoJCQkucmVtb3ZlQXR0ciggInJvbGUiICkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLWRpc2FibGVkIiApCgkJCS5jaGlsZHJlbiggImEiICkKCQkJCS5yZW1vdmVVbmlxdWVJZCgpCgkJCQkucmVtb3ZlQ2xhc3MoICJ1aS1jb3JuZXItYWxsIHVpLXN0YXRlLWhvdmVyIiApCgkJCQkucmVtb3ZlQXR0ciggInRhYkluZGV4IiApCgkJCQkucmVtb3ZlQXR0ciggInJvbGUiICkKCQkJCS5yZW1vdmVBdHRyKCAiYXJpYS1oYXNwb3B1cCIgKQoJCQkJLmNoaWxkcmVuKCkuZWFjaCggZnVuY3Rpb24oKSB7CgkJCQkJdmFyIGVsZW0gPSAkKCB0aGlzICk7CgkJCQkJaWYgKCBlbGVtLmRhdGEoICJ1aS1tZW51LXN1Ym1lbnUtY2FyYXQiICkgKSB7CgkJCQkJCWVsZW0ucmVtb3ZlKCk7CgkJCQkJfQoJCQkJfSk7CgoJCS8vIERlc3Ryb3kgbWVudSBkaXZpZGVycwoJCXRoaXMuZWxlbWVudC5maW5kKCAiLnVpLW1lbnUtZGl2aWRlciIgKS5yZW1vdmVDbGFzcyggInVpLW1lbnUtZGl2aWRlciB1aS13aWRnZXQtY29udGVudCIgKTsKCX0sCgoJX2tleWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgbWF0Y2gsIHByZXYsIGNoYXJhY3Rlciwgc2tpcCwgcmVnZXgsCgkJCXByZXZlbnREZWZhdWx0ID0gdHJ1ZTsKCgkJZnVuY3Rpb24gZXNjYXBlKCB2YWx1ZSApIHsKCQkJcmV0dXJuIHZhbHVlLnJlcGxhY2UoIC9bXC1cW1xde30oKSorPy4sXFxcXiR8I1xzXS9nLCAiXFwkJiIgKTsKCQl9CgoJCXN3aXRjaCAoIGV2ZW50LmtleUNvZGUgKSB7CgkJY2FzZSAkLnVpLmtleUNvZGUuUEFHRV9VUDoKCQkJdGhpcy5wcmV2aW91c1BhZ2UoIGV2ZW50ICk7CgkJCWJyZWFrOwoJCWNhc2UgJC51aS5rZXlDb2RlLlBBR0VfRE9XTjoKCQkJdGhpcy5uZXh0UGFnZSggZXZlbnQgKTsKCQkJYnJlYWs7CgkJY2FzZSAkLnVpLmtleUNvZGUuSE9NRToKCQkJdGhpcy5fbW92ZSggImZpcnN0IiwgImZpcnN0IiwgZXZlbnQgKTsKCQkJYnJlYWs7CgkJY2FzZSAkLnVpLmtleUNvZGUuRU5EOgoJCQl0aGlzLl9tb3ZlKCAibGFzdCIsICJsYXN0IiwgZXZlbnQgKTsKCQkJYnJlYWs7CgkJY2FzZSAkLnVpLmtleUNvZGUuVVA6CgkJCXRoaXMucHJldmlvdXMoIGV2ZW50ICk7CgkJCWJyZWFrOwoJCWNhc2UgJC51aS5rZXlDb2RlLkRPV046CgkJCXRoaXMubmV4dCggZXZlbnQgKTsKCQkJYnJlYWs7CgkJY2FzZSAkLnVpLmtleUNvZGUuTEVGVDoKCQkJdGhpcy5jb2xsYXBzZSggZXZlbnQgKTsKCQkJYnJlYWs7CgkJY2FzZSAkLnVpLmtleUNvZGUuUklHSFQ6CgkJCWlmICggdGhpcy5hY3RpdmUgJiYgIXRoaXMuYWN0aXZlLmlzKCAiLnVpLXN0YXRlLWRpc2FibGVkIiApICkgewoJCQkJdGhpcy5leHBhbmQoIGV2ZW50ICk7CgkJCX0KCQkJYnJlYWs7CgkJY2FzZSAkLnVpLmtleUNvZGUuRU5URVI6CgkJY2FzZSAkLnVpLmtleUNvZGUuU1BBQ0U6CgkJCXRoaXMuX2FjdGl2YXRlKCBldmVudCApOwoJCQlicmVhazsKCQljYXNlICQudWkua2V5Q29kZS5FU0NBUEU6CgkJCXRoaXMuY29sbGFwc2UoIGV2ZW50ICk7CgkJCWJyZWFrOwoJCWRlZmF1bHQ6CgkJCXByZXZlbnREZWZhdWx0ID0gZmFsc2U7CgkJCXByZXYgPSB0aGlzLnByZXZpb3VzRmlsdGVyIHx8ICIiOwoJCQljaGFyYWN0ZXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCBldmVudC5rZXlDb2RlICk7CgkJCXNraXAgPSBmYWxzZTsKCgkJCWNsZWFyVGltZW91dCggdGhpcy5maWx0ZXJUaW1lciApOwoKCQkJaWYgKCBjaGFyYWN0ZXIgPT09IHByZXYgKSB7CgkJCQlza2lwID0gdHJ1ZTsKCQkJfSBlbHNlIHsKCQkJCWNoYXJhY3RlciA9IHByZXYgKyBjaGFyYWN0ZXI7CgkJCX0KCgkJCXJlZ2V4ID0gbmV3IFJlZ0V4cCggIl4iICsgZXNjYXBlKCBjaGFyYWN0ZXIgKSwgImkiICk7CgkJCW1hdGNoID0gdGhpcy5hY3RpdmVNZW51LmNoaWxkcmVuKCAiLnVpLW1lbnUtaXRlbSIgKS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gcmVnZXgudGVzdCggJCggdGhpcyApLmNoaWxkcmVuKCAiYSIgKS50ZXh0KCkgKTsKCQkJfSk7CgkJCW1hdGNoID0gc2tpcCAmJiBtYXRjaC5pbmRleCggdGhpcy5hY3RpdmUubmV4dCgpICkgIT09IC0xID8KCQkJCXRoaXMuYWN0aXZlLm5leHRBbGwoICIudWktbWVudS1pdGVtIiApIDoKCQkJCW1hdGNoOwoKCQkJLy8gSWYgbm8gbWF0Y2hlcyBvbiB0aGUgY3VycmVudCBmaWx0ZXIsIHJlc2V0IHRvIHRoZSBsYXN0IGNoYXJhY3RlciBwcmVzc2VkCgkJCS8vIHRvIG1vdmUgZG93biB0aGUgbWVudSB0byB0aGUgZmlyc3QgaXRlbSB0aGF0IHN0YXJ0cyB3aXRoIHRoYXQgY2hhcmFjdGVyCgkJCWlmICggIW1hdGNoLmxlbmd0aCApIHsKCQkJCWNoYXJhY3RlciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoIGV2ZW50LmtleUNvZGUgKTsKCQkJCXJlZ2V4ID0gbmV3IFJlZ0V4cCggIl4iICsgZXNjYXBlKCBjaGFyYWN0ZXIgKSwgImkiICk7CgkJCQltYXRjaCA9IHRoaXMuYWN0aXZlTWVudS5jaGlsZHJlbiggIi51aS1tZW51LWl0ZW0iICkuZmlsdGVyKGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiByZWdleC50ZXN0KCAkKCB0aGlzICkuY2hpbGRyZW4oICJhIiApLnRleHQoKSApOwoJCQkJfSk7CgkJCX0KCgkJCWlmICggbWF0Y2gubGVuZ3RoICkgewoJCQkJdGhpcy5mb2N1cyggZXZlbnQsIG1hdGNoICk7CgkJCQlpZiAoIG1hdGNoLmxlbmd0aCA+IDEgKSB7CgkJCQkJdGhpcy5wcmV2aW91c0ZpbHRlciA9IGNoYXJhY3RlcjsKCQkJCQl0aGlzLmZpbHRlclRpbWVyID0gdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CgkJCQkJCWRlbGV0ZSB0aGlzLnByZXZpb3VzRmlsdGVyOwoJCQkJCX0sIDEwMDAgKTsKCQkJCX0gZWxzZSB7CgkJCQkJZGVsZXRlIHRoaXMucHJldmlvdXNGaWx0ZXI7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlkZWxldGUgdGhpcy5wcmV2aW91c0ZpbHRlcjsKCQkJfQoJCX0KCgkJaWYgKCBwcmV2ZW50RGVmYXVsdCApIHsKCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQl9Cgl9LAoKCV9hY3RpdmF0ZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCWlmICggIXRoaXMuYWN0aXZlLmlzKCAiLnVpLXN0YXRlLWRpc2FibGVkIiApICkgewoJCQlpZiAoIHRoaXMuYWN0aXZlLmNoaWxkcmVuKCAiYVthcmlhLWhhc3BvcHVwPSd0cnVlJ10iICkubGVuZ3RoICkgewoJCQkJdGhpcy5leHBhbmQoIGV2ZW50ICk7CgkJCX0gZWxzZSB7CgkJCQl0aGlzLnNlbGVjdCggZXZlbnQgKTsKCQkJfQoJCX0KCX0sCgoJcmVmcmVzaDogZnVuY3Rpb24oKSB7CgkJdmFyIG1lbnVzLAoJCQlpY29uID0gdGhpcy5vcHRpb25zLmljb25zLnN1Ym1lbnUsCgkJCXN1Ym1lbnVzID0gdGhpcy5lbGVtZW50LmZpbmQoIHRoaXMub3B0aW9ucy5tZW51cyApOwoKCQl0aGlzLmVsZW1lbnQudG9nZ2xlQ2xhc3MoICJ1aS1tZW51LWljb25zIiwgISF0aGlzLmVsZW1lbnQuZmluZCggIi51aS1pY29uIiApLmxlbmd0aCApOwoKCQkvLyBJbml0aWFsaXplIG5lc3RlZCBtZW51cwoJCXN1Ym1lbnVzLmZpbHRlciggIjpub3QoLnVpLW1lbnUpIiApCgkJCS5hZGRDbGFzcyggInVpLW1lbnUgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiICkKCQkJLmhpZGUoKQoJCQkuYXR0cih7CgkJCQlyb2xlOiB0aGlzLm9wdGlvbnMucm9sZSwKCQkJCSJhcmlhLWhpZGRlbiI6ICJ0cnVlIiwKCQkJCSJhcmlhLWV4cGFuZGVkIjogImZhbHNlIgoJCQl9KQoJCQkuZWFjaChmdW5jdGlvbigpIHsKCQkJCXZhciBtZW51ID0gJCggdGhpcyApLAoJCQkJCWl0ZW0gPSBtZW51LnByZXYoICJhIiApLAoJCQkJCXN1Ym1lbnVDYXJhdCA9ICQoICI8c3Bhbj4iICkKCQkJCQkJLmFkZENsYXNzKCAidWktbWVudS1pY29uIHVpLWljb24gIiArIGljb24gKQoJCQkJCQkuZGF0YSggInVpLW1lbnUtc3VibWVudS1jYXJhdCIsIHRydWUgKTsKCgkJCQlpdGVtCgkJCQkJLmF0dHIoICJhcmlhLWhhc3BvcHVwIiwgInRydWUiICkKCQkJCQkucHJlcGVuZCggc3VibWVudUNhcmF0ICk7CgkJCQltZW51LmF0dHIoICJhcmlhLWxhYmVsbGVkYnkiLCBpdGVtLmF0dHIoICJpZCIgKSApOwoJCQl9KTsKCgkJbWVudXMgPSBzdWJtZW51cy5hZGQoIHRoaXMuZWxlbWVudCApOwoKCQkvLyBEb24ndCByZWZyZXNoIGxpc3QgaXRlbXMgdGhhdCBhcmUgYWxyZWFkeSBhZGFwdGVkCgkJbWVudXMuY2hpbGRyZW4oICI6bm90KC51aS1tZW51LWl0ZW0pOmhhcyhhKSIgKQoJCQkuYWRkQ2xhc3MoICJ1aS1tZW51LWl0ZW0iICkKCQkJLmF0dHIoICJyb2xlIiwgInByZXNlbnRhdGlvbiIgKQoJCQkuY2hpbGRyZW4oICJhIiApCgkJCQkudW5pcXVlSWQoKQoJCQkJLmFkZENsYXNzKCAidWktY29ybmVyLWFsbCIgKQoJCQkJLmF0dHIoewoJCQkJCXRhYkluZGV4OiAtMSwKCQkJCQlyb2xlOiB0aGlzLl9pdGVtUm9sZSgpCgkJCQl9KTsKCgkJLy8gSW5pdGlhbGl6ZSB1bmxpbmtlZCBtZW51LWl0ZW1zIGNvbnRhaW5pbmcgc3BhY2VzIGFuZC9vciBkYXNoZXMgb25seSBhcyBkaXZpZGVycwoJCW1lbnVzLmNoaWxkcmVuKCAiOm5vdCgudWktbWVudS1pdGVtKSIgKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgaXRlbSA9ICQoIHRoaXMgKTsKCQkJLy8gaHlwaGVuLCBlbSBkYXNoLCBlbiBkYXNoCgkJCWlmICggIS9bXlwtXHUyMDE0XHUyMDEzXHNdLy50ZXN0KCBpdGVtLnRleHQoKSApICkgewoJCQkJaXRlbS5hZGRDbGFzcyggInVpLXdpZGdldC1jb250ZW50IHVpLW1lbnUtZGl2aWRlciIgKTsKCQkJfQoJCX0pOwoKCQkvLyBBZGQgYXJpYS1kaXNhYmxlZCBhdHRyaWJ1dGUgdG8gYW55IGRpc2FibGVkIG1lbnUgaXRlbQoJCW1lbnVzLmNoaWxkcmVuKCAiLnVpLXN0YXRlLWRpc2FibGVkIiApLmF0dHIoICJhcmlhLWRpc2FibGVkIiwgInRydWUiICk7CgoJCS8vIElmIHRoZSBhY3RpdmUgaXRlbSBoYXMgYmVlbiByZW1vdmVkLCBibHVyIHRoZSBtZW51CgkJaWYgKCB0aGlzLmFjdGl2ZSAmJiAhJC5jb250YWlucyggdGhpcy5lbGVtZW50WyAwIF0sIHRoaXMuYWN0aXZlWyAwIF0gKSApIHsKCQkJdGhpcy5ibHVyKCk7CgkJfQoJfSwKCglfaXRlbVJvbGU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB7CgkJCW1lbnU6ICJtZW51aXRlbSIsCgkJCWxpc3Rib3g6ICJvcHRpb24iCgkJfVsgdGhpcy5vcHRpb25zLnJvbGUgXTsKCX0sCgoJX3NldE9wdGlvbjogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJaWYgKCBrZXkgPT09ICJpY29ucyIgKSB7CgkJCXRoaXMuZWxlbWVudC5maW5kKCAiLnVpLW1lbnUtaWNvbiIgKQoJCQkJLnJlbW92ZUNsYXNzKCB0aGlzLm9wdGlvbnMuaWNvbnMuc3VibWVudSApCgkJCQkuYWRkQ2xhc3MoIHZhbHVlLnN1Ym1lbnUgKTsKCQl9CgkJdGhpcy5fc3VwZXIoIGtleSwgdmFsdWUgKTsKCX0sCgoJZm9jdXM6IGZ1bmN0aW9uKCBldmVudCwgaXRlbSApIHsKCQl2YXIgbmVzdGVkLCBmb2N1c2VkOwoJCXRoaXMuYmx1ciggZXZlbnQsIGV2ZW50ICYmIGV2ZW50LnR5cGUgPT09ICJmb2N1cyIgKTsKCgkJdGhpcy5fc2Nyb2xsSW50b1ZpZXcoIGl0ZW0gKTsKCgkJdGhpcy5hY3RpdmUgPSBpdGVtLmZpcnN0KCk7CgkJZm9jdXNlZCA9IHRoaXMuYWN0aXZlLmNoaWxkcmVuKCAiYSIgKS5hZGRDbGFzcyggInVpLXN0YXRlLWZvY3VzIiApOwoJCS8vIE9ubHkgdXBkYXRlIGFyaWEtYWN0aXZlZGVzY2VuZGFudCBpZiB0aGVyZSdzIGEgcm9sZQoJCS8vIG90aGVyd2lzZSB3ZSBhc3N1bWUgZm9jdXMgaXMgbWFuYWdlZCBlbHNld2hlcmUKCQlpZiAoIHRoaXMub3B0aW9ucy5yb2xlICkgewoJCQl0aGlzLmVsZW1lbnQuYXR0ciggImFyaWEtYWN0aXZlZGVzY2VuZGFudCIsIGZvY3VzZWQuYXR0ciggImlkIiApICk7CgkJfQoKCQkvLyBIaWdobGlnaHQgYWN0aXZlIHBhcmVudCBtZW51IGl0ZW0sIGlmIGFueQoJCXRoaXMuYWN0aXZlCgkJCS5wYXJlbnQoKQoJCQkuY2xvc2VzdCggIi51aS1tZW51LWl0ZW0iICkKCQkJLmNoaWxkcmVuKCAiYTpmaXJzdCIgKQoJCQkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICk7CgoJCWlmICggZXZlbnQgJiYgZXZlbnQudHlwZSA9PT0gImtleWRvd24iICkgewoJCQl0aGlzLl9jbG9zZSgpOwoJCX0gZWxzZSB7CgkJCXRoaXMudGltZXIgPSB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJCXRoaXMuX2Nsb3NlKCk7CgkJCX0sIHRoaXMuZGVsYXkgKTsKCQl9CgoJCW5lc3RlZCA9IGl0ZW0uY2hpbGRyZW4oICIudWktbWVudSIgKTsKCQlpZiAoIG5lc3RlZC5sZW5ndGggJiYgZXZlbnQgJiYgKCAvXm1vdXNlLy50ZXN0KCBldmVudC50eXBlICkgKSApIHsKCQkJdGhpcy5fc3RhcnRPcGVuaW5nKG5lc3RlZCk7CgkJfQoJCXRoaXMuYWN0aXZlTWVudSA9IGl0ZW0ucGFyZW50KCk7CgoJCXRoaXMuX3RyaWdnZXIoICJmb2N1cyIsIGV2ZW50LCB7IGl0ZW06IGl0ZW0gfSApOwoJfSwKCglfc2Nyb2xsSW50b1ZpZXc6IGZ1bmN0aW9uKCBpdGVtICkgewoJCXZhciBib3JkZXJUb3AsIHBhZGRpbmdUb3AsIG9mZnNldCwgc2Nyb2xsLCBlbGVtZW50SGVpZ2h0LCBpdGVtSGVpZ2h0OwoJCWlmICggdGhpcy5faGFzU2Nyb2xsKCkgKSB7CgkJCWJvcmRlclRvcCA9IHBhcnNlRmxvYXQoICQuY3NzKCB0aGlzLmFjdGl2ZU1lbnVbMF0sICJib3JkZXJUb3BXaWR0aCIgKSApIHx8IDA7CgkJCXBhZGRpbmdUb3AgPSBwYXJzZUZsb2F0KCAkLmNzcyggdGhpcy5hY3RpdmVNZW51WzBdLCAicGFkZGluZ1RvcCIgKSApIHx8IDA7CgkJCW9mZnNldCA9IGl0ZW0ub2Zmc2V0KCkudG9wIC0gdGhpcy5hY3RpdmVNZW51Lm9mZnNldCgpLnRvcCAtIGJvcmRlclRvcCAtIHBhZGRpbmdUb3A7CgkJCXNjcm9sbCA9IHRoaXMuYWN0aXZlTWVudS5zY3JvbGxUb3AoKTsKCQkJZWxlbWVudEhlaWdodCA9IHRoaXMuYWN0aXZlTWVudS5oZWlnaHQoKTsKCQkJaXRlbUhlaWdodCA9IGl0ZW0uaGVpZ2h0KCk7CgoJCQlpZiAoIG9mZnNldCA8IDAgKSB7CgkJCQl0aGlzLmFjdGl2ZU1lbnUuc2Nyb2xsVG9wKCBzY3JvbGwgKyBvZmZzZXQgKTsKCQkJfSBlbHNlIGlmICggb2Zmc2V0ICsgaXRlbUhlaWdodCA+IGVsZW1lbnRIZWlnaHQgKSB7CgkJCQl0aGlzLmFjdGl2ZU1lbnUuc2Nyb2xsVG9wKCBzY3JvbGwgKyBvZmZzZXQgLSBlbGVtZW50SGVpZ2h0ICsgaXRlbUhlaWdodCApOwoJCQl9CgkJfQoJfSwKCglibHVyOiBmdW5jdGlvbiggZXZlbnQsIGZyb21Gb2N1cyApIHsKCQlpZiAoICFmcm9tRm9jdXMgKSB7CgkJCWNsZWFyVGltZW91dCggdGhpcy50aW1lciApOwoJCX0KCgkJaWYgKCAhdGhpcy5hY3RpdmUgKSB7CgkJCXJldHVybjsKCQl9CgoJCXRoaXMuYWN0aXZlLmNoaWxkcmVuKCAiYSIgKS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWZvY3VzIiApOwoJCXRoaXMuYWN0aXZlID0gbnVsbDsKCgkJdGhpcy5fdHJpZ2dlciggImJsdXIiLCBldmVudCwgeyBpdGVtOiB0aGlzLmFjdGl2ZSB9ICk7Cgl9LAoKCV9zdGFydE9wZW5pbmc6IGZ1bmN0aW9uKCBzdWJtZW51ICkgewoJCWNsZWFyVGltZW91dCggdGhpcy50aW1lciApOwoKCQkvLyBEb24ndCBvcGVuIGlmIGFscmVhZHkgb3BlbiBmaXhlcyBhIEZpcmVmb3ggYnVnIHRoYXQgY2F1c2VkIGEgLjUgcGl4ZWwKCQkvLyBzaGlmdCBpbiB0aGUgc3VibWVudSBwb3NpdGlvbiB3aGVuIG1vdXNpbmcgb3ZlciB0aGUgY2FyYXQgaWNvbgoJCWlmICggc3VibWVudS5hdHRyKCAiYXJpYS1oaWRkZW4iICkgIT09ICJ0cnVlIiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy50aW1lciA9IHRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQl0aGlzLl9jbG9zZSgpOwoJCQl0aGlzLl9vcGVuKCBzdWJtZW51ICk7CgkJfSwgdGhpcy5kZWxheSApOwoJfSwKCglfb3BlbjogZnVuY3Rpb24oIHN1Ym1lbnUgKSB7CgkJdmFyIHBvc2l0aW9uID0gJC5leHRlbmQoewoJCQlvZjogdGhpcy5hY3RpdmUKCQl9LCB0aGlzLm9wdGlvbnMucG9zaXRpb24gKTsKCgkJY2xlYXJUaW1lb3V0KCB0aGlzLnRpbWVyICk7CgkJdGhpcy5lbGVtZW50LmZpbmQoICIudWktbWVudSIgKS5ub3QoIHN1Ym1lbnUucGFyZW50cyggIi51aS1tZW51IiApICkKCQkJLmhpZGUoKQoJCQkuYXR0ciggImFyaWEtaGlkZGVuIiwgInRydWUiICk7CgoJCXN1Ym1lbnUKCQkJLnNob3coKQoJCQkucmVtb3ZlQXR0ciggImFyaWEtaGlkZGVuIiApCgkJCS5hdHRyKCAiYXJpYS1leHBhbmRlZCIsICJ0cnVlIiApCgkJCS5wb3NpdGlvbiggcG9zaXRpb24gKTsKCX0sCgoJY29sbGFwc2VBbGw6IGZ1bmN0aW9uKCBldmVudCwgYWxsICkgewoJCWNsZWFyVGltZW91dCggdGhpcy50aW1lciApOwoJCXRoaXMudGltZXIgPSB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJLy8gSWYgd2Ugd2VyZSBwYXNzZWQgYW4gZXZlbnQsIGxvb2sgZm9yIHRoZSBzdWJtZW51IHRoYXQgY29udGFpbnMgdGhlIGV2ZW50CgkJCXZhciBjdXJyZW50TWVudSA9IGFsbCA/IHRoaXMuZWxlbWVudCA6CgkJCQkkKCBldmVudCAmJiBldmVudC50YXJnZXQgKS5jbG9zZXN0KCB0aGlzLmVsZW1lbnQuZmluZCggIi51aS1tZW51IiApICk7CgoJCQkvLyBJZiB3ZSBmb3VuZCBubyB2YWxpZCBzdWJtZW51IGFuY2VzdG9yLCB1c2UgdGhlIG1haW4gbWVudSB0byBjbG9zZSBhbGwgc3ViIG1lbnVzIGFueXdheQoJCQlpZiAoICFjdXJyZW50TWVudS5sZW5ndGggKSB7CgkJCQljdXJyZW50TWVudSA9IHRoaXMuZWxlbWVudDsKCQkJfQoKCQkJdGhpcy5fY2xvc2UoIGN1cnJlbnRNZW51ICk7CgoJCQl0aGlzLmJsdXIoIGV2ZW50ICk7CgkJCXRoaXMuYWN0aXZlTWVudSA9IGN1cnJlbnRNZW51OwoJCX0sIHRoaXMuZGVsYXkgKTsKCX0sCgoJLy8gV2l0aCBubyBhcmd1bWVudHMsIGNsb3NlcyB0aGUgY3VycmVudGx5IGFjdGl2ZSBtZW51IC0gaWYgbm90aGluZyBpcyBhY3RpdmUKCS8vIGl0IGNsb3NlcyBhbGwgbWVudXMuICBJZiBwYXNzZWQgYW4gYXJndW1lbnQsIGl0IHdpbGwgc2VhcmNoIGZvciBtZW51cyBCRUxPVwoJX2Nsb3NlOiBmdW5jdGlvbiggc3RhcnRNZW51ICkgewoJCWlmICggIXN0YXJ0TWVudSApIHsKCQkJc3RhcnRNZW51ID0gdGhpcy5hY3RpdmUgPyB0aGlzLmFjdGl2ZS5wYXJlbnQoKSA6IHRoaXMuZWxlbWVudDsKCQl9CgoJCXN0YXJ0TWVudQoJCQkuZmluZCggIi51aS1tZW51IiApCgkJCQkuaGlkZSgpCgkJCQkuYXR0ciggImFyaWEtaGlkZGVuIiwgInRydWUiICkKCQkJCS5hdHRyKCAiYXJpYS1leHBhbmRlZCIsICJmYWxzZSIgKQoJCQkuZW5kKCkKCQkJLmZpbmQoICJhLnVpLXN0YXRlLWFjdGl2ZSIgKQoJCQkJLnJlbW92ZUNsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApOwoJfSwKCgljb2xsYXBzZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCXZhciBuZXdJdGVtID0gdGhpcy5hY3RpdmUgJiYKCQkJdGhpcy5hY3RpdmUucGFyZW50KCkuY2xvc2VzdCggIi51aS1tZW51LWl0ZW0iLCB0aGlzLmVsZW1lbnQgKTsKCQlpZiAoIG5ld0l0ZW0gJiYgbmV3SXRlbS5sZW5ndGggKSB7CgkJCXRoaXMuX2Nsb3NlKCk7CgkJCXRoaXMuZm9jdXMoIGV2ZW50LCBuZXdJdGVtICk7CgkJfQoJfSwKCglleHBhbmQ6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgbmV3SXRlbSA9IHRoaXMuYWN0aXZlICYmCgkJCXRoaXMuYWN0aXZlCgkJCQkuY2hpbGRyZW4oICIudWktbWVudSAiICkKCQkJCS5jaGlsZHJlbiggIi51aS1tZW51LWl0ZW0iICkKCQkJCS5maXJzdCgpOwoKCQlpZiAoIG5ld0l0ZW0gJiYgbmV3SXRlbS5sZW5ndGggKSB7CgkJCXRoaXMuX29wZW4oIG5ld0l0ZW0ucGFyZW50KCkgKTsKCgkJCS8vIERlbGF5IHNvIEZpcmVmb3ggd2lsbCBub3QgaGlkZSBhY3RpdmVkZXNjZW5kYW50IGNoYW5nZSBpbiBleHBhbmRpbmcgc3VibWVudSBmcm9tIEFUCgkJCXRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQkJdGhpcy5mb2N1cyggZXZlbnQsIG5ld0l0ZW0gKTsKCQkJfSk7CgkJfQoJfSwKCgluZXh0OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJdGhpcy5fbW92ZSggIm5leHQiLCAiZmlyc3QiLCBldmVudCApOwoJfSwKCglwcmV2aW91czogZnVuY3Rpb24oIGV2ZW50ICkgewoJCXRoaXMuX21vdmUoICJwcmV2IiwgImxhc3QiLCBldmVudCApOwoJfSwKCglpc0ZpcnN0SXRlbTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuYWN0aXZlICYmICF0aGlzLmFjdGl2ZS5wcmV2QWxsKCAiLnVpLW1lbnUtaXRlbSIgKS5sZW5ndGg7Cgl9LAoKCWlzTGFzdEl0ZW06IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmFjdGl2ZSAmJiAhdGhpcy5hY3RpdmUubmV4dEFsbCggIi51aS1tZW51LWl0ZW0iICkubGVuZ3RoOwoJfSwKCglfbW92ZTogZnVuY3Rpb24oIGRpcmVjdGlvbiwgZmlsdGVyLCBldmVudCApIHsKCQl2YXIgbmV4dDsKCQlpZiAoIHRoaXMuYWN0aXZlICkgewoJCQlpZiAoIGRpcmVjdGlvbiA9PT0gImZpcnN0IiB8fCBkaXJlY3Rpb24gPT09ICJsYXN0IiApIHsKCQkJCW5leHQgPSB0aGlzLmFjdGl2ZQoJCQkJCVsgZGlyZWN0aW9uID09PSAiZmlyc3QiID8gInByZXZBbGwiIDogIm5leHRBbGwiIF0oICIudWktbWVudS1pdGVtIiApCgkJCQkJLmVxKCAtMSApOwoJCQl9IGVsc2UgewoJCQkJbmV4dCA9IHRoaXMuYWN0aXZlCgkJCQkJWyBkaXJlY3Rpb24gKyAiQWxsIiBdKCAiLnVpLW1lbnUtaXRlbSIgKQoJCQkJCS5lcSggMCApOwoJCQl9CgkJfQoJCWlmICggIW5leHQgfHwgIW5leHQubGVuZ3RoIHx8ICF0aGlzLmFjdGl2ZSApIHsKCQkJbmV4dCA9IHRoaXMuYWN0aXZlTWVudS5jaGlsZHJlbiggIi51aS1tZW51LWl0ZW0iIClbIGZpbHRlciBdKCk7CgkJfQoKCQl0aGlzLmZvY3VzKCBldmVudCwgbmV4dCApOwoJfSwKCgluZXh0UGFnZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCXZhciBpdGVtLCBiYXNlLCBoZWlnaHQ7CgoJCWlmICggIXRoaXMuYWN0aXZlICkgewoJCQl0aGlzLm5leHQoIGV2ZW50ICk7CgkJCXJldHVybjsKCQl9CgkJaWYgKCB0aGlzLmlzTGFzdEl0ZW0oKSApIHsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoIHRoaXMuX2hhc1Njcm9sbCgpICkgewoJCQliYXNlID0gdGhpcy5hY3RpdmUub2Zmc2V0KCkudG9wOwoJCQloZWlnaHQgPSB0aGlzLmVsZW1lbnQuaGVpZ2h0KCk7CgkJCXRoaXMuYWN0aXZlLm5leHRBbGwoICIudWktbWVudS1pdGVtIiApLmVhY2goZnVuY3Rpb24oKSB7CgkJCQlpdGVtID0gJCggdGhpcyApOwoJCQkJcmV0dXJuIGl0ZW0ub2Zmc2V0KCkudG9wIC0gYmFzZSAtIGhlaWdodCA8IDA7CgkJCX0pOwoKCQkJdGhpcy5mb2N1cyggZXZlbnQsIGl0ZW0gKTsKCQl9IGVsc2UgewoJCQl0aGlzLmZvY3VzKCBldmVudCwgdGhpcy5hY3RpdmVNZW51LmNoaWxkcmVuKCAiLnVpLW1lbnUtaXRlbSIgKQoJCQkJWyAhdGhpcy5hY3RpdmUgPyAiZmlyc3QiIDogImxhc3QiIF0oKSApOwoJCX0KCX0sCgoJcHJldmlvdXNQYWdlOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJdmFyIGl0ZW0sIGJhc2UsIGhlaWdodDsKCQlpZiAoICF0aGlzLmFjdGl2ZSApIHsKCQkJdGhpcy5uZXh0KCBldmVudCApOwoJCQlyZXR1cm47CgkJfQoJCWlmICggdGhpcy5pc0ZpcnN0SXRlbSgpICkgewoJCQlyZXR1cm47CgkJfQoJCWlmICggdGhpcy5faGFzU2Nyb2xsKCkgKSB7CgkJCWJhc2UgPSB0aGlzLmFjdGl2ZS5vZmZzZXQoKS50b3A7CgkJCWhlaWdodCA9IHRoaXMuZWxlbWVudC5oZWlnaHQoKTsKCQkJdGhpcy5hY3RpdmUucHJldkFsbCggIi51aS1tZW51LWl0ZW0iICkuZWFjaChmdW5jdGlvbigpIHsKCQkJCWl0ZW0gPSAkKCB0aGlzICk7CgkJCQlyZXR1cm4gaXRlbS5vZmZzZXQoKS50b3AgLSBiYXNlICsgaGVpZ2h0ID4gMDsKCQkJfSk7CgoJCQl0aGlzLmZvY3VzKCBldmVudCwgaXRlbSApOwoJCX0gZWxzZSB7CgkJCXRoaXMuZm9jdXMoIGV2ZW50LCB0aGlzLmFjdGl2ZU1lbnUuY2hpbGRyZW4oICIudWktbWVudS1pdGVtIiApLmZpcnN0KCkgKTsKCQl9Cgl9LAoKCV9oYXNTY3JvbGw6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSA8IHRoaXMuZWxlbWVudC5wcm9wKCAic2Nyb2xsSGVpZ2h0IiApOwoJfSwKCglzZWxlY3Q6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkvLyBUT0RPOiBJdCBzaG91bGQgbmV2ZXIgYmUgcG9zc2libGUgdG8gbm90IGhhdmUgYW4gYWN0aXZlIGl0ZW0gYXQgdGhpcwoJCS8vIHBvaW50LCBidXQgdGhlIHRlc3RzIGRvbid0IHRyaWdnZXIgbW91c2VlbnRlciBiZWZvcmUgY2xpY2suCgkJdGhpcy5hY3RpdmUgPSB0aGlzLmFjdGl2ZSB8fCAkKCBldmVudC50YXJnZXQgKS5jbG9zZXN0KCAiLnVpLW1lbnUtaXRlbSIgKTsKCQl2YXIgdWkgPSB7IGl0ZW06IHRoaXMuYWN0aXZlIH07CgkJaWYgKCAhdGhpcy5hY3RpdmUuaGFzKCAiLnVpLW1lbnUiICkubGVuZ3RoICkgewoJCQl0aGlzLmNvbGxhcHNlQWxsKCBldmVudCwgdHJ1ZSApOwoJCX0KCQl0aGlzLl90cmlnZ2VyKCAic2VsZWN0IiwgZXZlbnQsIHVpICk7Cgl9Cn0pOwoKfSggalF1ZXJ5ICkpOwoKKGZ1bmN0aW9uKCAkLCB1bmRlZmluZWQgKSB7CgokLnVpID0gJC51aSB8fCB7fTsKCnZhciBjYWNoZWRTY3JvbGxiYXJXaWR0aCwKCW1heCA9IE1hdGgubWF4LAoJYWJzID0gTWF0aC5hYnMsCglyb3VuZCA9IE1hdGgucm91bmQsCglyaG9yaXpvbnRhbCA9IC9sZWZ0fGNlbnRlcnxyaWdodC8sCglydmVydGljYWwgPSAvdG9wfGNlbnRlcnxib3R0b20vLAoJcm9mZnNldCA9IC9bXCtcLV1cZCsoXC5bXGRdKyk/JT8vLAoJcnBvc2l0aW9uID0gL15cdysvLAoJcnBlcmNlbnQgPSAvJSQvLAoJX3Bvc2l0aW9uID0gJC5mbi5wb3NpdGlvbjsKCmZ1bmN0aW9uIGdldE9mZnNldHMoIG9mZnNldHMsIHdpZHRoLCBoZWlnaHQgKSB7CglyZXR1cm4gWwoJCXBhcnNlRmxvYXQoIG9mZnNldHNbIDAgXSApICogKCBycGVyY2VudC50ZXN0KCBvZmZzZXRzWyAwIF0gKSA/IHdpZHRoIC8gMTAwIDogMSApLAoJCXBhcnNlRmxvYXQoIG9mZnNldHNbIDEgXSApICogKCBycGVyY2VudC50ZXN0KCBvZmZzZXRzWyAxIF0gKSA/IGhlaWdodCAvIDEwMCA6IDEgKQoJXTsKfQoKZnVuY3Rpb24gcGFyc2VDc3MoIGVsZW1lbnQsIHByb3BlcnR5ICkgewoJcmV0dXJuIHBhcnNlSW50KCAkLmNzcyggZWxlbWVudCwgcHJvcGVydHkgKSwgMTAgKSB8fCAwOwp9CgpmdW5jdGlvbiBnZXREaW1lbnNpb25zKCBlbGVtICkgewoJdmFyIHJhdyA9IGVsZW1bMF07CglpZiAoIHJhdy5ub2RlVHlwZSA9PT0gOSApIHsKCQlyZXR1cm4gewoJCQl3aWR0aDogZWxlbS53aWR0aCgpLAoJCQloZWlnaHQ6IGVsZW0uaGVpZ2h0KCksCgkJCW9mZnNldDogeyB0b3A6IDAsIGxlZnQ6IDAgfQoJCX07Cgl9CglpZiAoICQuaXNXaW5kb3coIHJhdyApICkgewoJCXJldHVybiB7CgkJCXdpZHRoOiBlbGVtLndpZHRoKCksCgkJCWhlaWdodDogZWxlbS5oZWlnaHQoKSwKCQkJb2Zmc2V0OiB7IHRvcDogZWxlbS5zY3JvbGxUb3AoKSwgbGVmdDogZWxlbS5zY3JvbGxMZWZ0KCkgfQoJCX07Cgl9CglpZiAoIHJhdy5wcmV2ZW50RGVmYXVsdCApIHsKCQlyZXR1cm4gewoJCQl3aWR0aDogMCwKCQkJaGVpZ2h0OiAwLAoJCQlvZmZzZXQ6IHsgdG9wOiByYXcucGFnZVksIGxlZnQ6IHJhdy5wYWdlWCB9CgkJfTsKCX0KCXJldHVybiB7CgkJd2lkdGg6IGVsZW0ub3V0ZXJXaWR0aCgpLAoJCWhlaWdodDogZWxlbS5vdXRlckhlaWdodCgpLAoJCW9mZnNldDogZWxlbS5vZmZzZXQoKQoJfTsKfQoKJC5wb3NpdGlvbiA9IHsKCXNjcm9sbGJhcldpZHRoOiBmdW5jdGlvbigpIHsKCQlpZiAoIGNhY2hlZFNjcm9sbGJhcldpZHRoICE9PSB1bmRlZmluZWQgKSB7CgkJCXJldHVybiBjYWNoZWRTY3JvbGxiYXJXaWR0aDsKCQl9CgkJdmFyIHcxLCB3MiwKCQkJZGl2ID0gJCggIjxkaXYgc3R5bGU9J2Rpc3BsYXk6YmxvY2s7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6NTBweDtoZWlnaHQ6NTBweDtvdmVyZmxvdzpoaWRkZW47Jz48ZGl2IHN0eWxlPSdoZWlnaHQ6MTAwcHg7d2lkdGg6YXV0bzsnPjwvZGl2PjwvZGl2PiIgKSwKCQkJaW5uZXJEaXYgPSBkaXYuY2hpbGRyZW4oKVswXTsKCgkJJCggImJvZHkiICkuYXBwZW5kKCBkaXYgKTsKCQl3MSA9IGlubmVyRGl2Lm9mZnNldFdpZHRoOwoJCWRpdi5jc3MoICJvdmVyZmxvdyIsICJzY3JvbGwiICk7CgoJCXcyID0gaW5uZXJEaXYub2Zmc2V0V2lkdGg7CgoJCWlmICggdzEgPT09IHcyICkgewoJCQl3MiA9IGRpdlswXS5jbGllbnRXaWR0aDsKCQl9CgoJCWRpdi5yZW1vdmUoKTsKCgkJcmV0dXJuIChjYWNoZWRTY3JvbGxiYXJXaWR0aCA9IHcxIC0gdzIpOwoJfSwKCWdldFNjcm9sbEluZm86IGZ1bmN0aW9uKCB3aXRoaW4gKSB7CgkJdmFyIG92ZXJmbG93WCA9IHdpdGhpbi5pc1dpbmRvdyB8fCB3aXRoaW4uaXNEb2N1bWVudCA/ICIiIDoKCQkJCXdpdGhpbi5lbGVtZW50LmNzcyggIm92ZXJmbG93LXgiICksCgkJCW92ZXJmbG93WSA9IHdpdGhpbi5pc1dpbmRvdyB8fCB3aXRoaW4uaXNEb2N1bWVudCA/ICIiIDoKCQkJCXdpdGhpbi5lbGVtZW50LmNzcyggIm92ZXJmbG93LXkiICksCgkJCWhhc092ZXJmbG93WCA9IG92ZXJmbG93WCA9PT0gInNjcm9sbCIgfHwKCQkJCSggb3ZlcmZsb3dYID09PSAiYXV0byIgJiYgd2l0aGluLndpZHRoIDwgd2l0aGluLmVsZW1lbnRbMF0uc2Nyb2xsV2lkdGggKSwKCQkJaGFzT3ZlcmZsb3dZID0gb3ZlcmZsb3dZID09PSAic2Nyb2xsIiB8fAoJCQkJKCBvdmVyZmxvd1kgPT09ICJhdXRvIiAmJiB3aXRoaW4uaGVpZ2h0IDwgd2l0aGluLmVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0ICk7CgkJcmV0dXJuIHsKCQkJd2lkdGg6IGhhc092ZXJmbG93WSA/ICQucG9zaXRpb24uc2Nyb2xsYmFyV2lkdGgoKSA6IDAsCgkJCWhlaWdodDogaGFzT3ZlcmZsb3dYID8gJC5wb3NpdGlvbi5zY3JvbGxiYXJXaWR0aCgpIDogMAoJCX07Cgl9LAoJZ2V0V2l0aGluSW5mbzogZnVuY3Rpb24oIGVsZW1lbnQgKSB7CgkJdmFyIHdpdGhpbkVsZW1lbnQgPSAkKCBlbGVtZW50IHx8IHdpbmRvdyApLAoJCQlpc1dpbmRvdyA9ICQuaXNXaW5kb3coIHdpdGhpbkVsZW1lbnRbMF0gKSwKCQkJaXNEb2N1bWVudCA9ICEhd2l0aGluRWxlbWVudFsgMCBdICYmIHdpdGhpbkVsZW1lbnRbIDAgXS5ub2RlVHlwZSA9PT0gOTsKCQlyZXR1cm4gewoJCQllbGVtZW50OiB3aXRoaW5FbGVtZW50LAoJCQlpc1dpbmRvdzogaXNXaW5kb3csCgkJCWlzRG9jdW1lbnQ6IGlzRG9jdW1lbnQsCgkJCW9mZnNldDogd2l0aGluRWxlbWVudC5vZmZzZXQoKSB8fCB7IGxlZnQ6IDAsIHRvcDogMCB9LAoJCQlzY3JvbGxMZWZ0OiB3aXRoaW5FbGVtZW50LnNjcm9sbExlZnQoKSwKCQkJc2Nyb2xsVG9wOiB3aXRoaW5FbGVtZW50LnNjcm9sbFRvcCgpLAoJCQl3aWR0aDogaXNXaW5kb3cgPyB3aXRoaW5FbGVtZW50LndpZHRoKCkgOiB3aXRoaW5FbGVtZW50Lm91dGVyV2lkdGgoKSwKCQkJaGVpZ2h0OiBpc1dpbmRvdyA/IHdpdGhpbkVsZW1lbnQuaGVpZ2h0KCkgOiB3aXRoaW5FbGVtZW50Lm91dGVySGVpZ2h0KCkKCQl9OwoJfQp9OwoKJC5mbi5wb3NpdGlvbiA9IGZ1bmN0aW9uKCBvcHRpb25zICkgewoJaWYgKCAhb3B0aW9ucyB8fCAhb3B0aW9ucy5vZiApIHsKCQlyZXR1cm4gX3Bvc2l0aW9uLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCX0KCgkvLyBtYWtlIGEgY29weSwgd2UgZG9uJ3Qgd2FudCB0byBtb2RpZnkgYXJndW1lbnRzCglvcHRpb25zID0gJC5leHRlbmQoIHt9LCBvcHRpb25zICk7CgoJdmFyIGF0T2Zmc2V0LCB0YXJnZXRXaWR0aCwgdGFyZ2V0SGVpZ2h0LCB0YXJnZXRPZmZzZXQsIGJhc2VQb3NpdGlvbiwgZGltZW5zaW9ucywKCQl0YXJnZXQgPSAkKCBvcHRpb25zLm9mICksCgkJd2l0aGluID0gJC5wb3NpdGlvbi5nZXRXaXRoaW5JbmZvKCBvcHRpb25zLndpdGhpbiApLAoJCXNjcm9sbEluZm8gPSAkLnBvc2l0aW9uLmdldFNjcm9sbEluZm8oIHdpdGhpbiApLAoJCWNvbGxpc2lvbiA9ICggb3B0aW9ucy5jb2xsaXNpb24gfHwgImZsaXAiICkuc3BsaXQoICIgIiApLAoJCW9mZnNldHMgPSB7fTsKCglkaW1lbnNpb25zID0gZ2V0RGltZW5zaW9ucyggdGFyZ2V0ICk7CglpZiAoIHRhcmdldFswXS5wcmV2ZW50RGVmYXVsdCApIHsKCQkvLyBmb3JjZSBsZWZ0IHRvcCB0byBhbGxvdyBmbGlwcGluZwoJCW9wdGlvbnMuYXQgPSAibGVmdCB0b3AiOwoJfQoJdGFyZ2V0V2lkdGggPSBkaW1lbnNpb25zLndpZHRoOwoJdGFyZ2V0SGVpZ2h0ID0gZGltZW5zaW9ucy5oZWlnaHQ7Cgl0YXJnZXRPZmZzZXQgPSBkaW1lbnNpb25zLm9mZnNldDsKCS8vIGNsb25lIHRvIHJldXNlIG9yaWdpbmFsIHRhcmdldE9mZnNldCBsYXRlcgoJYmFzZVBvc2l0aW9uID0gJC5leHRlbmQoIHt9LCB0YXJnZXRPZmZzZXQgKTsKCgkvLyBmb3JjZSBteSBhbmQgYXQgdG8gaGF2ZSB2YWxpZCBob3Jpem9udGFsIGFuZCB2ZXJ0aWNhbCBwb3NpdGlvbnMKCS8vIGlmIGEgdmFsdWUgaXMgbWlzc2luZyBvciBpbnZhbGlkLCBpdCB3aWxsIGJlIGNvbnZlcnRlZCB0byBjZW50ZXIKCSQuZWFjaCggWyAibXkiLCAiYXQiIF0sIGZ1bmN0aW9uKCkgewoJCXZhciBwb3MgPSAoIG9wdGlvbnNbIHRoaXMgXSB8fCAiIiApLnNwbGl0KCAiICIgKSwKCQkJaG9yaXpvbnRhbE9mZnNldCwKCQkJdmVydGljYWxPZmZzZXQ7CgoJCWlmICggcG9zLmxlbmd0aCA9PT0gMSkgewoJCQlwb3MgPSByaG9yaXpvbnRhbC50ZXN0KCBwb3NbIDAgXSApID8KCQkJCXBvcy5jb25jYXQoIFsgImNlbnRlciIgXSApIDoKCQkJCXJ2ZXJ0aWNhbC50ZXN0KCBwb3NbIDAgXSApID8KCQkJCQlbICJjZW50ZXIiIF0uY29uY2F0KCBwb3MgKSA6CgkJCQkJWyAiY2VudGVyIiwgImNlbnRlciIgXTsKCQl9CgkJcG9zWyAwIF0gPSByaG9yaXpvbnRhbC50ZXN0KCBwb3NbIDAgXSApID8gcG9zWyAwIF0gOiAiY2VudGVyIjsKCQlwb3NbIDEgXSA9IHJ2ZXJ0aWNhbC50ZXN0KCBwb3NbIDEgXSApID8gcG9zWyAxIF0gOiAiY2VudGVyIjsKCgkJLy8gY2FsY3VsYXRlIG9mZnNldHMKCQlob3Jpem9udGFsT2Zmc2V0ID0gcm9mZnNldC5leGVjKCBwb3NbIDAgXSApOwoJCXZlcnRpY2FsT2Zmc2V0ID0gcm9mZnNldC5leGVjKCBwb3NbIDEgXSApOwoJCW9mZnNldHNbIHRoaXMgXSA9IFsKCQkJaG9yaXpvbnRhbE9mZnNldCA/IGhvcml6b250YWxPZmZzZXRbIDAgXSA6IDAsCgkJCXZlcnRpY2FsT2Zmc2V0ID8gdmVydGljYWxPZmZzZXRbIDAgXSA6IDAKCQldOwoKCQkvLyByZWR1Y2UgdG8ganVzdCB0aGUgcG9zaXRpb25zIHdpdGhvdXQgdGhlIG9mZnNldHMKCQlvcHRpb25zWyB0aGlzIF0gPSBbCgkJCXJwb3NpdGlvbi5leGVjKCBwb3NbIDAgXSApWyAwIF0sCgkJCXJwb3NpdGlvbi5leGVjKCBwb3NbIDEgXSApWyAwIF0KCQldOwoJfSk7CgoJLy8gbm9ybWFsaXplIGNvbGxpc2lvbiBvcHRpb24KCWlmICggY29sbGlzaW9uLmxlbmd0aCA9PT0gMSApIHsKCQljb2xsaXNpb25bIDEgXSA9IGNvbGxpc2lvblsgMCBdOwoJfQoKCWlmICggb3B0aW9ucy5hdFsgMCBdID09PSAicmlnaHQiICkgewoJCWJhc2VQb3NpdGlvbi5sZWZ0ICs9IHRhcmdldFdpZHRoOwoJfSBlbHNlIGlmICggb3B0aW9ucy5hdFsgMCBdID09PSAiY2VudGVyIiApIHsKCQliYXNlUG9zaXRpb24ubGVmdCArPSB0YXJnZXRXaWR0aCAvIDI7Cgl9CgoJaWYgKCBvcHRpb25zLmF0WyAxIF0gPT09ICJib3R0b20iICkgewoJCWJhc2VQb3NpdGlvbi50b3AgKz0gdGFyZ2V0SGVpZ2h0OwoJfSBlbHNlIGlmICggb3B0aW9ucy5hdFsgMSBdID09PSAiY2VudGVyIiApIHsKCQliYXNlUG9zaXRpb24udG9wICs9IHRhcmdldEhlaWdodCAvIDI7Cgl9CgoJYXRPZmZzZXQgPSBnZXRPZmZzZXRzKCBvZmZzZXRzLmF0LCB0YXJnZXRXaWR0aCwgdGFyZ2V0SGVpZ2h0ICk7CgliYXNlUG9zaXRpb24ubGVmdCArPSBhdE9mZnNldFsgMCBdOwoJYmFzZVBvc2l0aW9uLnRvcCArPSBhdE9mZnNldFsgMSBdOwoKCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJdmFyIGNvbGxpc2lvblBvc2l0aW9uLCB1c2luZywKCQkJZWxlbSA9ICQoIHRoaXMgKSwKCQkJZWxlbVdpZHRoID0gZWxlbS5vdXRlcldpZHRoKCksCgkJCWVsZW1IZWlnaHQgPSBlbGVtLm91dGVySGVpZ2h0KCksCgkJCW1hcmdpbkxlZnQgPSBwYXJzZUNzcyggdGhpcywgIm1hcmdpbkxlZnQiICksCgkJCW1hcmdpblRvcCA9IHBhcnNlQ3NzKCB0aGlzLCAibWFyZ2luVG9wIiApLAoJCQljb2xsaXNpb25XaWR0aCA9IGVsZW1XaWR0aCArIG1hcmdpbkxlZnQgKyBwYXJzZUNzcyggdGhpcywgIm1hcmdpblJpZ2h0IiApICsgc2Nyb2xsSW5mby53aWR0aCwKCQkJY29sbGlzaW9uSGVpZ2h0ID0gZWxlbUhlaWdodCArIG1hcmdpblRvcCArIHBhcnNlQ3NzKCB0aGlzLCAibWFyZ2luQm90dG9tIiApICsgc2Nyb2xsSW5mby5oZWlnaHQsCgkJCXBvc2l0aW9uID0gJC5leHRlbmQoIHt9LCBiYXNlUG9zaXRpb24gKSwKCQkJbXlPZmZzZXQgPSBnZXRPZmZzZXRzKCBvZmZzZXRzLm15LCBlbGVtLm91dGVyV2lkdGgoKSwgZWxlbS5vdXRlckhlaWdodCgpICk7CgoJCWlmICggb3B0aW9ucy5teVsgMCBdID09PSAicmlnaHQiICkgewoJCQlwb3NpdGlvbi5sZWZ0IC09IGVsZW1XaWR0aDsKCQl9IGVsc2UgaWYgKCBvcHRpb25zLm15WyAwIF0gPT09ICJjZW50ZXIiICkgewoJCQlwb3NpdGlvbi5sZWZ0IC09IGVsZW1XaWR0aCAvIDI7CgkJfQoKCQlpZiAoIG9wdGlvbnMubXlbIDEgXSA9PT0gImJvdHRvbSIgKSB7CgkJCXBvc2l0aW9uLnRvcCAtPSBlbGVtSGVpZ2h0OwoJCX0gZWxzZSBpZiAoIG9wdGlvbnMubXlbIDEgXSA9PT0gImNlbnRlciIgKSB7CgkJCXBvc2l0aW9uLnRvcCAtPSBlbGVtSGVpZ2h0IC8gMjsKCQl9CgoJCXBvc2l0aW9uLmxlZnQgKz0gbXlPZmZzZXRbIDAgXTsKCQlwb3NpdGlvbi50b3AgKz0gbXlPZmZzZXRbIDEgXTsKCgkJLy8gaWYgdGhlIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IGZyYWN0aW9ucywgdGhlbiByb3VuZCBmb3IgY29uc2lzdGVudCByZXN1bHRzCgkJaWYgKCAhJC5zdXBwb3J0Lm9mZnNldEZyYWN0aW9ucyApIHsKCQkJcG9zaXRpb24ubGVmdCA9IHJvdW5kKCBwb3NpdGlvbi5sZWZ0ICk7CgkJCXBvc2l0aW9uLnRvcCA9IHJvdW5kKCBwb3NpdGlvbi50b3AgKTsKCQl9CgoJCWNvbGxpc2lvblBvc2l0aW9uID0gewoJCQltYXJnaW5MZWZ0OiBtYXJnaW5MZWZ0LAoJCQltYXJnaW5Ub3A6IG1hcmdpblRvcAoJCX07CgoJCSQuZWFjaCggWyAibGVmdCIsICJ0b3AiIF0sIGZ1bmN0aW9uKCBpLCBkaXIgKSB7CgkJCWlmICggJC51aS5wb3NpdGlvblsgY29sbGlzaW9uWyBpIF0gXSApIHsKCQkJCSQudWkucG9zaXRpb25bIGNvbGxpc2lvblsgaSBdIF1bIGRpciBdKCBwb3NpdGlvbiwgewoJCQkJCXRhcmdldFdpZHRoOiB0YXJnZXRXaWR0aCwKCQkJCQl0YXJnZXRIZWlnaHQ6IHRhcmdldEhlaWdodCwKCQkJCQllbGVtV2lkdGg6IGVsZW1XaWR0aCwKCQkJCQllbGVtSGVpZ2h0OiBlbGVtSGVpZ2h0LAoJCQkJCWNvbGxpc2lvblBvc2l0aW9uOiBjb2xsaXNpb25Qb3NpdGlvbiwKCQkJCQljb2xsaXNpb25XaWR0aDogY29sbGlzaW9uV2lkdGgsCgkJCQkJY29sbGlzaW9uSGVpZ2h0OiBjb2xsaXNpb25IZWlnaHQsCgkJCQkJb2Zmc2V0OiBbIGF0T2Zmc2V0WyAwIF0gKyBteU9mZnNldFsgMCBdLCBhdE9mZnNldCBbIDEgXSArIG15T2Zmc2V0WyAxIF0gXSwKCQkJCQlteTogb3B0aW9ucy5teSwKCQkJCQlhdDogb3B0aW9ucy5hdCwKCQkJCQl3aXRoaW46IHdpdGhpbiwKCQkJCQllbGVtIDogZWxlbQoJCQkJfSk7CgkJCX0KCQl9KTsKCgkJaWYgKCBvcHRpb25zLnVzaW5nICkgewoJCQkvLyBhZGRzIGZlZWRiYWNrIGFzIHNlY29uZCBhcmd1bWVudCB0byB1c2luZyBjYWxsYmFjaywgaWYgcHJlc2VudAoJCQl1c2luZyA9IGZ1bmN0aW9uKCBwcm9wcyApIHsKCQkJCXZhciBsZWZ0ID0gdGFyZ2V0T2Zmc2V0LmxlZnQgLSBwb3NpdGlvbi5sZWZ0LAoJCQkJCXJpZ2h0ID0gbGVmdCArIHRhcmdldFdpZHRoIC0gZWxlbVdpZHRoLAoJCQkJCXRvcCA9IHRhcmdldE9mZnNldC50b3AgLSBwb3NpdGlvbi50b3AsCgkJCQkJYm90dG9tID0gdG9wICsgdGFyZ2V0SGVpZ2h0IC0gZWxlbUhlaWdodCwKCQkJCQlmZWVkYmFjayA9IHsKCQkJCQkJdGFyZ2V0OiB7CgkJCQkJCQllbGVtZW50OiB0YXJnZXQsCgkJCQkJCQlsZWZ0OiB0YXJnZXRPZmZzZXQubGVmdCwKCQkJCQkJCXRvcDogdGFyZ2V0T2Zmc2V0LnRvcCwKCQkJCQkJCXdpZHRoOiB0YXJnZXRXaWR0aCwKCQkJCQkJCWhlaWdodDogdGFyZ2V0SGVpZ2h0CgkJCQkJCX0sCgkJCQkJCWVsZW1lbnQ6IHsKCQkJCQkJCWVsZW1lbnQ6IGVsZW0sCgkJCQkJCQlsZWZ0OiBwb3NpdGlvbi5sZWZ0LAoJCQkJCQkJdG9wOiBwb3NpdGlvbi50b3AsCgkJCQkJCQl3aWR0aDogZWxlbVdpZHRoLAoJCQkJCQkJaGVpZ2h0OiBlbGVtSGVpZ2h0CgkJCQkJCX0sCgkJCQkJCWhvcml6b250YWw6IHJpZ2h0IDwgMCA/ICJsZWZ0IiA6IGxlZnQgPiAwID8gInJpZ2h0IiA6ICJjZW50ZXIiLAoJCQkJCQl2ZXJ0aWNhbDogYm90dG9tIDwgMCA/ICJ0b3AiIDogdG9wID4gMCA/ICJib3R0b20iIDogIm1pZGRsZSIKCQkJCQl9OwoJCQkJaWYgKCB0YXJnZXRXaWR0aCA8IGVsZW1XaWR0aCAmJiBhYnMoIGxlZnQgKyByaWdodCApIDwgdGFyZ2V0V2lkdGggKSB7CgkJCQkJZmVlZGJhY2suaG9yaXpvbnRhbCA9ICJjZW50ZXIiOwoJCQkJfQoJCQkJaWYgKCB0YXJnZXRIZWlnaHQgPCBlbGVtSGVpZ2h0ICYmIGFicyggdG9wICsgYm90dG9tICkgPCB0YXJnZXRIZWlnaHQgKSB7CgkJCQkJZmVlZGJhY2sudmVydGljYWwgPSAibWlkZGxlIjsKCQkJCX0KCQkJCWlmICggbWF4KCBhYnMoIGxlZnQgKSwgYWJzKCByaWdodCApICkgPiBtYXgoIGFicyggdG9wICksIGFicyggYm90dG9tICkgKSApIHsKCQkJCQlmZWVkYmFjay5pbXBvcnRhbnQgPSAiaG9yaXpvbnRhbCI7CgkJCQl9IGVsc2UgewoJCQkJCWZlZWRiYWNrLmltcG9ydGFudCA9ICJ2ZXJ0aWNhbCI7CgkJCQl9CgkJCQlvcHRpb25zLnVzaW5nLmNhbGwoIHRoaXMsIHByb3BzLCBmZWVkYmFjayApOwoJCQl9OwoJCX0KCgkJZWxlbS5vZmZzZXQoICQuZXh0ZW5kKCBwb3NpdGlvbiwgeyB1c2luZzogdXNpbmcgfSApICk7Cgl9KTsKfTsKCiQudWkucG9zaXRpb24gPSB7CglmaXQ6IHsKCQlsZWZ0OiBmdW5jdGlvbiggcG9zaXRpb24sIGRhdGEgKSB7CgkJCXZhciB3aXRoaW4gPSBkYXRhLndpdGhpbiwKCQkJCXdpdGhpbk9mZnNldCA9IHdpdGhpbi5pc1dpbmRvdyA/IHdpdGhpbi5zY3JvbGxMZWZ0IDogd2l0aGluLm9mZnNldC5sZWZ0LAoJCQkJb3V0ZXJXaWR0aCA9IHdpdGhpbi53aWR0aCwKCQkJCWNvbGxpc2lvblBvc0xlZnQgPSBwb3NpdGlvbi5sZWZ0IC0gZGF0YS5jb2xsaXNpb25Qb3NpdGlvbi5tYXJnaW5MZWZ0LAoJCQkJb3ZlckxlZnQgPSB3aXRoaW5PZmZzZXQgLSBjb2xsaXNpb25Qb3NMZWZ0LAoJCQkJb3ZlclJpZ2h0ID0gY29sbGlzaW9uUG9zTGVmdCArIGRhdGEuY29sbGlzaW9uV2lkdGggLSBvdXRlcldpZHRoIC0gd2l0aGluT2Zmc2V0LAoJCQkJbmV3T3ZlclJpZ2h0OwoKCQkJLy8gZWxlbWVudCBpcyB3aWRlciB0aGFuIHdpdGhpbgoJCQlpZiAoIGRhdGEuY29sbGlzaW9uV2lkdGggPiBvdXRlcldpZHRoICkgewoJCQkJLy8gZWxlbWVudCBpcyBpbml0aWFsbHkgb3ZlciB0aGUgbGVmdCBzaWRlIG9mIHdpdGhpbgoJCQkJaWYgKCBvdmVyTGVmdCA+IDAgJiYgb3ZlclJpZ2h0IDw9IDAgKSB7CgkJCQkJbmV3T3ZlclJpZ2h0ID0gcG9zaXRpb24ubGVmdCArIG92ZXJMZWZ0ICsgZGF0YS5jb2xsaXNpb25XaWR0aCAtIG91dGVyV2lkdGggLSB3aXRoaW5PZmZzZXQ7CgkJCQkJcG9zaXRpb24ubGVmdCArPSBvdmVyTGVmdCAtIG5ld092ZXJSaWdodDsKCQkJCS8vIGVsZW1lbnQgaXMgaW5pdGlhbGx5IG92ZXIgcmlnaHQgc2lkZSBvZiB3aXRoaW4KCQkJCX0gZWxzZSBpZiAoIG92ZXJSaWdodCA+IDAgJiYgb3ZlckxlZnQgPD0gMCApIHsKCQkJCQlwb3NpdGlvbi5sZWZ0ID0gd2l0aGluT2Zmc2V0OwoJCQkJLy8gZWxlbWVudCBpcyBpbml0aWFsbHkgb3ZlciBib3RoIGxlZnQgYW5kIHJpZ2h0IHNpZGVzIG9mIHdpdGhpbgoJCQkJfSBlbHNlIHsKCQkJCQlpZiAoIG92ZXJMZWZ0ID4gb3ZlclJpZ2h0ICkgewoJCQkJCQlwb3NpdGlvbi5sZWZ0ID0gd2l0aGluT2Zmc2V0ICsgb3V0ZXJXaWR0aCAtIGRhdGEuY29sbGlzaW9uV2lkdGg7CgkJCQkJfSBlbHNlIHsKCQkJCQkJcG9zaXRpb24ubGVmdCA9IHdpdGhpbk9mZnNldDsKCQkJCQl9CgkJCQl9CgkJCS8vIHRvbyBmYXIgbGVmdCAtPiBhbGlnbiB3aXRoIGxlZnQgZWRnZQoJCQl9IGVsc2UgaWYgKCBvdmVyTGVmdCA+IDAgKSB7CgkJCQlwb3NpdGlvbi5sZWZ0ICs9IG92ZXJMZWZ0OwoJCQkvLyB0b28gZmFyIHJpZ2h0IC0+IGFsaWduIHdpdGggcmlnaHQgZWRnZQoJCQl9IGVsc2UgaWYgKCBvdmVyUmlnaHQgPiAwICkgewoJCQkJcG9zaXRpb24ubGVmdCAtPSBvdmVyUmlnaHQ7CgkJCS8vIGFkanVzdCBiYXNlZCBvbiBwb3NpdGlvbiBhbmQgbWFyZ2luCgkJCX0gZWxzZSB7CgkJCQlwb3NpdGlvbi5sZWZ0ID0gbWF4KCBwb3NpdGlvbi5sZWZ0IC0gY29sbGlzaW9uUG9zTGVmdCwgcG9zaXRpb24ubGVmdCApOwoJCQl9CgkJfSwKCQl0b3A6IGZ1bmN0aW9uKCBwb3NpdGlvbiwgZGF0YSApIHsKCQkJdmFyIHdpdGhpbiA9IGRhdGEud2l0aGluLAoJCQkJd2l0aGluT2Zmc2V0ID0gd2l0aGluLmlzV2luZG93ID8gd2l0aGluLnNjcm9sbFRvcCA6IHdpdGhpbi5vZmZzZXQudG9wLAoJCQkJb3V0ZXJIZWlnaHQgPSBkYXRhLndpdGhpbi5oZWlnaHQsCgkJCQljb2xsaXNpb25Qb3NUb3AgPSBwb3NpdGlvbi50b3AgLSBkYXRhLmNvbGxpc2lvblBvc2l0aW9uLm1hcmdpblRvcCwKCQkJCW92ZXJUb3AgPSB3aXRoaW5PZmZzZXQgLSBjb2xsaXNpb25Qb3NUb3AsCgkJCQlvdmVyQm90dG9tID0gY29sbGlzaW9uUG9zVG9wICsgZGF0YS5jb2xsaXNpb25IZWlnaHQgLSBvdXRlckhlaWdodCAtIHdpdGhpbk9mZnNldCwKCQkJCW5ld092ZXJCb3R0b207CgoJCQkvLyBlbGVtZW50IGlzIHRhbGxlciB0aGFuIHdpdGhpbgoJCQlpZiAoIGRhdGEuY29sbGlzaW9uSGVpZ2h0ID4gb3V0ZXJIZWlnaHQgKSB7CgkJCQkvLyBlbGVtZW50IGlzIGluaXRpYWxseSBvdmVyIHRoZSB0b3Agb2Ygd2l0aGluCgkJCQlpZiAoIG92ZXJUb3AgPiAwICYmIG92ZXJCb3R0b20gPD0gMCApIHsKCQkJCQluZXdPdmVyQm90dG9tID0gcG9zaXRpb24udG9wICsgb3ZlclRvcCArIGRhdGEuY29sbGlzaW9uSGVpZ2h0IC0gb3V0ZXJIZWlnaHQgLSB3aXRoaW5PZmZzZXQ7CgkJCQkJcG9zaXRpb24udG9wICs9IG92ZXJUb3AgLSBuZXdPdmVyQm90dG9tOwoJCQkJLy8gZWxlbWVudCBpcyBpbml0aWFsbHkgb3ZlciBib3R0b20gb2Ygd2l0aGluCgkJCQl9IGVsc2UgaWYgKCBvdmVyQm90dG9tID4gMCAmJiBvdmVyVG9wIDw9IDAgKSB7CgkJCQkJcG9zaXRpb24udG9wID0gd2l0aGluT2Zmc2V0OwoJCQkJLy8gZWxlbWVudCBpcyBpbml0aWFsbHkgb3ZlciBib3RoIHRvcCBhbmQgYm90dG9tIG9mIHdpdGhpbgoJCQkJfSBlbHNlIHsKCQkJCQlpZiAoIG92ZXJUb3AgPiBvdmVyQm90dG9tICkgewoJCQkJCQlwb3NpdGlvbi50b3AgPSB3aXRoaW5PZmZzZXQgKyBvdXRlckhlaWdodCAtIGRhdGEuY29sbGlzaW9uSGVpZ2h0OwoJCQkJCX0gZWxzZSB7CgkJCQkJCXBvc2l0aW9uLnRvcCA9IHdpdGhpbk9mZnNldDsKCQkJCQl9CgkJCQl9CgkJCS8vIHRvbyBmYXIgdXAgLT4gYWxpZ24gd2l0aCB0b3AKCQkJfSBlbHNlIGlmICggb3ZlclRvcCA+IDAgKSB7CgkJCQlwb3NpdGlvbi50b3AgKz0gb3ZlclRvcDsKCQkJLy8gdG9vIGZhciBkb3duIC0+IGFsaWduIHdpdGggYm90dG9tIGVkZ2UKCQkJfSBlbHNlIGlmICggb3ZlckJvdHRvbSA+IDAgKSB7CgkJCQlwb3NpdGlvbi50b3AgLT0gb3ZlckJvdHRvbTsKCQkJLy8gYWRqdXN0IGJhc2VkIG9uIHBvc2l0aW9uIGFuZCBtYXJnaW4KCQkJfSBlbHNlIHsKCQkJCXBvc2l0aW9uLnRvcCA9IG1heCggcG9zaXRpb24udG9wIC0gY29sbGlzaW9uUG9zVG9wLCBwb3NpdGlvbi50b3AgKTsKCQkJfQoJCX0KCX0sCglmbGlwOiB7CgkJbGVmdDogZnVuY3Rpb24oIHBvc2l0aW9uLCBkYXRhICkgewoJCQl2YXIgd2l0aGluID0gZGF0YS53aXRoaW4sCgkJCQl3aXRoaW5PZmZzZXQgPSB3aXRoaW4ub2Zmc2V0LmxlZnQgKyB3aXRoaW4uc2Nyb2xsTGVmdCwKCQkJCW91dGVyV2lkdGggPSB3aXRoaW4ud2lkdGgsCgkJCQlvZmZzZXRMZWZ0ID0gd2l0aGluLmlzV2luZG93ID8gd2l0aGluLnNjcm9sbExlZnQgOiB3aXRoaW4ub2Zmc2V0LmxlZnQsCgkJCQljb2xsaXNpb25Qb3NMZWZ0ID0gcG9zaXRpb24ubGVmdCAtIGRhdGEuY29sbGlzaW9uUG9zaXRpb24ubWFyZ2luTGVmdCwKCQkJCW92ZXJMZWZ0ID0gY29sbGlzaW9uUG9zTGVmdCAtIG9mZnNldExlZnQsCgkJCQlvdmVyUmlnaHQgPSBjb2xsaXNpb25Qb3NMZWZ0ICsgZGF0YS5jb2xsaXNpb25XaWR0aCAtIG91dGVyV2lkdGggLSBvZmZzZXRMZWZ0LAoJCQkJbXlPZmZzZXQgPSBkYXRhLm15WyAwIF0gPT09ICJsZWZ0IiA/CgkJCQkJLWRhdGEuZWxlbVdpZHRoIDoKCQkJCQlkYXRhLm15WyAwIF0gPT09ICJyaWdodCIgPwoJCQkJCQlkYXRhLmVsZW1XaWR0aCA6CgkJCQkJCTAsCgkJCQlhdE9mZnNldCA9IGRhdGEuYXRbIDAgXSA9PT0gImxlZnQiID8KCQkJCQlkYXRhLnRhcmdldFdpZHRoIDoKCQkJCQlkYXRhLmF0WyAwIF0gPT09ICJyaWdodCIgPwoJCQkJCQktZGF0YS50YXJnZXRXaWR0aCA6CgkJCQkJCTAsCgkJCQlvZmZzZXQgPSAtMiAqIGRhdGEub2Zmc2V0WyAwIF0sCgkJCQluZXdPdmVyUmlnaHQsCgkJCQluZXdPdmVyTGVmdDsKCgkJCWlmICggb3ZlckxlZnQgPCAwICkgewoJCQkJbmV3T3ZlclJpZ2h0ID0gcG9zaXRpb24ubGVmdCArIG15T2Zmc2V0ICsgYXRPZmZzZXQgKyBvZmZzZXQgKyBkYXRhLmNvbGxpc2lvbldpZHRoIC0gb3V0ZXJXaWR0aCAtIHdpdGhpbk9mZnNldDsKCQkJCWlmICggbmV3T3ZlclJpZ2h0IDwgMCB8fCBuZXdPdmVyUmlnaHQgPCBhYnMoIG92ZXJMZWZ0ICkgKSB7CgkJCQkJcG9zaXRpb24ubGVmdCArPSBteU9mZnNldCArIGF0T2Zmc2V0ICsgb2Zmc2V0OwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvdmVyUmlnaHQgPiAwICkgewoJCQkJbmV3T3ZlckxlZnQgPSBwb3NpdGlvbi5sZWZ0IC0gZGF0YS5jb2xsaXNpb25Qb3NpdGlvbi5tYXJnaW5MZWZ0ICsgbXlPZmZzZXQgKyBhdE9mZnNldCArIG9mZnNldCAtIG9mZnNldExlZnQ7CgkJCQlpZiAoIG5ld092ZXJMZWZ0ID4gMCB8fCBhYnMoIG5ld092ZXJMZWZ0ICkgPCBvdmVyUmlnaHQgKSB7CgkJCQkJcG9zaXRpb24ubGVmdCArPSBteU9mZnNldCArIGF0T2Zmc2V0ICsgb2Zmc2V0OwoJCQkJfQoJCQl9CgkJfSwKCQl0b3A6IGZ1bmN0aW9uKCBwb3NpdGlvbiwgZGF0YSApIHsKCQkJdmFyIHdpdGhpbiA9IGRhdGEud2l0aGluLAoJCQkJd2l0aGluT2Zmc2V0ID0gd2l0aGluLm9mZnNldC50b3AgKyB3aXRoaW4uc2Nyb2xsVG9wLAoJCQkJb3V0ZXJIZWlnaHQgPSB3aXRoaW4uaGVpZ2h0LAoJCQkJb2Zmc2V0VG9wID0gd2l0aGluLmlzV2luZG93ID8gd2l0aGluLnNjcm9sbFRvcCA6IHdpdGhpbi5vZmZzZXQudG9wLAoJCQkJY29sbGlzaW9uUG9zVG9wID0gcG9zaXRpb24udG9wIC0gZGF0YS5jb2xsaXNpb25Qb3NpdGlvbi5tYXJnaW5Ub3AsCgkJCQlvdmVyVG9wID0gY29sbGlzaW9uUG9zVG9wIC0gb2Zmc2V0VG9wLAoJCQkJb3ZlckJvdHRvbSA9IGNvbGxpc2lvblBvc1RvcCArIGRhdGEuY29sbGlzaW9uSGVpZ2h0IC0gb3V0ZXJIZWlnaHQgLSBvZmZzZXRUb3AsCgkJCQl0b3AgPSBkYXRhLm15WyAxIF0gPT09ICJ0b3AiLAoJCQkJbXlPZmZzZXQgPSB0b3AgPwoJCQkJCS1kYXRhLmVsZW1IZWlnaHQgOgoJCQkJCWRhdGEubXlbIDEgXSA9PT0gImJvdHRvbSIgPwoJCQkJCQlkYXRhLmVsZW1IZWlnaHQgOgoJCQkJCQkwLAoJCQkJYXRPZmZzZXQgPSBkYXRhLmF0WyAxIF0gPT09ICJ0b3AiID8KCQkJCQlkYXRhLnRhcmdldEhlaWdodCA6CgkJCQkJZGF0YS5hdFsgMSBdID09PSAiYm90dG9tIiA/CgkJCQkJCS1kYXRhLnRhcmdldEhlaWdodCA6CgkJCQkJCTAsCgkJCQlvZmZzZXQgPSAtMiAqIGRhdGEub2Zmc2V0WyAxIF0sCgkJCQluZXdPdmVyVG9wLAoJCQkJbmV3T3ZlckJvdHRvbTsKCQkJaWYgKCBvdmVyVG9wIDwgMCApIHsKCQkJCW5ld092ZXJCb3R0b20gPSBwb3NpdGlvbi50b3AgKyBteU9mZnNldCArIGF0T2Zmc2V0ICsgb2Zmc2V0ICsgZGF0YS5jb2xsaXNpb25IZWlnaHQgLSBvdXRlckhlaWdodCAtIHdpdGhpbk9mZnNldDsKCQkJCWlmICggKCBwb3NpdGlvbi50b3AgKyBteU9mZnNldCArIGF0T2Zmc2V0ICsgb2Zmc2V0KSA+IG92ZXJUb3AgJiYgKCBuZXdPdmVyQm90dG9tIDwgMCB8fCBuZXdPdmVyQm90dG9tIDwgYWJzKCBvdmVyVG9wICkgKSApIHsKCQkJCQlwb3NpdGlvbi50b3AgKz0gbXlPZmZzZXQgKyBhdE9mZnNldCArIG9mZnNldDsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggb3ZlckJvdHRvbSA+IDAgKSB7CgkJCQluZXdPdmVyVG9wID0gcG9zaXRpb24udG9wIC0gZGF0YS5jb2xsaXNpb25Qb3NpdGlvbi5tYXJnaW5Ub3AgKyBteU9mZnNldCArIGF0T2Zmc2V0ICsgb2Zmc2V0IC0gb2Zmc2V0VG9wOwoJCQkJaWYgKCAoIHBvc2l0aW9uLnRvcCArIG15T2Zmc2V0ICsgYXRPZmZzZXQgKyBvZmZzZXQpID4gb3ZlckJvdHRvbSAmJiAoIG5ld092ZXJUb3AgPiAwIHx8IGFicyggbmV3T3ZlclRvcCApIDwgb3ZlckJvdHRvbSApICkgewoJCQkJCXBvc2l0aW9uLnRvcCArPSBteU9mZnNldCArIGF0T2Zmc2V0ICsgb2Zmc2V0OwoJCQkJfQoJCQl9CgkJfQoJfSwKCWZsaXBmaXQ6IHsKCQlsZWZ0OiBmdW5jdGlvbigpIHsKCQkJJC51aS5wb3NpdGlvbi5mbGlwLmxlZnQuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQkkLnVpLnBvc2l0aW9uLmZpdC5sZWZ0LmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQl9LAoJCXRvcDogZnVuY3Rpb24oKSB7CgkJCSQudWkucG9zaXRpb24uZmxpcC50b3AuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQkkLnVpLnBvc2l0aW9uLmZpdC50b3AuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCX0KCX0KfTsKCi8vIGZyYWN0aW9uIHN1cHBvcnQgdGVzdAooZnVuY3Rpb24gKCkgewoJdmFyIHRlc3RFbGVtZW50LCB0ZXN0RWxlbWVudFBhcmVudCwgdGVzdEVsZW1lbnRTdHlsZSwgb2Zmc2V0TGVmdCwgaSwKCQlib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICJib2R5IiApWyAwIF0sCgkJZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKTsKCgkvL0NyZWF0ZSBhICJmYWtlIGJvZHkiIGZvciB0ZXN0aW5nIGJhc2VkIG9uIG1ldGhvZCB1c2VkIGluIGpRdWVyeS5zdXBwb3J0Cgl0ZXN0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIGJvZHkgPyAiZGl2IiA6ICJib2R5IiApOwoJdGVzdEVsZW1lbnRTdHlsZSA9IHsKCQl2aXNpYmlsaXR5OiAiaGlkZGVuIiwKCQl3aWR0aDogMCwKCQloZWlnaHQ6IDAsCgkJYm9yZGVyOiAwLAoJCW1hcmdpbjogMCwKCQliYWNrZ3JvdW5kOiAibm9uZSIKCX07CglpZiAoIGJvZHkgKSB7CgkJJC5leHRlbmQoIHRlc3RFbGVtZW50U3R5bGUsIHsKCQkJcG9zaXRpb246ICJhYnNvbHV0ZSIsCgkJCWxlZnQ6ICItMTAwMHB4IiwKCQkJdG9wOiAiLTEwMDBweCIKCQl9KTsKCX0KCWZvciAoIGkgaW4gdGVzdEVsZW1lbnRTdHlsZSApIHsKCQl0ZXN0RWxlbWVudC5zdHlsZVsgaSBdID0gdGVzdEVsZW1lbnRTdHlsZVsgaSBdOwoJfQoJdGVzdEVsZW1lbnQuYXBwZW5kQ2hpbGQoIGRpdiApOwoJdGVzdEVsZW1lbnRQYXJlbnQgPSBib2R5IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCXRlc3RFbGVtZW50UGFyZW50Lmluc2VydEJlZm9yZSggdGVzdEVsZW1lbnQsIHRlc3RFbGVtZW50UGFyZW50LmZpcnN0Q2hpbGQgKTsKCglkaXYuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjogYWJzb2x1dGU7IGxlZnQ6IDEwLjc0MzIyMjJweDsiOwoKCW9mZnNldExlZnQgPSAkKCBkaXYgKS5vZmZzZXQoKS5sZWZ0OwoJJC5zdXBwb3J0Lm9mZnNldEZyYWN0aW9ucyA9IG9mZnNldExlZnQgPiAxMCAmJiBvZmZzZXRMZWZ0IDwgMTE7CgoJdGVzdEVsZW1lbnQuaW5uZXJIVE1MID0gIiI7Cgl0ZXN0RWxlbWVudFBhcmVudC5yZW1vdmVDaGlsZCggdGVzdEVsZW1lbnQgKTsKfSkoKTsKCn0oIGpRdWVyeSApICk7CgooZnVuY3Rpb24oICQsIHVuZGVmaW5lZCApIHsKCiQud2lkZ2V0KCAidWkucHJvZ3Jlc3NiYXIiLCB7Cgl2ZXJzaW9uOiAiMS4xMC40IiwKCW9wdGlvbnM6IHsKCQltYXg6IDEwMCwKCQl2YWx1ZTogMCwKCgkJY2hhbmdlOiBudWxsLAoJCWNvbXBsZXRlOiBudWxsCgl9LAoKCW1pbjogMCwKCglfY3JlYXRlOiBmdW5jdGlvbigpIHsKCQkvLyBDb25zdHJhaW4gaW5pdGlhbCB2YWx1ZQoJCXRoaXMub2xkVmFsdWUgPSB0aGlzLm9wdGlvbnMudmFsdWUgPSB0aGlzLl9jb25zdHJhaW5lZFZhbHVlKCk7CgoJCXRoaXMuZWxlbWVudAoJCQkuYWRkQ2xhc3MoICJ1aS1wcm9ncmVzc2JhciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCIgKQoJCQkuYXR0cih7CgkJCQkvLyBPbmx5IHNldCBzdGF0aWMgdmFsdWVzLCBhcmlhLXZhbHVlbm93IGFuZCBhcmlhLXZhbHVlbWF4IGFyZQoJCQkJLy8gc2V0IGluc2lkZSBfcmVmcmVzaFZhbHVlKCkKCQkJCXJvbGU6ICJwcm9ncmVzc2JhciIsCgkJCQkiYXJpYS12YWx1ZW1pbiI6IHRoaXMubWluCgkJCX0pOwoKCQl0aGlzLnZhbHVlRGl2ID0gJCggIjxkaXYgY2xhc3M9J3VpLXByb2dyZXNzYmFyLXZhbHVlIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWxlZnQnPjwvZGl2PiIgKQoJCQkuYXBwZW5kVG8oIHRoaXMuZWxlbWVudCApOwoKCQl0aGlzLl9yZWZyZXNoVmFsdWUoKTsKCX0sCgoJX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewoJCXRoaXMuZWxlbWVudAoJCQkucmVtb3ZlQ2xhc3MoICJ1aS1wcm9ncmVzc2JhciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCIgKQoJCQkucmVtb3ZlQXR0ciggInJvbGUiICkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLXZhbHVlbWluIiApCgkJCS5yZW1vdmVBdHRyKCAiYXJpYS12YWx1ZW1heCIgKQoJCQkucmVtb3ZlQXR0ciggImFyaWEtdmFsdWVub3ciICk7CgoJCXRoaXMudmFsdWVEaXYucmVtb3ZlKCk7Cgl9LAoKCXZhbHVlOiBmdW5jdGlvbiggbmV3VmFsdWUgKSB7CgkJaWYgKCBuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkICkgewoJCQlyZXR1cm4gdGhpcy5vcHRpb25zLnZhbHVlOwoJCX0KCgkJdGhpcy5vcHRpb25zLnZhbHVlID0gdGhpcy5fY29uc3RyYWluZWRWYWx1ZSggbmV3VmFsdWUgKTsKCQl0aGlzLl9yZWZyZXNoVmFsdWUoKTsKCX0sCgoJX2NvbnN0cmFpbmVkVmFsdWU6IGZ1bmN0aW9uKCBuZXdWYWx1ZSApIHsKCQlpZiAoIG5ld1ZhbHVlID09PSB1bmRlZmluZWQgKSB7CgkJCW5ld1ZhbHVlID0gdGhpcy5vcHRpb25zLnZhbHVlOwoJCX0KCgkJdGhpcy5pbmRldGVybWluYXRlID0gbmV3VmFsdWUgPT09IGZhbHNlOwoKCQkvLyBzYW5pdGl6ZSB2YWx1ZQoJCWlmICggdHlwZW9mIG5ld1ZhbHVlICE9PSAibnVtYmVyIiApIHsKCQkJbmV3VmFsdWUgPSAwOwoJCX0KCgkJcmV0dXJuIHRoaXMuaW5kZXRlcm1pbmF0ZSA/IGZhbHNlIDoKCQkJTWF0aC5taW4oIHRoaXMub3B0aW9ucy5tYXgsIE1hdGgubWF4KCB0aGlzLm1pbiwgbmV3VmFsdWUgKSApOwoJfSwKCglfc2V0T3B0aW9uczogZnVuY3Rpb24oIG9wdGlvbnMgKSB7CgkJLy8gRW5zdXJlICJ2YWx1ZSIgb3B0aW9uIGlzIHNldCBhZnRlciBvdGhlciB2YWx1ZXMgKGxpa2UgbWF4KQoJCXZhciB2YWx1ZSA9IG9wdGlvbnMudmFsdWU7CgkJZGVsZXRlIG9wdGlvbnMudmFsdWU7CgoJCXRoaXMuX3N1cGVyKCBvcHRpb25zICk7CgoJCXRoaXMub3B0aW9ucy52YWx1ZSA9IHRoaXMuX2NvbnN0cmFpbmVkVmFsdWUoIHZhbHVlICk7CgkJdGhpcy5fcmVmcmVzaFZhbHVlKCk7Cgl9LAoKCV9zZXRPcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCWlmICgga2V5ID09PSAibWF4IiApIHsKCQkJLy8gRG9uJ3QgYWxsb3cgYSBtYXggbGVzcyB0aGFuIG1pbgoJCQl2YWx1ZSA9IE1hdGgubWF4KCB0aGlzLm1pbiwgdmFsdWUgKTsKCQl9CgoJCXRoaXMuX3N1cGVyKCBrZXksIHZhbHVlICk7Cgl9LAoKCV9wZXJjZW50YWdlOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5pbmRldGVybWluYXRlID8gMTAwIDogMTAwICogKCB0aGlzLm9wdGlvbnMudmFsdWUgLSB0aGlzLm1pbiApIC8gKCB0aGlzLm9wdGlvbnMubWF4IC0gdGhpcy5taW4gKTsKCX0sCgoJX3JlZnJlc2hWYWx1ZTogZnVuY3Rpb24oKSB7CgkJdmFyIHZhbHVlID0gdGhpcy5vcHRpb25zLnZhbHVlLAoJCQlwZXJjZW50YWdlID0gdGhpcy5fcGVyY2VudGFnZSgpOwoKCQl0aGlzLnZhbHVlRGl2CgkJCS50b2dnbGUoIHRoaXMuaW5kZXRlcm1pbmF0ZSB8fCB2YWx1ZSA+IHRoaXMubWluICkKCQkJLnRvZ2dsZUNsYXNzKCAidWktY29ybmVyLXJpZ2h0IiwgdmFsdWUgPT09IHRoaXMub3B0aW9ucy5tYXggKQoJCQkud2lkdGgoIHBlcmNlbnRhZ2UudG9GaXhlZCgwKSArICIlIiApOwoKCQl0aGlzLmVsZW1lbnQudG9nZ2xlQ2xhc3MoICJ1aS1wcm9ncmVzc2Jhci1pbmRldGVybWluYXRlIiwgdGhpcy5pbmRldGVybWluYXRlICk7CgoJCWlmICggdGhpcy5pbmRldGVybWluYXRlICkgewoJCQl0aGlzLmVsZW1lbnQucmVtb3ZlQXR0ciggImFyaWEtdmFsdWVub3ciICk7CgkJCWlmICggIXRoaXMub3ZlcmxheURpdiApIHsKCQkJCXRoaXMub3ZlcmxheURpdiA9ICQoICI8ZGl2IGNsYXNzPSd1aS1wcm9ncmVzc2Jhci1vdmVybGF5Jz48L2Rpdj4iICkuYXBwZW5kVG8oIHRoaXMudmFsdWVEaXYgKTsKCQkJfQoJCX0gZWxzZSB7CgkJCXRoaXMuZWxlbWVudC5hdHRyKHsKCQkJCSJhcmlhLXZhbHVlbWF4IjogdGhpcy5vcHRpb25zLm1heCwKCQkJCSJhcmlhLXZhbHVlbm93IjogdmFsdWUKCQkJfSk7CgkJCWlmICggdGhpcy5vdmVybGF5RGl2ICkgewoJCQkJdGhpcy5vdmVybGF5RGl2LnJlbW92ZSgpOwoJCQkJdGhpcy5vdmVybGF5RGl2ID0gbnVsbDsKCQkJfQoJCX0KCgkJaWYgKCB0aGlzLm9sZFZhbHVlICE9PSB2YWx1ZSApIHsKCQkJdGhpcy5vbGRWYWx1ZSA9IHZhbHVlOwoJCQl0aGlzLl90cmlnZ2VyKCAiY2hhbmdlIiApOwoJCX0KCQlpZiAoIHZhbHVlID09PSB0aGlzLm9wdGlvbnMubWF4ICkgewoJCQl0aGlzLl90cmlnZ2VyKCAiY29tcGxldGUiICk7CgkJfQoJfQp9KTsKCn0pKCBqUXVlcnkgKTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKLy8gbnVtYmVyIG9mIHBhZ2VzIGluIGEgc2xpZGVyCi8vIChob3cgbWFueSB0aW1lcyBjYW4geW91IHBhZ2UgdXAvZG93biB0byBnbyB0aHJvdWdoIHRoZSB3aG9sZSByYW5nZSkKdmFyIG51bVBhZ2VzID0gNTsKCiQud2lkZ2V0KCAidWkuc2xpZGVyIiwgJC51aS5tb3VzZSwgewoJdmVyc2lvbjogIjEuMTAuNCIsCgl3aWRnZXRFdmVudFByZWZpeDogInNsaWRlIiwKCglvcHRpb25zOiB7CgkJYW5pbWF0ZTogZmFsc2UsCgkJZGlzdGFuY2U6IDAsCgkJbWF4OiAxMDAsCgkJbWluOiAwLAoJCW9yaWVudGF0aW9uOiAiaG9yaXpvbnRhbCIsCgkJcmFuZ2U6IGZhbHNlLAoJCXN0ZXA6IDEsCgkJdmFsdWU6IDAsCgkJdmFsdWVzOiBudWxsLAoKCQkvLyBjYWxsYmFja3MKCQljaGFuZ2U6IG51bGwsCgkJc2xpZGU6IG51bGwsCgkJc3RhcnQ6IG51bGwsCgkJc3RvcDogbnVsbAoJfSwKCglfY3JlYXRlOiBmdW5jdGlvbigpIHsKCQl0aGlzLl9rZXlTbGlkaW5nID0gZmFsc2U7CgkJdGhpcy5fbW91c2VTbGlkaW5nID0gZmFsc2U7CgkJdGhpcy5fYW5pbWF0ZU9mZiA9IHRydWU7CgkJdGhpcy5faGFuZGxlSW5kZXggPSBudWxsOwoJCXRoaXMuX2RldGVjdE9yaWVudGF0aW9uKCk7CgkJdGhpcy5fbW91c2VJbml0KCk7CgoJCXRoaXMuZWxlbWVudAoJCQkuYWRkQ2xhc3MoICJ1aS1zbGlkZXIiICsKCQkJCSIgdWktc2xpZGVyLSIgKyB0aGlzLm9yaWVudGF0aW9uICsKCQkJCSIgdWktd2lkZ2V0IiArCgkJCQkiIHVpLXdpZGdldC1jb250ZW50IiArCgkJCQkiIHVpLWNvcm5lci1hbGwiKTsKCgkJdGhpcy5fcmVmcmVzaCgpOwoJCXRoaXMuX3NldE9wdGlvbiggImRpc2FibGVkIiwgdGhpcy5vcHRpb25zLmRpc2FibGVkICk7CgoJCXRoaXMuX2FuaW1hdGVPZmYgPSBmYWxzZTsKCX0sCgoJX3JlZnJlc2g6IGZ1bmN0aW9uKCkgewoJCXRoaXMuX2NyZWF0ZVJhbmdlKCk7CgkJdGhpcy5fY3JlYXRlSGFuZGxlcygpOwoJCXRoaXMuX3NldHVwRXZlbnRzKCk7CgkJdGhpcy5fcmVmcmVzaFZhbHVlKCk7Cgl9LAoKCV9jcmVhdGVIYW5kbGVzOiBmdW5jdGlvbigpIHsKCQl2YXIgaSwgaGFuZGxlQ291bnQsCgkJCW9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCgkJCWV4aXN0aW5nSGFuZGxlcyA9IHRoaXMuZWxlbWVudC5maW5kKCAiLnVpLXNsaWRlci1oYW5kbGUiICkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwiICksCgkJCWhhbmRsZSA9ICI8YSBjbGFzcz0ndWktc2xpZGVyLWhhbmRsZSB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwnIGhyZWY9JyMnPjwvYT4iLAoJCQloYW5kbGVzID0gW107CgoJCWhhbmRsZUNvdW50ID0gKCBvcHRpb25zLnZhbHVlcyAmJiBvcHRpb25zLnZhbHVlcy5sZW5ndGggKSB8fCAxOwoKCQlpZiAoIGV4aXN0aW5nSGFuZGxlcy5sZW5ndGggPiBoYW5kbGVDb3VudCApIHsKCQkJZXhpc3RpbmdIYW5kbGVzLnNsaWNlKCBoYW5kbGVDb3VudCApLnJlbW92ZSgpOwoJCQlleGlzdGluZ0hhbmRsZXMgPSBleGlzdGluZ0hhbmRsZXMuc2xpY2UoIDAsIGhhbmRsZUNvdW50ICk7CgkJfQoKCQlmb3IgKCBpID0gZXhpc3RpbmdIYW5kbGVzLmxlbmd0aDsgaSA8IGhhbmRsZUNvdW50OyBpKysgKSB7CgkJCWhhbmRsZXMucHVzaCggaGFuZGxlICk7CgkJfQoKCQl0aGlzLmhhbmRsZXMgPSBleGlzdGluZ0hhbmRsZXMuYWRkKCAkKCBoYW5kbGVzLmpvaW4oICIiICkgKS5hcHBlbmRUbyggdGhpcy5lbGVtZW50ICkgKTsKCgkJdGhpcy5oYW5kbGUgPSB0aGlzLmhhbmRsZXMuZXEoIDAgKTsKCgkJdGhpcy5oYW5kbGVzLmVhY2goZnVuY3Rpb24oIGkgKSB7CgkJCSQoIHRoaXMgKS5kYXRhKCAidWktc2xpZGVyLWhhbmRsZS1pbmRleCIsIGkgKTsKCQl9KTsKCX0sCgoJX2NyZWF0ZVJhbmdlOiBmdW5jdGlvbigpIHsKCQl2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKCQkJY2xhc3NlcyA9ICIiOwoKCQlpZiAoIG9wdGlvbnMucmFuZ2UgKSB7CgkJCWlmICggb3B0aW9ucy5yYW5nZSA9PT0gdHJ1ZSApIHsKCQkJCWlmICggIW9wdGlvbnMudmFsdWVzICkgewoJCQkJCW9wdGlvbnMudmFsdWVzID0gWyB0aGlzLl92YWx1ZU1pbigpLCB0aGlzLl92YWx1ZU1pbigpIF07CgkJCQl9IGVsc2UgaWYgKCBvcHRpb25zLnZhbHVlcy5sZW5ndGggJiYgb3B0aW9ucy52YWx1ZXMubGVuZ3RoICE9PSAyICkgewoJCQkJCW9wdGlvbnMudmFsdWVzID0gWyBvcHRpb25zLnZhbHVlc1swXSwgb3B0aW9ucy52YWx1ZXNbMF0gXTsKCQkJCX0gZWxzZSBpZiAoICQuaXNBcnJheSggb3B0aW9ucy52YWx1ZXMgKSApIHsKCQkJCQlvcHRpb25zLnZhbHVlcyA9IG9wdGlvbnMudmFsdWVzLnNsaWNlKDApOwoJCQkJfQoJCQl9CgoJCQlpZiAoICF0aGlzLnJhbmdlIHx8ICF0aGlzLnJhbmdlLmxlbmd0aCApIHsKCQkJCXRoaXMucmFuZ2UgPSAkKCAiPGRpdj48L2Rpdj4iICkKCQkJCQkuYXBwZW5kVG8oIHRoaXMuZWxlbWVudCApOwoKCQkJCWNsYXNzZXMgPSAidWktc2xpZGVyLXJhbmdlIiArCgkJCQkvLyBub3RlOiB0aGlzIGlzbid0IHRoZSBtb3N0IGZpdHRpbmdseSBzZW1hbnRpYyBmcmFtZXdvcmsgY2xhc3MgZm9yIHRoaXMgZWxlbWVudCwKCQkJCS8vIGJ1dCB3b3JrZWQgYmVzdCB2aXN1YWxseSB3aXRoIGEgdmFyaWV0eSBvZiB0aGVtZXMKCQkJCSIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYWxsIjsKCQkJfSBlbHNlIHsKCQkJCXRoaXMucmFuZ2UucmVtb3ZlQ2xhc3MoICJ1aS1zbGlkZXItcmFuZ2UtbWluIHVpLXNsaWRlci1yYW5nZS1tYXgiICkKCQkJCQkvLyBIYW5kbGUgcmFuZ2Ugc3dpdGNoaW5nIGZyb20gdHJ1ZSB0byBtaW4vbWF4CgkJCQkJLmNzcyh7CgkJCQkJCSJsZWZ0IjogIiIsCgkJCQkJCSJib3R0b20iOiAiIgoJCQkJCX0pOwoJCQl9CgoJCQl0aGlzLnJhbmdlLmFkZENsYXNzKCBjbGFzc2VzICsKCQkJCSggKCBvcHRpb25zLnJhbmdlID09PSAibWluIiB8fCBvcHRpb25zLnJhbmdlID09PSAibWF4IiApID8gIiB1aS1zbGlkZXItcmFuZ2UtIiArIG9wdGlvbnMucmFuZ2UgOiAiIiApICk7CgkJfSBlbHNlIHsKCQkJaWYgKCB0aGlzLnJhbmdlICkgewoJCQkJdGhpcy5yYW5nZS5yZW1vdmUoKTsKCQkJfQoJCQl0aGlzLnJhbmdlID0gbnVsbDsKCQl9Cgl9LAoKCV9zZXR1cEV2ZW50czogZnVuY3Rpb24oKSB7CgkJdmFyIGVsZW1lbnRzID0gdGhpcy5oYW5kbGVzLmFkZCggdGhpcy5yYW5nZSApLmZpbHRlciggImEiICk7CgkJdGhpcy5fb2ZmKCBlbGVtZW50cyApOwoJCXRoaXMuX29uKCBlbGVtZW50cywgdGhpcy5faGFuZGxlRXZlbnRzICk7CgkJdGhpcy5faG92ZXJhYmxlKCBlbGVtZW50cyApOwoJCXRoaXMuX2ZvY3VzYWJsZSggZWxlbWVudHMgKTsKCX0sCgoJX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewoJCXRoaXMuaGFuZGxlcy5yZW1vdmUoKTsKCQlpZiAoIHRoaXMucmFuZ2UgKSB7CgkJCXRoaXMucmFuZ2UucmVtb3ZlKCk7CgkJfQoKCQl0aGlzLmVsZW1lbnQKCQkJLnJlbW92ZUNsYXNzKCAidWktc2xpZGVyIiArCgkJCQkiIHVpLXNsaWRlci1ob3Jpem9udGFsIiArCgkJCQkiIHVpLXNsaWRlci12ZXJ0aWNhbCIgKwoJCQkJIiB1aS13aWRnZXQiICsKCQkJCSIgdWktd2lkZ2V0LWNvbnRlbnQiICsKCQkJCSIgdWktY29ybmVyLWFsbCIgKTsKCgkJdGhpcy5fbW91c2VEZXN0cm95KCk7Cgl9LAoKCV9tb3VzZUNhcHR1cmU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgcG9zaXRpb24sIG5vcm1WYWx1ZSwgZGlzdGFuY2UsIGNsb3Nlc3RIYW5kbGUsIGluZGV4LCBhbGxvd2VkLCBvZmZzZXQsIG1vdXNlT3ZlckhhbmRsZSwKCQkJdGhhdCA9IHRoaXMsCgkJCW8gPSB0aGlzLm9wdGlvbnM7CgoJCWlmICggby5kaXNhYmxlZCApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJdGhpcy5lbGVtZW50U2l6ZSA9IHsKCQkJd2lkdGg6IHRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCksCgkJCWhlaWdodDogdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCkKCQl9OwoJCXRoaXMuZWxlbWVudE9mZnNldCA9IHRoaXMuZWxlbWVudC5vZmZzZXQoKTsKCgkJcG9zaXRpb24gPSB7IHg6IGV2ZW50LnBhZ2VYLCB5OiBldmVudC5wYWdlWSB9OwoJCW5vcm1WYWx1ZSA9IHRoaXMuX25vcm1WYWx1ZUZyb21Nb3VzZSggcG9zaXRpb24gKTsKCQlkaXN0YW5jZSA9IHRoaXMuX3ZhbHVlTWF4KCkgLSB0aGlzLl92YWx1ZU1pbigpICsgMTsKCQl0aGlzLmhhbmRsZXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJdmFyIHRoaXNEaXN0YW5jZSA9IE1hdGguYWJzKCBub3JtVmFsdWUgLSB0aGF0LnZhbHVlcyhpKSApOwoJCQlpZiAoKCBkaXN0YW5jZSA+IHRoaXNEaXN0YW5jZSApIHx8CgkJCQkoIGRpc3RhbmNlID09PSB0aGlzRGlzdGFuY2UgJiYKCQkJCQkoaSA9PT0gdGhhdC5fbGFzdENoYW5nZWRWYWx1ZSB8fCB0aGF0LnZhbHVlcyhpKSA9PT0gby5taW4gKSkpIHsKCQkJCWRpc3RhbmNlID0gdGhpc0Rpc3RhbmNlOwoJCQkJY2xvc2VzdEhhbmRsZSA9ICQoIHRoaXMgKTsKCQkJCWluZGV4ID0gaTsKCQkJfQoJCX0pOwoKCQlhbGxvd2VkID0gdGhpcy5fc3RhcnQoIGV2ZW50LCBpbmRleCApOwoJCWlmICggYWxsb3dlZCA9PT0gZmFsc2UgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJdGhpcy5fbW91c2VTbGlkaW5nID0gdHJ1ZTsKCgkJdGhpcy5faGFuZGxlSW5kZXggPSBpbmRleDsKCgkJY2xvc2VzdEhhbmRsZQoJCQkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICkKCQkJLmZvY3VzKCk7CgoJCW9mZnNldCA9IGNsb3Nlc3RIYW5kbGUub2Zmc2V0KCk7CgkJbW91c2VPdmVySGFuZGxlID0gISQoIGV2ZW50LnRhcmdldCApLnBhcmVudHMoKS5hZGRCYWNrKCkuaXMoICIudWktc2xpZGVyLWhhbmRsZSIgKTsKCQl0aGlzLl9jbGlja09mZnNldCA9IG1vdXNlT3ZlckhhbmRsZSA/IHsgbGVmdDogMCwgdG9wOiAwIH0gOiB7CgkJCWxlZnQ6IGV2ZW50LnBhZ2VYIC0gb2Zmc2V0LmxlZnQgLSAoIGNsb3Nlc3RIYW5kbGUud2lkdGgoKSAvIDIgKSwKCQkJdG9wOiBldmVudC5wYWdlWSAtIG9mZnNldC50b3AgLQoJCQkJKCBjbG9zZXN0SGFuZGxlLmhlaWdodCgpIC8gMiApIC0KCQkJCSggcGFyc2VJbnQoIGNsb3Nlc3RIYW5kbGUuY3NzKCJib3JkZXJUb3BXaWR0aCIpLCAxMCApIHx8IDAgKSAtCgkJCQkoIHBhcnNlSW50KCBjbG9zZXN0SGFuZGxlLmNzcygiYm9yZGVyQm90dG9tV2lkdGgiKSwgMTAgKSB8fCAwKSArCgkJCQkoIHBhcnNlSW50KCBjbG9zZXN0SGFuZGxlLmNzcygibWFyZ2luVG9wIiksIDEwICkgfHwgMCkKCQl9OwoKCQlpZiAoICF0aGlzLmhhbmRsZXMuaGFzQ2xhc3MoICJ1aS1zdGF0ZS1ob3ZlciIgKSApIHsKCQkJdGhpcy5fc2xpZGUoIGV2ZW50LCBpbmRleCwgbm9ybVZhbHVlICk7CgkJfQoJCXRoaXMuX2FuaW1hdGVPZmYgPSB0cnVlOwoJCXJldHVybiB0cnVlOwoJfSwKCglfbW91c2VTdGFydDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRydWU7Cgl9LAoKCV9tb3VzZURyYWc6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgcG9zaXRpb24gPSB7IHg6IGV2ZW50LnBhZ2VYLCB5OiBldmVudC5wYWdlWSB9LAoJCQlub3JtVmFsdWUgPSB0aGlzLl9ub3JtVmFsdWVGcm9tTW91c2UoIHBvc2l0aW9uICk7CgoJCXRoaXMuX3NsaWRlKCBldmVudCwgdGhpcy5faGFuZGxlSW5kZXgsIG5vcm1WYWx1ZSApOwoKCQlyZXR1cm4gZmFsc2U7Cgl9LAoKCV9tb3VzZVN0b3A6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl0aGlzLmhhbmRsZXMucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICk7CgkJdGhpcy5fbW91c2VTbGlkaW5nID0gZmFsc2U7CgoJCXRoaXMuX3N0b3AoIGV2ZW50LCB0aGlzLl9oYW5kbGVJbmRleCApOwoJCXRoaXMuX2NoYW5nZSggZXZlbnQsIHRoaXMuX2hhbmRsZUluZGV4ICk7CgoJCXRoaXMuX2hhbmRsZUluZGV4ID0gbnVsbDsKCQl0aGlzLl9jbGlja09mZnNldCA9IG51bGw7CgkJdGhpcy5fYW5pbWF0ZU9mZiA9IGZhbHNlOwoKCQlyZXR1cm4gZmFsc2U7Cgl9LAoKCV9kZXRlY3RPcmllbnRhdGlvbjogZnVuY3Rpb24oKSB7CgkJdGhpcy5vcmllbnRhdGlvbiA9ICggdGhpcy5vcHRpb25zLm9yaWVudGF0aW9uID09PSAidmVydGljYWwiICkgPyAidmVydGljYWwiIDogImhvcml6b250YWwiOwoJfSwKCglfbm9ybVZhbHVlRnJvbU1vdXNlOiBmdW5jdGlvbiggcG9zaXRpb24gKSB7CgkJdmFyIHBpeGVsVG90YWwsCgkJCXBpeGVsTW91c2UsCgkJCXBlcmNlbnRNb3VzZSwKCQkJdmFsdWVUb3RhbCwKCQkJdmFsdWVNb3VzZTsKCgkJaWYgKCB0aGlzLm9yaWVudGF0aW9uID09PSAiaG9yaXpvbnRhbCIgKSB7CgkJCXBpeGVsVG90YWwgPSB0aGlzLmVsZW1lbnRTaXplLndpZHRoOwoJCQlwaXhlbE1vdXNlID0gcG9zaXRpb24ueCAtIHRoaXMuZWxlbWVudE9mZnNldC5sZWZ0IC0gKCB0aGlzLl9jbGlja09mZnNldCA/IHRoaXMuX2NsaWNrT2Zmc2V0LmxlZnQgOiAwICk7CgkJfSBlbHNlIHsKCQkJcGl4ZWxUb3RhbCA9IHRoaXMuZWxlbWVudFNpemUuaGVpZ2h0OwoJCQlwaXhlbE1vdXNlID0gcG9zaXRpb24ueSAtIHRoaXMuZWxlbWVudE9mZnNldC50b3AgLSAoIHRoaXMuX2NsaWNrT2Zmc2V0ID8gdGhpcy5fY2xpY2tPZmZzZXQudG9wIDogMCApOwoJCX0KCgkJcGVyY2VudE1vdXNlID0gKCBwaXhlbE1vdXNlIC8gcGl4ZWxUb3RhbCApOwoJCWlmICggcGVyY2VudE1vdXNlID4gMSApIHsKCQkJcGVyY2VudE1vdXNlID0gMTsKCQl9CgkJaWYgKCBwZXJjZW50TW91c2UgPCAwICkgewoJCQlwZXJjZW50TW91c2UgPSAwOwoJCX0KCQlpZiAoIHRoaXMub3JpZW50YXRpb24gPT09ICJ2ZXJ0aWNhbCIgKSB7CgkJCXBlcmNlbnRNb3VzZSA9IDEgLSBwZXJjZW50TW91c2U7CgkJfQoKCQl2YWx1ZVRvdGFsID0gdGhpcy5fdmFsdWVNYXgoKSAtIHRoaXMuX3ZhbHVlTWluKCk7CgkJdmFsdWVNb3VzZSA9IHRoaXMuX3ZhbHVlTWluKCkgKyBwZXJjZW50TW91c2UgKiB2YWx1ZVRvdGFsOwoKCQlyZXR1cm4gdGhpcy5fdHJpbUFsaWduVmFsdWUoIHZhbHVlTW91c2UgKTsKCX0sCgoJX3N0YXJ0OiBmdW5jdGlvbiggZXZlbnQsIGluZGV4ICkgewoJCXZhciB1aUhhc2ggPSB7CgkJCWhhbmRsZTogdGhpcy5oYW5kbGVzWyBpbmRleCBdLAoJCQl2YWx1ZTogdGhpcy52YWx1ZSgpCgkJfTsKCQlpZiAoIHRoaXMub3B0aW9ucy52YWx1ZXMgJiYgdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGggKSB7CgkJCXVpSGFzaC52YWx1ZSA9IHRoaXMudmFsdWVzKCBpbmRleCApOwoJCQl1aUhhc2gudmFsdWVzID0gdGhpcy52YWx1ZXMoKTsKCQl9CgkJcmV0dXJuIHRoaXMuX3RyaWdnZXIoICJzdGFydCIsIGV2ZW50LCB1aUhhc2ggKTsKCX0sCgoJX3NsaWRlOiBmdW5jdGlvbiggZXZlbnQsIGluZGV4LCBuZXdWYWwgKSB7CgkJdmFyIG90aGVyVmFsLAoJCQluZXdWYWx1ZXMsCgkJCWFsbG93ZWQ7CgoJCWlmICggdGhpcy5vcHRpb25zLnZhbHVlcyAmJiB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCApIHsKCQkJb3RoZXJWYWwgPSB0aGlzLnZhbHVlcyggaW5kZXggPyAwIDogMSApOwoKCQkJaWYgKCAoIHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoID09PSAyICYmIHRoaXMub3B0aW9ucy5yYW5nZSA9PT0gdHJ1ZSApICYmCgkJCQkJKCAoIGluZGV4ID09PSAwICYmIG5ld1ZhbCA+IG90aGVyVmFsKSB8fCAoIGluZGV4ID09PSAxICYmIG5ld1ZhbCA8IG90aGVyVmFsICkgKQoJCQkJKSB7CgkJCQluZXdWYWwgPSBvdGhlclZhbDsKCQkJfQoKCQkJaWYgKCBuZXdWYWwgIT09IHRoaXMudmFsdWVzKCBpbmRleCApICkgewoJCQkJbmV3VmFsdWVzID0gdGhpcy52YWx1ZXMoKTsKCQkJCW5ld1ZhbHVlc1sgaW5kZXggXSA9IG5ld1ZhbDsKCQkJCS8vIEEgc2xpZGUgY2FuIGJlIGNhbmNlbGVkIGJ5IHJldHVybmluZyBmYWxzZSBmcm9tIHRoZSBzbGlkZSBjYWxsYmFjawoJCQkJYWxsb3dlZCA9IHRoaXMuX3RyaWdnZXIoICJzbGlkZSIsIGV2ZW50LCB7CgkJCQkJaGFuZGxlOiB0aGlzLmhhbmRsZXNbIGluZGV4IF0sCgkJCQkJdmFsdWU6IG5ld1ZhbCwKCQkJCQl2YWx1ZXM6IG5ld1ZhbHVlcwoJCQkJfSApOwoJCQkJb3RoZXJWYWwgPSB0aGlzLnZhbHVlcyggaW5kZXggPyAwIDogMSApOwoJCQkJaWYgKCBhbGxvd2VkICE9PSBmYWxzZSApIHsKCQkJCQl0aGlzLnZhbHVlcyggaW5kZXgsIG5ld1ZhbCApOwoJCQkJfQoJCQl9CgkJfSBlbHNlIHsKCQkJaWYgKCBuZXdWYWwgIT09IHRoaXMudmFsdWUoKSApIHsKCQkJCS8vIEEgc2xpZGUgY2FuIGJlIGNhbmNlbGVkIGJ5IHJldHVybmluZyBmYWxzZSBmcm9tIHRoZSBzbGlkZSBjYWxsYmFjawoJCQkJYWxsb3dlZCA9IHRoaXMuX3RyaWdnZXIoICJzbGlkZSIsIGV2ZW50LCB7CgkJCQkJaGFuZGxlOiB0aGlzLmhhbmRsZXNbIGluZGV4IF0sCgkJCQkJdmFsdWU6IG5ld1ZhbAoJCQkJfSApOwoJCQkJaWYgKCBhbGxvd2VkICE9PSBmYWxzZSApIHsKCQkJCQl0aGlzLnZhbHVlKCBuZXdWYWwgKTsKCQkJCX0KCQkJfQoJCX0KCX0sCgoJX3N0b3A6IGZ1bmN0aW9uKCBldmVudCwgaW5kZXggKSB7CgkJdmFyIHVpSGFzaCA9IHsKCQkJaGFuZGxlOiB0aGlzLmhhbmRsZXNbIGluZGV4IF0sCgkJCXZhbHVlOiB0aGlzLnZhbHVlKCkKCQl9OwoJCWlmICggdGhpcy5vcHRpb25zLnZhbHVlcyAmJiB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCApIHsKCQkJdWlIYXNoLnZhbHVlID0gdGhpcy52YWx1ZXMoIGluZGV4ICk7CgkJCXVpSGFzaC52YWx1ZXMgPSB0aGlzLnZhbHVlcygpOwoJCX0KCgkJdGhpcy5fdHJpZ2dlciggInN0b3AiLCBldmVudCwgdWlIYXNoICk7Cgl9LAoKCV9jaGFuZ2U6IGZ1bmN0aW9uKCBldmVudCwgaW5kZXggKSB7CgkJaWYgKCAhdGhpcy5fa2V5U2xpZGluZyAmJiAhdGhpcy5fbW91c2VTbGlkaW5nICkgewoJCQl2YXIgdWlIYXNoID0gewoJCQkJaGFuZGxlOiB0aGlzLmhhbmRsZXNbIGluZGV4IF0sCgkJCQl2YWx1ZTogdGhpcy52YWx1ZSgpCgkJCX07CgkJCWlmICggdGhpcy5vcHRpb25zLnZhbHVlcyAmJiB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCApIHsKCQkJCXVpSGFzaC52YWx1ZSA9IHRoaXMudmFsdWVzKCBpbmRleCApOwoJCQkJdWlIYXNoLnZhbHVlcyA9IHRoaXMudmFsdWVzKCk7CgkJCX0KCgkJCS8vc3RvcmUgdGhlIGxhc3QgY2hhbmdlZCB2YWx1ZSBpbmRleCBmb3IgcmVmZXJlbmNlIHdoZW4gaGFuZGxlcyBvdmVybGFwCgkJCXRoaXMuX2xhc3RDaGFuZ2VkVmFsdWUgPSBpbmRleDsKCgkJCXRoaXMuX3RyaWdnZXIoICJjaGFuZ2UiLCBldmVudCwgdWlIYXNoICk7CgkJfQoJfSwKCgl2YWx1ZTogZnVuY3Rpb24oIG5ld1ZhbHVlICkgewoJCWlmICggYXJndW1lbnRzLmxlbmd0aCApIHsKCQkJdGhpcy5vcHRpb25zLnZhbHVlID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoIG5ld1ZhbHVlICk7CgkJCXRoaXMuX3JlZnJlc2hWYWx1ZSgpOwoJCQl0aGlzLl9jaGFuZ2UoIG51bGwsIDAgKTsKCQkJcmV0dXJuOwoJCX0KCgkJcmV0dXJuIHRoaXMuX3ZhbHVlKCk7Cgl9LAoKCXZhbHVlczogZnVuY3Rpb24oIGluZGV4LCBuZXdWYWx1ZSApIHsKCQl2YXIgdmFscywKCQkJbmV3VmFsdWVzLAoJCQlpOwoKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAxICkgewoJCQl0aGlzLm9wdGlvbnMudmFsdWVzWyBpbmRleCBdID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoIG5ld1ZhbHVlICk7CgkJCXRoaXMuX3JlZnJlc2hWYWx1ZSgpOwoJCQl0aGlzLl9jaGFuZ2UoIG51bGwsIGluZGV4ICk7CgkJCXJldHVybjsKCQl9CgoJCWlmICggYXJndW1lbnRzLmxlbmd0aCApIHsKCQkJaWYgKCAkLmlzQXJyYXkoIGFyZ3VtZW50c1sgMCBdICkgKSB7CgkJCQl2YWxzID0gdGhpcy5vcHRpb25zLnZhbHVlczsKCQkJCW5ld1ZhbHVlcyA9IGFyZ3VtZW50c1sgMCBdOwoJCQkJZm9yICggaSA9IDA7IGkgPCB2YWxzLmxlbmd0aDsgaSArPSAxICkgewoJCQkJCXZhbHNbIGkgXSA9IHRoaXMuX3RyaW1BbGlnblZhbHVlKCBuZXdWYWx1ZXNbIGkgXSApOwoJCQkJCXRoaXMuX2NoYW5nZSggbnVsbCwgaSApOwoJCQkJfQoJCQkJdGhpcy5fcmVmcmVzaFZhbHVlKCk7CgkJCX0gZWxzZSB7CgkJCQlpZiAoIHRoaXMub3B0aW9ucy52YWx1ZXMgJiYgdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGggKSB7CgkJCQkJcmV0dXJuIHRoaXMuX3ZhbHVlcyggaW5kZXggKTsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuIHRoaXMudmFsdWUoKTsKCQkJCX0KCQkJfQoJCX0gZWxzZSB7CgkJCXJldHVybiB0aGlzLl92YWx1ZXMoKTsKCQl9Cgl9LAoKCV9zZXRPcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCXZhciBpLAoJCQl2YWxzTGVuZ3RoID0gMDsKCgkJaWYgKCBrZXkgPT09ICJyYW5nZSIgJiYgdGhpcy5vcHRpb25zLnJhbmdlID09PSB0cnVlICkgewoJCQlpZiAoIHZhbHVlID09PSAibWluIiApIHsKCQkJCXRoaXMub3B0aW9ucy52YWx1ZSA9IHRoaXMuX3ZhbHVlcyggMCApOwoJCQkJdGhpcy5vcHRpb25zLnZhbHVlcyA9IG51bGw7CgkJCX0gZWxzZSBpZiAoIHZhbHVlID09PSAibWF4IiApIHsKCQkJCXRoaXMub3B0aW9ucy52YWx1ZSA9IHRoaXMuX3ZhbHVlcyggdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGgtMSApOwoJCQkJdGhpcy5vcHRpb25zLnZhbHVlcyA9IG51bGw7CgkJCX0KCQl9CgoJCWlmICggJC5pc0FycmF5KCB0aGlzLm9wdGlvbnMudmFsdWVzICkgKSB7CgkJCXZhbHNMZW5ndGggPSB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aDsKCQl9CgoJCSQuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCgkJc3dpdGNoICgga2V5ICkgewoJCQljYXNlICJvcmllbnRhdGlvbiI6CgkJCQl0aGlzLl9kZXRlY3RPcmllbnRhdGlvbigpOwoJCQkJdGhpcy5lbGVtZW50CgkJCQkJLnJlbW92ZUNsYXNzKCAidWktc2xpZGVyLWhvcml6b250YWwgdWktc2xpZGVyLXZlcnRpY2FsIiApCgkJCQkJLmFkZENsYXNzKCAidWktc2xpZGVyLSIgKyB0aGlzLm9yaWVudGF0aW9uICk7CgkJCQl0aGlzLl9yZWZyZXNoVmFsdWUoKTsKCQkJCWJyZWFrOwoJCQljYXNlICJ2YWx1ZSI6CgkJCQl0aGlzLl9hbmltYXRlT2ZmID0gdHJ1ZTsKCQkJCXRoaXMuX3JlZnJlc2hWYWx1ZSgpOwoJCQkJdGhpcy5fY2hhbmdlKCBudWxsLCAwICk7CgkJCQl0aGlzLl9hbmltYXRlT2ZmID0gZmFsc2U7CgkJCQlicmVhazsKCQkJY2FzZSAidmFsdWVzIjoKCQkJCXRoaXMuX2FuaW1hdGVPZmYgPSB0cnVlOwoJCQkJdGhpcy5fcmVmcmVzaFZhbHVlKCk7CgkJCQlmb3IgKCBpID0gMDsgaSA8IHZhbHNMZW5ndGg7IGkgKz0gMSApIHsKCQkJCQl0aGlzLl9jaGFuZ2UoIG51bGwsIGkgKTsKCQkJCX0KCQkJCXRoaXMuX2FuaW1hdGVPZmYgPSBmYWxzZTsKCQkJCWJyZWFrOwoJCQljYXNlICJtaW4iOgoJCQljYXNlICJtYXgiOgoJCQkJdGhpcy5fYW5pbWF0ZU9mZiA9IHRydWU7CgkJCQl0aGlzLl9yZWZyZXNoVmFsdWUoKTsKCQkJCXRoaXMuX2FuaW1hdGVPZmYgPSBmYWxzZTsKCQkJCWJyZWFrOwoJCQljYXNlICJyYW5nZSI6CgkJCQl0aGlzLl9hbmltYXRlT2ZmID0gdHJ1ZTsKCQkJCXRoaXMuX3JlZnJlc2goKTsKCQkJCXRoaXMuX2FuaW1hdGVPZmYgPSBmYWxzZTsKCQkJCWJyZWFrOwoJCX0KCX0sCgoJLy9pbnRlcm5hbCB2YWx1ZSBnZXR0ZXIKCS8vIF92YWx1ZSgpIHJldHVybnMgdmFsdWUgdHJpbW1lZCBieSBtaW4gYW5kIG1heCwgYWxpZ25lZCBieSBzdGVwCglfdmFsdWU6IGZ1bmN0aW9uKCkgewoJCXZhciB2YWwgPSB0aGlzLm9wdGlvbnMudmFsdWU7CgkJdmFsID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoIHZhbCApOwoKCQlyZXR1cm4gdmFsOwoJfSwKCgkvL2ludGVybmFsIHZhbHVlcyBnZXR0ZXIKCS8vIF92YWx1ZXMoKSByZXR1cm5zIGFycmF5IG9mIHZhbHVlcyB0cmltbWVkIGJ5IG1pbiBhbmQgbWF4LCBhbGlnbmVkIGJ5IHN0ZXAKCS8vIF92YWx1ZXMoIGluZGV4ICkgcmV0dXJucyBzaW5nbGUgdmFsdWUgdHJpbW1lZCBieSBtaW4gYW5kIG1heCwgYWxpZ25lZCBieSBzdGVwCglfdmFsdWVzOiBmdW5jdGlvbiggaW5kZXggKSB7CgkJdmFyIHZhbCwKCQkJdmFscywKCQkJaTsKCgkJaWYgKCBhcmd1bWVudHMubGVuZ3RoICkgewoJCQl2YWwgPSB0aGlzLm9wdGlvbnMudmFsdWVzWyBpbmRleCBdOwoJCQl2YWwgPSB0aGlzLl90cmltQWxpZ25WYWx1ZSggdmFsICk7CgoJCQlyZXR1cm4gdmFsOwoJCX0gZWxzZSBpZiAoIHRoaXMub3B0aW9ucy52YWx1ZXMgJiYgdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGggKSB7CgkJCS8vIC5zbGljZSgpIGNyZWF0ZXMgYSBjb3B5IG9mIHRoZSBhcnJheQoJCQkvLyB0aGlzIGNvcHkgZ2V0cyB0cmltbWVkIGJ5IG1pbiBhbmQgbWF4IGFuZCB0aGVuIHJldHVybmVkCgkJCXZhbHMgPSB0aGlzLm9wdGlvbnMudmFsdWVzLnNsaWNlKCk7CgkJCWZvciAoIGkgPSAwOyBpIDwgdmFscy5sZW5ndGg7IGkrPSAxKSB7CgkJCQl2YWxzWyBpIF0gPSB0aGlzLl90cmltQWxpZ25WYWx1ZSggdmFsc1sgaSBdICk7CgkJCX0KCgkJCXJldHVybiB2YWxzOwoJCX0gZWxzZSB7CgkJCXJldHVybiBbXTsKCQl9Cgl9LAoKCS8vIHJldHVybnMgdGhlIHN0ZXAtYWxpZ25lZCB2YWx1ZSB0aGF0IHZhbCBpcyBjbG9zZXN0IHRvLCBiZXR3ZWVuIChpbmNsdXNpdmUpIG1pbiBhbmQgbWF4CglfdHJpbUFsaWduVmFsdWU6IGZ1bmN0aW9uKCB2YWwgKSB7CgkJaWYgKCB2YWwgPD0gdGhpcy5fdmFsdWVNaW4oKSApIHsKCQkJcmV0dXJuIHRoaXMuX3ZhbHVlTWluKCk7CgkJfQoJCWlmICggdmFsID49IHRoaXMuX3ZhbHVlTWF4KCkgKSB7CgkJCXJldHVybiB0aGlzLl92YWx1ZU1heCgpOwoJCX0KCQl2YXIgc3RlcCA9ICggdGhpcy5vcHRpb25zLnN0ZXAgPiAwICkgPyB0aGlzLm9wdGlvbnMuc3RlcCA6IDEsCgkJCXZhbE1vZFN0ZXAgPSAodmFsIC0gdGhpcy5fdmFsdWVNaW4oKSkgJSBzdGVwLAoJCQlhbGlnblZhbHVlID0gdmFsIC0gdmFsTW9kU3RlcDsKCgkJaWYgKCBNYXRoLmFicyh2YWxNb2RTdGVwKSAqIDIgPj0gc3RlcCApIHsKCQkJYWxpZ25WYWx1ZSArPSAoIHZhbE1vZFN0ZXAgPiAwICkgPyBzdGVwIDogKCAtc3RlcCApOwoJCX0KCgkJLy8gU2luY2UgSmF2YVNjcmlwdCBoYXMgcHJvYmxlbXMgd2l0aCBsYXJnZSBmbG9hdHMsIHJvdW5kCgkJLy8gdGhlIGZpbmFsIHZhbHVlIHRvIDUgZGlnaXRzIGFmdGVyIHRoZSBkZWNpbWFsIHBvaW50IChzZWUgIzQxMjQpCgkJcmV0dXJuIHBhcnNlRmxvYXQoIGFsaWduVmFsdWUudG9GaXhlZCg1KSApOwoJfSwKCglfdmFsdWVNaW46IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLm9wdGlvbnMubWluOwoJfSwKCglfdmFsdWVNYXg6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLm9wdGlvbnMubWF4OwoJfSwKCglfcmVmcmVzaFZhbHVlOiBmdW5jdGlvbigpIHsKCQl2YXIgbGFzdFZhbFBlcmNlbnQsIHZhbFBlcmNlbnQsIHZhbHVlLCB2YWx1ZU1pbiwgdmFsdWVNYXgsCgkJCW9SYW5nZSA9IHRoaXMub3B0aW9ucy5yYW5nZSwKCQkJbyA9IHRoaXMub3B0aW9ucywKCQkJdGhhdCA9IHRoaXMsCgkJCWFuaW1hdGUgPSAoICF0aGlzLl9hbmltYXRlT2ZmICkgPyBvLmFuaW1hdGUgOiBmYWxzZSwKCQkJX3NldCA9IHt9OwoKCQlpZiAoIHRoaXMub3B0aW9ucy52YWx1ZXMgJiYgdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGggKSB7CgkJCXRoaXMuaGFuZGxlcy5lYWNoKGZ1bmN0aW9uKCBpICkgewoJCQkJdmFsUGVyY2VudCA9ICggdGhhdC52YWx1ZXMoaSkgLSB0aGF0Ll92YWx1ZU1pbigpICkgLyAoIHRoYXQuX3ZhbHVlTWF4KCkgLSB0aGF0Ll92YWx1ZU1pbigpICkgKiAxMDA7CgkJCQlfc2V0WyB0aGF0Lm9yaWVudGF0aW9uID09PSAiaG9yaXpvbnRhbCIgPyAibGVmdCIgOiAiYm90dG9tIiBdID0gdmFsUGVyY2VudCArICIlIjsKCQkJCSQoIHRoaXMgKS5zdG9wKCAxLCAxIClbIGFuaW1hdGUgPyAiYW5pbWF0ZSIgOiAiY3NzIiBdKCBfc2V0LCBvLmFuaW1hdGUgKTsKCQkJCWlmICggdGhhdC5vcHRpb25zLnJhbmdlID09PSB0cnVlICkgewoJCQkJCWlmICggdGhhdC5vcmllbnRhdGlvbiA9PT0gImhvcml6b250YWwiICkgewoJCQkJCQlpZiAoIGkgPT09IDAgKSB7CgkJCQkJCQl0aGF0LnJhbmdlLnN0b3AoIDEsIDEgKVsgYW5pbWF0ZSA/ICJhbmltYXRlIiA6ICJjc3MiIF0oIHsgbGVmdDogdmFsUGVyY2VudCArICIlIiB9LCBvLmFuaW1hdGUgKTsKCQkJCQkJfQoJCQkJCQlpZiAoIGkgPT09IDEgKSB7CgkJCQkJCQl0aGF0LnJhbmdlWyBhbmltYXRlID8gImFuaW1hdGUiIDogImNzcyIgXSggeyB3aWR0aDogKCB2YWxQZXJjZW50IC0gbGFzdFZhbFBlcmNlbnQgKSArICIlIiB9LCB7IHF1ZXVlOiBmYWxzZSwgZHVyYXRpb246IG8uYW5pbWF0ZSB9ICk7CgkJCQkJCX0KCQkJCQl9IGVsc2UgewoJCQkJCQlpZiAoIGkgPT09IDAgKSB7CgkJCQkJCQl0aGF0LnJhbmdlLnN0b3AoIDEsIDEgKVsgYW5pbWF0ZSA/ICJhbmltYXRlIiA6ICJjc3MiIF0oIHsgYm90dG9tOiAoIHZhbFBlcmNlbnQgKSArICIlIiB9LCBvLmFuaW1hdGUgKTsKCQkJCQkJfQoJCQkJCQlpZiAoIGkgPT09IDEgKSB7CgkJCQkJCQl0aGF0LnJhbmdlWyBhbmltYXRlID8gImFuaW1hdGUiIDogImNzcyIgXSggeyBoZWlnaHQ6ICggdmFsUGVyY2VudCAtIGxhc3RWYWxQZXJjZW50ICkgKyAiJSIgfSwgeyBxdWV1ZTogZmFsc2UsIGR1cmF0aW9uOiBvLmFuaW1hdGUgfSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJbGFzdFZhbFBlcmNlbnQgPSB2YWxQZXJjZW50OwoJCQl9KTsKCQl9IGVsc2UgewoJCQl2YWx1ZSA9IHRoaXMudmFsdWUoKTsKCQkJdmFsdWVNaW4gPSB0aGlzLl92YWx1ZU1pbigpOwoJCQl2YWx1ZU1heCA9IHRoaXMuX3ZhbHVlTWF4KCk7CgkJCXZhbFBlcmNlbnQgPSAoIHZhbHVlTWF4ICE9PSB2YWx1ZU1pbiApID8KCQkJCQkoIHZhbHVlIC0gdmFsdWVNaW4gKSAvICggdmFsdWVNYXggLSB2YWx1ZU1pbiApICogMTAwIDoKCQkJCQkwOwoJCQlfc2V0WyB0aGlzLm9yaWVudGF0aW9uID09PSAiaG9yaXpvbnRhbCIgPyAibGVmdCIgOiAiYm90dG9tIiBdID0gdmFsUGVyY2VudCArICIlIjsKCQkJdGhpcy5oYW5kbGUuc3RvcCggMSwgMSApWyBhbmltYXRlID8gImFuaW1hdGUiIDogImNzcyIgXSggX3NldCwgby5hbmltYXRlICk7CgoJCQlpZiAoIG9SYW5nZSA9PT0gIm1pbiIgJiYgdGhpcy5vcmllbnRhdGlvbiA9PT0gImhvcml6b250YWwiICkgewoJCQkJdGhpcy5yYW5nZS5zdG9wKCAxLCAxIClbIGFuaW1hdGUgPyAiYW5pbWF0ZSIgOiAiY3NzIiBdKCB7IHdpZHRoOiB2YWxQZXJjZW50ICsgIiUiIH0sIG8uYW5pbWF0ZSApOwoJCQl9CgkJCWlmICggb1JhbmdlID09PSAibWF4IiAmJiB0aGlzLm9yaWVudGF0aW9uID09PSAiaG9yaXpvbnRhbCIgKSB7CgkJCQl0aGlzLnJhbmdlWyBhbmltYXRlID8gImFuaW1hdGUiIDogImNzcyIgXSggeyB3aWR0aDogKCAxMDAgLSB2YWxQZXJjZW50ICkgKyAiJSIgfSwgeyBxdWV1ZTogZmFsc2UsIGR1cmF0aW9uOiBvLmFuaW1hdGUgfSApOwoJCQl9CgkJCWlmICggb1JhbmdlID09PSAibWluIiAmJiB0aGlzLm9yaWVudGF0aW9uID09PSAidmVydGljYWwiICkgewoJCQkJdGhpcy5yYW5nZS5zdG9wKCAxLCAxIClbIGFuaW1hdGUgPyAiYW5pbWF0ZSIgOiAiY3NzIiBdKCB7IGhlaWdodDogdmFsUGVyY2VudCArICIlIiB9LCBvLmFuaW1hdGUgKTsKCQkJfQoJCQlpZiAoIG9SYW5nZSA9PT0gIm1heCIgJiYgdGhpcy5vcmllbnRhdGlvbiA9PT0gInZlcnRpY2FsIiApIHsKCQkJCXRoaXMucmFuZ2VbIGFuaW1hdGUgPyAiYW5pbWF0ZSIgOiAiY3NzIiBdKCB7IGhlaWdodDogKCAxMDAgLSB2YWxQZXJjZW50ICkgKyAiJSIgfSwgeyBxdWV1ZTogZmFsc2UsIGR1cmF0aW9uOiBvLmFuaW1hdGUgfSApOwoJCQl9CgkJfQoJfSwKCglfaGFuZGxlRXZlbnRzOiB7CgkJa2V5ZG93bjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQl2YXIgYWxsb3dlZCwgY3VyVmFsLCBuZXdWYWwsIHN0ZXAsCgkJCQlpbmRleCA9ICQoIGV2ZW50LnRhcmdldCApLmRhdGEoICJ1aS1zbGlkZXItaGFuZGxlLWluZGV4IiApOwoKCQkJc3dpdGNoICggZXZlbnQua2V5Q29kZSApIHsKCQkJCWNhc2UgJC51aS5rZXlDb2RlLkhPTUU6CgkJCQljYXNlICQudWkua2V5Q29kZS5FTkQ6CgkJCQljYXNlICQudWkua2V5Q29kZS5QQUdFX1VQOgoJCQkJY2FzZSAkLnVpLmtleUNvZGUuUEFHRV9ET1dOOgoJCQkJY2FzZSAkLnVpLmtleUNvZGUuVVA6CgkJCQljYXNlICQudWkua2V5Q29kZS5SSUdIVDoKCQkJCWNhc2UgJC51aS5rZXlDb2RlLkRPV046CgkJCQljYXNlICQudWkua2V5Q29kZS5MRUZUOgoJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCQkJaWYgKCAhdGhpcy5fa2V5U2xpZGluZyApIHsKCQkJCQkJdGhpcy5fa2V5U2xpZGluZyA9IHRydWU7CgkJCQkJCSQoIGV2ZW50LnRhcmdldCApLmFkZENsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApOwoJCQkJCQlhbGxvd2VkID0gdGhpcy5fc3RhcnQoIGV2ZW50LCBpbmRleCApOwoJCQkJCQlpZiAoIGFsbG93ZWQgPT09IGZhbHNlICkgewoJCQkJCQkJcmV0dXJuOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWJyZWFrOwoJCQl9CgoJCQlzdGVwID0gdGhpcy5vcHRpb25zLnN0ZXA7CgkJCWlmICggdGhpcy5vcHRpb25zLnZhbHVlcyAmJiB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCApIHsKCQkJCWN1clZhbCA9IG5ld1ZhbCA9IHRoaXMudmFsdWVzKCBpbmRleCApOwoJCQl9IGVsc2UgewoJCQkJY3VyVmFsID0gbmV3VmFsID0gdGhpcy52YWx1ZSgpOwoJCQl9CgoJCQlzd2l0Y2ggKCBldmVudC5rZXlDb2RlICkgewoJCQkJY2FzZSAkLnVpLmtleUNvZGUuSE9NRToKCQkJCQluZXdWYWwgPSB0aGlzLl92YWx1ZU1pbigpOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAkLnVpLmtleUNvZGUuRU5EOgoJCQkJCW5ld1ZhbCA9IHRoaXMuX3ZhbHVlTWF4KCk7CgkJCQkJYnJlYWs7CgkJCQljYXNlICQudWkua2V5Q29kZS5QQUdFX1VQOgoJCQkJCW5ld1ZhbCA9IHRoaXMuX3RyaW1BbGlnblZhbHVlKCBjdXJWYWwgKyAoICh0aGlzLl92YWx1ZU1heCgpIC0gdGhpcy5fdmFsdWVNaW4oKSkgLyBudW1QYWdlcyApICk7CgkJCQkJYnJlYWs7CgkJCQljYXNlICQudWkua2V5Q29kZS5QQUdFX0RPV046CgkJCQkJbmV3VmFsID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoIGN1clZhbCAtICggKHRoaXMuX3ZhbHVlTWF4KCkgLSB0aGlzLl92YWx1ZU1pbigpKSAvIG51bVBhZ2VzICkgKTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJC51aS5rZXlDb2RlLlVQOgoJCQkJY2FzZSAkLnVpLmtleUNvZGUuUklHSFQ6CgkJCQkJaWYgKCBjdXJWYWwgPT09IHRoaXMuX3ZhbHVlTWF4KCkgKSB7CgkJCQkJCXJldHVybjsKCQkJCQl9CgkJCQkJbmV3VmFsID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoIGN1clZhbCArIHN0ZXAgKTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJC51aS5rZXlDb2RlLkRPV046CgkJCQljYXNlICQudWkua2V5Q29kZS5MRUZUOgoJCQkJCWlmICggY3VyVmFsID09PSB0aGlzLl92YWx1ZU1pbigpICkgewoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJCW5ld1ZhbCA9IHRoaXMuX3RyaW1BbGlnblZhbHVlKCBjdXJWYWwgLSBzdGVwICk7CgkJCQkJYnJlYWs7CgkJCX0KCgkJCXRoaXMuX3NsaWRlKCBldmVudCwgaW5kZXgsIG5ld1ZhbCApOwoJCX0sCgkJY2xpY2s6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQl9LAoJCWtleXVwOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCXZhciBpbmRleCA9ICQoIGV2ZW50LnRhcmdldCApLmRhdGEoICJ1aS1zbGlkZXItaGFuZGxlLWluZGV4IiApOwoKCQkJaWYgKCB0aGlzLl9rZXlTbGlkaW5nICkgewoJCQkJdGhpcy5fa2V5U2xpZGluZyA9IGZhbHNlOwoJCQkJdGhpcy5fc3RvcCggZXZlbnQsIGluZGV4ICk7CgkJCQl0aGlzLl9jaGFuZ2UoIGV2ZW50LCBpbmRleCApOwoJCQkJJCggZXZlbnQudGFyZ2V0ICkucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICk7CgkJCX0KCQl9Cgl9Cgp9KTsKCn0oalF1ZXJ5KSk7CgooZnVuY3Rpb24oICQgKSB7CgpmdW5jdGlvbiBtb2RpZmllciggZm4gKSB7CglyZXR1cm4gZnVuY3Rpb24oKSB7CgkJdmFyIHByZXZpb3VzID0gdGhpcy5lbGVtZW50LnZhbCgpOwoJCWZuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQl0aGlzLl9yZWZyZXNoKCk7CgkJaWYgKCBwcmV2aW91cyAhPT0gdGhpcy5lbGVtZW50LnZhbCgpICkgewoJCQl0aGlzLl90cmlnZ2VyKCAiY2hhbmdlIiApOwoJCX0KCX07Cn0KCiQud2lkZ2V0KCAidWkuc3Bpbm5lciIsIHsKCXZlcnNpb246ICIxLjEwLjQiLAoJZGVmYXVsdEVsZW1lbnQ6ICI8aW5wdXQ+IiwKCXdpZGdldEV2ZW50UHJlZml4OiAic3BpbiIsCglvcHRpb25zOiB7CgkJY3VsdHVyZTogbnVsbCwKCQlpY29uczogewoJCQlkb3duOiAidWktaWNvbi10cmlhbmdsZS0xLXMiLAoJCQl1cDogInVpLWljb24tdHJpYW5nbGUtMS1uIgoJCX0sCgkJaW5jcmVtZW50YWw6IHRydWUsCgkJbWF4OiBudWxsLAoJCW1pbjogbnVsbCwKCQludW1iZXJGb3JtYXQ6IG51bGwsCgkJcGFnZTogMTAsCgkJc3RlcDogMSwKCgkJY2hhbmdlOiBudWxsLAoJCXNwaW46IG51bGwsCgkJc3RhcnQ6IG51bGwsCgkJc3RvcDogbnVsbAoJfSwKCglfY3JlYXRlOiBmdW5jdGlvbigpIHsKCQkvLyBoYW5kbGUgc3RyaW5nIHZhbHVlcyB0aGF0IG5lZWQgdG8gYmUgcGFyc2VkCgkJdGhpcy5fc2V0T3B0aW9uKCAibWF4IiwgdGhpcy5vcHRpb25zLm1heCApOwoJCXRoaXMuX3NldE9wdGlvbiggIm1pbiIsIHRoaXMub3B0aW9ucy5taW4gKTsKCQl0aGlzLl9zZXRPcHRpb24oICJzdGVwIiwgdGhpcy5vcHRpb25zLnN0ZXAgKTsKCgkJLy8gT25seSBmb3JtYXQgaWYgdGhlcmUgaXMgYSB2YWx1ZSwgcHJldmVudHMgdGhlIGZpZWxkIGZyb20gYmVpbmcgbWFya2VkCgkJLy8gYXMgaW52YWxpZCBpbiBGaXJlZm94LCBzZWUgIzk1NzMuCgkJaWYgKCB0aGlzLnZhbHVlKCkgIT09ICIiICkgewoJCQkvLyBGb3JtYXQgdGhlIHZhbHVlLCBidXQgZG9uJ3QgY29uc3RyYWluLgoJCQl0aGlzLl92YWx1ZSggdGhpcy5lbGVtZW50LnZhbCgpLCB0cnVlICk7CgkJfQoKCQl0aGlzLl9kcmF3KCk7CgkJdGhpcy5fb24oIHRoaXMuX2V2ZW50cyApOwoJCXRoaXMuX3JlZnJlc2goKTsKCgkJLy8gdHVybmluZyBvZmYgYXV0b2NvbXBsZXRlIHByZXZlbnRzIHRoZSBicm93c2VyIGZyb20gcmVtZW1iZXJpbmcgdGhlCgkJLy8gdmFsdWUgd2hlbiBuYXZpZ2F0aW5nIHRocm91Z2ggaGlzdG9yeSwgc28gd2UgcmUtZW5hYmxlIGF1dG9jb21wbGV0ZQoJCS8vIGlmIHRoZSBwYWdlIGlzIHVubG9hZGVkIGJlZm9yZSB0aGUgd2lkZ2V0IGlzIGRlc3Ryb3llZC4gIzc3OTAKCQl0aGlzLl9vbiggdGhpcy53aW5kb3csIHsKCQkJYmVmb3JldW5sb2FkOiBmdW5jdGlvbigpIHsKCQkJCXRoaXMuZWxlbWVudC5yZW1vdmVBdHRyKCAiYXV0b2NvbXBsZXRlIiApOwoJCQl9CgkJfSk7Cgl9LAoKCV9nZXRDcmVhdGVPcHRpb25zOiBmdW5jdGlvbigpIHsKCQl2YXIgb3B0aW9ucyA9IHt9LAoJCQllbGVtZW50ID0gdGhpcy5lbGVtZW50OwoKCQkkLmVhY2goIFsgIm1pbiIsICJtYXgiLCAic3RlcCIgXSwgZnVuY3Rpb24oIGksIG9wdGlvbiApIHsKCQkJdmFyIHZhbHVlID0gZWxlbWVudC5hdHRyKCBvcHRpb24gKTsKCQkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlLmxlbmd0aCApIHsKCQkJCW9wdGlvbnNbIG9wdGlvbiBdID0gdmFsdWU7CgkJCX0KCQl9KTsKCgkJcmV0dXJuIG9wdGlvbnM7Cgl9LAoKCV9ldmVudHM6IHsKCQlrZXlkb3duOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCWlmICggdGhpcy5fc3RhcnQoIGV2ZW50ICkgJiYgdGhpcy5fa2V5ZG93biggZXZlbnQgKSApIHsKCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCX0KCQl9LAoJCWtleXVwOiAiX3N0b3AiLAoJCWZvY3VzOiBmdW5jdGlvbigpIHsKCQkJdGhpcy5wcmV2aW91cyA9IHRoaXMuZWxlbWVudC52YWwoKTsKCQl9LAoJCWJsdXI6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJaWYgKCB0aGlzLmNhbmNlbEJsdXIgKSB7CgkJCQlkZWxldGUgdGhpcy5jYW5jZWxCbHVyOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQl0aGlzLl9zdG9wKCk7CgkJCXRoaXMuX3JlZnJlc2goKTsKCQkJaWYgKCB0aGlzLnByZXZpb3VzICE9PSB0aGlzLmVsZW1lbnQudmFsKCkgKSB7CgkJCQl0aGlzLl90cmlnZ2VyKCAiY2hhbmdlIiwgZXZlbnQgKTsKCQkJfQoJCX0sCgkJbW91c2V3aGVlbDogZnVuY3Rpb24oIGV2ZW50LCBkZWx0YSApIHsKCQkJaWYgKCAhZGVsdGEgKSB7CgkJCQlyZXR1cm47CgkJCX0KCQkJaWYgKCAhdGhpcy5zcGlubmluZyAmJiAhdGhpcy5fc3RhcnQoIGV2ZW50ICkgKSB7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCgkJCXRoaXMuX3NwaW4oIChkZWx0YSA+IDAgPyAxIDogLTEpICogdGhpcy5vcHRpb25zLnN0ZXAsIGV2ZW50ICk7CgkJCWNsZWFyVGltZW91dCggdGhpcy5tb3VzZXdoZWVsVGltZXIgKTsKCQkJdGhpcy5tb3VzZXdoZWVsVGltZXIgPSB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJCWlmICggdGhpcy5zcGlubmluZyApIHsKCQkJCQl0aGlzLl9zdG9wKCBldmVudCApOwoJCQkJfQoJCQl9LCAxMDAgKTsKCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQl9LAoJCSJtb3VzZWRvd24gLnVpLXNwaW5uZXItYnV0dG9uIjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQl2YXIgcHJldmlvdXM7CgoJCQkvLyBXZSBuZXZlciB3YW50IHRoZSBidXR0b25zIHRvIGhhdmUgZm9jdXM7IHdoZW5ldmVyIHRoZSB1c2VyIGlzCgkJCS8vIGludGVyYWN0aW5nIHdpdGggdGhlIHNwaW5uZXIsIHRoZSBmb2N1cyBzaG91bGQgYmUgb24gdGhlIGlucHV0LgoJCQkvLyBJZiB0aGUgaW5wdXQgaXMgZm9jdXNlZCB0aGVuIHRoaXMucHJldmlvdXMgaXMgcHJvcGVybHkgc2V0IGZyb20KCQkJLy8gd2hlbiB0aGUgaW5wdXQgZmlyc3QgcmVjZWl2ZWQgZm9jdXMuIElmIHRoZSBpbnB1dCBpcyBub3QgZm9jdXNlZAoJCQkvLyB0aGVuIHdlIG5lZWQgdG8gc2V0IHRoaXMucHJldmlvdXMgYmFzZWQgb24gdGhlIHZhbHVlIGJlZm9yZSBzcGlubmluZy4KCQkJcHJldmlvdXMgPSB0aGlzLmVsZW1lbnRbMF0gPT09IHRoaXMuZG9jdW1lbnRbMF0uYWN0aXZlRWxlbWVudCA/CgkJCQl0aGlzLnByZXZpb3VzIDogdGhpcy5lbGVtZW50LnZhbCgpOwoJCQlmdW5jdGlvbiBjaGVja0ZvY3VzKCkgewoJCQkJdmFyIGlzQWN0aXZlID0gdGhpcy5lbGVtZW50WzBdID09PSB0aGlzLmRvY3VtZW50WzBdLmFjdGl2ZUVsZW1lbnQ7CgkJCQlpZiAoICFpc0FjdGl2ZSApIHsKCQkJCQl0aGlzLmVsZW1lbnQuZm9jdXMoKTsKCQkJCQl0aGlzLnByZXZpb3VzID0gcHJldmlvdXM7CgkJCQkJLy8gc3VwcG9ydDogSUUKCQkJCQkvLyBJRSBzZXRzIGZvY3VzIGFzeW5jaHJvbm91c2x5LCBzbyB3ZSBuZWVkIHRvIGNoZWNrIGlmIGZvY3VzCgkJCQkJLy8gbW92ZWQgb2ZmIG9mIHRoZSBpbnB1dCBiZWNhdXNlIHRoZSB1c2VyIGNsaWNrZWQgb24gdGhlIGJ1dHRvbi4KCQkJCQl0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJCQkJdGhpcy5wcmV2aW91cyA9IHByZXZpb3VzOwoJCQkJCX0pOwoJCQkJfQoJCQl9CgoJCQkvLyBlbnN1cmUgZm9jdXMgaXMgb24gKG9yIHN0YXlzIG9uKSB0aGUgdGV4dCBmaWVsZAoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQljaGVja0ZvY3VzLmNhbGwoIHRoaXMgKTsKCgkJCS8vIHN1cHBvcnQ6IElFCgkJCS8vIElFIGRvZXNuJ3QgcHJldmVudCBtb3ZpbmcgZm9jdXMgZXZlbiB3aXRoIGV2ZW50LnByZXZlbnREZWZhdWx0KCkKCQkJLy8gc28gd2Ugc2V0IGEgZmxhZyB0byBrbm93IHdoZW4gd2Ugc2hvdWxkIGlnbm9yZSB0aGUgYmx1ciBldmVudAoJCQkvLyBhbmQgY2hlY2sgKGFnYWluKSBpZiBmb2N1cyBtb3ZlZCBvZmYgb2YgdGhlIGlucHV0LgoJCQl0aGlzLmNhbmNlbEJsdXIgPSB0cnVlOwoJCQl0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJCWRlbGV0ZSB0aGlzLmNhbmNlbEJsdXI7CgkJCQljaGVja0ZvY3VzLmNhbGwoIHRoaXMgKTsKCQkJfSk7CgoJCQlpZiAoIHRoaXMuX3N0YXJ0KCBldmVudCApID09PSBmYWxzZSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJdGhpcy5fcmVwZWF0KCBudWxsLCAkKCBldmVudC5jdXJyZW50VGFyZ2V0ICkuaGFzQ2xhc3MoICJ1aS1zcGlubmVyLXVwIiApID8gMSA6IC0xLCBldmVudCApOwoJCX0sCgkJIm1vdXNldXAgLnVpLXNwaW5uZXItYnV0dG9uIjogIl9zdG9wIiwKCQkibW91c2VlbnRlciAudWktc3Bpbm5lci1idXR0b24iOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCS8vIGJ1dHRvbiB3aWxsIGFkZCB1aS1zdGF0ZS1hY3RpdmUgaWYgbW91c2Ugd2FzIGRvd24gd2hpbGUgbW91c2VsZWF2ZSBhbmQga2VwdCBkb3duCgkJCWlmICggISQoIGV2ZW50LmN1cnJlbnRUYXJnZXQgKS5oYXNDbGFzcyggInVpLXN0YXRlLWFjdGl2ZSIgKSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJaWYgKCB0aGlzLl9zdGFydCggZXZlbnQgKSA9PT0gZmFsc2UgKSB7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJdGhpcy5fcmVwZWF0KCBudWxsLCAkKCBldmVudC5jdXJyZW50VGFyZ2V0ICkuaGFzQ2xhc3MoICJ1aS1zcGlubmVyLXVwIiApID8gMSA6IC0xLCBldmVudCApOwoJCX0sCgkJLy8gVE9ETzogZG8gd2UgcmVhbGx5IHdhbnQgdG8gY29uc2lkZXIgdGhpcyBhIHN0b3A/CgkJLy8gc2hvdWxkbid0IHdlIGp1c3Qgc3RvcCB0aGUgcmVwZWF0ZXIgYW5kIHdhaXQgdW50aWwgbW91c2V1cCBiZWZvcmUKCQkvLyB3ZSB0cmlnZ2VyIHRoZSBzdG9wIGV2ZW50PwoJCSJtb3VzZWxlYXZlIC51aS1zcGlubmVyLWJ1dHRvbiI6ICJfc3RvcCIKCX0sCgoJX2RyYXc6IGZ1bmN0aW9uKCkgewoJCXZhciB1aVNwaW5uZXIgPSB0aGlzLnVpU3Bpbm5lciA9IHRoaXMuZWxlbWVudAoJCQkuYWRkQ2xhc3MoICJ1aS1zcGlubmVyLWlucHV0IiApCgkJCS5hdHRyKCAiYXV0b2NvbXBsZXRlIiwgIm9mZiIgKQoJCQkud3JhcCggdGhpcy5fdWlTcGlubmVySHRtbCgpICkKCQkJLnBhcmVudCgpCgkJCQkvLyBhZGQgYnV0dG9ucwoJCQkJLmFwcGVuZCggdGhpcy5fYnV0dG9uSHRtbCgpICk7CgoJCXRoaXMuZWxlbWVudC5hdHRyKCAicm9sZSIsICJzcGluYnV0dG9uIiApOwoKCQkvLyBidXR0b24gYmluZGluZ3MKCQl0aGlzLmJ1dHRvbnMgPSB1aVNwaW5uZXIuZmluZCggIi51aS1zcGlubmVyLWJ1dHRvbiIgKQoJCQkuYXR0ciggInRhYkluZGV4IiwgLTEgKQoJCQkuYnV0dG9uKCkKCQkJLnJlbW92ZUNsYXNzKCAidWktY29ybmVyLWFsbCIgKTsKCgkJLy8gSUUgNiBkb2Vzbid0IHVuZGVyc3RhbmQgaGVpZ2h0OiA1MCUgZm9yIHRoZSBidXR0b25zCgkJLy8gdW5sZXNzIHRoZSB3cmFwcGVyIGhhcyBhbiBleHBsaWNpdCBoZWlnaHQKCQlpZiAoIHRoaXMuYnV0dG9ucy5oZWlnaHQoKSA+IE1hdGguY2VpbCggdWlTcGlubmVyLmhlaWdodCgpICogMC41ICkgJiYKCQkJCXVpU3Bpbm5lci5oZWlnaHQoKSA+IDAgKSB7CgkJCXVpU3Bpbm5lci5oZWlnaHQoIHVpU3Bpbm5lci5oZWlnaHQoKSApOwoJCX0KCgkJLy8gZGlzYWJsZSBzcGlubmVyIGlmIGVsZW1lbnQgd2FzIGFscmVhZHkgZGlzYWJsZWQKCQlpZiAoIHRoaXMub3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJdGhpcy5kaXNhYmxlKCk7CgkJfQoJfSwKCglfa2V5ZG93bjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCXZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zLAoJCQlrZXlDb2RlID0gJC51aS5rZXlDb2RlOwoKCQlzd2l0Y2ggKCBldmVudC5rZXlDb2RlICkgewoJCWNhc2Uga2V5Q29kZS5VUDoKCQkJdGhpcy5fcmVwZWF0KCBudWxsLCAxLCBldmVudCApOwoJCQlyZXR1cm4gdHJ1ZTsKCQljYXNlIGtleUNvZGUuRE9XTjoKCQkJdGhpcy5fcmVwZWF0KCBudWxsLCAtMSwgZXZlbnQgKTsKCQkJcmV0dXJuIHRydWU7CgkJY2FzZSBrZXlDb2RlLlBBR0VfVVA6CgkJCXRoaXMuX3JlcGVhdCggbnVsbCwgb3B0aW9ucy5wYWdlLCBldmVudCApOwoJCQlyZXR1cm4gdHJ1ZTsKCQljYXNlIGtleUNvZGUuUEFHRV9ET1dOOgoJCQl0aGlzLl9yZXBlYXQoIG51bGwsIC1vcHRpb25zLnBhZ2UsIGV2ZW50ICk7CgkJCXJldHVybiB0cnVlOwoJCX0KCgkJcmV0dXJuIGZhbHNlOwoJfSwKCglfdWlTcGlubmVySHRtbDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuICI8c3BhbiBjbGFzcz0ndWktc3Bpbm5lciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCc+PC9zcGFuPiI7Cgl9LAoKCV9idXR0b25IdG1sOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gIiIgKwoJCQkiPGEgY2xhc3M9J3VpLXNwaW5uZXItYnV0dG9uIHVpLXNwaW5uZXItdXAgdWktY29ybmVyLXRyJz4iICsKCQkJCSI8c3BhbiBjbGFzcz0ndWktaWNvbiAiICsgdGhpcy5vcHRpb25zLmljb25zLnVwICsgIic+JiM5NjUwOzwvc3Bhbj4iICsKCQkJIjwvYT4iICsKCQkJIjxhIGNsYXNzPSd1aS1zcGlubmVyLWJ1dHRvbiB1aS1zcGlubmVyLWRvd24gdWktY29ybmVyLWJyJz4iICsKCQkJCSI8c3BhbiBjbGFzcz0ndWktaWNvbiAiICsgdGhpcy5vcHRpb25zLmljb25zLmRvd24gKyAiJz4mIzk2NjA7PC9zcGFuPiIgKwoJCQkiPC9hPiI7Cgl9LAoKCV9zdGFydDogZnVuY3Rpb24oIGV2ZW50ICkgewoJCWlmICggIXRoaXMuc3Bpbm5pbmcgJiYgdGhpcy5fdHJpZ2dlciggInN0YXJ0IiwgZXZlbnQgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWlmICggIXRoaXMuY291bnRlciApIHsKCQkJdGhpcy5jb3VudGVyID0gMTsKCQl9CgkJdGhpcy5zcGlubmluZyA9IHRydWU7CgkJcmV0dXJuIHRydWU7Cgl9LAoKCV9yZXBlYXQ6IGZ1bmN0aW9uKCBpLCBzdGVwcywgZXZlbnQgKSB7CgkJaSA9IGkgfHwgNTAwOwoKCQljbGVhclRpbWVvdXQoIHRoaXMudGltZXIgKTsKCQl0aGlzLnRpbWVyID0gdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CgkJCXRoaXMuX3JlcGVhdCggNDAsIHN0ZXBzLCBldmVudCApOwoJCX0sIGkgKTsKCgkJdGhpcy5fc3Bpbiggc3RlcHMgKiB0aGlzLm9wdGlvbnMuc3RlcCwgZXZlbnQgKTsKCX0sCgoJX3NwaW46IGZ1bmN0aW9uKCBzdGVwLCBldmVudCApIHsKCQl2YXIgdmFsdWUgPSB0aGlzLnZhbHVlKCkgfHwgMDsKCgkJaWYgKCAhdGhpcy5jb3VudGVyICkgewoJCQl0aGlzLmNvdW50ZXIgPSAxOwoJCX0KCgkJdmFsdWUgPSB0aGlzLl9hZGp1c3RWYWx1ZSggdmFsdWUgKyBzdGVwICogdGhpcy5faW5jcmVtZW50KCB0aGlzLmNvdW50ZXIgKSApOwoKCQlpZiAoICF0aGlzLnNwaW5uaW5nIHx8IHRoaXMuX3RyaWdnZXIoICJzcGluIiwgZXZlbnQsIHsgdmFsdWU6IHZhbHVlIH0gKSAhPT0gZmFsc2UpIHsKCQkJdGhpcy5fdmFsdWUoIHZhbHVlICk7CgkJCXRoaXMuY291bnRlcisrOwoJCX0KCX0sCgoJX2luY3JlbWVudDogZnVuY3Rpb24oIGkgKSB7CgkJdmFyIGluY3JlbWVudGFsID0gdGhpcy5vcHRpb25zLmluY3JlbWVudGFsOwoKCQlpZiAoIGluY3JlbWVudGFsICkgewoJCQlyZXR1cm4gJC5pc0Z1bmN0aW9uKCBpbmNyZW1lbnRhbCApID8KCQkJCWluY3JlbWVudGFsKCBpICkgOgoJCQkJTWF0aC5mbG9vciggaSppKmkvNTAwMDAgLSBpKmkvNTAwICsgMTcqaS8yMDAgKyAxICk7CgkJfQoKCQlyZXR1cm4gMTsKCX0sCgoJX3ByZWNpc2lvbjogZnVuY3Rpb24oKSB7CgkJdmFyIHByZWNpc2lvbiA9IHRoaXMuX3ByZWNpc2lvbk9mKCB0aGlzLm9wdGlvbnMuc3RlcCApOwoJCWlmICggdGhpcy5vcHRpb25zLm1pbiAhPT0gbnVsbCApIHsKCQkJcHJlY2lzaW9uID0gTWF0aC5tYXgoIHByZWNpc2lvbiwgdGhpcy5fcHJlY2lzaW9uT2YoIHRoaXMub3B0aW9ucy5taW4gKSApOwoJCX0KCQlyZXR1cm4gcHJlY2lzaW9uOwoJfSwKCglfcHJlY2lzaW9uT2Y6IGZ1bmN0aW9uKCBudW0gKSB7CgkJdmFyIHN0ciA9IG51bS50b1N0cmluZygpLAoJCQlkZWNpbWFsID0gc3RyLmluZGV4T2YoICIuIiApOwoJCXJldHVybiBkZWNpbWFsID09PSAtMSA/IDAgOiBzdHIubGVuZ3RoIC0gZGVjaW1hbCAtIDE7Cgl9LAoKCV9hZGp1c3RWYWx1ZTogZnVuY3Rpb24oIHZhbHVlICkgewoJCXZhciBiYXNlLCBhYm92ZU1pbiwKCQkJb3B0aW9ucyA9IHRoaXMub3B0aW9uczsKCgkJLy8gbWFrZSBzdXJlIHdlJ3JlIGF0IGEgdmFsaWQgc3RlcAoJCS8vIC0gZmluZCBvdXQgd2hlcmUgd2UgYXJlIHJlbGF0aXZlIHRvIHRoZSBiYXNlIChtaW4gb3IgMCkKCQliYXNlID0gb3B0aW9ucy5taW4gIT09IG51bGwgPyBvcHRpb25zLm1pbiA6IDA7CgkJYWJvdmVNaW4gPSB2YWx1ZSAtIGJhc2U7CgkJLy8gLSByb3VuZCB0byB0aGUgbmVhcmVzdCBzdGVwCgkJYWJvdmVNaW4gPSBNYXRoLnJvdW5kKGFib3ZlTWluIC8gb3B0aW9ucy5zdGVwKSAqIG9wdGlvbnMuc3RlcDsKCQkvLyAtIHJvdW5kaW5nIGlzIGJhc2VkIG9uIDAsIHNvIGFkanVzdCBiYWNrIHRvIG91ciBiYXNlCgkJdmFsdWUgPSBiYXNlICsgYWJvdmVNaW47CgoJCS8vIGZpeCBwcmVjaXNpb24gZnJvbSBiYWQgSlMgZmxvYXRpbmcgcG9pbnQgbWF0aAoJCXZhbHVlID0gcGFyc2VGbG9hdCggdmFsdWUudG9GaXhlZCggdGhpcy5fcHJlY2lzaW9uKCkgKSApOwoKCQkvLyBjbGFtcCB0aGUgdmFsdWUKCQlpZiAoIG9wdGlvbnMubWF4ICE9PSBudWxsICYmIHZhbHVlID4gb3B0aW9ucy5tYXgpIHsKCQkJcmV0dXJuIG9wdGlvbnMubWF4OwoJCX0KCQlpZiAoIG9wdGlvbnMubWluICE9PSBudWxsICYmIHZhbHVlIDwgb3B0aW9ucy5taW4gKSB7CgkJCXJldHVybiBvcHRpb25zLm1pbjsKCQl9CgoJCXJldHVybiB2YWx1ZTsKCX0sCgoJX3N0b3A6IGZ1bmN0aW9uKCBldmVudCApIHsKCQlpZiAoICF0aGlzLnNwaW5uaW5nICkgewoJCQlyZXR1cm47CgkJfQoKCQljbGVhclRpbWVvdXQoIHRoaXMudGltZXIgKTsKCQljbGVhclRpbWVvdXQoIHRoaXMubW91c2V3aGVlbFRpbWVyICk7CgkJdGhpcy5jb3VudGVyID0gMDsKCQl0aGlzLnNwaW5uaW5nID0gZmFsc2U7CgkJdGhpcy5fdHJpZ2dlciggInN0b3AiLCBldmVudCApOwoJfSwKCglfc2V0T3B0aW9uOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQlpZiAoIGtleSA9PT0gImN1bHR1cmUiIHx8IGtleSA9PT0gIm51bWJlckZvcm1hdCIgKSB7CgkJCXZhciBwcmV2VmFsdWUgPSB0aGlzLl9wYXJzZSggdGhpcy5lbGVtZW50LnZhbCgpICk7CgkJCXRoaXMub3B0aW9uc1sga2V5IF0gPSB2YWx1ZTsKCQkJdGhpcy5lbGVtZW50LnZhbCggdGhpcy5fZm9ybWF0KCBwcmV2VmFsdWUgKSApOwoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIGtleSA9PT0gIm1heCIgfHwga2V5ID09PSAibWluIiB8fCBrZXkgPT09ICJzdGVwIiApIHsKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICkgewoJCQkJdmFsdWUgPSB0aGlzLl9wYXJzZSggdmFsdWUgKTsKCQkJfQoJCX0KCQlpZiAoIGtleSA9PT0gImljb25zIiApIHsKCQkJdGhpcy5idXR0b25zLmZpcnN0KCkuZmluZCggIi51aS1pY29uIiApCgkJCQkucmVtb3ZlQ2xhc3MoIHRoaXMub3B0aW9ucy5pY29ucy51cCApCgkJCQkuYWRkQ2xhc3MoIHZhbHVlLnVwICk7CgkJCXRoaXMuYnV0dG9ucy5sYXN0KCkuZmluZCggIi51aS1pY29uIiApCgkJCQkucmVtb3ZlQ2xhc3MoIHRoaXMub3B0aW9ucy5pY29ucy5kb3duICkKCQkJCS5hZGRDbGFzcyggdmFsdWUuZG93biApOwoJCX0KCgkJdGhpcy5fc3VwZXIoIGtleSwgdmFsdWUgKTsKCgkJaWYgKCBrZXkgPT09ICJkaXNhYmxlZCIgKSB7CgkJCWlmICggdmFsdWUgKSB7CgkJCQl0aGlzLmVsZW1lbnQucHJvcCggImRpc2FibGVkIiwgdHJ1ZSApOwoJCQkJdGhpcy5idXR0b25zLmJ1dHRvbiggImRpc2FibGUiICk7CgkJCX0gZWxzZSB7CgkJCQl0aGlzLmVsZW1lbnQucHJvcCggImRpc2FibGVkIiwgZmFsc2UgKTsKCQkJCXRoaXMuYnV0dG9ucy5idXR0b24oICJlbmFibGUiICk7CgkJCX0KCQl9Cgl9LAoKCV9zZXRPcHRpb25zOiBtb2RpZmllcihmdW5jdGlvbiggb3B0aW9ucyApIHsKCQl0aGlzLl9zdXBlciggb3B0aW9ucyApOwoJCXRoaXMuX3ZhbHVlKCB0aGlzLmVsZW1lbnQudmFsKCkgKTsKCX0pLAoKCV9wYXJzZTogZnVuY3Rpb24oIHZhbCApIHsKCQlpZiAoIHR5cGVvZiB2YWwgPT09ICJzdHJpbmciICYmIHZhbCAhPT0gIiIgKSB7CgkJCXZhbCA9IHdpbmRvdy5HbG9iYWxpemUgJiYgdGhpcy5vcHRpb25zLm51bWJlckZvcm1hdCA/CgkJCQlHbG9iYWxpemUucGFyc2VGbG9hdCggdmFsLCAxMCwgdGhpcy5vcHRpb25zLmN1bHR1cmUgKSA6ICt2YWw7CgkJfQoJCXJldHVybiB2YWwgPT09ICIiIHx8IGlzTmFOKCB2YWwgKSA/IG51bGwgOiB2YWw7Cgl9LAoKCV9mb3JtYXQ6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQlpZiAoIHZhbHVlID09PSAiIiApIHsKCQkJcmV0dXJuICIiOwoJCX0KCQlyZXR1cm4gd2luZG93Lkdsb2JhbGl6ZSAmJiB0aGlzLm9wdGlvbnMubnVtYmVyRm9ybWF0ID8KCQkJR2xvYmFsaXplLmZvcm1hdCggdmFsdWUsIHRoaXMub3B0aW9ucy5udW1iZXJGb3JtYXQsIHRoaXMub3B0aW9ucy5jdWx0dXJlICkgOgoJCQl2YWx1ZTsKCX0sCgoJX3JlZnJlc2g6IGZ1bmN0aW9uKCkgewoJCXRoaXMuZWxlbWVudC5hdHRyKHsKCQkJImFyaWEtdmFsdWVtaW4iOiB0aGlzLm9wdGlvbnMubWluLAoJCQkiYXJpYS12YWx1ZW1heCI6IHRoaXMub3B0aW9ucy5tYXgsCgkJCS8vIFRPRE86IHdoYXQgc2hvdWxkIHdlIGRvIHdpdGggdmFsdWVzIHRoYXQgY2FuJ3QgYmUgcGFyc2VkPwoJCQkiYXJpYS12YWx1ZW5vdyI6IHRoaXMuX3BhcnNlKCB0aGlzLmVsZW1lbnQudmFsKCkgKQoJCX0pOwoJfSwKCgkvLyB1cGRhdGUgdGhlIHZhbHVlIHdpdGhvdXQgdHJpZ2dlcmluZyBjaGFuZ2UKCV92YWx1ZTogZnVuY3Rpb24oIHZhbHVlLCBhbGxvd0FueSApIHsKCQl2YXIgcGFyc2VkOwoJCWlmICggdmFsdWUgIT09ICIiICkgewoJCQlwYXJzZWQgPSB0aGlzLl9wYXJzZSggdmFsdWUgKTsKCQkJaWYgKCBwYXJzZWQgIT09IG51bGwgKSB7CgkJCQlpZiAoICFhbGxvd0FueSApIHsKCQkJCQlwYXJzZWQgPSB0aGlzLl9hZGp1c3RWYWx1ZSggcGFyc2VkICk7CgkJCQl9CgkJCQl2YWx1ZSA9IHRoaXMuX2Zvcm1hdCggcGFyc2VkICk7CgkJCX0KCQl9CgkJdGhpcy5lbGVtZW50LnZhbCggdmFsdWUgKTsKCQl0aGlzLl9yZWZyZXNoKCk7Cgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQl0aGlzLmVsZW1lbnQKCQkJLnJlbW92ZUNsYXNzKCAidWktc3Bpbm5lci1pbnB1dCIgKQoJCQkucHJvcCggImRpc2FibGVkIiwgZmFsc2UgKQoJCQkucmVtb3ZlQXR0ciggImF1dG9jb21wbGV0ZSIgKQoJCQkucmVtb3ZlQXR0ciggInJvbGUiICkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLXZhbHVlbWluIiApCgkJCS5yZW1vdmVBdHRyKCAiYXJpYS12YWx1ZW1heCIgKQoJCQkucmVtb3ZlQXR0ciggImFyaWEtdmFsdWVub3ciICk7CgkJdGhpcy51aVNwaW5uZXIucmVwbGFjZVdpdGgoIHRoaXMuZWxlbWVudCApOwoJfSwKCglzdGVwVXA6IG1vZGlmaWVyKGZ1bmN0aW9uKCBzdGVwcyApIHsKCQl0aGlzLl9zdGVwVXAoIHN0ZXBzICk7Cgl9KSwKCV9zdGVwVXA6IGZ1bmN0aW9uKCBzdGVwcyApIHsKCQlpZiAoIHRoaXMuX3N0YXJ0KCkgKSB7CgkJCXRoaXMuX3NwaW4oIChzdGVwcyB8fCAxKSAqIHRoaXMub3B0aW9ucy5zdGVwICk7CgkJCXRoaXMuX3N0b3AoKTsKCQl9Cgl9LAoKCXN0ZXBEb3duOiBtb2RpZmllcihmdW5jdGlvbiggc3RlcHMgKSB7CgkJdGhpcy5fc3RlcERvd24oIHN0ZXBzICk7Cgl9KSwKCV9zdGVwRG93bjogZnVuY3Rpb24oIHN0ZXBzICkgewoJCWlmICggdGhpcy5fc3RhcnQoKSApIHsKCQkJdGhpcy5fc3BpbiggKHN0ZXBzIHx8IDEpICogLXRoaXMub3B0aW9ucy5zdGVwICk7CgkJCXRoaXMuX3N0b3AoKTsKCQl9Cgl9LAoKCXBhZ2VVcDogbW9kaWZpZXIoZnVuY3Rpb24oIHBhZ2VzICkgewoJCXRoaXMuX3N0ZXBVcCggKHBhZ2VzIHx8IDEpICogdGhpcy5vcHRpb25zLnBhZ2UgKTsKCX0pLAoKCXBhZ2VEb3duOiBtb2RpZmllcihmdW5jdGlvbiggcGFnZXMgKSB7CgkJdGhpcy5fc3RlcERvd24oIChwYWdlcyB8fCAxKSAqIHRoaXMub3B0aW9ucy5wYWdlICk7Cgl9KSwKCgl2YWx1ZTogZnVuY3Rpb24oIG5ld1ZhbCApIHsKCQlpZiAoICFhcmd1bWVudHMubGVuZ3RoICkgewoJCQlyZXR1cm4gdGhpcy5fcGFyc2UoIHRoaXMuZWxlbWVudC52YWwoKSApOwoJCX0KCQltb2RpZmllciggdGhpcy5fdmFsdWUgKS5jYWxsKCB0aGlzLCBuZXdWYWwgKTsKCX0sCgoJd2lkZ2V0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy51aVNwaW5uZXI7Cgl9Cn0pOwoKfSggalF1ZXJ5ICkgKTsKCihmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkgewoKdmFyIHRhYklkID0gMCwKCXJoYXNoID0gLyMuKiQvOwoKZnVuY3Rpb24gZ2V0TmV4dFRhYklkKCkgewoJcmV0dXJuICsrdGFiSWQ7Cn0KCmZ1bmN0aW9uIGlzTG9jYWwoIGFuY2hvciApIHsKCS8vIHN1cHBvcnQ6IElFNwoJLy8gSUU3IGRvZXNuJ3Qgbm9ybWFsaXplIHRoZSBocmVmIHByb3BlcnR5IHdoZW4gc2V0IHZpYSBzY3JpcHQgKCM5MzE3KQoJYW5jaG9yID0gYW5jaG9yLmNsb25lTm9kZSggZmFsc2UgKTsKCglyZXR1cm4gYW5jaG9yLmhhc2gubGVuZ3RoID4gMSAmJgoJCWRlY29kZVVSSUNvbXBvbmVudCggYW5jaG9yLmhyZWYucmVwbGFjZSggcmhhc2gsICIiICkgKSA9PT0KCQkJZGVjb2RlVVJJQ29tcG9uZW50KCBsb2NhdGlvbi5ocmVmLnJlcGxhY2UoIHJoYXNoLCAiIiApICk7Cn0KCiQud2lkZ2V0KCAidWkudGFicyIsIHsKCXZlcnNpb246ICIxLjEwLjQiLAoJZGVsYXk6IDMwMCwKCW9wdGlvbnM6IHsKCQlhY3RpdmU6IG51bGwsCgkJY29sbGFwc2libGU6IGZhbHNlLAoJCWV2ZW50OiAiY2xpY2siLAoJCWhlaWdodFN0eWxlOiAiY29udGVudCIsCgkJaGlkZTogbnVsbCwKCQlzaG93OiBudWxsLAoKCQkvLyBjYWxsYmFja3MKCQlhY3RpdmF0ZTogbnVsbCwKCQliZWZvcmVBY3RpdmF0ZTogbnVsbCwKCQliZWZvcmVMb2FkOiBudWxsLAoJCWxvYWQ6IG51bGwKCX0sCgoJX2NyZWF0ZTogZnVuY3Rpb24oKSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlvcHRpb25zID0gdGhpcy5vcHRpb25zOwoKCQl0aGlzLnJ1bm5pbmcgPSBmYWxzZTsKCgkJdGhpcy5lbGVtZW50CgkJCS5hZGRDbGFzcyggInVpLXRhYnMgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiICkKCQkJLnRvZ2dsZUNsYXNzKCAidWktdGFicy1jb2xsYXBzaWJsZSIsIG9wdGlvbnMuY29sbGFwc2libGUgKQoJCQkvLyBQcmV2ZW50IHVzZXJzIGZyb20gZm9jdXNpbmcgZGlzYWJsZWQgdGFicyB2aWEgY2xpY2sKCQkJLmRlbGVnYXRlKCAiLnVpLXRhYnMtbmF2ID4gbGkiLCAibW91c2Vkb3duIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCWlmICggJCggdGhpcyApLmlzKCAiLnVpLXN0YXRlLWRpc2FibGVkIiApICkgewoJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCQl9CgkJCX0pCgkJCS8vIHN1cHBvcnQ6IElFIDw5CgkJCS8vIFByZXZlbnRpbmcgdGhlIGRlZmF1bHQgYWN0aW9uIGluIG1vdXNlZG93biBkb2Vzbid0IHByZXZlbnQgSUUKCQkJLy8gZnJvbSBmb2N1c2luZyB0aGUgZWxlbWVudCwgc28gaWYgdGhlIGFuY2hvciBnZXRzIGZvY3VzZWQsIGJsdXIuCgkJCS8vIFdlIGRvbid0IGhhdmUgdG8gd29ycnkgYWJvdXQgZm9jdXNpbmcgdGhlIHByZXZpb3VzbHkgZm9jdXNlZAoJCQkvLyBlbGVtZW50IHNpbmNlIGNsaWNraW5nIG9uIGEgbm9uLWZvY3VzYWJsZSBlbGVtZW50IHNob3VsZCBmb2N1cwoJCQkvLyB0aGUgYm9keSBhbnl3YXkuCgkJCS5kZWxlZ2F0ZSggIi51aS10YWJzLWFuY2hvciIsICJmb2N1cyIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbigpIHsKCQkJCWlmICggJCggdGhpcyApLmNsb3Nlc3QoICJsaSIgKS5pcyggIi51aS1zdGF0ZS1kaXNhYmxlZCIgKSApIHsKCQkJCQl0aGlzLmJsdXIoKTsKCQkJCX0KCQkJfSk7CgoJCXRoaXMuX3Byb2Nlc3NUYWJzKCk7CgkJb3B0aW9ucy5hY3RpdmUgPSB0aGlzLl9pbml0aWFsQWN0aXZlKCk7CgoJCS8vIFRha2UgZGlzYWJsaW5nIHRhYnMgdmlhIGNsYXNzIGF0dHJpYnV0ZSBmcm9tIEhUTUwKCQkvLyBpbnRvIGFjY291bnQgYW5kIHVwZGF0ZSBvcHRpb24gcHJvcGVybHkuCgkJaWYgKCAkLmlzQXJyYXkoIG9wdGlvbnMuZGlzYWJsZWQgKSApIHsKCQkJb3B0aW9ucy5kaXNhYmxlZCA9ICQudW5pcXVlKCBvcHRpb25zLmRpc2FibGVkLmNvbmNhdCgKCQkJCSQubWFwKCB0aGlzLnRhYnMuZmlsdGVyKCAiLnVpLXN0YXRlLWRpc2FibGVkIiApLCBmdW5jdGlvbiggbGkgKSB7CgkJCQkJcmV0dXJuIHRoYXQudGFicy5pbmRleCggbGkgKTsKCQkJCX0pCgkJCSkgKS5zb3J0KCk7CgkJfQoKCQkvLyBjaGVjayBmb3IgbGVuZ3RoIGF2b2lkcyBlcnJvciB3aGVuIGluaXRpYWxpemluZyBlbXB0eSBsaXN0CgkJaWYgKCB0aGlzLm9wdGlvbnMuYWN0aXZlICE9PSBmYWxzZSAmJiB0aGlzLmFuY2hvcnMubGVuZ3RoICkgewoJCQl0aGlzLmFjdGl2ZSA9IHRoaXMuX2ZpbmRBY3RpdmUoIG9wdGlvbnMuYWN0aXZlICk7CgkJfSBlbHNlIHsKCQkJdGhpcy5hY3RpdmUgPSAkKCk7CgkJfQoKCQl0aGlzLl9yZWZyZXNoKCk7CgoJCWlmICggdGhpcy5hY3RpdmUubGVuZ3RoICkgewoJCQl0aGlzLmxvYWQoIG9wdGlvbnMuYWN0aXZlICk7CgkJfQoJfSwKCglfaW5pdGlhbEFjdGl2ZTogZnVuY3Rpb24oKSB7CgkJdmFyIGFjdGl2ZSA9IHRoaXMub3B0aW9ucy5hY3RpdmUsCgkJCWNvbGxhcHNpYmxlID0gdGhpcy5vcHRpb25zLmNvbGxhcHNpYmxlLAoJCQlsb2NhdGlvbkhhc2ggPSBsb2NhdGlvbi5oYXNoLnN1YnN0cmluZyggMSApOwoKCQlpZiAoIGFjdGl2ZSA9PT0gbnVsbCApIHsKCQkJLy8gY2hlY2sgdGhlIGZyYWdtZW50IGlkZW50aWZpZXIgaW4gdGhlIFVSTAoJCQlpZiAoIGxvY2F0aW9uSGFzaCApIHsKCQkJCXRoaXMudGFicy5lYWNoKGZ1bmN0aW9uKCBpLCB0YWIgKSB7CgkJCQkJaWYgKCAkKCB0YWIgKS5hdHRyKCAiYXJpYS1jb250cm9scyIgKSA9PT0gbG9jYXRpb25IYXNoICkgewoJCQkJCQlhY3RpdmUgPSBpOwoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfSk7CgkJCX0KCgkJCS8vIGNoZWNrIGZvciBhIHRhYiBtYXJrZWQgYWN0aXZlIHZpYSBhIGNsYXNzCgkJCWlmICggYWN0aXZlID09PSBudWxsICkgewoJCQkJYWN0aXZlID0gdGhpcy50YWJzLmluZGV4KCB0aGlzLnRhYnMuZmlsdGVyKCAiLnVpLXRhYnMtYWN0aXZlIiApICk7CgkJCX0KCgkJCS8vIG5vIGFjdGl2ZSB0YWIsIHNldCB0byBmYWxzZQoJCQlpZiAoIGFjdGl2ZSA9PT0gbnVsbCB8fCBhY3RpdmUgPT09IC0xICkgewoJCQkJYWN0aXZlID0gdGhpcy50YWJzLmxlbmd0aCA/IDAgOiBmYWxzZTsKCQkJfQoJCX0KCgkJLy8gaGFuZGxlIG51bWJlcnM6IG5lZ2F0aXZlLCBvdXQgb2YgcmFuZ2UKCQlpZiAoIGFjdGl2ZSAhPT0gZmFsc2UgKSB7CgkJCWFjdGl2ZSA9IHRoaXMudGFicy5pbmRleCggdGhpcy50YWJzLmVxKCBhY3RpdmUgKSApOwoJCQlpZiAoIGFjdGl2ZSA9PT0gLTEgKSB7CgkJCQlhY3RpdmUgPSBjb2xsYXBzaWJsZSA/IGZhbHNlIDogMDsKCQkJfQoJCX0KCgkJLy8gZG9uJ3QgYWxsb3cgY29sbGFwc2libGU6IGZhbHNlIGFuZCBhY3RpdmU6IGZhbHNlCgkJaWYgKCAhY29sbGFwc2libGUgJiYgYWN0aXZlID09PSBmYWxzZSAmJiB0aGlzLmFuY2hvcnMubGVuZ3RoICkgewoJCQlhY3RpdmUgPSAwOwoJCX0KCgkJcmV0dXJuIGFjdGl2ZTsKCX0sCgoJX2dldENyZWF0ZUV2ZW50RGF0YTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHsKCQkJdGFiOiB0aGlzLmFjdGl2ZSwKCQkJcGFuZWw6ICF0aGlzLmFjdGl2ZS5sZW5ndGggPyAkKCkgOiB0aGlzLl9nZXRQYW5lbEZvclRhYiggdGhpcy5hY3RpdmUgKQoJCX07Cgl9LAoKCV90YWJLZXlkb3duOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJdmFyIGZvY3VzZWRUYWIgPSAkKCB0aGlzLmRvY3VtZW50WzBdLmFjdGl2ZUVsZW1lbnQgKS5jbG9zZXN0KCAibGkiICksCgkJCXNlbGVjdGVkSW5kZXggPSB0aGlzLnRhYnMuaW5kZXgoIGZvY3VzZWRUYWIgKSwKCQkJZ29pbmdGb3J3YXJkID0gdHJ1ZTsKCgkJaWYgKCB0aGlzLl9oYW5kbGVQYWdlTmF2KCBldmVudCApICkgewoJCQlyZXR1cm47CgkJfQoKCQlzd2l0Y2ggKCBldmVudC5rZXlDb2RlICkgewoJCQljYXNlICQudWkua2V5Q29kZS5SSUdIVDoKCQkJY2FzZSAkLnVpLmtleUNvZGUuRE9XTjoKCQkJCXNlbGVjdGVkSW5kZXgrKzsKCQkJCWJyZWFrOwoJCQljYXNlICQudWkua2V5Q29kZS5VUDoKCQkJY2FzZSAkLnVpLmtleUNvZGUuTEVGVDoKCQkJCWdvaW5nRm9yd2FyZCA9IGZhbHNlOwoJCQkJc2VsZWN0ZWRJbmRleC0tOwoJCQkJYnJlYWs7CgkJCWNhc2UgJC51aS5rZXlDb2RlLkVORDoKCQkJCXNlbGVjdGVkSW5kZXggPSB0aGlzLmFuY2hvcnMubGVuZ3RoIC0gMTsKCQkJCWJyZWFrOwoJCQljYXNlICQudWkua2V5Q29kZS5IT01FOgoJCQkJc2VsZWN0ZWRJbmRleCA9IDA7CgkJCQlicmVhazsKCQkJY2FzZSAkLnVpLmtleUNvZGUuU1BBQ0U6CgkJCQkvLyBBY3RpdmF0ZSBvbmx5LCBubyBjb2xsYXBzaW5nCgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJY2xlYXJUaW1lb3V0KCB0aGlzLmFjdGl2YXRpbmcgKTsKCQkJCXRoaXMuX2FjdGl2YXRlKCBzZWxlY3RlZEluZGV4ICk7CgkJCQlyZXR1cm47CgkJCWNhc2UgJC51aS5rZXlDb2RlLkVOVEVSOgoJCQkJLy8gVG9nZ2xlIChjYW5jZWwgZGVsYXllZCBhY3RpdmF0aW9uLCBhbGxvdyBjb2xsYXBzaW5nKQoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCWNsZWFyVGltZW91dCggdGhpcy5hY3RpdmF0aW5nICk7CgkJCQkvLyBEZXRlcm1pbmUgaWYgd2Ugc2hvdWxkIGNvbGxhcHNlIG9yIGFjdGl2YXRlCgkJCQl0aGlzLl9hY3RpdmF0ZSggc2VsZWN0ZWRJbmRleCA9PT0gdGhpcy5vcHRpb25zLmFjdGl2ZSA/IGZhbHNlIDogc2VsZWN0ZWRJbmRleCApOwoJCQkJcmV0dXJuOwoJCQlkZWZhdWx0OgoJCQkJcmV0dXJuOwoJCX0KCgkJLy8gRm9jdXMgdGhlIGFwcHJvcHJpYXRlIHRhYiwgYmFzZWQgb24gd2hpY2gga2V5IHdhcyBwcmVzc2VkCgkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQljbGVhclRpbWVvdXQoIHRoaXMuYWN0aXZhdGluZyApOwoJCXNlbGVjdGVkSW5kZXggPSB0aGlzLl9mb2N1c05leHRUYWIoIHNlbGVjdGVkSW5kZXgsIGdvaW5nRm9yd2FyZCApOwoKCQkvLyBOYXZpZ2F0aW5nIHdpdGggY29udHJvbCBrZXkgd2lsbCBwcmV2ZW50IGF1dG9tYXRpYyBhY3RpdmF0aW9uCgkJaWYgKCAhZXZlbnQuY3RybEtleSApIHsKCQkJLy8gVXBkYXRlIGFyaWEtc2VsZWN0ZWQgaW1tZWRpYXRlbHkgc28gdGhhdCBBVCB0aGluayB0aGUgdGFiIGlzIGFscmVhZHkgc2VsZWN0ZWQuCgkJCS8vIE90aGVyd2lzZSBBVCBtYXkgY29uZnVzZSB0aGUgdXNlciBieSBzdGF0aW5nIHRoYXQgdGhleSBuZWVkIHRvIGFjdGl2YXRlIHRoZSB0YWIsCgkJCS8vIGJ1dCB0aGUgdGFiIHdpbGwgYWxyZWFkeSBiZSBhY3RpdmF0ZWQgYnkgdGhlIHRpbWUgdGhlIGFubm91bmNlbWVudCBmaW5pc2hlcy4KCQkJZm9jdXNlZFRhYi5hdHRyKCAiYXJpYS1zZWxlY3RlZCIsICJmYWxzZSIgKTsKCQkJdGhpcy50YWJzLmVxKCBzZWxlY3RlZEluZGV4ICkuYXR0ciggImFyaWEtc2VsZWN0ZWQiLCAidHJ1ZSIgKTsKCgkJCXRoaXMuYWN0aXZhdGluZyA9IHRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQkJdGhpcy5vcHRpb24oICJhY3RpdmUiLCBzZWxlY3RlZEluZGV4ICk7CgkJCX0sIHRoaXMuZGVsYXkgKTsKCQl9Cgl9LAoKCV9wYW5lbEtleWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQlpZiAoIHRoaXMuX2hhbmRsZVBhZ2VOYXYoIGV2ZW50ICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIEN0cmwrdXAgbW92ZXMgZm9jdXMgdG8gdGhlIGN1cnJlbnQgdGFiCgkJaWYgKCBldmVudC5jdHJsS2V5ICYmIGV2ZW50LmtleUNvZGUgPT09ICQudWkua2V5Q29kZS5VUCApIHsKCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJdGhpcy5hY3RpdmUuZm9jdXMoKTsKCQl9Cgl9LAoKCS8vIEFsdCtwYWdlIHVwL2Rvd24gbW92ZXMgZm9jdXMgdG8gdGhlIHByZXZpb3VzL25leHQgdGFiIChhbmQgYWN0aXZhdGVzKQoJX2hhbmRsZVBhZ2VOYXY6IGZ1bmN0aW9uKCBldmVudCApIHsKCQlpZiAoIGV2ZW50LmFsdEtleSAmJiBldmVudC5rZXlDb2RlID09PSAkLnVpLmtleUNvZGUuUEFHRV9VUCApIHsKCQkJdGhpcy5fYWN0aXZhdGUoIHRoaXMuX2ZvY3VzTmV4dFRhYiggdGhpcy5vcHRpb25zLmFjdGl2ZSAtIDEsIGZhbHNlICkgKTsKCQkJcmV0dXJuIHRydWU7CgkJfQoJCWlmICggZXZlbnQuYWx0S2V5ICYmIGV2ZW50LmtleUNvZGUgPT09ICQudWkua2V5Q29kZS5QQUdFX0RPV04gKSB7CgkJCXRoaXMuX2FjdGl2YXRlKCB0aGlzLl9mb2N1c05leHRUYWIoIHRoaXMub3B0aW9ucy5hY3RpdmUgKyAxLCB0cnVlICkgKTsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfSwKCglfZmluZE5leHRUYWI6IGZ1bmN0aW9uKCBpbmRleCwgZ29pbmdGb3J3YXJkICkgewoJCXZhciBsYXN0VGFiSW5kZXggPSB0aGlzLnRhYnMubGVuZ3RoIC0gMTsKCgkJZnVuY3Rpb24gY29uc3RyYWluKCkgewoJCQlpZiAoIGluZGV4ID4gbGFzdFRhYkluZGV4ICkgewoJCQkJaW5kZXggPSAwOwoJCQl9CgkJCWlmICggaW5kZXggPCAwICkgewoJCQkJaW5kZXggPSBsYXN0VGFiSW5kZXg7CgkJCX0KCQkJcmV0dXJuIGluZGV4OwoJCX0KCgkJd2hpbGUgKCAkLmluQXJyYXkoIGNvbnN0cmFpbigpLCB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgKSAhPT0gLTEgKSB7CgkJCWluZGV4ID0gZ29pbmdGb3J3YXJkID8gaW5kZXggKyAxIDogaW5kZXggLSAxOwoJCX0KCgkJcmV0dXJuIGluZGV4OwoJfSwKCglfZm9jdXNOZXh0VGFiOiBmdW5jdGlvbiggaW5kZXgsIGdvaW5nRm9yd2FyZCApIHsKCQlpbmRleCA9IHRoaXMuX2ZpbmROZXh0VGFiKCBpbmRleCwgZ29pbmdGb3J3YXJkICk7CgkJdGhpcy50YWJzLmVxKCBpbmRleCApLmZvY3VzKCk7CgkJcmV0dXJuIGluZGV4OwoJfSwKCglfc2V0T3B0aW9uOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQlpZiAoIGtleSA9PT0gImFjdGl2ZSIgKSB7CgkJCS8vIF9hY3RpdmF0ZSgpIHdpbGwgaGFuZGxlIGludmFsaWQgdmFsdWVzIGFuZCB1cGRhdGUgdGhpcy5vcHRpb25zCgkJCXRoaXMuX2FjdGl2YXRlKCB2YWx1ZSApOwoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIGtleSA9PT0gImRpc2FibGVkIiApIHsKCQkJLy8gZG9uJ3QgdXNlIHRoZSB3aWRnZXQgZmFjdG9yeSdzIGRpc2FibGVkIGhhbmRsaW5nCgkJCXRoaXMuX3NldHVwRGlzYWJsZWQoIHZhbHVlICk7CgkJCXJldHVybjsKCQl9CgoJCXRoaXMuX3N1cGVyKCBrZXksIHZhbHVlKTsKCgkJaWYgKCBrZXkgPT09ICJjb2xsYXBzaWJsZSIgKSB7CgkJCXRoaXMuZWxlbWVudC50b2dnbGVDbGFzcyggInVpLXRhYnMtY29sbGFwc2libGUiLCB2YWx1ZSApOwoJCQkvLyBTZXR0aW5nIGNvbGxhcHNpYmxlOiBmYWxzZSB3aGlsZSBjb2xsYXBzZWQ7IG9wZW4gZmlyc3QgcGFuZWwKCQkJaWYgKCAhdmFsdWUgJiYgdGhpcy5vcHRpb25zLmFjdGl2ZSA9PT0gZmFsc2UgKSB7CgkJCQl0aGlzLl9hY3RpdmF0ZSggMCApOwoJCQl9CgkJfQoKCQlpZiAoIGtleSA9PT0gImV2ZW50IiApIHsKCQkJdGhpcy5fc2V0dXBFdmVudHMoIHZhbHVlICk7CgkJfQoKCQlpZiAoIGtleSA9PT0gImhlaWdodFN0eWxlIiApIHsKCQkJdGhpcy5fc2V0dXBIZWlnaHRTdHlsZSggdmFsdWUgKTsKCQl9Cgl9LAoKCV90YWJJZDogZnVuY3Rpb24oIHRhYiApIHsKCQlyZXR1cm4gdGFiLmF0dHIoICJhcmlhLWNvbnRyb2xzIiApIHx8ICJ1aS10YWJzLSIgKyBnZXROZXh0VGFiSWQoKTsKCX0sCgoJX3Nhbml0aXplU2VsZWN0b3I6IGZ1bmN0aW9uKCBoYXNoICkgewoJCXJldHVybiBoYXNoID8gaGFzaC5yZXBsYWNlKCAvWyEiJCUmJygpKissLlwvOjs8PT4/QFxbXF1cXmB7fH1+XS9nLCAiXFwkJiIgKSA6ICIiOwoJfSwKCglyZWZyZXNoOiBmdW5jdGlvbigpIHsKCQl2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKCQkJbGlzID0gdGhpcy50YWJsaXN0LmNoaWxkcmVuKCAiOmhhcyhhW2hyZWZdKSIgKTsKCgkJLy8gZ2V0IGRpc2FibGVkIHRhYnMgZnJvbSBjbGFzcyBhdHRyaWJ1dGUgZnJvbSBIVE1MCgkJLy8gdGhpcyB3aWxsIGdldCBjb252ZXJ0ZWQgdG8gYSBib29sZWFuIGlmIG5lZWRlZCBpbiBfcmVmcmVzaCgpCgkJb3B0aW9ucy5kaXNhYmxlZCA9ICQubWFwKCBsaXMuZmlsdGVyKCAiLnVpLXN0YXRlLWRpc2FibGVkIiApLCBmdW5jdGlvbiggdGFiICkgewoJCQlyZXR1cm4gbGlzLmluZGV4KCB0YWIgKTsKCQl9KTsKCgkJdGhpcy5fcHJvY2Vzc1RhYnMoKTsKCgkJLy8gd2FzIGNvbGxhcHNlZCBvciBubyB0YWJzCgkJaWYgKCBvcHRpb25zLmFjdGl2ZSA9PT0gZmFsc2UgfHwgIXRoaXMuYW5jaG9ycy5sZW5ndGggKSB7CgkJCW9wdGlvbnMuYWN0aXZlID0gZmFsc2U7CgkJCXRoaXMuYWN0aXZlID0gJCgpOwoJCS8vIHdhcyBhY3RpdmUsIGJ1dCBhY3RpdmUgdGFiIGlzIGdvbmUKCQl9IGVsc2UgaWYgKCB0aGlzLmFjdGl2ZS5sZW5ndGggJiYgISQuY29udGFpbnMoIHRoaXMudGFibGlzdFsgMCBdLCB0aGlzLmFjdGl2ZVsgMCBdICkgKSB7CgkJCS8vIGFsbCByZW1haW5pbmcgdGFicyBhcmUgZGlzYWJsZWQKCQkJaWYgKCB0aGlzLnRhYnMubGVuZ3RoID09PSBvcHRpb25zLmRpc2FibGVkLmxlbmd0aCApIHsKCQkJCW9wdGlvbnMuYWN0aXZlID0gZmFsc2U7CgkJCQl0aGlzLmFjdGl2ZSA9ICQoKTsKCQkJLy8gYWN0aXZhdGUgcHJldmlvdXMgdGFiCgkJCX0gZWxzZSB7CgkJCQl0aGlzLl9hY3RpdmF0ZSggdGhpcy5fZmluZE5leHRUYWIoIE1hdGgubWF4KCAwLCBvcHRpb25zLmFjdGl2ZSAtIDEgKSwgZmFsc2UgKSApOwoJCQl9CgkJLy8gd2FzIGFjdGl2ZSwgYWN0aXZlIHRhYiBzdGlsbCBleGlzdHMKCQl9IGVsc2UgewoJCQkvLyBtYWtlIHN1cmUgYWN0aXZlIGluZGV4IGlzIGNvcnJlY3QKCQkJb3B0aW9ucy5hY3RpdmUgPSB0aGlzLnRhYnMuaW5kZXgoIHRoaXMuYWN0aXZlICk7CgkJfQoKCQl0aGlzLl9yZWZyZXNoKCk7Cgl9LAoKCV9yZWZyZXNoOiBmdW5jdGlvbigpIHsKCQl0aGlzLl9zZXR1cERpc2FibGVkKCB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgKTsKCQl0aGlzLl9zZXR1cEV2ZW50cyggdGhpcy5vcHRpb25zLmV2ZW50ICk7CgkJdGhpcy5fc2V0dXBIZWlnaHRTdHlsZSggdGhpcy5vcHRpb25zLmhlaWdodFN0eWxlICk7CgoJCXRoaXMudGFicy5ub3QoIHRoaXMuYWN0aXZlICkuYXR0cih7CgkJCSJhcmlhLXNlbGVjdGVkIjogImZhbHNlIiwKCQkJdGFiSW5kZXg6IC0xCgkJfSk7CgkJdGhpcy5wYW5lbHMubm90KCB0aGlzLl9nZXRQYW5lbEZvclRhYiggdGhpcy5hY3RpdmUgKSApCgkJCS5oaWRlKCkKCQkJLmF0dHIoewoJCQkJImFyaWEtZXhwYW5kZWQiOiAiZmFsc2UiLAoJCQkJImFyaWEtaGlkZGVuIjogInRydWUiCgkJCX0pOwoKCQkvLyBNYWtlIHN1cmUgb25lIHRhYiBpcyBpbiB0aGUgdGFiIG9yZGVyCgkJaWYgKCAhdGhpcy5hY3RpdmUubGVuZ3RoICkgewoJCQl0aGlzLnRhYnMuZXEoIDAgKS5hdHRyKCAidGFiSW5kZXgiLCAwICk7CgkJfSBlbHNlIHsKCQkJdGhpcy5hY3RpdmUKCQkJCS5hZGRDbGFzcyggInVpLXRhYnMtYWN0aXZlIHVpLXN0YXRlLWFjdGl2ZSIgKQoJCQkJLmF0dHIoewoJCQkJCSJhcmlhLXNlbGVjdGVkIjogInRydWUiLAoJCQkJCXRhYkluZGV4OiAwCgkJCQl9KTsKCQkJdGhpcy5fZ2V0UGFuZWxGb3JUYWIoIHRoaXMuYWN0aXZlICkKCQkJCS5zaG93KCkKCQkJCS5hdHRyKHsKCQkJCQkiYXJpYS1leHBhbmRlZCI6ICJ0cnVlIiwKCQkJCQkiYXJpYS1oaWRkZW4iOiAiZmFsc2UiCgkJCQl9KTsKCQl9Cgl9LAoKCV9wcm9jZXNzVGFiczogZnVuY3Rpb24oKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoKCQl0aGlzLnRhYmxpc3QgPSB0aGlzLl9nZXRMaXN0KCkKCQkJLmFkZENsYXNzKCAidWktdGFicy1uYXYgdWktaGVscGVyLXJlc2V0IHVpLWhlbHBlci1jbGVhcmZpeCB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1hbGwiICkKCQkJLmF0dHIoICJyb2xlIiwgInRhYmxpc3QiICk7CgoJCXRoaXMudGFicyA9IHRoaXMudGFibGlzdC5maW5kKCAiPiBsaTpoYXMoYVtocmVmXSkiICkKCQkJLmFkZENsYXNzKCAidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItdG9wIiApCgkJCS5hdHRyKHsKCQkJCXJvbGU6ICJ0YWIiLAoJCQkJdGFiSW5kZXg6IC0xCgkJCX0pOwoKCQl0aGlzLmFuY2hvcnMgPSB0aGlzLnRhYnMubWFwKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICQoICJhIiwgdGhpcyApWyAwIF07CgkJCX0pCgkJCS5hZGRDbGFzcyggInVpLXRhYnMtYW5jaG9yIiApCgkJCS5hdHRyKHsKCQkJCXJvbGU6ICJwcmVzZW50YXRpb24iLAoJCQkJdGFiSW5kZXg6IC0xCgkJCX0pOwoKCQl0aGlzLnBhbmVscyA9ICQoKTsKCgkJdGhpcy5hbmNob3JzLmVhY2goZnVuY3Rpb24oIGksIGFuY2hvciApIHsKCQkJdmFyIHNlbGVjdG9yLCBwYW5lbCwgcGFuZWxJZCwKCQkJCWFuY2hvcklkID0gJCggYW5jaG9yICkudW5pcXVlSWQoKS5hdHRyKCAiaWQiICksCgkJCQl0YWIgPSAkKCBhbmNob3IgKS5jbG9zZXN0KCAibGkiICksCgkJCQlvcmlnaW5hbEFyaWFDb250cm9scyA9IHRhYi5hdHRyKCAiYXJpYS1jb250cm9scyIgKTsKCgkJCS8vIGlubGluZSB0YWIKCQkJaWYgKCBpc0xvY2FsKCBhbmNob3IgKSApIHsKCQkJCXNlbGVjdG9yID0gYW5jaG9yLmhhc2g7CgkJCQlwYW5lbCA9IHRoYXQuZWxlbWVudC5maW5kKCB0aGF0Ll9zYW5pdGl6ZVNlbGVjdG9yKCBzZWxlY3RvciApICk7CgkJCS8vIHJlbW90ZSB0YWIKCQkJfSBlbHNlIHsKCQkJCXBhbmVsSWQgPSB0aGF0Ll90YWJJZCggdGFiICk7CgkJCQlzZWxlY3RvciA9ICIjIiArIHBhbmVsSWQ7CgkJCQlwYW5lbCA9IHRoYXQuZWxlbWVudC5maW5kKCBzZWxlY3RvciApOwoJCQkJaWYgKCAhcGFuZWwubGVuZ3RoICkgewoJCQkJCXBhbmVsID0gdGhhdC5fY3JlYXRlUGFuZWwoIHBhbmVsSWQgKTsKCQkJCQlwYW5lbC5pbnNlcnRBZnRlciggdGhhdC5wYW5lbHNbIGkgLSAxIF0gfHwgdGhhdC50YWJsaXN0ICk7CgkJCQl9CgkJCQlwYW5lbC5hdHRyKCAiYXJpYS1saXZlIiwgInBvbGl0ZSIgKTsKCQkJfQoKCQkJaWYgKCBwYW5lbC5sZW5ndGgpIHsKCQkJCXRoYXQucGFuZWxzID0gdGhhdC5wYW5lbHMuYWRkKCBwYW5lbCApOwoJCQl9CgkJCWlmICggb3JpZ2luYWxBcmlhQ29udHJvbHMgKSB7CgkJCQl0YWIuZGF0YSggInVpLXRhYnMtYXJpYS1jb250cm9scyIsIG9yaWdpbmFsQXJpYUNvbnRyb2xzICk7CgkJCX0KCQkJdGFiLmF0dHIoewoJCQkJImFyaWEtY29udHJvbHMiOiBzZWxlY3Rvci5zdWJzdHJpbmcoIDEgKSwKCQkJCSJhcmlhLWxhYmVsbGVkYnkiOiBhbmNob3JJZAoJCQl9KTsKCQkJcGFuZWwuYXR0ciggImFyaWEtbGFiZWxsZWRieSIsIGFuY2hvcklkICk7CgkJfSk7CgoJCXRoaXMucGFuZWxzCgkJCS5hZGRDbGFzcyggInVpLXRhYnMtcGFuZWwgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWJvdHRvbSIgKQoJCQkuYXR0ciggInJvbGUiLCAidGFicGFuZWwiICk7Cgl9LAoKCS8vIGFsbG93IG92ZXJyaWRpbmcgaG93IHRvIGZpbmQgdGhlIGxpc3QgZm9yIHJhcmUgdXNhZ2Ugc2NlbmFyaW9zICgjNzcxNSkKCV9nZXRMaXN0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy50YWJsaXN0IHx8IHRoaXMuZWxlbWVudC5maW5kKCAib2wsdWwiICkuZXEoIDAgKTsKCX0sCgoJX2NyZWF0ZVBhbmVsOiBmdW5jdGlvbiggaWQgKSB7CgkJcmV0dXJuICQoICI8ZGl2PiIgKQoJCQkuYXR0ciggImlkIiwgaWQgKQoJCQkuYWRkQ2xhc3MoICJ1aS10YWJzLXBhbmVsIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20iICkKCQkJLmRhdGEoICJ1aS10YWJzLWRlc3Ryb3kiLCB0cnVlICk7Cgl9LAoKCV9zZXR1cERpc2FibGVkOiBmdW5jdGlvbiggZGlzYWJsZWQgKSB7CgkJaWYgKCAkLmlzQXJyYXkoIGRpc2FibGVkICkgKSB7CgkJCWlmICggIWRpc2FibGVkLmxlbmd0aCApIHsKCQkJCWRpc2FibGVkID0gZmFsc2U7CgkJCX0gZWxzZSBpZiAoIGRpc2FibGVkLmxlbmd0aCA9PT0gdGhpcy5hbmNob3JzLmxlbmd0aCApIHsKCQkJCWRpc2FibGVkID0gdHJ1ZTsKCQkJfQoJCX0KCgkJLy8gZGlzYWJsZSB0YWJzCgkJZm9yICggdmFyIGkgPSAwLCBsaTsgKCBsaSA9IHRoaXMudGFic1sgaSBdICk7IGkrKyApIHsKCQkJaWYgKCBkaXNhYmxlZCA9PT0gdHJ1ZSB8fCAkLmluQXJyYXkoIGksIGRpc2FibGVkICkgIT09IC0xICkgewoJCQkJJCggbGkgKQoJCQkJCS5hZGRDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiApCgkJCQkJLmF0dHIoICJhcmlhLWRpc2FibGVkIiwgInRydWUiICk7CgkJCX0gZWxzZSB7CgkJCQkkKCBsaSApCgkJCQkJLnJlbW92ZUNsYXNzKCAidWktc3RhdGUtZGlzYWJsZWQiICkKCQkJCQkucmVtb3ZlQXR0ciggImFyaWEtZGlzYWJsZWQiICk7CgkJCX0KCQl9CgoJCXRoaXMub3B0aW9ucy5kaXNhYmxlZCA9IGRpc2FibGVkOwoJfSwKCglfc2V0dXBFdmVudHM6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgZXZlbnRzID0gewoJCQljbGljazogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJfQoJCX07CgkJaWYgKCBldmVudCApIHsKCQkJJC5lYWNoKCBldmVudC5zcGxpdCgiICIpLCBmdW5jdGlvbiggaW5kZXgsIGV2ZW50TmFtZSApIHsKCQkJCWV2ZW50c1sgZXZlbnROYW1lIF0gPSAiX2V2ZW50SGFuZGxlciI7CgkJCX0pOwoJCX0KCgkJdGhpcy5fb2ZmKCB0aGlzLmFuY2hvcnMuYWRkKCB0aGlzLnRhYnMgKS5hZGQoIHRoaXMucGFuZWxzICkgKTsKCQl0aGlzLl9vbiggdGhpcy5hbmNob3JzLCBldmVudHMgKTsKCQl0aGlzLl9vbiggdGhpcy50YWJzLCB7IGtleWRvd246ICJfdGFiS2V5ZG93biIgfSApOwoJCXRoaXMuX29uKCB0aGlzLnBhbmVscywgeyBrZXlkb3duOiAiX3BhbmVsS2V5ZG93biIgfSApOwoKCQl0aGlzLl9mb2N1c2FibGUoIHRoaXMudGFicyApOwoJCXRoaXMuX2hvdmVyYWJsZSggdGhpcy50YWJzICk7Cgl9LAoKCV9zZXR1cEhlaWdodFN0eWxlOiBmdW5jdGlvbiggaGVpZ2h0U3R5bGUgKSB7CgkJdmFyIG1heEhlaWdodCwKCQkJcGFyZW50ID0gdGhpcy5lbGVtZW50LnBhcmVudCgpOwoKCQlpZiAoIGhlaWdodFN0eWxlID09PSAiZmlsbCIgKSB7CgkJCW1heEhlaWdodCA9IHBhcmVudC5oZWlnaHQoKTsKCQkJbWF4SGVpZ2h0IC09IHRoaXMuZWxlbWVudC5vdXRlckhlaWdodCgpIC0gdGhpcy5lbGVtZW50LmhlaWdodCgpOwoKCQkJdGhpcy5lbGVtZW50LnNpYmxpbmdzKCAiOnZpc2libGUiICkuZWFjaChmdW5jdGlvbigpIHsKCQkJCXZhciBlbGVtID0gJCggdGhpcyApLAoJCQkJCXBvc2l0aW9uID0gZWxlbS5jc3MoICJwb3NpdGlvbiIgKTsKCgkJCQlpZiAoIHBvc2l0aW9uID09PSAiYWJzb2x1dGUiIHx8IHBvc2l0aW9uID09PSAiZml4ZWQiICkgewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCW1heEhlaWdodCAtPSBlbGVtLm91dGVySGVpZ2h0KCB0cnVlICk7CgkJCX0pOwoKCQkJdGhpcy5lbGVtZW50LmNoaWxkcmVuKCkubm90KCB0aGlzLnBhbmVscyApLmVhY2goZnVuY3Rpb24oKSB7CgkJCQltYXhIZWlnaHQgLT0gJCggdGhpcyApLm91dGVySGVpZ2h0KCB0cnVlICk7CgkJCX0pOwoKCQkJdGhpcy5wYW5lbHMuZWFjaChmdW5jdGlvbigpIHsKCQkJCSQoIHRoaXMgKS5oZWlnaHQoIE1hdGgubWF4KCAwLCBtYXhIZWlnaHQgLQoJCQkJCSQoIHRoaXMgKS5pbm5lckhlaWdodCgpICsgJCggdGhpcyApLmhlaWdodCgpICkgKTsKCQkJfSkKCQkJLmNzcyggIm92ZXJmbG93IiwgImF1dG8iICk7CgkJfSBlbHNlIGlmICggaGVpZ2h0U3R5bGUgPT09ICJhdXRvIiApIHsKCQkJbWF4SGVpZ2h0ID0gMDsKCQkJdGhpcy5wYW5lbHMuZWFjaChmdW5jdGlvbigpIHsKCQkJCW1heEhlaWdodCA9IE1hdGgubWF4KCBtYXhIZWlnaHQsICQoIHRoaXMgKS5oZWlnaHQoICIiICkuaGVpZ2h0KCkgKTsKCQkJfSkuaGVpZ2h0KCBtYXhIZWlnaHQgKTsKCQl9Cgl9LAoKCV9ldmVudEhhbmRsZXI6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKCQkJYWN0aXZlID0gdGhpcy5hY3RpdmUsCgkJCWFuY2hvciA9ICQoIGV2ZW50LmN1cnJlbnRUYXJnZXQgKSwKCQkJdGFiID0gYW5jaG9yLmNsb3Nlc3QoICJsaSIgKSwKCQkJY2xpY2tlZElzQWN0aXZlID0gdGFiWyAwIF0gPT09IGFjdGl2ZVsgMCBdLAoJCQljb2xsYXBzaW5nID0gY2xpY2tlZElzQWN0aXZlICYmIG9wdGlvbnMuY29sbGFwc2libGUsCgkJCXRvU2hvdyA9IGNvbGxhcHNpbmcgPyAkKCkgOiB0aGlzLl9nZXRQYW5lbEZvclRhYiggdGFiICksCgkJCXRvSGlkZSA9ICFhY3RpdmUubGVuZ3RoID8gJCgpIDogdGhpcy5fZ2V0UGFuZWxGb3JUYWIoIGFjdGl2ZSApLAoJCQlldmVudERhdGEgPSB7CgkJCQlvbGRUYWI6IGFjdGl2ZSwKCQkJCW9sZFBhbmVsOiB0b0hpZGUsCgkJCQluZXdUYWI6IGNvbGxhcHNpbmcgPyAkKCkgOiB0YWIsCgkJCQluZXdQYW5lbDogdG9TaG93CgkJCX07CgoJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgoJCWlmICggdGFiLmhhc0NsYXNzKCAidWktc3RhdGUtZGlzYWJsZWQiICkgfHwKCQkJCS8vIHRhYiBpcyBhbHJlYWR5IGxvYWRpbmcKCQkJCXRhYi5oYXNDbGFzcyggInVpLXRhYnMtbG9hZGluZyIgKSB8fAoJCQkJLy8gY2FuJ3Qgc3dpdGNoIGR1cm5pbmcgYW4gYW5pbWF0aW9uCgkJCQl0aGlzLnJ1bm5pbmcgfHwKCQkJCS8vIGNsaWNrIG9uIGFjdGl2ZSBoZWFkZXIsIGJ1dCBub3QgY29sbGFwc2libGUKCQkJCSggY2xpY2tlZElzQWN0aXZlICYmICFvcHRpb25zLmNvbGxhcHNpYmxlICkgfHwKCQkJCS8vIGFsbG93IGNhbmNlbGluZyBhY3RpdmF0aW9uCgkJCQkoIHRoaXMuX3RyaWdnZXIoICJiZWZvcmVBY3RpdmF0ZSIsIGV2ZW50LCBldmVudERhdGEgKSA9PT0gZmFsc2UgKSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJb3B0aW9ucy5hY3RpdmUgPSBjb2xsYXBzaW5nID8gZmFsc2UgOiB0aGlzLnRhYnMuaW5kZXgoIHRhYiApOwoKCQl0aGlzLmFjdGl2ZSA9IGNsaWNrZWRJc0FjdGl2ZSA/ICQoKSA6IHRhYjsKCQlpZiAoIHRoaXMueGhyICkgewoJCQl0aGlzLnhoci5hYm9ydCgpOwoJCX0KCgkJaWYgKCAhdG9IaWRlLmxlbmd0aCAmJiAhdG9TaG93Lmxlbmd0aCApIHsKCQkJJC5lcnJvciggImpRdWVyeSBVSSBUYWJzOiBNaXNtYXRjaGluZyBmcmFnbWVudCBpZGVudGlmaWVyLiIgKTsKCQl9CgoJCWlmICggdG9TaG93Lmxlbmd0aCApIHsKCQkJdGhpcy5sb2FkKCB0aGlzLnRhYnMuaW5kZXgoIHRhYiApLCBldmVudCApOwoJCX0KCQl0aGlzLl90b2dnbGUoIGV2ZW50LCBldmVudERhdGEgKTsKCX0sCgoJLy8gaGFuZGxlcyBzaG93L2hpZGUgZm9yIHNlbGVjdGluZyB0YWJzCglfdG9nZ2xlOiBmdW5jdGlvbiggZXZlbnQsIGV2ZW50RGF0YSApIHsKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCXRvU2hvdyA9IGV2ZW50RGF0YS5uZXdQYW5lbCwKCQkJdG9IaWRlID0gZXZlbnREYXRhLm9sZFBhbmVsOwoKCQl0aGlzLnJ1bm5pbmcgPSB0cnVlOwoKCQlmdW5jdGlvbiBjb21wbGV0ZSgpIHsKCQkJdGhhdC5ydW5uaW5nID0gZmFsc2U7CgkJCXRoYXQuX3RyaWdnZXIoICJhY3RpdmF0ZSIsIGV2ZW50LCBldmVudERhdGEgKTsKCQl9CgoJCWZ1bmN0aW9uIHNob3coKSB7CgkJCWV2ZW50RGF0YS5uZXdUYWIuY2xvc2VzdCggImxpIiApLmFkZENsYXNzKCAidWktdGFicy1hY3RpdmUgdWktc3RhdGUtYWN0aXZlIiApOwoKCQkJaWYgKCB0b1Nob3cubGVuZ3RoICYmIHRoYXQub3B0aW9ucy5zaG93ICkgewoJCQkJdGhhdC5fc2hvdyggdG9TaG93LCB0aGF0Lm9wdGlvbnMuc2hvdywgY29tcGxldGUgKTsKCQkJfSBlbHNlIHsKCQkJCXRvU2hvdy5zaG93KCk7CgkJCQljb21wbGV0ZSgpOwoJCQl9CgkJfQoKCQkvLyBzdGFydCBvdXQgYnkgaGlkaW5nLCB0aGVuIHNob3dpbmcsIHRoZW4gY29tcGxldGluZwoJCWlmICggdG9IaWRlLmxlbmd0aCAmJiB0aGlzLm9wdGlvbnMuaGlkZSApIHsKCQkJdGhpcy5faGlkZSggdG9IaWRlLCB0aGlzLm9wdGlvbnMuaGlkZSwgZnVuY3Rpb24oKSB7CgkJCQlldmVudERhdGEub2xkVGFiLmNsb3Nlc3QoICJsaSIgKS5yZW1vdmVDbGFzcyggInVpLXRhYnMtYWN0aXZlIHVpLXN0YXRlLWFjdGl2ZSIgKTsKCQkJCXNob3coKTsKCQkJfSk7CgkJfSBlbHNlIHsKCQkJZXZlbnREYXRhLm9sZFRhYi5jbG9zZXN0KCAibGkiICkucmVtb3ZlQ2xhc3MoICJ1aS10YWJzLWFjdGl2ZSB1aS1zdGF0ZS1hY3RpdmUiICk7CgkJCXRvSGlkZS5oaWRlKCk7CgkJCXNob3coKTsKCQl9CgoJCXRvSGlkZS5hdHRyKHsKCQkJImFyaWEtZXhwYW5kZWQiOiAiZmFsc2UiLAoJCQkiYXJpYS1oaWRkZW4iOiAidHJ1ZSIKCQl9KTsKCQlldmVudERhdGEub2xkVGFiLmF0dHIoICJhcmlhLXNlbGVjdGVkIiwgImZhbHNlIiApOwoJCS8vIElmIHdlJ3JlIHN3aXRjaGluZyB0YWJzLCByZW1vdmUgdGhlIG9sZCB0YWIgZnJvbSB0aGUgdGFiIG9yZGVyLgoJCS8vIElmIHdlJ3JlIG9wZW5pbmcgZnJvbSBjb2xsYXBzZWQgc3RhdGUsIHJlbW92ZSB0aGUgcHJldmlvdXMgdGFiIGZyb20gdGhlIHRhYiBvcmRlci4KCQkvLyBJZiB3ZSdyZSBjb2xsYXBzaW5nLCB0aGVuIGtlZXAgdGhlIGNvbGxhcHNpbmcgdGFiIGluIHRoZSB0YWIgb3JkZXIuCgkJaWYgKCB0b1Nob3cubGVuZ3RoICYmIHRvSGlkZS5sZW5ndGggKSB7CgkJCWV2ZW50RGF0YS5vbGRUYWIuYXR0ciggInRhYkluZGV4IiwgLTEgKTsKCQl9IGVsc2UgaWYgKCB0b1Nob3cubGVuZ3RoICkgewoJCQl0aGlzLnRhYnMuZmlsdGVyKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICQoIHRoaXMgKS5hdHRyKCAidGFiSW5kZXgiICkgPT09IDA7CgkJCX0pCgkJCS5hdHRyKCAidGFiSW5kZXgiLCAtMSApOwoJCX0KCgkJdG9TaG93LmF0dHIoewoJCQkiYXJpYS1leHBhbmRlZCI6ICJ0cnVlIiwKCQkJImFyaWEtaGlkZGVuIjogImZhbHNlIgoJCX0pOwoJCWV2ZW50RGF0YS5uZXdUYWIuYXR0cih7CgkJCSJhcmlhLXNlbGVjdGVkIjogInRydWUiLAoJCQl0YWJJbmRleDogMAoJCX0pOwoJfSwKCglfYWN0aXZhdGU6IGZ1bmN0aW9uKCBpbmRleCApIHsKCQl2YXIgYW5jaG9yLAoJCQlhY3RpdmUgPSB0aGlzLl9maW5kQWN0aXZlKCBpbmRleCApOwoKCQkvLyB0cnlpbmcgdG8gYWN0aXZhdGUgdGhlIGFscmVhZHkgYWN0aXZlIHBhbmVsCgkJaWYgKCBhY3RpdmVbIDAgXSA9PT0gdGhpcy5hY3RpdmVbIDAgXSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gdHJ5aW5nIHRvIGNvbGxhcHNlLCBzaW11bGF0ZSBhIGNsaWNrIG9uIHRoZSBjdXJyZW50IGFjdGl2ZSBoZWFkZXIKCQlpZiAoICFhY3RpdmUubGVuZ3RoICkgewoJCQlhY3RpdmUgPSB0aGlzLmFjdGl2ZTsKCQl9CgoJCWFuY2hvciA9IGFjdGl2ZS5maW5kKCAiLnVpLXRhYnMtYW5jaG9yIiApWyAwIF07CgkJdGhpcy5fZXZlbnRIYW5kbGVyKHsKCQkJdGFyZ2V0OiBhbmNob3IsCgkJCWN1cnJlbnRUYXJnZXQ6IGFuY2hvciwKCQkJcHJldmVudERlZmF1bHQ6ICQubm9vcAoJCX0pOwoJfSwKCglfZmluZEFjdGl2ZTogZnVuY3Rpb24oIGluZGV4ICkgewoJCXJldHVybiBpbmRleCA9PT0gZmFsc2UgPyAkKCkgOiB0aGlzLnRhYnMuZXEoIGluZGV4ICk7Cgl9LAoKCV9nZXRJbmRleDogZnVuY3Rpb24oIGluZGV4ICkgewoJCS8vIG1ldGEtZnVuY3Rpb24gdG8gZ2l2ZSB1c2VycyBvcHRpb24gdG8gcHJvdmlkZSBhIGhyZWYgc3RyaW5nIGluc3RlYWQgb2YgYSBudW1lcmljYWwgaW5kZXguCgkJaWYgKCB0eXBlb2YgaW5kZXggPT09ICJzdHJpbmciICkgewoJCQlpbmRleCA9IHRoaXMuYW5jaG9ycy5pbmRleCggdGhpcy5hbmNob3JzLmZpbHRlciggIltocmVmJD0nIiArIGluZGV4ICsgIiddIiApICk7CgkJfQoKCQlyZXR1cm4gaW5kZXg7Cgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQlpZiAoIHRoaXMueGhyICkgewoJCQl0aGlzLnhoci5hYm9ydCgpOwoJCX0KCgkJdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCAidWktdGFicyB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCB1aS10YWJzLWNvbGxhcHNpYmxlIiApOwoKCQl0aGlzLnRhYmxpc3QKCQkJLnJlbW92ZUNsYXNzKCAidWktdGFicy1uYXYgdWktaGVscGVyLXJlc2V0IHVpLWhlbHBlci1jbGVhcmZpeCB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1hbGwiICkKCQkJLnJlbW92ZUF0dHIoICJyb2xlIiApOwoKCQl0aGlzLmFuY2hvcnMKCQkJLnJlbW92ZUNsYXNzKCAidWktdGFicy1hbmNob3IiICkKCQkJLnJlbW92ZUF0dHIoICJyb2xlIiApCgkJCS5yZW1vdmVBdHRyKCAidGFiSW5kZXgiICkKCQkJLnJlbW92ZVVuaXF1ZUlkKCk7CgoJCXRoaXMudGFicy5hZGQoIHRoaXMucGFuZWxzICkuZWFjaChmdW5jdGlvbigpIHsKCQkJaWYgKCAkLmRhdGEoIHRoaXMsICJ1aS10YWJzLWRlc3Ryb3kiICkgKSB7CgkJCQkkKCB0aGlzICkucmVtb3ZlKCk7CgkJCX0gZWxzZSB7CgkJCQkkKCB0aGlzICkKCQkJCQkucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1kZWZhdWx0IHVpLXN0YXRlLWFjdGl2ZSB1aS1zdGF0ZS1kaXNhYmxlZCAiICsKCQkJCQkJInVpLWNvcm5lci10b3AgdWktY29ybmVyLWJvdHRvbSB1aS13aWRnZXQtY29udGVudCB1aS10YWJzLWFjdGl2ZSB1aS10YWJzLXBhbmVsIiApCgkJCQkJLnJlbW92ZUF0dHIoICJ0YWJJbmRleCIgKQoJCQkJCS5yZW1vdmVBdHRyKCAiYXJpYS1saXZlIiApCgkJCQkJLnJlbW92ZUF0dHIoICJhcmlhLWJ1c3kiICkKCQkJCQkucmVtb3ZlQXR0ciggImFyaWEtc2VsZWN0ZWQiICkKCQkJCQkucmVtb3ZlQXR0ciggImFyaWEtbGFiZWxsZWRieSIgKQoJCQkJCS5yZW1vdmVBdHRyKCAiYXJpYS1oaWRkZW4iICkKCQkJCQkucmVtb3ZlQXR0ciggImFyaWEtZXhwYW5kZWQiICkKCQkJCQkucmVtb3ZlQXR0ciggInJvbGUiICk7CgkJCX0KCQl9KTsKCgkJdGhpcy50YWJzLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBsaSA9ICQoIHRoaXMgKSwKCQkJCXByZXYgPSBsaS5kYXRhKCAidWktdGFicy1hcmlhLWNvbnRyb2xzIiApOwoJCQlpZiAoIHByZXYgKSB7CgkJCQlsaQoJCQkJCS5hdHRyKCAiYXJpYS1jb250cm9scyIsIHByZXYgKQoJCQkJCS5yZW1vdmVEYXRhKCAidWktdGFicy1hcmlhLWNvbnRyb2xzIiApOwoJCQl9IGVsc2UgewoJCQkJbGkucmVtb3ZlQXR0ciggImFyaWEtY29udHJvbHMiICk7CgkJCX0KCQl9KTsKCgkJdGhpcy5wYW5lbHMuc2hvdygpOwoKCQlpZiAoIHRoaXMub3B0aW9ucy5oZWlnaHRTdHlsZSAhPT0gImNvbnRlbnQiICkgewoJCQl0aGlzLnBhbmVscy5jc3MoICJoZWlnaHQiLCAiIiApOwoJCX0KCX0sCgoJZW5hYmxlOiBmdW5jdGlvbiggaW5kZXggKSB7CgkJdmFyIGRpc2FibGVkID0gdGhpcy5vcHRpb25zLmRpc2FibGVkOwoJCWlmICggZGlzYWJsZWQgPT09IGZhbHNlICkgewoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIGluZGV4ID09PSB1bmRlZmluZWQgKSB7CgkJCWRpc2FibGVkID0gZmFsc2U7CgkJfSBlbHNlIHsKCQkJaW5kZXggPSB0aGlzLl9nZXRJbmRleCggaW5kZXggKTsKCQkJaWYgKCAkLmlzQXJyYXkoIGRpc2FibGVkICkgKSB7CgkJCQlkaXNhYmxlZCA9ICQubWFwKCBkaXNhYmxlZCwgZnVuY3Rpb24oIG51bSApIHsKCQkJCQlyZXR1cm4gbnVtICE9PSBpbmRleCA/IG51bSA6IG51bGw7CgkJCQl9KTsKCQkJfSBlbHNlIHsKCQkJCWRpc2FibGVkID0gJC5tYXAoIHRoaXMudGFicywgZnVuY3Rpb24oIGxpLCBudW0gKSB7CgkJCQkJcmV0dXJuIG51bSAhPT0gaW5kZXggPyBudW0gOiBudWxsOwoJCQkJfSk7CgkJCX0KCQl9CgkJdGhpcy5fc2V0dXBEaXNhYmxlZCggZGlzYWJsZWQgKTsKCX0sCgoJZGlzYWJsZTogZnVuY3Rpb24oIGluZGV4ICkgewoJCXZhciBkaXNhYmxlZCA9IHRoaXMub3B0aW9ucy5kaXNhYmxlZDsKCQlpZiAoIGRpc2FibGVkID09PSB0cnVlICkgewoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIGluZGV4ID09PSB1bmRlZmluZWQgKSB7CgkJCWRpc2FibGVkID0gdHJ1ZTsKCQl9IGVsc2UgewoJCQlpbmRleCA9IHRoaXMuX2dldEluZGV4KCBpbmRleCApOwoJCQlpZiAoICQuaW5BcnJheSggaW5kZXgsIGRpc2FibGVkICkgIT09IC0xICkgewoJCQkJcmV0dXJuOwoJCQl9CgkJCWlmICggJC5pc0FycmF5KCBkaXNhYmxlZCApICkgewoJCQkJZGlzYWJsZWQgPSAkLm1lcmdlKCBbIGluZGV4IF0sIGRpc2FibGVkICkuc29ydCgpOwoJCQl9IGVsc2UgewoJCQkJZGlzYWJsZWQgPSBbIGluZGV4IF07CgkJCX0KCQl9CgkJdGhpcy5fc2V0dXBEaXNhYmxlZCggZGlzYWJsZWQgKTsKCX0sCgoJbG9hZDogZnVuY3Rpb24oIGluZGV4LCBldmVudCApIHsKCQlpbmRleCA9IHRoaXMuX2dldEluZGV4KCBpbmRleCApOwoJCXZhciB0aGF0ID0gdGhpcywKCQkJdGFiID0gdGhpcy50YWJzLmVxKCBpbmRleCApLAoJCQlhbmNob3IgPSB0YWIuZmluZCggIi51aS10YWJzLWFuY2hvciIgKSwKCQkJcGFuZWwgPSB0aGlzLl9nZXRQYW5lbEZvclRhYiggdGFiICksCgkJCWV2ZW50RGF0YSA9IHsKCQkJCXRhYjogdGFiLAoJCQkJcGFuZWw6IHBhbmVsCgkJCX07CgoJCS8vIG5vdCByZW1vdGUKCQlpZiAoIGlzTG9jYWwoIGFuY2hvclsgMCBdICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCXRoaXMueGhyID0gJC5hamF4KCB0aGlzLl9hamF4U2V0dGluZ3MoIGFuY2hvciwgZXZlbnQsIGV2ZW50RGF0YSApICk7CgoJCS8vIHN1cHBvcnQ6IGpRdWVyeSA8MS44CgkJLy8galF1ZXJ5IDwxLjggcmV0dXJucyBmYWxzZSBpZiB0aGUgcmVxdWVzdCBpcyBjYW5jZWxlZCBpbiBiZWZvcmVTZW5kLAoJCS8vIGJ1dCBhcyBvZiAxLjgsICQuYWpheCgpIGFsd2F5cyByZXR1cm5zIGEganFYSFIgb2JqZWN0LgoJCWlmICggdGhpcy54aHIgJiYgdGhpcy54aHIuc3RhdHVzVGV4dCAhPT0gImNhbmNlbGVkIiApIHsKCQkJdGFiLmFkZENsYXNzKCAidWktdGFicy1sb2FkaW5nIiApOwoJCQlwYW5lbC5hdHRyKCAiYXJpYS1idXN5IiwgInRydWUiICk7CgoJCQl0aGlzLnhocgoJCQkJLnN1Y2Nlc3MoZnVuY3Rpb24oIHJlc3BvbnNlICkgewoJCQkJCS8vIHN1cHBvcnQ6IGpRdWVyeSA8MS44CgkJCQkJLy8gaHR0cDovL2J1Z3MuanF1ZXJ5LmNvbS90aWNrZXQvMTE3NzgKCQkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewoJCQkJCQlwYW5lbC5odG1sKCByZXNwb25zZSApOwoJCQkJCQl0aGF0Ll90cmlnZ2VyKCAibG9hZCIsIGV2ZW50LCBldmVudERhdGEgKTsKCQkJCQl9LCAxICk7CgkJCQl9KQoJCQkJLmNvbXBsZXRlKGZ1bmN0aW9uKCBqcVhIUiwgc3RhdHVzICkgewoJCQkJCS8vIHN1cHBvcnQ6IGpRdWVyeSA8MS44CgkJCQkJLy8gaHR0cDovL2J1Z3MuanF1ZXJ5LmNvbS90aWNrZXQvMTE3NzgKCQkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewoJCQkJCQlpZiAoIHN0YXR1cyA9PT0gImFib3J0IiApIHsKCQkJCQkJCXRoYXQucGFuZWxzLnN0b3AoIGZhbHNlLCB0cnVlICk7CgkJCQkJCX0KCgkJCQkJCXRhYi5yZW1vdmVDbGFzcyggInVpLXRhYnMtbG9hZGluZyIgKTsKCQkJCQkJcGFuZWwucmVtb3ZlQXR0ciggImFyaWEtYnVzeSIgKTsKCgkJCQkJCWlmICgganFYSFIgPT09IHRoYXQueGhyICkgewoJCQkJCQkJZGVsZXRlIHRoYXQueGhyOwoJCQkJCQl9CgkJCQkJfSwgMSApOwoJCQkJfSk7CgkJfQoJfSwKCglfYWpheFNldHRpbmdzOiBmdW5jdGlvbiggYW5jaG9yLCBldmVudCwgZXZlbnREYXRhICkgewoJCXZhciB0aGF0ID0gdGhpczsKCQlyZXR1cm4gewoJCQl1cmw6IGFuY2hvci5hdHRyKCAiaHJlZiIgKSwKCQkJYmVmb3JlU2VuZDogZnVuY3Rpb24oIGpxWEhSLCBzZXR0aW5ncyApIHsKCQkJCXJldHVybiB0aGF0Ll90cmlnZ2VyKCAiYmVmb3JlTG9hZCIsIGV2ZW50LAoJCQkJCSQuZXh0ZW5kKCB7IGpxWEhSIDoganFYSFIsIGFqYXhTZXR0aW5nczogc2V0dGluZ3MgfSwgZXZlbnREYXRhICkgKTsKCQkJfQoJCX07Cgl9LAoKCV9nZXRQYW5lbEZvclRhYjogZnVuY3Rpb24oIHRhYiApIHsKCQl2YXIgaWQgPSAkKCB0YWIgKS5hdHRyKCAiYXJpYS1jb250cm9scyIgKTsKCQlyZXR1cm4gdGhpcy5lbGVtZW50LmZpbmQoIHRoaXMuX3Nhbml0aXplU2VsZWN0b3IoICIjIiArIGlkICkgKTsKCX0KfSk7Cgp9KSggalF1ZXJ5ICk7CgooZnVuY3Rpb24oICQgKSB7Cgp2YXIgaW5jcmVtZW50cyA9IDA7CgpmdW5jdGlvbiBhZGREZXNjcmliZWRCeSggZWxlbSwgaWQgKSB7Cgl2YXIgZGVzY3JpYmVkYnkgPSAoZWxlbS5hdHRyKCAiYXJpYS1kZXNjcmliZWRieSIgKSB8fCAiIikuc3BsaXQoIC9ccysvICk7CglkZXNjcmliZWRieS5wdXNoKCBpZCApOwoJZWxlbQoJCS5kYXRhKCAidWktdG9vbHRpcC1pZCIsIGlkICkKCQkuYXR0ciggImFyaWEtZGVzY3JpYmVkYnkiLCAkLnRyaW0oIGRlc2NyaWJlZGJ5LmpvaW4oICIgIiApICkgKTsKfQoKZnVuY3Rpb24gcmVtb3ZlRGVzY3JpYmVkQnkoIGVsZW0gKSB7Cgl2YXIgaWQgPSBlbGVtLmRhdGEoICJ1aS10b29sdGlwLWlkIiApLAoJCWRlc2NyaWJlZGJ5ID0gKGVsZW0uYXR0ciggImFyaWEtZGVzY3JpYmVkYnkiICkgfHwgIiIpLnNwbGl0KCAvXHMrLyApLAoJCWluZGV4ID0gJC5pbkFycmF5KCBpZCwgZGVzY3JpYmVkYnkgKTsKCWlmICggaW5kZXggIT09IC0xICkgewoJCWRlc2NyaWJlZGJ5LnNwbGljZSggaW5kZXgsIDEgKTsKCX0KCgllbGVtLnJlbW92ZURhdGEoICJ1aS10b29sdGlwLWlkIiApOwoJZGVzY3JpYmVkYnkgPSAkLnRyaW0oIGRlc2NyaWJlZGJ5LmpvaW4oICIgIiApICk7CglpZiAoIGRlc2NyaWJlZGJ5ICkgewoJCWVsZW0uYXR0ciggImFyaWEtZGVzY3JpYmVkYnkiLCBkZXNjcmliZWRieSApOwoJfSBlbHNlIHsKCQllbGVtLnJlbW92ZUF0dHIoICJhcmlhLWRlc2NyaWJlZGJ5IiApOwoJfQp9CgokLndpZGdldCggInVpLnRvb2x0aXAiLCB7Cgl2ZXJzaW9uOiAiMS4xMC40IiwKCW9wdGlvbnM6IHsKCQljb250ZW50OiBmdW5jdGlvbigpIHsKCQkJLy8gc3VwcG9ydDogSUU8OSwgT3BlcmEgaW4galF1ZXJ5IDwxLjcKCQkJLy8gLnRleHQoKSBjYW4ndCBhY2NlcHQgdW5kZWZpbmVkLCBzbyBjb2VyY2UgdG8gYSBzdHJpbmcKCQkJdmFyIHRpdGxlID0gJCggdGhpcyApLmF0dHIoICJ0aXRsZSIgKSB8fCAiIjsKCQkJLy8gRXNjYXBlIHRpdGxlLCBzaW5jZSB3ZSdyZSBnb2luZyBmcm9tIGFuIGF0dHJpYnV0ZSB0byByYXcgSFRNTAoJCQlyZXR1cm4gJCggIjxhPiIgKS50ZXh0KCB0aXRsZSApLmh0bWwoKTsKCQl9LAoJCWhpZGU6IHRydWUsCgkJLy8gRGlzYWJsZWQgZWxlbWVudHMgaGF2ZSBpbmNvbnNpc3RlbnQgYmVoYXZpb3IgYWNyb3NzIGJyb3dzZXJzICgjODY2MSkKCQlpdGVtczogIlt0aXRsZV06bm90KFtkaXNhYmxlZF0pIiwKCQlwb3NpdGlvbjogewoJCQlteTogImxlZnQgdG9wKzE1IiwKCQkJYXQ6ICJsZWZ0IGJvdHRvbSIsCgkJCWNvbGxpc2lvbjogImZsaXBmaXQgZmxpcCIKCQl9LAoJCXNob3c6IHRydWUsCgkJdG9vbHRpcENsYXNzOiBudWxsLAoJCXRyYWNrOiBmYWxzZSwKCgkJLy8gY2FsbGJhY2tzCgkJY2xvc2U6IG51bGwsCgkJb3BlbjogbnVsbAoJfSwKCglfY3JlYXRlOiBmdW5jdGlvbigpIHsKCQl0aGlzLl9vbih7CgkJCW1vdXNlb3ZlcjogIm9wZW4iLAoJCQlmb2N1c2luOiAib3BlbiIKCQl9KTsKCgkJLy8gSURzIG9mIGdlbmVyYXRlZCB0b29sdGlwcywgbmVlZGVkIGZvciBkZXN0cm95CgkJdGhpcy50b29sdGlwcyA9IHt9OwoJCS8vIElEcyBvZiBwYXJlbnQgdG9vbHRpcHMgd2hlcmUgd2UgcmVtb3ZlZCB0aGUgdGl0bGUgYXR0cmlidXRlCgkJdGhpcy5wYXJlbnRzID0ge307CgoJCWlmICggdGhpcy5vcHRpb25zLmRpc2FibGVkICkgewoJCQl0aGlzLl9kaXNhYmxlKCk7CgkJfQoJfSwKCglfc2V0T3B0aW9uOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQl2YXIgdGhhdCA9IHRoaXM7CgoJCWlmICgga2V5ID09PSAiZGlzYWJsZWQiICkgewoJCQl0aGlzWyB2YWx1ZSA/ICJfZGlzYWJsZSIgOiAiX2VuYWJsZSIgXSgpOwoJCQl0aGlzLm9wdGlvbnNbIGtleSBdID0gdmFsdWU7CgkJCS8vIGRpc2FibGUgZWxlbWVudCBzdHlsZSBjaGFuZ2VzCgkJCXJldHVybjsKCQl9CgoJCXRoaXMuX3N1cGVyKCBrZXksIHZhbHVlICk7CgoJCWlmICgga2V5ID09PSAiY29udGVudCIgKSB7CgkJCSQuZWFjaCggdGhpcy50b29sdGlwcywgZnVuY3Rpb24oIGlkLCBlbGVtZW50ICkgewoJCQkJdGhhdC5fdXBkYXRlQ29udGVudCggZWxlbWVudCApOwoJCQl9KTsKCQl9Cgl9LAoKCV9kaXNhYmxlOiBmdW5jdGlvbigpIHsKCQl2YXIgdGhhdCA9IHRoaXM7CgoJCS8vIGNsb3NlIG9wZW4gdG9vbHRpcHMKCQkkLmVhY2goIHRoaXMudG9vbHRpcHMsIGZ1bmN0aW9uKCBpZCwgZWxlbWVudCApIHsKCQkJdmFyIGV2ZW50ID0gJC5FdmVudCggImJsdXIiICk7CgkJCWV2ZW50LnRhcmdldCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQgPSBlbGVtZW50WzBdOwoJCQl0aGF0LmNsb3NlKCBldmVudCwgdHJ1ZSApOwoJCX0pOwoKCQkvLyByZW1vdmUgdGl0bGUgYXR0cmlidXRlcyB0byBwcmV2ZW50IG5hdGl2ZSB0b29sdGlwcwoJCXRoaXMuZWxlbWVudC5maW5kKCB0aGlzLm9wdGlvbnMuaXRlbXMgKS5hZGRCYWNrKCkuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIGVsZW1lbnQgPSAkKCB0aGlzICk7CgkJCWlmICggZWxlbWVudC5pcyggIlt0aXRsZV0iICkgKSB7CgkJCQllbGVtZW50CgkJCQkJLmRhdGEoICJ1aS10b29sdGlwLXRpdGxlIiwgZWxlbWVudC5hdHRyKCAidGl0bGUiICkgKQoJCQkJCS5hdHRyKCAidGl0bGUiLCAiIiApOwoJCQl9CgkJfSk7Cgl9LAoKCV9lbmFibGU6IGZ1bmN0aW9uKCkgewoJCS8vIHJlc3RvcmUgdGl0bGUgYXR0cmlidXRlcwoJCXRoaXMuZWxlbWVudC5maW5kKCB0aGlzLm9wdGlvbnMuaXRlbXMgKS5hZGRCYWNrKCkuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIGVsZW1lbnQgPSAkKCB0aGlzICk7CgkJCWlmICggZWxlbWVudC5kYXRhKCAidWktdG9vbHRpcC10aXRsZSIgKSApIHsKCQkJCWVsZW1lbnQuYXR0ciggInRpdGxlIiwgZWxlbWVudC5kYXRhKCAidWktdG9vbHRpcC10aXRsZSIgKSApOwoJCQl9CgkJfSk7Cgl9LAoKCW9wZW46IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCXRhcmdldCA9ICQoIGV2ZW50ID8gZXZlbnQudGFyZ2V0IDogdGhpcy5lbGVtZW50ICkKCQkJCS8vIHdlIG5lZWQgY2xvc2VzdCBoZXJlIGR1ZSB0byBtb3VzZW92ZXIgYnViYmxpbmcsCgkJCQkvLyBidXQgYWx3YXlzIHBvaW50aW5nIGF0IHRoZSBzYW1lIGV2ZW50IHRhcmdldAoJCQkJLmNsb3Nlc3QoIHRoaXMub3B0aW9ucy5pdGVtcyApOwoKCQkvLyBObyBlbGVtZW50IHRvIHNob3cgYSB0b29sdGlwIGZvciBvciB0aGUgdG9vbHRpcCBpcyBhbHJlYWR5IG9wZW4KCQlpZiAoICF0YXJnZXQubGVuZ3RoIHx8IHRhcmdldC5kYXRhKCAidWktdG9vbHRpcC1pZCIgKSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKCB0YXJnZXQuYXR0ciggInRpdGxlIiApICkgewoJCQl0YXJnZXQuZGF0YSggInVpLXRvb2x0aXAtdGl0bGUiLCB0YXJnZXQuYXR0ciggInRpdGxlIiApICk7CgkJfQoKCQl0YXJnZXQuZGF0YSggInVpLXRvb2x0aXAtb3BlbiIsIHRydWUgKTsKCgkJLy8ga2lsbCBwYXJlbnQgdG9vbHRpcHMsIGN1c3RvbSBvciBuYXRpdmUsIGZvciBob3ZlcgoJCWlmICggZXZlbnQgJiYgZXZlbnQudHlwZSA9PT0gIm1vdXNlb3ZlciIgKSB7CgkJCXRhcmdldC5wYXJlbnRzKCkuZWFjaChmdW5jdGlvbigpIHsKCQkJCXZhciBwYXJlbnQgPSAkKCB0aGlzICksCgkJCQkJYmx1ckV2ZW50OwoJCQkJaWYgKCBwYXJlbnQuZGF0YSggInVpLXRvb2x0aXAtb3BlbiIgKSApIHsKCQkJCQlibHVyRXZlbnQgPSAkLkV2ZW50KCAiYmx1ciIgKTsKCQkJCQlibHVyRXZlbnQudGFyZ2V0ID0gYmx1ckV2ZW50LmN1cnJlbnRUYXJnZXQgPSB0aGlzOwoJCQkJCXRoYXQuY2xvc2UoIGJsdXJFdmVudCwgdHJ1ZSApOwoJCQkJfQoJCQkJaWYgKCBwYXJlbnQuYXR0ciggInRpdGxlIiApICkgewoJCQkJCXBhcmVudC51bmlxdWVJZCgpOwoJCQkJCXRoYXQucGFyZW50c1sgdGhpcy5pZCBdID0gewoJCQkJCQllbGVtZW50OiB0aGlzLAoJCQkJCQl0aXRsZTogcGFyZW50LmF0dHIoICJ0aXRsZSIgKQoJCQkJCX07CgkJCQkJcGFyZW50LmF0dHIoICJ0aXRsZSIsICIiICk7CgkJCQl9CgkJCX0pOwoJCX0KCgkJdGhpcy5fdXBkYXRlQ29udGVudCggdGFyZ2V0LCBldmVudCApOwoJfSwKCglfdXBkYXRlQ29udGVudDogZnVuY3Rpb24oIHRhcmdldCwgZXZlbnQgKSB7CgkJdmFyIGNvbnRlbnQsCgkJCWNvbnRlbnRPcHRpb24gPSB0aGlzLm9wdGlvbnMuY29udGVudCwKCQkJdGhhdCA9IHRoaXMsCgkJCWV2ZW50VHlwZSA9IGV2ZW50ID8gZXZlbnQudHlwZSA6IG51bGw7CgoJCWlmICggdHlwZW9mIGNvbnRlbnRPcHRpb24gPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gdGhpcy5fb3BlbiggZXZlbnQsIHRhcmdldCwgY29udGVudE9wdGlvbiApOwoJCX0KCgkJY29udGVudCA9IGNvbnRlbnRPcHRpb24uY2FsbCggdGFyZ2V0WzBdLCBmdW5jdGlvbiggcmVzcG9uc2UgKSB7CgkJCS8vIGlnbm9yZSBhc3luYyByZXNwb25zZSBpZiB0b29sdGlwIHdhcyBjbG9zZWQgYWxyZWFkeQoJCQlpZiAoICF0YXJnZXQuZGF0YSggInVpLXRvb2x0aXAtb3BlbiIgKSApIHsKCQkJCXJldHVybjsKCQkJfQoJCQkvLyBJRSBtYXkgaW5zdGFudGx5IHNlcnZlIGEgY2FjaGVkIHJlc3BvbnNlIGZvciBhamF4IHJlcXVlc3RzCgkJCS8vIGRlbGF5IHRoaXMgY2FsbCB0byBfb3BlbiBzbyB0aGUgb3RoZXIgY2FsbCB0byBfb3BlbiBydW5zIGZpcnN0CgkJCXRoYXQuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQkJLy8galF1ZXJ5IGNyZWF0ZXMgYSBzcGVjaWFsIGV2ZW50IGZvciBmb2N1c2luIHdoZW4gaXQgZG9lc24ndAoJCQkJLy8gZXhpc3QgbmF0aXZlbHkuIFRvIGltcHJvdmUgcGVyZm9ybWFuY2UsIHRoZSBuYXRpdmUgZXZlbnQKCQkJCS8vIG9iamVjdCBpcyByZXVzZWQgYW5kIHRoZSB0eXBlIGlzIGNoYW5nZWQuIFRoZXJlZm9yZSwgd2UgY2FuJ3QKCQkJCS8vIHJlbHkgb24gdGhlIHR5cGUgYmVpbmcgY29ycmVjdCBhZnRlciB0aGUgZXZlbnQgZmluaXNoZWQKCQkJCS8vIGJ1YmJsaW5nLCBzbyB3ZSBzZXQgaXQgYmFjayB0byB0aGUgcHJldmlvdXMgdmFsdWUuICgjODc0MCkKCQkJCWlmICggZXZlbnQgKSB7CgkJCQkJZXZlbnQudHlwZSA9IGV2ZW50VHlwZTsKCQkJCX0KCQkJCXRoaXMuX29wZW4oIGV2ZW50LCB0YXJnZXQsIHJlc3BvbnNlICk7CgkJCX0pOwoJCX0pOwoJCWlmICggY29udGVudCApIHsKCQkJdGhpcy5fb3BlbiggZXZlbnQsIHRhcmdldCwgY29udGVudCApOwoJCX0KCX0sCgoJX29wZW46IGZ1bmN0aW9uKCBldmVudCwgdGFyZ2V0LCBjb250ZW50ICkgewoJCXZhciB0b29sdGlwLCBldmVudHMsIGRlbGF5ZWRTaG93LAoJCQlwb3NpdGlvbk9wdGlvbiA9ICQuZXh0ZW5kKCB7fSwgdGhpcy5vcHRpb25zLnBvc2l0aW9uICk7CgoJCWlmICggIWNvbnRlbnQgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIENvbnRlbnQgY2FuIGJlIHVwZGF0ZWQgbXVsdGlwbGUgdGltZXMuIElmIHRoZSB0b29sdGlwIGFscmVhZHkKCQkvLyBleGlzdHMsIHRoZW4ganVzdCB1cGRhdGUgdGhlIGNvbnRlbnQgYW5kIGJhaWwuCgkJdG9vbHRpcCA9IHRoaXMuX2ZpbmQoIHRhcmdldCApOwoJCWlmICggdG9vbHRpcC5sZW5ndGggKSB7CgkJCXRvb2x0aXAuZmluZCggIi51aS10b29sdGlwLWNvbnRlbnQiICkuaHRtbCggY29udGVudCApOwoJCQlyZXR1cm47CgkJfQoKCQkvLyBpZiB3ZSBoYXZlIGEgdGl0bGUsIGNsZWFyIGl0IHRvIHByZXZlbnQgdGhlIG5hdGl2ZSB0b29sdGlwCgkJLy8gd2UgaGF2ZSB0byBjaGVjayBmaXJzdCB0byBhdm9pZCBkZWZpbmluZyBhIHRpdGxlIGlmIG5vbmUgZXhpc3RzCgkJLy8gKHdlIGRvbid0IHdhbnQgdG8gY2F1c2UgYW4gZWxlbWVudCB0byBzdGFydCBtYXRjaGluZyBbdGl0bGVdKQoJCS8vCgkJLy8gV2UgdXNlIHJlbW92ZUF0dHIgb25seSBmb3Iga2V5IGV2ZW50cywgdG8gYWxsb3cgSUUgdG8gZXhwb3J0IHRoZSBjb3JyZWN0CgkJLy8gYWNjZXNzaWJsZSBhdHRyaWJ1dGVzLiBGb3IgbW91c2UgZXZlbnRzLCBzZXQgdG8gZW1wdHkgc3RyaW5nIHRvIGF2b2lkCgkJLy8gbmF0aXZlIHRvb2x0aXAgc2hvd2luZyB1cCAoaGFwcGVucyBvbmx5IHdoZW4gcmVtb3ZpbmcgaW5zaWRlIG1vdXNlb3ZlcikuCgkJaWYgKCB0YXJnZXQuaXMoICJbdGl0bGVdIiApICkgewoJCQlpZiAoIGV2ZW50ICYmIGV2ZW50LnR5cGUgPT09ICJtb3VzZW92ZXIiICkgewoJCQkJdGFyZ2V0LmF0dHIoICJ0aXRsZSIsICIiICk7CgkJCX0gZWxzZSB7CgkJCQl0YXJnZXQucmVtb3ZlQXR0ciggInRpdGxlIiApOwoJCQl9CgkJfQoKCQl0b29sdGlwID0gdGhpcy5fdG9vbHRpcCggdGFyZ2V0ICk7CgkJYWRkRGVzY3JpYmVkQnkoIHRhcmdldCwgdG9vbHRpcC5hdHRyKCAiaWQiICkgKTsKCQl0b29sdGlwLmZpbmQoICIudWktdG9vbHRpcC1jb250ZW50IiApLmh0bWwoIGNvbnRlbnQgKTsKCgkJZnVuY3Rpb24gcG9zaXRpb24oIGV2ZW50ICkgewoJCQlwb3NpdGlvbk9wdGlvbi5vZiA9IGV2ZW50OwoJCQlpZiAoIHRvb2x0aXAuaXMoICI6aGlkZGVuIiApICkgewoJCQkJcmV0dXJuOwoJCQl9CgkJCXRvb2x0aXAucG9zaXRpb24oIHBvc2l0aW9uT3B0aW9uICk7CgkJfQoJCWlmICggdGhpcy5vcHRpb25zLnRyYWNrICYmIGV2ZW50ICYmIC9ebW91c2UvLnRlc3QoIGV2ZW50LnR5cGUgKSApIHsKCQkJdGhpcy5fb24oIHRoaXMuZG9jdW1lbnQsIHsKCQkJCW1vdXNlbW92ZTogcG9zaXRpb24KCQkJfSk7CgkJCS8vIHRyaWdnZXIgb25jZSB0byBvdmVycmlkZSBlbGVtZW50LXJlbGF0aXZlIHBvc2l0aW9uaW5nCgkJCXBvc2l0aW9uKCBldmVudCApOwoJCX0gZWxzZSB7CgkJCXRvb2x0aXAucG9zaXRpb24oICQuZXh0ZW5kKHsKCQkJCW9mOiB0YXJnZXQKCQkJfSwgdGhpcy5vcHRpb25zLnBvc2l0aW9uICkgKTsKCQl9CgoJCXRvb2x0aXAuaGlkZSgpOwoKCQl0aGlzLl9zaG93KCB0b29sdGlwLCB0aGlzLm9wdGlvbnMuc2hvdyApOwoJCS8vIEhhbmRsZSB0cmFja2luZyB0b29sdGlwcyB0aGF0IGFyZSBzaG93biB3aXRoIGEgZGVsYXkgKCM4NjQ0KS4gQXMgc29vbgoJCS8vIGFzIHRoZSB0b29sdGlwIGlzIHZpc2libGUsIHBvc2l0aW9uIHRoZSB0b29sdGlwIHVzaW5nIHRoZSBtb3N0IHJlY2VudAoJCS8vIGV2ZW50LgoJCWlmICggdGhpcy5vcHRpb25zLnNob3cgJiYgdGhpcy5vcHRpb25zLnNob3cuZGVsYXkgKSB7CgkJCWRlbGF5ZWRTaG93ID0gdGhpcy5kZWxheWVkU2hvdyA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgewoJCQkJaWYgKCB0b29sdGlwLmlzKCAiOnZpc2libGUiICkgKSB7CgkJCQkJcG9zaXRpb24oIHBvc2l0aW9uT3B0aW9uLm9mICk7CgkJCQkJY2xlYXJJbnRlcnZhbCggZGVsYXllZFNob3cgKTsKCQkJCX0KCQkJfSwgJC5meC5pbnRlcnZhbCApOwoJCX0KCgkJdGhpcy5fdHJpZ2dlciggIm9wZW4iLCBldmVudCwgeyB0b29sdGlwOiB0b29sdGlwIH0gKTsKCgkJZXZlbnRzID0gewoJCQlrZXl1cDogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJaWYgKCBldmVudC5rZXlDb2RlID09PSAkLnVpLmtleUNvZGUuRVNDQVBFICkgewoJCQkJCXZhciBmYWtlRXZlbnQgPSAkLkV2ZW50KGV2ZW50KTsKCQkJCQlmYWtlRXZlbnQuY3VycmVudFRhcmdldCA9IHRhcmdldFswXTsKCQkJCQl0aGlzLmNsb3NlKCBmYWtlRXZlbnQsIHRydWUgKTsKCQkJCX0KCQkJfSwKCQkJcmVtb3ZlOiBmdW5jdGlvbigpIHsKCQkJCXRoaXMuX3JlbW92ZVRvb2x0aXAoIHRvb2x0aXAgKTsKCQkJfQoJCX07CgkJaWYgKCAhZXZlbnQgfHwgZXZlbnQudHlwZSA9PT0gIm1vdXNlb3ZlciIgKSB7CgkJCWV2ZW50cy5tb3VzZWxlYXZlID0gImNsb3NlIjsKCQl9CgkJaWYgKCAhZXZlbnQgfHwgZXZlbnQudHlwZSA9PT0gImZvY3VzaW4iICkgewoJCQlldmVudHMuZm9jdXNvdXQgPSAiY2xvc2UiOwoJCX0KCQl0aGlzLl9vbiggdHJ1ZSwgdGFyZ2V0LCBldmVudHMgKTsKCX0sCgoJY2xvc2U6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCXRhcmdldCA9ICQoIGV2ZW50ID8gZXZlbnQuY3VycmVudFRhcmdldCA6IHRoaXMuZWxlbWVudCApLAoJCQl0b29sdGlwID0gdGhpcy5fZmluZCggdGFyZ2V0ICk7CgoJCS8vIGRpc2FibGluZyBjbG9zZXMgdGhlIHRvb2x0aXAsIHNvIHdlIG5lZWQgdG8gdHJhY2sgd2hlbiB3ZSdyZSBjbG9zaW5nCgkJLy8gdG8gYXZvaWQgYW4gaW5maW5pdGUgbG9vcCBpbiBjYXNlIHRoZSB0b29sdGlwIGJlY29tZXMgZGlzYWJsZWQgb24gY2xvc2UKCQlpZiAoIHRoaXMuY2xvc2luZyApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gQ2xlYXIgdGhlIGludGVydmFsIGZvciBkZWxheWVkIHRyYWNraW5nIHRvb2x0aXBzCgkJY2xlYXJJbnRlcnZhbCggdGhpcy5kZWxheWVkU2hvdyApOwoKCQkvLyBvbmx5IHNldCB0aXRsZSBpZiB3ZSBoYWQgb25lIGJlZm9yZSAoc2VlIGNvbW1lbnQgaW4gX29wZW4oKSkKCQlpZiAoIHRhcmdldC5kYXRhKCAidWktdG9vbHRpcC10aXRsZSIgKSApIHsKCQkJdGFyZ2V0LmF0dHIoICJ0aXRsZSIsIHRhcmdldC5kYXRhKCAidWktdG9vbHRpcC10aXRsZSIgKSApOwoJCX0KCgkJcmVtb3ZlRGVzY3JpYmVkQnkoIHRhcmdldCApOwoKCQl0b29sdGlwLnN0b3AoIHRydWUgKTsKCQl0aGlzLl9oaWRlKCB0b29sdGlwLCB0aGlzLm9wdGlvbnMuaGlkZSwgZnVuY3Rpb24oKSB7CgkJCXRoYXQuX3JlbW92ZVRvb2x0aXAoICQoIHRoaXMgKSApOwoJCX0pOwoKCQl0YXJnZXQucmVtb3ZlRGF0YSggInVpLXRvb2x0aXAtb3BlbiIgKTsKCQl0aGlzLl9vZmYoIHRhcmdldCwgIm1vdXNlbGVhdmUgZm9jdXNvdXQga2V5dXAiICk7CgkJLy8gUmVtb3ZlICdyZW1vdmUnIGJpbmRpbmcgb25seSBvbiBkZWxlZ2F0ZWQgdGFyZ2V0cwoJCWlmICggdGFyZ2V0WzBdICE9PSB0aGlzLmVsZW1lbnRbMF0gKSB7CgkJCXRoaXMuX29mZiggdGFyZ2V0LCAicmVtb3ZlIiApOwoJCX0KCQl0aGlzLl9vZmYoIHRoaXMuZG9jdW1lbnQsICJtb3VzZW1vdmUiICk7CgoJCWlmICggZXZlbnQgJiYgZXZlbnQudHlwZSA9PT0gIm1vdXNlbGVhdmUiICkgewoJCQkkLmVhY2goIHRoaXMucGFyZW50cywgZnVuY3Rpb24oIGlkLCBwYXJlbnQgKSB7CgkJCQkkKCBwYXJlbnQuZWxlbWVudCApLmF0dHIoICJ0aXRsZSIsIHBhcmVudC50aXRsZSApOwoJCQkJZGVsZXRlIHRoYXQucGFyZW50c1sgaWQgXTsKCQkJfSk7CgkJfQoKCQl0aGlzLmNsb3NpbmcgPSB0cnVlOwoJCXRoaXMuX3RyaWdnZXIoICJjbG9zZSIsIGV2ZW50LCB7IHRvb2x0aXA6IHRvb2x0aXAgfSApOwoJCXRoaXMuY2xvc2luZyA9IGZhbHNlOwoJfSwKCglfdG9vbHRpcDogZnVuY3Rpb24oIGVsZW1lbnQgKSB7CgkJdmFyIGlkID0gInVpLXRvb2x0aXAtIiArIGluY3JlbWVudHMrKywKCQkJdG9vbHRpcCA9ICQoICI8ZGl2PiIgKQoJCQkJLmF0dHIoewoJCQkJCWlkOiBpZCwKCQkJCQlyb2xlOiAidG9vbHRpcCIKCQkJCX0pCgkJCQkuYWRkQ2xhc3MoICJ1aS10b29sdGlwIHVpLXdpZGdldCB1aS1jb3JuZXItYWxsIHVpLXdpZGdldC1jb250ZW50ICIgKwoJCQkJCSggdGhpcy5vcHRpb25zLnRvb2x0aXBDbGFzcyB8fCAiIiApICk7CgkJJCggIjxkaXY+IiApCgkJCS5hZGRDbGFzcyggInVpLXRvb2x0aXAtY29udGVudCIgKQoJCQkuYXBwZW5kVG8oIHRvb2x0aXAgKTsKCQl0b29sdGlwLmFwcGVuZFRvKCB0aGlzLmRvY3VtZW50WzBdLmJvZHkgKTsKCQl0aGlzLnRvb2x0aXBzWyBpZCBdID0gZWxlbWVudDsKCQlyZXR1cm4gdG9vbHRpcDsKCX0sCgoJX2ZpbmQ6IGZ1bmN0aW9uKCB0YXJnZXQgKSB7CgkJdmFyIGlkID0gdGFyZ2V0LmRhdGEoICJ1aS10b29sdGlwLWlkIiApOwoJCXJldHVybiBpZCA/ICQoICIjIiArIGlkICkgOiAkKCk7Cgl9LAoKCV9yZW1vdmVUb29sdGlwOiBmdW5jdGlvbiggdG9vbHRpcCApIHsKCQl0b29sdGlwLnJlbW92ZSgpOwoJCWRlbGV0ZSB0aGlzLnRvb2x0aXBzWyB0b29sdGlwLmF0dHIoICJpZCIgKSBdOwoJfSwKCglfZGVzdHJveTogZnVuY3Rpb24oKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoKCQkvLyBjbG9zZSBvcGVuIHRvb2x0aXBzCgkJJC5lYWNoKCB0aGlzLnRvb2x0aXBzLCBmdW5jdGlvbiggaWQsIGVsZW1lbnQgKSB7CgkJCS8vIERlbGVnYXRlIHRvIGNsb3NlIG1ldGhvZCB0byBoYW5kbGUgY29tbW9uIGNsZWFudXAKCQkJdmFyIGV2ZW50ID0gJC5FdmVudCggImJsdXIiICk7CgkJCWV2ZW50LnRhcmdldCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQgPSBlbGVtZW50WzBdOwoJCQl0aGF0LmNsb3NlKCBldmVudCwgdHJ1ZSApOwoKCQkJLy8gUmVtb3ZlIGltbWVkaWF0ZWx5OyBkZXN0cm95aW5nIGFuIG9wZW4gdG9vbHRpcCBkb2Vzbid0IHVzZSB0aGUKCQkJLy8gaGlkZSBhbmltYXRpb24KCQkJJCggIiMiICsgaWQgKS5yZW1vdmUoKTsKCgkJCS8vIFJlc3RvcmUgdGhlIHRpdGxlCgkJCWlmICggZWxlbWVudC5kYXRhKCAidWktdG9vbHRpcC10aXRsZSIgKSApIHsKCQkJCWVsZW1lbnQuYXR0ciggInRpdGxlIiwgZWxlbWVudC5kYXRhKCAidWktdG9vbHRpcC10aXRsZSIgKSApOwoJCQkJZWxlbWVudC5yZW1vdmVEYXRhKCAidWktdG9vbHRpcC10aXRsZSIgKTsKCQkJfQoJCX0pOwoJfQp9KTsKCn0oIGpRdWVyeSApICk7Cgp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvKgogQW5ndWxhckpTIHYxLjUuNgogKGMpIDIwMTAtMjAxNiBHb29nbGUsIEluYy4gaHR0cDovL2FuZ3VsYXJqcy5vcmcKIExpY2Vuc2U6IE1JVAoqLwooZnVuY3Rpb24oRil7J3VzZSBzdHJpY3QnO2Z1bmN0aW9uIE8oYSl7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGI9YXJndW1lbnRzWzBdLGQ7ZD0iWyIrKGE/YSsiOiI6IiIpK2IrIl0gaHR0cDovL2Vycm9ycy5hbmd1bGFyanMub3JnLzEuNS42LyIrKGE/YSsiLyI6IiIpK2I7Zm9yKGI9MTtiPGFyZ3VtZW50cy5sZW5ndGg7YisrKXtkPWQrKDE9PWI/Ij8iOiImIikrInAiKyhiLTEpKyI9Ijt2YXIgYz1lbmNvZGVVUklDb21wb25lbnQsZTtlPWFyZ3VtZW50c1tiXTtlPSJmdW5jdGlvbiI9PXR5cGVvZiBlP2UudG9TdHJpbmcoKS5yZXBsYWNlKC8gXHtbXHNcU10qJC8sIiIpOiJ1bmRlZmluZWQiPT10eXBlb2YgZT8idW5kZWZpbmVkIjoic3RyaW5nIiE9dHlwZW9mIGU/SlNPTi5zdHJpbmdpZnkoZSk6ZTtkKz1jKGUpfXJldHVybiBFcnJvcihkKX19ZnVuY3Rpb24geGEoYSl7aWYobnVsbD09YXx8V2EoYSkpcmV0dXJuITE7aWYoSyhhKXx8SShhKXx8RyYmYSBpbnN0YW5jZW9mIEcpcmV0dXJuITA7CnZhciBiPSJsZW5ndGgiaW4gT2JqZWN0KGEpJiZhLmxlbmd0aDtyZXR1cm4gUShiKSYmKDA8PWImJihiLTEgaW4gYXx8YSBpbnN0YW5jZW9mIEFycmF5KXx8ImZ1bmN0aW9uIj09dHlwZW9mIGEuaXRlbSl9ZnVuY3Rpb24gcShhLGIsZCl7dmFyIGMsZTtpZihhKWlmKEUoYSkpZm9yKGMgaW4gYSkicHJvdG90eXBlIj09Y3x8Imxlbmd0aCI9PWN8fCJuYW1lIj09Y3x8YS5oYXNPd25Qcm9wZXJ0eSYmIWEuaGFzT3duUHJvcGVydHkoYyl8fGIuY2FsbChkLGFbY10sYyxhKTtlbHNlIGlmKEsoYSl8fHhhKGEpKXt2YXIgZj0ib2JqZWN0IiE9PXR5cGVvZiBhO2M9MDtmb3IoZT1hLmxlbmd0aDtjPGU7YysrKShmfHxjIGluIGEpJiZiLmNhbGwoZCxhW2NdLGMsYSl9ZWxzZSBpZihhLmZvckVhY2gmJmEuZm9yRWFjaCE9PXEpYS5mb3JFYWNoKGIsZCxhKTtlbHNlIGlmKHJjKGEpKWZvcihjIGluIGEpYi5jYWxsKGQsYVtjXSxjLGEpO2Vsc2UgaWYoImZ1bmN0aW9uIj09PXR5cGVvZiBhLmhhc093blByb3BlcnR5KWZvcihjIGluIGEpYS5oYXNPd25Qcm9wZXJ0eShjKSYmCmIuY2FsbChkLGFbY10sYyxhKTtlbHNlIGZvcihjIGluIGEpc2EuY2FsbChhLGMpJiZiLmNhbGwoZCxhW2NdLGMsYSk7cmV0dXJuIGF9ZnVuY3Rpb24gc2MoYSxiLGQpe2Zvcih2YXIgYz1PYmplY3Qua2V5cyhhKS5zb3J0KCksZT0wO2U8Yy5sZW5ndGg7ZSsrKWIuY2FsbChkLGFbY1tlXV0sY1tlXSk7cmV0dXJuIGN9ZnVuY3Rpb24gdGMoYSl7cmV0dXJuIGZ1bmN0aW9uKGIsZCl7YShkLGIpfX1mdW5jdGlvbiBZZCgpe3JldHVybisrcGJ9ZnVuY3Rpb24gUWIoYSxiLGQpe2Zvcih2YXIgYz1hLiQkaGFzaEtleSxlPTAsZj1iLmxlbmd0aDtlPGY7KytlKXt2YXIgZz1iW2VdO2lmKEooZyl8fEUoZykpZm9yKHZhciBoPU9iamVjdC5rZXlzKGcpLGs9MCxsPWgubGVuZ3RoO2s8bDtrKyspe3ZhciBtPWhba10sbj1nW21dO2QmJkoobik/aGEobik/YVttXT1uZXcgRGF0ZShuLnZhbHVlT2YoKSk6WGEobik/YVttXT1uZXcgUmVnRXhwKG4pOm4ubm9kZU5hbWU/YVttXT1uLmNsb25lTm9kZSghMCk6ClJiKG4pP2FbbV09bi5jbG9uZSgpOihKKGFbbV0pfHwoYVttXT1LKG4pP1tdOnt9KSxRYihhW21dLFtuXSwhMCkpOmFbbV09bn19Yz9hLiQkaGFzaEtleT1jOmRlbGV0ZSBhLiQkaGFzaEtleTtyZXR1cm4gYX1mdW5jdGlvbiBQKGEpe3JldHVybiBRYihhLHlhLmNhbGwoYXJndW1lbnRzLDEpLCExKX1mdW5jdGlvbiBaZChhKXtyZXR1cm4gUWIoYSx5YS5jYWxsKGFyZ3VtZW50cywxKSwhMCl9ZnVuY3Rpb24gJChhKXtyZXR1cm4gcGFyc2VJbnQoYSwxMCl9ZnVuY3Rpb24gU2IoYSxiKXtyZXR1cm4gUChPYmplY3QuY3JlYXRlKGEpLGIpfWZ1bmN0aW9uIEMoKXt9ZnVuY3Rpb24gWWEoYSl7cmV0dXJuIGF9ZnVuY3Rpb24gY2EoYSl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGF9fWZ1bmN0aW9uIHVjKGEpe3JldHVybiBFKGEudG9TdHJpbmcpJiZhLnRvU3RyaW5nIT09amF9ZnVuY3Rpb24geShhKXtyZXR1cm4idW5kZWZpbmVkIj09PXR5cGVvZiBhfWZ1bmN0aW9uIHYoYSl7cmV0dXJuInVuZGVmaW5lZCIhPT0KdHlwZW9mIGF9ZnVuY3Rpb24gSihhKXtyZXR1cm4gbnVsbCE9PWEmJiJvYmplY3QiPT09dHlwZW9mIGF9ZnVuY3Rpb24gcmMoYSl7cmV0dXJuIG51bGwhPT1hJiYib2JqZWN0Ij09PXR5cGVvZiBhJiYhdmMoYSl9ZnVuY3Rpb24gSShhKXtyZXR1cm4ic3RyaW5nIj09PXR5cGVvZiBhfWZ1bmN0aW9uIFEoYSl7cmV0dXJuIm51bWJlciI9PT10eXBlb2YgYX1mdW5jdGlvbiBoYShhKXtyZXR1cm4iW29iamVjdCBEYXRlXSI9PT1qYS5jYWxsKGEpfWZ1bmN0aW9uIEUoYSl7cmV0dXJuImZ1bmN0aW9uIj09PXR5cGVvZiBhfWZ1bmN0aW9uIFhhKGEpe3JldHVybiJbb2JqZWN0IFJlZ0V4cF0iPT09amEuY2FsbChhKX1mdW5jdGlvbiBXYShhKXtyZXR1cm4gYSYmYS53aW5kb3c9PT1hfWZ1bmN0aW9uIFphKGEpe3JldHVybiBhJiZhLiRldmFsQXN5bmMmJmEuJHdhdGNofWZ1bmN0aW9uIEVhKGEpe3JldHVybiJib29sZWFuIj09PXR5cGVvZiBhfWZ1bmN0aW9uICRkKGEpe3JldHVybiBhJiZRKGEubGVuZ3RoKSYmCmFlLnRlc3QoamEuY2FsbChhKSl9ZnVuY3Rpb24gUmIoYSl7cmV0dXJuISghYXx8IShhLm5vZGVOYW1lfHxhLnByb3AmJmEuYXR0ciYmYS5maW5kKSl9ZnVuY3Rpb24gYmUoYSl7dmFyIGI9e307YT1hLnNwbGl0KCIsIik7dmFyIGQ7Zm9yKGQ9MDtkPGEubGVuZ3RoO2QrKyliW2FbZF1dPSEwO3JldHVybiBifWZ1bmN0aW9uIHRhKGEpe3JldHVybiBMKGEubm9kZU5hbWV8fGFbMF0mJmFbMF0ubm9kZU5hbWUpfWZ1bmN0aW9uICRhKGEsYil7dmFyIGQ9YS5pbmRleE9mKGIpOzA8PWQmJmEuc3BsaWNlKGQsMSk7cmV0dXJuIGR9ZnVuY3Rpb24gb2EoYSxiKXtmdW5jdGlvbiBkKGEsYil7dmFyIGQ9Yi4kJGhhc2hLZXksZTtpZihLKGEpKXtlPTA7Zm9yKHZhciBmPWEubGVuZ3RoO2U8ZjtlKyspYi5wdXNoKGMoYVtlXSkpfWVsc2UgaWYocmMoYSkpZm9yKGUgaW4gYSliW2VdPWMoYVtlXSk7ZWxzZSBpZihhJiYiZnVuY3Rpb24iPT09dHlwZW9mIGEuaGFzT3duUHJvcGVydHkpZm9yKGUgaW4gYSlhLmhhc093blByb3BlcnR5KGUpJiYKKGJbZV09YyhhW2VdKSk7ZWxzZSBmb3IoZSBpbiBhKXNhLmNhbGwoYSxlKSYmKGJbZV09YyhhW2VdKSk7ZD9iLiQkaGFzaEtleT1kOmRlbGV0ZSBiLiQkaGFzaEtleTtyZXR1cm4gYn1mdW5jdGlvbiBjKGEpe2lmKCFKKGEpKXJldHVybiBhO3ZhciBiPWYuaW5kZXhPZihhKTtpZigtMSE9PWIpcmV0dXJuIGdbYl07aWYoV2EoYSl8fFphKGEpKXRocm93IHphKCJjcHdzIik7dmFyIGI9ITEsYz1lKGEpO3ZvaWQgMD09PWMmJihjPUsoYSk/W106T2JqZWN0LmNyZWF0ZSh2YyhhKSksYj0hMCk7Zi5wdXNoKGEpO2cucHVzaChjKTtyZXR1cm4gYj9kKGEsYyk6Y31mdW5jdGlvbiBlKGEpe3N3aXRjaChqYS5jYWxsKGEpKXtjYXNlICJbb2JqZWN0IEludDhBcnJheV0iOmNhc2UgIltvYmplY3QgSW50MTZBcnJheV0iOmNhc2UgIltvYmplY3QgSW50MzJBcnJheV0iOmNhc2UgIltvYmplY3QgRmxvYXQzMkFycmF5XSI6Y2FzZSAiW29iamVjdCBGbG9hdDY0QXJyYXldIjpjYXNlICJbb2JqZWN0IFVpbnQ4QXJyYXldIjpjYXNlICJbb2JqZWN0IFVpbnQ4Q2xhbXBlZEFycmF5XSI6Y2FzZSAiW29iamVjdCBVaW50MTZBcnJheV0iOmNhc2UgIltvYmplY3QgVWludDMyQXJyYXldIjpyZXR1cm4gbmV3IGEuY29uc3RydWN0b3IoYyhhLmJ1ZmZlcikpOwpjYXNlICJbb2JqZWN0IEFycmF5QnVmZmVyXSI6aWYoIWEuc2xpY2Upe3ZhciBiPW5ldyBBcnJheUJ1ZmZlcihhLmJ5dGVMZW5ndGgpOyhuZXcgVWludDhBcnJheShiKSkuc2V0KG5ldyBVaW50OEFycmF5KGEpKTtyZXR1cm4gYn1yZXR1cm4gYS5zbGljZSgwKTtjYXNlICJbb2JqZWN0IEJvb2xlYW5dIjpjYXNlICJbb2JqZWN0IE51bWJlcl0iOmNhc2UgIltvYmplY3QgU3RyaW5nXSI6Y2FzZSAiW29iamVjdCBEYXRlXSI6cmV0dXJuIG5ldyBhLmNvbnN0cnVjdG9yKGEudmFsdWVPZigpKTtjYXNlICJbb2JqZWN0IFJlZ0V4cF0iOnJldHVybiBiPW5ldyBSZWdFeHAoYS5zb3VyY2UsYS50b1N0cmluZygpLm1hdGNoKC9bXlwvXSokLylbMF0pLGIubGFzdEluZGV4PWEubGFzdEluZGV4LGI7Y2FzZSAiW29iamVjdCBCbG9iXSI6cmV0dXJuIG5ldyBhLmNvbnN0cnVjdG9yKFthXSx7dHlwZTphLnR5cGV9KX1pZihFKGEuY2xvbmVOb2RlKSlyZXR1cm4gYS5jbG9uZU5vZGUoITApfXZhciBmPVtdLApnPVtdO2lmKGIpe2lmKCRkKGIpfHwiW29iamVjdCBBcnJheUJ1ZmZlcl0iPT09amEuY2FsbChiKSl0aHJvdyB6YSgiY3B0YSIpO2lmKGE9PT1iKXRocm93IHphKCJjcGkiKTtLKGIpP2IubGVuZ3RoPTA6cShiLGZ1bmN0aW9uKGEsZCl7IiQkaGFzaEtleSIhPT1kJiZkZWxldGUgYltkXX0pO2YucHVzaChhKTtnLnB1c2goYik7cmV0dXJuIGQoYSxiKX1yZXR1cm4gYyhhKX1mdW5jdGlvbiBmYShhLGIpe2lmKEsoYSkpe2I9Ynx8W107Zm9yKHZhciBkPTAsYz1hLmxlbmd0aDtkPGM7ZCsrKWJbZF09YVtkXX1lbHNlIGlmKEooYSkpZm9yKGQgaW4gYj1ifHx7fSxhKWlmKCIkIiE9PWQuY2hhckF0KDApfHwiJCIhPT1kLmNoYXJBdCgxKSliW2RdPWFbZF07cmV0dXJuIGJ8fGF9ZnVuY3Rpb24gbmEoYSxiKXtpZihhPT09YilyZXR1cm4hMDtpZihudWxsPT09YXx8bnVsbD09PWIpcmV0dXJuITE7aWYoYSE9PWEmJmIhPT1iKXJldHVybiEwO3ZhciBkPXR5cGVvZiBhLGM7aWYoZD09dHlwZW9mIGImJgoib2JqZWN0Ij09ZClpZihLKGEpKXtpZighSyhiKSlyZXR1cm4hMTtpZigoZD1hLmxlbmd0aCk9PWIubGVuZ3RoKXtmb3IoYz0wO2M8ZDtjKyspaWYoIW5hKGFbY10sYltjXSkpcmV0dXJuITE7cmV0dXJuITB9fWVsc2V7aWYoaGEoYSkpcmV0dXJuIGhhKGIpP25hKGEuZ2V0VGltZSgpLGIuZ2V0VGltZSgpKTohMTtpZihYYShhKSlyZXR1cm4gWGEoYik/YS50b1N0cmluZygpPT1iLnRvU3RyaW5nKCk6ITE7aWYoWmEoYSl8fFphKGIpfHxXYShhKXx8V2EoYil8fEsoYil8fGhhKGIpfHxYYShiKSlyZXR1cm4hMTtkPVMoKTtmb3IoYyBpbiBhKWlmKCIkIiE9PWMuY2hhckF0KDApJiYhRShhW2NdKSl7aWYoIW5hKGFbY10sYltjXSkpcmV0dXJuITE7ZFtjXT0hMH1mb3IoYyBpbiBiKWlmKCEoYyBpbiBkKSYmIiQiIT09Yy5jaGFyQXQoMCkmJnYoYltjXSkmJiFFKGJbY10pKXJldHVybiExO3JldHVybiEwfXJldHVybiExfWZ1bmN0aW9uIGFiKGEsYixkKXtyZXR1cm4gYS5jb25jYXQoeWEuY2FsbChiLApkKSl9ZnVuY3Rpb24gYmIoYSxiKXt2YXIgZD0yPGFyZ3VtZW50cy5sZW5ndGg/eWEuY2FsbChhcmd1bWVudHMsMik6W107cmV0dXJuIUUoYil8fGIgaW5zdGFuY2VvZiBSZWdFeHA/YjpkLmxlbmd0aD9mdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP2IuYXBwbHkoYSxhYihkLGFyZ3VtZW50cywwKSk6Yi5hcHBseShhLGQpfTpmdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP2IuYXBwbHkoYSxhcmd1bWVudHMpOmIuY2FsbChhKX19ZnVuY3Rpb24gY2UoYSxiKXt2YXIgZD1iOyJzdHJpbmciPT09dHlwZW9mIGEmJiIkIj09PWEuY2hhckF0KDApJiYiJCI9PT1hLmNoYXJBdCgxKT9kPXZvaWQgMDpXYShiKT9kPSIkV0lORE9XIjpiJiZGLmRvY3VtZW50PT09Yj9kPSIkRE9DVU1FTlQiOlphKGIpJiYoZD0iJFNDT1BFIik7cmV0dXJuIGR9ZnVuY3Rpb24gY2IoYSxiKXtpZigheShhKSlyZXR1cm4gUShiKXx8KGI9Yj8yOm51bGwpLEpTT04uc3RyaW5naWZ5KGEsY2UsCmIpfWZ1bmN0aW9uIHdjKGEpe3JldHVybiBJKGEpP0pTT04ucGFyc2UoYSk6YX1mdW5jdGlvbiB4YyhhLGIpe2E9YS5yZXBsYWNlKGRlLCIiKTt2YXIgZD1EYXRlLnBhcnNlKCJKYW4gMDEsIDE5NzAgMDA6MDA6MDAgIithKS82RTQ7cmV0dXJuIGlzTmFOKGQpP2I6ZH1mdW5jdGlvbiBUYihhLGIsZCl7ZD1kPy0xOjE7dmFyIGM9YS5nZXRUaW1lem9uZU9mZnNldCgpO2I9eGMoYixjKTtkKj1iLWM7YT1uZXcgRGF0ZShhLmdldFRpbWUoKSk7YS5zZXRNaW51dGVzKGEuZ2V0TWludXRlcygpK2QpO3JldHVybiBhfWZ1bmN0aW9uIHVhKGEpe2E9RyhhKS5jbG9uZSgpO3RyeXthLmVtcHR5KCl9Y2F0Y2goYil7fXZhciBkPUcoIjxkaXY+IikuYXBwZW5kKGEpLmh0bWwoKTt0cnl7cmV0dXJuIGFbMF0ubm9kZVR5cGU9PT1OYT9MKGQpOmQubWF0Y2goL14oPFtePl0rPikvKVsxXS5yZXBsYWNlKC9ePChbXHdcLV0rKS8sZnVuY3Rpb24oYSxiKXtyZXR1cm4iPCIrTChiKX0pfWNhdGNoKGMpe3JldHVybiBMKGQpfX0KZnVuY3Rpb24geWMoYSl7dHJ5e3JldHVybiBkZWNvZGVVUklDb21wb25lbnQoYSl9Y2F0Y2goYil7fX1mdW5jdGlvbiB6YyhhKXt2YXIgYj17fTtxKChhfHwiIikuc3BsaXQoIiYiKSxmdW5jdGlvbihhKXt2YXIgYyxlLGY7YSYmKGU9YT1hLnJlcGxhY2UoL1wrL2csIiUyMCIpLGM9YS5pbmRleE9mKCI9IiksLTEhPT1jJiYoZT1hLnN1YnN0cmluZygwLGMpLGY9YS5zdWJzdHJpbmcoYysxKSksZT15YyhlKSx2KGUpJiYoZj12KGYpP3ljKGYpOiEwLHNhLmNhbGwoYixlKT9LKGJbZV0pP2JbZV0ucHVzaChmKTpiW2VdPVtiW2VdLGZdOmJbZV09ZikpfSk7cmV0dXJuIGJ9ZnVuY3Rpb24gVWIoYSl7dmFyIGI9W107cShhLGZ1bmN0aW9uKGEsYyl7SyhhKT9xKGEsZnVuY3Rpb24oYSl7Yi5wdXNoKGlhKGMsITApKyghMD09PWE/IiI6Ij0iK2lhKGEsITApKSl9KTpiLnB1c2goaWEoYywhMCkrKCEwPT09YT8iIjoiPSIraWEoYSwhMCkpKX0pO3JldHVybiBiLmxlbmd0aD9iLmpvaW4oIiYiKToiIn0KZnVuY3Rpb24gcWIoYSl7cmV0dXJuIGlhKGEsITApLnJlcGxhY2UoLyUyNi9naSwiJiIpLnJlcGxhY2UoLyUzRC9naSwiPSIpLnJlcGxhY2UoLyUyQi9naSwiKyIpfWZ1bmN0aW9uIGlhKGEsYil7cmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChhKS5yZXBsYWNlKC8lNDAvZ2ksIkAiKS5yZXBsYWNlKC8lM0EvZ2ksIjoiKS5yZXBsYWNlKC8lMjQvZywiJCIpLnJlcGxhY2UoLyUyQy9naSwiLCIpLnJlcGxhY2UoLyUzQi9naSwiOyIpLnJlcGxhY2UoLyUyMC9nLGI/IiUyMCI6IisiKX1mdW5jdGlvbiBlZShhLGIpe3ZhciBkLGMsZT1PYS5sZW5ndGg7Zm9yKGM9MDtjPGU7KytjKWlmKGQ9T2FbY10rYixJKGQ9YS5nZXRBdHRyaWJ1dGUoZCkpKXJldHVybiBkO3JldHVybiBudWxsfWZ1bmN0aW9uIGZlKGEsYil7dmFyIGQsYyxlPXt9O3EoT2EsZnVuY3Rpb24oYil7Yis9ImFwcCI7IWQmJmEuaGFzQXR0cmlidXRlJiZhLmhhc0F0dHJpYnV0ZShiKSYmKGQ9YSxjPWEuZ2V0QXR0cmlidXRlKGIpKX0pOwpxKE9hLGZ1bmN0aW9uKGIpe2IrPSJhcHAiO3ZhciBlOyFkJiYoZT1hLnF1ZXJ5U2VsZWN0b3IoIlsiK2IucmVwbGFjZSgiOiIsIlxcOiIpKyJdIikpJiYoZD1lLGM9ZS5nZXRBdHRyaWJ1dGUoYikpfSk7ZCYmKGUuc3RyaWN0RGk9bnVsbCE9PWVlKGQsInN0cmljdC1kaSIpLGIoZCxjP1tjXTpbXSxlKSl9ZnVuY3Rpb24gQWMoYSxiLGQpe0ooZCl8fChkPXt9KTtkPVAoe3N0cmljdERpOiExfSxkKTt2YXIgYz1mdW5jdGlvbigpe2E9RyhhKTtpZihhLmluamVjdG9yKCkpe3ZhciBjPWFbMF09PT1GLmRvY3VtZW50PyJkb2N1bWVudCI6dWEoYSk7dGhyb3cgemEoImJ0c3RycGQiLGMucmVwbGFjZSgvPC8sIiZsdDsiKS5yZXBsYWNlKC8+LywiJmd0OyIpKTt9Yj1ifHxbXTtiLnVuc2hpZnQoWyIkcHJvdmlkZSIsZnVuY3Rpb24oYil7Yi52YWx1ZSgiJHJvb3RFbGVtZW50IixhKX1dKTtkLmRlYnVnSW5mb0VuYWJsZWQmJmIucHVzaChbIiRjb21waWxlUHJvdmlkZXIiLGZ1bmN0aW9uKGEpe2EuZGVidWdJbmZvRW5hYmxlZCghMCl9XSk7CmIudW5zaGlmdCgibmciKTtjPWRiKGIsZC5zdHJpY3REaSk7Yy5pbnZva2UoWyIkcm9vdFNjb3BlIiwiJHJvb3RFbGVtZW50IiwiJGNvbXBpbGUiLCIkaW5qZWN0b3IiLGZ1bmN0aW9uKGEsYixjLGQpe2EuJGFwcGx5KGZ1bmN0aW9uKCl7Yi5kYXRhKCIkaW5qZWN0b3IiLGQpO2MoYikoYSl9KX1dKTtyZXR1cm4gY30sZT0vXk5HX0VOQUJMRV9ERUJVR19JTkZPIS8sZj0vXk5HX0RFRkVSX0JPT1RTVFJBUCEvO0YmJmUudGVzdChGLm5hbWUpJiYoZC5kZWJ1Z0luZm9FbmFibGVkPSEwLEYubmFtZT1GLm5hbWUucmVwbGFjZShlLCIiKSk7aWYoRiYmIWYudGVzdChGLm5hbWUpKXJldHVybiBjKCk7Ri5uYW1lPUYubmFtZS5yZXBsYWNlKGYsIiIpO2RhLnJlc3VtZUJvb3RzdHJhcD1mdW5jdGlvbihhKXtxKGEsZnVuY3Rpb24oYSl7Yi5wdXNoKGEpfSk7cmV0dXJuIGMoKX07RShkYS5yZXN1bWVEZWZlcnJlZEJvb3RzdHJhcCkmJmRhLnJlc3VtZURlZmVycmVkQm9vdHN0cmFwKCl9ZnVuY3Rpb24gZ2UoKXtGLm5hbWU9CiJOR19FTkFCTEVfREVCVUdfSU5GTyEiK0YubmFtZTtGLmxvY2F0aW9uLnJlbG9hZCgpfWZ1bmN0aW9uIGhlKGEpe2E9ZGEuZWxlbWVudChhKS5pbmplY3RvcigpO2lmKCFhKXRocm93IHphKCJ0ZXN0Iik7cmV0dXJuIGEuZ2V0KCIkJHRlc3RhYmlsaXR5Iil9ZnVuY3Rpb24gQmMoYSxiKXtiPWJ8fCJfIjtyZXR1cm4gYS5yZXBsYWNlKGllLGZ1bmN0aW9uKGEsYyl7cmV0dXJuKGM/YjoiIikrYS50b0xvd2VyQ2FzZSgpfSl9ZnVuY3Rpb24gamUoKXt2YXIgYTtpZighQ2Mpe3ZhciBiPXJiKCk7KFk9eShiKT9GLmpRdWVyeTpiP0ZbYl06dm9pZCAwKSYmWS5mbi5vbj8oRz1ZLFAoWS5mbix7c2NvcGU6UGEuc2NvcGUsaXNvbGF0ZVNjb3BlOlBhLmlzb2xhdGVTY29wZSxjb250cm9sbGVyOlBhLmNvbnRyb2xsZXIsaW5qZWN0b3I6UGEuaW5qZWN0b3IsaW5oZXJpdGVkRGF0YTpQYS5pbmhlcml0ZWREYXRhfSksYT1ZLmNsZWFuRGF0YSxZLmNsZWFuRGF0YT1mdW5jdGlvbihiKXtmb3IodmFyIGMsCmU9MCxmO251bGwhPShmPWJbZV0pO2UrKykoYz1ZLl9kYXRhKGYsImV2ZW50cyIpKSYmYy4kZGVzdHJveSYmWShmKS50cmlnZ2VySGFuZGxlcigiJGRlc3Ryb3kiKTthKGIpfSk6Rz1UO2RhLmVsZW1lbnQ9RztDYz0hMH19ZnVuY3Rpb24gc2IoYSxiLGQpe2lmKCFhKXRocm93IHphKCJhcmVxIixifHwiPyIsZHx8InJlcXVpcmVkIik7cmV0dXJuIGF9ZnVuY3Rpb24gUWEoYSxiLGQpe2QmJksoYSkmJihhPWFbYS5sZW5ndGgtMV0pO3NiKEUoYSksYiwibm90IGEgZnVuY3Rpb24sIGdvdCAiKyhhJiYib2JqZWN0Ij09PXR5cGVvZiBhP2EuY29uc3RydWN0b3IubmFtZXx8Ik9iamVjdCI6dHlwZW9mIGEpKTtyZXR1cm4gYX1mdW5jdGlvbiBSYShhLGIpe2lmKCJoYXNPd25Qcm9wZXJ0eSI9PT1hKXRocm93IHphKCJiYWRuYW1lIixiKTt9ZnVuY3Rpb24gRGMoYSxiLGQpe2lmKCFiKXJldHVybiBhO2I9Yi5zcGxpdCgiLiIpO2Zvcih2YXIgYyxlPWEsZj1iLmxlbmd0aCxnPTA7ZzxmO2crKyljPQpiW2ddLGEmJihhPShlPWEpW2NdKTtyZXR1cm4hZCYmRShhKT9iYihlLGEpOmF9ZnVuY3Rpb24gdGIoYSl7Zm9yKHZhciBiPWFbMF0sZD1hW2EubGVuZ3RoLTFdLGMsZT0xO2IhPT1kJiYoYj1iLm5leHRTaWJsaW5nKTtlKyspaWYoY3x8YVtlXSE9PWIpY3x8KGM9Ryh5YS5jYWxsKGEsMCxlKSkpLGMucHVzaChiKTtyZXR1cm4gY3x8YX1mdW5jdGlvbiBTKCl7cmV0dXJuIE9iamVjdC5jcmVhdGUobnVsbCl9ZnVuY3Rpb24ga2UoYSl7ZnVuY3Rpb24gYihhLGIsYyl7cmV0dXJuIGFbYl18fChhW2JdPWMoKSl9dmFyIGQ9TygiJGluamVjdG9yIiksYz1PKCJuZyIpO2E9YihhLCJhbmd1bGFyIixPYmplY3QpO2EuJCRtaW5FcnI9YS4kJG1pbkVycnx8TztyZXR1cm4gYihhLCJtb2R1bGUiLGZ1bmN0aW9uKCl7dmFyIGE9e307cmV0dXJuIGZ1bmN0aW9uKGYsZyxoKXtpZigiaGFzT3duUHJvcGVydHkiPT09Zil0aHJvdyBjKCJiYWRuYW1lIiwibW9kdWxlIik7ZyYmYS5oYXNPd25Qcm9wZXJ0eShmKSYmCihhW2ZdPW51bGwpO3JldHVybiBiKGEsZixmdW5jdGlvbigpe2Z1bmN0aW9uIGEoYixkLGUsZil7Znx8KGY9Yyk7cmV0dXJuIGZ1bmN0aW9uKCl7ZltlfHwicHVzaCJdKFtiLGQsYXJndW1lbnRzXSk7cmV0dXJuIFV9fWZ1bmN0aW9uIGIoYSxkKXtyZXR1cm4gZnVuY3Rpb24oYixlKXtlJiZFKGUpJiYoZS4kJG1vZHVsZU5hbWU9Zik7Yy5wdXNoKFthLGQsYXJndW1lbnRzXSk7cmV0dXJuIFV9fWlmKCFnKXRocm93IGQoIm5vbW9kIixmKTt2YXIgYz1bXSxlPVtdLHA9W10seD1hKCIkaW5qZWN0b3IiLCJpbnZva2UiLCJwdXNoIixlKSxVPXtfaW52b2tlUXVldWU6YyxfY29uZmlnQmxvY2tzOmUsX3J1bkJsb2NrczpwLHJlcXVpcmVzOmcsbmFtZTpmLHByb3ZpZGVyOmIoIiRwcm92aWRlIiwicHJvdmlkZXIiKSxmYWN0b3J5OmIoIiRwcm92aWRlIiwiZmFjdG9yeSIpLHNlcnZpY2U6YigiJHByb3ZpZGUiLCJzZXJ2aWNlIiksdmFsdWU6YSgiJHByb3ZpZGUiLCJ2YWx1ZSIpLGNvbnN0YW50OmEoIiRwcm92aWRlIiwKImNvbnN0YW50IiwidW5zaGlmdCIpLGRlY29yYXRvcjpiKCIkcHJvdmlkZSIsImRlY29yYXRvciIpLGFuaW1hdGlvbjpiKCIkYW5pbWF0ZVByb3ZpZGVyIiwicmVnaXN0ZXIiKSxmaWx0ZXI6YigiJGZpbHRlclByb3ZpZGVyIiwicmVnaXN0ZXIiKSxjb250cm9sbGVyOmIoIiRjb250cm9sbGVyUHJvdmlkZXIiLCJyZWdpc3RlciIpLGRpcmVjdGl2ZTpiKCIkY29tcGlsZVByb3ZpZGVyIiwiZGlyZWN0aXZlIiksY29tcG9uZW50OmIoIiRjb21waWxlUHJvdmlkZXIiLCJjb21wb25lbnQiKSxjb25maWc6eCxydW46ZnVuY3Rpb24oYSl7cC5wdXNoKGEpO3JldHVybiB0aGlzfX07aCYmeChoKTtyZXR1cm4gVX0pfX0pfWZ1bmN0aW9uIGxlKGEpe1AoYSx7Ym9vdHN0cmFwOkFjLGNvcHk6b2EsZXh0ZW5kOlAsbWVyZ2U6WmQsZXF1YWxzOm5hLGVsZW1lbnQ6Ryxmb3JFYWNoOnEsaW5qZWN0b3I6ZGIsbm9vcDpDLGJpbmQ6YmIsdG9Kc29uOmNiLGZyb21Kc29uOndjLGlkZW50aXR5OllhLGlzVW5kZWZpbmVkOnksCmlzRGVmaW5lZDp2LGlzU3RyaW5nOkksaXNGdW5jdGlvbjpFLGlzT2JqZWN0OkosaXNOdW1iZXI6USxpc0VsZW1lbnQ6UmIsaXNBcnJheTpLLHZlcnNpb246bWUsaXNEYXRlOmhhLGxvd2VyY2FzZTpMLHVwcGVyY2FzZTp1YixjYWxsYmFja3M6e2NvdW50ZXI6MH0sZ2V0VGVzdGFiaWxpdHk6aGUsJCRtaW5FcnI6TywkJGNzcDpGYSxyZWxvYWRXaXRoRGVidWdJbmZvOmdlfSk7VmI9a2UoRik7VmIoIm5nIixbIm5nTG9jYWxlIl0sWyIkcHJvdmlkZSIsZnVuY3Rpb24oYSl7YS5wcm92aWRlcih7JCRzYW5pdGl6ZVVyaTpuZX0pO2EucHJvdmlkZXIoIiRjb21waWxlIixFYykuZGlyZWN0aXZlKHthOm9lLGlucHV0OkZjLHRleHRhcmVhOkZjLGZvcm06cGUsc2NyaXB0OnFlLHNlbGVjdDpyZSxzdHlsZTpzZSxvcHRpb246dGUsbmdCaW5kOnVlLG5nQmluZEh0bWw6dmUsbmdCaW5kVGVtcGxhdGU6d2UsbmdDbGFzczp4ZSxuZ0NsYXNzRXZlbjp5ZSxuZ0NsYXNzT2RkOnplLG5nQ2xvYWs6QWUsbmdDb250cm9sbGVyOkJlLApuZ0Zvcm06Q2UsbmdIaWRlOkRlLG5nSWY6RWUsbmdJbmNsdWRlOkZlLG5nSW5pdDpHZSxuZ05vbkJpbmRhYmxlOkhlLG5nUGx1cmFsaXplOkllLG5nUmVwZWF0OkplLG5nU2hvdzpLZSxuZ1N0eWxlOkxlLG5nU3dpdGNoOk1lLG5nU3dpdGNoV2hlbjpOZSxuZ1N3aXRjaERlZmF1bHQ6T2UsbmdPcHRpb25zOlBlLG5nVHJhbnNjbHVkZTpRZSxuZ01vZGVsOlJlLG5nTGlzdDpTZSxuZ0NoYW5nZTpUZSxwYXR0ZXJuOkdjLG5nUGF0dGVybjpHYyxyZXF1aXJlZDpIYyxuZ1JlcXVpcmVkOkhjLG1pbmxlbmd0aDpJYyxuZ01pbmxlbmd0aDpJYyxtYXhsZW5ndGg6SmMsbmdNYXhsZW5ndGg6SmMsbmdWYWx1ZTpVZSxuZ01vZGVsT3B0aW9uczpWZX0pLmRpcmVjdGl2ZSh7bmdJbmNsdWRlOldlfSkuZGlyZWN0aXZlKHZiKS5kaXJlY3RpdmUoS2MpO2EucHJvdmlkZXIoeyRhbmNob3JTY3JvbGw6WGUsJGFuaW1hdGU6WWUsJGFuaW1hdGVDc3M6WmUsJCRhbmltYXRlSnM6JGUsJCRhbmltYXRlUXVldWU6YWYsCiQkQW5pbWF0ZVJ1bm5lcjpiZiwkJGFuaW1hdGVBc3luY1J1bjpjZiwkYnJvd3NlcjpkZiwkY2FjaGVGYWN0b3J5OmVmLCRjb250cm9sbGVyOmZmLCRkb2N1bWVudDpnZiwkZXhjZXB0aW9uSGFuZGxlcjpoZiwkZmlsdGVyOkxjLCQkZm9yY2VSZWZsb3c6amYsJGludGVycG9sYXRlOmtmLCRpbnRlcnZhbDpsZiwkaHR0cDptZiwkaHR0cFBhcmFtU2VyaWFsaXplcjpuZiwkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZTpvZiwkaHR0cEJhY2tlbmQ6cGYsJHhockZhY3Rvcnk6cWYsJGxvY2F0aW9uOnJmLCRsb2c6c2YsJHBhcnNlOnRmLCRyb290U2NvcGU6dWYsJHE6dmYsJCRxOndmLCRzY2U6eGYsJHNjZURlbGVnYXRlOnlmLCRzbmlmZmVyOnpmLCR0ZW1wbGF0ZUNhY2hlOkFmLCR0ZW1wbGF0ZVJlcXVlc3Q6QmYsJCR0ZXN0YWJpbGl0eTpDZiwkdGltZW91dDpEZiwkd2luZG93OkVmLCQkckFGOkZmLCQkanFMaXRlOkdmLCQkSGFzaE1hcDpIZiwkJGNvb2tpZVJlYWRlcjpJZn0pfV0pfWZ1bmN0aW9uIGViKGEpe3JldHVybiBhLnJlcGxhY2UoSmYsCmZ1bmN0aW9uKGEsZCxjLGUpe3JldHVybiBlP2MudG9VcHBlckNhc2UoKTpjfSkucmVwbGFjZShLZiwiTW96JDEiKX1mdW5jdGlvbiBNYyhhKXthPWEubm9kZVR5cGU7cmV0dXJuIDE9PT1hfHwhYXx8OT09PWF9ZnVuY3Rpb24gTmMoYSxiKXt2YXIgZCxjLGU9Yi5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksZj1bXTtpZihXYi50ZXN0KGEpKXtkPWR8fGUuYXBwZW5kQ2hpbGQoYi5jcmVhdGVFbGVtZW50KCJkaXYiKSk7Yz0oTGYuZXhlYyhhKXx8WyIiLCIiXSlbMV0udG9Mb3dlckNhc2UoKTtjPWdhW2NdfHxnYS5fZGVmYXVsdDtkLmlubmVySFRNTD1jWzFdK2EucmVwbGFjZShNZiwiPCQxPjwvJDI+IikrY1syXTtmb3IoYz1jWzBdO2MtLTspZD1kLmxhc3RDaGlsZDtmPWFiKGYsZC5jaGlsZE5vZGVzKTtkPWUuZmlyc3RDaGlsZDtkLnRleHRDb250ZW50PSIifWVsc2UgZi5wdXNoKGIuY3JlYXRlVGV4dE5vZGUoYSkpO2UudGV4dENvbnRlbnQ9IiI7ZS5pbm5lckhUTUw9IiI7cShmLGZ1bmN0aW9uKGEpe2UuYXBwZW5kQ2hpbGQoYSl9KTsKcmV0dXJuIGV9ZnVuY3Rpb24gT2MoYSxiKXt2YXIgZD1hLnBhcmVudE5vZGU7ZCYmZC5yZXBsYWNlQ2hpbGQoYixhKTtiLmFwcGVuZENoaWxkKGEpfWZ1bmN0aW9uIFQoYSl7aWYoYSBpbnN0YW5jZW9mIFQpcmV0dXJuIGE7dmFyIGI7SShhKSYmKGE9VihhKSxiPSEwKTtpZighKHRoaXMgaW5zdGFuY2VvZiBUKSl7aWYoYiYmIjwiIT1hLmNoYXJBdCgwKSl0aHJvdyBYYigibm9zZWwiKTtyZXR1cm4gbmV3IFQoYSl9aWYoYil7Yj1GLmRvY3VtZW50O3ZhciBkO2E9KGQ9TmYuZXhlYyhhKSk/W2IuY3JlYXRlRWxlbWVudChkWzFdKV06KGQ9TmMoYSxiKSk/ZC5jaGlsZE5vZGVzOltdfVBjKHRoaXMsYSl9ZnVuY3Rpb24gWWIoYSl7cmV0dXJuIGEuY2xvbmVOb2RlKCEwKX1mdW5jdGlvbiB3YihhLGIpe2J8fGZiKGEpO2lmKGEucXVlcnlTZWxlY3RvckFsbClmb3IodmFyIGQ9YS5xdWVyeVNlbGVjdG9yQWxsKCIqIiksYz0wLGU9ZC5sZW5ndGg7YzxlO2MrKylmYihkW2NdKX1mdW5jdGlvbiBRYyhhLApiLGQsYyl7aWYodihjKSl0aHJvdyBYYigib2ZmYXJncyIpO3ZhciBlPShjPXhiKGEpKSYmYy5ldmVudHMsZj1jJiZjLmhhbmRsZTtpZihmKWlmKGIpe3ZhciBnPWZ1bmN0aW9uKGIpe3ZhciBjPWVbYl07dihkKSYmJGEoY3x8W10sZCk7dihkKSYmYyYmMDxjLmxlbmd0aHx8KGEucmVtb3ZlRXZlbnRMaXN0ZW5lcihiLGYsITEpLGRlbGV0ZSBlW2JdKX07cShiLnNwbGl0KCIgIiksZnVuY3Rpb24oYSl7ZyhhKTt5YlthXSYmZyh5YlthXSl9KX1lbHNlIGZvcihiIGluIGUpIiRkZXN0cm95IiE9PWImJmEucmVtb3ZlRXZlbnRMaXN0ZW5lcihiLGYsITEpLGRlbGV0ZSBlW2JdfWZ1bmN0aW9uIGZiKGEsYil7dmFyIGQ9YS5uZzMzOSxjPWQmJmdiW2RdO2MmJihiP2RlbGV0ZSBjLmRhdGFbYl06KGMuaGFuZGxlJiYoYy5ldmVudHMuJGRlc3Ryb3kmJmMuaGFuZGxlKHt9LCIkZGVzdHJveSIpLFFjKGEpKSxkZWxldGUgZ2JbZF0sYS5uZzMzOT12b2lkIDApKX1mdW5jdGlvbiB4YihhLGIpe3ZhciBkPQphLm5nMzM5LGQ9ZCYmZ2JbZF07YiYmIWQmJihhLm5nMzM5PWQ9KytPZixkPWdiW2RdPXtldmVudHM6e30sZGF0YTp7fSxoYW5kbGU6dm9pZCAwfSk7cmV0dXJuIGR9ZnVuY3Rpb24gWmIoYSxiLGQpe2lmKE1jKGEpKXt2YXIgYz12KGQpLGU9IWMmJmImJiFKKGIpLGY9IWI7YT0oYT14YihhLCFlKSkmJmEuZGF0YTtpZihjKWFbYl09ZDtlbHNle2lmKGYpcmV0dXJuIGE7aWYoZSlyZXR1cm4gYSYmYVtiXTtQKGEsYil9fX1mdW5jdGlvbiB6YihhLGIpe3JldHVybiBhLmdldEF0dHJpYnV0ZT8tMTwoIiAiKyhhLmdldEF0dHJpYnV0ZSgiY2xhc3MiKXx8IiIpKyIgIikucmVwbGFjZSgvW1xuXHRdL2csIiAiKS5pbmRleE9mKCIgIitiKyIgIik6ITF9ZnVuY3Rpb24gQWIoYSxiKXtiJiZhLnNldEF0dHJpYnV0ZSYmcShiLnNwbGl0KCIgIiksZnVuY3Rpb24oYil7YS5zZXRBdHRyaWJ1dGUoImNsYXNzIixWKCgiICIrKGEuZ2V0QXR0cmlidXRlKCJjbGFzcyIpfHwiIikrIiAiKS5yZXBsYWNlKC9bXG5cdF0vZywKIiAiKS5yZXBsYWNlKCIgIitWKGIpKyIgIiwiICIpKSl9KX1mdW5jdGlvbiBCYihhLGIpe2lmKGImJmEuc2V0QXR0cmlidXRlKXt2YXIgZD0oIiAiKyhhLmdldEF0dHJpYnV0ZSgiY2xhc3MiKXx8IiIpKyIgIikucmVwbGFjZSgvW1xuXHRdL2csIiAiKTtxKGIuc3BsaXQoIiAiKSxmdW5jdGlvbihhKXthPVYoYSk7LTE9PT1kLmluZGV4T2YoIiAiK2ErIiAiKSYmKGQrPWErIiAiKX0pO2Euc2V0QXR0cmlidXRlKCJjbGFzcyIsVihkKSl9fWZ1bmN0aW9uIFBjKGEsYil7aWYoYilpZihiLm5vZGVUeXBlKWFbYS5sZW5ndGgrK109YjtlbHNle3ZhciBkPWIubGVuZ3RoO2lmKCJudW1iZXIiPT09dHlwZW9mIGQmJmIud2luZG93IT09Yil7aWYoZClmb3IodmFyIGM9MDtjPGQ7YysrKWFbYS5sZW5ndGgrK109YltjXX1lbHNlIGFbYS5sZW5ndGgrK109Yn19ZnVuY3Rpb24gUmMoYSxiKXtyZXR1cm4gQ2IoYSwiJCIrKGJ8fCJuZ0NvbnRyb2xsZXIiKSsiQ29udHJvbGxlciIpfWZ1bmN0aW9uIENiKGEsCmIsZCl7OT09YS5ub2RlVHlwZSYmKGE9YS5kb2N1bWVudEVsZW1lbnQpO2ZvcihiPUsoYik/YjpbYl07YTspe2Zvcih2YXIgYz0wLGU9Yi5sZW5ndGg7YzxlO2MrKylpZih2KGQ9Ry5kYXRhKGEsYltjXSkpKXJldHVybiBkO2E9YS5wYXJlbnROb2RlfHwxMT09PWEubm9kZVR5cGUmJmEuaG9zdH19ZnVuY3Rpb24gU2MoYSl7Zm9yKHdiKGEsITApO2EuZmlyc3RDaGlsZDspYS5yZW1vdmVDaGlsZChhLmZpcnN0Q2hpbGQpfWZ1bmN0aW9uIERiKGEsYil7Ynx8d2IoYSk7dmFyIGQ9YS5wYXJlbnROb2RlO2QmJmQucmVtb3ZlQ2hpbGQoYSl9ZnVuY3Rpb24gUGYoYSxiKXtiPWJ8fEY7aWYoImNvbXBsZXRlIj09PWIuZG9jdW1lbnQucmVhZHlTdGF0ZSliLnNldFRpbWVvdXQoYSk7ZWxzZSBHKGIpLm9uKCJsb2FkIixhKX1mdW5jdGlvbiBUYyhhLGIpe3ZhciBkPUViW2IudG9Mb3dlckNhc2UoKV07cmV0dXJuIGQmJlVjW3RhKGEpXSYmZH1mdW5jdGlvbiBRZihhLGIpe3ZhciBkPWZ1bmN0aW9uKGMsCmQpe2MuaXNEZWZhdWx0UHJldmVudGVkPWZ1bmN0aW9uKCl7cmV0dXJuIGMuZGVmYXVsdFByZXZlbnRlZH07dmFyIGY9YltkfHxjLnR5cGVdLGc9Zj9mLmxlbmd0aDowO2lmKGcpe2lmKHkoYy5pbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQpKXt2YXIgaD1jLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjtjLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbj1mdW5jdGlvbigpe2MuaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkPSEwO2Muc3RvcFByb3BhZ2F0aW9uJiZjLnN0b3BQcm9wYWdhdGlvbigpO2gmJmguY2FsbChjKX19Yy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZD1mdW5jdGlvbigpe3JldHVybiEwPT09Yy5pbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWR9O3ZhciBrPWYuc3BlY2lhbEhhbmRsZXJXcmFwcGVyfHxSZjsxPGcmJihmPWZhKGYpKTtmb3IodmFyIGw9MDtsPGc7bCsrKWMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKXx8ayhhLGMsZltsXSl9fTtkLmVsZW09CmE7cmV0dXJuIGR9ZnVuY3Rpb24gUmYoYSxiLGQpe2QuY2FsbChhLGIpfWZ1bmN0aW9uIFNmKGEsYixkKXt2YXIgYz1iLnJlbGF0ZWRUYXJnZXQ7YyYmKGM9PT1hfHxUZi5jYWxsKGEsYykpfHxkLmNhbGwoYSxiKX1mdW5jdGlvbiBHZigpe3RoaXMuJGdldD1mdW5jdGlvbigpe3JldHVybiBQKFQse2hhc0NsYXNzOmZ1bmN0aW9uKGEsYil7YS5hdHRyJiYoYT1hWzBdKTtyZXR1cm4gemIoYSxiKX0sYWRkQ2xhc3M6ZnVuY3Rpb24oYSxiKXthLmF0dHImJihhPWFbMF0pO3JldHVybiBCYihhLGIpfSxyZW1vdmVDbGFzczpmdW5jdGlvbihhLGIpe2EuYXR0ciYmKGE9YVswXSk7cmV0dXJuIEFiKGEsYil9fSl9fWZ1bmN0aW9uIEdhKGEsYil7dmFyIGQ9YSYmYS4kJGhhc2hLZXk7aWYoZClyZXR1cm4iZnVuY3Rpb24iPT09dHlwZW9mIGQmJihkPWEuJCRoYXNoS2V5KCkpLGQ7ZD10eXBlb2YgYTtyZXR1cm4gZD0iZnVuY3Rpb24iPT1kfHwib2JqZWN0Ij09ZCYmbnVsbCE9PWE/YS4kJGhhc2hLZXk9CmQrIjoiKyhifHxZZCkoKTpkKyI6IithfWZ1bmN0aW9uIFNhKGEsYil7aWYoYil7dmFyIGQ9MDt0aGlzLm5leHRVaWQ9ZnVuY3Rpb24oKXtyZXR1cm4rK2R9fXEoYSx0aGlzLnB1dCx0aGlzKX1mdW5jdGlvbiBWYyhhKXthPShGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhKSsiICIpLnJlcGxhY2UoVWYsIiIpO3JldHVybiBhLm1hdGNoKFZmKXx8YS5tYXRjaChXZil9ZnVuY3Rpb24gWGYoYSl7cmV0dXJuKGE9VmMoYSkpPyJmdW5jdGlvbigiKyhhWzFdfHwiIikucmVwbGFjZSgvW1xzXHJcbl0rLywiICIpKyIpIjoiZm4ifWZ1bmN0aW9uIGRiKGEsYil7ZnVuY3Rpb24gZChhKXtyZXR1cm4gZnVuY3Rpb24oYixjKXtpZihKKGIpKXEoYix0YyhhKSk7ZWxzZSByZXR1cm4gYShiLGMpfX1mdW5jdGlvbiBjKGEsYil7UmEoYSwic2VydmljZSIpO2lmKEUoYil8fEsoYikpYj1wLmluc3RhbnRpYXRlKGIpO2lmKCFiLiRnZXQpdGhyb3cgSGEoInBnZXQiLGEpO3JldHVybiBuW2ErIlByb3ZpZGVyIl09CmJ9ZnVuY3Rpb24gZShhLGIpe3JldHVybiBmdW5jdGlvbigpe3ZhciBjPXouaW52b2tlKGIsdGhpcyk7aWYoeShjKSl0aHJvdyBIYSgidW5kZWYiLGEpO3JldHVybiBjfX1mdW5jdGlvbiBmKGEsYixkKXtyZXR1cm4gYyhhLHskZ2V0OiExIT09ZD9lKGEsYik6Yn0pfWZ1bmN0aW9uIGcoYSl7c2IoeShhKXx8SyhhKSwibW9kdWxlc1RvTG9hZCIsIm5vdCBhbiBhcnJheSIpO3ZhciBiPVtdLGM7cShhLGZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGQoYSl7dmFyIGIsYztiPTA7Zm9yKGM9YS5sZW5ndGg7YjxjO2IrKyl7dmFyIGU9YVtiXSxmPXAuZ2V0KGVbMF0pO2ZbZVsxXV0uYXBwbHkoZixlWzJdKX19aWYoIW0uZ2V0KGEpKXttLnB1dChhLCEwKTt0cnl7SShhKT8oYz1WYihhKSxiPWIuY29uY2F0KGcoYy5yZXF1aXJlcykpLmNvbmNhdChjLl9ydW5CbG9ja3MpLGQoYy5faW52b2tlUXVldWUpLGQoYy5fY29uZmlnQmxvY2tzKSk6RShhKT9iLnB1c2gocC5pbnZva2UoYSkpOksoYSk/Yi5wdXNoKHAuaW52b2tlKGEpKToKUWEoYSwibW9kdWxlIil9Y2F0Y2goZSl7dGhyb3cgSyhhKSYmKGE9YVthLmxlbmd0aC0xXSksZS5tZXNzYWdlJiZlLnN0YWNrJiYtMT09ZS5zdGFjay5pbmRleE9mKGUubWVzc2FnZSkmJihlPWUubWVzc2FnZSsiXG4iK2Uuc3RhY2spLEhhKCJtb2R1bGVyciIsYSxlLnN0YWNrfHxlLm1lc3NhZ2V8fGUpO319fSk7cmV0dXJuIGJ9ZnVuY3Rpb24gaChhLGMpe2Z1bmN0aW9uIGQoYixlKXtpZihhLmhhc093blByb3BlcnR5KGIpKXtpZihhW2JdPT09ayl0aHJvdyBIYSgiY2RlcCIsYisiIDwtICIrbC5qb2luKCIgPC0gIikpO3JldHVybiBhW2JdfXRyeXtyZXR1cm4gbC51bnNoaWZ0KGIpLGFbYl09ayxhW2JdPWMoYixlKX1jYXRjaChmKXt0aHJvdyBhW2JdPT09ayYmZGVsZXRlIGFbYl0sZjt9ZmluYWxseXtsLnNoaWZ0KCl9fWZ1bmN0aW9uIGUoYSxjLGYpe3ZhciBnPVtdO2E9ZGIuJCRhbm5vdGF0ZShhLGIsZik7Zm9yKHZhciBoPTAsaz1hLmxlbmd0aDtoPGs7aCsrKXt2YXIgbD1hW2hdOwppZigic3RyaW5nIiE9PXR5cGVvZiBsKXRocm93IEhhKCJpdGtuIixsKTtnLnB1c2goYyYmYy5oYXNPd25Qcm9wZXJ0eShsKT9jW2xdOmQobCxmKSl9cmV0dXJuIGd9cmV0dXJue2ludm9rZTpmdW5jdGlvbihhLGIsYyxkKXsic3RyaW5nIj09PXR5cGVvZiBjJiYoZD1jLGM9bnVsbCk7Yz1lKGEsYyxkKTtLKGEpJiYoYT1hW2EubGVuZ3RoLTFdKTtkPTExPj1CYT8hMToiZnVuY3Rpb24iPT09dHlwZW9mIGEmJi9eKD86Y2xhc3Ncc3xjb25zdHJ1Y3RvclwoKS8udGVzdChGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhKSsiICIpO3JldHVybiBkPyhjLnVuc2hpZnQobnVsbCksbmV3IChGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5hcHBseShhLGMpKSk6YS5hcHBseShiLGMpfSxpbnN0YW50aWF0ZTpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9SyhhKT9hW2EubGVuZ3RoLTFdOmE7YT1lKGEsYixjKTthLnVuc2hpZnQobnVsbCk7cmV0dXJuIG5ldyAoRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuYXBwbHkoZCwKYSkpfSxnZXQ6ZCxhbm5vdGF0ZTpkYi4kJGFubm90YXRlLGhhczpmdW5jdGlvbihiKXtyZXR1cm4gbi5oYXNPd25Qcm9wZXJ0eShiKyJQcm92aWRlciIpfHxhLmhhc093blByb3BlcnR5KGIpfX19Yj0hMD09PWI7dmFyIGs9e30sbD1bXSxtPW5ldyBTYShbXSwhMCksbj17JHByb3ZpZGU6e3Byb3ZpZGVyOmQoYyksZmFjdG9yeTpkKGYpLHNlcnZpY2U6ZChmdW5jdGlvbihhLGIpe3JldHVybiBmKGEsWyIkaW5qZWN0b3IiLGZ1bmN0aW9uKGEpe3JldHVybiBhLmluc3RhbnRpYXRlKGIpfV0pfSksdmFsdWU6ZChmdW5jdGlvbihhLGIpe3JldHVybiBmKGEsY2EoYiksITEpfSksY29uc3RhbnQ6ZChmdW5jdGlvbihhLGIpe1JhKGEsImNvbnN0YW50Iik7blthXT1iO3hbYV09Yn0pLGRlY29yYXRvcjpmdW5jdGlvbihhLGIpe3ZhciBjPXAuZ2V0KGErIlByb3ZpZGVyIiksZD1jLiRnZXQ7Yy4kZ2V0PWZ1bmN0aW9uKCl7dmFyIGE9ei5pbnZva2UoZCxjKTtyZXR1cm4gei5pbnZva2UoYixudWxsLAp7JGRlbGVnYXRlOmF9KX19fX0scD1uLiRpbmplY3Rvcj1oKG4sZnVuY3Rpb24oYSxiKXtkYS5pc1N0cmluZyhiKSYmbC5wdXNoKGIpO3Rocm93IEhhKCJ1bnByIixsLmpvaW4oIiA8LSAiKSk7fSkseD17fSxVPWgoeCxmdW5jdGlvbihhLGIpe3ZhciBjPXAuZ2V0KGErIlByb3ZpZGVyIixiKTtyZXR1cm4gei5pbnZva2UoYy4kZ2V0LGMsdm9pZCAwLGEpfSksej1VO24uJGluamVjdG9yUHJvdmlkZXI9eyRnZXQ6Y2EoVSl9O3ZhciByPWcoYSksej1VLmdldCgiJGluamVjdG9yIik7ei5zdHJpY3REaT1iO3EocixmdW5jdGlvbihhKXthJiZ6Lmludm9rZShhKX0pO3JldHVybiB6fWZ1bmN0aW9uIFhlKCl7dmFyIGE9ITA7dGhpcy5kaXNhYmxlQXV0b1Njcm9sbGluZz1mdW5jdGlvbigpe2E9ITF9O3RoaXMuJGdldD1bIiR3aW5kb3ciLCIkbG9jYXRpb24iLCIkcm9vdFNjb3BlIixmdW5jdGlvbihiLGQsYyl7ZnVuY3Rpb24gZShhKXt2YXIgYj1udWxsO0FycmF5LnByb3RvdHlwZS5zb21lLmNhbGwoYSwKZnVuY3Rpb24oYSl7aWYoImEiPT09dGEoYSkpcmV0dXJuIGI9YSwhMH0pO3JldHVybiBifWZ1bmN0aW9uIGYoYSl7aWYoYSl7YS5zY3JvbGxJbnRvVmlldygpO3ZhciBjO2M9Zy55T2Zmc2V0O0UoYyk/Yz1jKCk6UmIoYyk/KGM9Y1swXSxjPSJmaXhlZCIhPT1iLmdldENvbXB1dGVkU3R5bGUoYykucG9zaXRpb24/MDpjLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmJvdHRvbSk6UShjKXx8KGM9MCk7YyYmKGE9YS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AsYi5zY3JvbGxCeSgwLGEtYykpfWVsc2UgYi5zY3JvbGxUbygwLDApfWZ1bmN0aW9uIGcoYSl7YT1JKGEpP2E6ZC5oYXNoKCk7dmFyIGI7YT8oYj1oLmdldEVsZW1lbnRCeUlkKGEpKT9mKGIpOihiPWUoaC5nZXRFbGVtZW50c0J5TmFtZShhKSkpP2YoYik6InRvcCI9PT1hJiZmKG51bGwpOmYobnVsbCl9dmFyIGg9Yi5kb2N1bWVudDthJiZjLiR3YXRjaChmdW5jdGlvbigpe3JldHVybiBkLmhhc2goKX0sZnVuY3Rpb24oYSxiKXthPT09CmImJiIiPT09YXx8UGYoZnVuY3Rpb24oKXtjLiRldmFsQXN5bmMoZyl9KX0pO3JldHVybiBnfV19ZnVuY3Rpb24gaGIoYSxiKXtpZighYSYmIWIpcmV0dXJuIiI7aWYoIWEpcmV0dXJuIGI7aWYoIWIpcmV0dXJuIGE7SyhhKSYmKGE9YS5qb2luKCIgIikpO0soYikmJihiPWIuam9pbigiICIpKTtyZXR1cm4gYSsiICIrYn1mdW5jdGlvbiBZZihhKXtJKGEpJiYoYT1hLnNwbGl0KCIgIikpO3ZhciBiPVMoKTtxKGEsZnVuY3Rpb24oYSl7YS5sZW5ndGgmJihiW2FdPSEwKX0pO3JldHVybiBifWZ1bmN0aW9uIElhKGEpe3JldHVybiBKKGEpP2E6e319ZnVuY3Rpb24gWmYoYSxiLGQsYyl7ZnVuY3Rpb24gZShhKXt0cnl7YS5hcHBseShudWxsLHlhLmNhbGwoYXJndW1lbnRzLDEpKX1maW5hbGx5e2lmKFUtLSwwPT09VSlmb3IoO3oubGVuZ3RoOyl0cnl7ei5wb3AoKSgpfWNhdGNoKGIpe2QuZXJyb3IoYil9fX1mdW5jdGlvbiBmKCl7dz1udWxsO2coKTtoKCl9ZnVuY3Rpb24gZygpe3I9a2EoKTsKcj15KHIpP251bGw6cjtuYShyLEgpJiYocj1IKTtIPXJ9ZnVuY3Rpb24gaCgpe2lmKHUhPT1rLnVybCgpfHxEIT09cil1PWsudXJsKCksRD1yLHEoQixmdW5jdGlvbihhKXthKGsudXJsKCkscil9KX12YXIgaz10aGlzLGw9YS5sb2NhdGlvbixtPWEuaGlzdG9yeSxuPWEuc2V0VGltZW91dCxwPWEuY2xlYXJUaW1lb3V0LHg9e307ay5pc01vY2s9ITE7dmFyIFU9MCx6PVtdO2suJCRjb21wbGV0ZU91dHN0YW5kaW5nUmVxdWVzdD1lO2suJCRpbmNPdXRzdGFuZGluZ1JlcXVlc3RDb3VudD1mdW5jdGlvbigpe1UrK307ay5ub3RpZnlXaGVuTm9PdXRzdGFuZGluZ1JlcXVlc3RzPWZ1bmN0aW9uKGEpezA9PT1VP2EoKTp6LnB1c2goYSl9O3ZhciByLEQsdT1sLmhyZWYsdD1iLmZpbmQoImJhc2UiKSx3PW51bGwsa2E9Yy5oaXN0b3J5P2Z1bmN0aW9uKCl7dHJ5e3JldHVybiBtLnN0YXRlfWNhdGNoKGEpe319OkM7ZygpO0Q9cjtrLnVybD1mdW5jdGlvbihiLGQsZSl7eShlKSYmKGU9bnVsbCk7CmwhPT1hLmxvY2F0aW9uJiYobD1hLmxvY2F0aW9uKTttIT09YS5oaXN0b3J5JiYobT1hLmhpc3RvcnkpO2lmKGIpe3ZhciBmPUQ9PT1lO2lmKHU9PT1iJiYoIWMuaGlzdG9yeXx8ZikpcmV0dXJuIGs7dmFyIGg9dSYmSmEodSk9PT1KYShiKTt1PWI7RD1lOyFjLmhpc3Rvcnl8fGgmJmY/KGh8fCh3PWIpLGQ/bC5yZXBsYWNlKGIpOmg/KGQ9bCxlPWIuaW5kZXhPZigiIyIpLGU9LTE9PT1lPyIiOmIuc3Vic3RyKGUpLGQuaGFzaD1lKTpsLmhyZWY9YixsLmhyZWYhPT1iJiYodz1iKSk6KG1bZD8icmVwbGFjZVN0YXRlIjoicHVzaFN0YXRlIl0oZSwiIixiKSxnKCksRD1yKTt3JiYodz1iKTtyZXR1cm4ga31yZXR1cm4gd3x8bC5ocmVmLnJlcGxhY2UoLyUyNy9nLCInIil9O2suc3RhdGU9ZnVuY3Rpb24oKXtyZXR1cm4gcn07dmFyIEI9W10sQT0hMSxIPW51bGw7ay5vblVybENoYW5nZT1mdW5jdGlvbihiKXtpZighQSl7aWYoYy5oaXN0b3J5KUcoYSkub24oInBvcHN0YXRlIixmKTtHKGEpLm9uKCJoYXNoY2hhbmdlIiwKZik7QT0hMH1CLnB1c2goYik7cmV0dXJuIGJ9O2suJCRhcHBsaWNhdGlvbkRlc3Ryb3llZD1mdW5jdGlvbigpe0coYSkub2ZmKCJoYXNoY2hhbmdlIHBvcHN0YXRlIixmKX07ay4kJGNoZWNrVXJsQ2hhbmdlPWg7ay5iYXNlSHJlZj1mdW5jdGlvbigpe3ZhciBhPXQuYXR0cigiaHJlZiIpO3JldHVybiBhP2EucmVwbGFjZSgvXihodHRwcz9cOik/XC9cL1teXC9dKi8sIiIpOiIifTtrLmRlZmVyPWZ1bmN0aW9uKGEsYil7dmFyIGM7VSsrO2M9bihmdW5jdGlvbigpe2RlbGV0ZSB4W2NdO2UoYSl9LGJ8fDApO3hbY109ITA7cmV0dXJuIGN9O2suZGVmZXIuY2FuY2VsPWZ1bmN0aW9uKGEpe3JldHVybiB4W2FdPyhkZWxldGUgeFthXSxwKGEpLGUoQyksITApOiExfX1mdW5jdGlvbiBkZigpe3RoaXMuJGdldD1bIiR3aW5kb3ciLCIkbG9nIiwiJHNuaWZmZXIiLCIkZG9jdW1lbnQiLGZ1bmN0aW9uKGEsYixkLGMpe3JldHVybiBuZXcgWmYoYSxjLGIsZCl9XX1mdW5jdGlvbiBlZigpe3RoaXMuJGdldD0KZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGEsYyl7ZnVuY3Rpb24gZShhKXthIT1uJiYocD9wPT1hJiYocD1hLm4pOnA9YSxmKGEubixhLnApLGYoYSxuKSxuPWEsbi5uPW51bGwpfWZ1bmN0aW9uIGYoYSxiKXthIT1iJiYoYSYmKGEucD1iKSxiJiYoYi5uPWEpKX1pZihhIGluIGIpdGhyb3cgTygiJGNhY2hlRmFjdG9yeSIpKCJpaWQiLGEpO3ZhciBnPTAsaD1QKHt9LGMse2lkOmF9KSxrPVMoKSxsPWMmJmMuY2FwYWNpdHl8fE51bWJlci5NQVhfVkFMVUUsbT1TKCksbj1udWxsLHA9bnVsbDtyZXR1cm4gYlthXT17cHV0OmZ1bmN0aW9uKGEsYil7aWYoIXkoYikpe2lmKGw8TnVtYmVyLk1BWF9WQUxVRSl7dmFyIGM9bVthXXx8KG1bYV09e2tleTphfSk7ZShjKX1hIGluIGt8fGcrKztrW2FdPWI7Zz5sJiZ0aGlzLnJlbW92ZShwLmtleSk7cmV0dXJuIGJ9fSxnZXQ6ZnVuY3Rpb24oYSl7aWYobDxOdW1iZXIuTUFYX1ZBTFVFKXt2YXIgYj1tW2FdO2lmKCFiKXJldHVybjtlKGIpfXJldHVybiBrW2FdfSwKcmVtb3ZlOmZ1bmN0aW9uKGEpe2lmKGw8TnVtYmVyLk1BWF9WQUxVRSl7dmFyIGI9bVthXTtpZighYilyZXR1cm47Yj09biYmKG49Yi5wKTtiPT1wJiYocD1iLm4pO2YoYi5uLGIucCk7ZGVsZXRlIG1bYV19YSBpbiBrJiYoZGVsZXRlIGtbYV0sZy0tKX0scmVtb3ZlQWxsOmZ1bmN0aW9uKCl7az1TKCk7Zz0wO209UygpO249cD1udWxsfSxkZXN0cm95OmZ1bmN0aW9uKCl7bT1oPWs9bnVsbDtkZWxldGUgYlthXX0saW5mbzpmdW5jdGlvbigpe3JldHVybiBQKHt9LGgse3NpemU6Z30pfX19dmFyIGI9e307YS5pbmZvPWZ1bmN0aW9uKCl7dmFyIGE9e307cShiLGZ1bmN0aW9uKGIsZSl7YVtlXT1iLmluZm8oKX0pO3JldHVybiBhfTthLmdldD1mdW5jdGlvbihhKXtyZXR1cm4gYlthXX07cmV0dXJuIGF9fWZ1bmN0aW9uIEFmKCl7dGhpcy4kZ2V0PVsiJGNhY2hlRmFjdG9yeSIsZnVuY3Rpb24oYSl7cmV0dXJuIGEoInRlbXBsYXRlcyIpfV19ZnVuY3Rpb24gRWMoYSxiKXtmdW5jdGlvbiBkKGEsCmIsYyl7dmFyIGQ9L15ccyooW0AmPF18PShcKj8pKShcPz8pXHMqKFx3KilccyokLyxlPVMoKTtxKGEsZnVuY3Rpb24oYSxmKXtpZihhIGluIG4pZVtmXT1uW2FdO2Vsc2V7dmFyIGc9YS5tYXRjaChkKTtpZighZyl0aHJvdyBlYSgiaXNjcCIsYixmLGEsYz8iY29udHJvbGxlciBiaW5kaW5ncyBkZWZpbml0aW9uIjoiaXNvbGF0ZSBzY29wZSBkZWZpbml0aW9uIik7ZVtmXT17bW9kZTpnWzFdWzBdLGNvbGxlY3Rpb246IioiPT09Z1syXSxvcHRpb25hbDoiPyI9PT1nWzNdLGF0dHJOYW1lOmdbNF18fGZ9O2dbNF0mJihuW2FdPWVbZl0pfX0pO3JldHVybiBlfWZ1bmN0aW9uIGMoYSl7dmFyIGI9YS5jaGFyQXQoMCk7aWYoIWJ8fGIhPT1MKGIpKXRocm93IGVhKCJiYWRkaXIiLGEpO2lmKGEhPT1hLnRyaW0oKSl0aHJvdyBlYSgiYmFkZGlyIixhKTt9ZnVuY3Rpb24gZShhKXt2YXIgYj1hLnJlcXVpcmV8fGEuY29udHJvbGxlciYmYS5uYW1lOyFLKGIpJiZKKGIpJiZxKGIsZnVuY3Rpb24oYSwKYyl7dmFyIGQ9YS5tYXRjaChsKTthLnN1YnN0cmluZyhkWzBdLmxlbmd0aCl8fChiW2NdPWRbMF0rYyl9KTtyZXR1cm4gYn12YXIgZj17fSxnPS9eXHMqZGlyZWN0aXZlXDpccyooW1x3XC1dKylccysoLiopJC8saD0vKChbXHdcLV0rKSg/Olw6KFteO10rKSk/Oz8pLyxrPWJlKCJuZ1NyYyxuZ1NyY3NldCxzcmMsc3Jjc2V0IiksbD0vXig/OihcXlxePyk/KFw/KT8oXF5cXj8pPyk/LyxtPS9eKG9uW2Etel0rfGZvcm1hY3Rpb24pJC8sbj1TKCk7dGhpcy5kaXJlY3RpdmU9ZnVuY3Rpb24geihiLGQpe1JhKGIsImRpcmVjdGl2ZSIpO0koYik/KGMoYiksc2IoZCwiZGlyZWN0aXZlRmFjdG9yeSIpLGYuaGFzT3duUHJvcGVydHkoYil8fChmW2JdPVtdLGEuZmFjdG9yeShiKyJEaXJlY3RpdmUiLFsiJGluamVjdG9yIiwiJGV4Y2VwdGlvbkhhbmRsZXIiLGZ1bmN0aW9uKGEsYyl7dmFyIGQ9W107cShmW2JdLGZ1bmN0aW9uKGYsZyl7dHJ5e3ZhciBoPWEuaW52b2tlKGYpO0UoaCk/aD17Y29tcGlsZTpjYShoKX06CiFoLmNvbXBpbGUmJmgubGluayYmKGguY29tcGlsZT1jYShoLmxpbmspKTtoLnByaW9yaXR5PWgucHJpb3JpdHl8fDA7aC5pbmRleD1nO2gubmFtZT1oLm5hbWV8fGI7aC5yZXF1aXJlPWUoaCk7aC5yZXN0cmljdD1oLnJlc3RyaWN0fHwiRUEiO2guJCRtb2R1bGVOYW1lPWYuJCRtb2R1bGVOYW1lO2QucHVzaChoKX1jYXRjaChrKXtjKGspfX0pO3JldHVybiBkfV0pKSxmW2JdLnB1c2goZCkpOnEoYix0Yyh6KSk7cmV0dXJuIHRoaXN9O3RoaXMuY29tcG9uZW50PWZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gYyhhKXtmdW5jdGlvbiBlKGIpe3JldHVybiBFKGIpfHxLKGIpP2Z1bmN0aW9uKGMsZCl7cmV0dXJuIGEuaW52b2tlKGIsdGhpcyx7JGVsZW1lbnQ6YywkYXR0cnM6ZH0pfTpifXZhciBmPWIudGVtcGxhdGV8fGIudGVtcGxhdGVVcmw/Yi50ZW1wbGF0ZToiIixnPXtjb250cm9sbGVyOmQsY29udHJvbGxlckFzOldjKGIuY29udHJvbGxlcil8fGIuY29udHJvbGxlckFzfHwiJGN0cmwiLAp0ZW1wbGF0ZTplKGYpLHRlbXBsYXRlVXJsOmUoYi50ZW1wbGF0ZVVybCksdHJhbnNjbHVkZTpiLnRyYW5zY2x1ZGUsc2NvcGU6e30sYmluZFRvQ29udHJvbGxlcjpiLmJpbmRpbmdzfHx7fSxyZXN0cmljdDoiRSIscmVxdWlyZTpiLnJlcXVpcmV9O3EoYixmdW5jdGlvbihhLGIpeyIkIj09PWIuY2hhckF0KDApJiYoZ1tiXT1hKX0pO3JldHVybiBnfXZhciBkPWIuY29udHJvbGxlcnx8ZnVuY3Rpb24oKXt9O3EoYixmdW5jdGlvbihhLGIpeyIkIj09PWIuY2hhckF0KDApJiYoY1tiXT1hLEUoZCkmJihkW2JdPWEpKX0pO2MuJGluamVjdD1bIiRpbmplY3RvciJdO3JldHVybiB0aGlzLmRpcmVjdGl2ZShhLGMpfTt0aGlzLmFIcmVmU2FuaXRpemF0aW9uV2hpdGVsaXN0PWZ1bmN0aW9uKGEpe3JldHVybiB2KGEpPyhiLmFIcmVmU2FuaXRpemF0aW9uV2hpdGVsaXN0KGEpLHRoaXMpOmIuYUhyZWZTYW5pdGl6YXRpb25XaGl0ZWxpc3QoKX07dGhpcy5pbWdTcmNTYW5pdGl6YXRpb25XaGl0ZWxpc3Q9CmZ1bmN0aW9uKGEpe3JldHVybiB2KGEpPyhiLmltZ1NyY1Nhbml0aXphdGlvbldoaXRlbGlzdChhKSx0aGlzKTpiLmltZ1NyY1Nhbml0aXphdGlvbldoaXRlbGlzdCgpfTt2YXIgcD0hMDt0aGlzLmRlYnVnSW5mb0VuYWJsZWQ9ZnVuY3Rpb24oYSl7cmV0dXJuIHYoYSk/KHA9YSx0aGlzKTpwfTt2YXIgeD0xMDt0aGlzLm9uQ2hhbmdlc1R0bD1mdW5jdGlvbihhKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oeD1hLHRoaXMpOnh9O3RoaXMuJGdldD1bIiRpbmplY3RvciIsIiRpbnRlcnBvbGF0ZSIsIiRleGNlcHRpb25IYW5kbGVyIiwiJHRlbXBsYXRlUmVxdWVzdCIsIiRwYXJzZSIsIiRjb250cm9sbGVyIiwiJHJvb3RTY29wZSIsIiRzY2UiLCIkYW5pbWF0ZSIsIiQkc2FuaXRpemVVcmkiLGZ1bmN0aW9uKGEsYixjLGUsbix3LGthLEIsQSxIKXtmdW5jdGlvbiBNKCl7dHJ5e2lmKCEtLW9hKXRocm93IFk9dm9pZCAwLGVhKCJpbmZjaG5nIix4KTtrYS4kYXBwbHkoZnVuY3Rpb24oKXtmb3IodmFyIGE9CjAsYj1ZLmxlbmd0aDthPGI7KythKVlbYV0oKTtZPXZvaWQgMH0pfWZpbmFsbHl7b2ErK319ZnVuY3Rpb24gQWEoYSxiKXtpZihiKXt2YXIgYz1PYmplY3Qua2V5cyhiKSxkLGUsZjtkPTA7Zm9yKGU9Yy5sZW5ndGg7ZDxlO2QrKylmPWNbZF0sdGhpc1tmXT1iW2ZdfWVsc2UgdGhpcy4kYXR0cj17fTt0aGlzLiQkZWxlbWVudD1hfWZ1bmN0aW9uIFIoYSxiLGMpe2xhLmlubmVySFRNTD0iPHNwYW4gIitiKyI+IjtiPWxhLmZpcnN0Q2hpbGQuYXR0cmlidXRlczt2YXIgZD1iWzBdO2IucmVtb3ZlTmFtZWRJdGVtKGQubmFtZSk7ZC52YWx1ZT1jO2EuYXR0cmlidXRlcy5zZXROYW1lZEl0ZW0oZCl9ZnVuY3Rpb24gTihhLGIpe3RyeXthLmFkZENsYXNzKGIpfWNhdGNoKGMpe319ZnVuY3Rpb24gYWEoYSxiLGMsZCxlKXthIGluc3RhbmNlb2YgR3x8KGE9RyhhKSk7Zm9yKHZhciBmPS9cUysvLGc9MCxoPWEubGVuZ3RoO2c8aDtnKyspe3ZhciBrPWFbZ107ay5ub2RlVHlwZT09PU5hJiZrLm5vZGVWYWx1ZS5tYXRjaChmKSYmCk9jKGssYVtnXT1GLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKSl9dmFyIGw9cyhhLGIsYSxjLGQsZSk7YWEuJCRhZGRTY29wZUNsYXNzKGEpO3ZhciBtPW51bGw7cmV0dXJuIGZ1bmN0aW9uKGIsYyxkKXtzYihiLCJzY29wZSIpO2UmJmUubmVlZHNOZXdTY29wZSYmKGI9Yi4kcGFyZW50LiRuZXcoKSk7ZD1kfHx7fTt2YXIgZj1kLnBhcmVudEJvdW5kVHJhbnNjbHVkZUZuLGc9ZC50cmFuc2NsdWRlQ29udHJvbGxlcnM7ZD1kLmZ1dHVyZVBhcmVudEVsZW1lbnQ7ZiYmZi4kJGJvdW5kVHJhbnNjbHVkZSYmKGY9Zi4kJGJvdW5kVHJhbnNjbHVkZSk7bXx8KG09KGQ9ZCYmZFswXSk/ImZvcmVpZ25vYmplY3QiIT09dGEoZCkmJmphLmNhbGwoZCkubWF0Y2goL1NWRy8pPyJzdmciOiJodG1sIjoiaHRtbCIpO2Q9Imh0bWwiIT09bT9HKGJhKG0sRygiPGRpdj4iKS5hcHBlbmQoYSkuaHRtbCgpKSk6Yz9QYS5jbG9uZS5jYWxsKGEpOmE7aWYoZylmb3IodmFyIGggaW4gZylkLmRhdGEoIiQiKwpoKyJDb250cm9sbGVyIixnW2hdLmluc3RhbmNlKTthYS4kJGFkZFNjb3BlSW5mbyhkLGIpO2MmJmMoZCxiKTtsJiZsKGIsZCxkLGYpO3JldHVybiBkfX1mdW5jdGlvbiBzKGEsYixjLGQsZSxmKXtmdW5jdGlvbiBnKGEsYyxkLGUpe3ZhciBmLGssbCxtLG4sdSxyO2lmKHApZm9yKHI9QXJyYXkoYy5sZW5ndGgpLG09MDttPGgubGVuZ3RoO20rPTMpZj1oW21dLHJbZl09Y1tmXTtlbHNlIHI9YzttPTA7Zm9yKG49aC5sZW5ndGg7bTxuOylrPXJbaFttKytdXSxjPWhbbSsrXSxmPWhbbSsrXSxjPyhjLnNjb3BlPyhsPWEuJG5ldygpLGFhLiQkYWRkU2NvcGVJbmZvKEcoayksbCkpOmw9YSx1PWMudHJhbnNjbHVkZU9uVGhpc0VsZW1lbnQ/dmEoYSxjLnRyYW5zY2x1ZGUsZSk6IWMudGVtcGxhdGVPblRoaXNFbGVtZW50JiZlP2U6IWUmJmI/dmEoYSxiKTpudWxsLGMoZixsLGssZCx1KSk6ZiYmZihhLGsuY2hpbGROb2Rlcyx2b2lkIDAsZSl9Zm9yKHZhciBoPVtdLGssbCxtLG4scCx1PTA7dTwKYS5sZW5ndGg7dSsrKXtrPW5ldyBBYTtsPSRiKGFbdV0sW10saywwPT09dT9kOnZvaWQgMCxlKTsoZj1sLmxlbmd0aD9UYShsLGFbdV0sayxiLGMsbnVsbCxbXSxbXSxmKTpudWxsKSYmZi5zY29wZSYmYWEuJCRhZGRTY29wZUNsYXNzKGsuJCRlbGVtZW50KTtrPWYmJmYudGVybWluYWx8fCEobT1hW3VdLmNoaWxkTm9kZXMpfHwhbS5sZW5ndGg/bnVsbDpzKG0sZj8oZi50cmFuc2NsdWRlT25UaGlzRWxlbWVudHx8IWYudGVtcGxhdGVPblRoaXNFbGVtZW50KSYmZi50cmFuc2NsdWRlOmIpO2lmKGZ8fGspaC5wdXNoKHUsZixrKSxuPSEwLHA9cHx8ZjtmPW51bGx9cmV0dXJuIG4/ZzpudWxsfWZ1bmN0aW9uIHZhKGEsYixjKXtmdW5jdGlvbiBkKGUsZixnLGgsayl7ZXx8KGU9YS4kbmV3KCExLGspLGUuJCR0cmFuc2NsdWRlZD0hMCk7cmV0dXJuIGIoZSxmLHtwYXJlbnRCb3VuZFRyYW5zY2x1ZGVGbjpjLHRyYW5zY2x1ZGVDb250cm9sbGVyczpnLGZ1dHVyZVBhcmVudEVsZW1lbnQ6aH0pfQp2YXIgZT1kLiQkc2xvdHM9UygpLGY7Zm9yKGYgaW4gYi4kJHNsb3RzKWVbZl09Yi4kJHNsb3RzW2ZdP3ZhKGEsYi4kJHNsb3RzW2ZdLGMpOm51bGw7cmV0dXJuIGR9ZnVuY3Rpb24gJGIoYSxiLGMsZCxlKXt2YXIgZj1jLiRhdHRyLGs7c3dpdGNoKGEubm9kZVR5cGUpe2Nhc2UgMTpEYShiLHdhKHRhKGEpKSwiRSIsZCxlKTtmb3IodmFyIGwsbSxuLHA9YS5hdHRyaWJ1dGVzLHU9MCxyPXAmJnAubGVuZ3RoO3U8cjt1Kyspe3ZhciBCPSExLHg9ITE7bD1wW3VdO2s9bC5uYW1lO209VihsLnZhbHVlKTtsPXdhKGspO2lmKG49eGEudGVzdChsKSlrPWsucmVwbGFjZShYYywiIikuc3Vic3RyKDgpLnJlcGxhY2UoL18oLikvZyxmdW5jdGlvbihhLGIpe3JldHVybiBiLnRvVXBwZXJDYXNlKCl9KTsobD1sLm1hdGNoKHphKSkmJlEobFsxXSkmJihCPWsseD1rLnN1YnN0cigwLGsubGVuZ3RoLTUpKyJlbmQiLGs9ay5zdWJzdHIoMCxrLmxlbmd0aC02KSk7bD13YShrLnRvTG93ZXJDYXNlKCkpO2ZbbF09Cms7aWYobnx8IWMuaGFzT3duUHJvcGVydHkobCkpY1tsXT1tLFRjKGEsbCkmJihjW2xdPSEwKTtoYShhLGIsbSxsLG4pO0RhKGIsbCwiQSIsZCxlLEIseCl9YT1hLmNsYXNzTmFtZTtKKGEpJiYoYT1hLmFuaW1WYWwpO2lmKEkoYSkmJiIiIT09YSlmb3IoO2s9aC5leGVjKGEpOylsPXdhKGtbMl0pLERhKGIsbCwiQyIsZCxlKSYmKGNbbF09VihrWzNdKSksYT1hLnN1YnN0cihrLmluZGV4K2tbMF0ubGVuZ3RoKTticmVhaztjYXNlIE5hOmlmKDExPT09QmEpZm9yKDthLnBhcmVudE5vZGUmJmEubmV4dFNpYmxpbmcmJmEubmV4dFNpYmxpbmcubm9kZVR5cGU9PT1OYTspYS5ub2RlVmFsdWUrPWEubmV4dFNpYmxpbmcubm9kZVZhbHVlLGEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhLm5leHRTaWJsaW5nKTskKGIsYS5ub2RlVmFsdWUpO2JyZWFrO2Nhc2UgODp0cnl7aWYoaz1nLmV4ZWMoYS5ub2RlVmFsdWUpKWw9d2Eoa1sxXSksRGEoYixsLCJNIixkLGUpJiYoY1tsXT1WKGtbMl0pKX1jYXRjaChBKXt9fWIuc29ydChYKTsKcmV0dXJuIGJ9ZnVuY3Rpb24gWWMoYSxiLGMpe3ZhciBkPVtdLGU9MDtpZihiJiZhLmhhc0F0dHJpYnV0ZSYmYS5oYXNBdHRyaWJ1dGUoYikpe2Rve2lmKCFhKXRocm93IGVhKCJ1dGVyZGlyIixiLGMpOzE9PWEubm9kZVR5cGUmJihhLmhhc0F0dHJpYnV0ZShiKSYmZSsrLGEuaGFzQXR0cmlidXRlKGMpJiZlLS0pO2QucHVzaChhKTthPWEubmV4dFNpYmxpbmd9d2hpbGUoMDxlKX1lbHNlIGQucHVzaChhKTtyZXR1cm4gRyhkKX1mdW5jdGlvbiBPKGEsYixjKXtyZXR1cm4gZnVuY3Rpb24oZCxlLGYsZyxoKXtlPVljKGVbMF0sYixjKTtyZXR1cm4gYShkLGUsZixnLGgpfX1mdW5jdGlvbiBhYyhhLGIsYyxkLGUsZil7dmFyIGc7cmV0dXJuIGE/YWEoYixjLGQsZSxmKTpmdW5jdGlvbigpe2d8fChnPWFhKGIsYyxkLGUsZiksYj1jPWY9bnVsbCk7cmV0dXJuIGcuYXBwbHkodGhpcyxhcmd1bWVudHMpfX1mdW5jdGlvbiBUYShhLGIsZCxlLGYsZyxoLGssbCl7ZnVuY3Rpb24gbShhLGIsYyxkKXtpZihhKXtjJiYKKGE9TyhhLGMsZCkpO2EucmVxdWlyZT10LnJlcXVpcmU7YS5kaXJlY3RpdmVOYW1lPU07aWYoQj09PXR8fHQuJCRpc29sYXRlU2NvcGUpYT1mYShhLHtpc29sYXRlU2NvcGU6ITB9KTtoLnB1c2goYSl9aWYoYil7YyYmKGI9TyhiLGMsZCkpO2IucmVxdWlyZT10LnJlcXVpcmU7Yi5kaXJlY3RpdmVOYW1lPU07aWYoQj09PXR8fHQuJCRpc29sYXRlU2NvcGUpYj1mYShiLHtpc29sYXRlU2NvcGU6ITB9KTtrLnB1c2goYil9fWZ1bmN0aW9uIG4oYSxjLGUsZixnKXtmdW5jdGlvbiBsKGEsYixjLGQpe3ZhciBlO1phKGEpfHwoZD1jLGM9YixiPWEsYT12b2lkIDApO3cmJihlPXopO2N8fChjPXc/RC5wYXJlbnQoKTpEKTtpZihkKXt2YXIgZj1nLiQkc2xvdHNbZF07aWYoZilyZXR1cm4gZihhLGIsZSxjLEZiKTtpZih5KGYpKXRocm93IGVhKCJub3Nsb3QiLGQsdWEoRCkpO31lbHNlIHJldHVybiBnKGEsYixlLGMsRmIpfXZhciBtLHAsQSx0LEgseixOLEQ7Yj09PWU/KGY9ZCxEPWQuJCRlbGVtZW50KToKKEQ9RyhlKSxmPW5ldyBBYShELGQpKTtIPWM7Qj90PWMuJG5ldyghMCk6dSYmKEg9Yy4kcGFyZW50KTtnJiYoTj1sLE4uJCRib3VuZFRyYW5zY2x1ZGU9ZyxOLmlzU2xvdEZpbGxlZD1mdW5jdGlvbihhKXtyZXR1cm4hIWcuJCRzbG90c1thXX0pO3ImJih6PSRmKEQsZixOLHIsdCxjLEIpKTtCJiYoYWEuJCRhZGRTY29wZUluZm8oRCx0LCEwLCEoeCYmKHg9PT1CfHx4PT09Qi4kJG9yaWdpbmFsRGlyZWN0aXZlKSkpLGFhLiQkYWRkU2NvcGVDbGFzcyhELCEwKSx0LiQkaXNvbGF0ZUJpbmRpbmdzPUIuJCRpc29sYXRlQmluZGluZ3MscD1nYShjLGYsdCx0LiQkaXNvbGF0ZUJpbmRpbmdzLEIpLHAucmVtb3ZlV2F0Y2hlcyYmdC4kb24oIiRkZXN0cm95IixwLnJlbW92ZVdhdGNoZXMpKTtmb3IobSBpbiB6KXtwPXJbbV07QT16W21dO3ZhciBSPXAuJCRiaW5kaW5ncy5iaW5kVG9Db250cm9sbGVyO0EuYmluZGluZ0luZm89QS5pZGVudGlmaWVyJiZSP2dhKEgsZixBLmluc3RhbmNlLFIscCk6Cnt9O3ZhciBNPUEoKTtNIT09QS5pbnN0YW5jZSYmKEEuaW5zdGFuY2U9TSxELmRhdGEoIiQiK3AubmFtZSsiQ29udHJvbGxlciIsTSksQS5iaW5kaW5nSW5mby5yZW1vdmVXYXRjaGVzJiZBLmJpbmRpbmdJbmZvLnJlbW92ZVdhdGNoZXMoKSxBLmJpbmRpbmdJbmZvPWdhKEgsZixBLmluc3RhbmNlLFIscCkpfXEocixmdW5jdGlvbihhLGIpe3ZhciBjPWEucmVxdWlyZTthLmJpbmRUb0NvbnRyb2xsZXImJiFLKGMpJiZKKGMpJiZQKHpbYl0uaW5zdGFuY2UsaWIoYixjLEQseikpfSk7cSh6LGZ1bmN0aW9uKGEpe3ZhciBiPWEuaW5zdGFuY2U7RShiLiRvbkNoYW5nZXMpJiZiLiRvbkNoYW5nZXMoYS5iaW5kaW5nSW5mby5pbml0aWFsQ2hhbmdlcyk7RShiLiRvbkluaXQpJiZiLiRvbkluaXQoKTtFKGIuJG9uRGVzdHJveSkmJkguJG9uKCIkZGVzdHJveSIsZnVuY3Rpb24oKXtiLiRvbkRlc3Ryb3koKX0pfSk7bT0wO2ZvcihwPWgubGVuZ3RoO208cDttKyspQT1oW21dLGlhKEEsQS5pc29sYXRlU2NvcGU/CnQ6YyxELGYsQS5yZXF1aXJlJiZpYihBLmRpcmVjdGl2ZU5hbWUsQS5yZXF1aXJlLEQseiksTik7dmFyIEZiPWM7QiYmKEIudGVtcGxhdGV8fG51bGw9PT1CLnRlbXBsYXRlVXJsKSYmKEZiPXQpO2EmJmEoRmIsZS5jaGlsZE5vZGVzLHZvaWQgMCxnKTtmb3IobT1rLmxlbmd0aC0xOzA8PW07bS0tKUE9a1ttXSxpYShBLEEuaXNvbGF0ZVNjb3BlP3Q6YyxELGYsQS5yZXF1aXJlJiZpYihBLmRpcmVjdGl2ZU5hbWUsQS5yZXF1aXJlLEQseiksTik7cSh6LGZ1bmN0aW9uKGEpe2E9YS5pbnN0YW5jZTtFKGEuJHBvc3RMaW5rKSYmYS4kcG9zdExpbmsoKX0pfWw9bHx8e307Zm9yKHZhciBwPS1OdW1iZXIuTUFYX1ZBTFVFLHU9bC5uZXdTY29wZURpcmVjdGl2ZSxyPWwuY29udHJvbGxlckRpcmVjdGl2ZXMsQj1sLm5ld0lzb2xhdGVTY29wZURpcmVjdGl2ZSx4PWwudGVtcGxhdGVEaXJlY3RpdmUsQT1sLm5vblRsYlRyYW5zY2x1ZGVEaXJlY3RpdmUsSD0hMSx6PSExLHc9bC5oYXNFbGVtZW50VHJhbnNjbHVkZURpcmVjdGl2ZSwKTj1kLiQkZWxlbWVudD1HKGIpLHQsTSxSLGthPWUscyxDYT0hMSx2YT0hMSx2LEM9MCxGPWEubGVuZ3RoO0M8RjtDKyspe3Q9YVtDXTt2YXIgST10LiQkc3RhcnQsVGE9dC4kJGVuZDtJJiYoTj1ZYyhiLEksVGEpKTtSPXZvaWQgMDtpZihwPnQucHJpb3JpdHkpYnJlYWs7aWYodj10LnNjb3BlKXQudGVtcGxhdGVVcmx8fChKKHYpPyhXKCJuZXcvaXNvbGF0ZWQgc2NvcGUiLEJ8fHUsdCxOKSxCPXQpOlcoIm5ldy9pc29sYXRlZCBzY29wZSIsQix0LE4pKSx1PXV8fHQ7TT10Lm5hbWU7aWYoIUNhJiYodC5yZXBsYWNlJiYodC50ZW1wbGF0ZVVybHx8dC50ZW1wbGF0ZSl8fHQudHJhbnNjbHVkZSYmIXQuJCR0bGIpKXtmb3Iodj1DKzE7Q2E9YVt2KytdOylpZihDYS50cmFuc2NsdWRlJiYhQ2EuJCR0bGJ8fENhLnJlcGxhY2UmJihDYS50ZW1wbGF0ZVVybHx8Q2EudGVtcGxhdGUpKXt2YT0hMDticmVha31DYT0hMH0hdC50ZW1wbGF0ZVVybCYmdC5jb250cm9sbGVyJiYodj10LmNvbnRyb2xsZXIsCnI9cnx8UygpLFcoIiciK00rIicgY29udHJvbGxlciIscltNXSx0LE4pLHJbTV09dCk7aWYodj10LnRyYW5zY2x1ZGUpaWYoSD0hMCx0LiQkdGxifHwoVygidHJhbnNjbHVzaW9uIixBLHQsTiksQT10KSwiZWxlbWVudCI9PXYpdz0hMCxwPXQucHJpb3JpdHksUj1OLE49ZC4kJGVsZW1lbnQ9RyhhYS4kJGNyZWF0ZUNvbW1lbnQoTSxkW01dKSksYj1OWzBdLGNhKGYseWEuY2FsbChSLDApLGIpLFJbMF0uJCRwYXJlbnROb2RlPVJbMF0ucGFyZW50Tm9kZSxrYT1hYyh2YSxSLGUscCxnJiZnLm5hbWUse25vblRsYlRyYW5zY2x1ZGVEaXJlY3RpdmU6QX0pO2Vsc2V7dmFyIEw9UygpO1I9RyhZYihiKSkuY29udGVudHMoKTtpZihKKHYpKXtSPVtdO3ZhciBRPVMoKSxEYT1TKCk7cSh2LGZ1bmN0aW9uKGEsYil7dmFyIGM9Ij8iPT09YS5jaGFyQXQoMCk7YT1jP2Euc3Vic3RyaW5nKDEpOmE7UVthXT1iO0xbYl09bnVsbDtEYVtiXT1jfSk7cShOLmNvbnRlbnRzKCksZnVuY3Rpb24oYSl7dmFyIGI9ClFbd2EodGEoYSkpXTtiPyhEYVtiXT0hMCxMW2JdPUxbYl18fFtdLExbYl0ucHVzaChhKSk6Ui5wdXNoKGEpfSk7cShEYSxmdW5jdGlvbihhLGIpe2lmKCFhKXRocm93IGVhKCJyZXFzbG90IixiKTt9KTtmb3IodmFyIFggaW4gTClMW1hdJiYoTFtYXT1hYyh2YSxMW1hdLGUpKX1OLmVtcHR5KCk7a2E9YWModmEsUixlLHZvaWQgMCx2b2lkIDAse25lZWRzTmV3U2NvcGU6dC4kJGlzb2xhdGVTY29wZXx8dC4kJG5ld1Njb3BlfSk7a2EuJCRzbG90cz1MfWlmKHQudGVtcGxhdGUpaWYoej0hMCxXKCJ0ZW1wbGF0ZSIseCx0LE4pLHg9dCx2PUUodC50ZW1wbGF0ZSk/dC50ZW1wbGF0ZShOLGQpOnQudGVtcGxhdGUsdj1yYSh2KSx0LnJlcGxhY2Upe2c9dDtSPVdiLnRlc3Qodik/WmMoYmEodC50ZW1wbGF0ZU5hbWVzcGFjZSxWKHYpKSk6W107Yj1SWzBdO2lmKDEhPVIubGVuZ3RofHwxIT09Yi5ub2RlVHlwZSl0aHJvdyBlYSgidHBscnQiLE0sIiIpO2NhKGYsTixiKTtGPXskYXR0cjp7fX07dj0KJGIoYixbXSxGKTt2YXIgJD1hLnNwbGljZShDKzEsYS5sZW5ndGgtKEMrMSkpOyhCfHx1KSYmJGModixCLHUpO2E9YS5jb25jYXQodikuY29uY2F0KCQpO1QoZCxGKTtGPWEubGVuZ3RofWVsc2UgTi5odG1sKHYpO2lmKHQudGVtcGxhdGVVcmwpej0hMCxXKCJ0ZW1wbGF0ZSIseCx0LE4pLHg9dCx0LnJlcGxhY2UmJihnPXQpLG49WihhLnNwbGljZShDLGEubGVuZ3RoLUMpLE4sZCxmLEgmJmthLGgsayx7Y29udHJvbGxlckRpcmVjdGl2ZXM6cixuZXdTY29wZURpcmVjdGl2ZTp1IT09dCYmdSxuZXdJc29sYXRlU2NvcGVEaXJlY3RpdmU6Qix0ZW1wbGF0ZURpcmVjdGl2ZTp4LG5vblRsYlRyYW5zY2x1ZGVEaXJlY3RpdmU6QX0pLEY9YS5sZW5ndGg7ZWxzZSBpZih0LmNvbXBpbGUpdHJ5e3M9dC5jb21waWxlKE4sZCxrYSk7dmFyIFk9dC4kJG9yaWdpbmFsRGlyZWN0aXZlfHx0O0Uocyk/bShudWxsLGJiKFkscyksSSxUYSk6cyYmbShiYihZLHMucHJlKSxiYihZLHMucG9zdCksSSxUYSl9Y2F0Y2goZGEpe2MoZGEsCnVhKE4pKX10LnRlcm1pbmFsJiYobi50ZXJtaW5hbD0hMCxwPU1hdGgubWF4KHAsdC5wcmlvcml0eSkpfW4uc2NvcGU9dSYmITA9PT11LnNjb3BlO24udHJhbnNjbHVkZU9uVGhpc0VsZW1lbnQ9SDtuLnRlbXBsYXRlT25UaGlzRWxlbWVudD16O24udHJhbnNjbHVkZT1rYTtsLmhhc0VsZW1lbnRUcmFuc2NsdWRlRGlyZWN0aXZlPXc7cmV0dXJuIG59ZnVuY3Rpb24gaWIoYSxiLGMsZCl7dmFyIGU7aWYoSShiKSl7dmFyIGY9Yi5tYXRjaChsKTtiPWIuc3Vic3RyaW5nKGZbMF0ubGVuZ3RoKTt2YXIgZz1mWzFdfHxmWzNdLGY9Ij8iPT09ZlsyXTsiXl4iPT09Zz9jPWMucGFyZW50KCk6ZT0oZT1kJiZkW2JdKSYmZS5pbnN0YW5jZTtpZighZSl7dmFyIGg9IiQiK2IrIkNvbnRyb2xsZXIiO2U9Zz9jLmluaGVyaXRlZERhdGEoaCk6Yy5kYXRhKGgpfWlmKCFlJiYhZil0aHJvdyBlYSgiY3RyZXEiLGIsYSk7fWVsc2UgaWYoSyhiKSlmb3IoZT1bXSxnPTAsZj1iLmxlbmd0aDtnPGY7ZysrKWVbZ109CmliKGEsYltnXSxjLGQpO2Vsc2UgSihiKSYmKGU9e30scShiLGZ1bmN0aW9uKGIsZil7ZVtmXT1pYihhLGIsYyxkKX0pKTtyZXR1cm4gZXx8bnVsbH1mdW5jdGlvbiAkZihhLGIsYyxkLGUsZixnKXt2YXIgaD1TKCksaztmb3IoayBpbiBkKXt2YXIgbD1kW2tdLG09eyRzY29wZTpsPT09Z3x8bC4kJGlzb2xhdGVTY29wZT9lOmYsJGVsZW1lbnQ6YSwkYXR0cnM6YiwkdHJhbnNjbHVkZTpjfSxuPWwuY29udHJvbGxlcjsiQCI9PW4mJihuPWJbbC5uYW1lXSk7bT13KG4sbSwhMCxsLmNvbnRyb2xsZXJBcyk7aFtsLm5hbWVdPW07YS5kYXRhKCIkIitsLm5hbWUrIkNvbnRyb2xsZXIiLG0uaW5zdGFuY2UpfXJldHVybiBofWZ1bmN0aW9uICRjKGEsYixjKXtmb3IodmFyIGQ9MCxlPWEubGVuZ3RoO2Q8ZTtkKyspYVtkXT1TYihhW2RdLHskJGlzb2xhdGVTY29wZTpiLCQkbmV3U2NvcGU6Y30pfWZ1bmN0aW9uIERhKGIsZSxnLGgsayxsLG0pe2lmKGU9PT1rKXJldHVybiBudWxsO2s9bnVsbDtpZihmLmhhc093blByb3BlcnR5KGUpKXt2YXIgbjsKZT1hLmdldChlKyJEaXJlY3RpdmUiKTtmb3IodmFyIHA9MCx1PWUubGVuZ3RoO3A8dTtwKyspdHJ5e2lmKG49ZVtwXSwoeShoKXx8aD5uLnByaW9yaXR5KSYmLTEhPW4ucmVzdHJpY3QuaW5kZXhPZihnKSl7bCYmKG49U2Iobix7JCRzdGFydDpsLCQkZW5kOm19KSk7aWYoIW4uJCRiaW5kaW5ncyl7dmFyIHI9bixCPW4sQT1uLm5hbWUseD17aXNvbGF0ZVNjb3BlOm51bGwsYmluZFRvQ29udHJvbGxlcjpudWxsfTtKKEIuc2NvcGUpJiYoITA9PT1CLmJpbmRUb0NvbnRyb2xsZXI/KHguYmluZFRvQ29udHJvbGxlcj1kKEIuc2NvcGUsQSwhMCkseC5pc29sYXRlU2NvcGU9e30pOnguaXNvbGF0ZVNjb3BlPWQoQi5zY29wZSxBLCExKSk7SihCLmJpbmRUb0NvbnRyb2xsZXIpJiYoeC5iaW5kVG9Db250cm9sbGVyPWQoQi5iaW5kVG9Db250cm9sbGVyLEEsITApKTtpZihKKHguYmluZFRvQ29udHJvbGxlcikpe3ZhciB0PUIuY29udHJvbGxlcixIPUIuY29udHJvbGxlckFzO2lmKCF0KXRocm93IGVhKCJub2N0cmwiLApBKTtpZighV2ModCxIKSl0aHJvdyBlYSgibm9pZGVudCIsQSk7fXZhciBOPXIuJCRiaW5kaW5ncz14O0ooTi5pc29sYXRlU2NvcGUpJiYobi4kJGlzb2xhdGVCaW5kaW5ncz1OLmlzb2xhdGVTY29wZSl9Yi5wdXNoKG4pO2s9bn19Y2F0Y2godyl7Yyh3KX19cmV0dXJuIGt9ZnVuY3Rpb24gUShiKXtpZihmLmhhc093blByb3BlcnR5KGIpKWZvcih2YXIgYz1hLmdldChiKyJEaXJlY3RpdmUiKSxkPTAsZT1jLmxlbmd0aDtkPGU7ZCsrKWlmKGI9Y1tkXSxiLm11bHRpRWxlbWVudClyZXR1cm4hMDtyZXR1cm4hMX1mdW5jdGlvbiBUKGEsYil7dmFyIGM9Yi4kYXR0cixkPWEuJGF0dHIsZT1hLiQkZWxlbWVudDtxKGEsZnVuY3Rpb24oZCxlKXsiJCIhPWUuY2hhckF0KDApJiYoYltlXSYmYltlXSE9PWQmJihkKz0oInN0eWxlIj09PWU/IjsiOiIgIikrYltlXSksYS4kc2V0KGUsZCwhMCxjW2VdKSl9KTtxKGIsZnVuY3Rpb24oYixmKXsiY2xhc3MiPT1mPyhOKGUsYiksYVsiY2xhc3MiXT0oYVsiY2xhc3MiXT8KYVsiY2xhc3MiXSsiICI6IiIpK2IpOiJzdHlsZSI9PWY/KGUuYXR0cigic3R5bGUiLGUuYXR0cigic3R5bGUiKSsiOyIrYiksYS5zdHlsZT0oYS5zdHlsZT9hLnN0eWxlKyI7IjoiIikrYik6IiQiPT1mLmNoYXJBdCgwKXx8YS5oYXNPd25Qcm9wZXJ0eShmKXx8KGFbZl09YixkW2ZdPWNbZl0pfSl9ZnVuY3Rpb24gWihhLGIsYyxkLGYsZyxoLGspe3ZhciBsPVtdLG0sbixwPWJbMF0sQj1hLnNoaWZ0KCkscj1TYihCLHt0ZW1wbGF0ZVVybDpudWxsLHRyYW5zY2x1ZGU6bnVsbCxyZXBsYWNlOm51bGwsJCRvcmlnaW5hbERpcmVjdGl2ZTpCfSksQT1FKEIudGVtcGxhdGVVcmwpP0IudGVtcGxhdGVVcmwoYixjKTpCLnRlbXBsYXRlVXJsLHg9Qi50ZW1wbGF0ZU5hbWVzcGFjZTtiLmVtcHR5KCk7ZShBKS50aGVuKGZ1bmN0aW9uKGUpe3ZhciB1LHQ7ZT1yYShlKTtpZihCLnJlcGxhY2Upe2U9V2IudGVzdChlKT9aYyhiYSh4LFYoZSkpKTpbXTt1PWVbMF07aWYoMSE9ZS5sZW5ndGh8fDEhPT11Lm5vZGVUeXBlKXRocm93IGVhKCJ0cGxydCIsCkIubmFtZSxBKTtlPXskYXR0cjp7fX07Y2EoZCxiLHUpO3ZhciBIPSRiKHUsW10sZSk7SihCLnNjb3BlKSYmJGMoSCwhMCk7YT1ILmNvbmNhdChhKTtUKGMsZSl9ZWxzZSB1PXAsYi5odG1sKGUpO2EudW5zaGlmdChyKTttPVRhKGEsdSxjLGYsYixCLGcsaCxrKTtxKGQsZnVuY3Rpb24oYSxjKXthPT11JiYoZFtjXT1iWzBdKX0pO2ZvcihuPXMoYlswXS5jaGlsZE5vZGVzLGYpO2wubGVuZ3RoOyl7ZT1sLnNoaWZ0KCk7dD1sLnNoaWZ0KCk7dmFyIHo9bC5zaGlmdCgpLEQ9bC5zaGlmdCgpLEg9YlswXTtpZighZS4kJGRlc3Ryb3llZCl7aWYodCE9PXApe3ZhciB3PXQuY2xhc3NOYW1lO2suaGFzRWxlbWVudFRyYW5zY2x1ZGVEaXJlY3RpdmUmJkIucmVwbGFjZXx8KEg9WWIodSkpO2NhKHosRyh0KSxIKTtOKEcoSCksdyl9dD1tLnRyYW5zY2x1ZGVPblRoaXNFbGVtZW50P3ZhKGUsbS50cmFuc2NsdWRlLEQpOkQ7bShuLGUsSCxkLHQpfX1sPW51bGx9KTtyZXR1cm4gZnVuY3Rpb24oYSxiLApjLGQsZSl7YT1lO2IuJCRkZXN0cm95ZWR8fChsP2wucHVzaChiLGMsZCxhKToobS50cmFuc2NsdWRlT25UaGlzRWxlbWVudCYmKGE9dmEoYixtLnRyYW5zY2x1ZGUsZSkpLG0obixiLGMsZCxhKSkpfX1mdW5jdGlvbiBYKGEsYil7dmFyIGM9Yi5wcmlvcml0eS1hLnByaW9yaXR5O3JldHVybiAwIT09Yz9jOmEubmFtZSE9PWIubmFtZT9hLm5hbWU8Yi5uYW1lPy0xOjE6YS5pbmRleC1iLmluZGV4fWZ1bmN0aW9uIFcoYSxiLGMsZCl7ZnVuY3Rpb24gZShhKXtyZXR1cm4gYT8iIChtb2R1bGU6ICIrYSsiKSI6IiJ9aWYoYil0aHJvdyBlYSgibXVsdGlkaXIiLGIubmFtZSxlKGIuJCRtb2R1bGVOYW1lKSxjLm5hbWUsZShjLiQkbW9kdWxlTmFtZSksYSx1YShkKSk7fWZ1bmN0aW9uICQoYSxjKXt2YXIgZD1iKGMsITApO2QmJmEucHVzaCh7cHJpb3JpdHk6MCxjb21waWxlOmZ1bmN0aW9uKGEpe2E9YS5wYXJlbnQoKTt2YXIgYj0hIWEubGVuZ3RoO2ImJmFhLiQkYWRkQmluZGluZ0NsYXNzKGEpOwpyZXR1cm4gZnVuY3Rpb24oYSxjKXt2YXIgZT1jLnBhcmVudCgpO2J8fGFhLiQkYWRkQmluZGluZ0NsYXNzKGUpO2FhLiQkYWRkQmluZGluZ0luZm8oZSxkLmV4cHJlc3Npb25zKTthLiR3YXRjaChkLGZ1bmN0aW9uKGEpe2NbMF0ubm9kZVZhbHVlPWF9KX19fSl9ZnVuY3Rpb24gYmEoYSxiKXthPUwoYXx8Imh0bWwiKTtzd2l0Y2goYSl7Y2FzZSAic3ZnIjpjYXNlICJtYXRoIjp2YXIgYz1GLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2MuaW5uZXJIVE1MPSI8IithKyI+IitiKyI8LyIrYSsiPiI7cmV0dXJuIGMuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzO2RlZmF1bHQ6cmV0dXJuIGJ9fWZ1bmN0aW9uIGRhKGEsYil7aWYoInNyY2RvYyI9PWIpcmV0dXJuIEIuSFRNTDt2YXIgYz10YShhKTtpZigieGxpbmtIcmVmIj09Ynx8ImZvcm0iPT1jJiYiYWN0aW9uIj09Ynx8ImltZyIhPWMmJigic3JjIj09Ynx8Im5nU3JjIj09YikpcmV0dXJuIEIuUkVTT1VSQ0VfVVJMfWZ1bmN0aW9uIGhhKGEsCmMsZCxlLGYpe3ZhciBnPWRhKGEsZSk7Zj1rW2VdfHxmO3ZhciBoPWIoZCwhMCxnLGYpO2lmKGgpe2lmKCJtdWx0aXBsZSI9PT1lJiYic2VsZWN0Ij09PXRhKGEpKXRocm93IGVhKCJzZWxtdWx0aSIsdWEoYSkpO2MucHVzaCh7cHJpb3JpdHk6MTAwLGNvbXBpbGU6ZnVuY3Rpb24oKXtyZXR1cm57cHJlOmZ1bmN0aW9uKGEsYyxrKXtjPWsuJCRvYnNlcnZlcnN8fChrLiQkb2JzZXJ2ZXJzPVMoKSk7aWYobS50ZXN0KGUpKXRocm93IGVhKCJub2RvbWV2ZW50cyIpO3ZhciBsPWtbZV07bCE9PWQmJihoPWwmJmIobCwhMCxnLGYpLGQ9bCk7aCYmKGtbZV09aChhKSwoY1tlXXx8KGNbZV09W10pKS4kJGludGVyPSEwLChrLiQkb2JzZXJ2ZXJzJiZrLiQkb2JzZXJ2ZXJzW2VdLiQkc2NvcGV8fGEpLiR3YXRjaChoLGZ1bmN0aW9uKGEsYil7ImNsYXNzIj09PWUmJmEhPWI/ay4kdXBkYXRlQ2xhc3MoYSxiKTprLiRzZXQoZSxhKX0pKX19fX0pfX1mdW5jdGlvbiBjYShhLGIsYyl7dmFyIGQ9YlswXSwKZT1iLmxlbmd0aCxmPWQucGFyZW50Tm9kZSxnLGg7aWYoYSlmb3IoZz0wLGg9YS5sZW5ndGg7ZzxoO2crKylpZihhW2ddPT1kKXthW2crK109YztoPWcrZS0xO2Zvcih2YXIgaz1hLmxlbmd0aDtnPGs7ZysrLGgrKyloPGs/YVtnXT1hW2hdOmRlbGV0ZSBhW2ddO2EubGVuZ3RoLT1lLTE7YS5jb250ZXh0PT09ZCYmKGEuY29udGV4dD1jKTticmVha31mJiZmLnJlcGxhY2VDaGlsZChjLGQpO2E9Ri5kb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7Zm9yKGc9MDtnPGU7ZysrKWEuYXBwZW5kQ2hpbGQoYltnXSk7Ry5oYXNEYXRhKGQpJiYoRy5kYXRhKGMsRy5kYXRhKGQpKSxHKGQpLm9mZigiJGRlc3Ryb3kiKSk7Ry5jbGVhbkRhdGEoYS5xdWVyeVNlbGVjdG9yQWxsKCIqIikpO2ZvcihnPTE7ZzxlO2crKylkZWxldGUgYltnXTtiWzBdPWM7Yi5sZW5ndGg9MX1mdW5jdGlvbiBmYShhLGIpe3JldHVybiBQKGZ1bmN0aW9uKCl7cmV0dXJuIGEuYXBwbHkobnVsbCxhcmd1bWVudHMpfSwKYSxiKX1mdW5jdGlvbiBpYShhLGIsZCxlLGYsZyl7dHJ5e2EoYixkLGUsZixnKX1jYXRjaChoKXtjKGgsdWEoZCkpfX1mdW5jdGlvbiBnYShhLGMsZCxlLGYpe2Z1bmN0aW9uIGcoYixjLGUpe0UoZC4kb25DaGFuZ2VzKSYmYyE9PWUmJihZfHwoYS4kJHBvc3REaWdlc3QoTSksWT1bXSksbXx8KG09e30sWS5wdXNoKGgpKSxtW2JdJiYoZT1tW2JdLnByZXZpb3VzVmFsdWUpLG1bYl09bmV3IEdiKGUsYykpfWZ1bmN0aW9uIGgoKXtkLiRvbkNoYW5nZXMobSk7bT12b2lkIDB9dmFyIGs9W10sbD17fSxtO3EoZSxmdW5jdGlvbihlLGgpe3ZhciBtPWUuYXR0ck5hbWUscD1lLm9wdGlvbmFsLHUsQixBLHg7c3dpdGNoKGUubW9kZSl7Y2FzZSAiQCI6cHx8c2EuY2FsbChjLG0pfHwoZFtoXT1jW21dPXZvaWQgMCk7Yy4kb2JzZXJ2ZShtLGZ1bmN0aW9uKGEpe2lmKEkoYSl8fEVhKGEpKWcoaCxhLGRbaF0pLGRbaF09YX0pO2MuJCRvYnNlcnZlcnNbbV0uJCRzY29wZT1hO3U9Y1ttXTtJKHUpP2RbaF09CmIodSkoYSk6RWEodSkmJihkW2hdPXUpO2xbaF09bmV3IEdiKGJjLGRbaF0pO2JyZWFrO2Nhc2UgIj0iOmlmKCFzYS5jYWxsKGMsbSkpe2lmKHApYnJlYWs7Y1ttXT12b2lkIDB9aWYocCYmIWNbbV0pYnJlYWs7Qj1uKGNbbV0pO3g9Qi5saXRlcmFsP25hOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGE9PT1ifHxhIT09YSYmYiE9PWJ9O0E9Qi5hc3NpZ258fGZ1bmN0aW9uKCl7dT1kW2hdPUIoYSk7dGhyb3cgZWEoIm5vbmFzc2lnbiIsY1ttXSxtLGYubmFtZSk7fTt1PWRbaF09QihhKTtwPWZ1bmN0aW9uKGIpe3goYixkW2hdKXx8KHgoYix1KT9BKGEsYj1kW2hdKTpkW2hdPWIpO3JldHVybiB1PWJ9O3AuJHN0YXRlZnVsPSEwO3A9ZS5jb2xsZWN0aW9uP2EuJHdhdGNoQ29sbGVjdGlvbihjW21dLHApOmEuJHdhdGNoKG4oY1ttXSxwKSxudWxsLEIubGl0ZXJhbCk7ay5wdXNoKHApO2JyZWFrO2Nhc2UgIjwiOmlmKCFzYS5jYWxsKGMsbSkpe2lmKHApYnJlYWs7Y1ttXT12b2lkIDB9aWYocCYmIWNbbV0pYnJlYWs7CkI9bihjW21dKTt2YXIgSD1kW2hdPUIoYSk7bFtoXT1uZXcgR2IoYmMsZFtoXSk7cD1hLiR3YXRjaChCLGZ1bmN0aW9uKGEsYil7aWYoYj09PWEpe2lmKGI9PT1IKXJldHVybjtiPUh9ZyhoLGEsYik7ZFtoXT1hfSxCLmxpdGVyYWwpO2sucHVzaChwKTticmVhaztjYXNlICImIjpCPWMuaGFzT3duUHJvcGVydHkobSk/bihjW21dKTpDO2lmKEI9PT1DJiZwKWJyZWFrO2RbaF09ZnVuY3Rpb24oYil7cmV0dXJuIEIoYSxiKX19fSk7cmV0dXJue2luaXRpYWxDaGFuZ2VzOmwscmVtb3ZlV2F0Y2hlczprLmxlbmd0aCYmZnVuY3Rpb24oKXtmb3IodmFyIGE9MCxiPWsubGVuZ3RoO2E8YjsrK2Epa1thXSgpfX19dmFyIG1hPS9eXHcvLGxhPUYuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iiksb2E9eCxZO0FhLnByb3RvdHlwZT17JG5vcm1hbGl6ZTp3YSwkYWRkQ2xhc3M6ZnVuY3Rpb24oYSl7YSYmMDxhLmxlbmd0aCYmQS5hZGRDbGFzcyh0aGlzLiQkZWxlbWVudCxhKX0sJHJlbW92ZUNsYXNzOmZ1bmN0aW9uKGEpe2EmJgowPGEubGVuZ3RoJiZBLnJlbW92ZUNsYXNzKHRoaXMuJCRlbGVtZW50LGEpfSwkdXBkYXRlQ2xhc3M6ZnVuY3Rpb24oYSxiKXt2YXIgYz1hZChhLGIpO2MmJmMubGVuZ3RoJiZBLmFkZENsYXNzKHRoaXMuJCRlbGVtZW50LGMpOyhjPWFkKGIsYSkpJiZjLmxlbmd0aCYmQS5yZW1vdmVDbGFzcyh0aGlzLiQkZWxlbWVudCxjKX0sJHNldDpmdW5jdGlvbihhLGIsZCxlKXt2YXIgZj1UYyh0aGlzLiQkZWxlbWVudFswXSxhKSxnPWJkW2FdLGg9YTtmPyh0aGlzLiQkZWxlbWVudC5wcm9wKGEsYiksZT1mKTpnJiYodGhpc1tnXT1iLGg9Zyk7dGhpc1thXT1iO2U/dGhpcy4kYXR0clthXT1lOihlPXRoaXMuJGF0dHJbYV0pfHwodGhpcy4kYXR0clthXT1lPUJjKGEsIi0iKSk7Zj10YSh0aGlzLiQkZWxlbWVudCk7aWYoImEiPT09ZiYmKCJocmVmIj09PWF8fCJ4bGlua0hyZWYiPT09YSl8fCJpbWciPT09ZiYmInNyYyI9PT1hKXRoaXNbYV09Yj1IKGIsInNyYyI9PT1hKTtlbHNlIGlmKCJpbWciPT09CmYmJiJzcmNzZXQiPT09YSYmdihiKSl7Zm9yKHZhciBmPSIiLGc9VihiKSxrPS8oXHMrXGQreFxzKix8XHMrXGQrd1xzKix8XHMrLHwsXHMrKS8saz0vXHMvLnRlc3QoZyk/azovKCwpLyxnPWcuc3BsaXQoayksaz1NYXRoLmZsb29yKGcubGVuZ3RoLzIpLGw9MDtsPGs7bCsrKXZhciBtPTIqbCxmPWYrSChWKGdbbV0pLCEwKSxmPWYrKCIgIitWKGdbbSsxXSkpO2c9VihnWzIqbF0pLnNwbGl0KC9ccy8pO2YrPUgoVihnWzBdKSwhMCk7Mj09PWcubGVuZ3RoJiYoZis9IiAiK1YoZ1sxXSkpO3RoaXNbYV09Yj1mfSExIT09ZCYmKG51bGw9PT1ifHx5KGIpP3RoaXMuJCRlbGVtZW50LnJlbW92ZUF0dHIoZSk6bWEudGVzdChlKT90aGlzLiQkZWxlbWVudC5hdHRyKGUsYik6Uih0aGlzLiQkZWxlbWVudFswXSxlLGIpKTsoYT10aGlzLiQkb2JzZXJ2ZXJzKSYmcShhW2hdLGZ1bmN0aW9uKGEpe3RyeXthKGIpfWNhdGNoKGQpe2MoZCl9fSl9LCRvYnNlcnZlOmZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcywKZD1jLiQkb2JzZXJ2ZXJzfHwoYy4kJG9ic2VydmVycz1TKCkpLGU9ZFthXXx8KGRbYV09W10pO2UucHVzaChiKTtrYS4kZXZhbEFzeW5jKGZ1bmN0aW9uKCl7ZS4kJGludGVyfHwhYy5oYXNPd25Qcm9wZXJ0eShhKXx8eShjW2FdKXx8YihjW2FdKX0pO3JldHVybiBmdW5jdGlvbigpeyRhKGUsYil9fX07dmFyIHBhPWIuc3RhcnRTeW1ib2woKSxxYT1iLmVuZFN5bWJvbCgpLHJhPSJ7eyI9PXBhJiYifX0iPT1xYT9ZYTpmdW5jdGlvbihhKXtyZXR1cm4gYS5yZXBsYWNlKC9ce1x7L2cscGEpLnJlcGxhY2UoL319L2cscWEpfSx4YT0vXm5nQXR0cltBLVpdLyx6YT0vXiguKylTdGFydCQvO2FhLiQkYWRkQmluZGluZ0luZm89cD9mdW5jdGlvbihhLGIpe3ZhciBjPWEuZGF0YSgiJGJpbmRpbmciKXx8W107SyhiKT9jPWMuY29uY2F0KGIpOmMucHVzaChiKTthLmRhdGEoIiRiaW5kaW5nIixjKX06QzthYS4kJGFkZEJpbmRpbmdDbGFzcz1wP2Z1bmN0aW9uKGEpe04oYSwibmctYmluZGluZyIpfToKQzthYS4kJGFkZFNjb3BlSW5mbz1wP2Z1bmN0aW9uKGEsYixjLGQpe2EuZGF0YShjP2Q/IiRpc29sYXRlU2NvcGVOb1RlbXBsYXRlIjoiJGlzb2xhdGVTY29wZSI6IiRzY29wZSIsYil9OkM7YWEuJCRhZGRTY29wZUNsYXNzPXA/ZnVuY3Rpb24oYSxiKXtOKGEsYj8ibmctaXNvbGF0ZS1zY29wZSI6Im5nLXNjb3BlIil9OkM7YWEuJCRjcmVhdGVDb21tZW50PWZ1bmN0aW9uKGEsYil7dmFyIGM9IiI7cCYmKGM9IiAiKyhhfHwiIikrIjogIixiJiYoYys9YisiICIpKTtyZXR1cm4gRi5kb2N1bWVudC5jcmVhdGVDb21tZW50KGMpfTtyZXR1cm4gYWF9XX1mdW5jdGlvbiBHYihhLGIpe3RoaXMucHJldmlvdXNWYWx1ZT1hO3RoaXMuY3VycmVudFZhbHVlPWJ9ZnVuY3Rpb24gd2EoYSl7cmV0dXJuIGViKGEucmVwbGFjZShYYywiIikpfWZ1bmN0aW9uIGFkKGEsYil7dmFyIGQ9IiIsYz1hLnNwbGl0KC9ccysvKSxlPWIuc3BsaXQoL1xzKy8pLGY9MDthOmZvcig7ZjxjLmxlbmd0aDtmKyspe2Zvcih2YXIgZz0KY1tmXSxoPTA7aDxlLmxlbmd0aDtoKyspaWYoZz09ZVtoXSljb250aW51ZSBhO2QrPSgwPGQubGVuZ3RoPyIgIjoiIikrZ31yZXR1cm4gZH1mdW5jdGlvbiBaYyhhKXthPUcoYSk7dmFyIGI9YS5sZW5ndGg7aWYoMT49YilyZXR1cm4gYTtmb3IoO2ItLTspOD09PWFbYl0ubm9kZVR5cGUmJmFnLmNhbGwoYSxiLDEpO3JldHVybiBhfWZ1bmN0aW9uIFdjKGEsYil7aWYoYiYmSShiKSlyZXR1cm4gYjtpZihJKGEpKXt2YXIgZD1jZC5leGVjKGEpO2lmKGQpcmV0dXJuIGRbM119fWZ1bmN0aW9uIGZmKCl7dmFyIGE9e30sYj0hMTt0aGlzLmhhcz1mdW5jdGlvbihiKXtyZXR1cm4gYS5oYXNPd25Qcm9wZXJ0eShiKX07dGhpcy5yZWdpc3Rlcj1mdW5jdGlvbihiLGMpe1JhKGIsImNvbnRyb2xsZXIiKTtKKGIpP1AoYSxiKTphW2JdPWN9O3RoaXMuYWxsb3dHbG9iYWxzPWZ1bmN0aW9uKCl7Yj0hMH07dGhpcy4kZ2V0PVsiJGluamVjdG9yIiwiJHdpbmRvdyIsZnVuY3Rpb24oZCxjKXtmdW5jdGlvbiBlKGEsCmIsYyxkKXtpZighYXx8IUooYS4kc2NvcGUpKXRocm93IE8oIiRjb250cm9sbGVyIikoIm5vc2NwIixkLGIpO2EuJHNjb3BlW2JdPWN9cmV0dXJuIGZ1bmN0aW9uKGYsZyxoLGspe3ZhciBsLG0sbjtoPSEwPT09aDtrJiZJKGspJiYobj1rKTtpZihJKGYpKXtrPWYubWF0Y2goY2QpO2lmKCFrKXRocm93IGJnKCJjdHJsZm10IixmKTttPWtbMV07bj1ufHxrWzNdO2Y9YS5oYXNPd25Qcm9wZXJ0eShtKT9hW21dOkRjKGcuJHNjb3BlLG0sITApfHwoYj9EYyhjLG0sITApOnZvaWQgMCk7UWEoZixtLCEwKX1pZihoKXJldHVybiBoPShLKGYpP2ZbZi5sZW5ndGgtMV06ZikucHJvdG90eXBlLGw9T2JqZWN0LmNyZWF0ZShofHxudWxsKSxuJiZlKGcsbixsLG18fGYubmFtZSksUChmdW5jdGlvbigpe3ZhciBhPWQuaW52b2tlKGYsbCxnLG0pO2EhPT1sJiYoSihhKXx8RShhKSkmJihsPWEsbiYmZShnLG4sbCxtfHxmLm5hbWUpKTtyZXR1cm4gbH0se2luc3RhbmNlOmwsaWRlbnRpZmllcjpufSk7bD0KZC5pbnN0YW50aWF0ZShmLGcsbSk7biYmZShnLG4sbCxtfHxmLm5hbWUpO3JldHVybiBsfX1dfWZ1bmN0aW9uIGdmKCl7dGhpcy4kZ2V0PVsiJHdpbmRvdyIsZnVuY3Rpb24oYSl7cmV0dXJuIEcoYS5kb2N1bWVudCl9XX1mdW5jdGlvbiBoZigpe3RoaXMuJGdldD1bIiRsb2ciLGZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbihiLGQpe2EuZXJyb3IuYXBwbHkoYSxhcmd1bWVudHMpfX1dfWZ1bmN0aW9uIGNjKGEpe3JldHVybiBKKGEpP2hhKGEpP2EudG9JU09TdHJpbmcoKTpjYihhKTphfWZ1bmN0aW9uIG5mKCl7dGhpcy4kZ2V0PWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKGEpe2lmKCFhKXJldHVybiIiO3ZhciBiPVtdO3NjKGEsZnVuY3Rpb24oYSxjKXtudWxsPT09YXx8eShhKXx8KEsoYSk/cShhLGZ1bmN0aW9uKGEpe2IucHVzaChpYShjKSsiPSIraWEoY2MoYSkpKX0pOmIucHVzaChpYShjKSsiPSIraWEoY2MoYSkpKSl9KTtyZXR1cm4gYi5qb2luKCImIil9fX1mdW5jdGlvbiBvZigpe3RoaXMuJGdldD0KZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihhLGUsZil7bnVsbD09PWF8fHkoYSl8fChLKGEpP3EoYSxmdW5jdGlvbihhLGMpe2IoYSxlKyJbIisoSihhKT9jOiIiKSsiXSIpfSk6SihhKSYmIWhhKGEpP3NjKGEsZnVuY3Rpb24oYSxjKXtiKGEsZSsoZj8iIjoiWyIpK2MrKGY/IiI6Il0iKSl9KTpkLnB1c2goaWEoZSkrIj0iK2lhKGNjKGEpKSkpfWlmKCFhKXJldHVybiIiO3ZhciBkPVtdO2IoYSwiIiwhMCk7cmV0dXJuIGQuam9pbigiJiIpfX19ZnVuY3Rpb24gZGMoYSxiKXtpZihJKGEpKXt2YXIgZD1hLnJlcGxhY2UoY2csIiIpLnRyaW0oKTtpZihkKXt2YXIgYz1iKCJDb250ZW50LVR5cGUiKTsoYz1jJiYwPT09Yy5pbmRleE9mKGRkKSl8fChjPShjPWQubWF0Y2goZGcpKSYmZWdbY1swXV0udGVzdChkKSk7YyYmKGE9d2MoZCkpfX1yZXR1cm4gYX1mdW5jdGlvbiBlZChhKXt2YXIgYj1TKCksZDtJKGEpP3EoYS5zcGxpdCgiXG4iKSxmdW5jdGlvbihhKXtkPQphLmluZGV4T2YoIjoiKTt2YXIgZT1MKFYoYS5zdWJzdHIoMCxkKSkpO2E9VihhLnN1YnN0cihkKzEpKTtlJiYoYltlXT1iW2VdP2JbZV0rIiwgIithOmEpfSk6SihhKSYmcShhLGZ1bmN0aW9uKGEsZCl7dmFyIGY9TChkKSxnPVYoYSk7ZiYmKGJbZl09YltmXT9iW2ZdKyIsICIrZzpnKX0pO3JldHVybiBifWZ1bmN0aW9uIGZkKGEpe3ZhciBiO3JldHVybiBmdW5jdGlvbihkKXtifHwoYj1lZChhKSk7cmV0dXJuIGQ/KGQ9YltMKGQpXSx2b2lkIDA9PT1kJiYoZD1udWxsKSxkKTpifX1mdW5jdGlvbiBnZChhLGIsZCxjKXtpZihFKGMpKXJldHVybiBjKGEsYixkKTtxKGMsZnVuY3Rpb24oYyl7YT1jKGEsYixkKX0pO3JldHVybiBhfWZ1bmN0aW9uIG1mKCl7dmFyIGE9dGhpcy5kZWZhdWx0cz17dHJhbnNmb3JtUmVzcG9uc2U6W2RjXSx0cmFuc2Zvcm1SZXF1ZXN0OltmdW5jdGlvbihhKXtyZXR1cm4gSihhKSYmIltvYmplY3QgRmlsZV0iIT09amEuY2FsbChhKSYmIltvYmplY3QgQmxvYl0iIT09CmphLmNhbGwoYSkmJiJbb2JqZWN0IEZvcm1EYXRhXSIhPT1qYS5jYWxsKGEpP2NiKGEpOmF9XSxoZWFkZXJzOntjb21tb246e0FjY2VwdDoiYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qIn0scG9zdDpmYShlYykscHV0OmZhKGVjKSxwYXRjaDpmYShlYyl9LHhzcmZDb29raWVOYW1lOiJYU1JGLVRPS0VOIix4c3JmSGVhZGVyTmFtZToiWC1YU1JGLVRPS0VOIixwYXJhbVNlcmlhbGl6ZXI6IiRodHRwUGFyYW1TZXJpYWxpemVyIn0sYj0hMTt0aGlzLnVzZUFwcGx5QXN5bmM9ZnVuY3Rpb24oYSl7cmV0dXJuIHYoYSk/KGI9ISFhLHRoaXMpOmJ9O3ZhciBkPSEwO3RoaXMudXNlTGVnYWN5UHJvbWlzZUV4dGVuc2lvbnM9ZnVuY3Rpb24oYSl7cmV0dXJuIHYoYSk/KGQ9ISFhLHRoaXMpOmR9O3ZhciBjPXRoaXMuaW50ZXJjZXB0b3JzPVtdO3RoaXMuJGdldD1bIiRodHRwQmFja2VuZCIsIiQkY29va2llUmVhZGVyIiwiJGNhY2hlRmFjdG9yeSIsIiRyb290U2NvcGUiLCIkcSIsIiRpbmplY3RvciIsCmZ1bmN0aW9uKGUsZixnLGgsayxsKXtmdW5jdGlvbiBtKGIpe2Z1bmN0aW9uIGMoYSl7dmFyIGI9UCh7fSxhKTtiLmRhdGE9Z2QoYS5kYXRhLGEuaGVhZGVycyxhLnN0YXR1cyxmLnRyYW5zZm9ybVJlc3BvbnNlKTthPWEuc3RhdHVzO3JldHVybiAyMDA8PWEmJjMwMD5hP2I6ay5yZWplY3QoYil9ZnVuY3Rpb24gZShhLGIpe3ZhciBjLGQ9e307cShhLGZ1bmN0aW9uKGEsZSl7RShhKT8oYz1hKGIpLG51bGwhPWMmJihkW2VdPWMpKTpkW2VdPWF9KTtyZXR1cm4gZH1pZighSihiKSl0aHJvdyBPKCIkaHR0cCIpKCJiYWRyZXEiLGIpO2lmKCFJKGIudXJsKSl0aHJvdyBPKCIkaHR0cCIpKCJiYWRyZXEiLGIudXJsKTt2YXIgZj1QKHttZXRob2Q6ImdldCIsdHJhbnNmb3JtUmVxdWVzdDphLnRyYW5zZm9ybVJlcXVlc3QsdHJhbnNmb3JtUmVzcG9uc2U6YS50cmFuc2Zvcm1SZXNwb25zZSxwYXJhbVNlcmlhbGl6ZXI6YS5wYXJhbVNlcmlhbGl6ZXJ9LGIpO2YuaGVhZGVycz1mdW5jdGlvbihiKXt2YXIgYz0KYS5oZWFkZXJzLGQ9UCh7fSxiLmhlYWRlcnMpLGYsZyxoLGM9UCh7fSxjLmNvbW1vbixjW0woYi5tZXRob2QpXSk7YTpmb3IoZiBpbiBjKXtnPUwoZik7Zm9yKGggaW4gZClpZihMKGgpPT09Zyljb250aW51ZSBhO2RbZl09Y1tmXX1yZXR1cm4gZShkLGZhKGIpKX0oYik7Zi5tZXRob2Q9dWIoZi5tZXRob2QpO2YucGFyYW1TZXJpYWxpemVyPUkoZi5wYXJhbVNlcmlhbGl6ZXIpP2wuZ2V0KGYucGFyYW1TZXJpYWxpemVyKTpmLnBhcmFtU2VyaWFsaXplcjt2YXIgZz1bZnVuY3Rpb24oYil7dmFyIGQ9Yi5oZWFkZXJzLGU9Z2QoYi5kYXRhLGZkKGQpLHZvaWQgMCxiLnRyYW5zZm9ybVJlcXVlc3QpO3koZSkmJnEoZCxmdW5jdGlvbihhLGIpeyJjb250ZW50LXR5cGUiPT09TChiKSYmZGVsZXRlIGRbYl19KTt5KGIud2l0aENyZWRlbnRpYWxzKSYmIXkoYS53aXRoQ3JlZGVudGlhbHMpJiYoYi53aXRoQ3JlZGVudGlhbHM9YS53aXRoQ3JlZGVudGlhbHMpO3JldHVybiBuKGIsZSkudGhlbihjLApjKX0sdm9pZCAwXSxoPWsud2hlbihmKTtmb3IocShVLGZ1bmN0aW9uKGEpeyhhLnJlcXVlc3R8fGEucmVxdWVzdEVycm9yKSYmZy51bnNoaWZ0KGEucmVxdWVzdCxhLnJlcXVlc3RFcnJvcik7KGEucmVzcG9uc2V8fGEucmVzcG9uc2VFcnJvcikmJmcucHVzaChhLnJlc3BvbnNlLGEucmVzcG9uc2VFcnJvcil9KTtnLmxlbmd0aDspe2I9Zy5zaGlmdCgpO3ZhciBtPWcuc2hpZnQoKSxoPWgudGhlbihiLG0pfWQ/KGguc3VjY2Vzcz1mdW5jdGlvbihhKXtRYShhLCJmbiIpO2gudGhlbihmdW5jdGlvbihiKXthKGIuZGF0YSxiLnN0YXR1cyxiLmhlYWRlcnMsZil9KTtyZXR1cm4gaH0saC5lcnJvcj1mdW5jdGlvbihhKXtRYShhLCJmbiIpO2gudGhlbihudWxsLGZ1bmN0aW9uKGIpe2EoYi5kYXRhLGIuc3RhdHVzLGIuaGVhZGVycyxmKX0pO3JldHVybiBofSk6KGguc3VjY2Vzcz1oZCgic3VjY2VzcyIpLGguZXJyb3I9aGQoImVycm9yIikpO3JldHVybiBofWZ1bmN0aW9uIG4oYyxkKXtmdW5jdGlvbiBnKGEpe2lmKGEpe3ZhciBjPQp7fTtxKGEsZnVuY3Rpb24oYSxkKXtjW2RdPWZ1bmN0aW9uKGMpe2Z1bmN0aW9uIGQoKXthKGMpfWI/aC4kYXBwbHlBc3luYyhkKTpoLiQkcGhhc2U/ZCgpOmguJGFwcGx5KGQpfX0pO3JldHVybiBjfX1mdW5jdGlvbiBsKGEsYyxkLGUpe2Z1bmN0aW9uIGYoKXtuKGMsYSxkLGUpfUgmJigyMDA8PWEmJjMwMD5hP0gucHV0KFIsW2EsYyxlZChkKSxlXSk6SC5yZW1vdmUoUikpO2I/aC4kYXBwbHlBc3luYyhmKTooZigpLGguJCRwaGFzZXx8aC4kYXBwbHkoKSl9ZnVuY3Rpb24gbihhLGIsZCxlKXtiPS0xPD1iP2I6MDsoMjAwPD1iJiYzMDA+Yj9CLnJlc29sdmU6Qi5yZWplY3QpKHtkYXRhOmEsc3RhdHVzOmIsaGVhZGVyczpmZChkKSxjb25maWc6YyxzdGF0dXNUZXh0OmV9KX1mdW5jdGlvbiB3KGEpe24oYS5kYXRhLGEuc3RhdHVzLGZhKGEuaGVhZGVycygpKSxhLnN0YXR1c1RleHQpfWZ1bmN0aW9uIFUoKXt2YXIgYT1tLnBlbmRpbmdSZXF1ZXN0cy5pbmRleE9mKGMpOy0xIT09YSYmbS5wZW5kaW5nUmVxdWVzdHMuc3BsaWNlKGEsCjEpfXZhciBCPWsuZGVmZXIoKSxBPUIucHJvbWlzZSxILE0sQWE9Yy5oZWFkZXJzLFI9cChjLnVybCxjLnBhcmFtU2VyaWFsaXplcihjLnBhcmFtcykpO20ucGVuZGluZ1JlcXVlc3RzLnB1c2goYyk7QS50aGVuKFUsVSk7IWMuY2FjaGUmJiFhLmNhY2hlfHwhMT09PWMuY2FjaGV8fCJHRVQiIT09Yy5tZXRob2QmJiJKU09OUCIhPT1jLm1ldGhvZHx8KEg9SihjLmNhY2hlKT9jLmNhY2hlOkooYS5jYWNoZSk/YS5jYWNoZTp4KTtIJiYoTT1ILmdldChSKSx2KE0pP00mJkUoTS50aGVuKT9NLnRoZW4odyx3KTpLKE0pP24oTVsxXSxNWzBdLGZhKE1bMl0pLE1bM10pOm4oTSwyMDAse30sIk9LIik6SC5wdXQoUixBKSk7eShNKSYmKChNPWlkKGMudXJsKT9mKClbYy54c3JmQ29va2llTmFtZXx8YS54c3JmQ29va2llTmFtZV06dm9pZCAwKSYmKEFhW2MueHNyZkhlYWRlck5hbWV8fGEueHNyZkhlYWRlck5hbWVdPU0pLGUoYy5tZXRob2QsUixkLGwsQWEsYy50aW1lb3V0LGMud2l0aENyZWRlbnRpYWxzLApjLnJlc3BvbnNlVHlwZSxnKGMuZXZlbnRIYW5kbGVycyksZyhjLnVwbG9hZEV2ZW50SGFuZGxlcnMpKSk7cmV0dXJuIEF9ZnVuY3Rpb24gcChhLGIpezA8Yi5sZW5ndGgmJihhKz0oLTE9PWEuaW5kZXhPZigiPyIpPyI/IjoiJiIpK2IpO3JldHVybiBhfXZhciB4PWcoIiRodHRwIik7YS5wYXJhbVNlcmlhbGl6ZXI9SShhLnBhcmFtU2VyaWFsaXplcik/bC5nZXQoYS5wYXJhbVNlcmlhbGl6ZXIpOmEucGFyYW1TZXJpYWxpemVyO3ZhciBVPVtdO3EoYyxmdW5jdGlvbihhKXtVLnVuc2hpZnQoSShhKT9sLmdldChhKTpsLmludm9rZShhKSl9KTttLnBlbmRpbmdSZXF1ZXN0cz1bXTsoZnVuY3Rpb24oYSl7cShhcmd1bWVudHMsZnVuY3Rpb24oYSl7bVthXT1mdW5jdGlvbihiLGMpe3JldHVybiBtKFAoe30sY3x8e30se21ldGhvZDphLHVybDpifSkpfX0pfSkoImdldCIsImRlbGV0ZSIsImhlYWQiLCJqc29ucCIpOyhmdW5jdGlvbihhKXtxKGFyZ3VtZW50cyxmdW5jdGlvbihhKXttW2FdPWZ1bmN0aW9uKGIsCmMsZCl7cmV0dXJuIG0oUCh7fSxkfHx7fSx7bWV0aG9kOmEsdXJsOmIsZGF0YTpjfSkpfX0pfSkoInBvc3QiLCJwdXQiLCJwYXRjaCIpO20uZGVmYXVsdHM9YTtyZXR1cm4gbX1dfWZ1bmN0aW9uIHFmKCl7dGhpcy4kZ2V0PWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBGLlhNTEh0dHBSZXF1ZXN0fX19ZnVuY3Rpb24gcGYoKXt0aGlzLiRnZXQ9WyIkYnJvd3NlciIsIiR3aW5kb3ciLCIkZG9jdW1lbnQiLCIkeGhyRmFjdG9yeSIsZnVuY3Rpb24oYSxiLGQsYyl7cmV0dXJuIGZnKGEsYyxhLmRlZmVyLGIuYW5ndWxhci5jYWxsYmFja3MsZFswXSl9XX1mdW5jdGlvbiBmZyhhLGIsZCxjLGUpe2Z1bmN0aW9uIGYoYSxiLGQpe3ZhciBmPWUuY3JlYXRlRWxlbWVudCgic2NyaXB0IiksbT1udWxsO2YudHlwZT0idGV4dC9qYXZhc2NyaXB0IjtmLnNyYz1hO2YuYXN5bmM9ITA7bT1mdW5jdGlvbihhKXtmLnJlbW92ZUV2ZW50TGlzdGVuZXIoImxvYWQiLG0sITEpO2YucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZXJyb3IiLAptLCExKTtlLmJvZHkucmVtb3ZlQ2hpbGQoZik7Zj1udWxsO3ZhciBnPS0xLHg9InVua25vd24iO2EmJigibG9hZCIhPT1hLnR5cGV8fGNbYl0uY2FsbGVkfHwoYT17dHlwZToiZXJyb3IifSkseD1hLnR5cGUsZz0iZXJyb3IiPT09YS50eXBlPzQwNDoyMDApO2QmJmQoZyx4KX07Zi5hZGRFdmVudExpc3RlbmVyKCJsb2FkIixtLCExKTtmLmFkZEV2ZW50TGlzdGVuZXIoImVycm9yIixtLCExKTtlLmJvZHkuYXBwZW5kQ2hpbGQoZik7cmV0dXJuIG19cmV0dXJuIGZ1bmN0aW9uKGUsaCxrLGwsbSxuLHAseCxVLHope2Z1bmN0aW9uIHIoKXt0JiZ0KCk7dyYmdy5hYm9ydCgpfWZ1bmN0aW9uIEQoYixjLGUsZixnKXt2KEIpJiZkLmNhbmNlbChCKTt0PXc9bnVsbDtiKGMsZSxmLGcpO2EuJCRjb21wbGV0ZU91dHN0YW5kaW5nUmVxdWVzdChDKX1hLiQkaW5jT3V0c3RhbmRpbmdSZXF1ZXN0Q291bnQoKTtoPWh8fGEudXJsKCk7aWYoImpzb25wIj09TChlKSl7dmFyIHU9Il8iKyhjLmNvdW50ZXIrKykudG9TdHJpbmcoMzYpOwpjW3VdPWZ1bmN0aW9uKGEpe2NbdV0uZGF0YT1hO2NbdV0uY2FsbGVkPSEwfTt2YXIgdD1mKGgucmVwbGFjZSgiSlNPTl9DQUxMQkFDSyIsImFuZ3VsYXIuY2FsbGJhY2tzLiIrdSksdSxmdW5jdGlvbihhLGIpe0QobCxhLGNbdV0uZGF0YSwiIixiKTtjW3VdPUN9KX1lbHNle3ZhciB3PWIoZSxoKTt3Lm9wZW4oZSxoLCEwKTtxKG0sZnVuY3Rpb24oYSxiKXt2KGEpJiZ3LnNldFJlcXVlc3RIZWFkZXIoYixhKX0pO3cub25sb2FkPWZ1bmN0aW9uKCl7dmFyIGE9dy5zdGF0dXNUZXh0fHwiIixiPSJyZXNwb25zZSJpbiB3P3cucmVzcG9uc2U6dy5yZXNwb25zZVRleHQsYz0xMjIzPT09dy5zdGF0dXM/MjA0Oncuc3RhdHVzOzA9PT1jJiYoYz1iPzIwMDoiZmlsZSI9PXBhKGgpLnByb3RvY29sPzQwNDowKTtEKGwsYyxiLHcuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCksYSl9O2U9ZnVuY3Rpb24oKXtEKGwsLTEsbnVsbCxudWxsLCIiKX07dy5vbmVycm9yPWU7dy5vbmFib3J0PWU7cShVLGZ1bmN0aW9uKGEsCmIpe3cuYWRkRXZlbnRMaXN0ZW5lcihiLGEpfSk7cSh6LGZ1bmN0aW9uKGEsYil7dy51cGxvYWQuYWRkRXZlbnRMaXN0ZW5lcihiLGEpfSk7cCYmKHcud2l0aENyZWRlbnRpYWxzPSEwKTtpZih4KXRyeXt3LnJlc3BvbnNlVHlwZT14fWNhdGNoKGthKXtpZigianNvbiIhPT14KXRocm93IGthO313LnNlbmQoeShrKT9udWxsOmspfWlmKDA8bil2YXIgQj1kKHIsbik7ZWxzZSBuJiZFKG4udGhlbikmJm4udGhlbihyKX19ZnVuY3Rpb24ga2YoKXt2YXIgYT0ie3siLGI9In19Ijt0aGlzLnN0YXJ0U3ltYm9sPWZ1bmN0aW9uKGIpe3JldHVybiBiPyhhPWIsdGhpcyk6YX07dGhpcy5lbmRTeW1ib2w9ZnVuY3Rpb24oYSl7cmV0dXJuIGE/KGI9YSx0aGlzKTpifTt0aGlzLiRnZXQ9WyIkcGFyc2UiLCIkZXhjZXB0aW9uSGFuZGxlciIsIiRzY2UiLGZ1bmN0aW9uKGQsYyxlKXtmdW5jdGlvbiBmKGEpe3JldHVybiJcXFxcXFwiK2F9ZnVuY3Rpb24gZyhjKXtyZXR1cm4gYy5yZXBsYWNlKG4sYSkucmVwbGFjZShwLApiKX1mdW5jdGlvbiBoKGEsYixjLGQpe3ZhciBlO3JldHVybiBlPWEuJHdhdGNoKGZ1bmN0aW9uKGEpe2UoKTtyZXR1cm4gZChhKX0sYixjKX1mdW5jdGlvbiBrKGYsayxuLHApe2Z1bmN0aW9uIEQoYSl7dHJ5e3ZhciBiPWE7YT1uP2UuZ2V0VHJ1c3RlZChuLGIpOmUudmFsdWVPZihiKTt2YXIgZDtpZihwJiYhdihhKSlkPWE7ZWxzZSBpZihudWxsPT1hKWQ9IiI7ZWxzZXtzd2l0Y2godHlwZW9mIGEpe2Nhc2UgInN0cmluZyI6YnJlYWs7Y2FzZSAibnVtYmVyIjphPSIiK2E7YnJlYWs7ZGVmYXVsdDphPWNiKGEpfWQ9YX1yZXR1cm4gZH1jYXRjaChnKXtjKEthLmludGVycihmLGcpKX19aWYoIWYubGVuZ3RofHwtMT09PWYuaW5kZXhPZihhKSl7dmFyIHU7a3x8KGs9ZyhmKSx1PWNhKGspLHUuZXhwPWYsdS5leHByZXNzaW9ucz1bXSx1LiQkd2F0Y2hEZWxlZ2F0ZT1oKTtyZXR1cm4gdX1wPSEhcDt2YXIgdCx3LHE9MCxCPVtdLEE9W107dT1mLmxlbmd0aDtmb3IodmFyIEg9W10sTT1bXTtxPAp1OylpZigtMSE9KHQ9Zi5pbmRleE9mKGEscSkpJiYtMSE9KHc9Zi5pbmRleE9mKGIsdCtsKSkpcSE9PXQmJkgucHVzaChnKGYuc3Vic3RyaW5nKHEsdCkpKSxxPWYuc3Vic3RyaW5nKHQrbCx3KSxCLnB1c2gocSksQS5wdXNoKGQocSxEKSkscT13K20sTS5wdXNoKEgubGVuZ3RoKSxILnB1c2goIiIpO2Vsc2V7cSE9PXUmJkgucHVzaChnKGYuc3Vic3RyaW5nKHEpKSk7YnJlYWt9biYmMTxILmxlbmd0aCYmS2EudGhyb3dOb2NvbmNhdChmKTtpZigha3x8Qi5sZW5ndGgpe3ZhciBBYT1mdW5jdGlvbihhKXtmb3IodmFyIGI9MCxjPUIubGVuZ3RoO2I8YztiKyspe2lmKHAmJnkoYVtiXSkpcmV0dXJuO0hbTVtiXV09YVtiXX1yZXR1cm4gSC5qb2luKCIiKX07cmV0dXJuIFAoZnVuY3Rpb24oYSl7dmFyIGI9MCxkPUIubGVuZ3RoLGU9QXJyYXkoZCk7dHJ5e2Zvcig7YjxkO2IrKyllW2JdPUFbYl0oYSk7cmV0dXJuIEFhKGUpfWNhdGNoKGcpe2MoS2EuaW50ZXJyKGYsZykpfX0se2V4cDpmLGV4cHJlc3Npb25zOkIsCiQkd2F0Y2hEZWxlZ2F0ZTpmdW5jdGlvbihhLGIpe3ZhciBjO3JldHVybiBhLiR3YXRjaEdyb3VwKEEsZnVuY3Rpb24oZCxlKXt2YXIgZj1BYShkKTtFKGIpJiZiLmNhbGwodGhpcyxmLGQhPT1lP2M6ZixhKTtjPWZ9KX19KX19dmFyIGw9YS5sZW5ndGgsbT1iLmxlbmd0aCxuPW5ldyBSZWdFeHAoYS5yZXBsYWNlKC8uL2csZiksImciKSxwPW5ldyBSZWdFeHAoYi5yZXBsYWNlKC8uL2csZiksImciKTtrLnN0YXJ0U3ltYm9sPWZ1bmN0aW9uKCl7cmV0dXJuIGF9O2suZW5kU3ltYm9sPWZ1bmN0aW9uKCl7cmV0dXJuIGJ9O3JldHVybiBrfV19ZnVuY3Rpb24gbGYoKXt0aGlzLiRnZXQ9WyIkcm9vdFNjb3BlIiwiJHdpbmRvdyIsIiRxIiwiJCRxIiwiJGJyb3dzZXIiLGZ1bmN0aW9uKGEsYixkLGMsZSl7ZnVuY3Rpb24gZihmLGssbCxtKXtmdW5jdGlvbiBuKCl7cD9mLmFwcGx5KG51bGwseCk6ZihyKX12YXIgcD00PGFyZ3VtZW50cy5sZW5ndGgseD1wP3lhLmNhbGwoYXJndW1lbnRzLDQpOgpbXSxxPWIuc2V0SW50ZXJ2YWwsej1iLmNsZWFySW50ZXJ2YWwscj0wLEQ9dihtKSYmIW0sdT0oRD9jOmQpLmRlZmVyKCksdD11LnByb21pc2U7bD12KGwpP2w6MDt0LiQkaW50ZXJ2YWxJZD1xKGZ1bmN0aW9uKCl7RD9lLmRlZmVyKG4pOmEuJGV2YWxBc3luYyhuKTt1Lm5vdGlmeShyKyspOzA8bCYmcj49bCYmKHUucmVzb2x2ZShyKSx6KHQuJCRpbnRlcnZhbElkKSxkZWxldGUgZ1t0LiQkaW50ZXJ2YWxJZF0pO0R8fGEuJGFwcGx5KCl9LGspO2dbdC4kJGludGVydmFsSWRdPXU7cmV0dXJuIHR9dmFyIGc9e307Zi5jYW5jZWw9ZnVuY3Rpb24oYSl7cmV0dXJuIGEmJmEuJCRpbnRlcnZhbElkIGluIGc/KGdbYS4kJGludGVydmFsSWRdLnJlamVjdCgiY2FuY2VsZWQiKSxiLmNsZWFySW50ZXJ2YWwoYS4kJGludGVydmFsSWQpLGRlbGV0ZSBnW2EuJCRpbnRlcnZhbElkXSwhMCk6ITF9O3JldHVybiBmfV19ZnVuY3Rpb24gZmMoYSl7YT1hLnNwbGl0KCIvIik7Zm9yKHZhciBiPWEubGVuZ3RoO2ItLTspYVtiXT0KcWIoYVtiXSk7cmV0dXJuIGEuam9pbigiLyIpfWZ1bmN0aW9uIGpkKGEsYil7dmFyIGQ9cGEoYSk7Yi4kJHByb3RvY29sPWQucHJvdG9jb2w7Yi4kJGhvc3Q9ZC5ob3N0bmFtZTtiLiQkcG9ydD0kKGQucG9ydCl8fGdnW2QucHJvdG9jb2xdfHxudWxsfWZ1bmN0aW9uIGtkKGEsYil7dmFyIGQ9Ii8iIT09YS5jaGFyQXQoMCk7ZCYmKGE9Ii8iK2EpO3ZhciBjPXBhKGEpO2IuJCRwYXRoPWRlY29kZVVSSUNvbXBvbmVudChkJiYiLyI9PT1jLnBhdGhuYW1lLmNoYXJBdCgwKT9jLnBhdGhuYW1lLnN1YnN0cmluZygxKTpjLnBhdGhuYW1lKTtiLiQkc2VhcmNoPXpjKGMuc2VhcmNoKTtiLiQkaGFzaD1kZWNvZGVVUklDb21wb25lbnQoYy5oYXNoKTtiLiQkcGF0aCYmIi8iIT1iLiQkcGF0aC5jaGFyQXQoMCkmJihiLiQkcGF0aD0iLyIrYi4kJHBhdGgpfWZ1bmN0aW9uIGxhKGEsYil7aWYoMD09PWIubGFzdEluZGV4T2YoYSwwKSlyZXR1cm4gYi5zdWJzdHIoYS5sZW5ndGgpfWZ1bmN0aW9uIEphKGEpe3ZhciBiPQphLmluZGV4T2YoIiMiKTtyZXR1cm4tMT09Yj9hOmEuc3Vic3RyKDAsYil9ZnVuY3Rpb24gamIoYSl7cmV0dXJuIGEucmVwbGFjZSgvKCMuKyl8IyQvLCIkMSIpfWZ1bmN0aW9uIGdjKGEsYixkKXt0aGlzLiQkaHRtbDU9ITA7ZD1kfHwiIjtqZChhLHRoaXMpO3RoaXMuJCRwYXJzZT1mdW5jdGlvbihhKXt2YXIgZD1sYShiLGEpO2lmKCFJKGQpKXRocm93IEhiKCJpcHRocHJmeCIsYSxiKTtrZChkLHRoaXMpO3RoaXMuJCRwYXRofHwodGhpcy4kJHBhdGg9Ii8iKTt0aGlzLiQkY29tcG9zZSgpfTt0aGlzLiQkY29tcG9zZT1mdW5jdGlvbigpe3ZhciBhPVViKHRoaXMuJCRzZWFyY2gpLGQ9dGhpcy4kJGhhc2g/IiMiK3FiKHRoaXMuJCRoYXNoKToiIjt0aGlzLiQkdXJsPWZjKHRoaXMuJCRwYXRoKSsoYT8iPyIrYToiIikrZDt0aGlzLiQkYWJzVXJsPWIrdGhpcy4kJHVybC5zdWJzdHIoMSl9O3RoaXMuJCRwYXJzZUxpbmtVcmw9ZnVuY3Rpb24oYyxlKXtpZihlJiYiIyI9PT1lWzBdKXJldHVybiB0aGlzLmhhc2goZS5zbGljZSgxKSksCiEwO3ZhciBmLGc7dihmPWxhKGEsYykpPyhnPWYsZz12KGY9bGEoZCxmKSk/YisobGEoIi8iLGYpfHxmKTphK2cpOnYoZj1sYShiLGMpKT9nPWIrZjpiPT1jKyIvIiYmKGc9Yik7ZyYmdGhpcy4kJHBhcnNlKGcpO3JldHVybiEhZ319ZnVuY3Rpb24gaGMoYSxiLGQpe2pkKGEsdGhpcyk7dGhpcy4kJHBhcnNlPWZ1bmN0aW9uKGMpe3ZhciBlPWxhKGEsYyl8fGxhKGIsYyksZjt5KGUpfHwiIyIhPT1lLmNoYXJBdCgwKT90aGlzLiQkaHRtbDU/Zj1lOihmPSIiLHkoZSkmJihhPWMsdGhpcy5yZXBsYWNlKCkpKTooZj1sYShkLGUpLHkoZikmJihmPWUpKTtrZChmLHRoaXMpO2M9dGhpcy4kJHBhdGg7dmFyIGU9YSxnPS9eXC9bQS1aXTooXC8uKikvOzA9PT1mLmxhc3RJbmRleE9mKGUsMCkmJihmPWYucmVwbGFjZShlLCIiKSk7Zy5leGVjKGYpfHwoYz0oZj1nLmV4ZWMoYykpP2ZbMV06Yyk7dGhpcy4kJHBhdGg9Yzt0aGlzLiQkY29tcG9zZSgpfTt0aGlzLiQkY29tcG9zZT1mdW5jdGlvbigpe3ZhciBiPQpVYih0aGlzLiQkc2VhcmNoKSxlPXRoaXMuJCRoYXNoPyIjIitxYih0aGlzLiQkaGFzaCk6IiI7dGhpcy4kJHVybD1mYyh0aGlzLiQkcGF0aCkrKGI/Ij8iK2I6IiIpK2U7dGhpcy4kJGFic1VybD1hKyh0aGlzLiQkdXJsP2QrdGhpcy4kJHVybDoiIil9O3RoaXMuJCRwYXJzZUxpbmtVcmw9ZnVuY3Rpb24oYixkKXtyZXR1cm4gSmEoYSk9PUphKGIpPyh0aGlzLiQkcGFyc2UoYiksITApOiExfX1mdW5jdGlvbiBsZChhLGIsZCl7dGhpcy4kJGh0bWw1PSEwO2hjLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt0aGlzLiQkcGFyc2VMaW5rVXJsPWZ1bmN0aW9uKGMsZSl7aWYoZSYmIiMiPT09ZVswXSlyZXR1cm4gdGhpcy5oYXNoKGUuc2xpY2UoMSkpLCEwO3ZhciBmLGc7YT09SmEoYyk/Zj1jOihnPWxhKGIsYykpP2Y9YStkK2c6Yj09PWMrIi8iJiYoZj1iKTtmJiZ0aGlzLiQkcGFyc2UoZik7cmV0dXJuISFmfTt0aGlzLiQkY29tcG9zZT1mdW5jdGlvbigpe3ZhciBiPVViKHRoaXMuJCRzZWFyY2gpLAplPXRoaXMuJCRoYXNoPyIjIitxYih0aGlzLiQkaGFzaCk6IiI7dGhpcy4kJHVybD1mYyh0aGlzLiQkcGF0aCkrKGI/Ij8iK2I6IiIpK2U7dGhpcy4kJGFic1VybD1hK2QrdGhpcy4kJHVybH19ZnVuY3Rpb24gSWIoYSl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXNbYV19fWZ1bmN0aW9uIG1kKGEsYil7cmV0dXJuIGZ1bmN0aW9uKGQpe2lmKHkoZCkpcmV0dXJuIHRoaXNbYV07dGhpc1thXT1iKGQpO3RoaXMuJCRjb21wb3NlKCk7cmV0dXJuIHRoaXN9fWZ1bmN0aW9uIHJmKCl7dmFyIGE9IiIsYj17ZW5hYmxlZDohMSxyZXF1aXJlQmFzZTohMCxyZXdyaXRlTGlua3M6ITB9O3RoaXMuaGFzaFByZWZpeD1mdW5jdGlvbihiKXtyZXR1cm4gdihiKT8oYT1iLHRoaXMpOmF9O3RoaXMuaHRtbDVNb2RlPWZ1bmN0aW9uKGEpe3JldHVybiBFYShhKT8oYi5lbmFibGVkPWEsdGhpcyk6SihhKT8oRWEoYS5lbmFibGVkKSYmKGIuZW5hYmxlZD1hLmVuYWJsZWQpLEVhKGEucmVxdWlyZUJhc2UpJiYKKGIucmVxdWlyZUJhc2U9YS5yZXF1aXJlQmFzZSksRWEoYS5yZXdyaXRlTGlua3MpJiYoYi5yZXdyaXRlTGlua3M9YS5yZXdyaXRlTGlua3MpLHRoaXMpOmJ9O3RoaXMuJGdldD1bIiRyb290U2NvcGUiLCIkYnJvd3NlciIsIiRzbmlmZmVyIiwiJHJvb3RFbGVtZW50IiwiJHdpbmRvdyIsZnVuY3Rpb24oZCxjLGUsZixnKXtmdW5jdGlvbiBoKGEsYixkKXt2YXIgZT1sLnVybCgpLGY9bC4kJHN0YXRlO3RyeXtjLnVybChhLGIsZCksbC4kJHN0YXRlPWMuc3RhdGUoKX1jYXRjaChnKXt0aHJvdyBsLnVybChlKSxsLiQkc3RhdGU9ZixnO319ZnVuY3Rpb24gayhhLGIpe2QuJGJyb2FkY2FzdCgiJGxvY2F0aW9uQ2hhbmdlU3VjY2VzcyIsbC5hYnNVcmwoKSxhLGwuJCRzdGF0ZSxiKX12YXIgbCxtO209Yy5iYXNlSHJlZigpO3ZhciBuPWMudXJsKCkscDtpZihiLmVuYWJsZWQpe2lmKCFtJiZiLnJlcXVpcmVCYXNlKXRocm93IEhiKCJub2Jhc2UiKTtwPW4uc3Vic3RyaW5nKDAsbi5pbmRleE9mKCIvIiwKbi5pbmRleE9mKCIvLyIpKzIpKSsobXx8Ii8iKTttPWUuaGlzdG9yeT9nYzpsZH1lbHNlIHA9SmEobiksbT1oYzt2YXIgeD1wLnN1YnN0cigwLEphKHApLmxhc3RJbmRleE9mKCIvIikrMSk7bD1uZXcgbShwLHgsIiMiK2EpO2wuJCRwYXJzZUxpbmtVcmwobixuKTtsLiQkc3RhdGU9Yy5zdGF0ZSgpO3ZhciBxPS9eXHMqKGphdmFzY3JpcHR8bWFpbHRvKTovaTtmLm9uKCJjbGljayIsZnVuY3Rpb24oYSl7aWYoYi5yZXdyaXRlTGlua3MmJiFhLmN0cmxLZXkmJiFhLm1ldGFLZXkmJiFhLnNoaWZ0S2V5JiYyIT1hLndoaWNoJiYyIT1hLmJ1dHRvbil7Zm9yKHZhciBlPUcoYS50YXJnZXQpOyJhIiE9PXRhKGVbMF0pOylpZihlWzBdPT09ZlswXXx8IShlPWUucGFyZW50KCkpWzBdKXJldHVybjt2YXIgaD1lLnByb3AoImhyZWYiKSxrPWUuYXR0cigiaHJlZiIpfHxlLmF0dHIoInhsaW5rOmhyZWYiKTtKKGgpJiYiW29iamVjdCBTVkdBbmltYXRlZFN0cmluZ10iPT09aC50b1N0cmluZygpJiYoaD0KcGEoaC5hbmltVmFsKS5ocmVmKTtxLnRlc3QoaCl8fCFofHxlLmF0dHIoInRhcmdldCIpfHxhLmlzRGVmYXVsdFByZXZlbnRlZCgpfHwhbC4kJHBhcnNlTGlua1VybChoLGspfHwoYS5wcmV2ZW50RGVmYXVsdCgpLGwuYWJzVXJsKCkhPWMudXJsKCkmJihkLiRhcHBseSgpLGcuYW5ndWxhclsiZmYtNjg0MjA4LXByZXZlbnREZWZhdWx0Il09ITApKX19KTtqYihsLmFic1VybCgpKSE9amIobikmJmMudXJsKGwuYWJzVXJsKCksITApO3ZhciB6PSEwO2Mub25VcmxDaGFuZ2UoZnVuY3Rpb24oYSxiKXt5KGxhKHgsYSkpP2cubG9jYXRpb24uaHJlZj1hOihkLiRldmFsQXN5bmMoZnVuY3Rpb24oKXt2YXIgYz1sLmFic1VybCgpLGU9bC4kJHN0YXRlLGY7YT1qYihhKTtsLiQkcGFyc2UoYSk7bC4kJHN0YXRlPWI7Zj1kLiRicm9hZGNhc3QoIiRsb2NhdGlvbkNoYW5nZVN0YXJ0IixhLGMsYixlKS5kZWZhdWx0UHJldmVudGVkO2wuYWJzVXJsKCk9PT1hJiYoZj8obC4kJHBhcnNlKGMpLGwuJCRzdGF0ZT0KZSxoKGMsITEsZSkpOih6PSExLGsoYyxlKSkpfSksZC4kJHBoYXNlfHxkLiRkaWdlc3QoKSl9KTtkLiR3YXRjaChmdW5jdGlvbigpe3ZhciBhPWpiKGMudXJsKCkpLGI9amIobC5hYnNVcmwoKSksZj1jLnN0YXRlKCksZz1sLiQkcmVwbGFjZSxtPWEhPT1ifHxsLiQkaHRtbDUmJmUuaGlzdG9yeSYmZiE9PWwuJCRzdGF0ZTtpZih6fHxtKXo9ITEsZC4kZXZhbEFzeW5jKGZ1bmN0aW9uKCl7dmFyIGI9bC5hYnNVcmwoKSxjPWQuJGJyb2FkY2FzdCgiJGxvY2F0aW9uQ2hhbmdlU3RhcnQiLGIsYSxsLiQkc3RhdGUsZikuZGVmYXVsdFByZXZlbnRlZDtsLmFic1VybCgpPT09YiYmKGM/KGwuJCRwYXJzZShhKSxsLiQkc3RhdGU9Zik6KG0mJmgoYixnLGY9PT1sLiQkc3RhdGU/bnVsbDpsLiQkc3RhdGUpLGsoYSxmKSkpfSk7bC4kJHJlcGxhY2U9ITF9KTtyZXR1cm4gbH1dfWZ1bmN0aW9uIHNmKCl7dmFyIGE9ITAsYj10aGlzO3RoaXMuZGVidWdFbmFibGVkPWZ1bmN0aW9uKGIpe3JldHVybiB2KGIpPwooYT1iLHRoaXMpOmF9O3RoaXMuJGdldD1bIiR3aW5kb3ciLGZ1bmN0aW9uKGQpe2Z1bmN0aW9uIGMoYSl7YSBpbnN0YW5jZW9mIEVycm9yJiYoYS5zdGFjaz9hPWEubWVzc2FnZSYmLTE9PT1hLnN0YWNrLmluZGV4T2YoYS5tZXNzYWdlKT8iRXJyb3I6ICIrYS5tZXNzYWdlKyJcbiIrYS5zdGFjazphLnN0YWNrOmEuc291cmNlVVJMJiYoYT1hLm1lc3NhZ2UrIlxuIithLnNvdXJjZVVSTCsiOiIrYS5saW5lKSk7cmV0dXJuIGF9ZnVuY3Rpb24gZShhKXt2YXIgYj1kLmNvbnNvbGV8fHt9LGU9YlthXXx8Yi5sb2d8fEM7YT0hMTt0cnl7YT0hIWUuYXBwbHl9Y2F0Y2goayl7fXJldHVybiBhP2Z1bmN0aW9uKCl7dmFyIGE9W107cShhcmd1bWVudHMsZnVuY3Rpb24oYil7YS5wdXNoKGMoYikpfSk7cmV0dXJuIGUuYXBwbHkoYixhKX06ZnVuY3Rpb24oYSxiKXtlKGEsbnVsbD09Yj8iIjpiKX19cmV0dXJue2xvZzplKCJsb2ciKSxpbmZvOmUoImluZm8iKSx3YXJuOmUoIndhcm4iKSxlcnJvcjplKCJlcnJvciIpLApkZWJ1ZzpmdW5jdGlvbigpe3ZhciBjPWUoImRlYnVnIik7cmV0dXJuIGZ1bmN0aW9uKCl7YSYmYy5hcHBseShiLGFyZ3VtZW50cyl9fSgpfX1dfWZ1bmN0aW9uIFVhKGEsYil7aWYoIl9fZGVmaW5lR2V0dGVyX18iPT09YXx8Il9fZGVmaW5lU2V0dGVyX18iPT09YXx8Il9fbG9va3VwR2V0dGVyX18iPT09YXx8Il9fbG9va3VwU2V0dGVyX18iPT09YXx8Il9fcHJvdG9fXyI9PT1hKXRocm93IGJhKCJpc2VjZmxkIixiKTtyZXR1cm4gYX1mdW5jdGlvbiBoZyhhKXtyZXR1cm4gYSsiIn1mdW5jdGlvbiBxYShhLGIpe2lmKGEpe2lmKGEuY29uc3RydWN0b3I9PT1hKXRocm93IGJhKCJpc2VjZm4iLGIpO2lmKGEud2luZG93PT09YSl0aHJvdyBiYSgiaXNlY3dpbmRvdyIsYik7aWYoYS5jaGlsZHJlbiYmKGEubm9kZU5hbWV8fGEucHJvcCYmYS5hdHRyJiZhLmZpbmQpKXRocm93IGJhKCJpc2VjZG9tIixiKTtpZihhPT09T2JqZWN0KXRocm93IGJhKCJpc2Vjb2JqIixiKTt9cmV0dXJuIGF9ZnVuY3Rpb24gbmQoYSwKYil7aWYoYSl7aWYoYS5jb25zdHJ1Y3Rvcj09PWEpdGhyb3cgYmEoImlzZWNmbiIsYik7aWYoYT09PWlnfHxhPT09amd8fGE9PT1rZyl0aHJvdyBiYSgiaXNlY2ZmIixiKTt9fWZ1bmN0aW9uIEpiKGEsYil7aWYoYSYmKGE9PT0oMCkuY29uc3RydWN0b3J8fGE9PT0oITEpLmNvbnN0cnVjdG9yfHxhPT09IiIuY29uc3RydWN0b3J8fGE9PT17fS5jb25zdHJ1Y3Rvcnx8YT09PVtdLmNvbnN0cnVjdG9yfHxhPT09RnVuY3Rpb24uY29uc3RydWN0b3IpKXRocm93IGJhKCJpc2VjYWYiLGIpO31mdW5jdGlvbiBsZyhhLGIpe3JldHVybiJ1bmRlZmluZWQiIT09dHlwZW9mIGE/YTpifWZ1bmN0aW9uIG9kKGEsYil7cmV0dXJuInVuZGVmaW5lZCI9PT10eXBlb2YgYT9iOiJ1bmRlZmluZWQiPT09dHlwZW9mIGI/YTphK2J9ZnVuY3Rpb24gWihhLGIpe3ZhciBkLGM7c3dpdGNoKGEudHlwZSl7Y2FzZSBzLlByb2dyYW06ZD0hMDtxKGEuYm9keSxmdW5jdGlvbihhKXtaKGEuZXhwcmVzc2lvbixiKTtkPQpkJiZhLmV4cHJlc3Npb24uY29uc3RhbnR9KTthLmNvbnN0YW50PWQ7YnJlYWs7Y2FzZSBzLkxpdGVyYWw6YS5jb25zdGFudD0hMDthLnRvV2F0Y2g9W107YnJlYWs7Y2FzZSBzLlVuYXJ5RXhwcmVzc2lvbjpaKGEuYXJndW1lbnQsYik7YS5jb25zdGFudD1hLmFyZ3VtZW50LmNvbnN0YW50O2EudG9XYXRjaD1hLmFyZ3VtZW50LnRvV2F0Y2g7YnJlYWs7Y2FzZSBzLkJpbmFyeUV4cHJlc3Npb246WihhLmxlZnQsYik7WihhLnJpZ2h0LGIpO2EuY29uc3RhbnQ9YS5sZWZ0LmNvbnN0YW50JiZhLnJpZ2h0LmNvbnN0YW50O2EudG9XYXRjaD1hLmxlZnQudG9XYXRjaC5jb25jYXQoYS5yaWdodC50b1dhdGNoKTticmVhaztjYXNlIHMuTG9naWNhbEV4cHJlc3Npb246WihhLmxlZnQsYik7WihhLnJpZ2h0LGIpO2EuY29uc3RhbnQ9YS5sZWZ0LmNvbnN0YW50JiZhLnJpZ2h0LmNvbnN0YW50O2EudG9XYXRjaD1hLmNvbnN0YW50P1tdOlthXTticmVhaztjYXNlIHMuQ29uZGl0aW9uYWxFeHByZXNzaW9uOlooYS50ZXN0LApiKTtaKGEuYWx0ZXJuYXRlLGIpO1ooYS5jb25zZXF1ZW50LGIpO2EuY29uc3RhbnQ9YS50ZXN0LmNvbnN0YW50JiZhLmFsdGVybmF0ZS5jb25zdGFudCYmYS5jb25zZXF1ZW50LmNvbnN0YW50O2EudG9XYXRjaD1hLmNvbnN0YW50P1tdOlthXTticmVhaztjYXNlIHMuSWRlbnRpZmllcjphLmNvbnN0YW50PSExO2EudG9XYXRjaD1bYV07YnJlYWs7Y2FzZSBzLk1lbWJlckV4cHJlc3Npb246WihhLm9iamVjdCxiKTthLmNvbXB1dGVkJiZaKGEucHJvcGVydHksYik7YS5jb25zdGFudD1hLm9iamVjdC5jb25zdGFudCYmKCFhLmNvbXB1dGVkfHxhLnByb3BlcnR5LmNvbnN0YW50KTthLnRvV2F0Y2g9W2FdO2JyZWFrO2Nhc2Ugcy5DYWxsRXhwcmVzc2lvbjpkPWEuZmlsdGVyPyFiKGEuY2FsbGVlLm5hbWUpLiRzdGF0ZWZ1bDohMTtjPVtdO3EoYS5hcmd1bWVudHMsZnVuY3Rpb24oYSl7WihhLGIpO2Q9ZCYmYS5jb25zdGFudDthLmNvbnN0YW50fHxjLnB1c2guYXBwbHkoYyxhLnRvV2F0Y2gpfSk7CmEuY29uc3RhbnQ9ZDthLnRvV2F0Y2g9YS5maWx0ZXImJiFiKGEuY2FsbGVlLm5hbWUpLiRzdGF0ZWZ1bD9jOlthXTticmVhaztjYXNlIHMuQXNzaWdubWVudEV4cHJlc3Npb246WihhLmxlZnQsYik7WihhLnJpZ2h0LGIpO2EuY29uc3RhbnQ9YS5sZWZ0LmNvbnN0YW50JiZhLnJpZ2h0LmNvbnN0YW50O2EudG9XYXRjaD1bYV07YnJlYWs7Y2FzZSBzLkFycmF5RXhwcmVzc2lvbjpkPSEwO2M9W107cShhLmVsZW1lbnRzLGZ1bmN0aW9uKGEpe1ooYSxiKTtkPWQmJmEuY29uc3RhbnQ7YS5jb25zdGFudHx8Yy5wdXNoLmFwcGx5KGMsYS50b1dhdGNoKX0pO2EuY29uc3RhbnQ9ZDthLnRvV2F0Y2g9YzticmVhaztjYXNlIHMuT2JqZWN0RXhwcmVzc2lvbjpkPSEwO2M9W107cShhLnByb3BlcnRpZXMsZnVuY3Rpb24oYSl7WihhLnZhbHVlLGIpO2Q9ZCYmYS52YWx1ZS5jb25zdGFudCYmIWEuY29tcHV0ZWQ7YS52YWx1ZS5jb25zdGFudHx8Yy5wdXNoLmFwcGx5KGMsYS52YWx1ZS50b1dhdGNoKX0pOwphLmNvbnN0YW50PWQ7YS50b1dhdGNoPWM7YnJlYWs7Y2FzZSBzLlRoaXNFeHByZXNzaW9uOmEuY29uc3RhbnQ9ITE7YS50b1dhdGNoPVtdO2JyZWFrO2Nhc2Ugcy5Mb2NhbHNFeHByZXNzaW9uOmEuY29uc3RhbnQ9ITEsYS50b1dhdGNoPVtdfX1mdW5jdGlvbiBwZChhKXtpZigxPT1hLmxlbmd0aCl7YT1hWzBdLmV4cHJlc3Npb247dmFyIGI9YS50b1dhdGNoO3JldHVybiAxIT09Yi5sZW5ndGg/YjpiWzBdIT09YT9iOnZvaWQgMH19ZnVuY3Rpb24gcWQoYSl7cmV0dXJuIGEudHlwZT09PXMuSWRlbnRpZmllcnx8YS50eXBlPT09cy5NZW1iZXJFeHByZXNzaW9ufWZ1bmN0aW9uIHJkKGEpe2lmKDE9PT1hLmJvZHkubGVuZ3RoJiZxZChhLmJvZHlbMF0uZXhwcmVzc2lvbikpcmV0dXJue3R5cGU6cy5Bc3NpZ25tZW50RXhwcmVzc2lvbixsZWZ0OmEuYm9keVswXS5leHByZXNzaW9uLHJpZ2h0Ont0eXBlOnMuTkdWYWx1ZVBhcmFtZXRlcn0sb3BlcmF0b3I6Ij0ifX1mdW5jdGlvbiBzZChhKXtyZXR1cm4gMD09PQphLmJvZHkubGVuZ3RofHwxPT09YS5ib2R5Lmxlbmd0aCYmKGEuYm9keVswXS5leHByZXNzaW9uLnR5cGU9PT1zLkxpdGVyYWx8fGEuYm9keVswXS5leHByZXNzaW9uLnR5cGU9PT1zLkFycmF5RXhwcmVzc2lvbnx8YS5ib2R5WzBdLmV4cHJlc3Npb24udHlwZT09PXMuT2JqZWN0RXhwcmVzc2lvbil9ZnVuY3Rpb24gdGQoYSxiKXt0aGlzLmFzdEJ1aWxkZXI9YTt0aGlzLiRmaWx0ZXI9Yn1mdW5jdGlvbiB1ZChhLGIpe3RoaXMuYXN0QnVpbGRlcj1hO3RoaXMuJGZpbHRlcj1ifWZ1bmN0aW9uIEtiKGEpe3JldHVybiJjb25zdHJ1Y3RvciI9PWF9ZnVuY3Rpb24gaWMoYSl7cmV0dXJuIEUoYS52YWx1ZU9mKT9hLnZhbHVlT2YoKTptZy5jYWxsKGEpfWZ1bmN0aW9uIHRmKCl7dmFyIGE9UygpLGI9UygpLGQ9eyJ0cnVlIjohMCwiZmFsc2UiOiExLCJudWxsIjpudWxsLHVuZGVmaW5lZDp2b2lkIDB9LGMsZTt0aGlzLmFkZExpdGVyYWw9ZnVuY3Rpb24oYSxiKXtkW2FdPWJ9O3RoaXMuc2V0SWRlbnRpZmllckZucz0KZnVuY3Rpb24oYSxiKXtjPWE7ZT1iO3JldHVybiB0aGlzfTt0aGlzLiRnZXQ9WyIkZmlsdGVyIixmdW5jdGlvbihmKXtmdW5jdGlvbiBnKGMsZCxlKXt2YXIgZyxrLEE7ZT1lfHxEO3N3aXRjaCh0eXBlb2YgYyl7Y2FzZSAic3RyaW5nIjpBPWM9Yy50cmltKCk7dmFyIEg9ZT9iOmE7Zz1IW0FdO2lmKCFnKXsiOiI9PT1jLmNoYXJBdCgwKSYmIjoiPT09Yy5jaGFyQXQoMSkmJihrPSEwLGM9Yy5zdWJzdHJpbmcoMikpO2c9ZT9yOno7dmFyIHE9bmV3IGpjKGcpO2c9KG5ldyBrYyhxLGYsZykpLnBhcnNlKGMpO2cuY29uc3RhbnQ/Zy4kJHdhdGNoRGVsZWdhdGU9cDprP2cuJCR3YXRjaERlbGVnYXRlPWcubGl0ZXJhbD9uOm06Zy5pbnB1dHMmJihnLiQkd2F0Y2hEZWxlZ2F0ZT1sKTtlJiYoZz1oKGcpKTtIW0FdPWd9cmV0dXJuIHgoZyxkKTtjYXNlICJmdW5jdGlvbiI6cmV0dXJuIHgoYyxkKTtkZWZhdWx0OnJldHVybiB4KEMsZCl9fWZ1bmN0aW9uIGgoYSl7ZnVuY3Rpb24gYihjLGQsZSxmKXt2YXIgZz0KRDtEPSEwO3RyeXtyZXR1cm4gYShjLGQsZSxmKX1maW5hbGx5e0Q9Z319aWYoIWEpcmV0dXJuIGE7Yi4kJHdhdGNoRGVsZWdhdGU9YS4kJHdhdGNoRGVsZWdhdGU7Yi5hc3NpZ249aChhLmFzc2lnbik7Yi5jb25zdGFudD1hLmNvbnN0YW50O2IubGl0ZXJhbD1hLmxpdGVyYWw7Zm9yKHZhciBjPTA7YS5pbnB1dHMmJmM8YS5pbnB1dHMubGVuZ3RoOysrYylhLmlucHV0c1tjXT1oKGEuaW5wdXRzW2NdKTtiLmlucHV0cz1hLmlucHV0cztyZXR1cm4gYn1mdW5jdGlvbiBrKGEsYil7cmV0dXJuIG51bGw9PWF8fG51bGw9PWI/YT09PWI6Im9iamVjdCI9PT10eXBlb2YgYSYmKGE9aWMoYSksIm9iamVjdCI9PT10eXBlb2YgYSk/ITE6YT09PWJ8fGEhPT1hJiZiIT09Yn1mdW5jdGlvbiBsKGEsYixjLGQsZSl7dmFyIGY9ZC5pbnB1dHMsZztpZigxPT09Zi5sZW5ndGgpe3ZhciBoPWssZj1mWzBdO3JldHVybiBhLiR3YXRjaChmdW5jdGlvbihhKXt2YXIgYj1mKGEpO2soYixoKXx8KGc9ZChhLHZvaWQgMCwKdm9pZCAwLFtiXSksaD1iJiZpYyhiKSk7cmV0dXJuIGd9LGIsYyxlKX1mb3IodmFyIGw9W10sbT1bXSxuPTAscD1mLmxlbmd0aDtuPHA7bisrKWxbbl09ayxtW25dPW51bGw7cmV0dXJuIGEuJHdhdGNoKGZ1bmN0aW9uKGEpe2Zvcih2YXIgYj0hMSxjPTAsZT1mLmxlbmd0aDtjPGU7YysrKXt2YXIgaD1mW2NdKGEpO2lmKGJ8fChiPSFrKGgsbFtjXSkpKW1bY109aCxsW2NdPWgmJmljKGgpfWImJihnPWQoYSx2b2lkIDAsdm9pZCAwLG0pKTtyZXR1cm4gZ30sYixjLGUpfWZ1bmN0aW9uIG0oYSxiLGMsZCl7dmFyIGUsZjtyZXR1cm4gZT1hLiR3YXRjaChmdW5jdGlvbihhKXtyZXR1cm4gZChhKX0sZnVuY3Rpb24oYSxjLGQpe2Y9YTtFKGIpJiZiLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt2KGEpJiZkLiQkcG9zdERpZ2VzdChmdW5jdGlvbigpe3YoZikmJmUoKX0pfSxjKX1mdW5jdGlvbiBuKGEsYixjLGQpe2Z1bmN0aW9uIGUoYSl7dmFyIGI9ITA7cShhLGZ1bmN0aW9uKGEpe3YoYSl8fChiPQohMSl9KTtyZXR1cm4gYn12YXIgZixnO3JldHVybiBmPWEuJHdhdGNoKGZ1bmN0aW9uKGEpe3JldHVybiBkKGEpfSxmdW5jdGlvbihhLGMsZCl7Zz1hO0UoYikmJmIuY2FsbCh0aGlzLGEsYyxkKTtlKGEpJiZkLiQkcG9zdERpZ2VzdChmdW5jdGlvbigpe2UoZykmJmYoKX0pfSxjKX1mdW5jdGlvbiBwKGEsYixjLGQpe3ZhciBlO3JldHVybiBlPWEuJHdhdGNoKGZ1bmN0aW9uKGEpe2UoKTtyZXR1cm4gZChhKX0sYixjKX1mdW5jdGlvbiB4KGEsYil7aWYoIWIpcmV0dXJuIGE7dmFyIGM9YS4kJHdhdGNoRGVsZWdhdGUsZD0hMSxjPWMhPT1uJiZjIT09bT9mdW5jdGlvbihjLGUsZixnKXtmPWQmJmc/Z1swXTphKGMsZSxmLGcpO3JldHVybiBiKGYsYyxlKX06ZnVuY3Rpb24oYyxkLGUsZil7ZT1hKGMsZCxlLGYpO2M9YihlLGMsZCk7cmV0dXJuIHYoZSk/YzplfTthLiQkd2F0Y2hEZWxlZ2F0ZSYmYS4kJHdhdGNoRGVsZWdhdGUhPT1sP2MuJCR3YXRjaERlbGVnYXRlPWEuJCR3YXRjaERlbGVnYXRlOgpiLiRzdGF0ZWZ1bHx8KGMuJCR3YXRjaERlbGVnYXRlPWwsZD0hYS5pbnB1dHMsYy5pbnB1dHM9YS5pbnB1dHM/YS5pbnB1dHM6W2FdKTtyZXR1cm4gY312YXIgVT1GYSgpLm5vVW5zYWZlRXZhbCx6PXtjc3A6VSxleHBlbnNpdmVDaGVja3M6ITEsbGl0ZXJhbHM6b2EoZCksaXNJZGVudGlmaWVyU3RhcnQ6RShjKSYmYyxpc0lkZW50aWZpZXJDb250aW51ZTpFKGUpJiZlfSxyPXtjc3A6VSxleHBlbnNpdmVDaGVja3M6ITAsbGl0ZXJhbHM6b2EoZCksaXNJZGVudGlmaWVyU3RhcnQ6RShjKSYmYyxpc0lkZW50aWZpZXJDb250aW51ZTpFKGUpJiZlfSxEPSExO2cuJCRydW5uaW5nRXhwZW5zaXZlQ2hlY2tzPWZ1bmN0aW9uKCl7cmV0dXJuIER9O3JldHVybiBnfV19ZnVuY3Rpb24gdmYoKXt0aGlzLiRnZXQ9WyIkcm9vdFNjb3BlIiwiJGV4Y2VwdGlvbkhhbmRsZXIiLGZ1bmN0aW9uKGEsYil7cmV0dXJuIHZkKGZ1bmN0aW9uKGIpe2EuJGV2YWxBc3luYyhiKX0sYil9XX1mdW5jdGlvbiB3Zigpe3RoaXMuJGdldD0KWyIkYnJvd3NlciIsIiRleGNlcHRpb25IYW5kbGVyIixmdW5jdGlvbihhLGIpe3JldHVybiB2ZChmdW5jdGlvbihiKXthLmRlZmVyKGIpfSxiKX1dfWZ1bmN0aW9uIHZkKGEsYil7ZnVuY3Rpb24gZCgpe3RoaXMuJCRzdGF0ZT17c3RhdHVzOjB9fWZ1bmN0aW9uIGMoYSxiKXtyZXR1cm4gZnVuY3Rpb24oYyl7Yi5jYWxsKGEsYyl9fWZ1bmN0aW9uIGUoYyl7IWMucHJvY2Vzc1NjaGVkdWxlZCYmYy5wZW5kaW5nJiYoYy5wcm9jZXNzU2NoZWR1bGVkPSEwLGEoZnVuY3Rpb24oKXt2YXIgYSxkLGU7ZT1jLnBlbmRpbmc7Yy5wcm9jZXNzU2NoZWR1bGVkPSExO2MucGVuZGluZz12b2lkIDA7Zm9yKHZhciBmPTAsZz1lLmxlbmd0aDtmPGc7KytmKXtkPWVbZl1bMF07YT1lW2ZdW2Muc3RhdHVzXTt0cnl7RShhKT9kLnJlc29sdmUoYShjLnZhbHVlKSk6MT09PWMuc3RhdHVzP2QucmVzb2x2ZShjLnZhbHVlKTpkLnJlamVjdChjLnZhbHVlKX1jYXRjaChoKXtkLnJlamVjdChoKSxiKGgpfX19KSl9CmZ1bmN0aW9uIGYoKXt0aGlzLnByb21pc2U9bmV3IGR9dmFyIGc9TygiJHEiLFR5cGVFcnJvcik7UChkLnByb3RvdHlwZSx7dGhlbjpmdW5jdGlvbihhLGIsYyl7aWYoeShhKSYmeShiKSYmeShjKSlyZXR1cm4gdGhpczt2YXIgZD1uZXcgZjt0aGlzLiQkc3RhdGUucGVuZGluZz10aGlzLiQkc3RhdGUucGVuZGluZ3x8W107dGhpcy4kJHN0YXRlLnBlbmRpbmcucHVzaChbZCxhLGIsY10pOzA8dGhpcy4kJHN0YXRlLnN0YXR1cyYmZSh0aGlzLiQkc3RhdGUpO3JldHVybiBkLnByb21pc2V9LCJjYXRjaCI6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMudGhlbihudWxsLGEpfSwiZmluYWxseSI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy50aGVuKGZ1bmN0aW9uKGIpe3JldHVybiBrKGIsITAsYSl9LGZ1bmN0aW9uKGIpe3JldHVybiBrKGIsITEsYSl9LGIpfX0pO1AoZi5wcm90b3R5cGUse3Jlc29sdmU6ZnVuY3Rpb24oYSl7dGhpcy5wcm9taXNlLiQkc3RhdGUuc3RhdHVzfHwoYT09PXRoaXMucHJvbWlzZT8KdGhpcy4kJHJlamVjdChnKCJxY3ljbGUiLGEpKTp0aGlzLiQkcmVzb2x2ZShhKSl9LCQkcmVzb2x2ZTpmdW5jdGlvbihhKXtmdW5jdGlvbiBkKGEpe2t8fChrPSEwLGguJCRyZXNvbHZlKGEpKX1mdW5jdGlvbiBmKGEpe2t8fChrPSEwLGguJCRyZWplY3QoYSkpfXZhciBnLGg9dGhpcyxrPSExO3RyeXtpZihKKGEpfHxFKGEpKWc9YSYmYS50aGVuO0UoZyk/KHRoaXMucHJvbWlzZS4kJHN0YXRlLnN0YXR1cz0tMSxnLmNhbGwoYSxkLGYsYyh0aGlzLHRoaXMubm90aWZ5KSkpOih0aGlzLnByb21pc2UuJCRzdGF0ZS52YWx1ZT1hLHRoaXMucHJvbWlzZS4kJHN0YXRlLnN0YXR1cz0xLGUodGhpcy5wcm9taXNlLiQkc3RhdGUpKX1jYXRjaChsKXtmKGwpLGIobCl9fSxyZWplY3Q6ZnVuY3Rpb24oYSl7dGhpcy5wcm9taXNlLiQkc3RhdGUuc3RhdHVzfHx0aGlzLiQkcmVqZWN0KGEpfSwkJHJlamVjdDpmdW5jdGlvbihhKXt0aGlzLnByb21pc2UuJCRzdGF0ZS52YWx1ZT1hO3RoaXMucHJvbWlzZS4kJHN0YXRlLnN0YXR1cz0KMjtlKHRoaXMucHJvbWlzZS4kJHN0YXRlKX0sbm90aWZ5OmZ1bmN0aW9uKGMpe3ZhciBkPXRoaXMucHJvbWlzZS4kJHN0YXRlLnBlbmRpbmc7MD49dGhpcy5wcm9taXNlLiQkc3RhdGUuc3RhdHVzJiZkJiZkLmxlbmd0aCYmYShmdW5jdGlvbigpe2Zvcih2YXIgYSxlLGY9MCxnPWQubGVuZ3RoO2Y8ZztmKyspe2U9ZFtmXVswXTthPWRbZl1bM107dHJ5e2Uubm90aWZ5KEUoYSk/YShjKTpjKX1jYXRjaChoKXtiKGgpfX19KX19KTt2YXIgaD1mdW5jdGlvbihhLGIpe3ZhciBjPW5ldyBmO2I/Yy5yZXNvbHZlKGEpOmMucmVqZWN0KGEpO3JldHVybiBjLnByb21pc2V9LGs9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPW51bGw7dHJ5e0UoYykmJihkPWMoKSl9Y2F0Y2goZSl7cmV0dXJuIGgoZSwhMSl9cmV0dXJuIGQmJkUoZC50aGVuKT9kLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gaChhLGIpfSxmdW5jdGlvbihhKXtyZXR1cm4gaChhLCExKX0pOmgoYSxiKX0sbD1mdW5jdGlvbihhLGIsYyxkKXt2YXIgZT0KbmV3IGY7ZS5yZXNvbHZlKGEpO3JldHVybiBlLnByb21pc2UudGhlbihiLGMsZCl9LG09ZnVuY3Rpb24oYSl7aWYoIUUoYSkpdGhyb3cgZygibm9yc2x2ciIsYSk7dmFyIGI9bmV3IGY7YShmdW5jdGlvbihhKXtiLnJlc29sdmUoYSl9LGZ1bmN0aW9uKGEpe2IucmVqZWN0KGEpfSk7cmV0dXJuIGIucHJvbWlzZX07bS5wcm90b3R5cGU9ZC5wcm90b3R5cGU7bS5kZWZlcj1mdW5jdGlvbigpe3ZhciBhPW5ldyBmO2EucmVzb2x2ZT1jKGEsYS5yZXNvbHZlKTthLnJlamVjdD1jKGEsYS5yZWplY3QpO2Eubm90aWZ5PWMoYSxhLm5vdGlmeSk7cmV0dXJuIGF9O20ucmVqZWN0PWZ1bmN0aW9uKGEpe3ZhciBiPW5ldyBmO2IucmVqZWN0KGEpO3JldHVybiBiLnByb21pc2V9O20ud2hlbj1sO20ucmVzb2x2ZT1sO20uYWxsPWZ1bmN0aW9uKGEpe3ZhciBiPW5ldyBmLGM9MCxkPUsoYSk/W106e307cShhLGZ1bmN0aW9uKGEsZSl7YysrO2woYSkudGhlbihmdW5jdGlvbihhKXtkLmhhc093blByb3BlcnR5KGUpfHwKKGRbZV09YSwtLWN8fGIucmVzb2x2ZShkKSl9LGZ1bmN0aW9uKGEpe2QuaGFzT3duUHJvcGVydHkoZSl8fGIucmVqZWN0KGEpfSl9KTswPT09YyYmYi5yZXNvbHZlKGQpO3JldHVybiBiLnByb21pc2V9O3JldHVybiBtfWZ1bmN0aW9uIEZmKCl7dGhpcy4kZ2V0PVsiJHdpbmRvdyIsIiR0aW1lb3V0IixmdW5jdGlvbihhLGIpe3ZhciBkPWEucmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxhLndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSxjPWEuY2FuY2VsQW5pbWF0aW9uRnJhbWV8fGEud2Via2l0Q2FuY2VsQW5pbWF0aW9uRnJhbWV8fGEud2Via2l0Q2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lLGU9ISFkLGY9ZT9mdW5jdGlvbihhKXt2YXIgYj1kKGEpO3JldHVybiBmdW5jdGlvbigpe2MoYil9fTpmdW5jdGlvbihhKXt2YXIgYz1iKGEsMTYuNjYsITEpO3JldHVybiBmdW5jdGlvbigpe2IuY2FuY2VsKGMpfX07Zi5zdXBwb3J0ZWQ9ZTtyZXR1cm4gZn1dfWZ1bmN0aW9uIHVmKCl7ZnVuY3Rpb24gYShhKXtmdW5jdGlvbiBiKCl7dGhpcy4kJHdhdGNoZXJzPQp0aGlzLiQkbmV4dFNpYmxpbmc9dGhpcy4kJGNoaWxkSGVhZD10aGlzLiQkY2hpbGRUYWlsPW51bGw7dGhpcy4kJGxpc3RlbmVycz17fTt0aGlzLiQkbGlzdGVuZXJDb3VudD17fTt0aGlzLiQkd2F0Y2hlcnNDb3VudD0wO3RoaXMuJGlkPSsrcGI7dGhpcy4kJENoaWxkU2NvcGU9bnVsbH1iLnByb3RvdHlwZT1hO3JldHVybiBifXZhciBiPTEwLGQ9TygiJHJvb3RTY29wZSIpLGM9bnVsbCxlPW51bGw7dGhpcy5kaWdlc3RUdGw9ZnVuY3Rpb24oYSl7YXJndW1lbnRzLmxlbmd0aCYmKGI9YSk7cmV0dXJuIGJ9O3RoaXMuJGdldD1bIiRleGNlcHRpb25IYW5kbGVyIiwiJHBhcnNlIiwiJGJyb3dzZXIiLGZ1bmN0aW9uKGYsZyxoKXtmdW5jdGlvbiBrKGEpe2EuY3VycmVudFNjb3BlLiQkZGVzdHJveWVkPSEwfWZ1bmN0aW9uIGwoYSl7OT09PUJhJiYoYS4kJGNoaWxkSGVhZCYmbChhLiQkY2hpbGRIZWFkKSxhLiQkbmV4dFNpYmxpbmcmJmwoYS4kJG5leHRTaWJsaW5nKSk7YS4kcGFyZW50PWEuJCRuZXh0U2libGluZz0KYS4kJHByZXZTaWJsaW5nPWEuJCRjaGlsZEhlYWQ9YS4kJGNoaWxkVGFpbD1hLiRyb290PWEuJCR3YXRjaGVycz1udWxsfWZ1bmN0aW9uIG0oKXt0aGlzLiRpZD0rK3BiO3RoaXMuJCRwaGFzZT10aGlzLiRwYXJlbnQ9dGhpcy4kJHdhdGNoZXJzPXRoaXMuJCRuZXh0U2libGluZz10aGlzLiQkcHJldlNpYmxpbmc9dGhpcy4kJGNoaWxkSGVhZD10aGlzLiQkY2hpbGRUYWlsPW51bGw7dGhpcy4kcm9vdD10aGlzO3RoaXMuJCRkZXN0cm95ZWQ9ITE7dGhpcy4kJGxpc3RlbmVycz17fTt0aGlzLiQkbGlzdGVuZXJDb3VudD17fTt0aGlzLiQkd2F0Y2hlcnNDb3VudD0wO3RoaXMuJCRpc29sYXRlQmluZGluZ3M9bnVsbH1mdW5jdGlvbiBuKGEpe2lmKEQuJCRwaGFzZSl0aHJvdyBkKCJpbnByb2ciLEQuJCRwaGFzZSk7RC4kJHBoYXNlPWF9ZnVuY3Rpb24gcChhLGIpe2RvIGEuJCR3YXRjaGVyc0NvdW50Kz1iO3doaWxlKGE9YS4kcGFyZW50KX1mdW5jdGlvbiB4KGEsYixjKXtkbyBhLiQkbGlzdGVuZXJDb3VudFtjXS09CmIsMD09PWEuJCRsaXN0ZW5lckNvdW50W2NdJiZkZWxldGUgYS4kJGxpc3RlbmVyQ291bnRbY107d2hpbGUoYT1hLiRwYXJlbnQpfWZ1bmN0aW9uIHMoKXt9ZnVuY3Rpb24geigpe2Zvcig7dy5sZW5ndGg7KXRyeXt3LnNoaWZ0KCkoKX1jYXRjaChhKXtmKGEpfWU9bnVsbH1mdW5jdGlvbiByKCl7bnVsbD09PWUmJihlPWguZGVmZXIoZnVuY3Rpb24oKXtELiRhcHBseSh6KX0pKX1tLnByb3RvdHlwZT17Y29uc3RydWN0b3I6bSwkbmV3OmZ1bmN0aW9uKGIsYyl7dmFyIGQ7Yz1jfHx0aGlzO2I/KGQ9bmV3IG0sZC4kcm9vdD10aGlzLiRyb290KToodGhpcy4kJENoaWxkU2NvcGV8fCh0aGlzLiQkQ2hpbGRTY29wZT1hKHRoaXMpKSxkPW5ldyB0aGlzLiQkQ2hpbGRTY29wZSk7ZC4kcGFyZW50PWM7ZC4kJHByZXZTaWJsaW5nPWMuJCRjaGlsZFRhaWw7Yy4kJGNoaWxkSGVhZD8oYy4kJGNoaWxkVGFpbC4kJG5leHRTaWJsaW5nPWQsYy4kJGNoaWxkVGFpbD1kKTpjLiQkY2hpbGRIZWFkPWMuJCRjaGlsZFRhaWw9CmQ7KGJ8fGMhPXRoaXMpJiZkLiRvbigiJGRlc3Ryb3kiLGspO3JldHVybiBkfSwkd2F0Y2g6ZnVuY3Rpb24oYSxiLGQsZSl7dmFyIGY9ZyhhKTtpZihmLiQkd2F0Y2hEZWxlZ2F0ZSlyZXR1cm4gZi4kJHdhdGNoRGVsZWdhdGUodGhpcyxiLGQsZixhKTt2YXIgaD10aGlzLGs9aC4kJHdhdGNoZXJzLGw9e2ZuOmIsbGFzdDpzLGdldDpmLGV4cDplfHxhLGVxOiEhZH07Yz1udWxsO0UoYil8fChsLmZuPUMpO2t8fChrPWguJCR3YXRjaGVycz1bXSk7ay51bnNoaWZ0KGwpO3AodGhpcywxKTtyZXR1cm4gZnVuY3Rpb24oKXswPD0kYShrLGwpJiZwKGgsLTEpO2M9bnVsbH19LCR3YXRjaEdyb3VwOmZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gYygpe2g9ITE7az8oaz0hMSxiKGUsZSxnKSk6YihlLGQsZyl9dmFyIGQ9QXJyYXkoYS5sZW5ndGgpLGU9QXJyYXkoYS5sZW5ndGgpLGY9W10sZz10aGlzLGg9ITEsaz0hMDtpZighYS5sZW5ndGgpe3ZhciBsPSEwO2cuJGV2YWxBc3luYyhmdW5jdGlvbigpe2wmJgpiKGUsZSxnKX0pO3JldHVybiBmdW5jdGlvbigpe2w9ITF9fWlmKDE9PT1hLmxlbmd0aClyZXR1cm4gdGhpcy4kd2F0Y2goYVswXSxmdW5jdGlvbihhLGMsZil7ZVswXT1hO2RbMF09YztiKGUsYT09PWM/ZTpkLGYpfSk7cShhLGZ1bmN0aW9uKGEsYil7dmFyIGs9Zy4kd2F0Y2goYSxmdW5jdGlvbihhLGYpe2VbYl09YTtkW2JdPWY7aHx8KGg9ITAsZy4kZXZhbEFzeW5jKGMpKX0pO2YucHVzaChrKX0pO3JldHVybiBmdW5jdGlvbigpe2Zvcig7Zi5sZW5ndGg7KWYuc2hpZnQoKSgpfX0sJHdhdGNoQ29sbGVjdGlvbjpmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGMoYSl7ZT1hO3ZhciBiLGQsZyxoO2lmKCF5KGUpKXtpZihKKGUpKWlmKHhhKGUpKWZvcihmIT09biYmKGY9bix1PWYubGVuZ3RoPTAsbCsrKSxhPWUubGVuZ3RoLHUhPT1hJiYobCsrLGYubGVuZ3RoPXU9YSksYj0wO2I8YTtiKyspaD1mW2JdLGc9ZVtiXSxkPWghPT1oJiZnIT09ZyxkfHxoPT09Z3x8KGwrKyxmW2JdPWcpO2Vsc2V7ZiE9PQpwJiYoZj1wPXt9LHU9MCxsKyspO2E9MDtmb3IoYiBpbiBlKXNhLmNhbGwoZSxiKSYmKGErKyxnPWVbYl0saD1mW2JdLGIgaW4gZj8oZD1oIT09aCYmZyE9PWcsZHx8aD09PWd8fChsKyssZltiXT1nKSk6KHUrKyxmW2JdPWcsbCsrKSk7aWYodT5hKWZvcihiIGluIGwrKyxmKXNhLmNhbGwoZSxiKXx8KHUtLSxkZWxldGUgZltiXSl9ZWxzZSBmIT09ZSYmKGY9ZSxsKyspO3JldHVybiBsfX1jLiRzdGF0ZWZ1bD0hMDt2YXIgZD10aGlzLGUsZixoLGs9MTxiLmxlbmd0aCxsPTAsbT1nKGEsYyksbj1bXSxwPXt9LHI9ITAsdT0wO3JldHVybiB0aGlzLiR3YXRjaChtLGZ1bmN0aW9uKCl7cj8ocj0hMSxiKGUsZSxkKSk6YihlLGgsZCk7aWYoaylpZihKKGUpKWlmKHhhKGUpKXtoPUFycmF5KGUubGVuZ3RoKTtmb3IodmFyIGE9MDthPGUubGVuZ3RoO2ErKyloW2FdPWVbYV19ZWxzZSBmb3IoYSBpbiBoPXt9LGUpc2EuY2FsbChlLGEpJiYoaFthXT1lW2FdKTtlbHNlIGg9ZX0pfSwkZGlnZXN0OmZ1bmN0aW9uKCl7dmFyIGEsCmcsayxsLG0scCxyLHgscT1iLHcseT1bXSxDLEY7bigiJGRpZ2VzdCIpO2guJCRjaGVja1VybENoYW5nZSgpO3RoaXM9PT1EJiZudWxsIT09ZSYmKGguZGVmZXIuY2FuY2VsKGUpLHooKSk7Yz1udWxsO2Rve3g9ITE7dz10aGlzO2ZvcihwPTA7cDx1Lmxlbmd0aDtwKyspe3RyeXtGPXVbcF0sRi5zY29wZS4kZXZhbChGLmV4cHJlc3Npb24sRi5sb2NhbHMpfWNhdGNoKEcpe2YoRyl9Yz1udWxsfXUubGVuZ3RoPTA7YTpkb3tpZihwPXcuJCR3YXRjaGVycylmb3Iocj1wLmxlbmd0aDtyLS07KXRyeXtpZihhPXBbcl0paWYobT1hLmdldCwoZz1tKHcpKSE9PShrPWEubGFzdCkmJiEoYS5lcT9uYShnLGspOiJudW1iZXIiPT09dHlwZW9mIGcmJiJudW1iZXIiPT09dHlwZW9mIGsmJmlzTmFOKGcpJiZpc05hTihrKSkpeD0hMCxjPWEsYS5sYXN0PWEuZXE/b2EoZyxudWxsKTpnLGw9YS5mbixsKGcsaz09PXM/ZzprLHcpLDU+cSYmKEM9NC1xLHlbQ118fCh5W0NdPVtdKSx5W0NdLnB1c2goe21zZzpFKGEuZXhwKT8KImZuOiAiKyhhLmV4cC5uYW1lfHxhLmV4cC50b1N0cmluZygpKTphLmV4cCxuZXdWYWw6ZyxvbGRWYWw6a30pKTtlbHNlIGlmKGE9PT1jKXt4PSExO2JyZWFrIGF9fWNhdGNoKEkpe2YoSSl9aWYoIShwPXcuJCR3YXRjaGVyc0NvdW50JiZ3LiQkY2hpbGRIZWFkfHx3IT09dGhpcyYmdy4kJG5leHRTaWJsaW5nKSlmb3IoO3chPT10aGlzJiYhKHA9dy4kJG5leHRTaWJsaW5nKTspdz13LiRwYXJlbnR9d2hpbGUodz1wKTtpZigoeHx8dS5sZW5ndGgpJiYhcS0tKXRocm93IEQuJCRwaGFzZT1udWxsLGQoImluZmRpZyIsYix5KTt9d2hpbGUoeHx8dS5sZW5ndGgpO2ZvcihELiQkcGhhc2U9bnVsbDt2PHQubGVuZ3RoOyl0cnl7dFt2KytdKCl9Y2F0Y2goSil7ZihKKX10Lmxlbmd0aD12PTB9LCRkZXN0cm95OmZ1bmN0aW9uKCl7aWYoIXRoaXMuJCRkZXN0cm95ZWQpe3ZhciBhPXRoaXMuJHBhcmVudDt0aGlzLiRicm9hZGNhc3QoIiRkZXN0cm95Iik7dGhpcy4kJGRlc3Ryb3llZD0hMDt0aGlzPT09CkQmJmguJCRhcHBsaWNhdGlvbkRlc3Ryb3llZCgpO3AodGhpcywtdGhpcy4kJHdhdGNoZXJzQ291bnQpO2Zvcih2YXIgYiBpbiB0aGlzLiQkbGlzdGVuZXJDb3VudCl4KHRoaXMsdGhpcy4kJGxpc3RlbmVyQ291bnRbYl0sYik7YSYmYS4kJGNoaWxkSGVhZD09dGhpcyYmKGEuJCRjaGlsZEhlYWQ9dGhpcy4kJG5leHRTaWJsaW5nKTthJiZhLiQkY2hpbGRUYWlsPT10aGlzJiYoYS4kJGNoaWxkVGFpbD10aGlzLiQkcHJldlNpYmxpbmcpO3RoaXMuJCRwcmV2U2libGluZyYmKHRoaXMuJCRwcmV2U2libGluZy4kJG5leHRTaWJsaW5nPXRoaXMuJCRuZXh0U2libGluZyk7dGhpcy4kJG5leHRTaWJsaW5nJiYodGhpcy4kJG5leHRTaWJsaW5nLiQkcHJldlNpYmxpbmc9dGhpcy4kJHByZXZTaWJsaW5nKTt0aGlzLiRkZXN0cm95PXRoaXMuJGRpZ2VzdD10aGlzLiRhcHBseT10aGlzLiRldmFsQXN5bmM9dGhpcy4kYXBwbHlBc3luYz1DO3RoaXMuJG9uPXRoaXMuJHdhdGNoPXRoaXMuJHdhdGNoR3JvdXA9CmZ1bmN0aW9uKCl7cmV0dXJuIEN9O3RoaXMuJCRsaXN0ZW5lcnM9e307dGhpcy4kJG5leHRTaWJsaW5nPW51bGw7bCh0aGlzKX19LCRldmFsOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGcoYSkodGhpcyxiKX0sJGV2YWxBc3luYzpmdW5jdGlvbihhLGIpe0QuJCRwaGFzZXx8dS5sZW5ndGh8fGguZGVmZXIoZnVuY3Rpb24oKXt1Lmxlbmd0aCYmRC4kZGlnZXN0KCl9KTt1LnB1c2goe3Njb3BlOnRoaXMsZXhwcmVzc2lvbjpnKGEpLGxvY2FsczpifSl9LCQkcG9zdERpZ2VzdDpmdW5jdGlvbihhKXt0LnB1c2goYSl9LCRhcHBseTpmdW5jdGlvbihhKXt0cnl7bigiJGFwcGx5Iik7dHJ5e3JldHVybiB0aGlzLiRldmFsKGEpfWZpbmFsbHl7RC4kJHBoYXNlPW51bGx9fWNhdGNoKGIpe2YoYil9ZmluYWxseXt0cnl7RC4kZGlnZXN0KCl9Y2F0Y2goYyl7dGhyb3cgZihjKSxjO319fSwkYXBwbHlBc3luYzpmdW5jdGlvbihhKXtmdW5jdGlvbiBiKCl7Yy4kZXZhbChhKX12YXIgYz10aGlzO2EmJncucHVzaChiKTsKYT1nKGEpO3IoKX0sJG9uOmZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy4kJGxpc3RlbmVyc1thXTtjfHwodGhpcy4kJGxpc3RlbmVyc1thXT1jPVtdKTtjLnB1c2goYik7dmFyIGQ9dGhpcztkbyBkLiQkbGlzdGVuZXJDb3VudFthXXx8KGQuJCRsaXN0ZW5lckNvdW50W2FdPTApLGQuJCRsaXN0ZW5lckNvdW50W2FdKys7d2hpbGUoZD1kLiRwYXJlbnQpO3ZhciBlPXRoaXM7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGQ9Yy5pbmRleE9mKGIpOy0xIT09ZCYmKGNbZF09bnVsbCx4KGUsMSxhKSl9fSwkZW1pdDpmdW5jdGlvbihhLGIpe3ZhciBjPVtdLGQsZT10aGlzLGc9ITEsaD17bmFtZTphLHRhcmdldFNjb3BlOmUsc3RvcFByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7Zz0hMH0scHJldmVudERlZmF1bHQ6ZnVuY3Rpb24oKXtoLmRlZmF1bHRQcmV2ZW50ZWQ9ITB9LGRlZmF1bHRQcmV2ZW50ZWQ6ITF9LGs9YWIoW2hdLGFyZ3VtZW50cywxKSxsLG07ZG97ZD1lLiQkbGlzdGVuZXJzW2FdfHxjO2guY3VycmVudFNjb3BlPQplO2w9MDtmb3IobT1kLmxlbmd0aDtsPG07bCsrKWlmKGRbbF0pdHJ5e2RbbF0uYXBwbHkobnVsbCxrKX1jYXRjaChuKXtmKG4pfWVsc2UgZC5zcGxpY2UobCwxKSxsLS0sbS0tO2lmKGcpcmV0dXJuIGguY3VycmVudFNjb3BlPW51bGwsaDtlPWUuJHBhcmVudH13aGlsZShlKTtoLmN1cnJlbnRTY29wZT1udWxsO3JldHVybiBofSwkYnJvYWRjYXN0OmZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcyxkPXRoaXMsZT17bmFtZTphLHRhcmdldFNjb3BlOnRoaXMscHJldmVudERlZmF1bHQ6ZnVuY3Rpb24oKXtlLmRlZmF1bHRQcmV2ZW50ZWQ9ITB9LGRlZmF1bHRQcmV2ZW50ZWQ6ITF9O2lmKCF0aGlzLiQkbGlzdGVuZXJDb3VudFthXSlyZXR1cm4gZTtmb3IodmFyIGc9YWIoW2VdLGFyZ3VtZW50cywxKSxoLGs7Yz1kOyl7ZS5jdXJyZW50U2NvcGU9YztkPWMuJCRsaXN0ZW5lcnNbYV18fFtdO2g9MDtmb3Ioaz1kLmxlbmd0aDtoPGs7aCsrKWlmKGRbaF0pdHJ5e2RbaF0uYXBwbHkobnVsbCxnKX1jYXRjaChsKXtmKGwpfWVsc2UgZC5zcGxpY2UoaCwKMSksaC0tLGstLTtpZighKGQ9Yy4kJGxpc3RlbmVyQ291bnRbYV0mJmMuJCRjaGlsZEhlYWR8fGMhPT10aGlzJiZjLiQkbmV4dFNpYmxpbmcpKWZvcig7YyE9PXRoaXMmJiEoZD1jLiQkbmV4dFNpYmxpbmcpOyljPWMuJHBhcmVudH1lLmN1cnJlbnRTY29wZT1udWxsO3JldHVybiBlfX07dmFyIEQ9bmV3IG0sdT1ELiQkYXN5bmNRdWV1ZT1bXSx0PUQuJCRwb3N0RGlnZXN0UXVldWU9W10sdz1ELiQkYXBwbHlBc3luY1F1ZXVlPVtdLHY9MDtyZXR1cm4gRH1dfWZ1bmN0aW9uIG5lKCl7dmFyIGE9L15ccyooaHR0cHM/fGZ0cHxtYWlsdG98dGVsfGZpbGUpOi8sYj0vXlxzKigoaHR0cHM/fGZ0cHxmaWxlfGJsb2IpOnxkYXRhOmltYWdlXC8pLzt0aGlzLmFIcmVmU2FuaXRpemF0aW9uV2hpdGVsaXN0PWZ1bmN0aW9uKGIpe3JldHVybiB2KGIpPyhhPWIsdGhpcyk6YX07dGhpcy5pbWdTcmNTYW5pdGl6YXRpb25XaGl0ZWxpc3Q9ZnVuY3Rpb24oYSl7cmV0dXJuIHYoYSk/KGI9YSx0aGlzKTpifTsKdGhpcy4kZ2V0PWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKGQsYyl7dmFyIGU9Yz9iOmEsZjtmPXBhKGQpLmhyZWY7cmV0dXJuIiI9PT1mfHxmLm1hdGNoKGUpP2Q6InVuc2FmZToiK2Z9fX1mdW5jdGlvbiBuZyhhKXtpZigic2VsZiI9PT1hKXJldHVybiBhO2lmKEkoYSkpe2lmKC0xPGEuaW5kZXhPZigiKioqIikpdGhyb3cgcmEoIml3Y2FyZCIsYSk7YT13ZChhKS5yZXBsYWNlKCJcXCpcXCoiLCIuKiIpLnJlcGxhY2UoIlxcKiIsIlteOi8uPyY7XSoiKTtyZXR1cm4gbmV3IFJlZ0V4cCgiXiIrYSsiJCIpfWlmKFhhKGEpKXJldHVybiBuZXcgUmVnRXhwKCJeIithLnNvdXJjZSsiJCIpO3Rocm93IHJhKCJpbWF0Y2hlciIpO31mdW5jdGlvbiB4ZChhKXt2YXIgYj1bXTt2KGEpJiZxKGEsZnVuY3Rpb24oYSl7Yi5wdXNoKG5nKGEpKX0pO3JldHVybiBifWZ1bmN0aW9uIHlmKCl7dGhpcy5TQ0VfQ09OVEVYVFM9bWE7dmFyIGE9WyJzZWxmIl0sYj1bXTt0aGlzLnJlc291cmNlVXJsV2hpdGVsaXN0PQpmdW5jdGlvbihiKXthcmd1bWVudHMubGVuZ3RoJiYoYT14ZChiKSk7cmV0dXJuIGF9O3RoaXMucmVzb3VyY2VVcmxCbGFja2xpc3Q9ZnVuY3Rpb24oYSl7YXJndW1lbnRzLmxlbmd0aCYmKGI9eGQoYSkpO3JldHVybiBifTt0aGlzLiRnZXQ9WyIkaW5qZWN0b3IiLGZ1bmN0aW9uKGQpe2Z1bmN0aW9uIGMoYSxiKXtyZXR1cm4ic2VsZiI9PT1hP2lkKGIpOiEhYS5leGVjKGIuaHJlZil9ZnVuY3Rpb24gZShhKXt2YXIgYj1mdW5jdGlvbihhKXt0aGlzLiQkdW53cmFwVHJ1c3RlZFZhbHVlPWZ1bmN0aW9uKCl7cmV0dXJuIGF9fTthJiYoYi5wcm90b3R5cGU9bmV3IGEpO2IucHJvdG90eXBlLnZhbHVlT2Y9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy4kJHVud3JhcFRydXN0ZWRWYWx1ZSgpfTtiLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiB0aGlzLiQkdW53cmFwVHJ1c3RlZFZhbHVlKCkudG9TdHJpbmcoKX07cmV0dXJuIGJ9dmFyIGY9ZnVuY3Rpb24oYSl7dGhyb3cgcmEoInVuc2FmZSIpOwp9O2QuaGFzKCIkc2FuaXRpemUiKSYmKGY9ZC5nZXQoIiRzYW5pdGl6ZSIpKTt2YXIgZz1lKCksaD17fTtoW21hLkhUTUxdPWUoZyk7aFttYS5DU1NdPWUoZyk7aFttYS5VUkxdPWUoZyk7aFttYS5KU109ZShnKTtoW21hLlJFU09VUkNFX1VSTF09ZShoW21hLlVSTF0pO3JldHVybnt0cnVzdEFzOmZ1bmN0aW9uKGEsYil7dmFyIGM9aC5oYXNPd25Qcm9wZXJ0eShhKT9oW2FdOm51bGw7aWYoIWMpdGhyb3cgcmEoImljb250ZXh0IixhLGIpO2lmKG51bGw9PT1ifHx5KGIpfHwiIj09PWIpcmV0dXJuIGI7aWYoInN0cmluZyIhPT10eXBlb2YgYil0aHJvdyByYSgiaXR5cGUiLGEpO3JldHVybiBuZXcgYyhiKX0sZ2V0VHJ1c3RlZDpmdW5jdGlvbihkLGUpe2lmKG51bGw9PT1lfHx5KGUpfHwiIj09PWUpcmV0dXJuIGU7dmFyIGc9aC5oYXNPd25Qcm9wZXJ0eShkKT9oW2RdOm51bGw7aWYoZyYmZSBpbnN0YW5jZW9mIGcpcmV0dXJuIGUuJCR1bndyYXBUcnVzdGVkVmFsdWUoKTtpZihkPT09bWEuUkVTT1VSQ0VfVVJMKXt2YXIgZz0KcGEoZS50b1N0cmluZygpKSxuLHAseD0hMTtuPTA7Zm9yKHA9YS5sZW5ndGg7bjxwO24rKylpZihjKGFbbl0sZykpe3g9ITA7YnJlYWt9aWYoeClmb3Iobj0wLHA9Yi5sZW5ndGg7bjxwO24rKylpZihjKGJbbl0sZykpe3g9ITE7YnJlYWt9aWYoeClyZXR1cm4gZTt0aHJvdyByYSgiaW5zZWN1cmwiLGUudG9TdHJpbmcoKSk7fWlmKGQ9PT1tYS5IVE1MKXJldHVybiBmKGUpO3Rocm93IHJhKCJ1bnNhZmUiKTt9LHZhbHVlT2Y6ZnVuY3Rpb24oYSl7cmV0dXJuIGEgaW5zdGFuY2VvZiBnP2EuJCR1bndyYXBUcnVzdGVkVmFsdWUoKTphfX19XX1mdW5jdGlvbiB4Zigpe3ZhciBhPSEwO3RoaXMuZW5hYmxlZD1mdW5jdGlvbihiKXthcmd1bWVudHMubGVuZ3RoJiYoYT0hIWIpO3JldHVybiBhfTt0aGlzLiRnZXQ9WyIkcGFyc2UiLCIkc2NlRGVsZWdhdGUiLGZ1bmN0aW9uKGIsZCl7aWYoYSYmOD5CYSl0aHJvdyByYSgiaWVxdWlya3MiKTt2YXIgYz1mYShtYSk7Yy5pc0VuYWJsZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gYX07CmMudHJ1c3RBcz1kLnRydXN0QXM7Yy5nZXRUcnVzdGVkPWQuZ2V0VHJ1c3RlZDtjLnZhbHVlT2Y9ZC52YWx1ZU9mO2F8fChjLnRydXN0QXM9Yy5nZXRUcnVzdGVkPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGJ9LGMudmFsdWVPZj1ZYSk7Yy5wYXJzZUFzPWZ1bmN0aW9uKGEsZCl7dmFyIGU9YihkKTtyZXR1cm4gZS5saXRlcmFsJiZlLmNvbnN0YW50P2U6YihkLGZ1bmN0aW9uKGIpe3JldHVybiBjLmdldFRydXN0ZWQoYSxiKX0pfTt2YXIgZT1jLnBhcnNlQXMsZj1jLmdldFRydXN0ZWQsZz1jLnRydXN0QXM7cShtYSxmdW5jdGlvbihhLGIpe3ZhciBkPUwoYik7Y1tlYigicGFyc2VfYXNfIitkKV09ZnVuY3Rpb24oYil7cmV0dXJuIGUoYSxiKX07Y1tlYigiZ2V0X3RydXN0ZWRfIitkKV09ZnVuY3Rpb24oYil7cmV0dXJuIGYoYSxiKX07Y1tlYigidHJ1c3RfYXNfIitkKV09ZnVuY3Rpb24oYil7cmV0dXJuIGcoYSxiKX19KTtyZXR1cm4gY31dfWZ1bmN0aW9uIHpmKCl7dGhpcy4kZ2V0PVsiJHdpbmRvdyIsCiIkZG9jdW1lbnQiLGZ1bmN0aW9uKGEsYil7dmFyIGQ9e30sYz0hKGEuY2hyb21lJiZhLmNocm9tZS5hcHAmJmEuY2hyb21lLmFwcC5ydW50aW1lKSYmYS5oaXN0b3J5JiZhLmhpc3RvcnkucHVzaFN0YXRlLGU9JCgoL2FuZHJvaWQgKFxkKykvLmV4ZWMoTCgoYS5uYXZpZ2F0b3J8fHt9KS51c2VyQWdlbnQpKXx8W10pWzFdKSxmPS9Cb3hlZS9pLnRlc3QoKGEubmF2aWdhdG9yfHx7fSkudXNlckFnZW50KSxnPWJbMF18fHt9LGgsaz0vXihNb3p8d2Via2l0fG1zKSg/PVtBLVpdKS8sbD1nLmJvZHkmJmcuYm9keS5zdHlsZSxtPSExLG49ITE7aWYobCl7Zm9yKHZhciBwIGluIGwpaWYobT1rLmV4ZWMocCkpe2g9bVswXTtoPWhbMF0udG9VcHBlckNhc2UoKStoLnN1YnN0cigxKTticmVha31ofHwoaD0iV2Via2l0T3BhY2l0eSJpbiBsJiYid2Via2l0Iik7bT0hISgidHJhbnNpdGlvbiJpbiBsfHxoKyJUcmFuc2l0aW9uImluIGwpO249ISEoImFuaW1hdGlvbiJpbiBsfHxoKyJBbmltYXRpb24iaW4KbCk7IWV8fG0mJm58fChtPUkobC53ZWJraXRUcmFuc2l0aW9uKSxuPUkobC53ZWJraXRBbmltYXRpb24pKX1yZXR1cm57aGlzdG9yeTohKCFjfHw0PmV8fGYpLGhhc0V2ZW50OmZ1bmN0aW9uKGEpe2lmKCJpbnB1dCI9PT1hJiYxMT49QmEpcmV0dXJuITE7aWYoeShkW2FdKSl7dmFyIGI9Zy5jcmVhdGVFbGVtZW50KCJkaXYiKTtkW2FdPSJvbiIrYSBpbiBifXJldHVybiBkW2FdfSxjc3A6RmEoKSx2ZW5kb3JQcmVmaXg6aCx0cmFuc2l0aW9uczptLGFuaW1hdGlvbnM6bixhbmRyb2lkOmV9fV19ZnVuY3Rpb24gQmYoKXt2YXIgYTt0aGlzLmh0dHBPcHRpb25zPWZ1bmN0aW9uKGIpe3JldHVybiBiPyhhPWIsdGhpcyk6YX07dGhpcy4kZ2V0PVsiJHRlbXBsYXRlQ2FjaGUiLCIkaHR0cCIsIiRxIiwiJHNjZSIsZnVuY3Rpb24oYixkLGMsZSl7ZnVuY3Rpb24gZihnLGgpe2YudG90YWxQZW5kaW5nUmVxdWVzdHMrKztpZighSShnKXx8eShiLmdldChnKSkpZz1lLmdldFRydXN0ZWRSZXNvdXJjZVVybChnKTsKdmFyIGs9ZC5kZWZhdWx0cyYmZC5kZWZhdWx0cy50cmFuc2Zvcm1SZXNwb25zZTtLKGspP2s9ay5maWx0ZXIoZnVuY3Rpb24oYSl7cmV0dXJuIGEhPT1kY30pOms9PT1kYyYmKGs9bnVsbCk7cmV0dXJuIGQuZ2V0KGcsUCh7Y2FjaGU6Yix0cmFuc2Zvcm1SZXNwb25zZTprfSxhKSlbImZpbmFsbHkiXShmdW5jdGlvbigpe2YudG90YWxQZW5kaW5nUmVxdWVzdHMtLX0pLnRoZW4oZnVuY3Rpb24oYSl7Yi5wdXQoZyxhLmRhdGEpO3JldHVybiBhLmRhdGF9LGZ1bmN0aW9uKGEpe2lmKCFoKXRocm93IG9nKCJ0cGxvYWQiLGcsYS5zdGF0dXMsYS5zdGF0dXNUZXh0KTtyZXR1cm4gYy5yZWplY3QoYSl9KX1mLnRvdGFsUGVuZGluZ1JlcXVlc3RzPTA7cmV0dXJuIGZ9XX1mdW5jdGlvbiBDZigpe3RoaXMuJGdldD1bIiRyb290U2NvcGUiLCIkYnJvd3NlciIsIiRsb2NhdGlvbiIsZnVuY3Rpb24oYSxiLGQpe3JldHVybntmaW5kQmluZGluZ3M6ZnVuY3Rpb24oYSxiLGQpe2E9YS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJuZy1iaW5kaW5nIik7CnZhciBnPVtdO3EoYSxmdW5jdGlvbihhKXt2YXIgYz1kYS5lbGVtZW50KGEpLmRhdGEoIiRiaW5kaW5nIik7YyYmcShjLGZ1bmN0aW9uKGMpe2Q/KG5ldyBSZWdFeHAoIihefFxccykiK3dkKGIpKyIoXFxzfFxcfHwkKSIpKS50ZXN0KGMpJiZnLnB1c2goYSk6LTEhPWMuaW5kZXhPZihiKSYmZy5wdXNoKGEpfSl9KTtyZXR1cm4gZ30sZmluZE1vZGVsczpmdW5jdGlvbihhLGIsZCl7Zm9yKHZhciBnPVsibmctIiwiZGF0YS1uZy0iLCJuZ1xcOiJdLGg9MDtoPGcubGVuZ3RoOysraCl7dmFyIGs9YS5xdWVyeVNlbGVjdG9yQWxsKCJbIitnW2hdKyJtb2RlbCIrKGQ/Ij0iOiIqPSIpKyciJytiKyciXScpO2lmKGsubGVuZ3RoKXJldHVybiBrfX0sZ2V0TG9jYXRpb246ZnVuY3Rpb24oKXtyZXR1cm4gZC51cmwoKX0sc2V0TG9jYXRpb246ZnVuY3Rpb24oYil7YiE9PWQudXJsKCkmJihkLnVybChiKSxhLiRkaWdlc3QoKSl9LHdoZW5TdGFibGU6ZnVuY3Rpb24oYSl7Yi5ub3RpZnlXaGVuTm9PdXRzdGFuZGluZ1JlcXVlc3RzKGEpfX19XX0KZnVuY3Rpb24gRGYoKXt0aGlzLiRnZXQ9WyIkcm9vdFNjb3BlIiwiJGJyb3dzZXIiLCIkcSIsIiQkcSIsIiRleGNlcHRpb25IYW5kbGVyIixmdW5jdGlvbihhLGIsZCxjLGUpe2Z1bmN0aW9uIGYoZixrLGwpe0UoZil8fChsPWssaz1mLGY9Qyk7dmFyIG09eWEuY2FsbChhcmd1bWVudHMsMyksbj12KGwpJiYhbCxwPShuP2M6ZCkuZGVmZXIoKSx4PXAucHJvbWlzZSxxO3E9Yi5kZWZlcihmdW5jdGlvbigpe3RyeXtwLnJlc29sdmUoZi5hcHBseShudWxsLG0pKX1jYXRjaChiKXtwLnJlamVjdChiKSxlKGIpfWZpbmFsbHl7ZGVsZXRlIGdbeC4kJHRpbWVvdXRJZF19bnx8YS4kYXBwbHkoKX0sayk7eC4kJHRpbWVvdXRJZD1xO2dbcV09cDtyZXR1cm4geH12YXIgZz17fTtmLmNhbmNlbD1mdW5jdGlvbihhKXtyZXR1cm4gYSYmYS4kJHRpbWVvdXRJZCBpbiBnPyhnW2EuJCR0aW1lb3V0SWRdLnJlamVjdCgiY2FuY2VsZWQiKSxkZWxldGUgZ1thLiQkdGltZW91dElkXSxiLmRlZmVyLmNhbmNlbChhLiQkdGltZW91dElkKSk6CiExfTtyZXR1cm4gZn1dfWZ1bmN0aW9uIHBhKGEpe0JhJiYoWC5zZXRBdHRyaWJ1dGUoImhyZWYiLGEpLGE9WC5ocmVmKTtYLnNldEF0dHJpYnV0ZSgiaHJlZiIsYSk7cmV0dXJue2hyZWY6WC5ocmVmLHByb3RvY29sOlgucHJvdG9jb2w/WC5wcm90b2NvbC5yZXBsYWNlKC86JC8sIiIpOiIiLGhvc3Q6WC5ob3N0LHNlYXJjaDpYLnNlYXJjaD9YLnNlYXJjaC5yZXBsYWNlKC9eXD8vLCIiKToiIixoYXNoOlguaGFzaD9YLmhhc2gucmVwbGFjZSgvXiMvLCIiKToiIixob3N0bmFtZTpYLmhvc3RuYW1lLHBvcnQ6WC5wb3J0LHBhdGhuYW1lOiIvIj09PVgucGF0aG5hbWUuY2hhckF0KDApP1gucGF0aG5hbWU6Ii8iK1gucGF0aG5hbWV9fWZ1bmN0aW9uIGlkKGEpe2E9SShhKT9wYShhKTphO3JldHVybiBhLnByb3RvY29sPT09eWQucHJvdG9jb2wmJmEuaG9zdD09PXlkLmhvc3R9ZnVuY3Rpb24gRWYoKXt0aGlzLiRnZXQ9Y2EoRil9ZnVuY3Rpb24gemQoYSl7ZnVuY3Rpb24gYihhKXt0cnl7cmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChhKX1jYXRjaChiKXtyZXR1cm4gYX19CnZhciBkPWFbMF18fHt9LGM9e30sZT0iIjtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgYSxnLGgsayxsO2E9ZC5jb29raWV8fCIiO2lmKGEhPT1lKWZvcihlPWEsYT1lLnNwbGl0KCI7ICIpLGM9e30saD0wO2g8YS5sZW5ndGg7aCsrKWc9YVtoXSxrPWcuaW5kZXhPZigiPSIpLDA8ayYmKGw9YihnLnN1YnN0cmluZygwLGspKSx5KGNbbF0pJiYoY1tsXT1iKGcuc3Vic3RyaW5nKGsrMSkpKSk7cmV0dXJuIGN9fWZ1bmN0aW9uIElmKCl7dGhpcy4kZ2V0PXpkfWZ1bmN0aW9uIExjKGEpe2Z1bmN0aW9uIGIoZCxjKXtpZihKKGQpKXt2YXIgZT17fTtxKGQsZnVuY3Rpb24oYSxjKXtlW2NdPWIoYyxhKX0pO3JldHVybiBlfXJldHVybiBhLmZhY3RvcnkoZCsiRmlsdGVyIixjKX10aGlzLnJlZ2lzdGVyPWI7dGhpcy4kZ2V0PVsiJGluamVjdG9yIixmdW5jdGlvbihhKXtyZXR1cm4gZnVuY3Rpb24oYil7cmV0dXJuIGEuZ2V0KGIrIkZpbHRlciIpfX1dO2IoImN1cnJlbmN5IixBZCk7YigiZGF0ZSIsQmQpOwpiKCJmaWx0ZXIiLHBnKTtiKCJqc29uIixxZyk7YigibGltaXRUbyIscmcpO2IoImxvd2VyY2FzZSIsc2cpO2IoIm51bWJlciIsQ2QpO2IoIm9yZGVyQnkiLERkKTtiKCJ1cHBlcmNhc2UiLHRnKX1mdW5jdGlvbiBwZygpe3JldHVybiBmdW5jdGlvbihhLGIsZCl7aWYoIXhhKGEpKXtpZihudWxsPT1hKXJldHVybiBhO3Rocm93IE8oImZpbHRlciIpKCJub3RhcnJheSIsYSk7fXZhciBjO3N3aXRjaChsYyhiKSl7Y2FzZSAiZnVuY3Rpb24iOmJyZWFrO2Nhc2UgImJvb2xlYW4iOmNhc2UgIm51bGwiOmNhc2UgIm51bWJlciI6Y2FzZSAic3RyaW5nIjpjPSEwO2Nhc2UgIm9iamVjdCI6Yj11ZyhiLGQsYyk7YnJlYWs7ZGVmYXVsdDpyZXR1cm4gYX1yZXR1cm4gQXJyYXkucHJvdG90eXBlLmZpbHRlci5jYWxsKGEsYil9fWZ1bmN0aW9uIHVnKGEsYixkKXt2YXIgYz1KKGEpJiYiJCJpbiBhOyEwPT09Yj9iPW5hOkUoYil8fChiPWZ1bmN0aW9uKGEsYil7aWYoeShhKSlyZXR1cm4hMTtpZihudWxsPT09CmF8fG51bGw9PT1iKXJldHVybiBhPT09YjtpZihKKGIpfHxKKGEpJiYhdWMoYSkpcmV0dXJuITE7YT1MKCIiK2EpO2I9TCgiIitiKTtyZXR1cm4tMSE9PWEuaW5kZXhPZihiKX0pO3JldHVybiBmdW5jdGlvbihlKXtyZXR1cm4gYyYmIUooZSk/TGEoZSxhLiQsYiwhMSk6TGEoZSxhLGIsZCl9fWZ1bmN0aW9uIExhKGEsYixkLGMsZSl7dmFyIGY9bGMoYSksZz1sYyhiKTtpZigic3RyaW5nIj09PWcmJiIhIj09PWIuY2hhckF0KDApKXJldHVybiFMYShhLGIuc3Vic3RyaW5nKDEpLGQsYyk7aWYoSyhhKSlyZXR1cm4gYS5zb21lKGZ1bmN0aW9uKGEpe3JldHVybiBMYShhLGIsZCxjKX0pO3N3aXRjaChmKXtjYXNlICJvYmplY3QiOnZhciBoO2lmKGMpe2ZvcihoIGluIGEpaWYoIiQiIT09aC5jaGFyQXQoMCkmJkxhKGFbaF0sYixkLCEwKSlyZXR1cm4hMDtyZXR1cm4gZT8hMTpMYShhLGIsZCwhMSl9aWYoIm9iamVjdCI9PT1nKXtmb3IoaCBpbiBiKWlmKGU9YltoXSwhRShlKSYmIXkoZSkmJgooZj0iJCI9PT1oLCFMYShmP2E6YVtoXSxlLGQsZixmKSkpcmV0dXJuITE7cmV0dXJuITB9cmV0dXJuIGQoYSxiKTtjYXNlICJmdW5jdGlvbiI6cmV0dXJuITE7ZGVmYXVsdDpyZXR1cm4gZChhLGIpfX1mdW5jdGlvbiBsYyhhKXtyZXR1cm4gbnVsbD09PWE/Im51bGwiOnR5cGVvZiBhfWZ1bmN0aW9uIEFkKGEpe3ZhciBiPWEuTlVNQkVSX0ZPUk1BVFM7cmV0dXJuIGZ1bmN0aW9uKGEsYyxlKXt5KGMpJiYoYz1iLkNVUlJFTkNZX1NZTSk7eShlKSYmKGU9Yi5QQVRURVJOU1sxXS5tYXhGcmFjKTtyZXR1cm4gbnVsbD09YT9hOkVkKGEsYi5QQVRURVJOU1sxXSxiLkdST1VQX1NFUCxiLkRFQ0lNQUxfU0VQLGUpLnJlcGxhY2UoL1x1MDBBNC9nLGMpfX1mdW5jdGlvbiBDZChhKXt2YXIgYj1hLk5VTUJFUl9GT1JNQVRTO3JldHVybiBmdW5jdGlvbihhLGMpe3JldHVybiBudWxsPT1hP2E6RWQoYSxiLlBBVFRFUk5TWzBdLGIuR1JPVVBfU0VQLGIuREVDSU1BTF9TRVAsYyl9fWZ1bmN0aW9uIHZnKGEpe3ZhciBiPQowLGQsYyxlLGYsZzstMTwoYz1hLmluZGV4T2YoRmQpKSYmKGE9YS5yZXBsYWNlKEZkLCIiKSk7MDwoZT1hLnNlYXJjaCgvZS9pKSk/KDA+YyYmKGM9ZSksYys9K2Euc2xpY2UoZSsxKSxhPWEuc3Vic3RyaW5nKDAsZSkpOjA+YyYmKGM9YS5sZW5ndGgpO2ZvcihlPTA7YS5jaGFyQXQoZSk9PW1jO2UrKyk7aWYoZT09KGc9YS5sZW5ndGgpKWQ9WzBdLGM9MTtlbHNle2ZvcihnLS07YS5jaGFyQXQoZyk9PW1jOylnLS07Yy09ZTtkPVtdO2ZvcihmPTA7ZTw9ZztlKyssZisrKWRbZl09K2EuY2hhckF0KGUpfWM+R2QmJihkPWQuc3BsaWNlKDAsR2QtMSksYj1jLTEsYz0xKTtyZXR1cm57ZDpkLGU6YixpOmN9fWZ1bmN0aW9uIHdnKGEsYixkLGMpe3ZhciBlPWEuZCxmPWUubGVuZ3RoLWEuaTtiPXkoYik/TWF0aC5taW4oTWF0aC5tYXgoZCxmKSxjKTorYjtkPWIrYS5pO2M9ZVtkXTtpZigwPGQpe2Uuc3BsaWNlKE1hdGgubWF4KGEuaSxkKSk7Zm9yKHZhciBnPWQ7ZzxlLmxlbmd0aDtnKyspZVtnXT0KMH1lbHNlIGZvcihmPU1hdGgubWF4KDAsZiksYS5pPTEsZS5sZW5ndGg9TWF0aC5tYXgoMSxkPWIrMSksZVswXT0wLGc9MTtnPGQ7ZysrKWVbZ109MDtpZig1PD1jKWlmKDA+ZC0xKXtmb3IoYz0wO2M+ZDtjLS0pZS51bnNoaWZ0KDApLGEuaSsrO2UudW5zaGlmdCgxKTthLmkrK31lbHNlIGVbZC0xXSsrO2Zvcig7ZjxNYXRoLm1heCgwLGIpO2YrKyllLnB1c2goMCk7aWYoYj1lLnJlZHVjZVJpZ2h0KGZ1bmN0aW9uKGEsYixjLGQpe2IrPWE7ZFtjXT1iJTEwO3JldHVybiBNYXRoLmZsb29yKGIvMTApfSwwKSllLnVuc2hpZnQoYiksYS5pKyt9ZnVuY3Rpb24gRWQoYSxiLGQsYyxlKXtpZighSShhKSYmIVEoYSl8fGlzTmFOKGEpKXJldHVybiIiO3ZhciBmPSFpc0Zpbml0ZShhKSxnPSExLGg9TWF0aC5hYnMoYSkrIiIsaz0iIjtpZihmKWs9Ilx1MjIxZSI7ZWxzZXtnPXZnKGgpO3dnKGcsZSxiLm1pbkZyYWMsYi5tYXhGcmFjKTtrPWcuZDtoPWcuaTtlPWcuZTtmPVtdO2ZvcihnPWsucmVkdWNlKGZ1bmN0aW9uKGEsCmIpe3JldHVybiBhJiYhYn0sITApOzA+aDspay51bnNoaWZ0KDApLGgrKzswPGg/Zj1rLnNwbGljZShoLGsubGVuZ3RoKTooZj1rLGs9WzBdKTtoPVtdO2ZvcihrLmxlbmd0aD49Yi5sZ1NpemUmJmgudW5zaGlmdChrLnNwbGljZSgtYi5sZ1NpemUsay5sZW5ndGgpLmpvaW4oIiIpKTtrLmxlbmd0aD5iLmdTaXplOyloLnVuc2hpZnQoay5zcGxpY2UoLWIuZ1NpemUsay5sZW5ndGgpLmpvaW4oIiIpKTtrLmxlbmd0aCYmaC51bnNoaWZ0KGsuam9pbigiIikpO2s9aC5qb2luKGQpO2YubGVuZ3RoJiYoays9YytmLmpvaW4oIiIpKTtlJiYoays9ImUrIitlKX1yZXR1cm4gMD5hJiYhZz9iLm5lZ1ByZStrK2IubmVnU3VmOmIucG9zUHJlK2srYi5wb3NTdWZ9ZnVuY3Rpb24gTGIoYSxiLGQsYyl7dmFyIGU9IiI7aWYoMD5hfHxjJiYwPj1hKWM/YT0tYSsxOihhPS1hLGU9Ii0iKTtmb3IoYT0iIithO2EubGVuZ3RoPGI7KWE9bWMrYTtkJiYoYT1hLnN1YnN0cihhLmxlbmd0aC1iKSk7cmV0dXJuIGUrCmF9ZnVuY3Rpb24gVyhhLGIsZCxjLGUpe2Q9ZHx8MDtyZXR1cm4gZnVuY3Rpb24oZil7Zj1mWyJnZXQiK2FdKCk7aWYoMDxkfHxmPi1kKWYrPWQ7MD09PWYmJi0xMj09ZCYmKGY9MTIpO3JldHVybiBMYihmLGIsYyxlKX19ZnVuY3Rpb24ga2IoYSxiLGQpe3JldHVybiBmdW5jdGlvbihjLGUpe3ZhciBmPWNbImdldCIrYV0oKSxnPXViKChkPyJTVEFOREFMT05FIjoiIikrKGI/IlNIT1JUIjoiIikrYSk7cmV0dXJuIGVbZ11bZl19fWZ1bmN0aW9uIEhkKGEpe3ZhciBiPShuZXcgRGF0ZShhLDAsMSkpLmdldERheSgpO3JldHVybiBuZXcgRGF0ZShhLDAsKDQ+PWI/NToxMiktYil9ZnVuY3Rpb24gSWQoYSl7cmV0dXJuIGZ1bmN0aW9uKGIpe3ZhciBkPUhkKGIuZ2V0RnVsbFllYXIoKSk7Yj0rbmV3IERhdGUoYi5nZXRGdWxsWWVhcigpLGIuZ2V0TW9udGgoKSxiLmdldERhdGUoKSsoNC1iLmdldERheSgpKSktK2Q7Yj0xK01hdGgucm91bmQoYi82MDQ4RTUpO3JldHVybiBMYihiLGEpfX1mdW5jdGlvbiBuYyhhLApiKXtyZXR1cm4gMD49YS5nZXRGdWxsWWVhcigpP2IuRVJBU1swXTpiLkVSQVNbMV19ZnVuY3Rpb24gQmQoYSl7ZnVuY3Rpb24gYihhKXt2YXIgYjtpZihiPWEubWF0Y2goZCkpe2E9bmV3IERhdGUoMCk7dmFyIGY9MCxnPTAsaD1iWzhdP2Euc2V0VVRDRnVsbFllYXI6YS5zZXRGdWxsWWVhcixrPWJbOF0/YS5zZXRVVENIb3VyczphLnNldEhvdXJzO2JbOV0mJihmPSQoYls5XStiWzEwXSksZz0kKGJbOV0rYlsxMV0pKTtoLmNhbGwoYSwkKGJbMV0pLCQoYlsyXSktMSwkKGJbM10pKTtmPSQoYls0XXx8MCktZjtnPSQoYls1XXx8MCktZztoPSQoYls2XXx8MCk7Yj1NYXRoLnJvdW5kKDFFMypwYXJzZUZsb2F0KCIwLiIrKGJbN118fDApKSk7ay5jYWxsKGEsZixnLGgsYil9cmV0dXJuIGF9dmFyIGQ9L14oXGR7NH0pLT8oXGRcZCktPyhcZFxkKSg/OlQoXGRcZCkoPzo6PyhcZFxkKSg/Ojo/KFxkXGQpKD86XC4oXGQrKSk/KT8pPyhafChbKy1dKShcZFxkKTo/KFxkXGQpKT8pPyQvO3JldHVybiBmdW5jdGlvbihjLApkLGYpe3ZhciBnPSIiLGg9W10sayxsO2Q9ZHx8Im1lZGl1bURhdGUiO2Q9YS5EQVRFVElNRV9GT1JNQVRTW2RdfHxkO0koYykmJihjPXhnLnRlc3QoYyk/JChjKTpiKGMpKTtRKGMpJiYoYz1uZXcgRGF0ZShjKSk7aWYoIWhhKGMpfHwhaXNGaW5pdGUoYy5nZXRUaW1lKCkpKXJldHVybiBjO2Zvcig7ZDspKGw9eWcuZXhlYyhkKSk/KGg9YWIoaCxsLDEpLGQ9aC5wb3AoKSk6KGgucHVzaChkKSxkPW51bGwpO3ZhciBtPWMuZ2V0VGltZXpvbmVPZmZzZXQoKTtmJiYobT14YyhmLG0pLGM9VGIoYyxmLCEwKSk7cShoLGZ1bmN0aW9uKGIpe2s9emdbYl07Zys9az9rKGMsYS5EQVRFVElNRV9GT1JNQVRTLG0pOiInJyI9PT1iPyInIjpiLnJlcGxhY2UoLyheJ3wnJCkvZywiIikucmVwbGFjZSgvJycvZywiJyIpfSk7cmV0dXJuIGd9fWZ1bmN0aW9uIHFnKCl7cmV0dXJuIGZ1bmN0aW9uKGEsYil7eShiKSYmKGI9Mik7cmV0dXJuIGNiKGEsYil9fWZ1bmN0aW9uIHJnKCl7cmV0dXJuIGZ1bmN0aW9uKGEsCmIsZCl7Yj1JbmZpbml0eT09PU1hdGguYWJzKE51bWJlcihiKSk/TnVtYmVyKGIpOiQoYik7aWYoaXNOYU4oYikpcmV0dXJuIGE7UShhKSYmKGE9YS50b1N0cmluZygpKTtpZighSyhhKSYmIUkoYSkpcmV0dXJuIGE7ZD0hZHx8aXNOYU4oZCk/MDokKGQpO2Q9MD5kP01hdGgubWF4KDAsYS5sZW5ndGgrZCk6ZDtyZXR1cm4gMDw9Yj9hLnNsaWNlKGQsZCtiKTowPT09ZD9hLnNsaWNlKGIsYS5sZW5ndGgpOmEuc2xpY2UoTWF0aC5tYXgoMCxkK2IpLGQpfX1mdW5jdGlvbiBEZChhKXtmdW5jdGlvbiBiKGIsZCl7ZD1kPy0xOjE7cmV0dXJuIGIubWFwKGZ1bmN0aW9uKGIpe3ZhciBjPTEsaD1ZYTtpZihFKGIpKWg9YjtlbHNlIGlmKEkoYikpe2lmKCIrIj09Yi5jaGFyQXQoMCl8fCItIj09Yi5jaGFyQXQoMCkpYz0iLSI9PWIuY2hhckF0KDApPy0xOjEsYj1iLnN1YnN0cmluZygxKTtpZigiIiE9PWImJihoPWEoYiksaC5jb25zdGFudCkpdmFyIGs9aCgpLGg9ZnVuY3Rpb24oYSl7cmV0dXJuIGFba119fXJldHVybntnZXQ6aCwKZGVzY2VuZGluZzpjKmR9fSl9ZnVuY3Rpb24gZChhKXtzd2l0Y2godHlwZW9mIGEpe2Nhc2UgIm51bWJlciI6Y2FzZSAiYm9vbGVhbiI6Y2FzZSAic3RyaW5nIjpyZXR1cm4hMDtkZWZhdWx0OnJldHVybiExfX1yZXR1cm4gZnVuY3Rpb24oYSxlLGYpe2lmKG51bGw9PWEpcmV0dXJuIGE7aWYoIXhhKGEpKXRocm93IE8oIm9yZGVyQnkiKSgibm90YXJyYXkiLGEpO0soZSl8fChlPVtlXSk7MD09PWUubGVuZ3RoJiYoZT1bIisiXSk7dmFyIGc9YihlLGYpO2cucHVzaCh7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJue319LGRlc2NlbmRpbmc6Zj8tMToxfSk7YT1BcnJheS5wcm90b3R5cGUubWFwLmNhbGwoYSxmdW5jdGlvbihhLGIpe3JldHVybnt2YWx1ZTphLHByZWRpY2F0ZVZhbHVlczpnLm1hcChmdW5jdGlvbihjKXt2YXIgZT1jLmdldChhKTtjPXR5cGVvZiBlO2lmKG51bGw9PT1lKWM9InN0cmluZyIsZT0ibnVsbCI7ZWxzZSBpZigic3RyaW5nIj09PWMpZT1lLnRvTG93ZXJDYXNlKCk7ZWxzZSBpZigib2JqZWN0Ij09PQpjKWE6e2lmKCJmdW5jdGlvbiI9PT10eXBlb2YgZS52YWx1ZU9mJiYoZT1lLnZhbHVlT2YoKSxkKGUpKSlicmVhayBhO2lmKHVjKGUpJiYoZT1lLnRvU3RyaW5nKCksZChlKSkpYnJlYWsgYTtlPWJ9cmV0dXJue3ZhbHVlOmUsdHlwZTpjfX0pfX0pO2Euc29ydChmdW5jdGlvbihhLGIpe2Zvcih2YXIgYz0wLGQ9MCxlPWcubGVuZ3RoO2Q8ZTsrK2Qpe3ZhciBjPWEucHJlZGljYXRlVmFsdWVzW2RdLGY9Yi5wcmVkaWNhdGVWYWx1ZXNbZF0seD0wO2MudHlwZT09PWYudHlwZT9jLnZhbHVlIT09Zi52YWx1ZSYmKHg9Yy52YWx1ZTxmLnZhbHVlPy0xOjEpOng9Yy50eXBlPGYudHlwZT8tMToxO2lmKGM9eCpnW2RdLmRlc2NlbmRpbmcpYnJlYWt9cmV0dXJuIGN9KTtyZXR1cm4gYT1hLm1hcChmdW5jdGlvbihhKXtyZXR1cm4gYS52YWx1ZX0pfX1mdW5jdGlvbiBNYShhKXtFKGEpJiYoYT17bGluazphfSk7YS5yZXN0cmljdD1hLnJlc3RyaWN0fHwiQUMiO3JldHVybiBjYShhKX1mdW5jdGlvbiBKZChhLApiLGQsYyxlKXt2YXIgZj10aGlzLGc9W107Zi4kZXJyb3I9e307Zi4kJHN1Y2Nlc3M9e307Zi4kcGVuZGluZz12b2lkIDA7Zi4kbmFtZT1lKGIubmFtZXx8Yi5uZ0Zvcm18fCIiKShkKTtmLiRkaXJ0eT0hMTtmLiRwcmlzdGluZT0hMDtmLiR2YWxpZD0hMDtmLiRpbnZhbGlkPSExO2YuJHN1Ym1pdHRlZD0hMTtmLiQkcGFyZW50Rm9ybT1NYjtmLiRyb2xsYmFja1ZpZXdWYWx1ZT1mdW5jdGlvbigpe3EoZyxmdW5jdGlvbihhKXthLiRyb2xsYmFja1ZpZXdWYWx1ZSgpfSl9O2YuJGNvbW1pdFZpZXdWYWx1ZT1mdW5jdGlvbigpe3EoZyxmdW5jdGlvbihhKXthLiRjb21taXRWaWV3VmFsdWUoKX0pfTtmLiRhZGRDb250cm9sPWZ1bmN0aW9uKGEpe1JhKGEuJG5hbWUsImlucHV0Iik7Zy5wdXNoKGEpO2EuJG5hbWUmJihmW2EuJG5hbWVdPWEpO2EuJCRwYXJlbnRGb3JtPWZ9O2YuJCRyZW5hbWVDb250cm9sPWZ1bmN0aW9uKGEsYil7dmFyIGM9YS4kbmFtZTtmW2NdPT09YSYmZGVsZXRlIGZbY107CmZbYl09YTthLiRuYW1lPWJ9O2YuJHJlbW92ZUNvbnRyb2w9ZnVuY3Rpb24oYSl7YS4kbmFtZSYmZlthLiRuYW1lXT09PWEmJmRlbGV0ZSBmW2EuJG5hbWVdO3EoZi4kcGVuZGluZyxmdW5jdGlvbihiLGMpe2YuJHNldFZhbGlkaXR5KGMsbnVsbCxhKX0pO3EoZi4kZXJyb3IsZnVuY3Rpb24oYixjKXtmLiRzZXRWYWxpZGl0eShjLG51bGwsYSl9KTtxKGYuJCRzdWNjZXNzLGZ1bmN0aW9uKGIsYyl7Zi4kc2V0VmFsaWRpdHkoYyxudWxsLGEpfSk7JGEoZyxhKTthLiQkcGFyZW50Rm9ybT1NYn07S2Qoe2N0cmw6dGhpcywkZWxlbWVudDphLHNldDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YVtiXTtkPy0xPT09ZC5pbmRleE9mKGMpJiZkLnB1c2goYyk6YVtiXT1bY119LHVuc2V0OmZ1bmN0aW9uKGEsYixjKXt2YXIgZD1hW2JdO2QmJigkYShkLGMpLDA9PT1kLmxlbmd0aCYmZGVsZXRlIGFbYl0pfSwkYW5pbWF0ZTpjfSk7Zi4kc2V0RGlydHk9ZnVuY3Rpb24oKXtjLnJlbW92ZUNsYXNzKGEsVmEpOwpjLmFkZENsYXNzKGEsTmIpO2YuJGRpcnR5PSEwO2YuJHByaXN0aW5lPSExO2YuJCRwYXJlbnRGb3JtLiRzZXREaXJ0eSgpfTtmLiRzZXRQcmlzdGluZT1mdW5jdGlvbigpe2Muc2V0Q2xhc3MoYSxWYSxOYisiIG5nLXN1Ym1pdHRlZCIpO2YuJGRpcnR5PSExO2YuJHByaXN0aW5lPSEwO2YuJHN1Ym1pdHRlZD0hMTtxKGcsZnVuY3Rpb24oYSl7YS4kc2V0UHJpc3RpbmUoKX0pfTtmLiRzZXRVbnRvdWNoZWQ9ZnVuY3Rpb24oKXtxKGcsZnVuY3Rpb24oYSl7YS4kc2V0VW50b3VjaGVkKCl9KX07Zi4kc2V0U3VibWl0dGVkPWZ1bmN0aW9uKCl7Yy5hZGRDbGFzcyhhLCJuZy1zdWJtaXR0ZWQiKTtmLiRzdWJtaXR0ZWQ9ITA7Zi4kJHBhcmVudEZvcm0uJHNldFN1Ym1pdHRlZCgpfX1mdW5jdGlvbiBvYyhhKXthLiRmb3JtYXR0ZXJzLnB1c2goZnVuY3Rpb24oYil7cmV0dXJuIGEuJGlzRW1wdHkoYik/YjpiLnRvU3RyaW5nKCl9KX1mdW5jdGlvbiBsYihhLGIsZCxjLGUsZil7dmFyIGc9TChiWzBdLnR5cGUpOwppZighZS5hbmRyb2lkKXt2YXIgaD0hMTtiLm9uKCJjb21wb3NpdGlvbnN0YXJ0IixmdW5jdGlvbigpe2g9ITB9KTtiLm9uKCJjb21wb3NpdGlvbmVuZCIsZnVuY3Rpb24oKXtoPSExO2woKX0pfXZhciBrLGw9ZnVuY3Rpb24oYSl7ayYmKGYuZGVmZXIuY2FuY2VsKGspLGs9bnVsbCk7aWYoIWgpe3ZhciBlPWIudmFsKCk7YT1hJiZhLnR5cGU7InBhc3N3b3JkIj09PWd8fGQubmdUcmltJiYiZmFsc2UiPT09ZC5uZ1RyaW18fChlPVYoZSkpOyhjLiR2aWV3VmFsdWUhPT1lfHwiIj09PWUmJmMuJCRoYXNOYXRpdmVWYWxpZGF0b3JzKSYmYy4kc2V0Vmlld1ZhbHVlKGUsYSl9fTtpZihlLmhhc0V2ZW50KCJpbnB1dCIpKWIub24oImlucHV0IixsKTtlbHNle3ZhciBtPWZ1bmN0aW9uKGEsYixjKXtrfHwoaz1mLmRlZmVyKGZ1bmN0aW9uKCl7az1udWxsO2ImJmIudmFsdWU9PT1jfHxsKGEpfSkpfTtiLm9uKCJrZXlkb3duIixmdW5jdGlvbihhKXt2YXIgYj1hLmtleUNvZGU7OTE9PT1ifHwxNTwKYiYmMTk+Ynx8Mzc8PWImJjQwPj1ifHxtKGEsdGhpcyx0aGlzLnZhbHVlKX0pO2lmKGUuaGFzRXZlbnQoInBhc3RlIikpYi5vbigicGFzdGUgY3V0IixtKX1iLm9uKCJjaGFuZ2UiLGwpO2lmKExkW2ddJiZjLiQkaGFzTmF0aXZlVmFsaWRhdG9ycyYmZz09PWQudHlwZSliLm9uKCJrZXlkb3duIHdoZWVsIG1vdXNlZG93biIsZnVuY3Rpb24oYSl7aWYoIWspe3ZhciBiPXRoaXMudmFsaWRpdHksYz1iLmJhZElucHV0LGQ9Yi50eXBlTWlzbWF0Y2g7az1mLmRlZmVyKGZ1bmN0aW9uKCl7az1udWxsO2IuYmFkSW5wdXQ9PT1jJiZiLnR5cGVNaXNtYXRjaD09PWR8fGwoYSl9KX19KTtjLiRyZW5kZXI9ZnVuY3Rpb24oKXt2YXIgYT1jLiRpc0VtcHR5KGMuJHZpZXdWYWx1ZSk/IiI6Yy4kdmlld1ZhbHVlO2IudmFsKCkhPT1hJiZiLnZhbChhKX19ZnVuY3Rpb24gT2IoYSxiKXtyZXR1cm4gZnVuY3Rpb24oZCxjKXt2YXIgZSxmO2lmKGhhKGQpKXJldHVybiBkO2lmKEkoZCkpeyciJz09ZC5jaGFyQXQoMCkmJgonIic9PWQuY2hhckF0KGQubGVuZ3RoLTEpJiYoZD1kLnN1YnN0cmluZygxLGQubGVuZ3RoLTEpKTtpZihBZy50ZXN0KGQpKXJldHVybiBuZXcgRGF0ZShkKTthLmxhc3RJbmRleD0wO2lmKGU9YS5leGVjKGQpKXJldHVybiBlLnNoaWZ0KCksZj1jP3t5eXl5OmMuZ2V0RnVsbFllYXIoKSxNTTpjLmdldE1vbnRoKCkrMSxkZDpjLmdldERhdGUoKSxISDpjLmdldEhvdXJzKCksbW06Yy5nZXRNaW51dGVzKCksc3M6Yy5nZXRTZWNvbmRzKCksc3NzOmMuZ2V0TWlsbGlzZWNvbmRzKCkvMUUzfTp7eXl5eToxOTcwLE1NOjEsZGQ6MSxISDowLG1tOjAsc3M6MCxzc3M6MH0scShlLGZ1bmN0aW9uKGEsYyl7YzxiLmxlbmd0aCYmKGZbYltjXV09K2EpfSksbmV3IERhdGUoZi55eXl5LGYuTU0tMSxmLmRkLGYuSEgsZi5tbSxmLnNzfHwwLDFFMypmLnNzc3x8MCl9cmV0dXJuIE5hTn19ZnVuY3Rpb24gbWIoYSxiLGQsYyl7cmV0dXJuIGZ1bmN0aW9uKGUsZixnLGgsayxsLG0pe2Z1bmN0aW9uIG4oYSl7cmV0dXJuIGEmJgohKGEuZ2V0VGltZSYmYS5nZXRUaW1lKCkhPT1hLmdldFRpbWUoKSl9ZnVuY3Rpb24gcChhKXtyZXR1cm4gdihhKSYmIWhhKGEpP2QoYSl8fHZvaWQgMDphfU1kKGUsZixnLGgpO2xiKGUsZixnLGgsayxsKTt2YXIgcT1oJiZoLiRvcHRpb25zJiZoLiRvcHRpb25zLnRpbWV6b25lLHM7aC4kJHBhcnNlck5hbWU9YTtoLiRwYXJzZXJzLnB1c2goZnVuY3Rpb24oYSl7aWYoaC4kaXNFbXB0eShhKSlyZXR1cm4gbnVsbDtpZihiLnRlc3QoYSkpcmV0dXJuIGE9ZChhLHMpLHEmJihhPVRiKGEscSkpLGF9KTtoLiRmb3JtYXR0ZXJzLnB1c2goZnVuY3Rpb24oYSl7aWYoYSYmIWhhKGEpKXRocm93IG5iKCJkYXRlZm10IixhKTtpZihuKGEpKXJldHVybihzPWEpJiZxJiYocz1UYihzLHEsITApKSxtKCJkYXRlIikoYSxjLHEpO3M9bnVsbDtyZXR1cm4iIn0pO2lmKHYoZy5taW4pfHxnLm5nTWluKXt2YXIgejtoLiR2YWxpZGF0b3JzLm1pbj1mdW5jdGlvbihhKXtyZXR1cm4hbihhKXx8eSh6KXx8ZChhKT49Cnp9O2cuJG9ic2VydmUoIm1pbiIsZnVuY3Rpb24oYSl7ej1wKGEpO2guJHZhbGlkYXRlKCl9KX1pZih2KGcubWF4KXx8Zy5uZ01heCl7dmFyIHI7aC4kdmFsaWRhdG9ycy5tYXg9ZnVuY3Rpb24oYSl7cmV0dXJuIW4oYSl8fHkocil8fGQoYSk8PXJ9O2cuJG9ic2VydmUoIm1heCIsZnVuY3Rpb24oYSl7cj1wKGEpO2guJHZhbGlkYXRlKCl9KX19fWZ1bmN0aW9uIE1kKGEsYixkLGMpeyhjLiQkaGFzTmF0aXZlVmFsaWRhdG9ycz1KKGJbMF0udmFsaWRpdHkpKSYmYy4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uKGEpe3ZhciBjPWIucHJvcCgidmFsaWRpdHkiKXx8e307cmV0dXJuIGMuYmFkSW5wdXR8fGMudHlwZU1pc21hdGNoP3ZvaWQgMDphfSl9ZnVuY3Rpb24gTmQoYSxiLGQsYyxlKXtpZih2KGMpKXthPWEoYyk7aWYoIWEuY29uc3RhbnQpdGhyb3cgbmIoImNvbnN0ZXhwciIsZCxjKTtyZXR1cm4gYShiKX1yZXR1cm4gZX1mdW5jdGlvbiBwYyhhLGIpe2E9Im5nQ2xhc3MiK2E7cmV0dXJuWyIkYW5pbWF0ZSIsCmZ1bmN0aW9uKGQpe2Z1bmN0aW9uIGMoYSxiKXt2YXIgYz1bXSxkPTA7YTpmb3IoO2Q8YS5sZW5ndGg7ZCsrKXtmb3IodmFyIGU9YVtkXSxtPTA7bTxiLmxlbmd0aDttKyspaWYoZT09YlttXSljb250aW51ZSBhO2MucHVzaChlKX1yZXR1cm4gY31mdW5jdGlvbiBlKGEpe3ZhciBiPVtdO3JldHVybiBLKGEpPyhxKGEsZnVuY3Rpb24oYSl7Yj1iLmNvbmNhdChlKGEpKX0pLGIpOkkoYSk/YS5zcGxpdCgiICIpOkooYSk/KHEoYSxmdW5jdGlvbihhLGMpe2EmJihiPWIuY29uY2F0KGMuc3BsaXQoIiAiKSkpfSksYik6YX1yZXR1cm57cmVzdHJpY3Q6IkFDIixsaW5rOmZ1bmN0aW9uKGYsZyxoKXtmdW5jdGlvbiBrKGEpe2E9bChhLDEpO2guJGFkZENsYXNzKGEpfWZ1bmN0aW9uIGwoYSxiKXt2YXIgYz1nLmRhdGEoIiRjbGFzc0NvdW50cyIpfHxTKCksZD1bXTtxKGEsZnVuY3Rpb24oYSl7aWYoMDxifHxjW2FdKWNbYV09KGNbYV18fDApK2IsY1thXT09PSsoMDxiKSYmZC5wdXNoKGEpfSk7Zy5kYXRhKCIkY2xhc3NDb3VudHMiLApjKTtyZXR1cm4gZC5qb2luKCIgIil9ZnVuY3Rpb24gbShhLGIpe3ZhciBlPWMoYixhKSxmPWMoYSxiKSxlPWwoZSwxKSxmPWwoZiwtMSk7ZSYmZS5sZW5ndGgmJmQuYWRkQ2xhc3MoZyxlKTtmJiZmLmxlbmd0aCYmZC5yZW1vdmVDbGFzcyhnLGYpfWZ1bmN0aW9uIG4oYSl7aWYoITA9PT1ifHwoZi4kaW5kZXgmMSk9PT1iKXt2YXIgYz1lKGF8fFtdKTtpZighcClrKGMpO2Vsc2UgaWYoIW5hKGEscCkpe3ZhciBkPWUocCk7bShkLGMpfX1wPUsoYSk/YS5tYXAoZnVuY3Rpb24oYSl7cmV0dXJuIGZhKGEpfSk6ZmEoYSl9dmFyIHA7Zi4kd2F0Y2goaFthXSxuLCEwKTtoLiRvYnNlcnZlKCJjbGFzcyIsZnVuY3Rpb24oYil7bihmLiRldmFsKGhbYV0pKX0pOyJuZ0NsYXNzIiE9PWEmJmYuJHdhdGNoKCIkaW5kZXgiLGZ1bmN0aW9uKGMsZCl7dmFyIGc9YyYxO2lmKGchPT0oZCYxKSl7dmFyIG09ZShmLiRldmFsKGhbYV0pKTtnPT09Yj9rKG0pOihnPWwobSwtMSksaC4kcmVtb3ZlQ2xhc3MoZykpfX0pfX19XX0KZnVuY3Rpb24gS2QoYSl7ZnVuY3Rpb24gYihhLGIpe2ImJiFmW2FdPyhrLmFkZENsYXNzKGUsYSksZlthXT0hMCk6IWImJmZbYV0mJihrLnJlbW92ZUNsYXNzKGUsYSksZlthXT0hMSl9ZnVuY3Rpb24gZChhLGMpe2E9YT8iLSIrQmMoYSwiLSIpOiIiO2Iob2IrYSwhMD09PWMpO2IoT2QrYSwhMT09PWMpfXZhciBjPWEuY3RybCxlPWEuJGVsZW1lbnQsZj17fSxnPWEuc2V0LGg9YS51bnNldCxrPWEuJGFuaW1hdGU7ZltPZF09IShmW29iXT1lLmhhc0NsYXNzKG9iKSk7Yy4kc2V0VmFsaWRpdHk9ZnVuY3Rpb24oYSxlLGYpe3koZSk/KGMuJHBlbmRpbmd8fChjLiRwZW5kaW5nPXt9KSxnKGMuJHBlbmRpbmcsYSxmKSk6KGMuJHBlbmRpbmcmJmgoYy4kcGVuZGluZyxhLGYpLFBkKGMuJHBlbmRpbmcpJiYoYy4kcGVuZGluZz12b2lkIDApKTtFYShlKT9lPyhoKGMuJGVycm9yLGEsZiksZyhjLiQkc3VjY2VzcyxhLGYpKTooZyhjLiRlcnJvcixhLGYpLGgoYy4kJHN1Y2Nlc3MsYSxmKSk6KGgoYy4kZXJyb3IsCmEsZiksaChjLiQkc3VjY2VzcyxhLGYpKTtjLiRwZW5kaW5nPyhiKFFkLCEwKSxjLiR2YWxpZD1jLiRpbnZhbGlkPXZvaWQgMCxkKCIiLG51bGwpKTooYihRZCwhMSksYy4kdmFsaWQ9UGQoYy4kZXJyb3IpLGMuJGludmFsaWQ9IWMuJHZhbGlkLGQoIiIsYy4kdmFsaWQpKTtlPWMuJHBlbmRpbmcmJmMuJHBlbmRpbmdbYV0/dm9pZCAwOmMuJGVycm9yW2FdPyExOmMuJCRzdWNjZXNzW2FdPyEwOm51bGw7ZChhLGUpO2MuJCRwYXJlbnRGb3JtLiRzZXRWYWxpZGl0eShhLGUsYyl9fWZ1bmN0aW9uIFBkKGEpe2lmKGEpZm9yKHZhciBiIGluIGEpaWYoYS5oYXNPd25Qcm9wZXJ0eShiKSlyZXR1cm4hMTtyZXR1cm4hMH12YXIgQmc9L15cLyguKylcLyhbYS16XSopJC8sc2E9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxMPWZ1bmN0aW9uKGEpe3JldHVybiBJKGEpP2EudG9Mb3dlckNhc2UoKTphfSx1Yj1mdW5jdGlvbihhKXtyZXR1cm4gSShhKT9hLnRvVXBwZXJDYXNlKCk6YX0sQmEsCkcsWSx5YT1bXS5zbGljZSxhZz1bXS5zcGxpY2UsQ2c9W10ucHVzaCxqYT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLHZjPU9iamVjdC5nZXRQcm90b3R5cGVPZix6YT1PKCJuZyIpLGRhPUYuYW5ndWxhcnx8KEYuYW5ndWxhcj17fSksVmIscGI9MDtCYT1GLmRvY3VtZW50LmRvY3VtZW50TW9kZTtDLiRpbmplY3Q9W107WWEuJGluamVjdD1bXTt2YXIgSz1BcnJheS5pc0FycmF5LGFlPS9eXFtvYmplY3QgKD86VWludDh8VWludDhDbGFtcGVkfFVpbnQxNnxVaW50MzJ8SW50OHxJbnQxNnxJbnQzMnxGbG9hdDMyfEZsb2F0NjQpQXJyYXlcXSQvLFY9ZnVuY3Rpb24oYSl7cmV0dXJuIEkoYSk/YS50cmltKCk6YX0sd2Q9ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSgvKFstKClcW1xde30rPyouJFxefCw6IzwhXFxdKS9nLCJcXCQxIikucmVwbGFjZSgvXHgwOC9nLCJcXHgwOCIpfSxGYT1mdW5jdGlvbigpe2lmKCF2KEZhLnJ1bGVzKSl7dmFyIGE9Ri5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbbmctY3NwXSIpfHwKRi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1uZy1jc3BdIik7aWYoYSl7dmFyIGI9YS5nZXRBdHRyaWJ1dGUoIm5nLWNzcCIpfHxhLmdldEF0dHJpYnV0ZSgiZGF0YS1uZy1jc3AiKTtGYS5ydWxlcz17bm9VbnNhZmVFdmFsOiFifHwtMSE9PWIuaW5kZXhPZigibm8tdW5zYWZlLWV2YWwiKSxub0lubGluZVN0eWxlOiFifHwtMSE9PWIuaW5kZXhPZigibm8taW5saW5lLXN0eWxlIil9fWVsc2V7YT1GYTt0cnl7bmV3IEZ1bmN0aW9uKCIiKSxiPSExfWNhdGNoKGQpe2I9ITB9YS5ydWxlcz17bm9VbnNhZmVFdmFsOmIsbm9JbmxpbmVTdHlsZTohMX19fXJldHVybiBGYS5ydWxlc30scmI9ZnVuY3Rpb24oKXtpZih2KHJiLm5hbWVfKSlyZXR1cm4gcmIubmFtZV87dmFyIGEsYixkPU9hLmxlbmd0aCxjLGU7Zm9yKGI9MDtiPGQ7KytiKWlmKGM9T2FbYl0sYT1GLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIlsiK2MucmVwbGFjZSgiOiIsIlxcOiIpKyJqcV0iKSl7ZT1hLmdldEF0dHJpYnV0ZShjKwoianEiKTticmVha31yZXR1cm4gcmIubmFtZV89ZX0sZGU9LzovZyxPYT1bIm5nLSIsImRhdGEtbmctIiwibmc6IiwieC1uZy0iXSxpZT0vW0EtWl0vZyxDYz0hMSxOYT0zLG1lPXtmdWxsOiIxLjUuNiIsbWFqb3I6MSxtaW5vcjo1LGRvdDo2LGNvZGVOYW1lOiJhcnJvdy1zdHJpbmdpZmljYXRpb24ifTtULmV4cGFuZG89Im5nMzM5Ijt2YXIgZ2I9VC5jYWNoZT17fSxPZj0xO1QuX2RhdGE9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuY2FjaGVbYVt0aGlzLmV4cGFuZG9dXXx8e319O3ZhciBKZj0vKFtcOlwtXF9dKyguKSkvZyxLZj0vXm1veihbQS1aXSkvLHliPXttb3VzZWxlYXZlOiJtb3VzZW91dCIsbW91c2VlbnRlcjoibW91c2VvdmVyIn0sWGI9TygianFMaXRlIiksTmY9L148KFtcdy1dKylccypcLz8+KD86PFwvXDE+fCkkLyxXYj0vPHwmIz9cdys7LyxMZj0vPChbXHc6LV0rKS8sTWY9LzwoPyFhcmVhfGJyfGNvbHxlbWJlZHxocnxpbWd8aW5wdXR8bGlua3xtZXRhfHBhcmFtKSgoW1x3Oi1dKylbXj5dKilcLz4vZ2ksCmdhPXtvcHRpb246WzEsJzxzZWxlY3QgbXVsdGlwbGU9Im11bHRpcGxlIj4nLCI8L3NlbGVjdD4iXSx0aGVhZDpbMSwiPHRhYmxlPiIsIjwvdGFibGU+Il0sY29sOlsyLCI8dGFibGU+PGNvbGdyb3VwPiIsIjwvY29sZ3JvdXA+PC90YWJsZT4iXSx0cjpbMiwiPHRhYmxlPjx0Ym9keT4iLCI8L3Rib2R5PjwvdGFibGU+Il0sdGQ6WzMsIjx0YWJsZT48dGJvZHk+PHRyPiIsIjwvdHI+PC90Ym9keT48L3RhYmxlPiJdLF9kZWZhdWx0OlswLCIiLCIiXX07Z2Eub3B0Z3JvdXA9Z2Eub3B0aW9uO2dhLnRib2R5PWdhLnRmb290PWdhLmNvbGdyb3VwPWdhLmNhcHRpb249Z2EudGhlYWQ7Z2EudGg9Z2EudGQ7dmFyIFRmPUYuTm9kZS5wcm90b3R5cGUuY29udGFpbnN8fGZ1bmN0aW9uKGEpe3JldHVybiEhKHRoaXMuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYSkmMTYpfSxQYT1ULnByb3RvdHlwZT17cmVhZHk6ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYigpe2R8fChkPSEwLGEoKSl9dmFyIGQ9ITE7ImNvbXBsZXRlIj09PQpGLmRvY3VtZW50LnJlYWR5U3RhdGU/Ri5zZXRUaW1lb3V0KGIpOih0aGlzLm9uKCJET01Db250ZW50TG9hZGVkIixiKSxUKEYpLm9uKCJsb2FkIixiKSl9LHRvU3RyaW5nOmZ1bmN0aW9uKCl7dmFyIGE9W107cSh0aGlzLGZ1bmN0aW9uKGIpe2EucHVzaCgiIitiKX0pO3JldHVybiJbIithLmpvaW4oIiwgIikrIl0ifSxlcTpmdW5jdGlvbihhKXtyZXR1cm4gMDw9YT9HKHRoaXNbYV0pOkcodGhpc1t0aGlzLmxlbmd0aCthXSl9LGxlbmd0aDowLHB1c2g6Q2csc29ydDpbXS5zb3J0LHNwbGljZTpbXS5zcGxpY2V9LEViPXt9O3EoIm11bHRpcGxlIHNlbGVjdGVkIGNoZWNrZWQgZGlzYWJsZWQgcmVhZE9ubHkgcmVxdWlyZWQgb3BlbiIuc3BsaXQoIiAiKSxmdW5jdGlvbihhKXtFYltMKGEpXT1hfSk7dmFyIFVjPXt9O3EoImlucHV0IHNlbGVjdCBvcHRpb24gdGV4dGFyZWEgYnV0dG9uIGZvcm0gZGV0YWlscyIuc3BsaXQoIiAiKSxmdW5jdGlvbihhKXtVY1thXT0hMH0pO3ZhciBiZD17bmdNaW5sZW5ndGg6Im1pbmxlbmd0aCIsCm5nTWF4bGVuZ3RoOiJtYXhsZW5ndGgiLG5nTWluOiJtaW4iLG5nTWF4OiJtYXgiLG5nUGF0dGVybjoicGF0dGVybiJ9O3Eoe2RhdGE6WmIscmVtb3ZlRGF0YTpmYixoYXNEYXRhOmZ1bmN0aW9uKGEpe2Zvcih2YXIgYiBpbiBnYlthLm5nMzM5XSlyZXR1cm4hMDtyZXR1cm4hMX0sY2xlYW5EYXRhOmZ1bmN0aW9uKGEpe2Zvcih2YXIgYj0wLGQ9YS5sZW5ndGg7YjxkO2IrKylmYihhW2JdKX19LGZ1bmN0aW9uKGEsYil7VFtiXT1hfSk7cSh7ZGF0YTpaYixpbmhlcml0ZWREYXRhOkNiLHNjb3BlOmZ1bmN0aW9uKGEpe3JldHVybiBHLmRhdGEoYSwiJHNjb3BlIil8fENiKGEucGFyZW50Tm9kZXx8YSxbIiRpc29sYXRlU2NvcGUiLCIkc2NvcGUiXSl9LGlzb2xhdGVTY29wZTpmdW5jdGlvbihhKXtyZXR1cm4gRy5kYXRhKGEsIiRpc29sYXRlU2NvcGUiKXx8Ry5kYXRhKGEsIiRpc29sYXRlU2NvcGVOb1RlbXBsYXRlIil9LGNvbnRyb2xsZXI6UmMsaW5qZWN0b3I6ZnVuY3Rpb24oYSl7cmV0dXJuIENiKGEsCiIkaW5qZWN0b3IiKX0scmVtb3ZlQXR0cjpmdW5jdGlvbihhLGIpe2EucmVtb3ZlQXR0cmlidXRlKGIpfSxoYXNDbGFzczp6Yixjc3M6ZnVuY3Rpb24oYSxiLGQpe2I9ZWIoYik7aWYodihkKSlhLnN0eWxlW2JdPWQ7ZWxzZSByZXR1cm4gYS5zdHlsZVtiXX0sYXR0cjpmdW5jdGlvbihhLGIsZCl7dmFyIGM9YS5ub2RlVHlwZTtpZihjIT09TmEmJjIhPT1jJiY4IT09YylpZihjPUwoYiksRWJbY10paWYodihkKSlkPyhhW2JdPSEwLGEuc2V0QXR0cmlidXRlKGIsYykpOihhW2JdPSExLGEucmVtb3ZlQXR0cmlidXRlKGMpKTtlbHNlIHJldHVybiBhW2JdfHwoYS5hdHRyaWJ1dGVzLmdldE5hbWVkSXRlbShiKXx8Qykuc3BlY2lmaWVkP2M6dm9pZCAwO2Vsc2UgaWYodihkKSlhLnNldEF0dHJpYnV0ZShiLGQpO2Vsc2UgaWYoYS5nZXRBdHRyaWJ1dGUpcmV0dXJuIGE9YS5nZXRBdHRyaWJ1dGUoYiwyKSxudWxsPT09YT92b2lkIDA6YX0scHJvcDpmdW5jdGlvbihhLGIsZCl7aWYodihkKSlhW2JdPQpkO2Vsc2UgcmV0dXJuIGFbYl19LHRleHQ6ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGEsZCl7aWYoeShkKSl7dmFyIGM9YS5ub2RlVHlwZTtyZXR1cm4gMT09PWN8fGM9PT1OYT9hLnRleHRDb250ZW50OiIifWEudGV4dENvbnRlbnQ9ZH1hLiRkdj0iIjtyZXR1cm4gYX0oKSx2YWw6ZnVuY3Rpb24oYSxiKXtpZih5KGIpKXtpZihhLm11bHRpcGxlJiYic2VsZWN0Ij09PXRhKGEpKXt2YXIgZD1bXTtxKGEub3B0aW9ucyxmdW5jdGlvbihhKXthLnNlbGVjdGVkJiZkLnB1c2goYS52YWx1ZXx8YS50ZXh0KX0pO3JldHVybiAwPT09ZC5sZW5ndGg/bnVsbDpkfXJldHVybiBhLnZhbHVlfWEudmFsdWU9Yn0saHRtbDpmdW5jdGlvbihhLGIpe2lmKHkoYikpcmV0dXJuIGEuaW5uZXJIVE1MO3diKGEsITApO2EuaW5uZXJIVE1MPWJ9LGVtcHR5OlNjfSxmdW5jdGlvbihhLGIpe1QucHJvdG90eXBlW2JdPWZ1bmN0aW9uKGIsYyl7dmFyIGUsZixnPXRoaXMubGVuZ3RoO2lmKGEhPT1TYyYmeSgyPT1hLmxlbmd0aCYmCmEhPT16YiYmYSE9PVJjP2I6Yykpe2lmKEooYikpe2ZvcihlPTA7ZTxnO2UrKylpZihhPT09WmIpYSh0aGlzW2VdLGIpO2Vsc2UgZm9yKGYgaW4gYilhKHRoaXNbZV0sZixiW2ZdKTtyZXR1cm4gdGhpc31lPWEuJGR2O2c9eShlKT9NYXRoLm1pbihnLDEpOmc7Zm9yKGY9MDtmPGc7ZisrKXt2YXIgaD1hKHRoaXNbZl0sYixjKTtlPWU/ZStoOmh9cmV0dXJuIGV9Zm9yKGU9MDtlPGc7ZSsrKWEodGhpc1tlXSxiLGMpO3JldHVybiB0aGlzfX0pO3Eoe3JlbW92ZURhdGE6ZmIsb246ZnVuY3Rpb24oYSxiLGQsYyl7aWYodihjKSl0aHJvdyBYYigib25hcmdzIik7aWYoTWMoYSkpe2M9eGIoYSwhMCk7dmFyIGU9Yy5ldmVudHMsZj1jLmhhbmRsZTtmfHwoZj1jLmhhbmRsZT1RZihhLGUpKTtjPTA8PWIuaW5kZXhPZigiICIpP2Iuc3BsaXQoIiAiKTpbYl07Zm9yKHZhciBnPWMubGVuZ3RoLGg9ZnVuY3Rpb24oYixjLGcpe3ZhciBoPWVbYl07aHx8KGg9ZVtiXT1bXSxoLnNwZWNpYWxIYW5kbGVyV3JhcHBlcj0KYywiJGRlc3Ryb3kiPT09Ynx8Z3x8YS5hZGRFdmVudExpc3RlbmVyKGIsZiwhMSkpO2gucHVzaChkKX07Zy0tOyliPWNbZ10seWJbYl0/KGgoeWJbYl0sU2YpLGgoYix2b2lkIDAsITApKTpoKGIpfX0sb2ZmOlFjLG9uZTpmdW5jdGlvbihhLGIsZCl7YT1HKGEpO2Eub24oYixmdW5jdGlvbiBlKCl7YS5vZmYoYixkKTthLm9mZihiLGUpfSk7YS5vbihiLGQpfSxyZXBsYWNlV2l0aDpmdW5jdGlvbihhLGIpe3ZhciBkLGM9YS5wYXJlbnROb2RlO3diKGEpO3EobmV3IFQoYiksZnVuY3Rpb24oYil7ZD9jLmluc2VydEJlZm9yZShiLGQubmV4dFNpYmxpbmcpOmMucmVwbGFjZUNoaWxkKGIsYSk7ZD1ifSl9LGNoaWxkcmVuOmZ1bmN0aW9uKGEpe3ZhciBiPVtdO3EoYS5jaGlsZE5vZGVzLGZ1bmN0aW9uKGEpezE9PT1hLm5vZGVUeXBlJiZiLnB1c2goYSl9KTtyZXR1cm4gYn0sY29udGVudHM6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuY29udGVudERvY3VtZW50fHxhLmNoaWxkTm9kZXN8fFtdfSxhcHBlbmQ6ZnVuY3Rpb24oYSwKYil7dmFyIGQ9YS5ub2RlVHlwZTtpZigxPT09ZHx8MTE9PT1kKXtiPW5ldyBUKGIpO2Zvcih2YXIgZD0wLGM9Yi5sZW5ndGg7ZDxjO2QrKylhLmFwcGVuZENoaWxkKGJbZF0pfX0scHJlcGVuZDpmdW5jdGlvbihhLGIpe2lmKDE9PT1hLm5vZGVUeXBlKXt2YXIgZD1hLmZpcnN0Q2hpbGQ7cShuZXcgVChiKSxmdW5jdGlvbihiKXthLmluc2VydEJlZm9yZShiLGQpfSl9fSx3cmFwOmZ1bmN0aW9uKGEsYil7T2MoYSxHKGIpLmVxKDApLmNsb25lKClbMF0pfSxyZW1vdmU6RGIsZGV0YWNoOmZ1bmN0aW9uKGEpe0RiKGEsITApfSxhZnRlcjpmdW5jdGlvbihhLGIpe3ZhciBkPWEsYz1hLnBhcmVudE5vZGU7Yj1uZXcgVChiKTtmb3IodmFyIGU9MCxmPWIubGVuZ3RoO2U8ZjtlKyspe3ZhciBnPWJbZV07Yy5pbnNlcnRCZWZvcmUoZyxkLm5leHRTaWJsaW5nKTtkPWd9fSxhZGRDbGFzczpCYixyZW1vdmVDbGFzczpBYix0b2dnbGVDbGFzczpmdW5jdGlvbihhLGIsZCl7YiYmcShiLnNwbGl0KCIgIiksCmZ1bmN0aW9uKGIpe3ZhciBlPWQ7eShlKSYmKGU9IXpiKGEsYikpOyhlP0JiOkFiKShhLGIpfSl9LHBhcmVudDpmdW5jdGlvbihhKXtyZXR1cm4oYT1hLnBhcmVudE5vZGUpJiYxMSE9PWEubm9kZVR5cGU/YTpudWxsfSxuZXh0OmZ1bmN0aW9uKGEpe3JldHVybiBhLm5leHRFbGVtZW50U2libGluZ30sZmluZDpmdW5jdGlvbihhLGIpe3JldHVybiBhLmdldEVsZW1lbnRzQnlUYWdOYW1lP2EuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYik6W119LGNsb25lOlliLHRyaWdnZXJIYW5kbGVyOmZ1bmN0aW9uKGEsYixkKXt2YXIgYyxlLGY9Yi50eXBlfHxiLGc9eGIoYSk7aWYoZz0oZz1nJiZnLmV2ZW50cykmJmdbZl0pYz17cHJldmVudERlZmF1bHQ6ZnVuY3Rpb24oKXt0aGlzLmRlZmF1bHRQcmV2ZW50ZWQ9ITB9LGlzRGVmYXVsdFByZXZlbnRlZDpmdW5jdGlvbigpe3JldHVybiEwPT09dGhpcy5kZWZhdWx0UHJldmVudGVkfSxzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb246ZnVuY3Rpb24oKXt0aGlzLmltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZD0KITB9LGlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOmZ1bmN0aW9uKCl7cmV0dXJuITA9PT10aGlzLmltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZH0sc3RvcFByb3BhZ2F0aW9uOkMsdHlwZTpmLHRhcmdldDphfSxiLnR5cGUmJihjPVAoYyxiKSksYj1mYShnKSxlPWQ/W2NdLmNvbmNhdChkKTpbY10scShiLGZ1bmN0aW9uKGIpe2MuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKXx8Yi5hcHBseShhLGUpfSl9fSxmdW5jdGlvbihhLGIpe1QucHJvdG90eXBlW2JdPWZ1bmN0aW9uKGIsYyxlKXtmb3IodmFyIGYsZz0wLGg9dGhpcy5sZW5ndGg7ZzxoO2crKyl5KGYpPyhmPWEodGhpc1tnXSxiLGMsZSksdihmKSYmKGY9RyhmKSkpOlBjKGYsYSh0aGlzW2ddLGIsYyxlKSk7cmV0dXJuIHYoZik/Zjp0aGlzfTtULnByb3RvdHlwZS5iaW5kPVQucHJvdG90eXBlLm9uO1QucHJvdG90eXBlLnVuYmluZD1ULnByb3RvdHlwZS5vZmZ9KTtTYS5wcm90b3R5cGU9e3B1dDpmdW5jdGlvbihhLApiKXt0aGlzW0dhKGEsdGhpcy5uZXh0VWlkKV09Yn0sZ2V0OmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzW0dhKGEsdGhpcy5uZXh0VWlkKV19LHJlbW92ZTpmdW5jdGlvbihhKXt2YXIgYj10aGlzW2E9R2EoYSx0aGlzLm5leHRVaWQpXTtkZWxldGUgdGhpc1thXTtyZXR1cm4gYn19O3ZhciBIZj1bZnVuY3Rpb24oKXt0aGlzLiRnZXQ9W2Z1bmN0aW9uKCl7cmV0dXJuIFNhfV19XSxWZj0vXihbXlwoXSs/KT0+LyxXZj0vXlteXChdKlwoXHMqKFteXCldKilcKS9tLERnPS8sLyxFZz0vXlxzKihfPykoXFMrPylcMVxzKiQvLFVmPS8oKFwvXC8uKiQpfChcL1wqW1xzXFNdKj9cKlwvKSkvbWcsSGE9TygiJGluamVjdG9yIik7ZGIuJCRhbm5vdGF0ZT1mdW5jdGlvbihhLGIsZCl7dmFyIGM7aWYoImZ1bmN0aW9uIj09PXR5cGVvZiBhKXtpZighKGM9YS4kaW5qZWN0KSl7Yz1bXTtpZihhLmxlbmd0aCl7aWYoYil0aHJvdyBJKGQpJiZkfHwoZD1hLm5hbWV8fFhmKGEpKSxIYSgic3RyaWN0ZGkiLGQpOwpiPVZjKGEpO3EoYlsxXS5zcGxpdChEZyksZnVuY3Rpb24oYSl7YS5yZXBsYWNlKEVnLGZ1bmN0aW9uKGEsYixkKXtjLnB1c2goZCl9KX0pfWEuJGluamVjdD1jfX1lbHNlIEsoYSk/KGI9YS5sZW5ndGgtMSxRYShhW2JdLCJmbiIpLGM9YS5zbGljZSgwLGIpKTpRYShhLCJmbiIsITApO3JldHVybiBjfTt2YXIgUmQ9TygiJGFuaW1hdGUiKSwkZT1mdW5jdGlvbigpe3RoaXMuJGdldD1DfSxhZj1mdW5jdGlvbigpe3ZhciBhPW5ldyBTYSxiPVtdO3RoaXMuJGdldD1bIiQkQW5pbWF0ZVJ1bm5lciIsIiRyb290U2NvcGUiLGZ1bmN0aW9uKGQsYyl7ZnVuY3Rpb24gZShhLGIsYyl7dmFyIGQ9ITE7YiYmKGI9SShiKT9iLnNwbGl0KCIgIik6SyhiKT9iOltdLHEoYixmdW5jdGlvbihiKXtiJiYoZD0hMCxhW2JdPWMpfSkpO3JldHVybiBkfWZ1bmN0aW9uIGYoKXtxKGIsZnVuY3Rpb24oYil7dmFyIGM9YS5nZXQoYik7aWYoYyl7dmFyIGQ9WWYoYi5hdHRyKCJjbGFzcyIpKSxlPSIiLGY9IiI7cShjLApmdW5jdGlvbihhLGIpe2EhPT0hIWRbYl0mJihhP2UrPShlLmxlbmd0aD8iICI6IiIpK2I6Zis9KGYubGVuZ3RoPyIgIjoiIikrYil9KTtxKGIsZnVuY3Rpb24oYSl7ZSYmQmIoYSxlKTtmJiZBYihhLGYpfSk7YS5yZW1vdmUoYil9fSk7Yi5sZW5ndGg9MH1yZXR1cm57ZW5hYmxlZDpDLG9uOkMsb2ZmOkMscGluOkMscHVzaDpmdW5jdGlvbihnLGgsayxsKXtsJiZsKCk7az1rfHx7fTtrLmZyb20mJmcuY3NzKGsuZnJvbSk7ay50byYmZy5jc3Moay50byk7aWYoay5hZGRDbGFzc3x8ay5yZW1vdmVDbGFzcylpZihoPWsuYWRkQ2xhc3MsbD1rLnJlbW92ZUNsYXNzLGs9YS5nZXQoZyl8fHt9LGg9ZShrLGgsITApLGw9ZShrLGwsITEpLGh8fGwpYS5wdXQoZyxrKSxiLnB1c2goZyksMT09PWIubGVuZ3RoJiZjLiQkcG9zdERpZ2VzdChmKTtnPW5ldyBkO2cuY29tcGxldGUoKTtyZXR1cm4gZ319fV19LFllPVsiJHByb3ZpZGUiLGZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7dGhpcy4kJHJlZ2lzdGVyZWRBbmltYXRpb25zPQpPYmplY3QuY3JlYXRlKG51bGwpO3RoaXMucmVnaXN0ZXI9ZnVuY3Rpb24oZCxjKXtpZihkJiYiLiIhPT1kLmNoYXJBdCgwKSl0aHJvdyBSZCgibm90Y3NlbCIsZCk7dmFyIGU9ZCsiLWFuaW1hdGlvbiI7Yi4kJHJlZ2lzdGVyZWRBbmltYXRpb25zW2Quc3Vic3RyKDEpXT1lO2EuZmFjdG9yeShlLGMpfTt0aGlzLmNsYXNzTmFtZUZpbHRlcj1mdW5jdGlvbihhKXtpZigxPT09YXJndW1lbnRzLmxlbmd0aCYmKHRoaXMuJCRjbGFzc05hbWVGaWx0ZXI9YSBpbnN0YW5jZW9mIFJlZ0V4cD9hOm51bGwpJiYvKFxzK3xcLyluZy1hbmltYXRlKFxzK3xcLykvLnRlc3QodGhpcy4kJGNsYXNzTmFtZUZpbHRlci50b1N0cmluZygpKSl0aHJvdyBSZCgibm9uZ2NscyIsIm5nLWFuaW1hdGUiKTtyZXR1cm4gdGhpcy4kJGNsYXNzTmFtZUZpbHRlcn07dGhpcy4kZ2V0PVsiJCRhbmltYXRlUXVldWUiLGZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYSxjLGQpe2lmKGQpe3ZhciBoO2E6e2ZvcihoPTA7aDxkLmxlbmd0aDtoKyspe3ZhciBrPQpkW2hdO2lmKDE9PT1rLm5vZGVUeXBlKXtoPWs7YnJlYWsgYX19aD12b2lkIDB9IWh8fGgucGFyZW50Tm9kZXx8aC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nfHwoZD1udWxsKX1kP2QuYWZ0ZXIoYSk6Yy5wcmVwZW5kKGEpfXJldHVybntvbjphLm9uLG9mZjphLm9mZixwaW46YS5waW4sZW5hYmxlZDphLmVuYWJsZWQsY2FuY2VsOmZ1bmN0aW9uKGEpe2EuZW5kJiZhLmVuZCgpfSxlbnRlcjpmdW5jdGlvbihlLGYsZyxoKXtmPWYmJkcoZik7Zz1nJiZHKGcpO2Y9Znx8Zy5wYXJlbnQoKTtiKGUsZixnKTtyZXR1cm4gYS5wdXNoKGUsImVudGVyIixJYShoKSl9LG1vdmU6ZnVuY3Rpb24oZSxmLGcsaCl7Zj1mJiZHKGYpO2c9ZyYmRyhnKTtmPWZ8fGcucGFyZW50KCk7YihlLGYsZyk7cmV0dXJuIGEucHVzaChlLCJtb3ZlIixJYShoKSl9LGxlYXZlOmZ1bmN0aW9uKGIsYyl7cmV0dXJuIGEucHVzaChiLCJsZWF2ZSIsSWEoYyksZnVuY3Rpb24oKXtiLnJlbW92ZSgpfSl9LGFkZENsYXNzOmZ1bmN0aW9uKGIsCmMsZyl7Zz1JYShnKTtnLmFkZENsYXNzPWhiKGcuYWRkY2xhc3MsYyk7cmV0dXJuIGEucHVzaChiLCJhZGRDbGFzcyIsZyl9LHJlbW92ZUNsYXNzOmZ1bmN0aW9uKGIsYyxnKXtnPUlhKGcpO2cucmVtb3ZlQ2xhc3M9aGIoZy5yZW1vdmVDbGFzcyxjKTtyZXR1cm4gYS5wdXNoKGIsInJlbW92ZUNsYXNzIixnKX0sc2V0Q2xhc3M6ZnVuY3Rpb24oYixjLGcsaCl7aD1JYShoKTtoLmFkZENsYXNzPWhiKGguYWRkQ2xhc3MsYyk7aC5yZW1vdmVDbGFzcz1oYihoLnJlbW92ZUNsYXNzLGcpO3JldHVybiBhLnB1c2goYiwic2V0Q2xhc3MiLGgpfSxhbmltYXRlOmZ1bmN0aW9uKGIsYyxnLGgsayl7az1JYShrKTtrLmZyb209ay5mcm9tP1Aoay5mcm9tLGMpOmM7ay50bz1rLnRvP1Aoay50byxnKTpnO2sudGVtcENsYXNzZXM9aGIoay50ZW1wQ2xhc3NlcyxofHwibmctaW5saW5lLWFuaW1hdGUiKTtyZXR1cm4gYS5wdXNoKGIsImFuaW1hdGUiLGspfX19XX1dLGNmPWZ1bmN0aW9uKCl7dGhpcy4kZ2V0PQpbIiQkckFGIixmdW5jdGlvbihhKXtmdW5jdGlvbiBiKGIpe2QucHVzaChiKTsxPGQubGVuZ3RofHxhKGZ1bmN0aW9uKCl7Zm9yKHZhciBhPTA7YTxkLmxlbmd0aDthKyspZFthXSgpO2Q9W119KX12YXIgZD1bXTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgYT0hMTtiKGZ1bmN0aW9uKCl7YT0hMH0pO3JldHVybiBmdW5jdGlvbihkKXthP2QoKTpiKGQpfX19XX0sYmY9ZnVuY3Rpb24oKXt0aGlzLiRnZXQ9WyIkcSIsIiRzbmlmZmVyIiwiJCRhbmltYXRlQXN5bmNSdW4iLCIkZG9jdW1lbnQiLCIkdGltZW91dCIsZnVuY3Rpb24oYSxiLGQsYyxlKXtmdW5jdGlvbiBmKGEpe3RoaXMuc2V0SG9zdChhKTt2YXIgYj1kKCk7dGhpcy5fZG9uZUNhbGxiYWNrcz1bXTt0aGlzLl90aWNrPWZ1bmN0aW9uKGEpe3ZhciBkPWNbMF07ZCYmZC5oaWRkZW4/ZShhLDAsITEpOmIoYSl9O3RoaXMuX3N0YXRlPTB9Zi5jaGFpbj1mdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGMoKXtpZihkPT09YS5sZW5ndGgpYighMCk7CmVsc2UgYVtkXShmdW5jdGlvbihhKXshMT09PWE/YighMSk6KGQrKyxjKCkpfSl9dmFyIGQ9MDtjKCl9O2YuYWxsPWZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gYyhmKXtlPWUmJmY7KytkPT09YS5sZW5ndGgmJmIoZSl9dmFyIGQ9MCxlPSEwO3EoYSxmdW5jdGlvbihhKXthLmRvbmUoYyl9KX07Zi5wcm90b3R5cGU9e3NldEhvc3Q6ZnVuY3Rpb24oYSl7dGhpcy5ob3N0PWF8fHt9fSxkb25lOmZ1bmN0aW9uKGEpezI9PT10aGlzLl9zdGF0ZT9hKCk6dGhpcy5fZG9uZUNhbGxiYWNrcy5wdXNoKGEpfSxwcm9ncmVzczpDLGdldFByb21pc2U6ZnVuY3Rpb24oKXtpZighdGhpcy5wcm9taXNlKXt2YXIgYj10aGlzO3RoaXMucHJvbWlzZT1hKGZ1bmN0aW9uKGEsYyl7Yi5kb25lKGZ1bmN0aW9uKGIpeyExPT09Yj9jKCk6YSgpfSl9KX1yZXR1cm4gdGhpcy5wcm9taXNlfSx0aGVuOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuZ2V0UHJvbWlzZSgpLnRoZW4oYSxiKX0sImNhdGNoIjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5nZXRQcm9taXNlKClbImNhdGNoIl0oYSl9LAoiZmluYWxseSI6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZ2V0UHJvbWlzZSgpWyJmaW5hbGx5Il0oYSl9LHBhdXNlOmZ1bmN0aW9uKCl7dGhpcy5ob3N0LnBhdXNlJiZ0aGlzLmhvc3QucGF1c2UoKX0scmVzdW1lOmZ1bmN0aW9uKCl7dGhpcy5ob3N0LnJlc3VtZSYmdGhpcy5ob3N0LnJlc3VtZSgpfSxlbmQ6ZnVuY3Rpb24oKXt0aGlzLmhvc3QuZW5kJiZ0aGlzLmhvc3QuZW5kKCk7dGhpcy5fcmVzb2x2ZSghMCl9LGNhbmNlbDpmdW5jdGlvbigpe3RoaXMuaG9zdC5jYW5jZWwmJnRoaXMuaG9zdC5jYW5jZWwoKTt0aGlzLl9yZXNvbHZlKCExKX0sY29tcGxldGU6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpczswPT09Yi5fc3RhdGUmJihiLl9zdGF0ZT0xLGIuX3RpY2soZnVuY3Rpb24oKXtiLl9yZXNvbHZlKGEpfSkpfSxfcmVzb2x2ZTpmdW5jdGlvbihhKXsyIT09dGhpcy5fc3RhdGUmJihxKHRoaXMuX2RvbmVDYWxsYmFja3MsZnVuY3Rpb24oYil7YihhKX0pLHRoaXMuX2RvbmVDYWxsYmFja3MubGVuZ3RoPQowLHRoaXMuX3N0YXRlPTIpfX07cmV0dXJuIGZ9XX0sWmU9ZnVuY3Rpb24oKXt0aGlzLiRnZXQ9WyIkJHJBRiIsIiRxIiwiJCRBbmltYXRlUnVubmVyIixmdW5jdGlvbihhLGIsZCl7cmV0dXJuIGZ1bmN0aW9uKGIsZSl7ZnVuY3Rpb24gZigpe2EoZnVuY3Rpb24oKXtnLmFkZENsYXNzJiYoYi5hZGRDbGFzcyhnLmFkZENsYXNzKSxnLmFkZENsYXNzPW51bGwpO2cucmVtb3ZlQ2xhc3MmJihiLnJlbW92ZUNsYXNzKGcucmVtb3ZlQ2xhc3MpLGcucmVtb3ZlQ2xhc3M9bnVsbCk7Zy50byYmKGIuY3NzKGcudG8pLGcudG89bnVsbCk7aHx8ay5jb21wbGV0ZSgpO2g9ITB9KTtyZXR1cm4ga312YXIgZz1lfHx7fTtnLiQkcHJlcGFyZWR8fChnPW9hKGcpKTtnLmNsZWFudXBTdHlsZXMmJihnLmZyb209Zy50bz1udWxsKTtnLmZyb20mJihiLmNzcyhnLmZyb20pLGcuZnJvbT1udWxsKTt2YXIgaCxrPW5ldyBkO3JldHVybntzdGFydDpmLGVuZDpmfX19XX0sZWE9TygiJGNvbXBpbGUiKSxiYz1uZXcgZnVuY3Rpb24oKXt9OwpFYy4kaW5qZWN0PVsiJHByb3ZpZGUiLCIkJHNhbml0aXplVXJpUHJvdmlkZXIiXTtHYi5wcm90b3R5cGUuaXNGaXJzdENoYW5nZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLnByZXZpb3VzVmFsdWU9PT1iY307dmFyIFhjPS9eKCg/Onh8ZGF0YSlbXDpcLV9dKS9pLGJnPU8oIiRjb250cm9sbGVyIiksY2Q9L14oXFMrKShccythc1xzKyhbXHckXSspKT8kLyxqZj1mdW5jdGlvbigpe3RoaXMuJGdldD1bIiRkb2N1bWVudCIsZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKGIpe2I/IWIubm9kZVR5cGUmJmIgaW5zdGFuY2VvZiBHJiYoYj1iWzBdKTpiPWFbMF0uYm9keTtyZXR1cm4gYi5vZmZzZXRXaWR0aCsxfX1dfSxkZD0iYXBwbGljYXRpb24vanNvbiIsZWM9eyJDb250ZW50LVR5cGUiOmRkKyI7Y2hhcnNldD11dGYtOCJ9LGRnPS9eXFt8Xlx7KD8hXHspLyxlZz17IlsiOi9dJC8sInsiOi99JC99LGNnPS9eXClcXVx9Jyw/XG4vLEZnPU8oIiRodHRwIiksaGQ9ZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKCl7dGhyb3cgRmcoImxlZ2FjeSIsCmEpO319LEthPWRhLiRpbnRlcnBvbGF0ZU1pbkVycj1PKCIkaW50ZXJwb2xhdGUiKTtLYS50aHJvd05vY29uY2F0PWZ1bmN0aW9uKGEpe3Rocm93IEthKCJub2NvbmNhdCIsYSk7fTtLYS5pbnRlcnI9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gS2EoImludGVyciIsYSxiLnRvU3RyaW5nKCkpfTt2YXIgR2c9L14oW15cPyNdKikoXD8oW14jXSopKT8oIyguKikpPyQvLGdnPXtodHRwOjgwLGh0dHBzOjQ0MyxmdHA6MjF9LEhiPU8oIiRsb2NhdGlvbiIpLEhnPXskJGh0bWw1OiExLCQkcmVwbGFjZTohMSxhYnNVcmw6SWIoIiQkYWJzVXJsIiksdXJsOmZ1bmN0aW9uKGEpe2lmKHkoYSkpcmV0dXJuIHRoaXMuJCR1cmw7dmFyIGI9R2cuZXhlYyhhKTsoYlsxXXx8IiI9PT1hKSYmdGhpcy5wYXRoKGRlY29kZVVSSUNvbXBvbmVudChiWzFdKSk7KGJbMl18fGJbMV18fCIiPT09YSkmJnRoaXMuc2VhcmNoKGJbM118fCIiKTt0aGlzLmhhc2goYls1XXx8IiIpO3JldHVybiB0aGlzfSxwcm90b2NvbDpJYigiJCRwcm90b2NvbCIpLApob3N0OkliKCIkJGhvc3QiKSxwb3J0OkliKCIkJHBvcnQiKSxwYXRoOm1kKCIkJHBhdGgiLGZ1bmN0aW9uKGEpe2E9bnVsbCE9PWE/YS50b1N0cmluZygpOiIiO3JldHVybiIvIj09YS5jaGFyQXQoMCk/YToiLyIrYX0pLHNlYXJjaDpmdW5jdGlvbihhLGIpe3N3aXRjaChhcmd1bWVudHMubGVuZ3RoKXtjYXNlIDA6cmV0dXJuIHRoaXMuJCRzZWFyY2g7Y2FzZSAxOmlmKEkoYSl8fFEoYSkpYT1hLnRvU3RyaW5nKCksdGhpcy4kJHNlYXJjaD16YyhhKTtlbHNlIGlmKEooYSkpYT1vYShhLHt9KSxxKGEsZnVuY3Rpb24oYixjKXtudWxsPT1iJiZkZWxldGUgYVtjXX0pLHRoaXMuJCRzZWFyY2g9YTtlbHNlIHRocm93IEhiKCJpc3JjaGFyZyIpO2JyZWFrO2RlZmF1bHQ6eShiKXx8bnVsbD09PWI/ZGVsZXRlIHRoaXMuJCRzZWFyY2hbYV06dGhpcy4kJHNlYXJjaFthXT1ifXRoaXMuJCRjb21wb3NlKCk7cmV0dXJuIHRoaXN9LGhhc2g6bWQoIiQkaGFzaCIsZnVuY3Rpb24oYSl7cmV0dXJuIG51bGwhPT0KYT9hLnRvU3RyaW5nKCk6IiJ9KSxyZXBsYWNlOmZ1bmN0aW9uKCl7dGhpcy4kJHJlcGxhY2U9ITA7cmV0dXJuIHRoaXN9fTtxKFtsZCxoYyxnY10sZnVuY3Rpb24oYSl7YS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShIZyk7YS5wcm90b3R5cGUuc3RhdGU9ZnVuY3Rpb24oYil7aWYoIWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIHRoaXMuJCRzdGF0ZTtpZihhIT09Z2N8fCF0aGlzLiQkaHRtbDUpdGhyb3cgSGIoIm5vc3RhdGUiKTt0aGlzLiQkc3RhdGU9eShiKT9udWxsOmI7cmV0dXJuIHRoaXN9fSk7dmFyIGJhPU8oIiRwYXJzZSIpLGlnPUZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsLGpnPUZ1bmN0aW9uLnByb3RvdHlwZS5hcHBseSxrZz1GdW5jdGlvbi5wcm90b3R5cGUuYmluZCxQYj1TKCk7cSgiKyAtICogLyAlID09PSAhPT0gPT0gIT0gPCA+IDw9ID49ICYmIHx8ICEgPSB8Ii5zcGxpdCgiICIpLGZ1bmN0aW9uKGEpe1BiW2FdPSEwfSk7dmFyIElnPXtuOiJcbiIsZjoiXGYiLHI6IlxyIiwKdDoiXHQiLHY6Ilx2IiwiJyI6IiciLCciJzonIid9LGpjPWZ1bmN0aW9uKGEpe3RoaXMub3B0aW9ucz1hfTtqYy5wcm90b3R5cGU9e2NvbnN0cnVjdG9yOmpjLGxleDpmdW5jdGlvbihhKXt0aGlzLnRleHQ9YTt0aGlzLmluZGV4PTA7Zm9yKHRoaXMudG9rZW5zPVtdO3RoaXMuaW5kZXg8dGhpcy50ZXh0Lmxlbmd0aDspaWYoYT10aGlzLnRleHQuY2hhckF0KHRoaXMuaW5kZXgpLCciJz09PWF8fCInIj09PWEpdGhpcy5yZWFkU3RyaW5nKGEpO2Vsc2UgaWYodGhpcy5pc051bWJlcihhKXx8Ii4iPT09YSYmdGhpcy5pc051bWJlcih0aGlzLnBlZWsoKSkpdGhpcy5yZWFkTnVtYmVyKCk7ZWxzZSBpZih0aGlzLmlzSWRlbnRpZmllclN0YXJ0KHRoaXMucGVla011bHRpY2hhcigpKSl0aGlzLnJlYWRJZGVudCgpO2Vsc2UgaWYodGhpcy5pcyhhLCIoKXt9W10uLDs6PyIpKXRoaXMudG9rZW5zLnB1c2goe2luZGV4OnRoaXMuaW5kZXgsdGV4dDphfSksdGhpcy5pbmRleCsrO2Vsc2UgaWYodGhpcy5pc1doaXRlc3BhY2UoYSkpdGhpcy5pbmRleCsrOwplbHNle3ZhciBiPWErdGhpcy5wZWVrKCksZD1iK3RoaXMucGVlaygyKSxjPVBiW2JdLGU9UGJbZF07UGJbYV18fGN8fGU/KGE9ZT9kOmM/YjphLHRoaXMudG9rZW5zLnB1c2goe2luZGV4OnRoaXMuaW5kZXgsdGV4dDphLG9wZXJhdG9yOiEwfSksdGhpcy5pbmRleCs9YS5sZW5ndGgpOnRoaXMudGhyb3dFcnJvcigiVW5leHBlY3RlZCBuZXh0IGNoYXJhY3RlciAiLHRoaXMuaW5kZXgsdGhpcy5pbmRleCsxKX1yZXR1cm4gdGhpcy50b2tlbnN9LGlzOmZ1bmN0aW9uKGEsYil7cmV0dXJuLTEhPT1iLmluZGV4T2YoYSl9LHBlZWs6ZnVuY3Rpb24oYSl7YT1hfHwxO3JldHVybiB0aGlzLmluZGV4K2E8dGhpcy50ZXh0Lmxlbmd0aD90aGlzLnRleHQuY2hhckF0KHRoaXMuaW5kZXgrYSk6ITF9LGlzTnVtYmVyOmZ1bmN0aW9uKGEpe3JldHVybiIwIjw9YSYmIjkiPj1hJiYic3RyaW5nIj09PXR5cGVvZiBhfSxpc1doaXRlc3BhY2U6ZnVuY3Rpb24oYSl7cmV0dXJuIiAiPT09YXx8IlxyIj09PWF8fAoiXHQiPT09YXx8IlxuIj09PWF8fCJcdiI9PT1hfHwiXHUwMGEwIj09PWF9LGlzSWRlbnRpZmllclN0YXJ0OmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLm9wdGlvbnMuaXNJZGVudGlmaWVyU3RhcnQ/dGhpcy5vcHRpb25zLmlzSWRlbnRpZmllclN0YXJ0KGEsdGhpcy5jb2RlUG9pbnRBdChhKSk6dGhpcy5pc1ZhbGlkSWRlbnRpZmllclN0YXJ0KGEpfSxpc1ZhbGlkSWRlbnRpZmllclN0YXJ0OmZ1bmN0aW9uKGEpe3JldHVybiJhIjw9YSYmInoiPj1hfHwiQSI8PWEmJiJaIj49YXx8Il8iPT09YXx8IiQiPT09YX0saXNJZGVudGlmaWVyQ29udGludWU6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMub3B0aW9ucy5pc0lkZW50aWZpZXJDb250aW51ZT90aGlzLm9wdGlvbnMuaXNJZGVudGlmaWVyQ29udGludWUoYSx0aGlzLmNvZGVQb2ludEF0KGEpKTp0aGlzLmlzVmFsaWRJZGVudGlmaWVyQ29udGludWUoYSl9LGlzVmFsaWRJZGVudGlmaWVyQ29udGludWU6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5pc1ZhbGlkSWRlbnRpZmllclN0YXJ0KGEsCmIpfHx0aGlzLmlzTnVtYmVyKGEpfSxjb2RlUG9pbnRBdDpmdW5jdGlvbihhKXtyZXR1cm4gMT09PWEubGVuZ3RoP2EuY2hhckNvZGVBdCgwKTooYS5jaGFyQ29kZUF0KDApPDwxMCkrYS5jaGFyQ29kZUF0KDEpLTU2NjEzODg4fSxwZWVrTXVsdGljaGFyOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy50ZXh0LmNoYXJBdCh0aGlzLmluZGV4KSxiPXRoaXMucGVlaygpO2lmKCFiKXJldHVybiBhO3ZhciBkPWEuY2hhckNvZGVBdCgwKSxjPWIuY2hhckNvZGVBdCgwKTtyZXR1cm4gNTUyOTY8PWQmJjU2MzE5Pj1kJiY1NjMyMDw9YyYmNTczNDM+PWM/YStiOmF9LGlzRXhwT3BlcmF0b3I6ZnVuY3Rpb24oYSl7cmV0dXJuIi0iPT09YXx8IisiPT09YXx8dGhpcy5pc051bWJlcihhKX0sdGhyb3dFcnJvcjpmdW5jdGlvbihhLGIsZCl7ZD1kfHx0aGlzLmluZGV4O2I9dihiKT8icyAiK2IrIi0iK3RoaXMuaW5kZXgrIiBbIit0aGlzLnRleHQuc3Vic3RyaW5nKGIsZCkrIl0iOiIgIitkO3Rocm93IGJhKCJsZXhlcnIiLAphLGIsdGhpcy50ZXh0KTt9LHJlYWROdW1iZXI6ZnVuY3Rpb24oKXtmb3IodmFyIGE9IiIsYj10aGlzLmluZGV4O3RoaXMuaW5kZXg8dGhpcy50ZXh0Lmxlbmd0aDspe3ZhciBkPUwodGhpcy50ZXh0LmNoYXJBdCh0aGlzLmluZGV4KSk7aWYoIi4iPT1kfHx0aGlzLmlzTnVtYmVyKGQpKWErPWQ7ZWxzZXt2YXIgYz10aGlzLnBlZWsoKTtpZigiZSI9PWQmJnRoaXMuaXNFeHBPcGVyYXRvcihjKSlhKz1kO2Vsc2UgaWYodGhpcy5pc0V4cE9wZXJhdG9yKGQpJiZjJiZ0aGlzLmlzTnVtYmVyKGMpJiYiZSI9PWEuY2hhckF0KGEubGVuZ3RoLTEpKWErPWQ7ZWxzZSBpZighdGhpcy5pc0V4cE9wZXJhdG9yKGQpfHxjJiZ0aGlzLmlzTnVtYmVyKGMpfHwiZSIhPWEuY2hhckF0KGEubGVuZ3RoLTEpKWJyZWFrO2Vsc2UgdGhpcy50aHJvd0Vycm9yKCJJbnZhbGlkIGV4cG9uZW50Iil9dGhpcy5pbmRleCsrfXRoaXMudG9rZW5zLnB1c2goe2luZGV4OmIsdGV4dDphLGNvbnN0YW50OiEwLHZhbHVlOk51bWJlcihhKX0pfSwKcmVhZElkZW50OmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5pbmRleDtmb3IodGhpcy5pbmRleCs9dGhpcy5wZWVrTXVsdGljaGFyKCkubGVuZ3RoO3RoaXMuaW5kZXg8dGhpcy50ZXh0Lmxlbmd0aDspe3ZhciBiPXRoaXMucGVla011bHRpY2hhcigpO2lmKCF0aGlzLmlzSWRlbnRpZmllckNvbnRpbnVlKGIpKWJyZWFrO3RoaXMuaW5kZXgrPWIubGVuZ3RofXRoaXMudG9rZW5zLnB1c2goe2luZGV4OmEsdGV4dDp0aGlzLnRleHQuc2xpY2UoYSx0aGlzLmluZGV4KSxpZGVudGlmaWVyOiEwfSl9LHJlYWRTdHJpbmc6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5pbmRleDt0aGlzLmluZGV4Kys7Zm9yKHZhciBkPSIiLGM9YSxlPSExO3RoaXMuaW5kZXg8dGhpcy50ZXh0Lmxlbmd0aDspe3ZhciBmPXRoaXMudGV4dC5jaGFyQXQodGhpcy5pbmRleCksYz1jK2Y7aWYoZSkidSI9PT1mPyhlPXRoaXMudGV4dC5zdWJzdHJpbmcodGhpcy5pbmRleCsxLHRoaXMuaW5kZXgrNSksZS5tYXRjaCgvW1xkYS1mXXs0fS9pKXx8CnRoaXMudGhyb3dFcnJvcigiSW52YWxpZCB1bmljb2RlIGVzY2FwZSBbXFx1IitlKyJdIiksdGhpcy5pbmRleCs9NCxkKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHBhcnNlSW50KGUsMTYpKSk6ZCs9SWdbZl18fGYsZT0hMTtlbHNlIGlmKCJcXCI9PT1mKWU9ITA7ZWxzZXtpZihmPT09YSl7dGhpcy5pbmRleCsrO3RoaXMudG9rZW5zLnB1c2goe2luZGV4OmIsdGV4dDpjLGNvbnN0YW50OiEwLHZhbHVlOmR9KTtyZXR1cm59ZCs9Zn10aGlzLmluZGV4Kyt9dGhpcy50aHJvd0Vycm9yKCJVbnRlcm1pbmF0ZWQgcXVvdGUiLGIpfX07dmFyIHM9ZnVuY3Rpb24oYSxiKXt0aGlzLmxleGVyPWE7dGhpcy5vcHRpb25zPWJ9O3MuUHJvZ3JhbT0iUHJvZ3JhbSI7cy5FeHByZXNzaW9uU3RhdGVtZW50PSJFeHByZXNzaW9uU3RhdGVtZW50IjtzLkFzc2lnbm1lbnRFeHByZXNzaW9uPSJBc3NpZ25tZW50RXhwcmVzc2lvbiI7cy5Db25kaXRpb25hbEV4cHJlc3Npb249IkNvbmRpdGlvbmFsRXhwcmVzc2lvbiI7CnMuTG9naWNhbEV4cHJlc3Npb249IkxvZ2ljYWxFeHByZXNzaW9uIjtzLkJpbmFyeUV4cHJlc3Npb249IkJpbmFyeUV4cHJlc3Npb24iO3MuVW5hcnlFeHByZXNzaW9uPSJVbmFyeUV4cHJlc3Npb24iO3MuQ2FsbEV4cHJlc3Npb249IkNhbGxFeHByZXNzaW9uIjtzLk1lbWJlckV4cHJlc3Npb249Ik1lbWJlckV4cHJlc3Npb24iO3MuSWRlbnRpZmllcj0iSWRlbnRpZmllciI7cy5MaXRlcmFsPSJMaXRlcmFsIjtzLkFycmF5RXhwcmVzc2lvbj0iQXJyYXlFeHByZXNzaW9uIjtzLlByb3BlcnR5PSJQcm9wZXJ0eSI7cy5PYmplY3RFeHByZXNzaW9uPSJPYmplY3RFeHByZXNzaW9uIjtzLlRoaXNFeHByZXNzaW9uPSJUaGlzRXhwcmVzc2lvbiI7cy5Mb2NhbHNFeHByZXNzaW9uPSJMb2NhbHNFeHByZXNzaW9uIjtzLk5HVmFsdWVQYXJhbWV0ZXI9Ik5HVmFsdWVQYXJhbWV0ZXIiO3MucHJvdG90eXBlPXthc3Q6ZnVuY3Rpb24oYSl7dGhpcy50ZXh0PWE7dGhpcy50b2tlbnM9dGhpcy5sZXhlci5sZXgoYSk7CmE9dGhpcy5wcm9ncmFtKCk7MCE9PXRoaXMudG9rZW5zLmxlbmd0aCYmdGhpcy50aHJvd0Vycm9yKCJpcyBhbiB1bmV4cGVjdGVkIHRva2VuIix0aGlzLnRva2Vuc1swXSk7cmV0dXJuIGF9LHByb2dyYW06ZnVuY3Rpb24oKXtmb3IodmFyIGE9W107OylpZigwPHRoaXMudG9rZW5zLmxlbmd0aCYmIXRoaXMucGVlaygifSIsIikiLCI7IiwiXSIpJiZhLnB1c2godGhpcy5leHByZXNzaW9uU3RhdGVtZW50KCkpLCF0aGlzLmV4cGVjdCgiOyIpKXJldHVybnt0eXBlOnMuUHJvZ3JhbSxib2R5OmF9fSxleHByZXNzaW9uU3RhdGVtZW50OmZ1bmN0aW9uKCl7cmV0dXJue3R5cGU6cy5FeHByZXNzaW9uU3RhdGVtZW50LGV4cHJlc3Npb246dGhpcy5maWx0ZXJDaGFpbigpfX0sZmlsdGVyQ2hhaW46ZnVuY3Rpb24oKXtmb3IodmFyIGE9dGhpcy5leHByZXNzaW9uKCk7dGhpcy5leHBlY3QoInwiKTspYT10aGlzLmZpbHRlcihhKTtyZXR1cm4gYX0sZXhwcmVzc2lvbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmFzc2lnbm1lbnQoKX0sCmFzc2lnbm1lbnQ6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLnRlcm5hcnkoKTt0aGlzLmV4cGVjdCgiPSIpJiYoYT17dHlwZTpzLkFzc2lnbm1lbnRFeHByZXNzaW9uLGxlZnQ6YSxyaWdodDp0aGlzLmFzc2lnbm1lbnQoKSxvcGVyYXRvcjoiPSJ9KTtyZXR1cm4gYX0sdGVybmFyeTpmdW5jdGlvbigpe3ZhciBhPXRoaXMubG9naWNhbE9SKCksYixkO3JldHVybiB0aGlzLmV4cGVjdCgiPyIpJiYoYj10aGlzLmV4cHJlc3Npb24oKSx0aGlzLmNvbnN1bWUoIjoiKSk/KGQ9dGhpcy5leHByZXNzaW9uKCkse3R5cGU6cy5Db25kaXRpb25hbEV4cHJlc3Npb24sdGVzdDphLGFsdGVybmF0ZTpiLGNvbnNlcXVlbnQ6ZH0pOmF9LGxvZ2ljYWxPUjpmdW5jdGlvbigpe2Zvcih2YXIgYT10aGlzLmxvZ2ljYWxBTkQoKTt0aGlzLmV4cGVjdCgifHwiKTspYT17dHlwZTpzLkxvZ2ljYWxFeHByZXNzaW9uLG9wZXJhdG9yOiJ8fCIsbGVmdDphLHJpZ2h0OnRoaXMubG9naWNhbEFORCgpfTtyZXR1cm4gYX0sbG9naWNhbEFORDpmdW5jdGlvbigpe2Zvcih2YXIgYT0KdGhpcy5lcXVhbGl0eSgpO3RoaXMuZXhwZWN0KCImJiIpOylhPXt0eXBlOnMuTG9naWNhbEV4cHJlc3Npb24sb3BlcmF0b3I6IiYmIixsZWZ0OmEscmlnaHQ6dGhpcy5lcXVhbGl0eSgpfTtyZXR1cm4gYX0sZXF1YWxpdHk6ZnVuY3Rpb24oKXtmb3IodmFyIGE9dGhpcy5yZWxhdGlvbmFsKCksYjtiPXRoaXMuZXhwZWN0KCI9PSIsIiE9IiwiPT09IiwiIT09Iik7KWE9e3R5cGU6cy5CaW5hcnlFeHByZXNzaW9uLG9wZXJhdG9yOmIudGV4dCxsZWZ0OmEscmlnaHQ6dGhpcy5yZWxhdGlvbmFsKCl9O3JldHVybiBhfSxyZWxhdGlvbmFsOmZ1bmN0aW9uKCl7Zm9yKHZhciBhPXRoaXMuYWRkaXRpdmUoKSxiO2I9dGhpcy5leHBlY3QoIjwiLCI+IiwiPD0iLCI+PSIpOylhPXt0eXBlOnMuQmluYXJ5RXhwcmVzc2lvbixvcGVyYXRvcjpiLnRleHQsbGVmdDphLHJpZ2h0OnRoaXMuYWRkaXRpdmUoKX07cmV0dXJuIGF9LGFkZGl0aXZlOmZ1bmN0aW9uKCl7Zm9yKHZhciBhPXRoaXMubXVsdGlwbGljYXRpdmUoKSwKYjtiPXRoaXMuZXhwZWN0KCIrIiwiLSIpOylhPXt0eXBlOnMuQmluYXJ5RXhwcmVzc2lvbixvcGVyYXRvcjpiLnRleHQsbGVmdDphLHJpZ2h0OnRoaXMubXVsdGlwbGljYXRpdmUoKX07cmV0dXJuIGF9LG11bHRpcGxpY2F0aXZlOmZ1bmN0aW9uKCl7Zm9yKHZhciBhPXRoaXMudW5hcnkoKSxiO2I9dGhpcy5leHBlY3QoIioiLCIvIiwiJSIpOylhPXt0eXBlOnMuQmluYXJ5RXhwcmVzc2lvbixvcGVyYXRvcjpiLnRleHQsbGVmdDphLHJpZ2h0OnRoaXMudW5hcnkoKX07cmV0dXJuIGF9LHVuYXJ5OmZ1bmN0aW9uKCl7dmFyIGE7cmV0dXJuKGE9dGhpcy5leHBlY3QoIisiLCItIiwiISIpKT97dHlwZTpzLlVuYXJ5RXhwcmVzc2lvbixvcGVyYXRvcjphLnRleHQscHJlZml4OiEwLGFyZ3VtZW50OnRoaXMudW5hcnkoKX06dGhpcy5wcmltYXJ5KCl9LHByaW1hcnk6ZnVuY3Rpb24oKXt2YXIgYTt0aGlzLmV4cGVjdCgiKCIpPyhhPXRoaXMuZmlsdGVyQ2hhaW4oKSx0aGlzLmNvbnN1bWUoIikiKSk6CnRoaXMuZXhwZWN0KCJbIik/YT10aGlzLmFycmF5RGVjbGFyYXRpb24oKTp0aGlzLmV4cGVjdCgieyIpP2E9dGhpcy5vYmplY3QoKTp0aGlzLnNlbGZSZWZlcmVudGlhbC5oYXNPd25Qcm9wZXJ0eSh0aGlzLnBlZWsoKS50ZXh0KT9hPW9hKHRoaXMuc2VsZlJlZmVyZW50aWFsW3RoaXMuY29uc3VtZSgpLnRleHRdKTp0aGlzLm9wdGlvbnMubGl0ZXJhbHMuaGFzT3duUHJvcGVydHkodGhpcy5wZWVrKCkudGV4dCk/YT17dHlwZTpzLkxpdGVyYWwsdmFsdWU6dGhpcy5vcHRpb25zLmxpdGVyYWxzW3RoaXMuY29uc3VtZSgpLnRleHRdfTp0aGlzLnBlZWsoKS5pZGVudGlmaWVyP2E9dGhpcy5pZGVudGlmaWVyKCk6dGhpcy5wZWVrKCkuY29uc3RhbnQ/YT10aGlzLmNvbnN0YW50KCk6dGhpcy50aHJvd0Vycm9yKCJub3QgYSBwcmltYXJ5IGV4cHJlc3Npb24iLHRoaXMucGVlaygpKTtmb3IodmFyIGI7Yj10aGlzLmV4cGVjdCgiKCIsIlsiLCIuIik7KSIoIj09PWIudGV4dD8oYT17dHlwZTpzLkNhbGxFeHByZXNzaW9uLApjYWxsZWU6YSxhcmd1bWVudHM6dGhpcy5wYXJzZUFyZ3VtZW50cygpfSx0aGlzLmNvbnN1bWUoIikiKSk6IlsiPT09Yi50ZXh0PyhhPXt0eXBlOnMuTWVtYmVyRXhwcmVzc2lvbixvYmplY3Q6YSxwcm9wZXJ0eTp0aGlzLmV4cHJlc3Npb24oKSxjb21wdXRlZDohMH0sdGhpcy5jb25zdW1lKCJdIikpOiIuIj09PWIudGV4dD9hPXt0eXBlOnMuTWVtYmVyRXhwcmVzc2lvbixvYmplY3Q6YSxwcm9wZXJ0eTp0aGlzLmlkZW50aWZpZXIoKSxjb21wdXRlZDohMX06dGhpcy50aHJvd0Vycm9yKCJJTVBPU1NJQkxFIik7cmV0dXJuIGF9LGZpbHRlcjpmdW5jdGlvbihhKXthPVthXTtmb3IodmFyIGI9e3R5cGU6cy5DYWxsRXhwcmVzc2lvbixjYWxsZWU6dGhpcy5pZGVudGlmaWVyKCksYXJndW1lbnRzOmEsZmlsdGVyOiEwfTt0aGlzLmV4cGVjdCgiOiIpOylhLnB1c2godGhpcy5leHByZXNzaW9uKCkpO3JldHVybiBifSxwYXJzZUFyZ3VtZW50czpmdW5jdGlvbigpe3ZhciBhPVtdO2lmKCIpIiE9PQp0aGlzLnBlZWtUb2tlbigpLnRleHQpe2RvIGEucHVzaCh0aGlzLmV4cHJlc3Npb24oKSk7d2hpbGUodGhpcy5leHBlY3QoIiwiKSl9cmV0dXJuIGF9LGlkZW50aWZpZXI6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmNvbnN1bWUoKTthLmlkZW50aWZpZXJ8fHRoaXMudGhyb3dFcnJvcigiaXMgbm90IGEgdmFsaWQgaWRlbnRpZmllciIsYSk7cmV0dXJue3R5cGU6cy5JZGVudGlmaWVyLG5hbWU6YS50ZXh0fX0sY29uc3RhbnQ6ZnVuY3Rpb24oKXtyZXR1cm57dHlwZTpzLkxpdGVyYWwsdmFsdWU6dGhpcy5jb25zdW1lKCkudmFsdWV9fSxhcnJheURlY2xhcmF0aW9uOmZ1bmN0aW9uKCl7dmFyIGE9W107aWYoIl0iIT09dGhpcy5wZWVrVG9rZW4oKS50ZXh0KXtkb3tpZih0aGlzLnBlZWsoIl0iKSlicmVhazthLnB1c2godGhpcy5leHByZXNzaW9uKCkpfXdoaWxlKHRoaXMuZXhwZWN0KCIsIikpfXRoaXMuY29uc3VtZSgiXSIpO3JldHVybnt0eXBlOnMuQXJyYXlFeHByZXNzaW9uLGVsZW1lbnRzOmF9fSwKb2JqZWN0OmZ1bmN0aW9uKCl7dmFyIGE9W10sYjtpZigifSIhPT10aGlzLnBlZWtUb2tlbigpLnRleHQpe2Rve2lmKHRoaXMucGVlaygifSIpKWJyZWFrO2I9e3R5cGU6cy5Qcm9wZXJ0eSxraW5kOiJpbml0In07dGhpcy5wZWVrKCkuY29uc3RhbnQ/KGIua2V5PXRoaXMuY29uc3RhbnQoKSxiLmNvbXB1dGVkPSExLHRoaXMuY29uc3VtZSgiOiIpLGIudmFsdWU9dGhpcy5leHByZXNzaW9uKCkpOnRoaXMucGVlaygpLmlkZW50aWZpZXI/KGIua2V5PXRoaXMuaWRlbnRpZmllcigpLGIuY29tcHV0ZWQ9ITEsdGhpcy5wZWVrKCI6Iik/KHRoaXMuY29uc3VtZSgiOiIpLGIudmFsdWU9dGhpcy5leHByZXNzaW9uKCkpOmIudmFsdWU9Yi5rZXkpOnRoaXMucGVlaygiWyIpPyh0aGlzLmNvbnN1bWUoIlsiKSxiLmtleT10aGlzLmV4cHJlc3Npb24oKSx0aGlzLmNvbnN1bWUoIl0iKSxiLmNvbXB1dGVkPSEwLHRoaXMuY29uc3VtZSgiOiIpLGIudmFsdWU9dGhpcy5leHByZXNzaW9uKCkpOnRoaXMudGhyb3dFcnJvcigiaW52YWxpZCBrZXkiLAp0aGlzLnBlZWsoKSk7YS5wdXNoKGIpfXdoaWxlKHRoaXMuZXhwZWN0KCIsIikpfXRoaXMuY29uc3VtZSgifSIpO3JldHVybnt0eXBlOnMuT2JqZWN0RXhwcmVzc2lvbixwcm9wZXJ0aWVzOmF9fSx0aHJvd0Vycm9yOmZ1bmN0aW9uKGEsYil7dGhyb3cgYmEoInN5bnRheCIsYi50ZXh0LGEsYi5pbmRleCsxLHRoaXMudGV4dCx0aGlzLnRleHQuc3Vic3RyaW5nKGIuaW5kZXgpKTt9LGNvbnN1bWU6ZnVuY3Rpb24oYSl7aWYoMD09PXRoaXMudG9rZW5zLmxlbmd0aCl0aHJvdyBiYSgidWVvZSIsdGhpcy50ZXh0KTt2YXIgYj10aGlzLmV4cGVjdChhKTtifHx0aGlzLnRocm93RXJyb3IoImlzIHVuZXhwZWN0ZWQsIGV4cGVjdGluZyBbIithKyJdIix0aGlzLnBlZWsoKSk7cmV0dXJuIGJ9LHBlZWtUb2tlbjpmdW5jdGlvbigpe2lmKDA9PT10aGlzLnRva2Vucy5sZW5ndGgpdGhyb3cgYmEoInVlb2UiLHRoaXMudGV4dCk7cmV0dXJuIHRoaXMudG9rZW5zWzBdfSxwZWVrOmZ1bmN0aW9uKGEsYiwKZCxjKXtyZXR1cm4gdGhpcy5wZWVrQWhlYWQoMCxhLGIsZCxjKX0scGVla0FoZWFkOmZ1bmN0aW9uKGEsYixkLGMsZSl7aWYodGhpcy50b2tlbnMubGVuZ3RoPmEpe2E9dGhpcy50b2tlbnNbYV07dmFyIGY9YS50ZXh0O2lmKGY9PT1ifHxmPT09ZHx8Zj09PWN8fGY9PT1lfHwhKGJ8fGR8fGN8fGUpKXJldHVybiBhfXJldHVybiExfSxleHBlY3Q6ZnVuY3Rpb24oYSxiLGQsYyl7cmV0dXJuKGE9dGhpcy5wZWVrKGEsYixkLGMpKT8odGhpcy50b2tlbnMuc2hpZnQoKSxhKTohMX0sc2VsZlJlZmVyZW50aWFsOnsidGhpcyI6e3R5cGU6cy5UaGlzRXhwcmVzc2lvbn0sJGxvY2Fsczp7dHlwZTpzLkxvY2Fsc0V4cHJlc3Npb259fX07dGQucHJvdG90eXBlPXtjb21waWxlOmZ1bmN0aW9uKGEsYil7dmFyIGQ9dGhpcyxjPXRoaXMuYXN0QnVpbGRlci5hc3QoYSk7dGhpcy5zdGF0ZT17bmV4dElkOjAsZmlsdGVyczp7fSxleHBlbnNpdmVDaGVja3M6Yixmbjp7dmFyczpbXSxib2R5OltdLG93bjp7fX0sCmFzc2lnbjp7dmFyczpbXSxib2R5OltdLG93bjp7fX0saW5wdXRzOltdfTtaKGMsZC4kZmlsdGVyKTt2YXIgZT0iIixmO3RoaXMuc3RhZ2U9ImFzc2lnbiI7aWYoZj1yZChjKSl0aGlzLnN0YXRlLmNvbXB1dGluZz0iYXNzaWduIixlPXRoaXMubmV4dElkKCksdGhpcy5yZWN1cnNlKGYsZSksdGhpcy5yZXR1cm5fKGUpLGU9ImZuLmFzc2lnbj0iK3RoaXMuZ2VuZXJhdGVGdW5jdGlvbigiYXNzaWduIiwicyx2LGwiKTtmPXBkKGMuYm9keSk7ZC5zdGFnZT0iaW5wdXRzIjtxKGYsZnVuY3Rpb24oYSxiKXt2YXIgYz0iZm4iK2I7ZC5zdGF0ZVtjXT17dmFyczpbXSxib2R5OltdLG93bjp7fX07ZC5zdGF0ZS5jb21wdXRpbmc9Yzt2YXIgZT1kLm5leHRJZCgpO2QucmVjdXJzZShhLGUpO2QucmV0dXJuXyhlKTtkLnN0YXRlLmlucHV0cy5wdXNoKGMpO2Eud2F0Y2hJZD1ifSk7dGhpcy5zdGF0ZS5jb21wdXRpbmc9ImZuIjt0aGlzLnN0YWdlPSJtYWluIjt0aGlzLnJlY3Vyc2UoYyk7ZT0nIicrdGhpcy5VU0UrCiIgIit0aGlzLlNUUklDVCsnIjtcbicrdGhpcy5maWx0ZXJQcmVmaXgoKSsidmFyIGZuPSIrdGhpcy5nZW5lcmF0ZUZ1bmN0aW9uKCJmbiIsInMsbCxhLGkiKStlK3RoaXMud2F0Y2hGbnMoKSsicmV0dXJuIGZuOyI7ZT0obmV3IEZ1bmN0aW9uKCIkZmlsdGVyIiwiZW5zdXJlU2FmZU1lbWJlck5hbWUiLCJlbnN1cmVTYWZlT2JqZWN0IiwiZW5zdXJlU2FmZUZ1bmN0aW9uIiwiZ2V0U3RyaW5nVmFsdWUiLCJlbnN1cmVTYWZlQXNzaWduQ29udGV4dCIsImlmRGVmaW5lZCIsInBsdXMiLCJ0ZXh0IixlKSkodGhpcy4kZmlsdGVyLFVhLHFhLG5kLGhnLEpiLGxnLG9kLGEpO3RoaXMuc3RhdGU9dGhpcy5zdGFnZT12b2lkIDA7ZS5saXRlcmFsPXNkKGMpO2UuY29uc3RhbnQ9Yy5jb25zdGFudDtyZXR1cm4gZX0sVVNFOiJ1c2UiLFNUUklDVDoic3RyaWN0Iix3YXRjaEZuczpmdW5jdGlvbigpe3ZhciBhPVtdLGI9dGhpcy5zdGF0ZS5pbnB1dHMsZD10aGlzO3EoYixmdW5jdGlvbihiKXthLnB1c2goInZhciAiKwpiKyI9IitkLmdlbmVyYXRlRnVuY3Rpb24oYiwicyIpKX0pO2IubGVuZ3RoJiZhLnB1c2goImZuLmlucHV0cz1bIitiLmpvaW4oIiwiKSsiXTsiKTtyZXR1cm4gYS5qb2luKCIiKX0sZ2VuZXJhdGVGdW5jdGlvbjpmdW5jdGlvbihhLGIpe3JldHVybiJmdW5jdGlvbigiK2IrIil7Iit0aGlzLnZhcnNQcmVmaXgoYSkrdGhpcy5ib2R5KGEpKyJ9OyJ9LGZpbHRlclByZWZpeDpmdW5jdGlvbigpe3ZhciBhPVtdLGI9dGhpcztxKHRoaXMuc3RhdGUuZmlsdGVycyxmdW5jdGlvbihkLGMpe2EucHVzaChkKyI9JGZpbHRlcigiK2IuZXNjYXBlKGMpKyIpIil9KTtyZXR1cm4gYS5sZW5ndGg/InZhciAiK2Euam9pbigiLCIpKyI7IjoiIn0sdmFyc1ByZWZpeDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5zdGF0ZVthXS52YXJzLmxlbmd0aD8idmFyICIrdGhpcy5zdGF0ZVthXS52YXJzLmpvaW4oIiwiKSsiOyI6IiJ9LGJvZHk6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuc3RhdGVbYV0uYm9keS5qb2luKCIiKX0sCnJlY3Vyc2U6ZnVuY3Rpb24oYSxiLGQsYyxlLGYpe3ZhciBnLGgsaz10aGlzLGwsbSxuO2M9Y3x8QztpZighZiYmdihhLndhdGNoSWQpKWI9Ynx8dGhpcy5uZXh0SWQoKSx0aGlzLmlmXygiaSIsdGhpcy5sYXp5QXNzaWduKGIsdGhpcy5jb21wdXRlZE1lbWJlcigiaSIsYS53YXRjaElkKSksdGhpcy5sYXp5UmVjdXJzZShhLGIsZCxjLGUsITApKTtlbHNlIHN3aXRjaChhLnR5cGUpe2Nhc2Ugcy5Qcm9ncmFtOnEoYS5ib2R5LGZ1bmN0aW9uKGIsYyl7ay5yZWN1cnNlKGIuZXhwcmVzc2lvbix2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKGEpe2g9YX0pO2MhPT1hLmJvZHkubGVuZ3RoLTE/ay5jdXJyZW50KCkuYm9keS5wdXNoKGgsIjsiKTprLnJldHVybl8oaCl9KTticmVhaztjYXNlIHMuTGl0ZXJhbDptPXRoaXMuZXNjYXBlKGEudmFsdWUpO3RoaXMuYXNzaWduKGIsbSk7YyhtKTticmVhaztjYXNlIHMuVW5hcnlFeHByZXNzaW9uOnRoaXMucmVjdXJzZShhLmFyZ3VtZW50LHZvaWQgMCx2b2lkIDAsCmZ1bmN0aW9uKGEpe2g9YX0pO209YS5vcGVyYXRvcisiKCIrdGhpcy5pZkRlZmluZWQoaCwwKSsiKSI7dGhpcy5hc3NpZ24oYixtKTtjKG0pO2JyZWFrO2Nhc2Ugcy5CaW5hcnlFeHByZXNzaW9uOnRoaXMucmVjdXJzZShhLmxlZnQsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbihhKXtnPWF9KTt0aGlzLnJlY3Vyc2UoYS5yaWdodCx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKGEpe2g9YX0pO209IisiPT09YS5vcGVyYXRvcj90aGlzLnBsdXMoZyxoKToiLSI9PT1hLm9wZXJhdG9yP3RoaXMuaWZEZWZpbmVkKGcsMCkrYS5vcGVyYXRvcit0aGlzLmlmRGVmaW5lZChoLDApOiIoIitnKyIpIithLm9wZXJhdG9yKyIoIitoKyIpIjt0aGlzLmFzc2lnbihiLG0pO2MobSk7YnJlYWs7Y2FzZSBzLkxvZ2ljYWxFeHByZXNzaW9uOmI9Ynx8dGhpcy5uZXh0SWQoKTtrLnJlY3Vyc2UoYS5sZWZ0LGIpO2suaWZfKCImJiI9PT1hLm9wZXJhdG9yP2I6ay5ub3QoYiksay5sYXp5UmVjdXJzZShhLnJpZ2h0LGIpKTsKYyhiKTticmVhaztjYXNlIHMuQ29uZGl0aW9uYWxFeHByZXNzaW9uOmI9Ynx8dGhpcy5uZXh0SWQoKTtrLnJlY3Vyc2UoYS50ZXN0LGIpO2suaWZfKGIsay5sYXp5UmVjdXJzZShhLmFsdGVybmF0ZSxiKSxrLmxhenlSZWN1cnNlKGEuY29uc2VxdWVudCxiKSk7YyhiKTticmVhaztjYXNlIHMuSWRlbnRpZmllcjpiPWJ8fHRoaXMubmV4dElkKCk7ZCYmKGQuY29udGV4dD0iaW5wdXRzIj09PWsuc3RhZ2U/InMiOnRoaXMuYXNzaWduKHRoaXMubmV4dElkKCksdGhpcy5nZXRIYXNPd25Qcm9wZXJ0eSgibCIsYS5uYW1lKSsiP2w6cyIpLGQuY29tcHV0ZWQ9ITEsZC5uYW1lPWEubmFtZSk7VWEoYS5uYW1lKTtrLmlmXygiaW5wdXRzIj09PWsuc3RhZ2V8fGsubm90KGsuZ2V0SGFzT3duUHJvcGVydHkoImwiLGEubmFtZSkpLGZ1bmN0aW9uKCl7ay5pZl8oImlucHV0cyI9PT1rLnN0YWdlfHwicyIsZnVuY3Rpb24oKXtlJiYxIT09ZSYmay5pZl8oay5ub3Qoay5ub25Db21wdXRlZE1lbWJlcigicyIsCmEubmFtZSkpLGsubGF6eUFzc2lnbihrLm5vbkNvbXB1dGVkTWVtYmVyKCJzIixhLm5hbWUpLCJ7fSIpKTtrLmFzc2lnbihiLGsubm9uQ29tcHV0ZWRNZW1iZXIoInMiLGEubmFtZSkpfSl9LGImJmsubGF6eUFzc2lnbihiLGsubm9uQ29tcHV0ZWRNZW1iZXIoImwiLGEubmFtZSkpKTsoay5zdGF0ZS5leHBlbnNpdmVDaGVja3N8fEtiKGEubmFtZSkpJiZrLmFkZEVuc3VyZVNhZmVPYmplY3QoYik7YyhiKTticmVhaztjYXNlIHMuTWVtYmVyRXhwcmVzc2lvbjpnPWQmJihkLmNvbnRleHQ9dGhpcy5uZXh0SWQoKSl8fHRoaXMubmV4dElkKCk7Yj1ifHx0aGlzLm5leHRJZCgpO2sucmVjdXJzZShhLm9iamVjdCxnLHZvaWQgMCxmdW5jdGlvbigpe2suaWZfKGsubm90TnVsbChnKSxmdW5jdGlvbigpe2UmJjEhPT1lJiZrLmFkZEVuc3VyZVNhZmVBc3NpZ25Db250ZXh0KGcpO2lmKGEuY29tcHV0ZWQpaD1rLm5leHRJZCgpLGsucmVjdXJzZShhLnByb3BlcnR5LGgpLGsuZ2V0U3RyaW5nVmFsdWUoaCksCmsuYWRkRW5zdXJlU2FmZU1lbWJlck5hbWUoaCksZSYmMSE9PWUmJmsuaWZfKGsubm90KGsuY29tcHV0ZWRNZW1iZXIoZyxoKSksay5sYXp5QXNzaWduKGsuY29tcHV0ZWRNZW1iZXIoZyxoKSwie30iKSksbT1rLmVuc3VyZVNhZmVPYmplY3Qoay5jb21wdXRlZE1lbWJlcihnLGgpKSxrLmFzc2lnbihiLG0pLGQmJihkLmNvbXB1dGVkPSEwLGQubmFtZT1oKTtlbHNle1VhKGEucHJvcGVydHkubmFtZSk7ZSYmMSE9PWUmJmsuaWZfKGsubm90KGsubm9uQ29tcHV0ZWRNZW1iZXIoZyxhLnByb3BlcnR5Lm5hbWUpKSxrLmxhenlBc3NpZ24oay5ub25Db21wdXRlZE1lbWJlcihnLGEucHJvcGVydHkubmFtZSksInt9IikpO209ay5ub25Db21wdXRlZE1lbWJlcihnLGEucHJvcGVydHkubmFtZSk7aWYoay5zdGF0ZS5leHBlbnNpdmVDaGVja3N8fEtiKGEucHJvcGVydHkubmFtZSkpbT1rLmVuc3VyZVNhZmVPYmplY3QobSk7ay5hc3NpZ24oYixtKTtkJiYoZC5jb21wdXRlZD0hMSxkLm5hbWU9YS5wcm9wZXJ0eS5uYW1lKX19LApmdW5jdGlvbigpe2suYXNzaWduKGIsInVuZGVmaW5lZCIpfSk7YyhiKX0sISFlKTticmVhaztjYXNlIHMuQ2FsbEV4cHJlc3Npb246Yj1ifHx0aGlzLm5leHRJZCgpO2EuZmlsdGVyPyhoPWsuZmlsdGVyKGEuY2FsbGVlLm5hbWUpLGw9W10scShhLmFyZ3VtZW50cyxmdW5jdGlvbihhKXt2YXIgYj1rLm5leHRJZCgpO2sucmVjdXJzZShhLGIpO2wucHVzaChiKX0pLG09aCsiKCIrbC5qb2luKCIsIikrIikiLGsuYXNzaWduKGIsbSksYyhiKSk6KGg9ay5uZXh0SWQoKSxnPXt9LGw9W10say5yZWN1cnNlKGEuY2FsbGVlLGgsZyxmdW5jdGlvbigpe2suaWZfKGsubm90TnVsbChoKSxmdW5jdGlvbigpe2suYWRkRW5zdXJlU2FmZUZ1bmN0aW9uKGgpO3EoYS5hcmd1bWVudHMsZnVuY3Rpb24oYSl7ay5yZWN1cnNlKGEsay5uZXh0SWQoKSx2b2lkIDAsZnVuY3Rpb24oYSl7bC5wdXNoKGsuZW5zdXJlU2FmZU9iamVjdChhKSl9KX0pO2cubmFtZT8oay5zdGF0ZS5leHBlbnNpdmVDaGVja3N8fGsuYWRkRW5zdXJlU2FmZU9iamVjdChnLmNvbnRleHQpLAptPWsubWVtYmVyKGcuY29udGV4dCxnLm5hbWUsZy5jb21wdXRlZCkrIigiK2wuam9pbigiLCIpKyIpIik6bT1oKyIoIitsLmpvaW4oIiwiKSsiKSI7bT1rLmVuc3VyZVNhZmVPYmplY3QobSk7ay5hc3NpZ24oYixtKX0sZnVuY3Rpb24oKXtrLmFzc2lnbihiLCJ1bmRlZmluZWQiKX0pO2MoYil9KSk7YnJlYWs7Y2FzZSBzLkFzc2lnbm1lbnRFeHByZXNzaW9uOmg9dGhpcy5uZXh0SWQoKTtnPXt9O2lmKCFxZChhLmxlZnQpKXRocm93IGJhKCJsdmFsIik7dGhpcy5yZWN1cnNlKGEubGVmdCx2b2lkIDAsZyxmdW5jdGlvbigpe2suaWZfKGsubm90TnVsbChnLmNvbnRleHQpLGZ1bmN0aW9uKCl7ay5yZWN1cnNlKGEucmlnaHQsaCk7ay5hZGRFbnN1cmVTYWZlT2JqZWN0KGsubWVtYmVyKGcuY29udGV4dCxnLm5hbWUsZy5jb21wdXRlZCkpO2suYWRkRW5zdXJlU2FmZUFzc2lnbkNvbnRleHQoZy5jb250ZXh0KTttPWsubWVtYmVyKGcuY29udGV4dCxnLm5hbWUsZy5jb21wdXRlZCkrYS5vcGVyYXRvcisKaDtrLmFzc2lnbihiLG0pO2MoYnx8bSl9KX0sMSk7YnJlYWs7Y2FzZSBzLkFycmF5RXhwcmVzc2lvbjpsPVtdO3EoYS5lbGVtZW50cyxmdW5jdGlvbihhKXtrLnJlY3Vyc2UoYSxrLm5leHRJZCgpLHZvaWQgMCxmdW5jdGlvbihhKXtsLnB1c2goYSl9KX0pO209IlsiK2wuam9pbigiLCIpKyJdIjt0aGlzLmFzc2lnbihiLG0pO2MobSk7YnJlYWs7Y2FzZSBzLk9iamVjdEV4cHJlc3Npb246bD1bXTtuPSExO3EoYS5wcm9wZXJ0aWVzLGZ1bmN0aW9uKGEpe2EuY29tcHV0ZWQmJihuPSEwKX0pO24/KGI9Ynx8dGhpcy5uZXh0SWQoKSx0aGlzLmFzc2lnbihiLCJ7fSIpLHEoYS5wcm9wZXJ0aWVzLGZ1bmN0aW9uKGEpe2EuY29tcHV0ZWQ/KGc9ay5uZXh0SWQoKSxrLnJlY3Vyc2UoYS5rZXksZykpOmc9YS5rZXkudHlwZT09PXMuSWRlbnRpZmllcj9hLmtleS5uYW1lOiIiK2Eua2V5LnZhbHVlO2g9ay5uZXh0SWQoKTtrLnJlY3Vyc2UoYS52YWx1ZSxoKTtrLmFzc2lnbihrLm1lbWJlcihiLGcsCmEuY29tcHV0ZWQpLGgpfSkpOihxKGEucHJvcGVydGllcyxmdW5jdGlvbihiKXtrLnJlY3Vyc2UoYi52YWx1ZSxhLmNvbnN0YW50P3ZvaWQgMDprLm5leHRJZCgpLHZvaWQgMCxmdW5jdGlvbihhKXtsLnB1c2goay5lc2NhcGUoYi5rZXkudHlwZT09PXMuSWRlbnRpZmllcj9iLmtleS5uYW1lOiIiK2Iua2V5LnZhbHVlKSsiOiIrYSl9KX0pLG09InsiK2wuam9pbigiLCIpKyJ9Iix0aGlzLmFzc2lnbihiLG0pKTtjKGJ8fG0pO2JyZWFrO2Nhc2Ugcy5UaGlzRXhwcmVzc2lvbjp0aGlzLmFzc2lnbihiLCJzIik7YygicyIpO2JyZWFrO2Nhc2Ugcy5Mb2NhbHNFeHByZXNzaW9uOnRoaXMuYXNzaWduKGIsImwiKTtjKCJsIik7YnJlYWs7Y2FzZSBzLk5HVmFsdWVQYXJhbWV0ZXI6dGhpcy5hc3NpZ24oYiwidiIpLGMoInYiKX19LGdldEhhc093blByb3BlcnR5OmZ1bmN0aW9uKGEsYil7dmFyIGQ9YSsiLiIrYixjPXRoaXMuY3VycmVudCgpLm93bjtjLmhhc093blByb3BlcnR5KGQpfHwoY1tkXT0KdGhpcy5uZXh0SWQoITEsYSsiJiYoIit0aGlzLmVzY2FwZShiKSsiIGluICIrYSsiKSIpKTtyZXR1cm4gY1tkXX0sYXNzaWduOmZ1bmN0aW9uKGEsYil7aWYoYSlyZXR1cm4gdGhpcy5jdXJyZW50KCkuYm9keS5wdXNoKGEsIj0iLGIsIjsiKSxhfSxmaWx0ZXI6ZnVuY3Rpb24oYSl7dGhpcy5zdGF0ZS5maWx0ZXJzLmhhc093blByb3BlcnR5KGEpfHwodGhpcy5zdGF0ZS5maWx0ZXJzW2FdPXRoaXMubmV4dElkKCEwKSk7cmV0dXJuIHRoaXMuc3RhdGUuZmlsdGVyc1thXX0saWZEZWZpbmVkOmZ1bmN0aW9uKGEsYil7cmV0dXJuImlmRGVmaW5lZCgiK2ErIiwiK3RoaXMuZXNjYXBlKGIpKyIpIn0scGx1czpmdW5jdGlvbihhLGIpe3JldHVybiJwbHVzKCIrYSsiLCIrYisiKSJ9LHJldHVybl86ZnVuY3Rpb24oYSl7dGhpcy5jdXJyZW50KCkuYm9keS5wdXNoKCJyZXR1cm4gIixhLCI7Iil9LGlmXzpmdW5jdGlvbihhLGIsZCl7aWYoITA9PT1hKWIoKTtlbHNle3ZhciBjPXRoaXMuY3VycmVudCgpLmJvZHk7CmMucHVzaCgiaWYoIixhLCIpeyIpO2IoKTtjLnB1c2goIn0iKTtkJiYoYy5wdXNoKCJlbHNleyIpLGQoKSxjLnB1c2goIn0iKSl9fSxub3Q6ZnVuY3Rpb24oYSl7cmV0dXJuIiEoIithKyIpIn0sbm90TnVsbDpmdW5jdGlvbihhKXtyZXR1cm4gYSsiIT1udWxsIn0sbm9uQ29tcHV0ZWRNZW1iZXI6ZnVuY3Rpb24oYSxiKXt2YXIgZD0vW14kX2EtekEtWjAtOV0vZztyZXR1cm4vWyRfYS16QS1aXVskX2EtekEtWjAtOV0qLy50ZXN0KGIpP2ErIi4iK2I6YSsnWyInK2IucmVwbGFjZShkLHRoaXMuc3RyaW5nRXNjYXBlRm4pKyciXSd9LGNvbXB1dGVkTWVtYmVyOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGErIlsiK2IrIl0ifSxtZW1iZXI6ZnVuY3Rpb24oYSxiLGQpe3JldHVybiBkP3RoaXMuY29tcHV0ZWRNZW1iZXIoYSxiKTp0aGlzLm5vbkNvbXB1dGVkTWVtYmVyKGEsYil9LGFkZEVuc3VyZVNhZmVPYmplY3Q6ZnVuY3Rpb24oYSl7dGhpcy5jdXJyZW50KCkuYm9keS5wdXNoKHRoaXMuZW5zdXJlU2FmZU9iamVjdChhKSwKIjsiKX0sYWRkRW5zdXJlU2FmZU1lbWJlck5hbWU6ZnVuY3Rpb24oYSl7dGhpcy5jdXJyZW50KCkuYm9keS5wdXNoKHRoaXMuZW5zdXJlU2FmZU1lbWJlck5hbWUoYSksIjsiKX0sYWRkRW5zdXJlU2FmZUZ1bmN0aW9uOmZ1bmN0aW9uKGEpe3RoaXMuY3VycmVudCgpLmJvZHkucHVzaCh0aGlzLmVuc3VyZVNhZmVGdW5jdGlvbihhKSwiOyIpfSxhZGRFbnN1cmVTYWZlQXNzaWduQ29udGV4dDpmdW5jdGlvbihhKXt0aGlzLmN1cnJlbnQoKS5ib2R5LnB1c2godGhpcy5lbnN1cmVTYWZlQXNzaWduQ29udGV4dChhKSwiOyIpfSxlbnN1cmVTYWZlT2JqZWN0OmZ1bmN0aW9uKGEpe3JldHVybiJlbnN1cmVTYWZlT2JqZWN0KCIrYSsiLHRleHQpIn0sZW5zdXJlU2FmZU1lbWJlck5hbWU6ZnVuY3Rpb24oYSl7cmV0dXJuImVuc3VyZVNhZmVNZW1iZXJOYW1lKCIrYSsiLHRleHQpIn0sZW5zdXJlU2FmZUZ1bmN0aW9uOmZ1bmN0aW9uKGEpe3JldHVybiJlbnN1cmVTYWZlRnVuY3Rpb24oIithKyIsdGV4dCkifSwKZ2V0U3RyaW5nVmFsdWU6ZnVuY3Rpb24oYSl7dGhpcy5hc3NpZ24oYSwiZ2V0U3RyaW5nVmFsdWUoIithKyIpIil9LGVuc3VyZVNhZmVBc3NpZ25Db250ZXh0OmZ1bmN0aW9uKGEpe3JldHVybiJlbnN1cmVTYWZlQXNzaWduQ29udGV4dCgiK2ErIix0ZXh0KSJ9LGxhenlSZWN1cnNlOmZ1bmN0aW9uKGEsYixkLGMsZSxmKXt2YXIgZz10aGlzO3JldHVybiBmdW5jdGlvbigpe2cucmVjdXJzZShhLGIsZCxjLGUsZil9fSxsYXp5QXNzaWduOmZ1bmN0aW9uKGEsYil7dmFyIGQ9dGhpcztyZXR1cm4gZnVuY3Rpb24oKXtkLmFzc2lnbihhLGIpfX0sc3RyaW5nRXNjYXBlUmVnZXg6L1teIGEtekEtWjAtOV0vZyxzdHJpbmdFc2NhcGVGbjpmdW5jdGlvbihhKXtyZXR1cm4iXFx1IisoIjAwMDAiK2EuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KX0sZXNjYXBlOmZ1bmN0aW9uKGEpe2lmKEkoYSkpcmV0dXJuIiciK2EucmVwbGFjZSh0aGlzLnN0cmluZ0VzY2FwZVJlZ2V4LHRoaXMuc3RyaW5nRXNjYXBlRm4pKwoiJyI7aWYoUShhKSlyZXR1cm4gYS50b1N0cmluZygpO2lmKCEwPT09YSlyZXR1cm4idHJ1ZSI7aWYoITE9PT1hKXJldHVybiJmYWxzZSI7aWYobnVsbD09PWEpcmV0dXJuIm51bGwiO2lmKCJ1bmRlZmluZWQiPT09dHlwZW9mIGEpcmV0dXJuInVuZGVmaW5lZCI7dGhyb3cgYmEoImVzYyIpO30sbmV4dElkOmZ1bmN0aW9uKGEsYil7dmFyIGQ9InYiK3RoaXMuc3RhdGUubmV4dElkKys7YXx8dGhpcy5jdXJyZW50KCkudmFycy5wdXNoKGQrKGI/Ij0iK2I6IiIpKTtyZXR1cm4gZH0sY3VycmVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnN0YXRlW3RoaXMuc3RhdGUuY29tcHV0aW5nXX19O3VkLnByb3RvdHlwZT17Y29tcGlsZTpmdW5jdGlvbihhLGIpe3ZhciBkPXRoaXMsYz10aGlzLmFzdEJ1aWxkZXIuYXN0KGEpO3RoaXMuZXhwcmVzc2lvbj1hO3RoaXMuZXhwZW5zaXZlQ2hlY2tzPWI7WihjLGQuJGZpbHRlcik7dmFyIGUsZjtpZihlPXJkKGMpKWY9dGhpcy5yZWN1cnNlKGUpO2U9cGQoYy5ib2R5KTsKdmFyIGc7ZSYmKGc9W10scShlLGZ1bmN0aW9uKGEsYil7dmFyIGM9ZC5yZWN1cnNlKGEpO2EuaW5wdXQ9YztnLnB1c2goYyk7YS53YXRjaElkPWJ9KSk7dmFyIGg9W107cShjLmJvZHksZnVuY3Rpb24oYSl7aC5wdXNoKGQucmVjdXJzZShhLmV4cHJlc3Npb24pKX0pO2U9MD09PWMuYm9keS5sZW5ndGg/QzoxPT09Yy5ib2R5Lmxlbmd0aD9oWzBdOmZ1bmN0aW9uKGEsYil7dmFyIGM7cShoLGZ1bmN0aW9uKGQpe2M9ZChhLGIpfSk7cmV0dXJuIGN9O2YmJihlLmFzc2lnbj1mdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYoYSxjLGIpfSk7ZyYmKGUuaW5wdXRzPWcpO2UubGl0ZXJhbD1zZChjKTtlLmNvbnN0YW50PWMuY29uc3RhbnQ7cmV0dXJuIGV9LHJlY3Vyc2U6ZnVuY3Rpb24oYSxiLGQpe3ZhciBjLGUsZj10aGlzLGc7aWYoYS5pbnB1dClyZXR1cm4gdGhpcy5pbnB1dHMoYS5pbnB1dCxhLndhdGNoSWQpO3N3aXRjaChhLnR5cGUpe2Nhc2Ugcy5MaXRlcmFsOnJldHVybiB0aGlzLnZhbHVlKGEudmFsdWUsCmIpO2Nhc2Ugcy5VbmFyeUV4cHJlc3Npb246cmV0dXJuIGU9dGhpcy5yZWN1cnNlKGEuYXJndW1lbnQpLHRoaXNbInVuYXJ5IithLm9wZXJhdG9yXShlLGIpO2Nhc2Ugcy5CaW5hcnlFeHByZXNzaW9uOnJldHVybiBjPXRoaXMucmVjdXJzZShhLmxlZnQpLGU9dGhpcy5yZWN1cnNlKGEucmlnaHQpLHRoaXNbImJpbmFyeSIrYS5vcGVyYXRvcl0oYyxlLGIpO2Nhc2Ugcy5Mb2dpY2FsRXhwcmVzc2lvbjpyZXR1cm4gYz10aGlzLnJlY3Vyc2UoYS5sZWZ0KSxlPXRoaXMucmVjdXJzZShhLnJpZ2h0KSx0aGlzWyJiaW5hcnkiK2Eub3BlcmF0b3JdKGMsZSxiKTtjYXNlIHMuQ29uZGl0aW9uYWxFeHByZXNzaW9uOnJldHVybiB0aGlzWyJ0ZXJuYXJ5PzoiXSh0aGlzLnJlY3Vyc2UoYS50ZXN0KSx0aGlzLnJlY3Vyc2UoYS5hbHRlcm5hdGUpLHRoaXMucmVjdXJzZShhLmNvbnNlcXVlbnQpLGIpO2Nhc2Ugcy5JZGVudGlmaWVyOnJldHVybiBVYShhLm5hbWUsZi5leHByZXNzaW9uKSxmLmlkZW50aWZpZXIoYS5uYW1lLApmLmV4cGVuc2l2ZUNoZWNrc3x8S2IoYS5uYW1lKSxiLGQsZi5leHByZXNzaW9uKTtjYXNlIHMuTWVtYmVyRXhwcmVzc2lvbjpyZXR1cm4gYz10aGlzLnJlY3Vyc2UoYS5vYmplY3QsITEsISFkKSxhLmNvbXB1dGVkfHwoVWEoYS5wcm9wZXJ0eS5uYW1lLGYuZXhwcmVzc2lvbiksZT1hLnByb3BlcnR5Lm5hbWUpLGEuY29tcHV0ZWQmJihlPXRoaXMucmVjdXJzZShhLnByb3BlcnR5KSksYS5jb21wdXRlZD90aGlzLmNvbXB1dGVkTWVtYmVyKGMsZSxiLGQsZi5leHByZXNzaW9uKTp0aGlzLm5vbkNvbXB1dGVkTWVtYmVyKGMsZSxmLmV4cGVuc2l2ZUNoZWNrcyxiLGQsZi5leHByZXNzaW9uKTtjYXNlIHMuQ2FsbEV4cHJlc3Npb246cmV0dXJuIGc9W10scShhLmFyZ3VtZW50cyxmdW5jdGlvbihhKXtnLnB1c2goZi5yZWN1cnNlKGEpKX0pLGEuZmlsdGVyJiYoZT10aGlzLiRmaWx0ZXIoYS5jYWxsZWUubmFtZSkpLGEuZmlsdGVyfHwoZT10aGlzLnJlY3Vyc2UoYS5jYWxsZWUsITApKSxhLmZpbHRlcj8KZnVuY3Rpb24oYSxjLGQsZil7Zm9yKHZhciBuPVtdLHA9MDtwPGcubGVuZ3RoOysrcCluLnB1c2goZ1twXShhLGMsZCxmKSk7YT1lLmFwcGx5KHZvaWQgMCxuLGYpO3JldHVybiBiP3tjb250ZXh0OnZvaWQgMCxuYW1lOnZvaWQgMCx2YWx1ZTphfTphfTpmdW5jdGlvbihhLGMsZCxtKXt2YXIgbj1lKGEsYyxkLG0pLHA7aWYobnVsbCE9bi52YWx1ZSl7cWEobi5jb250ZXh0LGYuZXhwcmVzc2lvbik7bmQobi52YWx1ZSxmLmV4cHJlc3Npb24pO3A9W107Zm9yKHZhciBxPTA7cTxnLmxlbmd0aDsrK3EpcC5wdXNoKHFhKGdbcV0oYSxjLGQsbSksZi5leHByZXNzaW9uKSk7cD1xYShuLnZhbHVlLmFwcGx5KG4uY29udGV4dCxwKSxmLmV4cHJlc3Npb24pfXJldHVybiBiP3t2YWx1ZTpwfTpwfTtjYXNlIHMuQXNzaWdubWVudEV4cHJlc3Npb246cmV0dXJuIGM9dGhpcy5yZWN1cnNlKGEubGVmdCwhMCwxKSxlPXRoaXMucmVjdXJzZShhLnJpZ2h0KSxmdW5jdGlvbihhLGQsZyxtKXt2YXIgbj1jKGEsCmQsZyxtKTthPWUoYSxkLGcsbSk7cWEobi52YWx1ZSxmLmV4cHJlc3Npb24pO0piKG4uY29udGV4dCk7bi5jb250ZXh0W24ubmFtZV09YTtyZXR1cm4gYj97dmFsdWU6YX06YX07Y2FzZSBzLkFycmF5RXhwcmVzc2lvbjpyZXR1cm4gZz1bXSxxKGEuZWxlbWVudHMsZnVuY3Rpb24oYSl7Zy5wdXNoKGYucmVjdXJzZShhKSl9KSxmdW5jdGlvbihhLGMsZCxlKXtmb3IodmFyIGY9W10scD0wO3A8Zy5sZW5ndGg7KytwKWYucHVzaChnW3BdKGEsYyxkLGUpKTtyZXR1cm4gYj97dmFsdWU6Zn06Zn07Y2FzZSBzLk9iamVjdEV4cHJlc3Npb246cmV0dXJuIGc9W10scShhLnByb3BlcnRpZXMsZnVuY3Rpb24oYSl7YS5jb21wdXRlZD9nLnB1c2goe2tleTpmLnJlY3Vyc2UoYS5rZXkpLGNvbXB1dGVkOiEwLHZhbHVlOmYucmVjdXJzZShhLnZhbHVlKX0pOmcucHVzaCh7a2V5OmEua2V5LnR5cGU9PT1zLklkZW50aWZpZXI/YS5rZXkubmFtZToiIithLmtleS52YWx1ZSxjb21wdXRlZDohMSx2YWx1ZTpmLnJlY3Vyc2UoYS52YWx1ZSl9KX0pLApmdW5jdGlvbihhLGMsZCxlKXtmb3IodmFyIGY9e30scD0wO3A8Zy5sZW5ndGg7KytwKWdbcF0uY29tcHV0ZWQ/ZltnW3BdLmtleShhLGMsZCxlKV09Z1twXS52YWx1ZShhLGMsZCxlKTpmW2dbcF0ua2V5XT1nW3BdLnZhbHVlKGEsYyxkLGUpO3JldHVybiBiP3t2YWx1ZTpmfTpmfTtjYXNlIHMuVGhpc0V4cHJlc3Npb246cmV0dXJuIGZ1bmN0aW9uKGEpe3JldHVybiBiP3t2YWx1ZTphfTphfTtjYXNlIHMuTG9jYWxzRXhwcmVzc2lvbjpyZXR1cm4gZnVuY3Rpb24oYSxjKXtyZXR1cm4gYj97dmFsdWU6Y306Y307Y2FzZSBzLk5HVmFsdWVQYXJhbWV0ZXI6cmV0dXJuIGZ1bmN0aW9uKGEsYyxkKXtyZXR1cm4gYj97dmFsdWU6ZH06ZH19fSwidW5hcnkrIjpmdW5jdGlvbihhLGIpe3JldHVybiBmdW5jdGlvbihkLGMsZSxmKXtkPWEoZCxjLGUsZik7ZD12KGQpPytkOjA7cmV0dXJuIGI/e3ZhbHVlOmR9OmR9fSwidW5hcnktIjpmdW5jdGlvbihhLGIpe3JldHVybiBmdW5jdGlvbihkLGMsZSwKZil7ZD1hKGQsYyxlLGYpO2Q9dihkKT8tZDowO3JldHVybiBiP3t2YWx1ZTpkfTpkfX0sInVuYXJ5ISI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZnVuY3Rpb24oZCxjLGUsZil7ZD0hYShkLGMsZSxmKTtyZXR1cm4gYj97dmFsdWU6ZH06ZH19LCJiaW5hcnkrIjpmdW5jdGlvbihhLGIsZCl7cmV0dXJuIGZ1bmN0aW9uKGMsZSxmLGcpe3ZhciBoPWEoYyxlLGYsZyk7Yz1iKGMsZSxmLGcpO2g9b2QoaCxjKTtyZXR1cm4gZD97dmFsdWU6aH06aH19LCJiaW5hcnktIjpmdW5jdGlvbihhLGIsZCl7cmV0dXJuIGZ1bmN0aW9uKGMsZSxmLGcpe3ZhciBoPWEoYyxlLGYsZyk7Yz1iKGMsZSxmLGcpO2g9KHYoaCk/aDowKS0odihjKT9jOjApO3JldHVybiBkP3t2YWx1ZTpofTpofX0sImJpbmFyeSoiOmZ1bmN0aW9uKGEsYixkKXtyZXR1cm4gZnVuY3Rpb24oYyxlLGYsZyl7Yz1hKGMsZSxmLGcpKmIoYyxlLGYsZyk7cmV0dXJuIGQ/e3ZhbHVlOmN9OmN9fSwiYmluYXJ5LyI6ZnVuY3Rpb24oYSxiLGQpe3JldHVybiBmdW5jdGlvbihjLAplLGYsZyl7Yz1hKGMsZSxmLGcpL2IoYyxlLGYsZyk7cmV0dXJuIGQ/e3ZhbHVlOmN9OmN9fSwiYmluYXJ5JSI6ZnVuY3Rpb24oYSxiLGQpe3JldHVybiBmdW5jdGlvbihjLGUsZixnKXtjPWEoYyxlLGYsZyklYihjLGUsZixnKTtyZXR1cm4gZD97dmFsdWU6Y306Y319LCJiaW5hcnk9PT0iOmZ1bmN0aW9uKGEsYixkKXtyZXR1cm4gZnVuY3Rpb24oYyxlLGYsZyl7Yz1hKGMsZSxmLGcpPT09YihjLGUsZixnKTtyZXR1cm4gZD97dmFsdWU6Y306Y319LCJiaW5hcnkhPT0iOmZ1bmN0aW9uKGEsYixkKXtyZXR1cm4gZnVuY3Rpb24oYyxlLGYsZyl7Yz1hKGMsZSxmLGcpIT09YihjLGUsZixnKTtyZXR1cm4gZD97dmFsdWU6Y306Y319LCJiaW5hcnk9PSI6ZnVuY3Rpb24oYSxiLGQpe3JldHVybiBmdW5jdGlvbihjLGUsZixnKXtjPWEoYyxlLGYsZyk9PWIoYyxlLGYsZyk7cmV0dXJuIGQ/e3ZhbHVlOmN9OmN9fSwiYmluYXJ5IT0iOmZ1bmN0aW9uKGEsYixkKXtyZXR1cm4gZnVuY3Rpb24oYywKZSxmLGcpe2M9YShjLGUsZixnKSE9YihjLGUsZixnKTtyZXR1cm4gZD97dmFsdWU6Y306Y319LCJiaW5hcnk8IjpmdW5jdGlvbihhLGIsZCl7cmV0dXJuIGZ1bmN0aW9uKGMsZSxmLGcpe2M9YShjLGUsZixnKTxiKGMsZSxmLGcpO3JldHVybiBkP3t2YWx1ZTpjfTpjfX0sImJpbmFyeT4iOmZ1bmN0aW9uKGEsYixkKXtyZXR1cm4gZnVuY3Rpb24oYyxlLGYsZyl7Yz1hKGMsZSxmLGcpPmIoYyxlLGYsZyk7cmV0dXJuIGQ/e3ZhbHVlOmN9OmN9fSwiYmluYXJ5PD0iOmZ1bmN0aW9uKGEsYixkKXtyZXR1cm4gZnVuY3Rpb24oYyxlLGYsZyl7Yz1hKGMsZSxmLGcpPD1iKGMsZSxmLGcpO3JldHVybiBkP3t2YWx1ZTpjfTpjfX0sImJpbmFyeT49IjpmdW5jdGlvbihhLGIsZCl7cmV0dXJuIGZ1bmN0aW9uKGMsZSxmLGcpe2M9YShjLGUsZixnKT49YihjLGUsZixnKTtyZXR1cm4gZD97dmFsdWU6Y306Y319LCJiaW5hcnkmJiI6ZnVuY3Rpb24oYSxiLGQpe3JldHVybiBmdW5jdGlvbihjLGUsZixnKXtjPQphKGMsZSxmLGcpJiZiKGMsZSxmLGcpO3JldHVybiBkP3t2YWx1ZTpjfTpjfX0sImJpbmFyeXx8IjpmdW5jdGlvbihhLGIsZCl7cmV0dXJuIGZ1bmN0aW9uKGMsZSxmLGcpe2M9YShjLGUsZixnKXx8YihjLGUsZixnKTtyZXR1cm4gZD97dmFsdWU6Y306Y319LCJ0ZXJuYXJ5PzoiOmZ1bmN0aW9uKGEsYixkLGMpe3JldHVybiBmdW5jdGlvbihlLGYsZyxoKXtlPWEoZSxmLGcsaCk/YihlLGYsZyxoKTpkKGUsZixnLGgpO3JldHVybiBjP3t2YWx1ZTplfTplfX0sdmFsdWU6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gYj97Y29udGV4dDp2b2lkIDAsbmFtZTp2b2lkIDAsdmFsdWU6YX06YX19LGlkZW50aWZpZXI6ZnVuY3Rpb24oYSxiLGQsYyxlKXtyZXR1cm4gZnVuY3Rpb24oZixnLGgsayl7Zj1nJiZhIGluIGc/ZzpmO2MmJjEhPT1jJiZmJiYhZlthXSYmKGZbYV09e30pO2c9Zj9mW2FdOnZvaWQgMDtiJiZxYShnLGUpO3JldHVybiBkP3tjb250ZXh0OmYsbmFtZTphLAp2YWx1ZTpnfTpnfX0sY29tcHV0ZWRNZW1iZXI6ZnVuY3Rpb24oYSxiLGQsYyxlKXtyZXR1cm4gZnVuY3Rpb24oZixnLGgsayl7dmFyIGw9YShmLGcsaCxrKSxtLG47bnVsbCE9bCYmKG09YihmLGcsaCxrKSxtKz0iIixVYShtLGUpLGMmJjEhPT1jJiYoSmIobCksbCYmIWxbbV0mJihsW21dPXt9KSksbj1sW21dLHFhKG4sZSkpO3JldHVybiBkP3tjb250ZXh0OmwsbmFtZTptLHZhbHVlOm59Om59fSxub25Db21wdXRlZE1lbWJlcjpmdW5jdGlvbihhLGIsZCxjLGUsZil7cmV0dXJuIGZ1bmN0aW9uKGcsaCxrLGwpe2c9YShnLGgsayxsKTtlJiYxIT09ZSYmKEpiKGcpLGcmJiFnW2JdJiYoZ1tiXT17fSkpO2g9bnVsbCE9Zz9nW2JdOnZvaWQgMDsoZHx8S2IoYikpJiZxYShoLGYpO3JldHVybiBjP3tjb250ZXh0OmcsbmFtZTpiLHZhbHVlOmh9Omh9fSxpbnB1dHM6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZnVuY3Rpb24oZCxjLGUsZil7cmV0dXJuIGY/ZltiXTphKGQsYyxlKX19fTt2YXIga2M9CmZ1bmN0aW9uKGEsYixkKXt0aGlzLmxleGVyPWE7dGhpcy4kZmlsdGVyPWI7dGhpcy5vcHRpb25zPWQ7dGhpcy5hc3Q9bmV3IHMoYSxkKTt0aGlzLmFzdENvbXBpbGVyPWQuY3NwP25ldyB1ZCh0aGlzLmFzdCxiKTpuZXcgdGQodGhpcy5hc3QsYil9O2tjLnByb3RvdHlwZT17Y29uc3RydWN0b3I6a2MscGFyc2U6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuYXN0Q29tcGlsZXIuY29tcGlsZShhLHRoaXMub3B0aW9ucy5leHBlbnNpdmVDaGVja3MpfX07dmFyIG1nPU9iamVjdC5wcm90b3R5cGUudmFsdWVPZixyYT1PKCIkc2NlIiksbWE9e0hUTUw6Imh0bWwiLENTUzoiY3NzIixVUkw6InVybCIsUkVTT1VSQ0VfVVJMOiJyZXNvdXJjZVVybCIsSlM6ImpzIn0sb2c9TygiJGNvbXBpbGUiKSxYPUYuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpLHlkPXBhKEYubG9jYXRpb24uaHJlZik7emQuJGluamVjdD1bIiRkb2N1bWVudCJdO0xjLiRpbmplY3Q9WyIkcHJvdmlkZSJdO3ZhciBHZD0yMiwKRmQ9Ii4iLG1jPSIwIjtBZC4kaW5qZWN0PVsiJGxvY2FsZSJdO0NkLiRpbmplY3Q9WyIkbG9jYWxlIl07dmFyIHpnPXt5eXl5OlcoIkZ1bGxZZWFyIiw0LDAsITEsITApLHl5OlcoIkZ1bGxZZWFyIiwyLDAsITAsITApLHk6VygiRnVsbFllYXIiLDEsMCwhMSwhMCksTU1NTTprYigiTW9udGgiKSxNTU06a2IoIk1vbnRoIiwhMCksTU06VygiTW9udGgiLDIsMSksTTpXKCJNb250aCIsMSwxKSxMTExMOmtiKCJNb250aCIsITEsITApLGRkOlcoIkRhdGUiLDIpLGQ6VygiRGF0ZSIsMSksSEg6VygiSG91cnMiLDIpLEg6VygiSG91cnMiLDEpLGhoOlcoIkhvdXJzIiwyLC0xMiksaDpXKCJIb3VycyIsMSwtMTIpLG1tOlcoIk1pbnV0ZXMiLDIpLG06VygiTWludXRlcyIsMSksc3M6VygiU2Vjb25kcyIsMiksczpXKCJTZWNvbmRzIiwxKSxzc3M6VygiTWlsbGlzZWNvbmRzIiwzKSxFRUVFOmtiKCJEYXkiKSxFRUU6a2IoIkRheSIsITApLGE6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gMTI+YS5nZXRIb3VycygpPwpiLkFNUE1TWzBdOmIuQU1QTVNbMV19LFo6ZnVuY3Rpb24oYSxiLGQpe2E9LTEqZDtyZXR1cm4gYT0oMDw9YT8iKyI6IiIpKyhMYihNYXRoWzA8YT8iZmxvb3IiOiJjZWlsIl0oYS82MCksMikrTGIoTWF0aC5hYnMoYSU2MCksMikpfSx3dzpJZCgyKSx3OklkKDEpLEc6bmMsR0c6bmMsR0dHOm5jLEdHR0c6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gMD49YS5nZXRGdWxsWWVhcigpP2IuRVJBTkFNRVNbMF06Yi5FUkFOQU1FU1sxXX19LHlnPS8oKD86W155TUxkSGhtc2FaRXdHJ10rKXwoPzonKD86W14nXXwnJykqJyl8KD86RSt8eSt8TSt8TCt8ZCt8SCt8aCt8bSt8cyt8YXxafEcrfHcrKSkoLiopLyx4Zz0vXlwtP1xkKyQvO0JkLiRpbmplY3Q9WyIkbG9jYWxlIl07dmFyIHNnPWNhKEwpLHRnPWNhKHViKTtEZC4kaW5qZWN0PVsiJHBhcnNlIl07dmFyIG9lPWNhKHtyZXN0cmljdDoiRSIsY29tcGlsZTpmdW5jdGlvbihhLGIpe2lmKCFiLmhyZWYmJiFiLnhsaW5rSHJlZilyZXR1cm4gZnVuY3Rpb24oYSwKYil7aWYoImEiPT09YlswXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKXt2YXIgZT0iW29iamVjdCBTVkdBbmltYXRlZFN0cmluZ10iPT09amEuY2FsbChiLnByb3AoImhyZWYiKSk/InhsaW5rOmhyZWYiOiJocmVmIjtiLm9uKCJjbGljayIsZnVuY3Rpb24oYSl7Yi5hdHRyKGUpfHxhLnByZXZlbnREZWZhdWx0KCl9KX19fX0pLHZiPXt9O3EoRWIsZnVuY3Rpb24oYSxiKXtmdW5jdGlvbiBkKGEsZCxlKXthLiR3YXRjaChlW2NdLGZ1bmN0aW9uKGEpe2UuJHNldChiLCEhYSl9KX1pZigibXVsdGlwbGUiIT1hKXt2YXIgYz13YSgibmctIitiKSxlPWQ7ImNoZWNrZWQiPT09YSYmKGU9ZnVuY3Rpb24oYSxiLGUpe2UubmdNb2RlbCE9PWVbY10mJmQoYSxiLGUpfSk7dmJbY109ZnVuY3Rpb24oKXtyZXR1cm57cmVzdHJpY3Q6IkEiLHByaW9yaXR5OjEwMCxsaW5rOmV9fX19KTtxKGJkLGZ1bmN0aW9uKGEsYil7dmJbYl09ZnVuY3Rpb24oKXtyZXR1cm57cHJpb3JpdHk6MTAwLGxpbms6ZnVuY3Rpb24oYSwKYyxlKXtpZigibmdQYXR0ZXJuIj09PWImJiIvIj09ZS5uZ1BhdHRlcm4uY2hhckF0KDApJiYoYz1lLm5nUGF0dGVybi5tYXRjaChCZykpKXtlLiRzZXQoIm5nUGF0dGVybiIsbmV3IFJlZ0V4cChjWzFdLGNbMl0pKTtyZXR1cm59YS4kd2F0Y2goZVtiXSxmdW5jdGlvbihhKXtlLiRzZXQoYixhKX0pfX19fSk7cShbInNyYyIsInNyY3NldCIsImhyZWYiXSxmdW5jdGlvbihhKXt2YXIgYj13YSgibmctIithKTt2YltiXT1mdW5jdGlvbigpe3JldHVybntwcmlvcml0eTo5OSxsaW5rOmZ1bmN0aW9uKGQsYyxlKXt2YXIgZj1hLGc9YTsiaHJlZiI9PT1hJiYiW29iamVjdCBTVkdBbmltYXRlZFN0cmluZ10iPT09amEuY2FsbChjLnByb3AoImhyZWYiKSkmJihnPSJ4bGlua0hyZWYiLGUuJGF0dHJbZ109InhsaW5rOmhyZWYiLGY9bnVsbCk7ZS4kb2JzZXJ2ZShiLGZ1bmN0aW9uKGIpe2I/KGUuJHNldChnLGIpLEJhJiZmJiZjLnByb3AoZixlW2ddKSk6ImhyZWYiPT09YSYmZS4kc2V0KGcsbnVsbCl9KX19fX0pOwp2YXIgTWI9eyRhZGRDb250cm9sOkMsJCRyZW5hbWVDb250cm9sOmZ1bmN0aW9uKGEsYil7YS4kbmFtZT1ifSwkcmVtb3ZlQ29udHJvbDpDLCRzZXRWYWxpZGl0eTpDLCRzZXREaXJ0eTpDLCRzZXRQcmlzdGluZTpDLCRzZXRTdWJtaXR0ZWQ6Q307SmQuJGluamVjdD1bIiRlbGVtZW50IiwiJGF0dHJzIiwiJHNjb3BlIiwiJGFuaW1hdGUiLCIkaW50ZXJwb2xhdGUiXTt2YXIgU2Q9ZnVuY3Rpb24oYSl7cmV0dXJuWyIkdGltZW91dCIsIiRwYXJzZSIsZnVuY3Rpb24oYixkKXtmdW5jdGlvbiBjKGEpe3JldHVybiIiPT09YT9kKCd0aGlzWyIiXScpLmFzc2lnbjpkKGEpLmFzc2lnbnx8Q31yZXR1cm57bmFtZToiZm9ybSIscmVzdHJpY3Q6YT8iRUFDIjoiRSIscmVxdWlyZTpbImZvcm0iLCJeXj9mb3JtIl0sY29udHJvbGxlcjpKZCxjb21waWxlOmZ1bmN0aW9uKGQsZil7ZC5hZGRDbGFzcyhWYSkuYWRkQ2xhc3Mob2IpO3ZhciBnPWYubmFtZT8ibmFtZSI6YSYmZi5uZ0Zvcm0/Im5nRm9ybSI6CiExO3JldHVybntwcmU6ZnVuY3Rpb24oYSxkLGUsZil7dmFyIG49ZlswXTtpZighKCJhY3Rpb24iaW4gZSkpe3ZhciBwPWZ1bmN0aW9uKGIpe2EuJGFwcGx5KGZ1bmN0aW9uKCl7bi4kY29tbWl0Vmlld1ZhbHVlKCk7bi4kc2V0U3VibWl0dGVkKCl9KTtiLnByZXZlbnREZWZhdWx0KCl9O2RbMF0uYWRkRXZlbnRMaXN0ZW5lcigic3VibWl0IixwLCExKTtkLm9uKCIkZGVzdHJveSIsZnVuY3Rpb24oKXtiKGZ1bmN0aW9uKCl7ZFswXS5yZW1vdmVFdmVudExpc3RlbmVyKCJzdWJtaXQiLHAsITEpfSwwLCExKX0pfShmWzFdfHxuLiQkcGFyZW50Rm9ybSkuJGFkZENvbnRyb2wobik7dmFyIHE9Zz9jKG4uJG5hbWUpOkM7ZyYmKHEoYSxuKSxlLiRvYnNlcnZlKGcsZnVuY3Rpb24oYil7bi4kbmFtZSE9PWImJihxKGEsdm9pZCAwKSxuLiQkcGFyZW50Rm9ybS4kJHJlbmFtZUNvbnRyb2wobixiKSxxPWMobi4kbmFtZSkscShhLG4pKX0pKTtkLm9uKCIkZGVzdHJveSIsZnVuY3Rpb24oKXtuLiQkcGFyZW50Rm9ybS4kcmVtb3ZlQ29udHJvbChuKTsKcShhLHZvaWQgMCk7UChuLE1iKX0pfX19fX1dfSxwZT1TZCgpLENlPVNkKCEwKSxBZz0vXlxkezQsfS1bMDFdXGQtWzAtM11cZFRbMC0yXVxkOlswLTVdXGQ6WzAtNV1cZFwuXGQrKD86WystXVswLTJdXGQ6WzAtNV1cZHxaKSQvLEpnPS9eW2Etel1bYS16XGQuKy1dKjpcLyooPzpbXjpAXSsoPzo6W15AXSspP0ApPyg/OlteXHM6Lz8jXSt8XFtbYS1mXGQ6XStcXSkoPzo6XGQrKT8oPzpcL1tePyNdKik/KD86XD9bXiNdKik/KD86Iy4qKT8kL2ksS2c9L15bYS16MC05ISMkJSYnKitcLz0/Xl9ge3x9fi4tXStAW2EtejAtOV0oW2EtejAtOS1dKlthLXowLTldKT8oXC5bYS16MC05XShbYS16MC05LV0qW2EtejAtOV0pPykqJC9pLExnPS9eXHMqKFwtfFwrKT8oXGQrfChcZCooXC5cZCopKSkoW2VFXVsrLV0/XGQrKT9ccyokLyxUZD0vXihcZHs0LH0pLShcZHsyfSktKFxkezJ9KSQvLFVkPS9eKFxkezQsfSktKFxkXGQpLShcZFxkKVQoXGRcZCk6KFxkXGQpKD86OihcZFxkKShcLlxkezEsM30pPyk/JC8sCnFjPS9eKFxkezQsfSktVyhcZFxkKSQvLFZkPS9eKFxkezQsfSktKFxkXGQpJC8sV2Q9L14oXGRcZCk6KFxkXGQpKD86OihcZFxkKShcLlxkezEsM30pPyk/JC8sTGQ9UygpO3EoWyJkYXRlIiwiZGF0ZXRpbWUtbG9jYWwiLCJtb250aCIsInRpbWUiLCJ3ZWVrIl0sZnVuY3Rpb24oYSl7TGRbYV09ITB9KTt2YXIgWGQ9e3RleHQ6ZnVuY3Rpb24oYSxiLGQsYyxlLGYpe2xiKGEsYixkLGMsZSxmKTtvYyhjKX0sZGF0ZTptYigiZGF0ZSIsVGQsT2IoVGQsWyJ5eXl5IiwiTU0iLCJkZCJdKSwieXl5eS1NTS1kZCIpLCJkYXRldGltZS1sb2NhbCI6bWIoImRhdGV0aW1lbG9jYWwiLFVkLE9iKFVkLCJ5eXl5IE1NIGRkIEhIIG1tIHNzIHNzcyIuc3BsaXQoIiAiKSksInl5eXktTU0tZGRUSEg6bW06c3Muc3NzIiksdGltZTptYigidGltZSIsV2QsT2IoV2QsWyJISCIsIm1tIiwic3MiLCJzc3MiXSksIkhIOm1tOnNzLnNzcyIpLHdlZWs6bWIoIndlZWsiLHFjLGZ1bmN0aW9uKGEsYil7aWYoaGEoYSkpcmV0dXJuIGE7CmlmKEkoYSkpe3FjLmxhc3RJbmRleD0wO3ZhciBkPXFjLmV4ZWMoYSk7aWYoZCl7dmFyIGM9K2RbMV0sZT0rZFsyXSxmPWQ9MCxnPTAsaD0wLGs9SGQoYyksZT03KihlLTEpO2ImJihkPWIuZ2V0SG91cnMoKSxmPWIuZ2V0TWludXRlcygpLGc9Yi5nZXRTZWNvbmRzKCksaD1iLmdldE1pbGxpc2Vjb25kcygpKTtyZXR1cm4gbmV3IERhdGUoYywwLGsuZ2V0RGF0ZSgpK2UsZCxmLGcsaCl9fXJldHVybiBOYU59LCJ5eXl5LVd3dyIpLG1vbnRoOm1iKCJtb250aCIsVmQsT2IoVmQsWyJ5eXl5IiwiTU0iXSksInl5eXktTU0iKSxudW1iZXI6ZnVuY3Rpb24oYSxiLGQsYyxlLGYpe01kKGEsYixkLGMpO2xiKGEsYixkLGMsZSxmKTtjLiQkcGFyc2VyTmFtZT0ibnVtYmVyIjtjLiRwYXJzZXJzLnB1c2goZnVuY3Rpb24oYSl7aWYoYy4kaXNFbXB0eShhKSlyZXR1cm4gbnVsbDtpZihMZy50ZXN0KGEpKXJldHVybiBwYXJzZUZsb2F0KGEpfSk7Yy4kZm9ybWF0dGVycy5wdXNoKGZ1bmN0aW9uKGEpe2lmKCFjLiRpc0VtcHR5KGEpKXtpZighUShhKSl0aHJvdyBuYigibnVtZm10IiwKYSk7YT1hLnRvU3RyaW5nKCl9cmV0dXJuIGF9KTtpZih2KGQubWluKXx8ZC5uZ01pbil7dmFyIGc7Yy4kdmFsaWRhdG9ycy5taW49ZnVuY3Rpb24oYSl7cmV0dXJuIGMuJGlzRW1wdHkoYSl8fHkoZyl8fGE+PWd9O2QuJG9ic2VydmUoIm1pbiIsZnVuY3Rpb24oYSl7dihhKSYmIVEoYSkmJihhPXBhcnNlRmxvYXQoYSwxMCkpO2c9UShhKSYmIWlzTmFOKGEpP2E6dm9pZCAwO2MuJHZhbGlkYXRlKCl9KX1pZih2KGQubWF4KXx8ZC5uZ01heCl7dmFyIGg7Yy4kdmFsaWRhdG9ycy5tYXg9ZnVuY3Rpb24oYSl7cmV0dXJuIGMuJGlzRW1wdHkoYSl8fHkoaCl8fGE8PWh9O2QuJG9ic2VydmUoIm1heCIsZnVuY3Rpb24oYSl7dihhKSYmIVEoYSkmJihhPXBhcnNlRmxvYXQoYSwxMCkpO2g9UShhKSYmIWlzTmFOKGEpP2E6dm9pZCAwO2MuJHZhbGlkYXRlKCl9KX19LHVybDpmdW5jdGlvbihhLGIsZCxjLGUsZil7bGIoYSxiLGQsYyxlLGYpO29jKGMpO2MuJCRwYXJzZXJOYW1lPSJ1cmwiO2MuJHZhbGlkYXRvcnMudXJsPQpmdW5jdGlvbihhLGIpe3ZhciBkPWF8fGI7cmV0dXJuIGMuJGlzRW1wdHkoZCl8fEpnLnRlc3QoZCl9fSxlbWFpbDpmdW5jdGlvbihhLGIsZCxjLGUsZil7bGIoYSxiLGQsYyxlLGYpO29jKGMpO2MuJCRwYXJzZXJOYW1lPSJlbWFpbCI7Yy4kdmFsaWRhdG9ycy5lbWFpbD1mdW5jdGlvbihhLGIpe3ZhciBkPWF8fGI7cmV0dXJuIGMuJGlzRW1wdHkoZCl8fEtnLnRlc3QoZCl9fSxyYWRpbzpmdW5jdGlvbihhLGIsZCxjKXt5KGQubmFtZSkmJmIuYXR0cigibmFtZSIsKytwYik7Yi5vbigiY2xpY2siLGZ1bmN0aW9uKGEpe2JbMF0uY2hlY2tlZCYmYy4kc2V0Vmlld1ZhbHVlKGQudmFsdWUsYSYmYS50eXBlKX0pO2MuJHJlbmRlcj1mdW5jdGlvbigpe2JbMF0uY2hlY2tlZD1kLnZhbHVlPT1jLiR2aWV3VmFsdWV9O2QuJG9ic2VydmUoInZhbHVlIixjLiRyZW5kZXIpfSxjaGVja2JveDpmdW5jdGlvbihhLGIsZCxjLGUsZixnLGgpe3ZhciBrPU5kKGgsYSwibmdUcnVlVmFsdWUiLGQubmdUcnVlVmFsdWUsCiEwKSxsPU5kKGgsYSwibmdGYWxzZVZhbHVlIixkLm5nRmFsc2VWYWx1ZSwhMSk7Yi5vbigiY2xpY2siLGZ1bmN0aW9uKGEpe2MuJHNldFZpZXdWYWx1ZShiWzBdLmNoZWNrZWQsYSYmYS50eXBlKX0pO2MuJHJlbmRlcj1mdW5jdGlvbigpe2JbMF0uY2hlY2tlZD1jLiR2aWV3VmFsdWV9O2MuJGlzRW1wdHk9ZnVuY3Rpb24oYSl7cmV0dXJuITE9PT1hfTtjLiRmb3JtYXR0ZXJzLnB1c2goZnVuY3Rpb24oYSl7cmV0dXJuIG5hKGEsayl9KTtjLiRwYXJzZXJzLnB1c2goZnVuY3Rpb24oYSl7cmV0dXJuIGE/azpsfSl9LGhpZGRlbjpDLGJ1dHRvbjpDLHN1Ym1pdDpDLHJlc2V0OkMsZmlsZTpDfSxGYz1bIiRicm93c2VyIiwiJHNuaWZmZXIiLCIkZmlsdGVyIiwiJHBhcnNlIixmdW5jdGlvbihhLGIsZCxjKXtyZXR1cm57cmVzdHJpY3Q6IkUiLHJlcXVpcmU6WyI/bmdNb2RlbCJdLGxpbms6e3ByZTpmdW5jdGlvbihlLGYsZyxoKXtoWzBdJiYoWGRbTChnLnR5cGUpXXx8WGQudGV4dCkoZSxmLApnLGhbMF0sYixhLGQsYyl9fX19XSxNZz0vXih0cnVlfGZhbHNlfFxkKykkLyxVZT1mdW5jdGlvbigpe3JldHVybntyZXN0cmljdDoiQSIscHJpb3JpdHk6MTAwLGNvbXBpbGU6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gTWcudGVzdChiLm5nVmFsdWUpP2Z1bmN0aW9uKGEsYixlKXtlLiRzZXQoInZhbHVlIixhLiRldmFsKGUubmdWYWx1ZSkpfTpmdW5jdGlvbihhLGIsZSl7YS4kd2F0Y2goZS5uZ1ZhbHVlLGZ1bmN0aW9uKGEpe2UuJHNldCgidmFsdWUiLGEpfSl9fX19LHVlPVsiJGNvbXBpbGUiLGZ1bmN0aW9uKGEpe3JldHVybntyZXN0cmljdDoiQUMiLGNvbXBpbGU6ZnVuY3Rpb24oYil7YS4kJGFkZEJpbmRpbmdDbGFzcyhiKTtyZXR1cm4gZnVuY3Rpb24oYixjLGUpe2EuJCRhZGRCaW5kaW5nSW5mbyhjLGUubmdCaW5kKTtjPWNbMF07Yi4kd2F0Y2goZS5uZ0JpbmQsZnVuY3Rpb24oYSl7Yy50ZXh0Q29udGVudD15KGEpPyIiOmF9KX19fX1dLHdlPVsiJGludGVycG9sYXRlIiwiJGNvbXBpbGUiLApmdW5jdGlvbihhLGIpe3JldHVybntjb21waWxlOmZ1bmN0aW9uKGQpe2IuJCRhZGRCaW5kaW5nQ2xhc3MoZCk7cmV0dXJuIGZ1bmN0aW9uKGMsZCxmKXtjPWEoZC5hdHRyKGYuJGF0dHIubmdCaW5kVGVtcGxhdGUpKTtiLiQkYWRkQmluZGluZ0luZm8oZCxjLmV4cHJlc3Npb25zKTtkPWRbMF07Zi4kb2JzZXJ2ZSgibmdCaW5kVGVtcGxhdGUiLGZ1bmN0aW9uKGEpe2QudGV4dENvbnRlbnQ9eShhKT8iIjphfSl9fX19XSx2ZT1bIiRzY2UiLCIkcGFyc2UiLCIkY29tcGlsZSIsZnVuY3Rpb24oYSxiLGQpe3JldHVybntyZXN0cmljdDoiQSIsY29tcGlsZTpmdW5jdGlvbihjLGUpe3ZhciBmPWIoZS5uZ0JpbmRIdG1sKSxnPWIoZS5uZ0JpbmRIdG1sLGZ1bmN0aW9uKGIpe3JldHVybiBhLnZhbHVlT2YoYil9KTtkLiQkYWRkQmluZGluZ0NsYXNzKGMpO3JldHVybiBmdW5jdGlvbihiLGMsZSl7ZC4kJGFkZEJpbmRpbmdJbmZvKGMsZS5uZ0JpbmRIdG1sKTtiLiR3YXRjaChnLGZ1bmN0aW9uKCl7dmFyIGQ9CmYoYik7Yy5odG1sKGEuZ2V0VHJ1c3RlZEh0bWwoZCl8fCIiKX0pfX19fV0sVGU9Y2Eoe3Jlc3RyaWN0OiJBIixyZXF1aXJlOiJuZ01vZGVsIixsaW5rOmZ1bmN0aW9uKGEsYixkLGMpe2MuJHZpZXdDaGFuZ2VMaXN0ZW5lcnMucHVzaChmdW5jdGlvbigpe2EuJGV2YWwoZC5uZ0NoYW5nZSl9KX19KSx4ZT1wYygiIiwhMCksemU9cGMoIk9kZCIsMCkseWU9cGMoIkV2ZW4iLDEpLEFlPU1hKHtjb21waWxlOmZ1bmN0aW9uKGEsYil7Yi4kc2V0KCJuZ0Nsb2FrIix2b2lkIDApO2EucmVtb3ZlQ2xhc3MoIm5nLWNsb2FrIil9fSksQmU9W2Z1bmN0aW9uKCl7cmV0dXJue3Jlc3RyaWN0OiJBIixzY29wZTohMCxjb250cm9sbGVyOiJAIixwcmlvcml0eTo1MDB9fV0sS2M9e30sTmc9e2JsdXI6ITAsZm9jdXM6ITB9O3EoImNsaWNrIGRibGNsaWNrIG1vdXNlZG93biBtb3VzZXVwIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZW1vdmUgbW91c2VlbnRlciBtb3VzZWxlYXZlIGtleWRvd24ga2V5dXAga2V5cHJlc3Mgc3VibWl0IGZvY3VzIGJsdXIgY29weSBjdXQgcGFzdGUiLnNwbGl0KCIgIiksCmZ1bmN0aW9uKGEpe3ZhciBiPXdhKCJuZy0iK2EpO0tjW2JdPVsiJHBhcnNlIiwiJHJvb3RTY29wZSIsZnVuY3Rpb24oZCxjKXtyZXR1cm57cmVzdHJpY3Q6IkEiLGNvbXBpbGU6ZnVuY3Rpb24oZSxmKXt2YXIgZz1kKGZbYl0sbnVsbCwhMCk7cmV0dXJuIGZ1bmN0aW9uKGIsZCl7ZC5vbihhLGZ1bmN0aW9uKGQpe3ZhciBlPWZ1bmN0aW9uKCl7ZyhiLHskZXZlbnQ6ZH0pfTtOZ1thXSYmYy4kJHBoYXNlP2IuJGV2YWxBc3luYyhlKTpiLiRhcHBseShlKX0pfX19fV19KTt2YXIgRWU9WyIkYW5pbWF0ZSIsIiRjb21waWxlIixmdW5jdGlvbihhLGIpe3JldHVybnttdWx0aUVsZW1lbnQ6ITAsdHJhbnNjbHVkZToiZWxlbWVudCIscHJpb3JpdHk6NjAwLHRlcm1pbmFsOiEwLHJlc3RyaWN0OiJBIiwkJHRsYjohMCxsaW5rOmZ1bmN0aW9uKGQsYyxlLGYsZyl7dmFyIGgsayxsO2QuJHdhdGNoKGUubmdJZixmdW5jdGlvbihkKXtkP2t8fGcoZnVuY3Rpb24oZCxmKXtrPWY7ZFtkLmxlbmd0aCsrXT0KYi4kJGNyZWF0ZUNvbW1lbnQoImVuZCBuZ0lmIixlLm5nSWYpO2g9e2Nsb25lOmR9O2EuZW50ZXIoZCxjLnBhcmVudCgpLGMpfSk6KGwmJihsLnJlbW92ZSgpLGw9bnVsbCksayYmKGsuJGRlc3Ryb3koKSxrPW51bGwpLGgmJihsPXRiKGguY2xvbmUpLGEubGVhdmUobCkudGhlbihmdW5jdGlvbigpe2w9bnVsbH0pLGg9bnVsbCkpfSl9fX1dLEZlPVsiJHRlbXBsYXRlUmVxdWVzdCIsIiRhbmNob3JTY3JvbGwiLCIkYW5pbWF0ZSIsZnVuY3Rpb24oYSxiLGQpe3JldHVybntyZXN0cmljdDoiRUNBIixwcmlvcml0eTo0MDAsdGVybWluYWw6ITAsdHJhbnNjbHVkZToiZWxlbWVudCIsY29udHJvbGxlcjpkYS5ub29wLGNvbXBpbGU6ZnVuY3Rpb24oYyxlKXt2YXIgZj1lLm5nSW5jbHVkZXx8ZS5zcmMsZz1lLm9ubG9hZHx8IiIsaD1lLmF1dG9zY3JvbGw7cmV0dXJuIGZ1bmN0aW9uKGMsZSxtLG4scCl7dmFyIHE9MCxzLHoscixEPWZ1bmN0aW9uKCl7eiYmKHoucmVtb3ZlKCksej1udWxsKTtzJiYKKHMuJGRlc3Ryb3koKSxzPW51bGwpO3ImJihkLmxlYXZlKHIpLnRoZW4oZnVuY3Rpb24oKXt6PW51bGx9KSx6PXIscj1udWxsKX07Yy4kd2F0Y2goZixmdW5jdGlvbihmKXt2YXIgbT1mdW5jdGlvbigpeyF2KGgpfHxoJiYhYy4kZXZhbChoKXx8YigpfSx3PSsrcTtmPyhhKGYsITApLnRoZW4oZnVuY3Rpb24oYSl7aWYoIWMuJCRkZXN0cm95ZWQmJnc9PT1xKXt2YXIgYj1jLiRuZXcoKTtuLnRlbXBsYXRlPWE7YT1wKGIsZnVuY3Rpb24oYSl7RCgpO2QuZW50ZXIoYSxudWxsLGUpLnRoZW4obSl9KTtzPWI7cj1hO3MuJGVtaXQoIiRpbmNsdWRlQ29udGVudExvYWRlZCIsZik7Yy4kZXZhbChnKX19LGZ1bmN0aW9uKCl7Yy4kJGRlc3Ryb3llZHx8dyE9PXF8fChEKCksYy4kZW1pdCgiJGluY2x1ZGVDb250ZW50RXJyb3IiLGYpKX0pLGMuJGVtaXQoIiRpbmNsdWRlQ29udGVudFJlcXVlc3RlZCIsZikpOihEKCksbi50ZW1wbGF0ZT1udWxsKX0pfX19fV0sV2U9WyIkY29tcGlsZSIsZnVuY3Rpb24oYSl7cmV0dXJue3Jlc3RyaWN0OiJFQ0EiLApwcmlvcml0eTotNDAwLHJlcXVpcmU6Im5nSW5jbHVkZSIsbGluazpmdW5jdGlvbihiLGQsYyxlKXtqYS5jYWxsKGRbMF0pLm1hdGNoKC9TVkcvKT8oZC5lbXB0eSgpLGEoTmMoZS50ZW1wbGF0ZSxGLmRvY3VtZW50KS5jaGlsZE5vZGVzKShiLGZ1bmN0aW9uKGEpe2QuYXBwZW5kKGEpfSx7ZnV0dXJlUGFyZW50RWxlbWVudDpkfSkpOihkLmh0bWwoZS50ZW1wbGF0ZSksYShkLmNvbnRlbnRzKCkpKGIpKX19fV0sR2U9TWEoe3ByaW9yaXR5OjQ1MCxjb21waWxlOmZ1bmN0aW9uKCl7cmV0dXJue3ByZTpmdW5jdGlvbihhLGIsZCl7YS4kZXZhbChkLm5nSW5pdCl9fX19KSxTZT1mdW5jdGlvbigpe3JldHVybntyZXN0cmljdDoiQSIscHJpb3JpdHk6MTAwLHJlcXVpcmU6Im5nTW9kZWwiLGxpbms6ZnVuY3Rpb24oYSxiLGQsYyl7dmFyIGU9Yi5hdHRyKGQuJGF0dHIubmdMaXN0KXx8IiwgIixmPSJmYWxzZSIhPT1kLm5nVHJpbSxnPWY/VihlKTplO2MuJHBhcnNlcnMucHVzaChmdW5jdGlvbihhKXtpZigheShhKSl7dmFyIGI9CltdO2EmJnEoYS5zcGxpdChnKSxmdW5jdGlvbihhKXthJiZiLnB1c2goZj9WKGEpOmEpfSk7cmV0dXJuIGJ9fSk7Yy4kZm9ybWF0dGVycy5wdXNoKGZ1bmN0aW9uKGEpe2lmKEsoYSkpcmV0dXJuIGEuam9pbihlKX0pO2MuJGlzRW1wdHk9ZnVuY3Rpb24oYSl7cmV0dXJuIWF8fCFhLmxlbmd0aH19fX0sb2I9Im5nLXZhbGlkIixPZD0ibmctaW52YWxpZCIsVmE9Im5nLXByaXN0aW5lIixOYj0ibmctZGlydHkiLFFkPSJuZy1wZW5kaW5nIixuYj1PKCJuZ01vZGVsIiksT2c9WyIkc2NvcGUiLCIkZXhjZXB0aW9uSGFuZGxlciIsIiRhdHRycyIsIiRlbGVtZW50IiwiJHBhcnNlIiwiJGFuaW1hdGUiLCIkdGltZW91dCIsIiRyb290U2NvcGUiLCIkcSIsIiRpbnRlcnBvbGF0ZSIsZnVuY3Rpb24oYSxiLGQsYyxlLGYsZyxoLGssbCl7dGhpcy4kbW9kZWxWYWx1ZT10aGlzLiR2aWV3VmFsdWU9TnVtYmVyLk5hTjt0aGlzLiQkcmF3TW9kZWxWYWx1ZT12b2lkIDA7dGhpcy4kdmFsaWRhdG9ycz17fTsKdGhpcy4kYXN5bmNWYWxpZGF0b3JzPXt9O3RoaXMuJHBhcnNlcnM9W107dGhpcy4kZm9ybWF0dGVycz1bXTt0aGlzLiR2aWV3Q2hhbmdlTGlzdGVuZXJzPVtdO3RoaXMuJHVudG91Y2hlZD0hMDt0aGlzLiR0b3VjaGVkPSExO3RoaXMuJHByaXN0aW5lPSEwO3RoaXMuJGRpcnR5PSExO3RoaXMuJHZhbGlkPSEwO3RoaXMuJGludmFsaWQ9ITE7dGhpcy4kZXJyb3I9e307dGhpcy4kJHN1Y2Nlc3M9e307dGhpcy4kcGVuZGluZz12b2lkIDA7dGhpcy4kbmFtZT1sKGQubmFtZXx8IiIsITEpKGEpO3RoaXMuJCRwYXJlbnRGb3JtPU1iO3ZhciBtPWUoZC5uZ01vZGVsKSxuPW0uYXNzaWduLHA9bSxzPW4sRj1udWxsLHoscj10aGlzO3RoaXMuJCRzZXRPcHRpb25zPWZ1bmN0aW9uKGEpe2lmKChyLiRvcHRpb25zPWEpJiZhLmdldHRlclNldHRlcil7dmFyIGI9ZShkLm5nTW9kZWwrIigpIiksZj1lKGQubmdNb2RlbCsiKCQkJHApIik7cD1mdW5jdGlvbihhKXt2YXIgYz1tKGEpO0UoYykmJihjPWIoYSkpOwpyZXR1cm4gY307cz1mdW5jdGlvbihhLGIpe0UobShhKSk/ZihhLHskJCRwOmJ9KTpuKGEsYil9fWVsc2UgaWYoIW0uYXNzaWduKXRocm93IG5iKCJub25hc3NpZ24iLGQubmdNb2RlbCx1YShjKSk7fTt0aGlzLiRyZW5kZXI9Qzt0aGlzLiRpc0VtcHR5PWZ1bmN0aW9uKGEpe3JldHVybiB5KGEpfHwiIj09PWF8fG51bGw9PT1hfHxhIT09YX07dGhpcy4kJHVwZGF0ZUVtcHR5Q2xhc3Nlcz1mdW5jdGlvbihhKXtyLiRpc0VtcHR5KGEpPyhmLnJlbW92ZUNsYXNzKGMsIm5nLW5vdC1lbXB0eSIpLGYuYWRkQ2xhc3MoYywibmctZW1wdHkiKSk6KGYucmVtb3ZlQ2xhc3MoYywibmctZW1wdHkiKSxmLmFkZENsYXNzKGMsIm5nLW5vdC1lbXB0eSIpKX07dmFyIEQ9MDtLZCh7Y3RybDp0aGlzLCRlbGVtZW50OmMsc2V0OmZ1bmN0aW9uKGEsYil7YVtiXT0hMH0sdW5zZXQ6ZnVuY3Rpb24oYSxiKXtkZWxldGUgYVtiXX0sJGFuaW1hdGU6Zn0pO3RoaXMuJHNldFByaXN0aW5lPWZ1bmN0aW9uKCl7ci4kZGlydHk9CiExO3IuJHByaXN0aW5lPSEwO2YucmVtb3ZlQ2xhc3MoYyxOYik7Zi5hZGRDbGFzcyhjLFZhKX07dGhpcy4kc2V0RGlydHk9ZnVuY3Rpb24oKXtyLiRkaXJ0eT0hMDtyLiRwcmlzdGluZT0hMTtmLnJlbW92ZUNsYXNzKGMsVmEpO2YuYWRkQ2xhc3MoYyxOYik7ci4kJHBhcmVudEZvcm0uJHNldERpcnR5KCl9O3RoaXMuJHNldFVudG91Y2hlZD1mdW5jdGlvbigpe3IuJHRvdWNoZWQ9ITE7ci4kdW50b3VjaGVkPSEwO2Yuc2V0Q2xhc3MoYywibmctdW50b3VjaGVkIiwibmctdG91Y2hlZCIpfTt0aGlzLiRzZXRUb3VjaGVkPWZ1bmN0aW9uKCl7ci4kdG91Y2hlZD0hMDtyLiR1bnRvdWNoZWQ9ITE7Zi5zZXRDbGFzcyhjLCJuZy10b3VjaGVkIiwibmctdW50b3VjaGVkIil9O3RoaXMuJHJvbGxiYWNrVmlld1ZhbHVlPWZ1bmN0aW9uKCl7Zy5jYW5jZWwoRik7ci4kdmlld1ZhbHVlPXIuJCRsYXN0Q29tbWl0dGVkVmlld1ZhbHVlO3IuJHJlbmRlcigpfTt0aGlzLiR2YWxpZGF0ZT1mdW5jdGlvbigpe2lmKCFRKHIuJG1vZGVsVmFsdWUpfHwKIWlzTmFOKHIuJG1vZGVsVmFsdWUpKXt2YXIgYT1yLiQkcmF3TW9kZWxWYWx1ZSxiPXIuJHZhbGlkLGM9ci4kbW9kZWxWYWx1ZSxkPXIuJG9wdGlvbnMmJnIuJG9wdGlvbnMuYWxsb3dJbnZhbGlkO3IuJCRydW5WYWxpZGF0b3JzKGEsci4kJGxhc3RDb21taXR0ZWRWaWV3VmFsdWUsZnVuY3Rpb24oZSl7ZHx8Yj09PWV8fChyLiRtb2RlbFZhbHVlPWU/YTp2b2lkIDAsci4kbW9kZWxWYWx1ZSE9PWMmJnIuJCR3cml0ZU1vZGVsVG9TY29wZSgpKX0pfX07dGhpcy4kJHJ1blZhbGlkYXRvcnM9ZnVuY3Rpb24oYSxiLGMpe2Z1bmN0aW9uIGQoKXt2YXIgYz0hMDtxKHIuJHZhbGlkYXRvcnMsZnVuY3Rpb24oZCxlKXt2YXIgZz1kKGEsYik7Yz1jJiZnO2YoZSxnKX0pO3JldHVybiBjPyEwOihxKHIuJGFzeW5jVmFsaWRhdG9ycyxmdW5jdGlvbihhLGIpe2YoYixudWxsKX0pLCExKX1mdW5jdGlvbiBlKCl7dmFyIGM9W10sZD0hMDtxKHIuJGFzeW5jVmFsaWRhdG9ycyxmdW5jdGlvbihlLGcpe3ZhciBoPQplKGEsYik7aWYoIWh8fCFFKGgudGhlbikpdGhyb3cgbmIoIm5vcHJvbWlzZSIsaCk7ZihnLHZvaWQgMCk7Yy5wdXNoKGgudGhlbihmdW5jdGlvbigpe2YoZywhMCl9LGZ1bmN0aW9uKCl7ZD0hMTtmKGcsITEpfSkpfSk7Yy5sZW5ndGg/ay5hbGwoYykudGhlbihmdW5jdGlvbigpe2coZCl9LEMpOmcoITApfWZ1bmN0aW9uIGYoYSxiKXtoPT09RCYmci4kc2V0VmFsaWRpdHkoYSxiKX1mdW5jdGlvbiBnKGEpe2g9PT1EJiZjKGEpfUQrKzt2YXIgaD1EOyhmdW5jdGlvbigpe3ZhciBhPXIuJCRwYXJzZXJOYW1lfHwicGFyc2UiO2lmKHkoeikpZihhLG51bGwpO2Vsc2UgcmV0dXJuIHp8fChxKHIuJHZhbGlkYXRvcnMsZnVuY3Rpb24oYSxiKXtmKGIsbnVsbCl9KSxxKHIuJGFzeW5jVmFsaWRhdG9ycyxmdW5jdGlvbihhLGIpe2YoYixudWxsKX0pKSxmKGEseiksejtyZXR1cm4hMH0pKCk/ZCgpP2UoKTpnKCExKTpnKCExKX07dGhpcy4kY29tbWl0Vmlld1ZhbHVlPWZ1bmN0aW9uKCl7dmFyIGE9CnIuJHZpZXdWYWx1ZTtnLmNhbmNlbChGKTtpZihyLiQkbGFzdENvbW1pdHRlZFZpZXdWYWx1ZSE9PWF8fCIiPT09YSYmci4kJGhhc05hdGl2ZVZhbGlkYXRvcnMpci4kJHVwZGF0ZUVtcHR5Q2xhc3NlcyhhKSxyLiQkbGFzdENvbW1pdHRlZFZpZXdWYWx1ZT1hLHIuJHByaXN0aW5lJiZ0aGlzLiRzZXREaXJ0eSgpLHRoaXMuJCRwYXJzZUFuZFZhbGlkYXRlKCl9O3RoaXMuJCRwYXJzZUFuZFZhbGlkYXRlPWZ1bmN0aW9uKCl7dmFyIGI9ci4kJGxhc3RDb21taXR0ZWRWaWV3VmFsdWU7aWYoej15KGIpP3ZvaWQgMDohMClmb3IodmFyIGM9MDtjPHIuJHBhcnNlcnMubGVuZ3RoO2MrKylpZihiPXIuJHBhcnNlcnNbY10oYikseShiKSl7ej0hMTticmVha31RKHIuJG1vZGVsVmFsdWUpJiZpc05hTihyLiRtb2RlbFZhbHVlKSYmKHIuJG1vZGVsVmFsdWU9cChhKSk7dmFyIGQ9ci4kbW9kZWxWYWx1ZSxlPXIuJG9wdGlvbnMmJnIuJG9wdGlvbnMuYWxsb3dJbnZhbGlkO3IuJCRyYXdNb2RlbFZhbHVlPQpiO2UmJihyLiRtb2RlbFZhbHVlPWIsci4kbW9kZWxWYWx1ZSE9PWQmJnIuJCR3cml0ZU1vZGVsVG9TY29wZSgpKTtyLiQkcnVuVmFsaWRhdG9ycyhiLHIuJCRsYXN0Q29tbWl0dGVkVmlld1ZhbHVlLGZ1bmN0aW9uKGEpe2V8fChyLiRtb2RlbFZhbHVlPWE/Yjp2b2lkIDAsci4kbW9kZWxWYWx1ZSE9PWQmJnIuJCR3cml0ZU1vZGVsVG9TY29wZSgpKX0pfTt0aGlzLiQkd3JpdGVNb2RlbFRvU2NvcGU9ZnVuY3Rpb24oKXtzKGEsci4kbW9kZWxWYWx1ZSk7cShyLiR2aWV3Q2hhbmdlTGlzdGVuZXJzLGZ1bmN0aW9uKGEpe3RyeXthKCl9Y2F0Y2goYyl7YihjKX19KX07dGhpcy4kc2V0Vmlld1ZhbHVlPWZ1bmN0aW9uKGEsYil7ci4kdmlld1ZhbHVlPWE7ci4kb3B0aW9ucyYmIXIuJG9wdGlvbnMudXBkYXRlT25EZWZhdWx0fHxyLiQkZGVib3VuY2VWaWV3VmFsdWVDb21taXQoYil9O3RoaXMuJCRkZWJvdW5jZVZpZXdWYWx1ZUNvbW1pdD1mdW5jdGlvbihiKXt2YXIgYz0wLGQ9ci4kb3B0aW9uczsKZCYmdihkLmRlYm91bmNlKSYmKGQ9ZC5kZWJvdW5jZSxRKGQpP2M9ZDpRKGRbYl0pP2M9ZFtiXTpRKGRbImRlZmF1bHQiXSkmJihjPWRbImRlZmF1bHQiXSkpO2cuY2FuY2VsKEYpO2M/Rj1nKGZ1bmN0aW9uKCl7ci4kY29tbWl0Vmlld1ZhbHVlKCl9LGMpOmguJCRwaGFzZT9yLiRjb21taXRWaWV3VmFsdWUoKTphLiRhcHBseShmdW5jdGlvbigpe3IuJGNvbW1pdFZpZXdWYWx1ZSgpfSl9O2EuJHdhdGNoKGZ1bmN0aW9uKCl7dmFyIGI9cChhKTtpZihiIT09ci4kbW9kZWxWYWx1ZSYmKHIuJG1vZGVsVmFsdWU9PT1yLiRtb2RlbFZhbHVlfHxiPT09Yikpe3IuJG1vZGVsVmFsdWU9ci4kJHJhd01vZGVsVmFsdWU9Yjt6PXZvaWQgMDtmb3IodmFyIGM9ci4kZm9ybWF0dGVycyxkPWMubGVuZ3RoLGU9YjtkLS07KWU9Y1tkXShlKTtyLiR2aWV3VmFsdWUhPT1lJiYoci4kJHVwZGF0ZUVtcHR5Q2xhc3NlcyhlKSxyLiR2aWV3VmFsdWU9ci4kJGxhc3RDb21taXR0ZWRWaWV3VmFsdWU9ZSxyLiRyZW5kZXIoKSwKci4kJHJ1blZhbGlkYXRvcnMoYixlLEMpKX1yZXR1cm4gYn0pfV0sUmU9WyIkcm9vdFNjb3BlIixmdW5jdGlvbihhKXtyZXR1cm57cmVzdHJpY3Q6IkEiLHJlcXVpcmU6WyJuZ01vZGVsIiwiXj9mb3JtIiwiXj9uZ01vZGVsT3B0aW9ucyJdLGNvbnRyb2xsZXI6T2cscHJpb3JpdHk6MSxjb21waWxlOmZ1bmN0aW9uKGIpe2IuYWRkQ2xhc3MoVmEpLmFkZENsYXNzKCJuZy11bnRvdWNoZWQiKS5hZGRDbGFzcyhvYik7cmV0dXJue3ByZTpmdW5jdGlvbihhLGIsZSxmKXt2YXIgZz1mWzBdO2I9ZlsxXXx8Zy4kJHBhcmVudEZvcm07Zy4kJHNldE9wdGlvbnMoZlsyXSYmZlsyXS4kb3B0aW9ucyk7Yi4kYWRkQ29udHJvbChnKTtlLiRvYnNlcnZlKCJuYW1lIixmdW5jdGlvbihhKXtnLiRuYW1lIT09YSYmZy4kJHBhcmVudEZvcm0uJCRyZW5hbWVDb250cm9sKGcsYSl9KTthLiRvbigiJGRlc3Ryb3kiLGZ1bmN0aW9uKCl7Zy4kJHBhcmVudEZvcm0uJHJlbW92ZUNvbnRyb2woZyl9KX0scG9zdDpmdW5jdGlvbihiLApjLGUsZil7dmFyIGc9ZlswXTtpZihnLiRvcHRpb25zJiZnLiRvcHRpb25zLnVwZGF0ZU9uKWMub24oZy4kb3B0aW9ucy51cGRhdGVPbixmdW5jdGlvbihhKXtnLiQkZGVib3VuY2VWaWV3VmFsdWVDb21taXQoYSYmYS50eXBlKX0pO2Mub24oImJsdXIiLGZ1bmN0aW9uKCl7Zy4kdG91Y2hlZHx8KGEuJCRwaGFzZT9iLiRldmFsQXN5bmMoZy4kc2V0VG91Y2hlZCk6Yi4kYXBwbHkoZy4kc2V0VG91Y2hlZCkpfSl9fX19fV0sUGc9Lyhccyt8XilkZWZhdWx0KFxzK3wkKS8sVmU9ZnVuY3Rpb24oKXtyZXR1cm57cmVzdHJpY3Q6IkEiLGNvbnRyb2xsZXI6WyIkc2NvcGUiLCIkYXR0cnMiLGZ1bmN0aW9uKGEsYil7dmFyIGQ9dGhpczt0aGlzLiRvcHRpb25zPW9hKGEuJGV2YWwoYi5uZ01vZGVsT3B0aW9ucykpO3YodGhpcy4kb3B0aW9ucy51cGRhdGVPbik/KHRoaXMuJG9wdGlvbnMudXBkYXRlT25EZWZhdWx0PSExLHRoaXMuJG9wdGlvbnMudXBkYXRlT249Vih0aGlzLiRvcHRpb25zLnVwZGF0ZU9uLnJlcGxhY2UoUGcsCmZ1bmN0aW9uKCl7ZC4kb3B0aW9ucy51cGRhdGVPbkRlZmF1bHQ9ITA7cmV0dXJuIiAifSkpKTp0aGlzLiRvcHRpb25zLnVwZGF0ZU9uRGVmYXVsdD0hMH1dfX0sSGU9TWEoe3Rlcm1pbmFsOiEwLHByaW9yaXR5OjFFM30pLFFnPU8oIm5nT3B0aW9ucyIpLFJnPS9eXHMqKFtcc1xTXSs/KSg/OlxzK2FzXHMrKFtcc1xTXSs/KSk/KD86XHMrZ3JvdXBccytieVxzKyhbXHNcU10rPykpPyg/OlxzK2Rpc2FibGVccyt3aGVuXHMrKFtcc1xTXSs/KSk/XHMrZm9yXHMrKD86KFtcJFx3XVtcJFx3XSopfCg/OlwoXHMqKFtcJFx3XVtcJFx3XSopXHMqLFxzKihbXCRcd11bXCRcd10qKVxzKlwpKSlccytpblxzKyhbXHNcU10rPykoPzpccyt0cmFja1xzK2J5XHMrKFtcc1xTXSs/KSk/JC8sUGU9WyIkY29tcGlsZSIsIiRkb2N1bWVudCIsIiRwYXJzZSIsZnVuY3Rpb24oYSxiLGQpe2Z1bmN0aW9uIGMoYSxiLGMpe2Z1bmN0aW9uIGUoYSxiLGMsZCxmKXt0aGlzLnNlbGVjdFZhbHVlPWE7dGhpcy52aWV3VmFsdWU9CmI7dGhpcy5sYWJlbD1jO3RoaXMuZ3JvdXA9ZDt0aGlzLmRpc2FibGVkPWZ9ZnVuY3Rpb24gZihhKXt2YXIgYjtpZighcSYmeGEoYSkpYj1hO2Vsc2V7Yj1bXTtmb3IodmFyIGMgaW4gYSlhLmhhc093blByb3BlcnR5KGMpJiYiJCIhPT1jLmNoYXJBdCgwKSYmYi5wdXNoKGMpfXJldHVybiBifXZhciBuPWEubWF0Y2goUmcpO2lmKCFuKXRocm93IFFnKCJpZXhwIixhLHVhKGIpKTt2YXIgcD1uWzVdfHxuWzddLHE9bls2XTthPS8gYXMgLy50ZXN0KG5bMF0pJiZuWzFdO3ZhciBzPW5bOV07Yj1kKG5bMl0/blsxXTpwKTt2YXIgej1hJiZkKGEpfHxiLHI9cyYmZChzKSx2PXM/ZnVuY3Rpb24oYSxiKXtyZXR1cm4gcihjLGIpfTpmdW5jdGlvbihhKXtyZXR1cm4gR2EoYSl9LHU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdihhLEgoYSxiKSl9LHQ9ZChuWzJdfHxuWzFdKSx3PWQoblszXXx8IiIpLHk9ZChuWzRdfHwiIiksQj1kKG5bOF0pLEE9e30sSD1xP2Z1bmN0aW9uKGEsYil7QVtxXT1iO0FbcF09CmE7cmV0dXJuIEF9OmZ1bmN0aW9uKGEpe0FbcF09YTtyZXR1cm4gQX07cmV0dXJue3RyYWNrQnk6cyxnZXRUcmFja0J5VmFsdWU6dSxnZXRXYXRjaGFibGVzOmQoQixmdW5jdGlvbihhKXt2YXIgYj1bXTthPWF8fFtdO2Zvcih2YXIgZD1mKGEpLGU9ZC5sZW5ndGgsZz0wO2c8ZTtnKyspe3ZhciBoPWE9PT1kP2c6ZFtnXSxsPWFbaF0saD1IKGwsaCksbD12KGwsaCk7Yi5wdXNoKGwpO2lmKG5bMl18fG5bMV0pbD10KGMsaCksYi5wdXNoKGwpO25bNF0mJihoPXkoYyxoKSxiLnB1c2goaCkpfXJldHVybiBifSksZ2V0T3B0aW9uczpmdW5jdGlvbigpe2Zvcih2YXIgYT1bXSxiPXt9LGQ9QihjKXx8W10sZz1mKGQpLGg9Zy5sZW5ndGgsbj0wO248aDtuKyspe3ZhciBwPWQ9PT1nP246Z1tuXSxxPUgoZFtwXSxwKSxyPXooYyxxKSxwPXYocixxKSx4PXQoYyxxKSxBPXcoYyxxKSxxPXkoYyxxKSxyPW5ldyBlKHAscix4LEEscSk7YS5wdXNoKHIpO2JbcF09cn1yZXR1cm57aXRlbXM6YSxzZWxlY3RWYWx1ZU1hcDpiLApnZXRPcHRpb25Gcm9tVmlld1ZhbHVlOmZ1bmN0aW9uKGEpe3JldHVybiBiW3UoYSldfSxnZXRWaWV3VmFsdWVGcm9tT3B0aW9uOmZ1bmN0aW9uKGEpe3JldHVybiBzP2RhLmNvcHkoYS52aWV3VmFsdWUpOmEudmlld1ZhbHVlfX19fX12YXIgZT1GLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpLGY9Ri5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRncm91cCIpO3JldHVybntyZXN0cmljdDoiQSIsdGVybWluYWw6ITAscmVxdWlyZTpbInNlbGVjdCIsIm5nTW9kZWwiXSxsaW5rOntwcmU6ZnVuY3Rpb24oYSxiLGMsZCl7ZFswXS5yZWdpc3Rlck9wdGlvbj1DfSxwb3N0OmZ1bmN0aW9uKGQsaCxrLGwpe2Z1bmN0aW9uIG0oYSxiKXthLmVsZW1lbnQ9YjtiLmRpc2FibGVkPWEuZGlzYWJsZWQ7YS5sYWJlbCE9PWIubGFiZWwmJihiLmxhYmVsPWEubGFiZWwsYi50ZXh0Q29udGVudD1hLmxhYmVsKTthLnZhbHVlIT09Yi52YWx1ZSYmKGIudmFsdWU9YS5zZWxlY3RWYWx1ZSl9ZnVuY3Rpb24gbigpe3ZhciBhPQp3JiZwLnJlYWRWYWx1ZSgpO2lmKHcpZm9yKHZhciBiPXcuaXRlbXMubGVuZ3RoLTE7MDw9YjtiLS0pe3ZhciBjPXcuaXRlbXNbYl07Yy5ncm91cD9EYihjLmVsZW1lbnQucGFyZW50Tm9kZSk6RGIoYy5lbGVtZW50KX13PUMuZ2V0T3B0aW9ucygpO3ZhciBkPXt9O3UmJmgucHJlcGVuZCh6KTt3Lml0ZW1zLmZvckVhY2goZnVuY3Rpb24oYSl7dmFyIGI7aWYodihhLmdyb3VwKSl7Yj1kW2EuZ3JvdXBdO2J8fChiPWYuY2xvbmVOb2RlKCExKSxCLmFwcGVuZENoaWxkKGIpLGIubGFiZWw9YS5ncm91cCxkW2EuZ3JvdXBdPWIpO3ZhciBjPWUuY2xvbmVOb2RlKCExKX1lbHNlIGI9QixjPWUuY2xvbmVOb2RlKCExKTtiLmFwcGVuZENoaWxkKGMpO20oYSxjKX0pO2hbMF0uYXBwZW5kQ2hpbGQoQik7cy4kcmVuZGVyKCk7cy4kaXNFbXB0eShhKXx8KGI9cC5yZWFkVmFsdWUoKSwoQy50cmFja0J5fHx5P25hKGEsYik6YT09PWIpfHwocy4kc2V0Vmlld1ZhbHVlKGIpLHMuJHJlbmRlcigpKSl9dmFyIHA9CmxbMF0scz1sWzFdLHk9ay5tdWx0aXBsZSx6O2w9MDtmb3IodmFyIHI9aC5jaGlsZHJlbigpLEQ9ci5sZW5ndGg7bDxEO2wrKylpZigiIj09PXJbbF0udmFsdWUpe3o9ci5lcShsKTticmVha312YXIgdT0hIXosdD1HKGUuY2xvbmVOb2RlKCExKSk7dC52YWwoIj8iKTt2YXIgdyxDPWMoay5uZ09wdGlvbnMsaCxkKSxCPWJbMF0uY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO3k/KHMuJGlzRW1wdHk9ZnVuY3Rpb24oYSl7cmV0dXJuIWF8fDA9PT1hLmxlbmd0aH0scC53cml0ZVZhbHVlPWZ1bmN0aW9uKGEpe3cuaXRlbXMuZm9yRWFjaChmdW5jdGlvbihhKXthLmVsZW1lbnQuc2VsZWN0ZWQ9ITF9KTthJiZhLmZvckVhY2goZnVuY3Rpb24oYSl7aWYoYT13LmdldE9wdGlvbkZyb21WaWV3VmFsdWUoYSkpYS5lbGVtZW50LnNlbGVjdGVkPSEwfSl9LHAucmVhZFZhbHVlPWZ1bmN0aW9uKCl7dmFyIGE9aC52YWwoKXx8W10sYj1bXTtxKGEsZnVuY3Rpb24oYSl7KGE9dy5zZWxlY3RWYWx1ZU1hcFthXSkmJgohYS5kaXNhYmxlZCYmYi5wdXNoKHcuZ2V0Vmlld1ZhbHVlRnJvbU9wdGlvbihhKSl9KTtyZXR1cm4gYn0sQy50cmFja0J5JiZkLiR3YXRjaENvbGxlY3Rpb24oZnVuY3Rpb24oKXtpZihLKHMuJHZpZXdWYWx1ZSkpcmV0dXJuIHMuJHZpZXdWYWx1ZS5tYXAoZnVuY3Rpb24oYSl7cmV0dXJuIEMuZ2V0VHJhY2tCeVZhbHVlKGEpfSl9LGZ1bmN0aW9uKCl7cy4kcmVuZGVyKCl9KSk6KHAud3JpdGVWYWx1ZT1mdW5jdGlvbihhKXt2YXIgYj13LmdldE9wdGlvbkZyb21WaWV3VmFsdWUoYSk7Yj8oaFswXS52YWx1ZSE9PWIuc2VsZWN0VmFsdWUmJih0LnJlbW92ZSgpLHV8fHoucmVtb3ZlKCksaFswXS52YWx1ZT1iLnNlbGVjdFZhbHVlLGIuZWxlbWVudC5zZWxlY3RlZD0hMCksYi5lbGVtZW50LnNldEF0dHJpYnV0ZSgic2VsZWN0ZWQiLCJzZWxlY3RlZCIpKTpudWxsPT09YXx8dT8odC5yZW1vdmUoKSx1fHxoLnByZXBlbmQoeiksaC52YWwoIiIpLHoucHJvcCgic2VsZWN0ZWQiLCEwKSx6LmF0dHIoInNlbGVjdGVkIiwKITApKToodXx8ei5yZW1vdmUoKSxoLnByZXBlbmQodCksaC52YWwoIj8iKSx0LnByb3AoInNlbGVjdGVkIiwhMCksdC5hdHRyKCJzZWxlY3RlZCIsITApKX0scC5yZWFkVmFsdWU9ZnVuY3Rpb24oKXt2YXIgYT13LnNlbGVjdFZhbHVlTWFwW2gudmFsKCldO3JldHVybiBhJiYhYS5kaXNhYmxlZD8odXx8ei5yZW1vdmUoKSx0LnJlbW92ZSgpLHcuZ2V0Vmlld1ZhbHVlRnJvbU9wdGlvbihhKSk6bnVsbH0sQy50cmFja0J5JiZkLiR3YXRjaChmdW5jdGlvbigpe3JldHVybiBDLmdldFRyYWNrQnlWYWx1ZShzLiR2aWV3VmFsdWUpfSxmdW5jdGlvbigpe3MuJHJlbmRlcigpfSkpO3U/KHoucmVtb3ZlKCksYSh6KShkKSx6LnJlbW92ZUNsYXNzKCJuZy1zY29wZSIpKTp6PUcoZS5jbG9uZU5vZGUoITEpKTtoLmVtcHR5KCk7bigpO2QuJHdhdGNoQ29sbGVjdGlvbihDLmdldFdhdGNoYWJsZXMsbil9fX19XSxJZT1bIiRsb2NhbGUiLCIkaW50ZXJwb2xhdGUiLCIkbG9nIixmdW5jdGlvbihhLGIsCmQpe3ZhciBjPS97fS9nLGU9L153aGVuKE1pbnVzKT8oLispJC87cmV0dXJue2xpbms6ZnVuY3Rpb24oZixnLGgpe2Z1bmN0aW9uIGsoYSl7Zy50ZXh0KGF8fCIiKX12YXIgbD1oLmNvdW50LG09aC4kYXR0ci53aGVuJiZnLmF0dHIoaC4kYXR0ci53aGVuKSxuPWgub2Zmc2V0fHwwLHA9Zi4kZXZhbChtKXx8e30scz17fSx2PWIuc3RhcnRTeW1ib2woKSx6PWIuZW5kU3ltYm9sKCkscj12K2wrIi0iK24reixEPWRhLm5vb3AsdTtxKGgsZnVuY3Rpb24oYSxiKXt2YXIgYz1lLmV4ZWMoYik7YyYmKGM9KGNbMV0/Ii0iOiIiKStMKGNbMl0pLHBbY109Zy5hdHRyKGguJGF0dHJbYl0pKX0pO3EocCxmdW5jdGlvbihhLGQpe3NbZF09YihhLnJlcGxhY2UoYyxyKSl9KTtmLiR3YXRjaChsLGZ1bmN0aW9uKGIpe3ZhciBjPXBhcnNlRmxvYXQoYiksZT1pc05hTihjKTtlfHxjIGluIHB8fChjPWEucGx1cmFsQ2F0KGMtbikpO2M9PT11fHxlJiZRKHUpJiZpc05hTih1KXx8KEQoKSxlPXNbY10seShlKT8KKG51bGwhPWImJmQuZGVidWcoIm5nUGx1cmFsaXplOiBubyBydWxlIGRlZmluZWQgZm9yICciK2MrIicgaW4gIittKSxEPUMsaygpKTpEPWYuJHdhdGNoKGUsayksdT1jKX0pfX19XSxKZT1bIiRwYXJzZSIsIiRhbmltYXRlIiwiJGNvbXBpbGUiLGZ1bmN0aW9uKGEsYixkKXt2YXIgYz1PKCJuZ1JlcGVhdCIpLGU9ZnVuY3Rpb24oYSxiLGMsZCxlLG0sbil7YVtjXT1kO2UmJihhW2VdPW0pO2EuJGluZGV4PWI7YS4kZmlyc3Q9MD09PWI7YS4kbGFzdD1iPT09bi0xO2EuJG1pZGRsZT0hKGEuJGZpcnN0fHxhLiRsYXN0KTthLiRvZGQ9IShhLiRldmVuPTA9PT0oYiYxKSl9O3JldHVybntyZXN0cmljdDoiQSIsbXVsdGlFbGVtZW50OiEwLHRyYW5zY2x1ZGU6ImVsZW1lbnQiLHByaW9yaXR5OjFFMyx0ZXJtaW5hbDohMCwkJHRsYjohMCxjb21waWxlOmZ1bmN0aW9uKGYsZyl7dmFyIGg9Zy5uZ1JlcGVhdCxrPWQuJCRjcmVhdGVDb21tZW50KCJlbmQgbmdSZXBlYXQiLGgpLGw9aC5tYXRjaCgvXlxzKihbXHNcU10rPylccytpblxzKyhbXHNcU10rPykoPzpccythc1xzKyhbXHNcU10rPykpPyg/OlxzK3RyYWNrXHMrYnlccysoW1xzXFNdKz8pKT9ccyokLyk7CmlmKCFsKXRocm93IGMoImlleHAiLGgpO3ZhciBtPWxbMV0sbj1sWzJdLHA9bFszXSxzPWxbNF0sbD1tLm1hdGNoKC9eKD86KFxzKltcJFx3XSspfFwoXHMqKFtcJFx3XSspXHMqLFxzKihbXCRcd10rKVxzKlwpKSQvKTtpZighbCl0aHJvdyBjKCJpaWRleHAiLG0pO3ZhciB2PWxbM118fGxbMV0sej1sWzJdO2lmKHAmJighL15bJGEtekEtWl9dWyRhLXpBLVowLTlfXSokLy50ZXN0KHApfHwvXihudWxsfHVuZGVmaW5lZHx0aGlzfFwkaW5kZXh8XCRmaXJzdHxcJG1pZGRsZXxcJGxhc3R8XCRldmVufFwkb2RkfFwkcGFyZW50fFwkcm9vdHxcJGlkKSQvLnRlc3QocCkpKXRocm93IGMoImJhZGlkZW50IixwKTt2YXIgcixELHUsdCx3PXskaWQ6R2F9O3M/cj1hKHMpOih1PWZ1bmN0aW9uKGEsYil7cmV0dXJuIEdhKGIpfSx0PWZ1bmN0aW9uKGEpe3JldHVybiBhfSk7cmV0dXJuIGZ1bmN0aW9uKGEsZCxmLGcsbCl7ciYmKEQ9ZnVuY3Rpb24oYixjLGQpe3omJih3W3pdPWIpO3dbdl09Yzt3LiRpbmRleD0KZDtyZXR1cm4gcihhLHcpfSk7dmFyIG09UygpO2EuJHdhdGNoQ29sbGVjdGlvbihuLGZ1bmN0aW9uKGYpe3ZhciBnLG4scj1kWzBdLHMseD1TKCksdyx5LEMsQSxGLEUsRztwJiYoYVtwXT1mKTtpZih4YShmKSlGPWYsbj1EfHx1O2Vsc2UgZm9yKEcgaW4gbj1EfHx0LEY9W10sZilzYS5jYWxsKGYsRykmJiIkIiE9PUcuY2hhckF0KDApJiZGLnB1c2goRyk7dz1GLmxlbmd0aDtHPUFycmF5KHcpO2ZvcihnPTA7Zzx3O2crKylpZih5PWY9PT1GP2c6RltnXSxDPWZbeV0sQT1uKHksQyxnKSxtW0FdKUU9bVtBXSxkZWxldGUgbVtBXSx4W0FdPUUsR1tnXT1FO2Vsc2V7aWYoeFtBXSl0aHJvdyBxKEcsZnVuY3Rpb24oYSl7YSYmYS5zY29wZSYmKG1bYS5pZF09YSl9KSxjKCJkdXBlcyIsaCxBLEMpO0dbZ109e2lkOkEsc2NvcGU6dm9pZCAwLGNsb25lOnZvaWQgMH07eFtBXT0hMH1mb3IocyBpbiBtKXtFPW1bc107QT10YihFLmNsb25lKTtiLmxlYXZlKEEpO2lmKEFbMF0ucGFyZW50Tm9kZSlmb3IoZz0KMCxuPUEubGVuZ3RoO2c8bjtnKyspQVtnXS4kJE5HX1JFTU9WRUQ9ITA7RS5zY29wZS4kZGVzdHJveSgpfWZvcihnPTA7Zzx3O2crKylpZih5PWY9PT1GP2c6RltnXSxDPWZbeV0sRT1HW2ddLEUuc2NvcGUpe3M9cjtkbyBzPXMubmV4dFNpYmxpbmc7d2hpbGUocyYmcy4kJE5HX1JFTU9WRUQpO0UuY2xvbmVbMF0hPXMmJmIubW92ZSh0YihFLmNsb25lKSxudWxsLHIpO3I9RS5jbG9uZVtFLmNsb25lLmxlbmd0aC0xXTtlKEUuc2NvcGUsZyx2LEMseix5LHcpfWVsc2UgbChmdW5jdGlvbihhLGMpe0Uuc2NvcGU9Yzt2YXIgZD1rLmNsb25lTm9kZSghMSk7YVthLmxlbmd0aCsrXT1kO2IuZW50ZXIoYSxudWxsLHIpO3I9ZDtFLmNsb25lPWE7eFtFLmlkXT1FO2UoRS5zY29wZSxnLHYsQyx6LHksdyl9KTttPXh9KX19fX1dLEtlPVsiJGFuaW1hdGUiLGZ1bmN0aW9uKGEpe3JldHVybntyZXN0cmljdDoiQSIsbXVsdGlFbGVtZW50OiEwLGxpbms6ZnVuY3Rpb24oYixkLGMpe2IuJHdhdGNoKGMubmdTaG93LApmdW5jdGlvbihiKXthW2I/InJlbW92ZUNsYXNzIjoiYWRkQ2xhc3MiXShkLCJuZy1oaWRlIix7dGVtcENsYXNzZXM6Im5nLWhpZGUtYW5pbWF0ZSJ9KX0pfX19XSxEZT1bIiRhbmltYXRlIixmdW5jdGlvbihhKXtyZXR1cm57cmVzdHJpY3Q6IkEiLG11bHRpRWxlbWVudDohMCxsaW5rOmZ1bmN0aW9uKGIsZCxjKXtiLiR3YXRjaChjLm5nSGlkZSxmdW5jdGlvbihiKXthW2I/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXShkLCJuZy1oaWRlIix7dGVtcENsYXNzZXM6Im5nLWhpZGUtYW5pbWF0ZSJ9KX0pfX19XSxMZT1NYShmdW5jdGlvbihhLGIsZCl7YS4kd2F0Y2goZC5uZ1N0eWxlLGZ1bmN0aW9uKGEsZCl7ZCYmYSE9PWQmJnEoZCxmdW5jdGlvbihhLGMpe2IuY3NzKGMsIiIpfSk7YSYmYi5jc3MoYSl9LCEwKX0pLE1lPVsiJGFuaW1hdGUiLCIkY29tcGlsZSIsZnVuY3Rpb24oYSxiKXtyZXR1cm57cmVxdWlyZToibmdTd2l0Y2giLGNvbnRyb2xsZXI6WyIkc2NvcGUiLGZ1bmN0aW9uKCl7dGhpcy5jYXNlcz0Ke319XSxsaW5rOmZ1bmN0aW9uKGQsYyxlLGYpe3ZhciBnPVtdLGg9W10saz1bXSxsPVtdLG09ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZnVuY3Rpb24oKXthLnNwbGljZShiLDEpfX07ZC4kd2F0Y2goZS5uZ1N3aXRjaHx8ZS5vbixmdW5jdGlvbihjKXt2YXIgZCxlO2Q9MDtmb3IoZT1rLmxlbmd0aDtkPGU7KytkKWEuY2FuY2VsKGtbZF0pO2Q9ay5sZW5ndGg9MDtmb3IoZT1sLmxlbmd0aDtkPGU7KytkKXt2YXIgcz10YihoW2RdLmNsb25lKTtsW2RdLiRkZXN0cm95KCk7KGtbZF09YS5sZWF2ZShzKSkudGhlbihtKGssZCkpfWgubGVuZ3RoPTA7bC5sZW5ndGg9MDsoZz1mLmNhc2VzWyIhIitjXXx8Zi5jYXNlc1siPyJdKSYmcShnLGZ1bmN0aW9uKGMpe2MudHJhbnNjbHVkZShmdW5jdGlvbihkLGUpe2wucHVzaChlKTt2YXIgZj1jLmVsZW1lbnQ7ZFtkLmxlbmd0aCsrXT1iLiQkY3JlYXRlQ29tbWVudCgiZW5kIG5nU3dpdGNoV2hlbiIpO2gucHVzaCh7Y2xvbmU6ZH0pO2EuZW50ZXIoZCxmLnBhcmVudCgpLApmKX0pfSl9KX19fV0sTmU9TWEoe3RyYW5zY2x1ZGU6ImVsZW1lbnQiLHByaW9yaXR5OjEyMDAscmVxdWlyZToiXm5nU3dpdGNoIixtdWx0aUVsZW1lbnQ6ITAsbGluazpmdW5jdGlvbihhLGIsZCxjLGUpe2MuY2FzZXNbIiEiK2QubmdTd2l0Y2hXaGVuXT1jLmNhc2VzWyIhIitkLm5nU3dpdGNoV2hlbl18fFtdO2MuY2FzZXNbIiEiK2QubmdTd2l0Y2hXaGVuXS5wdXNoKHt0cmFuc2NsdWRlOmUsZWxlbWVudDpifSl9fSksT2U9TWEoe3RyYW5zY2x1ZGU6ImVsZW1lbnQiLHByaW9yaXR5OjEyMDAscmVxdWlyZToiXm5nU3dpdGNoIixtdWx0aUVsZW1lbnQ6ITAsbGluazpmdW5jdGlvbihhLGIsZCxjLGUpe2MuY2FzZXNbIj8iXT1jLmNhc2VzWyI/Il18fFtdO2MuY2FzZXNbIj8iXS5wdXNoKHt0cmFuc2NsdWRlOmUsZWxlbWVudDpifSl9fSksU2c9TygibmdUcmFuc2NsdWRlIiksUWU9TWEoe3Jlc3RyaWN0OiJFQUMiLGxpbms6ZnVuY3Rpb24oYSxiLGQsYyxlKXtkLm5nVHJhbnNjbHVkZT09PQpkLiRhdHRyLm5nVHJhbnNjbHVkZSYmKGQubmdUcmFuc2NsdWRlPSIiKTtpZighZSl0aHJvdyBTZygib3JwaGFuIix1YShiKSk7ZShmdW5jdGlvbihhKXthLmxlbmd0aCYmKGIuZW1wdHkoKSxiLmFwcGVuZChhKSl9LG51bGwsZC5uZ1RyYW5zY2x1ZGV8fGQubmdUcmFuc2NsdWRlU2xvdCl9fSkscWU9WyIkdGVtcGxhdGVDYWNoZSIsZnVuY3Rpb24oYSl7cmV0dXJue3Jlc3RyaWN0OiJFIix0ZXJtaW5hbDohMCxjb21waWxlOmZ1bmN0aW9uKGIsZCl7InRleHQvbmctdGVtcGxhdGUiPT1kLnR5cGUmJmEucHV0KGQuaWQsYlswXS50ZXh0KX19fV0sVGc9eyRzZXRWaWV3VmFsdWU6QywkcmVuZGVyOkN9LFVnPVsiJGVsZW1lbnQiLCIkc2NvcGUiLGZ1bmN0aW9uKGEsYil7dmFyIGQ9dGhpcyxjPW5ldyBTYTtkLm5nTW9kZWxDdHJsPVRnO2QudW5rbm93bk9wdGlvbj1HKEYuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIikpO2QucmVuZGVyVW5rbm93bk9wdGlvbj1mdW5jdGlvbihiKXtiPQoiPyAiK0dhKGIpKyIgPyI7ZC51bmtub3duT3B0aW9uLnZhbChiKTthLnByZXBlbmQoZC51bmtub3duT3B0aW9uKTthLnZhbChiKX07Yi4kb24oIiRkZXN0cm95IixmdW5jdGlvbigpe2QucmVuZGVyVW5rbm93bk9wdGlvbj1DfSk7ZC5yZW1vdmVVbmtub3duT3B0aW9uPWZ1bmN0aW9uKCl7ZC51bmtub3duT3B0aW9uLnBhcmVudCgpJiZkLnVua25vd25PcHRpb24ucmVtb3ZlKCl9O2QucmVhZFZhbHVlPWZ1bmN0aW9uKCl7ZC5yZW1vdmVVbmtub3duT3B0aW9uKCk7cmV0dXJuIGEudmFsKCl9O2Qud3JpdGVWYWx1ZT1mdW5jdGlvbihiKXtkLmhhc09wdGlvbihiKT8oZC5yZW1vdmVVbmtub3duT3B0aW9uKCksYS52YWwoYiksIiI9PT1iJiZkLmVtcHR5T3B0aW9uLnByb3AoInNlbGVjdGVkIiwhMCkpOm51bGw9PWImJmQuZW1wdHlPcHRpb24/KGQucmVtb3ZlVW5rbm93bk9wdGlvbigpLGEudmFsKCIiKSk6ZC5yZW5kZXJVbmtub3duT3B0aW9uKGIpfTtkLmFkZE9wdGlvbj1mdW5jdGlvbihhLApiKXtpZig4IT09YlswXS5ub2RlVHlwZSl7UmEoYSwnIm9wdGlvbiB2YWx1ZSInKTsiIj09PWEmJihkLmVtcHR5T3B0aW9uPWIpO3ZhciBnPWMuZ2V0KGEpfHwwO2MucHV0KGEsZysxKTtkLm5nTW9kZWxDdHJsLiRyZW5kZXIoKTtiWzBdLmhhc0F0dHJpYnV0ZSgic2VsZWN0ZWQiKSYmKGJbMF0uc2VsZWN0ZWQ9ITApfX07ZC5yZW1vdmVPcHRpb249ZnVuY3Rpb24oYSl7dmFyIGI9Yy5nZXQoYSk7YiYmKDE9PT1iPyhjLnJlbW92ZShhKSwiIj09PWEmJihkLmVtcHR5T3B0aW9uPXZvaWQgMCkpOmMucHV0KGEsYi0xKSl9O2QuaGFzT3B0aW9uPWZ1bmN0aW9uKGEpe3JldHVybiEhYy5nZXQoYSl9O2QucmVnaXN0ZXJPcHRpb249ZnVuY3Rpb24oYSxiLGMsaCxrKXtpZihoKXt2YXIgbDtjLiRvYnNlcnZlKCJ2YWx1ZSIsZnVuY3Rpb24oYSl7dihsKSYmZC5yZW1vdmVPcHRpb24obCk7bD1hO2QuYWRkT3B0aW9uKGEsYil9KX1lbHNlIGs/YS4kd2F0Y2goayxmdW5jdGlvbihhLGUpe2MuJHNldCgidmFsdWUiLAphKTtlIT09YSYmZC5yZW1vdmVPcHRpb24oZSk7ZC5hZGRPcHRpb24oYSxiKX0pOmQuYWRkT3B0aW9uKGMudmFsdWUsYik7Yi5vbigiJGRlc3Ryb3kiLGZ1bmN0aW9uKCl7ZC5yZW1vdmVPcHRpb24oYy52YWx1ZSk7ZC5uZ01vZGVsQ3RybC4kcmVuZGVyKCl9KX19XSxyZT1mdW5jdGlvbigpe3JldHVybntyZXN0cmljdDoiRSIscmVxdWlyZTpbInNlbGVjdCIsIj9uZ01vZGVsIl0sY29udHJvbGxlcjpVZyxwcmlvcml0eToxLGxpbms6e3ByZTpmdW5jdGlvbihhLGIsZCxjKXt2YXIgZT1jWzFdO2lmKGUpe3ZhciBmPWNbMF07Zi5uZ01vZGVsQ3RybD1lO2Iub24oImNoYW5nZSIsZnVuY3Rpb24oKXthLiRhcHBseShmdW5jdGlvbigpe2UuJHNldFZpZXdWYWx1ZShmLnJlYWRWYWx1ZSgpKX0pfSk7aWYoZC5tdWx0aXBsZSl7Zi5yZWFkVmFsdWU9ZnVuY3Rpb24oKXt2YXIgYT1bXTtxKGIuZmluZCgib3B0aW9uIiksZnVuY3Rpb24oYil7Yi5zZWxlY3RlZCYmYS5wdXNoKGIudmFsdWUpfSk7cmV0dXJuIGF9OwpmLndyaXRlVmFsdWU9ZnVuY3Rpb24oYSl7dmFyIGM9bmV3IFNhKGEpO3EoYi5maW5kKCJvcHRpb24iKSxmdW5jdGlvbihhKXthLnNlbGVjdGVkPXYoYy5nZXQoYS52YWx1ZSkpfSl9O3ZhciBnLGg9TmFOO2EuJHdhdGNoKGZ1bmN0aW9uKCl7aCE9PWUuJHZpZXdWYWx1ZXx8bmEoZyxlLiR2aWV3VmFsdWUpfHwoZz1mYShlLiR2aWV3VmFsdWUpLGUuJHJlbmRlcigpKTtoPWUuJHZpZXdWYWx1ZX0pO2UuJGlzRW1wdHk9ZnVuY3Rpb24oYSl7cmV0dXJuIWF8fDA9PT1hLmxlbmd0aH19fX0scG9zdDpmdW5jdGlvbihhLGIsZCxjKXt2YXIgZT1jWzFdO2lmKGUpe3ZhciBmPWNbMF07ZS4kcmVuZGVyPWZ1bmN0aW9uKCl7Zi53cml0ZVZhbHVlKGUuJHZpZXdWYWx1ZSl9fX19fX0sdGU9WyIkaW50ZXJwb2xhdGUiLGZ1bmN0aW9uKGEpe3JldHVybntyZXN0cmljdDoiRSIscHJpb3JpdHk6MTAwLGNvbXBpbGU6ZnVuY3Rpb24oYixkKXtpZih2KGQudmFsdWUpKXZhciBjPWEoZC52YWx1ZSwhMCk7ZWxzZXt2YXIgZT0KYShiLnRleHQoKSwhMCk7ZXx8ZC4kc2V0KCJ2YWx1ZSIsYi50ZXh0KCkpfXJldHVybiBmdW5jdGlvbihhLGIsZCl7dmFyIGs9Yi5wYXJlbnQoKTsoaz1rLmRhdGEoIiRzZWxlY3RDb250cm9sbGVyIil8fGsucGFyZW50KCkuZGF0YSgiJHNlbGVjdENvbnRyb2xsZXIiKSkmJmsucmVnaXN0ZXJPcHRpb24oYSxiLGQsYyxlKX19fX1dLHNlPWNhKHtyZXN0cmljdDoiRSIsdGVybWluYWw6ITF9KSxIYz1mdW5jdGlvbigpe3JldHVybntyZXN0cmljdDoiQSIscmVxdWlyZToiP25nTW9kZWwiLGxpbms6ZnVuY3Rpb24oYSxiLGQsYyl7YyYmKGQucmVxdWlyZWQ9ITAsYy4kdmFsaWRhdG9ycy5yZXF1aXJlZD1mdW5jdGlvbihhLGIpe3JldHVybiFkLnJlcXVpcmVkfHwhYy4kaXNFbXB0eShiKX0sZC4kb2JzZXJ2ZSgicmVxdWlyZWQiLGZ1bmN0aW9uKCl7Yy4kdmFsaWRhdGUoKX0pKX19fSxHYz1mdW5jdGlvbigpe3JldHVybntyZXN0cmljdDoiQSIscmVxdWlyZToiP25nTW9kZWwiLGxpbms6ZnVuY3Rpb24oYSwKYixkLGMpe2lmKGMpe3ZhciBlLGY9ZC5uZ1BhdHRlcm58fGQucGF0dGVybjtkLiRvYnNlcnZlKCJwYXR0ZXJuIixmdW5jdGlvbihhKXtJKGEpJiYwPGEubGVuZ3RoJiYoYT1uZXcgUmVnRXhwKCJeIithKyIkIikpO2lmKGEmJiFhLnRlc3QpdGhyb3cgTygibmdQYXR0ZXJuIikoIm5vcmVnZXhwIixmLGEsdWEoYikpO2U9YXx8dm9pZCAwO2MuJHZhbGlkYXRlKCl9KTtjLiR2YWxpZGF0b3JzLnBhdHRlcm49ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYy4kaXNFbXB0eShiKXx8eShlKXx8ZS50ZXN0KGIpfX19fX0sSmM9ZnVuY3Rpb24oKXtyZXR1cm57cmVzdHJpY3Q6IkEiLHJlcXVpcmU6Ij9uZ01vZGVsIixsaW5rOmZ1bmN0aW9uKGEsYixkLGMpe2lmKGMpe3ZhciBlPS0xO2QuJG9ic2VydmUoIm1heGxlbmd0aCIsZnVuY3Rpb24oYSl7YT0kKGEpO2U9aXNOYU4oYSk/LTE6YTtjLiR2YWxpZGF0ZSgpfSk7Yy4kdmFsaWRhdG9ycy5tYXhsZW5ndGg9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gMD5lfHxjLiRpc0VtcHR5KGIpfHwKYi5sZW5ndGg8PWV9fX19fSxJYz1mdW5jdGlvbigpe3JldHVybntyZXN0cmljdDoiQSIscmVxdWlyZToiP25nTW9kZWwiLGxpbms6ZnVuY3Rpb24oYSxiLGQsYyl7aWYoYyl7dmFyIGU9MDtkLiRvYnNlcnZlKCJtaW5sZW5ndGgiLGZ1bmN0aW9uKGEpe2U9JChhKXx8MDtjLiR2YWxpZGF0ZSgpfSk7Yy4kdmFsaWRhdG9ycy5taW5sZW5ndGg9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYy4kaXNFbXB0eShiKXx8Yi5sZW5ndGg+PWV9fX19fTtGLmFuZ3VsYXIuYm9vdHN0cmFwP0YuY29uc29sZSYmY29uc29sZS5sb2coIldBUk5JTkc6IFRyaWVkIHRvIGxvYWQgYW5ndWxhciBtb3JlIHRoYW4gb25jZS4iKTooamUoKSxsZShkYSksZGEubW9kdWxlKCJuZ0xvY2FsZSIsW10sWyIkcHJvdmlkZSIsZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihhKXthKz0iIjt2YXIgYj1hLmluZGV4T2YoIi4iKTtyZXR1cm4tMT09Yj8wOmEubGVuZ3RoLWItMX1hLnZhbHVlKCIkbG9jYWxlIix7REFURVRJTUVfRk9STUFUUzp7QU1QTVM6WyJBTSIsCiJQTSJdLERBWToiU3VuZGF5IE1vbmRheSBUdWVzZGF5IFdlZG5lc2RheSBUaHVyc2RheSBGcmlkYXkgU2F0dXJkYXkiLnNwbGl0KCIgIiksRVJBTkFNRVM6WyJCZWZvcmUgQ2hyaXN0IiwiQW5ubyBEb21pbmkiXSxFUkFTOlsiQkMiLCJBRCJdLEZJUlNUREFZT0ZXRUVLOjYsTU9OVEg6IkphbnVhcnkgRmVicnVhcnkgTWFyY2ggQXByaWwgTWF5IEp1bmUgSnVseSBBdWd1c3QgU2VwdGVtYmVyIE9jdG9iZXIgTm92ZW1iZXIgRGVjZW1iZXIiLnNwbGl0KCIgIiksU0hPUlREQVk6IlN1biBNb24gVHVlIFdlZCBUaHUgRnJpIFNhdCIuc3BsaXQoIiAiKSxTSE9SVE1PTlRIOiJKYW4gRmViIE1hciBBcHIgTWF5IEp1biBKdWwgQXVnIFNlcCBPY3QgTm92IERlYyIuc3BsaXQoIiAiKSxTVEFOREFMT05FTU9OVEg6IkphbnVhcnkgRmVicnVhcnkgTWFyY2ggQXByaWwgTWF5IEp1bmUgSnVseSBBdWd1c3QgU2VwdGVtYmVyIE9jdG9iZXIgTm92ZW1iZXIgRGVjZW1iZXIiLnNwbGl0KCIgIiksV0VFS0VORFJBTkdFOls1LAo2XSxmdWxsRGF0ZToiRUVFRSwgTU1NTSBkLCB5Iixsb25nRGF0ZToiTU1NTSBkLCB5IixtZWRpdW06Ik1NTSBkLCB5IGg6bW06c3MgYSIsbWVkaXVtRGF0ZToiTU1NIGQsIHkiLG1lZGl1bVRpbWU6Img6bW06c3MgYSIsInNob3J0IjoiTS9kL3l5IGg6bW0gYSIsc2hvcnREYXRlOiJNL2QveXkiLHNob3J0VGltZToiaDptbSBhIn0sTlVNQkVSX0ZPUk1BVFM6e0NVUlJFTkNZX1NZTToiJCIsREVDSU1BTF9TRVA6Ii4iLEdST1VQX1NFUDoiLCIsUEFUVEVSTlM6W3tnU2l6ZTozLGxnU2l6ZTozLG1heEZyYWM6MyxtaW5GcmFjOjAsbWluSW50OjEsbmVnUHJlOiItIixuZWdTdWY6IiIscG9zUHJlOiIiLHBvc1N1ZjoiIn0se2dTaXplOjMsbGdTaXplOjMsbWF4RnJhYzoyLG1pbkZyYWM6MixtaW5JbnQ6MSxuZWdQcmU6Ii1cdTAwYTQiLG5lZ1N1ZjoiIixwb3NQcmU6Ilx1MDBhNCIscG9zU3VmOiIifV19LGlkOiJlbi11cyIsbG9jYWxlSUQ6ImVuX1VTIixwbHVyYWxDYXQ6ZnVuY3Rpb24oYSwKYyl7dmFyIGU9YXwwLGY9Yzt2b2lkIDA9PT1mJiYoZj1NYXRoLm1pbihiKGEpLDMpKTtNYXRoLnBvdygxMCxmKTtyZXR1cm4gMT09ZSYmMD09Zj8ib25lIjoib3RoZXIifX0pfV0pLEcoRi5kb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtmZShGLmRvY3VtZW50LEFjKX0pKX0pKHdpbmRvdyk7IXdpbmRvdy5hbmd1bGFyLiQkY3NwKCkubm9JbmxpbmVTdHlsZSYmd2luZG93LmFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5oZWFkKS5wcmVwZW5kKCc8c3R5bGUgdHlwZT0idGV4dC9jc3MiPkBjaGFyc2V0ICJVVEYtOCI7W25nXFw6Y2xvYWtdLFtuZy1jbG9ha10sW2RhdGEtbmctY2xvYWtdLFt4LW5nLWNsb2FrXSwubmctY2xvYWssLngtbmctY2xvYWssLm5nLWhpZGU6bm90KC5uZy1oaWRlLWFuaW1hdGUpe2Rpc3BsYXk6bm9uZSAhaW1wb3J0YW50O31uZ1xcOmZvcm17ZGlzcGxheTpibG9jazt9Lm5nLWFuaW1hdGUtc2hpbXt2aXNpYmlsaXR5OmhpZGRlbjt9Lm5nLWFuY2hvcntwb3NpdGlvbjphYnNvbHV0ZTt9PC9zdHlsZT4nKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9YW5ndWxhci5taW4uanMubWFwCgp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsNCnZhciBkb3dubG9hZEluaXRpYXRlZCA9IGZhbHNlOw0KdmFyIGlzUHJvZ3Jlc3NDb21wbGV0ZSA9IGZhbHNlOw0KdmFyIHBvcnRsZXRJRCA9ICIiOw0KdmFyIERNRFByb2RzID1bXTsgLy8gZG9udCBuZWVkIHRoaXMNCnZhciBjdXJyZW50TW9kZWxOdW1iZXIgPSAiIjsNCnZhciBwcm9kdWN0TmFtZU9pZDEgPSAiIjsNCnZhciB3b3JrRmxvdyA9ICcnOw0KdmFyIG1vZGVsTmFtZSA9ICIiOw0KdmFyIHVuaXF1ZVByb2R1Y3RzID0gW107DQp2YXIgcGlkc0NvdW50ZXIgPSAwOw0KdmFyIHhociA9ICIiOw0KdmFyIHhoclBvb2wgPSBbXTsNCnZhciBpc01vZGVsRm91bmRGb3JTb2x1dGlvbiA9IGZhbHNlOw0KdmFyIGlzUmV0cnkgPSAiIjsNCnZhciBNU0lWZXJzaW9uID0gIiI7DQp2YXIgaXNPblBhZ2VEaXNwbGF5ID0gIiI7DQp2YXIgaXNQZHBTd2RSZXF1ZXN0ID0gZmFsc2U7DQp2YXIgaXNTd0RUYWJSZXF1ZXN0ID0gZmFsc2U7DQp2YXIgaXNXYXJyYW50eUNoZWNrID0gZmFsc2U7DQp2YXIgZG1kU2VsZWN0QnV0dG9uSWQgPSAiIjsNCnZhciBpc1ZlcmlmaWNhdGlvbkNhbmNlbGxlZCA9IGZhbHNlOw0KdmFyIHJ1bkluQmFja2dyb3VuZCA9IGZhbHNlOy8vIHRoaXMgaXMgdG8gY2hlY2sgaWYgZG1kIGlzIHJ1biBpbiB0aGUgYmFja2dyb3VuZA0KdmFyIGlzU3dkU3RlcFR3b1JlcXVlc3QgPSBmYWxzZTsgLy9UaGlzIHdpbGwgaGVscCBrbm93aW5nIHRoZSB0cmlnZ2VyIGZyb20gU1dEIHN0ZXAyDQp2YXIgcHJvZ3Jlc3NQZXJjZW50ID0gMDsNCnZhciBwcm9ncmVzc0ZsYWcgPSBmYWxzZTsNCnZhciBpc0hvbWVQYWdlID0gZmFsc2U7DQoNCg0KdmFyIHByb2dyZXNzYmFyID0gJCggIi5wcm9ncmVzc0JhciIgKSwNCnByb2dyZXNzTGFiZWwgPSAkKCAiLnByb2dyZXNzLWJhci1zdGF0dXMiICk7DQoNCmpRdWVyeSgiZG9jdW1lbnQiKS5yZWFkeShmdW5jdGlvbigpew0KaWYodHlwZW9mIFNTRiAhPSAidW5kZWZpbmVkIil7DQoJaWYodHlwZW9mIGRtZFByaXZhY3lEb2NJZCAhPSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgY29uY2VudHJhQWpheFVybCAhPSAidW5kZWZpbmVkIikNCgl7DQoJCWdldERvY0lEQW5kQnVpbGRTb2xEaWFnTGluaygpOw0KCX0NCg0KCWlzT25QYWdlRGlzcGxheSA9ICQoJyNwbmxGb3VuZFByb2RzJykubGVuZ3RoID4gMDsNCgl2YXIgcHJvZEluZm8gPSBbXTsNCglpc1N0b3BEZXRlY3Rpb24gPSBmYWxzZTsNCgkvKk5lZWQgdG8gY2hhbmdlIHZlcnNpb24gd2hlbiBNU0kgdXBkYXRlIGlzIGF2YWlsYWJlIHRocm91Z2ggc3VwcG9ydCBzaXRlIENvbnNvbGUqLw0KCWxhdGVzdFZlcnNpb24gPSBqUXVlcnkoIiNtc2lWZXJzaW9uIikudmFsKCk7DQoJY3VycmVudE1vZGVsTnVtYmVyID0gJCgnI3BtX3Nlcmllc19tb2RlbF9uYW1lJykudmFsKCk7DQoJcHJvZHVjdE5hbWVPaWQxID0gJCgnI3Rtc1ZhbHVlRm9yU2VhcmNoJykudmFsKCk7DQoJbW9kZWxOYW1lID0gJCgnI3BtX3Nlcmllc19wcm9kdWN0X25hbWUnKS52YWwoKTsNCgkkKCcjcHJvZE5hbWUnKS5odG1sKG1vZGVsTmFtZSk7DQoNCgkvKkhpZGUgRE1EIGZvciBhbGwgbm9uIHdpbmRvd3MgT1MqLw0KCXZhciB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQ7DQoJdmFyIGlzV2luZG93cyA9IHVhLmluZGV4T2YoIldpbmRvd3MgTlQiKT4tMTsNCg0KCS8qaWYoIWlzV2luZG93cykgew0KCQlqUXVlcnkoIi5ETURPU0RldGVjdGlvbiIpLnJlbW92ZSgpDQoNCgl9DQoJaWYgKHR5cGVvZiBub0RNRFJlcXVpcmVkICE9PSAidW5kZWZpbmVkIil7DQoJCWlmKG5vRE1EUmVxdWlyZWQgPT0gJ3RydWUnKQ0KCQl7DQoJCQkkKCcuRE1ET1NEZXRlY3Rpb24nKS5oaWRlKCk7DQoJCX0NCgl9Ki8NCg0KCSQoZnVuY3Rpb24gKCkgew0KCQkkKGRvY3VtZW50KS5vbignY2xpY2snLCcjaW5zdGFsbC13aW5kb3dzLXNlcnZpY2UtYnV0dG9uJywgZnVuY3Rpb24oKXsNCg0KCQkJcGFyZW50LmxvY2F0aW9uID0gbXNpRG93bmxvYWRVUkw7DQoJCQlkb3dubG9hZEluaXRpYXRlZCA9IHRydWU7DQoJCQlydW5JbkJhY2tncm91bmQgPSBmYWxzZTsNCgkJCXB1c2hUb0dsb2JhbERhdGFMYXllcigiTVNJIGRvd25sb2FkIGluaXRpYXRlZCIsZ2xvYmFsRGF0YUxheWVyLlRlbXBsYXRlLCAnJywgJycsICcnLCAnJywgJycsICcnKTsNCgkJCWlmKHR5cGVvZiBTU0YgIT0gInVuZGVmaW5lZCIpew0KCQkJIFNTRi5HZXRWZXJzaW9uKDEsIG9uVXBkYXRlKTsNCgkJCX0NCgkJfSk7DQoJfSk7DQoNCgkvKnBvb2xpbmcgb24gZXZlcnkgMzAwbXMgaW50ZXJ2YWwgdG8gY2hlY2sgaWYgTVNJIGlzIGluc3RhbGxlZCovDQoJdmFyIG9uVXBkYXRlID0gZnVuY3Rpb24oZGF0YSkgew0KCQlpZighaXNTdG9wRGV0ZWN0aW9uKXsNCgkJCWlmIChzc2ZWZXJpb25NYXRjaChkYXRhKSkgew0KCQkJCXB1c2hUb0dsb2JhbERhdGFMYXllcigiTVNJIGluc3RhbGxhdGlvbiBjb21wbGV0ZWQiLGdsb2JhbERhdGFMYXllci5UZW1wbGF0ZSwgJycsICcnLCAnJywgJycsICcnLCAnJyk7DQoJCQkJaWYoaXNPblBhZ2VEaXNwbGF5KXsNCgkJCQkJb25WZXJzaW9uR290UGFnZShkYXRhKTsNCgkJCQl9DQoJCQkJZWxzZXsNCgkJCQkJb25WZXJzaW9uR290KGRhdGEpOw0KDQoJCQkJfQ0KDQoNCg0KCQkJfSBlbHNlIHsNCg0KCQkJCWlmKHR5cGVvZiBTU0YgIT0gInVuZGVmaW5lZCIpew0KCQkJCQlzZXRJbnRlcnZhbChTU0YuR2V0VmVyc2lvbigxLCBvblVwZGF0ZSksIDMwMCk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfTsNCg0KCWpRdWVyeSgiI3Nob3dDb250ZW50IikuaGlkZSgpOw0KCWpRdWVyeSgiLmFjY29yZGlvbkluc3QiKS5jbGljayhmdW5jdGlvbigpew0KCQlqUXVlcnkoIiNzaG93Q29udGVudCIpLnNsaWRlVG9nZ2xlKCdzbG93JywgZnVuY3Rpb24oKXsNCgkJCWlmKGpRdWVyeSgnI3Nob3dDb250ZW50JykuaXMoJzpoaWRkZW4nKSl7DQoJCQkJalF1ZXJ5KCIuc3BhbkltZyIpLmFkZENsYXNzKCdhY2NvcmRpb25QbHVzJykucmVtb3ZlQ2xhc3MoJ2FjY29yZGlvbk1pbnVzJyk7DQoJCQl9ZWxzZXsNCgkJCQlqUXVlcnkoIi5zcGFuSW1nIikucmVtb3ZlQ2xhc3MoJ2FjY29yZGlvblBsdXMnKS5hZGRDbGFzcygnYWNjb3JkaW9uTWludXMnKTsNCgkJCX0NCgkJfSk7DQoJfSk7DQoNCg0KCWpRdWVyeSgiLmNsb3NlTm90bGlzdGVkIikuY2xpY2soZnVuY3Rpb24oKXsNCgkJaXNTdG9wRGV0ZWN0aW9uID0gdHJ1ZTsNCgl9KTsNCg0KCSQoZG9jdW1lbnQpLm9uKCJrZXl1cCIgLCBmdW5jdGlvbihldmVudCkgew0KCQl2YXIgdHJpZ2dlcktleSA9IGV2ZW50LndoaWNoOw0KCQlpZiAodHJpZ2dlcktleSA9PSAyNyl7DQoJCQlpc1N0b3BEZXRlY3Rpb24gPSB0cnVlOw0KCQl9DQoJfSk7DQoNCg0KCSQoIiNkdlNXRERNRFJlc3VsdHMiKS5odG1sKCQoIiNkbWRTd2RSZXN1bHRzIikpOw0KDQoJaWYodHlwZW9mIGRtZEZsYWdIb21lUGFnZSAhPT0gInVuZGVmaW5lZCIgJiYgZG1kRmxhZ0hvbWVQYWdlICE9PSBudWxsICYmIHR5cGVvZiBkbWRBdXRvRGV0ZWN0ICE9ICJ1bmRlZmluZWQiKXsNCgkJaWYoZG1kRmxhZ0hvbWVQYWdlID09ICJ0cnVlIiB8fCAoJCgnI2lkZW50aWZ5U3VidGV4dCcpLmlzKCc6dmlzaWJsZScpICYmIGRtZEF1dG9EZXRlY3QgJiYgZG9jdW1lbnQubG9jYXRpb24uaHJlZi5zZWFyY2goJ2lkZW50aWZ5JykgIT0gLTEpKXsNCgkJCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCdTV0RETURJbml0aWF0ZWQnKTsNCgkJCSQod2luZG93KS50cmlnZ2VyKCdUZW1wbGF0ZScseyB0ZW1wbGF0ZSA6ICdTV0RETURJbml0aWF0ZWQnfSk7DQoJCQlvblRlc3RWZXJzaW9uQ2xpY2tQYWdlKCdkZXRlY3RTd2RCdG4nLCdkbWQnLCcnKTsNCgkJfQ0KCX0NCg0KDQoNCglpZigkKCcjcGFnZUlkZW50aWZpZXInKS52YWwoKS50b0xvd2VyQ2FzZSgpID09ICJzdXBwb3J0IGhvbWUiKXsNCgkJJCgnI2Nob29zZU5ld0dlblByb2R1Y3QnKS5hdHRyKCdkYXRhLWRpc21pc3MnLCAnbW9kYWwnKTsNCgl9DQp9DQp9KTsNCgkJLyo8c3VtbWFyeT4NCgkJCUJhY2sgdG8gZGV0ZWN0ZWQgcmVzdWx0IGluIG1vZGFsDQoJCTwvc3VtbWFyeT4qLw0KCQl2YXIgYmFja1RvUmVzdWx0ID0gZnVuY3Rpb24oKXsNCg0KCSAgCQlpZihwcm9kSW5mby5sZW5ndGg+MCl7DQoJICAJCQkkKCcubW9kYWxDb21tb25DbGFzcycpLmhpZGUoKTsNCgkgIAkJCWlmKHdvcmtGbG93ID09ICJmaW5kU29sdXRpb25zIil7DQoJICAJCQkJJCgnI2RldmljZURldGVjdGVkRm9yU29sdXRpb25zJykuc2hvdygpOw0KCSAgCQkJfQ0KCSAgCQkJZWxzZXsNCgkgIAkJCSAkKCcjbnVtYmVyT2ZEZXZpY2VEZXRlY3RlZCcpLnNob3coKTsNCgkgIAkJCX0NCgkgIAkJfQ0KCSAgCQllbHNlew0KCSAgCQkJaWYod29ya0Zsb3cgPT0gImZpbmRTb2x1dGlvbnMiKXsNCgkgIAkJCQkkKCcjZHZZb3VyUHJvZHVjdE5vdEZvdW5kJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOw0KCSAgCQkJCSQoJyNkdlplcm9EZXZpY2VGb3VuZCcpLmFkZENsYXNzKCdoaWRkZW4nKTsNCgkgIAkJCX0NCgkgIAkJCSAkKCcubW9kYWxDb21tb25DbGFzcycpLmhpZGUoKTsNCgkgIAkJCSAkKCcjbm9Qcm9kdWN0c0RldGVjdGVkJykuc2hvdygpOw0KCSAgCQl9DQoNCgkgIAkJJCgiLm1vZGFsLmZhZGUuaW4iKS5mb2N1cygpOw0KCSAgCX0NCg0KCQl2YXIgY2xvc2VMb2Fkc29mdHdhcmUgPSBmdW5jdGlvbigpew0KCQkJaXNTdG9wRGV0ZWN0aW9uID0gdHJ1ZTsNCgkJCWRvd25sb2FkSW5pdGlhdGVkID0gZmFsc2U7DQoJCX0NCiAJCS8qPHN1bW1hcnk+DQoJCQlmdW5jdGlvbiB0byBjaGVjayBpZiBtc2kgaXMgdGhlcmUgaW4gcGFnZSBvciBub3QNCgkJCUVudHJ5IHBvaW50IGZvciBETUQgZm9yIE1vZGFsIGZsb3cNCgkJPC9zdW1tYXJ5PiovDQoNCgkJdmFyIGdldEZsYWdPYmogPSBmdW5jdGlvbihkbWRUeXBlKXsNCgkJCXZhciBnZXRGbGFnVXJsID0gJCgiI2ZsYWdVcmwiKS50ZXh0KCkudHJpbSgpOw0KCQkJLy9BSkFYIENhbGwgdG8gc2V0IHRoZSBnbG9iYWxEYXRhTGF5ZXIuRmxhZyBvYmplY3QNCgkgICAgICAgICQuYWpheCh7DQoJICAgICAgICAgICAgdHlwZTogJ1BPU1QnLA0KCSAgICAgICAgICAgIHVybDogZ2V0RmxhZ1VybCwNCgkgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLA0KCSAgICAgICAgICAgIGRhdGE6IHsNCgkgICAgICAgICAgICAgICAgJ3JlcXVlc3RKc29uJzogZ2xvYmFsRGF0YUxheWVyLkZsYWcsDQoJICAgICAgICAgICAgICAgICdkbWRUeXBlJzogZG1kVHlwZQ0KCSAgICAgICAgICAgIH0NCgkgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24oZGF0YSl7DQoJICAgICAgICAgICAgdXBkYXRlRGF0YUxheWVyRmxhZ3MoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOw0KCSAgICAgICAgfSkuZmFpbChmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cyl7DQoNCgkgICAgICAgIH0pOw0KCQl9DQoNCiAgICAgICAgdmFyIG9uVGVzdFZlcnNpb25DbGljayA9IGZ1bmN0aW9uKHBvcnRsZXRJZCwgd29ya2Zsb3csIGlzcmV0cnkpIHsNCiAgICAgICAgCS8qZ2xvYmFsRGF0YUxheWVyLkZsYWcuaWRlbnRpZnlOb3dEbWQgPSAndHJ1ZSc7DQogICAgICAgICAgICBsb2NhbFN0b3JhZ2UuaWRlbnRpZnlOb3dEbWQgPSAndHJ1ZSc7DQogICAgICAgICAgICB0cmlnZ2VyTG9jYWxTZXNzaW9uVGltZXIoKTsqLw0KICAgICAgICAgICAgdmFyIGNoZWNrTm93QnRuID0gZmFsc2U7DQogICAgICAgICAgICBpZihpc1N3ZFN0ZXBUd29SZXF1ZXN0IHx8IGlzUGRwU3dkUmVxdWVzdCl7DQoJCQkJY2hlY2tOb3dCdG4gPSB0cnVlOw0KCQkJfQ0KCQkJZWxzZXsNCgkJCQljaGVja05vd0J0biA9IGZhbHNlOw0KCQkJfQ0KICAgICAgICAgICAvKiBpZigkLmluQXJyYXkocG9ydGxldElkLCBbImJ0blN3ZFNjYW5Ob3ciLCAic3dkU3RlcENoZWNrTm93Il0pID4gLTEpew0KICAgICAgICAgICAgCWNoZWNrTm93QnRuID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2V7DQogICAgICAgICAgICAJY2hlY2tOb3dCdG4gPSBmYWxzZTsNCiAgICAgICAgICAgIH0qLw0KICAgICAgICAgICAgaWYoZ2xvYmFsRGF0YUxheWVyLkZsYWcgIT0gdW5kZWZpbmVkKXsNCgkgICAgICAgICAgICBpZih3b3JrZmxvdyA9PSAiZG1kIiAmJiBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5pZGVudGlmeU5vd0RtZCAhPSB0cnVlKXsNCgkgICAgICAgICAgICAJZ2xvYmFsRGF0YUxheWVyLkZsYWcuaWRlbnRpZnlOb3dEbWQgPSB0cnVlOw0KCQkgICAgICAgICAgICBnZXRGbGFnT2JqKCJpZGVudGlmeU5vdyIpOw0KCQkgICAgICAgIH0NCgkJICAgICAgICBpZih3b3JrZmxvdyA9PSAiZmluZFNvbHV0aW9ucyIpew0KCQkgICAgICAgICAgICBpZihjaGVja05vd0J0bil7DQoJCSAgICAgICAgCQlpZihnbG9iYWxEYXRhTGF5ZXIuRmxhZy5jaGVja05vd0RtZCAhPSB0cnVlKXsNCgkJICAgICAgICAJCQlnbG9iYWxEYXRhTGF5ZXIuRmxhZy5jaGVja05vd0RtZCA9IHRydWU7DQoJCSAgICAgICAgCQkJZ2V0RmxhZ09iaigiY2hlY2tOb3ciKTsNCgkJICAgICAgICAJCX0NCgkJICAgICAgICAJfQ0KCQkgICAgICAgIAllbHNlew0KCQkgICAgICAgIAkJaWYoZ2xvYmFsRGF0YUxheWVyLkZsYWcuZmluZFNvbHV0aW9uc0RtZCAhPSB0cnVlKXsNCgkJICAgICAgICAJCQlnbG9iYWxEYXRhTGF5ZXIuRmxhZy5maW5kU29sdXRpb25zRG1kID0gdHJ1ZTsNCgkJICAgICAgICAJCQlnZXRGbGFnT2JqKCJmaW5kU29sdXRpb25zIik7DQoJCSAgICAgICAgCQl9DQoJCSAgICAgICAgCX0NCgkJICAgICAgICB9DQoJICAgICAgICB9DQoNCiAgICAgICAgCWdsb2JhbERhdGFMYXllci5ETUQgPSBbXTsNCiAgICAgICAgCXB1c2hUb0dsb2JhbERhdGFMYXllcigiRE1EIEluaXRpYXRlZCIsZ2xvYmFsRGF0YUxheWVyLlRlbXBsYXRlLCAnJywgJycsICcnLCAnJywgJycsICcnKTsNCiAgICAgICAgCXZhciB0aW1lciA9IDEwMDsNCiAgICAgICAgCWlmKCQoJ2JvZHknKS5oYXNDbGFzcygnbW9kYWwtb3BlbicpKXsNCiAgICAgICAgCQkkKCcubW9kYWwnKS5tb2RhbCgnaGlkZScpOw0KICAgICAgICAJCXRpbWVyID0gMTAwMDsNCiAgICAgICAgCX0NCg0KICAgICAgICAJaWYod29ya2Zsb3chPScnKXsNCiAgICAgICAgCQl3b3JrRmxvdyA9IHdvcmtmbG93Ow0KICAgICAgICAJfQ0KDQogICAgICAgIAlpc1JldHJ5ID0gaXNyZXRyeTsNCiAgICAgICAgCURNRFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpew0KICAgICAgICAJCWlmKHdvcmtGbG93ID09ICJmaW5kU29sdXRpb25zIil7DQoNCiAgICAgICAgCQkJaWYoc3NmUGFyYW1zLnNob3dPdmVybGF5KXsNCiAgICAgICAgCQkJCSQoJyNjaGVjay1zZXJ2aWNlLW1vZGFsJykubW9kYWwoJ3Nob3cnKTsNCiAgICAgICAgCQkJfQ0KDQogICAgICAgIAkJfQ0KICAgICAgICAJCWVsc2UNCg0KICAgICAgICAJCSQoJyNjaGVjay1zZXJ2aWNlLW1vZGFsJykubW9kYWwoJ3Nob3cnKTsNCiAgICAgICAgCQkkKCcjY2hlY2tTZXJ2aWNlJykuc2hvdygpOw0KICAgICAgICAJCSQoJy5wcm9ncmVzcy1iYXItY29tcG9uZW50Jykuc2hvdygpOw0KICAgICAgICAgICAgCWlzU3RvcERldGVjdGlvbiA9IGZhbHNlOw0KICAgICAgICAgICAgCWRvd25sb2FkSW5pdGlhdGVkID0gZmFsc2U7DQogICAgICAgICAgICAJaXNNb2RlbEZvdW5kRm9yU29sdXRpb24gPSBmYWxzZTsNCiAgICAgICAgICAgIAl1bmlxdWVQcm9kdWN0cyA9IFtdOw0KDQoJCQkJaWYodHlwZW9mIFNTRiAhPSAidW5kZWZpbmVkIil7DQogICAgICAgICAgICAgICAgIFNTRi5HZXRWZXJzaW9uKDAsIG9uVmVyc2lvbkdvdCk7DQoJCQkJIH0NCiAgICAgICAgICAgICAgICBpZihwb3J0bGV0SUQ9PScnKXsNCiAgICAgICAgICAgICAgICAJcG9ydGxldElEID0gcG9ydGxldElkOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAJCWNsZWFyVGltZW91dChETURUaW1lcikNCiAgICAgICAgCX0sdGltZXIpOw0KDQogICAgICAgIAkkKCcubW9kYWxDb21tb25DbGFzcycpLmhpZGUoKTsNCiAgICAgICAgfTsNCg0KCQkvKjxzdW1tYXJ5Pg0KCQkJZnVuY3Rpb24gdG8gY2hlY2sgaWYgbXNpIGlzIHRoZXJlIGluIHBhZ2Ugb3Igbm90DQoJCQlFbnRyeSBwb2ludCBmb3IgRE1EIGZvciBwYWdlIGZsb3cNCgkJPC9zdW1tYXJ5PiovDQoJCSAgIHZhciBkZXRlY3RPbkxvYWQgPSBmdW5jdGlvbiAocG9ydGxldElkLCB3b3JrZmxvdywgaXNyZXRyeSl7DQoJCSAgIAljbGVhckRNRERpdnMoKTsNCg0KCQkJaWYoJCgnI3BhZ2VJZGVudGlmaWVyJykudmFsKCkgIT0gIlN1cHBvcnQgSG9tZSIpew0KCQkJCSQoJyNkdkNsY1NlY3Rpb24nKS5oaWRlKCk7DQoJCQkJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsJ1NXRERNREluaXRpYXRlZCcpOw0KICAgIAkJICAgICQod2luZG93KS50cmlnZ2VyKCdUZW1wbGF0ZScseyB0ZW1wbGF0ZSA6ICdTV0RETURJbml0aWF0ZWQnIH0pOw0KCQkJfQ0KCQkgICAJdmFyIGRvY0xvYyA9ICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmOw0KCQkgICAJaWYoZG9jTG9jLnNlYXJjaCgnaWRlbnRpZnknKSA9PSAtMSl7DQoJCSAgIAkJaWYoZG9jTG9jLnNlYXJjaCgnc2VsZnNlcnZpY2UnKSAhPSAtMSkNCgkJICAgCQkJaGlzdG9yeS5wdXNoU3RhdGUobnVsbCwgbnVsbCwgZG9jTG9jLnJlcGxhY2UoJy9zZWxmc2VydmljZScsICcvc2VsZnNlcnZpY2UvaWRlbnRpZnknKSk7DQoJCSAgIAkJZWxzZQ0KCQkgICAJCQloaXN0b3J5LnB1c2hTdGF0ZShudWxsLCBudWxsLCBkb2NMb2MucmVwbGFjZSgnL2RyaXZlcnMnLCAnL2RyaXZlcnMvc2VsZnNlcnZpY2UvaWRlbnRpZnknKSk7DQoJCSAgIAl9DQoNCg0KDQoJCSAgIAl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9wc3RhdGUiLCBmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgCWlmKCEkKCcjaWRlbnRpZnlTdWJ0ZXh0JykuaXMoJzp2aXNpYmxlJykgJiYgZG9jdW1lbnQubG9jYXRpb24uaHJlZi5zZWFyY2goJ2lkZW50aWZ5JykgPT0gLTEpew0KCQkJCQkkKCcjZHZQZmluZGVyRE1EJykuc2hvdygpOw0KCQkJCQkkKCcjZHZTV0RTdGVwMVJlc3VsdHMnKS5oaWRlKCk7DQoJCQkJCSQoJyNpZGVudGlmeVN1YnRleHQnKS5zaG93KCk7DQogICAgICAgICAgICAJfQ0KICAgICAgICAgICAgCWVsc2V7DQogICAgICAgICAgICAJCW9uVGVzdFZlcnNpb25DbGlja1BhZ2UoJ2RldGVjdFN3ZEJ0bicsJ2RtZCcsJycpOw0KICAgICAgICAJCX0NCiAgICAgICAgICAgIH0sIGZhbHNlKTsNCg0KICAgICAgICAJZ2xvYmFsRGF0YUxheWVyLkRNRCA9IFtdOw0KDQogICAgICAgIAlwdXNoVG9HbG9iYWxEYXRhTGF5ZXIoIkRNRCBJbml0aWF0ZWQiLGdsb2JhbERhdGFMYXllci5UZW1wbGF0ZSwgJycsICcnLCAnJywgJycsICcnLCAnJyk7DQoNCiAgICAgICAgCXZhciBwYWdlTmFtZSA9ICAkKCcjcGFnZUlkZW50aWZpZXInKS52YWwoKTsNCg0KICAgICAgICAJdmFyIHRpbWVyID0gMTAwOw0KDQoNCiAgICAgICAgCWlmKHdvcmtmbG93IT0nJyl7DQogICAgICAgIAkJd29ya0Zsb3cgPSB3b3JrZmxvdzsNCiAgICAgICAgCX0NCg0KICAgICAgICAJaXNSZXRyeSA9IGlzcmV0cnk7DQogICAgICAgIAlETURUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCg0KCQkJICAgaWYgKCFydW5JbkJhY2tncm91bmQpIHsNCiAgICAgICAgCQkgJCgnI2NoZWNrU2VydmljZXBhZ2UnKS5zaG93KCk7DQoJCQkgICB9DQogICAgICAgICAgICAJaXNTdG9wRGV0ZWN0aW9uID0gZmFsc2U7DQogICAgICAgICAgICAJZG93bmxvYWRJbml0aWF0ZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIAlpc01vZGVsRm91bmRGb3JTb2x1dGlvbiA9IGZhbHNlOw0KICAgICAgICAgICAgCXVuaXF1ZVByb2R1Y3RzID0gW107DQoNCgkJCQlpZih0eXBlb2YgU1NGICE9ICJ1bmRlZmluZWQiKXsNCiAgICAgICAgICAgICAgICAgU1NGLkdldFZlcnNpb24oMCwgb25WZXJzaW9uR290UGFnZSk7DQoJCQkJfQ0KICAgICAgICAgICAgICAgIGlmKHBvcnRsZXRJRD09Jycpew0KICAgICAgICAgICAgICAgIAlwb3J0bGV0SUQgPSBwb3J0bGV0SWQ7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgIAkJY2xlYXJUaW1lb3V0KERNRFRpbWVyKQ0KICAgICAgICAJfSx0aW1lcik7DQoNCgkJCSQoJy5tb2RhbENvbW1vbkNsYXNzJykuaGlkZSgpOw0KCQkJJCgnI2RtZEJhbm5lcicpLmhpZGUoKTsNCgkJCSQoJyNkdlBmaW5kZXJETUQnKS5oaWRlKCk7LypIaWRlIHRoZSBwRmluZGVyIGFuZCBETUQqLw0KICAgICAgICAJJCgnI2lkZW50aWZ5U3VidGV4dCcpLmhpZGUoKTsvKkhpZGUgdGhlIGlkZW50aWZ5U3VidGV4dCovDQoJCQkkKCcjYmFubmVyJykuaGlkZSgpOw0KCQkJJCgnI2ZpbmFsVmlkZW9Db250YWluZXInKS5oaWRlKCk7DQogICAgICAgIH07DQoNCg0KDQogICAgICAgIHZhciBvbkRvd25sb2FkQ2xpY2sgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGxsaW5rIikuY2xpY2soKTsNCiAgICAgICAgfTsNCg0KCQl2YXIgb25UZXN0VmVyc2lvbkNsaWNrUGFnZSA9IGZ1bmN0aW9uKHBvcnRsZXRJZCwgd29ya2Zsb3csIGlzcmV0cnkpIHsNCgkJCS8qZ2xvYmFsRGF0YUxheWVyLkZsYWcuaWRlbnRpZnlOb3dEbWQgPSAndHJ1ZSc7DQogICAgICAgICAgICBsb2NhbFN0b3JhZ2UuaWRlbnRpZnlOb3dEbWQgPSAndHJ1ZSc7DQogICAgICAgICAgICB0cmlnZ2VyTG9jYWxTZXNzaW9uVGltZXIoKTsqLw0KICAgICAgICAgICAgdmFyIGNoZWNrTm93QnRuID0gZmFsc2U7DQogICAgICAgICAgICBpZihpc1N3ZFN0ZXBUd29SZXF1ZXN0IHx8IGlzUGRwU3dkUmVxdWVzdCl7DQoJCQkJY2hlY2tOb3dCdG4gPSB0cnVlOw0KCQkJfQ0KCQkJZWxzZXsNCgkJCQljaGVja05vd0J0biA9IGZhbHNlOw0KCQkJfQ0KICAgICAgICAgICAgLyppZigkLmluQXJyYXkocG9ydGxldElkLCBbImJ0blN3ZFNjYW5Ob3ciLCAic3dkU3RlcENoZWNrTm93Il0pID4gLTEpew0KICAgICAgICAgICAgCWNoZWNrTm93QnRuID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2V7DQogICAgICAgICAgICAJY2hlY2tOb3dCdG4gPSBmYWxzZTsNCiAgICAgICAgICAgIH0qLw0KICAgICAgICAgICAgLy9BSkFYIENhbGwgdG8gc2V0IHRoZSBnbG9iYWxEYXRhTGF5ZXIuRmxhZyBvYmplY3QNCgkgICAgICAgIGlmKGdsb2JhbERhdGFMYXllci5GbGFnICE9IHVuZGVmaW5lZCl7DQoJICAgICAgICAgICAgaWYod29ya2Zsb3cgPT0gImRtZCIgJiYgZ2xvYmFsRGF0YUxheWVyLkZsYWcuaWRlbnRpZnlOb3dEbWQgIT0gdHJ1ZSl7DQoJICAgICAgICAgICAgCWdsb2JhbERhdGFMYXllci5GbGFnLmlkZW50aWZ5Tm93RG1kID0gdHJ1ZTsNCgkJICAgICAgICAgICAgZ2V0RmxhZ09iaigiaWRlbnRpZnlOb3ciKTsNCgkJICAgICAgICB9DQoJCSAgICAgICAgaWYod29ya2Zsb3cgPT0gImZpbmRTb2x1dGlvbnMiKXsNCgkJICAgICAgICAJaWYoY2hlY2tOb3dCdG4pew0KCQkgICAgICAgIAkJaWYoZ2xvYmFsRGF0YUxheWVyLkZsYWcuY2hlY2tOb3dEbWQgIT0gdHJ1ZSl7DQoJCSAgICAgICAgCQkJZ2xvYmFsRGF0YUxheWVyLkZsYWcuY2hlY2tOb3dEbWQgPSB0cnVlOw0KCQkgICAgICAgIAkJCWdldEZsYWdPYmooImNoZWNrTm93Iik7DQoJCSAgICAgICAgCQl9DQoJCSAgICAgICAgCX0NCgkJICAgICAgICAJZWxzZXsNCgkJICAgICAgICAJCWlmKGdsb2JhbERhdGFMYXllci5GbGFnLmZpbmRTb2x1dGlvbnNEbWQgIT0gdHJ1ZSl7DQoJCSAgICAgICAgCQkJZ2xvYmFsRGF0YUxheWVyLkZsYWcuZmluZFNvbHV0aW9uc0RtZCA9IHRydWU7DQoJCSAgICAgICAgCQkJZ2V0RmxhZ09iaigiZmluZFNvbHV0aW9ucyIpOw0KCQkgICAgICAgIAkJfQ0KCQkgICAgICAgIAl9DQoJCSAgICAgICAgfQ0KCQkgICAgfQ0KCQkJcnVuSW5CYWNrZ3JvdW5kID0gZmFsc2U7DQoJCQlkZXRlY3RPbkxvYWQocG9ydGxldElkLCB3b3JrZmxvdywgaXNyZXRyeSk7DQoNCiAgICAgICAgfTsNCgkJLy9jaGVjayBpZiBETUQgaXMgaW4gcHJvZ3Jlc3MNCgkJdmFyIERNREluUHJvZ3Jlc3MgPSBmdW5jdGlvbigpew0KCQkJCSAgICQoJyNkZXRlY3Rpb25IZWFkZXInKS5odG1sKGlkZW50aWZ5aW5nTGFiZWwpOw0KCQkJCSAgICQoJyNzdGVwLTMnKS5zaG93KCk7DQoJCQkJICAgJCgnI3Byb2dyZXNzYmFyJykuc2hvdygpOw0KCQkJCSAgICQoJyNwbmxVbnNvcnRlZEZvdW5kUHJvZHMnKS5zaG93KCk7DQoJCQkJICAgJCgnI2lkZW50aWZ5LXRleHQzJykuc2hvdygpOw0KDQoNCgkJfQ0KDQoNCg0KCQl2YXIgRE1EUHJvZ3Jlc3NDb21wbGV0ZSA9IGZ1bmN0aW9uKCl7DQoJCSAgICAgICAgICAgICAgICQoJyNwcm9ncmVzc2JhcicpLmhpZGUoKTsNCg0KCQkJICAgICAgICAgICAgJCgnI2RldGVjdGlvbkhlYWRlcicpLmh0bWwoaG9tZUlkZW50aWZpZWRMYWJlbCk7DQoNCgkJCQkJICAgJCgnI3N0ZXAtMycpLnNob3coKTsNCgkJCQkJICAgJCgnI3BubFJldHJ5Jykuc2hvdygpOw0KDQoJCQkJCQkkKCcjaWRlbnRpZnktdGV4dDMnKS5oaWRlKCk7DQoJCQkJCQkkKCcjaWRlbnRpZnktdGV4dDQnKS5zaG93KCk7DQoNCgkJCQkJICAgJCgnI3BubFJldHJ5T3JTZWFyY2hCeVBGaW5kZXInKS5zaG93KCk7DQoJCQkJCSAgIGlmKCQoIiNwbmxGb3VuZFByb2RzRGlzcGxheSIpLmNoaWxkcmVuKCkubGVuZ3RoID4gMCl7DQoJCQkJCQkJJCgiI3BubEZvdW5kUHJvZHMiKS5zaG93KCk7DQoJCQkJCQl9DQoJCQkJCQlpZigkKCIjcG5sTmV0d29ya1Byb2RzRGlzcGxheSIpLmNoaWxkcmVuKCkubGVuZ3RoID4gMCl7DQoJCQkJCQkJJCgiI3BubE5ldHdvcmtQcm9kcyIpLnNob3coKTsNCgkJCQkJCX0NCgkJCQkJCWlmKCQoIiNwbmxDb25uZWN0ZWRQcm9kc0Rpc3BsYXkiKS5jaGlsZHJlbigpLmxlbmd0aCA+IDApew0KCQkJCQkJCSQoIiNwbmxDb25uZWN0ZWRQcm9kcyIpLnNob3coKTsNCgkJCQkJCX0NCg0KDQoNCgkJfQ0KDQoJCXZhciBub1Byb2R1Y3RzRm91bmQgPSBmdW5jdGlvbigpew0KDQoJCQkJCSAkKCcubW9kYWxDb21tb25DbGFzcycpLmhpZGUoKTsNCgkJCQkJICQoJyNkbWRSZXRyeVZpZXcnKS5yZW1vdmVDbGFzcygiaGlkZSIpOw0KCQkJCQkgICQoJyNub0ZvdW5kUHJvZHVjdHMnKS5zaG93KCk7DQoJCQkJCSAgJCgnI25vRm91bmRQcm9kdWN0cycpLmFwcGVuZFRvKCQoJy5ETURuZXcnKSk7DQoJCQkJCSAgcHVzaFRvR2xvYmFsRGF0YUxheWVyKCJObyBwcm9kdWN0cyBmb3VuZCIsZ2xvYmFsRGF0YUxheWVyLlRlbXBsYXRlLCAidHJ1ZSIsIE1TSVZlcnNpb24sICcnLCAnJywgJycsICcnKTsNCg0KDQoNCg0KCQl9DQoJCXZhciBzaG93UHJvZHVjdHNPbkNsaWNrID0gZnVuY3Rpb24gKCkgew0KCQkJLy9wcm9ncmVzc1BlcmNlbnQgPSAkKCcjcHJvZ3Jlc3NTdGF0dXMnKS5odG1sKCkuc3BsaXQoLyUvKVswXTsNCgkJCWlmIChzc2ZWZXJpb25NYXRjaChNU0lWZXJzaW9uKSl7DQoJCQkJaWYgKHByb2dyZXNzUGVyY2VudCA8IDEwMCkgew0KCQkJCQlETURJblByb2dyZXNzKCk7DQoJCQkJCXByb2dyZXNzRmxhZyAgPSB0cnVlOw0KCQkJCQl2YXIgaGVpZ2h0cyA9ICQoIi5wcm9kdWN0LXNlbGVjdGlvbiBoNCIpLm1hcChmdW5jdGlvbiAoKQ0KCQkJCXsNCgkJCQkJCXJldHVybiAkKHRoaXMpLmhlaWdodCgpOw0KCQkJCX0pLmdldCgpLA0KDQoJCQkJCW1heEhlaWdodCA9IE1hdGgubWF4LmFwcGx5KG51bGwsIGhlaWdodHMpOw0KCQkJCQkkKCIucHJvZHVjdC1zZWxlY3Rpb24gaDQiKS5oZWlnaHQobWF4SGVpZ2h0KTsNCg0KCQkJCX0NCgkJCQlpZiAocHJvZ3Jlc3NQZXJjZW50ID09IDEwMCkgew0KCQkJCQlpZihwcm9kSW5mby5sZW5ndGggPjApew0KCQkJCQkJICBETURQcm9ncmVzc0NvbXBsZXRlKCk7DQoNCgkJCQkJCQl2YXIgaGVpZ2h0cyA9ICQoIi5wcm9kdWN0LXNlbGVjdGlvbiBoNCIpLm1hcChmdW5jdGlvbiAoKQ0KCQkJCQkJew0KCQkJCQkJCQlyZXR1cm4gJCh0aGlzKS5oZWlnaHQoKTsNCgkJCQkJCX0pLmdldCgpLA0KDQoJCQkJCQkJbWF4SGVpZ2h0ID0gTWF0aC5tYXguYXBwbHkobnVsbCwgaGVpZ2h0cyk7DQoJCQkJCQkJJCgiLnByb2R1Y3Qtc2VsZWN0aW9uIGg0IikuaGVpZ2h0KG1heEhlaWdodCk7DQoNCg0KCQkJCQl9DQoJCQkJCSBlbHNlIGlmKHByb2RJbmZvLmxlbmd0aCA9PSAwKXsNCg0KCQkJCQkJIG5vUHJvZHVjdHNGb3VuZCgpOw0KDQoJCQkJICAgfQ0KDQoJCQkJfQ0KCQkJfQ0KCQkJZWxzZSBpZiAoTVNJVmVyc2lvbiA9PSAibm90IGluc3RhbGxlZCIgfHwgIXNzZlZlcmlvbk1hdGNoKE1TSVZlcnNpb24pKSB7DQoNCiAgICAgICAgICAgIAlpZihkb3dubG9hZEluaXRpYXRlZCA9PSBmYWxzZSl7DQoJCQkJICAgIGlmKCQoJyNuZXdIb21lRE1EJykubGVuZ3RoKXskKCcjbmV3SG9tZURNRCcpLmhpZGUoKX07DQoNCgkJCQkgIAkgJCgiI3Nob3dDb250ZW50IikuaGlkZSgpOw0KCQkJICAgICAgICAgJCgiLnNwYW5JbWciKS5hZGRDbGFzcygnYWNjb3JkaW9uUGx1cycpLnJlbW92ZUNsYXNzKCdhY2NvcmRpb25NaW51cycpOw0KCQkJICAgICAgICAgJCgnLm1vZGFsQ29tbW9uQ2xhc3MnKS5oaWRlKCk7DQoNCiAgICAgICAgICAgIAl9DQoNCgkJCQkkKCcjbG9hZFNvZnR3YXJlUGFnZScpLnNob3coKTsNCiAgICAgICAgICAgIH0NCg0KDQoNCgkJfTsNCgkJdmFyIGdldFByb2R1Y3RzT25Mb2FkID0gZnVuY3Rpb24ocG9ydGxldElkLCB3b3JrZmxvdywgaXNyZXRyeSwgaXNCYWNrZ3JvdW5kKSB7DQoJCQl2YXIgY2hlY2tOb3dCdG4gPSBmYWxzZTsNCgkJCWlmKGlzU3dkU3RlcFR3b1JlcXVlc3QgfHwgaXNQZHBTd2RSZXF1ZXN0KXsNCgkJCQljaGVja05vd0J0biA9IHRydWU7DQoJCQl9DQoJCQllbHNlew0KCQkJCWNoZWNrTm93QnRuID0gZmFsc2U7DQoJCQl9DQoNCiAgICAgICAgICAgIC8qaWYoJC5pbkFycmF5KHBvcnRsZXRJZCwgWyJidG5Td2RTY2FuTm93IiwgInN3ZFN0ZXBDaGVja05vdyJdKSA+IC0xKXsNCiAgICAgICAgICAgIAljaGVja05vd0J0biA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlew0KICAgICAgICAgICAgCWNoZWNrTm93QnRuID0gZmFsc2U7DQogICAgICAgICAgICB9Ki8NCgkJCWlmKGdsb2JhbERhdGFMYXllci5GbGFnICE9IHVuZGVmaW5lZCl7DQoJCQkJaWYod29ya2Zsb3cgPT0gImRtZCIgJiYgZ2xvYmFsRGF0YUxheWVyLkZsYWcuaWRlbnRpZnlOb3dEbWQgIT0gdHJ1ZSl7DQoJCSAgICAgICAgICAgIC8vIGdsb2JhbERhdGFMYXllci5GbGFnLmlkZW50aWZ5Tm93RG1kID0gdHJ1ZTsNCgkJICAgICAgICAgICAgZ2V0RmxhZ09iaigiaWRlbnRpZnlOb3ciKTsNCgkJICAgICAgICB9DQoJCSAgICAgICAgaWYod29ya2Zsb3cgPT0gImZpbmRTb2x1dGlvbnMiKXsNCgkJICAgICAgICAgICAgaWYoY2hlY2tOb3dCdG4pew0KCQkgICAgICAgIAkJaWYoZ2xvYmFsRGF0YUxheWVyLkZsYWcuY2hlY2tOb3dEbWQgIT0gdHJ1ZSl7DQoJCSAgICAgICAgCQkJLy8gZ2xvYmFsRGF0YUxheWVyLkZsYWcuY2hlY2tOb3dEbWQgPSB0cnVlOw0KCQkgICAgICAgIAkJCWdldEZsYWdPYmooImNoZWNrTm93Iik7DQoJCSAgICAgICAgCQl9DQoJCSAgICAgICAgCX0NCgkJICAgICAgICAJZWxzZXsNCgkJICAgICAgICAJCWlmKGdsb2JhbERhdGFMYXllci5GbGFnLmZpbmRTb2x1dGlvbnNEbWQgIT0gdHJ1ZSl7DQoJCSAgICAgICAgCQkJLy8gZ2xvYmFsRGF0YUxheWVyLkZsYWcuZmluZFNvbHV0aW9uc0RtZCA9IHRydWU7DQoJCSAgICAgICAgCQkJZ2V0RmxhZ09iaigiZmluZFNvbHV0aW9ucyIpOw0KCQkgICAgICAgIAkJfQ0KCQkgICAgICAgIAl9DQoJCSAgICAgICAgfQ0KCQkgICAgfQ0KCQkJcnVuSW5CYWNrZ3JvdW5kID0gIWlzQmFja2dyb3VuZDsNCgkJCWRldGVjdE9uTG9hZChwb3J0bGV0SWQsIHdvcmtmbG93LCBpc3JldHJ5KTsNCgkJCSQoJyNwcm9ncmVzc2JhcicpLmhpZGUoKTsNCg0KCQkJaWYoaXNCYWNrZ3JvdW5kKXsNCgkJCQlzaG93UHJvZHVjdHNPbkNsaWNrKCk7DQoJCQkJJCgnI25ld0hvbWVETUQnKS5oaWRlKCk7DQoJCQkJJCgnI25ld0hvbWVETUQnKS5hZGRDbGFzcygnaGlkZUZvcmV2ZXInKTsNCgkJCX0NCg0KCQkJaWYoIWlzQmFja2dyb3VuZCl7DQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGVjdE15RGV2aWNlVmlld1RvcEJ0bicpLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7DQoJCQkJICAgIHNob3dQcm9kdWN0c09uQ2xpY2soKTsNCgkJCQkJJCgnI25ld0hvbWVETUQnKS5oaWRlKCk7DQoJCQkJCSQoJyNuZXdIb21lRE1EJykuYWRkQ2xhc3MoJ2hpZGVGb3JldmVyJyk7DQoJCQkJfQ0KCQkJfQ0KCQl9Ow0KDQogICAgICAgIHZhciBvblZlcnNpb25Hb3RQYWdlID0gZnVuY3Rpb24gKHZlcnNpb24pIHsNCg0KDQoNCiAgICAgICAgCU1TSVZlcnNpb24gPSB2ZXJzaW9uOw0KICAgICAgICAJaWYodmVyc2lvbj09ICJub3QgaW5zdGFsbGVkIil7DQogICAgICAgIAkJcHVzaFRvR2xvYmFsRGF0YUxheWVyKCJDaGVjayBTZXJ2aWNlIiwgZ2xvYmFsRGF0YUxheWVyLlRlbXBsYXRlLCAiZmFsc2UiLCAnJywgJycsICcnLCAnJywgJycpOw0KICAgICAgICAJfQ0KICAgICAgICAJZWxzZXsNCiAgICAgICAgCQlwdXNoVG9HbG9iYWxEYXRhTGF5ZXIoIkNoZWNrIFNlcnZpY2UiLGdsb2JhbERhdGFMYXllci5UZW1wbGF0ZSwgInRydWUiLCAnJywgJycsICcnLCAnJywgJycpOw0KICAgICAgICAJfQ0KDQogICAgICAgICAgICBpZiAoKHZlcnNpb24gPT0gIm5vdCBpbnN0YWxsZWQiIHx8ICFzc2ZWZXJpb25NYXRjaCh2ZXJzaW9uKSkgJiYgKCFydW5JbkJhY2tncm91bmQpKSB7DQoNCiAgICAgICAgICAgIAlpZihkb3dubG9hZEluaXRpYXRlZCA9PSBmYWxzZSl7DQoJCQkJICAgIGlmKCQoJyNuZXdIb21lRE1EJykubGVuZ3RoKXskKCcjbmV3SG9tZURNRCcpLmhpZGUoKX07DQoJCQkJICAgICAkKCcjbG9hZFNvZnR3YXJlUGFnZScpLnNob3coKTsNCgkJCQkgIAkgJCgiI3Nob3dDb250ZW50IikuaGlkZSgpOw0KCQkJICAgICAgICAgJCgiLnNwYW5JbWciKS5hZGRDbGFzcygnYWNjb3JkaW9uUGx1cycpLnJlbW92ZUNsYXNzKCdhY2NvcmRpb25NaW51cycpOw0KCQkJICAgICAgICAgJCgnLm1vZGFsQ29tbW9uQ2xhc3MnKS5oaWRlKCk7DQoNCiAgICAgICAgICAgIAl9DQoJCQkJJCgnI2xvYWRTb2Z0d2FyZVBhZ2UnKS5zaG93KCk7DQoJCQkJaWYoJCgnI25ld0hvbWVETUQnKS5sZW5ndGgpeyQoJyNuZXdIb21lRE1EJykuaGlkZSgpfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KDQoNCgkJCQlpZiAoIXJ1bkluQmFja2dyb3VuZCkgew0KCQkJCQl2YXIgdmFsdWUgPSAwOw0KCQkJCQkkKCcjcHJvZ3Jlc3NiYXInKS5zaG93KCk7DQoJCQkJCSQoJy5wcm9ncmVzc1NlZWtCYXInKS5jc3MoJ3dpZHRoJywgdmFsdWUrJyUnKTsNCg0KCQkJCQkvL1Nob3cgTG9hZGluZy4uLiB0ZXh0IG9ubHkgd2hlbiBkZXRlY3Rpb24gaXMgbm90IGhhcHBlbmluZy4NCgkJCQkJaWYodmFsdWUgPiAwKQ0KCQkJCQkJJCgnLnByb2dyZXNzLWxvYWRpbmctbGFiZWwnKS5oaWRlKCk7DQoJCQkJCWVsc2UNCgkJCQkJCSQoJy5wcm9ncmVzcy1sb2FkaW5nLWxhYmVsJykuc2hvdygpOw0KDQoJCQkJCS8vU2hvdyBwZXJjZW50YWdlIGNvbXBsZXRpb24gd2hlbiBpdCBhdHRhaW5zIHRoZSBkaXNwbGF5IGxpbWl0IGNhcGFiaWxpdHkNCgkJCQkJaWYodmFsdWUgPj0gNSkNCgkJCQkJCSQoJy5wcm9ncmVzcy1iYXItc3RhdHVzJykuaHRtbCh2YWx1ZSsnJScpOw0KCQkJCQllbHNlDQoJCQkJCQkkKCcucHJvZ3Jlc3MtYmFyLXN0YXR1cycpLmh0bWwoJycpOw0KDQoJCQkJCSQoJyNwcm9ncmVzc1NlZWtCYXInKS5hdHRyKCdhcmlhLXZhbHVlbm93Jyx2YWx1ZSk7DQoJCQkJfQ0KCQkJCWVsc2V7DQoNCgkJCQkkKCcjcHJvZ3Jlc3NiYXInKS5oaWRlKCk7DQoJCQkJLy9wcm9ncmVzc1BlcmNlbnQgPSAkKCcjcHJvZ3Jlc3NTdGF0dXMnKS5odG1sKCkuc3BsaXQoLyUvKVswXTsNCgkJCQl9DQoNCgkJICAgICAgCWlmKHhoclBvb2wubGVuZ3RoPjApew0KCQkgICAgICAJCWZvcihpPTA7aTx4aHJQb29sLmxlbmd0aDtpKyspew0KCQkgICAgICAJCQl4aHJQb29sW2ldLmFib3J0KCk7DQoJCSAgICAgIAkJfQ0KCSAgICAgICAgCX0NCgkJICAgICAgCXhoclBvb2wgPSBbXTsNCgkJICAgICAgCXBpZHNDb3VudGVyID0gMDsNCgkJCSAgCWluaXREZXRlY3REZXZpY2VQcm9jZXNzTmV3KCk7DQoJCSAgICB9DQogICAgICAgIH07DQoNCg0KDQoJCS8qPHN1bW1hcnk+DQoJCQlmdW5jdGlvbiB0byBjaGVjayBpZiBtc2kgaXMgdGhlcmUgaW4gcGFnZSBvciBub3QNCgkJCUVudHJ5IHBvaW50IGZvciBETUQNCgkJPC9zdW1tYXJ5PiovDQoJCXZhciBvblZlcnNpb25Hb3QgPSBmdW5jdGlvbiAodmVyc2lvbikgew0KICAgICAgICAJTVNJVmVyc2lvbiA9IHZlcnNpb247DQogICAgICAgIAlpZih2ZXJzaW9uPT0gIm5vdCBpbnN0YWxsZWQiKXsNCiAgICAgICAgCQlwdXNoVG9HbG9iYWxEYXRhTGF5ZXIoIkNoZWNrIFNlcnZpY2UiLCBnbG9iYWxEYXRhTGF5ZXIuVGVtcGxhdGUsICJmYWxzZSIsICcnLCAnJywgJycsICcnLCAnJyk7DQogICAgICAgIAl9DQogICAgICAgIAllbHNlew0KICAgICAgICAJCXB1c2hUb0dsb2JhbERhdGFMYXllcigiQ2hlY2sgU2VydmljZSIsIGdsb2JhbERhdGFMYXllci5UZW1wbGF0ZSwgInRydWUiLCAnJywgJycsICcnLCAnJywgJycpOw0KICAgICAgICAJfQ0KICAgICAgICAJLy9wdXNoVG9HbG9iYWxEYXRhTGF5ZXIoIkNoZWNrIFNlcnZpY2UiLCB2ZXJzaW9uLCAnJywgJycsICcnLCAnJywgJycpOw0KICAgICAgICAgICAgaWYgKHZlcnNpb24gPT0gIm5vdCBpbnN0YWxsZWQiIHx8ICFzc2ZWZXJpb25NYXRjaCh2ZXJzaW9uKSkgew0KICAgICAgICAgICAgCS8vcHVzaFRvR2xvYmFsRGF0YUxheWVyKCJDaGVjayBWZXJzaW9uIiwgIm5vdCBpbnN0YWxsZWQiLCAnJywgJycsICcnLCAnJywgJycpOw0KICAgICAgICAgICAgCWlmKGRvd25sb2FkSW5pdGlhdGVkID09IGZhbHNlKXsNCgkJCQkJJCgnI2NoZWNrU2VydmljZScpLmhpZGUoKTsNCgkJCQkJICQoJyNsb2FkU29mdHdhcmUnKS5zaG93KCk7DQoJCQkJICAJICQoIiNzaG93Q29udGVudCIpLmhpZGUoKTsNCgkJCSAgICAgICAgICQoIi5zcGFuSW1nIikuYWRkQ2xhc3MoJ2FjY29yZGlvblBsdXMnKS5yZW1vdmVDbGFzcygnYWNjb3JkaW9uTWludXMnKTsNCg0KDQogICAgICAgICAgICAJfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQoNCiAgICAgICAgICAgIGlmKGlzU3dkU3RlcFR3b1JlcXVlc3Qpew0KICAgICAgICAgICAgCWhhbmRsZVNXRFBhZ2VQcmVSdW4oKTsNCiAgICAgICAgICAgIH0NCg0KCQkJCXZhciB2YWx1ZSA9IDA7DQoJCQkJJCgnI3Byb2dyZXNzYmFyJykuc2hvdygpOw0KCQkJCSQoJy5wcm9ncmVzc1NlZWtCYXInKS5jc3MoJ3dpZHRoJywgdmFsdWUrJyUnKTsNCg0KCQkJCS8vU2hvdyBMb2FkaW5nLi4uIHRleHQgb25seSB3aGVuIGRldGVjdGlvbiBpcyBub3QgaGFwcGVuaW5nLg0KCQkJCWlmKHZhbHVlID4gMCkNCgkJCQkJJCgnLnByb2dyZXNzLWxvYWRpbmctbGFiZWwnKS5oaWRlKCk7DQoJCQkJZWxzZQ0KCQkJCQkkKCcucHJvZ3Jlc3MtbG9hZGluZy1sYWJlbCcpLnNob3coKTsNCg0KCQkJCS8vU2hvdyBwZXJjZW50YWdlIGNvbXBsZXRpb24gd2hlbiBpdCBhdHRhaW5zIHRoZSBkaXNwbGF5IGxpbWl0IGNhcGFiaWxpdHkNCgkJCQlpZih2YWx1ZSA+PSAxMCkNCgkgIAkJCQkkKCcucHJvZ3Jlc3MtYmFyLXN0YXR1cycpLmh0bWwodmFsdWUrJyUnKTsNCiAgICAgICAgICAgIAllbHNlDQoJICAJCQkJJCgnLnByb2dyZXNzLWJhci1zdGF0dXMnKS5odG1sKCcnKTsNCg0KCSAgCQkJJCgnI3Byb2dyZXNzU2Vla0JhcicpLmF0dHIoJ2FyaWEtdmFsdWVub3cnLHZhbHVlKTsNCg0KCQkgICAgICAJaWYoeGhyUG9vbC5sZW5ndGg+MCl7DQoJCSAgICAgIAkJZm9yKGk9MDtpPHhoclBvb2wubGVuZ3RoO2krKyl7DQoJCSAgICAgIAkJCXhoclBvb2xbaV0uYWJvcnQoKTsNCgkJICAgICAgCQl9DQoJICAgICAgICAJfQ0KCQkgICAgICAJeGhyUG9vbCA9IFtdOw0KCQkgICAgICAJcGlkc0NvdW50ZXIgPSAwOw0KCQkJICAJaW5pdERldGVjdERldmljZVByb2Nlc3MoKTsNCgkJICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICB2YXIgdXBkYXRlUHJvZ3Jlc3NCYXIgPSBmdW5jdGlvbiAodmFsdWUpIHsNCgkJCXZhciBsaW1pdCA9IGlzT25QYWdlRGlzcGxheSA/IDUgOiAxMDsNCg0KCQkJJCgnLnByb2dyZXNzU2Vla0JhcicpLmNzcygnd2lkdGgnLCB2YWx1ZSsnJScpOw0KDQoJCQkvL1Nob3cgTG9hZGluZy4uLiB0ZXh0IG9ubHkgd2hlbiBkZXRlY3Rpb24gaXMgbm90IGhhcHBlbmluZy4NCgkJCWlmKHZhbHVlID4gMCkNCgkJCQkkKCcucHJvZ3Jlc3MtbG9hZGluZy1sYWJlbCcpLmhpZGUoKTsNCgkJCWVsc2UNCgkJCQkkKCcucHJvZ3Jlc3MtbG9hZGluZy1sYWJlbCcpLnNob3coKTsNCg0KDQoJCQkvL1Nob3cgcGVyY2VudGFnZSBjb21wbGV0aW9uIHdoZW4gaXQgYXR0YWlucyB0aGUgZGlzcGxheSBsaW1pdCBjYXBhYmlsaXR5DQoJCQlpZih2YWx1ZSA+PSBsaW1pdCl7DQogIAkJCQkkKCcucHJvZ3Jlc3MtYmFyLXN0YXR1cycpLmh0bWwodmFsdWUrJyUnKTsNCiAgICAgICAgICAgICAgICBwcm9ncmVzc1BlcmNlbnQgPSAkKCcjcHJvZ3Jlc3NTdGF0dXMnKS5odG1sKCkuc3BsaXQoLyUvKVswXTsNCiAgICAgICAgICAgICAgIH0NCiAgICAgICAgCWVsc2V7DQogIAkJCQkkKCcucHJvZ3Jlc3MtYmFyLXN0YXR1cycpLmh0bWwoJycpOw0KICAgICAgICAgICAgICAgfQ0KICAJCQkkKCcjcHJvZ3Jlc3NTZWVrQmFyJykuYXR0cignYXJpYS12YWx1ZW5vdycsdmFsdWUpOw0KCQkJLy9wcm9ncmVzc1BlcmNlbnQgPSAkKCcjcHJvZ3Jlc3NTdGF0dXMnKS5odG1sKCkuc3BsaXQoLyUvKVswXTsNCgkgIAl9DQoNCg0KCQkvKjxzdW1tYXJ5Pg0KCQkJTWV0aG9kIHRvIGNhbGwgaWYgc29mdHdhcmUgaXMgYWxyZWFkeSBpbnN0YWxsZWQNCgkJPC9zdW1tYXJ5PiovDQoJICAJdmFyIGluaXREZXRlY3REZXZpY2VQcm9jZXNzID0gZnVuY3Rpb24oKXsNCgkgIAkJalF1ZXJ5KCIjZGV0ZWN0ZWRIUERldmljZXMiKS5odG1sKCIiKTsNCgkgIAkJJCgnLm1vZGFsQ29tbW9uQ2xhc3MnKS5oaWRlKCk7DQoJICAJCVNTRi5Qcm9kdWN0RGV0ZWN0aW9uLk1heGltdW1UaW1lb3V0ID0gMzA7DQoJICAJICAgIFNTRi5Qcm9kdWN0RGV0ZWN0aW9uLkhUVFAgPSB0cnVlOw0KDQoJICAJCWlmKHdvcmtGbG93ID09ICJmaW5kU29sdXRpb25zIil7DQoJICAJCQlnZXRDdXJyZW50UHJvZEluZm8oKTsNCgkgIAkJCSQoJyN2ZXJpZnlEZXZpY2UnKS5zaG93KCk7DQoJICAJCQlpZihpc1JldHJ5ID09ICJyZXRyeSIpew0KCSAgCQkJCVNTRi5Qcm9kdWN0RGV0ZWN0aW9uLkNhY2hlZFJlc3VsdHNFeHBpcmF0aW9uID0gMDsNCgkgIAkJCX0NCgkgIAkJCWVsc2V7DQoJICAJCQkJU1NGLlByb2R1Y3REZXRlY3Rpb24uQ2FjaGVkUmVzdWx0c0V4cGlyYXRpb24gPSBqUXVlcnkoIiNETURQcm9kdWN0c0NhY2hlSW50ZXJ2YWxWYWx1ZSIpLnZhbCgpOw0KCSAgCQkJfQ0KCSAgCQl9DQoJICAJCWVsc2V7DQoJICAJCQkkKCcjZGV2aWNlRGV0ZWN0ZWN0aW9uJykuc2hvdygpOw0KDQoJICAJCQlTU0YuUHJvZHVjdERldGVjdGlvbi5DYWNoZWRSZXN1bHRzRXhwaXJhdGlvbiA9IGlzUmV0cnkgPT0gInJldHJ5IiA/IDAgOiAkKCIjRE1EUHJvZHVjdHNDYWNoZUludGVydmFsVmFsdWUiKS52YWwoKTsNCgkgIAkJfQ0KCSAgCSAgICBwcm9kSW5mbyA9IFtdOw0KCSAgCSAgICBqUXVlcnkoIi5ub3RMaXN0ZWQiKS5oaWRlKCk7DQoJICAJICAgIFNTRi5Qcm9kdWN0RGV0ZWN0aW9uLkRldGVjdChvblN0YXR1cywgb25FcnJvcik7DQoJICAJfQ0KDQoJCS8vIGRldGVjdGVkIGRldmljZSBwcm9ncmVzcyBiYXIgIFItMw0KCQkgIAl2YXIgaW5pdERldGVjdERldmljZVByb2Nlc3NOZXcgPSBmdW5jdGlvbigpew0KICAgICAgICAgICAgJCgnLm1vZGFsQ29tbW9uQ2xhc3MnKS5oaWRlKCk7DQoJICAJCVNTRi5Qcm9kdWN0RGV0ZWN0aW9uLk1heGltdW1UaW1lb3V0ID0gMzA7DQoJICAJICAgIFNTRi5Qcm9kdWN0RGV0ZWN0aW9uLkhUVFAgPSB0cnVlOw0KDQoJICAJCWlmKHdvcmtGbG93ID09ICJmaW5kU29sdXRpb25zIil7DQoJICAJCQlnZXRDdXJyZW50UHJvZEluZm8oKTsNCgkgIAkJCSQoJyN2ZXJpZnlEZXZpY2UnKS5zaG93KCk7DQoJICAJCQlpZihpc1JldHJ5ID09ICJyZXRyeSIpew0KCSAgCQkJCVNTRi5Qcm9kdWN0RGV0ZWN0aW9uLkNhY2hlZFJlc3VsdHNFeHBpcmF0aW9uID0gMDsNCgkgIAkJCX0NCgkgIAkJCWVsc2V7DQoJICAJCQkJU1NGLlByb2R1Y3REZXRlY3Rpb24uQ2FjaGVkUmVzdWx0c0V4cGlyYXRpb24gPSBqUXVlcnkoIiNETURQcm9kdWN0c0NhY2hlSW50ZXJ2YWxWYWx1ZSIpLnZhbCgpOw0KCSAgCQkJfQ0KCSAgCQl9DQoJICAJCWVsc2V7DQoJCQkgaWYgKCFydW5JbkJhY2tncm91bmQpIHsNCgkgIAkJCSQoJyNzdGVwLTMnKS5zaG93KCk7DQoJCQkJfQ0KCSAgCQkJLy9TU0YuUHJvZHVjdERldGVjdGlvbi5DYWNoZWRSZXN1bHRzRXhwaXJhdGlvbiA9IDA7Ly9qUXVlcnkoIiNETURQcm9kdWN0c0NhY2hlSW50ZXJ2YWxWYWx1ZSIpLnZhbCgpOw0KCQkJCWlmKGlzUmV0cnkgPT0gInJldHJ5Iil7DQoJICAJCQkJU1NGLlByb2R1Y3REZXRlY3Rpb24uQ2FjaGVkUmVzdWx0c0V4cGlyYXRpb24gPSAwOw0KCSAgCQkJfQ0KCSAgCQkJZWxzZXsNCgkgIAkJCQlTU0YuUHJvZHVjdERldGVjdGlvbi5DYWNoZWRSZXN1bHRzRXhwaXJhdGlvbiA9IGpRdWVyeSgiI0RNRFByb2R1Y3RzQ2FjaGVJbnRlcnZhbFZhbHVlIikudmFsKCk7DQoJICAJCQl9DQoJICAJCX0NCgkgIAkgICAgcHJvZEluZm8gPSBbXTsNCgkgIAkgICAgalF1ZXJ5KCIubm90TGlzdGVkIikuaGlkZSgpOw0KCSAgCSAgICBTU0YuUHJvZHVjdERldGVjdGlvbi5EZXRlY3Qob25TdGF0dXMsIG9uRXJyb3IpOw0KCSAgCX0NCg0KDQoNCg0KCSAgCXZhciBvblN0YXR1cyA9IGZ1bmN0aW9uIChzdGF0dXNPYmopIHsNCgkgICAJICAgIHZhciBqc29uVmFsdWUgPSBKU09OLnN0cmluZ2lmeShzdGF0dXNPYmopOw0KDQoNCgkJCQkvKlNob3cgUHJvZ3Jlc3MgYXMgd2luZG93cyBzZXJ2aWNlIHJldHVybnMqLw0KCQkJCXVwZGF0ZVByb2dyZXNzQmFyKHN0YXR1c09iai5Qcm9ncmVzcyk7DQoNCg0KCSAgCSAgaWYoc3RhdHVzT2JqLlJlc3VsdCE9bnVsbCl7DQoNCgkgIAkJLypTaG93IGRldGVjdGVkIGRldmljZXMgaW4gVUkqLw0KDQoJICAJCSAgLy9DcmVhdGUgYSBjdXN0b20gYXJyYXkgdG8gbWFpbnRhaW4gdGhlIGltYWdlcw0KCSAgCQkgIGlmKHN0YXR1c09iai5SZXN1bHQubGVuZ3RoICE9IDM0KXsNCg0KCSAgCQkJaWYoc3RhdHVzT2JqLlByb2dyZXNzID09ICcxMDAnKXsNCgkJCQkgICAgaWYoJCgnI3BhZ2VJZGVudGlmaWVyJykudmFsKCkgPT0gIlNXRFNlbGZTZXJ2aWNlIil7DQoNCgkJCQkJICAgcHVzaFRvR2xvYmFsRGF0YUxheWVyKCJEZXRlY3Rpb24gQ29tcGxldGVkIiwiU1dERE1ERGV0ZWN0aW9uQ29tcGxldGVkIiwgInRydWUiLCBNU0lWZXJzaW9uLCBzdGF0dXNPYmouUHJvZ3Jlc3MsICcnLCBzdGF0dXNPYmouUmVzdWx0Lmxlbmd0aCwgc3RhdHVzT2JqLlJlc3VsdCk7DQoJCQkJCX0NCgkJCQkJZWxzZXsNCg0KCQkJCQkJcHVzaFRvR2xvYmFsRGF0YUxheWVyKCJEZXRlY3Rpb24gQ29tcGxldGVkIixnbG9iYWxEYXRhTGF5ZXIuVGVtcGxhdGUsICJ0cnVlIiwgTVNJVmVyc2lvbiwgc3RhdHVzT2JqLlByb2dyZXNzLCAnJywgc3RhdHVzT2JqLlJlc3VsdC5sZW5ndGgsIHN0YXR1c09iai5SZXN1bHQpOw0KCQkJCQl9DQoJCSAgCSAgICB9DQoJICAJCQkvKmVsc2UgaWYoc3RhdHVzT2JqLlByb2dyZXNzPj0nNzQnICYmIHN0YXR1c09iai5Qcm9ncmVzczw9Jzc3Jyl7DQoJICAJCQkJcHVzaFRvR2xvYmFsRGF0YUxheWVyKCJEZXRlY3Rpb24gUHJvY2VzcyIsICJ0cnVlIiwgTVNJVmVyc2lvbiwgc3RhdHVzT2JqLlByb2dyZXNzLCAnJywgc3RhdHVzT2JqLlJlc3VsdC5sZW5ndGgsIHN0YXR1c09iai5SZXN1bHQpOw0KCSAgCQkJfQ0KCSAgCQkJZWxzZSBpZihzdGF0dXNPYmouUHJvZ3Jlc3M+PSc0OScgJiYgc3RhdHVzT2JqLlByb2dyZXNzPD0nNTInKXsNCgkgIAkJCQlwdXNoVG9HbG9iYWxEYXRhTGF5ZXIoIkRldGVjdGlvbiBQcm9jZXNzIiwgInRydWUiLCBNU0lWZXJzaW9uLCBzdGF0dXNPYmouUHJvZ3Jlc3MsICcnLCBzdGF0dXNPYmouUmVzdWx0Lmxlbmd0aCwgc3RhdHVzT2JqLlJlc3VsdCk7DQoJICAJCQl9DQoJICAJCQllbHNlIGlmKHN0YXR1c09iai5Qcm9ncmVzcz49JzI0JyAmJiBzdGF0dXNPYmouUHJvZ3Jlc3M8PScyNycpew0KCSAgCQkJCXB1c2hUb0dsb2JhbERhdGFMYXllcigiRGV0ZWN0aW9uIFByb2Nlc3MiLCAidHJ1ZSIsIE1TSVZlcnNpb24sIHN0YXR1c09iai5Qcm9ncmVzcywgJycsIHN0YXR1c09iai5SZXN1bHQubGVuZ3RoLCBzdGF0dXNPYmouUmVzdWx0KTsNCgkgIAkJCX0qLw0KCSAgCQkJZWxzZSBpZihzdGF0dXNPYmouUHJvZ3Jlc3M9PScwJyl7DQoJICAJCQkJcHVzaFRvR2xvYmFsRGF0YUxheWVyKCJEZXRlY3Rpb24gc3RhcnRlZCIsZ2xvYmFsRGF0YUxheWVyLlRlbXBsYXRlLCAidHJ1ZSIsIE1TSVZlcnNpb24sIHN0YXR1c09iai5Qcm9ncmVzcywgJycsIHN0YXR1c09iai5SZXN1bHQubGVuZ3RoLCBzdGF0dXNPYmouUmVzdWx0KTsNCgkgIAkJCX0NCg0KCSAgCQkJRE1EUHJvZHMgPSBzdGF0dXNPYmouUmVzdWx0Ow0KCQkgIAkJICBmb3IodmFyIGk9MDtpPCBzdGF0dXNPYmouUmVzdWx0Lmxlbmd0aDsgaSsrKXsNCg0KCQkgIAkJCSAgdmFyIE5ld1Byb2R1Y3QgPSBnZXRVbmlxdWVQcm9kdWN0KHN0YXR1c09iai5SZXN1bHRbaV0pOw0KDQoJCSAgCQkJICBpZihOZXdQcm9kdWN0IT1mYWxzZSl7DQoJCSAgCQkJCSAgcGlkc0NvdW50ZXIgPSBwaWRzQ291bnRlciArMTsNCgkJICAJCQkJICAvL2NvbnNvbGUubG9nKCcvLy8vLy8vLy8vLy8vcGlkc0NvdW50ZXIrKycrcGlkc0NvdW50ZXIpOw0KCQkgIAkJCQkgIGlmKGlzT25QYWdlRGlzcGxheSl7DQoJCSAgCQkJCSAgCWdldFByb2R1Y3RJbmZvKE5ld1Byb2R1Y3QpOw0KCQkgIAkJCQkgIH0NCgkJICAJCQkJICBlbHNlew0KCQkgIAkJCQkgIAlnZXRQcm9kSW5mbyhOZXdQcm9kdWN0KTsNCg0KCQkgIAkJCQkgIH0NCgkJICAJCQkgIH0NCgkJICAJCSAgfQ0KCSAgCQkgIH0NCgkgIAkJJCgnI2RldmljZURldGVjdGVkQ291bnQnKS52YWwocHJvZEluZm8ubGVuZ3RoKTsNCgkJICAJfQ0KCQkgIAkgIGlmKHN0YXR1c09iai5Qcm9ncmVzcyA9PSAiMTAwIiAmJiAhaXNTdG9wRGV0ZWN0aW9uKXsNCgkJICAJCSAgLy9DaGVjayBpZiBhbGwgcGlkcyB2YWx1ZXMgYXJlIHJldHVybmVkLiBJZiBub3Qgc2V0aW50ZXJ2YWwgb24gcGlkc0NvdW50ZXINCgkJICAJCSAgLy9pZiBwaWRzQ291bnRlciA9PSAwIHRoZW4gY29udGludWUgdGhlIGZsb3cNCg0KCQkgIAkJICAgIHZlcmlmeVBpZHNSZXNwb25zZSgpOw0KCQkJCQlETURQcm9kcyA9IHN0YXR1c09iai5SZXN1bHQ7DQoJCQkJfQ0KCQkgIAkgIGVsc2V7DQoJCSAgCQlpc1Byb2dyZXNzQ29tcGxldGUgPSBmYWxzZTsNCgkJICAJICB9DQoJICAJfQ0KDQoJICAJdmFyIHZlcmlmeVBpZHNSZXNwb25zZSA9IGZ1bmN0aW9uKCl7DQoJCSAgCQkgIGlmKHBpZHNDb3VudGVyPT0wKXsNCgkJICAJCQlpc1Byb2dyZXNzQ29tcGxldGUgPSB0cnVlOw0KCQkJCQkvL0FkZGluZyBkZXRlY3Rpb24gY29tcGxldGUgdGVtcGxhdGUNCgkJCQkJJCgnLnByb2dyZXNzLWJhci1jb21wb25lbnQnKS5oaWRlKCk7Ly8gSGlkaW5nIHByb2dyZXNzIGJhciByMw0KCQkgIAkJICAJJCgnI3Byb2dyZXNzYmFyJykuaGlkZSgpOw0KCQkgIAkJICAJaWYoIWlzT25QYWdlRGlzcGxheSl7DQoJCSAgCQkgIAkJc2hvd0RldGVjdGVkUHJvZHVjdHMocHJvZEluZm8pOw0KCQkgIAkJICAJfQ0KCQkgIAkJICAJZWxzZXsNCgkJICAJCSAgCQloYW5kbGVPblBhZ2VEZXRlY3RlZFByb2R1Y3RzKHByb2RJbmZvKTsNCgkJICAJCSAgCX0NCgkJCQkJaXNTdG9wRGV0ZWN0aW9uID0gdHJ1ZTsNCgkJCQkJalF1ZXJ5KCIubm90TGlzdGVkIikuc2hvdygpOw0KCQkgIAkJICB9DQoJCSAgCQkgIGVsc2V7DQoJCSAgCQkJc2V0VGltZW91dChmdW5jdGlvbigpew0KCQkgIAkJCQl2ZXJpZnlQaWRzUmVzcG9uc2UoKTsNCgkJCQkgIAl9LDMwMCk7DQoJCSAgCQkgIH0NCgkgIAl9DQoNCg0KCQkvKjxzdW1tYXJ5Pg0KCQkJR2V0IHVuaXF1ZSBwcm9kdWN0cyBmcm9tIERNRCByZXNwb25zZQ0KCQk8L3N1bW1hcnk+Ki8NCgkgIAl2YXIgZ2V0VW5pcXVlUHJvZHVjdCA9IGZ1bmN0aW9uKG5ld1Byb2Qpew0KCSAgCQl2YXIgbmV3T2JqID0gdHJ1ZTsNCg0KCSAgCQkvL0lmIGZpcnN0IHByb2R1Y3QsIGJsaW5kbHkgcHVzaCB0byBvYmplY3QgYW5kIHJldHVybi4NCgkgIAkJaWYodW5pcXVlUHJvZHVjdHMubGVuZ3RoID09IDApew0KCSAgCQkJdW5pcXVlUHJvZHVjdHMucHVzaChuZXdQcm9kKTsNCgkgIAkJCXJldHVybiBuZXdQcm9kOw0KCSAgCQl9DQoNCiAgCQkJLy9TZWxlY3QgdW5pcXVlICBwcm9kdWN0cyBiYXNlZCBvbiBzZXJpYWwgbnVtYmVyLiBJZiBzZXJpYWwgbnVtYmVyIGlzIG5vdCBhdmFpbGFibGUgZmlsdGVyIHVzaW5nIG1vZGVsIG51bWJlci4NCiAgCQkJaWYobmV3UHJvZC5TZXJpYWxOdW1iZXIgIT0gIiIpew0KCQkgIAkJZm9yKHZhciBpPTA7aTx1bmlxdWVQcm9kdWN0cy5sZW5ndGg7aSsrKXsNCgkJICAJCQlpZihuZXdQcm9kLlNlcmlhbE51bWJlcj09dW5pcXVlUHJvZHVjdHNbaV0uU2VyaWFsTnVtYmVyKXsNCgkJICAJCQkJbmV3T2JqID0gZmFsc2U7DQoJCSAgCQkJfQ0KCQkgIAkJfQ0KCSAgCQl9DQoJICAJCWVsc2V7DQoJCSAgCQlmb3IodmFyIGk9MDtpPHVuaXF1ZVByb2R1Y3RzLmxlbmd0aDtpKyspew0KCQkgIAkJCWlmKG5ld1Byb2QuTW9kZWxOdW1iZXI9PXVuaXF1ZVByb2R1Y3RzW2ldLk1vZGVsTnVtYmVyKXsNCgkJICAJCQkJbmV3T2JqID0gZmFsc2U7DQoJCSAgCQkJfQ0KCQkgIAkJfQ0KCSAgCQl9DQoJICAJCWlmKG5ld09iail7DQoJICAJCQl1bmlxdWVQcm9kdWN0cy5wdXNoKG5ld1Byb2QpOw0KCSAgCQkJcmV0dXJuIG5ld1Byb2Q7DQoJICAJCX0NCgkgIAkJZWxzZSB7DQoJICAJCQlyZXR1cm4gZmFsc2U7DQoJICAJCX0NCgkgIAl9DQoNCg0KCQkvKjxzdW1tYXJ5Pg0KCQkJQ2FsbCBQSURTIHdlYnNlcnZpY2Ugd2hlbiBhIG5ldyBwcm9kdWN0IGlzIGRldGVjdGVkSFBEZXZpY2VzDQoJCQlJbnB1dDogVW5pcXVlIFByb2R1Y3QgZGV0ZWN0ZWQgZnJvbSBETUQNCgkJCVJlc3BvbnNlOiBQSURTIGRldGFpbHMgZm9yIHNwZWNpZmllZCBwcm9kdWN0DQoJCTwvc3VtbWFyeT4qLw0KdmFyIGdldFByb2RJbmZvID0gZnVuY3Rpb24oRE1EUHJvZCkgew0KICAJCQl2YXIgbmV3T2JqID0gdHJ1ZTsNCiAgCQkJZGF0ZU9iaiA9IG5ldyBEYXRlKCk7DQogIAkgICAgICAgIHZhciBkYXRlID0gZGF0ZU9iai5nZXRDbGllbnREYXRlVGltZSgpOw0KICAJICAgICAgICB2YXIgb2Zmc2V0ID0gZ2V0R01UT2Zmc2V0KCk7DQogIAkgICAgICAgIHZhciBjYyA9IGdldENDTEMoImNjIik7DQogIAkgICAgICAgIHZhciBsYyA9IGdldENDTEMoImxjIik7DQogIAkgICAgICAgIHZhciBtb2RlbE51bSA9IERNRFByb2QuTW9kZWxOdW1iZXIuc3BsaXQoJyMnKTsNCiAgCSAgICAgICAgdmFyIGRldmljZUFkZHJlc3MgPSAnJzsNCg0KCSAgCQlpZihETURQcm9kLkRldmljZVR5cGU9PSJVU0IiKXsNCgkgIAkJCWRldmljZUFkZHJlc3MgPSAidXNiOi8vIiArIERNRFByb2QuSXBBZGRyZXNzOw0KCSAgCQl9DQoJICAJCWVsc2UgaWYoRE1EUHJvZC5EZXZpY2VUeXBlPT0iIil7DQoJICAJCQlkZXZpY2VBZGRyZXNzID0gImh0dHA6Ly9sb2NhbGhvc3QiOw0KCSAgCQl9DQoJICAJCWVsc2V7DQoJICAJCQlkZXZpY2VBZGRyZXNzID0gICJodHRwczovLyIgKyBETURQcm9kLklwQWRkcmVzczsNCgkgIAkJfQ0KCQkJLy9SZW1vdmUgI1hZWiB2YWx1ZSBmcm9tIG1vZGVsIG51bWJlcg0KCQkJLy9wYWdlTmFtZTogVHJhY2sgZnJvbSB3aGVyZSB1c2VyIGhhcyBjb21lDQoJCQkvL3ByZWZWYWx1ZTogVG8gdHJhY2sgd2hpY2ggcG9ydGxldCB1c2VyIGhhcyBjbGlja2VkIHRoZSBETUQNCiAgCSAgICAgeGhyID0gJC5hamF4KHsNCgkJICAJCSAgICB1cmw6IHVybDEsDQoJCSAgCQkgICAgdHlwZTogJ0dFVCcsDQoJCSAgCQkgICAgZGF0YVR5cGU6ICdqc29uJywNCgkJICAJCSAgICBkYXRhOiB7InByb2R1Y3ROdW1iZXIiOiBtb2RlbE51bVswXSwgInNlcmlhbE51bWJlciI6IERNRFByb2QuU2VyaWFsTnVtYmVyLCAicHJvZHVjdE5hbWUiOiBETURQcm9kLk1vZGVsTmFtZSwgImRhdGUiOiBkYXRlLCAib2Zmc2V0Ijogb2Zmc2V0LCAiY2MiOmNjLCAibGMiOmxjLCAiaXBBZGRyZXNzIjpkZXZpY2VBZGRyZXNzLCAicGFnZU5hbWUiOiQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpLCAicHJlZlZhbHVlIjpwb3J0bGV0SUR9LA0KCQkgIAkJICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsDQoJCSAgCQkgICAgbWltZVR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJywNCgkJICAJCSAgICBhc3luYzogdHJ1ZSwNCgkJCSAgCQkgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uKCB4aHIgKSB7DQoJCQkgIAkJCXhoclBvb2wucHVzaCh4aHIpOw0KDQoJCQkgIAkJICB9LA0KCQkgIAkJICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHsNCgkJICAJCQkJCSAgdmFyIGRldGVjdGluZ0RldmljZUh0bWwgPSAiIjsNCgkJICAJCQkJCXBpZHNDb3VudGVyID0gcGlkc0NvdW50ZXItMTsNCgkJICAJCQkJCS8vUmVtb3ZlIGludmFsaWQgcHJvZHVjdHMNCgkJICAJCQkJCSAgaWYoZGF0YVswXS5TdXBwb3J0TGluayE9IHVuZGVmaW5lZCl7DQoNCg0KDQoJCQkJICAJCQkgaWYocHJvZEluZm8ubGVuZ3RoID09IDApew0KCQkJCSAgCQkJCXByb2RJbmZvLnB1c2goZGF0YSk7DQoJCQkJICAJCQkJcHJvZEluZm9bcHJvZEluZm8ubGVuZ3RoLTFdWyJEZXZpY2VUeXBlIl0gPSBETURQcm9kLkRldmljZVR5cGU7DQoJCQkJICAJCQkJcHJvZEluZm9bcHJvZEluZm8ubGVuZ3RoLTFdWyJJcEFkZHJlc3MiXSA9IERNRFByb2QuSXBBZGRyZXNzOw0KCQkJCSAgCQkJCWRldGVjdGluZ0RldmljZUh0bWwgPSBidWlsZERldGVjdGVkUHJvZHVjdFVJKHByb2RJbmZvWzBdWzBdKTsNCgkJCQkgIAkJCQlqUXVlcnkoIiNkZXRlY3RlZEhQRGV2aWNlcyIpLmFwcGVuZChkZXRlY3RpbmdEZXZpY2VIdG1sKTsNCgkJCQkgIAkJCSB9DQoJCQkJICAJCQllbHNlew0KCQkJCSAgCQkJCQlwcm9kSW5mby5wdXNoKGRhdGEpOw0KCQkJCQkgIAkJCSAgCXByb2RJbmZvW3Byb2RJbmZvLmxlbmd0aC0xXVsiRGV2aWNlVHlwZSJdID0gRE1EUHJvZC5EZXZpY2VUeXBlOw0KCQkJCQkgIAkJCSAgCXByb2RJbmZvW3Byb2RJbmZvLmxlbmd0aC0xXVsiSXBBZGRyZXNzIl0gPSBETURQcm9kLklwQWRkcmVzczsNCgkJCQkJCQkJCWRldGVjdGluZ0RldmljZUh0bWwgPSBidWlsZERldGVjdGVkUHJvZHVjdFVJKHByb2RJbmZvW3Byb2RJbmZvLmxlbmd0aC0xXVswXSk7DQoJCQkJCQkJCQlqUXVlcnkoIiNkZXRlY3RlZEhQRGV2aWNlcyIpLmFwcGVuZChkZXRlY3RpbmdEZXZpY2VIdG1sKTsNCgkJCQkgIAkJCSB9DQoNCg0KDQoJCQkJICAJCQlpZihpc1Byb2dyZXNzQ29tcGxldGUpew0KCQkJCSAgCQkJCSBpZihwcm9kSW5mby5sZW5ndGggPT0gMCl7DQoJCQkJICAJCQkJCWRldGVjdGluZ0RldmljZUh0bWwgPSBidWlsZERldGVjdGVkUHJvZHVjdFVJKHByb2RJbmZvWzBdWzBdKTsNCgkJCQkgIAkJCQkgfQ0KCQkJCSAgCQkJCSBlbHNlew0KCQkJCSAgCQkJCQkgZGV0ZWN0aW5nRGV2aWNlSHRtbCA9IGJ1aWxkRGV0ZWN0ZWRQcm9kdWN0VUkocHJvZEluZm9bcHJvZEluZm8ubGVuZ3RoLTFdWzBdKTsNCgkJCQkgIAkJCQkgfQ0KCQkJCSAgCQkJCXByb2R1Y3RDYXQoRE1EUHJvZC5EZXZpY2VUeXBlLCBkZXRlY3RpbmdEZXZpY2VIdG1sKTsNCgkJCQkgIAkJCQkkKCcjZGV2aWNlRGV0ZWN0ZWRDb3VudCcpLmh0bWwoJygnICtwcm9kSW5mby5sZW5ndGgrJyknKTsNCgkJCSAgCQkJCX0NCgkJICAJCQkJfQ0KDQoJCSAgCQkgICAgfSwNCgkJICAJCSAgZXJyb3I6ZnVuY3Rpb24ocmVxdWVzdCwgc3RhdHVzLCBlcnJvcil7DQoJCSAgCQkJY29uc29sZS5sb2coIkVycm9yIitlcnJvcik7DQoJCSAgCQkgIH0NCgkJICAJCX0pOw0KICAJfQ0KDQoJICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbiAocmVxdWVzdCwgc3RhdHVzLCBlcnJvcikgew0KCSAgCQkvKklmIEFueSBlcnJvciovDQoJICAgICAgICAgIGNvbnNvbGUubG9nKCJFcnJvciIpOw0KCSAgICAgICAgICBwdXNoVG9HbG9iYWxEYXRhTGF5ZXIoInN0ZXAyIixnbG9iYWxEYXRhTGF5ZXIuVGVtcGxhdGUsICJ0cnVlIiwgTVNJVmVyc2lvbiwgJycsIGVycm9yLCAnJywgJycpOw0KDQoJICAgICAgfQ0KDQoNCgkJLyo8c3VtbWFyeT4NCgkJCUNhdGVnb3JpemUgdGhlIHByb2R1Y3RzIG9uY2UgZGV0ZWN0aW9uIGlzIGNvbXBsZXRlZA0KCQk8L3N1bW1hcnk+Ki8NCgkgIAl2YXIgc2hvd0RldGVjdGVkUHJvZHVjdHMgPSBmdW5jdGlvbiAocHJvZHVjdHMpew0KCQlqUXVlcnkoIi5sb2NhbERldmljZXMiKS5odG1sKCIiKTsNCgkJalF1ZXJ5KCIubmV0d29ya0RldmljZXMiKS5odG1sKCIiKTsNCgkJalF1ZXJ5KCIuVVNCRGV2aWNlcyIpLmh0bWwoIiIpOw0KDQoJICAJaWYocHJvZHVjdHMubGVuZ3RoID09IDApew0KCSAgCQlpZih3b3JrRmxvdyA9PSAiZmluZFNvbHV0aW9ucyIpew0KICAJCQkJJCgnI2R2WW91clByb2R1Y3ROb3RGb3VuZCcpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsNCiAgCQkJCSQoJyNkdlplcm9EZXZpY2VGb3VuZCcpLmFkZENsYXNzKCdoaWRkZW4nKTsNCiAgCQkJfQ0KCSAgCQkkKCcubW9kYWxDb21tb25DbGFzcycpLmhpZGUoKTsNCgkgIAkJJCgnI25vUHJvZHVjdHNEZXRlY3RlZCcpLnNob3coKTsNCgkgIAl9DQoJICAJZWxzZXsNCgkgIAkJalF1ZXJ5KCIubmV0d29ya0RldmljZXNXcmFwcGVyIikuaGlkZSgpOw0KCSAgCQlqUXVlcnkoIi5VU0JEZXZpY2VzV3JhcHBlciIpLmhpZGUoKTsNCgkgIAkJalF1ZXJ5KCIubG9jYWxEZXZpY2VzV3JhcHBlciIpLmhpZGUoKTsNCg0KCSAgCQlmb3IodmFyIGk9MDtpPHByb2R1Y3RzLmxlbmd0aDtpKyspew0KCSAgCQkJdmFyIHByb2QgPSBwcm9kdWN0c1tpXVswXTsNCg0KCSAgCQkJaWYocHJvZHVjdHMubGVuZ3RoPT0xKXsNCgkgIAkJCQlqUXVlcnkoIi5hcnJhbmdlRGV2aWNlcyIpLmNzcygiYm9yZGVyLWJvdHRvbSIsIjFweCBzb2xpZCAjY2NjIik7DQoJICAJCQkJalF1ZXJ5KCIuYXJyYW5nZURldmljZXMiKS5maW5kKCJkaXYiKS5jc3MoImJvcmRlci1ib3R0b20iLCJub25lIik7DQoJICAJCQl9DQoJICAJCQllbHNlew0KCSAgCQkJCWpRdWVyeSgiLmFycmFuZ2VEZXZpY2VzIikuZmluZCgiZGl2IikuY3NzKCJib3JkZXItYm90dG9tIiwiMXB4IHNvbGlkICNjY2MiKTsNCgkgIAkJCQlqUXVlcnkoIi5hcnJhbmdlRGV2aWNlcyIpLmNzcygiYm9yZGVyLWJvdHRvbSIsIm5vbmUiKTsNCg0KCSAgCQkJfQ0KDQoJICAJCQl2YXIgZGV0ZWN0aW5nRGV2aWNlSHRtbCA9IGJ1aWxkRGV0ZWN0ZWRQcm9kdWN0VUkocHJvZCk7DQoJICAJCQlwcm9kdWN0Q2F0KHByb2R1Y3RzW2ldLkRldmljZVR5cGUsIGRldGVjdGluZ0RldmljZUh0bWwpOw0KCSAgCQkJfQ0KCSAgCQlzaG93UmVzdWx0KHByb2R1Y3RzKTsNCiAgCQkJJCgnI2RldmljZURldGVjdGVkQ291bnQnKS5odG1sKCcoJyArcHJvZHVjdHMubGVuZ3RoKycpJyk7DQoJICAJCX0NCgkgIAl9DQoNCgkJLyo8c3VtbWFyeT4NCgkJCUdldCBzcGVjaWZpZWQgcHJvZHVjdCBpbmZvcm1hdGlvbiBmcm9tIFBJRFMgcmVzcG9uc2UNCgkJPC9zdW1tYXJ5PiovDQogICAgICAgIHZhciBnZXRDdXJyZW50TW9kZWxEZXRhaWxzID0gZnVuY3Rpb24gKG1vZGVsTnVtYmVyLCBwcm9kdWN0cyl7DQoJICAJCWZvcih2YXIgaT0wO2k8cHJvZHVjdHMubGVuZ3RoO2krKyl7DQoJICAJCQl2YXIgcHJvZCA9IHByb2R1Y3RzW2ldWzBdOw0KCSAgCQkJaWYobW9kZWxOdW1iZXIgPT0gcHJvZC5Qcm9kdWN0TmFtZU9pZCl7DQoJICAJCQkJcmV0dXJuIHByb2Q7DQoJICAJCQl9DQoJICAJCX0NCgkgIAkJcmV0dXJuIGZhbHNlOw0KCSAgCX0NCg0KCQkvKjxzdW1tYXJ5Pg0KCQkJQ2F0ZWdvcml6ZSB0aGUgcHJvZHVjdHMgb25jZSBkZXRlY3Rpb24gaXMgY29tcGxldGVkDQoJCTwvc3VtbWFyeT4qLw0KCSAgCWZ1bmN0aW9uIHByb2R1Y3RDYXQoZGV2aWNlVHlwZSwgZGV0ZWN0aW5nRGV2aWNlSHRtbCl7DQogIAkJCWlmKGRldmljZVR5cGUgPT0gIlBDIikgey8qQmlvcyovDQogIAkJCQlqUXVlcnkoIi5sb2NhbERldmljZXNXcmFwcGVyIikuc2hvdygpOw0KICAJCQkJalF1ZXJ5KCIubG9jYWxEZXZpY2VzIikuYXBwZW5kKGRldGVjdGluZ0RldmljZUh0bWwpOw0KICAJCQl9DQogIAkJCWVsc2UgaWYoZGV2aWNlVHlwZSA9PSAiTmV0d29yayIpIHsNCiAgCQkJCS8qTmV0d29yayovDQogIAkJCQlqUXVlcnkoIi5uZXR3b3JrRGV2aWNlc1dyYXBwZXIiKS5zaG93KCk7DQogIAkJCQlqUXVlcnkoIi5uZXR3b3JrRGV2aWNlcyIpLmFwcGVuZChkZXRlY3RpbmdEZXZpY2VIdG1sKTsNCiAgCQkJfQ0KICAJCQllbHNlIGlmKGRldmljZVR5cGUgPT0gIlVTQiIpIHsNCiAgCQkJCS8qVVNCKi8NCiAgCQkJCWpRdWVyeSgiLlVTQkRldmljZXNXcmFwcGVyIikuc2hvdygpOw0KICAJCQkJalF1ZXJ5KCIuVVNCRGV2aWNlcyIpLmFwcGVuZChkZXRlY3RpbmdEZXZpY2VIdG1sKTsNCiAgCQkJfQ0KDQogIAkJCWVsc2UgaWYoZGV2aWNlVHlwZSA9PSAiVW5rbm93biIpIHsNCiAgCQkJCS8qVW5rbm93biovDQogIAkJCQkvL2pRdWVyeSgiI1VTQkRldmljZXNXcmFwcGVyIikuc2hvdygpOw0KICAJCQkJLy9qUXVlcnkoIiNVU0JEZXZpY2VzIikuYXBwZW5kKGRldGVjdGluZ0RldmljZUh0bWwpOw0KICAJCQl9DQoJICAJfQ0KDQoJCS8qPHN1bW1hcnk+DQoJCQlTaG93IHRoZSBkZXRlY3RlZCBwcm9kdWN0cyBvbmNlIHByb2dyZXNzIGlzIGNvbXBsZXRlZA0KCQk8L3N1bW1hcnk+Ki8NCgkgIAl2YXIgc2hvd1Jlc3VsdCA9IGZ1bmN0aW9uKHByb2R1Y3RzKSB7DQoJICAJCXZhciBjdXJyZW50bW9kZWwgPSBmYWxzZTsNCgkgIAkJZm9yKHZhciBpPTA7aTxwcm9kdWN0cy5sZW5ndGg7aSsrKXsNCgkgIAkJCWlmKHdvcmtGbG93ID09ICJmaW5kU29sdXRpb25zIiAmJiAhaXNNb2RlbEZvdW5kRm9yU29sdXRpb24pew0KCSAgCQkJCWN1cnJlbnRtb2RlbCA9IGdldEN1cnJlbnRNb2RlbERldGFpbHMocHJvZHVjdE5hbWVPaWQxLCBwcm9kSW5mbyk7DQoJCQkJCWlzTW9kZWxGb3VuZEZvclNvbHV0aW9uID0gdHJ1ZTsNCgkgIAkJCX0NCgkgIAkJfQ0KDQoJCSAgCWlmKHdvcmtGbG93ID09ICJmaW5kU29sdXRpb25zIil7DQoJCQkJCWlmKGN1cnJlbnRtb2RlbCE9ZmFsc2Upew0KCQkJCQkJaWYoaXNTd2RTdGVwVHdvUmVxdWVzdCl7DQoJCQkJCQkJaW5pdFNTRkhhbmRzaGFrZShjdXJyZW50bW9kZWwpOw0KCQkJCQkJfQ0KCQkJCQkJZWxzZSBpZighaXNQZHBTd2RSZXF1ZXN0KXsNCgkJCQkJCQljaGVja0ZvcldhcnJhbnJ5TGluaygpOw0KCQkJCQkJCWdldEFkZHJlc3MoY3VycmVudE1vZGVsTnVtYmVyLCBwcm9kdWN0TmFtZU9pZDEpOw0KCQkJCQkJfQ0KCQkJCQkJZWxzZSBpZighaXNWZXJpZmljYXRpb25DYW5jZWxsZWQpew0KCQkJCQkJCXJlZGlyZWN0VG9Td2RTdGVwVHdvKHRydWUsY3VycmVudE1vZGVsTnVtYmVyKTsNCgkJCQkJCX0NCgkJCQkJCWVsc2UNCgkJCQkJCQlyZWRpcmVjdFRvU3dkU3RlcFR3byh0cnVlLGN1cnJlbnRNb2RlbE51bWJlcik7DQoJCQkJCX0NCgkJCQkJZWxzZXsNCgkJCQkJCS8vc2hvdyBvdGhlciBwcm9kdWN0cw0KCQkJCQkJJCgnLm1vZGFsQ29tbW9uQ2xhc3MnKS5oaWRlKCk7DQoJCQkJCQkkKCcjZGV2aWNlRGV0ZWN0ZWRGb3JTb2x1dGlvbnMnKS5zaG93KCk7DQoJCQkJCX0NCgkJCX0NCgkJCWVsc2V7DQoJCQkJJCgnLm1vZGFsQ29tbW9uQ2xhc3MnKS5oaWRlKCk7DQoJCQkJJCgnI251bWJlck9mRGV2aWNlRGV0ZWN0ZWQnKS5zaG93KCk7DQoJCQl9DQoJICAJfQ0KDQoJCS8qPHN1bW1hcnk+DQoJCQlUbyBnZXQgc2VsZWN0ZWQgcHJvZHVjdCBJbmZvcm1hdGlvbg0KCQk8L3N1bW1hcnk+Ki8NCgkgIAl2YXIgZ2V0Q3VycmVudFByb2RJbmZvID0gZnVuY3Rpb24gKCl7DQoJICAJCSQoJyNtb2RhbFByb2RJbWFnZScpLmF0dHIoInNyYyIsICgkKCIjcHJvZEluZm9JbWciKS5hdHRyKCJzcmMiKSkpOw0KCSAgCQkkKCcjbW9kYWxQcm9kTnVtYmVyJykuaHRtbCgkKCcjcG1fc2VyaWVzX21vZGVsX25hbWUnKS52YWwoKSk7DQoJICAJCSQoJyNtb2RhbFByb2ROYW1lJykuaHRtbCgkKCcjcG1fc2VyaWVzX3Byb2R1Y3RfbmFtZScpLnZhbCgpKTsNCgkgIAl9DQoNCgkJLyo8c3VtbWFyeT4NCgkJCUJ1aWxkIHRoZSByZXNwb25zaXZlIFVJIGZvciBlYWNoIHByb2R1Y3QNCgkJPC9zdW1tYXJ5PiovDQoJICAJdmFyIGJ1aWxkRGV0ZWN0ZWRQcm9kdWN0VUkgPSBmdW5jdGlvbihwcm9kdWN0cyl7DQoJICAJCXZhciBuYW1lQXR0cjsNCgkgIAkJdmFyIGh0bWxzdHI9IiI7DQoJICAJCXZhciBpbWdTdHJpbmcgPSAiIjsNCg0KCSAgCQl2YXIgc2VsZWN0SWQgPSBwcm9kdWN0cy5TZXJpYWxOdW1iZXIgIT0gIiIgPyBwcm9kdWN0cy5TZXJpYWxOdW1iZXIgOiBwcm9kdWN0cy5Qcm9kdWN0TnVtYmVyOw0KCSAgCQlzZWxlY3RJZCA9ICQoJyMnK3NlbGVjdElkKS5sZW5ndGggPiAwID8gc2VsZWN0SWQgKyAkKCcjJytzZWxlY3RJZCkubGVuZ3RoIDogc2VsZWN0SWQ7DQoJCQl2YXIgbGFiZWxJZCA9ICJsYmxfIiArIHNlbGVjdElkOw0KDQoJICAJCXZhciBwcm9kdWN0SnNvbldpdGhIdG1sQ2hhciA9IHByb2R1Y3RzOw0KCSAgCQlwcm9kdWN0SnNvbldpdGhIdG1sQ2hhci5Qcm9kdWN0TmFtZSA9IHByb2R1Y3RzLlByb2R1Y3ROYW1lLnJlcGxhY2UoLycvZywgJyYjMzk7Jyk7DQoJICAJCWlmKHByb2R1Y3RzIT1udWxsICYmIHByb2R1Y3RzLlByb2R1Y3ROYW1lIT1udWxsKXsgLypSZW1vdmUgdGhpcyBjb25kaXRpb24gd2hlbiBQSURTIGlzc3VlcyBpcyBmaXhlZCovDQoJCSAgCQlodG1sc3RyICs9ICcgPGRpdiBjbGFzcz0iaHAtcm93IGhwLXJvdy1zbSI+PGRpdiBjbGFzcz0iY29sLWxnLTggY29sLW1kLTgiPic7DQoJCSAgCQlpZihwcm9kdWN0cy5MZ0ltZ1VyaSE9IiIpew0KCQkgIAkJICAgICBodG1sc3RyICs9CSc8aW1nIHNyYz0iJytwcm9kdWN0cy5MZ0ltZ1VyaSsnIiBhbHQ9IicrcHJvZHVjdHMuUHJvZHVjdE5hbWUrJyIgLz4nOw0KCQkgIAkJfQ0KCQkgIAkJZWxzZXsNCgkJICAJCQkgaHRtbHN0ciArPQknPGltZyBzcmM9IicrZmFsbGJhY2tJbWFnZSsnIiBhbHQ9IicrcHJvZHVjdHMuUHJvZHVjdE5hbWUrJyIgd2lkdGg9IjEwMCUiLz4nOw0KCQkgIAkJfQ0KCQkgIAkJaHRtbHN0ciArPSAnPC9kaXY+JzsNCgkJICAJCWh0bWxzdHIgKz0JJzxkaXYgY2xhc3M9ImNvbC1sZy0xNiBjb2wtbWQtMTYiPic7DQoJCQkJCWh0bWxzdHIgKz0JJzxoMyBjbGFzcz0iRE1EUHJvZEhlYWRlciIgaWQ9IicrbGFiZWxJZCsnIj4nK3Byb2R1Y3RzLlByb2R1Y3ROYW1lKyc8L2gzPic7DQoJCQkJCWlmKHByb2R1Y3RzLlByb2R1Y3ROdW1iZXIhPSIiKXsNCgkJCQkJCXZhciBzZXJpYWxOdW1iZXJIdG1sID0gcHJvZHVjdHMuU2VyaWFsTnVtYmVyICE9ICIiID8gc2VyaWFsTG9jYWxlICsnICcrIHByb2R1Y3RzLlNlcmlhbE51bWJlciA6ICIiOw0KCQkJCQkJaHRtbHN0ciArPQknPHAgY2xhc3M9InRleHQtYmxhY2siPicrIG1vZGVsTG9jYWxlICsnICcrIHByb2R1Y3RzLlByb2R1Y3ROdW1iZXIrJzxici8+Jysgc2VyaWFsTnVtYmVySHRtbCsnPC9wPic7DQoJCQkJCX0NCgkJCQkJbmFtZUF0dHIgPSAiTU9ERUxOTz0iK3Byb2R1Y3RzLlByb2R1Y3ROdW1iZXIrIiZTRVJJQUxOTz0iK3Byb2R1Y3RzLlNlcmlhbE51bWJlcjsNCgkJCQkJaHRtbHN0ciArPQknPGEgcm9sZT0iYnV0dG9uIiBhcmlhLWRlc2NyaWJlZGJ5PSInKyBsYWJlbElkICsnIiBpZD0nK3Byb2R1Y3RzLlByb2R1Y3ROdW1iZXIrJyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCk7IiBjbGFzcz0iYnV0dG9uIHByaW1hcnkiJzsNCgkJCQkJdmFyIGNsaWNrSGFuZGxlciA9ICdvbmNsaWNrPSJnZXRTb2x1dGlvbnNETUQoXCcnK3Byb2R1Y3RzLlByb2R1Y3ROdW1iZXIrJ1wnLFwnJytwcm9kdWN0cy5TdXBwb3J0TGluay5VcmkrJ1wnKTsiPic7DQoNCg0KCQkJCQlpZigkKCcjcGFnZUlkZW50aWZpZXInKS52YWwoKS50b0xvd2VyQ2FzZSgpID09ICJzd2RzZWxmc2VydmljZXN0ZXAiKXsNCgkJCQkJCWNsaWNrSGFuZGxlciA9ICdvbmNsaWNrPSJoYW5kbGVTZWxlY3RTdWJtaXQoJCh0aGlzKSk7IiBkYXRhLWRpc21pc3M9Im1vZGFsIj4nOw0KCQkJCQkJaHRtbHN0ciArPSBjbGlja0hhbmRsZXI7DQoJCQkJCQlodG1sc3RyICs9IHNlbGVjdExvY2FsZTsNCgkJCQkJfQ0KCQkJCQkvL3NvbHV0aW9uU3VwcG9ydGVkUGwgaXMgZGVmaW5lZCBpbiBkZXRlY3RNeURldmljZURpdi5qc3AgaW4gaHAtZGV0ZWN0LWxvYWQtbXktZGV2aWNlDQoJCQkJCWVsc2UgaWYod29ya0Zsb3cgPT0gImZpbmRTb2x1dGlvbnMiICYmIGpRdWVyeS5pbkFycmF5KCBwcm9kdWN0cy5Qcm9kdWN0TGluZUNvZGUsIHNvbHV0aW9uU3VwcG9ydGVkUGwpICE9IC0xKXsNCgkJCQkJCWlmKGlzUGRwU3dkUmVxdWVzdCkNCgkJCQkJCQljbGlja0hhbmRsZXIgPSAnb25jbGljaz0icmVkaXJlY3RUb1N3ZFN0ZXBUd28odHJ1ZSwnK3Byb2R1Y3RzLlByb2R1Y3ROdW1iZXIrJyk7Ij4nOw0KCQkJCQkJaHRtbHN0ciArPSBjbGlja0hhbmRsZXI7DQoJCQkJCQlodG1sc3RyICs9IGZpbmRTb2x1dGlvbnNMb2NhbGU7DQoJCQkJCX0NCgkJCQkJZWxzZXsNCgkJCQkJCWlmKGlzUGRwU3dkUmVxdWVzdCkNCgkJCQkJCQljbGlja0hhbmRsZXIgPSAnb25jbGljaz0icmVkaXJlY3RUb1N3ZFN0ZXBUd28oZmFsc2UsJytwcm9kdWN0cy5Qcm9kdWN0TnVtYmVyKycpOyI+JzsNCgkJCQkJCWVsc2UgaWYoaXNXYXJyYW50eUNoZWNrKQ0KCQkJCQkJCWNsaWNrSGFuZGxlciA9ICdvbmNsaWNrPSJjaGVja0ZvcldhcnJhbnR5KHRoaXMpOyI+JzsNCgkJCQkJCWh0bWxzdHIgKz0gY2xpY2tIYW5kbGVyOw0KCQkJCQkJaHRtbHN0ciArPSBzZWxlY3RMb2NhbGU7DQoJCQkJCX0NCgkJCQkJaHRtbHN0ciArPSAnPC9hPjxpbnB1dCB0eXBlPSJoaWRkZW4iIGNsYXNzPSJwaWRzUmVzcG9uc2UiIHZhbHVlPVwnJytKU09OLnN0cmluZ2lmeShwcm9kdWN0SnNvbldpdGhIdG1sQ2hhcikrJ1wnLz48L2Rpdj48L2Rpdj4nOw0KCSAgCQl9DQoJCQkJcmV0dXJuKGh0bWxzdHIpOw0KCSAgCX0NCg0KLyo8c3VtbWFyeT4NCglSdW4gZmluZCBzb2x1dGlvbnMgaW4gYmFja2dyb3VuZA0KCVNlYXJjaCBmb3Igc2VsZWN0ZWQgcHJvZHVjdCBmcm9tIERNRCBjYWNoZQ0KCVJlZGlyZWN0IHRvIHJlc3BlY3RlZCBwYWdlDQo8L3N1bW1hcnk+Ki8NCiAgICAgICAgdmFyIGdldFNvbHV0aW9uc0RNRCA9IGZ1bmN0aW9uKHBwcm9kdWN0TnVtYmVyLCB1cmwpew0KDQogICAgICAgIAlpZih0eXBlb2YgZXZlbnQgIT09ICJ1bmRlZmluZWQiICYmIGV2ZW50LnRhcmdldCAhPSB1bmRlZmluZWQpew0KICAgICAgICAJCWRtZFNlbGVjdEJ1dHRvbklkID0gZXZlbnQudGFyZ2V0LmF0dHJpYnV0ZXMuaWQudmFsdWU7DQogICAgICAgIAl9DQoNCiAgICAgICAgCS8vQ2xvc2UgYWxsIHRoZSBtb2RhbCBiZWZvcmUgc3Bpbm5lcg0KCQkJaWYoJCgnI3BhZ2VJZGVudGlmaWVyJykudmFsKCkgIT0gIlN1cHBvcnQgSG9tZSIpew0KCQkJCSQoJy5tb2RhbCcpLm1vZGFsKCdoaWRlJyk7DQoJCQkJJCgnI21kbFNwaW5uZXInKS5tb2RhbCgnc2hvdycpOw0KCQkJCSQoJy5zcGluZXJQbGFjZW1lbnQnKS5jc3MoJ21hcmdpbi10b3AnLCQod2luZG93KS5oZWlnaHQoKS8yIC0gMzApOw0KICAgICAgICAgICAgIH0NCgkJICAJLy9nZXQgcGlkcyByZXNwb25zZQ0KICAgICAgICAJdmFyIHBpZHNSZXNwb25zZSA9IHByb2RJbmZvOw0KICAgICAgICAJdmFyIGlzUHJlc2VudCA9IGZhbHNlOw0KICAgICAgICAJaWYodHlwZW9mIHByb2RJbmZvICE9PSAidW5kZWZpbmVkIiAmJiBwcm9kSW5mb1swXVswXS5Qcm9kdWN0TmFtZSAhPSB1bmRlZmluZWQpew0KICAgICAgICAJLy9zZWFyY2ggZm9yIHRoZSBwcm9kdWN0IG9uIG1vZGVsIG51bWJlcg0KICAgICAgICAJZm9yKHZhciBpPTA7aTxwaWRzUmVzcG9uc2UubGVuZ3RoO2krKyl7DQogICAgICAgIAkJaWYocGlkc1Jlc3BvbnNlW2ldWzBdLlByb2R1Y3ROdW1iZXIgPT0gcHByb2R1Y3ROdW1iZXIpew0KICAgICAgICAJCQlwcm9kdWN0TmFtZSA9IHBpZHNSZXNwb25zZVtpXVswXS5Qcm9kdWN0TmFtZTsNCiAgICAgICAgCQkJcHJvZHVjdE51bWJlciA9IHBpZHNSZXNwb25zZVtpXVswXS5Qcm9kdWN0TnVtYmVyOw0KICAgICAgICAJCQlwcm9kdWN0TGluZSA9IHBpZHNSZXNwb25zZVtpXVswXS5Qcm9kdWN0TGluZUNvZGU7DQogICAgICAgIAkJCXByb2R1Y3ROYW1lT2lkID0gcGlkc1Jlc3BvbnNlW2ldWzBdLlByb2R1Y3ROYW1lT2lkOw0KICAgICAgICAJCQlzdXBwb3J0TmFtZU9pZCA9IHBpZHNSZXNwb25zZVtpXVswXS5TdXBwb3J0TmFtZU9pZDsNCiAgICAgICAgCQkJZGl2aWNlVHlwZSA9IHBpZHNSZXNwb25zZVtpXS5EZXZpY2VUeXBlOw0KDQogICAgICAgIAkJCWFkZHJlc3MgPSBkaXZpY2VUeXBlID09IlVTQiIgPyAidXNiOi8vIiArIHBpZHNSZXNwb25zZVtpXS5JcEFkZHJlc3M6DQoJCQkJCQkJZGl2aWNlVHlwZSA9PSIiID8gImh0dHA6Ly9sb2NhbGhvc3QiIDogImh0dHBzOi8vIiArIHBpZHNSZXNwb25zZVtpXS5JcEFkZHJlc3M7DQoNCiAgICAgICAgCQkJLy9hZGRyZXNzID0gZ2V0QWRkcmVzc0RNRChwcHJvZHVjdE51bWJlcik7DQogICAgICAgIAkJCWlzUHJlc2VudCA9IHRydWU7DQogICAgICAgIAkJfQ0KICAgICAgICAJfQ0KICAgICAgICAJLy9hc3NpZ24gdmFsdWVzDQogICAgICAgIAkvL2NhbGwgc29sdXRpb24NCiAgICAgICAgCQlpZihpc1ByZXNlbnQpew0KICAgICAgICAJCQkkKCcubW9kYWwnKS5tb2RhbCgnaGlkZScpOw0KICAgICAgICAJCQlpZihhZGRyZXNzPT0iIil7DQogICAgICAgIAkJCQlpc1NvbEZvdW5kID0gdHJ1ZTsNCiAgICAgICAgCQkJCWlmKGpRdWVyeS5pbkFycmF5KHByb2R1Y3RMaW5lLCBzb2x1dGlvblN1cHBvcnRlZFBsKSAhPSAtMSAmJiBqUXVlcnkuaW5BcnJheShwcm9kdWN0TGluZSwgc29sdXRpb25TdXBwb3J0ZWRQY1BsKSA9PSAtMSl7DQogICAgICAgIAkJCQkJZmluZFNvZnR3YXJlVXBkYXRlU2VydmljZSgpOw0KICAgICAgICAJCQkJfQ0KICAgICAgICAJCQkJZWxzZSBpZihqUXVlcnkuaW5BcnJheSggcHJvZHVjdExpbmUsIHNvbHV0aW9uU3VwcG9ydGVkUGNQbCkgIT0gLTEpew0KICAgICAgICAJCQkJCWZpbmRBQ0xNU29sdXRpb25TZXJ2aWNlKCk7DQogICAgICAgIAkJCQl9DQogICAgICAgIAkJCX0NCiAgICAgICAgCQkJZWxzZXsNCiAgICAgICAgCQkJCWZpbmRTb2x1dGlvbigpOw0KICAgICAgICAJCQl9DQogICAgICAgIAkJfQ0KICAgIAkJfQ0KDQogICAgCQkvL0ltcGxlbWVudCB0aGUgYWpheCBjYWxsIGZvciBwcmUtMjAwNSBwcm9kdWN0IGNoZWNrDQogICAgCQlpZihwcm9kdWN0TmFtZU9pZCAhPSAnJykNCiAgICAJCQljaGVja0Zvckhpc3RvcmljUHJvZHVjdCh1cmwpOw0KICAgIAkJZWxzZQ0KICAgICAgICAJCXdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdXJsOw0KCX0NCg0KICAvKjxzdW1tYXJ5Pg0KCUdldCB0aGUgc2VsZWN0ZWQgcHJvZHVjdCBJUCBhZGRyZXNzIGZvciBmaW5kIHNvbHV0aW9ucw0KCUlucHV0IE1vZGVsIE51bWJlcg0KCU91dHB1dDogSVAgQWRkcmVzcw0KPC9zdW1tYXJ5PiovDQogICAgICAgIHZhciBnZXRBZGRyZXNzRE1EID0gZnVuY3Rpb24obW9kZWxudW1iZXIpew0KICAgICAgICAJYWRkcmVzcyA9ICIiOw0KICAgICAgICAJZm9yKGk9MDtpPERNRFByb2RzLmxlbmd0aDtpKyspew0KICAgIAkJCWlmKERNRFByb2RzW2ldLk1vZGVsTnVtYmVyPT1tb2RlbG51bWJlcil7DQogICAgCQkJCWlmKERNRFByb2RzW2ldLklwQWRkcmVzcyE9IiIgJiYgRE1EUHJvZHNbaV0uSXBBZGRyZXNzIT11bmRlZmluZWQpew0KICAgIAkJICAJCSAgaWYoRE1EUHJvZHNbaV0uRGV2aWNlVHlwZT09IlVTQiIpew0KICAgIAkJICAJCQlhZGRyZXNzID0gInVzYjovLyIgKyBETURQcm9kc1tpXS5JcEFkZHJlc3M7DQogICAgCQkgIAkJICB9DQogICAgCQkgIAkJICBlbHNlIGlmKERNRFByb2RzW2ldLkRldmljZVR5cGU9PSIiKXsNCgkJCQkgIAkJCWRldmljZUFkZHJlc3MgPSAiaHR0cDovL2xvY2FsaG9zdCI7DQoJCQkJICAJCX0NCiAgICAJCSAgCQkgIGVsc2V7DQogICAgCQkgIAkJCWFkZHJlc3MgPSAgImh0dHA6Ly8iICsgRE1EUHJvZHNbaV0uSXBBZGRyZXNzOw0KICAgIAkJICAJCSAgfQ0KICAgIAkJCQl9DQogICAgCQkJfQ0KICAgIAkJfQ0KICAgICAgICAJcmV0dXJuIGFkZHJlc3M7DQogICAgICAgIH0NCiAgLyo8c3VtbWFyeT4NCglBZGQgRE1EIFN0ZXBzIHRvIGRhdGEgbGF5ZXINCjwvc3VtbWFyeT4qLw0KICAgICAgICB2YXIgcHVzaFRvR2xvYmFsRGF0YUxheWVyID0gZnVuY3Rpb24oc3RlcCwgRE1EVGVtcGxhdGUsIFNTRkluc3RhbGxlZCwgU1NGVmVyc2lvbiwgcHJvZ3Jlc3MsIGVycm9ycywgcHJvZHVjdHNEZXRlY3RlZCwgcHJvZHVjdExpc3Qpew0KICAgICAgICAJZGF0YUxheWVyT2JqID0gW107DQogICAgICAgIAlkYXRhTGF5ZXJPYmouRE1EUGFnZT1zdGVwOw0KCQkJZGF0YUxheWVyT2JqLkRNRFNvdXJjZT1ETURUZW1wbGF0ZTsNCiAgICAgICAgCWRhdGFMYXllck9iai5ETURTU0ZJbnN0YWxsZWQ9U1NGSW5zdGFsbGVkOw0KICAgICAgICAJZGF0YUxheWVyT2JqLkRNRFNTRlZlcnNpb249U1NGVmVyc2lvbjsNCiAgICAgICAgCWRhdGFMYXllck9iai5ETURQcm9ncmVzcz1wcm9ncmVzczsNCiAgICAgICAgCWRhdGFMYXllck9iai5ETURFcnJvcnM9ZXJyb3JzOw0KICAgICAgICAJZGF0YUxheWVyT2JqLkRNRFByb2R1Y3RzRGV0ZWN0ZWQ9cHJvZHVjdHNEZXRlY3RlZDsNCiAgICAgICAgCWRhdGFMYXllck9iai5ETURQcm9kdWN0TGlzdD1wcm9kdWN0TGlzdDsNCiAgICAgICAgCWdsb2JhbERhdGFMYXllci5ETUQucHVzaChkYXRhTGF5ZXJPYmopOw0KICAgICAgICB9DQoNCg0KLyo8c3VtbWFyeT4NCglNb3ZpbmcgY29kZSBmcm9tIHBvcnRhbCB0byB0aGVtZXMgLSBpc09uUGFnZURpc3BsYXkNCglUbyBnZXQgdGhlIHByb2R1Y3QgaW5mbyBhbmQgdXBkYXRlIHByb2QgaW5mbyBvYmplY3Qgd2l0aCBzdWNjZXNzZnVsIGNhbGwuDQo8L3N1bW1hcnk+Ki8NCmZ1bmN0aW9uIGdldFByb2R1Y3RJbmZvKERNRFByb2QpIHsNCgl2YXIgbmV3T2JqID0gdHJ1ZTsNCglkYXRlT2JqID0gbmV3IERhdGUoKTsNCgl2YXIgZGF0ZSA9IGRhdGVPYmouZ2V0Q2xpZW50RGF0ZVRpbWUoKTsNCgl2YXIgb2Zmc2V0ID0gZ2V0R01UT2Zmc2V0KCk7DQoJdmFyIGNjID0gZ2V0Q0NMQygiY2MiKTsNCgl2YXIgbGMgPSBnZXRDQ0xDKCJsYyIpOw0KCXZhciBtb2RlbE51bSA9IERNRFByb2QuTW9kZWxOdW1iZXIuc3BsaXQoJyMnKTsNCglhZGRyZXNzID0gRE1EUHJvZC5EZXZpY2VUeXBlID09IlVTQiIgPyAidXNiOi8vIiArIERNRFByb2QuSXBBZGRyZXNzOg0KCQkJCQkJCURNRFByb2QuRGV2aWNlVHlwZSA9PSIiID8gImh0dHA6Ly9sb2NhbGhvc3QiIDogImh0dHBzOi8vIiArIERNRFByb2QuSXBBZGRyZXNzOw0KDQoJeGhyID0gJC5hamF4KHsNCgkgICAgdXJsOiB1cmwxLA0KCSAgICB0eXBlOiAnR0VUJywNCgkgICAgZGF0YVR5cGU6ICdqc29uJywNCgkgICAgZGF0YTogeyJwcm9kdWN0TnVtYmVyIjogbW9kZWxOdW1bMF0sICJzZXJpYWxOdW1iZXIiOiBETURQcm9kLlNlcmlhbE51bWJlciwgInByb2R1Y3ROYW1lIjogRE1EUHJvZC5Nb2RlbE5hbWUsICJkYXRlIjogZGF0ZSwgIm9mZnNldCI6IG9mZnNldCwgImNjIjpjYywgImxjIjpsYywgImlwQWRkcmVzcyI6YWRkcmVzcywgInBhZ2VOYW1lIjokKCcjcGFnZUlkZW50aWZpZXInKS52YWwoKSwgInByZWZWYWx1ZSI6cG9ydGxldElEfSwNCgkgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJywNCgkgICAgbWltZVR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJywNCgkgICAgYXN5bmM6IHRydWUsDQoJCSAgYmVmb3JlU2VuZDogZnVuY3Rpb24oIHhociApIHsNCgkJCXhoclBvb2wucHVzaCh4aHIpOw0KDQoJCSAgfSwNCgkgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkgew0KCQkJdmFyIGRldGVjdGluZ0RldmljZUh0bWwgPSAiIjsNCgkJCXBpZHNDb3VudGVyID0gcGlkc0NvdW50ZXItMTsNCgkJCS8vUmVtb3ZlIGludmFsaWQgcHJvZHVjdHMNCgkJCWlmKGRhdGFbMF0uU3VwcG9ydExpbmshPSB1bmRlZmluZWQpew0KCQkJCXByb2RJbmZvLnB1c2goZGF0YSk7DQoJCQkgIAlwcm9kSW5mb1twcm9kSW5mby5sZW5ndGgtMV1bIkRldmljZVR5cGUiXSA9IERNRFByb2QuRGV2aWNlVHlwZTsNCgkJCSAgCXByb2RJbmZvW3Byb2RJbmZvLmxlbmd0aC0xXVsiSXBBZGRyZXNzIl0gPSBETURQcm9kLklwQWRkcmVzczsNCgkJCSAgCWlmKCFpc1N0b3BEZXRlY3Rpb24pIHsNCgkJCQkJZGlzcGxheURldGVjdGVkRGl2aWNlcyhETURQcm9kLkRldmljZVR5cGUsIGdldERldGVjdGVkRGV2aWNlRGlzcGxheU1hcmt1cChwcm9kSW5mb1twcm9kSW5mby5sZW5ndGgtMV1bMF0pKTsNCg0KCQkJCX0NCgkJCX0NCg0KCSAgICB9LA0KCSAgCWVycm9yOmZ1bmN0aW9uKHJlcXVlc3QsIHN0YXR1cywgZXJyb3Ipew0KCQkJY29uc29sZS5sb2coIkVycm9yIitlcnJvcik7DQoJICAJfQ0KCX0pOw0KfQ0KDQovKjxzdW1tYXJ5Pg0KCU1ldGhvZCB0byBjYWxsIGlmIHNvZnR3YXJlIGlzIGFscmVhZHkgaW5zdGFsbGVkDQoJSW5wdXQgUElEUyBKU09ODQoJT3V0cHV0OmRldGVjdGVkIGRldmljZSB0aWxlIG1hcmt1cA0KPC9zdW1tYXJ5PiovDQpmdW5jdGlvbiBnZXREZXRlY3RlZERldmljZURpc3BsYXlNYXJrdXAocHJvZEpzb24pew0KCXZhciBpbWFnZVVybCA9IHByb2RKc29uLkxnSW1nVXJpICE9ICIiID8gcHJvZEpzb24uTGdJbWdVcmkgOiBmYWxsYmFja0ltYWdlOw0KCXZhciBzZWxlY3RJZCA9IHByb2RKc29uLlNlcmlhbE51bWJlciAhPSAiIiA/IHByb2RKc29uLlNlcmlhbE51bWJlciA6IHByb2RKc29uLlByb2R1Y3ROdW1iZXI7DQoJc2VsZWN0SWQgPSAkKCcjJytzZWxlY3RJZCkubGVuZ3RoID4gMCA/IHNlbGVjdElkICsgJCgnIycrc2VsZWN0SWQpLmxlbmd0aCA6IHNlbGVjdElkOw0KCXZhciBsYWJlbElkID0gImxibF8iICsgc2VsZWN0SWQ7DQoNCgl2YXIgcmVzdWx0SHRtbCA9ICc8ZGl2IGNsYXNzPSJjb2wtbGctNiI+JzsNCglyZXN1bHRIdG1sICs9ICc8ZGl2IGNsYXNzPSJwcm9kdWN0LXNlbGVjdGlvbiI+JzsNCglyZXN1bHRIdG1sICs9ICc8ZGl2IGNsYXNzPSJwcm9kdWN0LWltYWdlIGFsaWduLWNlbnRlciI+JzsNCglyZXN1bHRIdG1sICs9ICc8aW1nIGNsYXNzPSJwcm9kdWN0LWluZm8taW1hZ2UiIHNyYz0iJytpbWFnZVVybCsnIiBhbHQ9IicrcHJvZEpzb24uUHJvZHVjdE5hbWUrJyI+JzsNCglyZXN1bHRIdG1sICs9ICc8L2Rpdj4nOw0KCXJlc3VsdEh0bWwgKz0gJzxtYWluPic7DQoJLy9yZXN1bHRIdG1sICs9ICc8YT4nOw0KCXJlc3VsdEh0bWwgKz0gJzxoNCBpZD0iJysgbGFiZWxJZCArJyI+Jytwcm9kSnNvbi5Qcm9kdWN0TmFtZSsnPC9oND4nOw0KCS8vcmVzdWx0SHRtbCArPSAnPC9hPic7DQoJcmVzdWx0SHRtbCArPSAnPGRpdiBjbGFzcz0ia2V5LXZhbHVlLWNvbnRhaW5lciI+JzsNCglpZihwcm9kSnNvbi5Qcm9kdWN0TnVtYmVyICE9ICIiKQ0KCQlyZXN1bHRIdG1sICs9ICc8cCBjbGFzcz0ia2V5LXZhbHVlIj48bGFiZWw+JysgbGJsTW9kZWxOdW1iZXIgKycgPC9sYWJlbD48c3BhbiBjbGFzcz0idmFsdWUiPicrcHJvZEpzb24uUHJvZHVjdE51bWJlcisnPC9zcGFuPjwvcD4nOw0KCWVsc2UNCgkJcmVzdWx0SHRtbCArPSAnPHAgY2xhc3M9ImtleS12YWx1ZSIgc3R5bGU9InZpc2liaWxpdHk6IGhpZGRlbjsiPjxsYWJlbD4nKyBsYmxNb2RlbE51bWJlciArJyA8L2xhYmVsPjxzcGFuIGNsYXNzPSJ2YWx1ZSI+Jytwcm9kSnNvbi5Qcm9kdWN0TnVtYmVyKyc8L3NwYW4+PC9wPic7DQoJaWYocHJvZEpzb24uU2VyaWFsTnVtYmVyICE9ICIiKQ0KCQlyZXN1bHRIdG1sICs9ICc8cCBjbGFzcz0ia2V5LXZhbHVlIj48bGFiZWw+JysgbGJsU2VyaWFsTnVtYmVyICsnIDwvbGFiZWw+PHNwYW4gY2xhc3M9InZhbHVlIj4nK3Byb2RKc29uLlNlcmlhbE51bWJlcisnPC9zcGFuPjwvcD4nOw0KCWVsc2UNCgkJcmVzdWx0SHRtbCArPSAnPHAgY2xhc3M9ImtleS12YWx1ZSIgc3R5bGU9InZpc2liaWxpdHk6IGhpZGRlbjsiPjxsYWJlbD4nKyBsYmxTZXJpYWxOdW1iZXIgKycgPC9sYWJlbD48c3BhbiBjbGFzcz0idmFsdWUiPicrcHJvZEpzb24uU2VyaWFsTnVtYmVyKyc8L3NwYW4+PC9wPic7DQoJcmVzdWx0SHRtbCArPSAnPC9kaXY+JzsNCglyZXN1bHRIdG1sICs9ICc8ZGl2IGNsYXNzPSJidXR0b24tY29udGFpbmVyIj4nOw0KCWlmKCQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpPT0gIlN1cHBvcnQgSG9tZSIpew0KDQoJIHJlc3VsdEh0bWwgKz0gJzxhIGlkPSInK3NlbGVjdElkKyciIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKTsiIGNsYXNzPSJBcnJheSBidXR0b24gYnV0dG9uLXNtIHByaW1hcnkiIG9uY2xpY2s9ImdldFNvbHV0aW9uc0RNRChcJycrcHJvZEpzb24uUHJvZHVjdE51bWJlcisnXCcsXCcnK3Byb2RKc29uLlN1cHBvcnRMaW5rLlVyaSsnXCcpOyIgYXJpYS1kZXNjcmliZWRieT0iJysgbGFiZWxJZCArJyIgcm9sZT0iYnV0dG9uIj4nK3NlbGVjdExhYmVsT25QYWdlKyc8L2E+JzsNCg0KCX0NCgllbHNlew0KCSAgcmVzdWx0SHRtbCArPSAnPGEgaWQ9Iicrc2VsZWN0SWQrJyIgcGlkc1ZhbHVlPVwnJytKU09OLnN0cmluZ2lmeShwcm9kSnNvbikucmVwbGFjZSgvJy9nLCAnJiMzOTsnKSsnXCcgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApOyIgY2xhc3M9IkFycmF5IGJ1dHRvbiBidXR0b24tc20gcHJpbWFyeSIgb25jbGljaz0iaGFuZGxlU2VsZWN0U3VibWl0KCQodGhpcykpOyIgYXJpYS1kZXNjcmliZWRieT0iJysgbGFiZWxJZCArJyIgcm9sZT0iYnV0dG9uIj4nK3NlbGVjdExhYmVsT25QYWdlKyc8L2E+JzsNCg0KCX0NCg0KDQoNCglyZXN1bHRIdG1sICs9ICc8L2Rpdj4nOw0KCXJlc3VsdEh0bWwgKz0gJzwvbWFpbj4nOw0KCXJlc3VsdEh0bWwgKz0gJzwvZGl2Pic7DQoJcmVzdWx0SHRtbCArPSAnPC9kaXY+JzsNCg0KCXJldHVybiByZXN1bHRIdG1sOw0KfQ0KDQovL0NhbGwgSU9HIGJlZm9yZSBzdWJtaXNzaW9uIG9mIENIRUNLIE5PVw0KZnVuY3Rpb24gY2FsbElPR0JlZm9yZVJlZGlyZWN0KHBpZHNWYWx1ZSl7DQoJJC5lYWNoKHByb2RJbmZvLCBmdW5jdGlvbihpbmRleCwgdmFsKXsNCgkJaWYodmFsWzBdLlNlcmlhbE51bWJlciA9PSBwaWRzVmFsdWUuU2VyaWFsTnVtYmVyKXsNCgkJZGl2aWNlVHlwZSA9dmFsLkRldmljZVR5cGU7DQoJICAJCWlmKGRpdmljZVR5cGU9PSJVU0IiKXsNCgkgIAkJCWFkZHJlc3MgPSAidXNiOi8vIiArIHZhbC5JcEFkZHJlc3M7DQoJICAJCX0NCgkgIAkJZWxzZSBpZihkaXZpY2VUeXBlID09ICIiKXsNCgkgIAkJICAJYWRkcmVzcyA9ICJodHRwczovL2xvY2FsaG9zdCI7DQoJICAJCX0NCgkgIAkJZWxzZXsNCiAgCQkJCWFkZHJlc3MgPSAgImh0dHBzOi8vIiArIHZhbC5JcEFkZHJlc3M7DQoJICAJCX0NCgkJfQ0KCX0pOw0KCXByb2R1Y3RMaW5lID0gcGlkc1ZhbHVlLlByb2R1Y3RMaW5lQ29kZTsNCglwcm9kdWN0TmFtZU9pZDEgPSBwaWRzVmFsdWUuUHJvZHVjdE5hbWVPaWQ7DQoJcHJvZHVjdE51bWJlciA9IHBpZHNWYWx1ZS5Qcm9kdWN0TnVtYmVyOw0KCXByb2R1Y3ROYW1lID0gcGlkc1ZhbHVlLlByb2R1Y3ROYW1lOw0KDQoJZmluZElPRygpOw0KfQ0KDQoNCi8qPHN1bW1hcnk+DQoJSGFuZGxlIHNlbGVjdCBidXR0b24gY2xpY2soZm9ybSBzdWJtaXQpDQo8L3N1bW1hcnk+Ki8NCmZ1bmN0aW9uIGhhbmRsZVNlbGVjdFN1Ym1pdChwaWRzU2VsZWN0QnV0dG9uKXsNCg0KCWlmKCQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpLnRvTG93ZXJDYXNlKCkgPT0gJ3N3ZHNlbGZzZXJ2aWNlJyl7DQoJCXZhciBwaWRzRGF0YSA9ICQucGFyc2VKU09OKHBpZHNTZWxlY3RCdXR0b24uYXR0cigncGlkc3ZhbHVlJykpOw0KCQlpZigkLmluQXJyYXkocGlkc0RhdGEuUHJvZHVjdExpbmVDb2RlLCBzb2x1dGlvblN1cHBvcnRlZFBsKSAhPSAtMSAmJiAkLmluQXJyYXkocGlkc0RhdGEuUHJvZHVjdExpbmVDb2RlLCBzb2x1dGlvblN1cHBvcnRlZFBjUGwpID09IC0xKQ0KCQl7DQoJCQkkLmVhY2gocHJvZEluZm8sIGZ1bmN0aW9uKGluZGV4LCB2YWwpew0KCQkJCWlmKHZhbFswXS5TZXJpYWxOdW1iZXIgPT0gcGlkc0RhdGEuU2VyaWFsTnVtYmVyKXsNCgkJCSAgCQlhZGRyZXNzID0gInVzYjovLyIgKyB2YWwuSXBBZGRyZXNzOw0KCQkJCX0NCgkJCX0pOw0KCQkJcHJvZHVjdExpbmUgPSBwaWRzRGF0YS5Qcm9kdWN0TGluZUNvZGU7DQoJCQlwcm9kdWN0TmFtZU9pZDEgPSBwaWRzRGF0YS5Qcm9kdWN0TmFtZU9pZDsNCgkJCXByb2R1Y3ROdW1iZXIgPSBwaWRzRGF0YS5Qcm9kdWN0TnVtYmVyOw0KCQkJcHJvZHVjdE5hbWUgPSBwaWRzRGF0YS5Qcm9kdWN0TmFtZTsNCg0KCQkJZmluZElPRygpOw0KCQl9DQoJfQ0KDQoJaWYoJCgnI3BhZ2VJZGVudGlmaWVyJykudmFsKCkudG9Mb3dlckNhc2UoKSA9PSAic3dkc2VsZnNlcnZpY2VzdGVwIil7DQoJCSQoJy5ocC1sb2FkaW5nLXJlc3VsdHMnKS5zaG93KCk7DQoJCSQoJyNzd2RMb2FkaW5nRGl2JykuY3NzKCd2aXNpYmlsaXR5JywnaGlkZGVuJyk7DQoNCgkJLy9DYWxsIElPRyBiZWZvcmUgcmVkaXJlY3Rpb24NCgkJdmFyIHNrdVZhbHVlID0gcGlkc1NlbGVjdEJ1dHRvbjsNCg0KCQlpZihza3VWYWx1ZSAhPSB1bmRlZmluZWQgJiYgdHlwZW9mIHNrdVZhbHVlICE9ICJzdHJpbmciKXsNCg0KCQkJaWYoc2t1VmFsdWVbMF0gIT0gdW5kZWZpbmVkKQ0KCQkJew0KCQkJCXNrdVZhbHVlID0gc2t1VmFsdWVbMF07DQoJCQl9DQoJCQl2YXIgcGlkc1ZhbHVlID0gJC5wYXJzZUpTT04oJChza3VWYWx1ZSkubmV4dCgpWzBdLnZhbHVlKTsNCgkJCWNhbGxJT0dCZWZvcmVSZWRpcmVjdChwaWRzVmFsdWUpOw0KCQl9DQoJfQ0KCS8vSWYgYWpheCBjYWxsIGlzIGFscmVhZHkgbWFkZSBhbmQgcHJvZHVjdCBpcyBpbmFjdGl2ZSwgZGlyZWN0bHkgc2hvdyB0aGUgb3ZlcmxheS4NCgllbHNlIGlmKHBpZHNTZWxlY3RCdXR0b24uYXR0cignaXNBY3RpdmUnKSAhPSB1bmRlZmluZWQgJiYgcGlkc1NlbGVjdEJ1dHRvbi5hdHRyKCdpc0FjdGl2ZScpLnRvTG93ZXJDYXNlKCkgPT0gIm5vIil7DQogIAkJJCgnI2hpc3RvcmljYWxJbmZvTW9kYWwnKS5tb2RhbCgnc2hvdycpOw0KICAJCXJldHVybjsNCgl9DQoJZWxzZXsNCgkgIAkkKCcjbWRsU3Bpbm5lcicpLm1vZGFsKCdzaG93Jyk7DQoJIAkkKCcuc3BpbmVyUGxhY2VtZW50JykuY3NzKCdtYXJnaW4tdG9wJywkKHdpbmRvdykuaGVpZ2h0KCkvMiAtIDMwKTsNCgl9DQoNCgl2YXIgcGlkc1ZhbHVlID0gJCgnI3BhZ2VJZGVudGlmaWVyJykudmFsKCkudG9Mb3dlckNhc2UoKSA9PSAic3dkc2VsZnNlcnZpY2VzdGVwIiA/IHBpZHNTZWxlY3RCdXR0b24ubmV4dCgpLnZhbCgpIDogcGlkc1NlbGVjdEJ1dHRvbi5hdHRyKCdwaWRzVmFsdWUnKTsNCgl2YXIgZGF0YSA9IHsNCgkJCSdzZWxlY3RlZFByb2R1Y3RDYyc6IGdldENDTEMoJ2NjJyksDQoJCQknc2VsZWN0ZWRQcm9kdWN0TGMnOiBnZXRDQ0xDKCdsYycpLA0KCQkJJ3NlbGVjdGVkUHJvZHVjdFBpZHMnOiBwaWRzVmFsdWUNCgkJfTsNCg0KCSQuYWpheCh7DQoJCWRhdGE6IGRhdGEsDQogICAgICAgIHVybDogaGlzdG9yaWNhbEFqYXhVcmwsDQogICAgICAgIHR5cGU6ICdQT1NUJywNCiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2Upew0KICAgICAgICAJdmFyIHJlc3BvbnNlSnNvbiA9IHJlc3BvbnNlOw0KICAgICAgICAJaWYocmVzcG9uc2VKc29uLmFjdGl2ZSA9PSAieWVzIikNCiAgICAgICAgCQl3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJlc3BvbnNlSnNvbi51cmw7DQogICAgICAgIAllbHNlew0KICAgICAgICAJCWlmKCQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpLnRvTG93ZXJDYXNlKCkgPT0gInN3ZHNlbGZzZXJ2aWNlc3RlcCIpew0KICAgICAgICAJCQkkKCcuaHAtbG9hZGluZy1yZXN1bHRzJykuaGlkZSgpOw0KICAgICAgICAJCQkkKCcjaGlzdG9yaWNhbEluZm9Nb2RhbCcpLm1vZGFsKCdzaG93Jyk7DQogICAgICAgIAkJfQ0KICAgICAgICAJCWVsc2V7DQoJICAgICAgICAJCSQoJy5tb2RhbCcpLm1vZGFsKCdoaWRlJyk7DQoJCQkJICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQoJCQkJICAgICAgJCgnI2hpc3RvcmljYWxJbmZvTW9kYWwnKS5tb2RhbCgnc2hvdycpOw0KCQkJCSAgICB9LDEzMDApOw0KCQkJCX0NCiAgICAgICAgCQlwaWRzU2VsZWN0QnV0dG9uLmF0dHIoJ2lzQWN0aXZlJywgcmVzcG9uc2VKc29uLmFjdGl2ZSk7DQoNCiAgICAgICAgCQl2YXIgdXJsVG9IaXN0b3JpY2FsUmVkaXJlY3QgPSAnLycrZ2V0Q0NMQygnY2MnKSsnLScrZ2V0Q0NMQygnbGMnKStoaXN0b3JpY2FsUGFnZUJhc2VVcmw7DQogIAkJCQkkKCcjaGlzdG9yaWNQcm9kdWN0c1BhZ2UnKS5hdHRyKCdocmVmJywgdXJsVG9IaXN0b3JpY2FsUmVkaXJlY3QpOw0KICAgICAgICAJfQ0KICAgICAgICB9LA0KICAgICAgICBlcnJvcjogZnVuY3Rpb24oeGhyLCBhamF4T3B0aW9ucywgdGhyb3duRXJyb3Ipew0KICAgICAgICAJY29uc29sZS5sb2coJ2Vycm9yID0gJyt0aHJvd25FcnJvcik7DQogICAgICAgIAkkKCcubW9kYWwnKS5tb2RhbCgnaGlkZScpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoNCi8qPHN1bW1hcnk+DQoJRGlzcGxheSBkZXRlY3RlZCBhbmQgbWFya3VwIGZyYW1lZCBkZXZpY2VzIGluIHJlc3BlY3RpdmUgc2VjdGlvbiBhbmQgYWxzbyB1cGRhdGUgdGhlIGNvdW50IG9mIG51bWJlciBvZiBkZXZpY2VzIGRldGVjdGVkIGluIHRoYXQgc2VjdGlvbi4NCjwvc3VtbWFyeT4qLw0KZnVuY3Rpb24gZGlzcGxheURldGVjdGVkRGl2aWNlcyhkZXZpY2VDb25uZWN0aXZpdHksIHByb2RNYXJrdXApew0KDQoJaWYgKCFydW5JbkJhY2tncm91bmQpIHsNCgkJJCgnI3BubFJldHJ5T3JTZWFyY2hCeVBGaW5kZXInKS5zaG93KCk7DQoJfQ0KCWhpZGVDYXRlZ29yaWVzKCk7DQoJaWYoZGV2aWNlQ29ubmVjdGl2aXR5ID09ICJQQyIpIHsNCgkJLypMb2NhbCovDQoJCSQoIiNwbmxGb3VuZFByb2RzRGlzcGxheSIpLmFwcGVuZChwcm9kTWFya3VwKTsNCgkJdmFyIGRldmljZUNvdW50ID0gJCgnI3BubEZvdW5kUHJvZHNEaXNwbGF5Pi5jb2wtbGctNicpLmxlbmd0aDsNCgkJJCgnI2ZvdW5kLWNvdW50JykuaHRtbCgnKCcrZGV2aWNlQ291bnQrJyknKTsNCgl9DQoJZWxzZSBpZihkZXZpY2VDb25uZWN0aXZpdHkgPT0gIk5ldHdvcmsiKSB7DQoJCS8qTmV0d29yayovDQoJCSQoIiNwbmxOZXR3b3JrUHJvZHNEaXNwbGF5IikuYXBwZW5kKHByb2RNYXJrdXApOw0KCQl2YXIgZGV2aWNlQ291bnQgPSAkKCcjcG5sTmV0d29ya1Byb2RzRGlzcGxheT4uY29sLWxnLTYnKS5sZW5ndGg7DQoJCSQoJyNuZXR3b3JrLWNvdW50JykuaHRtbCgnKCcrZGV2aWNlQ291bnQrJyknKTsNCgl9DQoJZWxzZSBpZihkZXZpY2VDb25uZWN0aXZpdHkgPT0gIlVTQiIpIHsNCgkJLypVU0IqLw0KCQkkKCIjcG5sQ29ubmVjdGVkUHJvZHNEaXNwbGF5IikuYXBwZW5kKHByb2RNYXJrdXApOw0KCQl2YXIgZGV2aWNlQ291bnQgPSAkKCcjcG5sQ29ubmVjdGVkUHJvZHNEaXNwbGF5Pi5jb2wtbGctNicpLmxlbmd0aDsNCgkJJCgnI2Nvbm5lY3RlZC1jb3VudCcpLmh0bWwoJygnK2RldmljZUNvdW50KycpJyk7DQoJfQ0KDQoJZWxzZSBpZihkZXZpY2VDb25uZWN0aXZpdHkgPT0gIlVua25vd24iKSB7DQoJCS8qVW5rbm93biovDQoJCS8vJCgiI1VTQkRldmljZXNXcmFwcGVyIikuc2hvdygpOw0KCQkvLyQoIiNVU0JEZXZpY2VzIikuYXBwZW5kKGRldGVjdGluZ0RldmljZUh0bWwpOw0KCX0NCgkkKCcjcG5sVW5zb3J0ZWRQcm9kc0Rpc3BsYXknKS5odG1sKCQoJyNwbmxVbnNvcnRlZFByb2RzRGlzcGxheScpLmh0bWwoKStwcm9kTWFya3VwKTsNCglpZiAoIXJ1bkluQmFja2dyb3VuZCkgew0KCQkkKCcjcG5sVW5zb3J0ZWRGb3VuZFByb2RzJykuc2hvdygpOw0KCQkkKCcjaWRlbnRpZnktdGV4dDMnKS5zaG93KCk7DQogICAgICAgICQoJy5wcm9kdWN0LXNlbGVjdGlvbiBoNCcpLm1hdGNoSGVpZ2h0KCk7DQoJfQ0KDQoNCgloaWRlQ2F0ZWdvcmllcygpOw0KfQ0KDQovKjxzdW1tYXJ5Pg0KCUhpZGUgdGhlIGNhdGVnb3JpZXMgZHVyaW5nIGRldGVjdGlvbg0KPC9zdW1tYXJ5PiovDQpmdW5jdGlvbiBoaWRlQ2F0ZWdvcmllcygpew0KCSQoIiNwbmxGb3VuZFByb2RzIikuaGlkZSgpOw0KCSQoIiNwbmxOZXR3b3JrUHJvZHMiKS5oaWRlKCk7DQoJJCgiI3BubENvbm5lY3RlZFByb2RzIikuaGlkZSgpOw0KfQ0KDQovKjxzdW1tYXJ5Pg0KCURpc3BsYXkgZGV0ZWN0ZWQgZGV2aWNlcyBpbiBjYXRlZ29yaWVzIGFmdGVyIDEwMCUgY29tcGxldGlvbiBvZiBkZXRlY3Rpb24gcHJvY2Vzcw0KPC9zdW1tYXJ5PiovDQpmdW5jdGlvbiBzaG93Q2F0ZWdvcml6ZWREZXZpY2VzKCl7DQoJaWYgKChwcm9ncmVzc1BlcmNlbnQgPj0gMTAwKSAmJiBwcm9ncmVzc0ZsYWcpew0KCQlydW5JbkJhY2tncm91bmQgPSBmYWxzZTsNCnZhciBoZWlnaHRzID0gJCgiLnByb2R1Y3Qtc2VsZWN0aW9uIGg0IikubWFwKGZ1bmN0aW9uICgpDQoJCQkJew0KCQkJCQkJcmV0dXJuICQodGhpcykuaGVpZ2h0KCk7DQoJCQkJfSkuZ2V0KCksDQoNCgkJCQkJbWF4SGVpZ2h0ID0gTWF0aC5tYXguYXBwbHkobnVsbCwgaGVpZ2h0cyk7DQoJCQkJCSQoIi5wcm9kdWN0LXNlbGVjdGlvbiBoNCIpLmhlaWdodChtYXhIZWlnaHQpOw0KCX0NCgkkKCcjcG5sVW5zb3J0ZWRQcm9kc0Rpc3BsYXknKS5lbXB0eSgpOw0KCSQoJyNwbmxVbnNvcnRlZEZvdW5kUHJvZHMnKS5oaWRlKCk7DQoNCglpZigkKCIjcG5sRm91bmRQcm9kc0Rpc3BsYXkiKS5jaGlsZHJlbigpLmxlbmd0aCA+IDAgJiYgIXJ1bkluQmFja2dyb3VuZCl7DQoJCSQoIiNwbmxGb3VuZFByb2RzIikuc2hvdygpOw0KCX0NCglpZigkKCIjcG5sTmV0d29ya1Byb2RzRGlzcGxheSIpLmNoaWxkcmVuKCkubGVuZ3RoID4gMCAmJiAhcnVuSW5CYWNrZ3JvdW5kKXsNCgkJJCgiI3BubE5ldHdvcmtQcm9kcyIpLnNob3coKTsNCgl9DQoJaWYoJCgiI3BubENvbm5lY3RlZFByb2RzRGlzcGxheSIpLmNoaWxkcmVuKCkubGVuZ3RoID4gMCAmJiAhcnVuSW5CYWNrZ3JvdW5kKXsNCgkJJCgiI3BubENvbm5lY3RlZFByb2RzIikuc2hvdygpOw0KCX0NCg0KCWlmICgoIXJ1bkluQmFja2dyb3VuZCkgJiYoJCgnI3BhZ2VJZGVudGlmaWVyJykudmFsKCkgIT09ICJTdXBwb3J0IEhvbWUiKSkgew0KCQkkKCcjcG5sUmV0cnknKS5zaG93KCk7DQogICAgICAgICQoJyNzdGVwLTMnKS5zaG93KCk7DQoJCSQoJyNpZGVudGlmeS10ZXh0MycpLmhpZGUoKTsNCgkJJCgnI2lkZW50aWZ5LXRleHQ0Jykuc2hvdygpOw0KCX0gZWxzZSBpZigoIXJ1bkluQmFja2dyb3VuZCkgJiYoJCgnI3BhZ2VJZGVudGlmaWVyJykudmFsKCkgPT0gIlN1cHBvcnQgSG9tZSIpKXsNCgkgICAkKCcjcG5sUmV0cnknKS5zaG93KCk7DQogICAgICAgICQoJyNzdGVwLTMnKS5zaG93KCk7DQoJCSQoJyNpZGVudGlmeS10ZXh0MycpLmhpZGUoKTsNCgkJJCgnI2lkZW50aWZ5LXRleHQ0Jykuc2hvdygpOw0KDQoJfWVsc2V7DQoJCSQoJyNzdGVwLTMnKS5oaWRlKCk7DQoJfQ0KDQp9DQoNCi8qPHN1bW1hcnk+DQoJU2hvdyBEZXRlY3RlZCBEZXZpY2VzIGluIFVJDQo8L3N1bW1hcnk+Ki8NCnZhciBoYW5kbGVPblBhZ2VEZXRlY3RlZFByb2R1Y3RzID0gZnVuY3Rpb24gKHByb2R1Y3RzKXsNCg0KCWlmKHByb2R1Y3RzLmxlbmd0aCA9PSAwKXsNCg0KDQoJCSAJJCgnLm1vZGFsQ29tbW9uQ2xhc3MnKS5oaWRlKCk7DQoJCQlpZiAoKHByb2dyZXNzRmxhZykgJiYoJCgnI3BhZ2VJZGVudGlmaWVyJykudmFsKCkgPT0gIlN1cHBvcnQgSG9tZSIpKXsNCgkJCSAgICQoJyNkbWRSZXRyeVZpZXcnKS5yZW1vdmVDbGFzcygiaGlkZSIpOw0KCQkJCSQoJyNub0ZvdW5kUHJvZHVjdHMnKS5zaG93KCk7DQoJCQkJJCgnI25vRm91bmRQcm9kdWN0cycpLmFwcGVuZFRvKCQoJy5ETURuZXcnKSk7DQoJCQkJcHVzaFRvR2xvYmFsRGF0YUxheWVyKCJObyBwcm9kdWN0cyBmb3VuZCIsZ2xvYmFsRGF0YUxheWVyLlRlbXBsYXRlLCAidHJ1ZSIsIE1TSVZlcnNpb24sICcnLCAnJywgJycsICcnKTsNCg0KDQoJCQl9DQoJCQlpZiAoKCFydW5JbkJhY2tncm91bmQpICYmKCQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpID09ICJTdXBwb3J0IEhvbWUiKSl7DQoJCQkgICAgJCgnI2RtZFJldHJ5VmlldycpLnJlbW92ZUNsYXNzKCJoaWRlIik7DQoJCQkJJCgnI25vRm91bmRQcm9kdWN0cycpLnNob3coKTsNCgkJCQkkKCcjbm9Gb3VuZFByb2R1Y3RzJykuYXBwZW5kVG8oJCgnLkRNRG5ldycpKTsNCgkJCQlwdXNoVG9HbG9iYWxEYXRhTGF5ZXIoIk5vIHByb2R1Y3RzIGZvdW5kIixnbG9iYWxEYXRhTGF5ZXIuVGVtcGxhdGUsICJ0cnVlIiwgTVNJVmVyc2lvbiwgJycsICcnLCAnJywgJycpOw0KDQoJCQl9DQoJCQlpZigkKCcjcGFnZUlkZW50aWZpZXInKS52YWwoKSAhPSAiU3VwcG9ydCBIb21lIil7DQoNCgkJCSAgICQoJyNub09uUGFnZURldmljZXNGb3VuZCcpLnNob3coKTsNCgkJCSAgIHB1c2hUb0dsb2JhbERhdGFMYXllcigiTm8gcHJvZHVjdHMgZm91bmQiLGdsb2JhbERhdGFMYXllci5UZW1wbGF0ZSwgInRydWUiLCBNU0lWZXJzaW9uLCAnJywgJycsICcnLCAnJyk7DQoJCQkgfQ0KDQoJCQlpZigkKCcjcGFnZUlkZW50aWZpZXInKS52YWwoKSE9PSAiU3VwcG9ydCBIb21lIil7DQoJCQkJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsJ1NXRERNRFVuYWJsZXRvZmluZCcpOw0KCQkJICAgICQod2luZG93KS50cmlnZ2VyKCdUZW1wbGF0ZScseyB0ZW1wbGF0ZSA6ICdTV0RETURVbmFibGV0b2ZpbmQnIH0pOw0KCQkJfQ0KDQoNCgkJfQ0KCWVsc2V7DQoNCg0KDQoJCQljbGVhckRpdnNPbkxvYWQoKTsNCgkJCSQoJyNwbmxSZXRyeU9yU2VhcmNoQnlQRmluZGVyJykuc2hvdygpOw0KCQkJJCgnI3BubFVuc29ydGVkRm91bmRQcm9kcycpLmhpZGUoKTsNCg0KCQkJc2hvd0NhdGVnb3JpemVkRGV2aWNlcygpOw0KCQkJaWYgKCQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpIT0gIlN1cHBvcnQgSG9tZSIpew0KCQkJICAkKCcjZGV0ZWN0aW9uSGVhZGVyJykuaHRtbChpZGVudGlmaWVkTGFiZWwpOw0KCQkJfQ0KCQkJZWxzZXsNCgkJCSAgICQoJyNkZXRlY3Rpb25IZWFkZXInKS5odG1sKGhvbWVJZGVudGlmaWVkTGFiZWwpOw0KCQkJfQ0KDQoJCQlpZigoIXJ1bkluQmFja2dyb3VuZCkgJiYgKCQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpPT0gIlN1cHBvcnQgSG9tZSIpKXsNCgkJCSAkKCcjc3RlcC0zJykuc2hvdygpOw0KCQkgICAgIH0NCgkJCWlmKCQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpIT09ICJTdXBwb3J0IEhvbWUiKXsNCg0KDQoNCgkJCQlnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywnU1dERE1ERGV0ZWN0aW9uQ29tcGxldGVkJyk7DQoJCQkJJCh3aW5kb3cpLnRyaWdnZXIoJ1RlbXBsYXRlJyx7IHRlbXBsYXRlIDogJ1NXRERNRERldGVjdGlvbkNvbXBsZXRlZCcgfSk7DQoNCgkJCSAgICB2YXIgaGVpZ2h0cyA9ICQoIi5wcm9kdWN0LXNlbGVjdGlvbiBoNCIpLm1hcChmdW5jdGlvbiAoKQ0KCQkJCXsNCgkJCQkJCXJldHVybiAkKHRoaXMpLmhlaWdodCgpOw0KCQkJCX0pLmdldCgpLA0KDQoJCQkJCW1heEhlaWdodCA9IE1hdGgubWF4LmFwcGx5KG51bGwsIGhlaWdodHMpOw0KCQkJCQkkKCIucHJvZHVjdC1zZWxlY3Rpb24gaDQiKS5oZWlnaHQobWF4SGVpZ2h0KTsNCg0KDQoJCQl9DQoJfQ0KDQp9DQoNCg0KLyo8c3VtbWFyeT4NCglDbGVhciBwcmV2aW91cyByZXN1bHRzIGFuZCByZXNldA0KPC9zdW1tYXJ5PiovDQogZnVuY3Rpb24gY2xlYXJETUREaXZzKCl7DQoJaWYgKCFydW5JbkJhY2tncm91bmQpIHsNCgkJJCgiI3BubEZvdW5kUHJvZHNEaXNwbGF5IikuZW1wdHkoKTsNCgkJJCgiI3BubE5ldHdvcmtQcm9kc0Rpc3BsYXkiKS5lbXB0eSgpOw0KCQkkKCIjcG5sQ29ubmVjdGVkUHJvZHNEaXNwbGF5IikuZW1wdHkoKTsNCgkJJCgnI3BubFVuc29ydGVkUHJvZHNEaXNwbGF5JykuZW1wdHkoKTsNCgl9DQoNCgkkKCIjcG5sRm91bmRQcm9kcyIpLmhpZGUoKTsNCgkkKCIjcG5sTmV0d29ya1Byb2RzIikuaGlkZSgpOw0KCSQoIiNwbmxDb25uZWN0ZWRQcm9kcyIpLmhpZGUoKTsNCgkkKCcjcG5sVW5zb3J0ZWRGb3VuZFByb2RzJykuaGlkZSgpOw0KDQoJJCgnI25vT25QYWdlRGV2aWNlc0ZvdW5kJykuaGlkZSgpOw0KCSQoJyNwbmxSZXRyeU9yU2VhcmNoQnlQRmluZGVyJykuaGlkZSgpOw0KCSQoJyNwbmxSZXRyeScpLmhpZGUoKTsNCg0KDQoJJCgnI2lkZW50aWZ5LXRleHQzJykuaGlkZSgpOw0KCSQoJyNpZGVudGlmeS10ZXh0NCcpLmhpZGUoKTsNCg0KDQoJJCgnI2RtZFJldHJ5VmlldycpLmFkZENsYXNzKCJoaWRlIik7DQoJJCgnI2RldGVjdGlvbkhlYWRlcicpLmh0bWwoaWRlbnRpZnlpbmdMYWJlbCk7DQoJaXNTdG9wRGV0ZWN0aW9uID0gZmFsc2U7DQp9DQoNCg0KLyo8c3VtbWFyeT4NCglQb3B1bGF0ZSB3YXJyYW50eSBmb3JtIGFuZCBzdWJtaXQgZm9yIHdhcnJhbnR5IGNoZWNrLg0KPC9zdW1tYXJ5PiovDQpmdW5jdGlvbiBjaGVja0ZvcldhcnJhbnR5KHNlbGVjdEJ1dHRvbil7DQoJaWYoJCgnI3BhZ2VJZGVudGlmaWVyJykudmFsKCkudG9Mb3dlckNhc2UoKSA9PSAidW5rbm93biB3YXJyYW50eSIpew0KCQkkKCcjd2FycmFudHlQaWRzUmVzcG9uc2UnKS52YWwoJChzZWxlY3RCdXR0b24pLm5leHQoKS52YWwoKSk7DQoJCSQoJyNmcm1XYXJyYW50eScpLnRyaWdnZXIoJ3N1Ym1pdCcpOw0KCX0NCgllbHNlew0KCQl2YXIgd2FycmFudHlEZXZpY2UgPSAkLnBhcnNlSlNPTigkKHNlbGVjdEJ1dHRvbikubmV4dCgpLnZhbCgpKTsNCg0KCQlpZigkLmluQXJyYXkod2FycmFudHlEZXZpY2UuUHJvZHVjdExpbmVDb2RlLCBzb2x1dGlvblN1cHBvcnRlZFBsKSAhPSAtMSAmJiAkLmluQXJyYXkod2FycmFudHlEZXZpY2UuUHJvZHVjdExpbmVDb2RlLCBzb2x1dGlvblN1cHBvcnRlZFBjUGwpID09IC0xKXsNCgkJCWNhbGxJT0dCZWZvcmVSZWRpcmVjdCh3YXJyYW50eURldmljZSk7DQoJCX0NCg0KCQkkKCcjd2FycmFudHlDQycpLnZhbChnZXRDQ0xDKCdjYycpKTsNCgkJJCgnI3dhcnJhbnR5TEMnKS52YWwoZ2V0Q0NMQygnbGMnKSk7DQoJCSQoJyN3YXJyYW50eVNlcmlhbE51bWJlcicpLnZhbCh3YXJyYW50eURldmljZS5TZXJpYWxOdW1iZXIpOw0KCQkkKCcjd2FycmFudHlQcm9kdWN0TnVtYmVyJykudmFsKHdhcnJhbnR5RGV2aWNlLlByb2R1Y3ROdW1iZXIpOw0KCQkkKCcjd2FycmFudHlQaWRzUmVzcG9uc2UnKS52YWwoJChzZWxlY3RCdXR0b24pLm5leHQoKS52YWwoKSk7DQoJCSQoJyNmcm1XYXJyYW50eScpLnRyaWdnZXIoJ3N1Ym1pdCcpOw0KCX0NCn0NCg0KLyo8c3VtbWFyeT4NCglGdW5jdGlvbiB0byBjaGVjayBQcmUtMjAwNSBhbmQgcG9wIG92ZXJsYXkgaWYgYWpheCByZXR1cm5zICJubyINCjwvc3VtbWFyeT4qLw0KZnVuY3Rpb24gY2hlY2tGb3JIaXN0b3JpY1Byb2R1Y3QodXJsKXsNCgl2YXIgc2VsZWN0aW9uQnV0dG9uID0gJCgnIycrZG1kU2VsZWN0QnV0dG9uSWQpOw0KCWlmKGRtZFNlbGVjdEJ1dHRvbklkICE9ICIiICYmIHNlbGVjdGlvbkJ1dHRvbi5hdHRyKCdpc0FjdGl2ZScpICE9IHVuZGVmaW5lZCAmJiBzZWxlY3Rpb25CdXR0b24uYXR0cignaXNBY3RpdmUnKS50b0xvd2VyQ2FzZSgpID09ICJubyIpew0KCQkkKCcubW9kYWwnKS5tb2RhbCgnaGlkZScpOw0KCSAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpew0KCSAgICAgICQoJyNoaXN0b3JpY2FsSW5mb01vZGFsJykubW9kYWwoJ3Nob3cnKTsNCgkgICAgfSwxMzAwKTsNCiAgCQlyZXR1cm47DQoJfQ0KCXZhciBkYXRhID0gew0KCQkJJ2NjJzogZ2V0Q0NMQygnY2MnKSwNCgkJCSdsYyc6IGdldENDTEMoJ2xjJyksDQoJCQkncHJvZHVjdE5hbWVPaWQnOiBwcm9kdWN0TmFtZU9pZA0KCQl9Ow0KDQoJJC5hamF4KHsNCgkJZGF0YTogZGF0YSwNCiAgICAgICAgdXJsOiBhY3RpdmVGbGFnQWpheFVybCwNCiAgICAgICAgdHlwZTogJ1BPU1QnLA0KICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKXsNCiAgICAgICAgCWlmKGRhdGEgPT0gJ25vJyl7DQogICAgICAgIAkJJCgnLm1vZGFsJykubW9kYWwoJ2hpZGUnKTsNCiAgICAgICAgCQlpZihkbWRTZWxlY3RCdXR0b25JZCAhPSIiKQ0KICAgICAgICAJCQlzZWxlY3Rpb25CdXR0b24uYXR0cignaXNBY3RpdmUnLCBkYXRhKTsNCgkJCSAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpew0KCQkJICAgICAgJCgnI2hpc3RvcmljYWxJbmZvTW9kYWwnKS5tb2RhbCgnc2hvdycpOw0KCQkJICAgIH0sMTMwMCk7DQogICAgICAgIAl9DQogICAgICAgIAllbHNlew0KCQkJCXdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdXJsOw0KICAgICAgICAJfQ0KICAgICAgICB9LA0KICAgICAgICBlcnJvcjogZnVuY3Rpb24oeGhyLCBhamF4T3B0aW9ucywgdGhyb3duRXJyb3Ipew0KICAgICAgICAJY29uc29sZS5sb2coJ2Vycm9yID0gJyt0aHJvd25FcnJvcik7DQoJCQl3aW5kb3cubG9jYXRpb24uaHJlZiA9IHVybDsNCiAgICAgICAgfQ0KICAgIH0pOw0KfQ0KDQokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpew0KCWlmKCQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpLnRvTG93ZXJDYXNlKCkgPT0gJ3N3ZHNlbGZzZXJ2aWNlJyl7DQoJCSQoJyNjaG9vc2VOZXdHZW5Qcm9kdWN0JykuYXR0cignZGF0YS1kaXNtaXNzJywnbW9kYWwnKTsNCgl9DQp9KTsNCg0KZnVuY3Rpb24gaGFuZGxlSGlzdG9yaWNhbE92ZXJsYXlMaW5rcygpew0KCS8vQ2xvc2UgUHJlLTIwMDUgb3ZlcmxheSBhbmQgb3BlbiBwcmV2aW91cyBvdmVybGF5IG9uIGdvIGJhY2sgbGluayBjbGljaw0KICAkKCcjY2hvb3NlTmV3R2VuUHJvZHVjdCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KXsNCiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICQoJyNoaXN0b3JpY2FsSW5mb01vZGFsJykubW9kYWwoJ2hpZGUnKTsNCiAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpew0KICAgICAgJCgnI2NoZWNrLXNlcnZpY2UtbW9kYWwnKS5tb2RhbCgnc2hvdycpOw0KICAgIH0sMTMwMCk7DQogIH0pOw0KDQp9DQoNCmZ1bmN0aW9uIGNsZWFyRGl2c09uTG9hZCgpew0KDQoJJCgnLm1vZGFsQ29tbW9uQ2xhc3MnKS5oaWRlKCk7DQoJJCgnLnByb2R1Y3Rpb24tc2VsZWN0aW9uLXNlY3Rpb24nKS5oaWRlKCk7DQoJaGlkZUNhdGVnb3JpZXMoKTsNCg0KfQ0KDQpmdW5jdGlvbiBzc2ZWZXJpb25NYXRjaChpbnB1dFZlcnNpb24pew0KLyogVGhpcyBmdW5jdGlvbiBpcyB0byBjaGVjayBhbnkgdmVyc2lvbiBvZiBTU0YgYWdhaW5zdCB0aGUgbGlzdCBvZiBDU1YncyBmcm9tIFNTQw0KICogaW5wdXRWZXJzaW9uIChTdHJpbmcpIDogVGhpcyBpcyB0aGUgdmVyc2lvbiB5b3UgbmVlZCB0byBjaGVjayBhZ2FpbnN0IHRoZSBDU1YncyBpbiBTU0MNCiAqIFJldHVybiAoQm9vbGVhbikgOiBJZiB0aGUgaW5wdXRWZXJzaW9uIG1hdGNoZXMgYW55IG9mIHRoZSBDU1YncyA6IHRydWUgfCBlbHNlIGZhbHNlDQogKiBsYXRlc3RWZXJzaW9uIChTdHJpbmcsIGNzdikgOiBUaGlzIGlzIHRoZSB2YWx1ZSBjb21pbmcgZnJvbSB0aGUgU1NDIHRvIGEgaGlkZGVuIHZhcmlhYmxlIHRvIEpTLCBzb21ld2hlcmUgYWJvdmUNCiAqLw0KCXZhciB0ZW1wVmVyc2lvbkFycmF5Ow0KCWlmKGNoZWNrVmFsaWRpdHkobGF0ZXN0VmVyc2lvbikpew0KCQl0ZW1wVmVyc2lvbkFycmF5ID0gbGF0ZXN0VmVyc2lvbi5zcGxpdCgiLCIpOw0KCQlmb3IodmFyIGk9MDsgaTx0ZW1wVmVyc2lvbkFycmF5Lmxlbmd0aDsgaSsrKXsNCgkJCWlmKGlucHV0VmVyc2lvbiA9PSAkLnRyaW0odGVtcFZlcnNpb25BcnJheVtpXSkgKXsNCgkJCQlyZXR1cm4gdHJ1ZTsNCgkJCX0NCgkJfQ0KCX0NCglyZXR1cm4gZmFsc2U7DQoNCn0NCg0KZnVuY3Rpb24gZ2V0RG9jSURBbmRCdWlsZFNvbERpYWdMaW5rICgpIHsNCgl2YXIgY3VycmVudENDID0gZ2V0Q0NMQygnY2MnKTsNCgl2YXIgY3VycmVudExDID0gZ2V0Q0NMQygnbGMnKTsNCgl2YXIgc29sRGlhZ1VybCA9ICJodHRwOi8vc3VwcG9ydC5ocC5jb20vIitjdXJyZW50Q0MrIi0iK2N1cnJlbnRMQysiL2RvY3VtZW50LyI7DQoNCglpZihjdXJyZW50Q0MgPT0gJ3VzJyAmJiBjdXJyZW50TEMgPT0gJ2VuJyl7DQoJCWJ1aWxkU29sdXRpb25EaWFnbm9zdGljTGluayhzb2xEaWFnVXJsK2RtZFByaXZhY3lEb2NJZCk7DQoJfQ0KCWVsc2UNCgl7DQoJCXZhciBkYXRhT2JqID0gew0KCQkJJ2NjJzogY3VycmVudENDLA0KCQkJJ2xjJzogY3VycmVudExDLA0KCQkJJ2RvY3VtZW50SWQnOiBkbWRQcml2YWN5RG9jSWQNCgkJfTsNCg0KCQkkLmFqYXgoew0KCQkJZGF0YTogZGF0YU9iaiwNCgkgICAgICAgIHVybDogY29uY2VudHJhQWpheFVybCwNCgkgICAgICAgIHR5cGU6ICdQT1NUJywNCgkgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpew0KCSAgICAgICAgCWlmKGRhdGEgPT0gIiIpDQoJICAgICAgICAJCWRhdGEgPSBkbWRQcml2YWN5RG9jSWQ7DQoJICAgICAgICAJYnVpbGRTb2x1dGlvbkRpYWdub3N0aWNMaW5rKHNvbERpYWdVcmwrZGF0YSk7DQoJICAgICAgICB9LA0KCSAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHhociwgYWpheE9wdGlvbnMsIHRocm93bkVycm9yKXsNCgkgICAgICAgIAljb25zb2xlLmxvZygnVW5rbm93biBlcnJvciB0aHJvd24nKTsNCgkgICAgICAgIAlidWlsZFNvbHV0aW9uRGlhZ25vc3RpY0xpbmsoc29sRGlhZ1VybCtkbWRQcml2YWN5RG9jSWQpOw0KCSAgICAgICAgCXJldHVybiBmYWxzZTsNCgkgICAgICAgIH0NCgkgICAgfSk7DQoJfQ0KfQ0KDQoNCmZ1bmN0aW9uIGJ1aWxkU29sdXRpb25EaWFnbm9zdGljTGluayhkb2NVcmwpew0KCSQoJy5sbmtTb2x1dGlvbkRpYWdub3N0aWMnKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCl7DQoJCWlmICh0eXBlb2Ygd2luICE9PSAnb2JqZWN0Jykgew0KCQkJd2luZG93Lm9wZW4oZG9jVXJsLCAibmV3V2luZG93IiwgIndpZHRoPTgwMCwgaGVpZ2h0PTYwMCwgbGVmdD0xMDAsIHRvcD0xMDAsIHNjcm9sbGJhcnM9eWVzIik7DQoJCX0gZWxzZSB7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KCQlyZXR1cm4gZmFsc2U7DQoJfSk7DQp9DQoKfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJNb2R1bGUgJ2hwU3R5bGVSMic6ICIsZSk7fQp0cnl7DQp2YXIgaXNTaG93RmluZFNvbHV0aW9uTXNnID0gZmFsc2U7DQp2YXIgaXNTb2xGb3VuZCA9IGZhbHNlOy8vZmxhZyB0byBjaGVjayBpZiBzb2x1dGlvbiBpcyBub3QgZm91bmQNCnZhciBpc1NvZnRVcGRhdGVGb3VuZCA9IGZhbHNlOy8vRmxhZyB0byBjaGVjayBpZiBzb2Z0d2FyZSBub3QgZm91bmQNCnZhciBzb2x1dGlvbnNDb3VudCA9IDA7DQp2YXIgc29mdENvdW50ID0gMDsNCg0KdmFyIGNjID0gZ2V0Q0NMQygiY2MiKTsNCnZhciBsYyA9IGdldENDTEMoImxjIik7DQp2YXIgcHJvZHVjdE5hbWUgPSAnJzsvLydIUCBPZmZpY2VqZXQgUHJvIDI3NmR3IE1GUCc7DQp2YXIgcHJvZHVjdE51bWJlciA9ICcnOy8vIkNSNzcwQSI7DQp2YXIgc3VwcG9ydE5hbWVPaWQgPSAnJzsvLzUyMTI4NDINCnZhciBwcm9kdWN0TmFtZU9pZCA9ICcnOw0KdmFyIE9TID0gIiI7LypyZWFkIGZyb20gSlMqLw0KdmFyIGNsaWVudE5hbWUgPSAicHBzcC0wMSI7DQp2YXIgcHJvZHVjdExpbmUgPSAnJzsgLy8iM1kiOw0KdmFyIGFkZHJlc3MgPSAnJzsvL2dldFBhcmFtZXRlckJ5TmFtZSgiaXBBZGRyZXNzIik7Ly8iaHR0cDovLzE5Mi4xNjguMS4xNjo4MC8iOy8qcmVhZCBmcm9tIEpTKi8NCi8vdmFyIHNzZiA9IGdldFBhcmFtZXRlckJ5TmFtZSgic3NmIik7DQp2YXIgdHJhY2tJRCA9IFtdOw0KdmFyIGNyaXRpY2FsU29sID0gW107DQp2YXIgbm9ybWFsU29sID0gW107DQp2YXIgaHRtbCA9ICIiOw0KdmFyIGNvdW50ZXIgPSAwOw0KdmFyIHNvbHV0aW9uc0NvdW50ZXIgPSAwOw0KdmFyIG1heFJlc3VsdENvdW50ID0gMjsNCnZhciBkaXZpY2VUeXBlID0gIiI7DQp2YXIgc3NmT2JqZWN0PSIiOw0KdmFyIHZpZXdNb3JlID0gIiI7DQp2YXIgdmlld0xlc3MgPSAiIjsNCnZhciBJT0dPYmplY3QgPSAiIjsNCnZhciBPQ1ZPYmplY3QgPSAiIjsNCnNmc1Byb2R1Y3RDYWNoZWRPYmplY3REbWQgPSAiIjsNCnJ1blNTRiA9ICIiOw0KdmFyIGlzQWNsbUVycm9yID0gZmFsc2U7DQp2YXIgc2VyaWFsTnVtYmVyPSIiOw0KdmFyIEN1cnJlbnRFbGVtZW50Ow0KdmFyIHNzZlBhcmFtcyA9IHsNCgkic2hvd092ZXJsYXkiIDogdHJ1ZSwNCgkic3NmSW5pdCIgOiBmYWxzZSwNCgkiaXNEbWRSdW4iIDogZmFsc2UsDQoJImdldFNvbHV0aW9uT25Mb2FkIiA6IGZhbHNlLA0KCSJpc1ZlcmlmaWVkIiA6IGZhbHNlLA0KCSJpc0xhdGVzdFNTRiIgOiBmYWxzZSwNCgkiaXNTb2Z0d2FyZVJ1biIgOiBmYWxzZSwNCgkiaXNTb2x1dGlvblJ1biIgOiBmYWxzZQ0KfQ0KdmFyIGlzUGRwUGFnZSA9IGZhbHNlOw0KDQp2YXIgbm9uSFBESUFTZWxlY3RlZEJ1dHRvbiA9ICcnOw0KdmFyIHBpZHM7DQoNCg0KalF1ZXJ5KCJkb2N1bWVudCIpLnJlYWR5KGZ1bmN0aW9uKCl7DQppZih0eXBlb2YgU1NGICE9ICJ1bmRlZmluZWQiKXsNCglpc1BkcFBhZ2UgPSAkKCcjcGFnZUlkZW50aWZpZXInKS52YWwoKS50b0xvd2VyQ2FzZSgpID09ICJwcm9kdWN0IGRldGFpbHMgcGFnZSI7DQoNCgkvL0dldCBTU0Ygc3RhdHVzIG9uIHBhZ2UgbG9hZA0KCWlmKGlzUGRwUGFnZSAmJiB0eXBlb2YgU1NGICE9ICJ1bmRlZmluZWQiKXsNCgkJU1NGLkdldFZlcnNpb24odHJ1ZSwgZnVuY3Rpb24oZGF0YSl7DQoJCQlzc2ZQYXJhbXMuaXNMYXRlc3RTU0YgPSBkYXRhICE9ICJub3QgaW5zdGFsbGVkIiAmJiBzc2ZWZXJpb25NYXRjaChkYXRhKTsNCgkJfSk7DQoJfQ0KDQoJLy9nZXQgdGhlIHBpZHMgcmVzcG9uc2Ugd2hpbGUgcGFnZSBsb2FkDQoJaWYoalF1ZXJ5KCIjcGlkcyIpLnZhbCgpKXsNCgkJcGlkcyA9IGpRdWVyeS5wYXJzZUpTT04oalF1ZXJ5KCIjcGlkcyIpLnZhbCgpKTsNCgl9DQoJZWxzZXsNCgkJcGlkcyA9IG51bGw7DQoJfQ0KDQoJdmFyIG9wZXJhdGluZ1N5c3RlbSA9IG5hdmlnYXRvci51c2VyQWdlbnQuc3BsaXQoIigiKTsNCgljbGllbnROYW1lID0gJCgnI2RtZENsaWVudElkJykudmFsKCk7DQoNCglpZihvcGVyYXRpbmdTeXN0ZW1bMV0uaW5kZXhPZigiTVNJRSIpPj0wKXsNCgkJdmFyIGdldE9TID0gb3BlcmF0aW5nU3lzdGVtWzFdLnNwbGl0KCI7Iik7DQoJCU9TID0gJC50cmltKGdldE9TWzJdKTsNCgl9DQoJZWxzZXsNCgkJdmFyIGdldE9TID0gb3BlcmF0aW5nU3lzdGVtWzFdLnNwbGl0KCI7Iik7DQoJCU9TID0gZ2V0T1NbMF07DQoNCgl9DQoJLy9jb25zb2xlLmxvZyhPUyk7DQoNCg0KLy9HZXQgdmFsdWUgZnJvbSBzZXNzaW9uDQp2YXIgc29sdXRpb25zSnNvbjsNCmlmKHNmc1Byb2R1Y3RDYWNoZWRPYmplY3REbWQpew0KCXNvbHV0aW9uc0pzb24gPSBqUXVlcnkucGFyc2VKU09OKHNmc1Byb2R1Y3RDYWNoZWRPYmplY3REbWQpOw0KfQ0KZWxzZXsNCglzb2x1dGlvbnNKc29uID0gbnVsbDsNCn0NCg0KCWlmKHBpZHMhPW51bGwpew0KCQlwcm9kdWN0TmFtZSA9IHBpZHMuUHJvZHVjdE5hbWU7DQoJCXByb2R1Y3ROdW1iZXIgPSBwaWRzLlByb2R1Y3ROdW1iZXI7DQoJCXByb2R1Y3RMaW5lID0gcGlkcy5Qcm9kdWN0TGluZUNvZGU7DQoJCXByb2R1Y3ROYW1lT2lkID0gcGlkcy5Qcm9kdWN0TmFtZU9pZDsNCgkJc3VwcG9ydE5hbWVPaWQgPSBwaWRzLlN1cHBvcnROYW1lT2lkOw0KCX0NCg0KCWlmKHNvbHV0aW9uc0pzb24hPXVuZGVmaW5lZCAmJiBzb2x1dGlvbnNKc29uIT1udWxsICYmIHNvbHV0aW9uc0pzb24hPScnKXsNCgkJaWYoalF1ZXJ5LmluQXJyYXkocHJvZHVjdExpbmUsIHNvbHV0aW9uU3VwcG9ydGVkUGwpICE9IC0xICYmIGpRdWVyeS5pbkFycmF5KHByb2R1Y3RMaW5lLCBzb2x1dGlvblN1cHBvcnRlZFBjUGwpID09IC0xKXsNCgkJCS8vRmluZCB0aGUgc29mdHdhcmUgdXBkYXRlDQoJCQlmaW5kU29mdHdhcmVVcGRhdGVTZXJ2aWNlKCk7DQoJCX0NCgkJZWxzZSBpZihqUXVlcnkuaW5BcnJheSggcHJvZHVjdExpbmUsIHNvbHV0aW9uU3VwcG9ydGVkUGNQbCkgIT0gLTEpew0KCQkJLy9GaW5kIEFDTE0gc29sdXRpb25zDQoJCQlmaW5kQUNMTVNvbHV0aW9uU2VydmljZSgpOw0KCQkJZmluZFNvbHV0aW9uU2VydmljZSgpOw0KCQl9DQoNCg0KDQoJCSQoJyNzb2x1dGlvbkZpbmRlcicpLmhpZGUoKTsNCgkJdmFyIHNlc3Npb25DbGVhbkpTT04gPSBbXTsNCgkJZm9yKGk9MDtpPHNvbHV0aW9uc0pzb24ubGVuZ3RoO2krKyl7DQoJCQlpZihzb2x1dGlvbnNKc29uW2ldLklkIT1udWxsICYmIHNvbHV0aW9uc0pzb25baV0uU29sdXRpb25UeXBlID09ICJTb2x1dGlvbkZvdW5kIiAmJiBzb2x1dGlvbnNKc29uW2ldLlVyaVR5cGUgPT0gIlNvbHV0aW9uUGFnZSIpew0KCQkJCXNlc3Npb25DbGVhbkpTT04ucHVzaChzb2x1dGlvbnNKc29uW2ldKTsNCgkJCX0NCgkJfQ0KCQlpc1NvbEZvdW5kID0gdHJ1ZTsNCgkJc29ydFJlc3VsdChzZXNzaW9uQ2xlYW5KU09OKTsNCgkJc2hvd1NvbHNSZXN1bHQoKTsNCgkJJCgnI3NvbHV0aW9uUmVzdWx0cycpLnNob3coKTsNCgkJJCgnI3NvbHV0aW9uc1dyYXBwZXInKS5zaG93KCk7DQoNCgl9DQoJZWxzZSBpZihpc1BkcFBhZ2UgJiYgdHlwZW9mIFNTRiAhPSAidW5kZWZpbmVkIil7DQoNCgkJaWYoJCgnI2RldGVjdGVkSXBBZGRyZXNzJykudmFsKCkgIT0gIiIpew0KCQkJYWRkcmVzcyA9ICQoJyNkZXRlY3RlZElwQWRkcmVzcycpLnZhbCgpOw0KCQl9DQoNCgkJaWYoc3NmUGFyYW1zLmdldFNvbHV0aW9uT25Mb2FkKXsNCgkJCWZpbmRTb2x1dGlvblNraXBWZXJpZmljYXRpb24oKTsNCgkJfQ0KCQllbHNlIGlmKCQoJyNpc2RtZFJ1bicpLnZhbCgpID09ICJ0cnVlIil7DQoJCQlzc2ZQYXJhbXMuc2hvd092ZXJsYXkgPSBmYWxzZTsNCgkJCXNzZlBhcmFtcy5pc1ZlcmlmaWVkID0gdHJ1ZTsNCgkJCWZpbmRTb2x1dGlvbigpDQoJCX0NCgkJZWxzZSB7DQoJCQlzc2ZQYXJhbXMuc2hvd092ZXJsYXkgPSBmYWxzZTsNCgkJCW9uVGVzdFZlcnNpb25DbGljaygiZmluZFNvbHV0aW9uc0J0biIsImZpbmRTb2x1dGlvbnMiLCcnKTsNCgkJfQ0KCX0NCg0KDQoNCg0KCS8vc2hvdyBzb2x1dGlvbiBvbiBjbGljayBvZiBmaW5kIHNvbHV0aW9uIGJ1dHRvbg0KCWpRdWVyeSgiI2ZpbmRTb2x1dGlvbnNCdG4iKS5jbGljayhmdW5jdGlvbigpew0KCQlpc1Nob3dGaW5kU29sdXRpb25Nc2cgPSBmYWxzZTsNCgkJaXNQZHBTd2RSZXF1ZXN0ID0gZmFsc2U7DQoJCWlmKHNzZlBhcmFtcy5zc2ZJbml0IHx8IHNzZlBhcmFtcy5pc0RtZFJ1bil7DQoJCQlzc2ZQYXJhbXMuc2hvd092ZXJsYXkgPSB0cnVlOw0KCQkJZmluZFNvbHV0aW9uU2tpcFZlcmlmaWNhdGlvbigpOw0KCQl9DQoJCWVsc2V7DQoJCQlzc2ZQYXJhbXMuc2hvd092ZXJsYXkgPSB0cnVlOw0KCQkJb25UZXN0VmVyc2lvbkNsaWNrKCJmaW5kU29sdXRpb25zQnRuIiwiZmluZFNvbHV0aW9ucyIsJycpOw0KCQl9DQoJfSk7DQoNCglqUXVlcnkoIiNzaG93TW9yZVJlc3VsdHMiKS5jbGljayhmdW5jdGlvbigpew0KDQoJCXZhciB2YWx1ZSA9IGpRdWVyeSh0aGlzKS5maW5kKCJoNCIpLmh0bWwoKTsNCgkJaWYodmFsdWUgPT0gdmlld01vcmUpew0KCQkJalF1ZXJ5KCIuaGlkZVJlc3VsdHMiKS5mYWRlSW4oInNsb3ciKTsNCgkJCWpRdWVyeSh0aGlzKS5maW5kKCJoNCIpLmh0bWwodmlld0xlc3MpOw0KCQkJalF1ZXJ5KHRoaXMpLmZpbmQoInNwYW4iKS5yZW1vdmVDbGFzcygidmlld01vcmVEb3duQXJyb3ciKS5hZGRDbGFzcygidmlld0xlc3NVcEFycm93Iik7DQoJCX0NCgkJZWxzZXsNCgkJCWpRdWVyeSgiLmhpZGVSZXN1bHRzIikuaGlkZSgpOw0KDQoJCQlqUXVlcnkodGhpcykuZmluZCgic3BhbiIpLnJlbW92ZUNsYXNzKCJ2aWV3TGVzc1VwQXJyb3ciKS5hZGRDbGFzcygidmlld01vcmVEb3duQXJyb3ciKTsNCgkJCWpRdWVyeSh0aGlzKS5maW5kKCJoNCIpLmh0bWwodmlld01vcmUpOw0KCQl9DQoJfSk7DQoJfQ0KDQoJJCgiI0hwZGlhX0Rvd25sb2FkRGlhbG9nIikub24oImNsaWNrIiwgIi5jbG9zZS5pY29uIiwgZnVuY3Rpb24oKXsNCgkJQ3VycmVudEVsZW1lbnQuZm9jdXMoKTsNCgl9KTsNCn0pOw0KDQpmdW5jdGlvbiBmaW5kU29sdXRpb25Ta2lwVmVyaWZpY2F0aW9uKCl7DQoJJCgnLm1vZGFsQ29tbW9uQ2xhc3MnKS5oaWRlKCk7DQoJJCgnI2ZpbmRpbmdTb2x1dGlvbnMnKS5zaG93KCk7DQoJJCgnI2NoZWNrLXNlcnZpY2UtbW9kYWwnKS5tb2RhbCgnc2hvdycpOw0KCWZpbmRTb2x1dGlvbigpOw0KfQ0KDQpmdW5jdGlvbiBnZXRTb2x1dGlvbnMoc2ltaWxhclByb2R1Y3RzKXsNCglpZihzaW1pbGFyUHJvZHVjdHMubGVuZ3RoID09IDEpew0KCQkkKCcubW9kYWxDb21tb25DbGFzcycpLmhpZGUoKTsNCgkJJCgnI2ZpbmRpbmdTb2x1dGlvbnMnKS5zaG93KCk7DQoJCWFkZHJlc3MgPSBzaW1pbGFyUHJvZHVjdHNbMF0uRGV2aWNlVHlwZSA9PSJVU0IiID8gInVzYjovLyIgKyBzaW1pbGFyUHJvZHVjdHNbMF0uSXBBZGRyZXNzOg0KCQkJCQkJCXNpbWlsYXJQcm9kdWN0c1swXS5EZXZpY2VUeXBlID09IiIgPyAiaHR0cDovL2xvY2FsaG9zdCIgOiAiaHR0cHM6Ly8iICsgc2ltaWxhclByb2R1Y3RzWzBdLklwQWRkcmVzczsNCglmaW5kU29sdXRpb24oKTsNCgl9DQoJZWxzZSBpZihzaW1pbGFyUHJvZHVjdHMubGVuZ3RoID4gMSl7DQoJCSQoJy5tb2RhbENvbW1vbkNsYXNzJykuaGlkZSgpOw0KCQkkKCcjY2hvb3NlUmlnaHRQcm9kdWN0Jykuc2hvdygpOw0KCX0NCn0NCg0KZnVuY3Rpb24gaGFuZGxlTXVsdGlQcm9kdWN0KCl7DQoJLy9HZXQgdGhlIHNlcmlhbCBudW1iZXIgZnJvbSBtYXJrdXAgLSBEaXJ0eSBmaXguIEZpeCB0aGlzIG9uY2UgcmVtb2RlbGluZyBpcyBkb25lLg0KCXZhciBmb3JTZXJpYWxOdW1iZXJBcnJheSA9ICQoZXZlbnQudGFyZ2V0KS5wcmV2KCkuaHRtbCgpLnJlcGxhY2UoLyAvZywgJycpLnNwbGl0KC86L2cpOw0KCXZhciBzZXJpYWxOb1RvQ29tcGFyZSA9IGZvclNlcmlhbE51bWJlckFycmF5W2ZvclNlcmlhbE51bWJlckFycmF5Lmxlbmd0aC0xXTsNCgkkLmVhY2gocHJvZEluZm8sIGZ1bmN0aW9uKGluZGV4LCB2YWwpew0KCQlpZihzZXJpYWxOb1RvQ29tcGFyZSA9PSB2YWxbMF1bJ1NlcmlhbE51bWJlciddKXsNCgkJCWFkZHJlc3MgPSB2YWwuRGV2aWNlVHlwZSA9PSJVU0IiID8gInVzYjovLyIgKyB2YWwuSXBBZGRyZXNzOg0KCQkJCXZhbC5EZXZpY2VUeXBlID09IiIgPyAiaHR0cDovL2xvY2FsaG9zdCIgOiAiaHR0cHM6Ly8iICsgdmFsLklwQWRkcmVzczsNCgkJfQ0KCX0pOw0KDQoJJCgnLm1vZGFsQ29tbW9uQ2xhc3MnKS5oaWRlKCk7DQoJJCgnI2ZpbmRpbmdTb2x1dGlvbnMnKS5zaG93KCk7DQoJZmluZFNvbHV0aW9uKCk7DQoJZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc2V0VmFsdWUoInNlcmlhbE51bWJlciIsc2VyaWFsTm9Ub0NvbXBhcmUpOw0KDQp9DQoNCmZ1bmN0aW9uIGdldEFkZHJlc3MocHJvZHVjdG51bWJlciwgcHJvZHVjdE5hbWVPaWQxKXsNCgkkKCcubW9kYWxDb21tb25DbGFzcycpLmhpZGUoKTsNCgkkKCcjZmluZGluZ1NvbHV0aW9ucycpLnNob3coKTsNCg0KCXByb2R1Y3ROdW1iZXIgPSBwcm9kdWN0bnVtYmVyOw0KCXByb2R1Y3RuYW1lT2lkID0gcHJvZHVjdE5hbWVPaWQxOw0KDQoNCg0KCVNTRi5Qcm9kdWN0RGV0ZWN0aW9uLk1heGltdW1UaW1lb3V0ID0gMjA7DQoJICAgIFNTRi5Qcm9kdWN0RGV0ZWN0aW9uLkhUVFAgPSB0cnVlOw0KCSAgICBTU0YuUHJvZHVjdERldGVjdGlvbi5DYWNoZWRSZXN1bHRzRXhwaXJhdGlvbiA9IGpRdWVyeSgiI0RNRFByb2R1Y3RzQ2FjaGVJbnRlcnZhbFZhbHVlIikudmFsKCk7DQoJU1NGLlByb2R1Y3REZXRlY3Rpb24uRGV0ZWN0KG9uU3RhdHVzLCBvbkVycm9yKTsNCg0KCWZ1bmN0aW9uIHNlYXJjaEFkZHJlc3MoY2FjaGVkUmVzdWx0LCBtb2RlbG51bWJlcil7DQoJCWZvcihpPTA7aTxjYWNoZWRSZXN1bHQubGVuZ3RoO2krKyl7DQoJCQl2YXIgcGlkc1Byb2QgPSBjYWNoZWRSZXN1bHRbaV07DQoJCQlpZihwaWRzUHJvZFswXS5Qcm9kdWN0TmFtZU9pZD09bW9kZWxudW1iZXIpew0KCQkJCXJldHVybiBjYWNoZWRSZXN1bHRbaV07DQoJCQl9DQoJCX0NCg0KCX0NCg0KCWZ1bmN0aW9uIG9uU3RhdHVzKHN0YXR1c09iaikgew0KDQoJCS8vVGVtcG9yYXJ5IGZpeCBmb3IgcHJvZHVjdCBudW1iZXIgdW50aWwgdGhlIEh1Yi1icm9rZXIgY2FsbCBpcyBtYWRlLg0KCQlpZihkb2N1bWVudC5sb2NhdGlvbi5ocmVmLnNwbGl0KCdwcm9kTnVtJykubGVuZ3RoID4gMSl7DQoJCQlwcm9kdWN0TnVtYmVyID0gcHJvZHVjdE51bWJlciAhPSAnJyA/IHByb2R1Y3ROdW1iZXIgOiBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLnNwbGl0KCdwcm9kTnVtPScpWzFdLnNwbGl0KCcmJylbMF07DQoJCX0NCgkgIAkgIGlmKHN0YXR1c09iai5Qcm9ncmVzcyA9PSAiMTAwIil7DQoJICAJCXZhciBzID0gc2VhcmNoQWRkcmVzcyhwcm9kSW5mbywgcHJvZHVjdG5hbWVPaWQpOw0KDQoNCgkgIAkJICBpZihzIT11bmRlZmluZWQgJiYgcy5JcEFkZHJlc3M9PSIiKXsNCgkgIAkJCWlzU29sRm91bmQgPSB0cnVlOw0KCSAgCQkJaWYoalF1ZXJ5LmluQXJyYXkocHJvZHVjdExpbmUsIHNvbHV0aW9uU3VwcG9ydGVkUGwpICE9IC0xICYmIGpRdWVyeS5pbkFycmF5KHByb2R1Y3RMaW5lLCBzb2x1dGlvblN1cHBvcnRlZFBjUGwpID09IC0xKXsNCgkgIAkJCQkvL0ZpbmQgdGhlIHNvZnR3YXJlIHVwZGF0ZQ0KCSAgCQkJCWZpbmRTb2Z0d2FyZVVwZGF0ZVNlcnZpY2UoKTsNCgkgIAkJCX0NCgkgIAkJCWVsc2UgaWYoalF1ZXJ5LmluQXJyYXkoIHByb2R1Y3RMaW5lLCBzb2x1dGlvblN1cHBvcnRlZFBjUGwpICE9IC0xKXsNCgkgIAkJCQkvL0ZpbmQgQUNMTSBzb2x1dGlvbnMNCgkgIAkJCQlmaW5kQUNMTVNvbHV0aW9uU2VydmljZSgpOw0KCSAgCQkJCWZpbmRTb2x1dGlvblNlcnZpY2UoKTsNCgkgIAkJCX0NCgkgIAkJICB9DQoJICAJCSAgZWxzZXsNCgkgIAkJCWRpdmljZVR5cGUgPXMuRGV2aWNlVHlwZTsNCgkgIAkJICBpZihkaXZpY2VUeXBlPT0iVVNCIil7DQoJICAJCQlhZGRyZXNzID0gInVzYjovLyIgKyBzLklwQWRkcmVzczsNCgkgIAkJICB9DQoJICAJCSAgZWxzZSBpZihkaXZpY2VUeXBlID09ICIiKXsNCgkgIAkJICAJYWRkcmVzcyA9ICJodHRwczovL2xvY2FsaG9zdCI7DQoJICAJCSAgfQ0KCSAgCQkgIGVsc2V7DQoJICAJCQlhZGRyZXNzID0gICJodHRwczovLyIgKyBzLklwQWRkcmVzczsNCgkgIAkJICB9DQoJICAJCSAgLy9hZGRyZXNzID0gIHMuSXBBZGRyZXNzOw0KCSAgCQlpZihzLklwQWRkcmVzcyE9dW5kZWZpbmVkKXsNCgkgIAkJCWZpbmRTb2x1dGlvbigpOw0KDQoJCQkJZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc2V0VmFsdWUoInNlcmlhbE51bWJlciIsc1swXS5TZXJpYWxOdW1iZXIpOw0KDQoJICAJCQlpZigkKCcjZHZDcml0aWNhbFNvbHV0aW9ucycpLmNoaWxkcmVuKCkubGVuZ3RoPjApew0KCSAgCQkJCWpRdWVyeSgiI2R2Q3JpdGljYWwiKS5zaG93KCk7DQoJICAJCQl9DQoJICAJCQlpZigkKCcjZHZQb3RlbnRpYWxTb2x1dGlvbnMnKS5jaGlsZHJlbigpLmxlbmd0aD4wKXsNCgkgIAkJCQlqUXVlcnkoIiNkdlBvdGVudGlhbCIpLnNob3coKTsNCgkgIAkJCX0NCgkgIAkJfQ0KCSAgCSAgfQ0KDQoJICAJICB9DQoJICAJICBlbHNlew0KCSAgCQlwcm9ncmVzc2Jhci5wcm9ncmVzc2JhciggInZhbHVlIiwgc3RhdHVzT2JqLlByb2dyZXNzKTsNCg0KDQoJICAJICB9DQoNCiAgCX0NCg0KCWZ1bmN0aW9uIG9uRXJyb3IocmVxdWVzdCwgc3RhdHVzLCBlcnJvcikgew0KCSAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShlcnJvcikpOw0KCX0NCg0KDQp9DQoNCmZ1bmN0aW9uIGZpbmRTb2x1dGlvbigpew0KCXNvbHV0aW9uc0NvdW50ZXIgPSAwOw0KDQoJLy9zb2x1dGlvblN1cHBvcnRlZFBsLCBzb2x1dGlvblN1cHBvcnRlZFBjUGwgaXMgZGVmaW5lZCBpbiBkZXRlY3RNeURldmljZURpdi5qc3AgaW4gaHAtZGV0ZWN0LWxvYWQtbXktZGV2aWNlDQoJaWYoalF1ZXJ5LmluQXJyYXkocHJvZHVjdExpbmUsIHNvbHV0aW9uU3VwcG9ydGVkUGwpICE9IC0xICYmIGpRdWVyeS5pbkFycmF5KHByb2R1Y3RMaW5lLCBzb2x1dGlvblN1cHBvcnRlZFBjUGwpID09IC0xKXsNCgkJLy9GaW5kIHRoZSBzb2Z0d2FyZSB1cGRhdGUNCgkJZmluZFNvZnR3YXJlVXBkYXRlU2VydmljZSgpOw0KDQoJCS8vRmluZCB0aGUgc29sdXRpb25zDQoJCWZpbmRTb2x1dGlvblNlcnZpY2UoKQ0KDQoNCgkJLy9JT0cgU2VydmljZQ0KCQlmaW5kSU9HKCk7DQoNCgkJLy9PQ1YgU2VydmljZQ0KCQlmaW5kT0NWKCk7DQoJfQ0KCWVsc2UgaWYoalF1ZXJ5LmluQXJyYXkoIHByb2R1Y3RMaW5lLCBzb2x1dGlvblN1cHBvcnRlZFBjUGwpICE9IC0xKXsNCgkJLy9GaW5kIEFDTE0gc29sdXRpb25zDQoJCWZpbmRBQ0xNU29sdXRpb25TZXJ2aWNlKCk7DQoNCgkJLy9GaW5kIHRoZSBzb2x1dGlvbnMNCgkJZmluZFNvbHV0aW9uU2VydmljZSgpOw0KCX0NCn0NCg0KZnVuY3Rpb24gZmluZE9DVigpew0KCWZ1bmN0aW9uIG9uU3RhdHVzKHN0YXR1c09iaikgew0KCQlpZihzdGF0dXNPYmouUHJvZ3Jlc3M9PSIxMDAiKXsNCgkJCU9DVk9iamVjdCA9IHN0YXR1c09iai5SZXN1bHQ7DQoJCQl1cGRhdGVTZXNzaW9uKCJPQ1YiLE9DVk9iamVjdCxwcm9kdWN0TnVtYmVyKTsNCg0KCQkgfQ0KDQogICAgfQ0KDQogICAgZnVuY3Rpb24gb25FcnJvcihyZXF1ZXN0LCBzdGF0dXMsIGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGVycm9yKSk7DQogICAgfQ0KDQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL0hhcmRDb2RlZC8vLy8vLy8vLy8vLy8vLy8vLy8NCgkJdmFyIGZpbmRBcmdzID0gew0KCQlBZGRyZXNzOiBhZGRyZXNzLCAvLyJmaWxlOi8vQzovbGVkbS9IUF9MYXNlckpldF9DTTE0MTVmbnciLCAgIC8vImZpbGU6Ly9DOi9sZWRtL0hQX0xhc2VySmV0X0NNMTQxNWZudyIsDQoJCUxDOiBsYywgLy8gbGFuZ3VhZ2UgY29kZQ0KCQlDQzogY2MsIC8vIGNvdW50cnkgY29kZQ0KCQlQcm9kdWN0TGluZTogcHJvZHVjdExpbmUsLy8gIjJCIiwgLy8gcHJvZHVjdCBsaW5lIGlzIGVzcGVjaWFsbHkgaW1wb3J0YW50IGFzIHRoYXQgaXMgaG93IHRoZSBIYXJ2ZXN0ZXIgVGVtcGxhdGUgaXMgZGV0ZXJtaW5lZC4NCgkJQ2xpZW50OiBjbGllbnROYW1lLCAvLyBSZW5hbWUgdGhpcyB0byBtYXRjaCB5b3VyIGFwcGxpY2F0aW9uDQoJCX07DQoNCgkJU1NGLk9DVi5DYWNoZWRSZXN1bHRzRXhwaXJhdGlvbiA9IDMwMDA7IC8vIDAgdG8gbm90IHVzZSBjYWNoZWQgcmVzdWx0cw0KCQlTU0YuT0NWLlRpbWVvdXQgPSAxNTA7IC8vIGFwcHJveGltYXRlbHkgMTUwIHNlY29uZHMgdGlsbCByZXNwb25zZSB0aW1lcyBvdXQNCgkJU1NGLk9DVi5SdW4oZmluZEFyZ3MsIG9uU3RhdHVzLCBvbkVycm9yKTsgLy8gZmluZCBzb2x1dGlvbnMhDQoNCg0KDQp9DQoNCmZ1bmN0aW9uIGZpbmRJT0coKXsNCg0KCSBmdW5jdGlvbiBvblN0YXR1cyhzdGF0dXNPYmopIHsNCiAgICAgICAgIC8vIEFzaWduIHRoZSByZXN1bHQgdG8gb2JqZWN0DQoJCSBpZihzdGF0dXNPYmouUHJvZ3Jlc3M9PSIxMDAiKXsNCgkJCSBJT0dPYmplY3QgPSBzdGF0dXNPYmouUmVzdWx0Ow0KCQkJIHVwZGF0ZVNlc3Npb24oIklPRyIsSU9HT2JqZWN0LHByb2R1Y3ROdW1iZXIpOw0KCQkJIGdsb2JhbERhdGFMYXllci5JT0cgPSBJT0dPYmplY3Q7DQoNCgkJIH0NCiAgICAgfQ0KDQogICAgIGZ1bmN0aW9uIG9uRXJyb3IocmVxdWVzdCwgc3RhdHVzLCBlcnJvcikgew0KICAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoZXJyb3IpKTsNCiAgICAgfQ0KDQoNCg0KCQkJdmFyIHBhcmFtZXRlcnMgPSB7DQoJCQlBZGRyZXNzOiBhZGRyZXNzLCAvLyJmaWxlOi8vQzovbGVkbS9EZXZpY2VfUGFwZXJfSmFtX2FuZF9Eb29yX2lzX29wZW4iLCAvL2FkZHJlc3MsIC8vImZpbGU6Ly9DOi9sZWRtL0RldmljZV9QYXBlcl9KYW1fYW5kX0Rvb3JfaXNfb3BlbiIsDQoJCQlMQzogbGMsIC8vIGxhbmd1YWdlIGNvZGUNCgkJCUNDOiBjYywgLy8gY291bnRyeSBjb2RlDQoJCQlQcm9kdWN0TGluZTogcHJvZHVjdExpbmUsIC8vIHByb2R1Y3QgbGluZSBpcyBlc3BlY2lhbGx5IGltcG9ydGFudCBhcyB0aGF0IGlzIGhvdyB0aGUgSGFydmVzdGVyIFRlbXBsYXRlIGlzIGRldGVybWluZWQuDQoJCQlQcm9kdWN0TmFtZU9pZDogcHJvZHVjdE5hbWVPaWQxLA0KCQkJUHJvZHVjdE51bWJlcjogcHJvZHVjdE51bWJlciwNCgkJCVByb2R1Y3ROYW1lOiBwcm9kdWN0TmFtZSwNCgkJCUNsaWVudDogY2xpZW50TmFtZSAvLyBSZW5hbWUgdGhpcyB0byBtYXRjaCB5b3VyIGFwcGxpY2F0aW9uDQoJCQl9Ow0KDQoJCQlTU0YuSU9HLkNhY2hlZFJlc3VsdHNFeHBpcmF0aW9uID0gMzAwMDsgLy8gMCB0byBub3QgdXNlIGNhY2hlZCByZXN1bHRzDQoJCQlTU0YuSU9HLlRpbWVvdXQgPSAxNTA7IC8vIGFwcHJveGltYXRlbHkgMTUwIHNlY29uZHMgdGlsbCByZXNwb25zZSB0aW1lcyBvdXQNCgkJCWlmKGpRdWVyeS5pbkFycmF5KHByb2R1Y3RMaW5lLCBzb2x1dGlvblN1cHBvcnRlZFBsKSAhPSAtMSAmJiBqUXVlcnkuaW5BcnJheShwcm9kdWN0TGluZSwgc29sdXRpb25TdXBwb3J0ZWRQY1BsKSA9PSAtMSl7DQoJCQkJU1NGLklPRy5SdW4ocGFyYW1ldGVycywgb25TdGF0dXMsIG9uRXJyb3IpOyAvLyBmaW5kIHNvbHV0aW9ucyENCgkJCX0NCg0KDQoNCg0KfQ0KDQpmdW5jdGlvbiBjaGVja0ZvclNuZFNlY3Rpb25VcGRhdGUoKXsNCglpZih0eXBlb2Ygd2lsZGNhdFRvQ29uY2VudHJhRG9jID09PSAidW5kZWZpbmVkIikNCgkJcmV0dXJuOw0KCWVsc2V7DQoJCS8vQWRkaW5nIHVybCBmb3IgdGVybXMgYW5kIGNvbmRpdGlvbnMNCgkJdmFyIGV1bGFEb2NJZCA9ICJjMDA1ODE0MDEiOyAvLyBDaGFuZ2UgaXQgcG9zdCAyLjIgdG8gcmVhZCBkeW5hbWljYWxseQ0KCQl2YXIgZXVsYVVybCA9IHdpbGRjYXRUb0NvbmNlbnRyYURvYyhldWxhRG9jSWQpOw0KCQkkKCcuc3dpbmRleFROQycpLmF0dHIoJ2hyZWYnLCBldWxhVXJsKTsNCg0KCS8qaWYoJCgnI2R2U3dkU2NhbicpLmxlbmd0aCA+IDApew0KCQkkKCcjZHZTd2RTY2FuJykuaGlkZSgpOw0KCQkkKCcjbGJsT3B0aW9uMicpLmhpZGUoKTsNCgkJJCgnI3BubFBvc3RTY2FuTWVzc2FnZScpLnNob3coKTsNCgl9Ki8gICAgICAvL0FzaHdpbmk6IFRoaXMgZnVuY3Rpb25hbGl0eSBpcyBkaXNhYmxlZCBhcyBwYXJ0IG9mIFVTLTUxMzcuDQoJCWlmKHR5cGVvZiBTU0YgIT0gInVuZGVmaW5lZCIpew0KCSAgICAgICAgU1NGLkhQRElBLkF0dGFjaEV2ZW50SGFuZGxlcnMoKTsNCgkgICAgfQ0KCSAgICBlbHNlew0KCSAgICAgICAgYXR0YWNoTm9uSFBESUFIYW5kbGVyKCk7DQoJICAgIH0NCgl9DQp9DQoNCmZ1bmN0aW9uIGZpbmRTb2Z0d2FyZVVwZGF0ZVNlcnZpY2UoKXsNCg0KCXNzZlBhcmFtcy5zc2ZJbml0ID0gdHJ1ZTsNCglzc2ZQYXJhbXMuaXNWZXJpZmllZCA9IHRydWU7DQoJc3NmUGFyYW1zLmlzU29mdHdhcmVSdW4gPSBmYWxzZTsNCg0KCS8vU29mdHdhcmUgbG9va3VwIHBhcmFtDQoJdmFyIGxvb2t1cEFyZ3MgPSB7DQoJCSAgICBMQzogbGMsDQoJCSAgICBDQzogY2MsDQoJCSAgICBDbGllbnQ6IGNsaWVudE5hbWUsDQoJCSAgICAgLy9QSUQ6ICIweGExMTEiLA0KCQkgICAgIEZyaWVuZGx5TmFtZTogcHJvZHVjdE5hbWUsDQoJCSAgICBQcm9kdWN0TnVtYmVyOiBwcm9kdWN0TnVtYmVyLA0KCQkgICAgT1M6IE9TDQoJCX07DQoNCgkJU1NGLlNvZnR3YXJlTG9va3VwU2VydmljZS5DYWNoZWRSZXN1bHRzRXhwaXJhdGlvbiA9IGlzUmV0cnkgPT0gInJldHJ5IiA/IDAgOiBzb2Z0d2FyZVVwZGF0ZUNhY2hlVGltZTsNCgkJU1NGLlNvZnR3YXJlTG9va3VwU2VydmljZS5UaW1lb3V0ID0gMzAwMDsNCgkJU1NGLkVudmlyb25tZW50ID0gInBybyI7DQoJCS8vSW5pdGlhdGUgc29mdHdhcmUgbG9va3VwIHNlcnZpY2UNCg0KCQlTU0YuU29mdHdhcmVMb29rdXBTZXJ2aWNlLkxvb2t1cChsb29rdXBBcmdzLCBvblN0YXR1cywgb25FcnJvcik7DQoNCg0KDQoJCWZ1bmN0aW9uIG9uU3RhdHVzKHN0YXR1c09iaikgew0KDQoNCgkJCSAvL2NyZWF0ZSB0aGUgVUkNCg0KCQkJIGlmKHN0YXR1c09iai5Qcm9ncmVzcz09IjEwMCIpew0KCQkgCQkvLyQoJyNzd2RJc1ZlcmlmaWVkJykudmFsKCd0cnVlJyk7DQoJCQkJICQoJyNkcml2ZXJzVXBkYXRlJykuaHRtbCgnJyk7DQoJCQkJIHZhciBqc29uID0gW107DQoJCQkJIHZhciB0eXBlID0gIiI7DQoJCQkJIGh0bWwgPSAiIjsNCgkJCQkgdXBkYXRlU2Vzc2lvbigiU1NGIixzdGF0dXNPYmouUmVzdWx0LHByb2R1Y3ROdW1iZXIpOw0KCQkJCSAvL0ZpbmQgaWYgdGhlIFVzZXIgc3lzdGVtIGlzIDY0Yml0IG9yIDMyYml0DQoJCQkJIC8qaWYgKG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiV09XNjQiKSAhPSAtMSB8fCAgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJXaW42NCIpICE9IC0xICl7DQoJCQkJCSB0eXBlID0gIkJhc2ljeDY0IjsNCgkJCQkJfSBlbHNlIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIldPVzMyIikgIT0gLTEgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJXaW4zMiIpICE9IC0xICl7DQoJCQkJCQl0eXBlID0gIkJhc2ljeDg2IjsNCgkJCQkJfSovDQoJCQkJIC8vU2VsZWN0IHRoZSBzb2Z0d2FyZSB1cGRhdGUgZnJvbSBqc29uDQoJCQkJIGZvcihpPTA7aTxzdGF0dXNPYmouUmVzdWx0Lmxlbmd0aDtpKyspew0KCQkJCSBpZihzdGF0dXNPYmouUmVzdWx0W2ldLlR5cGUhPSJOT1QgU1VQUE9SVEVEIil7DQoJCQkJCQkganNvbiA9ICBzdGF0dXNPYmouUmVzdWx0W2ldOw0KDQoJCQkJIC8vaWYgc29mdHdhcmUgdXBkYXRlIGlzIGF2YWlsYWJsZSBzaG93IGl0IHRvIHVzZXINCgkJCQkgaWYoanNvbi5UaXRsZSE9bnVsbCAmJiBqc29uLlRpdGxlIT11bmRlZmluZWQgJiYganNvbi5UeXBlID09ICJGVUxMS0FSTkFLIiAmJiBqc29uLlN0YXR1cyAhPSAiY3VycmVudCIpew0KCQkJCQkgc29sdXRpb25zQ291bnRlciArPTE7DQoJCQkJCSBzb2Z0Q291bnQrKzsNCgkJCQkgCXZhciBpc1VwZGF0ZU5lZWRlZCA9IGpzb24uU3RhdHVzID09ICJub3QgaW5zdGFsbGVkIiA/ICJmYWxzZSIgOiAidHJ1ZSI7DQoJCQkJCS8vY2hlY2tGb3JTbmRTZWN0aW9uVXBkYXRlKGpzb24uU29mdHdhcmVJZCxpc1VwZGF0ZU5lZWRlZCk7DQoJCQkJCXZhciBpc0NyaXRpY2FsID0ganNvbi5TdGF0dXMgPT0gIm5vdCBpbnN0YWxsZWQiID8gdHJ1ZSA6IGZhbHNlOw0KCQkJCQl2YXIgYnV0dG9uVGV4dCA9IGpzb24uU3RhdHVzID09ICJub3QgaW5zdGFsbGVkIiA/IGRvd25sb2FkTGFiZWwgOiB1cGRhdGVMYWJlbDsNCgkJCQkJdmFyIGNsYXNzVG9BZGQgPSBpc0NyaXRpY2FsID8gJ2J1dHRvbiBidXR0b24tc20gY3JpdGljYWwgbm8tbWFyZ2luJyA6ICdidXR0b24gYnV0dG9uLXNtIHByaW1hcnkgbm8tbWFyZ2luJzsNCgkJCQkJLy9UZXJtcyBhbmQgY29uZGl0aW9uIGxpbmsgaXMgYSB0ZW1wb3JhcnkgZml4LiBLaW5kbHkgbWFwIHRoaXMgd2l0aCBjb25jZW50cmEgdXJsLg0KCQkJCQl2YXIgdEFuZENMaW5rID0gJCgnLnN3aW5kZXhUbkMnKS5sZW5ndGggPiAwID8gJCgnLnN3aW5kZXhUbkMnKS5hdHRyKCdocmVmJykgOiAiamF2YXNjcmlwdDp2b2lkKDApOyI7DQoJCQkJCXZhciBwcm9kdWN0TmFtZVZhbHVlID0gJCgnI3Rtc0NsYXNzRm9yU2VhcmNoJykudmFsKCkgPT0gInBtX3Nlcmllc192YWx1ZSIgPyAkKCcjc2VyaWVzTmFtZScpLnZhbCgpIDogJCgnI3BtX3Nlcmllc19wcm9kdWN0X25hbWUnKS52YWwoKTsNCgkJCQkJdmFyIGFjdGlvbk5lZWRlZFRleHQgPSBpc0NyaXRpY2FsID8gaW1wb3J0YW50TGFiZWwgOiByZWNvbW1lbmRlZExhYmVsOw0KCQkJCQl2YXIgYWN0aW9uTmVlZGVkVG9vbHRpcCA9IGlzQ3JpdGljYWwgPyBpbXBvcnRhbnREZXNjIDogcmVjb21tZW5kZWREZXNjOw0KICAgICAgICAgICAgICAgICAgICB2YXIgc29mdEh0bWwgPSAnJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8ZGl2IGNsYXNzPSJocC1yb3cgaHAtcm93LXNtIj4nOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29mdEh0bWwgKz0gJzxkaXYgY2xhc3M9ImNvbC1sZy0xNiI+JzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8aDU+Jytqc29uLlRpdGxlKyc6Jm5ic3A7JzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8c3BhbiBjbGFzcz0idGV4dC1jcml0aWNhbCB3aXRoLXRvb2x0aXAiIGRhdGEtdG9nZ2xlPSJwb3BvdmVyIiBkYXRhLXBsYWNlbWVudD0idG9wIiBkYXRhLWNvbnRlbnQ9IicrYWN0aW9uTmVlZGVkVG9vbHRpcCsnIiBkYXRhLW9yaWdpbmFsLXRpdGxlPSIiIHRpdGxlPSIiPicrYWN0aW9uTmVlZGVkVGV4dCsnPC9zcGFuPic7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2Z0SHRtbCArPSAnPC9oNT4nOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29mdEh0bWwgKz0gJzxwPicranNvbi5EZXNjcmlwdGlvbisnPC9wPic7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2Z0SHRtbCArPSAnPC9kaXY+JzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8ZGl2IGNsYXNzPSJjb2wtbGctOCBhbGlnbi1yaWdodCI+JzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8cD48YSBjbGFzcz0iJytjbGFzc1RvQWRkKycgaHBkaWFCdXR0b24gc29sSHBEaWEiIHRpdGxlPSInK2J1dHRvblRleHQrJyIgdXRpbGl0eXRpdGxlPSInK2pzb24uVGl0bGUrJyIgdXRpbGl0eXBhZ2V0eXBlPSJTU0ZSZXN1bHRzIiBTb2Z0SWQ9IicranNvbi5GdHBVUkwuc3BsaXQoJy8nKVtqc29uLkZ0cFVSTC5zcGxpdCgnLycpLmxlbmd0aC0yXSsnIiB1dGlsaXR5dmFsdWU9IicranNvbi5GdHBVUkwuc3BsaXQoJy8nKVtqc29uLkZ0cFVSTC5zcGxpdCgnLycpLmxlbmd0aC0xXSsnIiBocmVmPSInK2pzb24uRnRwVVJMLnJlcGxhY2UoJ2Z0cDovLycsJ2h0dHA6Ly8nKSsnIj4nK2J1dHRvblRleHQrJzwvYT48L3A+JzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8cCBjbGFzcz0idGV4dC1zbWFsbCI+JytJRF9wcHNfbGJsX0RNRF9Eb3dubG9hZEFncmVlbWVudCsnIDxhIGNsYXNzPSJzd2luZGV4VE5DIiB0YXJnZXQ9Il9ibGFuayI+JytJRF9wcHNfbGJsX1NXRF9UZXJtc09mVXNlKyc8L2E+PC9wPic7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2Z0SHRtbCArPSAnPC9kaXY+JzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8L2Rpdj4nOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2RyaXZlcnNVcGRhdGUnKS5hcHBlbmQoc29mdEh0bWwpOw0KDQoJCQkJCQkJCQkkKCcuc29sSHBEaWEnKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCl7DQoJCQkJCQkJCQkJaWYgKFNTRi5IUERJQS5Vc2VIUERJQSAmJiBTU0YuSFBESUEuSXNFbnZpcm9ubWVudFN1cHBvcnRlZCgpICYmIFNTRi5IUERJQS5Jc1NTTFN1cHBvcnRlZFNlcnZlck9yQ291bnRyeSgpKXsNCgkJCQkJCQkJICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCgkJCQkJCQkJICAgICAgICAgICAgJCgnI0hwZGlhX09wdEluRGlhbG9nX0J0bk5leHQnKS5hdHRyKCdocmVmJywkKHRoaXMpLmF0dHIoJ2hyZWYnKSk7DQoJCQkJCQkJCSAgICAgICAgfQ0KCQkJCQkJCQkJfSk7DQoNCgkJCQkJIGNvdW50ZXIgPSBjb3VudGVyICsgMTsNCg0KCQkJCSB9DQoNCg0KCQkJCSB9DQoJCQkJIH0NCg0KDQoJCQkJIC8vJCgnI3Nob3dQcm9ncmVzcycpLmhpZGUoKTsNCgkJCQkgaXNTb2Z0VXBkYXRlRm91bmQgPSB0cnVlOw0KCQkJCSBzc2ZQYXJhbXMuaXNTb2Z0d2FyZVJ1biA9IHRydWU7DQoJCQkJIHNob3dTb2xzUmVzdWx0KCk7DQoJCQkJIHdpbmRvdy5zZXRUaW1lb3V0KGNoZWNrRm9yU25kU2VjdGlvblVwZGF0ZSwxMzAwKTsNCgkJCSB9DQoNCg0KCQl9DQoNCg0KDQoJCWZ1bmN0aW9uIG9uRXJyb3IocmVxdWVzdCwgc3RhdHVzLCBlcnJvcikgew0KCQkgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoZXJyb3IpKTsNCgkJICAgIGlzU29mdFVwZGF0ZU5vdEZvdW5kID0gdHJ1ZTsNCgkJICAgIHNzZlBhcmFtcy5pc1NvZnR3YXJlUnVuID0gdHJ1ZTsNCgkJCQkgc2hvd1NvbHNSZXN1bHQoKTsNCgkJfQ0KfQ0KDQpmdW5jdGlvbiBmaW5kQUNMTVNvbHV0aW9uU2VydmljZSgpew0KCXNzZlBhcmFtcy5zc2ZJbml0ID0gdHJ1ZTsNCglzc2ZQYXJhbXMuaXNWZXJpZmllZCA9IHRydWU7DQoJc3NmUGFyYW1zLmlzU29mdHdhcmVSdW4gPSBmYWxzZTsNCg0KCS8vQUNMTSBsb29rdXAgcGFyYW0NCgl2YXIgZmluZEFyZ3MgPSB7DQogICAgICAgIExDOiBsYywNCgkgICAgQ0M6IGNjLA0KICAgICAgICBQcm9kdWN0TmFtZU9pZDpzdXBwb3J0TmFtZU9pZCwNCiAgICAgICAgRW52aXJvbm1lbnQ6IGVudlZhcmlhYmxlLA0KICAgICAgICB4bWxWYWx1ZTogImZhbHNlIg0KDQogICAgfTsNCg0KICAgIFNTRi5BY3RpdmVDaGVja0xvY2FsTW9kZS5DYWNoZWRSZXN1bHRzRXhwaXJhdGlvbiA9IGlzUmV0cnkgPT0gInJldHJ5IiA/IDAgOiBhY2xtQ2FjaGVUaW1lOw0KICAgIFNTRi5BY3RpdmVDaGVja0xvY2FsTW9kZS5UaW1lb3V0ID0gMTUwOw0KDQoJLy9Jbml0aWF0ZSBzb2Z0d2FyZSBsb29rdXAgc2VydmljZQ0KICAgIFNTRi5BY3RpdmVDaGVja0xvY2FsTW9kZS5Mb29rdXAoZmluZEFyZ3MsIG9uU3RhdHVzLCBvbkVycm9yKTsNCg0KCWZ1bmN0aW9uIG9uU3RhdHVzKHN0YXR1c09iaikgew0KDQoJCSAvL2NyZWF0ZSB0aGUgVUkNCgkJIGlmKHN0YXR1c09iai5Qcm9ncmVzcz09IjEwMCIpew0KCQkgCS8vJCgnI3N3ZElzVmVyaWZpZWQnKS52YWwoJ3RydWUnKTsNCgkJCSAkKCcjZHJpdmVyc1VwZGF0ZScpLmh0bWwoJycpOw0KCQkJIC8vdXBkYXRlU2Vzc2lvbigiU1NGIixzdGF0dXNPYmouUmVzdWx0LHByb2R1Y3ROdW1iZXIpOw0KDQoJCQkgLy9IYW5kbGUgc3VjY2VzcyBqc29uIGNvbnRhaW5pbmcgZXJyb3IgbWVzc2FnZS4gRXhhbXBsZTogeyJjb2RlIjoyMDAsInN0YXR1cyI6InN1Y2Nlc3MiLCJtZXNzYWdlIjpudWxsLCJSZXN1bHREYXRlIjoiMjAxNS0wMS0wN1QxMjozMDoyMC43OTI5MDU1WiIsIlByb2dyZXNzIjoxMDAsIlJlc3VsdCI6IjxlcnJvcj5PYmplY3QgcmVmZXJlbmNlIG5vdCBzZXQgdG8gYW4gaW5zdGFuY2Ugb2YgYW4gb2JqZWN0LjwvZXJyb3I+In0NCgkJCSBpZihzdGF0dXNPYmouUmVzdWx0Lmxlbmd0aCA8IDEgfHwgc3RhdHVzT2JqLlJlc3VsdFswXS5GUkVFSU5GTyA9PSB1bmRlZmluZWQpew0KCQkJIAlpc1NvZnRVcGRhdGVOb3RGb3VuZCA9IHRydWU7DQoJCQkgICAgLy9pc1NvbEZvdW5kID0gdHJ1ZTsNCgkJCQlpc1NvZnRVcGRhdGVGb3VuZCA9IHRydWU7DQoJCQkgICAgaXNBY2xtRXJyb3IgPSB0cnVlOw0KCQkJICAgIHNob3dTb2xzUmVzdWx0KCk7DQoJCQkgfQ0KDQoJCQkgJC5lYWNoKHN0YXR1c09iai5SZXN1bHQsIGZ1bmN0aW9uKGlkeCx2YWwpew0KCQkJIAl2YXIgY29udGVudERlc2NyaXB0aW9uID0gdmFsLkZSRUVJTkZPLkRFU0NSSVBUSU9OLnJlcGxhY2UoL1xuL2csJycpOw0KCQkJIAl2YXIgdXBkYXRlVGl0bGUgPSB2YWwuRlJFRUlORk8uVElUTEU7DQoJCQkgCXZhciB1dGlsaXR5dGl0bGUgPSB2YWwuRlJFRUlORk8uVFlQRS5uYW1lOw0KCQkJIAl2YXIgaXNDcml0aWNhbCA9IHZhbC5GUkVFSU5GTy5TRVZFUklUWSA9PSAiQWxlcnQiID8gdHJ1ZSA6IGZhbHNlOw0KCQkJIAl2YXIgYWN0aW9uTmVlZGVkVGV4dCA9IGlzQ3JpdGljYWwgPyBpbXBvcnRhbnRMYWJlbCA6IHJlY29tbWVuZGVkTGFiZWw7DQoJCQkJdmFyIGFjdGlvbk5lZWRlZFRvb2x0aXAgPSBpc0NyaXRpY2FsID8gaW1wb3J0YW50RGVzYyA6IHJlY29tbWVuZGVkRGVzYzsNCgkJCQl2YXIgY2xhc3NUb0FkZCA9IGlzQ3JpdGljYWwgPyAnYnV0dG9uIGJ1dHRvbi1zbSBjcml0aWNhbCBuby1tYXJnaW4nIDogJ2J1dHRvbiBidXR0b24tc20gcHJpbWFyeSBuby1tYXJnaW4nOw0KCQkJCS8vdmFyIGJ1dHRvblRleHQgPSBpc0NyaXRpY2FsID8gZG93bmxvYWRMYWJlbCA6IHVwZGF0ZUxhYmVsOw0KCQkJCXZhciBidXR0b25UZXh0ID0gZG93bmxvYWRMYWJlbDsgLy9ObyBwYXJhbSB0byBjaGVjayB1cGRhdGUgb3IgZG93bmxvYWQuDQoJCQkJdmFyIHNwTmFtZSA9IHZhbC5GUkVFSU5GTy5UWVBFLnNwbmFtZTsNCgkJCQkvL3ZhciBzc21Mb2NhdGlvbiA9IHZhbC5GUkVFSU5GTy5UWVBFLlNTTVBhY2tGdHBMb2NhdGlvbi5yZXBsYWNlKCdmdHA6Ly8nLCdodHRwOi8vJyk7DQoJCQkJLy9ocGRpYUZ0cFByZWZpeCBpcyBkZWZpbmVkIGFuZCBleHRlcm5hbGl6ZWQgaW4gaHAtZGV0ZWN0LWxvYWQtbXktZGV2aWNlIHBvcnRsZXQgLSBkZXRlY3RNeURldmljZURpdi5qc3ANCgkJCQl2YXIgc3NtTG9jYXRpb24gPSBocGRpYUZ0cFByZWZpeCArIEdldFNvZnRwYXFGVFBQYXRoKHNwTmFtZSkgKyAiLyIgKyBzcE5hbWUgKyAiLmV4ZSI7DQoJCQkJc3NtTG9jYXRpb24gPSBzc21Mb2NhdGlvbi50b0xvd2VyQ2FzZSgpOw0KCQkJCXZhciB0b29sdGlwQ2xhc3MgPSBpc0NyaXRpY2FsID8gInRleHQtY3JpdGljYWwgd2l0aC10b29sdGlwIiA6ICJ0ZXh0LWJsdWUgd2l0aC10b29sdGlwIjsNCgkJCQlzb2x1dGlvbnNDb3VudGVyICs9MTsNCgkJCQlzb2Z0Q291bnQrKzsNCgkJCQl2YXIgcHJvZHVjdE5hbWVWYWx1ZSA9ICQoJyN0bXNDbGFzc0ZvclNlYXJjaCcpLnZhbCgpID09ICJwbV9zZXJpZXNfdmFsdWUiID8gJCgnI3Nlcmllc05hbWUnKS52YWwoKSA6ICQoJyNwbV9zZXJpZXNfcHJvZHVjdF9uYW1lJykudmFsKCk7DQoJICAgICAgICAgICAgdmFyIHNvZnRIdG1sID0gJyc7DQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8ZGl2IGNsYXNzPSJocC1yb3cgaHAtcm93LXNtIj4nOw0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2Z0SHRtbCArPSAnPGRpdiBjbGFzcz0iY29sLWxnLTE2Ij4nOw0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2Z0SHRtbCArPSAnPGg1PicrdXBkYXRlVGl0bGUrJzombmJzcDsnOw0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2Z0SHRtbCArPSAnPHNwYW4gY2xhc3M9IicrdG9vbHRpcENsYXNzKyciIGRhdGEtdG9nZ2xlPSJwb3BvdmVyIiBkYXRhLXBsYWNlbWVudD0idG9wIiBkYXRhLWNvbnRlbnQ9IicrYWN0aW9uTmVlZGVkVG9vbHRpcCsnIiBkYXRhLW9yaWdpbmFsLXRpdGxlPSIiIHRpdGxlPSIiPicrYWN0aW9uTmVlZGVkVGV4dCsnPC9zcGFuPic7DQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8L2g1Pic7DQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8cD4nK2NvbnRlbnREZXNjcmlwdGlvbisnPC9wPic7DQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8L2Rpdj4nOw0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2Z0SHRtbCArPSAnPGRpdiBjbGFzcz0iY29sLWxnLTggYWxpZ24tcmlnaHQiPic7DQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8cD48YSBjbGFzcz0iJytjbGFzc1RvQWRkKycgaHBkaWFCdXR0b24gc29sSHBEaWEiIHRpdGxlPSInK2J1dHRvblRleHQrJyIgdXRpbGl0eXRpdGxlPSInK3V0aWxpdHl0aXRsZSsnIiB1dGlsaXR5cGFnZXR5cGU9IlNTRlJlc3VsdHMiIFNvZnRJZD0iJytzcE5hbWUrJyIgdXRpbGl0eXZhbHVlPSInK3NwTmFtZSsnLmV4ZSIgaHJlZj0iJytzc21Mb2NhdGlvbisnIj4nK2J1dHRvblRleHQrJzwvYT48L3A+JzsNCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29mdEh0bWwgKz0gJzxwIGNsYXNzPSJ0ZXh0LXNtYWxsIj4nK0lEX3Bwc19sYmxfRE1EX0Rvd25sb2FkQWdyZWVtZW50KycgPGEgY2xhc3M9InN3aW5kZXhUTkMiIHRhcmdldD0iX2JsYW5rIj4nK0lEX3Bwc19sYmxfU1dEX1Rlcm1zT2ZVc2UrJzwvYT48L3A+JzsNCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29mdEh0bWwgKz0gJzwvZGl2Pic7DQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvZnRIdG1sICs9ICc8L2Rpdj4nOw0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjZHJpdmVyc1VwZGF0ZScpLmFwcGVuZChzb2Z0SHRtbCk7DQoNCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9UaGlzIGlzIHRvIHBsYWNlIHRoZSBjcml0aWNhbCBvbmVzIG9uIHRoZSB0b3AuDQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNkcml2ZXJzVXBkYXRlJykucHJlcGVuZCgkKCcudGV4dC1jcml0aWNhbC53aXRoLXRvb2x0aXAnKS5wYXJlbnRzKCcuaHAtcm93LmhwLXJvdy1zbScpKTsNCg0KCQkJCQkJCQkkKCcuc29sSHBEaWEnKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCl7DQoJCQkJCQkJCQlpZiAoU1NGLkhQRElBLlVzZUhQRElBICYmIFNTRi5IUERJQS5Jc0Vudmlyb25tZW50U3VwcG9ydGVkKCkgJiYgU1NGLkhQRElBLklzU1NMU3VwcG9ydGVkU2VydmVyT3JDb3VudHJ5KCkpew0KCQkJCQkJCSAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQkJCQkJICAgICAgICAgICAgJCgnI0hwZGlhX09wdEluRGlhbG9nX0J0bk5leHQnKS5hdHRyKCdocmVmJywkKHRoaXMpLmF0dHIoJ2hyZWYnKSk7DQoJCQkJCQkJICAgICAgICB9DQoJCQkJCQkJCX0pOw0KCQkJCS8vJCgnI2RyaXZlcnNVcGRhdGUnKQ0KCQkJCSBjb3VudGVyID0gY291bnRlciArIDE7DQoJCQkJLy9pc1NvbEZvdW5kID0gdHJ1ZTsNCgkJCQlpc1NvZnRVcGRhdGVGb3VuZCA9IHRydWU7DQoJCQkJc3NmUGFyYW1zLmlzU29mdHdhcmVSdW4gPSB0cnVlOw0KCQkJCXNob3dTb2xzUmVzdWx0KCk7DQoJCQkJd2luZG93LnNldFRpbWVvdXQoY2hlY2tGb3JTbmRTZWN0aW9uVXBkYXRlLDEzMDApOw0KCQkJfSk7DQoJCX0NCgl9DQoNCglmdW5jdGlvbiBvbkVycm9yKHJlcXVlc3QsIHN0YXR1cywgZXJyb3IpIHsNCgkgICAgLy9jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShlcnJvcikpOw0KCSAgICBpc1NvZnRVcGRhdGVOb3RGb3VuZCA9IHRydWU7DQoJICAgIC8vaXNTb2xGb3VuZCA9IHRydWU7DQoJCWlzU29mdFVwZGF0ZUZvdW5kID0gdHJ1ZTsNCgkgICAgaXNBY2xtRXJyb3IgPSB0cnVlOw0KCSAgICBzc2ZQYXJhbXMuaXNTb2Z0d2FyZVJ1biA9IHRydWU7DQoJICAgIHNob3dTb2xzUmVzdWx0KCk7DQoJfQ0KfQ0KDQpmdW5jdGlvbiBmaW5kU29sdXRpb25TZXJ2aWNlKCl7DQoNCglhZGRyZXNzID0gYWRkcmVzcyA9PSAiIiB8fCBhZGRyZXNzID09ICJodHRwczovLyIgfHwgYWRkcmVzcyA9PSAiaHR0cDovLyIgPyAiaHR0cHM6Ly9sb2NhbGhvc3QiIDogYWRkcmVzczsNCglzc2ZQYXJhbXMuaXNTb2x1dGlvblJ1biA9IGZhbHNlOw0KCXZhciBwcm9kdWN0TmFtZU9pZEZvclNvbHV0aW9uID0gcHJvZHVjdE5hbWVPaWQxID09IHVuZGVmaW5lZCA/IHByb2R1Y3ROYW1lT2lkIDogcHJvZHVjdE5hbWVPaWQxOw0KDQoJLy9maW5kIHNvbHV0aW9uIHBhcmFtDQoJdmFyIGZpbmRBcmdzID0gew0KCQkgICAgTEM6IGxjLA0KCQkgICAgQ0M6IGNjLA0KCQkgICAgQWRkcmVzczogYWRkcmVzcywgLy8iZmlsZTovL0M6L2xlZG0vQ1gwMzhBIiwvLytwcm9kdWN0TnVtYmVyLCAvLyJodHRwOi8vIithZGRyZXNzKyIvbGVkbS9DWDAzOEEiLC8vYWRkcmVzcywvLyJodHRwOi8vMTkyLjE2OC4xLjE2OjgwLyIsDQoJCSAgICBQcm9kdWN0TGluZTogcHJvZHVjdExpbmUsDQoJCSAgICBQcm9kdWN0TmFtZU9pZDogcHJvZHVjdE5hbWVPaWRGb3JTb2x1dGlvbiwNCgkJICAgIFByb2R1Y3ROdW1iZXI6IHByb2R1Y3ROdW1iZXIsDQoJCSAgICBDbGllbnQ6IGNsaWVudE5hbWUsDQoJCSAgICBXYXJyYW50eVN0YXR1czogIm5vIg0KCQl9Ow0KCQl2YXIgc3NmU29sdXRpb25DYWNoZUludGVydmFsID0galF1ZXJ5KCIjc3NmU29sdXRpb25DYWNoZUludGVydmFsVmFsdWUiKS52YWwoKTsNCgkJU1NGLlNvbHV0aW9uRmluZGluZ1NlcnZpY2UuQ2FjaGVkUmVzdWx0c0V4cGlyYXRpb24gPSBzc2ZTb2x1dGlvbkNhY2hlSW50ZXJ2YWw7DQoJCVNTRi5Tb2x1dGlvbkZpbmRpbmdTZXJ2aWNlLlRpbWVvdXQgPSAxNTA7DQoJCS8vSW5pdGlhdGUgZmluZCBzb2x1dGlvbiBzZXJ2aWNlDQoJCVNTRi5Tb2x1dGlvbkZpbmRpbmdTZXJ2aWNlLkZpbmQoZmluZEFyZ3MsIG9uU3RhdHVzLCBvbkVycm9yKTsNCg0KDQoNCgkJZnVuY3Rpb24gb25TdGF0dXMoc3RhdHVzT2JqKSB7DQoJCSAgICBodG1sID0gIiI7DQoNCgkJCSBpZihzdGF0dXNPYmouUHJvZ3Jlc3M9PSIxMDAiKXsNCgkJCQkgdHJhY2tJRCA9IFtdOw0KCQkJCSBjcml0aWNhbFNvbCA9IFtdOw0KCQkJCSBub3JtYWxTb2wgPSBbXTsNCgkJCQkgaHRtbCA9ICIiOw0KCQkJCSAvL2pRdWVyeSgiI3Nob3dQcm9ncmVzcyIpLmZhZGVPdXQoIjgwMCIpOw0KCQkJCSBzc2ZPYmplY3QgPSBzdGF0dXNPYmouUmVzdWx0Ow0KDQoJCQkJIC8vQ2hlY2sgaWYgdGhlcmUgaXMgZXJyb3INCgkJCQkgaWYoc3RhdHVzT2JqLlJlc3VsdC5FcnJvciE9dW5kZWZpbmVkKXsNCg0KCQkJCQkgLy9IYW5kbGUgZXJyb3INCgkJCQkgfQ0KDQoJCQkJIC8vYWZ0ZXIgY29tcGxldGUgc2NhbiBvciBjYWNoZWQgc2hvdyBzb2x1dGlvbg0KCQkJCSBlbHNlIGlmKHN0YXR1c09iai5SZXN1bHQuSnNvblJlc3VsdC5Tb2x1dGlvbnMuU2ZzIT11bmRlZmluZWQpew0KCQkJCQkgdmFyIGNsZWFuSnNvbiA9IFtdOw0KCQkJCQkgdmFyIHRlbXBKc29uID0gW107DQoJCQkJCSB2YXIgc2Vzc2lvblJlc3VsdCA9IFtdOw0KCQkJCQkgdmFyIHNvbHV0aW9uc0pzb24gPSBzdGF0dXNPYmouUmVzdWx0Lkpzb25SZXN1bHQuU29sdXRpb25zLlNmczsNCgkJCQkJIHZhciBzZXNzaW9uSWRTdHJpbmcgPSAiIjsNCg0KDQoJCQkJCSAvL3NvcnQgdGhlIHJlc3VsdCBvbiBzZXZlcml0eSBhbmQgcmVtb3ZlIGFsbCBkdXBsaWNhdGUgYW5kIHVud2FudGVkIHJlc3VsdCcNCgkJCQkJCWZvcihpPTA7aTxzb2x1dGlvbnNKc29uLmxlbmd0aDtpKyspew0KDQoJCQkJCQkJaWYoaT09MCl7DQoJCQkJCQkJCXNlc3Npb25JZFN0cmluZyA9IHNvbHV0aW9uc0pzb25baV0uU2Vzc2lvbklkOw0KCQkJCQkJCX0NCgkJCQkJCQllbHNlew0KCQkJCQkJCQlzZXNzaW9uSWRTdHJpbmcgPSBzZXNzaW9uSWRTdHJpbmcgKyAiLCIgKyBzb2x1dGlvbnNKc29uW2ldLlNlc3Npb25JZDsNCgkJCQkJCQl9DQoNCgkJCQkJCQlpZihzb2x1dGlvbnNKc29uW2ldLklkIT1udWxsICYmIHNvbHV0aW9uc0pzb25baV0uU29sdXRpb25UeXBlID09ICJTb2x1dGlvbkZvdW5kIiAmJiBzb2x1dGlvbnNKc29uW2ldLlVyaVR5cGUgPT0gIlNvbHV0aW9uUGFnZSIpew0KCQkJCQkJCQljbGVhbkpzb24ucHVzaChzb2x1dGlvbnNKc29uW2ldKTsNCgkJCQkJCQl9DQoJCQkJCQkJZWxzZXsNCgkJCQkJCQkJdGVtcEpzb24ucHVzaChzb2x1dGlvbnNKc29uW2ldKTsNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCQlpZihjbGVhbkpzb24ubGVuZ3RoPjApew0KCQkJCQkJCXNlc3Npb25SZXN1bHQucHVzaChjbGVhbkpzb24pOw0KCQkJCQkJfQ0KCQkJCQkJCWZvcihqPTA7ajx0ZW1wSnNvbi5sZW5ndGg7aisrKXsNCgkJCQkJCQkJaWYoc2Vzc2lvblJlc3VsdC5sZW5ndGg8NSl7DQoJCQkJCQkJCQlzZXNzaW9uUmVzdWx0LnB1c2godGVtcEpzb25bal0pOw0KCQkJCQkJCQl9DQoJCQkJCQkJfQ0KDQoJCQkJCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgic2Vzc2lvbklkIixzZXNzaW9uSWRTdHJpbmcpOw0KCQkJCQkgc29ydFJlc3VsdChjbGVhbkpzb24pOw0KCQkJCQkgdXBkYXRlU2Vzc2lvbigiU0ZTIixzb2x1dGlvbnNKc29uLHByb2R1Y3ROdW1iZXIpOw0KCQkJCSB9DQoJCQkJIGlzU29sRm91bmQgPSB0cnVlOw0KCQkJCSBzc2ZQYXJhbXMuaXNTb2x1dGlvblJ1biA9IHRydWU7DQoJCQkJIHNob3dTb2xzUmVzdWx0KCk7DQoJCQkJIC8vR2VuZXJhdGUgdGhlIEhUTUwgdXNpbmcgY3JpcmNhbCBhbmQgbm9ybWFsIHNvbHV0aW9uIGFycmF5DQoNCgkJCSB9DQoNCgkJfQ0KDQoJCWZ1bmN0aW9uIG9uRXJyb3IocmVxdWVzdCwgc3RhdHVzLCBlcnJvcikgew0KCQkgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoZXJyb3IpKTsNCgkJCWlzU29sRm91bmQgPSB0cnVlOw0KCQkJc3NmUGFyYW1zLmlzU29sdXRpb25SdW4gPSB0cnVlOw0KCQkgCXNob3dTb2xzUmVzdWx0KCk7DQoJCX0NCg0KCQkvL1FBUkkNCgkJdmFyIHBhcmFtZXRlcnMgPSB7DQoJCSAgICBBZGRyZXNzOiBhZGRyZXNzLA0KCQkgICAgTEM6IGxjLA0KCQkgICAgQ0M6IGNjLA0KCQkgICAgQ2xpZW50OiBjbGllbnROYW1lLA0KCQkgICAgUHJvZHVjdExpbmU6IHByb2R1Y3RMaW5lLA0KCQkgICAgQ2FjaGVkUmVzdWx0c0V4cGlyYXRpb246IHNzZlNvbHV0aW9uQ2FjaGVJbnRlcnZhbCwNCgkJICAgIFRpbWVvdXQ6IDMwMCwNCgkJICAgIFNlcnZpY2VzOiJjb21wcmVzc29yIg0KCQl9Ow0KDQoJCVNTRi5RQVJJLlJ1bihwYXJhbWV0ZXJzLCBvblN0YXR1c0NhbGxiYWNrLCBvbkVycm9yQ2FsbGJhY2spOw0KDQoNCgkJZnVuY3Rpb24gb25TdGF0dXNDYWxsYmFjayhyZXN1bHRzKSB7DQogCQkJY29uc29sZS5sb2cocmVzdWx0cyk7DQoJCX0NCg0KCQlmdW5jdGlvbiBvbkVycm9yQ2FsbGJhY2socmVzdWx0cykgew0KIAkJCWNvbnNvbGUubG9nKHJlc3VsdHMpOw0KCQl9DQp9DQoNCmZ1bmN0aW9uIGdlbmVyYXRlU29sdXRpb25IdG1sKCl7DQoJdmFyIGh0bWw9IiI7DQoJJCgnI2R2Q3JpdGljYWxTb2x1dGlvbnMnKS5odG1sKCcnKTsNCgkkKCcjZHZQb3RlbnRpYWxTb2x1dGlvbnMnKS5odG1sKCcnKTsNCgkvL2lmKCQoJyNkdkNyaXRpY2FsU29sdXRpb25zJykuaHRtbCgpID09ICIiKXsNCgkJZm9yKGk9MDtpPGNyaXRpY2FsU29sLmxlbmd0aDtpKyspew0KCQkvL2dlbmVyYXRlIHNvbHV0aW9ucyBmcm9tIGNyaXRpY2FsIHNvbHV0aW9ucyBhcnJheQ0KDQoJCQl2YXIgU29sSHRtbCA9ICcnOw0KCQkJU29sSHRtbCA9IFNvbEh0bWwgKyAnPHA+JzsNCgkJCVNvbEh0bWwgPSBTb2xIdG1sICsgJzxhIGhyZWY9IicrY3JpdGljYWxTb2xbaV0uaGVscFVSSSsnIj48c3BhbiBjbGFzcz0iZmEgZmEtZmlsZS10ZXh0LW8iPjwvc3Bhbj4gJytjcml0aWNhbFNvbFtpXS50aXRsZS5yZXBsYWNlKC9ETURERUxJTS9nLCInIikrJzwvYT48YnIvPic7DQoJCQlTb2xIdG1sID0gU29sSHRtbCArIGNyaXRpY2FsU29sW2ldLmRpc2NyaXB0aW9uLnJlcGxhY2UoL0RNRERFTElNL2csIiciKTsNCgkJCVNvbEh0bWwgPSBTb2xIdG1sICsgJzwvcD4nOw0KCQkJJCgnI2R2Q3JpdGljYWxTb2x1dGlvbnMnKS5hcHBlbmQoU29sSHRtbCk7DQoJCQlzb2x1dGlvbnNDb3VudGVyKys7DQoJCQkgJCgnI2R2Q3JpdGljYWwnKS5mYWRlSW4oJzgwMCcpOw0KDQoJCX0NCg0KCQlmb3Ioaj0wO2o8bm9ybWFsU29sLmxlbmd0aDtqKyspew0KDQoJCQl2YXIgU29sSHRtbCA9ICcnOw0KCQkJU29sSHRtbCA9IFNvbEh0bWwgKyAnPHA+JzsNCgkJCVNvbEh0bWwgPSBTb2xIdG1sICsgJzxhIGhyZWY9Iicrbm9ybWFsU29sW2pdLmhlbHBVUkkrJyI+PHNwYW4gY2xhc3M9ImZhIGZhLWZpbGUtdGV4dC1vIj48L3NwYW4+ICcrbm9ybWFsU29sW2pdLnRpdGxlLnJlcGxhY2UoL0RNRERFTElNL2csIiciKSsnPC9hPjxici8+JzsNCgkJCVNvbEh0bWwgPSBTb2xIdG1sICsgbm9ybWFsU29sW2pdLmRpc2NyaXB0aW9uLnJlcGxhY2UoL0RNRERFTElNL2csIiciKTsNCgkJCVNvbEh0bWwgPSBTb2xIdG1sICsgJzwvcD4nOw0KCQkJc29sdXRpb25zQ291bnRlcisrOw0KCQkJJCgnI2R2UG90ZW50aWFsU29sdXRpb25zJykuYXBwZW5kKFNvbEh0bWwpOw0KDQoJCQkgJCgnI2R2UG90ZW50aWFsJykuZmFkZUluKCc4MDAnKTsNCgkJfQ0KDQoNCn0NCg0KLy9Tb3J0IFJlc3VsdA0KZnVuY3Rpb24gc29ydFJlc3VsdChzb2x1dGlvbnNKc29uKXsNCg0KCWlmKHNvbHV0aW9uc0pzb24ubGVuZ3RoPjApew0KDQoJCWZvcihpPTA7aTxzb2x1dGlvbnNKc29uLmxlbmd0aDtpKyspew0KCQkJaWYodHJhY2tJRC5sZW5ndGggPT0gMCl7DQoJCQkJLy9wdXNoRmlyc3Qgc29sdXRpb24gdG8gYWxsIHJlbGV2ZW50IGFycmF5DQoJCQkJcHVzaFRvVHJhY2tJRChzb2x1dGlvbnNKc29uW2ldKTsNCgkJCX0NCgkJCWVsc2V7DQoJCQkJLy9uZXh0IG9iamVjdCBvbndhcmRzIGNoZWNrIGlmIGl0IGlzIGR1cGxpY2F0ZSByZXN1bHQNCgkJCQljaGVja0R1cGxpY2F0ZUVudHJ5KHNvbHV0aW9uc0pzb25baV0pOw0KCQkJfQ0KDQoJCX0NCgl9DQoJZWxzZXsNCgl9DQoJZ2VuZXJhdGVTb2x1dGlvbkh0bWwoKTsNCg0KfQ0KDQpmdW5jdGlvbiBwdXNoVG9UcmFja0lEKHNvbHV0aW9uSnNvbil7DQoJLy9hZGQgcmVzdWx0cyB0byByZWxhdmVudCBhcnJheQ0KCXZhciBpZCA9IHNvbHV0aW9uSnNvbi5JZDsNCgl2YXIgdGl0bGUgPSBzb2x1dGlvbkpzb24uVGl0bGU7DQoJdmFyIGRpc2NyaXB0aW9uID0gc29sdXRpb25Kc29uLkRlc2NyaXB0aW9uOw0KCXZhciBwZHBVUkwgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5yZXBsYWNlKCIvc29sdXRpb24iLCIiKTsNCgl2YXIgcXVlcnlQYXJhbSA9IHBkcFVSTC5zcGxpdCgiPyIpOw0KDQoJLy92YXIgaGVscFVSSSA9IHF1ZXJ5UGFyYW1bMF0gKyIvZG9jdW1lbnQvIisgc29sdXRpb25Kc29uLklkOw0KCS8vaGVscFVSSSA9IGhlbHBVUkkgKyAiPyIgKyBxdWVyeVBhcmFtWzFdOw0KCXZhciBoZWxwVVJJID0gc29sdXRpb25Kc29uLlVyaTsNCgl2YXIgc2V2ZXJpdHkgPSBzb2x1dGlvbkpzb24uU2lnbmF0dXJlLlNldmVyaXR5Ow0KCXRyYWNrSUQucHVzaCh7ImlkIjppZCwic2V2ZXJpdHkiOnNldmVyaXR5fSk7DQoJaWYoc29sdXRpb25Kc29uLlNpZ25hdHVyZS5TZXZlcml0eSA9PSAiQ3JpdGljYWwiKXsNCgkJc29sdXRpb25zQ291bnQrKzsNCgkJLy9zb2x1dGlvbnNDb3VudGVyKys7DQoJCWNyaXRpY2FsU29sLnB1c2goeyJpZCI6aWQsInNldmVyaXR5IjpzZXZlcml0eSwidGl0bGUiOnRpdGxlLCAiZGlzY3JpcHRpb24iOmRpc2NyaXB0aW9uLCAiaGVscFVSSSI6aGVscFVSSX0pOw0KCX0NCgllbHNlIGlmKHNvbHV0aW9uSnNvbi5TaWduYXR1cmUuU2V2ZXJpdHkgPT0gbnVsbCl7DQoJCXNvbHV0aW9uc0NvdW50Kys7DQoJCS8vc29sdXRpb25zQ291bnRlcisrOw0KCQlub3JtYWxTb2wucHVzaCh7ImlkIjppZCwic2V2ZXJpdHkiOnNldmVyaXR5LCJ0aXRsZSI6dGl0bGUsICJkaXNjcmlwdGlvbiI6ZGlzY3JpcHRpb24sICJoZWxwVVJJIjpoZWxwVVJJfSk7DQoJfQ0KfQ0KDQoNCg0KZnVuY3Rpb24gY2hlY2tEdXBsaWNhdGVFbnRyeShzb2x1dGlvbnNKc29uKXsNCg0KCXZhciBpc0R1cGxpY2F0ZSA9IGZhbHNlOw0KCXZhciB0cmFja0lkID0gMDsNCgkvL2V4dHJhY3QgZHVwbGljYXRlIHZhbHVlcw0KCWZvcih2YXIgaT0wO2k8dHJhY2tJRC5sZW5ndGg7aSsrKXsNCgkJaWYodHJhY2tJRFtpXS5pZD09c29sdXRpb25zSnNvbi5JZCAmJiBzb2x1dGlvbnNKc29uLlNpZ25hdHVyZS5TZXZlcml0eSA9PSBudWxsKXsNCgkJCS8vaWYgZHVwbGljYXRlIHZhbHVlIGFuZCBTZXZlcml0eSBpcyBDcml0aWNhbCB1cGRhdGUgdGhlIGFycmF5cw0KCQkJaXNEdXBsaWNhdGUgPSB0cnVlOw0KCQkJdHJhY2tJZCA9ICB0cmFja0lEW2ldLmlkOw0KCQl9DQoJfQ0KDQoJaWYoaXNEdXBsaWNhdGUpew0KCQl1cGRhdGVDcml0aWNhbFNvbChzb2x1dGlvbnNKc29uLCB0cmFja0lkKTsNCgl9DQoJZWxzZXsNCgkJLy9pZiBub3QgZHVwbGljYXRlIHZhbHVlIHB1c2ggdG8gYXJyYXkNCgkJcHVzaFRvVHJhY2tJRChzb2x1dGlvbnNKc29uKTsNCgl9DQoNCn0NCg0KZnVuY3Rpb24gdXBkYXRlQ3JpdGljYWxTb2woc29sdXRpb25Kc29uLCBkdXBsaWNhdGVJRCl7DQoJLy91cGRhdGUgaWYgdGhlIFNldmVyaXR5IG9mIGR1cGxpY2F0ZSB2YWx1ZSBpcyBDcml0aWNhbA0KCWZvcih2YXIgaT0wO2k8bm9ybWFsU29sLmxlbmd0aDtpKyspew0KCQlpZihub3JtYWxTb2xbaV0uaWQgPT0gZHVwbGljYXRlSUQgJiYgc29sdXRpb25Kc29uLlNpZ25hdHVyZS5TZXZlcml0eSA9PSAiQ3JpdGljYWwiKXsNCgkJCWRlbGV0ZSBub3JtYWxTb2xbaV07DQoJCQljcml0aWNhbFNvbC5wdXNoKHsiaWQiOnNvbHV0aW9uSnNvbi5pZCwic2V2ZXJpdHkiOnNvbHV0aW9uSnNvbi5TaWduYXR1cmUuU2V2ZXJpdHksInRpdGxlIjpzb2x1dGlvbkpzb24udGl0bGUsICJkaXNjcmlwdGlvbiI6c29sdXRpb25Kc29uLmRpc2NyaXB0aW9uLCAiaGVscFVSSSI6c29sdXRpb25Kc29uLmhlbHBVUkl9KTsNCgkJfQ0KDQoNCgl9DQoNCn0NCg0KDQovL0Rpc3BsYXkgcmVzdWx0DQpmdW5jdGlvbiBzaG93U29sc1Jlc3VsdCgpew0KCWlmKHNzZlBhcmFtcy5zaG93T3ZlcmxheSAmJiBzc2ZQYXJhbXMuaXNTb2Z0d2FyZVJ1biAmJiBzc2ZQYXJhbXMuaXNTb2x1dGlvblJ1bil7DQoJCXZhciB0b3RhbFNvbHV0aW9ucyA9ICQoJyNkcml2ZXJzVXBkYXRlIC5ocC1yb3cnKS5sZW5ndGggKyAkKCcjZHZDcml0aWNhbFNvbHV0aW9ucyBhJykubGVuZ3RoICsgJCgnI2R2UG90ZW50aWFsU29sdXRpb25zIGEnKS5sZW5ndGg7DQoJCXNvbHV0aW9uc0NvdW50ZXIgPSBzb2x1dGlvbnNDb3VudGVyID4gdG90YWxTb2x1dGlvbnMgPyB0b3RhbFNvbHV0aW9ucyA6IHNvbHV0aW9uc0NvdW50ZXI7DQoNCgkJaWYoaXNTb2xGb3VuZCAmJiBpc1NvZnRVcGRhdGVGb3VuZCl7Ly9pZiBib3RoIHNlcnZpY2UgcmVzdWx0cyB3aXRoIG5vIHNvbHV0aW9ucywgZGlzcGxheSBubyBzb2x1dGlvbnMgZm91bmQNCgkJCSQoJyNjaGVjay1zZXJ2aWNlLW1vZGFsJykubW9kYWwoImhpZGUiKTsNCgkJCSQoJyNzb2x1dGlvbkZpbmRlcicpLmhpZGUoKTsNCgkJCWpRdWVyeSgiI3NvbHV0aW9uUmVzdWx0cyIpLnNob3coKTsNCg0KCQkJaWYoc29sdXRpb25zQ291bnRlcj09MCl7DQoJCQkJJCgnI3BubFNvbHV0aW9uVXBkYXRlU3ViSGVhZGluZycpLmhpZGUoKTsNCgkJCQlpZihpc0FjbG1FcnJvcil7DQoJCQkJCSQoJyNwcmdUZWNoRXJyb3InKS5zaG93KCk7DQoJCQkJCSQoJyNwcmdOb1NvbHV0aW9uJykuaGlkZSgpOw0KCQkJCX0NCgkJCQkkKCcjbm9Tb2x1dGlvbnNGb3VuZCcpLnNob3coKTsNCgkJCX0NCgkJCWVsc2V7DQoJCQkJJCgnI3NvbHV0aW9uc1N1YnRpdGxlJykuc2hvdygpOw0KCQkJCSBpZihzb2Z0Q291bnQ+MCl7DQoJCQkJCSBqUXVlcnkoJyNkdkRyaXZlcnMnKS5zaG93KCk7DQoJCQkJIH0NCgkJCQkgaWYoc29sdXRpb25zQ291bnQ+MCl7DQoJCQkJCSBqUXVlcnkoIiNzb2x1dGlvbnNXcmFwcGVyIikuc2hvdygpOw0KCQkJCSB9DQoNCgkJCQkgJCgnI3NvbHV0aW9uc0hlYWRpbmcnKS5odG1sKCIoIit0b3RhbFNvbHV0aW9ucysiKSIpOw0KCQkJfQ0KDQoJCX0NCgl9DQoNCn0NCg0KDQoNCi8qc2hvdyBmaW5kIHNvbHV0aW9uIGJ1dHRvbiovDQpmdW5jdGlvbiBzaG93RmluZFNvbHV0aW9uTXNnKCl7DQoNCglpZihpc1Nob3dGaW5kU29sdXRpb25Nc2cgIT0gdHJ1ZSl7DQoJCWpRdWVyeSgiI2ZpbmRTb2x1dGlvbldyYXBwZXIiKS5zaG93KCk7DQoJCWlzU2hvd0ZpbmRTb2x1dGlvbk1zZyA9IHRydWU7DQoJfQ0KDQp9DQoNCg0KdmFyIHVwZGF0ZVNlc3Npb24gPSBmdW5jdGlvbihtZXRob2QsIHJlc3VsdE9iamVjdCwgcHJvZHVjdE51bWJlcikgew0KCXhociA9ICQucG9zdChzZXNzaW9uVVJMLHsNCgkJIm1ldGhvZCI6bWV0aG9kLA0KCQkicmVzdWx0T2JqZWN0IjpKU09OLnN0cmluZ2lmeShyZXN1bHRPYmplY3QpLA0KCQkicHJvZHVjdE51bWJlciI6cHJvZHVjdE51bWJlcg0KCQl9LGZ1bmN0aW9uKGRhdGEpey8qY29uc29sZS5sb2coJ0NvbXBsZXRlZCBmb3InK21ldGhvZCkqL30pOw0KfQ0KDQoNCi8qIDxzdW1tYXJ5Pg0KIEZpbmQgdGhlIFNQIGZvbGRlciBuYW1lDQogZWc6IHNwNjY1MDEtNjcwMDANCiA8L3N1bW1hcnk+Ki8NCg0KZnVuY3Rpb24gR2V0U29mdHBhcUZUUFBhdGgoU1BOdW1iZXIpew0KICAgICAgICB2YXIgcmVzdWx0ID0gIiI7DQogICAgICAgIFNQTnVtYmVyID0gU1BOdW1iZXIudG9VcHBlckNhc2UoKS5yZXBsYWNlKCJTUCIsICIiKTsNCiAgICAgICAgdmFyIGxvdyA9IFNQTnVtYmVyOw0KICAgICAgICB2YXIgdXBwZXIgPVNQTnVtYmVyOw0KICAgICAgICB2YXIgZml2ZTEwMHMgPSBTUE51bWJlcjsNCiAgICAgICAgdmFyIHNvZnRwYXEgPSBTUE51bWJlcjsNCiAgICAgICAgaWYgKHNvZnRwYXEgPCA1MDEpew0KICAgICAgICAgICAgbG93ID0gMDsNCiAgICAgICAgICAgIHVwcGVyID0gNTAwOw0KICAgICAgICB9DQogICAgICAgIGVsc2V7DQogICAgICAgICAgICBmaXZlMTAwcyA9IE1hdGguZmxvb3Ioc29mdHBhcSAvIDUwMCk7DQogICAgICAgICAgICBpZiAoKHNvZnRwYXEgJSA1MDApID4gMCl7DQogICAgICAgICAgICAgICAgKytmaXZlMTAwczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHVwcGVyID0gZml2ZTEwMHMgKiA1MDA7DQogICAgICAgICAgICBsb3cgPSB1cHBlciAtIDQ5OTsNCiAgICAgICAgfQ0KICAgICAgICByZXN1bHQgPSAic3AiK2xvdysiLSIrdXBwZXI7DQogICAgICAgIHJldHVybiByZXN1bHQ7DQoNCn0NCg0KZnVuY3Rpb24gYXR0YWNoTm9uSFBESUFIYW5kbGVyKCl7DQoJaWYodHlwZW9mKG5vbkhQRElBSGFuZGxlckF0dGFjaGVkKSAhPSAidW5kZWZpbmVkIil7DQoJCWlmKCFub25IUERJQUhhbmRsZXJBdHRhY2hlZCl7DQoJCQkkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmhwZGlhQnV0dG9uJywgZnVuY3Rpb24oZXZlbnQpew0KCQkJCXZhciBudWEgPSBuYXZpZ2F0b3IudXNlckFnZW50Ow0KCQkJCXZhciBpc01vYmlsZURldmljZSA9IG51YS5tYXRjaCgvQW5kcm9pZC9pKSB8fCBudWEubWF0Y2goL0JsYWNrQmVycnkvaSkgfHwgbnVhLm1hdGNoKC9pUGhvbmV8aVBhZHxpUG9kL2kpIHx8IG51YS5tYXRjaCgvT3BlcmEgTWluaS9pKSB8fCBudWEubWF0Y2goL0lFTW9iaWxlL2kpIHx8IG51YS5tYXRjaCgvTW9iaWxlL2kpOw0KDQoJCQkJdmFyIHN3ZFV0aWxpdHlUaXRsZSA9ICQodGhpcykuYXR0cigndXRpbGl0eXRpdGxlJyk7DQoJCQkJdmFyIHN3ZFV0aWxpdHlWYWx1ZSA9ICQodGhpcykuYXR0cigndXRpbGl0eXZhbHVlJyk7DQoJCQkJbm9uSFBESUFTZWxlY3RlZEJ1dHRvbiA9ICQodGhpcyk7DQoJCQkJaWYoIWlzTW9iaWxlRGV2aWNlKXsNCgkJCQkJLyogZC0zNjEzICovDQoJCQkJCS8qQ3VycmVudEVsZW1lbnQgPSAkKHRoaXMpOw0KCQkJCQkkKCcjSHBkaWFfRG93bmxvYWREaWFsb2cnKS5tb2RhbCgpOw0KDQoJCQkJCSQoJyNIcGRpYV9Eb3dubG9hZERpYWxvZ19CdG5OZXh0JykuYXR0cigndXRpbGl0eXRpdGxlJywgc3dkVXRpbGl0eVRpdGxlKS5hdHRyKCd1dGlsaXR5dmFsdWUnLCBzd2RVdGlsaXR5VmFsdWUpLm9mZignY2xpY2snKTsNCg0KCQkJCQkkKCcjSHBkaWFfRG93bmxvYWREaWFsb2dfQnRuTmV4dCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KXsNCgkJCQkJCXZhciB1dGlsaXR5dGl0bGUgPSAkKHRoaXMpLmF0dHIoJ3V0aWxpdHl0aXRsZScpOw0KCQkJCQkJdmFyIHV0aWxpdHl2YWx1ZSA9ICQodGhpcykuYXR0cigndXRpbGl0eXZhbHVlJyk7DQoJCQkJCQloYW5kbGVDbG9zdXJlUGFnZVJlZGlyZWN0KHV0aWxpdHl0aXRsZSwgdXRpbGl0eXZhbHVlKTsNCgkJCQkJfSk7Ki8NCgkJCQkJaGFuZGxlQ2xvc3VyZVBhZ2VSZWRpcmVjdChzd2RVdGlsaXR5VGl0bGUsIHN3ZFV0aWxpdHlWYWx1ZSk7DQoJCQkJfQ0KCQkJCWVsc2V7DQoJCQkJCWhhbmRsZUNsb3N1cmVQYWdlUmVkaXJlY3QodXRpbGl0eXRpdGxlLCB1dGlsaXR5dmFsdWUpOw0KCQkJCX0NCgkJCX0pOw0KCQkJbm9uSFBESUFIYW5kbGVyQXR0YWNoZWQgPSB0cnVlOw0KCQl9DQoJfQ0KfQ0KCn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ew0KDQoJCQkJIC8qDQoJCQkJICAqIGlmIHlvdSBhcmUgc3R1Y2sgdHJ5aW5nIHRvIGZpZ3VyZSBvdXQgd2hhdCBmdW5jdGlvbiBjYWxscyB3aGF0LA0KCQkJCSAgKiBQbGVhc2UgcmVmZXIgZmxvd2NoYXJ0LCBpdCBzaG91bGQgbWFrZSB5b3VyIGxpZmUgc2ltcGxlcihkZXYgaW4NCgkJCQkgICogcHJvZ3Jlc3MpDQoJCQkJICAqLw0KCQkJCSBmaXJzdERyaWxsZG93blJ1biA9IHRydWU7DQoJCQkJIGluaXRpYWxpemVEcmlsbGRvd24gPSBmdW5jdGlvbihkcmlsbGRvd25WYXJpYWJsZVNldCkgew0KDQoJCQkJCSBpZiAoZmlyc3REcmlsbGRvd25SdW4pIHsNCgkJCQkJCSBmaXJzdERyaWxsZG93blJ1biA9IGZhbHNlOw0KDQoJCQkJCQkgdmFyIGZhbGxiYWNrSW1hZ2UgPSBkcmlsbGRvd25WYXJpYWJsZVNldC5mYWxsYmFja0ltYWdlOw0KCQkJCQkJIHZhciBkcmlsbGRvd25VUkwgPSBkcmlsbGRvd25WYXJpYWJsZVNldC5kcmlsbGRvd25VUkw7DQoJCQkJCQkgdmFyIG9wZW5MZXZlbHNKU09OID0gZHJpbGxkb3duVmFyaWFibGVTZXQub3BlbkxldmVsc0pTT047DQoJCQkJCQkgdmFyIGxvYWRpbmdHaWYgPSBkcmlsbGRvd25WYXJpYWJsZVNldC5sb2FkaW5nR2lmOw0KCQkJCQkJIHZhciBzd2l0Y2hMdmwgPSAicG1fc2VyaWVzX3ZhbHVlIjsNCgkJCQkJCSB2YXIgcHVzaFN0YXRlVmFyID0gImNhdGVnb3J5X25hdmlnYXRpb24iOw0KCQkJCQkJIHZhciBjdXJyZW50VGFiSW5kZXggPSAiMCI7DQoJCQkJCQkgdmFyIGxpc3RWaWV3QnJlYWsgPSBkcmlsbGRvd25WYXJpYWJsZVNldC5saXN0Vmlld0JyZWFrOw0KCQkJCQkJIHZhciBwdXNoU3RhdGVPY2N1cmVkICA9IGZhbHNlOw0KCQkJCQkJIA0KCQkJCQkJIG9wZW5GbGFnID0gdHJ1ZTsNCgkJCQkJCSAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsNCg0KCQkJCQkJCSBpZiAoJCgnI3NlbFByb2R1Y3RUeXBlJykpIHsNCgkJCQkJCQkJICQoJyNzZWxQcm9kdWN0VHlwZScpLmhpZGUoKTsNCgkJCQkJCQkgfQkJDQoJCQkJCQkJLy9Bc3NpZ24gYXJyb3cgY2xhc3MgYmFzZWQgb24gUlRML0xUUgkNCgkJCQkJCQkvL2dldCBIVE1MIHRhZyBkaXINCgkJCQkJCQl2YXIgZGlyID0gJCgnaHRtbCcpLmF0dHIoJ2RpcicpOwkJCQkJCSANCgkJCQkJCQlpZihkaXI9PSJydGwiKXsNCgkJCQkJCQkJJCgnI3ZpZXdNb3JlQXJyb3cnKS5yZW1vdmVDbGFzcygnZmEtYW5nbGUtcmlnaHQnKTsNCgkJCQkJCQkJJCgnI3ZpZXdNb3JlQXJyb3cnKS5hZGRDbGFzcygnZmEtYW5nbGUtbGVmdCcpOw0KCQkJCQkJCX0NCgkJCQkJCQkgIC8vIHRvIHRydW5jYXRlIGFueSB0ZXh0IGFuZCBhZGQgLi4uIGF0IGl0cyBlbmQNCgkJCQkJCSAgICAgICAgJCgiLmdyaWRFbGVtZW50IC5lbGVtZW50VmFsdWUiKS5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQkJDQoJCQkJCQkgICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygiZWxlbWVudFZhbHVlIikpIHsNCgkJCQkJCSAgICAgICAgICAgIAkvL3NldCB0aGUgY29tcGxldGUgdmFsdWUgYXMgdGhlIHRpdGxlDQoJCQkJCQkJCQkJICQodGhpcykuYXR0cigidGl0bGUiLCAkKHRoaXMpLnRleHQoKSk7DQoJCQkJCQkJCQkJIA0KCQkJCQkJCQkJCSAvL3RydW5jYXRlIGFsbCBjaGFyYWN0ZXJzIGlmIGNoYXIgbGVuZ3RoIGdyZWF0ZXIgdGhhbiAzMCBjaGFycw0KCQkJCQkJICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLnRleHQoKS5sZW5ndGg+MzApIHsNCgkJCQkJCSAgICAgICAgICAgICAgICAgICAgdmFyIG9yaWdfdGV4dCA9ICQodGhpcykuaHRtbCgpOw0KCQkJCQkJICAgICAgICAgICAgICAgICAgICB2YXIgc2hvcnRUZXh0ID0gb3JpZ190ZXh0Ow0KCQkJCQkJICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmh0bWwoc2hvcnRUZXh0KTsNCgkJCQkJCSAgICAgICAgICAgICAgICAgICAgLy9yZW1vdmUgbGFzdCAyIGNoYXJzIGFuZCBhZGQgYW4gZWxsaXBzZXMNCgkJCQkJCSAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCQodGhpcykudGV4dCgpLmxlbmd0aD4zMCkgeyAgDQoJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICBzaG9ydFRleHQgPSBqUXVlcnkudHJpbShzaG9ydFRleHQpLnN1YnN0cmluZygwLCAoc2hvcnRUZXh0Lmxlbmd0aCAtIDIpKTsNCgkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuaHRtbChzaG9ydFRleHQpOw0KCQkJCQkJICAgICAgICAgICAgICAgICAgICB9DQoJCQkJCQkgICAgICAgICAgICAgICAgICAgIHNob3J0VGV4dCA9IGpRdWVyeS50cmltKHNob3J0VGV4dCkuc3Vic3RyaW5nKDAsIChzaG9ydFRleHQubGVuZ3RoIC0gMikpICsgIi4uLiI7DQoJCQkJCQkgICAgICAgICAgICAgICAgICAgICQodGhpcykuaHRtbChzaG9ydFRleHQpOw0KCQkJCQkJICAgICAgICAgICAgICAgICAgICAvLyQodGhpcykuY3NzKCJjdXJzb3IiLCAiZGVmYXVsdCIpOw0KCQkJCQkJICAgICAgICAgICAgICAgIH0NCgkJCQkJCSAgICAgICAgICAgIH0NCgkJCQkJCSAgICAgICAgfSk7DQoJCQkJCQkJIA0KCQkJCQkJCQkvL21hdGNoIGhlaWdodCBmb3IgdmlldyBtb3JlIHByb2QgZWxlbWVudHMNCgkJCQkJCQkJJCgnLm1vcmUtcHJvZHVjdHMgdWwgbGknKS5tYXRjaEhlaWdodCgpOw0KCQkJCQkNCgkJCQkJCSAgIC8qICAgaWYgKCQoJyNwcm9kdWN0LXRleHQnKSkgew0KCQkJCQkJCQkgJCgnI3Byb2R1Y3QtdGV4dCcpLm9uKCJjbGljayIsIGZ1bmN0aW9uKGV2ZW50KSB7DQoJCQkJCQkJCSAgCX0NCgkJCQkJCQkgfSAqLw0KCQkJCQkJaWYgKCQoJyNwcm9kdWN0R3JpZEJsb2NrcyBhLnByb2R1Y3QtZ3JpZC1jYXRlZ29yeS5ncmlkRWxlbWVudCcpKSB7DQoJCQkJCQkJCSAkKCcjcHJvZHVjdEdyaWRCbG9ja3MgYS5wcm9kdWN0LWdyaWQtY2F0ZWdvcnkuZ3JpZEVsZW1lbnQnKS5lYWNoKGZ1bmN0aW9uKCkgew0KDQoJCQkJCQkJCQkgJCh0aGlzKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkgew0KDQoJCQkJCQkJCQkJIGN1cnJlbnRQYWdlID0gJCgnI3BhZ2VJZGVudGlmaWVyJykudmFsKCk7DQoJCQkJCQkJCQkJIC8vIHJlcXVpcmVkIGZvciB1bml0IHRlc3RpbmcNCgkJCQkJCQkJCQkgLy9jdXJyZW50UGFnZSA9ICJQcm9kdWN0IEhvbWUiDQoNCgkJCQkJCQkJCQkgaWYgKGN1cnJlbnRQYWdlICE9IG51bGwgJiYgY3VycmVudFBhZ2UgIT0gIm51bGwiKSB7DQoJCQkJCQkJCQkJCSAvLyBmb3Igc3VwcG9ydEhvbWUgdXNlIGxvZ2ljIHRvIHJlZGlyZWN0DQoJCQkJCQkJCQkJCSAvLyBvbiBjbGljaw0KCQkJCQkJCQkJCQkgLy8gZm9yIHByb2R1Y3RIb21lIHVzZSBsb2dpYyB0byBjcmVhdGUNCgkJCQkJCQkJCQkJIC8vIGRyaWxsZG93biBvbiBjbGljaw0KCQkJCQkJCQkJCQkgcG9wdWxhdGVDYXRlZ29yeUZvclNlYXJjaCgkKHRoaXMpKTsgLyogVGhpcyBmdW5jdGlvbiBpcyB0byBwb3B1bGF0ZSBhIHZhcmlhYmxlIHdpdGggdGhlIHJhdy1kYXRhLXZhbHVlIGZvciBzZWFyY2ggKi8NCgkJCQkJCQkJCQkJIGlmIChjdXJyZW50UGFnZSA9PSAiUHJvZHVjdCBIb21lIikgew0KDQoJCQkJCQkJCQkJCQkgY2xhenpUeXBlID0gJCh0aGlzKS5hdHRyKCdjbGF6elR5cGUnKTsNCgkJCQkJCQkJCQkJCSBpZiAoY2xhenpUeXBlID09ICJocHNjX2p1bXBfbmF2aWdhdGlvbiIpIHsNCgkJCQkJCQkJCQkJCQkgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAkKHRoaXMpLmF0dHIoJ2xpbmsnKTsNCgkJCQkJCQkJCQkJCSB9IGVsc2Ugew0KCQkJCQkJCQkJCQkJCSAkKCcjcHJvZHVjdEdyaWQnKS5oaWRlKCk7DQoJCQkJCQkJCQkJCQkJIGlmICgkKHRoaXMpLmNoaWxkcmVuKCdoMycpLmxlbmd0aCA+IDApIHsNCgkJCQkJCQkJCQkJCQkJICQoJyNzZWxQcm9kdWN0VHlwZSBzcGFuJykuZW1wdHkoKS5hcHBlbmQoJCh0aGlzKS5jaGlsZHJlbignaDMnKS5odG1sKCkpOw0KCQkJCQkJCQkJCQkJCQkgJCgnI3NlbFByb2R1Y3RUeXBlIHNwYW4nKS5hdHRyKCdzZW8tbGFiZWwnLCAkKHRoaXMpLmF0dHIoJ3Nlby1sYWJlbCcpKTsNCgkJCQkJCQkJCQkJCQkJIC8vIGlmKCQoJyNocFByb2R1Y3RDb250ZXh0UGFnZVRpdGxlJykubGVuZ3RoPjApDQoJCQkJCQkJCQkJCQkJCSAvLyAkKCcjaHBQcm9kdWN0Q29udGV4dFBhZ2VUaXRsZScpLmVtcHR5KCkuYXBwZW5kKCQodGhpcykuY2hpbGRyZW4oJ2gzJykuaHRtbCgpKTsNCg0KCQkJCQkJCQkJCQkJCQkgLy9zZXQgdGhlIHBhZ2UgdGl0bGUNCgkJCQkJCQkJCQkJCQkJIGNoYW5nZVBhZ2VUaXRsZShkcmlsbGRvd25WYXJpYWJsZVNldC5sb2NhbGl6ZWRWYWx1ZXMuaHBTdXBwb3J0LCAkKHRoaXMpLmNoaWxkcmVuKCdoMycpLmh0bWwoKSk7DQoNCgkJCQkJCQkJCQkJCQkgfSBlbHNlIHsNCg0KCQkJCQkJCQkJCQkJCQkgJCgnI3NlbFByb2R1Y3RUeXBlIHNwYW4nKS5lbXB0eSgpLmFwcGVuZCgkKHRoaXMpLmh0bWwoKSk7DQoJCQkJCQkJCQkJCQkJCSAkKCcjc2VsUHJvZHVjdFR5cGUgc3BhbicpLmF0dHIoJ3Nlby1sYWJlbCcsICQodGhpcykuYXR0cignc2VvLWxhYmVsJykpOw0KDQoJCQkJCQkJCQkJCQkJCSAvL3NldCB0aGUgcGFnZSB0aXRsZQ0KCQkJCQkJCQkJCQkJCQkgY2hhbmdlUGFnZVRpdGxlKGRyaWxsZG93blZhcmlhYmxlU2V0LmxvY2FsaXplZFZhbHVlcy5ocFN1cHBvcnQsICQodGhpcykuaHRtbCgpKTsNCgkJCQkJCQkJCQkJCQkgfQ0KDQoJCQkJCQkJCQkJCQkJICQoJyNzZWxQcm9kdWN0VHlwZScpLnNob3coKTsNCgkJCQkJCQkJCQkJCQkgICQoJyNkcmlsbGRvd25NYWluQ29udGFpbmVyJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsNCg0KCQkJCQkJCQkJCQkJCSB2YXIgY2F0ZWdvcnlJZCA9ICQodGhpcykuYXR0cigncmF3LWRhdGEtdmFsdWUnKTsNCgkJCQkJCQkJCQkJCQkgdmFyIHNlb0xhYmVsID0gJCh0aGlzKS5hdHRyKCdzZW8tbGFiZWwnKTsNCgkJCQkJCQkJCQkJCQkgdG9nZ2xlS25vd1dpbmRvd3NDb250YWluZXIoc2VvTGFiZWwpOw0KDQoJCQkJCQkJCQkJCQkJIGNsZWFyTmV4dExldmVscygwKTsNCgkJCQkJCQkJCQkJCQkgaWYgKGdldFRNU1Jlc3BvbnNlKQ0KCQkJCQkJCQkJCQkJCQkgZ2V0VE1TUmVzcG9uc2UuYWJvcnQoKTsNCgkJCQkJCQkJCQkJCQkgaWYgKHN1cHBvcnRzX2hpc3RvcnlfYXBpKCkpIHsNCgkJCQkJCQkJCQkJCQkJIGhhbmRsZVB1c2hTdGF0ZShjYXRlZ29yeUlkLCAwLCBzZW9MYWJlbCk7DQoJCQkJCQkJCQkJCQkJIH0NCgkJCQkJCQkJCQkJCQkgY2hlY2tGb3JEYXRhKGNhdGVnb3J5SWQsICcwJywgJ3Byb2R1Y3REcmlsbGRvd24nLCAnbmF2aWdhdGlvbicsICcnLCAnJyk7DQoJCQkJCQkJCQkJCQkgfQ0KCQkJCQkJCQkJCQkJIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQkJCQkJCQkJCSB9IGVsc2Ugew0KCQkJCQkJCQkJCQkJIC8vIHJlZGlyZWN0IGxvZ2ljDQoJCQkJCQkJCQkJCQkgLy93aW5kb3cubG9jYXRpb249KCQodGhpcykuYXR0cignbGluaycpKTsNCgkJCQkJCQkJCQkJIH0NCgkJCQkJCQkJCQkgfQ0KCQkJCQkJCQkJIH0pOw0KCQkJCQkJCQkgfSk7DQoJCQkJCQkJIH0NCgkJCQkJCQkgbGV2ZWxzT3BlbmVkID0gMDsNCgkJCQkJCQkgaWYgKCQoJy5vcGVuTGV2ZWwnKSkgew0KCQkJCQkJCQkgbGV2ZWxzVG9PcGVuID0gJCgnLm9wZW5MZXZlbCcpLmxlbmd0aDsNCg0KCQkJCQkJCQkgaWYgKGxldmVsc1RvT3BlbiA+IDApIHsNCgkJCQkJCQkJCSAkKCdib2R5JykucHJlcGVuZCgnPGRpdiBpZD0iYmlnTG9hZGluZ0RpdiIgY2xhc3M9IiI+PC9kaXY+Jyk7DQoJCQkJCQkJCSB9DQoJCQkJCQkJCSBjaGVja0Zvck9wZW5MZXZlbHMob3BlbkxldmVsc0pTT04pOw0KCQkJCQkJCSB9DQoJCQkJCQkgfSk7DQoNCgkJCQkJCSB2YXIgcGFnZVNpemUgPSAxMDsNCgkJCQkJCSB2YXIgZmluYWxHcmlkSlNPTjsNCgkJCQkJCSB2YXIgY3VycmVudEdyaWRKU09OOw0KCQkJCQkJIHZhciBmaW5hbEdyaWRQYWdlTnVtYmVyID0gMTsNCgkJCQkJCSB2YXIgZ2V0VE1TUmVzcG9uc2UgPSBmYWxzZTsNCgkJCQkJCSB2YXIgZmluYWxHcmlkVmlld1R5cGUgPSAnZ3JpZCc7DQoJCQkJCQkgdmFyIGpzb25NYXAgPSB7fTsNCgkJCQkJCSBjaGVja01hcCA9IGZ1bmN0aW9uKGNhdElkKSB7DQoJCQkJCQkJIHZhciB0ZW1wSlNPTiA9IGpzb25NYXBbY2F0SWRdOw0KCQkJCQkJCSBpZiAodGVtcEpTT04pIHsNCgkJCQkJCQkJIHJldHVybiB0ZW1wSlNPTjsNCgkJCQkJCQkgfQ0KCQkJCQkJIH07DQoNCgkJCQkJCSBnZW5lcmF0ZU1hcCA9IGZ1bmN0aW9uKGNhdElkLCBkYXRhKSB7DQoJCQkJCQkJIGlmICghY2hlY2tNYXAoY2F0SWQpKSB7DQoJCQkJCQkJCSBqc29uTWFwW2NhdElkXSA9IGRhdGE7DQoJCQkJCQkJIH0NCgkJCQkJCSB9Ow0KDQoJCQkJCQkgLyogQUpBWCBjYWxsIHRvIFRNUyBmb3IgZGF0YSBiYXNlZCBvbiBjYXRlZ29yeSBJRCAqLw0KCQkJCQkJIGNoZWNrRm9yRGF0YSA9IGZ1bmN0aW9uKGNhdGVnb3J5SWQsIGluZGV4LCBlbGVtZW50VHlwZSwgY2xhenpUeXBlLCBwYWdlTnVtYmVyLCBwYWdlU2l6ZSkgew0KCQkJCQkJCSBjYyA9IGdldENDTEMoJ2NjJyk7DQoJCQkJCQkJIGxjID0gZ2V0Q0NMQygnbGMnKTsNCgkJCQkJCQkgaWYgKGNjID09ICJlbiIpIHsNCgkJCQkJCQkJIGNjID0gbnVsbDsNCgkJCQkJCQkJIGxjID0gbnVsbDsNCgkJCQkJCQkgfQ0KCQkJCQkJCSBkYXRhID0gY2hlY2tNYXAoY2F0ZWdvcnlJZCk7DQoNCgkJCQkJCQkgZmV0Y2hJbWFnZSA9IGZhbHNlOw0KCQkJCQkJCSBpZiAoaW5kZXggPT0gMCAmJiBlbGVtZW50VHlwZSA9PSAicHJvZHVjdERyaWxsZG93biIpIHsNCgkJCQkJCQkJIGZldGNoSW1hZ2UgPSAidHJ1ZSI7DQoJCQkJCQkJIH0NCg0KCQkJCQkJCSBpZiAocGFnZU51bWJlciA9PSBudWxsIHx8IHBhZ2VOdW1iZXIgPT0gIm51bGwiKQ0KCQkJCQkJCQkgcGFnZU51bWJlciA9IDA7DQoNCgkJCQkJCQkgaWYgKHBhZ2VTaXplID09IG51bGwgfHwgcGFnZVNpemUgPT0gIm51bGwiKQ0KCQkJCQkJCQkgcGFnZVNpemUgPSAwOw0KDQoJCQkJCQkJIGlmIChkYXRhID09IG51bGwpIHsNCgkJCQkJCQkJICQoJyNwcm9kdWN0X2RyaWxsZG93bicpLmFwcGVuZCgkKCc8ZGl2IGlkPSJkcmlsbGRvd25Mb2FkaW5nRGl2IiBjbGFzcz0iZHJpbGxkb3duTG9hZGluZ0RpdiI+PGltZyBhbHQ9ImxvYWRpbmciIHNyYz0iJyArIGxvYWRpbmdHaWYgKyAnIi8+PC9kaXY+JykpOw0KCQkJCQkJCQkgdmFyIGN1cnJlbnRQYWdlID0gJCgnI3BhZ2VJZGVudGlmaWVyJykudmFsKCk7DQoJCQkJCQkJCSB2YXIgaXNIaXN0b3JpY2FsRHJpbGxkb3duOw0KCQkJCQkJCQkgaWYgKGN1cnJlbnRQYWdlICE9PSAiSGlzdG9yaWNhbCBQcm9kdWN0cyIpDQoJCQkJCQkJCQkgew0KCQkJCQkJCQkJIGlzSGlzdG9yaWNhbERyaWxsZG93biA9IGZhbHNlOw0KCQkJCQkJCQkJIH0NCgkJCQkJCQkJIGdldFRNU1Jlc3BvbnNlID0gJC5wb3N0KGRyaWxsZG93blVSTCwgew0KCQkJCQkJCQkJICdjYXRlZ29yeUlkJzogY2F0ZWdvcnlJZCwNCgkJCQkJCQkJCSAnY2MnOiBjYywNCgkJCQkJCQkJCSAnbGMnOiBsYywNCgkJCQkJCQkJCSAnZmlyc3RMZXZlbCc6IGZldGNoSW1hZ2UsDQoJCQkJCQkJCQkgJ2NhbGxGb3JIaXN0b3JpY1Byb2R1Y3QnIDogaXNIaXN0b3JpY2FsRHJpbGxkb3duLA0KCQkJCQkJCQkJICdkcml2ZXInOiBjaGVja0RyaXZlcigpDQoJCQkJCQkJCSB9LCBmdW5jdGlvbihkYXRhKSB7DQoNCgkJCQkJCQkJCSBpZiAobnVsbCAhPSBkYXRhLnRtc1Jlc3BvbnNlKSB7DQoJCQkJCQkJCQkJIGdlbmVyYXRlTWFwKGNhdGVnb3J5SWQsIGRhdGEpOw0KCQkJCQkJCQkJCSBpZiAoJCgnI2RyaWxsZG93bkxvYWRpbmdEaXYnKS5sZW5ndGggPiAwKSB7DQoJCQkJCQkJCQkJCSAkKCcjZHJpbGxkb3duTG9hZGluZ0RpdicpLnJlbW92ZSgpOw0KCQkJCQkJCQkJCSB9DQoJCQkJCQkJCQkJIGNyZWF0ZVByb2R1Y3REcmlsbGRvd24oZGF0YSwgaW5kZXgsIHRydWUpOw0KCQkJCQkJCQkJCSBsZXZlbHNPcGVuZWQrKzsNCgkJCQkJCQkJCQkgY2hlY2tGb3JPcGVuTGV2ZWxzKGRhdGEpOw0KCQkJCQkJCQkJIH0NCgkJCQkJCQkJIH0pOw0KDQoJCQkJCQkJCWlmKGluZGV4PjApew0KDQoJCQkJCQkJCQkkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7DQoJCQkJCQkJICAgIAkgICAgc2Nyb2xsVG9wOiAkKCIjZHZOYXJyb3dpbmdTZWxlY3Rpb25MZXZlbCIraW5kZXgpLm9mZnNldCgpLnRvcC0gMTUNCgkJCQkJCQkgICAgCX0sIDEwMDApOwkNCg0KCQkJCQkJCQl9DQoNCg0KCQkJCQkJCSB9IGVsc2Ugew0KCQkJCQkJCQkgZ2VuZXJhdGVNYXAoY2F0ZWdvcnlJZCwgZGF0YSk7DQoJCQkJCQkJCSBjcmVhdGVQcm9kdWN0RHJpbGxkb3duKGRhdGEsIGluZGV4LCB0cnVlKTsNCg0KCQkJCQkJCQkgaWYoaW5kZXg+MCl7DQoNCgkJCQkJCQkJCSQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHsNCgkJCQkJCQkgICAgCSAgICBzY3JvbGxUb3A6ICQoIiNkdk5hcnJvd2luZ1NlbGVjdGlvbkxldmVsIitpbmRleCkub2Zmc2V0KCkudG9wLSAxNQ0KCQkJCQkJCSAgICAJfSwgMTAwMCk7CQ0KDQoJCQkJCQkJCX0NCg0KCQkJCQkJCSB9DQoJCQkJCQkgfTsNCg0KCQkJCQkJIGNyZWF0ZVByb2R1Y3REcmlsbGRvd24gPSBmdW5jdGlvbihkYXRhLCBpbmRleCwgZGlzcFN0YXRlKSB7DQoJCQkJCQkJIGlmIChudWxsICE9IGRhdGEudG1zUmVzcG9uc2UpIHsNCgkJCQkJCQkgCXZhciBwYXJ0aWFsQnJvd3NlclRpdGxlID0gZG9jdW1lbnQudGl0bGU7DQoJCQkJCQkJIAlkb2N1bWVudC50aXRsZSA9IGRhdGEudG1zUmVzcG9uc2UubmFtZSArIiAiKyBwYXJ0aWFsQnJvd3NlclRpdGxlOyAvL1RoZSBwcm9kdWN0IHRpdGxlIHdpbGwgbm93IGJlIGZ1bGwgbmFtZSArIHRyYWlsaW5nIHRleHQNCgkJCQkJCQkgCWlmKGRvY3VtZW50LnRpdGxlLmluZGV4T2YoJyZhbXA7Jyk+MCl7DQoJCQkJCQkJCQlkb2N1bWVudC50aXRsZSA9IGRvY3VtZW50LnRpdGxlLnJlcGxhY2UoJyZhbXA7JywnJicpOw0KCQkJCQkJCQl9DQoJCQkJCQkJCSBjbGVhck5leHRMZXZlbHMoaW5kZXgpOw0KCQkJCQkJCQkgaWYgKGRhdGEudG1zUmVzcG9uc2UuZmllbGRMaXN0WzBdLmNsYXp6VHlwZSA9PSBzd2l0Y2hMdmwpIHsNCgkJCQkJCQkJCSBjcmVhdGVQcm9kdWN0R3JpZFZpZXcoZGF0YS50bXNSZXNwb25zZSwgaW5kZXgpOw0KDQoJCQkJCQkJCSB9IGVsc2UgaWYgKGluZGV4ID09ICIwIikgew0KDQoJCQkJCQkJCQkgY3JlYXRlUHJvZHVjdEZhbWlseShkYXRhLnRtc1Jlc3BvbnNlLCBpbmRleCwgZGlzcFN0YXRlKTsgLy8gY3JlYXRlcyB0aGUgMHRoIGxldmVsIHdpdGggbmFtZXMgYW5kIGltYWdlcw0KDQoNCgkJCQkJCQkJIH0gZWxzZSB7DQoJCQkJCQkJCQkgY3JlYXRlUHJvZHVjdExpc3RWaWV3KGRhdGEudG1zUmVzcG9uc2UsIGluZGV4LCBkaXNwU3RhdGUpOw0KCQkJCQkJCQkgfQ0KCQkJCQkJCSB9DQoJCQkJCQkgfTsNCg0KCQkJCQkJIC8vIHBEcmlsbExldmVsIGlzIHNob3J0IGZvciBQcm9kdWN0IERyaWxsZG93biBMZXZlbA0KCQkJCQkJIGNyZWF0ZVByb2R1Y3RGYW1pbHkgPSBmdW5jdGlvbihkYXRhLCBpbmRleCwgZGlzcFN0YXRlKSB7DQoJCQkJCQkJIGluZGV4Kys7DQoNCgkJCQkJCQkgcmVuZGVyTGV2ZWwoaW5kZXgpOw0KCQkJCQkJCSByZW5kZXJQREhlYWRlckJveENvbnRlbnQoaW5kZXgpOw0KCQkJCQkJCSB2YXIgb3V0ZXJDb250YWluZXIgPSAkKCI8ZGl2IGlkPSdwRHJpbGxMZXZlbCIgKyBpbmRleCArICInIGNsYXNzPSdwYW5lbC1ib2R5IGhwLXJvdyBwYnVpbGRlcic+PC9kaXY+Iik7DQoJCQkJCQkJIHZhciBib290c3RyYXBNYXJrdXAgPSAkKCI8ZGl2IGNsYXNzPSdjb2wtbGctMjQnPjwvZGl2PiIpOw0KCQkJCQkJCSB2YXIgY2VudGVyZWRNYXJrdXAgPSAkKCI8ZGl2IGNsYXNzPSdjZW50ZXJlZCc+PC9kaXY+Iik7DQoJCQkJCQkJIHZhciBwcm9kRmFtaWx5TGlzdCA9ICQoJzx1bCBjbGFzcz0icHJvZHVjdC1maW5kZXItbGlzdCB3aXRoLWltYWdlcyI+PC91bD4nKTsNCgkJCQkJCQkgdmFyIGNvdW50ZXIgPSAwOw0KCQkJCQkJCSBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEuZmllbGRMaXN0Lmxlbmd0aDsgaSsrKSB7DQoJCQkJCQkJCSBpbWFnZVVSTCA9IGRhdGEuZmllbGRMaXN0W2ldLmltYWdlVXJsOw0KCQkJCQkJCQkgaWYgKGltYWdlVVJMID09IG51bGwgfHwgaW1hZ2VVUkwgPT0gJ251bGwnIHx8IGltYWdlVVJMID09ICIiKSB7DQoJCQkJCQkJCQkgaW1hZ2VVUkwgPSBmYWxsYmFja0ltYWdlOw0KCQkJCQkJCQkgfQ0KDQoJCQkJCQkJCSBwcm9kRmFtaWx5TGlzdC5hcHBlbmQoJzxsaT4nKw0KCQkJCQkJCQkJCQkJCQkJJzxzcGFuIGNsYXNzPSJlbGVtIiAgdGFiaW5kZXg9JysgY3VycmVudFRhYkluZGV4ICsnICAgaHJlZj0iIyIgcmVkaXJlY3RVcmw9IicgKyBkYXRhLmZpZWxkTGlzdFtpXS5yZWRpcmVjdFVybCArICciIGNsYXp6VHlwZT0iJyArIGRhdGEuZmllbGRMaXN0W2ldLmNsYXp6VHlwZSArICciIHJhdy1kYXRhLXZhbHVlPSInICsgZGF0YS5maWVsZExpc3RbaV0udWlkICsgJyIgCT4nKw0KCQkJCQkJCQkJCQkJCQkJCSc8ZGl2IGlkPSJwRHJpbGxMZXZlbCcgKyBpbmRleCArICdfaW1hZ2UnICsgaSArICciIGNsYXNzPSJwcm9kdWN0LWlubmVyIj4nKw0KCQkJCQkJCQkJCQkJCQkJCQknPGltZyBzcmM9IicgKyBpbWFnZVVSTCArICciIHdpZHRoPSI3NSUiIGFsdD0iJysgZGF0YS5maWVsZExpc3RbaV0udmFsdWUgKyciIC8+JysNCgkJCQkJCQkJCQkJCQkJCQknPC9kaXY+JysNCgkJCQkJCQkJCQkJCQkJCQknPHNwYW4gaWQ9InBEcmlsbExldmVsJyArIGluZGV4ICsgJ190aXRsZScgKyBpICsgJyIgY2xhc3M9InBDYXJvdXNhbFRpdGxlIHRpdGxlIiByYXctZGF0YS12YWx1ZT0iJyArIGRhdGEuZmllbGRMaXN0W2ldLnVpZCArICciIHNlby1sYWJlbD0iJyArIGRhdGEuZmllbGRMaXN0W2ldLnNlb0xhYmVsICsgJyIgID4nKyANCgkJCQkJCQkJCQkJCQkJCQkJZGF0YS5maWVsZExpc3RbaV0udmFsdWUgKw0KCQkJCQkJCQkJCQkJCQkJCSc8L3NwYW4+PC9zcGFuPjwvbGk+Jyk7DQoNCgkJCQkJCQkJLyogIGlmICgrK2NvdW50ZXIgPT0gNykgew0KCQkJCQkJCQkJIHByb2RGYW1pbHlMaXN0LmFwcGVuZCgnPGRpdiBjbGFzcz0ibGluZUJyZWFrIj48L2Rpdj4nKTsNCgkJCQkJCQkJCSBjb3VudGVyID0gMDsNCgkJCQkJCQkJIH0NCg0KCQkJCQkJCQkgaWYgKChkYXRhLmZpZWxkTGlzdC5sZW5ndGggJSA3KSA9PSAwKSB7DQoNCgkJCQkJCQkJCSAkKCcubGluZUJyZWFrOmxhc3QtY2hpbGQnKS5yZW1vdmUoKTsNCg0KCQkJCQkJCQkgfSAqLw0KCQkJCQkJCSB9DQoJCQkJCQkJDQoJCQkJCQkJIG91dGVyQ29udGFpbmVyLmFwcGVuZChib290c3RyYXBNYXJrdXApOw0KCQkJCQkJCSBib290c3RyYXBNYXJrdXAuYXBwZW5kKGNlbnRlcmVkTWFya3VwKTsNCgkJCQkJCQkgY2VudGVyZWRNYXJrdXAuYXBwZW5kKHByb2RGYW1pbHlMaXN0KTsNCgkJCQkJCQkgJCgnI2R2Q29udGVudENvbnRhaW5lckxldmVsJyArIGluZGV4KS5hcHBlbmQob3V0ZXJDb250YWluZXIpOw0KDQoJCQkJCQkJIGlmIChkaXNwU3RhdGUgPT0gZmFsc2UpIHsNCgkJCQkJCQkJIC8vIGxvYWQgYXMgY2xvc2VkIGRpdiB3aXRoIGEgc2VsZWN0ZWQgc3RhdGUNCgkJCQkJCQkJCQkJaWYoJCgnI2R2Q29udGVudENvbnRhaW5lckxldmVsJyArIGluZGV4KS5oYXNDbGFzcygiaW4iKSkgew0KCQkJCQkJCQkJCQkJJCgnI2R2Q29udGVudENvbnRhaW5lckxldmVsJyArIGluZGV4KS5yZW1vdmVDbGFzcygiaW4iKTsNCgkJCQkJCQkJCQkJfQ0KCQkJCQkJCQkJCQkgLy9jb2xsYXBzZSB0aGUgcGFuZWwNCgkJCQkJCQkJCQkJICQoJyNkdkNvbnRlbnRDb250YWluZXJMZXZlbCcgKyBpbmRleCkuY3NzKCdkaXNwbGF5Jywnbm9uZScpOw0KDQoJCQkJCQkJCQkJCSAvL3JlbW92ZSBvcGVuIGNsYXNzIHRvIGNoYW5nZSBleHBhbmQgY29sbGFwc2UgYnV0dG9uDQoJCQkJCQkJCQkJCSAkKCcjYUV4cGFuZENvbGxhcHNlJysgaW5kZXgpLnJlbW92ZUNsYXNzKCd0b2dnbGVkJykNCgkJCQkJCQkJCQkJICQoJyNkdk5hcnJvd2luZ1NlbGVjdGlvbkxldmVsJyArIGluZGV4KS5yZW1vdmVDbGFzcygnb3BlbicpOw0KCQkJCQkJCQkJCQkgJCgnI2FFeHBhbmRDb2xsYXBzZScgKyBpbmRleCkuYXR0cignYXJpYS1leHBhbmRlZCcsJ2ZhbHNlJyk7DQoNCgkJCQkJCQkJIC8vIHJlbW92ZSBib2xkIGZyb20gaGVhZGluZw0KCQkJCQkJCQkgaWYgKCQoIiNkdk5hcnJvd2luZ1NlbGVjdGlvbkxldmVsIiArIGluZGV4ICsgIiAubmFycm93U2VsZWN0aW9uIikuaGFzQ2xhc3MoJ0hQU2ltcGxpZmllZEJvbGROZXcnKSkNCgkJCQkJCQkJCSAkKCIjZHZOYXJyb3dpbmdTZWxlY3Rpb25MZXZlbCIgKyBpbmRleCArICIgLm5hcnJvd1NlbGVjdGlvbiIpLnJlbW92ZUNsYXNzKCdIUFNpbXBsaWZpZWRCb2xkTmV3Jyk7DQoJCQkJCQkJIH0NCg0KCQkJCQkJCSBhdHRhY2hEcmlsbGRvd25FdmVudEhhbmRsZXJzKGluZGV4KTsNCg0KCQkJCQkJCSAvL2FkZCBGaXJzdExldmVsIGNyZWF0ZWQgdG8gZGF0YSBsYXllciB0ZW1wbGF0ZQ0KCQkJCQkJCSBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ1Byb2R1Y3RDYXRlZ29yeUwwJyk7DQoJCQkJCQkJICQod2luZG93KS50cmlnZ2VyKCdUZW1wbGF0ZScseyB0ZW1wbGF0ZSA6ICdQcm9kdWN0Q2F0ZWdvcnlMMCd9KTsNCgkJCQkJCSB9Ow0KDQoJCQkJCQkgY3JlYXRlUHJvZHVjdExpc3RWaWV3ID0gZnVuY3Rpb24oZGF0YSwgaW5kZXgsIGRpc3BTdGF0ZSkgew0KCQkJCQkJCSAvL3NldCBjdXJyZW50IGxldmVsIG51bWJlciBpbnRvIGRhdGEgTGF5ZXINCgkJCQkJCQkgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdQcm9kdWN0Q2F0ZWdvcnlMJyArIGluZGV4KTsNCgkJCQkJCQkgJCh3aW5kb3cpLnRyaWdnZXIoJ1RlbXBsYXRlJyx7IHRlbXBsYXRlIDogJ1Byb2R1Y3RDYXRlZ29yeUwnKyBpbmRleH0pOw0KDQoJCQkJCQkJIGluZGV4Kys7DQoJCQkJCQkJIHJlbmRlckxldmVsKGluZGV4KTsNCgkJCQkJCQkgcmVuZGVyUERIZWFkZXJCb3hDb250ZW50KGluZGV4KTsNCgkJCQkJCQkgdmFyIG91dGVyQ29udGFpbmVyID0gJCgiPGRpdiBpZD0ncERyaWxsTGV2ZWwiICsgaW5kZXggKyAiJyBjbGFzcz0ncGFuZWwtYm9keSBwcm9kdWN0LWZpbmRlci1saXN0LXZpZXcgaHAtcm93Jz48L2Rpdj4iKTsNCgkJCQkJCQkgdmFyIHByb2RGYW1pbHlMaXN0ID0gJCgnPHVsPjwvdWw+Jyk7DQoNCgkJCQkJCQkgdmFyIHZlcnRpY2FsUG9wdWxhdGUgPSB0cnVlOw0KCQkJCQkJCSB2YXIgYnJlYWtwb2ludCA9IGxpc3RWaWV3QnJlYWs7DQoJCQkJCQkJIHZhciBsaXN0bGVuZ3RoID0gZGF0YS5maWVsZExpc3QubGVuZ3RoOw0KCQkJCQkJCSB2YXIgY29sc1RvRHJhdyA9IDE7DQoJCQkJCQkJIHZhciByZXN1bHRUZW1wID0gbGlzdGxlbmd0aCAvIGJyZWFrcG9pbnQgfCAwOw0KCQkJCQkJCSB2YXIgcmVtYWluZGVyVGVtcCA9IGxpc3RsZW5ndGggJSBicmVha3BvaW50Ow0KDQoJCQkJCQkJIGlmIChyZXN1bHRUZW1wID49IDMpIHsNCgkJCQkJCQkJIGNvbHNUb0RyYXcgPSAzOw0KCQkJCQkJCSB9IGVsc2UgaWYgKHJlc3VsdFRlbXAgIT0gMCkgew0KCQkJCQkJCQkgaWYgKHJlbWFpbmRlclRlbXAgIT0gMCkgew0KCQkJCQkJCQkJIGNvbHNUb0RyYXcgPSByZXN1bHRUZW1wICsgMTsNCgkJCQkJCQkJIH0gZWxzZSB7DQoJCQkJCQkJCQkgY29sc1RvRHJhdyA9IHJlc3VsdFRlbXA7DQoJCQkJCQkJCSB9DQoJCQkJCQkJIH0NCg0KCQkJCQkJCSBpZiAodmVydGljYWxQb3B1bGF0ZSkgew0KCQkJCQkJCQkgdmFyIHZhbHNQZXJDb2wgPSAoZGF0YS5maWVsZExpc3QubGVuZ3RoIC8gY29sc1RvRHJhdykgfCAwOyAvLyAiIHZhbHVlIHwgMCIgZ2V0cyBpbnRlZ2VyIHZhbHVlDQoJCQkJCQkJCSB2YXIgcmVtYWluZGVyID0gZGF0YS5maWVsZExpc3QubGVuZ3RoICUgY29sc1RvRHJhdzsNCgkJCQkJCQkJIHZhciB2YWxzQ29sID0gW3ZhbHNQZXJDb2wsIHZhbHNQZXJDb2wsIHZhbHNQZXJDb2xdOw0KDQoJCQkJCQkJCSBpZiAocmVtYWluZGVyID09IDEpIHsNCgkJCQkJCQkJCSB2YWxzQ29sWzBdICsrOw0KCQkJCQkJCQkgfQ0KDQoJCQkJCQkJCSBpZiAocmVtYWluZGVyID09IDIpIHsNCgkJCQkJCQkJCSB2YWxzQ29sWzBdICsrOw0KCQkJCQkJCQkJIHZhbHNDb2xbMV0gKys7DQoJCQkJCQkJCSB9DQoNCgkJCQkJCQkJIGZvciAodmFyIHggPSAxOyB4IDw9IGNvbHNUb0RyYXc7IHgrKykgew0KCQkJCQkJCQkJIHZhciBzdGFydFZhbCA9IDA7DQoJCQkJCQkJCQkgaWYgKHggPT0gMikgew0KCQkJCQkJCQkJCSBzdGFydFZhbCA9IHZhbHNDb2xbMF07DQoJCQkJCQkJCQkgfQ0KCQkJCQkJCQkJIGlmICh4ID09IDMpIHsNCgkJCQkJCQkJCQkgc3RhcnRWYWwgPSB2YWxzQ29sWzBdICsgdmFsc0NvbFsxXTsNCgkJCQkJCQkJCSB9DQoNCgkJCQkJCQkJCSB2YXIgZW5kVmFsID0gMDsNCgkJCQkJCQkJCSBmb3IgKHZhciB5ID0gMTsgeSA8PSB4OyB5KyspIHsNCgkJCQkJCQkJCQkgZW5kVmFsICs9IHZhbHNDb2xbeSAtIDFdOw0KCQkJCQkJCQkJIH0NCgkJCQkJCQkJCXZhciBsaXN0SG9sZGVyID0gJCgnPGRpdiBjbGFzcz0iY29sLWxnLTgiPjwvZGl2PicpOw0KCQkJCQkJCQkJIHZhciBsaXN0Q29sID0gJCgnPHVsIGNsYXNzPSJwcm9kdWN0LWZpbmRlci1saXN0Ij48L3VsPicpOw0KCQkJCQkJCQkJIGxpc3RIb2xkZXIuYXBwZW5kKGxpc3RDb2wpOw0KCQkJCQkJCQkJIG91dGVyQ29udGFpbmVyLmFwcGVuZChsaXN0SG9sZGVyKTsNCgkJCQkJCQkJCSBmb3IgKHZhciBpID0gc3RhcnRWYWw7IGkgPCBlbmRWYWw7IGkrKykgew0KDQoJCQkJCQkJCQkJIGxpc3RDb2wuYXBwZW5kKCc8bGkgY2xhc3M9ImVsZW0iICA+PHNwYW4gIHRhYmluZGV4PScrIGN1cnJlbnRUYWJJbmRleCArJyBocmVmPSIjIiByZWRpcmVjdFVybD0iJyArIGRhdGEuZmllbGRMaXN0W2ldLnJlZGlyZWN0VXJsICsgJyIgY2xhenpUeXBlPSInICsgZGF0YS5maWVsZExpc3RbaV0uY2xhenpUeXBlICsgJyIgcmF3LWRhdGEtdmFsdWU9IicgKyBkYXRhLmZpZWxkTGlzdFtpXS51aWQgKyAnIiBzZW8tbGFiZWw9IicgKyBkYXRhLmZpZWxkTGlzdFtpXS5zZW9MYWJlbCArICciPjxzcGFuIGlkPSJwRHJpbGxMZXZlbCcgKyBpbmRleCArICdFbGVtZW50JyArIGkgKyAnInJvbGU9ImJ1dHRvbiIgY2xhc3M9InBDYXJvdXNhbFRpdGxlIHRpdGxlIiByYXctZGF0YS12YWx1ZT0iJyArIGRhdGEuZmllbGRMaXN0W2ldLnVpZCArICciICBzZW8tbGFiZWw9IicgKyBkYXRhLmZpZWxkTGlzdFtpXS5zZW9MYWJlbCArICciID4nICsgZGF0YS5maWVsZExpc3RbaV0udmFsdWUgKyAnPC9zcGFuPjwvc3Bhbj48L2xpPicpOw0KCQkJCQkJCQkJIH0NCgkJCQkJCQkJIH0NCgkJCQkJCQkgfSBlbHNlIHsNCgkJCQkJCQkJIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5maWVsZExpc3QubGVuZ3RoOyBpKyspIHsNCgkJCQkJCQkJCSBwcm9kRmFtaWx5TGlzdC5hcHBlbmQoJzxsaSBjbGFzcz0iY29sLWxnLTggY29sLXNtLTI0Ij48c3BhbiB0YWJpbmRleD0nKyBjdXJyZW50VGFiSW5kZXggKycgIGhyZWY9IiMiIHJlZGlyZWN0VXJsPSInICsgZGF0YS5maWVsZExpc3RbaV0ucmVkaXJlY3RVcmwgKyAnIiBjbGF6elR5cGU9IicgKyBkYXRhLmZpZWxkTGlzdFtpXS5jbGF6elR5cGUgKyAnIiByYXctZGF0YS12YWx1ZT0iJyArIGRhdGEuZmllbGRMaXN0W2ldLnVpZCArICciIHNlby1sYWJlbD0iJyArIGRhdGEuZmllbGRMaXN0W2ldLnNlb0xhYmVsICsgJyI+PHNwYW4gaWQ9InBEcmlsbExldmVsRWxlbWVudCcgKyBpICsgJyJyb2xlPSJidXR0b24iIGNsYXNzPSJwQ2Fyb3VzYWxUaXRsZSB0aXRsZSIgcmF3LWRhdGEtdmFsdWU9IicgKyBkYXRhLmZpZWxkTGlzdFtpXS51aWQgKyAnIiAgc2VvLWxhYmVsPSInICsgZGF0YS5maWVsZExpc3RbaV0uc2VvTGFiZWwgKyAnIiA+JyArIGRhdGEuZmllbGRMaXN0W2ldLnZhbHVlICsgJzwvc3Bhbj48L3NwYW4+PC9saT4nKTsNCgkJCQkJCQkJCSBvdXRlckNvbnRhaW5lci5hcHBlbmQocHJvZEZhbWlseUxpc3QpOw0KCQkJCQkJCQkgfQ0KCQkJCQkJCSB9DQoNCgkJCQkJCQkgJCgnI2R2Q29udGVudENvbnRhaW5lckxldmVsJyArIGluZGV4KS5hcHBlbmQob3V0ZXJDb250YWluZXIpOw0KDQoJCQkJCQkJIGlmIChkaXNwU3RhdGUgPT0gZmFsc2UpIHsNCgkJCQkJCQkJIC8vIGxvYWQgYXMgY2xvc2VkIGRpdiB3aXRoIGEgc2VsZWN0ZWQgc3RhdGUNCgkJCQkJCQkJIGlmKCQoJyNkdkNvbnRlbnRDb250YWluZXJMZXZlbCcgKyBpbmRleCkuaGFzQ2xhc3MoImluIikpIHsNCgkJCQkJCQkJCQkJCSQoJyNkdkNvbnRlbnRDb250YWluZXJMZXZlbCcgKyBpbmRleCkucmVtb3ZlQ2xhc3MoImluIik7DQoJCQkJCQkJCQkJCX0NCgkJCQkJCQkJCQkJIC8vY29sbGFwc2UgdGhlIHBhbmVsDQoJCQkJCQkJCQkJCSAkKCcjZHZDb250ZW50Q29udGFpbmVyTGV2ZWwnICsgaW5kZXgpLmNzcygnZGlzcGxheScsJ25vbmUnKTsNCg0KCQkJCQkJCQkJCQkgLy9yZW1vdmUgb3BlbiBjbGFzcyB0byBjaGFuZ2UgZXhwYW5kIGNvbGxhcHNlIGJ1dHRvbg0KCQkJCQkJCQkJCQkgJCgnI2FFeHBhbmRDb2xsYXBzZScrIGluZGV4KS5yZW1vdmVDbGFzcygndG9nZ2xlZCcpDQoJCQkJCQkJCQkJCSAkKCcjZHZOYXJyb3dpbmdTZWxlY3Rpb25MZXZlbCcgKyBpbmRleCkucmVtb3ZlQ2xhc3MoJ29wZW4nKTsNCgkJCQkJCQkJCQkJICQoJyNhRXhwYW5kQ29sbGFwc2UnICsgaW5kZXgpLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCdmYWxzZScpOw0KCQkJCQkJCQkgLy8gcmVtb3ZlIGJvbGQgZnJvbSBoZWFkaW5nDQoJCQkJCQkJCSBpZiAoJCgiI2R2TmFycm93aW5nU2VsZWN0aW9uTGV2ZWwiICsgaW5kZXggKyAiIC5uYXJyb3dTZWxlY3Rpb24iKS5oYXNDbGFzcygnSFBTaW1wbGlmaWVkQm9sZE5ldycpKQ0KCQkJCQkJCQkJICQoIiNkdk5hcnJvd2luZ1NlbGVjdGlvbkxldmVsIiArIGluZGV4ICsgIiAubmFycm93U2VsZWN0aW9uIikucmVtb3ZlQ2xhc3MoJ0hQU2ltcGxpZmllZEJvbGROZXcnKTsNCgkJCQkJCQkgfQ0KCQkJCQkJCSBhdHRhY2hEcmlsbGRvd25FdmVudEhhbmRsZXJzKGluZGV4KTsNCgkJCQkJCSB9Ow0KDQoJCQkJCQkgLy8gZnVuY3Rpb24gdG8gcmVuZGVyIGZpbmFsIGdyaWQvbGlzdCBsZXZlbA0KCQkJCQkJIGNyZWF0ZVByb2R1Y3RHcmlkVmlldyA9IGZ1bmN0aW9uKGRhdGEsIGluZGV4KSB7DQoJCQkJCQkJIC8vc2V0IGN1cnJlbnQgbGV2ZWwgbnVtYmVyIGludG8gZGF0YSBMYXllcg0KCQkJCQkJCSBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ1Byb2R1Y3RDYXRlZ29yeUwnICsgaW5kZXgpOw0KCQkJCQkJCSAkKHdpbmRvdykudHJpZ2dlcignVGVtcGxhdGUnLHsgdGVtcGxhdGUgOiAnUHJvZHVjdENhdGVnb3J5TCcrIGluZGV4fSk7DQoNCgkJCQkJCQkgLy92YXIgZmluYWxHcmlkQ29udGFpbmVyID0gJCgnPGRpdiBpZD0iZmluYWxHcmlkQ29udGFpbmVyIiBjbGFzcz0iZmluYWxHcmlkQ29udGFpbmVyIj4nKTsNCgkJCQkJCQkgdmFyIGZpbmFsR3JpZENvbnRhaW5lciA9ICQoJyNmaW5hbEdyaWRDb250YWluZXInKTsNCgkJCQkJCQkgaWYoJCgnI2ZpbmFsR3JpZENvbnRhaW5lcicpLmxlbmd0aD4wKXsNCgkJCQkJCQkJZmluYWxHcmlkQ29udGFpbmVyID0gJCgnI2ZpbmFsR3JpZENvbnRhaW5lcicpOw0KCQkJCQkJCSB9DQoJCQkJCQkJIHZhciBmaW5hbEdyaWRIZWFkZXJDb250YWluZXIgPSAkKCc8ZGl2IGlkPSJmaW5hbEdyaWRIZWFkZXJDb250YWluZXIiIGNsYXNzPSJocC1zZWN0aW9uIGhwLXNlY3Rpb24tc20gcHJvZHVjdC1maW5kZXItcmVzdWx0cyI+Jyk7DQoJCQkJCQkJIHZhciBmaW5hbEdyaWQgPSAkKCc8ZGl2IGlkPSJmaW5hbEdyaWQiIGNsYXNzPSJocC1zZWN0aW9uIGhwLXNlY3Rpb24tc20iPicpOw0KCQkJCQkJCSB2YXIgZmluYWxHcmlkRm9vdGVyQ29udGFpbmVyID0gJCgnPGRpdiBpZD0iZmluYWxHcmlkRm9vdGVyQ29udGFpbmVyIiBjbGFzcz0iaHAtc2VjdGlvbiBocC1zZWN0aW9uLXNtIj4nKTsNCg0KCQkJCQkJCSAvLyBmaW5hbEdyaWQgSGVhZGVyDQoJCQkJCQkJIHZhciBmaW5hbEdyaWRIZWFkZXJUZXh0ID0gJCgnPGgxIGlkPSJmaW5hbEhlYWRlclRleHQiID48L2gxPicpOw0KCQkJCQkJCSB2YXIgZmluYWxHcmlkU3dhcGFibGVWaWV3cyA9ICQoJzxkaXYgaWQ9ImZpbmFsR3JpZFN3YXBWaWV3Q29udHJvbCIgY2xhc3M9InN3YXBWaWV3SG9sZGVyIj4nKTsNCgkJCQkJCQkgdmFyIGZpbmFsR3JpZFBhZ2luYXRpb24gPSAkKCc8ZGl2IGlkPSJmaW5hbEdyaWRQYWdpbmF0aW9uIiBjbGFzcz0icGFnaW5hdGlvbkhvbGRlciI+Jyk7DQoNCgkJCQkJCQkgLy8gY3JlYXRlIHN0cnVjdHVyZQ0KCQkJCQkJCSBmaW5hbEdyaWRDb250YWluZXIuYXBwZW5kKGZpbmFsR3JpZEhlYWRlckNvbnRhaW5lcik7DQoJCQkJCQkJIGZpbmFsR3JpZENvbnRhaW5lci5hcHBlbmQoZmluYWxHcmlkKTsNCgkJCQkJCQkgZmluYWxHcmlkQ29udGFpbmVyLmFwcGVuZChmaW5hbEdyaWRGb290ZXJDb250YWluZXIpOw0KDQoJCQkJCQkJIC8vIGNyZWF0ZSBIZWFkZXJTdHJ1Y3R1cmUNCgkJCQkJCQkgdmFyIGhwUm93ID0gJCgnPGRpdiBjbGFzcz0iaHAtcm93Ij48L2Rpdj4nKTsNCgkJCQkJCQkgZmluYWxHcmlkSGVhZGVyQ29udGFpbmVyLmFwcGVuZChocFJvdyk7DQoJCQkJCQkJIGhwUm93LmFwcGVuZChmaW5hbEdyaWRIZWFkZXJUZXh0KTsNCgkJCQkJCQkgaHBSb3cuYXBwZW5kKGZpbmFsR3JpZFN3YXBhYmxlVmlld3MpOw0KCQkJCQkJCSBocFJvdy5hcHBlbmQoZmluYWxHcmlkUGFnaW5hdGlvbik7DQoJCQkJCQkJIA0KCQkJCQkJCSAvL2ZpbmFsR3JpZENvbnRhaW5lci5hcHBlbmQoZmluYWxHcmlkQ29udGFpbmVyKTsNCgkJCQkJCQkgDQoJCQkJCQkJIC8vIGluc3RhbnRpYXRlIGdyaWQgb2JqZWN0DQoJCQkJCQkJIGZpbmFsR3JpZFBhZ2VOdW1iZXIgPSAxOw0KCQkJCQkJCSBmaW5hbEdyaWRKU09OID0gZGF0YTsNCgkJCQkJCQkgZmluYWxHcmlkVmlld1R5cGUgPSAnZ3JpZCc7DQoJCQkJCQkJIGNyZWF0ZUZpbmFsR3JpZChmaW5hbEdyaWRKU09OLCBmaW5hbEdyaWRQYWdlTnVtYmVyKTsNCgkJCQkJCQkgcG9wdWxhdGVGaW5hbEdyaWRIZWFkZXIoaW5kZXgsIGRhdGEpOw0KDQoJCQkJCQkJIHJlbmRlclBhZ2luYXRpb24oJ2ZpbmFsR3JpZEZvb3RlckNvbnRhaW5lcicpOw0KCQkJCQkJCSBmaWxsUGFnaW5hdGlvbignZmluYWxHcmlkRm9vdGVyQ29udGFpbmVyJywgcGFnZVNpemUsIGRhdGEpOw0KCQkJCQkJCSBoYW5kbGVQYWdpbmF0aW9uKCdmaW5hbEdyaWRDb250YWluZXInKTsNCg0KCQkJCQkJCS8vICQoJyNmaW5hbEdyaWQgdWwgbGk6bnRoLWNoaWxkKDRuKScpLmNzcygnbWFyZ2luLXJpZ2h0JywgJzBweCcpOw0KCQkJCQkJIH07DQoNCgkJCQkJCSBjcmVhdGVGaW5hbEdyaWQgPSBmdW5jdGlvbihkYXRhLCBwYWdlTnVtYmVyKSB7DQoJCQkJCQkJIHZhciBmaW5hbEdyaWRJRCA9ICdmaW5hbEdyaWQnOw0KCQkJCQkJCSB2YXIgZmluYWxHcmlkUm93ID0gJCgnPGRpdiBjbGFzcz0iaHAtcm93Ij48L2Rpdj4nKTsNCgkJCQkJCQkgdmFyIGZpbmFsR3JpZEJvb3RzdHJhcCA9ICQoJzxkaXYgY2xhc3M9ImNvbC1sZy0yNCI+PC9kaXY+Jyk7DQoJCQkJCQkJIA0KCQkJCQkJCSBpZihmaW5hbEdyaWRWaWV3VHlwZT09ImdyaWQiKQ0KCQkJCQkJCSB7DQoJCQkJCQkJCWZpbmFsR3JpZENsYXNzID0gJ3Byb2R1Y3QtZ3JpZC12aWV3JzsNCgkJCQkJCQkgfQ0KCQkJCQkJCSBlbHNlew0KCQkJCQkJCQlmaW5hbEdyaWRDbGFzcyA9ICdwcm9kdWN0LWxpc3Qtdmlldyc7DQoJCQkJCQkJIH0NCgkJCQkJCQkgDQoJCQkJCQkJIHZhciBmaW5hbEdyaWRMaXN0ID0gJCgnPHVsIGlkPSJwcm9kdWN0R3JpZExpc3QiIGNsYXNzPSInK2ZpbmFsR3JpZENsYXNzKyciPjwvdWw+Jyk7DQoJCQkJCQkJIA0KCQkJCQkJCSAkKCcjJyArIGZpbmFsR3JpZElEKS5hcHBlbmQoZmluYWxHcmlkUm93KTsNCgkJCQkJCQkgJChmaW5hbEdyaWRSb3cpLmFwcGVuZChmaW5hbEdyaWRCb290c3RyYXApOw0KCQkJCQkJCSAkKGZpbmFsR3JpZEJvb3RzdHJhcCkuYXBwZW5kKGZpbmFsR3JpZExpc3QpOyANCgkJCQkJCQkgDQoJCQkJCQkJIHN0YXJ0VmFsID0gKChwYWdlTnVtYmVyIC0gMSkgKiBwYWdlU2l6ZSkgKyAxOw0KDQoJCQkJCQkJIGlmIChkYXRhLmZpZWxkTGlzdC5sZW5ndGggPCBwYWdlU2l6ZSkNCgkJCQkJCQkJIGVuZFZhbCA9IGRhdGEuZmllbGRMaXN0Lmxlbmd0aDsNCgkJCQkJCQkgZWxzZQ0KCQkJCQkJCQkgZW5kVmFsID0gKHBhZ2VOdW1iZXIgKiBwYWdlU2l6ZSk7DQoNCgkJCQkJCQkgaWYgKGRhdGEuZmllbGRMaXN0Lmxlbmd0aCA8IGVuZFZhbCkNCgkJCQkJCQkJIGVuZFZhbCA9IGRhdGEuZmllbGRMaXN0Lmxlbmd0aDsNCg0KCQkJCQkJCSBjdXJyZW50R3JpZEpTT04gPSBbXTsNCgkJCQkJCQkgZm9yICh2YXIgaSA9IHN0YXJ0VmFsIC0gMTsgaSA8IGVuZFZhbDsgaSsrKSB7DQoJCQkJCQkJCSBpbWFnZVVSTCA9IGRhdGEuZmllbGRMaXN0W2ldLmltYWdlVXJsOw0KCQkJCQkJCQkgaWYgKGltYWdlVVJMID09IG51bGwgfHwgaW1hZ2VVUkwgPT0gJ251bGwnIHx8IGltYWdlVVJMID09ICcnKSB7DQoJCQkJCQkJCQkgaW1hZ2VVUkwgPSBmYWxsYmFja0ltYWdlOw0KCQkJCQkJCQkgfQ0KCQkJCQkJCQkNCgkJCQkJCQkJIGN1cnJlbnRHcmlkSlNPTi5wdXNoKGRhdGEuZmllbGRMaXN0W2ldKTsNCgkJCQkJCQkJIGZpbmFsR3JpZExpc3QuYXBwZW5kKCc8bGkgY2xhc3M9InByb2R1Y3QiPicrDQoJCQkJCQkJCQkJCQkJCSc8YSAgICBocmVmPSInICsgZGF0YS5maWVsZExpc3RbaV0ucmVkaXJlY3RVcmwgKyAnIiBjbGF6elR5cGU9IicgKyBkYXRhLmZpZWxkTGlzdFtpXS5jbGF6elR5cGUgKyAnIiByYXctZGF0YS12YWx1ZT0iJyArIGRhdGEuZmllbGRMaXN0W2ldLnVpZCArICciPicrDQoJCQkJCQkJCQkJCQkJCQknPGRpdiBpZD0iZmluYWxHcmlkX2ltYWdlJyArIGkgKyAnIiBjbGFzcz0icHJvZHVjdC1pbm5lciI+JysNCgkJCQkJCQkJCQkJCQkJCQknPGltZyBzcmM9IicgKyBpbWFnZVVSTCArICciIGFsdD0iJysgZGF0YS5maWVsZExpc3RbaV0udmFsdWUgKyciLz4nKw0KCQkJCQkJCQkJCQkJCQkJJzwvZGl2PicrDQoJCQkJCQkJCQkJCQkJCQknPGRpdiBjbGFzcz0icHJvZHVjdC1pbm5lci1ib3QiPicrDQoJCQkJCQkJCQkJCQkJCQkJJzxzcGFuIGlkPSJmaW5hbEdyaWRfdGl0bGUnICsgaSArICciIGNsYXNzPSIiPicgKyBkYXRhLmZpZWxkTGlzdFtpXS52YWx1ZSArICc8L3NwYW4+JysNCgkJCQkJCQkJCQkJCQkJCQknPHNwYW4gaWQ9ImZpbmFsR3JpZF92aWV3TW9kZWwnICsgaSArICciIGNsYXNzPSJ2aWV3LXNlcmllcyI+JyArIGRyaWxsZG93blZhcmlhYmxlU2V0LmxvY2FsaXplZFZhbHVlcy52aWV3TW9kZWxzICsgJzwvc3Bhbj4nKw0KCQkJCQkJCQkJCQkJCQkJJzwvZGl2PicrDQoJCQkJCQkJCQkJCQkJCSc8L2E+JysNCgkJCQkJCQkJCQkJCQknPC9saT4nKTsNCgkJCQkJCQkgfQ0KCQkJCQkJCSAkKCcjJyArIGZpbmFsR3JpZElEKS5lbXB0eSgpOw0KCQkJCQkJCSAkKCcjJyArIGZpbmFsR3JpZElEKS5hcHBlbmQoZmluYWxHcmlkUm93KTsNCgkJCQkJCQkgJChmaW5hbEdyaWRSb3cpLmFwcGVuZChmaW5hbEdyaWRCb290c3RyYXApOw0KCQkJCQkJCSAkKGZpbmFsR3JpZEJvb3RzdHJhcCkuYXBwZW5kKGZpbmFsR3JpZExpc3QpOyANCgkJCQkJCQkgdXBkYXRlUGFnaW5hdGlvbignZmluYWxHcmlkQ29udGFpbmVyJywgZGF0YSwgc3RhcnRWYWwsIGVuZFZhbCk7DQoJCQkJCQkgfTsNCg0KCQkJCQkJIHJlbmRlclBhZ2VWaWV3VG9nZ2xlID0gZnVuY3Rpb24obG9jYXRpb25JRCkgew0KDQoJCQkJCQkJIHZhciB2aWV3VG9nZ2xlQ29udGFpbmVyID0gJCgnPGRpdiBpZD0iZmluYWxHcmlkVG9nZ2xlVmlld0NvbnRhaW5lciIgY2xhc3M9InZpZXctY29udGFpbmVyIiA+Jyk7DQoJCQkJCQkJIHZhciB2aWV3VG9nZ2xlVGV4dCA9ICQoJzxzcGFuIGlkPSIiIGNsYXNzPSJoaWRkZW4tc20iPicrIGRyaWxsZG93blZhcmlhYmxlU2V0LmxvY2FsaXplZFZhbHVlcy5wYWdpbmF0aW9uVmlld3MgKycgPC9zcGFuPicpOw0KCQkJCQkJCSB2YXIgdmlld09wdGlvbkxpc3QgPSAkKCc8YnV0dG9uICBhcmlhLWxhYmVsPSJsaXN0IiAgaWQ9InByb2R1Y3QtbGlzdC12aWV3IiBjbGFzcz0idmlldy1idXR0b24gbGlzdC12aWV3ICAiIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSI+PC9idXR0b24+Jyk7DQoJCQkJCQkJIHZhciB2aWV3T3B0aW9uR3JpZCA9ICQoJzxidXR0b24gIGFyaWEtbGFiZWw9ImdyaWQiIGlkPSJwcm9kdWN0LWdyaWQtdmlldyIgY2xhc3M9InZpZXctYnV0dG9uIGdyaWQtdmlldyBhY3RpdmUiIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSI+PC9idXR0b24+Jyk7DQoNCgkJCQkJCQkgdmlld1RvZ2dsZUNvbnRhaW5lci5hcHBlbmQodmlld1RvZ2dsZVRleHQpOw0KCQkJCQkJCSB2aWV3VG9nZ2xlQ29udGFpbmVyLmFwcGVuZCh2aWV3T3B0aW9uTGlzdCk7DQoJCQkJCQkJIHZpZXdUb2dnbGVDb250YWluZXIuYXBwZW5kKHZpZXdPcHRpb25HcmlkKTsNCgkJCQkJCQkNCgkJCQkJCQkgJCgnIycgKyBsb2NhdGlvbklEKS5hcHBlbmQodmlld1RvZ2dsZUNvbnRhaW5lcik7DQoNCgkJCQkJCQkgJCgnI2ZpbmFsR3JpZFRvZ2dsZVZpZXdDb250YWluZXInKS5maW5kKCcuZ3JpZC12aWV3Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7DQoNCgkJCQkJCQkJICQoJy5ncmlkLXZpZXcnKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoNCgkJCQkJCQkJIGlmICgkKCcubGlzdC12aWV3JykuaGFzQ2xhc3MoJ2FjdGl2ZScpKQ0KCQkJCQkJCQkJICQoJy5saXN0LXZpZXcnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoNCgkJCQkJCQkJICQoJyNwcm9kdWN0R3JpZExpc3QnKS5hdHRyKCdjbGFzcycsICdwcm9kdWN0LWdyaWQtdmlldycpOw0KCQkJCQkJCQkgZmluYWxHcmlkVmlld1R5cGUgPSAiZ3JpZCI7DQoNCgkJCQkJCQkgfSk7DQoNCgkJCQkJCQkgJCgnI2ZpbmFsR3JpZFRvZ2dsZVZpZXdDb250YWluZXInKS5maW5kKCcubGlzdC12aWV3Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7DQoNCgkJCQkJCQkJICQoJy5saXN0LXZpZXcnKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoNCgkJCQkJCQkJIGlmICgkKCcuZ3JpZC12aWV3JykuaGFzQ2xhc3MoJ2FjdGl2ZScpKQ0KCQkJCQkJCQkJICQoJy5ncmlkLXZpZXcnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoNCgkJCQkJCQkJICQoJyNwcm9kdWN0R3JpZExpc3QnKS5hdHRyKCdjbGFzcycsICdwcm9kdWN0LWxpc3QtdmlldycpOw0KCQkJCQkJCQkgZmluYWxHcmlkVmlld1R5cGUgPSAibGlzdCI7DQoJCQkJCQkJIH0pOw0KCQkJCQkJIH07DQoNCgkJCQkJCSBoYW5kbGVQYWdpbmF0aW9uID0gZnVuY3Rpb24obG9jYXRpb25JRCkgew0KCQkJCQkJCSB2YXIgc3RhcnRWYWw7DQoJCQkJCQkJIHZhciBwYWdlVG90YWxWYWw7DQoJCQkJCQkJIHZhciBlbmRWYWw7DQoNCgkJCQkJCQkgdmFyIHN0YXJ0VmFsID0gKChmaW5hbEdyaWRQYWdlTnVtYmVyIC0gMSkgKiBwYWdlU2l6ZSkgKyAxOw0KDQoJCQkJCQkJIGlmIChudWxsICE9IGZpbmFsR3JpZEpTT04uZmllbGRMaXN0KQ0KCQkJCQkJCQkgcGFnZVRvdGFsVmFsID0gZmluYWxHcmlkSlNPTi5maWVsZExpc3QubGVuZ3RoOw0KCQkJCQkJCSBlbHNlDQoJCQkJCQkJCSBwYWdlVG90YWxWYWwgPSAiIjsNCg0KCQkJCQkJCSBpZiAocGFnZVRvdGFsVmFsIDwgcGFnZVNpemUpIHsNCgkJCQkJCQkJIGVuZFZhbCA9IHBhZ2VUb3RhbFZhbDsNCgkJCQkJCQkgfSBlbHNlIHsNCgkJCQkJCQkJIGVuZFZhbCA9IChmaW5hbEdyaWRQYWdlTnVtYmVyICogcGFnZVNpemUpOw0KCQkJCQkJCSB9DQoNCgkJCQkJCQkgaWYgKHN0YXJ0VmFsID09IDEpIHsNCgkJCQkJCQkJIC8vIGRpc2FibGUgcHJldiBidXR0b24NCgkJCQkJCQkJICQoJyMnICsgbG9jYXRpb25JRCArICcgLnBhZ2luYXRpb24tY29udGFpbmVyIC5wYWdpbmF0aW9uLWxlc3MnKS5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJyk7DQoJCQkJCQkJCSAkKCcjJyArIGxvY2F0aW9uSUQgKyAnIC5wYWdpbmF0aW9uLWNvbnRhaW5lciAucGFnaW5hdGlvbi1sZXNzJykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7DQoJCQkJCQkJIH0gZWxzZSB7DQoNCgkJCQkJCQkJICQoJyMnICsgbG9jYXRpb25JRCArICcgLnBhZ2luYXRpb24tY29udGFpbmVyIC5wYWdpbmF0aW9uLWxlc3MnKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpOw0KCQkJCQkJCQkgJCgnIycgKyBsb2NhdGlvbklEICsgJyAucGFnaW5hdGlvbi1jb250YWluZXIgLnBhZ2luYXRpb24tbGVzcycpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpOw0KCQkJCQkJCSB9DQoNCgkJCQkJCQkgaWYgKGVuZFZhbCA9PSBmaW5hbEdyaWRKU09OLmZpZWxkTGlzdC5sZW5ndGgpIHsNCgkJCQkJCQkJIC8vIGRpc2FibGUgbmV4dCBidXR0b24NCg0KCQkJCQkJCQkgJCgnIycgKyBsb2NhdGlvbklEICsgJyAucGFnaW5hdGlvbi1jb250YWluZXIgLnBhZ2luYXRpb24tbW9yZScpLmF0dHIoJ2Rpc2FibGVkJywnZGlzYWJsZWQnKTsNCgkJCQkJCQkJICQoJyMnICsgbG9jYXRpb25JRCArICcgLnBhZ2luYXRpb24tY29udGFpbmVyIC5wYWdpbmF0aW9uLW1vcmUnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTsNCgkJCQkJCQkgfSBlbHNlIHsNCg0KCQkJCQkJCQkgJCgnIycgKyBsb2NhdGlvbklEICsgJyAucGFnaW5hdGlvbi1jb250YWluZXIgLnBhZ2luYXRpb24tbW9yZScpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7DQoJCQkJCQkJCSAkKCcjJyArIGxvY2F0aW9uSUQgKyAnIC5wYWdpbmF0aW9uLWNvbnRhaW5lciAucGFnaW5hdGlvbi1tb3JlJykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7DQoJCQkJCQkJIH0NCg0KCQkJCQkJCSAkKCcjJyArIGxvY2F0aW9uSUQgKyAnIC5wYWdpbmF0aW9uLWNvbnRhaW5lciAucGFnaW5hdGlvbi1sZXNzJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHsNCgkJCQkJCQkJIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQkJCQkJCSBpZiAoISQodGhpcykuaGFzQ2xhc3MoJ2Rpc2FibGVkJykpIHsNCgkJCQkJCQkJCSBmaW5hbEdyaWRQYWdlTnVtYmVyLS07DQoNCgkJCQkJCQkJCSBzdGFydFZhbCA9ICgoZmluYWxHcmlkUGFnZU51bWJlciAtIDEpICogcGFnZVNpemUpICsgMTsNCgkJCQkJCQkJCSBlbmRWYWwgPSAoZmluYWxHcmlkUGFnZU51bWJlciAqIHBhZ2VTaXplKTsNCg0KCQkJCQkJCQkJIGlmIChmaW5hbEdyaWRQYWdlTnVtYmVyICE9IDApIHsNCgkJCQkJCQkJCQkgY3JlYXRlRmluYWxHcmlkKGZpbmFsR3JpZEpTT04sIGZpbmFsR3JpZFBhZ2VOdW1iZXIpOw0KCQkJCQkJCQkJCSB3aW5kb3cuc2Nyb2xsVG8oJCgnI2ZpbmFsR3JpZCcpLCAkKCcjZmluYWxHcmlkQ29udGFpbmVyJykucG9zaXRpb24oKS50b3ApOw0KCQkJCQkJCQkJIH0NCgkJCQkJCQkJIH0NCgkJCQkJCQkJIGlmIChzdGFydFZhbCA9PSAxKSB7DQoJCQkJCQkJCQkgLy8gZGlzYWJsZSBwcmV2IGJ1dHRvbg0KCQkJCQkJCQkJICQoJyMnICsgbG9jYXRpb25JRCArICcgLnBhZ2luYXRpb24tY29udGFpbmVyIC5wYWdpbmF0aW9uLWxlc3MnKS5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJyk7DQoJCQkJCQkJCQkgJCgnIycgKyBsb2NhdGlvbklEICsgJyAucGFnaW5hdGlvbi1jb250YWluZXIgLnBhZ2luYXRpb24tbGVzcycpLmFkZENsYXNzKCdkaXNhYmxlZCcpOw0KCQkJCQkJCQkgfSBlbHNlIHsNCgkJCQkJCQkJCSAkKCcjJyArIGxvY2F0aW9uSUQgKyAnIC5wYWdpbmF0aW9uLWNvbnRhaW5lciAucGFnaW5hdGlvbi1sZXNzJykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsNCgkJCQkJCQkJCSAkKCcjJyArIGxvY2F0aW9uSUQgKyAnIC5wYWdpbmF0aW9uLWNvbnRhaW5lciAucGFnaW5hdGlvbi1sZXNzJykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7DQoJCQkJCQkJCSB9DQoNCgkJCQkJCQkJIGlmIChlbmRWYWwgPj0gZmluYWxHcmlkSlNPTi5maWVsZExpc3QubGVuZ3RoKSB7DQoJCQkJCQkJCQkgLy8gZGlzYWJsZSBuZXh0IGJ1dHRvbg0KCQkJCQkJCQkJICQoJyMnICsgbG9jYXRpb25JRCArICcgLnBhZ2luYXRpb24tY29udGFpbmVyIC5wYWdpbmF0aW9uLW1vcmUnKS5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJyk7DQoJCQkJCQkJCQkgJCgnIycgKyBsb2NhdGlvbklEICsgJyAucGFnaW5hdGlvbi1jb250YWluZXIgLnBhZ2luYXRpb24tbW9yZScpLmFkZENsYXNzKCdkaXNhYmxlZCcpOw0KCQkJCQkJCQkgfSBlbHNlIHsNCgkJCQkJCQkJCSAkKCcjJyArIGxvY2F0aW9uSUQgKyAnIC5wYWdpbmF0aW9uLWNvbnRhaW5lciAucGFnaW5hdGlvbi1tb3JlJykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsNCgkJCQkJCQkJCSAkKCcjJyArIGxvY2F0aW9uSUQgKyAnIC5wYWdpbmF0aW9uLWNvbnRhaW5lciAucGFnaW5hdGlvbi1tb3JlJykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7DQoJCQkJCQkJCSB9DQoJCQkJCQkJIH0pOw0KDQoJCQkJCQkJICQoJyMnICsgbG9jYXRpb25JRCArICcgLnBhZ2luYXRpb24tY29udGFpbmVyIC5wYWdpbmF0aW9uLW1vcmUnKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkgew0KDQoJCQkJCQkJCSBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KDQoJCQkJCQkJCSBpZiAoISQodGhpcykuaGFzQ2xhc3MoJ2Rpc2FibGVkJykpIHsNCgkJCQkJCQkJCSBmaW5hbEdyaWRQYWdlTnVtYmVyKys7DQoJCQkJCQkJCQkgc3RhcnRWYWwgPSAoKGZpbmFsR3JpZFBhZ2VOdW1iZXIgLSAxKSAqIHBhZ2VTaXplKSArIDE7DQoJCQkJCQkJCQkgZW5kVmFsID0gKGZpbmFsR3JpZFBhZ2VOdW1iZXIgKiBwYWdlU2l6ZSk7DQoNCgkJCQkJCQkJCSBpZiAoZmluYWxHcmlkUGFnZU51bWJlciAhPSAwKSB7DQoJCQkJCQkJCQkJIGNyZWF0ZUZpbmFsR3JpZChmaW5hbEdyaWRKU09OLCBmaW5hbEdyaWRQYWdlTnVtYmVyKTsNCgkJCQkJCQkJCQkgd2luZG93LnNjcm9sbFRvKCQoJyNmaW5hbEdyaWQnKSwgJCgnI2ZpbmFsR3JpZENvbnRhaW5lcicpLnBvc2l0aW9uKCkudG9wKTsNCgkJCQkJCQkJCSB9DQoJCQkJCQkJCSB9DQoNCgkJCQkJCQkJIGlmIChzdGFydFZhbCA9PSAxKSB7DQoJCQkJCQkJCQkgLy8gZGlzYWJsZSBwcmV2IGJ1dHRvbg0KCQkJCQkJCQkJICQoJyMnICsgbG9jYXRpb25JRCArICcgLnBhZ2luYXRpb24tY29udGFpbmVyIC5wYWdpbmF0aW9uLWxlc3MnKS5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJyk7DQoJCQkJCQkJCQkgJCgnIycgKyBsb2NhdGlvbklEICsgJyAucGFnaW5hdGlvbi1jb250YWluZXIgLnBhZ2luYXRpb24tbGVzcycpLmFkZENsYXNzKCdkaXNhYmxlZCcpOw0KCQkJCQkJCQkgfSBlbHNlIHsNCg0KCQkJCQkJCQkJICQoJyMnICsgbG9jYXRpb25JRCArICcgLnBhZ2luYXRpb24tY29udGFpbmVyIC5wYWdpbmF0aW9uLWxlc3MnKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpOw0KCQkJCQkJCQkJICQoJyMnICsgbG9jYXRpb25JRCArICcgLnBhZ2luYXRpb24tY29udGFpbmVyIC5wYWdpbmF0aW9uLWxlc3MnKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTsNCgkJCQkJCQkJIH0NCg0KCQkJCQkJCQkgaWYgKGVuZFZhbCA+PSBmaW5hbEdyaWRKU09OLmZpZWxkTGlzdC5sZW5ndGgpIHsNCgkJCQkJCQkJCSAvLyBkaXNhYmxlIG5leHQgYnV0dG9uDQoNCgkJCQkJCQkJCSAkKCcjJyArIGxvY2F0aW9uSUQgKyAnIC5wYWdpbmF0aW9uLWNvbnRhaW5lciAucGFnaW5hdGlvbi1tb3JlJykuYXR0cignZGlzYWJsZWQnLCdkaXNhYmxlZCcpOw0KCQkJCQkJCQkJICQoJyMnICsgbG9jYXRpb25JRCArICcgLnBhZ2luYXRpb24tY29udGFpbmVyIC5wYWdpbmF0aW9uLW1vcmUnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTsNCgkJCQkJCQkJIH0gZWxzZSB7DQoNCgkJCQkJCQkJCSAkKCcjJyArIGxvY2F0aW9uSUQgKyAnIC5wYWdpbmF0aW9uLWNvbnRhaW5lciAucGFnaW5hdGlvbi1tb3JlJykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsNCgkJCQkJCQkJCSAkKCcjJyArIGxvY2F0aW9uSUQgKyAnIC5wYWdpbmF0aW9uLWNvbnRhaW5lciAucGFnaW5hdGlvbi1tb3JlJykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7DQoJCQkJCQkJCSB9DQoJCQkJCQkJCSAvLyB1cGRhdGVQYWdpbmF0aW9uKGxvY2F0aW9uSUQsIGRhdGEsIHN0YXJ0VmFsLA0KCQkJCQkJCQkgLy8gZW5kVmFsKQ0KCQkJCQkJCSB9KTsNCgkJCQkJCSB9Ow0KDQoJCQkJCQkgcmVuZGVyUGFnaW5hdGlvbiA9IGZ1bmN0aW9uKGxvY2F0aW9uSUQpIHsNCg0KCQkJCQkJCSB2YXIgcGFnaW5hdGlvbkNvbnRhaW5lciA9ICQoJzxkaXYgaWQ9InBhZ2luYXRpb25Db250YWluZXIiIGNsYXNzPSJwYWdpbmF0aW9uLWNvbnRhaW5lciI+PC9kaXY+Jyk7DQoJCQkJCQkJIHZhciBwYWdpbmF0aW9uVGV4dCA9ICQoJzxzcGFuIGlkPSJwYWdpbmF0aW9uVGV4dCIgY2xhc3M9InBhZ2luYXRpb25UZXh0Ij48L3NwYW4+Jyk7DQoJCQkJCQkJIHZhciBwYWdpbmF0aW9uU3RhcnRWYWwgPSAkKCc8c3BhbiBpZD0icGFnaW5hdGlvblN0YXJ0VmFsIiBjbGFzcz0icGFnaW5hdGlvblN0YXJ0VmFsIj48L3NwYW4+Jyk7DQoJCQkJCQkJIHZhciBwYWdpbmF0aW9uRW5kVmFsID0gJCgnPHNwYW4gaWQ9InBhZ2luYXRpb25FbmRWYWwiIGNsYXNzPSJwYWdpbmF0aW9uRW5kVmFsIj48L3NwYW4+Jyk7DQoJCQkJCQkJIHZhciBwYWdpbmF0aW9uVG90YWxWYWwgPSAkKCc8c3BhbiBpZD0icGFnaW5hdGlvblRvdGFsVmFsIiBjbGFzcz0icGFnaW5hdGlvblRvdGFsVmFsIj48L3NwYW4+Jyk7DQoJDQoJCQkJCQkJIHBhZ2luYXRpb25UZXh0LmFwcGVuZChwYWdpbmF0aW9uU3RhcnRWYWwpOw0KCQkJCQkJCSBwYWdpbmF0aW9uVGV4dC5hcHBlbmQoJzxzcGFuPiAtIDwvc3Bhbj4nKTsNCgkJCQkJCQkgcGFnaW5hdGlvblRleHQuYXBwZW5kKHBhZ2luYXRpb25FbmRWYWwpOw0KCQkJCQkJCSBwYWdpbmF0aW9uVGV4dC5hcHBlbmQoJzxzcGFuPiAnICsgZHJpbGxkb3duVmFyaWFibGVTZXQubG9jYWxpemVkVmFsdWVzLm9mVmFsICsgJyA8L3NwYW4+Jyk7DQoJCQkJCQkJIHBhZ2luYXRpb25UZXh0LmFwcGVuZChwYWdpbmF0aW9uVG90YWxWYWwpOw0KCQkJCQkJCSBwYWdpbmF0aW9uVGV4dC5hcHBlbmQoJzxzcGFuIGNsYXNzPSJ0b3RhbFJlc3VsdHMiPiAnICsgZHJpbGxkb3duVmFyaWFibGVTZXQubG9jYWxpemVkVmFsdWVzLnJlc3VsdHNWYWwgKyAnIDwvc3Bhbj4nKTsNCg0KCQkJCQkJCSBwYWdpbmF0aW9uQ29udGFpbmVyLmFwcGVuZChwYWdpbmF0aW9uVGV4dCk7DQoJCQkJCQkJIHBhZ2luYXRpb25Db250YWluZXIuYXBwZW5kKCc8YnV0dG9uIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgYXJpYS1sYWJlbD0iUHJldmlvdXMiIGNsYXNzPSJwYWdpbmF0aW9uLWJ1dHRvbiBwYWdpbmF0aW9uLWxlc3MiPjxzcGFuIGNsYXNzPSJwcmV2UGFnaW5hdGlvbiI+PC9pPjwvYnV0dG9uPicpOw0KCQkJCQkJCSBwYWdpbmF0aW9uQ29udGFpbmVyLmFwcGVuZCgnPGJ1dHRvbiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGFyaWEtbGFiZWw9Ik5leHQiIGNsYXNzPSJwYWdpbmF0aW9uLWJ1dHRvbiBwYWdpbmF0aW9uLW1vcmUiPjxzcGFuIGNsYXNzPSJuZXh0UGFnaW5hdGlvbiI+PC9pPjwvYnV0dG9uPicpOw0KDQoJCQkJCQkJICQoJyMnICsgbG9jYXRpb25JRCkuYXBwZW5kKHBhZ2luYXRpb25Db250YWluZXIpOw0KCQkJCQkJIH07DQoNCgkJCQkJCSBwb3B1bGF0ZUZpbmFsR3JpZEhlYWRlciA9IGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7DQoJCQkJCQkJIHZhciBoZWFkZXJDb250YWluZXIgPSAnZmluYWxHcmlkSGVhZGVyQ29udGFpbmVyJzsNCg0KCQkJCQkJCSAkKCcjJyArIGhlYWRlckNvbnRhaW5lcikuY2hpbGRyZW4oJy5ocC1yb3cnKS5jaGlsZHJlbignaDEnKS5odG1sKCQoJyNzTmFycm93aW5nU2VsZWN0aW9uSGVhZGVyTGV2ZWwnICsgaW5kZXggKycgLnRpdGxlJykuaHRtbCgpKTsNCg0KCQkJCQkJCSByZW5kZXJQYWdpbmF0aW9uKCdmaW5hbEdyaWRQYWdpbmF0aW9uJyk7DQoJCQkJCQkJIGZpbGxQYWdpbmF0aW9uKGhlYWRlckNvbnRhaW5lciwgcGFnZVNpemUsIGRhdGEpOyAvLyBmaXJzdA0KCQkJCQkJCSAvLyBjYWxsDQoJCQkJCQkJIC8vIHRvDQoJCQkJCQkJIC8vIGZpbGwNCgkJCQkJCQkgLy8gcGFnaW5hdGlvbg0KCQkJCQkJCSAvLyBzZWN0aW9uDQoJCQkJCQkJIC8vIGVnOiAxDQoJCQkJCQkJIC8vIC0gMTINCgkJCQkJCQkgLy8gb2YgNTANCgkJCQkJCQkgcmVuZGVyUGFnZVZpZXdUb2dnbGUoJ2ZpbmFsR3JpZFN3YXBWaWV3Q29udHJvbCcpOw0KCQkJCQkJIH07DQoNCgkJCQkJCSAvLyBmdW5jdGlvbiBmb3IgMXN0IGNhbGwNCgkJCQkJCSBmaWxsUGFnaW5hdGlvbiA9IGZ1bmN0aW9uKGxvY2F0aW9uSUQsIHBhZ2VTaXplLCBkYXRhKSB7DQoJCQkJCQkJIC8vIHBhZ2VUb3RhbFZhbCA9IHRvdGFsIG51bWJlciBvZiByZXN1dGxzDQoJCQkJCQkJIHZhciBwYWdlVG90YWxWYWw7DQoJCQkJCQkJIHZhciBlbmRWYWw7DQoJCQkJCQkJIHZhciBzdGFydFZhbDsNCgkJCQkJCQkgdmFyIHN0YXJ0VmFsTG9jYXRpb24gPSAnIycgKyBsb2NhdGlvbklEICsgJyAucGFnaW5hdGlvblN0YXJ0VmFsJzsNCgkJCQkJCQkgdmFyIGVuZFZhbExvY2F0aW9uID0gJyMnICsgbG9jYXRpb25JRCArICcgLnBhZ2luYXRpb25FbmRWYWwnOw0KCQkJCQkJCSB2YXIgdG90YWxWYWxMb2NhdGlvbiA9ICcjJyArIGxvY2F0aW9uSUQgKyAnIC5wYWdpbmF0aW9uVG90YWxWYWwnOw0KDQoJCQkJCQkJIGlmIChudWxsICE9IGRhdGEuZmllbGRMaXN0KQ0KCQkJCQkJCQkgcGFnZVRvdGFsVmFsID0gZGF0YS5maWVsZExpc3QubGVuZ3RoOw0KCQkJCQkJCSBlbHNlDQoJCQkJCQkJCSBwYWdlVG90YWxWYWwgPSAiIjsNCg0KCQkJCQkJCSBpZiAocGFnZVRvdGFsVmFsIDwgcGFnZVNpemUpIHsNCgkJCQkJCQkJIGVuZFZhbCA9IHBhZ2VUb3RhbFZhbDsNCgkJCQkJCQkgfSBlbHNlIHsNCgkJCQkJCQkJIGVuZFZhbCA9IHBhZ2VTaXplOw0KCQkJCQkJCSB9DQoJCQkJCQkJICQoc3RhcnRWYWxMb2NhdGlvbikuaHRtbCgnMScpOw0KCQkJCQkJCSAkKGVuZFZhbExvY2F0aW9uKS5odG1sKGVuZFZhbCk7DQoJCQkJCQkJICQodG90YWxWYWxMb2NhdGlvbikuaHRtbChwYWdlVG90YWxWYWwpOw0KCQkJCQkJIH07DQoNCgkJCQkJCSAvLyBmdW5jdGlvbiBmb3IgbnRoIGNhbGwNCgkJCQkJCSB1cGRhdGVQYWdpbmF0aW9uID0gZnVuY3Rpb24obG9jYXRpb25JRCwgZGF0YSwgcGFnZVN0YXJ0VmFsLCBwYWdlRW5kVmFsKSB7DQoJCQkJCQkJIHZhciBwYWdlVG90YWxWYWw7DQoNCgkJCQkJCQkgdmFyIHN0YXJ0VmFsTG9jYXRpb24gPSAkKCcjJyArIGxvY2F0aW9uSUQpLmZpbmQoJyAucGFnaW5hdGlvblN0YXJ0VmFsJyk7DQoJCQkJCQkJIHZhciBlbmRWYWxMb2NhdGlvbiA9ICQoJyMnICsgbG9jYXRpb25JRCkuZmluZCgnIC5wYWdpbmF0aW9uRW5kVmFsJyk7DQoJCQkJCQkJIHZhciB0b3RhbFZhbExvY2F0aW9uID0gJCgnIycgKyBsb2NhdGlvbklEKS5maW5kKCcgLnBhZ2luYXRpb25Ub3RhbFZhbCcpOw0KDQoJCQkJCQkJIGlmIChudWxsICE9IGRhdGEuZmllbGRMaXN0KQ0KCQkJCQkJCQkgcGFnZVRvdGFsVmFsID0gZGF0YS5maWVsZExpc3QubGVuZ3RoOw0KCQkJCQkJCSBlbHNlDQoJCQkJCQkJCSBwYWdlVG90YWxWYWwgPSAiIjsNCg0KCQkJCQkJCSAkKHN0YXJ0VmFsTG9jYXRpb24pLmh0bWwocGFnZVN0YXJ0VmFsKTsNCgkJCQkJCQkgJChlbmRWYWxMb2NhdGlvbikuaHRtbChwYWdlRW5kVmFsKTsNCgkJCQkJCQkgJCh0b3RhbFZhbExvY2F0aW9uKS5odG1sKHBhZ2VUb3RhbFZhbCk7DQoJCQkJCQkgfTsNCg0KCQkJCQkJIGNsZWFyTmV4dExldmVscyA9IGZ1bmN0aW9uKGx2bE5vKSB7DQoJCQkJCQkJIGlmIChsdmxObyA9PSAwKSB7DQoJCQkJCQkJCSAkKCcjcHJvZHVjdF9kcmlsbGRvd24gLnBhbmVsJykucmVtb3ZlKCk7DQoJCQkJCQkJCSAkKCcjZmluYWxHcmlkQ29udGFpbmVyJykuZW1wdHkoKTsNCgkJCQkJCQkgfSBlbHNlIHsNCgkJCQkJCQkJIGx2bE5vLS07DQoNCgkJCQkJCQkJICQoJyNwcm9kdWN0X2RyaWxsZG93biAucGFuZWw6Z3QoJyArIGx2bE5vICsgJyknKS5yZW1vdmUoKTsNCgkJCQkJCQkJICQoJyNmaW5hbEdyaWRDb250YWluZXInKS5lbXB0eSgpOw0KCQkJCQkJCSB9DQoJCQkJCQkgfTsNCg0KCQkJCQkJIGNoZWNrSWZTYW1lT3B0aW9uID0gZnVuY3Rpb24oZWxlKSB7DQoNCgkJCQkJCQkgLy8gaGVhZGVyU3BhblRhZ0lEID0gdGhlIGNhdGVnb3J5SUQgZnJvbSB0aGUgc3BhbiB0YWcNCgkJCQkJCQkgLy8gbmVhciAibmFycm93IHlvdXIgc2VsZWN0aW9uIiBpbiB0aGUgaGVhZGVyIG9mIGVhY2gNCgkJCQkJCQkgLy8gbGV2ZWwNCgkJCQkJCQkgLy8gY3VycmVudEVsZUlEID0gdGhlIGNhdGVnb3J5SUQgZnJvbSB0aGUgc2VsZWN0ZWQNCgkJCQkJCQkgLy8gZWxlbWVudA0KDQoJCQkJCQkJIGhlYWRlclNwYW5UYWdJRCA9ICQoZWxlKS5wYXJlbnRzKCdkaXYucHJvZ3Jlc3NpdmUtZGlzY2xvc3VyZS1ib3gnKS5maW5kKCdzcGFuLnByb2dyZXNzaXZlLWRpc2Nsb3N1cmUtaGVhZGVyLXRleHQnKS5jaGlsZHJlbignc3Bhbi50aXRsZScpLmF0dHIoJ3Jhdy1kYXRhLXZhbHVlJyk7DQoJCQkJCQkJIGN1cnJlbnRFbGVJRCA9ICQoZWxlKS5jaGlsZHJlbignc3Bhbi50aXRsZScpLmF0dHIoJ3Jhdy1kYXRhLXZhbHVlJyk7DQoJCQkJCQkJIGlmIChoZWFkZXJTcGFuVGFnSUQpIHsNCgkJCQkJCQkJIGlmIChoZWFkZXJTcGFuVGFnSUQgPT0gY3VycmVudEVsZUlEKSB7DQoJCQkJCQkJCQkgcmV0dXJuIGZhbHNlOyAvLyBzYW1lIHZhbHVlIHNlbGVjdGVkDQoJCQkJCQkJCSB9IGVsc2UNCgkJCQkJCQkJCSByZXR1cm4gdHJ1ZTsgLy8gZGlmZmVyZW50IHZhbHVlIHNlbGVjdGVkDQoJCQkJCQkJIH0gZWxzZSB7DQoJCQkJCQkJCSByZXR1cm4gdHJ1ZTsgLy8gZmlyc3QgcnVuIGhlbmNlIHRoZSBzcGFuIHRhZyBhZnRlcg0KCQkJCQkJCQkgLy8gTmFycm93IHlvdXIgc2VsZWN0aW9uIGlzIGVtcHR5DQoJCQkJCQkJIH0NCgkJCQkJCSB9Ow0KCQkJCQkJIHBvcHVsYXRlQ2F0ZWdvcnlGb3JTZWFyY2ggPSBmdW5jdGlvbihjbGlja2VkT2JqKXsNCgkJCQkJCQkgaWYoY2xpY2tlZE9iai5hdHRyKCdjbGF6elR5cGUnKT09J2NhdGVnb3J5X25hdmlnYXRpb24nKXsNCgkJCQkJCQkJIGNhdGVnb3J5X25hdl9wcm9kID0gY2xpY2tlZE9iai5hdHRyKCdyYXctZGF0YS12YWx1ZScpOw0KCQkJCQkJCQkgcHJvZHVjdE5hbWVGb3JTZWFyY2ggPSBjbGlja2VkT2JqLnRleHQoKS50cmltKCk7DQoJCQkJCQkJIH0NCgkJCQkJCSB9DQoJCQkJCQkgYXR0YWNoRHJpbGxkb3duRXZlbnRIYW5kbGVycyA9IGZ1bmN0aW9uKGluZGV4KSB7DQoNCgkJCQkJCQkgaWYgKCQoJyNwRHJpbGxMZXZlbCcgKyBpbmRleCkubGVuZ3RoID4gMCkgew0KCQkJCQkJCQkgJCgnI3BEcmlsbExldmVsJyArIGluZGV4ICsgJyB1bCBsaSBzcGFuJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHsNCgkJCQkJCQkJCSBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCQkJCQkJIC8vIGhpZGUgYWxsIGxldmVscyBhZnRlciB0aGlzIGxldmVsDQoJCQkJCQkJCQkgdmFyIHJlZGlyZWN0VVJMID0gJCh0aGlzKS5hdHRyKCdyZWRpcmVjdFVybCcpOw0KCQkJCQkJCQkJIGlmICgocmVkaXJlY3RVUkwgIT0gbnVsbCAmJiByZWRpcmVjdFVSTCAhPSAibnVsbCIgJiYgcmVkaXJlY3RVUkwgIT0gIiIpICYmIGluZGV4ID4gMCkgew0KCQkJCQkJCQkJCSB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJlZGlyZWN0VVJMOw0KDQoJCQkJCQkJCQkgfSBlbHNlIHsNCg0KCQkJCQkJCQkJCSB2YXIgaGVhZGVyVmFsID0gJCh0aGlzKS5jaGlsZHJlbignc3BhbicpLmNsb25lKCk7DQoJCQkJCQkJCQkJIHZhciBjbGF6elR5cGUgPSAkKHRoaXMpLmF0dHIoJ2NsYXp6VHlwZScpOw0KCQkJCQkJCQkJCSB2YXIgY2F0ZWdvcnlJZCA9ICQodGhpcykuYXR0cigncmF3LWRhdGEtdmFsdWUnKTsNCgkJCQkJCQkJCQkgdmFyIHNlb0xhYmVsID0gJCh0aGlzKS5hdHRyKCdzZW8tbGFiZWwnKTsNCgkJCQkJCQkJCQkgcG9wdWxhdGVDYXRlZ29yeUZvclNlYXJjaCgkKHRoaXMpKTsgLyogVGhpcyBmdW5jdGlvbiBpcyB0byBwb3B1bGF0ZSBhIHZhcmlhYmxlIHdpdGggdGhlIHJhdy1kYXRhLXZhbHVlIGZvciBzZWFyY2ggKi8NCgkJCQkJCQkJCQkgaWYgKGluZGV4ID09IDAgJiYgY2xhc3p6VHlwZSA9PSAiaHBzY19qdW1wX25hdmlnYXRpb24iKSB7DQoJCQkJCQkJCQkJCSB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICQodGhpcykuYXR0cignbGluaycpOw0KDQoJCQkJCQkJCQkJIH0gZWxzZSB7DQoJCQkJCQkJCQkJCSAvLyByZW1vdmUgYWxsIG90aGVyIHNlbGVjdGVkIGVsZW1lbnQgY2xhc3Nlcw0KCQkJCQkJCQkJCQkgJCh0aGlzKS5wYXJlbnRzKCcucGFuZWwtYm9keS5ocC1yb3cnKS5maW5kKCcuc2VsZWN0ZWRFbGVtZW50JykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkRWxlbWVudCcpOw0KCQkJCQkJCQkJCQkgLy8gYWRkIHNlbGVjdGVkRWxlbWVudA0KCQkJCQkJCQkJCQkgJCh0aGlzKS5hZGRDbGFzcygnc2VsZWN0ZWRFbGVtZW50Jyk7DQoNCgkJCQkJCQkJCQkJIGlmIChjaGVja0lmU2FtZU9wdGlvbih0aGlzKSkgew0KCQkJCQkJCQkJCQkJIGNsZWFyTmV4dExldmVscyhpbmRleCk7DQoJCQkJCQkJCQkJCQkgLy8gc3RvcCBwcmV2aW91cyBBSkFYIGNhbGxzICYgcmVtb3ZlIGFueQ0KCQkJCQkJCQkJCQkJIC8vIGxvYWRpbmcgZGl2cw0KCQkJCQkJCQkJCQkJIGlmIChnZXRUTVNSZXNwb25zZSkNCgkJCQkJCQkJCQkJCQkgZ2V0VE1TUmVzcG9uc2UuYWJvcnQoKTsNCgkJCQkJCQkJCQkJCSBpZiAoJCgnI2RyaWxsZG93bkxvYWRpbmdEaXYnKS5sZW5ndGggPiAwKSB7DQoJCQkJCQkJCQkJCQkJICQoJyNkcmlsbGRvd25Mb2FkaW5nRGl2JykucmVtb3ZlKCk7DQoJCQkJCQkJCQkJCQkgfQ0KCQkJCQkJCQkJCQkJIHNldEhlYWRlclZhbHVlKGluZGV4LCBoZWFkZXJWYWwpOw0KCQkJCQkJCQkJCQkJIGlmIChzdXBwb3J0c19oaXN0b3J5X2FwaSgpICYmIGNsYXp6VHlwZSA9PSBwdXNoU3RhdGVWYXIpIHsNCgkJCQkJCQkJCQkJCQkgaGFuZGxlUHVzaFN0YXRlKGNhdGVnb3J5SWQsIGluZGV4LCBzZW9MYWJlbCk7DQoJCQkJCQkJCQkJCQkgfQ0KDQoJCQkJCQkJCQkJCQkgY2hlY2tGb3JEYXRhKGNhdGVnb3J5SWQsIGluZGV4LCAncHJvZHVjdERyaWxsZG93bicsIGNsYXp6VHlwZSwgIiIsICIiKTsNCg0KCQkJCQkJCQkJCQkJIGNvbGxhcHNlTGV2ZWwoaW5kZXgpOw0KCQkJCQkJCQkJCQkgfSBlbHNlIHsNCgkJCQkJCQkJCQkJCSBjb2xsYXBzZUxldmVsKGluZGV4KTsNCgkJCQkJCQkJCQkJCSBleHBhbmRMZXZlbChpbmRleCArIDEpOw0KDQoJCQkJCQkJCQkJCSB9DQoJCQkJCQkJCQkJIH0NCgkJCQkJCQkJCSB9DQoJCQkJCQkJCSB9KTsNCg0KCQkgIAkJCQkJCS8vZm9yIGFjY2Vzc2liaWxpdHkgYWRkaW5nIGEga2V5cHJlc3MgaGFuZGxlciB0byB0cmlnZ2VyIGNsaWNrIGlmIHVzZXIgaGl0cyBlbnRlcg0KCQkgIAkJCQkJCSAkKCcjcERyaWxsTGV2ZWwnICsgaW5kZXggKyAnIHVsIGxpIHNwYW4nKS5vbigna2V5cHJlc3MnLGZ1bmN0aW9uKGUpew0KCQkgIAkJCQkJCSAJCWlmKGUua2V5Q29kZSA9PSAxMyl7DQoJCSAgCQkJCQkJIAkJCSQodGhpcykudHJpZ2dlcignY2xpY2snKTsNCgkJICAJCQkJCQkgCQl9DQoJCSAgCQkJCQkJIH0pOw0KCQkJCQkJCSB9DQoJCQkJCQkgfTsNCg0KCQkJCQkJIHJlbmRlckxldmVsID0gZnVuY3Rpb24oTEVWRUxfTlVNQkVSKSB7DQoNCgkJCQkJCQkgdmFyIHByb2dyZXNzaXZlRGlzY2xvc3VyZU1haW5Db250YWluZXIgPSAiI3Byb2R1Y3RfZHJpbGxkb3duIjsNCg0KCQkJCQkJCSAvLyBJbml0aWFsaXplIGxldmVsIHNwZWNpZmljIElEcyBieSBhcHBlbmRpbmcgbGV2ZWwNCgkJCQkJCQkgLy8gbnVtYmVyDQoJCQkJCQkJIHZhciBwcm9ncmVzc2l2ZURpc2Nsb3N1cmVCb3hJZCA9ICJkdk5hcnJvd2luZ1NlbGVjdGlvbkxldmVsIiArIExFVkVMX05VTUJFUjsNCgkJCQkJCQkgdmFyIHByb2dyZXNzaXZlRGlzY2xvc3VyZUNvbnRlbnRDb250YWluZXJJZCA9ICJkdkNvbnRlbnRDb250YWluZXJMZXZlbCIgKyBMRVZFTF9OVU1CRVI7DQoNCgkJCQkJCQkgLy8gU3RvcmUgYWxsIHRoZSBtYXJrdXAgYXMgYW4gb2JqZWN0IGFuZCB1c2UgYXMgc2VlbiBmaXQNCgkJCQkJCQkgLy8gVGhpcyBhcHByb2FjaCBhbHNvIG1ha2VzIHRoZSBjb2RlIG1vcmUgcmVhZGFibGUNCgkJCQkJCQkgLy8gdmFyIHByb2dyZXNzaXZlRGlzY2xvc3VyZUVsZW1lbnRzID0gew0KCQkJCQkJCSB2YXIgcHJvZ3Jlc3NpdmVEaXNjbG9zdXJlQm94ID0gJCgnPGRpdiBpZD0iJyArIHByb2dyZXNzaXZlRGlzY2xvc3VyZUJveElkICsgJyIgY2xhc3M9InBhbmVsIHBhbmVsLWRlZmF1bHQgb3BlbiI+Jyk7DQoNCgkJCQkJCQkgLy8gTWFya3VwIHJlbGF0ZWQgdG8gQ29udGVudCBDb250YWluZXINCgkJCQkJCQkgdmFyIGNvbnRlbnRDb250YWluZXIgPSAkKCc8ZGl2IGlkID0iJyArIHByb2dyZXNzaXZlRGlzY2xvc3VyZUNvbnRlbnRDb250YWluZXJJZCArICciICBjbGFzcz0icGFuZWwtY29sbGFwc2UgICI+Jyk7DQoNCgkJCQkJCQkgLy8gcmVuZGVyIHByb2dyZXNzaXZlIGRpY2xvc3VyZSBjb250ZW50IGNvbnRhaW5lcg0KCQkJCQkJCSBjb250ZW50Q29udGFpbmVyLmFwcGVuZFRvKHByb2dyZXNzaXZlRGlzY2xvc3VyZUJveCk7DQoNCgkJCQkJCQkgLy8gcmVuZGVyIHByb2dyZXNzaXZlIGRpc2Nsb3N1cmUgYm94IGFuZCBoZWFkZXINCgkJCQkJCQkgcHJvZ3Jlc3NpdmVEaXNjbG9zdXJlQm94LmFwcGVuZFRvKHByb2dyZXNzaXZlRGlzY2xvc3VyZU1haW5Db250YWluZXIpOw0KCQkJCQkJIH07DQoNCgkJCQkJCSBleHBhbmRMZXZlbCA9IGZ1bmN0aW9uKExFVkVMX05VTUJFUikgew0KDQoJCQkJCQkJCS8vY29sbGFwc2UgYWxsIG90aGVyIGxldmVscw0KCQkJCQkJCQlpZigkKCcucGFuZWwnKS5oYXNDbGFzcygnb3BlbicpKXsNCgkJCQkJCQkJDQoJCQkJCQkJCQkkKCcucGFuZWwnKS5yZW1vdmVDbGFzcygnb3BlbicpDQoJCQkJCQkJCX0NCgkJCQkJCQkJDQoJCQkJCQkJCWlmKCQoJy5wYW5lbC1jb2xsYXBzZScpLmhhc0NsYXNzKCdpbicpKXsNCgkJCQkJCQkJDQoJCQkJCQkJCQkkKCcucGFuZWwtY29sbGFwc2UnKS5yZW1vdmVDbGFzcygnaW4nKQ0KCQkJCQkJCQl9DQoNCgkJCQkJCQkJaWYoJCgnLnBhbmVsLWNvbGxhcHNlJykuaGFzQ2xhc3MoJ2NvbGxhcHNlJykpew0KCQkJCQkJCQkNCgkJCQkJCQkJCSQoJy5wYW5lbC1jb2xsYXBzZScpLnJlbW92ZUNsYXNzKCdjb2xsYXBzZScpDQoJCQkJCQkJCX0NCg0KCQkJCQkJCQlpZigkKCcucGFuZWwtdGl0bGUgYScpLmhhc0NsYXNzKCd0b2dnbGVkJykpew0KCQkJCQkJCQkNCgkJCQkJCQkJCSQoJy5wYW5lbC10aXRsZSBhJykucmVtb3ZlQ2xhc3MoJ3RvZ2dsZWQnKQ0KCQkJCQkJCQl9DQoNCg0KCQkJCQkJCQkkKCcucGFuZWwtY29sbGFwc2UnKS5jc3MoJ2Rpc3BsYXknLCdub25lJyk7DQoJCQkJCQkJCQ0KCQkJCQkJCSAvL2V4cGFuZCB0aGUgcGFuZWwNCgkJCQkJCQkgJCgnI2R2Q29udGVudENvbnRhaW5lckxldmVsJyArIExFVkVMX05VTUJFUikuY3NzKCdkaXNwbGF5JywnYmxvY2snKTsNCgkJCQkJCQkkKCcjZHZDb250ZW50Q29udGFpbmVyTGV2ZWwnICsgTEVWRUxfTlVNQkVSKS5hZGRDbGFzcygiaW4iKTsNCg0KCQkJCQkJCS8vc2V0IGZvY3VzIHRvIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBsaXN0DQoJCQkJCQkJJCgkKCcjZHZDb250ZW50Q29udGFpbmVyTGV2ZWwnICsgTEVWRUxfTlVNQkVSKycgdWwgbGknKVswXSkuY2hpbGRyZW4oJ3NwYW4nKS50cmlnZ2VyKCdmb2N1cycpOw0KCQkJCQkJCSANCgkJCQkJCQkgLy9yZW1vdmUgb3BlbiBjbGFzcyB0byBjaGFuZ2UgZXhwYW5kIGNvbGxhcHNlIGJ1dHRvbg0KCQkJCQkJCSAkKCcjZHZOYXJyb3dpbmdTZWxlY3Rpb25MZXZlbCcgKyBMRVZFTF9OVU1CRVIpLmFkZENsYXNzKCdvcGVuJyk7CQ0KCQkJCQkJCSAkKCcjYUV4cGFuZENvbGxhcHNlJysgTEVWRUxfTlVNQkVSKS5hZGRDbGFzcygndG9nZ2xlZCcpOw0KCQkJCQkJCSAkKCcjYUV4cGFuZENvbGxhcHNlJyArIExFVkVMX05VTUJFUikuYXR0cignYXJpYS1leHBhbmRlZCcsJ3RydWUnKTsJIA0KCQkJCQkJIH07DQoNCgkJCQkJCSBjb2xsYXBzZUxldmVsID0gZnVuY3Rpb24oTEVWRUxfTlVNQkVSKSB7DQoNCgkJCQkJCQlpZigkKCcjZHZDb250ZW50Q29udGFpbmVyTGV2ZWwnICsgTEVWRUxfTlVNQkVSKS5oYXNDbGFzcygiaW4iKSkgew0KCQkJCQkJCQkkKCcjZHZDb250ZW50Q29udGFpbmVyTGV2ZWwnICsgTEVWRUxfTlVNQkVSKS5yZW1vdmVDbGFzcygiaW4iKTsNCgkJCQkJCQl9DQoJCQkJCQkJIC8vY29sbGFwc2UgdGhlIHBhbmVsDQoJCQkJCQkJICQoJyNkdkNvbnRlbnRDb250YWluZXJMZXZlbCcgKyBMRVZFTF9OVU1CRVIpLmNzcygnZGlzcGxheScsJ25vbmUnKTsNCg0KCQkJCQkJCSAvL3JlbW92ZSBvcGVuIGNsYXNzIHRvIGNoYW5nZSBleHBhbmQgY29sbGFwc2UgYnV0dG9uDQoJCQkJCQkJICQoJyNkdk5hcnJvd2luZ1NlbGVjdGlvbkxldmVsJyArIExFVkVMX05VTUJFUikucmVtb3ZlQ2xhc3MoJ29wZW4nKTsNCgkJCQkJCQkgJCgnI2FFeHBhbmRDb2xsYXBzZScrIExFVkVMX05VTUJFUikucmVtb3ZlQ2xhc3MoJ3RvZ2dsZWQnKTsNCgkJCQkJCQkgJCgnI2FFeHBhbmRDb2xsYXBzZScrIExFVkVMX05VTUJFUikuYXR0cignYXJpYS1leHBhbmRlZCcsJ2ZhbHNlJyk7DQoJCQkJCQkgfTsNCg0KCQkJCQkJIHJlbmRlclBESGVhZGVyQm94Q29udGVudCA9IGZ1bmN0aW9uKExFVkVMX05VTUJFUikgew0KCQkJCQkJCSB2YXIgcHJvZ3Jlc3NpdmVEaXNjbG9zdXJlTWFpbkNvbnRhaW5lciA9ICIjcHJvZHVjdF9kcmlsbGRvd24iOw0KCQkJCQkJCSB2YXIgcHJvZ3Jlc3NpdmVEaXNjbG9zdXJlQm94SWQgPSAiZHZOYXJyb3dpbmdTZWxlY3Rpb25MZXZlbCIgKyBMRVZFTF9OVU1CRVI7DQoJCQkJCQkJIHZhciBwcm9ncmVzc2l2ZURpc2Nsb3N1cmVIZWFkZXJMZXZlbE51bWJlcklkID0gInNOdW1iZXJDaXJjbGUiICsgTEVWRUxfTlVNQkVSOw0KCQkJCQkJCSB2YXIgcHJvZ3Jlc3NpdmVEaXNjbG9zdXJlSGVhZGVyVGV4dElkID0gInNOYXJyb3dpbmdTZWxlY3Rpb25IZWFkZXJMZXZlbCIgKyBMRVZFTF9OVU1CRVI7DQoJCQkJCQkJIHZhciBwcm9ncmVzc2l2ZURpc2Nsb3N1cmVFeHBhbmRDb2xsYXBzZUJ1dHRvbklkID0gImFFeHBhbmRDb2xsYXBzZSIgKyBMRVZFTF9OVU1CRVI7DQoNCgkJCQkJCQkgLy8gTWFya3VwIHJlbGF0ZWQgdG8gSGVhZGVyDQoJCQkJCQkJIC8vIHZhciBib290c3RyYXBNYXJrdXBGb3JIZWFkZXIgPSAkKCc8ZGl2ICBjbGFzcz0iY29sLXhzLTI0IGNvbC1tZC0yNCBjb2wtbGctMjQgYm9vdHN0cmFwTWFya3VwIj4nKTsNCgkJCQkJCQkgdmFyIGhlYWRlckJveCA9ICQoJzxkaXYgY2xhc3M9InBhbmVsLWhlYWRpbmciID48L2Rpdj4nKTsNCgkJCQkJCQkgdmFyIGhlYWRlckhlYWRpbmdUYWcgPSAkKCc8aDUgY2xhc3M9InBhbmVsLXRpdGxlIiA+PC9oNT4nKTsNCgkJCQkJCQkgdmFyIGhlYWRlckFuY2hvclRhZyA9ICQoJzxhIHJvbGU9ImJ1dHRvbiIgYXJpYS1leHBhbmRlZD0idHJ1ZSIgZGF0YS10b2dnbGU9ImNvbGxhcHNlIiBkYXRhLXBhcmVudD0iJyArIHByb2dyZXNzaXZlRGlzY2xvc3VyZU1haW5Db250YWluZXIgKyAnIiBkYXRhLXNjcm9sbD0iZmFsc2UiIGhyZWY9ImphdmFzY3JpcHQ6OyIgaWQ9IicgKyBwcm9ncmVzc2l2ZURpc2Nsb3N1cmVFeHBhbmRDb2xsYXBzZUJ1dHRvbklkICsgJyIgY2xhc3M9InRvZ2dsZWQiID48L2E+Jyk7DQoJCQkJCQkJIHZhciBoZWFkZXJMZXZlbE51bWJlckJveCA9ICQoJzxzcGFuIGlkPSAiJyArIHByb2dyZXNzaXZlRGlzY2xvc3VyZUhlYWRlckxldmVsTnVtYmVySWQgKyAnIiBjbGFzcz0iYmFkZ2UgYmFkZ2UtYmx1ZSBiYWRnZS1yb3VuZCI+JyArIExFVkVMX05VTUJFUiArICc8L3NwYW4+Jyk7DQoJCQkJCQkJIHZhciBoZWFkZXJEZWZhdWx0VGV4dCA9ICQoJzxzcGFuIGNsYXNzPSJwYW5lbC1sYWJlbCAiPicgKyBkcmlsbGRvd25WYXJpYWJsZVNldC5sb2NhbGl6ZWRWYWx1ZXMubmFycm93U2VsZWN0aW9uICsgJzogPC9zcGFuPicpOw0KCQkJCQkJCSB2YXIgaGVhZGVyU2VsZWN0ZWRUZXh0ID0gJCgnPHNwYW4gaWQ9IicgKyBwcm9ncmVzc2l2ZURpc2Nsb3N1cmVIZWFkZXJUZXh0SWQgKyAnIiBjbGFzcz0ic2VsZWN0ZWQtcHJvZHVjdCAiIHRleHQ9IiI+PC9zcGFuPicpOw0KCQkJCQkJCSAvLyB2YXIgZXhwYW5kQ29sbGFwc2VCdXR0b24gPSAkKCc8YSB0YWJpbmRleD0nKyBjdXJyZW50VGFiSW5kZXggKycgIGlkPSInK3Byb2dyZXNzaXZlRGlzY2xvc3VyZUV4cGFuZENvbGxhcHNlQnV0dG9uSWQrJyIgY2xhc3M9InByb2dyZXNzaXZlLWRpc2Nsb3N1cmUtZXhwYW5kLWNvbGxhcHNlLWJ1dHRvbiBvcGVuIHB1bGwtcmlnaHQiPjwvYT4nKTsNCg0KDQoJCQkJCQkJIC8vIEJlaGF2aW91ciBmb3IgZGlmZmVyZW50IGVsZW1lbnRzDQoJCQkJCQkJIGlmICgkKCcjJyArIHByb2dyZXNzaXZlRGlzY2xvc3VyZUJveElkKS5jaGlsZHJlbignLnBhbmVsLWhlYWRpbmcnKS5sZW5ndGggPCAxKSB7DQoJCQkJCQkJCSAkKCcjJyArIHByb2dyZXNzaXZlRGlzY2xvc3VyZUJveElkKS5wcmVwZW5kKGhlYWRlckJveCk7DQoNCgkJCQkJCQkJIGhlYWRlckhlYWRpbmdUYWcuYXBwZW5kKGhlYWRlckFuY2hvclRhZyk7DQoJCQkJCQkJCSBoZWFkZXJCb3guYXBwZW5kKGhlYWRlckhlYWRpbmdUYWcpOw0KCQkJCQkJCQkgaGVhZGVyQW5jaG9yVGFnLmFwcGVuZChoZWFkZXJMZXZlbE51bWJlckJveCk7DQoJCQkJCQkJCSBoZWFkZXJBbmNob3JUYWcuYXBwZW5kKGhlYWRlckRlZmF1bHRUZXh0KTsNCgkJCQkJCQkJIGhlYWRlckFuY2hvclRhZy5hcHBlbmQoaGVhZGVyU2VsZWN0ZWRUZXh0KTsNCgkJCQkJCQkJIGhlYWRlckFuY2hvclRhZy5hcHBlbmQoJzxkaXYgc3R5bGU9ImNsZWFyOmJvdGgiPjwvZGl2PicpDQoNCgkJCQkJCQkJIC8vaGVhZGVyQm94LmFwcGVuZChleHBhbmRDb2xsYXBzZUJ1dHRvbik7DQoJCQkJCQkJCSAvLyBBc3NpZ24gYmVoYXZpb3VyIHRvIGRpZmZlcmVudCBlbGVtZW50cw0KCQkJCQkJCQkgLy8gZXhwYW5kQ29sbGFwc2VCdXR0b24uY2xpY2sodG9nZ2xlRXhwYW5kQ29sbGFwc2VMZXZlbCk7DQoJCQkJCQkJCSAkKCcjJyArIHByb2dyZXNzaXZlRGlzY2xvc3VyZUV4cGFuZENvbGxhcHNlQnV0dG9uSWQpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkgew0KDQoJCQkJCQkJCQkgaWYgKCQoIi5wYW5lbDplcSgiICsgKExFVkVMX05VTUJFUiAtIDEpICsgIikiKS5oYXNDbGFzcygnb3BlbicpKSB7DQoJCQkJCQkJCQkJIGNvbGxhcHNlTGV2ZWwoTEVWRUxfTlVNQkVSKTsNCgkJCQkJCQkJCSB9IGVsc2Ugew0KCQkJCQkJCQkJCSBleHBhbmRMZXZlbChMRVZFTF9OVU1CRVIpOw0KCQkJCQkJCQkJIH0NCgkJCQkJCQkJIH0pOyANCgkJCQkJCQkgfQ0KCQkJCQkJIH07DQoNCgkJCQkJCSBzZXRIZWFkZXJWYWx1ZSA9IGZ1bmN0aW9uKExFVkVMX05VTUJFUiwgdmFsdWUpIHsNCg0KCQkJCQkJCSAkKCcjc05hcnJvd2luZ1NlbGVjdGlvbkhlYWRlckxldmVsJyArIExFVkVMX05VTUJFUikuZW1wdHkoKS5hcHBlbmQodmFsdWUpOw0KCQkJCQkJCSAkKCcjZHZOYXJyb3dpbmdTZWxlY3Rpb25MZXZlbCcgKyBMRVZFTF9OVU1CRVIgKycgLnBhbmVsLXRpdGxlJykuYWRkQ2xhc3MoJ3N0ZXAtY29tcGxldGUnKQ0KCQkJCQkJCSAkKCcjZHZOYXJyb3dpbmdTZWxlY3Rpb25MZXZlbCcgKyBMRVZFTF9OVU1CRVIgKyAnIC5uYXJyb3dTZWxlY3Rpb24nKS5lbXB0eSgpLmFwcGVuZChkcmlsbGRvd25WYXJpYWJsZVNldC5sb2NhbGl6ZWRWYWx1ZXMubmFycm93U2VsZWN0aW9uICsgJzonKTsNCg0KCQkJCQkJCSBpZiAodmFsdWUubGVuZ3RoID4gMCkgew0KCQkJCQkJCQkgY2hhbmdlUGFnZVRpdGxlKGRyaWxsZG93blZhcmlhYmxlU2V0LmxvY2FsaXplZFZhbHVlcy5ocFN1cHBvcnQsIHZhbHVlLmh0bWwoKSk7DQoJCQkJCQkJIH0NCgkJCQkJCSB9Ow0KDQoJCQkJCQkgY2hlY2tEcml2ZXIgPSBmdW5jdGlvbigpIHsNCgkJCQkJCQkgaWYgKCQoIiNpc0RyaXZlciIpLmxlbmd0aCA+IDApIHsNCgkJCQkJCQkJIHJldHVybiAkKCIjaXNEcml2ZXIiKS52YWwoKTsNCgkJCQkJCQkgfSBlbHNlIHsNCgkJCQkJCQkJIHJldHVybiAiZmFsc2UiOw0KCQkJCQkJCSB9DQoJCQkJCQkgfTsNCg0KCQkJCQkJIGNsZWFuTGV2ZWxTdGF0ZSA9IGZ1bmN0aW9uKGxldmVsKSB7DQoJCQkJCQkJICQoJyNkdk5hcnJvd2luZ1NlbGVjdGlvbkxldmVsJyArIGxldmVsICsgJyAgLnByb2dyZXNzaXZlLWRpc2Nsb3N1cmUtaGVhZGVyLXRleHQnKS5lbXB0eSgpOw0KCQkJCQkJCSAkKCcjZHZOYXJyb3dpbmdTZWxlY3Rpb25MZXZlbCcgKyBsZXZlbCArICcgIC5zZWxlY3RlZEVsZW1lbnQnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWRFbGVtZW50Jyk7DQoJCQkJCQkgfTsNCg0KCQkJCQkJIHNldExldmVsU3RhdGUgPSBmdW5jdGlvbihsZXZlbCwgdmFsdWUpIHsNCg0KCQkJCQkJCSB2YXIgc2VsZWN0ZWRPYmogPSAkKCcjZHZDb250ZW50Q29udGFpbmVyTGV2ZWwnICsgbGV2ZWwpLmZpbmQoJ1tyYXctZGF0YS12YWx1ZT0nICsgdmFsdWUgKyAnXScpOw0KCQkJCQkJCSBzZXRIZWFkZXJWYWx1ZShsZXZlbCwgc2VsZWN0ZWRPYmouY2hpbGRyZW4oJ3NwYW4nKS5jbG9uZSgpKTsNCgkJCQkJCQkgc2VsZWN0ZWRPYmoucGFyZW50KCdsaScpLnBhcmVudCgndWwnKS5maW5kKCcuc2VsZWN0ZWRFbGVtZW50JykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkRWxlbWVudCcpOw0KCQkJCQkJCSBzZWxlY3RlZE9iai5hZGRDbGFzcygnc2VsZWN0ZWRFbGVtZW50Jyk7DQoJCQkJCQkgfTsNCgkJCQkNCgkJCQkJCSBvcmlnaW5hbFN0YXRlID0gIi8iICsgZ2V0Q0NMQygnY2MnKSArICItIiArIGdldENDTEMoJ2xjJykgKyAiL3Byb2R1Y3RzLyI7DQoJCQkJCQkgY3VycmVudFN0YXRlID0gb3JpZ2luYWxTdGF0ZTsNCg0KCQkJCQkJIGhhbmRsZVB1c2hTdGF0ZSA9IGZ1bmN0aW9uKGNhdElELCBpbmRleCwgc2VvTGFiZWwpIHsNCgkJCQkJCSAJCXB1c2hTdGF0ZU9jY3VyZWQgID0gdHJ1ZTsNCgkJCQkJCQkJIGN1cnJlbnRTdGF0ZSA9IG9yaWdpbmFsU3RhdGU7DQoNCgkJCQkJCQkJIGlmIChudWxsICE9IGhpc3Rvcnkuc3RhdGUpIHsNCgkJCQkJCQkJCSAvLyBwdXNoU3RhdGUgaGFzIG9jY3VyZWQgYmVmb3JlDQoJCQkJCQkJCQkgdmFyIGhpc3RJbmRleCA9IGhpc3Rvcnkuc3RhdGUuaW5kZXg7DQoJCQkJCQkJCQkgdmFyIGhpc3RTdGF0ZSA9IGhpc3Rvcnkuc3RhdGUubGFzdFN0YXRlOw0KDQoJCQkJCQkJCQkgLy8JaWYoaW5kZXggPT0gaGlzdEluZGV4KXsNCgkJCQkJCQkJCSAvLyBzYW1lIGxldmVsIGJ1dCBkaWZmZXJlbnQgdmFsdWUgY2xpY2tlZA0KDQoJCQkJCQkJCQkgLy8JY3VycmVudFN0YXRlID0gaGlzdFN0YXRlOw0KCQkJCQkJCQkJIC8vfQ0KDQoJCQkJCQkJCSB9DQoNCgkJCQkJCQkJIHN0YXRlT2JqID0gew0KCQkJCQkJCQkJICJpbmRleCI6IGluZGV4LA0KCQkJCQkJCQkJICJsYXN0U3RhdGUiOiBjdXJyZW50U3RhdGUsDQoJCQkJCQkJCQkgImNhdElkIjogY2F0SUQsDQoJCQkJCQkJCQkgInNlb0xhYmVsIjogc2VvTGFiZWwNCgkJCQkJCQkJIH07DQoJCQkJCQkJCSAvLyBoYW5kbGVzIHN0YXRlcyBpZiBsZXZlbHMgYXJlIGFscmVhZHkgb3Blbg0KCQkJCQkJCQkgLy8gaWYoaW5kZXg+MCAmJiBsZXZlbHNUb09wZW4+MCl7DQoJCQkJCQkJCSBpZiAoaW5kZXggPT0gMCkgew0KCQkJCQkJCQkJIGdldFRyYWlsKGluZGV4ICsgMSk7DQoNCgkJCQkJCQkJIH0gZWxzZSB7DQoJCQkJCQkJCQkgZ2V0VHJhaWwoaW5kZXgpOw0KCQkJCQkJCQkgfQ0KCQkJCQkJCQkgdmFyIGMgPSAwOw0KCQkJCQkJCQkgd2hpbGUgKHRyYWlsW2NdICE9IG51bGwpIHsNCgkJCQkJCQkJCSBjdXJyZW50U3RhdGUgKz0gdHJhaWxbY10gKyAiLyI7DQoJCQkJCQkJCQkgYysrOw0KCQkJCQkJCSB9DQoJCQkJCQkJCSAvL0JlbG93IENvbmRpdGlvbiBhZGRlZCBmb3IgVVMgNjQ1Nw0KCQkJCQkJCQkgaWYoY3VycmVudFN0YXRlICE9IiIgJiYgY3VycmVudFN0YXRlLnN1YnN0cigtMSkgPT09ICcvJykgew0KCQkJCQkJCQkJIGN1cnJlbnRTdGF0ZSA9ICBjdXJyZW50U3RhdGUuc3Vic3RyKDAsIGN1cnJlbnRTdGF0ZS5sZW5ndGggLSAxKTsNCgkJCQkJCQkJICAgIH0JCQ0KCQkJCQkJCSAvLyB9DQoJCQkJCQkJIC8vIGlmKHNlb0xhYmVsICE9IiIgfHwgc2VvTGFiZWwhPSBudWxsIHx8IHNlb0xhYmVsICE9DQoJCQkJCQkJIC8vICJudWxsIil7DQoJCQkJCQkJIC8vIGN1cnJlbnRTdGF0ZSArPSBzZW9MYWJlbCsgIi8iOw0KCQkJCQkJCSBoaXN0b3J5LnB1c2hTdGF0ZShzdGF0ZU9iaiwgbnVsbCwgY3VycmVudFN0YXRlKTsNCgkJCQkJCQkgc2V0Q2Fub25pY2FsVXJsKCk7DQoJCQkJCQkgfTsNCgkJCQkJCSB3aW5kb3cub25wb3BzdGF0ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7DQoNCgkJCQkJCQkgLy8gc3RvcCBwcmV2aW91cyBBSkFYIGNhbGxzICYgcmVtb3ZlIGFueSBsb2FkaW5nIGRpdnMNCgkJCQkJCQkgaWYgKGdldFRNU1Jlc3BvbnNlKQ0KCQkJCQkJCQkgZ2V0VE1TUmVzcG9uc2UuYWJvcnQoKTsNCgkJCQkJCQkgaWYgKCQoJyNkcmlsbGRvd25Mb2FkaW5nRGl2JykubGVuZ3RoID4gMCkgew0KCQkJCQkJCQkgJCgnI2RyaWxsZG93bkxvYWRpbmdEaXYnKS5yZW1vdmUoKTsNCgkJCQkJCQkgfQ0KCQkJCQkJCSBoYW5kbGVQb3BTdGF0ZShldmVudC5zdGF0ZSk7DQoJCQkJCQkgfTsNCg0KCQkJCQkJIGhhbmRsZVBvcFN0YXRlID0gZnVuY3Rpb24oc3RhdGVPYmopIHsNCgkJCQkJCQkgY29uc29sZS5sb2coc3RhdGVPYmopOw0KCQkJCQkJCSBpZiAoc3RhdGVPYmogIT0gbnVsbCkgew0KCQkJCQkJCQkgdmFyIGluZGV4ID0gc3RhdGVPYmouaW5kZXg7DQoJCQkJCQkJCSBjbGVhck5leHRMZXZlbHMoaW5kZXggKyAxKTsNCgkJCQkJCQkJIGV4cGFuZExldmVsKGluZGV4ICsgMSk7DQoJCQkJCQkJCSBzZXRMZXZlbFN0YXRlKGluZGV4LCBzdGF0ZU9iai5jYXRJZCk7DQoJCQkJCQkJCSBjaGVja0ZvckRhdGEoc3RhdGVPYmouY2F0SWQsIGluZGV4LCAncHJvZHVjdERyaWxsZG93bicsICcnLCAnJywgJycpOw0KCQkJCQkJCQkgY2xlYW5MZXZlbFN0YXRlKGluZGV4ICsgMSk7DQoJCQkJCQkJIH0gZWxzZSB7DQoJCQkJCQkJIAlpZihwdXNoU3RhdGVPY2N1cmVkKXsNCgkJCQkJCQkgCQkvLyBzaG93IEdyaWQNCgkJCQkJCQkJIGNsZWFyTmV4dExldmVscygwKTsNCgkJCQkJCQkJICQoJyNwcm9kdWN0R3JpZCcpLnNob3coKTsNCgkJCQkJCQkJICQoJyNwcm9kdWN0R3JpZCcpLnBhcmVudCgnZGl2JykucGFyZW50KCdkaXYnKS5yZW1vdmVDbGFzcygnaGlkZScpOw0KCQkJCQkJCQkgJCgnI3NlbFByb2R1Y3RUeXBlJykuaGlkZSgpOw0KCQkJCQkJCQkgLy9zZXQgbGFuZGluZyBwYWdlIHZhbCBpbnRvIGRhdGEgbGF5ZXINCgkJCQkJCQkJIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnUHJvZHVjdENhdGVnb3J5TGFuZGluZycpOw0KCQkJCQkJCQkgJCh3aW5kb3cpLnRyaWdnZXIoJ1RlbXBsYXRlJyx7IHRlbXBsYXRlIDogJ1Byb2R1Y3RDYXRlZ29yeUxhbmRpbmcnfSk7DQoJCQkJCQ0KCQkJCQkJCSAJfQ0KCQkJCQkJCQkgDQovKgkJCQkJCQkJIGxldmVsc09wZW5lZCA9IDA7DQoJCQkJCQkJCSBpZiAoJCgnLm9wZW5MZXZlbCcpKSB7DQoJCQkJCQkJCQkgbGV2ZWxzVG9PcGVuID0gJCgnLm9wZW5MZXZlbCcpLmxlbmd0aDsNCgkJCQkJCQkJCSBjaGVja0Zvck9wZW5MZXZlbHMob3BlbkxldmVsc0pTT04pOw0KCQkJCQkJCQkgfQ0KDQoJCQkJCQkJCSANCiovCQkJCQkJCQkgY3VycmVudFN0YXRlID0gb3JpZ2luYWxTdGF0ZTsNCgkJCQkJCQkgfQ0KCQkJCQkJIH07DQoJCQkJCQkgc3VwcG9ydHNfaGlzdG9yeV9hcGkgPSBmdW5jdGlvbigpIHsNCgkJCQkJCQkgcmV0dXJuICEhKHdpbmRvdy5oaXN0b3J5ICYmIGhpc3RvcnkucHVzaFN0YXRlKTsNCgkJCQkJCSB9Ow0KCQkJCQkJIHRyYWlsID0gW107DQoJCQkJCQkgZ2V0VHJhaWwgPSBmdW5jdGlvbihsdmxObykgew0KCQkJCQkJCSB0cmFpbCA9IFtdOw0KCQkJCQkJCSBjb3VudGVyID0gMDsNCgkJCQkJCQkgZG8gew0KCQkJCQkJCQkgaWYgKGx2bE5vID4gMCkgew0KCQkJCQkJCQkJIHRyYWlsWzBdID0gJCgnI3NlbFByb2R1Y3RUeXBlIHNwYW4nKS5hdHRyKCdzZW8tbGFiZWwnKTsNCgkJCQkJCQkJCSBjb3VudGVyKys7DQoJCQkJCQkJCQkgaWYgKCQoJyNkdk5hcnJvd2luZ1NlbGVjdGlvbkxldmVsJyArIGNvdW50ZXIpLmxlbmd0aCA+IDApIHsNCgkJCQkJCQkJCQkgdHJhaWxbY291bnRlcl0gPSAkKCcjZHZOYXJyb3dpbmdTZWxlY3Rpb25MZXZlbCcgKyBjb3VudGVyICsgJyAucGFuZWwtdGl0bGUgc3Bhbi50aXRsZScpLmF0dHIoJ3Nlby1sYWJlbCcpOw0KCQkJCQkJCQkJIH0NCgkJCQkJCQkJIH0NCgkJCQkJCQkgfSB3aGlsZSAoY291bnRlciA8IGx2bE5vKTsNCgkJCQkJCSB9Ow0KDQoJCQkJCQkgdG9nZ2xlS25vd1dpbmRvd3NDb250YWluZXIgPSBmdW5jdGlvbihjYXRlZ29yeUlkKSB7DQoJCQkJCQkJIHZhciBzdGlja2VyQ29udGFpbmVySWQgPSAiI2R2S25vd1dpbmRvd3NDb250YWluZXIiOw0KCQkJCQkJCSAvLyBjb2RlIHRvIHNob3cgb3IgaGlkZSBiYXNlZCBvbiBjYXRlZ29yeSBpZA0KCQkJCQkJCSB2YXIgY2F0ZWdvcnlMaXN0U3RyaW5nID0gIiI7DQoJCQkJCQkJIC8vIGV4dHJhY3QgY29tbWEtc2VwYXJhdGVkIGxpc3Qgc3RyaW5nIGZyb20gaGlkZGVuDQoJCQkJCQkJIC8vIGZpZWxkDQoJCQkJCQkJIGlmICgkKCcjaGlkZGVuQ2F0ZWdvcnlMaXN0JykubGVuZ3RoID4gMCkgew0KCQkJCQkJCQkgY2F0ZWdvcnlMaXN0U3RyaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImhpZGRlbkNhdGVnb3J5TGlzdCIpLnZhbHVlOw0KCQkJCQkJCSB9DQoNCgkJCQkJCQkgLy8gY3JlYXRlIGNhdGVnb3J5IGxpc3QgYXJyYXkNCgkJCQkJCQkgdmFyIGNhdGVnb3J5TGlzdCA9IGNhdGVnb3J5TGlzdFN0cmluZy5zcGxpdCgiLCIpOw0KDQoJCQkJCQkJIC8vIGxvb3AgdGhyb3VnaCBjYXRlZ29yeSBsaXN0IGFuZCBsb2NhdGUgY2F0ZWdvcnkgaWQNCgkJCQkJCQkgdmFyIGlzQ2F0ZWdvcnlJZEV4aXN0cyA9IGZhbHNlOw0KCQkJCQkJCSBmb3IgKHZhciBpID0gMDsgaSA8IGNhdGVnb3J5TGlzdC5sZW5ndGg7IGkrKykgew0KCQkJCQkJCQkgaWYgKGNhdGVnb3J5TGlzdFtpXSA9PSBjYXRlZ29yeUlkKSB7DQoJCQkJCQkJCQkgaXNDYXRlZ29yeUlkRXhpc3RzID0gdHJ1ZTsNCgkJCQkJCQkJCSBicmVhazsNCgkJCQkJCQkJIH0NCgkJCQkJCQkgfQ0KCQkJCQkJCSAvLyBpZiBjYXRlZ29yeSBpZCBwcmVzZW50LCBkaXNwbGF5IGRpdg0KCQkJCQkJCSBpZiAoaXNDYXRlZ29yeUlkRXhpc3RzID09IHRydWUpIHsNCgkJCQkJCQkJICQoc3RpY2tlckNvbnRhaW5lcklkKS5zaG93KCk7DQoJCQkJCQkJIH0gZWxzZSB7DQoJCQkJCQkJCSAvLyBlbHNlIGhpZGUgZGl2DQoJCQkJCQkJCSAkKHN0aWNrZXJDb250YWluZXJJZCkuaGlkZSgpOw0KCQkJCQkJCSB9DQoJCQkJCQkgfTsNCgkJCQkJCSAvLyBjb2RlIHRvIGNoYW5nZSB0aGUgcGFnZSB0aXRsZSBiYXNlZCBvbiBjb250ZXh0DQoJCQkJCQkgY2hhbmdlUGFnZVRpdGxlID0gZnVuY3Rpb24oaHBTdXBwb3J0VGV4dEZyb21DYWNoZVRhZywgdHJhaWxpbmdUZXh0KSB7DQoJCQkJCQkJIC8vIGFwcGVuZCB0cmFpbGluZyB0ZXh0IHRvIEhQIFN1cHBvcnQgcHJlZml4IGNvbWluZyBmcm9tIGNhY2hlIHRhZw0KCQkJCQkJCSB2YXIgcGFnZVRpdGxlID0gaHBTdXBwb3J0VGV4dEZyb21DYWNoZVRhZyArICcgLSAnICsgdHJhaWxpbmdUZXh0Ow0KCQkJCQkJCSAvLyBJbmplY3QgZnVsbCB0ZXh0IGludG8gcGFnZSB0aXRsZSANCgkJCQkJCQkgaWYgKCQoIiNocFByb2R1Y3RDb250ZXh0UGFnZVRpdGxlIikubGVuZ3RoID4gMCkgew0KCQkJCQkJCQkgJCgiI2hwUHJvZHVjdENvbnRleHRQYWdlVGl0bGUiKS5odG1sKHBhZ2VUaXRsZSk7DQoJCQkJCQkJIH0NCgkJCQkJCQkgDQoJCQkJCQkJIC8vIGRvY3VtZW50LnRpdGxlID0gZHJpbGxkb3duVmFyaWFibGVTZXQubG9jYWxpemVkVmFsdWVzLnBhZ2VUaXRsZSArICcgJyArIHRyYWlsaW5nVGV4dCArICcgfCAnICsgZHJpbGxkb3duVmFyaWFibGVTZXQubG9jYWxpemVkVmFsdWVzLnRyYWlsaW5nUGFnZVRpdGxlIDsNCgkJCQkJCQkgLy8gZG9jdW1lbnQudGl0bGUgPSB0cmFpbGluZ1RleHQgKyAnIHwgJyArIGRyaWxsZG93blZhcmlhYmxlU2V0LmxvY2FsaXplZFZhbHVlcy50cmFpbGluZ1BhZ2VUaXRsZSA7DQoJCQkJCQkJIGRvY3VtZW50LnRpdGxlID0gJyB8ICcgKyBkcmlsbGRvd25WYXJpYWJsZVNldC5sb2NhbGl6ZWRWYWx1ZXMudHJhaWxpbmdQYWdlVGl0bGUgOyAgIC8vUmVtb3ZpbmcgdHJhaWxpbmcgdGV4dCBhcyBpdCB3aWxsIGJlIHBvcHVsYXRlZCBhZnRlciB0aGUgY2hlY2tGb3JEYXRhIHNlcnZpY2UgY2FsbA0KCQkJCQkJCSBpZihkb2N1bWVudC50aXRsZS5pbmRleE9mKCcmYW1wOycpPjApew0KCQkJCQkJCQlkb2N1bWVudC50aXRsZSA9IGRvY3VtZW50LnRpdGxlLnJlcGxhY2UoJyZhbXA7JywnJicpDQoJCQkJCQkJfQ0KCQkJCQkJIH07DQoJCQkJCQkgIGNoZWNrRm9yT3BlbkxldmVscyA9IGZ1bmN0aW9uKGRhdGEpIHsNCgkJCQkJCQkgb3BlbkZsYWcgPSB0cnVlOw0KCQkJCQkJCSBpZiAobGV2ZWxzVG9PcGVuID4gMCkgew0KCQkJCQkJCQkgaWYgKGxldmVsc09wZW5lZCA9PSAwKSB7DQoJCQkJCQkJCQkgLy8gaGlkZSBncmlkDQoJCQkJCQkJCQkgJCgnI3Byb2R1Y3RHcmlkJykuaGlkZSgpOw0KCQkJCQkJCQkJIC8vIHNldCBtYWluIGhlYWRlciB2YWwNCgkJCQkJCQkJCSB2YXIgbHZsMSA9ICQoJy5vcGVuTGV2ZWwnKVswXS52YWx1ZTsNCg0KCQkJCQkJCQkJICQoJyNwcm9kdWN0R3JpZCcpLmZpbmQoJ1tyYXctZGF0YS12YWx1ZT0nICsgbHZsMSArICddJykuZWFjaChmdW5jdGlvbigpIHsNCgkJCQkJCQkJCQkgaWYgKCQodGhpcykuY2hpbGRyZW4oJ2gzJykubGVuZ3RoID4gMCkgew0KCQkJCQkJCQkJCQkgJCgnI3NlbFByb2R1Y3RUeXBlIHNwYW4nKS5lbXB0eSgpLmFwcGVuZCgkKHRoaXMpLmNoaWxkcmVuKCdoMycpLmh0bWwoKSk7DQoJCQkJCQkJCQkJCSAkKCcjc2VsUHJvZHVjdFR5cGUgc3BhbicpLmF0dHIoJ3Nlby1sYWJlbCcsICQodGhpcykuYXR0cignc2VvLWxhYmVsJykpOw0KCQkJCQkJCQkJCQkgLy8gaWYoJCgnI2hwUHJvZHVjdENvbnRleHRQYWdlVGl0bGUnKS5sZW5ndGg+MCkNCgkJCQkJCQkJCQkJIC8vICQoJyNocFByb2R1Y3RDb250ZXh0UGFnZVRpdGxlJykuZW1wdHkoKS5hcHBlbmQoJCh0aGlzKS5jaGlsZHJlbignaDMnKS5odG1sKCkpOw0KCQkJCQkJCQkJCQkgLy9zZXQgdGhlIHBhZ2UgdGl0bGUNCgkJCQkJCQkJCQkJIC8vY2hhbmdlUGFnZVRpdGxlKGRyaWxsZG93blZhcmlhYmxlU2V0LmxvY2FsaXplZFZhbHVlcy5ocFN1cHBvcnQsICQodGhpcykuY2hpbGRyZW4oJ2gzJykuaHRtbCgpKTsNCgkJCQkJCQkJCQkgfSBlbHNlIHsNCg0KCQkJCQkJCQkJCQkgJCgnI3NlbFByb2R1Y3RUeXBlIHNwYW4nKS5lbXB0eSgpLmFwcGVuZCgkKHRoaXMpLmh0bWwoKSk7DQoJCQkJCQkJCQkJCSAkKCcjc2VsUHJvZHVjdFR5cGUgc3BhbicpLmF0dHIoJ3Nlby1sYWJlbCcsICQodGhpcykuYXR0cignc2VvLWxhYmVsJykpOw0KCQkJCQkJCQkJCQkgLy8gaWYoJCgnI2hwUHJvZHVjdENvbnRleHRQYWdlVGl0bGUnKS5sZW5ndGg+MCkNCgkJCQkJCQkJCQkJIC8vICQoJyNocFByb2R1Y3RDb250ZXh0UGFnZVRpdGxlJykuZW1wdHkoKS5hcHBlbmQoJCh0aGlzKS5odG1sKCkpOw0KCQkJCQkJCQkJCQkgLy9zZXQgdGhlIHBhZ2UgdGl0bGUNCgkJCQkJCQkJCQkJIC8vY2hhbmdlUGFnZVRpdGxlKGRyaWxsZG93blZhcmlhYmxlU2V0LmxvY2FsaXplZFZhbHVlcy5ocFN1cHBvcnQsICQodGhpcykuaHRtbCgpKTsNCgkJCQkJCQkJCQkgfQ0KCQkJCQkJCQkJIH0pOw0KCQkJCQkJCQkJICQoJyNzZWxQcm9kdWN0VHlwZScpLnNob3coKTsNCgkJCQkJCQkJCSAkKCcjZHJpbGxkb3duTWFpbkNvbnRhaW5lcicpLnJlbW92ZUNsYXNzKCdoaWRlJyk7DQoNCgkJCQkJCQkJCSAvLyBPcGVuIEZpcnN0IGxldmVsDQoJCQkJCQkJCQkgaWYgKG51bGwgIT0gZGF0YVswXSkgew0KCQkJCQkJCQkJCSBpZiAoZGF0YVswXS5maWVsZExpc3RbMF0uY2xhenpUeXBlID09IHN3aXRjaEx2bCkgew0KCQkJCQkJCQkJCQkgY3JlYXRlUHJvZHVjdEdyaWRWaWV3KGRhdGFbMF0sIGxldmVsc09wZW5lZCk7DQoJCQkJCQkJCQkJCSBsZXZlbHNPcGVuZWQrKzsNCgkJCQkJCQkJCQkJIGNoZWNrRm9yT3BlbkxldmVscyhkYXRhKTsNCg0KCQkJCQkJCQkJCSB9IGVsc2Ugew0KCQkJCQkJCQkJCQkgdmFyIGNoZWNrTHZsT3BlbmVkID0gbGV2ZWxzT3BlbmVkICsgMTsNCgkJCQkJCQkJCQkJIGlmIChsZXZlbHNUb09wZW4gPiBjaGVja0x2bE9wZW5lZCkgew0KCQkJCQkJCQkJCQkJIG9wZW5GbGFnID0gZmFsc2U7IC8vIGxvYWQgYSBjbG9zZWQNCgkJCQkJCQkJCQkJCSAvLyBsZXZlbCBhcw0KCQkJCQkJCQkJCQkJIC8vIHRoZXJlIGFyZQ0KCQkJCQkJCQkJCQkJIC8vIG1vcmUgbGV2ZWxzDQoJCQkJCQkJCQkJCQkgLy8gdG8gb3Blbg0KCQkJCQkJCQkJCQkgfQ0KCQkJCQkJCQkJCQkgY3JlYXRlUHJvZHVjdEZhbWlseShkYXRhWzBdLCAwLCBvcGVuRmxhZyk7DQoJCQkJCQkJCQkJCSBsZXZlbHNPcGVuZWQrKzsNCgkJCQkJCQkJCQkJIC8vIHNldCBhIHNlbGVjdGVkIHN0YXRlIGZvciBhDQoJCQkJCQkJCQkJCSAvLyBjbG9zZWQgbGV2ZWwgb3IgaXRzIGp1c3Qgd2VpcmQgdG8NCgkJCQkJCQkJCQkJIC8vIGhhdmUgaXQgbG9hZCBsaWtlIHRoYXQNCgkJCQkJCQkJCQkJIGlmICghb3BlbkZsYWcpIHsNCgkJCQkJCQkJCQkJCSBpZiAobGV2ZWxzT3BlbmVkIDwgbGV2ZWxzVG9PcGVuKSB7DQoJCQkJCQkJCQkJCQkJIHZhciBzZWxlY3RlZFZhbCA9ICQoJy5vcGVuTGV2ZWwnKVtsZXZlbHNPcGVuZWRdLnZhbHVlOw0KCQkJCQkJCQkJCQkJCSBzZXRMZXZlbFN0YXRlKGxldmVsc09wZW5lZCwgc2VsZWN0ZWRWYWwpOw0KCQkJCQkJCQkJCQkJCSAkKCIucHJvZ3Jlc3NpdmUtZGlzY2xvc3VyZS1leHBhbmQtY29sbGFwc2UtYnV0dG9uOmVxKCIgKyAwICsgIikiKS5yZW1vdmVDbGFzcygib3BlbiIpLmFkZENsYXNzKCJjbG9zZWQiKTsNCgkJCQkJCQkJCQkJCSB9DQoJCQkJCQkJCQkJCSB9DQoJCQkJCQkJCQkJCSBjaGVja0Zvck9wZW5MZXZlbHMoZGF0YSk7DQoJCQkJCQkJCQkJIH0NCgkJCQkJCQkJCSB9DQoJCQkJCQkJCX0gIGVsc2Ugew0KCQkJCQkJCQkJIGlmIChsZXZlbHNPcGVuZWQgPj0gbGV2ZWxzVG9PcGVuKSB7DQoJCQkJCQkJCQkJIC8vIEFsbCBsZXZlbHMgb3BlbmVkDQoJCQkJCQkJCQkJIGlmICgkKCcjYmlnTG9hZGluZ0RpdicpLmxlbmd0aCA+IDApIHsNCgkJCQkJCQkJCQkJICQoJyNiaWdMb2FkaW5nRGl2JykucmVtb3ZlKCk7DQoJCQkJCQkJCQkJIH0NCgkJCQkJCQkJCQkgaWYgKCQoJy5vcGVuTGV2ZWwnKS5sZW5ndGggPiAwKSB7DQoJCQkJCQkJCQkJCS8vICQoJy5vcGVuTGV2ZWwnKS5yZW1vdmUoKTsNCgkJCQkJCQkJCQkgfQ0KCQkJCQkJCQkJIH0gZWxzZXsNCgkJCQkJCQkJCSAvLyBjb2xsYXBzZSBwcmV2aW91cyBsZXZlbHMNCgkJCQkJCQkJCSAvLyBPcGVuIFN1YnNlcXVlbnQgTGV2ZWxzDQoJCQkJCQkJCQkgaWYgKGRhdGFbbGV2ZWxzT3BlbmVkXS5maWVsZExpc3RbMF0uY2xhenpUeXBlID09IHN3aXRjaEx2bCkgew0KCQkJCQkJCQkJCSBpZiAobnVsbCAhPSBkYXRhW2xldmVsc09wZW5lZF0pIHsNCgkJCQkJCQkJCQkJIGNyZWF0ZVByb2R1Y3RHcmlkVmlldyhkYXRhW2xldmVsc09wZW5lZF0sIGxldmVsc09wZW5lZCk7DQoJCQkJCQkJCQkJCSBsZXZlbHNPcGVuZWQrKzsNCgkJCQkJCQkJCQkJIGNoZWNrRm9yT3BlbkxldmVscyhkYXRhKTsNCgkJCQkJCQkJCQkgfQ0KCQkJCQkJCQkJIH0gZWxzZSB7DQoJCQkJCQkJCQkJIGlmIChudWxsICE9IGRhdGFbbGV2ZWxzT3BlbmVkXSkgew0KCQkJCQkJCQkJCQkgdmFyIGNoZWNrTHZsT3BlbmVkID0gbGV2ZWxzT3BlbmVkICsgMTsNCgkJCQkJCQkJCQkJIGlmIChsZXZlbHNUb09wZW4gPiBjaGVja0x2bE9wZW5lZCkgew0KCQkJCQkJCQkJCQkJIG9wZW5GbGFnID0gZmFsc2U7IC8vIGxvYWQgYQ0KCQkJCQkJCQkJCQkJIC8vIGNsb3NlZA0KCQkJCQkJCQkJCQkJIC8vIGxldmVsIGFzDQoJCQkJCQkJCQkJCQkgLy8gdGhlcmUgYXJlDQoJCQkJCQkJCQkJCQkgLy8gbW9yZQ0KCQkJCQkJCQkJCQkJIC8vIGxldmVscyB0bw0KCQkJCQkJCQkJCQkJIC8vIG9wZW4NCgkJCQkJCQkJCQkJIH0NCgkJCQkJCQkJCQkJIGNyZWF0ZVByb2R1Y3RMaXN0VmlldyhkYXRhW2xldmVsc09wZW5lZF0sIGxldmVsc09wZW5lZCwgb3BlbkZsYWcpOw0KCQkJCQkJCQkJCQkgbGV2ZWxzT3BlbmVkKys7DQoJCQkJCQkJCQkJCSBpZiAoIW9wZW5GbGFnKSB7DQoJCQkJCQkJCQkJCQkgaWYgKGxldmVsc09wZW5lZCA8IGxldmVsc1RvT3Blbikgew0KCQkJCQkJCQkJCQkJCSB2YXIgc2VsZWN0ZWRWYWwgPSAkKCcub3BlbkxldmVsJylbbGV2ZWxzT3BlbmVkXS52YWx1ZTsNCgkJCQkJCQkJCQkJCQkgc2V0TGV2ZWxTdGF0ZShsZXZlbHNPcGVuZWQsIHNlbGVjdGVkVmFsKTsNCgkJCQkJCQkJCQkJCQkgJCgiLnByb2dyZXNzaXZlLWRpc2Nsb3N1cmUtZXhwYW5kLWNvbGxhcHNlLWJ1dHRvbjplcSgiICsgKGxldmVsc09wZW5lZCAtIDEpICsgIikiKS5yZW1vdmVDbGFzcygib3BlbiIpLmFkZENsYXNzKCJjbG9zZWQiKTsNCgkJCQkJCQkJCQkJCSB9DQoJCQkJCQkJCQkJCSB9DQoJCQkJCQkJCQkJCSBjaGVja0Zvck9wZW5MZXZlbHMoZGF0YSk7DQoJCQkJCQkJCQkJIH0NCgkJCQkJCQkJCSB9DQoJCQkJCQkJCSB9DQoJCQkJCQkJIH0NCgkJCQkJCSB9IA0KCQkJCQkgfTsNCg0KCQkJCSB9DQoJCQkJIH07DQoJCQkJIAp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsJCSAgLyogaWYgeW91IGFyZSBzdHVjayB0cnlpbmcgdG8gZmlndXJlIG91dCB3aGF0IGZ1bmN0aW9uIGNhbGxzIHdoYXQsIFBsZWFzZSByZWZlciBmbG93Y2hhcnQsIGl0IHNob3VsZCBtYWtlIHlvdXIgbGlmZSBzaW1wbGVyKGRldiBpbiBwcm9ncmVzcykgKi8NCkluaXRpYWxpemVCdWlsZGVyID0gZnVuY3Rpb24oQnVpbGRlclZhcmlhYmxlU2V0KSB7DQoJCQkNCgkJCSB0aGlzLmZhbGxiYWNrSW1hZ2UgPSBCdWlsZGVyVmFyaWFibGVTZXQuZmFsbGJhY2tJbWFnZTsNCgkJCSB0aGlzLmRlZmF1bHRJbWFnZSA9IEJ1aWxkZXJWYXJpYWJsZVNldC5kZWZhdWx0SW1hZ2U7DQoJCQkgdGhpcy5idWlsZGVyVVJMID0gQnVpbGRlclZhcmlhYmxlU2V0LmJ1aWxkZXJVUkw7DQoJCQkgdGhpcy5yZXZlcnNlQnVpbGRlclVSTCA9IEJ1aWxkZXJWYXJpYWJsZVNldC5yZXZlcnNlQnVpbGRlclVSTDsNCgkJCSB0aGlzLmRlZmF1bHRUZXh0ID0gQnVpbGRlclZhcmlhYmxlU2V0LmRlZmF1bHRUZXh0Ow0KCQkJIHRoaXMubG9hZGluZ0dpZiA9IEJ1aWxkZXJWYXJpYWJsZVNldC5sb2FkaW5nR2lmOw0KCQkJIHRoaXMucmV2ZXJzZUJ1aWxkZXJDYWxsID0gZmFsc2U7DQoJCQkgdGhpcy5udW1PZkRyb3Bkb3ducyA9IEJ1aWxkZXJWYXJpYWJsZVNldC5udW1PZkRyb3Bkb3duczsNCgkJCSB0aGlzLnN0b3BMdmwgPSBCdWlsZGVyVmFyaWFibGVTZXQuc3RvcEx2bDsgLy8icG1fc2VyaWVzX3ZhbHVlIjsNCgkJCSB0aGlzLmRpcmVjdGlvbiA9IEJ1aWxkZXJWYXJpYWJsZVNldC5kaXJlY3Rpb247IC8vZndkIG9yIHJldg0KCQkJIHRoaXMuaWRzID0gQnVpbGRlclZhcmlhYmxlU2V0LmlkczsgLy9pZHMgZm9yIGNvbnRhaW5lcixpbWFnZWJveCxjb250aW51ZSBidXR0b24NCgkJCSB0aGlzLnBhdGggPSBCdWlsZGVyVmFyaWFibGVTZXQucGF0aDsgLy9wYXRoIGNhbiBiZSBwcHMgb3IgY3BoIGJhc2VkIG9uIHdoaWNoIHRtcyBwYXRoIHdlIG5lZWQgdG8gYWNjZXNzDQoJCQkgdGhpcy5leHRyYVBhcmFtcyA9IEJ1aWxkZXJWYXJpYWJsZVNldC5leHRyYVBhcmFtczsvL0pTT04gd2l0aCBhZGRlZCBwYXJhbXMNCgkJCSB0aGlzLnN1Y2Nlc3NIYW5kbGVyID0gQnVpbGRlclZhcmlhYmxlU2V0LnN1Y2Nlc3NIYW5kbGVyOy8vIGNhbGwgdGhpcyBmdW5jdGlvbiBvbiBhamF4IHN1Y2Nlc3MgQUZURVIgY3JlYXRpbmcgdGhlIGRyb3Bkb3duDQoJCQkgdGhpcy5zdWNjZXNzSGFuZGxlclBhcmFtcyA9IEJ1aWxkZXJWYXJpYWJsZVNldC5zdWNjZXNzSGFuZGxlclBhcmFtczsvLyBjYWxsIHRoaXMgZnVuY3Rpb24gb24gYWpheCBzdWNjZXNzIEFGVEVSIGNyZWF0aW5nIHRoZSBkcm9wZG93bg0KCQkJIHRoaXMuZ2V0QnVpbGRlclRNU1Jlc3BvbnNlID0gZmFsc2U7DQoJCQkgDQoJCQkgdGhpcy5zbW9KU09OID0gQnVpbGRlclZhcmlhYmxlU2V0LnNtb0pTT047DQoJCQkgDQoJCQkgdGhpcy5idWlsZGVyTWFwID0ge307DQoJCQkgdmFyIGlkc1NldCA9IHRoaXM7DQoNCgkJCQl0aGlzLmluaXQgPSBmdW5jdGlvbigpIHsNCgkJCQkNCgkJCQkJaWYgKCQoJyMnICsgaWRzU2V0Lmlkcy5jb250YWluZXJJZCkgJiYgaWRzU2V0LmRpcmVjdGlvbiA9PSAiZndkIikgew0KDQoJCQkJCQkgJCgnIycgKyBpZHNTZXQuaWRzLmNvbnRhaW5lcklkICsgJyA+IGRpdi5ocFN0eWxlRHJvcGRvd246Z3QoMCknKS5yZW1vdmUoKTsNCgkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuY29udGFpbmVySWQgKyAnID4gc2VsZWN0LmhwU3R5bGVEcm9wZG93bjpndCgwKScpLnJlbW92ZSgpOw0KCQkJCQkJIGlkc1NldC5hdHRhY2hEcm9wZG93bkV2ZW50SGFuZGxlcnMoMCk7DQoNCgkJCQkJIH0gZWxzZSBpZiAoaWRzU2V0LmRpcmVjdGlvbiA9PSAicmV2Iikgew0KDQoJCQkJCSB9CQkJDQoJCQkJfQ0KCQkJCSAvKi0tLS0tLS0tLS0tUkVWRVJTRSBCVUlMREVSIC0tLS0tLS0tKi8NCg0KCQkJCXRoaXMucHJlcG9wdWxhdGVCdWlsZGVyID0gZnVuY3Rpb24oY2F0ZWdvcnlJZCkgew0KDQoJCQkJCSBjYyA9IGdldENDTEMoJ2NjJyk7DQoJCQkJCSBsYyA9IGdldENDTEMoJ2xjJyk7DQoJCQkJCSBpZiAoY2MgPT0gImVuIikgew0KCQkJCQkJIGNjID0gbnVsbDsNCgkJCQkJCSBsYyA9IG51bGw7DQoJCQkJCSB9DQoJCQkJCSAvL3NldCBkZWZhdWx0IGltYWdlDQoJCQkJCSAgJCgnIycgKyBpZHNTZXQuaWRzLmltYWdlQm94ICsgJyBpbWcnKS5hdHRyKCdzcmMnLCBpZHNTZXQuZGVmYXVsdEltYWdlKTsNCgkJCQkJICAkKCcjJyArIGlkc1NldC5pZHMuaW1hZ2VCb3ggKyAnIGltZycpLmF0dHIoJ2FsdCcsICIiKTsNCg0KCQkJCQkgaWYgKGlkc1NldC5yZXZlcnNlQnVpbGRlckNhbGwpDQoJCQkJCQkgaWRzU2V0LnJldmVyc2VCdWlsZGVyQ2FsbC5hYm9ydCgpOw0KCQkJCQkgdmFyIGJ1aWxkZXJKU09OOw0KCQkJCQkgaWRzU2V0LnJldmVyc2VCdWlsZGVyQ2FsbCA9ICQucG9zdCgNCgkJCQkJCSBpZHNTZXQucmV2ZXJzZUJ1aWxkZXJVUkwsIHsNCgkJCQkJCQkgJ2NhdGVnb3J5SWQnOiBjYXRlZ29yeUlkLA0KCQkJCQkJCSAnY2MnOiBjYywNCgkJCQkJCQkgJ2xjJzogbGMsDQoJCQkJCQkJICdwYXRoJzppZHNTZXQucGF0aCwNCgkJCQkJCQkgJ2V4dHJhUGFyYW1zJzppZHNTZXQuZXh0cmFQYXJhbXMNCgkJCQkJCSB9LA0KCQkJCQkJIGZ1bmN0aW9uKGRhdGEpIHsNCgkJCQkJCQkgYnVpbGRlckpTT04gPSBkYXRhLnRtc1Jlc3BvbnNlLmxpc3RQcm9kdWN0Q2F0ZWdvcnlQcmV2U2VsZWN0ZWRSZXNwb25zZTsNCgkJCQkJCQkgaWRzU2V0LmNyZWF0ZVJldmVyc2VCdWlsZGVyKGJ1aWxkZXJKU09OKTsNCgkJCQkJCQkgaWRzU2V0LmhhbmRsZVN1Y2Nlc3MoKTsNCgkJCQkJCSB9KTsNCgkJCQkgfTsNCgkJCQkgDQoJCQkJdGhpcy5jcmVhdGVSZXZlcnNlQnVpbGRlciA9IGZ1bmN0aW9uKGRhdGEpIHsNCgkJCQkJIGNvbnNvbGUubG9nKGRhdGEpOw0KCQkJCQkgaWYgKGRhdGEgIT0gIiIgJiYgZGF0YSAhPSAibnVsbCIgJiYgZGF0YSAhPSBudWxsKSB7DQoJCQkJCQkgLy9jb25zb2xlLmxvZyhkYXRhLmxpc3RQcm9kdWN0Q2F0ZWdvcnlQcmV2U2VsZWN0ZWRSZXNwb25zZS5sZW5ndGgpOw0KCQkJCQkJIGlmICgkKCcjbG9hZGluZ0RpdicpKQ0KCQkJCQkJCSAkKCcjbG9hZGluZ0RpdicpLnJlbW92ZSgpOw0KCQkJCQkJdmFyIG51bU9mRHJvcGRvd25zID0gMjsNCgkJCQkJCS8vcHBzIHNob3cgMSBsdmwgZWxzZSAzDQoJCQkJCQlpZihpZHNTZXQucGF0aD09InBwcyIpew0KCQkJCQkJCQkgbnVtT2ZEcm9wZG93bnMgPSAxOw0KCQkJCQkJfQ0KDQoJCQkJCQkgZm9yICh2YXIgaSA9IDA7IGkgPD0gbnVtT2ZEcm9wZG93bnM7IGkrKykgew0KCQkJCQkJCSBpZiAoaSA8IG51bU9mRHJvcGRvd25zKSB7DQoJCQkJCQkJCSBpZHNTZXQuY3JlYXRlRHJvcGRvd24oZGF0YVtpXS5wcm9kdWN0Q2F0ZWdvcnlUbXNIaWVyYXJjaHlSZXNwb25zZVdyYXBwZXIsIGkgLSAxKTsNCgkJCQkJCQkJIGlkc1NldC5zZXRTZWxlY3RlZFZhbChkYXRhW2ldLnNlbGVjdGVkSWQsIGkgLSAxKTsNCgkJCQkJCQkgfQ0KCQkJCQkJCSBpZiAoaSA9PSBudW1PZkRyb3Bkb3ducykgew0KCQkJCQkJCQkgaWRzU2V0LmNyZWF0ZURyb3Bkb3duKGRhdGFbaV0ucHJvZHVjdENhdGVnb3J5VG1zSGllcmFyY2h5UmVzcG9uc2VXcmFwcGVyLCBpIC0gMSk7DQoNCgkJCQkJCQkgfQ0KCQkJCQkJIH0NCgkJCQkJCX0JCSANCgkJCQkJIH07DQoNCgkJCQl0aGlzLnNldFNlbGVjdGVkVmFsID0gZnVuY3Rpb24oZGF0YSwgaW5kZXgpIHsNCgkJCQkJCSBjb25zb2xlLmxvZygnLS0tLSBzZWxlY3RlZElkLS0tLT4nICsgZGF0YSk7DQoNCgkJCQkJCSB2YXIgZHJvcGRvd25JRCA9IGlkc1NldC5pZHMuY29udGFpbmVySWQ7DQoJCQkJCQkgdmFyIHRlbXBJbmRleCA9IGluZGV4KzE7DQoJCQkJCQkgDQoJCQkJCQkgaWYoIHRlbXBJbmRleCA+IDAgKXsNCgkJCQkJCSAJZHJvcGRvd25JRCA9IGRyb3Bkb3duSUQrIjAiK3RlbXBJbmRleDsNCgkJCQkJCSB9DQoJCQkJCQkgZWxzZXsNCgkJCQkJCSAJZHJvcGRvd25JRCA9IGRyb3Bkb3duSUQrdGVtcEluZGV4Ow0KCQkJCQkJIH0NCg0KDQoJCQkJCQkgcG9wdWxhdGVEcm9wZG93bkhlYWRlcihkcm9wZG93bklELCBkYXRhKTsNCg0KCQkJCQkJICQoJyMnICsgaWRzU2V0Lmlkcy5jb250YWluZXJJZCArICcgIGRpdi5ocFN0eWxlRHJvcGRvd246ZXEoJyArIChpbmRleCArIDEpICsgJykgdWwgLnZhbHVlJykuZWFjaChmdW5jdGlvbigpIHsNCgkJCQkJCQkgaWYgKCQodGhpcykuaHRtbCgpID09IGRhdGEpIHsNCg0KCQkJCQkJCQkgLyokKHRoaXMpLnBhcmVudHMoJy5ocFN0eWxlRHJvcGRvd24nKS5maW5kKCcuZHJvcGRvd25IZWFkZXJWYWx1ZScpLmh0bWwoJCh0aGlzKS5wYXJlbnRzKCdsaSBhJykuaHRtbCgpKTsqLw0KDQoJCQkJCQkJCSB2YXIgaW1hZ2VVcmwgPSAkKHRoaXMpLnBhcmVudHMoJy5ocFN0eWxlRHJvcGRvd24nKS5maW5kKCcuZHJvcGRvd25IZWFkZXJWYWx1ZSBzcGFuLmltZ3VybCcpLmh0bWwoKTsNCgkJCQkJCQkJIGlmIChudWxsICE9IGltYWdlVXJsICYmIGltYWdlVXJsICE9ICJudWxsIikgew0KDQoJCQkJCQkJCQkgJCgnIycgKyBpZHNTZXQuaWRzLmltYWdlQm94ICsgJyBpbWcnKS5hdHRyKCdzcmMnLCBpbWFnZVVybCk7DQoJCQkJCQkJCQkkKCcjJyArIGlkc1NldC5pZHMuaW1hZ2VCb3ggKyAnIGltZycpLmF0dHIoJ2FsdCcsICQodGhpcykucGFyZW50KCdhJykuaHRtbCgpLnNwbGl0KCc8JylbMF0pOw0KCQkJCQkJCQkgfSBlbHNlIHsNCgkJCQkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuaW1hZ2VCb3ggKyAnIGltZycpLmF0dHIoJ3NyYycsIGlkc1NldC5mYWxsYmFja0ltYWdlKTsNCgkJCQkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuaW1hZ2VCb3ggKyAnIGltZycpLmF0dHIoJ2FsdCcsICIiKTsNCgkJCQkJCQkJCSBjb25zb2xlLmxvZygnSW1hZ2UgZG9lcyBub3QgZXhpc3QgZm9yIHRoaXMgc2VsZWN0aW9uJyk7DQoJCQkJCQkJCSB9DQoJCQkJCQkJIH0NCgkJCQkJCSB9KTsNCgkJCQkJIH07DQoNCgkJCQkgLyotLS0tLS0tLS0tLVJFVkVSU0UgQlVJTERFUiAtLS0tLS0tLSovDQoJCQkJCSANCgkJCQl0aGlzLmF0dGFjaERyb3Bkb3duRXZlbnRIYW5kbGVycyA9IGZ1bmN0aW9uKGluZGV4KSB7DQoJCQkJCSQoJyMnICsgaWRzU2V0Lmlkcy5jb250YWluZXJJZCArICcgPiBkaXYuaHBTdHlsZURyb3Bkb3duOmVxKCcgKyBpbmRleCArICcpJykuZmluZCgnbGknKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkgew0KCQkJCQkJCSAvKg0KCQkJCQkJCSAgKiBzZWxlY3RlZFZhbHVlID0gJCgnIycrIGlkc1NldC5pZHMuY29udGFpbmVySWQgKyAnID4NCgkJCQkJCQkgICogZGl2LmhwU3R5bGVEcm9wZG93bjplcSgnICsgaW5kZXggKyAnKQ0KCQkJCQkJCSAgKiBhLmN1c3RvbURyb3BEb3duSGVhZGVyIHNwYW4udmFsdWUnKS5odG1sKCk7DQoJCQkJCQkJICAqIGN1cnJlbnRWYWx1ZSA9DQoJCQkJCQkJICAqICQodGhpcykuY2hpbGRyZW4oJ2EnKS5jaGlsZHJlbignc3BhbicpLmh0bWwoKQ0KCQkJCQkJCSAgKiBpZihjdXJyZW50VmFsdWUgIT0gY3VycmVudFZhbHVlKSB7DQoJCQkJCQkJICAqLw0KCQkJCQkJCSBpZiAoaWRzU2V0LmdldEJ1aWxkZXJUTVNSZXNwb25zZSkNCgkJCQkJCQkJIGlkc1NldC5nZXRCdWlsZGVyVE1TUmVzcG9uc2UuYWJvcnQoKTsNCgkJCQkJCQkgaWYgKCQoJyNsb2FkaW5nRGl2JykpDQoJCQkJCQkJCSAkKCcjbG9hZGluZ0RpdicpLnJlbW92ZSgpOw0KDQoJCQkJCQkJICQoJyMnICsgaWRzU2V0Lmlkcy5jb250YWluZXJJZCArICcgPiBkaXYuaHBTdHlsZURyb3Bkb3duOmd0KCcgKyBpbmRleCArICcpJykucmVtb3ZlKCk7DQoJCQkJCQkJICQoJyMnICsgaWRzU2V0Lmlkcy5jb250YWluZXJJZCArICcgPiBzZWxlY3QuaHBTdHlsZURyb3Bkb3duOmd0KCcgKyBpbmRleCArICcpJykucmVtb3ZlKCk7DQoJCQkJCQkJICQoJyMnICsgaWRzU2V0Lmlkcy5idG5Db250aW51ZSkuYXR0cignZGlzYWJsZWQnLCB0cnVlKTsNCg0KCQkJCQkJCSBpZiAoJCh0aGlzKS5jaGlsZHJlbignYScpLmNoaWxkcmVuKCdzcGFuLnZhbHVlJykuaHRtbCgpID09ICIiKSB7DQoJCQkJCQkJCSAvLyBmaXJzdCBvcHRpb24gY2xpY2tlZA0KCQkJCQkJCQkgaWYgKGluZGV4ID09IDApIHsgLy8gZmlyc3QgZHJvcGRvd24NCgkJCQkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuaW1hZ2VCb3ggKyAnIGltZycpLmF0dHIoJ3NyYycsIGlkc1NldC5kZWZhdWx0SW1hZ2UpOw0KCQkJCQkJCQkJICQoJyMnICsgaWRzU2V0Lmlkcy5pbWFnZUJveCArICcgaW1nJykuYXR0cignYWx0JywgIkRlZmF1bHQgaW1hZ2UiKTsNCg0KCQkJCQkJCQkJIGlmICgkKCcjbG9hZGluZ0RpdicpKQ0KCQkJCQkJCQkJCSAkKCcjbG9hZGluZ0RpdicpLnJlbW92ZSgpOw0KCQkJCQkJCQkgfSBlbHNlIHsNCg0KCQkJCQkJCQkJIHZhciB0ZW1wID0gJzAnICsgKGluZGV4LTEpOw0KCQkJCQkJCQkJIGlmICh0ZW1wIDw9IDApIHsNCgkJCQkJCQkJCQkgdGVtcCA9ICIwIjsNCgkJCQkJCQkJCSB9DQoNCgkJCQkJCQkJCSB2YXIgcHJldkltYWdlVXJsID0gJCgnIycgKyBpZHNTZXQuaWRzLmNvbnRhaW5lcklkICsgKHRlbXApICsgJ19kZF9oZWFkZXJWYWx1ZSAuaW1ndXJsJykuaHRtbCgpDQoJCQkJCQkJCQkgaWYocHJldkltYWdlVXJsPT11bmRlZmluZWQgfHwgcHJldkltYWdlVXJsPT1udWxsIHx8IHByZXZJbWFnZVVybD09IiIgfHwgcHJldkltYWdlVXJsPT0ibnVsbCIgKXsNCgkJCQkJCQkJCSAJcHJldkltYWdlVXJsID0gaWRzU2V0LmZhbGxiYWNrSW1hZ2U7DQoJCQkJCQkJCQkgfQ0KDQoJCQkJCQkJCQkgJCgnIycgKyBpZHNTZXQuaWRzLmltYWdlQm94ICsgJyBpbWcnKS5hdHRyKCdzcmMnLCBwcmV2SW1hZ2VVcmwgKTsNCgkJCQkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuaW1hZ2VCb3ggKyAnIGltZycpLmF0dHIoJ2FsdCcsICQoJyMnICsgaWRzU2V0Lmlkcy5pbWFnZUJveCArICcgaW1nJykuYXR0cignYWx0JywgJCgnIycgKyBpZHNTZXQuaWRzLmNvbnRhaW5lcklkICsgKHRlbXApICsgJ19kZF9oZWFkZXJWYWx1ZScpLmh0bWwoKS5zcGxpdCgnPCcpWzBdKSk7DQoNCgkJCQkJCQkJCSBpZiAoJCgnI2xvYWRpbmdEaXYnKSkNCgkJCQkJCQkJCQkgJCgnI2xvYWRpbmdEaXYnKS5yZW1vdmUoKTsNCgkJCQkJCQkJIH0NCgkJCQkJCQkJIGlkc1NldC5oYW5kbGVTdWNjZXNzKCk7DQoNCgkJCQkJCQkgfSBlbHNlIHsNCgkJCQkJCQkJIHZhciBpbWFnZVVybCA9ICQodGhpcykuY2hpbGRyZW4oJ2EnKS5jaGlsZHJlbignc3Bhbi5pbWd1cmwnKS5odG1sKCk7DQoJCQkJCQkJCSB2YXIgc2VvTGFiZWwgPSAkKHRoaXMpLmNoaWxkcmVuKCdhJykuY2hpbGRyZW4oJ3NwYW4uc2VvTGFiZWwnKS5odG1sKCk7DQoJCQkJCQkJCSB2YXIgcmVkaXJlY3RVcmwgPSAkKHRoaXMpLmNoaWxkcmVuKCdhJykuY2hpbGRyZW4oJ3NwYW4ucmVkaXJlY3RVcmwnKS5odG1sKCk7DQoJCQkJCQkJCSB2YXIgY2xhenpUeXBlID0gJCh0aGlzKS5jaGlsZHJlbignYScpLmNoaWxkcmVuKCdzcGFuLmNsYXp6VHlwZScpLmh0bWwoKTsNCgkJCQkJCQkJIGlmIChudWxsICE9IGltYWdlVXJsICYmIGltYWdlVXJsICE9ICJudWxsIikgew0KDQoJCQkJCQkJCQkgJCgnIycgKyBpZHNTZXQuaWRzLmltYWdlQm94ICsgJyBpbWcnKS5hdHRyKCdzcmMnLCBpbWFnZVVybCk7DQoJCQkJCQkJCQkgJCgnIycgKyBpZHNTZXQuaWRzLmltYWdlQm94ICsgJyBpbWcnKS5hdHRyKCdhbHQnLCAkKHRoaXMpLmNoaWxkcmVuKCdhJykuaHRtbCgpLnNwbGl0KCc8JylbMF0pOw0KCQkJCQkJCQkgfSBlbHNlIHsNCgkJCQkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuaW1hZ2VCb3ggKyAnIGltZycpLmF0dHIoJ3NyYycsIGlkc1NldC5mYWxsYmFja0ltYWdlKTsNCgkJCQkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuaW1hZ2VCb3ggKyAnIGltZycpLmF0dHIoJ2FsdCcsICIiKTsNCgkJCQkJCQkJCSBjb25zb2xlLmxvZygnSW1hZ2UgZG9lcyBub3QgZXhpc3QgZm9yIHRoaXMgc2VsZWN0aW9uJyk7DQoJCQkJCQkJCSB9DQoJCQkJCQkJCSBpZiAoaW5kZXggPCBpZHNTZXQubnVtT2ZEcm9wZG93bnMpIHsNCgkJCQkJCQkJCSBpZiAoKG51bGwgIT0gcmVkaXJlY3RVcmwgJiYgcmVkaXJlY3RVcmwgIT0gIm51bGwiICYmIHJlZGlyZWN0VXJsICE9ICIiKSAmJiBjbGF6elR5cGUgPT0gImhwc2NfanVtcF9uYXZpZ2F0aW9uIikgew0KCQkJCQkJCQkJCSAvLyBub3cgaWYgdGhlIHVzZXIgY2xpY2tzIGNvbnRpbnVlIGhlIHNob3VsZCBnbyB0byB0aGUgSFBTQyBqdW1wIHVybA0KCQkJCQkJCQkJCSAvL2luZGV4PTAgbWVhbnMgdGhlIGZpcnN0IGRyb3Bkb3duLCBoZXJlIHdlIGhhdmUgcmVkaXJlY3QgVVJMcyBmb3IgYWxsIHRoZSBvcHRpb25zIHRodXMgdGhlcmUgaXMgYSBjaGVjayBmb3IgY2xhc3N0eXBlLCBzdWJzZXF1ZW50IGxldmVscyB3aWxsIGhhdmUgdGhlIHJlZGlyZWN0IFVSTCBvbmx5IGZvciBocHNjIGp1bXAgbmF2aWdhdGlvbg0KCQkJCQkJCQkJCSBIUFNDcmVkaXJlY3QgPSB0cnVlOw0KCQkJCQkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuYnRuQ29udGludWUpLmF0dHIoJ2Rpc2FibGVkJywgZmFsc2UpOw0KCQkJCQkJCQkJCSAkKCcjbG9hZGluZ0RpdicpLnJlbW92ZSgpOw0KCQkJCQkJCQkJCSBpZHNTZXQuaGFuZGxlU3VjY2VzcygpOw0KCQkJCQkJCQkJIH0gZWxzZSBpZiAoKG51bGwgIT0gcmVkaXJlY3RVcmwgJiYgcmVkaXJlY3RVcmwgIT0gIm51bGwiICYmIHJlZGlyZWN0VXJsICE9ICIiKSAmJiBpbmRleCA+IDAgJiYgY2xhenpUeXBlID09IGlkc1NldC5zdG9wTHZsKSB7DQoJCQkJCQkJCQkJICQoJyMnICsgaWRzU2V0Lmlkcy5idG5Db250aW51ZSkuYXR0cignZGlzYWJsZWQnLCBmYWxzZSk7DQoJCQkJCQkJCQkJICQoJyNsb2FkaW5nRGl2JykucmVtb3ZlKCk7DQoJCQkJCQkJCQkJIGlkc1NldC5oYW5kbGVTdWNjZXNzKCk7DQoNCgkJCQkJCQkJCSB9IGVsc2Ugew0KCQkJCQkJCQkJCSAvL3N0b3AgYSByZXZlcnNlIGJ1aWxkZXIgY2FsbCBpZiBpdCBpcyBoYXBwZW5pbmcNCgkJCQkJCQkJCQkgaWYgKGlkc1NldC5yZXZlcnNlQnVpbGRlckNhbGwpDQoJCQkJCQkJCQkJCSBpZHNTZXQucmV2ZXJzZUJ1aWxkZXJDYWxsLmFib3J0KCk7DQoJCQkJCQkJCQkJIGlkc1NldC5jaGVja0ZvckJ1aWxkZXJEYXRhKCQodGhpcykuY2hpbGRyZW4oJ2EnKS5jaGlsZHJlbignc3Bhbi52YWx1ZScpLmh0bWwoKSwgaW5kZXgsICJkcm9wZG93biIpOyAvLyBwYXJhbWV0ZXJzDQoJCQkJCQkJCQkJIC8vIGFyZQ0KCQkJCQkJCQkJCSAvLyAodmFsdWUsDQoJCQkJCQkJCQkJIC8vIGNyZWF0ZWRMZXZlbCwNCgkJCQkJCQkJCQkgLy8gZWxlbWVudFR5cGUpDQoJCQkJCQkJCQkgfQ0KCQkJCQkJCQkgfSBlbHNlIHsNCgkJCQkJCQkJIAkJaWRzU2V0LmhhbmRsZVN1Y2Nlc3MoKTsNCgkJCQkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuYnRuQ29udGludWUpLmF0dHIoJ2Rpc2FibGVkJywgZmFsc2UpOw0KCQkJCQkJCQkJICQoJyNsb2FkaW5nRGl2JykucmVtb3ZlKCk7DQoJCQkJCQkJCSB9DQoJCQkJCQkJIH0NCgkJCQkJCSB9KTsNCgkJCQl9Ow0KDQoJCQkJdGhpcy5oYW5kbGVTdWNjZXNzID0gZnVuY3Rpb24oKXsNCgkJCQkJIAkJaWYoaWRzU2V0LnN1Y2Nlc3NIYW5kbGVyIT0iIil7DQoJCQkJCQkJCQkgCQlpZihpZHNTZXQuc3VjY2Vzc0hhbmRsZXJQYXJhbXMhPSIiKXsNCgkJCQkJCQkJCSAJCQlpZHNTZXQuc3VjY2Vzc0hhbmRsZXIoaWRzU2V0LnN1Y2Nlc3NIYW5kbGVyUGFyYW1zKTsJDQoJCQkJCQkJCQkgCQl9DQoJCQkJCQkJCQkgCQllbHNlew0KCQkJCQkJCQkJIAkJCWlkc1NldC5zdWNjZXNzSGFuZGxlcigpOwkJDQoJCQkJCQkJCQkgCQl9DQoJCQkJCQkJCQkgfQ0KCQkJCX0NCg0KDQoJCQkJdGhpcy5jaGVja0J1aWxkZXJNYXAgPSBmdW5jdGlvbihjYXRJZCkgew0KCQkJCQkJIHZhciB0ZW1wSlNPTiA9IHRoaXMuYnVpbGRlck1hcFtjYXRJZF07DQoJCQkJCQkgaWYgKHRlbXBKU09OKSB7DQoJCQkJCQkJIHJldHVybiB0ZW1wSlNPTjsNCgkJCQkJCSB9DQoJCQkJfTsNCg0KCQkJCXRoaXMuZ2VuZXJhdGVCdWlsZGVyTWFwID0gZnVuY3Rpb24oY2F0SWQsIGRhdGEpIHsNCgkJCQkJIGlmICghaWRzU2V0LmNoZWNrQnVpbGRlck1hcChjYXRJZCkpIHsNCgkJCQkJCSBpZHNTZXQuYnVpbGRlck1hcFtjYXRJZF0gPSBkYXRhOw0KCQkJCQkgfQ0KCQkJCX07DQoJCQkJCSANCgkJCQkgLyogQUpBWCBjYWxsIHRvIFRNUyBmb3IgZGF0YSBiYXNlZCBvbiBjYXRlZ29yeSBJRCAqLw0KCQkJCSB0aGlzLmNoZWNrRm9yQnVpbGRlckRhdGEgPSBmdW5jdGlvbihjYXRlZ29yeUlkLCBpbmRleCwgZWxlbWVudFR5cGUpIHsNCgkJCQkJIGNjID0gZ2V0Q0NMQygnY2MnKTsNCgkJCQkJIGxjID0gZ2V0Q0NMQygnbGMnKTsNCgkJCQkJIGlmIChjYyA9PSAiZW4iKSB7DQoJCQkJCQkgY2MgPSBudWxsOw0KCQkJCQkJIGxjID0gbnVsbDsNCgkJCQkJIH0NCgkJCQkJIGRhdGEgPSBpZHNTZXQuY2hlY2tCdWlsZGVyTWFwKGNhdGVnb3J5SWQpOw0KDQoJCQkJCSBpZiAoZGF0YSA9PSBudWxsKSB7DQoNCgkJCQkJCSBpZHNTZXQuZ2V0QnVpbGRlclRNU1Jlc3BvbnNlID0gJC5wb3N0KGlkc1NldC5idWlsZGVyVVJMLCB7DQoJCQkJCQkJICdjYXRlZ29yeUlkJzogY2F0ZWdvcnlJZCwNCgkJCQkJCQkgJ2NjJzogY2MsDQoJCQkJCQkJICdsYyc6IGxjLA0KCQkJCQkJCSAncGF0aCc6aWRzU2V0LnBhdGgsDQoJCQkJCQkJICdleHRyYVBhcmFtcyc6aWRzU2V0LmV4dHJhUGFyYW1zDQoNCg0KCQkJCQkJCSANCgkJCQkJCSB9LCBmdW5jdGlvbihkYXRhKSB7DQoNCgkJCQkJCQkgaWYgKG51bGwgIT0gZGF0YS50bXNSZXNwb25zZSkgew0KCQkJCQkJCQkgaWRzU2V0LmdlbmVyYXRlQnVpbGRlck1hcChjYXRlZ29yeUlkLCBkYXRhKTsNCgkJCQkJCQkJIGlkc1NldC5jcmVhdGVEcm9wZG93bihkYXRhLnRtc1Jlc3BvbnNlLCBpbmRleCk7DQoJCQkJCQkJCWlkc1NldC5oYW5kbGVTdWNjZXNzKCk7CQkJCQkJCQkgDQoJCQkJCQkJIH0gZWxzZSB7DQoJCQkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuYnRuQ29udGludWUpLmF0dHIoJ2Rpc2FibGVkJywgZmFsc2UpOw0KCQkJCQkJCQkgJCgnI2xvYWRpbmdEaXYnKS5yZW1vdmUoKTsNCgkJCQkJCQkJIGlkc1NldC5oYW5kbGVTdWNjZXNzKCk7CQ0KCQkJCQkJCSB9DQoJCQkJCQkgfSk7DQoJCQkJCQkgaWYgKCQoJyNsb2FkaW5nRGl2JykubGVuZ3RoIDwgMSkgew0KCQkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuY29udGFpbmVySWQpLmFwcGVuZCgkKCc8ZGl2IGlkPSJsb2FkaW5nRGl2Ij48aW1nIGFsdD0iTG9hZGluZyIgc3JjPSInICsgaWRzU2V0LmxvYWRpbmdHaWYgKyAnIi8+PC9kaXY+JykpOw0KCQkJCQkJIH0NCgkJCQkJIH0gZWxzZSB7DQoJCQkJCQkgdGhpcy5nZW5lcmF0ZUJ1aWxkZXJNYXAoY2F0ZWdvcnlJZCwgZGF0YSk7DQoNCgkJCQkJCSBpZiAoZWxlbWVudFR5cGUgPT0gImRyb3Bkb3duIikNCgkJCQkJCQkgaWRzU2V0LmNyZWF0ZURyb3Bkb3duKGRhdGEudG1zUmVzcG9uc2UsIGluZGV4KTsNCgkJCQkJIH0NCgkJCQkgfTsNCg0KCQkJCSB0aGlzLmNyZWF0ZURyb3Bkb3duID0gZnVuY3Rpb24oZGF0YSwgaW5kZXgpIHsNCg0KCQkJCQkgaWYgKG51bGwgIT0gZGF0YSAmJiBkYXRhLmZpZWxkTGlzdFswXS5jbGF6elR5cGUgIT0gaWRzU2V0LnN0b3BMdmwpIHsNCgkJCQkJCSB2YXIgYWpheFNlbGVjdCA9ICQoJzxzZWxlY3Q+PC9zZWxlY3Q+Jyk7DQoJCQkJCQkgYWpheFNlbGVjdC5hZGRDbGFzcygnaHBTdHlsZURyb3Bkb3duJyk7DQoJCQkJCQkgYWpheFNlbGVjdC5hZGRDbGFzcygnaGlkZScpOw0KCQkJCQkJIHZhciBhamF4U2VsZWN0SWQgPSBpZHNTZXQuaWRzLmNvbnRhaW5lcklkICsgJzAnOw0KCQkJCQkJIGlmICgoaW5kZXggKyAxKSAhPSAwKSB7DQoJCQkJCQkJIGFqYXhTZWxlY3RJZCArPSAgKGluZGV4ICsgMSkgOw0KCQkJCQkJIH0gDQoJCQkJCQkgYWpheFNlbGVjdC5hdHRyKCdpZCcsIGFqYXhTZWxlY3RJZCk7DQoJCQkJCQkgYWpheFNlbGVjdC5hdHRyKCd1c2VUYWInLCAnMjknKTsNCgkJCQkJCSBpZiAoKGluZGV4ICsgMSkgPT0gMSkgew0KCQkJCQkJCSBhamF4U2VsZWN0LmF0dHIoJ25hbWUnLCAiY2F0ZzIiKTsNCg0KCQkJCQkJIH0gZWxzZSBpZiAoKGluZGV4ICsgMSkgPT0gMikgew0KDQoJCQkJCQkJIGFqYXhTZWxlY3QuYXR0cignbmFtZScsICJjYXRnMyIpOw0KCQkJCQkJIH0NCgkJCQkJCSBhamF4U2VsZWN0LmFwcGVuZCgnPG9wdGlvbiB2YWx1ZT0iIiBpbWFnZXVybD0iIj4nICsgaWRzU2V0LmRlZmF1bHRUZXh0ICsgJzwvb3B0aW9uPicpOw0KCQkJCQkJIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5maWVsZExpc3QubGVuZ3RoOyBpKyspIHsNCgkJCQkJCQkgDQoJCQkJCQkJIA0KCQkJCQkJCSB2YXIgcmVkaXJlY3RVUkwgPSBkYXRhLmZpZWxkTGlzdFtpXS5yZWRpcmVjdFVybDsNCgkJCQkJCQkgdmFyIFNNT2ZsYWcgPSBpZHNTZXQuc21vSlNPTi5jb25maWdTTU87DQoJCQkJCQkJIGlmKCBTTU9mbGFnPT0iZmFsc2UiICYmIGRhdGEuZmllbGRMaXN0W2ldLnVpZCA9PSBpZHNTZXQuc21vSlNPTi5jYXRlZ29yeUlkKXsNCgkJCQkJCQkJcmVkaXJlY3RVUkwgPSAgaWRzU2V0LnNtb0pTT04uZGlzY2xhaW1lclVSTDsNCgkJCQkJCQkgfQ0KCQkJCQkJCSANCgkJCQkJCQkgDQoJCQkJCQkJIGFqYXhTZWxlY3QNCgkJCQkJCQkJIC5hcHBlbmQoJzxvcHRpb24gdmFsdWU9IicgKyBkYXRhLmZpZWxkTGlzdFtpXS51aWQgKyAnIiBpbWFnZXVybD0iJyArIGRhdGEuZmllbGRMaXN0W2ldLmltYWdlVXJsICsgJyIgcmVkaXJlY3RVcmw9IicgKyByZWRpcmVjdFVSTCArICciIGNsYXp6VHlwZT0iJyArIGRhdGEuZmllbGRMaXN0W2ldLmNsYXp6VHlwZSArICciIHNlby1sYWJlbD0iJyArIGRhdGEuZmllbGRMaXN0W2ldLnNlb0xhYmVsICsgJyI+JyArIGRhdGEuZmllbGRMaXN0W2ldLnZhbHVlICsgJzwvb3B0aW9uPicpOw0KCQkJCQkJIH0NCgkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuYnRuQ29udGludWUpLmF0dHIoJ2Rpc2FibGVkJywgdHJ1ZSk7DQoNCgkJCQkJCSB2YXIgYnRuRmluZFNvZnR3YXJlID0gJCgnIycgKyBpZHNTZXQuaWRzLmJ0bkNvbnRpbnVlKTsNCgkJCQkJCSAkKCcjJyArIGlkc1NldC5pZHMuY29udGFpbmVySWQpLmFwcGVuZChhamF4U2VsZWN0KTsNCgkJCQkJCSBnZXRIcFN0eWxlRHJvcGRvd24oKTsNCgkJCQkJCSBpZHNTZXQuYXR0YWNoRHJvcGRvd25FdmVudEhhbmRsZXJzKGluZGV4ICsgMSk7DQoJCQkJCSB9IGVsc2UgaWYgKG51bGwgIT0gZGF0YSAmJiBkYXRhLmZpZWxkTGlzdFswXS5jbGF6elR5cGUgPT0gaWRzU2V0LnN0b3BMdmwpIHsNCgkJCQkJIAlpZihkYXRhLmZpZWxkTGlzdFswXS5jbGF6elR5cGUgPT0gInBtX251bWJlcl92YWx1ZSIpew0KCQkJCQkgCQkkKCcjJyArIGlkc1NldC5pZHMuY29udGFpbmVySWQpLmFwcGVuZCgnPGlucHV0IGlkPSJpcE1vZGVsTnVtYmVyIiBuYW1lPSJtb2RlbE51bWJlciIgdHlwZT0iaGlkZGVuIiB2YWx1ZT0iJyArIGRhdGEuZmllbGRMaXN0WzBdLnZhbHVlICsgJyIgLz4gJyk7CQ0KCQkJCQkgCX0JCQkJCQkgDQoJCQkJCQkgJCgnIycgKyBpZHNTZXQuaWRzLmJ0bkNvbnRpbnVlKS5hdHRyKCdkaXNhYmxlZCcsIGZhbHNlKTsNCgkJCQkJIH0NCgkJCQkJICQoJyNsb2FkaW5nRGl2JykucmVtb3ZlKCk7DQoJCQkJCSBpZHNTZXQuaGFuZGxlU3VjY2VzcygpOw0KCQkJCQkgJCgnIycrYWpheFNlbGVjdElkKydfZGRfaGVhZGVyTGluaycpLnRyaWdnZXIoJ2ZvY3VzJyk7DQoNCgkJCQkgfTsNCn07Cn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ey8qDQogKiBUaGlzIGlzIHRoZSBEYXRhTGF5ZXIgdGhhdCBpcyBwYXNzZWQgdG8gRW5zaWdodGVuIGZvciBhbmFseXRpY3MuDQogKiBUaGlzIGZpbGUgaXMgaW5jbHVkZWQgZGlyZWN0bHkgaW50byB0aGVtZXMuaHRtbCBhZnRlciB0aGUgY286aGVhZCBzZWN0aW9uDQogKiBBdXRob3I6IFZhcnVuIFZpbmF5YWsNCiAqIFNhbXBsZTogZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCJrZXkiLCJ2YWx1ZSIpDQogKi8NCg0KLyogKioqKlRoaXMgaXMgdGhlIGdsb2JhbCBkYXRhbGF5ZXIgb2JqZWN0IHRoYXQgaG9sZHMgdGhlIHJlcXVpcmVkIGtleSAtIHZhbHVlIHBhaXJzICYgY2FuIGJlIGFjY2Vzc2VkIGJ5IGFsbCB0aGUgcG9ydGxldHMgKioqKiAgKi8NCnZhciBnbG9iYWxEYXRhTGF5ZXIgPSB7DQogICAgQ291bnRyeUNvZGU6ICcnLA0KICAgIExhbmd1YWdlQ29kZTogJycsDQogICAgTG9jYWxlOiAnJywNCiAgICBXZWJTZWN0aW9uSWQ6ICdSMTE4MzknLA0KICAgIFBmaW5kZXJRdWVyeTogJycsDQogICAgVGVtcGxhdGU6ICcnLA0KICAgIHN3U25pZmZlZE9Tc3VwcG9ydGVkOiBudWxsLA0KICAgIERvY3VtZW50OiB7DQogICAgICAgIGRvY3VtZW50SUQ6ICIiDQogICAgfSwNCiAgICBEYXNoYm9hcmQ6IHsNCiAgICAgICAgTm9PZkRldmljZXM6ICIiLA0KICAgICAgICBQcm9kdWN0czogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGF1ZGllbmNlVHlwZTogIiIsDQogICAgICAgICAgICAgICAgUHJvZHVjdExpbmVDb2RlOiAiIiwNCiAgICAgICAgICAgICAgICBQcm9kdWN0TW9kZWxOdW1iZXI6ICIiLA0KICAgICAgICAgICAgICAgIFNlcmllc05hbWU6ICIiLA0KICAgICAgICAgICAgICAgIFNlcmllc09pZDogIiIsDQogICAgICAgICAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdLA0KICAgICAgICBTcGVjc01pc3Npbmc6IFtdLA0KICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0sDQogICAgUHJvZHVjdDogew0KICAgICAgICBiaWdTZXJpZXNOYW1lOiAiIiwNCiAgICAgICAgYmlnU2VyaWVzT2lkOiAiIiwNCiAgICAgICAgc3VwcG9ydENhdGVnb3J5TmFtZTogIiIsDQogICAgICAgIHN1cHBvcnRDYXRlZ29yeU9pZDogIiIsDQogICAgICAgIHNlcmllc05hbWU6ICIiLA0KICAgICAgICBzZXJpZXNPaWQ6ICIiLA0KICAgICAgICBwcm9kdWN0TGluZUNvZGU6ICIiLA0KICAgICAgICBzdXBwb3J0TmFtZU5hbWU6ICIiLA0KICAgICAgICBzdXBwb3J0TmFtZU9pZDogIiIsDQogICAgICAgIHBsYXRmb3JtSWQ6ICIiLA0KICAgICAgICB3ZWJSZWxlYXNlRGF0ZTogIiIsDQogICAgICAgIHNlcmlhbE51bWJlcjogIiIsDQogICAgICAgIHByb2R1Y3RTa3VOYW1lOiIiLA0KICAgICAgICBhdWRpZW5jZVR5cGU6IiIsDQogICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7DQogICAgICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQogICAgICAgICAgICAgICAgdGhpc1trZXldID0gdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9LA0KICAgIFNlYXJjaDogew0KICAgICAgICAgICAgUXVlcnk6IiIsDQogICAgICAgICAgICBSZWRpcmVjdDoiZmFsc2UiLA0KICAgICAgICAgICAgQ291bnQ6IiIsDQogICAgICAgICAgICBQcm9kdWN0OiB7DQogICAgICAgICAgICAgICAgICAgIGJpZ1Nlcmllc05hbWU6ICIiLA0KICAgICAgICAgICAgICAgICAgICBiaWdTZXJpZXNPaWQ6ICIiLA0KICAgICAgICAgICAgICAgICAgICBzdXBwb3J0Q2F0ZWdvcnlOYW1lOiAiIiwNCiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydENhdGVnb3J5T2lkOiAiIiwNCiAgICAgICAgICAgICAgICAgICAgc2VyaWVzTmFtZTogIiIsDQogICAgICAgICAgICAgICAgICAgIHNlcmllc09pZDogIiIsDQogICAgICAgICAgICAgICAgICAgIHByb2R1Y3RMaW5lQ29kZTogIiIsDQogICAgICAgICAgICAgICAgICAgIHN1cHBvcnROYW1lTmFtZTogIiIsDQogICAgICAgICAgICAgICAgICAgIHN1cHBvcnROYW1lT2lkOiAiIiwNCiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm1JZDogIiIsDQogICAgICAgICAgICAgICAgICAgIHdlYlJlbGVhc2VEYXRlOiAiIiwNCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsTnVtYmVyOiAiIiwNCiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdE1vZGVsTnVtYmVyOiIiLA0KICAgICAgICAgICAgICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24oa2V5LCB2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoa2V5KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIElET0xQcm9kdWN0OnsNCiAgICAgICAgICAgICAgICBwcm9kdWN0TmFtZToiIiwNCiAgICAgICAgICAgICAgICBwcm9kdWN0VE1TT0lEOiIiLA0KICAgICAgICAgICAgICAgIHByb2R1Y3RUTVNDbGFzczoiIiwNCiAgICAgICAgICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24oa2V5LCB2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoa2V5KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgIH0sDQogICAgRE1EOiB7DQogICAgICAgIFNTRkluc3RhbGxlZDogIiIsDQogICAgICAgIFByb2RDb3VudDogIiIsDQogICAgICAgIFByb2R1Y3RzOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgIlBuIjogIiIsDQogICAgICAgICAgICAgICAgIlBsIjogIiIsDQogICAgICAgICAgICAgICAgIlBOYW1lIjogIiIsDQogICAgICAgICAgICAgICAgInNPaWQiOiAiIiwNCiAgICAgICAgICAgICAgICAicE9pZCI6ICIiLA0KICAgICAgICAgICAgICAgICJEZXRlY3RNZXRob2QiOiAiIiwNCiAgICAgICAgICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24oa2V5LCB2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0sDQogICAgRW50aXRsZW1lbnRSZXN1bHRzOiB7DQogICAgICAgIEVudFJlc3VsdHM6JycsDQogICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7DQogICAgICAgICAgICAvL2lmICh0aGlzLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTsNCiAgICAgICAgICAgIC8vfQ0KICAgICAgICB9DQogICAgfSwNCiAgICBFcnJvckNvZGU6ICcnLA0KICAgIHNvZnR3YXJlRG93bmxvYWRlZEZpbGVOYW1lczogJycsDQogICAgSU9HOiBbXSwNCglzZXNzaW9uSWQ6JycsDQogICAgc2V0VmFsdWU6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsNCiAgICAgICAgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoa2V5KSkgew0KICAgICAgICAgICAgdGhpc1trZXldID0gdmFsdWU7DQogICAgICAgIH0NCiAgICB9DQp9Ow0KDQppZihzZXNzaW9uU3RvcmFnZS5Eb3dubG9hZFR5cGUgIT0gdW5kZWZpbmVkKXsNCiAgICBnbG9iYWxEYXRhTGF5ZXIuRG93bmxvYWRUeXBlID0gc2Vzc2lvblN0b3JhZ2UuRG93bmxvYWRUeXBlOw0KfQ0KDQovKioNCiAqIFIxOTItMzY3OiBHbG9iYWwgRGF0YSBMYXllciBzaGFyaW5nIGJldHdlZW4gV2Vic3BoZXJlIFdDQyBhbmQgQVdTIFdDQyBhcHBsaWNhdGlvbnMgLS0NCiAqIFRoZSBnbG9iYWxEYXRhTGF5ZXJXcml0ZXIgaXMgYSB1dGlsaXR5IG9iamVjdCBmb3Igd3JpdGluZyBnbG9iYWxEYXRhTGF5ZXIgdmFsdWVzIHJldHJpdmVkIGZyb20gbG9jYWwgc3RvcmFnZS4NCiAqIGdsb2JhbERhdGFMYXllciBwcm9wZXJ0aWVzIGNhbiBjb250YWluIHN0cmluZ3MsIG51bWJlcnMsIGJvb2xlYW5zLCBvYmplY3RzLCBhbmQgYXJyYXlzIG9mIG9iamVjdHMuDQogKi8NCnZhciBnbG9iYWxEYXRhTGF5ZXJXcml0ZXIgPSB7DQogICAgLyoqDQogICAgICogU2V0cyBnbG9iYWxEYXRhTGF5ZXIgcHJvcGVydGllcyBvbiB0aGUgZ2xvYmFsRGF0YUxheWVyIG9iamVjdC4gTm90IGFsbCBnZGwgcHJvcGVydGllcyBoYXZlIGEgc2V0VmFsdWUgbWV0aG9kDQogICAgICogc28gaXQncyBuZWNlc3NhcnkgdG8gY2hlY2sgZmlyc3QgdG8gYXZvaWQgZXJyb3IuICBOZXN0ZWQgb2JqZWN0cyBuZWNlc3NpdGF0ZSB0aGUgYWRkaXRpb25hbCBjaGVja3MgZm9yDQogICAgICogYW5jZXN0b3IgLyBwYXJlbnQuICBUaGVyZSBpcyBsaWtlbHkgYSBtb3JlIGVsZWdhbnQgc29sdXRpb24gKHVzaW5nIGxlc3MgJ2lmJyBzdG10cyksIGJ1dCB0aGlzIHdvcmtzIGZvciBub3cuLi4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBnZGxQcm9wTmFtZSAtIGdkbCBwcm9wZXJ0eSBuYW1lDQogICAgICogQHBhcmFtIGdsZFByb3BWYWx1ZSAtIGdkbCBwcm9wZXJ0eSB2YWx1ZQ0KICAgICAqIEBwYXJhbSBnZGxGYW1pbHlUcmVlIC0gW29wdGlvbmFsXSBvYmplY3Qgd2l0aCBwYXJlbnQgJiBhbmNlc3RvciBwcm9wZXJ0aWVzLiAgRXgge3BhcmVudDogUHJvZHVjdHMsIGFuY2VzdG9yOiBEYXNoYm9hcmR9DQogICAgICoNCiAgICAgKi8NCiAgICB3cml0ZUdsb2JhbERhdGFMYXllclZhbHVlOiBmdW5jdGlvbihnZGxQcm9wTmFtZSwgZ2RsUHJvcFZhbCwgZ2RsRmFtaWx5VHJlZSl7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoZ2RsRmFtaWx5VHJlZSAmJiBnZGxGYW1pbHlUcmVlLmhhc093blByb3BlcnR5KCJhbmNlc3RvciIpICYmIGdkbEZhbWlseVRyZWUuaGFzT3duUHJvcGVydHkoInBhcmVudCIpKSB7DQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5nbG9iYWxEYXRhTGF5ZXJbZ2RsRmFtaWx5VHJlZS5hbmNlc3Rvcl1bZ2RsRmFtaWx5VHJlZS5wYXJlbnRdLmhhc093blByb3BlcnR5KCdzZXRWYWx1ZScpKXsNCiAgICAgICAgICAgICAgICAgICAgd2luZG93Lmdsb2JhbERhdGFMYXllcltnZGxGYW1pbHlUcmVlLmFuY2VzdG9yXVtnZGxGYW1pbHlUcmVlLnBhcmVudF0uc2V0VmFsdWUoZ2RsUHJvcE5hbWUsIGdkbFByb3BWYWwpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5nbG9iYWxEYXRhTGF5ZXJbZ2RsRmFtaWx5VHJlZS5hbmNlc3Rvcl1bZ2RsRmFtaWx5VHJlZS5wYXJlbnRdW2dkbFByb3BOYW1lXSA9ICBnZGxQcm9wVmFsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2RsRmFtaWx5VHJlZSAmJiBnZGxGYW1pbHlUcmVlLmhhc093blByb3BlcnR5KCJwYXJlbnQiKSkgew0KICAgICAgICAgICAgICAgIGlmICh1bmRlZmluZWQgIT09IHdpbmRvdy5nbG9iYWxEYXRhTGF5ZXJbZ2RsRmFtaWx5VHJlZS5wYXJlbnRdKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZ2xvYmFsRGF0YUxheWVyW2dkbEZhbWlseVRyZWUucGFyZW50XS5oYXNPd25Qcm9wZXJ0eSgnc2V0VmFsdWUnKSl7DQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZ2xvYmFsRGF0YUxheWVyW2dkbEZhbWlseVRyZWUucGFyZW50XS5zZXRWYWx1ZShnZGxQcm9wTmFtZSwgZ2RsUHJvcFZhbCk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZ2xvYmFsRGF0YUxheWVyW2dkbEZhbWlseVRyZWUucGFyZW50XVtnZGxQcm9wTmFtZV0gPSAgZ2RsUHJvcFZhbDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgd2luZG93Lmdsb2JhbERhdGFMYXllci5zZXRWYWx1ZShnZGxQcm9wTmFtZSwgZ2RsUHJvcFZhbCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2goZSl7DQogICAgICAgICAgY29uc29sZS5sb2coIkVSUk9SOiBmYWlsZWQgdG8gc2V0IGdsb2JhbERhdGFMYXllciBwcm9wICIgKyBlKTsNCiAgICAgICAgfQ0KICAgIH0sDQogICAgLyoqDQogICAgICogSXRlcmF0ZXMgZ2xvYmFsRGF0YUxheWVyIHByb3BlcnRpZXMgY2FsbGluZyB3cml0ZUdsb2JhbERhdGFMYXllclZhbHVlIHdpdGggdGhlIGFwcHJvcHJpYXRlIGxldmVsIG9mIHJlZmVyZW5jZSAoZm9yIG5lc3RlZCBvYmplY3RzKS4NCiAgICAgKiBBcnJheXMgJiBwcmltaXRpdmUgdHlwZXMgYXJlIGhhbmRsZWQgaWRlbnRpY2FsbHkgZm9yIG5vdyAodmFsdWUgaXMgYXNzaWduZWQgZGlyZWN0bHkpLiAgSWYgdGhlIHByb3BlcnkgaXMgbm90IG51bGwgbm9yIGFuIEFycmF5IGJ1dA0KICAgICAqIGlzIGFuIG9iamVjdCwgdGhlIGZ1bmN0aW9uIHJlY3Vyc2VzIG9uIGl0c2VsZiByZXRhaW5pbmcgdGhlIHBhcmVudCBwcm9wZXJ0eSBuYW1lIGFzIGFuY2VzdG9yIC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBwYXJlbnQgLSB0aGUgcHJvcGVydHkgbmFtZSBmb3IgdGhpcyBnbG9iYWxEYXRhTGF5ZXIgdmFsdWUNCiAgICAgKiBAcGFyYW0gZ2RsT2JqIC0gdGhlIGdsb2JhbERhdGFMYXllciBvYmplY3QgdG8gYmUgcGFyc2VkDQogICAgICogQHBhcmFtIGFuY2VzdG9yIC0gW29wdGlvbmFsXSB3aWxsIGJlIHByZXNlbnQgZm9yIG5lc3RlZCBvYmplY3RzIG9ubHkuICBUaGlzIGlzIHRoZSBmaXJzdCBsZXZlbCBnbG9iYWxEYXRhTGF5ZXIgcHJvcGVydHkgbmFtZS4gIEV4Og0KICAgICAqICAgIFNlYXJjaCBiZWNvbWVzIHRoZSBhbmNlc3RvciB3aGVuIHRoZSBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLlByb2R1Y3Qgb2JqZWN0IHZhbHVlIGlzIHBhcnNlZC4NCiAgICAgKi8NCiAgICBwYXJzZUdETFByb3BlcnR5OiBmdW5jdGlvbihwYXJlbnQsIGdkbE9iaiwgYW5jZXN0b3Ipew0KICAgICAgICB2YXIgZ2RsQW5jZXN0b3J5ID0geyJwYXJlbnQiOiBwYXJlbnR9Ow0KICAgICAgICBpZiAoYW5jZXN0b3IgJiYgYW5jZXN0b3IgIT09ICIiKXsNCiAgICAgICAgICAgIGdkbEFuY2VzdG9yeVsiYW5jZXN0b3IiXSA9IGFuY2VzdG9yOw0KICAgICAgICB9DQogICAgICAgIGZvciAodmFyIGtleSBpbiBnZGxPYmopIHsNCiAgICAgICAgICAgIGlmICgib2JqZWN0IiA9PSB0eXBlb2YoZ2RsT2JqW2tleV0pICYmIGZhbHNlID09IEFycmF5LmlzQXJyYXkoZ2RsT2JqW2tleV0pICYmIG51bGwgIT09IGdkbE9ialtrZXldKSB7DQogICAgICAgICAgICAgICAgLy8gdmFsdWUgaXMgYW4gb2JqZWN0IHdpdGggc3RyaW5nL2Jvb2xlYW4vbnVtYmVyL251bGwgcHJvcGVydGllcy4gIGV4OiBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLlByb2R1Y3QgPSB7ImtleSI6InZhbHVlIiwuLi59DQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyV3JpdGVyLnBhcnNlR0RMUHJvcGVydHkoa2V5LGdkbE9ialtrZXldLHBhcmVudCk7DQogICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyB2YWx1ZSBpcyBhbiBhcnJheSBvZiBvYmplY3RzIG9yIGFueSBwcmltaXRpdmUgZGF0YSB0eXBlIChzdHJpbmcsIG51bWJlciwgYm9vbGVhbikNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXJXcml0ZXIud3JpdGVHbG9iYWxEYXRhTGF5ZXJWYWx1ZShrZXksZ2RsT2JqW2tleV0sZ2RsQW5jZXN0b3J5KTsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgfQ0KfTsNCi8qKg0KICogUjE5Mi0zNjc6IEdsb2JhbCBEYXRhIExheWVyIHNoYXJpbmcgYmV0d2VlbiBXZWJzcGhlcmUgV0NDIGFuZCBBV1MgV0NDIGFwcGxpY2F0aW9ucyAtLQ0KICoNCiAqIFRoaXMgZnVuY3Rpb24gY2hlY2tzIGxvY2FsIHN0b3JhZ2UgZm9yIHRoZSBnbG9iYWxEYXRhTGF5ZXIgaXRlbS4gIElmIGZvdW5kLCB0aGUgdmFsdWUgaXMgY29udmVydGVkIHRvIEpTT04gdGhlbiBpdGVyYXRlZA0KICogd3JpdGluZyBlYWNoIGtleS92YWx1ZSB0byB3aW5kb3cuZ2xvYmFsRGF0YUxheWVyIChmb3IgYWxsIG5vbi1vYmplY3QgdmFsdWVzKSBvciBzZW5kaW5nIHRoZSB2YWx1ZSBmb3IgZnV0aGVyIHBhcnNpbmcNCiAqIChmb3IgdmFsdWVzIHRoYXQgYXJlIG9iamVjdHMgdGhlbXNlbHZlcykuIFRoZSBpbnRlbnQgaXMgdHdvZm9sZDoNCiAqICAxLiAgYXZvaWQgb3ZlcndyaXRpbmcgdGhlIGdsb2JhbERhdGFMYXllciBvYmplY3Qgd2l0aCBhIHN1YnNldCBvZiBrZXkvdmFsdWVzIGFjcXVpcmVkIGZyb20gQVdTIFdDQyAoaW4gY2FzZSBBV1MgV0NDDQogKiAgICAgIGdsb2JhbERhdGFMYXllciBvYmplY3QgZG9lcyBub3QgaW5jbHVkZSBrZXlzIHNldCBieSBwb3J0bGV0cyBlbHN3ZXdoZXJlIGluIHRoZSBXZWJzcGhlcmUgV0NDIGFwcGxpY2F0aW9uKSBhbmQsDQogKiAgMi4gIHdoZXJlIHBvc3NpYmxlLCBhc3NlcnQgZ3JlYXRlciBjb250cm9sIG92ZXIgaG93IHZhbHVlcyBhcmUgc2V0IG9uIHRoZSBnbG9iYWwgb2JqZWN0LiBUaGUgcHJlZmVycmVkIG1ldGhvZCBpcyB0byB1c2UgdGhlIG9iamVjdCdzIHNldFZhbHVlKCkgbWV0aG9kDQogKiAgICAgIChpZiBpdCBoYXMgb25lKSB0byBlbnN1cmUgZGF0YSBpbnRlZ3JpdHkuDQogKi8NCmZ1bmN0aW9uIGdldEdsb2JhbERhdGFMYXllckZyb21Mb2NhbFN0b3JhZ2UoKXsNCiAgICB2YXIgZ2RsID0gKHdpbmRvdy5sb2NhbFN0b3JhZ2UgJiYgd2luZG93LmxvY2FsU3RvcmFnZS5oYXNPd25Qcm9wZXJ0eSgnZ2xvYmFsRGF0YUxheWVyJykpID8gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZ2xvYmFsRGF0YUxheWVyJykpIDogdW5kZWZpbmVkOw0KICAgIGlmICh1bmRlZmluZWQgIT09IGdkbCl7DQogICAgICAgIGZvciAodmFyIGsgaW4gZ2RsKSB7DQogICAgICAgICAgICBpZiAoIm9iamVjdCIgPT0gdHlwZW9mIChnZGxba10pICYmIG51bGwgIT09IGdkbFtrXSkgew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllcldyaXRlci5wYXJzZUdETFByb3BlcnR5KGssIGdkbFtrXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllcldyaXRlci53cml0ZUdsb2JhbERhdGFMYXllclZhbHVlKGssZ2RsW2tdKTsgICAgICAgICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn07DQovKioNCiAqIFIxOTItMzY3OiBHbG9iYWwgRGF0YSBMYXllciBzaGFyaW5nIGJldHdlZW4gV2Vic3BoZXJlIFdDQyBhbmQgQVdTIFdDQyBhcHBsaWNhdGlvbnMgLS0NCiAqIHdyaXRlR2xvYmFsRGF0YUxheWVyVG9Mb2NhbFN0b3JhZ2VfV1Mgc2V0cyB0aGUgZ2xvYmFsRGF0YUxheWVyIG9iamVjdCBpbiBsb2NhbFN0b3JhZ2UNCiAqLw0KZnVuY3Rpb24gd3JpdGVHbG9iYWxEYXRhTGF5ZXJUb0xvY2FsU3RvcmFnZV9XUygpew0KICAgIHRyeXsNCiAgICAgICAgaWYoZ2xvYmFsRGF0YUxheWVyICYmIHdpbmRvdy5sb2NhbFN0b3JhZ2Upew0KICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdnbG9iYWxEYXRhTGF5ZXInLCBKU09OLnN0cmluZ2lmeShnbG9iYWxEYXRhTGF5ZXIpKTsNCiAgICAgICAgfQ0KICAgIH0gY2F0Y2goZSl7DQogICAgICAgIGNvbnNvbGUubG9nKCJGYWlsZWQgdG8gc2V0IGdkbCBpbiBsb2NhbCBzdG9yYWdlICIgKyBlKTsNCiAgICB9DQp9DQovKiogUjE5Mi0zNjc6IEdsb2JhbCBEYXRhIExheWVyIHNoYXJpbmcgYmV0d2VlbiBXZWJzcGhlcmUgV0NDIGFuZCBBV1MgV0NDIGFwcGxpY2F0aW9ucyAtLQ0KICogIEluaXRpYWxpemUgZ2xvYmFsRGF0YUxheWVyIHdpdGggdmFsdWVzIGZyb20gbG9jYWwgc3RvcmFnZS4gVmFsdWVzIHdpbGwgYmUgdXBkYXRlZCAvIG92ZXJ3cml0dGVuDQogKiAgYXMgY3VzdG9tZXIgaW50ZXJhY3RzIHdpdGggdGhlIFBvcnRhbCBhcHBsaWNhdGlvbi4gDQogKi8NCnRyeXsNCiAgICBnZXRHbG9iYWxEYXRhTGF5ZXJGcm9tTG9jYWxTdG9yYWdlKCk7DQp9IGNhdGNoKGUpew0KICAgIGNvbnNvbGUubG9nKCJGYWlsZWQgdG8gcmVhZCBnZGwgZnJvbSBsb2NhbCBzdG9yYWdlICIgKyBlKTsNCn0NCi8qKg0KICogUjE5Mi0zNjc6IEdsb2JhbCBEYXRhIExheWVyIHNoYXJpbmcgYmV0d2VlbiBXZWJzcGhlcmUgV0NDIGFuZCBBV1MgV0NDIGFwcGxpY2F0aW9ucyAtLQ0KICogUGVyc2lzdCBnbG9iYWxEYXRhTGF5ZXIgdmFsdWVzIGluIGxvY2FsIHN0b3JhZ2UgYmVmb3JlIHBhZ2UgdW5sb2FkIGV2ZW50Lg0KICovDQp3aW5kb3cub25iZWZvcmV1bmxvYWQgPSBmdW5jdGlvbigpew0KICAgIHdyaXRlR2xvYmFsRGF0YUxheWVyVG9Mb2NhbFN0b3JhZ2VfV1MoKTsNCn0NCi8qLS0tLS0tLS0tLS1Mb2NhbCBTdG9yYWdlIHNlc3Npb24gZnVuY3Rpb25zLS0tLS0tLS0tLS0tLQ0KICAgIGZ1bmN0aW9uIHRyaWdnZXJMb2NhbFNlc3Npb25UaW1lcigpew0KICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7DQogICAgICAgIHZhciBjdXJyZW50VGltZSA9IGRhdGUuZ2V0VGltZSgpOw0KICAgICAgICBsb2NhbFN0b3JhZ2Uuc3RhcnRUaW1lID0gY3VycmVudFRpbWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2hlY2tMb2NhbFNlc3Npb24oKXsNCiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpOw0KICAgICAgICB2YXIgY3VycmVudFRpbWUgPSBkYXRlLmdldFRpbWUoKTsNCiAgICAgICAgaWYobG9jYWxTdG9yYWdlLnN0YXJ0VGltZSA9PT0gdW5kZWZpbmVkKXsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlew0KICAgICAgICAgICAgdmFyIGRpZmYgPSBjdXJyZW50VGltZSAtIHBhcnNlSW50KGxvY2FsU3RvcmFnZS5zdGFydFRpbWUpOw0KICAgICAgICAgICAgaWYoZGlmZiA+PSAxNDQwMDAwMCl7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0qLw0KICAgICAvKi0tLS0tLS0tU2V0dGluZyBGbGFnIE9iamVjdC0tLS0tLS0qLw0KICAgICBmdW5jdGlvbiB1cGRhdGVEYXRhTGF5ZXJGbGFncyhmbGFnT2JqZWN0KXsNCiAgICAgICAgaWYoZmxhZ09iamVjdD09IiIpew0KICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLkZsYWcgPSB7J2RvY3VtZW50Vmlld2VkJzogZmFsc2UsICdzZWFyY2hFeGVjdXRlZCc6IGZhbHNlLCAnc3dkVmlzaXRlZCc6IGZhbHNlLCAnY29udGFjdEhQVmlzaXRlZCc6IGZhbHNlLCAnaWRlbnRpZnlOb3dEbWQnOiBmYWxzZSwgJ2ZpbmRTb2x1dGlvbnNEbWQnOiBmYWxzZSwgJ2NoZWNrTm93RG1kJzogZmFsc2UsJ0VBU1Zpc2l0ZWQnOiBmYWxzZX07DQogICAgICAgICAgICBmbGFnT2JqZWN0ID0gSlNPTi5zdHJpbmdpZnkoZ2xvYmFsRGF0YUxheWVyLkZsYWcpOw0KICAgICAgICB9DQogICAgICAgIGZsYWdPYmplY3QgPSAkLnBhcnNlSlNPTihmbGFnT2JqZWN0KTsNCiAgICAgICAgaWYoZ2xvYmFsRGF0YUxheWVyLkZsYWcgPT09IHVuZGVmaW5lZCl7DQogICAgICAgIAlnbG9iYWxEYXRhTGF5ZXIuRmxhZyA9IHsnZG9jdW1lbnRWaWV3ZWQnOiBmYWxzZSwgJ3NlYXJjaEV4ZWN1dGVkJzogZmFsc2UsICdzd2RWaXNpdGVkJzogZmFsc2UsICdjb250YWN0SFBWaXNpdGVkJzogZmFsc2UsICdpZGVudGlmeU5vd0RtZCc6IGZhbHNlLCAnZmluZFNvbHV0aW9uc0RtZCc6IGZhbHNlLCAnY2hlY2tOb3dEbWQnOiBmYWxzZSwnRUFTVmlzaXRlZCc6IGZhbHNlfTsNCiAgICAgICAgICAgIGNoZWNrU2Vzc2lvbk9iamVjdChmbGFnT2JqZWN0KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlew0KICAgICAgICAgICAgY2hlY2tTZXNzaW9uT2JqZWN0KGZsYWdPYmplY3QpOw0KICAgICAgICB9DQogICAgIH0NCg0KICAgICBmdW5jdGlvbiB1cGRhdGVBdWRpZW5jZVR5cGUoKXsgLy9kZXRlcm1pbmUgaWYgcHJvZHVjdCBpcyBjb25zdW1lciBvciBjb21tZXJjaWFsDQogICAgICAgaWYoJCgnI3Rtc0NsYXNzRm9yU2VhcmNoJykudmFsKCkgPT0gJ3BtX3Nlcmllc192YWx1ZScpew0KICAgICAgICAgICBpZigkKCcjaXNDb21tZXJjaWFsUHJvZHVjdCcpLnZhbCgpID09ICd0cnVlJyl7DQogICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnYXVkaWVuY2VUeXBlJywnQ29tbWVyY2lhbCcpOw0KICAgICAgICAgICB9DQogICAgICAgICAgIGVsc2V7DQogICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnYXVkaWVuY2VUeXBlJywnQ29uc3VtZXInKTsNCiAgICAgICAgICAgfQ0KICAgICAgIH1lbHNlIGlmKCQoJyN0bXNDbGFzc0ZvclNlYXJjaCcpLnZhbCgpID09ICdwbV9uYW1lX3ZhbHVlJyl7DQogICAgICAgICBpZigkKCcjaXNDb21tZXJjaWFsUHJvZHVjdCcpLnZhbCgpID09ICd0cnVlJyl7DQogICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnYXVkaWVuY2VUeXBlJywnTGFyZ2UnKTsNCiAgICAgICAgIH0NCiAgICAgICAgIGVsc2V7DQogICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnNldFZhbHVlKCdhdWRpZW5jZVR5cGUnLCdISE8nKTsNCiAgICAgICAgIH0NCiAgICAgICB9DQogICAgIH0NCg0KICAgICBmdW5jdGlvbiBjaGVja1Nlc3Npb25PYmplY3QoZmxhZ09iamVjdCl7DQogICAgICAgICAgICBpZihmbGFnT2JqZWN0LmRvY3VtZW50Vmlld2VkICE9PSB0cnVlKXsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5kb2N1bWVudFZpZXdlZCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5kb2N1bWVudFZpZXdlZCA9IGZsYWdPYmplY3QuZG9jdW1lbnRWaWV3ZWQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKGZsYWdPYmplY3Quc2VhcmNoRXhlY3V0ZWQgIT09IHRydWUpew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5GbGFnLnNlYXJjaEV4ZWN1dGVkID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5GbGFnLnNlYXJjaEV4ZWN1dGVkID0gZmxhZ09iamVjdC5zZWFyY2hFeGVjdXRlZDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoZmxhZ09iamVjdC5zd2RWaXNpdGVkICE9PSB0cnVlKXsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5zd2RWaXNpdGVkID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5GbGFnLnN3ZFZpc2l0ZWQgPSBmbGFnT2JqZWN0LnN3ZFZpc2l0ZWQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKGZsYWdPYmplY3QuY29udGFjdEhQVmlzaXRlZCAhPT0gdHJ1ZSl7DQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLkZsYWcuY29udGFjdEhQVmlzaXRlZCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5jb250YWN0SFBWaXNpdGVkID0gZmxhZ09iamVjdC5jb250YWN0SFBWaXNpdGVkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihmbGFnT2JqZWN0LmlkZW50aWZ5Tm93RG1kICE9PSB0cnVlKXsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5pZGVudGlmeU5vd0RtZCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5pZGVudGlmeU5vd0RtZCA9IGZsYWdPYmplY3QuaWRlbnRpZnlOb3dEbWQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKGZsYWdPYmplY3QuZmluZFNvbHV0aW9uc0RtZCAhPT0gdHJ1ZSl7DQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLkZsYWcuZmluZFNvbHV0aW9uc0RtZCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5maW5kU29sdXRpb25zRG1kID0gZmxhZ09iamVjdC5maW5kU29sdXRpb25zRG1kOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihmbGFnT2JqZWN0LmNoZWNrTm93RG1kICE9PSB0cnVlKXsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5jaGVja05vd0RtZCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5jaGVja05vd0RtZCA9IGZsYWdPYmplY3QuY2hlY2tOb3dEbWQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEVBUyBWaXNpdGVkIEZsYWcNCiAgICAgICAgICAgIGlmKGZsYWdPYmplY3QuZWFzVmlzaXRlZCAhPT0gdHJ1ZSl7DQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLkZsYWcuRUFTVmlzaXRlZCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgIAlnbG9iYWxEYXRhTGF5ZXIuRmxhZy5FQVNWaXNpdGVkID0gZmxhZ09iamVjdC5lYXNWaXNpdGVkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihmbGFnT2JqZWN0LmRvY3VtZW50R0RMID09IG51bGwpew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Eb2N1bWVudC5kb2N1bWVudElEID0gIiI7DQogICAgICAgICAgICAgICAgZGVsZXRlIGdsb2JhbERhdGFMYXllci5GbGFnLmRvY3VtZW50R0RMOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRG9jdW1lbnQuZG9jdW1lbnRJRCA9IGZsYWdPYmplY3QuZG9jdW1lbnRHREwuZG9jdW1lbnRJZDsgOw0KICAgICAgICAgICAgICAgIGRlbGV0ZSBnbG9iYWxEYXRhTGF5ZXIuRmxhZy5kb2N1bWVudEdETDsNCiAgICAgICAgICAgIH0NCiAgICAgfQ0KICAgIC8qdmFyIHNlc3Npb25BY3RpdmUgPSBjaGVja0xvY2FsU2Vzc2lvbigpOw0KICAgIGlmKCFzZXNzaW9uQWN0aXZlKXsNCiAgICAgICAgbG9jYWxTdG9yYWdlLmRvY3VtZW50Vmlld2VkID0gImZhbHNlIjsNCiAgICAgICAgbG9jYWxTdG9yYWdlLnNlYXJjaEV4ZWN1dGVkID0gImZhbHNlIjsNCiAgICAgICAgbG9jYWxTdG9yYWdlLnN3ZFZpc2l0ZWQgPSAiZmFsc2UiOw0KICAgICAgICBsb2NhbFN0b3JhZ2UuY29udGFjdEhQVmlzaXRlZCA9ICJmYWxzZSI7DQogICAgICAgIGxvY2FsU3RvcmFnZS5pZGVudGlmeU5vd0RtZCA9ICJmYWxzZSI7DQogICAgICAgIGdsb2JhbERhdGFMYXllci5GbGFnID0geydkb2N1bWVudFZpZXdlZCc6ICdmYWxzZScsICdzZWFyY2hFeGVjdXRlZCc6ICdmYWxzZScsICdzd2RWaXNpdGVkJzogJ2ZhbHNlJywgJ2NvbnRhY3RIUFZpc2l0ZWQnOiAnZmFsc2UnLCAnaWRlbnRpZnlOb3dEbWQnOiAnZmFsc2UnfTsNCiAgICB9DQogICAgZWxzZXsNCiAgICAgICAgaWYobG9jYWxTdG9yYWdlLmRvY3VtZW50Vmlld2VkICE9PSAidHJ1ZSIpew0KICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmRvY3VtZW50Vmlld2VkID0gImZhbHNlIjsNCiAgICAgICAgfQ0KICAgICAgICBpZihsb2NhbFN0b3JhZ2Uuc2VhcmNoRXhlY3V0ZWQgIT09ICJ0cnVlIil7DQogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2VhcmNoRXhlY3V0ZWQgPSAiZmFsc2UiOw0KICAgICAgICB9DQogICAgICAgIGlmKGxvY2FsU3RvcmFnZS5zd2RWaXNpdGVkICE9PSAidHJ1ZSIpew0KICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnN3ZFZpc2l0ZWQgPSAiZmFsc2UiOw0KICAgICAgICB9DQogICAgICAgIGlmKGxvY2FsU3RvcmFnZS5jb250YWN0SFBWaXNpdGVkICE9PSAidHJ1ZSIpew0KICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmNvbnRhY3RIUFZpc2l0ZWQgPSAiZmFsc2UiOw0KICAgICAgICB9DQogICAgICAgIGlmKGxvY2FsU3RvcmFnZS5pZGVudGlmeU5vd0RtZCAhPT0gInRydWUiKXsNCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5pZGVudGlmeU5vd0RtZCA9ICJmYWxzZSI7DQogICAgICAgIH0NCiAgICAgICAgZ2xvYmFsRGF0YUxheWVyLkZsYWcgPSB7J2RvY3VtZW50Vmlld2VkJzogbG9jYWxTdG9yYWdlLmRvY3VtZW50Vmlld2VkLCAnc2VhcmNoRXhlY3V0ZWQnOiBsb2NhbFN0b3JhZ2Uuc2VhcmNoRXhlY3V0ZWQsICdzd2RWaXNpdGVkJzogbG9jYWxTdG9yYWdlLnN3ZFZpc2l0ZWQsICdjb250YWN0SFBWaXNpdGVkJzogbG9jYWxTdG9yYWdlLmNvbnRhY3RIUFZpc2l0ZWQsICdpZGVudGlmeU5vd0RtZCc6IGxvY2FsU3RvcmFnZS5pZGVudGlmeU5vd0RtZH07DQogICAgfSovDQoNCi8qIFRoaXMgc2VjdGlvbiBmZWVkcyBzb21lIHZhbHVlcyBhdmFpbGFibGUgYXQgZG9tLnJlYWR5IHRvIHRoZSBkYXRhbGF5ZXIgKi8NCiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgew0KDQogICAgLy9CYXNlZCBvbiBqU2Vzc2lvbiBpZCB3ZSBtYWludGFpbiB0aGUgc3dTbmlmZmVkT1NzdXBwb3J0ZWQgd2VhdGhlciBpZiBpdCBpcyB0cnVlIG9yIGZsYXNlDQogICAgaWYobG9jYWxTdG9yYWdlLnN3ZE9TU2Vzc2lvbiA9PSAkKCIjalNlc3Npb25JZCIpLnZhbCgpKXsNCiAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnN3U25pZmZlZE9Tc3VwcG9ydGVkID0gbG9jYWxTdG9yYWdlLnN3ZE9TVmFsOw0KICAgIH0NCg0KICAgIHZhciBkYXRhbGF5ZXJDQyA9IGdldENDTEMoJ2NjJyk7DQogICAgdmFyIGRhdGFsYXllckxDID0gZ2V0Q0NMQygnbGMnKTsNCg0KICAgIGlmIChkYXRhbGF5ZXJMQyA9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgZGF0YWxheWVyQ0MgPSAidXMiOw0KICAgICAgICBkYXRhbGF5ZXJMQyA9ICJlbiI7DQoNCiAgICB9DQoNCiAgICAvKiA2ODk3OiBjYWxsZWQgb24gZXZlcnkgcGFnZSBsb2FkIHRvIGRldGVybWluZSBpZiBTZWFyY2ggcmVkaXJlY3QgaGFzIG9jY3VyZWQNCiAgICBTZXNzaW9uIHN0b3JhZ2UgU2VhcmNoIHF1ZXJ5IHdpbGwgYmUgcHJlc2VudCBvbmx5IGZvciByZWRpcmVjdCovDQogICAgZ2V0U2Vzc2lvblN0b3JhZ2VGb3JTZWFyY2goKTsNCg0KICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgiQ291bnRyeUNvZGUiLCBkYXRhbGF5ZXJDQyk7IC8qIEZldGNoZXMgY2MgZnJvbSB0aGUgdXJsIGZvcm1hdDogLmNvbS9jYy1sYy8gKi8NCiAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoIkxhbmd1YWdlQ29kZSIsIGRhdGFsYXllckxDKTsgLyogRmV0Y2hlcyBsYyBmcm9tIHRoZSB1cmwgZm9ybWF0OiAuY29tL2NjLWxjLyAqLw0KICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgiTG9jYWxlIiwgZGF0YWxheWVyQ0MgKyAnLScgKyBkYXRhbGF5ZXJMQyk7DQoNCg0KDQogICAgLy8gRGF0YSBmcm9tIHRoZSBUTVMgU0VTU0lPTiBoaWRkZW4gdmFyaWFibGUNCiAgICB2YXIgdG1zUmVzcG9uc2U7DQogICAgaWYgKCQoJyNwcm9kdWN0QVJyZXNwb25zZScpLmxlbmd0aCA+IDApIHsNCg0KICAgICAgICBpZiAoJCgnI3Byb2R1Y3RBUnJlc3BvbnNlJykudmFsKCkgIT0gIiIpIHsNCiAgICAgICAgICAgIHRtc1Jlc3BvbnNlID0gJCgnI3Byb2R1Y3RBUnJlc3BvbnNlJykudmFsKCk7DQogICAgICAgIH0NCg0KDQogICAgICAgIGlmICh0bXNSZXNwb25zZSAhPSBudWxsICYmIHRtc1Jlc3BvbnNlICE9ICIiICYmIHRtc1Jlc3BvbnNlICE9ICJudWxsIikgew0KICAgICAgICAgICAgdG1zUmVzcG9uc2UgPSBKU09OLnBhcnNlKHRtc1Jlc3BvbnNlKTsNCg0KICAgICAgICAgICAgLy9jaGVjayBUTVMgaGlkZGVuIGZpZWxkIGZvciB2YWx1ZXMNCiAgICAgICAgICAgIC8qICAgIGVnOg0KICAgICAgICAgICAgICJiaWdTZXJpZXNOYW1lIjogIkhQIEVOVlkgMTIwIGUtQWxsLWluLU9uZSBQcmludGVyIHNlcmllcyIsDQogICAgICAgICAgICAgICAgImJpZ1Nlcmllc09pZCI6IDUyMDMyMDYsDQogICAgICAgICAgICAgICAgInN1cHBvcnRDYXRlZ29yeU5hbWUiOiAiTXVsdGlmdW5jdGlvbiBhbmQgQWxsLWluLU9uZSIsDQogICAgICAgICAgICAgICAgInN1cHBvcnRDYXRlZ29yeU9pZCI6IDIzODQ0NSwNCiAgICAgICAgICAgICAgICAic2VyaWVzTmFtZSI6ICJIUCBFTlZZIDEyMCBlLUFsbC1pbi1PbmUgUHJpbnRlciBzZXJpZXMiLA0KICAgICAgICAgICAgICAgICJzZXJpZXNPaWQiOiAiNTIwMzIwOCIsDQogICAgICAgICAgICAgICAgInByb2R1Y3RMaW5lQ29kZSI6ICI1TSIsDQogICAgICAgICAgICAgICAgInN1cHBvcnROYW1lTmFtZSI6ICJIUCBFTlZZIDEyMCBlLUFsbC1pbi1PbmUgUHJpbnRlciIsDQogICAgICAgICAgICAgICAgInN1cHBvcnROYW1lT2lkIjogIjUyMDMyMDkiLA0KICAgICAgICAgICAgICAgICJwbGF0Zm9ybUlkIjogIlNjaG9vbmVyIiwNCiAgICAgICAgICAgICAgICAid2ViUmVsZWFzZURhdGUiOiAiMjAxMjEwMDFUMDA6MDA6MDAiDQogICAgICAgICAgICAqLw0KDQoNCiAgICAgICAgICAgIGlmICh0bXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnYmlnU2VyaWVzTmFtZScpKSB7DQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc2V0VmFsdWUoJ2JpZ1Nlcmllc05hbWUnLCB0bXNSZXNwb25zZVsnYmlnU2VyaWVzTmFtZSddKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIGJpZ1Nlcmllc05hbWUnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdiaWdTZXJpZXNPaWQnKSkgew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnNldFZhbHVlKCdiaWdTZXJpZXNPaWQnLCB0bXNSZXNwb25zZVsnYmlnU2VyaWVzT2lkJ10pOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gYmlnU2VyaWVzT2lkJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICh0bXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncGxhdGZvcm1JZCcpKSB7DQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc2V0VmFsdWUoJ3BsYXRmb3JtSWQnLCB0bXNSZXNwb25zZVsncGxhdGZvcm1JZCddKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIHBsYXRmb3JtSWQnKTsNCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICBpZiAodG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3Byb2R1Y3RMaW5lQ29kZScpKSB7DQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc2V0VmFsdWUoJ3Byb2R1Y3RMaW5lQ29kZScsIHRtc1Jlc3BvbnNlWydwcm9kdWN0TGluZUNvZGUnXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBwcm9kdWN0IHByb2R1Y3RMaW5lQ29kZScpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAodG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3Nlcmllc05hbWUnKSkgew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnNldFZhbHVlKCdzZXJpZXNOYW1lJywgdG1zUmVzcG9uc2VbJ3Nlcmllc05hbWUnXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBwcm9kdWN0IHNlcmllc05hbWUnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdzZXJpZXNPaWQnKSkgew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnNldFZhbHVlKCdzZXJpZXNPaWQnLCB0bXNSZXNwb25zZVsnc2VyaWVzT2lkJ10pOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gcHJvZHVjdCBzZXJpZXNPaWQnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdzdXBwb3J0Q2F0ZWdvcnlOYW1lJykpIHsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnc3VwcG9ydENhdGVnb3J5TmFtZScsIHRtc1Jlc3BvbnNlWydzdXBwb3J0Q2F0ZWdvcnlOYW1lJ10pOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gcHJvZHVjdCBzdXBwb3J0Q2F0ZWdvcnlOYW1lJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICh0bXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnc3VwcG9ydENhdGVnb3J5T2lkJykpIHsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnc3VwcG9ydENhdGVnb3J5T2lkJywgdG1zUmVzcG9uc2VbJ3N1cHBvcnRDYXRlZ29yeU9pZCddKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIHByb2R1Y3Qgc3VwcG9ydENhdGVnb3J5T2lkJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICh0bXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnc3VwcG9ydE5hbWVOYW1lJykpIHsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnc3VwcG9ydE5hbWVOYW1lJywgdG1zUmVzcG9uc2VbJ3N1cHBvcnROYW1lTmFtZSddKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIHByb2R1Y3Qgc3VwcG9ydE5hbWVOYW1lJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICh0bXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnc3VwcG9ydE5hbWVPaWQnKSkgew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnNldFZhbHVlKCdzdXBwb3J0TmFtZU9pZCcsIHRtc1Jlc3BvbnNlWydzdXBwb3J0TmFtZU9pZCddKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIHByb2R1Y3Qgc3VwcG9ydE5hbWVPaWQnKTsNCiAgICAgICAgICAgIH0NCg0KCQkJaWYgKHRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdtb2RlbE51bWJlcicpICYmIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnN1cHBvcnROYW1lT2lkICE9IG51bGwpIHsNCgkJCQ0KCQkJIAl2YXIgY3VycmVudFVybCA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWY7DQoJCQkJaWYgKGN1cnJlbnRVcmwuc2VhcmNoKCdza3U9JykgPiAwKSB7DQoJCQkJCWNvbnNvbGUubG9nKCdTS1UgcGFnZScpOw0KCQkJCQl1cmxTa3VWYWx1ZSA9IGN1cnJlbnRVcmwuc3BsaXQoL3NrdT0vZylbMV0uc3BsaXQoL1wmL2cpWzBdLnNwbGl0KC8jL2cpWzBdOw0KCQkJCQlnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgncHJvZHVjdFNrdU5hbWUnLHVybFNrdVZhbHVlKTsNCgkJCQkJfQ0KCQkJCWVsc2Ugew0KCQkJCQljb25zb2xlLmxvZygnTW9kZWwgcGFnZScpOw0KCQkJCQlnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgncHJvZHVjdFNrdU5hbWUnLG51bGwpOw0KCQkJCX0NCg0KCQkJfWVsc2UgaWYoZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc3VwcG9ydE5hbWVPaWQgPT0gbnVsbCl7DQogICAgICAgICAgICAJY29uc29sZS5sb2coJ1NlcmllcyBwYWdlJyk7DQogICAgICAgICAgICAJZ2xvYmFsRGF0YUxheWVyLlByb2R1Y3Quc2V0VmFsdWUoJ3Byb2R1Y3RTa3VOYW1lJyxudWxsKTsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gcHJvZHVjdCBtb2RlbE51bWJlcicpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAodG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3dlYlJlbGVhc2VEYXRlJykpIHsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdC5zZXRWYWx1ZSgnd2ViUmVsZWFzZURhdGUnLCB0bXNSZXNwb25zZVsnd2ViUmVsZWFzZURhdGUnXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBwcm9kdWN0IHdlYlJlbGVhc2VEYXRlJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICh0bXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnYXVkaWVuY2UnKSkgew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0LnNldFZhbHVlKCdhdWRpZW5jZVR5cGUnLCB0bXNSZXNwb25zZVsnYXVkaWVuY2UnXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBhdWRpZW5jZSB0eXBlJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyB2YWx1ZSBmcm9tIHRtcycpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gRGF0YSBmcm9tIHRoZSBTRUFSQ0ggUFJPRCBJTkZPIGhpZGRlbiB2YXJpYWJsZQ0KICAgIHZhciBzZWFyY2hUbXNSZXNwb25zZTsNCiAgICBpZiAoJCgnI3NlYXJjaFByb2R1Y3RBUnJlc3BvbnNlJykubGVuZ3RoID4gMCkgew0KDQogICAgICAgIGlmICgkKCcjc2VhcmNoUHJvZHVjdEFScmVzcG9uc2UnKS52YWwoKSAhPSAiIikgew0KICAgICAgICAgICAgc2VhcmNoVG1zUmVzcG9uc2UgPSAkKCcjc2VhcmNoUHJvZHVjdEFScmVzcG9uc2UnKS52YWwoKTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgaWYgKHNlYXJjaFRtc1Jlc3BvbnNlICE9IG51bGwgJiYgc2VhcmNoVG1zUmVzcG9uc2UgIT0gIiIgJiYgc2VhcmNoVG1zUmVzcG9uc2UgIT0gIm51bGwiKSB7DQogICAgICAgICAgICBzZWFyY2hUbXNSZXNwb25zZSA9IEpTT04ucGFyc2Uoc2VhcmNoVG1zUmVzcG9uc2UpOw0KDQogICAgICAgICAgICAvL2NoZWNrIFRNUyBoaWRkZW4gZmllbGQgZm9yIHZhbHVlcw0KICAgICAgICAgICAgLyogICAgZWc6DQogICAgICAgICAgICAgImJpZ1Nlcmllc05hbWUiOiAiSFAgRU5WWSAxMjAgZS1BbGwtaW4tT25lIFByaW50ZXIgc2VyaWVzIiwNCiAgICAgICAgICAgICAgICAiYmlnU2VyaWVzT2lkIjogNTIwMzIwNiwNCiAgICAgICAgICAgICAgICAic3VwcG9ydENhdGVnb3J5TmFtZSI6ICJNdWx0aWZ1bmN0aW9uIGFuZCBBbGwtaW4tT25lIiwNCiAgICAgICAgICAgICAgICAic3VwcG9ydENhdGVnb3J5T2lkIjogMjM4NDQ1LA0KICAgICAgICAgICAgICAgICJzZXJpZXNOYW1lIjogIkhQIEVOVlkgMTIwIGUtQWxsLWluLU9uZSBQcmludGVyIHNlcmllcyIsDQogICAgICAgICAgICAgICAgInNlcmllc09pZCI6ICI1MjAzMjA4IiwNCiAgICAgICAgICAgICAgICAicHJvZHVjdExpbmVDb2RlIjogIjVNIiwNCiAgICAgICAgICAgICAgICAic3VwcG9ydE5hbWVOYW1lIjogIkhQIEVOVlkgMTIwIGUtQWxsLWluLU9uZSBQcmludGVyIiwNCiAgICAgICAgICAgICAgICAic3VwcG9ydE5hbWVPaWQiOiAiNTIwMzIwOSIsDQogICAgICAgICAgICAgICAgInBsYXRmb3JtSWQiOiAiU2Nob29uZXIiLA0KICAgICAgICAgICAgICAgICJ3ZWJSZWxlYXNlRGF0ZSI6ICIyMDEyMTAwMVQwMDowMDowMCINCiAgICAgICAgICAgICovDQoNCg0KICAgICAgICAgICAgaWYgKHNlYXJjaFRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdiaWdTZXJpZXNOYW1lJykpIHsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLlByb2R1Y3Quc2V0VmFsdWUoJ2JpZ1Nlcmllc05hbWUnLCBzZWFyY2hUbXNSZXNwb25zZVsnYmlnU2VyaWVzTmFtZSddKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIFNlYXJjaFByb2R1Y3QgYmlnU2VyaWVzTmFtZScpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoc2VhcmNoVG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ2JpZ1Nlcmllc09pZCcpKSB7DQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5Qcm9kdWN0LnNldFZhbHVlKCdiaWdTZXJpZXNPaWQnLCBzZWFyY2hUbXNSZXNwb25zZVsnYmlnU2VyaWVzT2lkJ10pOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gU2VhcmNoUHJvZHVjdCBiaWdTZXJpZXNPaWQnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHNlYXJjaFRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdwbGF0Zm9ybUlkJykpIHsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLlByb2R1Y3Quc2V0VmFsdWUoJ3BsYXRmb3JtSWQnLCBzZWFyY2hUbXNSZXNwb25zZVsncGxhdGZvcm1JZCddKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIFNlYXJjaFByb2R1Y3QgcGxhdGZvcm1JZCcpOw0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAgIGlmIChzZWFyY2hUbXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncHJvZHVjdExpbmVDb2RlJykpIHsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLlByb2R1Y3Quc2V0VmFsdWUoJ3Byb2R1Y3RMaW5lQ29kZScsIHNlYXJjaFRtc1Jlc3BvbnNlWydwcm9kdWN0TGluZUNvZGUnXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBTZWFyY2hQcm9kdWN0IHByb2R1Y3RMaW5lQ29kZScpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoc2VhcmNoVG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3Nlcmllc05hbWUnKSkgew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5TZWFyY2guUHJvZHVjdC5zZXRWYWx1ZSgnc2VyaWVzTmFtZScsIHNlYXJjaFRtc1Jlc3BvbnNlWydzZXJpZXNOYW1lJ10pOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gU2VhcmNoUHJvZHVjdCBzZXJpZXNOYW1lJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChzZWFyY2hUbXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnc2VyaWVzT2lkJykpIHsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLlByb2R1Y3Quc2V0VmFsdWUoJ3Nlcmllc09pZCcsIHNlYXJjaFRtc1Jlc3BvbnNlWydzZXJpZXNPaWQnXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBTZWFyY2hQcm9kdWN0IHNlcmllc09pZCcpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoc2VhcmNoVG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3N1cHBvcnRDYXRlZ29yeU5hbWUnKSkgew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5TZWFyY2guUHJvZHVjdC5zZXRWYWx1ZSgnc3VwcG9ydENhdGVnb3J5TmFtZScsIHNlYXJjaFRtc1Jlc3BvbnNlWydzdXBwb3J0Q2F0ZWdvcnlOYW1lJ10pOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gU2VhcmNoUHJvZHVjdCBzdXBwb3J0Q2F0ZWdvcnlOYW1lJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChzZWFyY2hUbXNSZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnc3VwcG9ydENhdGVnb3J5T2lkJykpIHsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLlByb2R1Y3Quc2V0VmFsdWUoJ3N1cHBvcnRDYXRlZ29yeU9pZCcsIHNlYXJjaFRtc1Jlc3BvbnNlWydzdXBwb3J0Q2F0ZWdvcnlPaWQnXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBTZWFyY2hQcm9kdWN0IHN1cHBvcnRDYXRlZ29yeU9pZCcpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoc2VhcmNoVG1zUmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3N1cHBvcnROYW1lTmFtZScpKSB7DQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5Qcm9kdWN0LnNldFZhbHVlKCdzdXBwb3J0TmFtZU5hbWUnLCBzZWFyY2hUbXNSZXNwb25zZVsnc3VwcG9ydE5hbWVOYW1lJ10pOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gU2VhcmNoUHJvZHVjdCBzdXBwb3J0TmFtZU5hbWUnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHNlYXJjaFRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdzdXBwb3J0TmFtZU9pZCcpKSB7DQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5Qcm9kdWN0LnNldFZhbHVlKCdzdXBwb3J0TmFtZU9pZCcsIHNlYXJjaFRtc1Jlc3BvbnNlWydzdXBwb3J0TmFtZU9pZCddKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIFNlYXJjaFByb2R1Y3Qgc3VwcG9ydE5hbWVPaWQnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHNlYXJjaFRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCd3ZWJSZWxlYXNlRGF0ZScpKSB7DQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5Qcm9kdWN0LnNldFZhbHVlKCd3ZWJSZWxlYXNlRGF0ZScsIHNlYXJjaFRtc1Jlc3BvbnNlWyd3ZWJSZWxlYXNlRGF0ZSddKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIFNlYXJjaFByb2R1Y3Qgd2ViUmVsZWFzZURhdGUnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gVVMgMTgyIDM1IFJlcGxpY2F0ZSBzZWFyY2ggcHJvZHVjdCBkYXRhIGludG8gZ2xvYmFsIGRhdGENCiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5Qcm9kdWN0ID0gZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5Qcm9kdWN0Ow0KICAgICAgICAgICAgLy8gVXBkYXRpbmcgY29udGFjdCBzdXBwb3J0IHVybCB3aXRoIGNvcnJlY3QgcHJvZHVjdCBudW1iZXINCiAgICAgICAgICAgIHZhciBnZGwgPSBnbG9iYWxEYXRhTGF5ZXIuUHJvZHVjdDsgLy8gc2hvcnRoYW5kIGNvbnZpbmllbmNlDQogICAgICAgICAgICB2YXIgc2VyaWVzT3JNb2RlbElkID0gKGdkbC5zZXJpZXNOYW1lT2lkID8gZ2RsLnNlcmllc05hbWVPaWQgOiBnZGwuc2VyaWVzT2lkKTsNCiAgICAgICAgICAgIHVwZGF0ZUNvbnRhY3RTdXBwb3J0VVJMKCIvaHAtcHBzLXNlcnZpY2VzL2h1Yi9uYXZpZ2F0aW9uIiwgc2VyaWVzT3JNb2RlbElkKTsNCg0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIHZhbHVlIGZyb20gc2VhcmNoIHRtcycpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy9EYXRhIGZyb20gU0VBUkNIIElET0wgaGlkZGVuIHZhcmlhYmxlDQogICAgdmFyIHNlYXJjaEFSRGF0YTsNCiAgICAgaWYgKCQoJyNTZWFyY2hBTlInKS5sZW5ndGggPiAwKSB7DQoNCiAgICAgICAgaWYgKCQoJyNTZWFyY2hBTlInKS52YWwoKSAhPSAiIikgew0KICAgICAgICAgICAgc2VhcmNoQVJEYXRhID0gJCgnI1NlYXJjaEFOUicpLnZhbCgpOw0KICAgICAgICB9DQoNCg0KICAgICAgICBpZiAoc2VhcmNoQVJEYXRhICE9IG51bGwgJiYgc2VhcmNoQVJEYXRhICE9ICIiICYmIHNlYXJjaEFSRGF0YSAhPSAibnVsbCIpIHsNCiAgICAgICAgICAgIHNlYXJjaEFSRGF0YSA9IEpTT04ucGFyc2Uoc2VhcmNoQVJEYXRhKQ0KDQogICAgICAgICAgICAvL2NoZWNrICBTRUFSQ0ggSURPTCBoaWRkZW4gZmllbGQgZm9yIHZhbHVlcw0KICAgICAgICAgICAgLyogIGVnOg0KICAgICAgICAgICAgICAgICJwcm9kdWN0TmFtZSI6ICJIUCBFTlZZIDEyMCBlLUFsbC1pbi1PbmUgUHJpbnRlciIsDQogICAgICAgICAgICAgICAgInByb2R1Y3RUTVNPSUQiOiA1MjAzMjA2LA0KICAgICAgICAgICAgICAgICJwcm9kdWN0VE1TQ2xhc3MiOiAicG1fbmFtZV92YWx1ZSINCiAgICAgICAgICAgICovDQoNCiAgICAgICAgICAgIGlmIChzZWFyY2hBUkRhdGEuaGFzT3duUHJvcGVydHkoJ3Byb2R1Y3ROYW1lJykpIHsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLklET0xQcm9kdWN0LnNldFZhbHVlKCdwcm9kdWN0TmFtZScsIHNlYXJjaEFSRGF0YVsncHJvZHVjdE5hbWUnXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBTZWFyY2ggSURPTCBwcm9kdWN0TmFtZScpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGlmIChzZWFyY2hBUkRhdGEuaGFzT3duUHJvcGVydHkoJ3Byb2R1Y3RUTVNPSUQnKSkgew0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5TZWFyY2guSURPTFByb2R1Y3Quc2V0VmFsdWUoJ3Byb2R1Y3RUTVNPSUQnLCBzZWFyY2hBUkRhdGFbJ3Byb2R1Y3RUTVNPSUQnXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBTZWFyY2ggSURPTCBwcm9kdWN0VE1TT0lEJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChzZWFyY2hBUkRhdGEuaGFzT3duUHJvcGVydHkoJ3Byb2R1Y3RUTVNDbGFzcycpKSB7DQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLlNlYXJjaC5JRE9MUHJvZHVjdC5zZXRWYWx1ZSgncHJvZHVjdFRNU0NsYXNzJywgc2VhcmNoQVJEYXRhWydwcm9kdWN0VE1TQ2xhc3MnXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBTZWFyY2ggSURPTCBwcm9kdWN0VE1TQ2xhc3MnKTsNCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gdmFsdWUgZnJvbSBzZWFyY2ggSURPTCcpOw0KICAgICAgICB9DQoNCiAgICB9DQoNCg0KICAgIHZhciBlcnJvcjQwNDsNCiAgICBpZiAobG9jYXRpb24uaHJlZi5pbmRleE9mKCJlcnJvclR5cGU9NDA0Iik+MCkgew0KICAgICAgICBlcnJvcjQwNCA9ICQoJyNlcnJvcjQwNCcpLnZhbCgpOw0KICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ0Vycm9yQ29kZScsICc0MDQnKTsNCiAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdFcnJvcjQwNCcpOw0KDQogICAgfQ0KDQogICAgdmFyIGVycm9yNTAwOw0KICAgIGlmIChsb2NhdGlvbi5ocmVmLmluZGV4T2YoImVycm9yVHlwZT01MDAiKT4wKSB7DQogICAgICAgIGVycm9yNTAwID0gJCgnI2Vycm9yNTAwJykudmFsKCk7DQogICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnRXJyb3JDb2RlJywgJzUwMCcpOw0KICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ0Vycm9yNTAwJyk7DQoNCiAgICB9DQoNCiAgICB2YXIgRW50aXRsZW1lbnRSZXN1bHQ7DQogICAgaWYgKCQoJyNpcFdhcnJhbnR5TGV2ZWwnKS5sZW5ndGggPiAwKSB7DQogICAgICAgIEVudGl0bGVtZW50UmVzdWx0ID0gJCgnI2lwV2FycmFudHlMZXZlbCcpLnZhbCgpOw0KICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuRW50aXRsZW1lbnRSZXN1bHRzLnNldFZhbHVlKCdFbnRSZXN1bHRzJywgRW50aXRsZW1lbnRSZXN1bHQpOw0KDQogICAgfQ0KDQogICAvKiBBZGRpbmcgZG93bmxvYWRlZCBkcml2ZXIgZmlsZSBuYW1lIHRvIGRhdGFsYXllciBmcm9tIHNlc3Npb24gKi8NCiAgICB2YXIgZG93bmxvYWRlZEZpbGVOYW1lID0gKCQoIiNkb3dubG9hZEZpbGVOYW1lIikubGVuZ3RoID4gMCkgPyAkKCIjZG93bmxvYWRGaWxlTmFtZSIpLnZhbCgpIDogIiIgOw0KICAgIGlmIChkb3dubG9hZGVkRmlsZU5hbWUgIT09ICIiICYmIGRvd25sb2FkZWRGaWxlTmFtZSAhPT1udWxsICYmIHR5cGVvZihkb3dubG9hZGVkRmlsZU5hbWUpIT09InVuZGVmaW5lZCIpIHsNCiAgICAJLy8gZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCJzb2Z3YXJlRG93bmxvYWRlZEZpbGVOYW1lIixkb3dubG9hZGVkRmlsZU5hbWUpOw0KICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoInNvZnR3YXJlRG93bmxvYWRlZEZpbGVOYW1lcyIsZG93bmxvYWRlZEZpbGVOYW1lKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBjb25zb2xlLmxvZygnbm8gc29mdHdhcmVEb3dubG9hZGVkRmlsZU5hbWUnKTsNCiAgICB9DQoNCiAgICAvKi0tLS0tLS0tLS0tLS0tVGVtcGxhdGUgU2V0dGluZy0tLS0tLS0tLS0tLS0tLS0tLSovDQogICAgLy9TZXR0aW5nIGRlZmF1bHQgdmFsdWUgb2YgcGFyYW1ldGVycy8vDQogICAgICAgDQogICAgLy9TZXQgdmFsdWVzIGJhc2VkIHNvbGVseSBvbiBwYWdlIG5hbWUNCg0KICAgIHZhciBwYWdlTmFtZSA9ICQoJyNwYWdlSWRlbnRpZmllcicpLnZhbCgpOw0KICAgIHZhciBjdXN0RGV0YWlsUGFnZU5hbWUgPSAkKCcjanNwTmFtZScpLnZhbCgpOw0KICAgIHZhciB1cmw9ZG9jdW1lbnQubG9jYXRpb24uaHJlZjsNCiAgICB2YXIgcHJvZE1vZGVsID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgY3VycmVudFVybCA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWY7DQogICAgICAgIGlmKGN1cnJlbnRVcmwuaW5kZXhPZigiL21vZGVsIikgPiAtMSl7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChjdXN0RGV0YWlsUGFnZU5hbWUgPT0iY3VzdG9tZXJkZXRhaWxzIikgew0KICAgIAlnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ2N1c3RvbWVyZGV0YWlscycpOw0KICAgIH0NCiAgICANCiAgICBpZiAocGFnZU5hbWUgIT0gIiIgJiYgcGFnZU5hbWUgIT0gIm51bGwiICYmIHBhZ2VOYW1lICE9IG51bGwpIHsNCiAgICAJY29uc29sZS5sb2coIj09PT1wYWdlIG5hZSBpcz09PT0iK3BhZ2VOYW1lKTsNCiAgICAJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdQZmluZGVyUXVlcnknLCIiKTsNCiAgICAJaWYocGFnZU5hbWUgIT0gIkNvbmNlbnRyYVdyYXBwZXIiKXsNCiAgICAJCWdsb2JhbERhdGFMYXllci5Eb2N1bWVudC5UTVNDYXRlZ29yaXphdGlvbj0iIjsNCiAgICAJCWdsb2JhbERhdGFMYXllci5Eb2N1bWVudC5jb250ZW50VHlwZT0iIjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFnZU5hbWUgPT0gIlN1cHBvcnQgSG9tZSIpIHsNCg0KICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdTaXRlSG9tZScpOw0KICAgICAgICB9ZWxzZSBpZihwYWdlTmFtZSA9PSAiV2FycmFudHlPbmx5IikgeyAgLy8gd2FycmFudHkgcmVzdWx0cyAtIG5vIHByb2QgaW5mbyBwYWdlDQoNCiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnT1NXYXJyYW50eU9ubHknKTsNCg0KICAgICAgICB9ZWxzZSBpZihwYWdlTmFtZSA9PSAiY2FzZUNyZWF0aW9uIikgeyAgLy9BZGRlZCBhcyBwYXJ0IG9mIDY1ODENCg0KICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdTdWJtaXRDYXNlRm9ybVBhZ2UnKTsNCg0KICAgICAgICB9IGVsc2UgaWYgKHBhZ2VOYW1lID09ICJQcm9kdWN0IEhvbWUiKSB7DQoNCiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnUHJvZHVjdENhdGVnb3J5TGFuZGluZycpOw0KICAgICAgICB9IGVsc2UgaWYgKHBhZ2VOYW1lID09ICJTV0RTZWxmU2VydmljZSIgJiYgZ2xvYmFsRGF0YUxheWVyLlRlbXBsYXRlID09ICIiKSB7DQoNCiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnU1dETGFuZGluZycpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHBhZ2VOYW1lID09ICJDb250YWN0IEhQIC0gQW5vbnltb3VzIikgew0KDQogICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ0NvbnRhY3RIUExhbmRpbmcnKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmKHBhZ2VOYW1lID09ICJTZXJ2aWNlTG9jYXRvciIpew0KICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdTZXJ2aWNlTG9jYXRvcicpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYocGFnZU5hbWUgPT0gIlNlY3VyaXR5QnVsbGV0aW5BcmNoaXZlIil7DQogICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ3NlY3VyaXR5YnVsbGV0aW5hcmNoaXZlJyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZihwYWdlTmFtZSA9PSAibXVsdGlwbGVXYXJyYW50eSIpew0KICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsJ011bHRpcGxlV2FycmFudHlJbnB1dFBhZ2UnKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmKHBhZ2VOYW1lID09ICdBZGQgRGV2aWNlJyl7IC8vQWRpbmcgZm9yIGFkZCBkZXZpY2UgcGFnZQ0KICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCdBZGREZXZpY2UnKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChwYWdlTmFtZSA9PSAiU1dEU2VsZlNlcnZpY2VTdGVwIikgeyAgICAvL1NXRCBDaGFuZ2VzIGdsb2JhbERhdGFMYXllcg0KDQogICAgICAgIAlpZihwcm9kTW9kZWwoKSA9PSB0cnVlKXsNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ1NXRERvd25sb2FkX05ldycpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgIAlnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ1NXRFNlcmllc0Rvd25sb2FkX05ldycpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHBhZ2VOYW1lID09ICJzd2REcml2ZXJEZXRhaWxzIikgeyAgICAvL1NXRCBDaGFuZ2VzIGdsb2JhbERhdGFMYXllcg0KICAgIAkgICBpZihwcm9kTW9kZWwoKSA9PSB0cnVlKXsNCiAgICAgICAgICAgICAgICAvL1NldCBmb3IgbW9kZWwNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ1NXRE1vZGVsRHJpdmVyRGV0YWlsc1BhZ2UnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2V7DQogICAgICAgICAgICAgICAgLy9TZXQgZm9yIHNlcmllcw0KICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnU1dEU2VyaWVzRHJpdmVyRGV0YWlsc1BhZ2UnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAocGFnZU5hbWUgPT0gIlNXRFNlbGZTZXJ2aWNlRmluaXNoIikgew0KLy8gICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ1NXRENsb3N1cmUnKTsNCiAgICAgICAgCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnU1dEQ2xvc3VyZV9OZXcnKTsNCiAgICAgICAgfSAgZWxzZSBpZiAocGFnZU5hbWUgPT0gIkNvbnRhY3QgSFAgUHJvZHVjdCBDb250ZXh0IFZpZXciKSB7DQogICAgICAgICAgICAvKmdsb2JhbERhdGFMYXllci5GbGFnLmNvbnRhY3RIUFZpc2l0ZWQgPSAndHJ1ZSc7DQogICAgICAgICAgICBsb2NhbFN0b3JhZ2UuY29udGFjdEhQVmlzaXRlZCA9ICd0cnVlJzsNCiAgICAgICAgICAgIHRyaWdnZXJMb2NhbFNlc3Npb25UaW1lcigpOyovDQogICAgICAgICAgICAvL3RoaXMgdmFsdWUgaXMgc2V0IG9uIEFKQVggc3VjY2VzcyBpbiBocC1wcm9kdWN0LWNvbnRhY3Qtb3B0aW9ucw0KCSAgICB9IGVsc2UgaWYgKHBhZ2VOYW1lID09ICJTZWFyY2hSZXN1bHQiKSB7DQoJCQkJCQkJaWYgKHVybC5pbmRleE9mKCJjb250YWN0LWhwIikgPiAwKSB7DQoNCgkJCQkJCQkJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdNb2RlbHMnKTsNCg0KCQkJCQkJCQlpZiAoZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpIHsNCgkJCQkJCQkJCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnUGZpbmRlclF1ZXJ5JywNCgkJCQkJCQkJCQkJZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpOw0KCQkJCQkJCQl9DQoNCgkJCQkJCQkJLy8gaWYgYmFkIHJlc3VsdHMgY2hhbmdlIHRoZSBUZW1wbGF0ZU5hbWUNCgkJCQkJCQkJaWYgKCQoJyNwRmluZGVyQmFkUmVzdWx0cycpLmxlbmd0aCA+IDApIHsNCgkJCQkJCQkJCS8vIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLA0KCQkJCQkJCQkJLy8gJ01vZGVsc0JhZFJlc3VsdHMnKTsNCgkJCQkJCQkJfQ0KDQoJCQkJCQkJfSBlbHNlIGlmICh1cmwuaW5kZXhPZigicHJvZHVjdHMiKSA+IDApIHsNCg0KCQkJCQkJCQlnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywNCgkJCQkJCQkJCQknUHJvZHVjdE1vZGVscycpOw0KCQkJCQkJCQlpZiAoZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpIHsNCgkJCQkJCQkJCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnUGZpbmRlclF1ZXJ5JywNCgkJCQkJCQkJCQkJZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpOw0KCQkJCQkJCQl9DQoJCQkJCQkJCS8vIGlmIGJhZCByZXN1bHRzIGNoYW5nZSB0aGUgVGVtcGxhdGVOYW1lDQoJCQkJCQkJCWlmICgkKCcjcEZpbmRlckJhZFJlc3VsdHMnKS5sZW5ndGggPiAwKSB7DQoJCQkJCQkJCQkvLyBnbG9iYWxEYXRhTGF5ZXIuc2VcdFZhbHVlKCdUZW1wbGF0ZScsDQoJCQkJCQkJCQkvLyAnU1dETW9kZWxzQmFkUmVzdWx0cycpOw0KCQkJCQkJCQl9DQoNCgkJCQkJCQl9IGVsc2UgaWYgKHVybC5pbmRleE9mKCJkcml2ZXJzIikgPiAwKSB7DQoNCgkJCQkJCQkJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsDQoJCQkJCQkJCQkJJ1NXRE1vZGVscycpOw0KCQkJCQkJCQlpZiAoZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpIHsNCgkJCQkJCQkJCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnUGZpbmRlclF1ZXJ5JywNCgkJCQkJCQkJCQkJZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpOw0KCQkJCQkJCQl9DQoJCQkJCQkJCS8vIGlmIGJhZCByZXN1bHRzIGNoYW5nZSB0aGUgVGVtcGxhdGVOYW1lDQoJCQkJCQkJCWlmICgkKCcjcEZpbmRlckJhZFJlc3VsdHMnKS5sZW5ndGggPiAwKSB7DQoJCQkJCQkJCQkvLyBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywNCgkJCQkJCQkJCS8vICdTV0RNb2RlbHNCYWRSZXN1bHRzJyk7DQoJCQkJCQkJCX0NCgkJCQkJCQl9IGVsc2Ugew0KDQoJCQkJCQkJCWdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnU2VhcmNoJyk7DQoJCQkJCQkJCWNvbnNvbGUubG9nKCItLS0tcSBpcy0tLSIrZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpOw0KCQkJCQkJCQlpZiAoZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpIHsNCgkJCQkJCQkJCWdsb2JhbERhdGFMYXllci5TZWFyY2guc2V0VmFsdWUoJ1F1ZXJ5JywNCgkJCQkJCQkJCQkJZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpOw0KCQkJCQkJCQl9DQoJCQkJCQkJCS8qDQoJCQkJCQkJCSAqIGdsb2JhbERhdGFMYXllci5GbGFnLnNlYXJjaEV4ZWN1dGVkID0gJ3RydWUnOw0KCQkJCQkJCQkgKiBsb2NhbFN0b3JhZ2Uuc2VhcmNoRXhlY3V0ZWQgPSAndHJ1ZSc7DQoJCQkJCQkJCSAqIHRyaWdnZXJMb2NhbFNlc3Npb25UaW1lcigpOw0KCQkJCQkJCQkgKi8NCgkJCQkJCQl9DQoJCQkJCQl9DQogICAgICAgIGVsc2UgaWYgKHBhZ2VOYW1lID09ICJDb25jZW50cmFXcmFwcGVyIiB8fCBwYWdlTmFtZSA9PSAiQ29uY2VudHJhTm9uQ29udGV4dHVhbCIpIHsNCiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnRG9jdW1lbnQnKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCItLS0tLS0tLS0+IitnZXRQYXJhbWV0ZXJCeU5hbWUoJ3EnKSk7DQogICAgICAgICAgICBpZiAoZ2V0UGFyYW1ldGVyQnlOYW1lKCdxJykpIHsNCgkJCQlnbG9iYWxEYXRhTGF5ZXIuU2VhcmNoLnNldFZhbHVlKCdRdWVyeScsDQoJCQkJCQkiZWMtbG9va3VwIHwgIitnZXRQYXJhbWV0ZXJCeU5hbWUoJ3EnKSk7DQoJCQkJIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnUGZpbmRlclF1ZXJ5JywiZWMtbG9va3VwIHwgIitnZXRQYXJhbWV0ZXJCeU5hbWUoJ3EnKSk7DQoJCQl9DQogICAgICAgICAgICAvKmdsb2JhbERhdGFMYXllci5GbGFnLmRvY3VtZW50Vmlld2VkID0gJ3RydWUnOw0KICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmRvY3VtZW50Vmlld2VkID0gJ3RydWUnOw0KICAgICAgICAgICAgdHJpZ2dlckxvY2FsU2Vzc2lvblRpbWVyKCk7Ki8NCg0KICAgICAgICB9IGVsc2UgaWYgKHBhZ2VOYW1lID09ICJQcm9kdWN0IERldGFpbHMgUGFnZSIgfHwgcGFnZU5hbWUgPT0gIlByb2R1Y3QgRGV0YWlscyBQYWdlIikgew0KICAgICAgICAgICAgaWYgKHRtc1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdzdXBwb3J0TmFtZU9pZCcpKSB7DQogICAgICAgICAgICAgICAgaWYgKHRtc1Jlc3BvbnNlWydzdXBwb3J0TmFtZU9pZCddICE9IG51bGwgJiYgdG1zUmVzcG9uc2VbJ3N1cHBvcnROYW1lT2lkJ10gIT0gJ251bGwnICYmIHRtc1Jlc3BvbnNlWydzdXBwb3J0TmFtZU9pZCddICE9ICcnKSB7DQogICAgICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnUHJvZHVjdE1vZGVsJyk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdQcm9kdWN0U2VyaWVzJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKHBhZ2VOYW1lID09ICJEaXNwdXRlRm9ybSIpIHsNCg0KICAgICAgICAgICAgaWYoJCgnI3dhcnJhbnR5RGlzcHV0ZUZvcm0nKS5sZW5ndGg+MCl7DQoNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ0Rpc3B1dGVXYXJyYW50eUZvcm0nKTsNCg0KICAgICAgICAgICAgfSBlbHNlew0KDQogICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdEaXNwdXRlV2FycmFudHlDb25maXJtYXRpb24nKTsNCg0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgfSBlbHNlIGlmIChwYWdlTmFtZSA9PSAiUmVtb3RlQ29ubmVjdGlvbiIpIHsNCg0KICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdSZW1vdGVBc3Npc3RhbmNlJyk7DQoNCiAgICAgICAgfSBlbHNlIGlmIChwYWdlTmFtZSA9PSAiV2FycmFudHkgQ2hlY2siKSB7DQoNCiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnV2FycmFudHlMYW5kaW5nJyk7DQoNCiAgICAgICAgfSBlbHNlIGlmIChwYWdlTmFtZSA9PSAiUHJvZHVjdCBXYXJyYW50eSBSZXN1bHQiKSB7DQoNCiAgICAgICAgICAgIGlmKCQoJyN3YXJyYW50eVN0YXR1cycpLmxlbmd0aD4wKXsNCiAgICAgICAgICAgICAgICB2YXIgd1N0YXR1cyA9ICQoJyN3YXJyYW50eVN0YXR1cycpLnZhbCgpOw0KICAgICAgICAgICAgICAgIHN3aXRjaCh3U3RhdHVzKXsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnSVcnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnSVdSZXN1bHRzJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ09XJzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ09PV1Jlc3VsdHMnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnWFcnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnWFdSZXN1bHRzJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB9IGVsc2V7DQoNCiAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ09PV1Jlc3VsdHMnKTsNCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgIH0gZWxzZSBpZiAocGFnZU5hbWUgPT0gIlVua25vd24gV2FycmFudHkiKSB7DQoNCg0KICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdVV1Jlc3VsdHMnKTsNCg0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYocGFnZU5hbWUgPT0gIm11bHRpcGxlV2FycmFudHkiKXsNCiAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCdNdWx0aXBsZVdhcnJhbnR5SW5wdXRQYWdlJykNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChwYWdlTmFtZSA9PSAiSGlzdG9yaWNhbCBQcm9kdWN0cyIpIHsNCg0KDQogICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ0hpc3RvcmljYWxQcm9kdWN0c0xhbmRpbmcnKTsNCg0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHBhZ2VOYW1lID09ICJNZWRpYU9yZGVyaW5nIikgew0KICAgICAgICAgICAgdmFyIHN0ZXBzdmFsdWUgPSAkKCcuc3RlcHNfbWVkaWEnKS52YWwoKSA7DQogICAgICAgICAgICBzd2l0Y2goc3RlcHN2YWx1ZSl7DQogICAgICAgICAgICAgICAgY2FzZSAic3RlcDEiOg0KICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdNZWRpYUN1c3RvbWVySW5mb3JtYXRpb24nKTsNCiAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgInN0ZXAyIjoNCiAgICAgICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCAnTWVkaWFTaGlwcGluZ0luZm9ybWF0aW9uJyk7DQogICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlICJzdGVwMyI6DQogICAgICAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ01lZGlhQmlsbGluZ0luZm9ybWF0aW9uJyk7DQogICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlICJzdGVwNCI6DQogICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdNZWRpYVBheW1lbnRJbmZvcm1hdGlvbicpOw0KICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgInN0ZXA1IjoNCiAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdNZWRpYU9yZGVyQ29uZmlybWF0aW9uJyk7DQoNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgfSBlbHNlIGlmIChwYWdlTmFtZSA9PSAicHJvZHVjdHJlcGxhY2VtZW50Iikgew0KICAgICAgICAJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdwcm9kdWN0cmVwbGFjZW1lbnQnKTsNCiAgICAgICAgfSBlbHNlIGlmIChwYWdlTmFtZSA9PSAib3JkZXJjb25maXJtYXRpb24iKSB7DQogICAgICAgIAlnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ29yZGVyY29uZmlybWF0aW9uJyk7DQogICAgICAgIH0NCiAgICAgICAgLy9lcnJvciBwYWdlDQogICAgICAgIGVsc2UgaWYocGFnZU5hbWUgPT0gIkVycm9yIFBhZ2UiKXsNCiAgICAgICAgICAgIHZhciBlcnJvcnZhbHVlID0gJCgnLm1lZGlhZXJyb3InKS52YWwoKSB8IDAgOw0KICAgICAgICAgICAgdmFyIHByb2R1Y3RSZXBsYWNlbWVudEVycm9yVmFsdWUgPSAkKCcjcHJvZHVjdHJlcGxhY2VtZW50ZXJyb3InKS52YWwoKSB8IDAgOw0KICAgICAgICAgICAgc3dpdGNoKGVycm9ydmFsdWUpew0KICAgICAgICAgICAgICAgIGNhc2UgMToNCiAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ01lZGlhTm90T3JkZXJhYmxlJyk7DQogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAyOg0KICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbERhdGFMYXllci5zZXRWYWx1ZSgnVGVtcGxhdGUnLCdNZWRpYUxpbWl0UmVhY2hlZCcpOw0KICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgMzoNCiAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywnTWVkaWFQYXltZW50RmFpbGVkJyk7DQogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzd2l0Y2gocHJvZHVjdFJlcGxhY2VtZW50RXJyb3JWYWx1ZSl7DQoJICAgICAgICAgICAgY2FzZSAxOg0KCSAgICAgICAgICAJICAJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdJbmVsaWdpYmxlUHJvZHVjdCcpOw0KCSAgICAgICAgICAJICAJYnJlYWs7DQoJICAgICAgICAgICAgY2FzZSAyOg0KCSAgICAgICAgICAJICAJZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdTdWJtaXNzaW9uRmFpbGVkJyk7DQoJICAgICAgICAgICAgCWJyZWFrOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICB9DQoNCiAgICAgICAgIGVsc2UgaWYocGFnZU5hbWUgPT0gIklkZW50aWZ5UHJvZHVjdCIpew0KICAgICAgICAgICAgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdDaGFuZ2VQcm9kdWN0Jyk7DQogICAgICAgICB9DQogICAgICAgICBlbHNlIGlmKHBhZ2VOYW1lID09ICJTV0RwZmluZGVyQmFkUmVzdWx0cyIpeyAgLy9BZGRlZCBhcyBwYXJ0IG9mIDY1MzkNCg0KICAgICAgICAgICAgaWYgKHVybC5pbmRleE9mKCJjb250YWN0LWhwIikgPiAwKSB7DQoNCiAgICAgICAgICAgIAlnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywgJ0NvbnRhY3RIUEJhZFJlc3VsdHMnKTsNCg0KCQkJfSBlbHNlIGlmICh1cmwuaW5kZXhPZigicHJvZHVjdHMiKSA+IDApIHsNCgkJCQkgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdQRFBCYWRSZXN1bHRzJyk7DQoNCgkJCX0gZWxzZSBpZiAodXJsLmluZGV4T2YoImRyaXZlcnMiKSA+IDApIHsNCgkJCQkgZ2xvYmFsRGF0YUxheWVyLnNldFZhbHVlKCdUZW1wbGF0ZScsICdTV0RCYWRSZXN1bHRzJyk7DQoNCgkJCX0NCiAgICAgICAgIH0NCiAgICAgICAgIGVsc2UgaWYgKHBhZ2VOYW1lID09ICJwcm9kdWN0SWRlbnRpZmljYXRpb24iKXsNCiAgICAgICAgICAgICBnbG9iYWxEYXRhTGF5ZXIuc2V0VmFsdWUoJ1RlbXBsYXRlJywnRE1EJyk7DQogICAgICAgICB9DQogICAgfQ0KDQogICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KfSk7DQoNCmNsZWFyTG9jYWxTdG9yYWdlRUFTKCk7DQoNCmZ1bmN0aW9uIGNsZWFyTG9jYWxTdG9yYWdlRUFTKCl7DQoJaWYobG9jYWxTdG9yYWdlLmVhc1N0YXJ0VGltZSl7DQoJdmFyIGluaXRpYWxUaW1lID0gcGFyc2VJbnQobG9jYWxTdG9yYWdlLmVhc1N0YXJ0VGltZSk7DQoJdmFyIGV4cGlyYXlEdXJhdGlvbiA9IDYwKjYwKjEwMDA7DQoJdmFyIGN1cnJlbnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQoJCWlmKGN1cnJlbnRUaW1lIC0gaW5pdGlhbFRpbWUgPj0gZXhwaXJheUR1cmF0aW9uKXsNCgkJCWxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJ1c2VyRUFTSW5mbyIpOw0KCQl9DQoJfQ0KfQ0KCn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30KdHJ5ey8qKgogKiBUaGlzIGZ1bmN0aW9uIHdpbGwgaXRlcmF0ZSBvdmVyIGFsbAogKiBBRFggZW5kcG9pbnRzIGFuZCBhcHBlbmQgc2Vzc2lvbiBkYXRhCiAqIGxpa2Ugc2VyaWFsIG51bWJlciBhbmQgc2t1IGlmIGF2YWlsYWJsZQogKiAKICogQGF1dGhvciBhcmthc2luaGEKICogQHNpbmNlIENvbW1lcmNpYWwgUjIuMAogKi8KZnVuY3Rpb24gYXBwZW5kU2Vzc2lvbkRhdGFUb0FkeEVuZHBvaW50cygpewoJCgkkKCcubG9naW4tcmVxdWlyZWQnKS5lYWNoKGZ1bmN0aW9uKGksIG9iaikgewoJCQoJCXZhciB1cmwgPSAkKG9iaikuYXR0cigiaHJlZiIpOwoJCXZhciBxdWVyeVBhcmFtUHJlZml4ID0gbnVsbDsKCQkKCQkvLyB0aGVyZSBpcyBhIFVSTCBpbiBwbGFjZSBhbHJlYWR5CgkgICAgaWYodXJsICE9IHVuZGVmaW5lZCAmJiB1cmwgIT0gJycpewoJICAgIAkKCSAgICAJLy8gdGhlIFVSTCBhbHJlYWR5IGhhcyBxdWVyeSBwYXJhbShzKQoJICAgIAlpZih1cmwuaW5kZXhPZigiPyIpPj0wKXsKCSAgICAJCXF1ZXJ5UGFyYW1QcmVmaXggPSAiJiI7CgkgICAgCX1lbHNlIHsKCSAgICAJCXF1ZXJ5UGFyYW1QcmVmaXggPSAiPyIKCSAgICAJfQoJICAgIAkKCSAgICAJLy8gYXBwZW5kIHNlcmlhbCBudW1iZXIKCSAgICAJaWYoJCgiI3NlcmlhbE51bWJlckZyb21TZXNzaW9uIikudmFsKCkgIT0gdW5kZWZpbmVkICYmICQoIiNzZXJpYWxOdW1iZXJGcm9tU2Vzc2lvbiIpLnZhbCgpICE9ICcnCgkgICAgCQkgJiYgdXJsLmluZGV4T2YoImFpbmZvIikgPCAwKSB7CgkgICAgCQl1cmwgKz0gcXVlcnlQYXJhbVByZWZpeCArICJhaW5mbz0iKyQoIiNzZXJpYWxOdW1iZXJGcm9tU2Vzc2lvbiIpLnZhbCgpOwoJICAgIAkJCgkgICAgCQkvLyBmb3IgYWxsIG90aGVyIHBhcmFtcwoJICAgIAkJcXVlcnlQYXJhbVByZWZpeCA9ICImIjsKCSAgICAJfQkgICAgCgkgICAgfQoJICAgIAoJICAgIC8vIHNldCB0aGUgbW9kaWZpZWQgdXJsCgkgICAgJChvYmopLmF0dHIoImhyZWYiLHVybCk7CgkgICAgCgl9KTsKfQoKLyoqCiAqIFRoaXMgZnVuY3Rpb24gd2lsbCBhcHBlbmQgc2Vzc2lvbiBkYXRhCiAqIHRvIHRoZSBwcm92aWRlZCB1cmwgbGlrZSBzZXJpYWwgbnVtYmVyIAogKiBhbmQgc2t1IGlmIGF2YWlsYWJsZQogKiAKICogQGF1dGhvciBhcmthc2luaGEKICogQHNpbmNlIENvbW1lcmNpYWwgUjIuMAogKi8KZnVuY3Rpb24gYWRkU2VyaWFsTnVtYmVyQW5kU2t1KHVybCl7Cgl0cnl7CgkJLy8gYWRkaW5nIHNlcmlhbCBudW1iZXIgaWYgYXZhaWxhYmxlIGFuZCBpZiBub3QgYXBwZW5kZWQgYWxyZWFkeQoJCWlmKCQoIiNzZXJpYWxOdW1iZXJGcm9tU2Vzc2lvbiIpLnZhbCgpICE9IHVuZGVmaW5lZCAmJiAkKCIjc2VyaWFsTnVtYmVyRnJvbVNlc3Npb24iKS52YWwoKSAhPSAnJwoJCQkgJiYgdXJsLmluZGV4T2YoImFpbmZvIikgPCAwKXsKCQkJCgkJCS8vIGlzIHRoaXMgdGhlIGZpcnN0IHBhcmFtPwoJCQlpZih1cmwuaW5kZXhPZigiPyIpPj0wKXsKCQkJCXVybCs9IiZhaW5mbz0iKyQoIiNzZXJpYWxOdW1iZXJGcm9tU2Vzc2lvbiIpLnZhbCgpOwoJCQl9ZWxzZSB7CgkJCQl1cmwrPSI/YWluZm89IiskKCIjc2VyaWFsTnVtYmVyRnJvbVNlc3Npb24iKS52YWwoKTsKCQkJfQoJCX0KCX0gY2F0Y2ggKCBlICkgewoJCWNvbnNvbGUubG9nKCJlcnJvciBpbiBhZHhOYXZnaWF0aW9uLmpzLCBhZGRTZXJpYWxOdW1iZXJBbmRTa3UiK2UpOwoJfQoJcmV0dXJuIHVybDsKfQp9Y2F0Y2goZSl7Y29uc29sZS5sb2coIk1vZHVsZSAnaHBTdHlsZVIyJzogIixlKTt9CnRyeXsvKiEKCiBoYW5kbGViYXJzIHY0LjAuNQoKQ29weXJpZ2h0IChDKSAyMDExLTIwMTUgYnkgWWVodWRhIEthdHoKClBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwp0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwpmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoKVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgpUSEUgU09GVFdBUkUuCgpAbGljZW5zZQoqLwooZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkgewoJaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKQoJCW1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwoJZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpCgkJZGVmaW5lKFtdLCBmYWN0b3J5KTsKCWVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKQoJCWV4cG9ydHNbIkhhbmRsZWJhcnMiXSA9IGZhY3RvcnkoKTsKCWVsc2UKCQlyb290WyJIYW5kbGViYXJzIl0gPSBmYWN0b3J5KCk7Cn0pKHRoaXMsIGZ1bmN0aW9uKCkgewpyZXR1cm4gLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcAovKioqKioqLyAJLy8gVGhlIG1vZHVsZSBjYWNoZQovKioqKioqLyAJdmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTsKCi8qKioqKiovIAkvLyBUaGUgcmVxdWlyZSBmdW5jdGlvbgovKioqKioqLyAJZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgewoKLyoqKioqKi8gCQkvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGUKLyoqKioqKi8gCQlpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkKLyoqKioqKi8gCQkJcmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7CgovKioqKioqLyAJCS8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpCi8qKioqKiovIAkJdmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0gewovKioqKioqLyAJCQlleHBvcnRzOiB7fSwKLyoqKioqKi8gCQkJaWQ6IG1vZHVsZUlkLAovKioqKioqLyAJCQlsb2FkZWQ6IGZhbHNlCi8qKioqKiovIAkJfTsKCi8qKioqKiovIAkJLy8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uCi8qKioqKiovIAkJbW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7CgovKioqKioqLyAJCS8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWQKLyoqKioqKi8gCQltb2R1bGUubG9hZGVkID0gdHJ1ZTsKCi8qKioqKiovIAkJLy8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGUKLyoqKioqKi8gCQlyZXR1cm4gbW9kdWxlLmV4cG9ydHM7Ci8qKioqKiovIAl9CgoKLyoqKioqKi8gCS8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzOwoKLyoqKioqKi8gCS8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzOwoKLyoqKioqKi8gCS8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSAiIjsKCi8qKioqKiovIAkvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHMKLyoqKioqKi8gCXJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApOwovKioqKioqLyB9KQovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKioqKioqLyAoWwovKiAwICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCSd1c2Ugc3RyaWN0JzsKCgl2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18oMSlbJ2RlZmF1bHQnXTsKCglleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKCXZhciBfaGFuZGxlYmFyc1J1bnRpbWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOwoKCXZhciBfaGFuZGxlYmFyc1J1bnRpbWUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaGFuZGxlYmFyc1J1bnRpbWUpOwoKCS8vIENvbXBpbGVyIGltcG9ydHMKCgl2YXIgX2hhbmRsZWJhcnNDb21waWxlckFzdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjEpOwoKCXZhciBfaGFuZGxlYmFyc0NvbXBpbGVyQXN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2hhbmRsZWJhcnNDb21waWxlckFzdCk7CgoJdmFyIF9oYW5kbGViYXJzQ29tcGlsZXJCYXNlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMik7CgoJdmFyIF9oYW5kbGViYXJzQ29tcGlsZXJDb21waWxlciA9IF9fd2VicGFja19yZXF1aXJlX18oMjcpOwoKCXZhciBfaGFuZGxlYmFyc0NvbXBpbGVySmF2YXNjcmlwdENvbXBpbGVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOCk7CgoJdmFyIF9oYW5kbGViYXJzQ29tcGlsZXJKYXZhc2NyaXB0Q29tcGlsZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaGFuZGxlYmFyc0NvbXBpbGVySmF2YXNjcmlwdENvbXBpbGVyKTsKCgl2YXIgX2hhbmRsZWJhcnNDb21waWxlclZpc2l0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI1KTsKCgl2YXIgX2hhbmRsZWJhcnNDb21waWxlclZpc2l0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaGFuZGxlYmFyc0NvbXBpbGVyVmlzaXRvcik7CgoJdmFyIF9oYW5kbGViYXJzTm9Db25mbGljdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjApOwoKCXZhciBfaGFuZGxlYmFyc05vQ29uZmxpY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaGFuZGxlYmFyc05vQ29uZmxpY3QpOwoKCXZhciBfY3JlYXRlID0gX2hhbmRsZWJhcnNSdW50aW1lMlsnZGVmYXVsdCddLmNyZWF0ZTsKCWZ1bmN0aW9uIGNyZWF0ZSgpIHsKCSAgdmFyIGhiID0gX2NyZWF0ZSgpOwoKCSAgaGIuY29tcGlsZSA9IGZ1bmN0aW9uIChpbnB1dCwgb3B0aW9ucykgewoJICAgIHJldHVybiBfaGFuZGxlYmFyc0NvbXBpbGVyQ29tcGlsZXIuY29tcGlsZShpbnB1dCwgb3B0aW9ucywgaGIpOwoJICB9OwoJICBoYi5wcmVjb21waWxlID0gZnVuY3Rpb24gKGlucHV0LCBvcHRpb25zKSB7CgkgICAgcmV0dXJuIF9oYW5kbGViYXJzQ29tcGlsZXJDb21waWxlci5wcmVjb21waWxlKGlucHV0LCBvcHRpb25zLCBoYik7CgkgIH07CgoJICBoYi5BU1QgPSBfaGFuZGxlYmFyc0NvbXBpbGVyQXN0MlsnZGVmYXVsdCddOwoJICBoYi5Db21waWxlciA9IF9oYW5kbGViYXJzQ29tcGlsZXJDb21waWxlci5Db21waWxlcjsKCSAgaGIuSmF2YVNjcmlwdENvbXBpbGVyID0gX2hhbmRsZWJhcnNDb21waWxlckphdmFzY3JpcHRDb21waWxlcjJbJ2RlZmF1bHQnXTsKCSAgaGIuUGFyc2VyID0gX2hhbmRsZWJhcnNDb21waWxlckJhc2UucGFyc2VyOwoJICBoYi5wYXJzZSA9IF9oYW5kbGViYXJzQ29tcGlsZXJCYXNlLnBhcnNlOwoKCSAgcmV0dXJuIGhiOwoJfQoKCXZhciBpbnN0ID0gY3JlYXRlKCk7CglpbnN0LmNyZWF0ZSA9IGNyZWF0ZTsKCglfaGFuZGxlYmFyc05vQ29uZmxpY3QyWydkZWZhdWx0J10oaW5zdCk7CgoJaW5zdC5WaXNpdG9yID0gX2hhbmRsZWJhcnNDb21waWxlclZpc2l0b3IyWydkZWZhdWx0J107CgoJaW5zdFsnZGVmYXVsdCddID0gaW5zdDsKCglleHBvcnRzWydkZWZhdWx0J10gPSBpbnN0OwoJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiAxICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKCSJ1c2Ugc3RyaWN0IjsKCglleHBvcnRzWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiAob2JqKSB7CgkgIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CgkgICAgImRlZmF1bHQiOiBvYmoKCSAgfTsKCX07CgoJZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCi8qKiovIH0sCi8qIDIgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoJJ3VzZSBzdHJpY3QnOwoKCXZhciBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCA9IF9fd2VicGFja19yZXF1aXJlX18oMylbJ2RlZmF1bHQnXTsKCgl2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18oMSlbJ2RlZmF1bHQnXTsKCglleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKCXZhciBfaGFuZGxlYmFyc0Jhc2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpOwoKCXZhciBiYXNlID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQoX2hhbmRsZWJhcnNCYXNlKTsKCgkvLyBFYWNoIG9mIHRoZXNlIGF1Z21lbnQgdGhlIEhhbmRsZWJhcnMgb2JqZWN0LiBObyBuZWVkIHRvIHNldHVwIGhlcmUuCgkvLyAoVGhpcyBpcyBkb25lIHRvIGVhc2lseSBzaGFyZSBjb2RlIGJldHdlZW4gY29tbW9uanMgYW5kIGJyb3dzZSBlbnZzKQoKCXZhciBfaGFuZGxlYmFyc1NhZmVTdHJpbmcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4KTsKCgl2YXIgX2hhbmRsZWJhcnNTYWZlU3RyaW5nMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2hhbmRsZWJhcnNTYWZlU3RyaW5nKTsKCgl2YXIgX2hhbmRsZWJhcnNFeGNlcHRpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOwoKCXZhciBfaGFuZGxlYmFyc0V4Y2VwdGlvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9oYW5kbGViYXJzRXhjZXB0aW9uKTsKCgl2YXIgX2hhbmRsZWJhcnNVdGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgoJdmFyIFV0aWxzID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQoX2hhbmRsZWJhcnNVdGlscyk7CgoJdmFyIF9oYW5kbGViYXJzUnVudGltZSA9IF9fd2VicGFja19yZXF1aXJlX18oMTkpOwoKCXZhciBydW50aW1lID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQoX2hhbmRsZWJhcnNSdW50aW1lKTsKCgl2YXIgX2hhbmRsZWJhcnNOb0NvbmZsaWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMCk7CgoJdmFyIF9oYW5kbGViYXJzTm9Db25mbGljdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9oYW5kbGViYXJzTm9Db25mbGljdCk7CgoJLy8gRm9yIGNvbXBhdGliaWxpdHkgYW5kIHVzYWdlIG91dHNpZGUgb2YgbW9kdWxlIHN5c3RlbXMsIG1ha2UgdGhlIEhhbmRsZWJhcnMgb2JqZWN0IGEgbmFtZXNwYWNlCglmdW5jdGlvbiBjcmVhdGUoKSB7CgkgIHZhciBoYiA9IG5ldyBiYXNlLkhhbmRsZWJhcnNFbnZpcm9ubWVudCgpOwoKCSAgVXRpbHMuZXh0ZW5kKGhiLCBiYXNlKTsKCSAgaGIuU2FmZVN0cmluZyA9IF9oYW5kbGViYXJzU2FmZVN0cmluZzJbJ2RlZmF1bHQnXTsKCSAgaGIuRXhjZXB0aW9uID0gX2hhbmRsZWJhcnNFeGNlcHRpb24yWydkZWZhdWx0J107CgkgIGhiLlV0aWxzID0gVXRpbHM7CgkgIGhiLmVzY2FwZUV4cHJlc3Npb24gPSBVdGlscy5lc2NhcGVFeHByZXNzaW9uOwoKCSAgaGIuVk0gPSBydW50aW1lOwoJICBoYi50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChzcGVjKSB7CgkgICAgcmV0dXJuIHJ1bnRpbWUudGVtcGxhdGUoc3BlYywgaGIpOwoJICB9OwoKCSAgcmV0dXJuIGhiOwoJfQoKCXZhciBpbnN0ID0gY3JlYXRlKCk7CglpbnN0LmNyZWF0ZSA9IGNyZWF0ZTsKCglfaGFuZGxlYmFyc05vQ29uZmxpY3QyWydkZWZhdWx0J10oaW5zdCk7CgoJaW5zdFsnZGVmYXVsdCddID0gaW5zdDsKCglleHBvcnRzWydkZWZhdWx0J10gPSBpbnN0OwoJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiAzICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKCSJ1c2Ugc3RyaWN0IjsKCglleHBvcnRzWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiAob2JqKSB7CgkgIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKCSAgICByZXR1cm4gb2JqOwoJICB9IGVsc2UgewoJICAgIHZhciBuZXdPYmogPSB7fTsKCgkgICAgaWYgKG9iaiAhPSBudWxsKSB7CgkgICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CgkgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSBuZXdPYmpba2V5XSA9IG9ialtrZXldOwoJICAgICAgfQoJICAgIH0KCgkgICAgbmV3T2JqWyJkZWZhdWx0Il0gPSBvYmo7CgkgICAgcmV0dXJuIG5ld09iajsKCSAgfQoJfTsKCglleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKLyoqKi8gfSwKLyogNCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCgkndXNlIHN0cmljdCc7CgoJdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpWydkZWZhdWx0J107CgoJZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCWV4cG9ydHMuSGFuZGxlYmFyc0Vudmlyb25tZW50ID0gSGFuZGxlYmFyc0Vudmlyb25tZW50OwoKCXZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOwoKCXZhciBfZXhjZXB0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCgl2YXIgX2V4Y2VwdGlvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9leGNlcHRpb24pOwoKCXZhciBfaGVscGVycyA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7CgoJdmFyIF9kZWNvcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7CgoJdmFyIF9sb2dnZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3KTsKCgl2YXIgX2xvZ2dlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9sb2dnZXIpOwoKCXZhciBWRVJTSU9OID0gJzQuMC41JzsKCWV4cG9ydHMuVkVSU0lPTiA9IFZFUlNJT047Cgl2YXIgQ09NUElMRVJfUkVWSVNJT04gPSA3OwoKCWV4cG9ydHMuQ09NUElMRVJfUkVWSVNJT04gPSBDT01QSUxFUl9SRVZJU0lPTjsKCXZhciBSRVZJU0lPTl9DSEFOR0VTID0gewoJICAxOiAnPD0gMS4wLnJjLjInLCAvLyAxLjAucmMuMiBpcyBhY3R1YWxseSByZXYyIGJ1dCBkb2Vzbid0IHJlcG9ydCBpdAoJICAyOiAnPT0gMS4wLjAtcmMuMycsCgkgIDM6ICc9PSAxLjAuMC1yYy40JywKCSAgNDogJz09IDEueC54JywKCSAgNTogJz09IDIuMC4wLWFscGhhLngnLAoJICA2OiAnPj0gMi4wLjAtYmV0YS4xJywKCSAgNzogJz49IDQuMC4wJwoJfTsKCglleHBvcnRzLlJFVklTSU9OX0NIQU5HRVMgPSBSRVZJU0lPTl9DSEFOR0VTOwoJdmFyIG9iamVjdFR5cGUgPSAnW29iamVjdCBPYmplY3RdJzsKCglmdW5jdGlvbiBIYW5kbGViYXJzRW52aXJvbm1lbnQoaGVscGVycywgcGFydGlhbHMsIGRlY29yYXRvcnMpIHsKCSAgdGhpcy5oZWxwZXJzID0gaGVscGVycyB8fCB7fTsKCSAgdGhpcy5wYXJ0aWFscyA9IHBhcnRpYWxzIHx8IHt9OwoJICB0aGlzLmRlY29yYXRvcnMgPSBkZWNvcmF0b3JzIHx8IHt9OwoKCSAgX2hlbHBlcnMucmVnaXN0ZXJEZWZhdWx0SGVscGVycyh0aGlzKTsKCSAgX2RlY29yYXRvcnMucmVnaXN0ZXJEZWZhdWx0RGVjb3JhdG9ycyh0aGlzKTsKCX0KCglIYW5kbGViYXJzRW52aXJvbm1lbnQucHJvdG90eXBlID0gewoJICBjb25zdHJ1Y3RvcjogSGFuZGxlYmFyc0Vudmlyb25tZW50LAoKCSAgbG9nZ2VyOiBfbG9nZ2VyMlsnZGVmYXVsdCddLAoJICBsb2c6IF9sb2dnZXIyWydkZWZhdWx0J10ubG9nLAoKCSAgcmVnaXN0ZXJIZWxwZXI6IGZ1bmN0aW9uIHJlZ2lzdGVySGVscGVyKG5hbWUsIGZuKSB7CgkgICAgaWYgKF91dGlscy50b1N0cmluZy5jYWxsKG5hbWUpID09PSBvYmplY3RUeXBlKSB7CgkgICAgICBpZiAoZm4pIHsKCSAgICAgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ0FyZyBub3Qgc3VwcG9ydGVkIHdpdGggbXVsdGlwbGUgaGVscGVycycpOwoJICAgICAgfQoJICAgICAgX3V0aWxzLmV4dGVuZCh0aGlzLmhlbHBlcnMsIG5hbWUpOwoJICAgIH0gZWxzZSB7CgkgICAgICB0aGlzLmhlbHBlcnNbbmFtZV0gPSBmbjsKCSAgICB9CgkgIH0sCgkgIHVucmVnaXN0ZXJIZWxwZXI6IGZ1bmN0aW9uIHVucmVnaXN0ZXJIZWxwZXIobmFtZSkgewoJICAgIGRlbGV0ZSB0aGlzLmhlbHBlcnNbbmFtZV07CgkgIH0sCgoJICByZWdpc3RlclBhcnRpYWw6IGZ1bmN0aW9uIHJlZ2lzdGVyUGFydGlhbChuYW1lLCBwYXJ0aWFsKSB7CgkgICAgaWYgKF91dGlscy50b1N0cmluZy5jYWxsKG5hbWUpID09PSBvYmplY3RUeXBlKSB7CgkgICAgICBfdXRpbHMuZXh0ZW5kKHRoaXMucGFydGlhbHMsIG5hbWUpOwoJICAgIH0gZWxzZSB7CgkgICAgICBpZiAodHlwZW9mIHBhcnRpYWwgPT09ICd1bmRlZmluZWQnKSB7CgkgICAgICAgIHRocm93IG5ldyBfZXhjZXB0aW9uMlsnZGVmYXVsdCddKCdBdHRlbXB0aW5nIHRvIHJlZ2lzdGVyIGEgcGFydGlhbCBjYWxsZWQgIicgKyBuYW1lICsgJyIgYXMgdW5kZWZpbmVkJyk7CgkgICAgICB9CgkgICAgICB0aGlzLnBhcnRpYWxzW25hbWVdID0gcGFydGlhbDsKCSAgICB9CgkgIH0sCgkgIHVucmVnaXN0ZXJQYXJ0aWFsOiBmdW5jdGlvbiB1bnJlZ2lzdGVyUGFydGlhbChuYW1lKSB7CgkgICAgZGVsZXRlIHRoaXMucGFydGlhbHNbbmFtZV07CgkgIH0sCgoJICByZWdpc3RlckRlY29yYXRvcjogZnVuY3Rpb24gcmVnaXN0ZXJEZWNvcmF0b3IobmFtZSwgZm4pIHsKCSAgICBpZiAoX3V0aWxzLnRvU3RyaW5nLmNhbGwobmFtZSkgPT09IG9iamVjdFR5cGUpIHsKCSAgICAgIGlmIChmbikgewoJICAgICAgICB0aHJvdyBuZXcgX2V4Y2VwdGlvbjJbJ2RlZmF1bHQnXSgnQXJnIG5vdCBzdXBwb3J0ZWQgd2l0aCBtdWx0aXBsZSBkZWNvcmF0b3JzJyk7CgkgICAgICB9CgkgICAgICBfdXRpbHMuZXh0ZW5kKHRoaXMuZGVjb3JhdG9ycywgbmFtZSk7CgkgICAgfSBlbHNlIHsKCSAgICAgIHRoaXMuZGVjb3JhdG9yc1tuYW1lXSA9IGZuOwoJICAgIH0KCSAgfSwKCSAgdW5yZWdpc3RlckRlY29yYXRvcjogZnVuY3Rpb24gdW5yZWdpc3RlckRlY29yYXRvcihuYW1lKSB7CgkgICAgZGVsZXRlIHRoaXMuZGVjb3JhdG9yc1tuYW1lXTsKCSAgfQoJfTsKCgl2YXIgbG9nID0gX2xvZ2dlcjJbJ2RlZmF1bHQnXS5sb2c7CgoJZXhwb3J0cy5sb2cgPSBsb2c7CglleHBvcnRzLmNyZWF0ZUZyYW1lID0gX3V0aWxzLmNyZWF0ZUZyYW1lOwoJZXhwb3J0cy5sb2dnZXIgPSBfbG9nZ2VyMlsnZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogNSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCgkndXNlIHN0cmljdCc7CgoJZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCWV4cG9ydHMuZXh0ZW5kID0gZXh0ZW5kOwoJZXhwb3J0cy5pbmRleE9mID0gaW5kZXhPZjsKCWV4cG9ydHMuZXNjYXBlRXhwcmVzc2lvbiA9IGVzY2FwZUV4cHJlc3Npb247CglleHBvcnRzLmlzRW1wdHkgPSBpc0VtcHR5OwoJZXhwb3J0cy5jcmVhdGVGcmFtZSA9IGNyZWF0ZUZyYW1lOwoJZXhwb3J0cy5ibG9ja1BhcmFtcyA9IGJsb2NrUGFyYW1zOwoJZXhwb3J0cy5hcHBlbmRDb250ZXh0UGF0aCA9IGFwcGVuZENvbnRleHRQYXRoOwoJdmFyIGVzY2FwZSA9IHsKCSAgJyYnOiAnJmFtcDsnLAoJICAnPCc6ICcmbHQ7JywKCSAgJz4nOiAnJmd0OycsCgkgICciJzogJyZxdW90OycsCgkgICInIjogJyYjeDI3OycsCgkgICdgJzogJyYjeDYwOycsCgkgICc9JzogJyYjeDNEOycKCX07CgoJdmFyIGJhZENoYXJzID0gL1smPD4iJ2A9XS9nLAoJICAgIHBvc3NpYmxlID0gL1smPD4iJ2A9XS87CgoJZnVuY3Rpb24gZXNjYXBlQ2hhcihjaHIpIHsKCSAgcmV0dXJuIGVzY2FwZVtjaHJdOwoJfQoKCWZ1bmN0aW9uIGV4dGVuZChvYmogLyogLCAuLi5zb3VyY2UgKi8pIHsKCSAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKCSAgICBmb3IgKHZhciBrZXkgaW4gYXJndW1lbnRzW2ldKSB7CgkgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGFyZ3VtZW50c1tpXSwga2V5KSkgewoJICAgICAgICBvYmpba2V5XSA9IGFyZ3VtZW50c1tpXVtrZXldOwoJICAgICAgfQoJICAgIH0KCSAgfQoKCSAgcmV0dXJuIG9iajsKCX0KCgl2YXIgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwoKCWV4cG9ydHMudG9TdHJpbmcgPSB0b1N0cmluZzsKCS8vIFNvdXJjZWQgZnJvbSBsb2Rhc2gKCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS9iZXN0aWVqcy9sb2Rhc2gvYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKCS8qIGVzbGludC1kaXNhYmxlIGZ1bmMtc3R5bGUgKi8KCXZhciBpc0Z1bmN0aW9uID0gZnVuY3Rpb24gaXNGdW5jdGlvbih2YWx1ZSkgewoJICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nOwoJfTsKCS8vIGZhbGxiYWNrIGZvciBvbGRlciB2ZXJzaW9ucyBvZiBDaHJvbWUgYW5kIFNhZmFyaQoJLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCWlmIChpc0Z1bmN0aW9uKC94LykpIHsKCSAgZXhwb3J0cy5pc0Z1bmN0aW9uID0gaXNGdW5jdGlvbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewoJICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicgJiYgdG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT09ICdbb2JqZWN0IEZ1bmN0aW9uXSc7CgkgIH07Cgl9CglleHBvcnRzLmlzRnVuY3Rpb24gPSBpc0Z1bmN0aW9uOwoKCS8qIGVzbGludC1lbmFibGUgZnVuYy1zdHlsZSAqLwoKCS8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgl2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKHZhbHVlKSB7CgkgIHJldHVybiB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnID8gdG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT09ICdbb2JqZWN0IEFycmF5XScgOiBmYWxzZTsKCX07CgoJZXhwb3J0cy5pc0FycmF5ID0gaXNBcnJheTsKCS8vIE9sZGVyIElFIHZlcnNpb25zIGRvIG5vdCBkaXJlY3RseSBzdXBwb3J0IGluZGV4T2Ygc28gd2UgbXVzdCBpbXBsZW1lbnQgb3VyIG93biwgc2FkbHkuCgoJZnVuY3Rpb24gaW5kZXhPZihhcnJheSwgdmFsdWUpIHsKCSAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFycmF5Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkgICAgaWYgKGFycmF5W2ldID09PSB2YWx1ZSkgewoJICAgICAgcmV0dXJuIGk7CgkgICAgfQoJICB9CgkgIHJldHVybiAtMTsKCX0KCglmdW5jdGlvbiBlc2NhcGVFeHByZXNzaW9uKHN0cmluZykgewoJICBpZiAodHlwZW9mIHN0cmluZyAhPT0gJ3N0cmluZycpIHsKCSAgICAvLyBkb24ndCBlc2NhcGUgU2FmZVN0cmluZ3MsIHNpbmNlIHRoZXkncmUgYWxyZWFkeSBzYWZlCgkgICAgaWYgKHN0cmluZyAmJiBzdHJpbmcudG9IVE1MKSB7CgkgICAgICByZXR1cm4gc3RyaW5nLnRvSFRNTCgpOwoJICAgIH0gZWxzZSBpZiAoc3RyaW5nID09IG51bGwpIHsKCSAgICAgIHJldHVybiAnJzsKCSAgICB9IGVsc2UgaWYgKCFzdHJpbmcpIHsKCSAgICAgIHJldHVybiBzdHJpbmcgKyAnJzsKCSAgICB9CgoJICAgIC8vIEZvcmNlIGEgc3RyaW5nIGNvbnZlcnNpb24gYXMgdGhpcyB3aWxsIGJlIGRvbmUgYnkgdGhlIGFwcGVuZCByZWdhcmRsZXNzIGFuZAoJICAgIC8vIHRoZSByZWdleCB0ZXN0IHdpbGwgZG8gdGhpcyB0cmFuc3BhcmVudGx5IGJlaGluZCB0aGUgc2NlbmVzLCBjYXVzaW5nIGlzc3VlcyBpZgoJICAgIC8vIGFuIG9iamVjdCdzIHRvIHN0cmluZyBoYXMgZXNjYXBlZCBjaGFyYWN0ZXJzIGluIGl0LgoJICAgIHN0cmluZyA9ICcnICsgc3RyaW5nOwoJICB9CgoJICBpZiAoIXBvc3NpYmxlLnRlc3Qoc3RyaW5nKSkgewoJICAgIHJldHVybiBzdHJpbmc7CgkgIH0KCSAgcmV0dXJuIHN0cmluZy5yZXBsYWNlKGJhZENoYXJzLCBlc2NhcGVDaGFyKTsKCX0KCglmdW5jdGlvbiBpc0VtcHR5KHZhbHVlKSB7CgkgIGlmICghdmFsdWUgJiYgdmFsdWUgIT09IDApIHsKCSAgICByZXR1cm4gdHJ1ZTsKCSAgfSBlbHNlIGlmIChpc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDApIHsKCSAgICByZXR1cm4gdHJ1ZTsKCSAgfSBlbHNlIHsKCSAgICByZXR1cm4gZmFsc2U7CgkgIH0KCX0KCglmdW5jdGlvbiBjcmVhdGVGcmFtZShvYmplY3QpIHsKCSAgdmFyIGZyYW1lID0gZXh0ZW5kKHt9LCBvYmplY3QpOwoJICBmcmFtZS5fcGFyZW50ID0gb2JqZWN0OwoJICByZXR1cm4gZnJhbWU7Cgl9CgoJZnVuY3Rpb24gYmxvY2tQYXJhbXMocGFyYW1zLCBpZHMpIHsKCSAgcGFyYW1zLnBhdGggPSBpZHM7CgkgIHJldHVybiBwYXJhbXM7Cgl9CgoJZnVuY3Rpb24gYXBwZW5kQ29udGV4dFBhdGgoY29udGV4dFBhdGgsIGlkKSB7CgkgIHJldHVybiAoY29udGV4dFBhdGggPyBjb250ZXh0UGF0aCArICcuJyA6ICcnKSArIGlkOwoJfQoKLyoqKi8gfSwKLyogNiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCgkndXNlIHN0cmljdCc7CgoJZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCgl2YXIgZXJyb3JQcm9wcyA9IFsnZGVzY3JpcHRpb24nLCAnZmlsZU5hbWUnLCAnbGluZU51bWJlcicsICdtZXNzYWdlJywgJ25hbWUnLCAnbnVtYmVyJywgJ3N0YWNrJ107CgoJZnVuY3Rpb24gRXhjZXB0aW9uKG1lc3NhZ2UsIG5vZGUpIHsKCSAgdmFyIGxvYyA9IG5vZGUgJiYgbm9kZS5sb2MsCgkgICAgICBsaW5lID0gdW5kZWZpbmVkLAoJICAgICAgY29sdW1uID0gdW5kZWZpbmVkOwoJICBpZiAobG9jKSB7CgkgICAgbGluZSA9IGxvYy5zdGFydC5saW5lOwoJICAgIGNvbHVtbiA9IGxvYy5zdGFydC5jb2x1bW47CgoJICAgIG1lc3NhZ2UgKz0gJyAtICcgKyBsaW5lICsgJzonICsgY29sdW1uOwoJICB9CgoJICB2YXIgdG1wID0gRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgbWVzc2FnZSk7CgoJICAvLyBVbmZvcnR1bmF0ZWx5IGVycm9ycyBhcmUgbm90IGVudW1lcmFibGUgaW4gQ2hyb21lIChhdCBsZWFzdCksIHNvIGBmb3IgcHJvcCBpbiB0bXBgIGRvZXNuJ3Qgd29yay4KCSAgZm9yICh2YXIgaWR4ID0gMDsgaWR4IDwgZXJyb3JQcm9wcy5sZW5ndGg7IGlkeCsrKSB7CgkgICAgdGhpc1tlcnJvclByb3BzW2lkeF1dID0gdG1wW2Vycm9yUHJvcHNbaWR4XV07CgkgIH0KCgkgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCgkgIGlmIChFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSkgewoJICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIEV4Y2VwdGlvbik7CgkgIH0KCgkgIGlmIChsb2MpIHsKCSAgICB0aGlzLmxpbmVOdW1iZXIgPSBsaW5lOwoJICAgIHRoaXMuY29sdW1uID0gY29sdW1uOwoJICB9Cgl9CgoJRXhjZXB0aW9uLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpOwoKCWV4cG9ydHNbJ2RlZmF1bHQnXSA9IEV4Y2VwdGlvbjsKCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogNyAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCgkndXNlIHN0cmljdCc7CgoJdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpWydkZWZhdWx0J107CgoJZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCWV4cG9ydHMucmVnaXN0ZXJEZWZhdWx0SGVscGVycyA9IHJlZ2lzdGVyRGVmYXVsdEhlbHBlcnM7CgoJdmFyIF9oZWxwZXJzQmxvY2tIZWxwZXJNaXNzaW5nID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsKCgl2YXIgX2hlbHBlcnNCbG9ja0hlbHBlck1pc3NpbmcyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaGVscGVyc0Jsb2NrSGVscGVyTWlzc2luZyk7CgoJdmFyIF9oZWxwZXJzRWFjaCA9IF9fd2VicGFja19yZXF1aXJlX18oOSk7CgoJdmFyIF9oZWxwZXJzRWFjaDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9oZWxwZXJzRWFjaCk7CgoJdmFyIF9oZWxwZXJzSGVscGVyTWlzc2luZyA9IF9fd2VicGFja19yZXF1aXJlX18oMTApOwoKCXZhciBfaGVscGVyc0hlbHBlck1pc3NpbmcyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaGVscGVyc0hlbHBlck1pc3NpbmcpOwoKCXZhciBfaGVscGVyc0lmID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMSk7CgoJdmFyIF9oZWxwZXJzSWYyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaGVscGVyc0lmKTsKCgl2YXIgX2hlbHBlcnNMb2cgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsKCgl2YXIgX2hlbHBlcnNMb2cyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaGVscGVyc0xvZyk7CgoJdmFyIF9oZWxwZXJzTG9va3VwID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMyk7CgoJdmFyIF9oZWxwZXJzTG9va3VwMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2hlbHBlcnNMb29rdXApOwoKCXZhciBfaGVscGVyc1dpdGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE0KTsKCgl2YXIgX2hlbHBlcnNXaXRoMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2hlbHBlcnNXaXRoKTsKCglmdW5jdGlvbiByZWdpc3RlckRlZmF1bHRIZWxwZXJzKGluc3RhbmNlKSB7CgkgIF9oZWxwZXJzQmxvY2tIZWxwZXJNaXNzaW5nMlsnZGVmYXVsdCddKGluc3RhbmNlKTsKCSAgX2hlbHBlcnNFYWNoMlsnZGVmYXVsdCddKGluc3RhbmNlKTsKCSAgX2hlbHBlcnNIZWxwZXJNaXNzaW5nMlsnZGVmYXVsdCddKGluc3RhbmNlKTsKCSAgX2hlbHBlcnNJZjJbJ2RlZmF1bHQnXShpbnN0YW5jZSk7CgkgIF9oZWxwZXJzTG9nMlsnZGVmYXVsdCddKGluc3RhbmNlKTsKCSAgX2hlbHBlcnNMb29rdXAyWydkZWZhdWx0J10oaW5zdGFuY2UpOwoJICBfaGVscGVyc1dpdGgyWydkZWZhdWx0J10oaW5zdGFuY2UpOwoJfQoKLyoqKi8gfSwKLyogOCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCgkndXNlIHN0cmljdCc7CgoJZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCgl2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsKCglleHBvcnRzWydkZWZhdWx0J10gPSBmdW5jdGlvbiAoaW5zdGFuY2UpIHsKCSAgaW5zdGFuY2UucmVnaXN0ZXJIZWxwZXIoJ2Jsb2NrSGVscGVyTWlzc2luZycsIGZ1bmN0aW9uIChjb250ZXh0LCBvcHRpb25zKSB7CgkgICAgdmFyIGludmVyc2UgPSBvcHRpb25zLmludmVyc2UsCgkgICAgICAgIGZuID0gb3B0aW9ucy5mbjsKCgkgICAgaWYgKGNvbnRleHQgPT09IHRydWUpIHsKCSAgICAgIHJldHVybiBmbih0aGlzKTsKCSAgICB9IGVsc2UgaWYgKGNvbnRleHQgPT09IGZhbHNlIHx8IGNvbnRleHQgPT0gbnVsbCkgewoJICAgICAgcmV0dXJuIGludmVyc2UodGhpcyk7CgkgICAgfSBlbHNlIGlmIChfdXRpbHMuaXNBcnJheShjb250ZXh0KSkgewoJICAgICAgaWYgKGNvbnRleHQubGVuZ3RoID4gMCkgewoJICAgICAgICBpZiAob3B0aW9ucy5pZHMpIHsKCSAgICAgICAgICBvcHRpb25zLmlkcyA9IFtvcHRpb25zLm5hbWVdOwoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gaW5zdGFuY2UuaGVscGVycy5lYWNoKGNvbnRleHQsIG9wdGlvbnMpOwoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgcmV0dXJuIGludmVyc2UodGhpcyk7CgkgICAgICB9CgkgICAgfSBlbHNlIHsKCSAgICAgIGlmIChvcHRpb25zLmRhdGEgJiYgb3B0aW9ucy5pZHMpIHsKCSAgICAgICAgdmFyIGRhdGEgPSBfdXRpbHMuY3JlYXRlRnJhbWUob3B0aW9ucy5kYXRhKTsKCSAgICAgICAgZGF0YS5jb250ZXh0UGF0aCA9IF91dGlscy5hcHBlbmRDb250ZXh0UGF0aChvcHRpb25zLmRhdGEuY29udGV4dFBhdGgsIG9wdGlvbnMubmFtZSk7CgkgICAgICAgIG9wdGlvbnMgPSB7IGRhdGE6IGRhdGEgfTsKCSAgICAgIH0KCgkgICAgICByZXR1cm4gZm4oY29udGV4dCwgb3B0aW9ucyk7CgkgICAgfQoJICB9KTsKCX07CgoJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiA5ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCSd1c2Ugc3RyaWN0JzsKCgl2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18oMSlbJ2RlZmF1bHQnXTsKCglleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKCXZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOwoKCXZhciBfZXhjZXB0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCgl2YXIgX2V4Y2VwdGlvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9leGNlcHRpb24pOwoKCWV4cG9ydHNbJ2RlZmF1bHQnXSA9IGZ1bmN0aW9uIChpbnN0YW5jZSkgewoJICBpbnN0YW5jZS5yZWdpc3RlckhlbHBlcignZWFjaCcsIGZ1bmN0aW9uIChjb250ZXh0LCBvcHRpb25zKSB7CgkgICAgaWYgKCFvcHRpb25zKSB7CgkgICAgICB0aHJvdyBuZXcgX2V4Y2VwdGlvbjJbJ2RlZmF1bHQnXSgnTXVzdCBwYXNzIGl0ZXJhdG9yIHRvICNlYWNoJyk7CgkgICAgfQoKCSAgICB2YXIgZm4gPSBvcHRpb25zLmZuLAoJICAgICAgICBpbnZlcnNlID0gb3B0aW9ucy5pbnZlcnNlLAoJICAgICAgICBpID0gMCwKCSAgICAgICAgcmV0ID0gJycsCgkgICAgICAgIGRhdGEgPSB1bmRlZmluZWQsCgkgICAgICAgIGNvbnRleHRQYXRoID0gdW5kZWZpbmVkOwoKCSAgICBpZiAob3B0aW9ucy5kYXRhICYmIG9wdGlvbnMuaWRzKSB7CgkgICAgICBjb250ZXh0UGF0aCA9IF91dGlscy5hcHBlbmRDb250ZXh0UGF0aChvcHRpb25zLmRhdGEuY29udGV4dFBhdGgsIG9wdGlvbnMuaWRzWzBdKSArICcuJzsKCSAgICB9CgoJICAgIGlmIChfdXRpbHMuaXNGdW5jdGlvbihjb250ZXh0KSkgewoJICAgICAgY29udGV4dCA9IGNvbnRleHQuY2FsbCh0aGlzKTsKCSAgICB9CgoJICAgIGlmIChvcHRpb25zLmRhdGEpIHsKCSAgICAgIGRhdGEgPSBfdXRpbHMuY3JlYXRlRnJhbWUob3B0aW9ucy5kYXRhKTsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGV4ZWNJdGVyYXRpb24oZmllbGQsIGluZGV4LCBsYXN0KSB7CgkgICAgICBpZiAoZGF0YSkgewoJICAgICAgICBkYXRhLmtleSA9IGZpZWxkOwoJICAgICAgICBkYXRhLmluZGV4ID0gaW5kZXg7CgkgICAgICAgIGRhdGEuZmlyc3QgPSBpbmRleCA9PT0gMDsKCSAgICAgICAgZGF0YS5sYXN0ID0gISFsYXN0OwoKCSAgICAgICAgaWYgKGNvbnRleHRQYXRoKSB7CgkgICAgICAgICAgZGF0YS5jb250ZXh0UGF0aCA9IGNvbnRleHRQYXRoICsgZmllbGQ7CgkgICAgICAgIH0KCSAgICAgIH0KCgkgICAgICByZXQgPSByZXQgKyBmbihjb250ZXh0W2ZpZWxkXSwgewoJICAgICAgICBkYXRhOiBkYXRhLAoJICAgICAgICBibG9ja1BhcmFtczogX3V0aWxzLmJsb2NrUGFyYW1zKFtjb250ZXh0W2ZpZWxkXSwgZmllbGRdLCBbY29udGV4dFBhdGggKyBmaWVsZCwgbnVsbF0pCgkgICAgICB9KTsKCSAgICB9CgoJICAgIGlmIChjb250ZXh0ICYmIHR5cGVvZiBjb250ZXh0ID09PSAnb2JqZWN0JykgewoJICAgICAgaWYgKF91dGlscy5pc0FycmF5KGNvbnRleHQpKSB7CgkgICAgICAgIGZvciAodmFyIGogPSBjb250ZXh0Lmxlbmd0aDsgaSA8IGo7IGkrKykgewoJICAgICAgICAgIGlmIChpIGluIGNvbnRleHQpIHsKCSAgICAgICAgICAgIGV4ZWNJdGVyYXRpb24oaSwgaSwgaSA9PT0gY29udGV4dC5sZW5ndGggLSAxKTsKCSAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgIH0gZWxzZSB7CgkgICAgICAgIHZhciBwcmlvcktleSA9IHVuZGVmaW5lZDsKCgkgICAgICAgIGZvciAodmFyIGtleSBpbiBjb250ZXh0KSB7CgkgICAgICAgICAgaWYgKGNvbnRleHQuaGFzT3duUHJvcGVydHkoa2V5KSkgewoJICAgICAgICAgICAgLy8gV2UncmUgcnVubmluZyB0aGUgaXRlcmF0aW9ucyBvbmUgc3RlcCBvdXQgb2Ygc3luYyBzbyB3ZSBjYW4gZGV0ZWN0CgkgICAgICAgICAgICAvLyB0aGUgbGFzdCBpdGVyYXRpb24gd2l0aG91dCBoYXZlIHRvIHNjYW4gdGhlIG9iamVjdCB0d2ljZSBhbmQgY3JlYXRlCgkgICAgICAgICAgICAvLyBhbiBpdGVybWVkaWF0ZSBrZXlzIGFycmF5LgoJICAgICAgICAgICAgaWYgKHByaW9yS2V5ICE9PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgICAgZXhlY0l0ZXJhdGlvbihwcmlvcktleSwgaSAtIDEpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcHJpb3JLZXkgPSBrZXk7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGlmIChwcmlvcktleSAhPT0gdW5kZWZpbmVkKSB7CgkgICAgICAgICAgZXhlY0l0ZXJhdGlvbihwcmlvcktleSwgaSAtIDEsIHRydWUpOwoJICAgICAgICB9CgkgICAgICB9CgkgICAgfQoKCSAgICBpZiAoaSA9PT0gMCkgewoJICAgICAgcmV0ID0gaW52ZXJzZSh0aGlzKTsKCSAgICB9CgoJICAgIHJldHVybiByZXQ7CgkgIH0pOwoJfTsKCgltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDEwICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCSd1c2Ugc3RyaWN0JzsKCgl2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18oMSlbJ2RlZmF1bHQnXTsKCglleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKCXZhciBfZXhjZXB0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCgl2YXIgX2V4Y2VwdGlvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9leGNlcHRpb24pOwoKCWV4cG9ydHNbJ2RlZmF1bHQnXSA9IGZ1bmN0aW9uIChpbnN0YW5jZSkgewoJICBpbnN0YW5jZS5yZWdpc3RlckhlbHBlcignaGVscGVyTWlzc2luZycsIGZ1bmN0aW9uICgpIC8qIFthcmdzLCBdb3B0aW9ucyAqL3sKCSAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgewoJICAgICAgLy8gQSBtaXNzaW5nIGZpZWxkIGluIGEge3tmb299fSBjb25zdHJ1Y3QuCgkgICAgICByZXR1cm4gdW5kZWZpbmVkOwoJICAgIH0gZWxzZSB7CgkgICAgICAvLyBTb21lb25lIGlzIGFjdHVhbGx5IHRyeWluZyB0byBjYWxsIHNvbWV0aGluZywgYmxvdyB1cC4KCSAgICAgIHRocm93IG5ldyBfZXhjZXB0aW9uMlsnZGVmYXVsdCddKCdNaXNzaW5nIGhlbHBlcjogIicgKyBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdLm5hbWUgKyAnIicpOwoJICAgIH0KCSAgfSk7Cgl9OwoKCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogMTEgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoJJ3VzZSBzdHJpY3QnOwoKCWV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CgoJdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgoJZXhwb3J0c1snZGVmYXVsdCddID0gZnVuY3Rpb24gKGluc3RhbmNlKSB7CgkgIGluc3RhbmNlLnJlZ2lzdGVySGVscGVyKCdpZicsIGZ1bmN0aW9uIChjb25kaXRpb25hbCwgb3B0aW9ucykgewoJICAgIGlmIChfdXRpbHMuaXNGdW5jdGlvbihjb25kaXRpb25hbCkpIHsKCSAgICAgIGNvbmRpdGlvbmFsID0gY29uZGl0aW9uYWwuY2FsbCh0aGlzKTsKCSAgICB9CgoJICAgIC8vIERlZmF1bHQgYmVoYXZpb3IgaXMgdG8gcmVuZGVyIHRoZSBwb3NpdGl2ZSBwYXRoIGlmIHRoZSB2YWx1ZSBpcyB0cnV0aHkgYW5kIG5vdCBlbXB0eS4KCSAgICAvLyBUaGUgYGluY2x1ZGVaZXJvYCBvcHRpb24gbWF5IGJlIHNldCB0byB0cmVhdCB0aGUgY29uZHRpb25hbCBhcyBwdXJlbHkgbm90IGVtcHR5IGJhc2VkIG9uIHRoZQoJICAgIC8vIGJlaGF2aW9yIG9mIGlzRW1wdHkuIEVmZmVjdGl2ZWx5IHRoaXMgZGV0ZXJtaW5lcyBpZiAwIGlzIGhhbmRsZWQgYnkgdGhlIHBvc2l0aXZlIHBhdGggb3IgbmVnYXRpdmUuCgkgICAgaWYgKCFvcHRpb25zLmhhc2guaW5jbHVkZVplcm8gJiYgIWNvbmRpdGlvbmFsIHx8IF91dGlscy5pc0VtcHR5KGNvbmRpdGlvbmFsKSkgewoJICAgICAgcmV0dXJuIG9wdGlvbnMuaW52ZXJzZSh0aGlzKTsKCSAgICB9IGVsc2UgewoJICAgICAgcmV0dXJuIG9wdGlvbnMuZm4odGhpcyk7CgkgICAgfQoJICB9KTsKCgkgIGluc3RhbmNlLnJlZ2lzdGVySGVscGVyKCd1bmxlc3MnLCBmdW5jdGlvbiAoY29uZGl0aW9uYWwsIG9wdGlvbnMpIHsKCSAgICByZXR1cm4gaW5zdGFuY2UuaGVscGVyc1snaWYnXS5jYWxsKHRoaXMsIGNvbmRpdGlvbmFsLCB7IGZuOiBvcHRpb25zLmludmVyc2UsIGludmVyc2U6IG9wdGlvbnMuZm4sIGhhc2g6IG9wdGlvbnMuaGFzaCB9KTsKCSAgfSk7Cgl9OwoKCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogMTIgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgoJJ3VzZSBzdHJpY3QnOwoKCWV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CgoJZXhwb3J0c1snZGVmYXVsdCddID0gZnVuY3Rpb24gKGluc3RhbmNlKSB7CgkgIGluc3RhbmNlLnJlZ2lzdGVySGVscGVyKCdsb2cnLCBmdW5jdGlvbiAoKSAvKiBtZXNzYWdlLCBvcHRpb25zICovewoJICAgIHZhciBhcmdzID0gW3VuZGVmaW5lZF0sCgkgICAgICAgIG9wdGlvbnMgPSBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdOwoJICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aCAtIDE7IGkrKykgewoJICAgICAgYXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7CgkgICAgfQoKCSAgICB2YXIgbGV2ZWwgPSAxOwoJICAgIGlmIChvcHRpb25zLmhhc2gubGV2ZWwgIT0gbnVsbCkgewoJICAgICAgbGV2ZWwgPSBvcHRpb25zLmhhc2gubGV2ZWw7CgkgICAgfSBlbHNlIGlmIChvcHRpb25zLmRhdGEgJiYgb3B0aW9ucy5kYXRhLmxldmVsICE9IG51bGwpIHsKCSAgICAgIGxldmVsID0gb3B0aW9ucy5kYXRhLmxldmVsOwoJICAgIH0KCSAgICBhcmdzWzBdID0gbGV2ZWw7CgoJICAgIGluc3RhbmNlLmxvZy5hcHBseShpbnN0YW5jZSwgYXJncyk7CgkgIH0pOwoJfTsKCgltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDEzICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKCSd1c2Ugc3RyaWN0JzsKCglleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKCWV4cG9ydHNbJ2RlZmF1bHQnXSA9IGZ1bmN0aW9uIChpbnN0YW5jZSkgewoJICBpbnN0YW5jZS5yZWdpc3RlckhlbHBlcignbG9va3VwJywgZnVuY3Rpb24gKG9iaiwgZmllbGQpIHsKCSAgICByZXR1cm4gb2JqICYmIG9ialtmaWVsZF07CgkgIH0pOwoJfTsKCgltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDE0ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCSd1c2Ugc3RyaWN0JzsKCglleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKCXZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOwoKCWV4cG9ydHNbJ2RlZmF1bHQnXSA9IGZ1bmN0aW9uIChpbnN0YW5jZSkgewoJICBpbnN0YW5jZS5yZWdpc3RlckhlbHBlcignd2l0aCcsIGZ1bmN0aW9uIChjb250ZXh0LCBvcHRpb25zKSB7CgkgICAgaWYgKF91dGlscy5pc0Z1bmN0aW9uKGNvbnRleHQpKSB7CgkgICAgICBjb250ZXh0ID0gY29udGV4dC5jYWxsKHRoaXMpOwoJICAgIH0KCgkgICAgdmFyIGZuID0gb3B0aW9ucy5mbjsKCgkgICAgaWYgKCFfdXRpbHMuaXNFbXB0eShjb250ZXh0KSkgewoJICAgICAgdmFyIGRhdGEgPSBvcHRpb25zLmRhdGE7CgkgICAgICBpZiAob3B0aW9ucy5kYXRhICYmIG9wdGlvbnMuaWRzKSB7CgkgICAgICAgIGRhdGEgPSBfdXRpbHMuY3JlYXRlRnJhbWUob3B0aW9ucy5kYXRhKTsKCSAgICAgICAgZGF0YS5jb250ZXh0UGF0aCA9IF91dGlscy5hcHBlbmRDb250ZXh0UGF0aChvcHRpb25zLmRhdGEuY29udGV4dFBhdGgsIG9wdGlvbnMuaWRzWzBdKTsKCSAgICAgIH0KCgkgICAgICByZXR1cm4gZm4oY29udGV4dCwgewoJICAgICAgICBkYXRhOiBkYXRhLAoJICAgICAgICBibG9ja1BhcmFtczogX3V0aWxzLmJsb2NrUGFyYW1zKFtjb250ZXh0XSwgW2RhdGEgJiYgZGF0YS5jb250ZXh0UGF0aF0pCgkgICAgICB9KTsKCSAgICB9IGVsc2UgewoJICAgICAgcmV0dXJuIG9wdGlvbnMuaW52ZXJzZSh0aGlzKTsKCSAgICB9CgkgIH0pOwoJfTsKCgltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDE1ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCSd1c2Ugc3RyaWN0JzsKCgl2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18oMSlbJ2RlZmF1bHQnXTsKCglleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoJZXhwb3J0cy5yZWdpc3RlckRlZmF1bHREZWNvcmF0b3JzID0gcmVnaXN0ZXJEZWZhdWx0RGVjb3JhdG9yczsKCgl2YXIgX2RlY29yYXRvcnNJbmxpbmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2KTsKCgl2YXIgX2RlY29yYXRvcnNJbmxpbmUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZGVjb3JhdG9yc0lubGluZSk7CgoJZnVuY3Rpb24gcmVnaXN0ZXJEZWZhdWx0RGVjb3JhdG9ycyhpbnN0YW5jZSkgewoJICBfZGVjb3JhdG9yc0lubGluZTJbJ2RlZmF1bHQnXShpbnN0YW5jZSk7Cgl9CgovKioqLyB9LAovKiAxNiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCgkndXNlIHN0cmljdCc7CgoJZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCgl2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsKCglleHBvcnRzWydkZWZhdWx0J10gPSBmdW5jdGlvbiAoaW5zdGFuY2UpIHsKCSAgaW5zdGFuY2UucmVnaXN0ZXJEZWNvcmF0b3IoJ2lubGluZScsIGZ1bmN0aW9uIChmbiwgcHJvcHMsIGNvbnRhaW5lciwgb3B0aW9ucykgewoJICAgIHZhciByZXQgPSBmbjsKCSAgICBpZiAoIXByb3BzLnBhcnRpYWxzKSB7CgkgICAgICBwcm9wcy5wYXJ0aWFscyA9IHt9OwoJICAgICAgcmV0ID0gZnVuY3Rpb24gKGNvbnRleHQsIG9wdGlvbnMpIHsKCSAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IHBhcnRpYWxzIHN0YWNrIGZyYW1lIHByaW9yIHRvIGV4ZWMuCgkgICAgICAgIHZhciBvcmlnaW5hbCA9IGNvbnRhaW5lci5wYXJ0aWFsczsKCSAgICAgICAgY29udGFpbmVyLnBhcnRpYWxzID0gX3V0aWxzLmV4dGVuZCh7fSwgb3JpZ2luYWwsIHByb3BzLnBhcnRpYWxzKTsKCSAgICAgICAgdmFyIHJldCA9IGZuKGNvbnRleHQsIG9wdGlvbnMpOwoJICAgICAgICBjb250YWluZXIucGFydGlhbHMgPSBvcmlnaW5hbDsKCSAgICAgICAgcmV0dXJuIHJldDsKCSAgICAgIH07CgkgICAgfQoKCSAgICBwcm9wcy5wYXJ0aWFsc1tvcHRpb25zLmFyZ3NbMF1dID0gb3B0aW9ucy5mbjsKCgkgICAgcmV0dXJuIHJldDsKCSAgfSk7Cgl9OwoKCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogMTcgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoJJ3VzZSBzdHJpY3QnOwoKCWV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CgoJdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgoJdmFyIGxvZ2dlciA9IHsKCSAgbWV0aG9kTWFwOiBbJ2RlYnVnJywgJ2luZm8nLCAnd2FybicsICdlcnJvciddLAoJICBsZXZlbDogJ2luZm8nLAoKCSAgLy8gTWFwcyBhIGdpdmVuIGxldmVsIHZhbHVlIHRvIHRoZSBgbWV0aG9kTWFwYCBpbmRleGVzIGFib3ZlLgoJICBsb29rdXBMZXZlbDogZnVuY3Rpb24gbG9va3VwTGV2ZWwobGV2ZWwpIHsKCSAgICBpZiAodHlwZW9mIGxldmVsID09PSAnc3RyaW5nJykgewoJICAgICAgdmFyIGxldmVsTWFwID0gX3V0aWxzLmluZGV4T2YobG9nZ2VyLm1ldGhvZE1hcCwgbGV2ZWwudG9Mb3dlckNhc2UoKSk7CgkgICAgICBpZiAobGV2ZWxNYXAgPj0gMCkgewoJICAgICAgICBsZXZlbCA9IGxldmVsTWFwOwoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgbGV2ZWwgPSBwYXJzZUludChsZXZlbCwgMTApOwoJICAgICAgfQoJICAgIH0KCgkgICAgcmV0dXJuIGxldmVsOwoJICB9LAoKCSAgLy8gQ2FuIGJlIG92ZXJyaWRkZW4gaW4gdGhlIGhvc3QgZW52aXJvbm1lbnQKCSAgbG9nOiBmdW5jdGlvbiBsb2cobGV2ZWwpIHsKCSAgICBsZXZlbCA9IGxvZ2dlci5sb29rdXBMZXZlbChsZXZlbCk7CgoJICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbG9nZ2VyLmxvb2t1cExldmVsKGxvZ2dlci5sZXZlbCkgPD0gbGV2ZWwpIHsKCSAgICAgIHZhciBtZXRob2QgPSBsb2dnZXIubWV0aG9kTWFwW2xldmVsXTsKCSAgICAgIGlmICghY29uc29sZVttZXRob2RdKSB7CgkgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQoJICAgICAgICBtZXRob2QgPSAnbG9nJzsKCSAgICAgIH0KCgkgICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgbWVzc2FnZSA9IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKCSAgICAgICAgbWVzc2FnZVtfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07CgkgICAgICB9CgoJICAgICAgY29uc29sZVttZXRob2RdLmFwcGx5KGNvbnNvbGUsIG1lc3NhZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCSAgICB9CgkgIH0KCX07CgoJZXhwb3J0c1snZGVmYXVsdCddID0gbG9nZ2VyOwoJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiAxOCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCgkvLyBCdWlsZCBvdXQgb3VyIGJhc2ljIFNhZmVTdHJpbmcgdHlwZQoJJ3VzZSBzdHJpY3QnOwoKCWV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CglmdW5jdGlvbiBTYWZlU3RyaW5nKHN0cmluZykgewoJICB0aGlzLnN0cmluZyA9IHN0cmluZzsKCX0KCglTYWZlU3RyaW5nLnByb3RvdHlwZS50b1N0cmluZyA9IFNhZmVTdHJpbmcucHJvdG90eXBlLnRvSFRNTCA9IGZ1bmN0aW9uICgpIHsKCSAgcmV0dXJuICcnICsgdGhpcy5zdHJpbmc7Cgl9OwoKCWV4cG9ydHNbJ2RlZmF1bHQnXSA9IFNhZmVTdHJpbmc7Cgltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDE5ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCSd1c2Ugc3RyaWN0JzsKCgl2YXIgX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpWydkZWZhdWx0J107CgoJdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpWydkZWZhdWx0J107CgoJZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCWV4cG9ydHMuY2hlY2tSZXZpc2lvbiA9IGNoZWNrUmV2aXNpb247CglleHBvcnRzLnRlbXBsYXRlID0gdGVtcGxhdGU7CglleHBvcnRzLndyYXBQcm9ncmFtID0gd3JhcFByb2dyYW07CglleHBvcnRzLnJlc29sdmVQYXJ0aWFsID0gcmVzb2x2ZVBhcnRpYWw7CglleHBvcnRzLmludm9rZVBhcnRpYWwgPSBpbnZva2VQYXJ0aWFsOwoJZXhwb3J0cy5ub29wID0gbm9vcDsKCgl2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsKCgl2YXIgVXRpbHMgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChfdXRpbHMpOwoKCXZhciBfZXhjZXB0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCgl2YXIgX2V4Y2VwdGlvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9leGNlcHRpb24pOwoKCXZhciBfYmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7CgoJZnVuY3Rpb24gY2hlY2tSZXZpc2lvbihjb21waWxlckluZm8pIHsKCSAgdmFyIGNvbXBpbGVyUmV2aXNpb24gPSBjb21waWxlckluZm8gJiYgY29tcGlsZXJJbmZvWzBdIHx8IDEsCgkgICAgICBjdXJyZW50UmV2aXNpb24gPSBfYmFzZS5DT01QSUxFUl9SRVZJU0lPTjsKCgkgIGlmIChjb21waWxlclJldmlzaW9uICE9PSBjdXJyZW50UmV2aXNpb24pIHsKCSAgICBpZiAoY29tcGlsZXJSZXZpc2lvbiA8IGN1cnJlbnRSZXZpc2lvbikgewoJICAgICAgdmFyIHJ1bnRpbWVWZXJzaW9ucyA9IF9iYXNlLlJFVklTSU9OX0NIQU5HRVNbY3VycmVudFJldmlzaW9uXSwKCSAgICAgICAgICBjb21waWxlclZlcnNpb25zID0gX2Jhc2UuUkVWSVNJT05fQ0hBTkdFU1tjb21waWxlclJldmlzaW9uXTsKCSAgICAgIHRocm93IG5ldyBfZXhjZXB0aW9uMlsnZGVmYXVsdCddKCdUZW1wbGF0ZSB3YXMgcHJlY29tcGlsZWQgd2l0aCBhbiBvbGRlciB2ZXJzaW9uIG9mIEhhbmRsZWJhcnMgdGhhbiB0aGUgY3VycmVudCBydW50aW1lLiAnICsgJ1BsZWFzZSB1cGRhdGUgeW91ciBwcmVjb21waWxlciB0byBhIG5ld2VyIHZlcnNpb24gKCcgKyBydW50aW1lVmVyc2lvbnMgKyAnKSBvciBkb3duZ3JhZGUgeW91ciBydW50aW1lIHRvIGFuIG9sZGVyIHZlcnNpb24gKCcgKyBjb21waWxlclZlcnNpb25zICsgJykuJyk7CgkgICAgfSBlbHNlIHsKCSAgICAgIC8vIFVzZSB0aGUgZW1iZWRkZWQgdmVyc2lvbiBpbmZvIHNpbmNlIHRoZSBydW50aW1lIGRvZXNuJ3Qga25vdyBhYm91dCB0aGlzIHJldmlzaW9uIHlldAoJICAgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ1RlbXBsYXRlIHdhcyBwcmVjb21waWxlZCB3aXRoIGEgbmV3ZXIgdmVyc2lvbiBvZiBIYW5kbGViYXJzIHRoYW4gdGhlIGN1cnJlbnQgcnVudGltZS4gJyArICdQbGVhc2UgdXBkYXRlIHlvdXIgcnVudGltZSB0byBhIG5ld2VyIHZlcnNpb24gKCcgKyBjb21waWxlckluZm9bMV0gKyAnKS4nKTsKCSAgICB9CgkgIH0KCX0KCglmdW5jdGlvbiB0ZW1wbGF0ZSh0ZW1wbGF0ZVNwZWMsIGVudikgewoJICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoJICBpZiAoIWVudikgewoJICAgIHRocm93IG5ldyBfZXhjZXB0aW9uMlsnZGVmYXVsdCddKCdObyBlbnZpcm9ubWVudCBwYXNzZWQgdG8gdGVtcGxhdGUnKTsKCSAgfQoJICBpZiAoIXRlbXBsYXRlU3BlYyB8fCAhdGVtcGxhdGVTcGVjLm1haW4pIHsKCSAgICB0aHJvdyBuZXcgX2V4Y2VwdGlvbjJbJ2RlZmF1bHQnXSgnVW5rbm93biB0ZW1wbGF0ZSBvYmplY3Q6ICcgKyB0eXBlb2YgdGVtcGxhdGVTcGVjKTsKCSAgfQoKCSAgdGVtcGxhdGVTcGVjLm1haW4uZGVjb3JhdG9yID0gdGVtcGxhdGVTcGVjLm1haW5fZDsKCgkgIC8vIE5vdGU6IFVzaW5nIGVudi5WTSByZWZlcmVuY2VzIHJhdGhlciB0aGFuIGxvY2FsIHZhciByZWZlcmVuY2VzIHRocm91Z2hvdXQgdGhpcyBzZWN0aW9uIHRvIGFsbG93CgkgIC8vIGZvciBleHRlcm5hbCB1c2VycyB0byBvdmVycmlkZSB0aGVzZSBhcyBwc3VlZG8tc3VwcG9ydGVkIEFQSXMuCgkgIGVudi5WTS5jaGVja1JldmlzaW9uKHRlbXBsYXRlU3BlYy5jb21waWxlcik7CgoJICBmdW5jdGlvbiBpbnZva2VQYXJ0aWFsV3JhcHBlcihwYXJ0aWFsLCBjb250ZXh0LCBvcHRpb25zKSB7CgkgICAgaWYgKG9wdGlvbnMuaGFzaCkgewoJICAgICAgY29udGV4dCA9IFV0aWxzLmV4dGVuZCh7fSwgY29udGV4dCwgb3B0aW9ucy5oYXNoKTsKCSAgICAgIGlmIChvcHRpb25zLmlkcykgewoJICAgICAgICBvcHRpb25zLmlkc1swXSA9IHRydWU7CgkgICAgICB9CgkgICAgfQoKCSAgICBwYXJ0aWFsID0gZW52LlZNLnJlc29sdmVQYXJ0aWFsLmNhbGwodGhpcywgcGFydGlhbCwgY29udGV4dCwgb3B0aW9ucyk7CgkgICAgdmFyIHJlc3VsdCA9IGVudi5WTS5pbnZva2VQYXJ0aWFsLmNhbGwodGhpcywgcGFydGlhbCwgY29udGV4dCwgb3B0aW9ucyk7CgoJICAgIGlmIChyZXN1bHQgPT0gbnVsbCAmJiBlbnYuY29tcGlsZSkgewoJICAgICAgb3B0aW9ucy5wYXJ0aWFsc1tvcHRpb25zLm5hbWVdID0gZW52LmNvbXBpbGUocGFydGlhbCwgdGVtcGxhdGVTcGVjLmNvbXBpbGVyT3B0aW9ucywgZW52KTsKCSAgICAgIHJlc3VsdCA9IG9wdGlvbnMucGFydGlhbHNbb3B0aW9ucy5uYW1lXShjb250ZXh0LCBvcHRpb25zKTsKCSAgICB9CgkgICAgaWYgKHJlc3VsdCAhPSBudWxsKSB7CgkgICAgICBpZiAob3B0aW9ucy5pbmRlbnQpIHsKCSAgICAgICAgdmFyIGxpbmVzID0gcmVzdWx0LnNwbGl0KCdcbicpOwoJICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGxpbmVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewoJICAgICAgICAgIGlmICghbGluZXNbaV0gJiYgaSArIDEgPT09IGwpIHsKCSAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgIH0KCgkgICAgICAgICAgbGluZXNbaV0gPSBvcHRpb25zLmluZGVudCArIGxpbmVzW2ldOwoJICAgICAgICB9CgkgICAgICAgIHJlc3VsdCA9IGxpbmVzLmpvaW4oJ1xuJyk7CgkgICAgICB9CgkgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH0gZWxzZSB7CgkgICAgICB0aHJvdyBuZXcgX2V4Y2VwdGlvbjJbJ2RlZmF1bHQnXSgnVGhlIHBhcnRpYWwgJyArIG9wdGlvbnMubmFtZSArICcgY291bGQgbm90IGJlIGNvbXBpbGVkIHdoZW4gcnVubmluZyBpbiBydW50aW1lLW9ubHkgbW9kZScpOwoJICAgIH0KCSAgfQoKCSAgLy8gSnVzdCBhZGQgd2F0ZXIKCSAgdmFyIGNvbnRhaW5lciA9IHsKCSAgICBzdHJpY3Q6IGZ1bmN0aW9uIHN0cmljdChvYmosIG5hbWUpIHsKCSAgICAgIGlmICghKG5hbWUgaW4gb2JqKSkgewoJICAgICAgICB0aHJvdyBuZXcgX2V4Y2VwdGlvbjJbJ2RlZmF1bHQnXSgnIicgKyBuYW1lICsgJyIgbm90IGRlZmluZWQgaW4gJyArIG9iaik7CgkgICAgICB9CgkgICAgICByZXR1cm4gb2JqW25hbWVdOwoJICAgIH0sCgkgICAgbG9va3VwOiBmdW5jdGlvbiBsb29rdXAoZGVwdGhzLCBuYW1lKSB7CgkgICAgICB2YXIgbGVuID0gZGVwdGhzLmxlbmd0aDsKCSAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKCSAgICAgICAgaWYgKGRlcHRoc1tpXSAmJiBkZXB0aHNbaV1bbmFtZV0gIT0gbnVsbCkgewoJICAgICAgICAgIHJldHVybiBkZXB0aHNbaV1bbmFtZV07CgkgICAgICAgIH0KCSAgICAgIH0KCSAgICB9LAoJICAgIGxhbWJkYTogZnVuY3Rpb24gbGFtYmRhKGN1cnJlbnQsIGNvbnRleHQpIHsKCSAgICAgIHJldHVybiB0eXBlb2YgY3VycmVudCA9PT0gJ2Z1bmN0aW9uJyA/IGN1cnJlbnQuY2FsbChjb250ZXh0KSA6IGN1cnJlbnQ7CgkgICAgfSwKCgkgICAgZXNjYXBlRXhwcmVzc2lvbjogVXRpbHMuZXNjYXBlRXhwcmVzc2lvbiwKCSAgICBpbnZva2VQYXJ0aWFsOiBpbnZva2VQYXJ0aWFsV3JhcHBlciwKCgkgICAgZm46IGZ1bmN0aW9uIGZuKGkpIHsKCSAgICAgIHZhciByZXQgPSB0ZW1wbGF0ZVNwZWNbaV07CgkgICAgICByZXQuZGVjb3JhdG9yID0gdGVtcGxhdGVTcGVjW2kgKyAnX2QnXTsKCSAgICAgIHJldHVybiByZXQ7CgkgICAgfSwKCgkgICAgcHJvZ3JhbXM6IFtdLAoJICAgIHByb2dyYW06IGZ1bmN0aW9uIHByb2dyYW0oaSwgZGF0YSwgZGVjbGFyZWRCbG9ja1BhcmFtcywgYmxvY2tQYXJhbXMsIGRlcHRocykgewoJICAgICAgdmFyIHByb2dyYW1XcmFwcGVyID0gdGhpcy5wcm9ncmFtc1tpXSwKCSAgICAgICAgICBmbiA9IHRoaXMuZm4oaSk7CgkgICAgICBpZiAoZGF0YSB8fCBkZXB0aHMgfHwgYmxvY2tQYXJhbXMgfHwgZGVjbGFyZWRCbG9ja1BhcmFtcykgewoJICAgICAgICBwcm9ncmFtV3JhcHBlciA9IHdyYXBQcm9ncmFtKHRoaXMsIGksIGZuLCBkYXRhLCBkZWNsYXJlZEJsb2NrUGFyYW1zLCBibG9ja1BhcmFtcywgZGVwdGhzKTsKCSAgICAgIH0gZWxzZSBpZiAoIXByb2dyYW1XcmFwcGVyKSB7CgkgICAgICAgIHByb2dyYW1XcmFwcGVyID0gdGhpcy5wcm9ncmFtc1tpXSA9IHdyYXBQcm9ncmFtKHRoaXMsIGksIGZuKTsKCSAgICAgIH0KCSAgICAgIHJldHVybiBwcm9ncmFtV3JhcHBlcjsKCSAgICB9LAoKCSAgICBkYXRhOiBmdW5jdGlvbiBkYXRhKHZhbHVlLCBkZXB0aCkgewoJICAgICAgd2hpbGUgKHZhbHVlICYmIGRlcHRoLS0pIHsKCSAgICAgICAgdmFsdWUgPSB2YWx1ZS5fcGFyZW50OwoJICAgICAgfQoJICAgICAgcmV0dXJuIHZhbHVlOwoJICAgIH0sCgkgICAgbWVyZ2U6IGZ1bmN0aW9uIG1lcmdlKHBhcmFtLCBjb21tb24pIHsKCSAgICAgIHZhciBvYmogPSBwYXJhbSB8fCBjb21tb247CgoJICAgICAgaWYgKHBhcmFtICYmIGNvbW1vbiAmJiBwYXJhbSAhPT0gY29tbW9uKSB7CgkgICAgICAgIG9iaiA9IFV0aWxzLmV4dGVuZCh7fSwgY29tbW9uLCBwYXJhbSk7CgkgICAgICB9CgoJICAgICAgcmV0dXJuIG9iajsKCSAgICB9LAoKCSAgICBub29wOiBlbnYuVk0ubm9vcCwKCSAgICBjb21waWxlckluZm86IHRlbXBsYXRlU3BlYy5jb21waWxlcgoJICB9OwoKCSAgZnVuY3Rpb24gcmV0KGNvbnRleHQpIHsKCSAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IHt9IDogYXJndW1lbnRzWzFdOwoKCSAgICB2YXIgZGF0YSA9IG9wdGlvbnMuZGF0YTsKCgkgICAgcmV0Ll9zZXR1cChvcHRpb25zKTsKCSAgICBpZiAoIW9wdGlvbnMucGFydGlhbCAmJiB0ZW1wbGF0ZVNwZWMudXNlRGF0YSkgewoJICAgICAgZGF0YSA9IGluaXREYXRhKGNvbnRleHQsIGRhdGEpOwoJICAgIH0KCSAgICB2YXIgZGVwdGhzID0gdW5kZWZpbmVkLAoJICAgICAgICBibG9ja1BhcmFtcyA9IHRlbXBsYXRlU3BlYy51c2VCbG9ja1BhcmFtcyA/IFtdIDogdW5kZWZpbmVkOwoJICAgIGlmICh0ZW1wbGF0ZVNwZWMudXNlRGVwdGhzKSB7CgkgICAgICBpZiAob3B0aW9ucy5kZXB0aHMpIHsKCSAgICAgICAgZGVwdGhzID0gY29udGV4dCAhPT0gb3B0aW9ucy5kZXB0aHNbMF0gPyBbY29udGV4dF0uY29uY2F0KG9wdGlvbnMuZGVwdGhzKSA6IG9wdGlvbnMuZGVwdGhzOwoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgZGVwdGhzID0gW2NvbnRleHRdOwoJICAgICAgfQoJICAgIH0KCgkgICAgZnVuY3Rpb24gbWFpbihjb250ZXh0IC8qLCBvcHRpb25zKi8pIHsKCSAgICAgIHJldHVybiAnJyArIHRlbXBsYXRlU3BlYy5tYWluKGNvbnRhaW5lciwgY29udGV4dCwgY29udGFpbmVyLmhlbHBlcnMsIGNvbnRhaW5lci5wYXJ0aWFscywgZGF0YSwgYmxvY2tQYXJhbXMsIGRlcHRocyk7CgkgICAgfQoJICAgIG1haW4gPSBleGVjdXRlRGVjb3JhdG9ycyh0ZW1wbGF0ZVNwZWMubWFpbiwgbWFpbiwgY29udGFpbmVyLCBvcHRpb25zLmRlcHRocyB8fCBbXSwgZGF0YSwgYmxvY2tQYXJhbXMpOwoJICAgIHJldHVybiBtYWluKGNvbnRleHQsIG9wdGlvbnMpOwoJICB9CgkgIHJldC5pc1RvcCA9IHRydWU7CgoJICByZXQuX3NldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKCSAgICBpZiAoIW9wdGlvbnMucGFydGlhbCkgewoJICAgICAgY29udGFpbmVyLmhlbHBlcnMgPSBjb250YWluZXIubWVyZ2Uob3B0aW9ucy5oZWxwZXJzLCBlbnYuaGVscGVycyk7CgoJICAgICAgaWYgKHRlbXBsYXRlU3BlYy51c2VQYXJ0aWFsKSB7CgkgICAgICAgIGNvbnRhaW5lci5wYXJ0aWFscyA9IGNvbnRhaW5lci5tZXJnZShvcHRpb25zLnBhcnRpYWxzLCBlbnYucGFydGlhbHMpOwoJICAgICAgfQoJICAgICAgaWYgKHRlbXBsYXRlU3BlYy51c2VQYXJ0aWFsIHx8IHRlbXBsYXRlU3BlYy51c2VEZWNvcmF0b3JzKSB7CgkgICAgICAgIGNvbnRhaW5lci5kZWNvcmF0b3JzID0gY29udGFpbmVyLm1lcmdlKG9wdGlvbnMuZGVjb3JhdG9ycywgZW52LmRlY29yYXRvcnMpOwoJICAgICAgfQoJICAgIH0gZWxzZSB7CgkgICAgICBjb250YWluZXIuaGVscGVycyA9IG9wdGlvbnMuaGVscGVyczsKCSAgICAgIGNvbnRhaW5lci5wYXJ0aWFscyA9IG9wdGlvbnMucGFydGlhbHM7CgkgICAgICBjb250YWluZXIuZGVjb3JhdG9ycyA9IG9wdGlvbnMuZGVjb3JhdG9yczsKCSAgICB9CgkgIH07CgoJICByZXQuX2NoaWxkID0gZnVuY3Rpb24gKGksIGRhdGEsIGJsb2NrUGFyYW1zLCBkZXB0aHMpIHsKCSAgICBpZiAodGVtcGxhdGVTcGVjLnVzZUJsb2NrUGFyYW1zICYmICFibG9ja1BhcmFtcykgewoJICAgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ211c3QgcGFzcyBibG9jayBwYXJhbXMnKTsKCSAgICB9CgkgICAgaWYgKHRlbXBsYXRlU3BlYy51c2VEZXB0aHMgJiYgIWRlcHRocykgewoJICAgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ211c3QgcGFzcyBwYXJlbnQgZGVwdGhzJyk7CgkgICAgfQoKCSAgICByZXR1cm4gd3JhcFByb2dyYW0oY29udGFpbmVyLCBpLCB0ZW1wbGF0ZVNwZWNbaV0sIGRhdGEsIDAsIGJsb2NrUGFyYW1zLCBkZXB0aHMpOwoJICB9OwoJICByZXR1cm4gcmV0OwoJfQoKCWZ1bmN0aW9uIHdyYXBQcm9ncmFtKGNvbnRhaW5lciwgaSwgZm4sIGRhdGEsIGRlY2xhcmVkQmxvY2tQYXJhbXMsIGJsb2NrUGFyYW1zLCBkZXB0aHMpIHsKCSAgZnVuY3Rpb24gcHJvZyhjb250ZXh0KSB7CgkgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB7fSA6IGFyZ3VtZW50c1sxXTsKCgkgICAgdmFyIGN1cnJlbnREZXB0aHMgPSBkZXB0aHM7CgkgICAgaWYgKGRlcHRocyAmJiBjb250ZXh0ICE9PSBkZXB0aHNbMF0pIHsKCSAgICAgIGN1cnJlbnREZXB0aHMgPSBbY29udGV4dF0uY29uY2F0KGRlcHRocyk7CgkgICAgfQoKCSAgICByZXR1cm4gZm4oY29udGFpbmVyLCBjb250ZXh0LCBjb250YWluZXIuaGVscGVycywgY29udGFpbmVyLnBhcnRpYWxzLCBvcHRpb25zLmRhdGEgfHwgZGF0YSwgYmxvY2tQYXJhbXMgJiYgW29wdGlvbnMuYmxvY2tQYXJhbXNdLmNvbmNhdChibG9ja1BhcmFtcyksIGN1cnJlbnREZXB0aHMpOwoJICB9CgoJICBwcm9nID0gZXhlY3V0ZURlY29yYXRvcnMoZm4sIHByb2csIGNvbnRhaW5lciwgZGVwdGhzLCBkYXRhLCBibG9ja1BhcmFtcyk7CgoJICBwcm9nLnByb2dyYW0gPSBpOwoJICBwcm9nLmRlcHRoID0gZGVwdGhzID8gZGVwdGhzLmxlbmd0aCA6IDA7CgkgIHByb2cuYmxvY2tQYXJhbXMgPSBkZWNsYXJlZEJsb2NrUGFyYW1zIHx8IDA7CgkgIHJldHVybiBwcm9nOwoJfQoKCWZ1bmN0aW9uIHJlc29sdmVQYXJ0aWFsKHBhcnRpYWwsIGNvbnRleHQsIG9wdGlvbnMpIHsKCSAgaWYgKCFwYXJ0aWFsKSB7CgkgICAgaWYgKG9wdGlvbnMubmFtZSA9PT0gJ0BwYXJ0aWFsLWJsb2NrJykgewoJICAgICAgcGFydGlhbCA9IG9wdGlvbnMuZGF0YVsncGFydGlhbC1ibG9jayddOwoJICAgIH0gZWxzZSB7CgkgICAgICBwYXJ0aWFsID0gb3B0aW9ucy5wYXJ0aWFsc1tvcHRpb25zLm5hbWVdOwoJICAgIH0KCSAgfSBlbHNlIGlmICghcGFydGlhbC5jYWxsICYmICFvcHRpb25zLm5hbWUpIHsKCSAgICAvLyBUaGlzIGlzIGEgZHluYW1pYyBwYXJ0aWFsIHRoYXQgcmV0dXJuZWQgYSBzdHJpbmcKCSAgICBvcHRpb25zLm5hbWUgPSBwYXJ0aWFsOwoJICAgIHBhcnRpYWwgPSBvcHRpb25zLnBhcnRpYWxzW3BhcnRpYWxdOwoJICB9CgkgIHJldHVybiBwYXJ0aWFsOwoJfQoKCWZ1bmN0aW9uIGludm9rZVBhcnRpYWwocGFydGlhbCwgY29udGV4dCwgb3B0aW9ucykgewoJICBvcHRpb25zLnBhcnRpYWwgPSB0cnVlOwoJICBpZiAob3B0aW9ucy5pZHMpIHsKCSAgICBvcHRpb25zLmRhdGEuY29udGV4dFBhdGggPSBvcHRpb25zLmlkc1swXSB8fCBvcHRpb25zLmRhdGEuY29udGV4dFBhdGg7CgkgIH0KCgkgIHZhciBwYXJ0aWFsQmxvY2sgPSB1bmRlZmluZWQ7CgkgIGlmIChvcHRpb25zLmZuICYmIG9wdGlvbnMuZm4gIT09IG5vb3ApIHsKCSAgICBvcHRpb25zLmRhdGEgPSBfYmFzZS5jcmVhdGVGcmFtZShvcHRpb25zLmRhdGEpOwoJICAgIHBhcnRpYWxCbG9jayA9IG9wdGlvbnMuZGF0YVsncGFydGlhbC1ibG9jayddID0gb3B0aW9ucy5mbjsKCgkgICAgaWYgKHBhcnRpYWxCbG9jay5wYXJ0aWFscykgewoJICAgICAgb3B0aW9ucy5wYXJ0aWFscyA9IFV0aWxzLmV4dGVuZCh7fSwgb3B0aW9ucy5wYXJ0aWFscywgcGFydGlhbEJsb2NrLnBhcnRpYWxzKTsKCSAgICB9CgkgIH0KCgkgIGlmIChwYXJ0aWFsID09PSB1bmRlZmluZWQgJiYgcGFydGlhbEJsb2NrKSB7CgkgICAgcGFydGlhbCA9IHBhcnRpYWxCbG9jazsKCSAgfQoKCSAgaWYgKHBhcnRpYWwgPT09IHVuZGVmaW5lZCkgewoJICAgIHRocm93IG5ldyBfZXhjZXB0aW9uMlsnZGVmYXVsdCddKCdUaGUgcGFydGlhbCAnICsgb3B0aW9ucy5uYW1lICsgJyBjb3VsZCBub3QgYmUgZm91bmQnKTsKCSAgfSBlbHNlIGlmIChwYXJ0aWFsIGluc3RhbmNlb2YgRnVuY3Rpb24pIHsKCSAgICByZXR1cm4gcGFydGlhbChjb250ZXh0LCBvcHRpb25zKTsKCSAgfQoJfQoKCWZ1bmN0aW9uIG5vb3AoKSB7CgkgIHJldHVybiAnJzsKCX0KCglmdW5jdGlvbiBpbml0RGF0YShjb250ZXh0LCBkYXRhKSB7CgkgIGlmICghZGF0YSB8fCAhKCdyb290JyBpbiBkYXRhKSkgewoJICAgIGRhdGEgPSBkYXRhID8gX2Jhc2UuY3JlYXRlRnJhbWUoZGF0YSkgOiB7fTsKCSAgICBkYXRhLnJvb3QgPSBjb250ZXh0OwoJICB9CgkgIHJldHVybiBkYXRhOwoJfQoKCWZ1bmN0aW9uIGV4ZWN1dGVEZWNvcmF0b3JzKGZuLCBwcm9nLCBjb250YWluZXIsIGRlcHRocywgZGF0YSwgYmxvY2tQYXJhbXMpIHsKCSAgaWYgKGZuLmRlY29yYXRvcikgewoJICAgIHZhciBwcm9wcyA9IHt9OwoJICAgIHByb2cgPSBmbi5kZWNvcmF0b3IocHJvZywgcHJvcHMsIGNvbnRhaW5lciwgZGVwdGhzICYmIGRlcHRoc1swXSwgZGF0YSwgYmxvY2tQYXJhbXMsIGRlcHRocyk7CgkgICAgVXRpbHMuZXh0ZW5kKHByb2csIHByb3BzKTsKCSAgfQoJICByZXR1cm4gcHJvZzsKCX0KCi8qKiovIH0sCi8qIDIwICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKCS8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsvKiBnbG9iYWwgd2luZG93ICovCgkndXNlIHN0cmljdCc7CgoJZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCglleHBvcnRzWydkZWZhdWx0J10gPSBmdW5jdGlvbiAoSGFuZGxlYmFycykgewoJICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoJICB2YXIgcm9vdCA9IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogd2luZG93LAoJICAgICAgJEhhbmRsZWJhcnMgPSByb290LkhhbmRsZWJhcnM7CgkgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgkgIEhhbmRsZWJhcnMubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsKCSAgICBpZiAocm9vdC5IYW5kbGViYXJzID09PSBIYW5kbGViYXJzKSB7CgkgICAgICByb290LkhhbmRsZWJhcnMgPSAkSGFuZGxlYmFyczsKCSAgICB9CgkgICAgcmV0dXJuIEhhbmRsZWJhcnM7CgkgIH07Cgl9OwoKCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoJLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKGV4cG9ydHMsIChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0oKSkpKQoKLyoqKi8gfSwKLyogMjEgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgoJJ3VzZSBzdHJpY3QnOwoKCWV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7Cgl2YXIgQVNUID0gewoJICAvLyBQdWJsaWMgQVBJIHVzZWQgdG8gZXZhbHVhdGUgZGVyaXZlZCBhdHRyaWJ1dGVzIHJlZ2FyZGluZyBBU1Qgbm9kZXMKCSAgaGVscGVyczogewoJICAgIC8vIGEgbXVzdGFjaGUgaXMgZGVmaW5pdGVseSBhIGhlbHBlciBpZjoKCSAgICAvLyAqIGl0IGlzIGFuIGVsaWdpYmxlIGhlbHBlciwgYW5kCgkgICAgLy8gKiBpdCBoYXMgYXQgbGVhc3Qgb25lIHBhcmFtZXRlciBvciBoYXNoIHNlZ21lbnQKCSAgICBoZWxwZXJFeHByZXNzaW9uOiBmdW5jdGlvbiBoZWxwZXJFeHByZXNzaW9uKG5vZGUpIHsKCSAgICAgIHJldHVybiBub2RlLnR5cGUgPT09ICdTdWJFeHByZXNzaW9uJyB8fCAobm9kZS50eXBlID09PSAnTXVzdGFjaGVTdGF0ZW1lbnQnIHx8IG5vZGUudHlwZSA9PT0gJ0Jsb2NrU3RhdGVtZW50JykgJiYgISEobm9kZS5wYXJhbXMgJiYgbm9kZS5wYXJhbXMubGVuZ3RoIHx8IG5vZGUuaGFzaCk7CgkgICAgfSwKCgkgICAgc2NvcGVkSWQ6IGZ1bmN0aW9uIHNjb3BlZElkKHBhdGgpIHsKCSAgICAgIHJldHVybiAoL15cLnx0aGlzXGIvLnRlc3QocGF0aC5vcmlnaW5hbCkKCSAgICAgICk7CgkgICAgfSwKCgkgICAgLy8gYW4gSUQgaXMgc2ltcGxlIGlmIGl0IG9ubHkgaGFzIG9uZSBwYXJ0LCBhbmQgdGhhdCBwYXJ0IGlzIG5vdAoJICAgIC8vIGAuLmAgb3IgYHRoaXNgLgoJICAgIHNpbXBsZUlkOiBmdW5jdGlvbiBzaW1wbGVJZChwYXRoKSB7CgkgICAgICByZXR1cm4gcGF0aC5wYXJ0cy5sZW5ndGggPT09IDEgJiYgIUFTVC5oZWxwZXJzLnNjb3BlZElkKHBhdGgpICYmICFwYXRoLmRlcHRoOwoJICAgIH0KCSAgfQoJfTsKCgkvLyBNdXN0IGJlIGV4cG9ydGVkIGFzIGFuIG9iamVjdCByYXRoZXIgdGhhbiB0aGUgcm9vdCBvZiB0aGUgbW9kdWxlIGFzIHRoZSBqaXNvbiBsZXhlcgoJLy8gbXVzdCBtb2RpZnkgdGhlIG9iamVjdCB0byBvcGVyYXRlIHByb3Blcmx5LgoJZXhwb3J0c1snZGVmYXVsdCddID0gQVNUOwoJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiAyMiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCgkndXNlIHN0cmljdCc7CgoJdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpWydkZWZhdWx0J107CgoJdmFyIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKVsnZGVmYXVsdCddOwoKCWV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CglleHBvcnRzLnBhcnNlID0gcGFyc2U7CgoJdmFyIF9wYXJzZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKTsKCgl2YXIgX3BhcnNlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9wYXJzZXIpOwoKCXZhciBfd2hpdGVzcGFjZUNvbnRyb2wgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0KTsKCgl2YXIgX3doaXRlc3BhY2VDb250cm9sMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3doaXRlc3BhY2VDb250cm9sKTsKCgl2YXIgX2hlbHBlcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI2KTsKCgl2YXIgSGVscGVycyA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKF9oZWxwZXJzKTsKCgl2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsKCglleHBvcnRzLnBhcnNlciA9IF9wYXJzZXIyWydkZWZhdWx0J107CgoJdmFyIHl5ID0ge307CglfdXRpbHMuZXh0ZW5kKHl5LCBIZWxwZXJzKTsKCglmdW5jdGlvbiBwYXJzZShpbnB1dCwgb3B0aW9ucykgewoJICAvLyBKdXN0IHJldHVybiBpZiBhbiBhbHJlYWR5LWNvbXBpbGVkIEFTVCB3YXMgcGFzc2VkIGluLgoJICBpZiAoaW5wdXQudHlwZSA9PT0gJ1Byb2dyYW0nKSB7CgkgICAgcmV0dXJuIGlucHV0OwoJICB9CgoJICBfcGFyc2VyMlsnZGVmYXVsdCddLnl5ID0geXk7CgoJICAvLyBBbHRlcmluZyB0aGUgc2hhcmVkIG9iamVjdCBoZXJlLCBidXQgdGhpcyBpcyBvayBhcyBwYXJzZXIgaXMgYSBzeW5jIG9wZXJhdGlvbgoJICB5eS5sb2NJbmZvID0gZnVuY3Rpb24gKGxvY0luZm8pIHsKCSAgICByZXR1cm4gbmV3IHl5LlNvdXJjZUxvY2F0aW9uKG9wdGlvbnMgJiYgb3B0aW9ucy5zcmNOYW1lLCBsb2NJbmZvKTsKCSAgfTsKCgkgIHZhciBzdHJpcCA9IG5ldyBfd2hpdGVzcGFjZUNvbnRyb2wyWydkZWZhdWx0J10ob3B0aW9ucyk7CgkgIHJldHVybiBzdHJpcC5hY2NlcHQoX3BhcnNlcjJbJ2RlZmF1bHQnXS5wYXJzZShpbnB1dCkpOwoJfQoKLyoqKi8gfSwKLyogMjMgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgoJLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCS8qIEppc29uIGdlbmVyYXRlZCBwYXJzZXIgKi8KCSJ1c2Ugc3RyaWN0IjsKCgl2YXIgaGFuZGxlYmFycyA9IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIHBhcnNlciA9IHsgdHJhY2U6IGZ1bmN0aW9uIHRyYWNlKCkge30sCgkgICAgICAgIHl5OiB7fSwKCSAgICAgICAgc3ltYm9sc186IHsgImVycm9yIjogMiwgInJvb3QiOiAzLCAicHJvZ3JhbSI6IDQsICJFT0YiOiA1LCAicHJvZ3JhbV9yZXBldGl0aW9uMCI6IDYsICJzdGF0ZW1lbnQiOiA3LCAibXVzdGFjaGUiOiA4LCAiYmxvY2siOiA5LCAicmF3QmxvY2siOiAxMCwgInBhcnRpYWwiOiAxMSwgInBhcnRpYWxCbG9jayI6IDEyLCAiY29udGVudCI6IDEzLCAiQ09NTUVOVCI6IDE0LCAiQ09OVEVOVCI6IDE1LCAib3BlblJhd0Jsb2NrIjogMTYsICJyYXdCbG9ja19yZXBldGl0aW9uX3BsdXMwIjogMTcsICJFTkRfUkFXX0JMT0NLIjogMTgsICJPUEVOX1JBV19CTE9DSyI6IDE5LCAiaGVscGVyTmFtZSI6IDIwLCAib3BlblJhd0Jsb2NrX3JlcGV0aXRpb24wIjogMjEsICJvcGVuUmF3QmxvY2tfb3B0aW9uMCI6IDIyLCAiQ0xPU0VfUkFXX0JMT0NLIjogMjMsICJvcGVuQmxvY2siOiAyNCwgImJsb2NrX29wdGlvbjAiOiAyNSwgImNsb3NlQmxvY2siOiAyNiwgIm9wZW5JbnZlcnNlIjogMjcsICJibG9ja19vcHRpb24xIjogMjgsICJPUEVOX0JMT0NLIjogMjksICJvcGVuQmxvY2tfcmVwZXRpdGlvbjAiOiAzMCwgIm9wZW5CbG9ja19vcHRpb24wIjogMzEsICJvcGVuQmxvY2tfb3B0aW9uMSI6IDMyLCAiQ0xPU0UiOiAzMywgIk9QRU5fSU5WRVJTRSI6IDM0LCAib3BlbkludmVyc2VfcmVwZXRpdGlvbjAiOiAzNSwgIm9wZW5JbnZlcnNlX29wdGlvbjAiOiAzNiwgIm9wZW5JbnZlcnNlX29wdGlvbjEiOiAzNywgIm9wZW5JbnZlcnNlQ2hhaW4iOiAzOCwgIk9QRU5fSU5WRVJTRV9DSEFJTiI6IDM5LCAib3BlbkludmVyc2VDaGFpbl9yZXBldGl0aW9uMCI6IDQwLCAib3BlbkludmVyc2VDaGFpbl9vcHRpb24wIjogNDEsICJvcGVuSW52ZXJzZUNoYWluX29wdGlvbjEiOiA0MiwgImludmVyc2VBbmRQcm9ncmFtIjogNDMsICJJTlZFUlNFIjogNDQsICJpbnZlcnNlQ2hhaW4iOiA0NSwgImludmVyc2VDaGFpbl9vcHRpb24wIjogNDYsICJPUEVOX0VOREJMT0NLIjogNDcsICJPUEVOIjogNDgsICJtdXN0YWNoZV9yZXBldGl0aW9uMCI6IDQ5LCAibXVzdGFjaGVfb3B0aW9uMCI6IDUwLCAiT1BFTl9VTkVTQ0FQRUQiOiA1MSwgIm11c3RhY2hlX3JlcGV0aXRpb24xIjogNTIsICJtdXN0YWNoZV9vcHRpb24xIjogNTMsICJDTE9TRV9VTkVTQ0FQRUQiOiA1NCwgIk9QRU5fUEFSVElBTCI6IDU1LCAicGFydGlhbE5hbWUiOiA1NiwgInBhcnRpYWxfcmVwZXRpdGlvbjAiOiA1NywgInBhcnRpYWxfb3B0aW9uMCI6IDU4LCAib3BlblBhcnRpYWxCbG9jayI6IDU5LCAiT1BFTl9QQVJUSUFMX0JMT0NLIjogNjAsICJvcGVuUGFydGlhbEJsb2NrX3JlcGV0aXRpb24wIjogNjEsICJvcGVuUGFydGlhbEJsb2NrX29wdGlvbjAiOiA2MiwgInBhcmFtIjogNjMsICJzZXhwciI6IDY0LCAiT1BFTl9TRVhQUiI6IDY1LCAic2V4cHJfcmVwZXRpdGlvbjAiOiA2NiwgInNleHByX29wdGlvbjAiOiA2NywgIkNMT1NFX1NFWFBSIjogNjgsICJoYXNoIjogNjksICJoYXNoX3JlcGV0aXRpb25fcGx1czAiOiA3MCwgImhhc2hTZWdtZW50IjogNzEsICJJRCI6IDcyLCAiRVFVQUxTIjogNzMsICJibG9ja1BhcmFtcyI6IDc0LCAiT1BFTl9CTE9DS19QQVJBTVMiOiA3NSwgImJsb2NrUGFyYW1zX3JlcGV0aXRpb25fcGx1czAiOiA3NiwgIkNMT1NFX0JMT0NLX1BBUkFNUyI6IDc3LCAicGF0aCI6IDc4LCAiZGF0YU5hbWUiOiA3OSwgIlNUUklORyI6IDgwLCAiTlVNQkVSIjogODEsICJCT09MRUFOIjogODIsICJVTkRFRklORUQiOiA4MywgIk5VTEwiOiA4NCwgIkRBVEEiOiA4NSwgInBhdGhTZWdtZW50cyI6IDg2LCAiU0VQIjogODcsICIkYWNjZXB0IjogMCwgIiRlbmQiOiAxIH0sCgkgICAgICAgIHRlcm1pbmFsc186IHsgMjogImVycm9yIiwgNTogIkVPRiIsIDE0OiAiQ09NTUVOVCIsIDE1OiAiQ09OVEVOVCIsIDE4OiAiRU5EX1JBV19CTE9DSyIsIDE5OiAiT1BFTl9SQVdfQkxPQ0siLCAyMzogIkNMT1NFX1JBV19CTE9DSyIsIDI5OiAiT1BFTl9CTE9DSyIsIDMzOiAiQ0xPU0UiLCAzNDogIk9QRU5fSU5WRVJTRSIsIDM5OiAiT1BFTl9JTlZFUlNFX0NIQUlOIiwgNDQ6ICJJTlZFUlNFIiwgNDc6ICJPUEVOX0VOREJMT0NLIiwgNDg6ICJPUEVOIiwgNTE6ICJPUEVOX1VORVNDQVBFRCIsIDU0OiAiQ0xPU0VfVU5FU0NBUEVEIiwgNTU6ICJPUEVOX1BBUlRJQUwiLCA2MDogIk9QRU5fUEFSVElBTF9CTE9DSyIsIDY1OiAiT1BFTl9TRVhQUiIsIDY4OiAiQ0xPU0VfU0VYUFIiLCA3MjogIklEIiwgNzM6ICJFUVVBTFMiLCA3NTogIk9QRU5fQkxPQ0tfUEFSQU1TIiwgNzc6ICJDTE9TRV9CTE9DS19QQVJBTVMiLCA4MDogIlNUUklORyIsIDgxOiAiTlVNQkVSIiwgODI6ICJCT09MRUFOIiwgODM6ICJVTkRFRklORUQiLCA4NDogIk5VTEwiLCA4NTogIkRBVEEiLCA4NzogIlNFUCIgfSwKCSAgICAgICAgcHJvZHVjdGlvbnNfOiBbMCwgWzMsIDJdLCBbNCwgMV0sIFs3LCAxXSwgWzcsIDFdLCBbNywgMV0sIFs3LCAxXSwgWzcsIDFdLCBbNywgMV0sIFs3LCAxXSwgWzEzLCAxXSwgWzEwLCAzXSwgWzE2LCA1XSwgWzksIDRdLCBbOSwgNF0sIFsyNCwgNl0sIFsyNywgNl0sIFszOCwgNl0sIFs0MywgMl0sIFs0NSwgM10sIFs0NSwgMV0sIFsyNiwgM10sIFs4LCA1XSwgWzgsIDVdLCBbMTEsIDVdLCBbMTIsIDNdLCBbNTksIDVdLCBbNjMsIDFdLCBbNjMsIDFdLCBbNjQsIDVdLCBbNjksIDFdLCBbNzEsIDNdLCBbNzQsIDNdLCBbMjAsIDFdLCBbMjAsIDFdLCBbMjAsIDFdLCBbMjAsIDFdLCBbMjAsIDFdLCBbMjAsIDFdLCBbMjAsIDFdLCBbNTYsIDFdLCBbNTYsIDFdLCBbNzksIDJdLCBbNzgsIDFdLCBbODYsIDNdLCBbODYsIDFdLCBbNiwgMF0sIFs2LCAyXSwgWzE3LCAxXSwgWzE3LCAyXSwgWzIxLCAwXSwgWzIxLCAyXSwgWzIyLCAwXSwgWzIyLCAxXSwgWzI1LCAwXSwgWzI1LCAxXSwgWzI4LCAwXSwgWzI4LCAxXSwgWzMwLCAwXSwgWzMwLCAyXSwgWzMxLCAwXSwgWzMxLCAxXSwgWzMyLCAwXSwgWzMyLCAxXSwgWzM1LCAwXSwgWzM1LCAyXSwgWzM2LCAwXSwgWzM2LCAxXSwgWzM3LCAwXSwgWzM3LCAxXSwgWzQwLCAwXSwgWzQwLCAyXSwgWzQxLCAwXSwgWzQxLCAxXSwgWzQyLCAwXSwgWzQyLCAxXSwgWzQ2LCAwXSwgWzQ2LCAxXSwgWzQ5LCAwXSwgWzQ5LCAyXSwgWzUwLCAwXSwgWzUwLCAxXSwgWzUyLCAwXSwgWzUyLCAyXSwgWzUzLCAwXSwgWzUzLCAxXSwgWzU3LCAwXSwgWzU3LCAyXSwgWzU4LCAwXSwgWzU4LCAxXSwgWzYxLCAwXSwgWzYxLCAyXSwgWzYyLCAwXSwgWzYyLCAxXSwgWzY2LCAwXSwgWzY2LCAyXSwgWzY3LCAwXSwgWzY3LCAxXSwgWzcwLCAxXSwgWzcwLCAyXSwgWzc2LCAxXSwgWzc2LCAyXV0sCgkgICAgICAgIHBlcmZvcm1BY3Rpb246IGZ1bmN0aW9uIGFub255bW91cyh5eXRleHQsIHl5bGVuZywgeXlsaW5lbm8sIHl5LCB5eXN0YXRlLCAkJCwgXyQKCSAgICAgICAgLyoqLykgewoKCSAgICAgICAgICAgIHZhciAkMCA9ICQkLmxlbmd0aCAtIDE7CgkgICAgICAgICAgICBzd2l0Y2ggKHl5c3RhdGUpIHsKCSAgICAgICAgICAgICAgICBjYXNlIDE6CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiAkJFskMCAtIDFdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDI6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IHl5LnByZXBhcmVQcm9ncmFtKCQkWyQwXSk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMzoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0gJCRbJDBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDQ6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9ICQkWyQwXTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA1OgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSAkJFskMF07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgNjoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0gJCRbJDBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDc6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9ICQkWyQwXTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA4OgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSAkJFskMF07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgOToKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0gewoJICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0NvbW1lbnRTdGF0ZW1lbnQnLAoJICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHl5LnN0cmlwQ29tbWVudCgkJFskMF0pLAoJICAgICAgICAgICAgICAgICAgICAgICAgc3RyaXA6IHl5LnN0cmlwRmxhZ3MoJCRbJDBdLCAkJFskMF0pLAoJICAgICAgICAgICAgICAgICAgICAgICAgbG9jOiB5eS5sb2NJbmZvKHRoaXMuXyQpCgkgICAgICAgICAgICAgICAgICAgIH07CgoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDEwOgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQ29udGVudFN0YXRlbWVudCcsCgkgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbDogJCRbJDBdLAoJICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICQkWyQwXSwKCSAgICAgICAgICAgICAgICAgICAgICAgIGxvYzogeXkubG9jSW5mbyh0aGlzLl8kKQoJICAgICAgICAgICAgICAgICAgICB9OwoKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAxMToKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0geXkucHJlcGFyZVJhd0Jsb2NrKCQkWyQwIC0gMl0sICQkWyQwIC0gMV0sICQkWyQwXSwgdGhpcy5fJCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMTI6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IHsgcGF0aDogJCRbJDAgLSAzXSwgcGFyYW1zOiAkJFskMCAtIDJdLCBoYXNoOiAkJFskMCAtIDFdIH07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMTM6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IHl5LnByZXBhcmVCbG9jaygkJFskMCAtIDNdLCAkJFskMCAtIDJdLCAkJFskMCAtIDFdLCAkJFskMF0sIGZhbHNlLCB0aGlzLl8kKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAxNDoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0geXkucHJlcGFyZUJsb2NrKCQkWyQwIC0gM10sICQkWyQwIC0gMl0sICQkWyQwIC0gMV0sICQkWyQwXSwgdHJ1ZSwgdGhpcy5fJCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMTU6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IHsgb3BlbjogJCRbJDAgLSA1XSwgcGF0aDogJCRbJDAgLSA0XSwgcGFyYW1zOiAkJFskMCAtIDNdLCBoYXNoOiAkJFskMCAtIDJdLCBibG9ja1BhcmFtczogJCRbJDAgLSAxXSwgc3RyaXA6IHl5LnN0cmlwRmxhZ3MoJCRbJDAgLSA1XSwgJCRbJDBdKSB9OwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDE2OgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSB7IHBhdGg6ICQkWyQwIC0gNF0sIHBhcmFtczogJCRbJDAgLSAzXSwgaGFzaDogJCRbJDAgLSAyXSwgYmxvY2tQYXJhbXM6ICQkWyQwIC0gMV0sIHN0cmlwOiB5eS5zdHJpcEZsYWdzKCQkWyQwIC0gNV0sICQkWyQwXSkgfTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAxNzoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0geyBwYXRoOiAkJFskMCAtIDRdLCBwYXJhbXM6ICQkWyQwIC0gM10sIGhhc2g6ICQkWyQwIC0gMl0sIGJsb2NrUGFyYW1zOiAkJFskMCAtIDFdLCBzdHJpcDogeXkuc3RyaXBGbGFncygkJFskMCAtIDVdLCAkJFskMF0pIH07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMTg6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IHsgc3RyaXA6IHl5LnN0cmlwRmxhZ3MoJCRbJDAgLSAxXSwgJCRbJDAgLSAxXSksIHByb2dyYW06ICQkWyQwXSB9OwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDE5OgoJICAgICAgICAgICAgICAgICAgICB2YXIgaW52ZXJzZSA9IHl5LnByZXBhcmVCbG9jaygkJFskMCAtIDJdLCAkJFskMCAtIDFdLCAkJFskMF0sICQkWyQwXSwgZmFsc2UsIHRoaXMuXyQpLAoJICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3JhbSA9IHl5LnByZXBhcmVQcm9ncmFtKFtpbnZlcnNlXSwgJCRbJDAgLSAxXS5sb2MpOwoJICAgICAgICAgICAgICAgICAgICBwcm9ncmFtLmNoYWluZWQgPSB0cnVlOwoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0geyBzdHJpcDogJCRbJDAgLSAyXS5zdHJpcCwgcHJvZ3JhbTogcHJvZ3JhbSwgY2hhaW46IHRydWUgfTsKCgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMjA6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9ICQkWyQwXTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAyMToKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0geyBwYXRoOiAkJFskMCAtIDFdLCBzdHJpcDogeXkuc3RyaXBGbGFncygkJFskMCAtIDJdLCAkJFskMF0pIH07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMjI6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IHl5LnByZXBhcmVNdXN0YWNoZSgkJFskMCAtIDNdLCAkJFskMCAtIDJdLCAkJFskMCAtIDFdLCAkJFskMCAtIDRdLCB5eS5zdHJpcEZsYWdzKCQkWyQwIC0gNF0sICQkWyQwXSksIHRoaXMuXyQpOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDIzOgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSB5eS5wcmVwYXJlTXVzdGFjaGUoJCRbJDAgLSAzXSwgJCRbJDAgLSAyXSwgJCRbJDAgLSAxXSwgJCRbJDAgLSA0XSwgeXkuc3RyaXBGbGFncygkJFskMCAtIDRdLCAkJFskMF0pLCB0aGlzLl8kKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAyNDoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0gewoJICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BhcnRpYWxTdGF0ZW1lbnQnLAoJICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJCRbJDAgLSAzXSwKCSAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogJCRbJDAgLSAyXSwKCSAgICAgICAgICAgICAgICAgICAgICAgIGhhc2g6ICQkWyQwIC0gMV0sCgkgICAgICAgICAgICAgICAgICAgICAgICBpbmRlbnQ6ICcnLAoJICAgICAgICAgICAgICAgICAgICAgICAgc3RyaXA6IHl5LnN0cmlwRmxhZ3MoJCRbJDAgLSA0XSwgJCRbJDBdKSwKCSAgICAgICAgICAgICAgICAgICAgICAgIGxvYzogeXkubG9jSW5mbyh0aGlzLl8kKQoJICAgICAgICAgICAgICAgICAgICB9OwoKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAyNToKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0geXkucHJlcGFyZVBhcnRpYWxCbG9jaygkJFskMCAtIDJdLCAkJFskMCAtIDFdLCAkJFskMF0sIHRoaXMuXyQpOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDI2OgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSB7IHBhdGg6ICQkWyQwIC0gM10sIHBhcmFtczogJCRbJDAgLSAyXSwgaGFzaDogJCRbJDAgLSAxXSwgc3RyaXA6IHl5LnN0cmlwRmxhZ3MoJCRbJDAgLSA0XSwgJCRbJDBdKSB9OwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDI3OgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSAkJFskMF07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMjg6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9ICQkWyQwXTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAyOToKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0gewoJICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1N1YkV4cHJlc3Npb24nLAoJICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJCRbJDAgLSAzXSwKCSAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogJCRbJDAgLSAyXSwKCSAgICAgICAgICAgICAgICAgICAgICAgIGhhc2g6ICQkWyQwIC0gMV0sCgkgICAgICAgICAgICAgICAgICAgICAgICBsb2M6IHl5LmxvY0luZm8odGhpcy5fJCkKCSAgICAgICAgICAgICAgICAgICAgfTsKCgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMzA6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IHsgdHlwZTogJ0hhc2gnLCBwYWlyczogJCRbJDBdLCBsb2M6IHl5LmxvY0luZm8odGhpcy5fJCkgfTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAzMToKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0geyB0eXBlOiAnSGFzaFBhaXInLCBrZXk6IHl5LmlkKCQkWyQwIC0gMl0pLCB2YWx1ZTogJCRbJDBdLCBsb2M6IHl5LmxvY0luZm8odGhpcy5fJCkgfTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAzMjoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0geXkuaWQoJCRbJDAgLSAxXSk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMzM6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9ICQkWyQwXTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAzNDoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0gJCRbJDBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDM1OgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSB7IHR5cGU6ICdTdHJpbmdMaXRlcmFsJywgdmFsdWU6ICQkWyQwXSwgb3JpZ2luYWw6ICQkWyQwXSwgbG9jOiB5eS5sb2NJbmZvKHRoaXMuXyQpIH07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMzY6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IHsgdHlwZTogJ051bWJlckxpdGVyYWwnLCB2YWx1ZTogTnVtYmVyKCQkWyQwXSksIG9yaWdpbmFsOiBOdW1iZXIoJCRbJDBdKSwgbG9jOiB5eS5sb2NJbmZvKHRoaXMuXyQpIH07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMzc6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IHsgdHlwZTogJ0Jvb2xlYW5MaXRlcmFsJywgdmFsdWU6ICQkWyQwXSA9PT0gJ3RydWUnLCBvcmlnaW5hbDogJCRbJDBdID09PSAndHJ1ZScsIGxvYzogeXkubG9jSW5mbyh0aGlzLl8kKSB9OwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDM4OgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSB7IHR5cGU6ICdVbmRlZmluZWRMaXRlcmFsJywgb3JpZ2luYWw6IHVuZGVmaW5lZCwgdmFsdWU6IHVuZGVmaW5lZCwgbG9jOiB5eS5sb2NJbmZvKHRoaXMuXyQpIH07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMzk6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IHsgdHlwZTogJ051bGxMaXRlcmFsJywgb3JpZ2luYWw6IG51bGwsIHZhbHVlOiBudWxsLCBsb2M6IHl5LmxvY0luZm8odGhpcy5fJCkgfTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA0MDoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0gJCRbJDBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDQxOgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSAkJFskMF07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgNDI6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IHl5LnByZXBhcmVQYXRoKHRydWUsICQkWyQwXSwgdGhpcy5fJCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgNDM6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IHl5LnByZXBhcmVQYXRoKGZhbHNlLCAkJFskMF0sIHRoaXMuXyQpOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDQ0OgoJICAgICAgICAgICAgICAgICAgICAkJFskMCAtIDJdLnB1c2goeyBwYXJ0OiB5eS5pZCgkJFskMF0pLCBvcmlnaW5hbDogJCRbJDBdLCBzZXBhcmF0b3I6ICQkWyQwIC0gMV0gfSk7dGhpcy4kID0gJCRbJDAgLSAyXTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA0NToKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0gW3sgcGFydDogeXkuaWQoJCRbJDBdKSwgb3JpZ2luYWw6ICQkWyQwXSB9XTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA0NjoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0gW107CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgNDc6CgkgICAgICAgICAgICAgICAgICAgICQkWyQwIC0gMV0ucHVzaCgkJFskMF0pOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDQ4OgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSBbJCRbJDBdXTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA0OToKCSAgICAgICAgICAgICAgICAgICAgJCRbJDAgLSAxXS5wdXNoKCQkWyQwXSk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgNTA6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IFtdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDUxOgoJICAgICAgICAgICAgICAgICAgICAkJFskMCAtIDFdLnB1c2goJCRbJDBdKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA1ODoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0gW107CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgNTk6CgkgICAgICAgICAgICAgICAgICAgICQkWyQwIC0gMV0ucHVzaCgkJFskMF0pOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDY0OgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSBbXTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA2NToKCSAgICAgICAgICAgICAgICAgICAgJCRbJDAgLSAxXS5wdXNoKCQkWyQwXSk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgNzA6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IFtdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDcxOgoJICAgICAgICAgICAgICAgICAgICAkJFskMCAtIDFdLnB1c2goJCRbJDBdKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA3ODoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0gW107CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgNzk6CgkgICAgICAgICAgICAgICAgICAgICQkWyQwIC0gMV0ucHVzaCgkJFskMF0pOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDgyOgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSBbXTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA4MzoKCSAgICAgICAgICAgICAgICAgICAgJCRbJDAgLSAxXS5wdXNoKCQkWyQwXSk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgODY6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IFtdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDg3OgoJICAgICAgICAgICAgICAgICAgICAkJFskMCAtIDFdLnB1c2goJCRbJDBdKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA5MDoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy4kID0gW107CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgOTE6CgkgICAgICAgICAgICAgICAgICAgICQkWyQwIC0gMV0ucHVzaCgkJFskMF0pOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDk0OgoJICAgICAgICAgICAgICAgICAgICB0aGlzLiQgPSBbXTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA5NToKCSAgICAgICAgICAgICAgICAgICAgJCRbJDAgLSAxXS5wdXNoKCQkWyQwXSk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgOTg6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IFskJFskMF1dOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDk5OgoJICAgICAgICAgICAgICAgICAgICAkJFskMCAtIDFdLnB1c2goJCRbJDBdKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAxMDA6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuJCA9IFskJFskMF1dOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDEwMToKCSAgICAgICAgICAgICAgICAgICAgJCRbJDAgLSAxXS5wdXNoKCQkWyQwXSk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgfQoJICAgICAgICB9LAoJICAgICAgICB0YWJsZTogW3sgMzogMSwgNDogMiwgNTogWzIsIDQ2XSwgNjogMywgMTQ6IFsyLCA0Nl0sIDE1OiBbMiwgNDZdLCAxOTogWzIsIDQ2XSwgMjk6IFsyLCA0Nl0sIDM0OiBbMiwgNDZdLCA0ODogWzIsIDQ2XSwgNTE6IFsyLCA0Nl0sIDU1OiBbMiwgNDZdLCA2MDogWzIsIDQ2XSB9LCB7IDE6IFszXSB9LCB7IDU6IFsxLCA0XSB9LCB7IDU6IFsyLCAyXSwgNzogNSwgODogNiwgOTogNywgMTA6IDgsIDExOiA5LCAxMjogMTAsIDEzOiAxMSwgMTQ6IFsxLCAxMl0sIDE1OiBbMSwgMjBdLCAxNjogMTcsIDE5OiBbMSwgMjNdLCAyNDogMTUsIDI3OiAxNiwgMjk6IFsxLCAyMV0sIDM0OiBbMSwgMjJdLCAzOTogWzIsIDJdLCA0NDogWzIsIDJdLCA0NzogWzIsIDJdLCA0ODogWzEsIDEzXSwgNTE6IFsxLCAxNF0sIDU1OiBbMSwgMThdLCA1OTogMTksIDYwOiBbMSwgMjRdIH0sIHsgMTogWzIsIDFdIH0sIHsgNTogWzIsIDQ3XSwgMTQ6IFsyLCA0N10sIDE1OiBbMiwgNDddLCAxOTogWzIsIDQ3XSwgMjk6IFsyLCA0N10sIDM0OiBbMiwgNDddLCAzOTogWzIsIDQ3XSwgNDQ6IFsyLCA0N10sIDQ3OiBbMiwgNDddLCA0ODogWzIsIDQ3XSwgNTE6IFsyLCA0N10sIDU1OiBbMiwgNDddLCA2MDogWzIsIDQ3XSB9LCB7IDU6IFsyLCAzXSwgMTQ6IFsyLCAzXSwgMTU6IFsyLCAzXSwgMTk6IFsyLCAzXSwgMjk6IFsyLCAzXSwgMzQ6IFsyLCAzXSwgMzk6IFsyLCAzXSwgNDQ6IFsyLCAzXSwgNDc6IFsyLCAzXSwgNDg6IFsyLCAzXSwgNTE6IFsyLCAzXSwgNTU6IFsyLCAzXSwgNjA6IFsyLCAzXSB9LCB7IDU6IFsyLCA0XSwgMTQ6IFsyLCA0XSwgMTU6IFsyLCA0XSwgMTk6IFsyLCA0XSwgMjk6IFsyLCA0XSwgMzQ6IFsyLCA0XSwgMzk6IFsyLCA0XSwgNDQ6IFsyLCA0XSwgNDc6IFsyLCA0XSwgNDg6IFsyLCA0XSwgNTE6IFsyLCA0XSwgNTU6IFsyLCA0XSwgNjA6IFsyLCA0XSB9LCB7IDU6IFsyLCA1XSwgMTQ6IFsyLCA1XSwgMTU6IFsyLCA1XSwgMTk6IFsyLCA1XSwgMjk6IFsyLCA1XSwgMzQ6IFsyLCA1XSwgMzk6IFsyLCA1XSwgNDQ6IFsyLCA1XSwgNDc6IFsyLCA1XSwgNDg6IFsyLCA1XSwgNTE6IFsyLCA1XSwgNTU6IFsyLCA1XSwgNjA6IFsyLCA1XSB9LCB7IDU6IFsyLCA2XSwgMTQ6IFsyLCA2XSwgMTU6IFsyLCA2XSwgMTk6IFsyLCA2XSwgMjk6IFsyLCA2XSwgMzQ6IFsyLCA2XSwgMzk6IFsyLCA2XSwgNDQ6IFsyLCA2XSwgNDc6IFsyLCA2XSwgNDg6IFsyLCA2XSwgNTE6IFsyLCA2XSwgNTU6IFsyLCA2XSwgNjA6IFsyLCA2XSB9LCB7IDU6IFsyLCA3XSwgMTQ6IFsyLCA3XSwgMTU6IFsyLCA3XSwgMTk6IFsyLCA3XSwgMjk6IFsyLCA3XSwgMzQ6IFsyLCA3XSwgMzk6IFsyLCA3XSwgNDQ6IFsyLCA3XSwgNDc6IFsyLCA3XSwgNDg6IFsyLCA3XSwgNTE6IFsyLCA3XSwgNTU6IFsyLCA3XSwgNjA6IFsyLCA3XSB9LCB7IDU6IFsyLCA4XSwgMTQ6IFsyLCA4XSwgMTU6IFsyLCA4XSwgMTk6IFsyLCA4XSwgMjk6IFsyLCA4XSwgMzQ6IFsyLCA4XSwgMzk6IFsyLCA4XSwgNDQ6IFsyLCA4XSwgNDc6IFsyLCA4XSwgNDg6IFsyLCA4XSwgNTE6IFsyLCA4XSwgNTU6IFsyLCA4XSwgNjA6IFsyLCA4XSB9LCB7IDU6IFsyLCA5XSwgMTQ6IFsyLCA5XSwgMTU6IFsyLCA5XSwgMTk6IFsyLCA5XSwgMjk6IFsyLCA5XSwgMzQ6IFsyLCA5XSwgMzk6IFsyLCA5XSwgNDQ6IFsyLCA5XSwgNDc6IFsyLCA5XSwgNDg6IFsyLCA5XSwgNTE6IFsyLCA5XSwgNTU6IFsyLCA5XSwgNjA6IFsyLCA5XSB9LCB7IDIwOiAyNSwgNzI6IFsxLCAzNV0sIDc4OiAyNiwgNzk6IDI3LCA4MDogWzEsIDI4XSwgODE6IFsxLCAyOV0sIDgyOiBbMSwgMzBdLCA4MzogWzEsIDMxXSwgODQ6IFsxLCAzMl0sIDg1OiBbMSwgMzRdLCA4NjogMzMgfSwgeyAyMDogMzYsIDcyOiBbMSwgMzVdLCA3ODogMjYsIDc5OiAyNywgODA6IFsxLCAyOF0sIDgxOiBbMSwgMjldLCA4MjogWzEsIDMwXSwgODM6IFsxLCAzMV0sIDg0OiBbMSwgMzJdLCA4NTogWzEsIDM0XSwgODY6IDMzIH0sIHsgNDogMzcsIDY6IDMsIDE0OiBbMiwgNDZdLCAxNTogWzIsIDQ2XSwgMTk6IFsyLCA0Nl0sIDI5OiBbMiwgNDZdLCAzNDogWzIsIDQ2XSwgMzk6IFsyLCA0Nl0sIDQ0OiBbMiwgNDZdLCA0NzogWzIsIDQ2XSwgNDg6IFsyLCA0Nl0sIDUxOiBbMiwgNDZdLCA1NTogWzIsIDQ2XSwgNjA6IFsyLCA0Nl0gfSwgeyA0OiAzOCwgNjogMywgMTQ6IFsyLCA0Nl0sIDE1OiBbMiwgNDZdLCAxOTogWzIsIDQ2XSwgMjk6IFsyLCA0Nl0sIDM0OiBbMiwgNDZdLCA0NDogWzIsIDQ2XSwgNDc6IFsyLCA0Nl0sIDQ4OiBbMiwgNDZdLCA1MTogWzIsIDQ2XSwgNTU6IFsyLCA0Nl0sIDYwOiBbMiwgNDZdIH0sIHsgMTM6IDQwLCAxNTogWzEsIDIwXSwgMTc6IDM5IH0sIHsgMjA6IDQyLCA1NjogNDEsIDY0OiA0MywgNjU6IFsxLCA0NF0sIDcyOiBbMSwgMzVdLCA3ODogMjYsIDc5OiAyNywgODA6IFsxLCAyOF0sIDgxOiBbMSwgMjldLCA4MjogWzEsIDMwXSwgODM6IFsxLCAzMV0sIDg0OiBbMSwgMzJdLCA4NTogWzEsIDM0XSwgODY6IDMzIH0sIHsgNDogNDUsIDY6IDMsIDE0OiBbMiwgNDZdLCAxNTogWzIsIDQ2XSwgMTk6IFsyLCA0Nl0sIDI5OiBbMiwgNDZdLCAzNDogWzIsIDQ2XSwgNDc6IFsyLCA0Nl0sIDQ4OiBbMiwgNDZdLCA1MTogWzIsIDQ2XSwgNTU6IFsyLCA0Nl0sIDYwOiBbMiwgNDZdIH0sIHsgNTogWzIsIDEwXSwgMTQ6IFsyLCAxMF0sIDE1OiBbMiwgMTBdLCAxODogWzIsIDEwXSwgMTk6IFsyLCAxMF0sIDI5OiBbMiwgMTBdLCAzNDogWzIsIDEwXSwgMzk6IFsyLCAxMF0sIDQ0OiBbMiwgMTBdLCA0NzogWzIsIDEwXSwgNDg6IFsyLCAxMF0sIDUxOiBbMiwgMTBdLCA1NTogWzIsIDEwXSwgNjA6IFsyLCAxMF0gfSwgeyAyMDogNDYsIDcyOiBbMSwgMzVdLCA3ODogMjYsIDc5OiAyNywgODA6IFsxLCAyOF0sIDgxOiBbMSwgMjldLCA4MjogWzEsIDMwXSwgODM6IFsxLCAzMV0sIDg0OiBbMSwgMzJdLCA4NTogWzEsIDM0XSwgODY6IDMzIH0sIHsgMjA6IDQ3LCA3MjogWzEsIDM1XSwgNzg6IDI2LCA3OTogMjcsIDgwOiBbMSwgMjhdLCA4MTogWzEsIDI5XSwgODI6IFsxLCAzMF0sIDgzOiBbMSwgMzFdLCA4NDogWzEsIDMyXSwgODU6IFsxLCAzNF0sIDg2OiAzMyB9LCB7IDIwOiA0OCwgNzI6IFsxLCAzNV0sIDc4OiAyNiwgNzk6IDI3LCA4MDogWzEsIDI4XSwgODE6IFsxLCAyOV0sIDgyOiBbMSwgMzBdLCA4MzogWzEsIDMxXSwgODQ6IFsxLCAzMl0sIDg1OiBbMSwgMzRdLCA4NjogMzMgfSwgeyAyMDogNDIsIDU2OiA0OSwgNjQ6IDQzLCA2NTogWzEsIDQ0XSwgNzI6IFsxLCAzNV0sIDc4OiAyNiwgNzk6IDI3LCA4MDogWzEsIDI4XSwgODE6IFsxLCAyOV0sIDgyOiBbMSwgMzBdLCA4MzogWzEsIDMxXSwgODQ6IFsxLCAzMl0sIDg1OiBbMSwgMzRdLCA4NjogMzMgfSwgeyAzMzogWzIsIDc4XSwgNDk6IDUwLCA2NTogWzIsIDc4XSwgNzI6IFsyLCA3OF0sIDgwOiBbMiwgNzhdLCA4MTogWzIsIDc4XSwgODI6IFsyLCA3OF0sIDgzOiBbMiwgNzhdLCA4NDogWzIsIDc4XSwgODU6IFsyLCA3OF0gfSwgeyAyMzogWzIsIDMzXSwgMzM6IFsyLCAzM10sIDU0OiBbMiwgMzNdLCA2NTogWzIsIDMzXSwgNjg6IFsyLCAzM10sIDcyOiBbMiwgMzNdLCA3NTogWzIsIDMzXSwgODA6IFsyLCAzM10sIDgxOiBbMiwgMzNdLCA4MjogWzIsIDMzXSwgODM6IFsyLCAzM10sIDg0OiBbMiwgMzNdLCA4NTogWzIsIDMzXSB9LCB7IDIzOiBbMiwgMzRdLCAzMzogWzIsIDM0XSwgNTQ6IFsyLCAzNF0sIDY1OiBbMiwgMzRdLCA2ODogWzIsIDM0XSwgNzI6IFsyLCAzNF0sIDc1OiBbMiwgMzRdLCA4MDogWzIsIDM0XSwgODE6IFsyLCAzNF0sIDgyOiBbMiwgMzRdLCA4MzogWzIsIDM0XSwgODQ6IFsyLCAzNF0sIDg1OiBbMiwgMzRdIH0sIHsgMjM6IFsyLCAzNV0sIDMzOiBbMiwgMzVdLCA1NDogWzIsIDM1XSwgNjU6IFsyLCAzNV0sIDY4OiBbMiwgMzVdLCA3MjogWzIsIDM1XSwgNzU6IFsyLCAzNV0sIDgwOiBbMiwgMzVdLCA4MTogWzIsIDM1XSwgODI6IFsyLCAzNV0sIDgzOiBbMiwgMzVdLCA4NDogWzIsIDM1XSwgODU6IFsyLCAzNV0gfSwgeyAyMzogWzIsIDM2XSwgMzM6IFsyLCAzNl0sIDU0OiBbMiwgMzZdLCA2NTogWzIsIDM2XSwgNjg6IFsyLCAzNl0sIDcyOiBbMiwgMzZdLCA3NTogWzIsIDM2XSwgODA6IFsyLCAzNl0sIDgxOiBbMiwgMzZdLCA4MjogWzIsIDM2XSwgODM6IFsyLCAzNl0sIDg0OiBbMiwgMzZdLCA4NTogWzIsIDM2XSB9LCB7IDIzOiBbMiwgMzddLCAzMzogWzIsIDM3XSwgNTQ6IFsyLCAzN10sIDY1OiBbMiwgMzddLCA2ODogWzIsIDM3XSwgNzI6IFsyLCAzN10sIDc1OiBbMiwgMzddLCA4MDogWzIsIDM3XSwgODE6IFsyLCAzN10sIDgyOiBbMiwgMzddLCA4MzogWzIsIDM3XSwgODQ6IFsyLCAzN10sIDg1OiBbMiwgMzddIH0sIHsgMjM6IFsyLCAzOF0sIDMzOiBbMiwgMzhdLCA1NDogWzIsIDM4XSwgNjU6IFsyLCAzOF0sIDY4OiBbMiwgMzhdLCA3MjogWzIsIDM4XSwgNzU6IFsyLCAzOF0sIDgwOiBbMiwgMzhdLCA4MTogWzIsIDM4XSwgODI6IFsyLCAzOF0sIDgzOiBbMiwgMzhdLCA4NDogWzIsIDM4XSwgODU6IFsyLCAzOF0gfSwgeyAyMzogWzIsIDM5XSwgMzM6IFsyLCAzOV0sIDU0OiBbMiwgMzldLCA2NTogWzIsIDM5XSwgNjg6IFsyLCAzOV0sIDcyOiBbMiwgMzldLCA3NTogWzIsIDM5XSwgODA6IFsyLCAzOV0sIDgxOiBbMiwgMzldLCA4MjogWzIsIDM5XSwgODM6IFsyLCAzOV0sIDg0OiBbMiwgMzldLCA4NTogWzIsIDM5XSB9LCB7IDIzOiBbMiwgNDNdLCAzMzogWzIsIDQzXSwgNTQ6IFsyLCA0M10sIDY1OiBbMiwgNDNdLCA2ODogWzIsIDQzXSwgNzI6IFsyLCA0M10sIDc1OiBbMiwgNDNdLCA4MDogWzIsIDQzXSwgODE6IFsyLCA0M10sIDgyOiBbMiwgNDNdLCA4MzogWzIsIDQzXSwgODQ6IFsyLCA0M10sIDg1OiBbMiwgNDNdLCA4NzogWzEsIDUxXSB9LCB7IDcyOiBbMSwgMzVdLCA4NjogNTIgfSwgeyAyMzogWzIsIDQ1XSwgMzM6IFsyLCA0NV0sIDU0OiBbMiwgNDVdLCA2NTogWzIsIDQ1XSwgNjg6IFsyLCA0NV0sIDcyOiBbMiwgNDVdLCA3NTogWzIsIDQ1XSwgODA6IFsyLCA0NV0sIDgxOiBbMiwgNDVdLCA4MjogWzIsIDQ1XSwgODM6IFsyLCA0NV0sIDg0OiBbMiwgNDVdLCA4NTogWzIsIDQ1XSwgODc6IFsyLCA0NV0gfSwgeyA1MjogNTMsIDU0OiBbMiwgODJdLCA2NTogWzIsIDgyXSwgNzI6IFsyLCA4Ml0sIDgwOiBbMiwgODJdLCA4MTogWzIsIDgyXSwgODI6IFsyLCA4Ml0sIDgzOiBbMiwgODJdLCA4NDogWzIsIDgyXSwgODU6IFsyLCA4Ml0gfSwgeyAyNTogNTQsIDM4OiA1NiwgMzk6IFsxLCA1OF0sIDQzOiA1NywgNDQ6IFsxLCA1OV0sIDQ1OiA1NSwgNDc6IFsyLCA1NF0gfSwgeyAyODogNjAsIDQzOiA2MSwgNDQ6IFsxLCA1OV0sIDQ3OiBbMiwgNTZdIH0sIHsgMTM6IDYzLCAxNTogWzEsIDIwXSwgMTg6IFsxLCA2Ml0gfSwgeyAxNTogWzIsIDQ4XSwgMTg6IFsyLCA0OF0gfSwgeyAzMzogWzIsIDg2XSwgNTc6IDY0LCA2NTogWzIsIDg2XSwgNzI6IFsyLCA4Nl0sIDgwOiBbMiwgODZdLCA4MTogWzIsIDg2XSwgODI6IFsyLCA4Nl0sIDgzOiBbMiwgODZdLCA4NDogWzIsIDg2XSwgODU6IFsyLCA4Nl0gfSwgeyAzMzogWzIsIDQwXSwgNjU6IFsyLCA0MF0sIDcyOiBbMiwgNDBdLCA4MDogWzIsIDQwXSwgODE6IFsyLCA0MF0sIDgyOiBbMiwgNDBdLCA4MzogWzIsIDQwXSwgODQ6IFsyLCA0MF0sIDg1OiBbMiwgNDBdIH0sIHsgMzM6IFsyLCA0MV0sIDY1OiBbMiwgNDFdLCA3MjogWzIsIDQxXSwgODA6IFsyLCA0MV0sIDgxOiBbMiwgNDFdLCA4MjogWzIsIDQxXSwgODM6IFsyLCA0MV0sIDg0OiBbMiwgNDFdLCA4NTogWzIsIDQxXSB9LCB7IDIwOiA2NSwgNzI6IFsxLCAzNV0sIDc4OiAyNiwgNzk6IDI3LCA4MDogWzEsIDI4XSwgODE6IFsxLCAyOV0sIDgyOiBbMSwgMzBdLCA4MzogWzEsIDMxXSwgODQ6IFsxLCAzMl0sIDg1OiBbMSwgMzRdLCA4NjogMzMgfSwgeyAyNjogNjYsIDQ3OiBbMSwgNjddIH0sIHsgMzA6IDY4LCAzMzogWzIsIDU4XSwgNjU6IFsyLCA1OF0sIDcyOiBbMiwgNThdLCA3NTogWzIsIDU4XSwgODA6IFsyLCA1OF0sIDgxOiBbMiwgNThdLCA4MjogWzIsIDU4XSwgODM6IFsyLCA1OF0sIDg0OiBbMiwgNThdLCA4NTogWzIsIDU4XSB9LCB7IDMzOiBbMiwgNjRdLCAzNTogNjksIDY1OiBbMiwgNjRdLCA3MjogWzIsIDY0XSwgNzU6IFsyLCA2NF0sIDgwOiBbMiwgNjRdLCA4MTogWzIsIDY0XSwgODI6IFsyLCA2NF0sIDgzOiBbMiwgNjRdLCA4NDogWzIsIDY0XSwgODU6IFsyLCA2NF0gfSwgeyAyMTogNzAsIDIzOiBbMiwgNTBdLCA2NTogWzIsIDUwXSwgNzI6IFsyLCA1MF0sIDgwOiBbMiwgNTBdLCA4MTogWzIsIDUwXSwgODI6IFsyLCA1MF0sIDgzOiBbMiwgNTBdLCA4NDogWzIsIDUwXSwgODU6IFsyLCA1MF0gfSwgeyAzMzogWzIsIDkwXSwgNjE6IDcxLCA2NTogWzIsIDkwXSwgNzI6IFsyLCA5MF0sIDgwOiBbMiwgOTBdLCA4MTogWzIsIDkwXSwgODI6IFsyLCA5MF0sIDgzOiBbMiwgOTBdLCA4NDogWzIsIDkwXSwgODU6IFsyLCA5MF0gfSwgeyAyMDogNzUsIDMzOiBbMiwgODBdLCA1MDogNzIsIDYzOiA3MywgNjQ6IDc2LCA2NTogWzEsIDQ0XSwgNjk6IDc0LCA3MDogNzcsIDcxOiA3OCwgNzI6IFsxLCA3OV0sIDc4OiAyNiwgNzk6IDI3LCA4MDogWzEsIDI4XSwgODE6IFsxLCAyOV0sIDgyOiBbMSwgMzBdLCA4MzogWzEsIDMxXSwgODQ6IFsxLCAzMl0sIDg1OiBbMSwgMzRdLCA4NjogMzMgfSwgeyA3MjogWzEsIDgwXSB9LCB7IDIzOiBbMiwgNDJdLCAzMzogWzIsIDQyXSwgNTQ6IFsyLCA0Ml0sIDY1OiBbMiwgNDJdLCA2ODogWzIsIDQyXSwgNzI6IFsyLCA0Ml0sIDc1OiBbMiwgNDJdLCA4MDogWzIsIDQyXSwgODE6IFsyLCA0Ml0sIDgyOiBbMiwgNDJdLCA4MzogWzIsIDQyXSwgODQ6IFsyLCA0Ml0sIDg1OiBbMiwgNDJdLCA4NzogWzEsIDUxXSB9LCB7IDIwOiA3NSwgNTM6IDgxLCA1NDogWzIsIDg0XSwgNjM6IDgyLCA2NDogNzYsIDY1OiBbMSwgNDRdLCA2OTogODMsIDcwOiA3NywgNzE6IDc4LCA3MjogWzEsIDc5XSwgNzg6IDI2LCA3OTogMjcsIDgwOiBbMSwgMjhdLCA4MTogWzEsIDI5XSwgODI6IFsxLCAzMF0sIDgzOiBbMSwgMzFdLCA4NDogWzEsIDMyXSwgODU6IFsxLCAzNF0sIDg2OiAzMyB9LCB7IDI2OiA4NCwgNDc6IFsxLCA2N10gfSwgeyA0NzogWzIsIDU1XSB9LCB7IDQ6IDg1LCA2OiAzLCAxNDogWzIsIDQ2XSwgMTU6IFsyLCA0Nl0sIDE5OiBbMiwgNDZdLCAyOTogWzIsIDQ2XSwgMzQ6IFsyLCA0Nl0sIDM5OiBbMiwgNDZdLCA0NDogWzIsIDQ2XSwgNDc6IFsyLCA0Nl0sIDQ4OiBbMiwgNDZdLCA1MTogWzIsIDQ2XSwgNTU6IFsyLCA0Nl0sIDYwOiBbMiwgNDZdIH0sIHsgNDc6IFsyLCAyMF0gfSwgeyAyMDogODYsIDcyOiBbMSwgMzVdLCA3ODogMjYsIDc5OiAyNywgODA6IFsxLCAyOF0sIDgxOiBbMSwgMjldLCA4MjogWzEsIDMwXSwgODM6IFsxLCAzMV0sIDg0OiBbMSwgMzJdLCA4NTogWzEsIDM0XSwgODY6IDMzIH0sIHsgNDogODcsIDY6IDMsIDE0OiBbMiwgNDZdLCAxNTogWzIsIDQ2XSwgMTk6IFsyLCA0Nl0sIDI5OiBbMiwgNDZdLCAzNDogWzIsIDQ2XSwgNDc6IFsyLCA0Nl0sIDQ4OiBbMiwgNDZdLCA1MTogWzIsIDQ2XSwgNTU6IFsyLCA0Nl0sIDYwOiBbMiwgNDZdIH0sIHsgMjY6IDg4LCA0NzogWzEsIDY3XSB9LCB7IDQ3OiBbMiwgNTddIH0sIHsgNTogWzIsIDExXSwgMTQ6IFsyLCAxMV0sIDE1OiBbMiwgMTFdLCAxOTogWzIsIDExXSwgMjk6IFsyLCAxMV0sIDM0OiBbMiwgMTFdLCAzOTogWzIsIDExXSwgNDQ6IFsyLCAxMV0sIDQ3OiBbMiwgMTFdLCA0ODogWzIsIDExXSwgNTE6IFsyLCAxMV0sIDU1OiBbMiwgMTFdLCA2MDogWzIsIDExXSB9LCB7IDE1OiBbMiwgNDldLCAxODogWzIsIDQ5XSB9LCB7IDIwOiA3NSwgMzM6IFsyLCA4OF0sIDU4OiA4OSwgNjM6IDkwLCA2NDogNzYsIDY1OiBbMSwgNDRdLCA2OTogOTEsIDcwOiA3NywgNzE6IDc4LCA3MjogWzEsIDc5XSwgNzg6IDI2LCA3OTogMjcsIDgwOiBbMSwgMjhdLCA4MTogWzEsIDI5XSwgODI6IFsxLCAzMF0sIDgzOiBbMSwgMzFdLCA4NDogWzEsIDMyXSwgODU6IFsxLCAzNF0sIDg2OiAzMyB9LCB7IDY1OiBbMiwgOTRdLCA2NjogOTIsIDY4OiBbMiwgOTRdLCA3MjogWzIsIDk0XSwgODA6IFsyLCA5NF0sIDgxOiBbMiwgOTRdLCA4MjogWzIsIDk0XSwgODM6IFsyLCA5NF0sIDg0OiBbMiwgOTRdLCA4NTogWzIsIDk0XSB9LCB7IDU6IFsyLCAyNV0sIDE0OiBbMiwgMjVdLCAxNTogWzIsIDI1XSwgMTk6IFsyLCAyNV0sIDI5OiBbMiwgMjVdLCAzNDogWzIsIDI1XSwgMzk6IFsyLCAyNV0sIDQ0OiBbMiwgMjVdLCA0NzogWzIsIDI1XSwgNDg6IFsyLCAyNV0sIDUxOiBbMiwgMjVdLCA1NTogWzIsIDI1XSwgNjA6IFsyLCAyNV0gfSwgeyAyMDogOTMsIDcyOiBbMSwgMzVdLCA3ODogMjYsIDc5OiAyNywgODA6IFsxLCAyOF0sIDgxOiBbMSwgMjldLCA4MjogWzEsIDMwXSwgODM6IFsxLCAzMV0sIDg0OiBbMSwgMzJdLCA4NTogWzEsIDM0XSwgODY6IDMzIH0sIHsgMjA6IDc1LCAzMTogOTQsIDMzOiBbMiwgNjBdLCA2MzogOTUsIDY0OiA3NiwgNjU6IFsxLCA0NF0sIDY5OiA5NiwgNzA6IDc3LCA3MTogNzgsIDcyOiBbMSwgNzldLCA3NTogWzIsIDYwXSwgNzg6IDI2LCA3OTogMjcsIDgwOiBbMSwgMjhdLCA4MTogWzEsIDI5XSwgODI6IFsxLCAzMF0sIDgzOiBbMSwgMzFdLCA4NDogWzEsIDMyXSwgODU6IFsxLCAzNF0sIDg2OiAzMyB9LCB7IDIwOiA3NSwgMzM6IFsyLCA2Nl0sIDM2OiA5NywgNjM6IDk4LCA2NDogNzYsIDY1OiBbMSwgNDRdLCA2OTogOTksIDcwOiA3NywgNzE6IDc4LCA3MjogWzEsIDc5XSwgNzU6IFsyLCA2Nl0sIDc4OiAyNiwgNzk6IDI3LCA4MDogWzEsIDI4XSwgODE6IFsxLCAyOV0sIDgyOiBbMSwgMzBdLCA4MzogWzEsIDMxXSwgODQ6IFsxLCAzMl0sIDg1OiBbMSwgMzRdLCA4NjogMzMgfSwgeyAyMDogNzUsIDIyOiAxMDAsIDIzOiBbMiwgNTJdLCA2MzogMTAxLCA2NDogNzYsIDY1OiBbMSwgNDRdLCA2OTogMTAyLCA3MDogNzcsIDcxOiA3OCwgNzI6IFsxLCA3OV0sIDc4OiAyNiwgNzk6IDI3LCA4MDogWzEsIDI4XSwgODE6IFsxLCAyOV0sIDgyOiBbMSwgMzBdLCA4MzogWzEsIDMxXSwgODQ6IFsxLCAzMl0sIDg1OiBbMSwgMzRdLCA4NjogMzMgfSwgeyAyMDogNzUsIDMzOiBbMiwgOTJdLCA2MjogMTAzLCA2MzogMTA0LCA2NDogNzYsIDY1OiBbMSwgNDRdLCA2OTogMTA1LCA3MDogNzcsIDcxOiA3OCwgNzI6IFsxLCA3OV0sIDc4OiAyNiwgNzk6IDI3LCA4MDogWzEsIDI4XSwgODE6IFsxLCAyOV0sIDgyOiBbMSwgMzBdLCA4MzogWzEsIDMxXSwgODQ6IFsxLCAzMl0sIDg1OiBbMSwgMzRdLCA4NjogMzMgfSwgeyAzMzogWzEsIDEwNl0gfSwgeyAzMzogWzIsIDc5XSwgNjU6IFsyLCA3OV0sIDcyOiBbMiwgNzldLCA4MDogWzIsIDc5XSwgODE6IFsyLCA3OV0sIDgyOiBbMiwgNzldLCA4MzogWzIsIDc5XSwgODQ6IFsyLCA3OV0sIDg1OiBbMiwgNzldIH0sIHsgMzM6IFsyLCA4MV0gfSwgeyAyMzogWzIsIDI3XSwgMzM6IFsyLCAyN10sIDU0OiBbMiwgMjddLCA2NTogWzIsIDI3XSwgNjg6IFsyLCAyN10sIDcyOiBbMiwgMjddLCA3NTogWzIsIDI3XSwgODA6IFsyLCAyN10sIDgxOiBbMiwgMjddLCA4MjogWzIsIDI3XSwgODM6IFsyLCAyN10sIDg0OiBbMiwgMjddLCA4NTogWzIsIDI3XSB9LCB7IDIzOiBbMiwgMjhdLCAzMzogWzIsIDI4XSwgNTQ6IFsyLCAyOF0sIDY1OiBbMiwgMjhdLCA2ODogWzIsIDI4XSwgNzI6IFsyLCAyOF0sIDc1OiBbMiwgMjhdLCA4MDogWzIsIDI4XSwgODE6IFsyLCAyOF0sIDgyOiBbMiwgMjhdLCA4MzogWzIsIDI4XSwgODQ6IFsyLCAyOF0sIDg1OiBbMiwgMjhdIH0sIHsgMjM6IFsyLCAzMF0sIDMzOiBbMiwgMzBdLCA1NDogWzIsIDMwXSwgNjg6IFsyLCAzMF0sIDcxOiAxMDcsIDcyOiBbMSwgMTA4XSwgNzU6IFsyLCAzMF0gfSwgeyAyMzogWzIsIDk4XSwgMzM6IFsyLCA5OF0sIDU0OiBbMiwgOThdLCA2ODogWzIsIDk4XSwgNzI6IFsyLCA5OF0sIDc1OiBbMiwgOThdIH0sIHsgMjM6IFsyLCA0NV0sIDMzOiBbMiwgNDVdLCA1NDogWzIsIDQ1XSwgNjU6IFsyLCA0NV0sIDY4OiBbMiwgNDVdLCA3MjogWzIsIDQ1XSwgNzM6IFsxLCAxMDldLCA3NTogWzIsIDQ1XSwgODA6IFsyLCA0NV0sIDgxOiBbMiwgNDVdLCA4MjogWzIsIDQ1XSwgODM6IFsyLCA0NV0sIDg0OiBbMiwgNDVdLCA4NTogWzIsIDQ1XSwgODc6IFsyLCA0NV0gfSwgeyAyMzogWzIsIDQ0XSwgMzM6IFsyLCA0NF0sIDU0OiBbMiwgNDRdLCA2NTogWzIsIDQ0XSwgNjg6IFsyLCA0NF0sIDcyOiBbMiwgNDRdLCA3NTogWzIsIDQ0XSwgODA6IFsyLCA0NF0sIDgxOiBbMiwgNDRdLCA4MjogWzIsIDQ0XSwgODM6IFsyLCA0NF0sIDg0OiBbMiwgNDRdLCA4NTogWzIsIDQ0XSwgODc6IFsyLCA0NF0gfSwgeyA1NDogWzEsIDExMF0gfSwgeyA1NDogWzIsIDgzXSwgNjU6IFsyLCA4M10sIDcyOiBbMiwgODNdLCA4MDogWzIsIDgzXSwgODE6IFsyLCA4M10sIDgyOiBbMiwgODNdLCA4MzogWzIsIDgzXSwgODQ6IFsyLCA4M10sIDg1OiBbMiwgODNdIH0sIHsgNTQ6IFsyLCA4NV0gfSwgeyA1OiBbMiwgMTNdLCAxNDogWzIsIDEzXSwgMTU6IFsyLCAxM10sIDE5OiBbMiwgMTNdLCAyOTogWzIsIDEzXSwgMzQ6IFsyLCAxM10sIDM5OiBbMiwgMTNdLCA0NDogWzIsIDEzXSwgNDc6IFsyLCAxM10sIDQ4OiBbMiwgMTNdLCA1MTogWzIsIDEzXSwgNTU6IFsyLCAxM10sIDYwOiBbMiwgMTNdIH0sIHsgMzg6IDU2LCAzOTogWzEsIDU4XSwgNDM6IDU3LCA0NDogWzEsIDU5XSwgNDU6IDExMiwgNDY6IDExMSwgNDc6IFsyLCA3Nl0gfSwgeyAzMzogWzIsIDcwXSwgNDA6IDExMywgNjU6IFsyLCA3MF0sIDcyOiBbMiwgNzBdLCA3NTogWzIsIDcwXSwgODA6IFsyLCA3MF0sIDgxOiBbMiwgNzBdLCA4MjogWzIsIDcwXSwgODM6IFsyLCA3MF0sIDg0OiBbMiwgNzBdLCA4NTogWzIsIDcwXSB9LCB7IDQ3OiBbMiwgMThdIH0sIHsgNTogWzIsIDE0XSwgMTQ6IFsyLCAxNF0sIDE1OiBbMiwgMTRdLCAxOTogWzIsIDE0XSwgMjk6IFsyLCAxNF0sIDM0OiBbMiwgMTRdLCAzOTogWzIsIDE0XSwgNDQ6IFsyLCAxNF0sIDQ3OiBbMiwgMTRdLCA0ODogWzIsIDE0XSwgNTE6IFsyLCAxNF0sIDU1OiBbMiwgMTRdLCA2MDogWzIsIDE0XSB9LCB7IDMzOiBbMSwgMTE0XSB9LCB7IDMzOiBbMiwgODddLCA2NTogWzIsIDg3XSwgNzI6IFsyLCA4N10sIDgwOiBbMiwgODddLCA4MTogWzIsIDg3XSwgODI6IFsyLCA4N10sIDgzOiBbMiwgODddLCA4NDogWzIsIDg3XSwgODU6IFsyLCA4N10gfSwgeyAzMzogWzIsIDg5XSB9LCB7IDIwOiA3NSwgNjM6IDExNiwgNjQ6IDc2LCA2NTogWzEsIDQ0XSwgNjc6IDExNSwgNjg6IFsyLCA5Nl0sIDY5OiAxMTcsIDcwOiA3NywgNzE6IDc4LCA3MjogWzEsIDc5XSwgNzg6IDI2LCA3OTogMjcsIDgwOiBbMSwgMjhdLCA4MTogWzEsIDI5XSwgODI6IFsxLCAzMF0sIDgzOiBbMSwgMzFdLCA4NDogWzEsIDMyXSwgODU6IFsxLCAzNF0sIDg2OiAzMyB9LCB7IDMzOiBbMSwgMTE4XSB9LCB7IDMyOiAxMTksIDMzOiBbMiwgNjJdLCA3NDogMTIwLCA3NTogWzEsIDEyMV0gfSwgeyAzMzogWzIsIDU5XSwgNjU6IFsyLCA1OV0sIDcyOiBbMiwgNTldLCA3NTogWzIsIDU5XSwgODA6IFsyLCA1OV0sIDgxOiBbMiwgNTldLCA4MjogWzIsIDU5XSwgODM6IFsyLCA1OV0sIDg0OiBbMiwgNTldLCA4NTogWzIsIDU5XSB9LCB7IDMzOiBbMiwgNjFdLCA3NTogWzIsIDYxXSB9LCB7IDMzOiBbMiwgNjhdLCAzNzogMTIyLCA3NDogMTIzLCA3NTogWzEsIDEyMV0gfSwgeyAzMzogWzIsIDY1XSwgNjU6IFsyLCA2NV0sIDcyOiBbMiwgNjVdLCA3NTogWzIsIDY1XSwgODA6IFsyLCA2NV0sIDgxOiBbMiwgNjVdLCA4MjogWzIsIDY1XSwgODM6IFsyLCA2NV0sIDg0OiBbMiwgNjVdLCA4NTogWzIsIDY1XSB9LCB7IDMzOiBbMiwgNjddLCA3NTogWzIsIDY3XSB9LCB7IDIzOiBbMSwgMTI0XSB9LCB7IDIzOiBbMiwgNTFdLCA2NTogWzIsIDUxXSwgNzI6IFsyLCA1MV0sIDgwOiBbMiwgNTFdLCA4MTogWzIsIDUxXSwgODI6IFsyLCA1MV0sIDgzOiBbMiwgNTFdLCA4NDogWzIsIDUxXSwgODU6IFsyLCA1MV0gfSwgeyAyMzogWzIsIDUzXSB9LCB7IDMzOiBbMSwgMTI1XSB9LCB7IDMzOiBbMiwgOTFdLCA2NTogWzIsIDkxXSwgNzI6IFsyLCA5MV0sIDgwOiBbMiwgOTFdLCA4MTogWzIsIDkxXSwgODI6IFsyLCA5MV0sIDgzOiBbMiwgOTFdLCA4NDogWzIsIDkxXSwgODU6IFsyLCA5MV0gfSwgeyAzMzogWzIsIDkzXSB9LCB7IDU6IFsyLCAyMl0sIDE0OiBbMiwgMjJdLCAxNTogWzIsIDIyXSwgMTk6IFsyLCAyMl0sIDI5OiBbMiwgMjJdLCAzNDogWzIsIDIyXSwgMzk6IFsyLCAyMl0sIDQ0OiBbMiwgMjJdLCA0NzogWzIsIDIyXSwgNDg6IFsyLCAyMl0sIDUxOiBbMiwgMjJdLCA1NTogWzIsIDIyXSwgNjA6IFsyLCAyMl0gfSwgeyAyMzogWzIsIDk5XSwgMzM6IFsyLCA5OV0sIDU0OiBbMiwgOTldLCA2ODogWzIsIDk5XSwgNzI6IFsyLCA5OV0sIDc1OiBbMiwgOTldIH0sIHsgNzM6IFsxLCAxMDldIH0sIHsgMjA6IDc1LCA2MzogMTI2LCA2NDogNzYsIDY1OiBbMSwgNDRdLCA3MjogWzEsIDM1XSwgNzg6IDI2LCA3OTogMjcsIDgwOiBbMSwgMjhdLCA4MTogWzEsIDI5XSwgODI6IFsxLCAzMF0sIDgzOiBbMSwgMzFdLCA4NDogWzEsIDMyXSwgODU6IFsxLCAzNF0sIDg2OiAzMyB9LCB7IDU6IFsyLCAyM10sIDE0OiBbMiwgMjNdLCAxNTogWzIsIDIzXSwgMTk6IFsyLCAyM10sIDI5OiBbMiwgMjNdLCAzNDogWzIsIDIzXSwgMzk6IFsyLCAyM10sIDQ0OiBbMiwgMjNdLCA0NzogWzIsIDIzXSwgNDg6IFsyLCAyM10sIDUxOiBbMiwgMjNdLCA1NTogWzIsIDIzXSwgNjA6IFsyLCAyM10gfSwgeyA0NzogWzIsIDE5XSB9LCB7IDQ3OiBbMiwgNzddIH0sIHsgMjA6IDc1LCAzMzogWzIsIDcyXSwgNDE6IDEyNywgNjM6IDEyOCwgNjQ6IDc2LCA2NTogWzEsIDQ0XSwgNjk6IDEyOSwgNzA6IDc3LCA3MTogNzgsIDcyOiBbMSwgNzldLCA3NTogWzIsIDcyXSwgNzg6IDI2LCA3OTogMjcsIDgwOiBbMSwgMjhdLCA4MTogWzEsIDI5XSwgODI6IFsxLCAzMF0sIDgzOiBbMSwgMzFdLCA4NDogWzEsIDMyXSwgODU6IFsxLCAzNF0sIDg2OiAzMyB9LCB7IDU6IFsyLCAyNF0sIDE0OiBbMiwgMjRdLCAxNTogWzIsIDI0XSwgMTk6IFsyLCAyNF0sIDI5OiBbMiwgMjRdLCAzNDogWzIsIDI0XSwgMzk6IFsyLCAyNF0sIDQ0OiBbMiwgMjRdLCA0NzogWzIsIDI0XSwgNDg6IFsyLCAyNF0sIDUxOiBbMiwgMjRdLCA1NTogWzIsIDI0XSwgNjA6IFsyLCAyNF0gfSwgeyA2ODogWzEsIDEzMF0gfSwgeyA2NTogWzIsIDk1XSwgNjg6IFsyLCA5NV0sIDcyOiBbMiwgOTVdLCA4MDogWzIsIDk1XSwgODE6IFsyLCA5NV0sIDgyOiBbMiwgOTVdLCA4MzogWzIsIDk1XSwgODQ6IFsyLCA5NV0sIDg1OiBbMiwgOTVdIH0sIHsgNjg6IFsyLCA5N10gfSwgeyA1OiBbMiwgMjFdLCAxNDogWzIsIDIxXSwgMTU6IFsyLCAyMV0sIDE5OiBbMiwgMjFdLCAyOTogWzIsIDIxXSwgMzQ6IFsyLCAyMV0sIDM5OiBbMiwgMjFdLCA0NDogWzIsIDIxXSwgNDc6IFsyLCAyMV0sIDQ4OiBbMiwgMjFdLCA1MTogWzIsIDIxXSwgNTU6IFsyLCAyMV0sIDYwOiBbMiwgMjFdIH0sIHsgMzM6IFsxLCAxMzFdIH0sIHsgMzM6IFsyLCA2M10gfSwgeyA3MjogWzEsIDEzM10sIDc2OiAxMzIgfSwgeyAzMzogWzEsIDEzNF0gfSwgeyAzMzogWzIsIDY5XSB9LCB7IDE1OiBbMiwgMTJdIH0sIHsgMTQ6IFsyLCAyNl0sIDE1OiBbMiwgMjZdLCAxOTogWzIsIDI2XSwgMjk6IFsyLCAyNl0sIDM0OiBbMiwgMjZdLCA0NzogWzIsIDI2XSwgNDg6IFsyLCAyNl0sIDUxOiBbMiwgMjZdLCA1NTogWzIsIDI2XSwgNjA6IFsyLCAyNl0gfSwgeyAyMzogWzIsIDMxXSwgMzM6IFsyLCAzMV0sIDU0OiBbMiwgMzFdLCA2ODogWzIsIDMxXSwgNzI6IFsyLCAzMV0sIDc1OiBbMiwgMzFdIH0sIHsgMzM6IFsyLCA3NF0sIDQyOiAxMzUsIDc0OiAxMzYsIDc1OiBbMSwgMTIxXSB9LCB7IDMzOiBbMiwgNzFdLCA2NTogWzIsIDcxXSwgNzI6IFsyLCA3MV0sIDc1OiBbMiwgNzFdLCA4MDogWzIsIDcxXSwgODE6IFsyLCA3MV0sIDgyOiBbMiwgNzFdLCA4MzogWzIsIDcxXSwgODQ6IFsyLCA3MV0sIDg1OiBbMiwgNzFdIH0sIHsgMzM6IFsyLCA3M10sIDc1OiBbMiwgNzNdIH0sIHsgMjM6IFsyLCAyOV0sIDMzOiBbMiwgMjldLCA1NDogWzIsIDI5XSwgNjU6IFsyLCAyOV0sIDY4OiBbMiwgMjldLCA3MjogWzIsIDI5XSwgNzU6IFsyLCAyOV0sIDgwOiBbMiwgMjldLCA4MTogWzIsIDI5XSwgODI6IFsyLCAyOV0sIDgzOiBbMiwgMjldLCA4NDogWzIsIDI5XSwgODU6IFsyLCAyOV0gfSwgeyAxNDogWzIsIDE1XSwgMTU6IFsyLCAxNV0sIDE5OiBbMiwgMTVdLCAyOTogWzIsIDE1XSwgMzQ6IFsyLCAxNV0sIDM5OiBbMiwgMTVdLCA0NDogWzIsIDE1XSwgNDc6IFsyLCAxNV0sIDQ4OiBbMiwgMTVdLCA1MTogWzIsIDE1XSwgNTU6IFsyLCAxNV0sIDYwOiBbMiwgMTVdIH0sIHsgNzI6IFsxLCAxMzhdLCA3NzogWzEsIDEzN10gfSwgeyA3MjogWzIsIDEwMF0sIDc3OiBbMiwgMTAwXSB9LCB7IDE0OiBbMiwgMTZdLCAxNTogWzIsIDE2XSwgMTk6IFsyLCAxNl0sIDI5OiBbMiwgMTZdLCAzNDogWzIsIDE2XSwgNDQ6IFsyLCAxNl0sIDQ3OiBbMiwgMTZdLCA0ODogWzIsIDE2XSwgNTE6IFsyLCAxNl0sIDU1OiBbMiwgMTZdLCA2MDogWzIsIDE2XSB9LCB7IDMzOiBbMSwgMTM5XSB9LCB7IDMzOiBbMiwgNzVdIH0sIHsgMzM6IFsyLCAzMl0gfSwgeyA3MjogWzIsIDEwMV0sIDc3OiBbMiwgMTAxXSB9LCB7IDE0OiBbMiwgMTddLCAxNTogWzIsIDE3XSwgMTk6IFsyLCAxN10sIDI5OiBbMiwgMTddLCAzNDogWzIsIDE3XSwgMzk6IFsyLCAxN10sIDQ0OiBbMiwgMTddLCA0NzogWzIsIDE3XSwgNDg6IFsyLCAxN10sIDUxOiBbMiwgMTddLCA1NTogWzIsIDE3XSwgNjA6IFsyLCAxN10gfV0sCgkgICAgICAgIGRlZmF1bHRBY3Rpb25zOiB7IDQ6IFsyLCAxXSwgNTU6IFsyLCA1NV0sIDU3OiBbMiwgMjBdLCA2MTogWzIsIDU3XSwgNzQ6IFsyLCA4MV0sIDgzOiBbMiwgODVdLCA4NzogWzIsIDE4XSwgOTE6IFsyLCA4OV0sIDEwMjogWzIsIDUzXSwgMTA1OiBbMiwgOTNdLCAxMTE6IFsyLCAxOV0sIDExMjogWzIsIDc3XSwgMTE3OiBbMiwgOTddLCAxMjA6IFsyLCA2M10sIDEyMzogWzIsIDY5XSwgMTI0OiBbMiwgMTJdLCAxMzY6IFsyLCA3NV0sIDEzNzogWzIsIDMyXSB9LAoJICAgICAgICBwYXJzZUVycm9yOiBmdW5jdGlvbiBwYXJzZUVycm9yKHN0ciwgaGFzaCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHN0cik7CgkgICAgICAgIH0sCgkgICAgICAgIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShpbnB1dCkgewoJICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLAoJICAgICAgICAgICAgICAgIHN0YWNrID0gWzBdLAoJICAgICAgICAgICAgICAgIHZzdGFjayA9IFtudWxsXSwKCSAgICAgICAgICAgICAgICBsc3RhY2sgPSBbXSwKCSAgICAgICAgICAgICAgICB0YWJsZSA9IHRoaXMudGFibGUsCgkgICAgICAgICAgICAgICAgeXl0ZXh0ID0gIiIsCgkgICAgICAgICAgICAgICAgeXlsaW5lbm8gPSAwLAoJICAgICAgICAgICAgICAgIHl5bGVuZyA9IDAsCgkgICAgICAgICAgICAgICAgcmVjb3ZlcmluZyA9IDAsCgkgICAgICAgICAgICAgICAgVEVSUk9SID0gMiwKCSAgICAgICAgICAgICAgICBFT0YgPSAxOwoJICAgICAgICAgICAgdGhpcy5sZXhlci5zZXRJbnB1dChpbnB1dCk7CgkgICAgICAgICAgICB0aGlzLmxleGVyLnl5ID0gdGhpcy55eTsKCSAgICAgICAgICAgIHRoaXMueXkubGV4ZXIgPSB0aGlzLmxleGVyOwoJICAgICAgICAgICAgdGhpcy55eS5wYXJzZXIgPSB0aGlzOwoJICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmxleGVyLnl5bGxvYyA9PSAidW5kZWZpbmVkIikgdGhpcy5sZXhlci55eWxsb2MgPSB7fTsKCSAgICAgICAgICAgIHZhciB5eWxvYyA9IHRoaXMubGV4ZXIueXlsbG9jOwoJICAgICAgICAgICAgbHN0YWNrLnB1c2goeXlsb2MpOwoJICAgICAgICAgICAgdmFyIHJhbmdlcyA9IHRoaXMubGV4ZXIub3B0aW9ucyAmJiB0aGlzLmxleGVyLm9wdGlvbnMucmFuZ2VzOwoJICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnl5LnBhcnNlRXJyb3IgPT09ICJmdW5jdGlvbiIpIHRoaXMucGFyc2VFcnJvciA9IHRoaXMueXkucGFyc2VFcnJvcjsKCSAgICAgICAgICAgIGZ1bmN0aW9uIHBvcFN0YWNrKG4pIHsKCSAgICAgICAgICAgICAgICBzdGFjay5sZW5ndGggPSBzdGFjay5sZW5ndGggLSAyICogbjsKCSAgICAgICAgICAgICAgICB2c3RhY2subGVuZ3RoID0gdnN0YWNrLmxlbmd0aCAtIG47CgkgICAgICAgICAgICAgICAgbHN0YWNrLmxlbmd0aCA9IGxzdGFjay5sZW5ndGggLSBuOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZnVuY3Rpb24gbGV4KCkgewoJICAgICAgICAgICAgICAgIHZhciB0b2tlbjsKCSAgICAgICAgICAgICAgICB0b2tlbiA9IHNlbGYubGV4ZXIubGV4KCkgfHwgMTsKCSAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRva2VuICE9PSAibnVtYmVyIikgewoJICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHNlbGYuc3ltYm9sc19bdG9rZW5dIHx8IHRva2VuOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXR1cm4gdG9rZW47CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgc3ltYm9sLAoJICAgICAgICAgICAgICAgIHByZUVycm9yU3ltYm9sLAoJICAgICAgICAgICAgICAgIHN0YXRlLAoJICAgICAgICAgICAgICAgIGFjdGlvbiwKCSAgICAgICAgICAgICAgICBhLAoJICAgICAgICAgICAgICAgIHIsCgkgICAgICAgICAgICAgICAgeXl2YWwgPSB7fSwKCSAgICAgICAgICAgICAgICBwLAoJICAgICAgICAgICAgICAgIGxlbiwKCSAgICAgICAgICAgICAgICBuZXdTdGF0ZSwKCSAgICAgICAgICAgICAgICBleHBlY3RlZDsKCSAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CgkgICAgICAgICAgICAgICAgc3RhdGUgPSBzdGFja1tzdGFjay5sZW5ndGggLSAxXTsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWZhdWx0QWN0aW9uc1tzdGF0ZV0pIHsKCSAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gdGhpcy5kZWZhdWx0QWN0aW9uc1tzdGF0ZV07CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHN5bWJvbCA9PT0gbnVsbCB8fCB0eXBlb2Ygc3ltYm9sID09ICJ1bmRlZmluZWQiKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzeW1ib2wgPSBsZXgoKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSB0YWJsZVtzdGF0ZV0gJiYgdGFibGVbc3RhdGVdW3N5bWJvbF07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYWN0aW9uID09PSAidW5kZWZpbmVkIiB8fCAhYWN0aW9uLmxlbmd0aCB8fCAhYWN0aW9uWzBdKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBlcnJTdHIgPSAiIjsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCFyZWNvdmVyaW5nKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZCA9IFtdOwoJICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChwIGluIHRhYmxlW3N0YXRlXSkgaWYgKHRoaXMudGVybWluYWxzX1twXSAmJiBwID4gMikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkLnB1c2goIiciICsgdGhpcy50ZXJtaW5hbHNfW3BdICsgIiciKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxleGVyLnNob3dQb3NpdGlvbikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVyclN0ciA9ICJQYXJzZSBlcnJvciBvbiBsaW5lICIgKyAoeXlsaW5lbm8gKyAxKSArICI6XG4iICsgdGhpcy5sZXhlci5zaG93UG9zaXRpb24oKSArICJcbkV4cGVjdGluZyAiICsgZXhwZWN0ZWQuam9pbigiLCAiKSArICIsIGdvdCAnIiArICh0aGlzLnRlcm1pbmFsc19bc3ltYm9sXSB8fCBzeW1ib2wpICsgIiciOwoJICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJTdHIgPSAiUGFyc2UgZXJyb3Igb24gbGluZSAiICsgKHl5bGluZW5vICsgMSkgKyAiOiBVbmV4cGVjdGVkICIgKyAoc3ltYm9sID09IDEgPyAiZW5kIG9mIGlucHV0IiA6ICInIiArICh0aGlzLnRlcm1pbmFsc19bc3ltYm9sXSB8fCBzeW1ib2wpICsgIiciKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2VFcnJvcihlcnJTdHIsIHsgdGV4dDogdGhpcy5sZXhlci5tYXRjaCwgdG9rZW46IHRoaXMudGVybWluYWxzX1tzeW1ib2xdIHx8IHN5bWJvbCwgbGluZTogdGhpcy5sZXhlci55eWxpbmVubywgbG9jOiB5eWxvYywgZXhwZWN0ZWQ6IGV4cGVjdGVkIH0pOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChhY3Rpb25bMF0gaW5zdGFuY2VvZiBBcnJheSAmJiBhY3Rpb24ubGVuZ3RoID4gMSkgewoJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBhcnNlIEVycm9yOiBtdWx0aXBsZSBhY3Rpb25zIHBvc3NpYmxlIGF0IHN0YXRlOiAiICsgc3RhdGUgKyAiLCB0b2tlbjogIiArIHN5bWJvbCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHN3aXRjaCAoYWN0aW9uWzBdKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goc3ltYm9sKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZzdGFjay5wdXNoKHRoaXMubGV4ZXIueXl0ZXh0KTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGxzdGFjay5wdXNoKHRoaXMubGV4ZXIueXlsbG9jKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYWN0aW9uWzFdKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbCA9IG51bGw7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByZUVycm9yU3ltYm9sKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgeXlsZW5nID0gdGhpcy5sZXhlci55eWxlbmc7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgeXl0ZXh0ID0gdGhpcy5sZXhlci55eXRleHQ7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgeXlsaW5lbm8gPSB0aGlzLmxleGVyLnl5bGluZW5vOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl5bG9jID0gdGhpcy5sZXhlci55eWxsb2M7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlY292ZXJpbmcgPiAwKSByZWNvdmVyaW5nLS07CgkgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbCA9IHByZUVycm9yU3ltYm9sOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZUVycm9yU3ltYm9sID0gbnVsbDsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CgkgICAgICAgICAgICAgICAgICAgICAgICBsZW4gPSB0aGlzLnByb2R1Y3Rpb25zX1thY3Rpb25bMV1dWzFdOwoJICAgICAgICAgICAgICAgICAgICAgICAgeXl2YWwuJCA9IHZzdGFja1t2c3RhY2subGVuZ3RoIC0gbGVuXTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHl5dmFsLl8kID0geyBmaXJzdF9saW5lOiBsc3RhY2tbbHN0YWNrLmxlbmd0aCAtIChsZW4gfHwgMSldLmZpcnN0X2xpbmUsIGxhc3RfbGluZTogbHN0YWNrW2xzdGFjay5sZW5ndGggLSAxXS5sYXN0X2xpbmUsIGZpcnN0X2NvbHVtbjogbHN0YWNrW2xzdGFjay5sZW5ndGggLSAobGVuIHx8IDEpXS5maXJzdF9jb2x1bW4sIGxhc3RfY29sdW1uOiBsc3RhY2tbbHN0YWNrLmxlbmd0aCAtIDFdLmxhc3RfY29sdW1uIH07CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmFuZ2VzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgeXl2YWwuXyQucmFuZ2UgPSBbbHN0YWNrW2xzdGFjay5sZW5ndGggLSAobGVuIHx8IDEpXS5yYW5nZVswXSwgbHN0YWNrW2xzdGFjay5sZW5ndGggLSAxXS5yYW5nZVsxXV07CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICByID0gdGhpcy5wZXJmb3JtQWN0aW9uLmNhbGwoeXl2YWwsIHl5dGV4dCwgeXlsZW5nLCB5eWxpbmVubywgdGhpcy55eSwgYWN0aW9uWzFdLCB2c3RhY2ssIGxzdGFjayk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHIgIT09ICJ1bmRlZmluZWQiKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHI7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGVuKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sgPSBzdGFjay5zbGljZSgwLCAtMSAqIGxlbiAqIDIpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZzdGFjayA9IHZzdGFjay5zbGljZSgwLCAtMSAqIGxlbik7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbHN0YWNrID0gbHN0YWNrLnNsaWNlKDAsIC0xICogbGVuKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2godGhpcy5wcm9kdWN0aW9uc19bYWN0aW9uWzFdXVswXSk7CgkgICAgICAgICAgICAgICAgICAgICAgICB2c3RhY2sucHVzaCh5eXZhbC4kKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGxzdGFjay5wdXNoKHl5dmFsLl8kKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIG5ld1N0YXRlID0gdGFibGVbc3RhY2tbc3RhY2subGVuZ3RoIC0gMl1dW3N0YWNrW3N0YWNrLmxlbmd0aCAtIDFdXTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2gobmV3U3RhdGUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKCSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKiBKaXNvbiBnZW5lcmF0ZWQgbGV4ZXIgKi8KCSAgICB2YXIgbGV4ZXIgPSAoZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbGV4ZXIgPSB7IEVPRjogMSwKCSAgICAgICAgICAgIHBhcnNlRXJyb3I6IGZ1bmN0aW9uIHBhcnNlRXJyb3Ioc3RyLCBoYXNoKSB7CgkgICAgICAgICAgICAgICAgaWYgKHRoaXMueXkucGFyc2VyKSB7CgkgICAgICAgICAgICAgICAgICAgIHRoaXMueXkucGFyc2VyLnBhcnNlRXJyb3Ioc3RyLCBoYXNoKTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Ioc3RyKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9LAoJICAgICAgICAgICAgc2V0SW5wdXQ6IGZ1bmN0aW9uIHNldElucHV0KGlucHV0KSB7CgkgICAgICAgICAgICAgICAgdGhpcy5faW5wdXQgPSBpbnB1dDsKCSAgICAgICAgICAgICAgICB0aGlzLl9tb3JlID0gdGhpcy5fbGVzcyA9IHRoaXMuZG9uZSA9IGZhbHNlOwoJICAgICAgICAgICAgICAgIHRoaXMueXlsaW5lbm8gPSB0aGlzLnl5bGVuZyA9IDA7CgkgICAgICAgICAgICAgICAgdGhpcy55eXRleHQgPSB0aGlzLm1hdGNoZWQgPSB0aGlzLm1hdGNoID0gJyc7CgkgICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25TdGFjayA9IFsnSU5JVElBTCddOwoJICAgICAgICAgICAgICAgIHRoaXMueXlsbG9jID0geyBmaXJzdF9saW5lOiAxLCBmaXJzdF9jb2x1bW46IDAsIGxhc3RfbGluZTogMSwgbGFzdF9jb2x1bW46IDAgfTsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJhbmdlcykgdGhpcy55eWxsb2MucmFuZ2UgPSBbMCwgMF07CgkgICAgICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSAwOwoJICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICAgICAgfSwKCSAgICAgICAgICAgIGlucHV0OiBmdW5jdGlvbiBpbnB1dCgpIHsKCSAgICAgICAgICAgICAgICB2YXIgY2ggPSB0aGlzLl9pbnB1dFswXTsKCSAgICAgICAgICAgICAgICB0aGlzLnl5dGV4dCArPSBjaDsKCSAgICAgICAgICAgICAgICB0aGlzLnl5bGVuZysrOwoJICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0Kys7CgkgICAgICAgICAgICAgICAgdGhpcy5tYXRjaCArPSBjaDsKCSAgICAgICAgICAgICAgICB0aGlzLm1hdGNoZWQgKz0gY2g7CgkgICAgICAgICAgICAgICAgdmFyIGxpbmVzID0gY2gubWF0Y2goLyg/OlxyXG4/fFxuKS4qL2cpOwoJICAgICAgICAgICAgICAgIGlmIChsaW5lcykgewoJICAgICAgICAgICAgICAgICAgICB0aGlzLnl5bGluZW5vKys7CgkgICAgICAgICAgICAgICAgICAgIHRoaXMueXlsbG9jLmxhc3RfbGluZSsrOwoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHRoaXMueXlsbG9jLmxhc3RfY29sdW1uKys7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmFuZ2VzKSB0aGlzLnl5bGxvYy5yYW5nZVsxXSsrOwoKCSAgICAgICAgICAgICAgICB0aGlzLl9pbnB1dCA9IHRoaXMuX2lucHV0LnNsaWNlKDEpOwoJICAgICAgICAgICAgICAgIHJldHVybiBjaDsKCSAgICAgICAgICAgIH0sCgkgICAgICAgICAgICB1bnB1dDogZnVuY3Rpb24gdW5wdXQoY2gpIHsKCSAgICAgICAgICAgICAgICB2YXIgbGVuID0gY2gubGVuZ3RoOwoJICAgICAgICAgICAgICAgIHZhciBsaW5lcyA9IGNoLnNwbGl0KC8oPzpcclxuP3xcbikvZyk7CgoJICAgICAgICAgICAgICAgIHRoaXMuX2lucHV0ID0gY2ggKyB0aGlzLl9pbnB1dDsKCSAgICAgICAgICAgICAgICB0aGlzLnl5dGV4dCA9IHRoaXMueXl0ZXh0LnN1YnN0cigwLCB0aGlzLnl5dGV4dC5sZW5ndGggLSBsZW4gLSAxKTsKCSAgICAgICAgICAgICAgICAvL3RoaXMueXlsZW5nIC09IGxlbjsKCSAgICAgICAgICAgICAgICB0aGlzLm9mZnNldCAtPSBsZW47CgkgICAgICAgICAgICAgICAgdmFyIG9sZExpbmVzID0gdGhpcy5tYXRjaC5zcGxpdCgvKD86XHJcbj98XG4pL2cpOwoJICAgICAgICAgICAgICAgIHRoaXMubWF0Y2ggPSB0aGlzLm1hdGNoLnN1YnN0cigwLCB0aGlzLm1hdGNoLmxlbmd0aCAtIDEpOwoJICAgICAgICAgICAgICAgIHRoaXMubWF0Y2hlZCA9IHRoaXMubWF0Y2hlZC5zdWJzdHIoMCwgdGhpcy5tYXRjaGVkLmxlbmd0aCAtIDEpOwoKCSAgICAgICAgICAgICAgICBpZiAobGluZXMubGVuZ3RoIC0gMSkgdGhpcy55eWxpbmVubyAtPSBsaW5lcy5sZW5ndGggLSAxOwoJICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy55eWxsb2MucmFuZ2U7CgoJICAgICAgICAgICAgICAgIHRoaXMueXlsbG9jID0geyBmaXJzdF9saW5lOiB0aGlzLnl5bGxvYy5maXJzdF9saW5lLAoJICAgICAgICAgICAgICAgICAgICBsYXN0X2xpbmU6IHRoaXMueXlsaW5lbm8gKyAxLAoJICAgICAgICAgICAgICAgICAgICBmaXJzdF9jb2x1bW46IHRoaXMueXlsbG9jLmZpcnN0X2NvbHVtbiwKCSAgICAgICAgICAgICAgICAgICAgbGFzdF9jb2x1bW46IGxpbmVzID8gKGxpbmVzLmxlbmd0aCA9PT0gb2xkTGluZXMubGVuZ3RoID8gdGhpcy55eWxsb2MuZmlyc3RfY29sdW1uIDogMCkgKyBvbGRMaW5lc1tvbGRMaW5lcy5sZW5ndGggLSBsaW5lcy5sZW5ndGhdLmxlbmd0aCAtIGxpbmVzWzBdLmxlbmd0aCA6IHRoaXMueXlsbG9jLmZpcnN0X2NvbHVtbiAtIGxlbgoJICAgICAgICAgICAgICAgIH07CgoJICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmFuZ2VzKSB7CgkgICAgICAgICAgICAgICAgICAgIHRoaXMueXlsbG9jLnJhbmdlID0gW3JbMF0sIHJbMF0gKyB0aGlzLnl5bGVuZyAtIGxlbl07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICAgICAgfSwKCSAgICAgICAgICAgIG1vcmU6IGZ1bmN0aW9uIG1vcmUoKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5fbW9yZSA9IHRydWU7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgICAgICB9LAoJICAgICAgICAgICAgbGVzczogZnVuY3Rpb24gbGVzcyhuKSB7CgkgICAgICAgICAgICAgICAgdGhpcy51bnB1dCh0aGlzLm1hdGNoLnNsaWNlKG4pKTsKCSAgICAgICAgICAgIH0sCgkgICAgICAgICAgICBwYXN0SW5wdXQ6IGZ1bmN0aW9uIHBhc3RJbnB1dCgpIHsKCSAgICAgICAgICAgICAgICB2YXIgcGFzdCA9IHRoaXMubWF0Y2hlZC5zdWJzdHIoMCwgdGhpcy5tYXRjaGVkLmxlbmd0aCAtIHRoaXMubWF0Y2gubGVuZ3RoKTsKCSAgICAgICAgICAgICAgICByZXR1cm4gKHBhc3QubGVuZ3RoID4gMjAgPyAnLi4uJyA6ICcnKSArIHBhc3Quc3Vic3RyKC0yMCkucmVwbGFjZSgvXG4vZywgIiIpOwoJICAgICAgICAgICAgfSwKCSAgICAgICAgICAgIHVwY29taW5nSW5wdXQ6IGZ1bmN0aW9uIHVwY29taW5nSW5wdXQoKSB7CgkgICAgICAgICAgICAgICAgdmFyIG5leHQgPSB0aGlzLm1hdGNoOwoJICAgICAgICAgICAgICAgIGlmIChuZXh0Lmxlbmd0aCA8IDIwKSB7CgkgICAgICAgICAgICAgICAgICAgIG5leHQgKz0gdGhpcy5faW5wdXQuc3Vic3RyKDAsIDIwIC0gbmV4dC5sZW5ndGgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXR1cm4gKG5leHQuc3Vic3RyKDAsIDIwKSArIChuZXh0Lmxlbmd0aCA+IDIwID8gJy4uLicgOiAnJykpLnJlcGxhY2UoL1xuL2csICIiKTsKCSAgICAgICAgICAgIH0sCgkgICAgICAgICAgICBzaG93UG9zaXRpb246IGZ1bmN0aW9uIHNob3dQb3NpdGlvbigpIHsKCSAgICAgICAgICAgICAgICB2YXIgcHJlID0gdGhpcy5wYXN0SW5wdXQoKTsKCSAgICAgICAgICAgICAgICB2YXIgYyA9IG5ldyBBcnJheShwcmUubGVuZ3RoICsgMSkuam9pbigiLSIpOwoJICAgICAgICAgICAgICAgIHJldHVybiBwcmUgKyB0aGlzLnVwY29taW5nSW5wdXQoKSArICJcbiIgKyBjICsgIl4iOwoJICAgICAgICAgICAgfSwKCSAgICAgICAgICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQoKSB7CgkgICAgICAgICAgICAgICAgaWYgKHRoaXMuZG9uZSkgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5FT0Y7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmICghdGhpcy5faW5wdXQpIHRoaXMuZG9uZSA9IHRydWU7CgoJICAgICAgICAgICAgICAgIHZhciB0b2tlbiwgbWF0Y2gsIHRlbXBNYXRjaCwgaW5kZXgsIGNvbCwgbGluZXM7CgkgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9tb3JlKSB7CgkgICAgICAgICAgICAgICAgICAgIHRoaXMueXl0ZXh0ID0gJyc7CgkgICAgICAgICAgICAgICAgICAgIHRoaXMubWF0Y2ggPSAnJzsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgdmFyIHJ1bGVzID0gdGhpcy5fY3VycmVudFJ1bGVzKCk7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBydWxlcy5sZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICB0ZW1wTWF0Y2ggPSB0aGlzLl9pbnB1dC5tYXRjaCh0aGlzLnJ1bGVzW3J1bGVzW2ldXSk7CgkgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wTWF0Y2ggJiYgKCFtYXRjaCB8fCB0ZW1wTWF0Y2hbMF0ubGVuZ3RoID4gbWF0Y2hbMF0ubGVuZ3RoKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSB0ZW1wTWF0Y2g7CgkgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5mbGV4KSBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpZiAobWF0Y2gpIHsKCSAgICAgICAgICAgICAgICAgICAgbGluZXMgPSBtYXRjaFswXS5tYXRjaCgvKD86XHJcbj98XG4pLiovZyk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChsaW5lcykgdGhpcy55eWxpbmVubyArPSBsaW5lcy5sZW5ndGg7CgkgICAgICAgICAgICAgICAgICAgIHRoaXMueXlsbG9jID0geyBmaXJzdF9saW5lOiB0aGlzLnl5bGxvYy5sYXN0X2xpbmUsCgkgICAgICAgICAgICAgICAgICAgICAgICBsYXN0X2xpbmU6IHRoaXMueXlsaW5lbm8gKyAxLAoJICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RfY29sdW1uOiB0aGlzLnl5bGxvYy5sYXN0X2NvbHVtbiwKCSAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfY29sdW1uOiBsaW5lcyA/IGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdLmxlbmd0aCAtIGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdLm1hdGNoKC9ccj9cbj8vKVswXS5sZW5ndGggOiB0aGlzLnl5bGxvYy5sYXN0X2NvbHVtbiArIG1hdGNoWzBdLmxlbmd0aCB9OwoJICAgICAgICAgICAgICAgICAgICB0aGlzLnl5dGV4dCArPSBtYXRjaFswXTsKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXRjaCArPSBtYXRjaFswXTsKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXRjaGVzID0gbWF0Y2g7CgkgICAgICAgICAgICAgICAgICAgIHRoaXMueXlsZW5nID0gdGhpcy55eXRleHQubGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJhbmdlcykgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55eWxsb2MucmFuZ2UgPSBbdGhpcy5vZmZzZXQsIHRoaXMub2Zmc2V0ICs9IHRoaXMueXlsZW5nXTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3JlID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lucHV0ID0gdGhpcy5faW5wdXQuc2xpY2UobWF0Y2hbMF0ubGVuZ3RoKTsKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXRjaGVkICs9IG1hdGNoWzBdOwoJICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMucGVyZm9ybUFjdGlvbi5jYWxsKHRoaXMsIHRoaXMueXksIHRoaXMsIHJ1bGVzW2luZGV4XSwgdGhpcy5jb25kaXRpb25TdGFja1t0aGlzLmNvbmRpdGlvblN0YWNrLmxlbmd0aCAtIDFdKTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZG9uZSAmJiB0aGlzLl9pbnB1dCkgdGhpcy5kb25lID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbikgcmV0dXJuIHRva2VuO2Vsc2UgcmV0dXJuOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpZiAodGhpcy5faW5wdXQgPT09ICIiKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkVPRjsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUVycm9yKCdMZXhpY2FsIGVycm9yIG9uIGxpbmUgJyArICh0aGlzLnl5bGluZW5vICsgMSkgKyAnLiBVbnJlY29nbml6ZWQgdGV4dC5cbicgKyB0aGlzLnNob3dQb3NpdGlvbigpLCB7IHRleHQ6ICIiLCB0b2tlbjogbnVsbCwgbGluZTogdGhpcy55eWxpbmVubyB9KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9LAoJICAgICAgICAgICAgbGV4OiBmdW5jdGlvbiBsZXgoKSB7CgkgICAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLm5leHQoKTsKCSAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHIgIT09ICd1bmRlZmluZWQnKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiByOwoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxleCgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0sCgkgICAgICAgICAgICBiZWdpbjogZnVuY3Rpb24gYmVnaW4oY29uZGl0aW9uKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25TdGFjay5wdXNoKGNvbmRpdGlvbik7CgkgICAgICAgICAgICB9LAoJICAgICAgICAgICAgcG9wU3RhdGU6IGZ1bmN0aW9uIHBvcFN0YXRlKCkgewoJICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmRpdGlvblN0YWNrLnBvcCgpOwoJICAgICAgICAgICAgfSwKCSAgICAgICAgICAgIF9jdXJyZW50UnVsZXM6IGZ1bmN0aW9uIF9jdXJyZW50UnVsZXMoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uZGl0aW9uc1t0aGlzLmNvbmRpdGlvblN0YWNrW3RoaXMuY29uZGl0aW9uU3RhY2subGVuZ3RoIC0gMV1dLnJ1bGVzOwoJICAgICAgICAgICAgfSwKCSAgICAgICAgICAgIHRvcFN0YXRlOiBmdW5jdGlvbiB0b3BTdGF0ZSgpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25kaXRpb25TdGFja1t0aGlzLmNvbmRpdGlvblN0YWNrLmxlbmd0aCAtIDJdOwoJICAgICAgICAgICAgfSwKCSAgICAgICAgICAgIHB1c2hTdGF0ZTogZnVuY3Rpb24gYmVnaW4oY29uZGl0aW9uKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iZWdpbihjb25kaXRpb24pOwoJICAgICAgICAgICAgfSB9OwoJICAgICAgICBsZXhlci5vcHRpb25zID0ge307CgkgICAgICAgIGxleGVyLnBlcmZvcm1BY3Rpb24gPSBmdW5jdGlvbiBhbm9ueW1vdXMoeXksIHl5XywgJGF2b2lkaW5nX25hbWVfY29sbGlzaW9ucywgWVlfU1RBUlQKCSAgICAgICAgLyoqLykgewoKCSAgICAgICAgICAgIGZ1bmN0aW9uIHN0cmlwKHN0YXJ0LCBlbmQpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4geXlfLnl5dGV4dCA9IHl5Xy55eXRleHQuc3Vic3RyKHN0YXJ0LCB5eV8ueXlsZW5nIC0gZW5kKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICB2YXIgWVlTVEFURSA9IFlZX1NUQVJUOwoJICAgICAgICAgICAgc3dpdGNoICgkYXZvaWRpbmdfbmFtZV9jb2xsaXNpb25zKSB7CgkgICAgICAgICAgICAgICAgY2FzZSAwOgoJICAgICAgICAgICAgICAgICAgICBpZiAoeXlfLnl5dGV4dC5zbGljZSgtMikgPT09ICJcXFxcIikgewoJICAgICAgICAgICAgICAgICAgICAgICAgc3RyaXAoMCwgMSk7CgkgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJlZ2luKCJtdSIpOwoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHl5Xy55eXRleHQuc2xpY2UoLTEpID09PSAiXFwiKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzdHJpcCgwLCAxKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmVnaW4oImVtdSIpOwoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5iZWdpbigibXUiKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeXlfLnl5dGV4dCkgcmV0dXJuIDE1OwoKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAxOgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTU7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMjoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3BTdGF0ZSgpOwoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTU7CgoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDM6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuYmVnaW4oJ3JhdycpO3JldHVybiAxNTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA0OgoJICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcFN0YXRlKCk7CgkgICAgICAgICAgICAgICAgICAgIC8vIFNob3VsZCBiZSB1c2luZyBgdGhpcy50b3BTdGF0ZSgpYCBiZWxvdywgYnV0IGl0IGN1cnJlbnRseQoJICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm5zIHRoZSBzZWNvbmQgdG9wIGluc3RlYWQgb2YgdGhlIGZpcnN0IHRvcC4gT3BlbmVkIGFuCgkgICAgICAgICAgICAgICAgICAgIC8vIGlzc3VlIGFib3V0IGl0IGF0IGh0dHBzOi8vZ2l0aHViLmNvbS96YWFjaC9qaXNvbi9pc3N1ZXMvMjkxCgkgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbmRpdGlvblN0YWNrW3RoaXMuY29uZGl0aW9uU3RhY2subGVuZ3RoIC0gMV0gPT09ICdyYXcnKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTU7CgkgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB5eV8ueXl0ZXh0ID0geXlfLnl5dGV4dC5zdWJzdHIoNSwgeXlfLnl5bGVuZyAtIDkpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdFTkRfUkFXX0JMT0NLJzsKCSAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA1OgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTU7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgNjoKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3BTdGF0ZSgpOwoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTQ7CgoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDc6CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiA2NTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA4OgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gNjg7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgOToKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE5OwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDEwOgoJICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcFN0YXRlKCk7CgkgICAgICAgICAgICAgICAgICAgIHRoaXMuYmVnaW4oJ3JhdycpOwoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjM7CgoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDExOgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gNTU7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMTI6CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiA2MDsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAxMzoKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDI5OwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDE0OgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gNDc7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMTU6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMucG9wU3RhdGUoKTtyZXR1cm4gNDQ7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMTY6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMucG9wU3RhdGUoKTtyZXR1cm4gNDQ7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMTc6CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiAzNDsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAxODoKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDM5OwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDE5OgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gNTE7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMjA6CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiA0ODsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAyMToKCSAgICAgICAgICAgICAgICAgICAgdGhpcy51bnB1dCh5eV8ueXl0ZXh0KTsKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3BTdGF0ZSgpOwoJICAgICAgICAgICAgICAgICAgICB0aGlzLmJlZ2luKCdjb20nKTsKCgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMjI6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMucG9wU3RhdGUoKTsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE0OwoKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAyMzoKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQ4OwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDI0OgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gNzM7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMjU6CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiA3MjsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAyNjoKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDcyOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDI3OgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gODc7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMjg6CgkgICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZSB3aGl0ZXNwYWNlCgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMjk6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMucG9wU3RhdGUoKTtyZXR1cm4gNTQ7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMzA6CgkgICAgICAgICAgICAgICAgICAgIHRoaXMucG9wU3RhdGUoKTtyZXR1cm4gMzM7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMzE6CgkgICAgICAgICAgICAgICAgICAgIHl5Xy55eXRleHQgPSBzdHJpcCgxLCAyKS5yZXBsYWNlKC9cXCIvZywgJyInKTtyZXR1cm4gODA7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMzI6CgkgICAgICAgICAgICAgICAgICAgIHl5Xy55eXRleHQgPSBzdHJpcCgxLCAyKS5yZXBsYWNlKC9cXCcvZywgIiciKTtyZXR1cm4gODA7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMzM6CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiA4NTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAzNDoKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDgyOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDM1OgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gODI7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMzY6CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiA4MzsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAzNzoKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0OwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDM4OgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gODE7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgMzk6CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiA3NTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSA0MDoKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDc3OwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDQxOgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gNzI7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgNDI6CgkgICAgICAgICAgICAgICAgICAgIHl5Xy55eXRleHQgPSB5eV8ueXl0ZXh0LnJlcGxhY2UoL1xcKFtcXFxdXSkvZywgJyQxJyk7cmV0dXJuIDcyOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDQzOgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ0lOVkFMSUQnOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlIDQ0OgoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gNTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9CgkgICAgICAgIH07CgkgICAgICAgIGxleGVyLnJ1bGVzID0gWy9eKD86W15ceDAwXSo/KD89KFx7XHspKSkvLCAvXig/OlteXHgwMF0rKS8sIC9eKD86W15ceDAwXXsyLH0/KD89KFx7XHt8XFxce1x7fFxcXFxce1x7fCQpKSkvLCAvXig/Olx7XHtce1x7KD89W14vXSkpLywgL14oPzpce1x7XHtce1wvW15ccyEiIyUtLFwuXC87LT5AXFstXF5gXHstfl0rKD89Wz19XHNcLy5dKVx9XH1cfVx9KS8sIC9eKD86W15ceDAwXSo/KD89KFx7XHtce1x7KSkpLywgL14oPzpbXHNcU10qPy0tKH4pP1x9XH0pLywgL14oPzpcKCkvLCAvXig/OlwpKS8sIC9eKD86XHtce1x7XHspLywgL14oPzpcfVx9XH1cfSkvLCAvXig/Olx7XHsofik/PikvLCAvXig/Olx7XHsofik/Iz4pLywgL14oPzpce1x7KH4pPyNcKj8pLywgL14oPzpce1x7KH4pP1wvKS8sIC9eKD86XHtceyh+KT9cXlxzKih+KT9cfVx9KS8sIC9eKD86XHtceyh+KT9ccyplbHNlXHMqKH4pP1x9XH0pLywgL14oPzpce1x7KH4pP1xeKS8sIC9eKD86XHtceyh+KT9ccyplbHNlXGIpLywgL14oPzpce1x7KH4pP1x7KS8sIC9eKD86XHtceyh+KT8mKS8sIC9eKD86XHtceyh+KT8hLS0pLywgL14oPzpce1x7KH4pPyFbXHNcU10qP1x9XH0pLywgL14oPzpce1x7KH4pP1wqPykvLCAvXig/Oj0pLywgL14oPzpcLlwuKS8sIC9eKD86XC4oPz0oWz1+fVxzXC8uKXxdKSkpLywgL14oPzpbXC8uXSkvLCAvXig/OlxzKykvLCAvXig/Olx9KH4pP1x9XH0pLywgL14oPzoofik/XH1cfSkvLCAvXig/OiIoXFxbIl18W14iXSkqIikvLCAvXig/OicoXFxbJ118W14nXSkqJykvLCAvXig/OkApLywgL14oPzp0cnVlKD89KFt+fVxzKV0pKSkvLCAvXig/OmZhbHNlKD89KFt+fVxzKV0pKSkvLCAvXig/OnVuZGVmaW5lZCg/PShbfn1ccyldKSkpLywgL14oPzpudWxsKD89KFt+fVxzKV0pKSkvLCAvXig/Oi0/WzAtOV0rKD86XC5bMC05XSspPyg/PShbfn1ccyldKSkpLywgL14oPzphc1xzK1x8KS8sIC9eKD86XHwpLywgL14oPzooW15ccyEiIyUtLFwuXC87LT5AXFstXF5gXHstfl0rKD89KFs9fn1cc1wvLil8XSkpKSkvLCAvXig/OlxbKFxcXF18W15cXV0pKlxdKS8sIC9eKD86LikvLCAvXig/OiQpL107CgkgICAgICAgIGxleGVyLmNvbmRpdGlvbnMgPSB7ICJtdSI6IHsgInJ1bGVzIjogWzcsIDgsIDksIDEwLCAxMSwgMTIsIDEzLCAxNCwgMTUsIDE2LCAxNywgMTgsIDE5LCAyMCwgMjEsIDIyLCAyMywgMjQsIDI1LCAyNiwgMjcsIDI4LCAyOSwgMzAsIDMxLCAzMiwgMzMsIDM0LCAzNSwgMzYsIDM3LCAzOCwgMzksIDQwLCA0MSwgNDIsIDQzLCA0NF0sICJpbmNsdXNpdmUiOiBmYWxzZSB9LCAiZW11IjogeyAicnVsZXMiOiBbMl0sICJpbmNsdXNpdmUiOiBmYWxzZSB9LCAiY29tIjogeyAicnVsZXMiOiBbNl0sICJpbmNsdXNpdmUiOiBmYWxzZSB9LCAicmF3IjogeyAicnVsZXMiOiBbMywgNCwgNV0sICJpbmNsdXNpdmUiOiBmYWxzZSB9LCAiSU5JVElBTCI6IHsgInJ1bGVzIjogWzAsIDEsIDQ0XSwgImluY2x1c2l2ZSI6IHRydWUgfSB9OwoJICAgICAgICByZXR1cm4gbGV4ZXI7CgkgICAgfSkoKTsKCSAgICBwYXJzZXIubGV4ZXIgPSBsZXhlcjsKCSAgICBmdW5jdGlvbiBQYXJzZXIoKSB7CgkgICAgICAgIHRoaXMueXkgPSB7fTsKCSAgICB9UGFyc2VyLnByb3RvdHlwZSA9IHBhcnNlcjtwYXJzZXIuUGFyc2VyID0gUGFyc2VyOwoJICAgIHJldHVybiBuZXcgUGFyc2VyKCk7Cgl9KSgpO2V4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CglleHBvcnRzWydkZWZhdWx0J10gPSBoYW5kbGViYXJzOwoKLyoqKi8gfSwKLyogMjQgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoJJ3VzZSBzdHJpY3QnOwoKCXZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKVsnZGVmYXVsdCddOwoKCWV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CgoJdmFyIF92aXNpdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNSk7CgoJdmFyIF92aXNpdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3Zpc2l0b3IpOwoKCWZ1bmN0aW9uIFdoaXRlc3BhY2VDb250cm9sKCkgewoJICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMCB8fCBhcmd1bWVudHNbMF0gPT09IHVuZGVmaW5lZCA/IHt9IDogYXJndW1lbnRzWzBdOwoKCSAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCX0KCVdoaXRlc3BhY2VDb250cm9sLnByb3RvdHlwZSA9IG5ldyBfdmlzaXRvcjJbJ2RlZmF1bHQnXSgpOwoKCVdoaXRlc3BhY2VDb250cm9sLnByb3RvdHlwZS5Qcm9ncmFtID0gZnVuY3Rpb24gKHByb2dyYW0pIHsKCSAgdmFyIGRvU3RhbmRhbG9uZSA9ICF0aGlzLm9wdGlvbnMuaWdub3JlU3RhbmRhbG9uZTsKCgkgIHZhciBpc1Jvb3QgPSAhdGhpcy5pc1Jvb3RTZWVuOwoJICB0aGlzLmlzUm9vdFNlZW4gPSB0cnVlOwoKCSAgdmFyIGJvZHkgPSBwcm9ncmFtLmJvZHk7CgkgIGZvciAodmFyIGkgPSAwLCBsID0gYm9keS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKCSAgICB2YXIgY3VycmVudCA9IGJvZHlbaV0sCgkgICAgICAgIHN0cmlwID0gdGhpcy5hY2NlcHQoY3VycmVudCk7CgoJICAgIGlmICghc3RyaXApIHsKCSAgICAgIGNvbnRpbnVlOwoJICAgIH0KCgkgICAgdmFyIF9pc1ByZXZXaGl0ZXNwYWNlID0gaXNQcmV2V2hpdGVzcGFjZShib2R5LCBpLCBpc1Jvb3QpLAoJICAgICAgICBfaXNOZXh0V2hpdGVzcGFjZSA9IGlzTmV4dFdoaXRlc3BhY2UoYm9keSwgaSwgaXNSb290KSwKCSAgICAgICAgb3BlblN0YW5kYWxvbmUgPSBzdHJpcC5vcGVuU3RhbmRhbG9uZSAmJiBfaXNQcmV2V2hpdGVzcGFjZSwKCSAgICAgICAgY2xvc2VTdGFuZGFsb25lID0gc3RyaXAuY2xvc2VTdGFuZGFsb25lICYmIF9pc05leHRXaGl0ZXNwYWNlLAoJICAgICAgICBpbmxpbmVTdGFuZGFsb25lID0gc3RyaXAuaW5saW5lU3RhbmRhbG9uZSAmJiBfaXNQcmV2V2hpdGVzcGFjZSAmJiBfaXNOZXh0V2hpdGVzcGFjZTsKCgkgICAgaWYgKHN0cmlwLmNsb3NlKSB7CgkgICAgICBvbWl0UmlnaHQoYm9keSwgaSwgdHJ1ZSk7CgkgICAgfQoJICAgIGlmIChzdHJpcC5vcGVuKSB7CgkgICAgICBvbWl0TGVmdChib2R5LCBpLCB0cnVlKTsKCSAgICB9CgoJICAgIGlmIChkb1N0YW5kYWxvbmUgJiYgaW5saW5lU3RhbmRhbG9uZSkgewoJICAgICAgb21pdFJpZ2h0KGJvZHksIGkpOwoKCSAgICAgIGlmIChvbWl0TGVmdChib2R5LCBpKSkgewoJICAgICAgICAvLyBJZiB3ZSBhcmUgb24gYSBzdGFuZGFsb25lIG5vZGUsIHNhdmUgdGhlIGluZGVudCBpbmZvIGZvciBwYXJ0aWFscwoJICAgICAgICBpZiAoY3VycmVudC50eXBlID09PSAnUGFydGlhbFN0YXRlbWVudCcpIHsKCSAgICAgICAgICAvLyBQdWxsIG91dCB0aGUgd2hpdGVzcGFjZSBmcm9tIHRoZSBmaW5hbCBsaW5lCgkgICAgICAgICAgY3VycmVudC5pbmRlbnQgPSAvKFsgXHRdKyQpLy5leGVjKGJvZHlbaSAtIDFdLm9yaWdpbmFsKVsxXTsKCSAgICAgICAgfQoJICAgICAgfQoJICAgIH0KCSAgICBpZiAoZG9TdGFuZGFsb25lICYmIG9wZW5TdGFuZGFsb25lKSB7CgkgICAgICBvbWl0UmlnaHQoKGN1cnJlbnQucHJvZ3JhbSB8fCBjdXJyZW50LmludmVyc2UpLmJvZHkpOwoKCSAgICAgIC8vIFN0cmlwIG91dCB0aGUgcHJldmlvdXMgY29udGVudCBub2RlIGlmIGl0J3Mgd2hpdGVzcGFjZSBvbmx5CgkgICAgICBvbWl0TGVmdChib2R5LCBpKTsKCSAgICB9CgkgICAgaWYgKGRvU3RhbmRhbG9uZSAmJiBjbG9zZVN0YW5kYWxvbmUpIHsKCSAgICAgIC8vIEFsd2F5cyBzdHJpcCB0aGUgbmV4dCBub2RlCgkgICAgICBvbWl0UmlnaHQoYm9keSwgaSk7CgoJICAgICAgb21pdExlZnQoKGN1cnJlbnQuaW52ZXJzZSB8fCBjdXJyZW50LnByb2dyYW0pLmJvZHkpOwoJICAgIH0KCSAgfQoKCSAgcmV0dXJuIHByb2dyYW07Cgl9OwoKCVdoaXRlc3BhY2VDb250cm9sLnByb3RvdHlwZS5CbG9ja1N0YXRlbWVudCA9IFdoaXRlc3BhY2VDb250cm9sLnByb3RvdHlwZS5EZWNvcmF0b3JCbG9jayA9IFdoaXRlc3BhY2VDb250cm9sLnByb3RvdHlwZS5QYXJ0aWFsQmxvY2tTdGF0ZW1lbnQgPSBmdW5jdGlvbiAoYmxvY2spIHsKCSAgdGhpcy5hY2NlcHQoYmxvY2sucHJvZ3JhbSk7CgkgIHRoaXMuYWNjZXB0KGJsb2NrLmludmVyc2UpOwoKCSAgLy8gRmluZCB0aGUgaW52ZXJzZSBwcm9ncmFtIHRoYXQgaXMgaW52b2xlZCB3aXRoIHdoaXRlc3BhY2Ugc3RyaXBwaW5nLgoJICB2YXIgcHJvZ3JhbSA9IGJsb2NrLnByb2dyYW0gfHwgYmxvY2suaW52ZXJzZSwKCSAgICAgIGludmVyc2UgPSBibG9jay5wcm9ncmFtICYmIGJsb2NrLmludmVyc2UsCgkgICAgICBmaXJzdEludmVyc2UgPSBpbnZlcnNlLAoJICAgICAgbGFzdEludmVyc2UgPSBpbnZlcnNlOwoKCSAgaWYgKGludmVyc2UgJiYgaW52ZXJzZS5jaGFpbmVkKSB7CgkgICAgZmlyc3RJbnZlcnNlID0gaW52ZXJzZS5ib2R5WzBdLnByb2dyYW07CgoJICAgIC8vIFdhbGsgdGhlIGludmVyc2UgY2hhaW4gdG8gZmluZCB0aGUgbGFzdCBpbnZlcnNlIHRoYXQgaXMgYWN0dWFsbHkgaW4gdGhlIGNoYWluLgoJICAgIHdoaWxlIChsYXN0SW52ZXJzZS5jaGFpbmVkKSB7CgkgICAgICBsYXN0SW52ZXJzZSA9IGxhc3RJbnZlcnNlLmJvZHlbbGFzdEludmVyc2UuYm9keS5sZW5ndGggLSAxXS5wcm9ncmFtOwoJICAgIH0KCSAgfQoKCSAgdmFyIHN0cmlwID0gewoJICAgIG9wZW46IGJsb2NrLm9wZW5TdHJpcC5vcGVuLAoJICAgIGNsb3NlOiBibG9jay5jbG9zZVN0cmlwLmNsb3NlLAoKCSAgICAvLyBEZXRlcm1pbmUgdGhlIHN0YW5kYWxvbmUgY2FuZGlhY3kuIEJhc2ljYWxseSBmbGFnIG91ciBjb250ZW50IGFzIGJlaW5nIHBvc3NpYmx5IHN0YW5kYWxvbmUKCSAgICAvLyBzbyBvdXIgcGFyZW50IGNhbiBkZXRlcm1pbmUgaWYgd2UgYWN0dWFsbHkgYXJlIHN0YW5kYWxvbmUKCSAgICBvcGVuU3RhbmRhbG9uZTogaXNOZXh0V2hpdGVzcGFjZShwcm9ncmFtLmJvZHkpLAoJICAgIGNsb3NlU3RhbmRhbG9uZTogaXNQcmV2V2hpdGVzcGFjZSgoZmlyc3RJbnZlcnNlIHx8IHByb2dyYW0pLmJvZHkpCgkgIH07CgoJICBpZiAoYmxvY2sub3BlblN0cmlwLmNsb3NlKSB7CgkgICAgb21pdFJpZ2h0KHByb2dyYW0uYm9keSwgbnVsbCwgdHJ1ZSk7CgkgIH0KCgkgIGlmIChpbnZlcnNlKSB7CgkgICAgdmFyIGludmVyc2VTdHJpcCA9IGJsb2NrLmludmVyc2VTdHJpcDsKCgkgICAgaWYgKGludmVyc2VTdHJpcC5vcGVuKSB7CgkgICAgICBvbWl0TGVmdChwcm9ncmFtLmJvZHksIG51bGwsIHRydWUpOwoJICAgIH0KCgkgICAgaWYgKGludmVyc2VTdHJpcC5jbG9zZSkgewoJICAgICAgb21pdFJpZ2h0KGZpcnN0SW52ZXJzZS5ib2R5LCBudWxsLCB0cnVlKTsKCSAgICB9CgkgICAgaWYgKGJsb2NrLmNsb3NlU3RyaXAub3BlbikgewoJICAgICAgb21pdExlZnQobGFzdEludmVyc2UuYm9keSwgbnVsbCwgdHJ1ZSk7CgkgICAgfQoKCSAgICAvLyBGaW5kIHN0YW5kYWxvbmUgZWxzZSBzdGF0bWVudHMKCSAgICBpZiAoIXRoaXMub3B0aW9ucy5pZ25vcmVTdGFuZGFsb25lICYmIGlzUHJldldoaXRlc3BhY2UocHJvZ3JhbS5ib2R5KSAmJiBpc05leHRXaGl0ZXNwYWNlKGZpcnN0SW52ZXJzZS5ib2R5KSkgewoJICAgICAgb21pdExlZnQocHJvZ3JhbS5ib2R5KTsKCSAgICAgIG9taXRSaWdodChmaXJzdEludmVyc2UuYm9keSk7CgkgICAgfQoJICB9IGVsc2UgaWYgKGJsb2NrLmNsb3NlU3RyaXAub3BlbikgewoJICAgIG9taXRMZWZ0KHByb2dyYW0uYm9keSwgbnVsbCwgdHJ1ZSk7CgkgIH0KCgkgIHJldHVybiBzdHJpcDsKCX07CgoJV2hpdGVzcGFjZUNvbnRyb2wucHJvdG90eXBlLkRlY29yYXRvciA9IFdoaXRlc3BhY2VDb250cm9sLnByb3RvdHlwZS5NdXN0YWNoZVN0YXRlbWVudCA9IGZ1bmN0aW9uIChtdXN0YWNoZSkgewoJICByZXR1cm4gbXVzdGFjaGUuc3RyaXA7Cgl9OwoKCVdoaXRlc3BhY2VDb250cm9sLnByb3RvdHlwZS5QYXJ0aWFsU3RhdGVtZW50ID0gV2hpdGVzcGFjZUNvbnRyb2wucHJvdG90eXBlLkNvbW1lbnRTdGF0ZW1lbnQgPSBmdW5jdGlvbiAobm9kZSkgewoJICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoJICB2YXIgc3RyaXAgPSBub2RlLnN0cmlwIHx8IHt9OwoJICByZXR1cm4gewoJICAgIGlubGluZVN0YW5kYWxvbmU6IHRydWUsCgkgICAgb3Blbjogc3RyaXAub3BlbiwKCSAgICBjbG9zZTogc3RyaXAuY2xvc2UKCSAgfTsKCX07CgoJZnVuY3Rpb24gaXNQcmV2V2hpdGVzcGFjZShib2R5LCBpLCBpc1Jvb3QpIHsKCSAgaWYgKGkgPT09IHVuZGVmaW5lZCkgewoJICAgIGkgPSBib2R5Lmxlbmd0aDsKCSAgfQoKCSAgLy8gTm9kZXMgdGhhdCBlbmQgd2l0aCBuZXdsaW5lcyBhcmUgY29uc2lkZXJlZCB3aGl0ZXNwYWNlIChidXQgYXJlIHNwZWNpYWwKCSAgLy8gY2FzZWQgZm9yIHN0cmlwIG9wZXJhdGlvbnMpCgkgIHZhciBwcmV2ID0gYm9keVtpIC0gMV0sCgkgICAgICBzaWJsaW5nID0gYm9keVtpIC0gMl07CgkgIGlmICghcHJldikgewoJICAgIHJldHVybiBpc1Jvb3Q7CgkgIH0KCgkgIGlmIChwcmV2LnR5cGUgPT09ICdDb250ZW50U3RhdGVtZW50JykgewoJICAgIHJldHVybiAoc2libGluZyB8fCAhaXNSb290ID8gL1xyP1xuXHMqPyQvIDogLyhefFxyP1xuKVxzKj8kLykudGVzdChwcmV2Lm9yaWdpbmFsKTsKCSAgfQoJfQoJZnVuY3Rpb24gaXNOZXh0V2hpdGVzcGFjZShib2R5LCBpLCBpc1Jvb3QpIHsKCSAgaWYgKGkgPT09IHVuZGVmaW5lZCkgewoJICAgIGkgPSAtMTsKCSAgfQoKCSAgdmFyIG5leHQgPSBib2R5W2kgKyAxXSwKCSAgICAgIHNpYmxpbmcgPSBib2R5W2kgKyAyXTsKCSAgaWYgKCFuZXh0KSB7CgkgICAgcmV0dXJuIGlzUm9vdDsKCSAgfQoKCSAgaWYgKG5leHQudHlwZSA9PT0gJ0NvbnRlbnRTdGF0ZW1lbnQnKSB7CgkgICAgcmV0dXJuIChzaWJsaW5nIHx8ICFpc1Jvb3QgPyAvXlxzKj9ccj9cbi8gOiAvXlxzKj8oXHI/XG58JCkvKS50ZXN0KG5leHQub3JpZ2luYWwpOwoJICB9Cgl9CgoJLy8gTWFya3MgdGhlIG5vZGUgdG8gdGhlIHJpZ2h0IG9mIHRoZSBwb3NpdGlvbiBhcyBvbWl0dGVkLgoJLy8gSS5lLiB7e2Zvb319JyAnIHdpbGwgbWFyayB0aGUgJyAnIG5vZGUgYXMgb21pdHRlZC4KCS8vCgkvLyBJZiBpIGlzIHVuZGVmaW5lZCwgdGhlbiB0aGUgZmlyc3QgY2hpbGQgd2lsbCBiZSBtYXJrZWQgYXMgc3VjaC4KCS8vCgkvLyBJZiBtdWxpdHBsZSBpcyB0cnV0aHkgdGhlbiBhbGwgd2hpdGVzcGFjZSB3aWxsIGJlIHN0cmlwcGVkIG91dCB1bnRpbCBub24td2hpdGVzcGFjZQoJLy8gY29udGVudCBpcyBtZXQuCglmdW5jdGlvbiBvbWl0UmlnaHQoYm9keSwgaSwgbXVsdGlwbGUpIHsKCSAgdmFyIGN1cnJlbnQgPSBib2R5W2kgPT0gbnVsbCA/IDAgOiBpICsgMV07CgkgIGlmICghY3VycmVudCB8fCBjdXJyZW50LnR5cGUgIT09ICdDb250ZW50U3RhdGVtZW50JyB8fCAhbXVsdGlwbGUgJiYgY3VycmVudC5yaWdodFN0cmlwcGVkKSB7CgkgICAgcmV0dXJuOwoJICB9CgoJICB2YXIgb3JpZ2luYWwgPSBjdXJyZW50LnZhbHVlOwoJICBjdXJyZW50LnZhbHVlID0gY3VycmVudC52YWx1ZS5yZXBsYWNlKG11bHRpcGxlID8gL15ccysvIDogL15bIFx0XSpccj9cbj8vLCAnJyk7CgkgIGN1cnJlbnQucmlnaHRTdHJpcHBlZCA9IGN1cnJlbnQudmFsdWUgIT09IG9yaWdpbmFsOwoJfQoKCS8vIE1hcmtzIHRoZSBub2RlIHRvIHRoZSBsZWZ0IG9mIHRoZSBwb3NpdGlvbiBhcyBvbWl0dGVkLgoJLy8gSS5lLiAnICd7e2Zvb319IHdpbGwgbWFyayB0aGUgJyAnIG5vZGUgYXMgb21pdHRlZC4KCS8vCgkvLyBJZiBpIGlzIHVuZGVmaW5lZCB0aGVuIHRoZSBsYXN0IGNoaWxkIHdpbGwgYmUgbWFya2VkIGFzIHN1Y2guCgkvLwoJLy8gSWYgbXVsaXRwbGUgaXMgdHJ1dGh5IHRoZW4gYWxsIHdoaXRlc3BhY2Ugd2lsbCBiZSBzdHJpcHBlZCBvdXQgdW50aWwgbm9uLXdoaXRlc3BhY2UKCS8vIGNvbnRlbnQgaXMgbWV0LgoJZnVuY3Rpb24gb21pdExlZnQoYm9keSwgaSwgbXVsdGlwbGUpIHsKCSAgdmFyIGN1cnJlbnQgPSBib2R5W2kgPT0gbnVsbCA/IGJvZHkubGVuZ3RoIC0gMSA6IGkgLSAxXTsKCSAgaWYgKCFjdXJyZW50IHx8IGN1cnJlbnQudHlwZSAhPT0gJ0NvbnRlbnRTdGF0ZW1lbnQnIHx8ICFtdWx0aXBsZSAmJiBjdXJyZW50LmxlZnRTdHJpcHBlZCkgewoJICAgIHJldHVybjsKCSAgfQoKCSAgLy8gV2Ugb21pdCB0aGUgbGFzdCBub2RlIGlmIGl0J3Mgd2hpdGVzcGFjZSBvbmx5IGFuZCBub3QgcHJlY2VlZGVkIGJ5IGEgbm9uLWNvbnRlbnQgbm9kZS4KCSAgdmFyIG9yaWdpbmFsID0gY3VycmVudC52YWx1ZTsKCSAgY3VycmVudC52YWx1ZSA9IGN1cnJlbnQudmFsdWUucmVwbGFjZShtdWx0aXBsZSA/IC9ccyskLyA6IC9bIFx0XSskLywgJycpOwoJICBjdXJyZW50LmxlZnRTdHJpcHBlZCA9IGN1cnJlbnQudmFsdWUgIT09IG9yaWdpbmFsOwoJICByZXR1cm4gY3VycmVudC5sZWZ0U3RyaXBwZWQ7Cgl9CgoJZXhwb3J0c1snZGVmYXVsdCddID0gV2hpdGVzcGFjZUNvbnRyb2w7Cgltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDI1ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCSd1c2Ugc3RyaWN0JzsKCgl2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18oMSlbJ2RlZmF1bHQnXTsKCglleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKCXZhciBfZXhjZXB0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCgl2YXIgX2V4Y2VwdGlvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9leGNlcHRpb24pOwoKCWZ1bmN0aW9uIFZpc2l0b3IoKSB7CgkgIHRoaXMucGFyZW50cyA9IFtdOwoJfQoKCVZpc2l0b3IucHJvdG90eXBlID0gewoJICBjb25zdHJ1Y3RvcjogVmlzaXRvciwKCSAgbXV0YXRpbmc6IGZhbHNlLAoKCSAgLy8gVmlzaXRzIGEgZ2l2ZW4gdmFsdWUuIElmIG11dGF0aW5nLCB3aWxsIHJlcGxhY2UgdGhlIHZhbHVlIGlmIG5lY2Vzc2FyeS4KCSAgYWNjZXB0S2V5OiBmdW5jdGlvbiBhY2NlcHRLZXkobm9kZSwgbmFtZSkgewoJICAgIHZhciB2YWx1ZSA9IHRoaXMuYWNjZXB0KG5vZGVbbmFtZV0pOwoJICAgIGlmICh0aGlzLm11dGF0aW5nKSB7CgkgICAgICAvLyBIYWNreSBzYW5pdHkgY2hlY2s6IFRoaXMgbWF5IGhhdmUgYSBmZXcgZmFsc2UgcG9zaXRpdmVzIGZvciB0eXBlIGZvciB0aGUgaGVscGVyCgkgICAgICAvLyBtZXRob2RzIGJ1dCB3aWxsIGdlbmVyYWxseSBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aG91dCBhIGxvdCBvZiBvdmVyaGVhZC4KCSAgICAgIGlmICh2YWx1ZSAmJiAhVmlzaXRvci5wcm90b3R5cGVbdmFsdWUudHlwZV0pIHsKCSAgICAgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ1VuZXhwZWN0ZWQgbm9kZSB0eXBlICInICsgdmFsdWUudHlwZSArICciIGZvdW5kIHdoZW4gYWNjZXB0aW5nICcgKyBuYW1lICsgJyBvbiAnICsgbm9kZS50eXBlKTsKCSAgICAgIH0KCSAgICAgIG5vZGVbbmFtZV0gPSB2YWx1ZTsKCSAgICB9CgkgIH0sCgoJICAvLyBQZXJmb3JtcyBhbiBhY2NlcHQgb3BlcmF0aW9uIHdpdGggYWRkZWQgc2FuaXR5IGNoZWNrIHRvIGVuc3VyZQoJICAvLyByZXF1aXJlZCBrZXlzIGFyZSBub3QgcmVtb3ZlZC4KCSAgYWNjZXB0UmVxdWlyZWQ6IGZ1bmN0aW9uIGFjY2VwdFJlcXVpcmVkKG5vZGUsIG5hbWUpIHsKCSAgICB0aGlzLmFjY2VwdEtleShub2RlLCBuYW1lKTsKCgkgICAgaWYgKCFub2RlW25hbWVdKSB7CgkgICAgICB0aHJvdyBuZXcgX2V4Y2VwdGlvbjJbJ2RlZmF1bHQnXShub2RlLnR5cGUgKyAnIHJlcXVpcmVzICcgKyBuYW1lKTsKCSAgICB9CgkgIH0sCgoJICAvLyBUcmF2ZXJzZXMgYSBnaXZlbiBhcnJheS4gSWYgbXV0YXRpbmcsIGVtcHR5IHJlc3Buc2VzIHdpbGwgYmUgcmVtb3ZlZAoJICAvLyBmb3IgY2hpbGQgZWxlbWVudHMuCgkgIGFjY2VwdEFycmF5OiBmdW5jdGlvbiBhY2NlcHRBcnJheShhcnJheSkgewoJICAgIGZvciAodmFyIGkgPSAwLCBsID0gYXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CgkgICAgICB0aGlzLmFjY2VwdEtleShhcnJheSwgaSk7CgoJICAgICAgaWYgKCFhcnJheVtpXSkgewoJICAgICAgICBhcnJheS5zcGxpY2UoaSwgMSk7CgkgICAgICAgIGktLTsKCSAgICAgICAgbC0tOwoJICAgICAgfQoJICAgIH0KCSAgfSwKCgkgIGFjY2VwdDogZnVuY3Rpb24gYWNjZXB0KG9iamVjdCkgewoJICAgIGlmICghb2JqZWN0KSB7CgkgICAgICByZXR1cm47CgkgICAgfQoKCSAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dDogU2FuaXR5IGNvZGUgKi8KCSAgICBpZiAoIXRoaXNbb2JqZWN0LnR5cGVdKSB7CgkgICAgICB0aHJvdyBuZXcgX2V4Y2VwdGlvbjJbJ2RlZmF1bHQnXSgnVW5rbm93biB0eXBlOiAnICsgb2JqZWN0LnR5cGUsIG9iamVjdCk7CgkgICAgfQoKCSAgICBpZiAodGhpcy5jdXJyZW50KSB7CgkgICAgICB0aGlzLnBhcmVudHMudW5zaGlmdCh0aGlzLmN1cnJlbnQpOwoJICAgIH0KCSAgICB0aGlzLmN1cnJlbnQgPSBvYmplY3Q7CgoJICAgIHZhciByZXQgPSB0aGlzW29iamVjdC50eXBlXShvYmplY3QpOwoKCSAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLnBhcmVudHMuc2hpZnQoKTsKCgkgICAgaWYgKCF0aGlzLm11dGF0aW5nIHx8IHJldCkgewoJICAgICAgcmV0dXJuIHJldDsKCSAgICB9IGVsc2UgaWYgKHJldCAhPT0gZmFsc2UpIHsKCSAgICAgIHJldHVybiBvYmplY3Q7CgkgICAgfQoJICB9LAoKCSAgUHJvZ3JhbTogZnVuY3Rpb24gUHJvZ3JhbShwcm9ncmFtKSB7CgkgICAgdGhpcy5hY2NlcHRBcnJheShwcm9ncmFtLmJvZHkpOwoJICB9LAoKCSAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHZpc2l0U3ViRXhwcmVzc2lvbiwKCSAgRGVjb3JhdG9yOiB2aXNpdFN1YkV4cHJlc3Npb24sCgoJICBCbG9ja1N0YXRlbWVudDogdmlzaXRCbG9jaywKCSAgRGVjb3JhdG9yQmxvY2s6IHZpc2l0QmxvY2ssCgoJICBQYXJ0aWFsU3RhdGVtZW50OiB2aXNpdFBhcnRpYWwsCgkgIFBhcnRpYWxCbG9ja1N0YXRlbWVudDogZnVuY3Rpb24gUGFydGlhbEJsb2NrU3RhdGVtZW50KHBhcnRpYWwpIHsKCSAgICB2aXNpdFBhcnRpYWwuY2FsbCh0aGlzLCBwYXJ0aWFsKTsKCgkgICAgdGhpcy5hY2NlcHRLZXkocGFydGlhbCwgJ3Byb2dyYW0nKTsKCSAgfSwKCgkgIENvbnRlbnRTdGF0ZW1lbnQ6IGZ1bmN0aW9uIENvbnRlbnRTdGF0ZW1lbnQoKSAvKiBjb250ZW50ICove30sCgkgIENvbW1lbnRTdGF0ZW1lbnQ6IGZ1bmN0aW9uIENvbW1lbnRTdGF0ZW1lbnQoKSAvKiBjb21tZW50ICove30sCgoJICBTdWJFeHByZXNzaW9uOiB2aXNpdFN1YkV4cHJlc3Npb24sCgoJICBQYXRoRXhwcmVzc2lvbjogZnVuY3Rpb24gUGF0aEV4cHJlc3Npb24oKSAvKiBwYXRoICove30sCgoJICBTdHJpbmdMaXRlcmFsOiBmdW5jdGlvbiBTdHJpbmdMaXRlcmFsKCkgLyogc3RyaW5nICove30sCgkgIE51bWJlckxpdGVyYWw6IGZ1bmN0aW9uIE51bWJlckxpdGVyYWwoKSAvKiBudW1iZXIgKi97fSwKCSAgQm9vbGVhbkxpdGVyYWw6IGZ1bmN0aW9uIEJvb2xlYW5MaXRlcmFsKCkgLyogYm9vbCAqL3t9LAoJICBVbmRlZmluZWRMaXRlcmFsOiBmdW5jdGlvbiBVbmRlZmluZWRMaXRlcmFsKCkgLyogbGl0ZXJhbCAqL3t9LAoJICBOdWxsTGl0ZXJhbDogZnVuY3Rpb24gTnVsbExpdGVyYWwoKSAvKiBsaXRlcmFsICove30sCgoJICBIYXNoOiBmdW5jdGlvbiBIYXNoKGhhc2gpIHsKCSAgICB0aGlzLmFjY2VwdEFycmF5KGhhc2gucGFpcnMpOwoJICB9LAoJICBIYXNoUGFpcjogZnVuY3Rpb24gSGFzaFBhaXIocGFpcikgewoJICAgIHRoaXMuYWNjZXB0UmVxdWlyZWQocGFpciwgJ3ZhbHVlJyk7CgkgIH0KCX07CgoJZnVuY3Rpb24gdmlzaXRTdWJFeHByZXNzaW9uKG11c3RhY2hlKSB7CgkgIHRoaXMuYWNjZXB0UmVxdWlyZWQobXVzdGFjaGUsICdwYXRoJyk7CgkgIHRoaXMuYWNjZXB0QXJyYXkobXVzdGFjaGUucGFyYW1zKTsKCSAgdGhpcy5hY2NlcHRLZXkobXVzdGFjaGUsICdoYXNoJyk7Cgl9CglmdW5jdGlvbiB2aXNpdEJsb2NrKGJsb2NrKSB7CgkgIHZpc2l0U3ViRXhwcmVzc2lvbi5jYWxsKHRoaXMsIGJsb2NrKTsKCgkgIHRoaXMuYWNjZXB0S2V5KGJsb2NrLCAncHJvZ3JhbScpOwoJICB0aGlzLmFjY2VwdEtleShibG9jaywgJ2ludmVyc2UnKTsKCX0KCWZ1bmN0aW9uIHZpc2l0UGFydGlhbChwYXJ0aWFsKSB7CgkgIHRoaXMuYWNjZXB0UmVxdWlyZWQocGFydGlhbCwgJ25hbWUnKTsKCSAgdGhpcy5hY2NlcHRBcnJheShwYXJ0aWFsLnBhcmFtcyk7CgkgIHRoaXMuYWNjZXB0S2V5KHBhcnRpYWwsICdoYXNoJyk7Cgl9CgoJZXhwb3J0c1snZGVmYXVsdCddID0gVmlzaXRvcjsKCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogMjYgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoJJ3VzZSBzdHJpY3QnOwoKCXZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKVsnZGVmYXVsdCddOwoKCWV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CglleHBvcnRzLlNvdXJjZUxvY2F0aW9uID0gU291cmNlTG9jYXRpb247CglleHBvcnRzLmlkID0gaWQ7CglleHBvcnRzLnN0cmlwRmxhZ3MgPSBzdHJpcEZsYWdzOwoJZXhwb3J0cy5zdHJpcENvbW1lbnQgPSBzdHJpcENvbW1lbnQ7CglleHBvcnRzLnByZXBhcmVQYXRoID0gcHJlcGFyZVBhdGg7CglleHBvcnRzLnByZXBhcmVNdXN0YWNoZSA9IHByZXBhcmVNdXN0YWNoZTsKCWV4cG9ydHMucHJlcGFyZVJhd0Jsb2NrID0gcHJlcGFyZVJhd0Jsb2NrOwoJZXhwb3J0cy5wcmVwYXJlQmxvY2sgPSBwcmVwYXJlQmxvY2s7CglleHBvcnRzLnByZXBhcmVQcm9ncmFtID0gcHJlcGFyZVByb2dyYW07CglleHBvcnRzLnByZXBhcmVQYXJ0aWFsQmxvY2sgPSBwcmVwYXJlUGFydGlhbEJsb2NrOwoKCXZhciBfZXhjZXB0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCgl2YXIgX2V4Y2VwdGlvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9leGNlcHRpb24pOwoKCWZ1bmN0aW9uIHZhbGlkYXRlQ2xvc2Uob3BlbiwgY2xvc2UpIHsKCSAgY2xvc2UgPSBjbG9zZS5wYXRoID8gY2xvc2UucGF0aC5vcmlnaW5hbCA6IGNsb3NlOwoKCSAgaWYgKG9wZW4ucGF0aC5vcmlnaW5hbCAhPT0gY2xvc2UpIHsKCSAgICB2YXIgZXJyb3JOb2RlID0geyBsb2M6IG9wZW4ucGF0aC5sb2MgfTsKCgkgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10ob3Blbi5wYXRoLm9yaWdpbmFsICsgIiBkb2Vzbid0IG1hdGNoICIgKyBjbG9zZSwgZXJyb3JOb2RlKTsKCSAgfQoJfQoKCWZ1bmN0aW9uIFNvdXJjZUxvY2F0aW9uKHNvdXJjZSwgbG9jSW5mbykgewoJICB0aGlzLnNvdXJjZSA9IHNvdXJjZTsKCSAgdGhpcy5zdGFydCA9IHsKCSAgICBsaW5lOiBsb2NJbmZvLmZpcnN0X2xpbmUsCgkgICAgY29sdW1uOiBsb2NJbmZvLmZpcnN0X2NvbHVtbgoJICB9OwoJICB0aGlzLmVuZCA9IHsKCSAgICBsaW5lOiBsb2NJbmZvLmxhc3RfbGluZSwKCSAgICBjb2x1bW46IGxvY0luZm8ubGFzdF9jb2x1bW4KCSAgfTsKCX0KCglmdW5jdGlvbiBpZCh0b2tlbikgewoJICBpZiAoL15cWy4qXF0kLy50ZXN0KHRva2VuKSkgewoJICAgIHJldHVybiB0b2tlbi5zdWJzdHIoMSwgdG9rZW4ubGVuZ3RoIC0gMik7CgkgIH0gZWxzZSB7CgkgICAgcmV0dXJuIHRva2VuOwoJICB9Cgl9CgoJZnVuY3Rpb24gc3RyaXBGbGFncyhvcGVuLCBjbG9zZSkgewoJICByZXR1cm4gewoJICAgIG9wZW46IG9wZW4uY2hhckF0KDIpID09PSAnficsCgkgICAgY2xvc2U6IGNsb3NlLmNoYXJBdChjbG9zZS5sZW5ndGggLSAzKSA9PT0gJ34nCgkgIH07Cgl9CgoJZnVuY3Rpb24gc3RyaXBDb21tZW50KGNvbW1lbnQpIHsKCSAgcmV0dXJuIGNvbW1lbnQucmVwbGFjZSgvXlx7XHt+P1whLT8tPy8sICcnKS5yZXBsYWNlKC8tPy0/fj9cfVx9JC8sICcnKTsKCX0KCglmdW5jdGlvbiBwcmVwYXJlUGF0aChkYXRhLCBwYXJ0cywgbG9jKSB7CgkgIGxvYyA9IHRoaXMubG9jSW5mbyhsb2MpOwoKCSAgdmFyIG9yaWdpbmFsID0gZGF0YSA/ICdAJyA6ICcnLAoJICAgICAgZGlnID0gW10sCgkgICAgICBkZXB0aCA9IDAsCgkgICAgICBkZXB0aFN0cmluZyA9ICcnOwoKCSAgZm9yICh2YXIgaSA9IDAsIGwgPSBwYXJ0cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKCSAgICB2YXIgcGFydCA9IHBhcnRzW2ldLnBhcnQsCgoJICAgIC8vIElmIHdlIGhhdmUgW10gc3ludGF4IHRoZW4gd2UgZG8gbm90IHRyZWF0IHBhdGggcmVmZXJlbmNlcyBhcyBvcGVyYXRvcnMsCgkgICAgLy8gaS5lLiBmb28uW3RoaXNdIHJlc29sdmVzIHRvIGFwcHJveGltYXRlbHkgY29udGV4dC5mb29bJ3RoaXMnXQoJICAgIGlzTGl0ZXJhbCA9IHBhcnRzW2ldLm9yaWdpbmFsICE9PSBwYXJ0OwoJICAgIG9yaWdpbmFsICs9IChwYXJ0c1tpXS5zZXBhcmF0b3IgfHwgJycpICsgcGFydDsKCgkgICAgaWYgKCFpc0xpdGVyYWwgJiYgKHBhcnQgPT09ICcuLicgfHwgcGFydCA9PT0gJy4nIHx8IHBhcnQgPT09ICd0aGlzJykpIHsKCSAgICAgIGlmIChkaWcubGVuZ3RoID4gMCkgewoJICAgICAgICB0aHJvdyBuZXcgX2V4Y2VwdGlvbjJbJ2RlZmF1bHQnXSgnSW52YWxpZCBwYXRoOiAnICsgb3JpZ2luYWwsIHsgbG9jOiBsb2MgfSk7CgkgICAgICB9IGVsc2UgaWYgKHBhcnQgPT09ICcuLicpIHsKCSAgICAgICAgZGVwdGgrKzsKCSAgICAgICAgZGVwdGhTdHJpbmcgKz0gJy4uLyc7CgkgICAgICB9CgkgICAgfSBlbHNlIHsKCSAgICAgIGRpZy5wdXNoKHBhcnQpOwoJICAgIH0KCSAgfQoKCSAgcmV0dXJuIHsKCSAgICB0eXBlOiAnUGF0aEV4cHJlc3Npb24nLAoJICAgIGRhdGE6IGRhdGEsCgkgICAgZGVwdGg6IGRlcHRoLAoJICAgIHBhcnRzOiBkaWcsCgkgICAgb3JpZ2luYWw6IG9yaWdpbmFsLAoJICAgIGxvYzogbG9jCgkgIH07Cgl9CgoJZnVuY3Rpb24gcHJlcGFyZU11c3RhY2hlKHBhdGgsIHBhcmFtcywgaGFzaCwgb3Blbiwgc3RyaXAsIGxvY0luZm8pIHsKCSAgLy8gTXVzdCB1c2UgY2hhckF0IHRvIHN1cHBvcnQgSUUgcHJlLTEwCgkgIHZhciBlc2NhcGVGbGFnID0gb3Blbi5jaGFyQXQoMykgfHwgb3Blbi5jaGFyQXQoMiksCgkgICAgICBlc2NhcGVkID0gZXNjYXBlRmxhZyAhPT0gJ3snICYmIGVzY2FwZUZsYWcgIT09ICcmJzsKCgkgIHZhciBkZWNvcmF0b3IgPSAvXCovLnRlc3Qob3Blbik7CgkgIHJldHVybiB7CgkgICAgdHlwZTogZGVjb3JhdG9yID8gJ0RlY29yYXRvcicgOiAnTXVzdGFjaGVTdGF0ZW1lbnQnLAoJICAgIHBhdGg6IHBhdGgsCgkgICAgcGFyYW1zOiBwYXJhbXMsCgkgICAgaGFzaDogaGFzaCwKCSAgICBlc2NhcGVkOiBlc2NhcGVkLAoJICAgIHN0cmlwOiBzdHJpcCwKCSAgICBsb2M6IHRoaXMubG9jSW5mbyhsb2NJbmZvKQoJICB9OwoJfQoKCWZ1bmN0aW9uIHByZXBhcmVSYXdCbG9jayhvcGVuUmF3QmxvY2ssIGNvbnRlbnRzLCBjbG9zZSwgbG9jSW5mbykgewoJICB2YWxpZGF0ZUNsb3NlKG9wZW5SYXdCbG9jaywgY2xvc2UpOwoKCSAgbG9jSW5mbyA9IHRoaXMubG9jSW5mbyhsb2NJbmZvKTsKCSAgdmFyIHByb2dyYW0gPSB7CgkgICAgdHlwZTogJ1Byb2dyYW0nLAoJICAgIGJvZHk6IGNvbnRlbnRzLAoJICAgIHN0cmlwOiB7fSwKCSAgICBsb2M6IGxvY0luZm8KCSAgfTsKCgkgIHJldHVybiB7CgkgICAgdHlwZTogJ0Jsb2NrU3RhdGVtZW50JywKCSAgICBwYXRoOiBvcGVuUmF3QmxvY2sucGF0aCwKCSAgICBwYXJhbXM6IG9wZW5SYXdCbG9jay5wYXJhbXMsCgkgICAgaGFzaDogb3BlblJhd0Jsb2NrLmhhc2gsCgkgICAgcHJvZ3JhbTogcHJvZ3JhbSwKCSAgICBvcGVuU3RyaXA6IHt9LAoJICAgIGludmVyc2VTdHJpcDoge30sCgkgICAgY2xvc2VTdHJpcDoge30sCgkgICAgbG9jOiBsb2NJbmZvCgkgIH07Cgl9CgoJZnVuY3Rpb24gcHJlcGFyZUJsb2NrKG9wZW5CbG9jaywgcHJvZ3JhbSwgaW52ZXJzZUFuZFByb2dyYW0sIGNsb3NlLCBpbnZlcnRlZCwgbG9jSW5mbykgewoJICBpZiAoY2xvc2UgJiYgY2xvc2UucGF0aCkgewoJICAgIHZhbGlkYXRlQ2xvc2Uob3BlbkJsb2NrLCBjbG9zZSk7CgkgIH0KCgkgIHZhciBkZWNvcmF0b3IgPSAvXCovLnRlc3Qob3BlbkJsb2NrLm9wZW4pOwoKCSAgcHJvZ3JhbS5ibG9ja1BhcmFtcyA9IG9wZW5CbG9jay5ibG9ja1BhcmFtczsKCgkgIHZhciBpbnZlcnNlID0gdW5kZWZpbmVkLAoJICAgICAgaW52ZXJzZVN0cmlwID0gdW5kZWZpbmVkOwoKCSAgaWYgKGludmVyc2VBbmRQcm9ncmFtKSB7CgkgICAgaWYgKGRlY29yYXRvcikgewoJICAgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ1VuZXhwZWN0ZWQgaW52ZXJzZSBibG9jayBvbiBkZWNvcmF0b3InLCBpbnZlcnNlQW5kUHJvZ3JhbSk7CgkgICAgfQoKCSAgICBpZiAoaW52ZXJzZUFuZFByb2dyYW0uY2hhaW4pIHsKCSAgICAgIGludmVyc2VBbmRQcm9ncmFtLnByb2dyYW0uYm9keVswXS5jbG9zZVN0cmlwID0gY2xvc2Uuc3RyaXA7CgkgICAgfQoKCSAgICBpbnZlcnNlU3RyaXAgPSBpbnZlcnNlQW5kUHJvZ3JhbS5zdHJpcDsKCSAgICBpbnZlcnNlID0gaW52ZXJzZUFuZFByb2dyYW0ucHJvZ3JhbTsKCSAgfQoKCSAgaWYgKGludmVydGVkKSB7CgkgICAgaW52ZXJ0ZWQgPSBpbnZlcnNlOwoJICAgIGludmVyc2UgPSBwcm9ncmFtOwoJICAgIHByb2dyYW0gPSBpbnZlcnRlZDsKCSAgfQoKCSAgcmV0dXJuIHsKCSAgICB0eXBlOiBkZWNvcmF0b3IgPyAnRGVjb3JhdG9yQmxvY2snIDogJ0Jsb2NrU3RhdGVtZW50JywKCSAgICBwYXRoOiBvcGVuQmxvY2sucGF0aCwKCSAgICBwYXJhbXM6IG9wZW5CbG9jay5wYXJhbXMsCgkgICAgaGFzaDogb3BlbkJsb2NrLmhhc2gsCgkgICAgcHJvZ3JhbTogcHJvZ3JhbSwKCSAgICBpbnZlcnNlOiBpbnZlcnNlLAoJICAgIG9wZW5TdHJpcDogb3BlbkJsb2NrLnN0cmlwLAoJICAgIGludmVyc2VTdHJpcDogaW52ZXJzZVN0cmlwLAoJICAgIGNsb3NlU3RyaXA6IGNsb3NlICYmIGNsb3NlLnN0cmlwLAoJICAgIGxvYzogdGhpcy5sb2NJbmZvKGxvY0luZm8pCgkgIH07Cgl9CgoJZnVuY3Rpb24gcHJlcGFyZVByb2dyYW0oc3RhdGVtZW50cywgbG9jKSB7CgkgIGlmICghbG9jICYmIHN0YXRlbWVudHMubGVuZ3RoKSB7CgkgICAgdmFyIGZpcnN0TG9jID0gc3RhdGVtZW50c1swXS5sb2MsCgkgICAgICAgIGxhc3RMb2MgPSBzdGF0ZW1lbnRzW3N0YXRlbWVudHMubGVuZ3RoIC0gMV0ubG9jOwoKCSAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwoJICAgIGlmIChmaXJzdExvYyAmJiBsYXN0TG9jKSB7CgkgICAgICBsb2MgPSB7CgkgICAgICAgIHNvdXJjZTogZmlyc3RMb2Muc291cmNlLAoJICAgICAgICBzdGFydDogewoJICAgICAgICAgIGxpbmU6IGZpcnN0TG9jLnN0YXJ0LmxpbmUsCgkgICAgICAgICAgY29sdW1uOiBmaXJzdExvYy5zdGFydC5jb2x1bW4KCSAgICAgICAgfSwKCSAgICAgICAgZW5kOiB7CgkgICAgICAgICAgbGluZTogbGFzdExvYy5lbmQubGluZSwKCSAgICAgICAgICBjb2x1bW46IGxhc3RMb2MuZW5kLmNvbHVtbgoJICAgICAgICB9CgkgICAgICB9OwoJICAgIH0KCSAgfQoKCSAgcmV0dXJuIHsKCSAgICB0eXBlOiAnUHJvZ3JhbScsCgkgICAgYm9keTogc3RhdGVtZW50cywKCSAgICBzdHJpcDoge30sCgkgICAgbG9jOiBsb2MKCSAgfTsKCX0KCglmdW5jdGlvbiBwcmVwYXJlUGFydGlhbEJsb2NrKG9wZW4sIHByb2dyYW0sIGNsb3NlLCBsb2NJbmZvKSB7CgkgIHZhbGlkYXRlQ2xvc2Uob3BlbiwgY2xvc2UpOwoKCSAgcmV0dXJuIHsKCSAgICB0eXBlOiAnUGFydGlhbEJsb2NrU3RhdGVtZW50JywKCSAgICBuYW1lOiBvcGVuLnBhdGgsCgkgICAgcGFyYW1zOiBvcGVuLnBhcmFtcywKCSAgICBoYXNoOiBvcGVuLmhhc2gsCgkgICAgcHJvZ3JhbTogcHJvZ3JhbSwKCSAgICBvcGVuU3RyaXA6IG9wZW4uc3RyaXAsCgkgICAgY2xvc2VTdHJpcDogY2xvc2UgJiYgY2xvc2Uuc3RyaXAsCgkgICAgbG9jOiB0aGlzLmxvY0luZm8obG9jSW5mbykKCSAgfTsKCX0KCi8qKiovIH0sCi8qIDI3ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCS8qIGVzbGludC1kaXNhYmxlIG5ldy1jYXAgKi8KCgkndXNlIHN0cmljdCc7CgoJdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpWydkZWZhdWx0J107CgoJZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCWV4cG9ydHMuQ29tcGlsZXIgPSBDb21waWxlcjsKCWV4cG9ydHMucHJlY29tcGlsZSA9IHByZWNvbXBpbGU7CglleHBvcnRzLmNvbXBpbGUgPSBjb21waWxlOwoKCXZhciBfZXhjZXB0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCgl2YXIgX2V4Y2VwdGlvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9leGNlcHRpb24pOwoKCXZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOwoKCXZhciBfYXN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMSk7CgoJdmFyIF9hc3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfYXN0KTsKCgl2YXIgc2xpY2UgPSBbXS5zbGljZTsKCglmdW5jdGlvbiBDb21waWxlcigpIHt9CgoJLy8gdGhlIGZvdW5kSGVscGVyIHJlZ2lzdGVyIHdpbGwgZGlzYW1iaWd1YXRlIGhlbHBlciBsb29rdXAgZnJvbSBmaW5kaW5nIGEKCS8vIGZ1bmN0aW9uIGluIGEgY29udGV4dC4gVGhpcyBpcyBuZWNlc3NhcnkgZm9yIG11c3RhY2hlIGNvbXBhdGliaWxpdHksIHdoaWNoCgkvLyByZXF1aXJlcyB0aGF0IGNvbnRleHQgZnVuY3Rpb25zIGluIGJsb2NrcyBhcmUgZXZhbHVhdGVkIGJ5IGJsb2NrSGVscGVyTWlzc2luZywKCS8vIGFuZCB0aGVuIHByb2NlZWQgYXMgaWYgdGhlIHJlc3VsdGluZyB2YWx1ZSB3YXMgcHJvdmlkZWQgdG8gYmxvY2tIZWxwZXJNaXNzaW5nLgoKCUNvbXBpbGVyLnByb3RvdHlwZSA9IHsKCSAgY29tcGlsZXI6IENvbXBpbGVyLAoKCSAgZXF1YWxzOiBmdW5jdGlvbiBlcXVhbHMob3RoZXIpIHsKCSAgICB2YXIgbGVuID0gdGhpcy5vcGNvZGVzLmxlbmd0aDsKCSAgICBpZiAob3RoZXIub3Bjb2Rlcy5sZW5ndGggIT09IGxlbikgewoJICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH0KCgkgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewoJICAgICAgdmFyIG9wY29kZSA9IHRoaXMub3Bjb2Rlc1tpXSwKCSAgICAgICAgICBvdGhlck9wY29kZSA9IG90aGVyLm9wY29kZXNbaV07CgkgICAgICBpZiAob3Bjb2RlLm9wY29kZSAhPT0gb3RoZXJPcGNvZGUub3Bjb2RlIHx8ICFhcmdFcXVhbHMob3Bjb2RlLmFyZ3MsIG90aGVyT3Bjb2RlLmFyZ3MpKSB7CgkgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgIH0KCSAgICB9CgoJICAgIC8vIFdlIGtub3cgdGhhdCBsZW5ndGggaXMgdGhlIHNhbWUgYmV0d2VlbiB0aGUgdHdvIGFycmF5cyBiZWNhdXNlIHRoZXkgYXJlIGRpcmVjdGx5IHRpZWQKCSAgICAvLyB0byB0aGUgb3Bjb2RlIGJlaGF2aW9yIGFib3ZlLgoJICAgIGxlbiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOwoJICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKCSAgICAgIGlmICghdGhpcy5jaGlsZHJlbltpXS5lcXVhbHMob3RoZXIuY2hpbGRyZW5baV0pKSB7CgkgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgIH0KCSAgICB9CgoJICAgIHJldHVybiB0cnVlOwoJICB9LAoKCSAgZ3VpZDogMCwKCgkgIGNvbXBpbGU6IGZ1bmN0aW9uIGNvbXBpbGUocHJvZ3JhbSwgb3B0aW9ucykgewoJICAgIHRoaXMuc291cmNlTm9kZSA9IFtdOwoJICAgIHRoaXMub3Bjb2RlcyA9IFtdOwoJICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKCSAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwoJICAgIHRoaXMuc3RyaW5nUGFyYW1zID0gb3B0aW9ucy5zdHJpbmdQYXJhbXM7CgkgICAgdGhpcy50cmFja0lkcyA9IG9wdGlvbnMudHJhY2tJZHM7CgoJICAgIG9wdGlvbnMuYmxvY2tQYXJhbXMgPSBvcHRpb25zLmJsb2NrUGFyYW1zIHx8IFtdOwoKCSAgICAvLyBUaGVzZSBjaGFuZ2VzIHdpbGwgcHJvcGFnYXRlIHRvIHRoZSBvdGhlciBjb21waWxlciBjb21wb25lbnRzCgkgICAgdmFyIGtub3duSGVscGVycyA9IG9wdGlvbnMua25vd25IZWxwZXJzOwoJICAgIG9wdGlvbnMua25vd25IZWxwZXJzID0gewoJICAgICAgJ2hlbHBlck1pc3NpbmcnOiB0cnVlLAoJICAgICAgJ2Jsb2NrSGVscGVyTWlzc2luZyc6IHRydWUsCgkgICAgICAnZWFjaCc6IHRydWUsCgkgICAgICAnaWYnOiB0cnVlLAoJICAgICAgJ3VubGVzcyc6IHRydWUsCgkgICAgICAnd2l0aCc6IHRydWUsCgkgICAgICAnbG9nJzogdHJ1ZSwKCSAgICAgICdsb29rdXAnOiB0cnVlCgkgICAgfTsKCSAgICBpZiAoa25vd25IZWxwZXJzKSB7CgkgICAgICBmb3IgKHZhciBfbmFtZSBpbiBrbm93bkhlbHBlcnMpIHsKCSAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KCSAgICAgICAgaWYgKF9uYW1lIGluIGtub3duSGVscGVycykgewoJICAgICAgICAgIG9wdGlvbnMua25vd25IZWxwZXJzW19uYW1lXSA9IGtub3duSGVscGVyc1tfbmFtZV07CgkgICAgICAgIH0KCSAgICAgIH0KCSAgICB9CgoJICAgIHJldHVybiB0aGlzLmFjY2VwdChwcm9ncmFtKTsKCSAgfSwKCgkgIGNvbXBpbGVQcm9ncmFtOiBmdW5jdGlvbiBjb21waWxlUHJvZ3JhbShwcm9ncmFtKSB7CgkgICAgdmFyIGNoaWxkQ29tcGlsZXIgPSBuZXcgdGhpcy5jb21waWxlcigpLAoJICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5ldy1jYXAKCSAgICByZXN1bHQgPSBjaGlsZENvbXBpbGVyLmNvbXBpbGUocHJvZ3JhbSwgdGhpcy5vcHRpb25zKSwKCSAgICAgICAgZ3VpZCA9IHRoaXMuZ3VpZCsrOwoKCSAgICB0aGlzLnVzZVBhcnRpYWwgPSB0aGlzLnVzZVBhcnRpYWwgfHwgcmVzdWx0LnVzZVBhcnRpYWw7CgoJICAgIHRoaXMuY2hpbGRyZW5bZ3VpZF0gPSByZXN1bHQ7CgkgICAgdGhpcy51c2VEZXB0aHMgPSB0aGlzLnVzZURlcHRocyB8fCByZXN1bHQudXNlRGVwdGhzOwoKCSAgICByZXR1cm4gZ3VpZDsKCSAgfSwKCgkgIGFjY2VwdDogZnVuY3Rpb24gYWNjZXB0KG5vZGUpIHsKCSAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dDogU2FuaXR5IGNvZGUgKi8KCSAgICBpZiAoIXRoaXNbbm9kZS50eXBlXSkgewoJICAgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ1Vua25vd24gdHlwZTogJyArIG5vZGUudHlwZSwgbm9kZSk7CgkgICAgfQoKCSAgICB0aGlzLnNvdXJjZU5vZGUudW5zaGlmdChub2RlKTsKCSAgICB2YXIgcmV0ID0gdGhpc1tub2RlLnR5cGVdKG5vZGUpOwoJICAgIHRoaXMuc291cmNlTm9kZS5zaGlmdCgpOwoJICAgIHJldHVybiByZXQ7CgkgIH0sCgoJICBQcm9ncmFtOiBmdW5jdGlvbiBQcm9ncmFtKHByb2dyYW0pIHsKCSAgICB0aGlzLm9wdGlvbnMuYmxvY2tQYXJhbXMudW5zaGlmdChwcm9ncmFtLmJsb2NrUGFyYW1zKTsKCgkgICAgdmFyIGJvZHkgPSBwcm9ncmFtLmJvZHksCgkgICAgICAgIGJvZHlMZW5ndGggPSBib2R5Lmxlbmd0aDsKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJvZHlMZW5ndGg7IGkrKykgewoJICAgICAgdGhpcy5hY2NlcHQoYm9keVtpXSk7CgkgICAgfQoKCSAgICB0aGlzLm9wdGlvbnMuYmxvY2tQYXJhbXMuc2hpZnQoKTsKCgkgICAgdGhpcy5pc1NpbXBsZSA9IGJvZHlMZW5ndGggPT09IDE7CgkgICAgdGhpcy5ibG9ja1BhcmFtcyA9IHByb2dyYW0uYmxvY2tQYXJhbXMgPyBwcm9ncmFtLmJsb2NrUGFyYW1zLmxlbmd0aCA6IDA7CgoJICAgIHJldHVybiB0aGlzOwoJICB9LAoKCSAgQmxvY2tTdGF0ZW1lbnQ6IGZ1bmN0aW9uIEJsb2NrU3RhdGVtZW50KGJsb2NrKSB7CgkgICAgdHJhbnNmb3JtTGl0ZXJhbFRvUGF0aChibG9jayk7CgoJICAgIHZhciBwcm9ncmFtID0gYmxvY2sucHJvZ3JhbSwKCSAgICAgICAgaW52ZXJzZSA9IGJsb2NrLmludmVyc2U7CgoJICAgIHByb2dyYW0gPSBwcm9ncmFtICYmIHRoaXMuY29tcGlsZVByb2dyYW0ocHJvZ3JhbSk7CgkgICAgaW52ZXJzZSA9IGludmVyc2UgJiYgdGhpcy5jb21waWxlUHJvZ3JhbShpbnZlcnNlKTsKCgkgICAgdmFyIHR5cGUgPSB0aGlzLmNsYXNzaWZ5U2V4cHIoYmxvY2spOwoKCSAgICBpZiAodHlwZSA9PT0gJ2hlbHBlcicpIHsKCSAgICAgIHRoaXMuaGVscGVyU2V4cHIoYmxvY2ssIHByb2dyYW0sIGludmVyc2UpOwoJICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3NpbXBsZScpIHsKCSAgICAgIHRoaXMuc2ltcGxlU2V4cHIoYmxvY2spOwoKCSAgICAgIC8vIG5vdyB0aGF0IHRoZSBzaW1wbGUgbXVzdGFjaGUgaXMgcmVzb2x2ZWQsIHdlIG5lZWQgdG8KCSAgICAgIC8vIGV2YWx1YXRlIGl0IGJ5IGV4ZWN1dGluZyBgYmxvY2tIZWxwZXJNaXNzaW5nYAoJICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hQcm9ncmFtJywgcHJvZ3JhbSk7CgkgICAgICB0aGlzLm9wY29kZSgncHVzaFByb2dyYW0nLCBpbnZlcnNlKTsKCSAgICAgIHRoaXMub3Bjb2RlKCdlbXB0eUhhc2gnKTsKCSAgICAgIHRoaXMub3Bjb2RlKCdibG9ja1ZhbHVlJywgYmxvY2sucGF0aC5vcmlnaW5hbCk7CgkgICAgfSBlbHNlIHsKCSAgICAgIHRoaXMuYW1iaWd1b3VzU2V4cHIoYmxvY2ssIHByb2dyYW0sIGludmVyc2UpOwoKCSAgICAgIC8vIG5vdyB0aGF0IHRoZSBzaW1wbGUgbXVzdGFjaGUgaXMgcmVzb2x2ZWQsIHdlIG5lZWQgdG8KCSAgICAgIC8vIGV2YWx1YXRlIGl0IGJ5IGV4ZWN1dGluZyBgYmxvY2tIZWxwZXJNaXNzaW5nYAoJICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hQcm9ncmFtJywgcHJvZ3JhbSk7CgkgICAgICB0aGlzLm9wY29kZSgncHVzaFByb2dyYW0nLCBpbnZlcnNlKTsKCSAgICAgIHRoaXMub3Bjb2RlKCdlbXB0eUhhc2gnKTsKCSAgICAgIHRoaXMub3Bjb2RlKCdhbWJpZ3VvdXNCbG9ja1ZhbHVlJyk7CgkgICAgfQoKCSAgICB0aGlzLm9wY29kZSgnYXBwZW5kJyk7CgkgIH0sCgoJICBEZWNvcmF0b3JCbG9jazogZnVuY3Rpb24gRGVjb3JhdG9yQmxvY2soZGVjb3JhdG9yKSB7CgkgICAgdmFyIHByb2dyYW0gPSBkZWNvcmF0b3IucHJvZ3JhbSAmJiB0aGlzLmNvbXBpbGVQcm9ncmFtKGRlY29yYXRvci5wcm9ncmFtKTsKCSAgICB2YXIgcGFyYW1zID0gdGhpcy5zZXR1cEZ1bGxNdXN0YWNoZVBhcmFtcyhkZWNvcmF0b3IsIHByb2dyYW0sIHVuZGVmaW5lZCksCgkgICAgICAgIHBhdGggPSBkZWNvcmF0b3IucGF0aDsKCgkgICAgdGhpcy51c2VEZWNvcmF0b3JzID0gdHJ1ZTsKCSAgICB0aGlzLm9wY29kZSgncmVnaXN0ZXJEZWNvcmF0b3InLCBwYXJhbXMubGVuZ3RoLCBwYXRoLm9yaWdpbmFsKTsKCSAgfSwKCgkgIFBhcnRpYWxTdGF0ZW1lbnQ6IGZ1bmN0aW9uIFBhcnRpYWxTdGF0ZW1lbnQocGFydGlhbCkgewoJICAgIHRoaXMudXNlUGFydGlhbCA9IHRydWU7CgoJICAgIHZhciBwcm9ncmFtID0gcGFydGlhbC5wcm9ncmFtOwoJICAgIGlmIChwcm9ncmFtKSB7CgkgICAgICBwcm9ncmFtID0gdGhpcy5jb21waWxlUHJvZ3JhbShwYXJ0aWFsLnByb2dyYW0pOwoJICAgIH0KCgkgICAgdmFyIHBhcmFtcyA9IHBhcnRpYWwucGFyYW1zOwoJICAgIGlmIChwYXJhbXMubGVuZ3RoID4gMSkgewoJICAgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ1Vuc3VwcG9ydGVkIG51bWJlciBvZiBwYXJ0aWFsIGFyZ3VtZW50czogJyArIHBhcmFtcy5sZW5ndGgsIHBhcnRpYWwpOwoJICAgIH0gZWxzZSBpZiAoIXBhcmFtcy5sZW5ndGgpIHsKCSAgICAgIGlmICh0aGlzLm9wdGlvbnMuZXhwbGljaXRQYXJ0aWFsQ29udGV4dCkgewoJICAgICAgICB0aGlzLm9wY29kZSgncHVzaExpdGVyYWwnLCAndW5kZWZpbmVkJyk7CgkgICAgICB9IGVsc2UgewoJICAgICAgICBwYXJhbXMucHVzaCh7IHR5cGU6ICdQYXRoRXhwcmVzc2lvbicsIHBhcnRzOiBbXSwgZGVwdGg6IDAgfSk7CgkgICAgICB9CgkgICAgfQoKCSAgICB2YXIgcGFydGlhbE5hbWUgPSBwYXJ0aWFsLm5hbWUub3JpZ2luYWwsCgkgICAgICAgIGlzRHluYW1pYyA9IHBhcnRpYWwubmFtZS50eXBlID09PSAnU3ViRXhwcmVzc2lvbic7CgkgICAgaWYgKGlzRHluYW1pYykgewoJICAgICAgdGhpcy5hY2NlcHQocGFydGlhbC5uYW1lKTsKCSAgICB9CgoJICAgIHRoaXMuc2V0dXBGdWxsTXVzdGFjaGVQYXJhbXMocGFydGlhbCwgcHJvZ3JhbSwgdW5kZWZpbmVkLCB0cnVlKTsKCgkgICAgdmFyIGluZGVudCA9IHBhcnRpYWwuaW5kZW50IHx8ICcnOwoJICAgIGlmICh0aGlzLm9wdGlvbnMucHJldmVudEluZGVudCAmJiBpbmRlbnQpIHsKCSAgICAgIHRoaXMub3Bjb2RlKCdhcHBlbmRDb250ZW50JywgaW5kZW50KTsKCSAgICAgIGluZGVudCA9ICcnOwoJICAgIH0KCgkgICAgdGhpcy5vcGNvZGUoJ2ludm9rZVBhcnRpYWwnLCBpc0R5bmFtaWMsIHBhcnRpYWxOYW1lLCBpbmRlbnQpOwoJICAgIHRoaXMub3Bjb2RlKCdhcHBlbmQnKTsKCSAgfSwKCSAgUGFydGlhbEJsb2NrU3RhdGVtZW50OiBmdW5jdGlvbiBQYXJ0aWFsQmxvY2tTdGF0ZW1lbnQocGFydGlhbEJsb2NrKSB7CgkgICAgdGhpcy5QYXJ0aWFsU3RhdGVtZW50KHBhcnRpYWxCbG9jayk7CgkgIH0sCgoJICBNdXN0YWNoZVN0YXRlbWVudDogZnVuY3Rpb24gTXVzdGFjaGVTdGF0ZW1lbnQobXVzdGFjaGUpIHsKCSAgICB0aGlzLlN1YkV4cHJlc3Npb24obXVzdGFjaGUpOwoKCSAgICBpZiAobXVzdGFjaGUuZXNjYXBlZCAmJiAhdGhpcy5vcHRpb25zLm5vRXNjYXBlKSB7CgkgICAgICB0aGlzLm9wY29kZSgnYXBwZW5kRXNjYXBlZCcpOwoJICAgIH0gZWxzZSB7CgkgICAgICB0aGlzLm9wY29kZSgnYXBwZW5kJyk7CgkgICAgfQoJICB9LAoJICBEZWNvcmF0b3I6IGZ1bmN0aW9uIERlY29yYXRvcihkZWNvcmF0b3IpIHsKCSAgICB0aGlzLkRlY29yYXRvckJsb2NrKGRlY29yYXRvcik7CgkgIH0sCgoJICBDb250ZW50U3RhdGVtZW50OiBmdW5jdGlvbiBDb250ZW50U3RhdGVtZW50KGNvbnRlbnQpIHsKCSAgICBpZiAoY29udGVudC52YWx1ZSkgewoJICAgICAgdGhpcy5vcGNvZGUoJ2FwcGVuZENvbnRlbnQnLCBjb250ZW50LnZhbHVlKTsKCSAgICB9CgkgIH0sCgoJICBDb21tZW50U3RhdGVtZW50OiBmdW5jdGlvbiBDb21tZW50U3RhdGVtZW50KCkge30sCgoJICBTdWJFeHByZXNzaW9uOiBmdW5jdGlvbiBTdWJFeHByZXNzaW9uKHNleHByKSB7CgkgICAgdHJhbnNmb3JtTGl0ZXJhbFRvUGF0aChzZXhwcik7CgkgICAgdmFyIHR5cGUgPSB0aGlzLmNsYXNzaWZ5U2V4cHIoc2V4cHIpOwoKCSAgICBpZiAodHlwZSA9PT0gJ3NpbXBsZScpIHsKCSAgICAgIHRoaXMuc2ltcGxlU2V4cHIoc2V4cHIpOwoJICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2hlbHBlcicpIHsKCSAgICAgIHRoaXMuaGVscGVyU2V4cHIoc2V4cHIpOwoJICAgIH0gZWxzZSB7CgkgICAgICB0aGlzLmFtYmlndW91c1NleHByKHNleHByKTsKCSAgICB9CgkgIH0sCgkgIGFtYmlndW91c1NleHByOiBmdW5jdGlvbiBhbWJpZ3VvdXNTZXhwcihzZXhwciwgcHJvZ3JhbSwgaW52ZXJzZSkgewoJICAgIHZhciBwYXRoID0gc2V4cHIucGF0aCwKCSAgICAgICAgbmFtZSA9IHBhdGgucGFydHNbMF0sCgkgICAgICAgIGlzQmxvY2sgPSBwcm9ncmFtICE9IG51bGwgfHwgaW52ZXJzZSAhPSBudWxsOwoKCSAgICB0aGlzLm9wY29kZSgnZ2V0Q29udGV4dCcsIHBhdGguZGVwdGgpOwoKCSAgICB0aGlzLm9wY29kZSgncHVzaFByb2dyYW0nLCBwcm9ncmFtKTsKCSAgICB0aGlzLm9wY29kZSgncHVzaFByb2dyYW0nLCBpbnZlcnNlKTsKCgkgICAgcGF0aC5zdHJpY3QgPSB0cnVlOwoJICAgIHRoaXMuYWNjZXB0KHBhdGgpOwoKCSAgICB0aGlzLm9wY29kZSgnaW52b2tlQW1iaWd1b3VzJywgbmFtZSwgaXNCbG9jayk7CgkgIH0sCgoJICBzaW1wbGVTZXhwcjogZnVuY3Rpb24gc2ltcGxlU2V4cHIoc2V4cHIpIHsKCSAgICB2YXIgcGF0aCA9IHNleHByLnBhdGg7CgkgICAgcGF0aC5zdHJpY3QgPSB0cnVlOwoJICAgIHRoaXMuYWNjZXB0KHBhdGgpOwoJICAgIHRoaXMub3Bjb2RlKCdyZXNvbHZlUG9zc2libGVMYW1iZGEnKTsKCSAgfSwKCgkgIGhlbHBlclNleHByOiBmdW5jdGlvbiBoZWxwZXJTZXhwcihzZXhwciwgcHJvZ3JhbSwgaW52ZXJzZSkgewoJICAgIHZhciBwYXJhbXMgPSB0aGlzLnNldHVwRnVsbE11c3RhY2hlUGFyYW1zKHNleHByLCBwcm9ncmFtLCBpbnZlcnNlKSwKCSAgICAgICAgcGF0aCA9IHNleHByLnBhdGgsCgkgICAgICAgIG5hbWUgPSBwYXRoLnBhcnRzWzBdOwoKCSAgICBpZiAodGhpcy5vcHRpb25zLmtub3duSGVscGVyc1tuYW1lXSkgewoJICAgICAgdGhpcy5vcGNvZGUoJ2ludm9rZUtub3duSGVscGVyJywgcGFyYW1zLmxlbmd0aCwgbmFtZSk7CgkgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMua25vd25IZWxwZXJzT25seSkgewoJICAgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ1lvdSBzcGVjaWZpZWQga25vd25IZWxwZXJzT25seSwgYnV0IHVzZWQgdGhlIHVua25vd24gaGVscGVyICcgKyBuYW1lLCBzZXhwcik7CgkgICAgfSBlbHNlIHsKCSAgICAgIHBhdGguc3RyaWN0ID0gdHJ1ZTsKCSAgICAgIHBhdGguZmFsc3kgPSB0cnVlOwoKCSAgICAgIHRoaXMuYWNjZXB0KHBhdGgpOwoJICAgICAgdGhpcy5vcGNvZGUoJ2ludm9rZUhlbHBlcicsIHBhcmFtcy5sZW5ndGgsIHBhdGgub3JpZ2luYWwsIF9hc3QyWydkZWZhdWx0J10uaGVscGVycy5zaW1wbGVJZChwYXRoKSk7CgkgICAgfQoJICB9LAoKCSAgUGF0aEV4cHJlc3Npb246IGZ1bmN0aW9uIFBhdGhFeHByZXNzaW9uKHBhdGgpIHsKCSAgICB0aGlzLmFkZERlcHRoKHBhdGguZGVwdGgpOwoJICAgIHRoaXMub3Bjb2RlKCdnZXRDb250ZXh0JywgcGF0aC5kZXB0aCk7CgoJICAgIHZhciBuYW1lID0gcGF0aC5wYXJ0c1swXSwKCSAgICAgICAgc2NvcGVkID0gX2FzdDJbJ2RlZmF1bHQnXS5oZWxwZXJzLnNjb3BlZElkKHBhdGgpLAoJICAgICAgICBibG9ja1BhcmFtSWQgPSAhcGF0aC5kZXB0aCAmJiAhc2NvcGVkICYmIHRoaXMuYmxvY2tQYXJhbUluZGV4KG5hbWUpOwoKCSAgICBpZiAoYmxvY2tQYXJhbUlkKSB7CgkgICAgICB0aGlzLm9wY29kZSgnbG9va3VwQmxvY2tQYXJhbScsIGJsb2NrUGFyYW1JZCwgcGF0aC5wYXJ0cyk7CgkgICAgfSBlbHNlIGlmICghbmFtZSkgewoJICAgICAgLy8gQ29udGV4dCByZWZlcmVuY2UsIGkuZS4gYHt7Zm9vIC59fWAgb3IgYHt7Zm9vIC4ufX1gCgkgICAgICB0aGlzLm9wY29kZSgncHVzaENvbnRleHQnKTsKCSAgICB9IGVsc2UgaWYgKHBhdGguZGF0YSkgewoJICAgICAgdGhpcy5vcHRpb25zLmRhdGEgPSB0cnVlOwoJICAgICAgdGhpcy5vcGNvZGUoJ2xvb2t1cERhdGEnLCBwYXRoLmRlcHRoLCBwYXRoLnBhcnRzLCBwYXRoLnN0cmljdCk7CgkgICAgfSBlbHNlIHsKCSAgICAgIHRoaXMub3Bjb2RlKCdsb29rdXBPbkNvbnRleHQnLCBwYXRoLnBhcnRzLCBwYXRoLmZhbHN5LCBwYXRoLnN0cmljdCwgc2NvcGVkKTsKCSAgICB9CgkgIH0sCgoJICBTdHJpbmdMaXRlcmFsOiBmdW5jdGlvbiBTdHJpbmdMaXRlcmFsKHN0cmluZykgewoJICAgIHRoaXMub3Bjb2RlKCdwdXNoU3RyaW5nJywgc3RyaW5nLnZhbHVlKTsKCSAgfSwKCgkgIE51bWJlckxpdGVyYWw6IGZ1bmN0aW9uIE51bWJlckxpdGVyYWwobnVtYmVyKSB7CgkgICAgdGhpcy5vcGNvZGUoJ3B1c2hMaXRlcmFsJywgbnVtYmVyLnZhbHVlKTsKCSAgfSwKCgkgIEJvb2xlYW5MaXRlcmFsOiBmdW5jdGlvbiBCb29sZWFuTGl0ZXJhbChib29sKSB7CgkgICAgdGhpcy5vcGNvZGUoJ3B1c2hMaXRlcmFsJywgYm9vbC52YWx1ZSk7CgkgIH0sCgoJICBVbmRlZmluZWRMaXRlcmFsOiBmdW5jdGlvbiBVbmRlZmluZWRMaXRlcmFsKCkgewoJICAgIHRoaXMub3Bjb2RlKCdwdXNoTGl0ZXJhbCcsICd1bmRlZmluZWQnKTsKCSAgfSwKCgkgIE51bGxMaXRlcmFsOiBmdW5jdGlvbiBOdWxsTGl0ZXJhbCgpIHsKCSAgICB0aGlzLm9wY29kZSgncHVzaExpdGVyYWwnLCAnbnVsbCcpOwoJICB9LAoKCSAgSGFzaDogZnVuY3Rpb24gSGFzaChoYXNoKSB7CgkgICAgdmFyIHBhaXJzID0gaGFzaC5wYWlycywKCSAgICAgICAgaSA9IDAsCgkgICAgICAgIGwgPSBwYWlycy5sZW5ndGg7CgoJICAgIHRoaXMub3Bjb2RlKCdwdXNoSGFzaCcpOwoKCSAgICBmb3IgKDsgaSA8IGw7IGkrKykgewoJICAgICAgdGhpcy5wdXNoUGFyYW0ocGFpcnNbaV0udmFsdWUpOwoJICAgIH0KCSAgICB3aGlsZSAoaS0tKSB7CgkgICAgICB0aGlzLm9wY29kZSgnYXNzaWduVG9IYXNoJywgcGFpcnNbaV0ua2V5KTsKCSAgICB9CgkgICAgdGhpcy5vcGNvZGUoJ3BvcEhhc2gnKTsKCSAgfSwKCgkgIC8vIEhFTFBFUlMKCSAgb3Bjb2RlOiBmdW5jdGlvbiBvcGNvZGUobmFtZSkgewoJICAgIHRoaXMub3Bjb2Rlcy5wdXNoKHsgb3Bjb2RlOiBuYW1lLCBhcmdzOiBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGxvYzogdGhpcy5zb3VyY2VOb2RlWzBdLmxvYyB9KTsKCSAgfSwKCgkgIGFkZERlcHRoOiBmdW5jdGlvbiBhZGREZXB0aChkZXB0aCkgewoJICAgIGlmICghZGVwdGgpIHsKCSAgICAgIHJldHVybjsKCSAgICB9CgoJICAgIHRoaXMudXNlRGVwdGhzID0gdHJ1ZTsKCSAgfSwKCgkgIGNsYXNzaWZ5U2V4cHI6IGZ1bmN0aW9uIGNsYXNzaWZ5U2V4cHIoc2V4cHIpIHsKCSAgICB2YXIgaXNTaW1wbGUgPSBfYXN0MlsnZGVmYXVsdCddLmhlbHBlcnMuc2ltcGxlSWQoc2V4cHIucGF0aCk7CgoJICAgIHZhciBpc0Jsb2NrUGFyYW0gPSBpc1NpbXBsZSAmJiAhIXRoaXMuYmxvY2tQYXJhbUluZGV4KHNleHByLnBhdGgucGFydHNbMF0pOwoKCSAgICAvLyBhIG11c3RhY2hlIGlzIGFuIGVsaWdpYmxlIGhlbHBlciBpZjoKCSAgICAvLyAqIGl0cyBpZCBpcyBzaW1wbGUgKGEgc2luZ2xlIHBhcnQsIG5vdCBgdGhpc2Agb3IgYC4uYCkKCSAgICB2YXIgaXNIZWxwZXIgPSAhaXNCbG9ja1BhcmFtICYmIF9hc3QyWydkZWZhdWx0J10uaGVscGVycy5oZWxwZXJFeHByZXNzaW9uKHNleHByKTsKCgkgICAgLy8gaWYgYSBtdXN0YWNoZSBpcyBhbiBlbGlnaWJsZSBoZWxwZXIgYnV0IG5vdCBhIGRlZmluaXRlCgkgICAgLy8gaGVscGVyLCBpdCBpcyBhbWJpZ3VvdXMsIGFuZCB3aWxsIGJlIHJlc29sdmVkIGluIGEgbGF0ZXIKCSAgICAvLyBwYXNzIG9yIGF0IHJ1bnRpbWUuCgkgICAgdmFyIGlzRWxpZ2libGUgPSAhaXNCbG9ja1BhcmFtICYmIChpc0hlbHBlciB8fCBpc1NpbXBsZSk7CgoJICAgIC8vIGlmIGFtYmlndW91cywgd2UgY2FuIHBvc3NpYmx5IHJlc29sdmUgdGhlIGFtYmlndWl0eSBub3cKCSAgICAvLyBBbiBlbGlnaWJsZSBoZWxwZXIgaXMgb25lIHRoYXQgZG9lcyBub3QgaGF2ZSBhIGNvbXBsZXggcGF0aCwgaS5lLiBgdGhpcy5mb29gLCBgLi4vZm9vYCBldGMuCgkgICAgaWYgKGlzRWxpZ2libGUgJiYgIWlzSGVscGVyKSB7CgkgICAgICB2YXIgX25hbWUyID0gc2V4cHIucGF0aC5wYXJ0c1swXSwKCSAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zOwoKCSAgICAgIGlmIChvcHRpb25zLmtub3duSGVscGVyc1tfbmFtZTJdKSB7CgkgICAgICAgIGlzSGVscGVyID0gdHJ1ZTsKCSAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5rbm93bkhlbHBlcnNPbmx5KSB7CgkgICAgICAgIGlzRWxpZ2libGUgPSBmYWxzZTsKCSAgICAgIH0KCSAgICB9CgoJICAgIGlmIChpc0hlbHBlcikgewoJICAgICAgcmV0dXJuICdoZWxwZXInOwoJICAgIH0gZWxzZSBpZiAoaXNFbGlnaWJsZSkgewoJICAgICAgcmV0dXJuICdhbWJpZ3VvdXMnOwoJICAgIH0gZWxzZSB7CgkgICAgICByZXR1cm4gJ3NpbXBsZSc7CgkgICAgfQoJICB9LAoKCSAgcHVzaFBhcmFtczogZnVuY3Rpb24gcHVzaFBhcmFtcyhwYXJhbXMpIHsKCSAgICBmb3IgKHZhciBpID0gMCwgbCA9IHBhcmFtcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKCSAgICAgIHRoaXMucHVzaFBhcmFtKHBhcmFtc1tpXSk7CgkgICAgfQoJICB9LAoKCSAgcHVzaFBhcmFtOiBmdW5jdGlvbiBwdXNoUGFyYW0odmFsKSB7CgkgICAgdmFyIHZhbHVlID0gdmFsLnZhbHVlICE9IG51bGwgPyB2YWwudmFsdWUgOiB2YWwub3JpZ2luYWwgfHwgJyc7CgoJICAgIGlmICh0aGlzLnN0cmluZ1BhcmFtcykgewoJICAgICAgaWYgKHZhbHVlLnJlcGxhY2UpIHsKCSAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9eKFwuP1wuXC8pKi9nLCAnJykucmVwbGFjZSgvXC8vZywgJy4nKTsKCSAgICAgIH0KCgkgICAgICBpZiAodmFsLmRlcHRoKSB7CgkgICAgICAgIHRoaXMuYWRkRGVwdGgodmFsLmRlcHRoKTsKCSAgICAgIH0KCSAgICAgIHRoaXMub3Bjb2RlKCdnZXRDb250ZXh0JywgdmFsLmRlcHRoIHx8IDApOwoJICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hTdHJpbmdQYXJhbScsIHZhbHVlLCB2YWwudHlwZSk7CgoJICAgICAgaWYgKHZhbC50eXBlID09PSAnU3ViRXhwcmVzc2lvbicpIHsKCSAgICAgICAgLy8gU3ViRXhwcmVzc2lvbnMgZ2V0IGV2YWx1YXRlZCBhbmQgcGFzc2VkIGluCgkgICAgICAgIC8vIGluIHN0cmluZyBwYXJhbXMgbW9kZS4KCSAgICAgICAgdGhpcy5hY2NlcHQodmFsKTsKCSAgICAgIH0KCSAgICB9IGVsc2UgewoJICAgICAgaWYgKHRoaXMudHJhY2tJZHMpIHsKCSAgICAgICAgdmFyIGJsb2NrUGFyYW1JbmRleCA9IHVuZGVmaW5lZDsKCSAgICAgICAgaWYgKHZhbC5wYXJ0cyAmJiAhX2FzdDJbJ2RlZmF1bHQnXS5oZWxwZXJzLnNjb3BlZElkKHZhbCkgJiYgIXZhbC5kZXB0aCkgewoJICAgICAgICAgIGJsb2NrUGFyYW1JbmRleCA9IHRoaXMuYmxvY2tQYXJhbUluZGV4KHZhbC5wYXJ0c1swXSk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJsb2NrUGFyYW1JbmRleCkgewoJICAgICAgICAgIHZhciBibG9ja1BhcmFtQ2hpbGQgPSB2YWwucGFydHMuc2xpY2UoMSkuam9pbignLicpOwoJICAgICAgICAgIHRoaXMub3Bjb2RlKCdwdXNoSWQnLCAnQmxvY2tQYXJhbScsIGJsb2NrUGFyYW1JbmRleCwgYmxvY2tQYXJhbUNoaWxkKTsKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICB2YWx1ZSA9IHZhbC5vcmlnaW5hbCB8fCB2YWx1ZTsKCSAgICAgICAgICBpZiAodmFsdWUucmVwbGFjZSkgewoJICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9edGhpcyg/OlwufCQpLywgJycpLnJlcGxhY2UoL15cLlwvLywgJycpLnJlcGxhY2UoL15cLiQvLCAnJyk7CgkgICAgICAgICAgfQoKCSAgICAgICAgICB0aGlzLm9wY29kZSgncHVzaElkJywgdmFsLnR5cGUsIHZhbHVlKTsKCSAgICAgICAgfQoJICAgICAgfQoJICAgICAgdGhpcy5hY2NlcHQodmFsKTsKCSAgICB9CgkgIH0sCgoJICBzZXR1cEZ1bGxNdXN0YWNoZVBhcmFtczogZnVuY3Rpb24gc2V0dXBGdWxsTXVzdGFjaGVQYXJhbXMoc2V4cHIsIHByb2dyYW0sIGludmVyc2UsIG9taXRFbXB0eSkgewoJICAgIHZhciBwYXJhbXMgPSBzZXhwci5wYXJhbXM7CgkgICAgdGhpcy5wdXNoUGFyYW1zKHBhcmFtcyk7CgoJICAgIHRoaXMub3Bjb2RlKCdwdXNoUHJvZ3JhbScsIHByb2dyYW0pOwoJICAgIHRoaXMub3Bjb2RlKCdwdXNoUHJvZ3JhbScsIGludmVyc2UpOwoKCSAgICBpZiAoc2V4cHIuaGFzaCkgewoJICAgICAgdGhpcy5hY2NlcHQoc2V4cHIuaGFzaCk7CgkgICAgfSBlbHNlIHsKCSAgICAgIHRoaXMub3Bjb2RlKCdlbXB0eUhhc2gnLCBvbWl0RW1wdHkpOwoJICAgIH0KCgkgICAgcmV0dXJuIHBhcmFtczsKCSAgfSwKCgkgIGJsb2NrUGFyYW1JbmRleDogZnVuY3Rpb24gYmxvY2tQYXJhbUluZGV4KG5hbWUpIHsKCSAgICBmb3IgKHZhciBkZXB0aCA9IDAsIGxlbiA9IHRoaXMub3B0aW9ucy5ibG9ja1BhcmFtcy5sZW5ndGg7IGRlcHRoIDwgbGVuOyBkZXB0aCsrKSB7CgkgICAgICB2YXIgYmxvY2tQYXJhbXMgPSB0aGlzLm9wdGlvbnMuYmxvY2tQYXJhbXNbZGVwdGhdLAoJICAgICAgICAgIHBhcmFtID0gYmxvY2tQYXJhbXMgJiYgX3V0aWxzLmluZGV4T2YoYmxvY2tQYXJhbXMsIG5hbWUpOwoJICAgICAgaWYgKGJsb2NrUGFyYW1zICYmIHBhcmFtID49IDApIHsKCSAgICAgICAgcmV0dXJuIFtkZXB0aCwgcGFyYW1dOwoJICAgICAgfQoJICAgIH0KCSAgfQoJfTsKCglmdW5jdGlvbiBwcmVjb21waWxlKGlucHV0LCBvcHRpb25zLCBlbnYpIHsKCSAgaWYgKGlucHV0ID09IG51bGwgfHwgdHlwZW9mIGlucHV0ICE9PSAnc3RyaW5nJyAmJiBpbnB1dC50eXBlICE9PSAnUHJvZ3JhbScpIHsKCSAgICB0aHJvdyBuZXcgX2V4Y2VwdGlvbjJbJ2RlZmF1bHQnXSgnWW91IG11c3QgcGFzcyBhIHN0cmluZyBvciBIYW5kbGViYXJzIEFTVCB0byBIYW5kbGViYXJzLnByZWNvbXBpbGUuIFlvdSBwYXNzZWQgJyArIGlucHV0KTsKCSAgfQoKCSAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgkgIGlmICghKCdkYXRhJyBpbiBvcHRpb25zKSkgewoJICAgIG9wdGlvbnMuZGF0YSA9IHRydWU7CgkgIH0KCSAgaWYgKG9wdGlvbnMuY29tcGF0KSB7CgkgICAgb3B0aW9ucy51c2VEZXB0aHMgPSB0cnVlOwoJICB9CgoJICB2YXIgYXN0ID0gZW52LnBhcnNlKGlucHV0LCBvcHRpb25zKSwKCSAgICAgIGVudmlyb25tZW50ID0gbmV3IGVudi5Db21waWxlcigpLmNvbXBpbGUoYXN0LCBvcHRpb25zKTsKCSAgcmV0dXJuIG5ldyBlbnYuSmF2YVNjcmlwdENvbXBpbGVyKCkuY29tcGlsZShlbnZpcm9ubWVudCwgb3B0aW9ucyk7Cgl9CgoJZnVuY3Rpb24gY29tcGlsZShpbnB1dCwgb3B0aW9ucywgZW52KSB7CgkgIGlmIChvcHRpb25zID09PSB1bmRlZmluZWQpIG9wdGlvbnMgPSB7fTsKCgkgIGlmIChpbnB1dCA9PSBudWxsIHx8IHR5cGVvZiBpbnB1dCAhPT0gJ3N0cmluZycgJiYgaW5wdXQudHlwZSAhPT0gJ1Byb2dyYW0nKSB7CgkgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ1lvdSBtdXN0IHBhc3MgYSBzdHJpbmcgb3IgSGFuZGxlYmFycyBBU1QgdG8gSGFuZGxlYmFycy5jb21waWxlLiBZb3UgcGFzc2VkICcgKyBpbnB1dCk7CgkgIH0KCgkgIGlmICghKCdkYXRhJyBpbiBvcHRpb25zKSkgewoJICAgIG9wdGlvbnMuZGF0YSA9IHRydWU7CgkgIH0KCSAgaWYgKG9wdGlvbnMuY29tcGF0KSB7CgkgICAgb3B0aW9ucy51c2VEZXB0aHMgPSB0cnVlOwoJICB9CgoJICB2YXIgY29tcGlsZWQgPSB1bmRlZmluZWQ7CgoJICBmdW5jdGlvbiBjb21waWxlSW5wdXQoKSB7CgkgICAgdmFyIGFzdCA9IGVudi5wYXJzZShpbnB1dCwgb3B0aW9ucyksCgkgICAgICAgIGVudmlyb25tZW50ID0gbmV3IGVudi5Db21waWxlcigpLmNvbXBpbGUoYXN0LCBvcHRpb25zKSwKCSAgICAgICAgdGVtcGxhdGVTcGVjID0gbmV3IGVudi5KYXZhU2NyaXB0Q29tcGlsZXIoKS5jb21waWxlKGVudmlyb25tZW50LCBvcHRpb25zLCB1bmRlZmluZWQsIHRydWUpOwoJICAgIHJldHVybiBlbnYudGVtcGxhdGUodGVtcGxhdGVTcGVjKTsKCSAgfQoKCSAgLy8gVGVtcGxhdGUgaXMgb25seSBjb21waWxlZCBvbiBmaXJzdCB1c2UgYW5kIGNhY2hlZCBhZnRlciB0aGF0IHBvaW50LgoJICBmdW5jdGlvbiByZXQoY29udGV4dCwgZXhlY09wdGlvbnMpIHsKCSAgICBpZiAoIWNvbXBpbGVkKSB7CgkgICAgICBjb21waWxlZCA9IGNvbXBpbGVJbnB1dCgpOwoJICAgIH0KCSAgICByZXR1cm4gY29tcGlsZWQuY2FsbCh0aGlzLCBjb250ZXh0LCBleGVjT3B0aW9ucyk7CgkgIH0KCSAgcmV0Ll9zZXR1cCA9IGZ1bmN0aW9uIChzZXR1cE9wdGlvbnMpIHsKCSAgICBpZiAoIWNvbXBpbGVkKSB7CgkgICAgICBjb21waWxlZCA9IGNvbXBpbGVJbnB1dCgpOwoJICAgIH0KCSAgICByZXR1cm4gY29tcGlsZWQuX3NldHVwKHNldHVwT3B0aW9ucyk7CgkgIH07CgkgIHJldC5fY2hpbGQgPSBmdW5jdGlvbiAoaSwgZGF0YSwgYmxvY2tQYXJhbXMsIGRlcHRocykgewoJICAgIGlmICghY29tcGlsZWQpIHsKCSAgICAgIGNvbXBpbGVkID0gY29tcGlsZUlucHV0KCk7CgkgICAgfQoJICAgIHJldHVybiBjb21waWxlZC5fY2hpbGQoaSwgZGF0YSwgYmxvY2tQYXJhbXMsIGRlcHRocyk7CgkgIH07CgkgIHJldHVybiByZXQ7Cgl9CgoJZnVuY3Rpb24gYXJnRXF1YWxzKGEsIGIpIHsKCSAgaWYgKGEgPT09IGIpIHsKCSAgICByZXR1cm4gdHJ1ZTsKCSAgfQoKCSAgaWYgKF91dGlscy5pc0FycmF5KGEpICYmIF91dGlscy5pc0FycmF5KGIpICYmIGEubGVuZ3RoID09PSBiLmxlbmd0aCkgewoJICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykgewoJICAgICAgaWYgKCFhcmdFcXVhbHMoYVtpXSwgYltpXSkpIHsKCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgfQoJICAgIH0KCSAgICByZXR1cm4gdHJ1ZTsKCSAgfQoJfQoKCWZ1bmN0aW9uIHRyYW5zZm9ybUxpdGVyYWxUb1BhdGgoc2V4cHIpIHsKCSAgaWYgKCFzZXhwci5wYXRoLnBhcnRzKSB7CgkgICAgdmFyIGxpdGVyYWwgPSBzZXhwci5wYXRoOwoJICAgIC8vIENhc3RpbmcgdG8gc3RyaW5nIGhlcmUgdG8gbWFrZSBmYWxzZSBhbmQgMCBsaXRlcmFsIHZhbHVlcyBwbGF5IG5pY2VseSB3aXRoIHRoZSByZXN0CgkgICAgLy8gb2YgdGhlIHN5c3RlbS4KCSAgICBzZXhwci5wYXRoID0gewoJICAgICAgdHlwZTogJ1BhdGhFeHByZXNzaW9uJywKCSAgICAgIGRhdGE6IGZhbHNlLAoJICAgICAgZGVwdGg6IDAsCgkgICAgICBwYXJ0czogW2xpdGVyYWwub3JpZ2luYWwgKyAnJ10sCgkgICAgICBvcmlnaW5hbDogbGl0ZXJhbC5vcmlnaW5hbCArICcnLAoJICAgICAgbG9jOiBsaXRlcmFsLmxvYwoJICAgIH07CgkgIH0KCX0KCi8qKiovIH0sCi8qIDI4ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCSd1c2Ugc3RyaWN0JzsKCgl2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18oMSlbJ2RlZmF1bHQnXTsKCglleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKCXZhciBfYmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7CgoJdmFyIF9leGNlcHRpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOwoKCXZhciBfZXhjZXB0aW9uMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2V4Y2VwdGlvbik7CgoJdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgoJdmFyIF9jb2RlR2VuID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOSk7CgoJdmFyIF9jb2RlR2VuMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvZGVHZW4pOwoKCWZ1bmN0aW9uIExpdGVyYWwodmFsdWUpIHsKCSAgdGhpcy52YWx1ZSA9IHZhbHVlOwoJfQoKCWZ1bmN0aW9uIEphdmFTY3JpcHRDb21waWxlcigpIHt9CgoJSmF2YVNjcmlwdENvbXBpbGVyLnByb3RvdHlwZSA9IHsKCSAgLy8gUFVCTElDIEFQSTogWW91IGNhbiBvdmVycmlkZSB0aGVzZSBtZXRob2RzIGluIGEgc3ViY2xhc3MgdG8gcHJvdmlkZQoJICAvLyBhbHRlcm5hdGl2ZSBjb21waWxlZCBmb3JtcyBmb3IgbmFtZSBsb29rdXAgYW5kIGJ1ZmZlcmluZyBzZW1hbnRpY3MKCSAgbmFtZUxvb2t1cDogZnVuY3Rpb24gbmFtZUxvb2t1cChwYXJlbnQsIG5hbWUgLyogLCB0eXBlKi8pIHsKCSAgICBpZiAoSmF2YVNjcmlwdENvbXBpbGVyLmlzVmFsaWRKYXZhU2NyaXB0VmFyaWFibGVOYW1lKG5hbWUpKSB7CgkgICAgICByZXR1cm4gW3BhcmVudCwgJy4nLCBuYW1lXTsKCSAgICB9IGVsc2UgewoJICAgICAgcmV0dXJuIFtwYXJlbnQsICdbJywgSlNPTi5zdHJpbmdpZnkobmFtZSksICddJ107CgkgICAgfQoJICB9LAoJICBkZXB0aGVkTG9va3VwOiBmdW5jdGlvbiBkZXB0aGVkTG9va3VwKG5hbWUpIHsKCSAgICByZXR1cm4gW3RoaXMuYWxpYXNhYmxlKCdjb250YWluZXIubG9va3VwJyksICcoZGVwdGhzLCAiJywgbmFtZSwgJyIpJ107CgkgIH0sCgoJICBjb21waWxlckluZm86IGZ1bmN0aW9uIGNvbXBpbGVySW5mbygpIHsKCSAgICB2YXIgcmV2aXNpb24gPSBfYmFzZS5DT01QSUxFUl9SRVZJU0lPTiwKCSAgICAgICAgdmVyc2lvbnMgPSBfYmFzZS5SRVZJU0lPTl9DSEFOR0VTW3JldmlzaW9uXTsKCSAgICByZXR1cm4gW3JldmlzaW9uLCB2ZXJzaW9uc107CgkgIH0sCgoJICBhcHBlbmRUb0J1ZmZlcjogZnVuY3Rpb24gYXBwZW5kVG9CdWZmZXIoc291cmNlLCBsb2NhdGlvbiwgZXhwbGljaXQpIHsKCSAgICAvLyBGb3JjZSBhIHNvdXJjZSBhcyB0aGlzIHNpbXBsaWZpZXMgdGhlIG1lcmdlIGxvZ2ljLgoJICAgIGlmICghX3V0aWxzLmlzQXJyYXkoc291cmNlKSkgewoJICAgICAgc291cmNlID0gW3NvdXJjZV07CgkgICAgfQoJICAgIHNvdXJjZSA9IHRoaXMuc291cmNlLndyYXAoc291cmNlLCBsb2NhdGlvbik7CgoJICAgIGlmICh0aGlzLmVudmlyb25tZW50LmlzU2ltcGxlKSB7CgkgICAgICByZXR1cm4gWydyZXR1cm4gJywgc291cmNlLCAnOyddOwoJICAgIH0gZWxzZSBpZiAoZXhwbGljaXQpIHsKCSAgICAgIC8vIFRoaXMgaXMgYSBjYXNlIHdoZXJlIHRoZSBidWZmZXIgb3BlcmF0aW9uIG9jY3VycyBhcyBhIGNoaWxkIG9mIGFub3RoZXIKCSAgICAgIC8vIGNvbnN0cnVjdCwgZ2VuZXJhbGx5IGJyYWNlcy4gV2UgaGF2ZSB0byBleHBsaWNpdGx5IG91dHB1dCB0aGVzZSBidWZmZXIKCSAgICAgIC8vIG9wZXJhdGlvbnMgdG8gZW5zdXJlIHRoYXQgdGhlIGVtaXR0ZWQgY29kZSBnb2VzIGluIHRoZSBjb3JyZWN0IGxvY2F0aW9uLgoJICAgICAgcmV0dXJuIFsnYnVmZmVyICs9ICcsIHNvdXJjZSwgJzsnXTsKCSAgICB9IGVsc2UgewoJICAgICAgc291cmNlLmFwcGVuZFRvQnVmZmVyID0gdHJ1ZTsKCSAgICAgIHJldHVybiBzb3VyY2U7CgkgICAgfQoJICB9LAoKCSAgaW5pdGlhbGl6ZUJ1ZmZlcjogZnVuY3Rpb24gaW5pdGlhbGl6ZUJ1ZmZlcigpIHsKCSAgICByZXR1cm4gdGhpcy5xdW90ZWRTdHJpbmcoJycpOwoJICB9LAoJICAvLyBFTkQgUFVCTElDIEFQSQoKCSAgY29tcGlsZTogZnVuY3Rpb24gY29tcGlsZShlbnZpcm9ubWVudCwgb3B0aW9ucywgY29udGV4dCwgYXNPYmplY3QpIHsKCSAgICB0aGlzLmVudmlyb25tZW50ID0gZW52aXJvbm1lbnQ7CgkgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCSAgICB0aGlzLnN0cmluZ1BhcmFtcyA9IHRoaXMub3B0aW9ucy5zdHJpbmdQYXJhbXM7CgkgICAgdGhpcy50cmFja0lkcyA9IHRoaXMub3B0aW9ucy50cmFja0lkczsKCSAgICB0aGlzLnByZWNvbXBpbGUgPSAhYXNPYmplY3Q7CgoJICAgIHRoaXMubmFtZSA9IHRoaXMuZW52aXJvbm1lbnQubmFtZTsKCSAgICB0aGlzLmlzQ2hpbGQgPSAhIWNvbnRleHQ7CgkgICAgdGhpcy5jb250ZXh0ID0gY29udGV4dCB8fCB7CgkgICAgICBkZWNvcmF0b3JzOiBbXSwKCSAgICAgIHByb2dyYW1zOiBbXSwKCSAgICAgIGVudmlyb25tZW50czogW10KCSAgICB9OwoKCSAgICB0aGlzLnByZWFtYmxlKCk7CgoJICAgIHRoaXMuc3RhY2tTbG90ID0gMDsKCSAgICB0aGlzLnN0YWNrVmFycyA9IFtdOwoJICAgIHRoaXMuYWxpYXNlcyA9IHt9OwoJICAgIHRoaXMucmVnaXN0ZXJzID0geyBsaXN0OiBbXSB9OwoJICAgIHRoaXMuaGFzaGVzID0gW107CgkgICAgdGhpcy5jb21waWxlU3RhY2sgPSBbXTsKCSAgICB0aGlzLmlubGluZVN0YWNrID0gW107CgkgICAgdGhpcy5ibG9ja1BhcmFtcyA9IFtdOwoKCSAgICB0aGlzLmNvbXBpbGVDaGlsZHJlbihlbnZpcm9ubWVudCwgb3B0aW9ucyk7CgoJICAgIHRoaXMudXNlRGVwdGhzID0gdGhpcy51c2VEZXB0aHMgfHwgZW52aXJvbm1lbnQudXNlRGVwdGhzIHx8IGVudmlyb25tZW50LnVzZURlY29yYXRvcnMgfHwgdGhpcy5vcHRpb25zLmNvbXBhdDsKCSAgICB0aGlzLnVzZUJsb2NrUGFyYW1zID0gdGhpcy51c2VCbG9ja1BhcmFtcyB8fCBlbnZpcm9ubWVudC51c2VCbG9ja1BhcmFtczsKCgkgICAgdmFyIG9wY29kZXMgPSBlbnZpcm9ubWVudC5vcGNvZGVzLAoJICAgICAgICBvcGNvZGUgPSB1bmRlZmluZWQsCgkgICAgICAgIGZpcnN0TG9jID0gdW5kZWZpbmVkLAoJICAgICAgICBpID0gdW5kZWZpbmVkLAoJICAgICAgICBsID0gdW5kZWZpbmVkOwoKCSAgICBmb3IgKGkgPSAwLCBsID0gb3Bjb2Rlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKCSAgICAgIG9wY29kZSA9IG9wY29kZXNbaV07CgoJICAgICAgdGhpcy5zb3VyY2UuY3VycmVudExvY2F0aW9uID0gb3Bjb2RlLmxvYzsKCSAgICAgIGZpcnN0TG9jID0gZmlyc3RMb2MgfHwgb3Bjb2RlLmxvYzsKCSAgICAgIHRoaXNbb3Bjb2RlLm9wY29kZV0uYXBwbHkodGhpcywgb3Bjb2RlLmFyZ3MpOwoJICAgIH0KCgkgICAgLy8gRmx1c2ggYW55IHRyYWlsaW5nIGNvbnRlbnQgdGhhdCBtaWdodCBiZSBwZW5kaW5nLgoJICAgIHRoaXMuc291cmNlLmN1cnJlbnRMb2NhdGlvbiA9IGZpcnN0TG9jOwoJICAgIHRoaXMucHVzaFNvdXJjZSgnJyk7CgoJICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgkgICAgaWYgKHRoaXMuc3RhY2tTbG90IHx8IHRoaXMuaW5saW5lU3RhY2subGVuZ3RoIHx8IHRoaXMuY29tcGlsZVN0YWNrLmxlbmd0aCkgewoJICAgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ0NvbXBpbGUgY29tcGxldGVkIHdpdGggY29udGVudCBsZWZ0IG9uIHN0YWNrJyk7CgkgICAgfQoKCSAgICBpZiAoIXRoaXMuZGVjb3JhdG9ycy5pc0VtcHR5KCkpIHsKCSAgICAgIHRoaXMudXNlRGVjb3JhdG9ycyA9IHRydWU7CgoJICAgICAgdGhpcy5kZWNvcmF0b3JzLnByZXBlbmQoJ3ZhciBkZWNvcmF0b3JzID0gY29udGFpbmVyLmRlY29yYXRvcnM7XG4nKTsKCSAgICAgIHRoaXMuZGVjb3JhdG9ycy5wdXNoKCdyZXR1cm4gZm47Jyk7CgoJICAgICAgaWYgKGFzT2JqZWN0KSB7CgkgICAgICAgIHRoaXMuZGVjb3JhdG9ycyA9IEZ1bmN0aW9uLmFwcGx5KHRoaXMsIFsnZm4nLCAncHJvcHMnLCAnY29udGFpbmVyJywgJ2RlcHRoMCcsICdkYXRhJywgJ2Jsb2NrUGFyYW1zJywgJ2RlcHRocycsIHRoaXMuZGVjb3JhdG9ycy5tZXJnZSgpXSk7CgkgICAgICB9IGVsc2UgewoJICAgICAgICB0aGlzLmRlY29yYXRvcnMucHJlcGVuZCgnZnVuY3Rpb24oZm4sIHByb3BzLCBjb250YWluZXIsIGRlcHRoMCwgZGF0YSwgYmxvY2tQYXJhbXMsIGRlcHRocykge1xuJyk7CgkgICAgICAgIHRoaXMuZGVjb3JhdG9ycy5wdXNoKCd9XG4nKTsKCSAgICAgICAgdGhpcy5kZWNvcmF0b3JzID0gdGhpcy5kZWNvcmF0b3JzLm1lcmdlKCk7CgkgICAgICB9CgkgICAgfSBlbHNlIHsKCSAgICAgIHRoaXMuZGVjb3JhdG9ycyA9IHVuZGVmaW5lZDsKCSAgICB9CgoJICAgIHZhciBmbiA9IHRoaXMuY3JlYXRlRnVuY3Rpb25Db250ZXh0KGFzT2JqZWN0KTsKCSAgICBpZiAoIXRoaXMuaXNDaGlsZCkgewoJICAgICAgdmFyIHJldCA9IHsKCSAgICAgICAgY29tcGlsZXI6IHRoaXMuY29tcGlsZXJJbmZvKCksCgkgICAgICAgIG1haW46IGZuCgkgICAgICB9OwoKCSAgICAgIGlmICh0aGlzLmRlY29yYXRvcnMpIHsKCSAgICAgICAgcmV0Lm1haW5fZCA9IHRoaXMuZGVjb3JhdG9yczsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2UKCSAgICAgICAgcmV0LnVzZURlY29yYXRvcnMgPSB0cnVlOwoJICAgICAgfQoKCSAgICAgIHZhciBfY29udGV4dCA9IHRoaXMuY29udGV4dDsKCSAgICAgIHZhciBwcm9ncmFtcyA9IF9jb250ZXh0LnByb2dyYW1zOwoJICAgICAgdmFyIGRlY29yYXRvcnMgPSBfY29udGV4dC5kZWNvcmF0b3JzOwoKCSAgICAgIGZvciAoaSA9IDAsIGwgPSBwcm9ncmFtcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKCSAgICAgICAgaWYgKHByb2dyYW1zW2ldKSB7CgkgICAgICAgICAgcmV0W2ldID0gcHJvZ3JhbXNbaV07CgkgICAgICAgICAgaWYgKGRlY29yYXRvcnNbaV0pIHsKCSAgICAgICAgICAgIHJldFtpICsgJ19kJ10gPSBkZWNvcmF0b3JzW2ldOwoJICAgICAgICAgICAgcmV0LnVzZURlY29yYXRvcnMgPSB0cnVlOwoJICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgfQoKCSAgICAgIGlmICh0aGlzLmVudmlyb25tZW50LnVzZVBhcnRpYWwpIHsKCSAgICAgICAgcmV0LnVzZVBhcnRpYWwgPSB0cnVlOwoJICAgICAgfQoJICAgICAgaWYgKHRoaXMub3B0aW9ucy5kYXRhKSB7CgkgICAgICAgIHJldC51c2VEYXRhID0gdHJ1ZTsKCSAgICAgIH0KCSAgICAgIGlmICh0aGlzLnVzZURlcHRocykgewoJICAgICAgICByZXQudXNlRGVwdGhzID0gdHJ1ZTsKCSAgICAgIH0KCSAgICAgIGlmICh0aGlzLnVzZUJsb2NrUGFyYW1zKSB7CgkgICAgICAgIHJldC51c2VCbG9ja1BhcmFtcyA9IHRydWU7CgkgICAgICB9CgkgICAgICBpZiAodGhpcy5vcHRpb25zLmNvbXBhdCkgewoJICAgICAgICByZXQuY29tcGF0ID0gdHJ1ZTsKCSAgICAgIH0KCgkgICAgICBpZiAoIWFzT2JqZWN0KSB7CgkgICAgICAgIHJldC5jb21waWxlciA9IEpTT04uc3RyaW5naWZ5KHJldC5jb21waWxlcik7CgoJICAgICAgICB0aGlzLnNvdXJjZS5jdXJyZW50TG9jYXRpb24gPSB7IHN0YXJ0OiB7IGxpbmU6IDEsIGNvbHVtbjogMCB9IH07CgkgICAgICAgIHJldCA9IHRoaXMub2JqZWN0TGl0ZXJhbChyZXQpOwoKCSAgICAgICAgaWYgKG9wdGlvbnMuc3JjTmFtZSkgewoJICAgICAgICAgIHJldCA9IHJldC50b1N0cmluZ1dpdGhTb3VyY2VNYXAoeyBmaWxlOiBvcHRpb25zLmRlc3ROYW1lIH0pOwoJICAgICAgICAgIHJldC5tYXAgPSByZXQubWFwICYmIHJldC5tYXAudG9TdHJpbmcoKTsKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICByZXQgPSByZXQudG9TdHJpbmcoKTsKCSAgICAgICAgfQoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgcmV0LmNvbXBpbGVyT3B0aW9ucyA9IHRoaXMub3B0aW9uczsKCSAgICAgIH0KCgkgICAgICByZXR1cm4gcmV0OwoJICAgIH0gZWxzZSB7CgkgICAgICByZXR1cm4gZm47CgkgICAgfQoJICB9LAoKCSAgcHJlYW1ibGU6IGZ1bmN0aW9uIHByZWFtYmxlKCkgewoJICAgIC8vIHRyYWNrIHRoZSBsYXN0IGNvbnRleHQgcHVzaGVkIGludG8gcGxhY2UgdG8gYWxsb3cgc2tpcHBpbmcgdGhlCgkgICAgLy8gZ2V0Q29udGV4dCBvcGNvZGUgd2hlbiBpdCB3b3VsZCBiZSBhIG5vb3AKCSAgICB0aGlzLmxhc3RDb250ZXh0ID0gMDsKCSAgICB0aGlzLnNvdXJjZSA9IG5ldyBfY29kZUdlbjJbJ2RlZmF1bHQnXSh0aGlzLm9wdGlvbnMuc3JjTmFtZSk7CgkgICAgdGhpcy5kZWNvcmF0b3JzID0gbmV3IF9jb2RlR2VuMlsnZGVmYXVsdCddKHRoaXMub3B0aW9ucy5zcmNOYW1lKTsKCSAgfSwKCgkgIGNyZWF0ZUZ1bmN0aW9uQ29udGV4dDogZnVuY3Rpb24gY3JlYXRlRnVuY3Rpb25Db250ZXh0KGFzT2JqZWN0KSB7CgkgICAgdmFyIHZhckRlY2xhcmF0aW9ucyA9ICcnOwoKCSAgICB2YXIgbG9jYWxzID0gdGhpcy5zdGFja1ZhcnMuY29uY2F0KHRoaXMucmVnaXN0ZXJzLmxpc3QpOwoJICAgIGlmIChsb2NhbHMubGVuZ3RoID4gMCkgewoJICAgICAgdmFyRGVjbGFyYXRpb25zICs9ICcsICcgKyBsb2NhbHMuam9pbignLCAnKTsKCSAgICB9CgoJICAgIC8vIEdlbmVyYXRlIG1pbmltaXplciBhbGlhcyBtYXBwaW5ncwoJICAgIC8vCgkgICAgLy8gV2hlbiB1c2luZyB0cnVlIFNvdXJjZU5vZGVzLCB0aGlzIHdpbGwgdXBkYXRlIGFsbCByZWZlcmVuY2VzIHRvIHRoZSBnaXZlbiBhbGlhcwoJICAgIC8vIGFzIHRoZSBzb3VyY2Ugbm9kZXMgYXJlIHJldXNlZCBpbiBzaXR1LiBGb3IgdGhlIG5vbi1zb3VyY2Ugbm9kZSBjb21waWxhdGlvbiBtb2RlLAoJICAgIC8vIGFsaWFzZXMgd2lsbCBub3QgYmUgdXNlZCwgYnV0IHRoaXMgY2FzZSBpcyBhbHJlYWR5IGJlaW5nIHJ1biBvbiB0aGUgY2xpZW50IGFuZAoJICAgIC8vIHdlIGFyZW4ndCBjb25jZXJuIGFib3V0IG1pbmltaXppbmcgdGhlIHRlbXBsYXRlIHNpemUuCgkgICAgdmFyIGFsaWFzQ291bnQgPSAwOwoJICAgIGZvciAodmFyIGFsaWFzIGluIHRoaXMuYWxpYXNlcykgewoJICAgICAgLy8gZXNsaW50LWRpc2FibGUtbGluZSBndWFyZC1mb3ItaW4KCSAgICAgIHZhciBub2RlID0gdGhpcy5hbGlhc2VzW2FsaWFzXTsKCgkgICAgICBpZiAodGhpcy5hbGlhc2VzLmhhc093blByb3BlcnR5KGFsaWFzKSAmJiBub2RlLmNoaWxkcmVuICYmIG5vZGUucmVmZXJlbmNlQ291bnQgPiAxKSB7CgkgICAgICAgIHZhckRlY2xhcmF0aW9ucyArPSAnLCBhbGlhcycgKyArK2FsaWFzQ291bnQgKyAnPScgKyBhbGlhczsKCSAgICAgICAgbm9kZS5jaGlsZHJlblswXSA9ICdhbGlhcycgKyBhbGlhc0NvdW50OwoJICAgICAgfQoJICAgIH0KCgkgICAgdmFyIHBhcmFtcyA9IFsnY29udGFpbmVyJywgJ2RlcHRoMCcsICdoZWxwZXJzJywgJ3BhcnRpYWxzJywgJ2RhdGEnXTsKCgkgICAgaWYgKHRoaXMudXNlQmxvY2tQYXJhbXMgfHwgdGhpcy51c2VEZXB0aHMpIHsKCSAgICAgIHBhcmFtcy5wdXNoKCdibG9ja1BhcmFtcycpOwoJICAgIH0KCSAgICBpZiAodGhpcy51c2VEZXB0aHMpIHsKCSAgICAgIHBhcmFtcy5wdXNoKCdkZXB0aHMnKTsKCSAgICB9CgoJICAgIC8vIFBlcmZvcm0gYSBzZWNvbmQgcGFzcyBvdmVyIHRoZSBvdXRwdXQgdG8gbWVyZ2UgY29udGVudCB3aGVuIHBvc3NpYmxlCgkgICAgdmFyIHNvdXJjZSA9IHRoaXMubWVyZ2VTb3VyY2UodmFyRGVjbGFyYXRpb25zKTsKCgkgICAgaWYgKGFzT2JqZWN0KSB7CgkgICAgICBwYXJhbXMucHVzaChzb3VyY2UpOwoKCSAgICAgIHJldHVybiBGdW5jdGlvbi5hcHBseSh0aGlzLCBwYXJhbXMpOwoJICAgIH0gZWxzZSB7CgkgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uud3JhcChbJ2Z1bmN0aW9uKCcsIHBhcmFtcy5qb2luKCcsJyksICcpIHtcbiAgJywgc291cmNlLCAnfSddKTsKCSAgICB9CgkgIH0sCgkgIG1lcmdlU291cmNlOiBmdW5jdGlvbiBtZXJnZVNvdXJjZSh2YXJEZWNsYXJhdGlvbnMpIHsKCSAgICB2YXIgaXNTaW1wbGUgPSB0aGlzLmVudmlyb25tZW50LmlzU2ltcGxlLAoJICAgICAgICBhcHBlbmRPbmx5ID0gIXRoaXMuZm9yY2VCdWZmZXIsCgkgICAgICAgIGFwcGVuZEZpcnN0ID0gdW5kZWZpbmVkLAoJICAgICAgICBzb3VyY2VTZWVuID0gdW5kZWZpbmVkLAoJICAgICAgICBidWZmZXJTdGFydCA9IHVuZGVmaW5lZCwKCSAgICAgICAgYnVmZmVyRW5kID0gdW5kZWZpbmVkOwoJICAgIHRoaXMuc291cmNlLmVhY2goZnVuY3Rpb24gKGxpbmUpIHsKCSAgICAgIGlmIChsaW5lLmFwcGVuZFRvQnVmZmVyKSB7CgkgICAgICAgIGlmIChidWZmZXJTdGFydCkgewoJICAgICAgICAgIGxpbmUucHJlcGVuZCgnICArICcpOwoJICAgICAgICB9IGVsc2UgewoJICAgICAgICAgIGJ1ZmZlclN0YXJ0ID0gbGluZTsKCSAgICAgICAgfQoJICAgICAgICBidWZmZXJFbmQgPSBsaW5lOwoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgaWYgKGJ1ZmZlclN0YXJ0KSB7CgkgICAgICAgICAgaWYgKCFzb3VyY2VTZWVuKSB7CgkgICAgICAgICAgICBhcHBlbmRGaXJzdCA9IHRydWU7CgkgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgIGJ1ZmZlclN0YXJ0LnByZXBlbmQoJ2J1ZmZlciArPSAnKTsKCSAgICAgICAgICB9CgkgICAgICAgICAgYnVmZmVyRW5kLmFkZCgnOycpOwoJICAgICAgICAgIGJ1ZmZlclN0YXJ0ID0gYnVmZmVyRW5kID0gdW5kZWZpbmVkOwoJICAgICAgICB9CgoJICAgICAgICBzb3VyY2VTZWVuID0gdHJ1ZTsKCSAgICAgICAgaWYgKCFpc1NpbXBsZSkgewoJICAgICAgICAgIGFwcGVuZE9ubHkgPSBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgfQoJICAgIH0pOwoKCSAgICBpZiAoYXBwZW5kT25seSkgewoJICAgICAgaWYgKGJ1ZmZlclN0YXJ0KSB7CgkgICAgICAgIGJ1ZmZlclN0YXJ0LnByZXBlbmQoJ3JldHVybiAnKTsKCSAgICAgICAgYnVmZmVyRW5kLmFkZCgnOycpOwoJICAgICAgfSBlbHNlIGlmICghc291cmNlU2VlbikgewoJICAgICAgICB0aGlzLnNvdXJjZS5wdXNoKCdyZXR1cm4gIiI7Jyk7CgkgICAgICB9CgkgICAgfSBlbHNlIHsKCSAgICAgIHZhckRlY2xhcmF0aW9ucyArPSAnLCBidWZmZXIgPSAnICsgKGFwcGVuZEZpcnN0ID8gJycgOiB0aGlzLmluaXRpYWxpemVCdWZmZXIoKSk7CgoJICAgICAgaWYgKGJ1ZmZlclN0YXJ0KSB7CgkgICAgICAgIGJ1ZmZlclN0YXJ0LnByZXBlbmQoJ3JldHVybiBidWZmZXIgKyAnKTsKCSAgICAgICAgYnVmZmVyRW5kLmFkZCgnOycpOwoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgdGhpcy5zb3VyY2UucHVzaCgncmV0dXJuIGJ1ZmZlcjsnKTsKCSAgICAgIH0KCSAgICB9CgoJICAgIGlmICh2YXJEZWNsYXJhdGlvbnMpIHsKCSAgICAgIHRoaXMuc291cmNlLnByZXBlbmQoJ3ZhciAnICsgdmFyRGVjbGFyYXRpb25zLnN1YnN0cmluZygyKSArIChhcHBlbmRGaXJzdCA/ICcnIDogJztcbicpKTsKCSAgICB9CgoJICAgIHJldHVybiB0aGlzLnNvdXJjZS5tZXJnZSgpOwoJICB9LAoKCSAgLy8gW2Jsb2NrVmFsdWVdCgkgIC8vCgkgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IGhhc2gsIGludmVyc2UsIHByb2dyYW0sIHZhbHVlCgkgIC8vIE9uIHN0YWNrLCBhZnRlcjogcmV0dXJuIHZhbHVlIG9mIGJsb2NrSGVscGVyTWlzc2luZwoJICAvLwoJICAvLyBUaGUgcHVycG9zZSBvZiB0aGlzIG9wY29kZSBpcyB0byB0YWtlIGEgYmxvY2sgb2YgdGhlIGZvcm0KCSAgLy8gYHt7I3RoaXMuZm9vfX0uLi57ey90aGlzLmZvb319YCwgcmVzb2x2ZSB0aGUgdmFsdWUgb2YgYGZvb2AsIGFuZAoJICAvLyByZXBsYWNlIGl0IG9uIHRoZSBzdGFjayB3aXRoIHRoZSByZXN1bHQgb2YgcHJvcGVybHkKCSAgLy8gaW52b2tpbmcgYmxvY2tIZWxwZXJNaXNzaW5nLgoJICBibG9ja1ZhbHVlOiBmdW5jdGlvbiBibG9ja1ZhbHVlKG5hbWUpIHsKCSAgICB2YXIgYmxvY2tIZWxwZXJNaXNzaW5nID0gdGhpcy5hbGlhc2FibGUoJ2hlbHBlcnMuYmxvY2tIZWxwZXJNaXNzaW5nJyksCgkgICAgICAgIHBhcmFtcyA9IFt0aGlzLmNvbnRleHROYW1lKDApXTsKCSAgICB0aGlzLnNldHVwSGVscGVyQXJncyhuYW1lLCAwLCBwYXJhbXMpOwoKCSAgICB2YXIgYmxvY2tOYW1lID0gdGhpcy5wb3BTdGFjaygpOwoJICAgIHBhcmFtcy5zcGxpY2UoMSwgMCwgYmxvY2tOYW1lKTsKCgkgICAgdGhpcy5wdXNoKHRoaXMuc291cmNlLmZ1bmN0aW9uQ2FsbChibG9ja0hlbHBlck1pc3NpbmcsICdjYWxsJywgcGFyYW1zKSk7CgkgIH0sCgoJICAvLyBbYW1iaWd1b3VzQmxvY2tWYWx1ZV0KCSAgLy8KCSAgLy8gT24gc3RhY2ssIGJlZm9yZTogaGFzaCwgaW52ZXJzZSwgcHJvZ3JhbSwgdmFsdWUKCSAgLy8gQ29tcGlsZXIgdmFsdWUsIGJlZm9yZTogbGFzdEhlbHBlcj12YWx1ZSBvZiBsYXN0IGZvdW5kIGhlbHBlciwgaWYgYW55CgkgIC8vIE9uIHN0YWNrLCBhZnRlciwgaWYgbm8gbGFzdEhlbHBlcjogc2FtZSBhcyBbYmxvY2tWYWx1ZV0KCSAgLy8gT24gc3RhY2ssIGFmdGVyLCBpZiBsYXN0SGVscGVyOiB2YWx1ZQoJICBhbWJpZ3VvdXNCbG9ja1ZhbHVlOiBmdW5jdGlvbiBhbWJpZ3VvdXNCbG9ja1ZhbHVlKCkgewoJICAgIC8vIFdlJ3JlIGJlaW5nIGEgYml0IGNoZWVreSBhbmQgcmV1c2luZyB0aGUgb3B0aW9ucyB2YWx1ZSBmcm9tIHRoZSBwcmlvciBleGVjCgkgICAgdmFyIGJsb2NrSGVscGVyTWlzc2luZyA9IHRoaXMuYWxpYXNhYmxlKCdoZWxwZXJzLmJsb2NrSGVscGVyTWlzc2luZycpLAoJICAgICAgICBwYXJhbXMgPSBbdGhpcy5jb250ZXh0TmFtZSgwKV07CgkgICAgdGhpcy5zZXR1cEhlbHBlckFyZ3MoJycsIDAsIHBhcmFtcywgdHJ1ZSk7CgoJICAgIHRoaXMuZmx1c2hJbmxpbmUoKTsKCgkgICAgdmFyIGN1cnJlbnQgPSB0aGlzLnRvcFN0YWNrKCk7CgkgICAgcGFyYW1zLnNwbGljZSgxLCAwLCBjdXJyZW50KTsKCgkgICAgdGhpcy5wdXNoU291cmNlKFsnaWYgKCEnLCB0aGlzLmxhc3RIZWxwZXIsICcpIHsgJywgY3VycmVudCwgJyA9ICcsIHRoaXMuc291cmNlLmZ1bmN0aW9uQ2FsbChibG9ja0hlbHBlck1pc3NpbmcsICdjYWxsJywgcGFyYW1zKSwgJ30nXSk7CgkgIH0sCgoJICAvLyBbYXBwZW5kQ29udGVudF0KCSAgLy8KCSAgLy8gT24gc3RhY2ssIGJlZm9yZTogLi4uCgkgIC8vIE9uIHN0YWNrLCBhZnRlcjogLi4uCgkgIC8vCgkgIC8vIEFwcGVuZHMgdGhlIHN0cmluZyB2YWx1ZSBvZiBgY29udGVudGAgdG8gdGhlIGN1cnJlbnQgYnVmZmVyCgkgIGFwcGVuZENvbnRlbnQ6IGZ1bmN0aW9uIGFwcGVuZENvbnRlbnQoY29udGVudCkgewoJICAgIGlmICh0aGlzLnBlbmRpbmdDb250ZW50KSB7CgkgICAgICBjb250ZW50ID0gdGhpcy5wZW5kaW5nQ29udGVudCArIGNvbnRlbnQ7CgkgICAgfSBlbHNlIHsKCSAgICAgIHRoaXMucGVuZGluZ0xvY2F0aW9uID0gdGhpcy5zb3VyY2UuY3VycmVudExvY2F0aW9uOwoJICAgIH0KCgkgICAgdGhpcy5wZW5kaW5nQ29udGVudCA9IGNvbnRlbnQ7CgkgIH0sCgoJICAvLyBbYXBwZW5kXQoJICAvLwoJICAvLyBPbiBzdGFjaywgYmVmb3JlOiB2YWx1ZSwgLi4uCgkgIC8vIE9uIHN0YWNrLCBhZnRlcjogLi4uCgkgIC8vCgkgIC8vIENvZXJjZXMgYHZhbHVlYCB0byBhIFN0cmluZyBhbmQgYXBwZW5kcyBpdCB0byB0aGUgY3VycmVudCBidWZmZXIuCgkgIC8vCgkgIC8vIElmIGB2YWx1ZWAgaXMgdHJ1dGh5LCBvciAwLCBpdCBpcyBjb2VyY2VkIGludG8gYSBzdHJpbmcgYW5kIGFwcGVuZGVkCgkgIC8vIE90aGVyd2lzZSwgdGhlIGVtcHR5IHN0cmluZyBpcyBhcHBlbmRlZAoJICBhcHBlbmQ6IGZ1bmN0aW9uIGFwcGVuZCgpIHsKCSAgICBpZiAodGhpcy5pc0lubGluZSgpKSB7CgkgICAgICB0aGlzLnJlcGxhY2VTdGFjayhmdW5jdGlvbiAoY3VycmVudCkgewoJICAgICAgICByZXR1cm4gWycgIT0gbnVsbCA/ICcsIGN1cnJlbnQsICcgOiAiIiddOwoJICAgICAgfSk7CgoJICAgICAgdGhpcy5wdXNoU291cmNlKHRoaXMuYXBwZW5kVG9CdWZmZXIodGhpcy5wb3BTdGFjaygpKSk7CgkgICAgfSBlbHNlIHsKCSAgICAgIHZhciBsb2NhbCA9IHRoaXMucG9wU3RhY2soKTsKCSAgICAgIHRoaXMucHVzaFNvdXJjZShbJ2lmICgnLCBsb2NhbCwgJyAhPSBudWxsKSB7ICcsIHRoaXMuYXBwZW5kVG9CdWZmZXIobG9jYWwsIHVuZGVmaW5lZCwgdHJ1ZSksICcgfSddKTsKCSAgICAgIGlmICh0aGlzLmVudmlyb25tZW50LmlzU2ltcGxlKSB7CgkgICAgICAgIHRoaXMucHVzaFNvdXJjZShbJ2Vsc2UgeyAnLCB0aGlzLmFwcGVuZFRvQnVmZmVyKCInJyIsIHVuZGVmaW5lZCwgdHJ1ZSksICcgfSddKTsKCSAgICAgIH0KCSAgICB9CgkgIH0sCgoJICAvLyBbYXBwZW5kRXNjYXBlZF0KCSAgLy8KCSAgLy8gT24gc3RhY2ssIGJlZm9yZTogdmFsdWUsIC4uLgoJICAvLyBPbiBzdGFjaywgYWZ0ZXI6IC4uLgoJICAvLwoJICAvLyBFc2NhcGUgYHZhbHVlYCBhbmQgYXBwZW5kIGl0IHRvIHRoZSBidWZmZXIKCSAgYXBwZW5kRXNjYXBlZDogZnVuY3Rpb24gYXBwZW5kRXNjYXBlZCgpIHsKCSAgICB0aGlzLnB1c2hTb3VyY2UodGhpcy5hcHBlbmRUb0J1ZmZlcihbdGhpcy5hbGlhc2FibGUoJ2NvbnRhaW5lci5lc2NhcGVFeHByZXNzaW9uJyksICcoJywgdGhpcy5wb3BTdGFjaygpLCAnKSddKSk7CgkgIH0sCgoJICAvLyBbZ2V0Q29udGV4dF0KCSAgLy8KCSAgLy8gT24gc3RhY2ssIGJlZm9yZTogLi4uCgkgIC8vIE9uIHN0YWNrLCBhZnRlcjogLi4uCgkgIC8vIENvbXBpbGVyIHZhbHVlLCBhZnRlcjogbGFzdENvbnRleHQ9ZGVwdGgKCSAgLy8KCSAgLy8gU2V0IHRoZSB2YWx1ZSBvZiB0aGUgYGxhc3RDb250ZXh0YCBjb21waWxlciB2YWx1ZSB0byB0aGUgZGVwdGgKCSAgZ2V0Q29udGV4dDogZnVuY3Rpb24gZ2V0Q29udGV4dChkZXB0aCkgewoJICAgIHRoaXMubGFzdENvbnRleHQgPSBkZXB0aDsKCSAgfSwKCgkgIC8vIFtwdXNoQ29udGV4dF0KCSAgLy8KCSAgLy8gT24gc3RhY2ssIGJlZm9yZTogLi4uCgkgIC8vIE9uIHN0YWNrLCBhZnRlcjogY3VycmVudENvbnRleHQsIC4uLgoJICAvLwoJICAvLyBQdXNoZXMgdGhlIHZhbHVlIG9mIHRoZSBjdXJyZW50IGNvbnRleHQgb250byB0aGUgc3RhY2suCgkgIHB1c2hDb250ZXh0OiBmdW5jdGlvbiBwdXNoQ29udGV4dCgpIHsKCSAgICB0aGlzLnB1c2hTdGFja0xpdGVyYWwodGhpcy5jb250ZXh0TmFtZSh0aGlzLmxhc3RDb250ZXh0KSk7CgkgIH0sCgoJICAvLyBbbG9va3VwT25Db250ZXh0XQoJICAvLwoJICAvLyBPbiBzdGFjaywgYmVmb3JlOiAuLi4KCSAgLy8gT24gc3RhY2ssIGFmdGVyOiBjdXJyZW50Q29udGV4dFtuYW1lXSwgLi4uCgkgIC8vCgkgIC8vIExvb2tzIHVwIHRoZSB2YWx1ZSBvZiBgbmFtZWAgb24gdGhlIGN1cnJlbnQgY29udGV4dCBhbmQgcHVzaGVzCgkgIC8vIGl0IG9udG8gdGhlIHN0YWNrLgoJICBsb29rdXBPbkNvbnRleHQ6IGZ1bmN0aW9uIGxvb2t1cE9uQ29udGV4dChwYXJ0cywgZmFsc3ksIHN0cmljdCwgc2NvcGVkKSB7CgkgICAgdmFyIGkgPSAwOwoKCSAgICBpZiAoIXNjb3BlZCAmJiB0aGlzLm9wdGlvbnMuY29tcGF0ICYmICF0aGlzLmxhc3RDb250ZXh0KSB7CgkgICAgICAvLyBUaGUgZGVwdGhlZCBxdWVyeSBpcyBleHBlY3RlZCB0byBoYW5kbGUgdGhlIHVuZGVmaW5lZCBsb2dpYyBmb3IgdGhlIHJvb3QgbGV2ZWwgdGhhdAoJICAgICAgLy8gaXMgaW1wbGVtZW50ZWQgYmVsb3csIHNvIHdlIGV2YWx1YXRlIHRoYXQgZGlyZWN0bHkgaW4gY29tcGF0IG1vZGUKCSAgICAgIHRoaXMucHVzaCh0aGlzLmRlcHRoZWRMb29rdXAocGFydHNbaSsrXSkpOwoJICAgIH0gZWxzZSB7CgkgICAgICB0aGlzLnB1c2hDb250ZXh0KCk7CgkgICAgfQoKCSAgICB0aGlzLnJlc29sdmVQYXRoKCdjb250ZXh0JywgcGFydHMsIGksIGZhbHN5LCBzdHJpY3QpOwoJICB9LAoKCSAgLy8gW2xvb2t1cEJsb2NrUGFyYW1dCgkgIC8vCgkgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IC4uLgoJICAvLyBPbiBzdGFjaywgYWZ0ZXI6IGJsb2NrUGFyYW1bbmFtZV0sIC4uLgoJICAvLwoJICAvLyBMb29rcyB1cCB0aGUgdmFsdWUgb2YgYHBhcnRzYCBvbiB0aGUgZ2l2ZW4gYmxvY2sgcGFyYW0gYW5kIHB1c2hlcwoJICAvLyBpdCBvbnRvIHRoZSBzdGFjay4KCSAgbG9va3VwQmxvY2tQYXJhbTogZnVuY3Rpb24gbG9va3VwQmxvY2tQYXJhbShibG9ja1BhcmFtSWQsIHBhcnRzKSB7CgkgICAgdGhpcy51c2VCbG9ja1BhcmFtcyA9IHRydWU7CgoJICAgIHRoaXMucHVzaChbJ2Jsb2NrUGFyYW1zWycsIGJsb2NrUGFyYW1JZFswXSwgJ11bJywgYmxvY2tQYXJhbUlkWzFdLCAnXSddKTsKCSAgICB0aGlzLnJlc29sdmVQYXRoKCdjb250ZXh0JywgcGFydHMsIDEpOwoJICB9LAoKCSAgLy8gW2xvb2t1cERhdGFdCgkgIC8vCgkgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IC4uLgoJICAvLyBPbiBzdGFjaywgYWZ0ZXI6IGRhdGEsIC4uLgoJICAvLwoJICAvLyBQdXNoIHRoZSBkYXRhIGxvb2t1cCBvcGVyYXRvcgoJICBsb29rdXBEYXRhOiBmdW5jdGlvbiBsb29rdXBEYXRhKGRlcHRoLCBwYXJ0cywgc3RyaWN0KSB7CgkgICAgaWYgKCFkZXB0aCkgewoJICAgICAgdGhpcy5wdXNoU3RhY2tMaXRlcmFsKCdkYXRhJyk7CgkgICAgfSBlbHNlIHsKCSAgICAgIHRoaXMucHVzaFN0YWNrTGl0ZXJhbCgnY29udGFpbmVyLmRhdGEoZGF0YSwgJyArIGRlcHRoICsgJyknKTsKCSAgICB9CgoJICAgIHRoaXMucmVzb2x2ZVBhdGgoJ2RhdGEnLCBwYXJ0cywgMCwgdHJ1ZSwgc3RyaWN0KTsKCSAgfSwKCgkgIHJlc29sdmVQYXRoOiBmdW5jdGlvbiByZXNvbHZlUGF0aCh0eXBlLCBwYXJ0cywgaSwgZmFsc3ksIHN0cmljdCkgewoJICAgIC8vIGlzdGFuYnVsIGlnbm9yZSBuZXh0CgoJICAgIHZhciBfdGhpcyA9IHRoaXM7CgoJICAgIGlmICh0aGlzLm9wdGlvbnMuc3RyaWN0IHx8IHRoaXMub3B0aW9ucy5hc3N1bWVPYmplY3RzKSB7CgkgICAgICB0aGlzLnB1c2goc3RyaWN0TG9va3VwKHRoaXMub3B0aW9ucy5zdHJpY3QgJiYgc3RyaWN0LCB0aGlzLCBwYXJ0cywgdHlwZSkpOwoJICAgICAgcmV0dXJuOwoJICAgIH0KCgkgICAgdmFyIGxlbiA9IHBhcnRzLmxlbmd0aDsKCSAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CgkgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1sb29wLWZ1bmMgKi8KCSAgICAgIHRoaXMucmVwbGFjZVN0YWNrKGZ1bmN0aW9uIChjdXJyZW50KSB7CgkgICAgICAgIHZhciBsb29rdXAgPSBfdGhpcy5uYW1lTG9va3VwKGN1cnJlbnQsIHBhcnRzW2ldLCB0eXBlKTsKCSAgICAgICAgLy8gV2Ugd2FudCB0byBlbnN1cmUgdGhhdCB6ZXJvIGFuZCBmYWxzZSBhcmUgaGFuZGxlZCBwcm9wZXJseSBpZiB0aGUgY29udGV4dCAoZmFsc3kgZmxhZykKCSAgICAgICAgLy8gbmVlZHMgdG8gaGF2ZSB0aGUgc3BlY2lhbCBoYW5kbGluZyBmb3IgdGhlc2UgdmFsdWVzLgoJICAgICAgICBpZiAoIWZhbHN5KSB7CgkgICAgICAgICAgcmV0dXJuIFsnICE9IG51bGwgPyAnLCBsb29rdXAsICcgOiAnLCBjdXJyZW50XTsKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAvLyBPdGhlcndpc2Ugd2UgY2FuIHVzZSBnZW5lcmljIGZhbHN5IGhhbmRsaW5nCgkgICAgICAgICAgcmV0dXJuIFsnICYmICcsIGxvb2t1cF07CgkgICAgICAgIH0KCSAgICAgIH0pOwoJICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1sb29wLWZ1bmMgKi8KCSAgICB9CgkgIH0sCgoJICAvLyBbcmVzb2x2ZVBvc3NpYmxlTGFtYmRhXQoJICAvLwoJICAvLyBPbiBzdGFjaywgYmVmb3JlOiB2YWx1ZSwgLi4uCgkgIC8vIE9uIHN0YWNrLCBhZnRlcjogcmVzb2x2ZWQgdmFsdWUsIC4uLgoJICAvLwoJICAvLyBJZiB0aGUgYHZhbHVlYCBpcyBhIGxhbWJkYSwgcmVwbGFjZSBpdCBvbiB0aGUgc3RhY2sgYnkKCSAgLy8gdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgbGFtYmRhCgkgIHJlc29sdmVQb3NzaWJsZUxhbWJkYTogZnVuY3Rpb24gcmVzb2x2ZVBvc3NpYmxlTGFtYmRhKCkgewoJICAgIHRoaXMucHVzaChbdGhpcy5hbGlhc2FibGUoJ2NvbnRhaW5lci5sYW1iZGEnKSwgJygnLCB0aGlzLnBvcFN0YWNrKCksICcsICcsIHRoaXMuY29udGV4dE5hbWUoMCksICcpJ10pOwoJICB9LAoKCSAgLy8gW3B1c2hTdHJpbmdQYXJhbV0KCSAgLy8KCSAgLy8gT24gc3RhY2ssIGJlZm9yZTogLi4uCgkgIC8vIE9uIHN0YWNrLCBhZnRlcjogc3RyaW5nLCBjdXJyZW50Q29udGV4dCwgLi4uCgkgIC8vCgkgIC8vIFRoaXMgb3Bjb2RlIGlzIGRlc2lnbmVkIGZvciB1c2UgaW4gc3RyaW5nIG1vZGUsIHdoaWNoCgkgIC8vIHByb3ZpZGVzIHRoZSBzdHJpbmcgdmFsdWUgb2YgYSBwYXJhbWV0ZXIgYWxvbmcgd2l0aCBpdHMKCSAgLy8gZGVwdGggcmF0aGVyIHRoYW4gcmVzb2x2aW5nIGl0IGltbWVkaWF0ZWx5LgoJICBwdXNoU3RyaW5nUGFyYW06IGZ1bmN0aW9uIHB1c2hTdHJpbmdQYXJhbShzdHJpbmcsIHR5cGUpIHsKCSAgICB0aGlzLnB1c2hDb250ZXh0KCk7CgkgICAgdGhpcy5wdXNoU3RyaW5nKHR5cGUpOwoKCSAgICAvLyBJZiBpdCdzIGEgc3ViZXhwcmVzc2lvbiwgdGhlIHN0cmluZyByZXN1bHQKCSAgICAvLyB3aWxsIGJlIHB1c2hlZCBhZnRlciB0aGlzIG9wY29kZS4KCSAgICBpZiAodHlwZSAhPT0gJ1N1YkV4cHJlc3Npb24nKSB7CgkgICAgICBpZiAodHlwZW9mIHN0cmluZyA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgdGhpcy5wdXNoU3RyaW5nKHN0cmluZyk7CgkgICAgICB9IGVsc2UgewoJICAgICAgICB0aGlzLnB1c2hTdGFja0xpdGVyYWwoc3RyaW5nKTsKCSAgICAgIH0KCSAgICB9CgkgIH0sCgoJICBlbXB0eUhhc2g6IGZ1bmN0aW9uIGVtcHR5SGFzaChvbWl0RW1wdHkpIHsKCSAgICBpZiAodGhpcy50cmFja0lkcykgewoJICAgICAgdGhpcy5wdXNoKCd7fScpOyAvLyBoYXNoSWRzCgkgICAgfQoJICAgIGlmICh0aGlzLnN0cmluZ1BhcmFtcykgewoJICAgICAgdGhpcy5wdXNoKCd7fScpOyAvLyBoYXNoQ29udGV4dHMKCSAgICAgIHRoaXMucHVzaCgne30nKTsgLy8gaGFzaFR5cGVzCgkgICAgfQoJICAgIHRoaXMucHVzaFN0YWNrTGl0ZXJhbChvbWl0RW1wdHkgPyAndW5kZWZpbmVkJyA6ICd7fScpOwoJICB9LAoJICBwdXNoSGFzaDogZnVuY3Rpb24gcHVzaEhhc2goKSB7CgkgICAgaWYgKHRoaXMuaGFzaCkgewoJICAgICAgdGhpcy5oYXNoZXMucHVzaCh0aGlzLmhhc2gpOwoJICAgIH0KCSAgICB0aGlzLmhhc2ggPSB7IHZhbHVlczogW10sIHR5cGVzOiBbXSwgY29udGV4dHM6IFtdLCBpZHM6IFtdIH07CgkgIH0sCgkgIHBvcEhhc2g6IGZ1bmN0aW9uIHBvcEhhc2goKSB7CgkgICAgdmFyIGhhc2ggPSB0aGlzLmhhc2g7CgkgICAgdGhpcy5oYXNoID0gdGhpcy5oYXNoZXMucG9wKCk7CgoJICAgIGlmICh0aGlzLnRyYWNrSWRzKSB7CgkgICAgICB0aGlzLnB1c2godGhpcy5vYmplY3RMaXRlcmFsKGhhc2guaWRzKSk7CgkgICAgfQoJICAgIGlmICh0aGlzLnN0cmluZ1BhcmFtcykgewoJICAgICAgdGhpcy5wdXNoKHRoaXMub2JqZWN0TGl0ZXJhbChoYXNoLmNvbnRleHRzKSk7CgkgICAgICB0aGlzLnB1c2godGhpcy5vYmplY3RMaXRlcmFsKGhhc2gudHlwZXMpKTsKCSAgICB9CgoJICAgIHRoaXMucHVzaCh0aGlzLm9iamVjdExpdGVyYWwoaGFzaC52YWx1ZXMpKTsKCSAgfSwKCgkgIC8vIFtwdXNoU3RyaW5nXQoJICAvLwoJICAvLyBPbiBzdGFjaywgYmVmb3JlOiAuLi4KCSAgLy8gT24gc3RhY2ssIGFmdGVyOiBxdW90ZWRTdHJpbmcoc3RyaW5nKSwgLi4uCgkgIC8vCgkgIC8vIFB1c2ggYSBxdW90ZWQgdmVyc2lvbiBvZiBgc3RyaW5nYCBvbnRvIHRoZSBzdGFjawoJICBwdXNoU3RyaW5nOiBmdW5jdGlvbiBwdXNoU3RyaW5nKHN0cmluZykgewoJICAgIHRoaXMucHVzaFN0YWNrTGl0ZXJhbCh0aGlzLnF1b3RlZFN0cmluZyhzdHJpbmcpKTsKCSAgfSwKCgkgIC8vIFtwdXNoTGl0ZXJhbF0KCSAgLy8KCSAgLy8gT24gc3RhY2ssIGJlZm9yZTogLi4uCgkgIC8vIE9uIHN0YWNrLCBhZnRlcjogdmFsdWUsIC4uLgoJICAvLwoJICAvLyBQdXNoZXMgYSB2YWx1ZSBvbnRvIHRoZSBzdGFjay4gVGhpcyBvcGVyYXRpb24gcHJldmVudHMKCSAgLy8gdGhlIGNvbXBpbGVyIGZyb20gY3JlYXRpbmcgYSB0ZW1wb3JhcnkgdmFyaWFibGUgdG8gaG9sZAoJICAvLyBpdC4KCSAgcHVzaExpdGVyYWw6IGZ1bmN0aW9uIHB1c2hMaXRlcmFsKHZhbHVlKSB7CgkgICAgdGhpcy5wdXNoU3RhY2tMaXRlcmFsKHZhbHVlKTsKCSAgfSwKCgkgIC8vIFtwdXNoUHJvZ3JhbV0KCSAgLy8KCSAgLy8gT24gc3RhY2ssIGJlZm9yZTogLi4uCgkgIC8vIE9uIHN0YWNrLCBhZnRlcjogcHJvZ3JhbShndWlkKSwgLi4uCgkgIC8vCgkgIC8vIFB1c2ggYSBwcm9ncmFtIGV4cHJlc3Npb24gb250byB0aGUgc3RhY2suIFRoaXMgdGFrZXMKCSAgLy8gYSBjb21waWxlLXRpbWUgZ3VpZCBhbmQgY29udmVydHMgaXQgaW50byBhIHJ1bnRpbWUtYWNjZXNzaWJsZQoJICAvLyBleHByZXNzaW9uLgoJICBwdXNoUHJvZ3JhbTogZnVuY3Rpb24gcHVzaFByb2dyYW0oZ3VpZCkgewoJICAgIGlmIChndWlkICE9IG51bGwpIHsKCSAgICAgIHRoaXMucHVzaFN0YWNrTGl0ZXJhbCh0aGlzLnByb2dyYW1FeHByZXNzaW9uKGd1aWQpKTsKCSAgICB9IGVsc2UgewoJICAgICAgdGhpcy5wdXNoU3RhY2tMaXRlcmFsKG51bGwpOwoJICAgIH0KCSAgfSwKCgkgIC8vIFtyZWdpc3RlckRlY29yYXRvcl0KCSAgLy8KCSAgLy8gT24gc3RhY2ssIGJlZm9yZTogaGFzaCwgcHJvZ3JhbSwgcGFyYW1zLi4uLCAuLi4KCSAgLy8gT24gc3RhY2ssIGFmdGVyOiAuLi4KCSAgLy8KCSAgLy8gUG9wcyBvZmYgdGhlIGRlY29yYXRvcidzIHBhcmFtZXRlcnMsIGludm9rZXMgdGhlIGRlY29yYXRvciwKCSAgLy8gYW5kIGluc2VydHMgdGhlIGRlY29yYXRvciBpbnRvIHRoZSBkZWNvcmF0b3JzIGxpc3QuCgkgIHJlZ2lzdGVyRGVjb3JhdG9yOiBmdW5jdGlvbiByZWdpc3RlckRlY29yYXRvcihwYXJhbVNpemUsIG5hbWUpIHsKCSAgICB2YXIgZm91bmREZWNvcmF0b3IgPSB0aGlzLm5hbWVMb29rdXAoJ2RlY29yYXRvcnMnLCBuYW1lLCAnZGVjb3JhdG9yJyksCgkgICAgICAgIG9wdGlvbnMgPSB0aGlzLnNldHVwSGVscGVyQXJncyhuYW1lLCBwYXJhbVNpemUpOwoKCSAgICB0aGlzLmRlY29yYXRvcnMucHVzaChbJ2ZuID0gJywgdGhpcy5kZWNvcmF0b3JzLmZ1bmN0aW9uQ2FsbChmb3VuZERlY29yYXRvciwgJycsIFsnZm4nLCAncHJvcHMnLCAnY29udGFpbmVyJywgb3B0aW9uc10pLCAnIHx8IGZuOyddKTsKCSAgfSwKCgkgIC8vIFtpbnZva2VIZWxwZXJdCgkgIC8vCgkgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IGhhc2gsIGludmVyc2UsIHByb2dyYW0sIHBhcmFtcy4uLiwgLi4uCgkgIC8vIE9uIHN0YWNrLCBhZnRlcjogcmVzdWx0IG9mIGhlbHBlciBpbnZvY2F0aW9uCgkgIC8vCgkgIC8vIFBvcHMgb2ZmIHRoZSBoZWxwZXIncyBwYXJhbWV0ZXJzLCBpbnZva2VzIHRoZSBoZWxwZXIsCgkgIC8vIGFuZCBwdXNoZXMgdGhlIGhlbHBlcidzIHJldHVybiB2YWx1ZSBvbnRvIHRoZSBzdGFjay4KCSAgLy8KCSAgLy8gSWYgdGhlIGhlbHBlciBpcyBub3QgZm91bmQsIGBoZWxwZXJNaXNzaW5nYCBpcyBjYWxsZWQuCgkgIGludm9rZUhlbHBlcjogZnVuY3Rpb24gaW52b2tlSGVscGVyKHBhcmFtU2l6ZSwgbmFtZSwgaXNTaW1wbGUpIHsKCSAgICB2YXIgbm9uSGVscGVyID0gdGhpcy5wb3BTdGFjaygpLAoJICAgICAgICBoZWxwZXIgPSB0aGlzLnNldHVwSGVscGVyKHBhcmFtU2l6ZSwgbmFtZSksCgkgICAgICAgIHNpbXBsZSA9IGlzU2ltcGxlID8gW2hlbHBlci5uYW1lLCAnIHx8ICddIDogJyc7CgoJICAgIHZhciBsb29rdXAgPSBbJygnXS5jb25jYXQoc2ltcGxlLCBub25IZWxwZXIpOwoJICAgIGlmICghdGhpcy5vcHRpb25zLnN0cmljdCkgewoJICAgICAgbG9va3VwLnB1c2goJyB8fCAnLCB0aGlzLmFsaWFzYWJsZSgnaGVscGVycy5oZWxwZXJNaXNzaW5nJykpOwoJICAgIH0KCSAgICBsb29rdXAucHVzaCgnKScpOwoKCSAgICB0aGlzLnB1c2godGhpcy5zb3VyY2UuZnVuY3Rpb25DYWxsKGxvb2t1cCwgJ2NhbGwnLCBoZWxwZXIuY2FsbFBhcmFtcykpOwoJICB9LAoKCSAgLy8gW2ludm9rZUtub3duSGVscGVyXQoJICAvLwoJICAvLyBPbiBzdGFjaywgYmVmb3JlOiBoYXNoLCBpbnZlcnNlLCBwcm9ncmFtLCBwYXJhbXMuLi4sIC4uLgoJICAvLyBPbiBzdGFjaywgYWZ0ZXI6IHJlc3VsdCBvZiBoZWxwZXIgaW52b2NhdGlvbgoJICAvLwoJICAvLyBUaGlzIG9wZXJhdGlvbiBpcyB1c2VkIHdoZW4gdGhlIGhlbHBlciBpcyBrbm93biB0byBleGlzdCwKCSAgLy8gc28gYSBgaGVscGVyTWlzc2luZ2AgZmFsbGJhY2sgaXMgbm90IHJlcXVpcmVkLgoJICBpbnZva2VLbm93bkhlbHBlcjogZnVuY3Rpb24gaW52b2tlS25vd25IZWxwZXIocGFyYW1TaXplLCBuYW1lKSB7CgkgICAgdmFyIGhlbHBlciA9IHRoaXMuc2V0dXBIZWxwZXIocGFyYW1TaXplLCBuYW1lKTsKCSAgICB0aGlzLnB1c2godGhpcy5zb3VyY2UuZnVuY3Rpb25DYWxsKGhlbHBlci5uYW1lLCAnY2FsbCcsIGhlbHBlci5jYWxsUGFyYW1zKSk7CgkgIH0sCgoJICAvLyBbaW52b2tlQW1iaWd1b3VzXQoJICAvLwoJICAvLyBPbiBzdGFjaywgYmVmb3JlOiBoYXNoLCBpbnZlcnNlLCBwcm9ncmFtLCBwYXJhbXMuLi4sIC4uLgoJICAvLyBPbiBzdGFjaywgYWZ0ZXI6IHJlc3VsdCBvZiBkaXNhbWJpZ3VhdGlvbgoJICAvLwoJICAvLyBUaGlzIG9wZXJhdGlvbiBpcyB1c2VkIHdoZW4gYW4gZXhwcmVzc2lvbiBsaWtlIGB7e2Zvb319YAoJICAvLyBpcyBwcm92aWRlZCwgYnV0IHdlIGRvbid0IGtub3cgYXQgY29tcGlsZS10aW1lIHdoZXRoZXIgaXQKCSAgLy8gaXMgYSBoZWxwZXIgb3IgYSBwYXRoLgoJICAvLwoJICAvLyBUaGlzIG9wZXJhdGlvbiBlbWl0cyBtb3JlIGNvZGUgdGhhbiB0aGUgb3RoZXIgb3B0aW9ucywKCSAgLy8gYW5kIGNhbiBiZSBhdm9pZGVkIGJ5IHBhc3NpbmcgdGhlIGBrbm93bkhlbHBlcnNgIGFuZAoJICAvLyBga25vd25IZWxwZXJzT25seWAgZmxhZ3MgYXQgY29tcGlsZS10aW1lLgoJICBpbnZva2VBbWJpZ3VvdXM6IGZ1bmN0aW9uIGludm9rZUFtYmlndW91cyhuYW1lLCBoZWxwZXJDYWxsKSB7CgkgICAgdGhpcy51c2VSZWdpc3RlcignaGVscGVyJyk7CgoJICAgIHZhciBub25IZWxwZXIgPSB0aGlzLnBvcFN0YWNrKCk7CgoJICAgIHRoaXMuZW1wdHlIYXNoKCk7CgkgICAgdmFyIGhlbHBlciA9IHRoaXMuc2V0dXBIZWxwZXIoMCwgbmFtZSwgaGVscGVyQ2FsbCk7CgoJICAgIHZhciBoZWxwZXJOYW1lID0gdGhpcy5sYXN0SGVscGVyID0gdGhpcy5uYW1lTG9va3VwKCdoZWxwZXJzJywgbmFtZSwgJ2hlbHBlcicpOwoKCSAgICB2YXIgbG9va3VwID0gWycoJywgJyhoZWxwZXIgPSAnLCBoZWxwZXJOYW1lLCAnIHx8ICcsIG5vbkhlbHBlciwgJyknXTsKCSAgICBpZiAoIXRoaXMub3B0aW9ucy5zdHJpY3QpIHsKCSAgICAgIGxvb2t1cFswXSA9ICcoaGVscGVyID0gJzsKCSAgICAgIGxvb2t1cC5wdXNoKCcgIT0gbnVsbCA/IGhlbHBlciA6ICcsIHRoaXMuYWxpYXNhYmxlKCdoZWxwZXJzLmhlbHBlck1pc3NpbmcnKSk7CgkgICAgfQoKCSAgICB0aGlzLnB1c2goWycoJywgbG9va3VwLCBoZWxwZXIucGFyYW1zSW5pdCA/IFsnKSwoJywgaGVscGVyLnBhcmFtc0luaXRdIDogW10sICcpLCcsICcodHlwZW9mIGhlbHBlciA9PT0gJywgdGhpcy5hbGlhc2FibGUoJyJmdW5jdGlvbiInKSwgJyA/ICcsIHRoaXMuc291cmNlLmZ1bmN0aW9uQ2FsbCgnaGVscGVyJywgJ2NhbGwnLCBoZWxwZXIuY2FsbFBhcmFtcyksICcgOiBoZWxwZXIpKSddKTsKCSAgfSwKCgkgIC8vIFtpbnZva2VQYXJ0aWFsXQoJICAvLwoJICAvLyBPbiBzdGFjaywgYmVmb3JlOiBjb250ZXh0LCAuLi4KCSAgLy8gT24gc3RhY2sgYWZ0ZXI6IHJlc3VsdCBvZiBwYXJ0aWFsIGludm9jYXRpb24KCSAgLy8KCSAgLy8gVGhpcyBvcGVyYXRpb24gcG9wcyBvZmYgYSBjb250ZXh0LCBpbnZva2VzIGEgcGFydGlhbCB3aXRoIHRoYXQgY29udGV4dCwKCSAgLy8gYW5kIHB1c2hlcyB0aGUgcmVzdWx0IG9mIHRoZSBpbnZvY2F0aW9uIGJhY2suCgkgIGludm9rZVBhcnRpYWw6IGZ1bmN0aW9uIGludm9rZVBhcnRpYWwoaXNEeW5hbWljLCBuYW1lLCBpbmRlbnQpIHsKCSAgICB2YXIgcGFyYW1zID0gW10sCgkgICAgICAgIG9wdGlvbnMgPSB0aGlzLnNldHVwUGFyYW1zKG5hbWUsIDEsIHBhcmFtcyk7CgoJICAgIGlmIChpc0R5bmFtaWMpIHsKCSAgICAgIG5hbWUgPSB0aGlzLnBvcFN0YWNrKCk7CgkgICAgICBkZWxldGUgb3B0aW9ucy5uYW1lOwoJICAgIH0KCgkgICAgaWYgKGluZGVudCkgewoJICAgICAgb3B0aW9ucy5pbmRlbnQgPSBKU09OLnN0cmluZ2lmeShpbmRlbnQpOwoJICAgIH0KCSAgICBvcHRpb25zLmhlbHBlcnMgPSAnaGVscGVycyc7CgkgICAgb3B0aW9ucy5wYXJ0aWFscyA9ICdwYXJ0aWFscyc7CgkgICAgb3B0aW9ucy5kZWNvcmF0b3JzID0gJ2NvbnRhaW5lci5kZWNvcmF0b3JzJzsKCgkgICAgaWYgKCFpc0R5bmFtaWMpIHsKCSAgICAgIHBhcmFtcy51bnNoaWZ0KHRoaXMubmFtZUxvb2t1cCgncGFydGlhbHMnLCBuYW1lLCAncGFydGlhbCcpKTsKCSAgICB9IGVsc2UgewoJICAgICAgcGFyYW1zLnVuc2hpZnQobmFtZSk7CgkgICAgfQoKCSAgICBpZiAodGhpcy5vcHRpb25zLmNvbXBhdCkgewoJICAgICAgb3B0aW9ucy5kZXB0aHMgPSAnZGVwdGhzJzsKCSAgICB9CgkgICAgb3B0aW9ucyA9IHRoaXMub2JqZWN0TGl0ZXJhbChvcHRpb25zKTsKCSAgICBwYXJhbXMucHVzaChvcHRpb25zKTsKCgkgICAgdGhpcy5wdXNoKHRoaXMuc291cmNlLmZ1bmN0aW9uQ2FsbCgnY29udGFpbmVyLmludm9rZVBhcnRpYWwnLCAnJywgcGFyYW1zKSk7CgkgIH0sCgoJICAvLyBbYXNzaWduVG9IYXNoXQoJICAvLwoJICAvLyBPbiBzdGFjaywgYmVmb3JlOiB2YWx1ZSwgLi4uLCBoYXNoLCAuLi4KCSAgLy8gT24gc3RhY2ssIGFmdGVyOiAuLi4sIGhhc2gsIC4uLgoJICAvLwoJICAvLyBQb3BzIGEgdmFsdWUgb2ZmIHRoZSBzdGFjayBhbmQgYXNzaWducyBpdCB0byB0aGUgY3VycmVudCBoYXNoCgkgIGFzc2lnblRvSGFzaDogZnVuY3Rpb24gYXNzaWduVG9IYXNoKGtleSkgewoJICAgIHZhciB2YWx1ZSA9IHRoaXMucG9wU3RhY2soKSwKCSAgICAgICAgY29udGV4dCA9IHVuZGVmaW5lZCwKCSAgICAgICAgdHlwZSA9IHVuZGVmaW5lZCwKCSAgICAgICAgaWQgPSB1bmRlZmluZWQ7CgoJICAgIGlmICh0aGlzLnRyYWNrSWRzKSB7CgkgICAgICBpZCA9IHRoaXMucG9wU3RhY2soKTsKCSAgICB9CgkgICAgaWYgKHRoaXMuc3RyaW5nUGFyYW1zKSB7CgkgICAgICB0eXBlID0gdGhpcy5wb3BTdGFjaygpOwoJICAgICAgY29udGV4dCA9IHRoaXMucG9wU3RhY2soKTsKCSAgICB9CgoJICAgIHZhciBoYXNoID0gdGhpcy5oYXNoOwoJICAgIGlmIChjb250ZXh0KSB7CgkgICAgICBoYXNoLmNvbnRleHRzW2tleV0gPSBjb250ZXh0OwoJICAgIH0KCSAgICBpZiAodHlwZSkgewoJICAgICAgaGFzaC50eXBlc1trZXldID0gdHlwZTsKCSAgICB9CgkgICAgaWYgKGlkKSB7CgkgICAgICBoYXNoLmlkc1trZXldID0gaWQ7CgkgICAgfQoJICAgIGhhc2gudmFsdWVzW2tleV0gPSB2YWx1ZTsKCSAgfSwKCgkgIHB1c2hJZDogZnVuY3Rpb24gcHVzaElkKHR5cGUsIG5hbWUsIGNoaWxkKSB7CgkgICAgaWYgKHR5cGUgPT09ICdCbG9ja1BhcmFtJykgewoJICAgICAgdGhpcy5wdXNoU3RhY2tMaXRlcmFsKCdibG9ja1BhcmFtc1snICsgbmFtZVswXSArICddLnBhdGhbJyArIG5hbWVbMV0gKyAnXScgKyAoY2hpbGQgPyAnICsgJyArIEpTT04uc3RyaW5naWZ5KCcuJyArIGNoaWxkKSA6ICcnKSk7CgkgICAgfSBlbHNlIGlmICh0eXBlID09PSAnUGF0aEV4cHJlc3Npb24nKSB7CgkgICAgICB0aGlzLnB1c2hTdHJpbmcobmFtZSk7CgkgICAgfSBlbHNlIGlmICh0eXBlID09PSAnU3ViRXhwcmVzc2lvbicpIHsKCSAgICAgIHRoaXMucHVzaFN0YWNrTGl0ZXJhbCgndHJ1ZScpOwoJICAgIH0gZWxzZSB7CgkgICAgICB0aGlzLnB1c2hTdGFja0xpdGVyYWwoJ251bGwnKTsKCSAgICB9CgkgIH0sCgoJICAvLyBIRUxQRVJTCgoJICBjb21waWxlcjogSmF2YVNjcmlwdENvbXBpbGVyLAoKCSAgY29tcGlsZUNoaWxkcmVuOiBmdW5jdGlvbiBjb21waWxlQ2hpbGRyZW4oZW52aXJvbm1lbnQsIG9wdGlvbnMpIHsKCSAgICB2YXIgY2hpbGRyZW4gPSBlbnZpcm9ubWVudC5jaGlsZHJlbiwKCSAgICAgICAgY2hpbGQgPSB1bmRlZmluZWQsCgkgICAgICAgIGNvbXBpbGVyID0gdW5kZWZpbmVkOwoKCSAgICBmb3IgKHZhciBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkrKykgewoJICAgICAgY2hpbGQgPSBjaGlsZHJlbltpXTsKCSAgICAgIGNvbXBpbGVyID0gbmV3IHRoaXMuY29tcGlsZXIoKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuZXctY2FwCgoJICAgICAgdmFyIGluZGV4ID0gdGhpcy5tYXRjaEV4aXN0aW5nUHJvZ3JhbShjaGlsZCk7CgoJICAgICAgaWYgKGluZGV4ID09IG51bGwpIHsKCSAgICAgICAgdGhpcy5jb250ZXh0LnByb2dyYW1zLnB1c2goJycpOyAvLyBQbGFjZWhvbGRlciB0byBwcmV2ZW50IG5hbWUgY29uZmxpY3RzIGZvciBuZXN0ZWQgY2hpbGRyZW4KCSAgICAgICAgaW5kZXggPSB0aGlzLmNvbnRleHQucHJvZ3JhbXMubGVuZ3RoOwoJICAgICAgICBjaGlsZC5pbmRleCA9IGluZGV4OwoJICAgICAgICBjaGlsZC5uYW1lID0gJ3Byb2dyYW0nICsgaW5kZXg7CgkgICAgICAgIHRoaXMuY29udGV4dC5wcm9ncmFtc1tpbmRleF0gPSBjb21waWxlci5jb21waWxlKGNoaWxkLCBvcHRpb25zLCB0aGlzLmNvbnRleHQsICF0aGlzLnByZWNvbXBpbGUpOwoJICAgICAgICB0aGlzLmNvbnRleHQuZGVjb3JhdG9yc1tpbmRleF0gPSBjb21waWxlci5kZWNvcmF0b3JzOwoJICAgICAgICB0aGlzLmNvbnRleHQuZW52aXJvbm1lbnRzW2luZGV4XSA9IGNoaWxkOwoKCSAgICAgICAgdGhpcy51c2VEZXB0aHMgPSB0aGlzLnVzZURlcHRocyB8fCBjb21waWxlci51c2VEZXB0aHM7CgkgICAgICAgIHRoaXMudXNlQmxvY2tQYXJhbXMgPSB0aGlzLnVzZUJsb2NrUGFyYW1zIHx8IGNvbXBpbGVyLnVzZUJsb2NrUGFyYW1zOwoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgY2hpbGQuaW5kZXggPSBpbmRleDsKCSAgICAgICAgY2hpbGQubmFtZSA9ICdwcm9ncmFtJyArIGluZGV4OwoKCSAgICAgICAgdGhpcy51c2VEZXB0aHMgPSB0aGlzLnVzZURlcHRocyB8fCBjaGlsZC51c2VEZXB0aHM7CgkgICAgICAgIHRoaXMudXNlQmxvY2tQYXJhbXMgPSB0aGlzLnVzZUJsb2NrUGFyYW1zIHx8IGNoaWxkLnVzZUJsb2NrUGFyYW1zOwoJICAgICAgfQoJICAgIH0KCSAgfSwKCSAgbWF0Y2hFeGlzdGluZ1Byb2dyYW06IGZ1bmN0aW9uIG1hdGNoRXhpc3RpbmdQcm9ncmFtKGNoaWxkKSB7CgkgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuY29udGV4dC5lbnZpcm9ubWVudHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCSAgICAgIHZhciBlbnZpcm9ubWVudCA9IHRoaXMuY29udGV4dC5lbnZpcm9ubWVudHNbaV07CgkgICAgICBpZiAoZW52aXJvbm1lbnQgJiYgZW52aXJvbm1lbnQuZXF1YWxzKGNoaWxkKSkgewoJICAgICAgICByZXR1cm4gaTsKCSAgICAgIH0KCSAgICB9CgkgIH0sCgoJICBwcm9ncmFtRXhwcmVzc2lvbjogZnVuY3Rpb24gcHJvZ3JhbUV4cHJlc3Npb24oZ3VpZCkgewoJICAgIHZhciBjaGlsZCA9IHRoaXMuZW52aXJvbm1lbnQuY2hpbGRyZW5bZ3VpZF0sCgkgICAgICAgIHByb2dyYW1QYXJhbXMgPSBbY2hpbGQuaW5kZXgsICdkYXRhJywgY2hpbGQuYmxvY2tQYXJhbXNdOwoKCSAgICBpZiAodGhpcy51c2VCbG9ja1BhcmFtcyB8fCB0aGlzLnVzZURlcHRocykgewoJICAgICAgcHJvZ3JhbVBhcmFtcy5wdXNoKCdibG9ja1BhcmFtcycpOwoJICAgIH0KCSAgICBpZiAodGhpcy51c2VEZXB0aHMpIHsKCSAgICAgIHByb2dyYW1QYXJhbXMucHVzaCgnZGVwdGhzJyk7CgkgICAgfQoKCSAgICByZXR1cm4gJ2NvbnRhaW5lci5wcm9ncmFtKCcgKyBwcm9ncmFtUGFyYW1zLmpvaW4oJywgJykgKyAnKSc7CgkgIH0sCgoJICB1c2VSZWdpc3RlcjogZnVuY3Rpb24gdXNlUmVnaXN0ZXIobmFtZSkgewoJICAgIGlmICghdGhpcy5yZWdpc3RlcnNbbmFtZV0pIHsKCSAgICAgIHRoaXMucmVnaXN0ZXJzW25hbWVdID0gdHJ1ZTsKCSAgICAgIHRoaXMucmVnaXN0ZXJzLmxpc3QucHVzaChuYW1lKTsKCSAgICB9CgkgIH0sCgoJICBwdXNoOiBmdW5jdGlvbiBwdXNoKGV4cHIpIHsKCSAgICBpZiAoIShleHByIGluc3RhbmNlb2YgTGl0ZXJhbCkpIHsKCSAgICAgIGV4cHIgPSB0aGlzLnNvdXJjZS53cmFwKGV4cHIpOwoJICAgIH0KCgkgICAgdGhpcy5pbmxpbmVTdGFjay5wdXNoKGV4cHIpOwoJICAgIHJldHVybiBleHByOwoJICB9LAoKCSAgcHVzaFN0YWNrTGl0ZXJhbDogZnVuY3Rpb24gcHVzaFN0YWNrTGl0ZXJhbChpdGVtKSB7CgkgICAgdGhpcy5wdXNoKG5ldyBMaXRlcmFsKGl0ZW0pKTsKCSAgfSwKCgkgIHB1c2hTb3VyY2U6IGZ1bmN0aW9uIHB1c2hTb3VyY2Uoc291cmNlKSB7CgkgICAgaWYgKHRoaXMucGVuZGluZ0NvbnRlbnQpIHsKCSAgICAgIHRoaXMuc291cmNlLnB1c2godGhpcy5hcHBlbmRUb0J1ZmZlcih0aGlzLnNvdXJjZS5xdW90ZWRTdHJpbmcodGhpcy5wZW5kaW5nQ29udGVudCksIHRoaXMucGVuZGluZ0xvY2F0aW9uKSk7CgkgICAgICB0aGlzLnBlbmRpbmdDb250ZW50ID0gdW5kZWZpbmVkOwoJICAgIH0KCgkgICAgaWYgKHNvdXJjZSkgewoJICAgICAgdGhpcy5zb3VyY2UucHVzaChzb3VyY2UpOwoJICAgIH0KCSAgfSwKCgkgIHJlcGxhY2VTdGFjazogZnVuY3Rpb24gcmVwbGFjZVN0YWNrKGNhbGxiYWNrKSB7CgkgICAgdmFyIHByZWZpeCA9IFsnKCddLAoJICAgICAgICBzdGFjayA9IHVuZGVmaW5lZCwKCSAgICAgICAgY3JlYXRlZFN0YWNrID0gdW5kZWZpbmVkLAoJICAgICAgICB1c2VkTGl0ZXJhbCA9IHVuZGVmaW5lZDsKCgkgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCSAgICBpZiAoIXRoaXMuaXNJbmxpbmUoKSkgewoJICAgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ3JlcGxhY2VTdGFjayBvbiBub24taW5saW5lJyk7CgkgICAgfQoKCSAgICAvLyBXZSB3YW50IHRvIG1lcmdlIHRoZSBpbmxpbmUgc3RhdGVtZW50IGludG8gdGhlIHJlcGxhY2VtZW50IHN0YXRlbWVudCB2aWEgJywnCgkgICAgdmFyIHRvcCA9IHRoaXMucG9wU3RhY2sodHJ1ZSk7CgoJICAgIGlmICh0b3AgaW5zdGFuY2VvZiBMaXRlcmFsKSB7CgkgICAgICAvLyBMaXRlcmFscyBkbyBub3QgbmVlZCB0byBiZSBpbmxpbmVkCgkgICAgICBzdGFjayA9IFt0b3AudmFsdWVdOwoJICAgICAgcHJlZml4ID0gWycoJywgc3RhY2tdOwoJICAgICAgdXNlZExpdGVyYWwgPSB0cnVlOwoJICAgIH0gZWxzZSB7CgkgICAgICAvLyBHZXQgb3IgY3JlYXRlIHRoZSBjdXJyZW50IHN0YWNrIG5hbWUgZm9yIHVzZSBieSB0aGUgaW5saW5lCgkgICAgICBjcmVhdGVkU3RhY2sgPSB0cnVlOwoJICAgICAgdmFyIF9uYW1lID0gdGhpcy5pbmNyU3RhY2soKTsKCgkgICAgICBwcmVmaXggPSBbJygoJywgdGhpcy5wdXNoKF9uYW1lKSwgJyA9ICcsIHRvcCwgJyknXTsKCSAgICAgIHN0YWNrID0gdGhpcy50b3BTdGFjaygpOwoJICAgIH0KCgkgICAgdmFyIGl0ZW0gPSBjYWxsYmFjay5jYWxsKHRoaXMsIHN0YWNrKTsKCgkgICAgaWYgKCF1c2VkTGl0ZXJhbCkgewoJICAgICAgdGhpcy5wb3BTdGFjaygpOwoJICAgIH0KCSAgICBpZiAoY3JlYXRlZFN0YWNrKSB7CgkgICAgICB0aGlzLnN0YWNrU2xvdC0tOwoJICAgIH0KCSAgICB0aGlzLnB1c2gocHJlZml4LmNvbmNhdChpdGVtLCAnKScpKTsKCSAgfSwKCgkgIGluY3JTdGFjazogZnVuY3Rpb24gaW5jclN0YWNrKCkgewoJICAgIHRoaXMuc3RhY2tTbG90Kys7CgkgICAgaWYgKHRoaXMuc3RhY2tTbG90ID4gdGhpcy5zdGFja1ZhcnMubGVuZ3RoKSB7CgkgICAgICB0aGlzLnN0YWNrVmFycy5wdXNoKCdzdGFjaycgKyB0aGlzLnN0YWNrU2xvdCk7CgkgICAgfQoJICAgIHJldHVybiB0aGlzLnRvcFN0YWNrTmFtZSgpOwoJICB9LAoJICB0b3BTdGFja05hbWU6IGZ1bmN0aW9uIHRvcFN0YWNrTmFtZSgpIHsKCSAgICByZXR1cm4gJ3N0YWNrJyArIHRoaXMuc3RhY2tTbG90OwoJICB9LAoJICBmbHVzaElubGluZTogZnVuY3Rpb24gZmx1c2hJbmxpbmUoKSB7CgkgICAgdmFyIGlubGluZVN0YWNrID0gdGhpcy5pbmxpbmVTdGFjazsKCSAgICB0aGlzLmlubGluZVN0YWNrID0gW107CgkgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGlubGluZVN0YWNrLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkgICAgICB2YXIgZW50cnkgPSBpbmxpbmVTdGFja1tpXTsKCSAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoJICAgICAgaWYgKGVudHJ5IGluc3RhbmNlb2YgTGl0ZXJhbCkgewoJICAgICAgICB0aGlzLmNvbXBpbGVTdGFjay5wdXNoKGVudHJ5KTsKCSAgICAgIH0gZWxzZSB7CgkgICAgICAgIHZhciBzdGFjayA9IHRoaXMuaW5jclN0YWNrKCk7CgkgICAgICAgIHRoaXMucHVzaFNvdXJjZShbc3RhY2ssICcgPSAnLCBlbnRyeSwgJzsnXSk7CgkgICAgICAgIHRoaXMuY29tcGlsZVN0YWNrLnB1c2goc3RhY2spOwoJICAgICAgfQoJICAgIH0KCSAgfSwKCSAgaXNJbmxpbmU6IGZ1bmN0aW9uIGlzSW5saW5lKCkgewoJICAgIHJldHVybiB0aGlzLmlubGluZVN0YWNrLmxlbmd0aDsKCSAgfSwKCgkgIHBvcFN0YWNrOiBmdW5jdGlvbiBwb3BTdGFjayh3cmFwcGVkKSB7CgkgICAgdmFyIGlubGluZSA9IHRoaXMuaXNJbmxpbmUoKSwKCSAgICAgICAgaXRlbSA9IChpbmxpbmUgPyB0aGlzLmlubGluZVN0YWNrIDogdGhpcy5jb21waWxlU3RhY2spLnBvcCgpOwoKCSAgICBpZiAoIXdyYXBwZWQgJiYgaXRlbSBpbnN0YW5jZW9mIExpdGVyYWwpIHsKCSAgICAgIHJldHVybiBpdGVtLnZhbHVlOwoJICAgIH0gZWxzZSB7CgkgICAgICBpZiAoIWlubGluZSkgewoJICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoJICAgICAgICBpZiAoIXRoaXMuc3RhY2tTbG90KSB7CgkgICAgICAgICAgdGhyb3cgbmV3IF9leGNlcHRpb24yWydkZWZhdWx0J10oJ0ludmFsaWQgc3RhY2sgcG9wJyk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5zdGFja1Nsb3QtLTsKCSAgICAgIH0KCSAgICAgIHJldHVybiBpdGVtOwoJICAgIH0KCSAgfSwKCgkgIHRvcFN0YWNrOiBmdW5jdGlvbiB0b3BTdGFjaygpIHsKCSAgICB2YXIgc3RhY2sgPSB0aGlzLmlzSW5saW5lKCkgPyB0aGlzLmlubGluZVN0YWNrIDogdGhpcy5jb21waWxlU3RhY2ssCgkgICAgICAgIGl0ZW0gPSBzdGFja1tzdGFjay5sZW5ndGggLSAxXTsKCgkgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgkgICAgaWYgKGl0ZW0gaW5zdGFuY2VvZiBMaXRlcmFsKSB7CgkgICAgICByZXR1cm4gaXRlbS52YWx1ZTsKCSAgICB9IGVsc2UgewoJICAgICAgcmV0dXJuIGl0ZW07CgkgICAgfQoJICB9LAoKCSAgY29udGV4dE5hbWU6IGZ1bmN0aW9uIGNvbnRleHROYW1lKGNvbnRleHQpIHsKCSAgICBpZiAodGhpcy51c2VEZXB0aHMgJiYgY29udGV4dCkgewoJICAgICAgcmV0dXJuICdkZXB0aHNbJyArIGNvbnRleHQgKyAnXSc7CgkgICAgfSBlbHNlIHsKCSAgICAgIHJldHVybiAnZGVwdGgnICsgY29udGV4dDsKCSAgICB9CgkgIH0sCgoJICBxdW90ZWRTdHJpbmc6IGZ1bmN0aW9uIHF1b3RlZFN0cmluZyhzdHIpIHsKCSAgICByZXR1cm4gdGhpcy5zb3VyY2UucXVvdGVkU3RyaW5nKHN0cik7CgkgIH0sCgoJICBvYmplY3RMaXRlcmFsOiBmdW5jdGlvbiBvYmplY3RMaXRlcmFsKG9iaikgewoJICAgIHJldHVybiB0aGlzLnNvdXJjZS5vYmplY3RMaXRlcmFsKG9iaik7CgkgIH0sCgoJICBhbGlhc2FibGU6IGZ1bmN0aW9uIGFsaWFzYWJsZShuYW1lKSB7CgkgICAgdmFyIHJldCA9IHRoaXMuYWxpYXNlc1tuYW1lXTsKCSAgICBpZiAocmV0KSB7CgkgICAgICByZXQucmVmZXJlbmNlQ291bnQrKzsKCSAgICAgIHJldHVybiByZXQ7CgkgICAgfQoKCSAgICByZXQgPSB0aGlzLmFsaWFzZXNbbmFtZV0gPSB0aGlzLnNvdXJjZS53cmFwKG5hbWUpOwoJICAgIHJldC5hbGlhc2FibGUgPSB0cnVlOwoJICAgIHJldC5yZWZlcmVuY2VDb3VudCA9IDE7CgoJICAgIHJldHVybiByZXQ7CgkgIH0sCgoJICBzZXR1cEhlbHBlcjogZnVuY3Rpb24gc2V0dXBIZWxwZXIocGFyYW1TaXplLCBuYW1lLCBibG9ja0hlbHBlcikgewoJICAgIHZhciBwYXJhbXMgPSBbXSwKCSAgICAgICAgcGFyYW1zSW5pdCA9IHRoaXMuc2V0dXBIZWxwZXJBcmdzKG5hbWUsIHBhcmFtU2l6ZSwgcGFyYW1zLCBibG9ja0hlbHBlcik7CgkgICAgdmFyIGZvdW5kSGVscGVyID0gdGhpcy5uYW1lTG9va3VwKCdoZWxwZXJzJywgbmFtZSwgJ2hlbHBlcicpLAoJICAgICAgICBjYWxsQ29udGV4dCA9IHRoaXMuYWxpYXNhYmxlKHRoaXMuY29udGV4dE5hbWUoMCkgKyAnICE9IG51bGwgPyAnICsgdGhpcy5jb250ZXh0TmFtZSgwKSArICcgOiB7fScpOwoKCSAgICByZXR1cm4gewoJICAgICAgcGFyYW1zOiBwYXJhbXMsCgkgICAgICBwYXJhbXNJbml0OiBwYXJhbXNJbml0LAoJICAgICAgbmFtZTogZm91bmRIZWxwZXIsCgkgICAgICBjYWxsUGFyYW1zOiBbY2FsbENvbnRleHRdLmNvbmNhdChwYXJhbXMpCgkgICAgfTsKCSAgfSwKCgkgIHNldHVwUGFyYW1zOiBmdW5jdGlvbiBzZXR1cFBhcmFtcyhoZWxwZXIsIHBhcmFtU2l6ZSwgcGFyYW1zKSB7CgkgICAgdmFyIG9wdGlvbnMgPSB7fSwKCSAgICAgICAgY29udGV4dHMgPSBbXSwKCSAgICAgICAgdHlwZXMgPSBbXSwKCSAgICAgICAgaWRzID0gW10sCgkgICAgICAgIG9iamVjdEFyZ3MgPSAhcGFyYW1zLAoJICAgICAgICBwYXJhbSA9IHVuZGVmaW5lZDsKCgkgICAgaWYgKG9iamVjdEFyZ3MpIHsKCSAgICAgIHBhcmFtcyA9IFtdOwoJICAgIH0KCgkgICAgb3B0aW9ucy5uYW1lID0gdGhpcy5xdW90ZWRTdHJpbmcoaGVscGVyKTsKCSAgICBvcHRpb25zLmhhc2ggPSB0aGlzLnBvcFN0YWNrKCk7CgoJICAgIGlmICh0aGlzLnRyYWNrSWRzKSB7CgkgICAgICBvcHRpb25zLmhhc2hJZHMgPSB0aGlzLnBvcFN0YWNrKCk7CgkgICAgfQoJICAgIGlmICh0aGlzLnN0cmluZ1BhcmFtcykgewoJICAgICAgb3B0aW9ucy5oYXNoVHlwZXMgPSB0aGlzLnBvcFN0YWNrKCk7CgkgICAgICBvcHRpb25zLmhhc2hDb250ZXh0cyA9IHRoaXMucG9wU3RhY2soKTsKCSAgICB9CgoJICAgIHZhciBpbnZlcnNlID0gdGhpcy5wb3BTdGFjaygpLAoJICAgICAgICBwcm9ncmFtID0gdGhpcy5wb3BTdGFjaygpOwoKCSAgICAvLyBBdm9pZCBzZXR0aW5nIGZuIGFuZCBpbnZlcnNlIGlmIG5laXRoZXIgYXJlIHNldC4gVGhpcyBhbGxvd3MKCSAgICAvLyBoZWxwZXJzIHRvIGRvIGEgY2hlY2sgZm9yIGBpZiAob3B0aW9ucy5mbilgCgkgICAgaWYgKHByb2dyYW0gfHwgaW52ZXJzZSkgewoJICAgICAgb3B0aW9ucy5mbiA9IHByb2dyYW0gfHwgJ2NvbnRhaW5lci5ub29wJzsKCSAgICAgIG9wdGlvbnMuaW52ZXJzZSA9IGludmVyc2UgfHwgJ2NvbnRhaW5lci5ub29wJzsKCSAgICB9CgoJICAgIC8vIFRoZSBwYXJhbWV0ZXJzIGdvIG9uIHRvIHRoZSBzdGFjayBpbiBvcmRlciAobWFraW5nIHN1cmUgdGhhdCB0aGV5IGFyZSBldmFsdWF0ZWQgaW4gb3JkZXIpCgkgICAgLy8gc28gd2UgbmVlZCB0byBwb3AgdGhlbSBvZmYgdGhlIHN0YWNrIGluIHJldmVyc2Ugb3JkZXIKCSAgICB2YXIgaSA9IHBhcmFtU2l6ZTsKCSAgICB3aGlsZSAoaS0tKSB7CgkgICAgICBwYXJhbSA9IHRoaXMucG9wU3RhY2soKTsKCSAgICAgIHBhcmFtc1tpXSA9IHBhcmFtOwoKCSAgICAgIGlmICh0aGlzLnRyYWNrSWRzKSB7CgkgICAgICAgIGlkc1tpXSA9IHRoaXMucG9wU3RhY2soKTsKCSAgICAgIH0KCSAgICAgIGlmICh0aGlzLnN0cmluZ1BhcmFtcykgewoJICAgICAgICB0eXBlc1tpXSA9IHRoaXMucG9wU3RhY2soKTsKCSAgICAgICAgY29udGV4dHNbaV0gPSB0aGlzLnBvcFN0YWNrKCk7CgkgICAgICB9CgkgICAgfQoKCSAgICBpZiAob2JqZWN0QXJncykgewoJICAgICAgb3B0aW9ucy5hcmdzID0gdGhpcy5zb3VyY2UuZ2VuZXJhdGVBcnJheShwYXJhbXMpOwoJICAgIH0KCgkgICAgaWYgKHRoaXMudHJhY2tJZHMpIHsKCSAgICAgIG9wdGlvbnMuaWRzID0gdGhpcy5zb3VyY2UuZ2VuZXJhdGVBcnJheShpZHMpOwoJICAgIH0KCSAgICBpZiAodGhpcy5zdHJpbmdQYXJhbXMpIHsKCSAgICAgIG9wdGlvbnMudHlwZXMgPSB0aGlzLnNvdXJjZS5nZW5lcmF0ZUFycmF5KHR5cGVzKTsKCSAgICAgIG9wdGlvbnMuY29udGV4dHMgPSB0aGlzLnNvdXJjZS5nZW5lcmF0ZUFycmF5KGNvbnRleHRzKTsKCSAgICB9CgoJICAgIGlmICh0aGlzLm9wdGlvbnMuZGF0YSkgewoJICAgICAgb3B0aW9ucy5kYXRhID0gJ2RhdGEnOwoJICAgIH0KCSAgICBpZiAodGhpcy51c2VCbG9ja1BhcmFtcykgewoJICAgICAgb3B0aW9ucy5ibG9ja1BhcmFtcyA9ICdibG9ja1BhcmFtcyc7CgkgICAgfQoJICAgIHJldHVybiBvcHRpb25zOwoJICB9LAoKCSAgc2V0dXBIZWxwZXJBcmdzOiBmdW5jdGlvbiBzZXR1cEhlbHBlckFyZ3MoaGVscGVyLCBwYXJhbVNpemUsIHBhcmFtcywgdXNlUmVnaXN0ZXIpIHsKCSAgICB2YXIgb3B0aW9ucyA9IHRoaXMuc2V0dXBQYXJhbXMoaGVscGVyLCBwYXJhbVNpemUsIHBhcmFtcyk7CgkgICAgb3B0aW9ucyA9IHRoaXMub2JqZWN0TGl0ZXJhbChvcHRpb25zKTsKCSAgICBpZiAodXNlUmVnaXN0ZXIpIHsKCSAgICAgIHRoaXMudXNlUmVnaXN0ZXIoJ29wdGlvbnMnKTsKCSAgICAgIHBhcmFtcy5wdXNoKCdvcHRpb25zJyk7CgkgICAgICByZXR1cm4gWydvcHRpb25zPScsIG9wdGlvbnNdOwoJICAgIH0gZWxzZSBpZiAocGFyYW1zKSB7CgkgICAgICBwYXJhbXMucHVzaChvcHRpb25zKTsKCSAgICAgIHJldHVybiAnJzsKCSAgICB9IGVsc2UgewoJICAgICAgcmV0dXJuIG9wdGlvbnM7CgkgICAgfQoJICB9Cgl9OwoKCShmdW5jdGlvbiAoKSB7CgkgIHZhciByZXNlcnZlZFdvcmRzID0gKCdicmVhayBlbHNlIG5ldyB2YXInICsgJyBjYXNlIGZpbmFsbHkgcmV0dXJuIHZvaWQnICsgJyBjYXRjaCBmb3Igc3dpdGNoIHdoaWxlJyArICcgY29udGludWUgZnVuY3Rpb24gdGhpcyB3aXRoJyArICcgZGVmYXVsdCBpZiB0aHJvdycgKyAnIGRlbGV0ZSBpbiB0cnknICsgJyBkbyBpbnN0YW5jZW9mIHR5cGVvZicgKyAnIGFic3RyYWN0IGVudW0gaW50IHNob3J0JyArICcgYm9vbGVhbiBleHBvcnQgaW50ZXJmYWNlIHN0YXRpYycgKyAnIGJ5dGUgZXh0ZW5kcyBsb25nIHN1cGVyJyArICcgY2hhciBmaW5hbCBuYXRpdmUgc3luY2hyb25pemVkJyArICcgY2xhc3MgZmxvYXQgcGFja2FnZSB0aHJvd3MnICsgJyBjb25zdCBnb3RvIHByaXZhdGUgdHJhbnNpZW50JyArICcgZGVidWdnZXIgaW1wbGVtZW50cyBwcm90ZWN0ZWQgdm9sYXRpbGUnICsgJyBkb3VibGUgaW1wb3J0IHB1YmxpYyBsZXQgeWllbGQgYXdhaXQnICsgJyBudWxsIHRydWUgZmFsc2UnKS5zcGxpdCgnICcpOwoKCSAgdmFyIGNvbXBpbGVyV29yZHMgPSBKYXZhU2NyaXB0Q29tcGlsZXIuUkVTRVJWRURfV09SRFMgPSB7fTsKCgkgIGZvciAodmFyIGkgPSAwLCBsID0gcmVzZXJ2ZWRXb3Jkcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKCSAgICBjb21waWxlcldvcmRzW3Jlc2VydmVkV29yZHNbaV1dID0gdHJ1ZTsKCSAgfQoJfSkoKTsKCglKYXZhU2NyaXB0Q29tcGlsZXIuaXNWYWxpZEphdmFTY3JpcHRWYXJpYWJsZU5hbWUgPSBmdW5jdGlvbiAobmFtZSkgewoJICByZXR1cm4gIUphdmFTY3JpcHRDb21waWxlci5SRVNFUlZFRF9XT1JEU1tuYW1lXSAmJiAvXlthLXpBLVpfJF1bMC05YS16QS1aXyRdKiQvLnRlc3QobmFtZSk7Cgl9OwoKCWZ1bmN0aW9uIHN0cmljdExvb2t1cChyZXF1aXJlVGVybWluYWwsIGNvbXBpbGVyLCBwYXJ0cywgdHlwZSkgewoJICB2YXIgc3RhY2sgPSBjb21waWxlci5wb3BTdGFjaygpLAoJICAgICAgaSA9IDAsCgkgICAgICBsZW4gPSBwYXJ0cy5sZW5ndGg7CgkgIGlmIChyZXF1aXJlVGVybWluYWwpIHsKCSAgICBsZW4tLTsKCSAgfQoKCSAgZm9yICg7IGkgPCBsZW47IGkrKykgewoJICAgIHN0YWNrID0gY29tcGlsZXIubmFtZUxvb2t1cChzdGFjaywgcGFydHNbaV0sIHR5cGUpOwoJICB9CgoJICBpZiAocmVxdWlyZVRlcm1pbmFsKSB7CgkgICAgcmV0dXJuIFtjb21waWxlci5hbGlhc2FibGUoJ2NvbnRhaW5lci5zdHJpY3QnKSwgJygnLCBzdGFjaywgJywgJywgY29tcGlsZXIucXVvdGVkU3RyaW5nKHBhcnRzW2ldKSwgJyknXTsKCSAgfSBlbHNlIHsKCSAgICByZXR1cm4gc3RhY2s7CgkgIH0KCX0KCglleHBvcnRzWydkZWZhdWx0J10gPSBKYXZhU2NyaXB0Q29tcGlsZXI7Cgltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDI5ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCS8qIGdsb2JhbCBkZWZpbmUgKi8KCSd1c2Ugc3RyaWN0JzsKCglleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKCXZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOwoKCXZhciBTb3VyY2VOb2RlID0gdW5kZWZpbmVkOwoKCXRyeSB7CgkgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgkgIGlmIChmYWxzZSkgewoJICAgIC8vIFdlIGRvbid0IHN1cHBvcnQgdGhpcyBpbiBBTUQgZW52aXJvbm1lbnRzLiBGb3IgdGhlc2UgZW52aXJvbm1lbnRzLCB3ZSBhc3VzbWUgdGhhdAoJICAgIC8vIHRoZXkgYXJlIHJ1bm5pbmcgb24gdGhlIGJyb3dzZXIgYW5kIHRodXMgaGF2ZSBubyBuZWVkIGZvciB0aGUgc291cmNlLW1hcCBsaWJyYXJ5LgoJICAgIHZhciBTb3VyY2VNYXAgPSByZXF1aXJlKCdzb3VyY2UtbWFwJyk7CgkgICAgU291cmNlTm9kZSA9IFNvdXJjZU1hcC5Tb3VyY2VOb2RlOwoJICB9Cgl9IGNhdGNoIChlcnIpIHt9CgkvKiBOT1AgKi8KCgkvKiBpc3RhbmJ1bCBpZ25vcmUgaWY6IHRlc3RlZCBidXQgbm90IGNvdmVyZWQgaW4gaXN0YW5idWwgZHVlIHRvIGRpc3QgYnVpbGQgICovCglpZiAoIVNvdXJjZU5vZGUpIHsKCSAgU291cmNlTm9kZSA9IGZ1bmN0aW9uIChsaW5lLCBjb2x1bW4sIHNyY0ZpbGUsIGNodW5rcykgewoJICAgIHRoaXMuc3JjID0gJyc7CgkgICAgaWYgKGNodW5rcykgewoJICAgICAgdGhpcy5hZGQoY2h1bmtzKTsKCSAgICB9CgkgIH07CgkgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgkgIFNvdXJjZU5vZGUucHJvdG90eXBlID0gewoJICAgIGFkZDogZnVuY3Rpb24gYWRkKGNodW5rcykgewoJICAgICAgaWYgKF91dGlscy5pc0FycmF5KGNodW5rcykpIHsKCSAgICAgICAgY2h1bmtzID0gY2h1bmtzLmpvaW4oJycpOwoJICAgICAgfQoJICAgICAgdGhpcy5zcmMgKz0gY2h1bmtzOwoJICAgIH0sCgkgICAgcHJlcGVuZDogZnVuY3Rpb24gcHJlcGVuZChjaHVua3MpIHsKCSAgICAgIGlmIChfdXRpbHMuaXNBcnJheShjaHVua3MpKSB7CgkgICAgICAgIGNodW5rcyA9IGNodW5rcy5qb2luKCcnKTsKCSAgICAgIH0KCSAgICAgIHRoaXMuc3JjID0gY2h1bmtzICsgdGhpcy5zcmM7CgkgICAgfSwKCSAgICB0b1N0cmluZ1dpdGhTb3VyY2VNYXA6IGZ1bmN0aW9uIHRvU3RyaW5nV2l0aFNvdXJjZU1hcCgpIHsKCSAgICAgIHJldHVybiB7IGNvZGU6IHRoaXMudG9TdHJpbmcoKSB9OwoJICAgIH0sCgkgICAgdG9TdHJpbmc6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewoJICAgICAgcmV0dXJuIHRoaXMuc3JjOwoJICAgIH0KCSAgfTsKCX0KCglmdW5jdGlvbiBjYXN0Q2h1bmsoY2h1bmssIGNvZGVHZW4sIGxvYykgewoJICBpZiAoX3V0aWxzLmlzQXJyYXkoY2h1bmspKSB7CgkgICAgdmFyIHJldCA9IFtdOwoKCSAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gY2h1bmsubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCSAgICAgIHJldC5wdXNoKGNvZGVHZW4ud3JhcChjaHVua1tpXSwgbG9jKSk7CgkgICAgfQoJICAgIHJldHVybiByZXQ7CgkgIH0gZWxzZSBpZiAodHlwZW9mIGNodW5rID09PSAnYm9vbGVhbicgfHwgdHlwZW9mIGNodW5rID09PSAnbnVtYmVyJykgewoJICAgIC8vIEhhbmRsZSBwcmltaXRpdmVzIHRoYXQgdGhlIFNvdXJjZU5vZGUgd2lsbCB0aHJvdyB1cCBvbgoJICAgIHJldHVybiBjaHVuayArICcnOwoJICB9CgkgIHJldHVybiBjaHVuazsKCX0KCglmdW5jdGlvbiBDb2RlR2VuKHNyY0ZpbGUpIHsKCSAgdGhpcy5zcmNGaWxlID0gc3JjRmlsZTsKCSAgdGhpcy5zb3VyY2UgPSBbXTsKCX0KCglDb2RlR2VuLnByb3RvdHlwZSA9IHsKCSAgaXNFbXB0eTogZnVuY3Rpb24gaXNFbXB0eSgpIHsKCSAgICByZXR1cm4gIXRoaXMuc291cmNlLmxlbmd0aDsKCSAgfSwKCSAgcHJlcGVuZDogZnVuY3Rpb24gcHJlcGVuZChzb3VyY2UsIGxvYykgewoJICAgIHRoaXMuc291cmNlLnVuc2hpZnQodGhpcy53cmFwKHNvdXJjZSwgbG9jKSk7CgkgIH0sCgkgIHB1c2g6IGZ1bmN0aW9uIHB1c2goc291cmNlLCBsb2MpIHsKCSAgICB0aGlzLnNvdXJjZS5wdXNoKHRoaXMud3JhcChzb3VyY2UsIGxvYykpOwoJICB9LAoKCSAgbWVyZ2U6IGZ1bmN0aW9uIG1lcmdlKCkgewoJICAgIHZhciBzb3VyY2UgPSB0aGlzLmVtcHR5KCk7CgkgICAgdGhpcy5lYWNoKGZ1bmN0aW9uIChsaW5lKSB7CgkgICAgICBzb3VyY2UuYWRkKFsnICAnLCBsaW5lLCAnXG4nXSk7CgkgICAgfSk7CgkgICAgcmV0dXJuIHNvdXJjZTsKCSAgfSwKCgkgIGVhY2g6IGZ1bmN0aW9uIGVhY2goaXRlcikgewoJICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLnNvdXJjZS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJICAgICAgaXRlcih0aGlzLnNvdXJjZVtpXSk7CgkgICAgfQoJICB9LAoKCSAgZW1wdHk6IGZ1bmN0aW9uIGVtcHR5KCkgewoJICAgIHZhciBsb2MgPSB0aGlzLmN1cnJlbnRMb2NhdGlvbiB8fCB7IHN0YXJ0OiB7fSB9OwoJICAgIHJldHVybiBuZXcgU291cmNlTm9kZShsb2Muc3RhcnQubGluZSwgbG9jLnN0YXJ0LmNvbHVtbiwgdGhpcy5zcmNGaWxlKTsKCSAgfSwKCSAgd3JhcDogZnVuY3Rpb24gd3JhcChjaHVuaykgewoJICAgIHZhciBsb2MgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB0aGlzLmN1cnJlbnRMb2NhdGlvbiB8fCB7IHN0YXJ0OiB7fSB9IDogYXJndW1lbnRzWzFdOwoKCSAgICBpZiAoY2h1bmsgaW5zdGFuY2VvZiBTb3VyY2VOb2RlKSB7CgkgICAgICByZXR1cm4gY2h1bms7CgkgICAgfQoKCSAgICBjaHVuayA9IGNhc3RDaHVuayhjaHVuaywgdGhpcywgbG9jKTsKCgkgICAgcmV0dXJuIG5ldyBTb3VyY2VOb2RlKGxvYy5zdGFydC5saW5lLCBsb2Muc3RhcnQuY29sdW1uLCB0aGlzLnNyY0ZpbGUsIGNodW5rKTsKCSAgfSwKCgkgIGZ1bmN0aW9uQ2FsbDogZnVuY3Rpb24gZnVuY3Rpb25DYWxsKGZuLCB0eXBlLCBwYXJhbXMpIHsKCSAgICBwYXJhbXMgPSB0aGlzLmdlbmVyYXRlTGlzdChwYXJhbXMpOwoJICAgIHJldHVybiB0aGlzLndyYXAoW2ZuLCB0eXBlID8gJy4nICsgdHlwZSArICcoJyA6ICcoJywgcGFyYW1zLCAnKSddKTsKCSAgfSwKCgkgIHF1b3RlZFN0cmluZzogZnVuY3Rpb24gcXVvdGVkU3RyaW5nKHN0cikgewoJICAgIHJldHVybiAnIicgKyAoc3RyICsgJycpLnJlcGxhY2UoL1xcL2csICdcXFxcJykucmVwbGFjZSgvIi9nLCAnXFwiJykucmVwbGFjZSgvXG4vZywgJ1xcbicpLnJlcGxhY2UoL1xyL2csICdcXHInKS5yZXBsYWNlKC9cdTIwMjgvZywgJ1xcdTIwMjgnKSAvLyBQZXIgRWNtYS0yNjIgNy4zICsgNy44LjQKCSAgICAucmVwbGFjZSgvXHUyMDI5L2csICdcXHUyMDI5JykgKyAnIic7CgkgIH0sCgoJICBvYmplY3RMaXRlcmFsOiBmdW5jdGlvbiBvYmplY3RMaXRlcmFsKG9iaikgewoJICAgIHZhciBwYWlycyA9IFtdOwoKCSAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CgkgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHsKCSAgICAgICAgdmFyIHZhbHVlID0gY2FzdENodW5rKG9ialtrZXldLCB0aGlzKTsKCSAgICAgICAgaWYgKHZhbHVlICE9PSAndW5kZWZpbmVkJykgewoJICAgICAgICAgIHBhaXJzLnB1c2goW3RoaXMucXVvdGVkU3RyaW5nKGtleSksICc6JywgdmFsdWVdKTsKCSAgICAgICAgfQoJICAgICAgfQoJICAgIH0KCgkgICAgdmFyIHJldCA9IHRoaXMuZ2VuZXJhdGVMaXN0KHBhaXJzKTsKCSAgICByZXQucHJlcGVuZCgneycpOwoJICAgIHJldC5hZGQoJ30nKTsKCSAgICByZXR1cm4gcmV0OwoJICB9LAoKCSAgZ2VuZXJhdGVMaXN0OiBmdW5jdGlvbiBnZW5lcmF0ZUxpc3QoZW50cmllcykgewoJICAgIHZhciByZXQgPSB0aGlzLmVtcHR5KCk7CgoJICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBlbnRyaWVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkgICAgICBpZiAoaSkgewoJICAgICAgICByZXQuYWRkKCcsJyk7CgkgICAgICB9CgoJICAgICAgcmV0LmFkZChjYXN0Q2h1bmsoZW50cmllc1tpXSwgdGhpcykpOwoJICAgIH0KCgkgICAgcmV0dXJuIHJldDsKCSAgfSwKCgkgIGdlbmVyYXRlQXJyYXk6IGZ1bmN0aW9uIGdlbmVyYXRlQXJyYXkoZW50cmllcykgewoJICAgIHZhciByZXQgPSB0aGlzLmdlbmVyYXRlTGlzdChlbnRyaWVzKTsKCSAgICByZXQucHJlcGVuZCgnWycpOwoJICAgIHJldC5hZGQoJ10nKTsKCgkgICAgcmV0dXJuIHJldDsKCSAgfQoJfTsKCglleHBvcnRzWydkZWZhdWx0J10gPSBDb2RlR2VuOwoJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9Ci8qKioqKiovIF0pCn0pOwo7Cn1jYXRjaChlKXtjb25zb2xlLmxvZygiTW9kdWxlICdocFN0eWxlUjInOiAiLGUpO30=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="1512931265" offset="0" length="16384" />
        <PacketInfo time="1512931281" offset="16384" length="16384" />
        <PacketInfo time="1512931281" offset="32768" length="16384" />
        <PacketInfo time="1512931281" offset="49152" length="16384" />
        <PacketInfo time="1512931281" offset="65536" length="16384" />
        <PacketInfo time="1512931281" offset="81920" length="16384" />
        <PacketInfo time="1512931281" offset="98304" length="16384" />
        <PacketInfo time="1512931296" offset="114688" length="16384" />
        <PacketInfo time="1512931296" offset="131072" length="16384" />
        <PacketInfo time="1512931296" offset="147456" length="16384" />
        <PacketInfo time="1512931312" offset="163840" length="16384" />
        <PacketInfo time="1512931312" offset="180224" length="16384" />
        <PacketInfo time="1512931312" offset="196608" length="16384" />
        <PacketInfo time="1512931312" offset="212992" length="16384" />
        <PacketInfo time="1512931312" offset="229376" length="16384" />
        <PacketInfo time="1512931328" offset="245760" length="16384" />
        <PacketInfo time="1512931328" offset="262144" length="16384" />
        <PacketInfo time="1512931328" offset="278528" length="5648" />
      </TcpPackets>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>